{
    "url": "http://localhost:9999/cgross/owf-bower/owf-widget-debug.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Client-side JSON injection (DOM-based)",
    "issueType": 2098032,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based JSON injection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and incorporates this into a string that is parsed as a JSON data structure and then processed by the application. An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause arbitrary JSON data to be processed. Depending on the purpose for which this data is used, it may be possible to subvert the application's logic, or cause unintended actions on behalf of the user.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based JSON injection vulnerabilities is not to parse as JSON any string containing data that originated from an untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from modifying the JSON structure in inappropriate ways. This may involve strict validation of specific items to ensure they do not contain any characters that may interfere with the structure of the JSON when it is parsed.",
    "issueDetail": "The application may be vulnerable to DOM-based client-side JSON injection. Data is read from <b>window.name</b> and written to <b>JSON.parse()</b> via the following statement:<ul><li>config = JSON.parse(window.name);</li></ul><b>Note:</b> The name of the current window is a valid attack vector for DOM-based vulnerabilities. An attacker can directly control the name of the targeted application's window by using code on their own domain to load the targeted page using either window.open() or an iframe tag, and specifying the desired window name. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/cgross/owf-bower/owf-widget-debug.js",
                "path": "/cgross/owf-bower/owf-widget-debug.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9jZ3Jvc3Mvb3dmLWJvd2VyL293Zi13aWRnZXQtZGVidWcuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTAzMzE4Mg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAyMTozMTo1OSBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMjE6MzE6NTkgR01UDQoNCi8qDQoJQ29weXJpZ2h0IChjKSAyMDA0LTIwMTAsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4NCglBdmFpbGFibGUgdmlhIEFjYWRlbWljIEZyZWUgTGljZW5zZSA+PSAyLjEgT1IgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlLg0KCXNlZTogaHR0cDovL2Rvam90b29sa2l0Lm9yZy9saWNlbnNlIGZvciBkZXRhaWxzDQoqLw0KDQovKg0KCVRoaXMgaXMgYW4gb3B0aW1pemVkIHZlcnNpb24gb2YgRG9qbywgYnVpbHQgZm9yIGRlcGxveW1lbnQgYW5kIG5vdCBmb3INCglkZXZlbG9wbWVudC4gVG8gZ2V0IHNvdXJjZXMgYW5kIGRvY3VtZW50YXRpb24sIHBsZWFzZSB2aXNpdDoNCg0KCQlodHRwOi8vZG9qb3Rvb2xraXQub3JnDQoqLw0KDQo7KGZ1bmN0aW9uKCl7DQoNCgkvKg0KCWRvam8sIGRpaml0LCBhbmQgZG9qb3ggbXVzdCBhbHdheXMgYmUgdGhlIGZpcnN0IHRocmVlLCBhbmQgaW4gdGhhdCBvcmRlci4NCglkakNvbmZpZy5zY29wZU1hcCA9IFsNCgkJWyJkb2pvIiwgImZvam8iXSwNCgkJWyJkaWppdCIsICJmaWppdCJdLA0KCQlbImRvam94IiwgImZvam94Il0NCgkNCgldDQoJKi8NCg0KCWV2YWwoInZhciBkakNvbmZpZyA9IHtzY29wZU1hcDpbW1wiZG9qb1wiLFwib3dmZG9qb1wiXSxbXCJkaWppdFwiLFwib3dmZGlqaXRcIl0sW1wiZG9qb3hcIixcIm93ZmRvam94XCJdXX07Iik7DQoNCgkvL1RoZSBudWxsIGJlbG93IGNhbiBiZSByZWxhY2VkIGJ5IGEgYnVpbGQtdGltZSB2YWx1ZSB1c2VkIGluc3RlYWQgb2YgZGpDb25maWcuc2NvcGVNYXAuDQoJdmFyIHNNYXAgPSBudWxsOw0KDQoJLy9TZWUgaWYgbmV3IHNjb3BlcyBuZWVkIHRvIGJlIGRlZmluZWQuDQoJaWYoKHNNYXAgfHwgKHR5cGVvZiBkakNvbmZpZyAhPSAidW5kZWZpbmVkIiAmJiBkakNvbmZpZy5zY29wZU1hcCkpICYmICh0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiKSl7DQoJCXZhciBzY29wZURlZiA9ICIiLCBzY29wZVByZWZpeCA9ICIiLCBzY29wZVN1ZmZpeCA9ICIiLCBzY29wZU1hcCA9IHt9LCBzY29wZU1hcFJldiA9IHt9Ow0KCQlzTWFwID0gc01hcCB8fCBkakNvbmZpZy5zY29wZU1hcDsNCgkJZm9yKHZhciBpID0gMDsgaSA8IHNNYXAubGVuZ3RoOyBpKyspew0KCQkJLy9NYWtlIGxvY2FsIHZhcmlhYmxlcywgdGhlbiBnbG9iYWwgdmFyaWFibGVzIHRoYXQgdXNlIHRoZSBsb2NhbHMuDQoJCQl2YXIgbmV3U2NvcGUgPSBzTWFwW2ldOw0KCQkJc2NvcGVEZWYgKz0gInZhciAiICsgbmV3U2NvcGVbMF0gKyAiID0ge307ICIgKyBuZXdTY29wZVsxXSArICIgPSAiICsgbmV3U2NvcGVbMF0gKyAiOyIgKyBuZXdTY29wZVsxXSArICIuX3Njb3BlTmFtZSA9ICciICsgbmV3U2NvcGVbMV0gKyAiJzsiOw0KCQkJc2NvcGVQcmVmaXggKz0gKGkgPT0gMCA/ICIiIDogIiwiKSArIG5ld1Njb3BlWzBdOw0KCQkJc2NvcGVTdWZmaXggKz0gKGkgPT0gMCA/ICIiIDogIiwiKSArIG5ld1Njb3BlWzFdOw0KCQkJc2NvcGVNYXBbbmV3U2NvcGVbMF1dID0gbmV3U2NvcGVbMV07DQoJCQlzY29wZU1hcFJldltuZXdTY29wZVsxXV0gPSBuZXdTY29wZVswXTsNCgkJfQ0KDQoJCWV2YWwoc2NvcGVEZWYgKyAiZG9qby5fc2NvcGVBcmdzID0gWyIgKyBzY29wZVN1ZmZpeCArICJdOyIpOw0KDQoJCWRvam8uX3Njb3BlUHJlZml4QXJncyA9IHNjb3BlUHJlZml4Ow0KCQlkb2pvLl9zY29wZVByZWZpeCA9ICIoZnVuY3Rpb24oIiArIHNjb3BlUHJlZml4ICsgIil7IjsNCgkJZG9qby5fc2NvcGVTdWZmaXggPSAifSkoIiArIHNjb3BlU3VmZml4ICsgIikiOw0KCQlkb2pvLl9zY29wZU1hcCA9IHNjb3BlTWFwOw0KCQlkb2pvLl9zY29wZU1hcFJldiA9IHNjb3BlTWFwUmV2Ow0KCX0NCg0KLyo9PT09PQ0KLy8gbm90ZToNCi8vCQknZGpDb25maWcnIGRvZXMgbm90IGV4aXN0IHVuZGVyICdkb2pvLionIHNvIHRoYXQgaXQgY2FuIGJlIHNldCBiZWZvcmUgdGhlDQovLwkJJ2Rvam8nIHZhcmlhYmxlIGV4aXN0cy4NCi8vIG5vdGU6DQovLwkJU2V0dGluZyBhbnkgb2YgdGhlc2UgdmFyaWFibGVzICphZnRlciogdGhlIGxpYnJhcnkgaGFzIGxvYWRlZCBkb2VzDQovLwkJbm90aGluZyBhdCBhbGwuDQoNCmRqQ29uZmlnID0gew0KCS8vIHN1bW1hcnk6DQoJLy8JCUFwcGxpY2F0aW9uIGNvZGUgY2FuIHNldCB0aGUgZ2xvYmFsICdkakNvbmZpZycgcHJpb3IgdG8gbG9hZGluZw0KCS8vCQl0aGUgbGlicmFyeSB0byBvdmVycmlkZSBjZXJ0YWluIGdsb2JhbCBzZXR0aW5ncyBmb3IgaG93IGRvam8gd29ya3MuDQoJLy8NCgkvLyBpc0RlYnVnOiBCb29sZWFuDQoJLy8JCURlZmF1bHRzIHRvIGBmYWxzZWAuIElmIHNldCB0byBgdHJ1ZWAsIGVuc3VyZXMgdGhhdCBEb2pvIHByb3ZpZGVzDQoJLy8JCWV4dGVuZGVkIGRlYnVnZ2luZyBmZWVkYmFjayB2aWEgRmlyZWJ1Zy4gSWYgRmlyZWJ1ZyBpcyBub3QgYXZhaWxhYmxlDQoJLy8JCW9uIHlvdXIgcGxhdGZvcm0sIHNldHRpbmcgYGlzRGVidWdgIHRvIGB0cnVlYCB3aWxsIGZvcmNlIERvam8gdG8NCgkvLwkJcHVsbCBpbiAoYW5kIGRpc3BsYXkpIHRoZSB2ZXJzaW9uIG9mIEZpcmVidWcgTGl0ZSB3aGljaCBpcw0KCS8vCQlpbnRlZ3JhdGVkIGludG8gdGhlIERvam8gZGlzdHJpYnV0aW9uLCB0aGVyZWJ5IGFsd2F5cyBwcm92aWRpbmcgYQ0KCS8vCQlkZWJ1Z2dpbmcvbG9nZ2luZyBjb25zb2xlIHdoZW4gYGlzRGVidWdgIGlzIGVuYWJsZWQuIE5vdGUgdGhhdA0KCS8vCQlGaXJlYnVnJ3MgYGNvbnNvbGUuKmAgbWV0aG9kcyBhcmUgQUxXQVlTIGRlZmluZWQgYnkgRG9qby4gSWYNCgkvLwkJYGlzRGVidWdgIGlzIGZhbHNlIGFuZCB5b3UgYXJlIG9uIGEgcGxhdGZvcm0gd2l0aG91dCBGaXJlYnVnLCB0aGVzZQ0KCS8vCQltZXRob2RzIHdpbGwgYmUgZGVmaW5lZCBhcyBuby1vcHMuDQoJaXNEZWJ1ZzogZmFsc2UsDQoJLy8gZGVidWdBdEFsbENvc3RzOiBCb29sZWFuDQoJLy8JCURlZmF1bHRzIHRvIGBmYWxzZWAuIElmIHNldCB0byBgdHJ1ZWAsIHRoaXMgdHJpZ2dlcnMgYW4gYWx0ZXJuYXRlDQoJLy8JCW1vZGUgb2YgdGhlIHBhY2thZ2Ugc3lzdGVtIGluIHdoaWNoIGRlcGVuZGVuY2llcyBhcmUgZGV0ZWN0ZWQgYW5kDQoJLy8JCW9ubHkgdGhlbiBhcmUgcmVzb3VyY2VzIGV2YWx1YXRlZCBpbiBkZXBlbmRlbmN5IG9yZGVyIHZpYQ0KCS8vCQlgPHNjcmlwdD5gIHRhZyBpbmNsdXNpb24uIFRoaXMgbWF5IGRvdWJsZS1yZXF1ZXN0IHJlc291cmNlcyBhbmQNCgkvLwkJY2F1c2UgcHJvYmxlbXMgd2l0aCBzY3JpcHRzIHdoaWNoIGV4cGVjdCBgZG9qby5yZXF1aXJlKClgIHRvDQoJLy8JCXByZWZvcm0gc3luY2hyb25vdXNseS4gYGRlYnVnQXRBbGxDb3N0c2AgY2FuIGJlIGFuIGludmFsdWFibGUNCgkvLwkJZGVidWdnaW5nIGFpZCwgYnV0IHdoZW4gdXNpbmcgaXQsIGVuc3VyZSB0aGF0IGFsbCBjb2RlIHdoaWNoDQoJLy8JCWRlcGVuZHMgb24gRG9qbyBtb2R1bGVzIGlzIHdyYXBwZWQgaW4gYGRvam8uYWRkT25Mb2FkKClgIGhhbmRsZXJzLg0KCS8vCQlEdWUgdG8gdGhlIHNvbWV3aGF0IHVucHJlZGljdGFibGUgc2lkZS1lZmZlY3RzIG9mIHVzaW5nDQoJLy8JCWBkZWJ1Z0F0QWxsQ29zdHNgLCBpdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0aGF0IHlvdSBlbmFibGUgdGhpcw0KCS8vCQlmbGFnIGFzIGEgbGFzdCByZXNvcnQuIGBkZWJ1Z0F0QWxsQ29zdHNgIGhhcyBubyBlZmZlY3Qgd2hlbiBsb2FkaW5nDQoJLy8JCXJlc291cmNlcyBhY3Jvc3MgZG9tYWlucy4gRm9yIHVzYWdlIGluZm9ybWF0aW9uLCBzZWUgdGhlDQoJLy8JCVtEb2pvIEJvb2tdKGh0dHA6Ly9kb2pvdG9vbGtpdC5vcmcvYm9vay9ib29rLWRvam8vcGFydC00LW1ldGEtZG9qby1tYWtpbmcteW91ci1kb2pvLWNvZGUtcnVuLWZhc3Rlci1hbmQtYmV0dGVyL2RlYnVnZ2luZy1mYWNpbGl0aWVzL2RlYikNCglkZWJ1Z0F0QWxsQ29zdHM6IGZhbHNlLA0KCS8vIGxvY2FsZTogU3RyaW5nDQoJLy8JCVRoZSBsb2NhbGUgdG8gYXNzdW1lIGZvciBsb2FkaW5nIGxvY2FsaXplZCByZXNvdXJjZXMgaW4gdGhpcyBwYWdlLA0KCS8vCQlzcGVjaWZpZWQgYWNjb3JkaW5nIHRvIFtSRkMgMzA2Nl0oaHR0cDovL3d3dy5pZXRmLm9yZy9yZmMvcmZjMzA2Ni50eHQpLg0KCS8vCQlNdXN0IGJlIHNwZWNpZmllZCBlbnRpcmVseSBpbiBsb3dlcmNhc2UsIGUuZy4gYGVuLXVzYCBhbmQgYHpoLWNuYC4NCgkvLwkJU2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciBgZG9qby5pMThuYCBhbmQgYGRvam8ucmVxdWlyZUxvY2FsaXphdGlvbmANCgkvLwkJZm9yIGRldGFpbHMgb24gbG9hZGluZyBsb2NhbGl6ZWQgcmVzb3VyY2VzLiBJZiBubyBsb2NhbGUgaXMgc3BlY2lmaWVkLA0KCS8vCQlEb2pvIGFzc3VtZXMgdGhlIGxvY2FsZSBvZiB0aGUgdXNlciBhZ2VudCwgYWNjb3JkaW5nIHRvIGBuYXZpZ2F0b3IudXNlckxhbmd1YWdlYA0KCS8vCQlvciBgbmF2aWdhdG9yLmxhbmd1YWdlYCBwcm9wZXJ0aWVzLg0KCWxvY2FsZTogdW5kZWZpbmVkLA0KCS8vIGV4dHJhTG9jYWxlOiBBcnJheQ0KCS8vCQlObyBkZWZhdWx0IHZhbHVlLiBTcGVjaWZpZXMgYWRkaXRpb25hbCBsb2NhbGVzIHdob3NlDQoJLy8JCXJlc291cmNlcyBzaG91bGQgYWxzbyBiZSBsb2FkZWQgYWxvbmdzaWRlIHRoZSBkZWZhdWx0IGxvY2FsZSB3aGVuDQoJLy8JCWNhbGxzIHRvIGBkb2pvLnJlcXVpcmVMb2NhbGl6YXRpb24oKWAgYXJlIHByb2Nlc3NlZC4NCglleHRyYUxvY2FsZTogdW5kZWZpbmVkLA0KCS8vIGJhc2VVcmw6IFN0cmluZw0KCS8vCQlUaGUgZGlyZWN0b3J5IGluIHdoaWNoIGBkb2pvLmpzYCBpcyBsb2NhdGVkLiBVbmRlciBub3JtYWwNCgkvLwkJY29uZGl0aW9ucywgRG9qbyBhdXRvLWRldGVjdHMgdGhlIGNvcnJlY3QgbG9jYXRpb24gZnJvbSB3aGljaCBpdA0KCS8vCQl3YXMgbG9hZGVkLiBZb3UgbWF5IG5lZWQgdG8gbWFudWFsbHkgY29uZmlndXJlIGBiYXNlVXJsYCBpbiBjYXNlcw0KCS8vCQl3aGVyZSB5b3UgaGF2ZSByZW5hbWVkIGBkb2pvLmpzYCBvciBpbiB3aGljaCBgPGJhc2U+YCB0YWdzIGNvbmZ1c2UNCgkvLwkJc29tZSBicm93c2VycyAoZS5nLiBJRSA2KS4gVGhlIHZhcmlhYmxlIGBkb2pvLmJhc2VVcmxgIGlzIGFzc2lnbmVkDQoJLy8JCWVpdGhlciB0aGUgdmFsdWUgb2YgYGRqQ29uZmlnLmJhc2VVcmxgIGlmIG9uZSBpcyBwcm92aWRlZCBvciB0aGUNCgkvLwkJYXV0by1kZXRlY3RlZCByb290IGlmIG5vdC4gT3RoZXIgbW9kdWxlcyBhcmUgbG9jYXRlZCByZWxhdGl2ZSB0bw0KCS8vCQl0aGlzIHBhdGguIFRoZSBwYXRoIHNob3VsZCBlbmQgaW4gYSBzbGFzaC4NCgliYXNlVXJsOiB1bmRlZmluZWQsDQoJLy8gbW9kdWxlUGF0aHM6IE9iamVjdA0KCS8vCQlBIG1hcCBvZiBtb2R1bGUgbmFtZXMgdG8gcGF0aHMgcmVsYXRpdmUgdG8gYGRvam8uYmFzZVVybGAuIFRoZQ0KCS8vCQlrZXkvdmFsdWUgcGFpcnMgY29ycmVzcG9uZCBkaXJlY3RseSB0byB0aGUgYXJndW1lbnRzIHdoaWNoDQoJLy8JCWBkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aGAgYWNjZXB0cy4gU3BlY2lmaXlpbmcNCgkvLwkJYGRqQ29uZmlnLm1vZHVsZVBhdGhzID0geyAiZm9vIjogIi4uLy4uL2JhciIgfWAgaXMgdGhlIGVxdWl2YWxlbnQNCgkvLwkJb2YgY2FsbGluZyBgZG9qby5yZWdpc3Rlck1vZHVsZVBhdGgoImZvbyIsICIuLi8uLi9iYXIiKTtgLiBNdWx0aXBsZQ0KCS8vCQltb2R1bGVzIG1heSBiZSBjb25maWd1cmVkIHZpYSBgZGpDb25maWcubW9kdWxlUGF0aHNgLg0KCW1vZHVsZVBhdGhzOiB7fSwNCgkvLyBhZnRlck9uTG9hZDogQm9vbGVhbiANCgkvLwkJSW5kaWNhdGVzIERvam8gd2FzIGFkZGVkIHRvIHRoZSBwYWdlIGFmdGVyIHRoZSBwYWdlIGxvYWQuIEluIHRoaXMgY2FzZQ0KCS8vCQlEb2pvIHdpbGwgbm90IHdhaXQgZm9yIHRoZSBwYWdlIERPTUNvbnRlbnRMb2FkL2xvYWQgZXZlbnRzIGFuZCBmaXJlDQoJLy8JCWl0cyBkb2pvLmFkZE9uTG9hZCBjYWxsYmFja3MgYWZ0ZXIgbWFraW5nIHN1cmUgYWxsIG91dHN0YW5kaW5nDQoJLy8JCWRvam8ucmVxdWlyZWQgbW9kdWxlcyBoYXZlIGxvYWRlZC4gT25seSB3b3JrcyB3aXRoIGEgYnVpbHQgZG9qby5qcywNCgkvLwkJaXQgZG9lcyBub3Qgd29yayB0aGUgZG9qby5qcyBkaXJlY3RseSBmcm9tIHNvdXJjZSBjb250cm9sLg0KCWFmdGVyT25Mb2FkOiBmYWxzZSwNCgkvLyBhZGRPbkxvYWQ6IEZ1bmN0aW9uIG9yIEFycmF5DQoJLy8JCUFkZHMgYSBjYWxsYmFjayB2aWEgZG9qby5hZGRPbkxvYWQuIFVzZWZ1bCB3aGVuIERvam8gaXMgYWRkZWQgYWZ0ZXINCgkvLwkJdGhlIHBhZ2UgbG9hZHMgYW5kIGRqQ29uZmlnLmFmdGVyT25Mb2FkIGlzIHRydWUuIFN1cHBvcnRzIHRoZSBzYW1lDQoJLy8JCWFyZ3VtZW50cyBhcyBkb2pvLmFkZE9uTG9hZC4gV2hlbiB1c2luZyBhIGZ1bmN0aW9uIHJlZmVyZW5jZSwgdXNlDQoJLy8JCWBkakNvbmZpZy5hZGRPbkxvYWQgPSBmdW5jdGlvbigpe307YC4gRm9yIG9iamVjdCB3aXRoIGZ1bmN0aW9uIG5hbWUgdXNlDQoJLy8JCWBkakNvbmZpZy5hZGRPbkxvYWQgPSBbbXlPYmplY3QsICJmdW5jdGlvbk5hbWUiXTtgIGFuZCBmb3Igb2JqZWN0IHdpdGgNCgkvLwkJZnVuY3Rpb24gcmVmZXJlbmNlIHVzZQ0KCS8vCQlgZGpDb25maWcuYWRkT25Mb2FkID0gW215T2JqZWN0LCBmdW5jdGlvbigpe31dO2ANCglhZGRPbkxvYWQ6IG51bGwsDQoJLy8gcmVxdWlyZTogQXJyYXkNCgkvLwkJQW4gYXJyYXkgb2YgbW9kdWxlIG5hbWVzIHRvIGJlIGxvYWRlZCBpbW1lZGlhdGVseSBhZnRlciBkb2pvLmpzIGhhcyBiZWVuIGluY2x1ZGVkDQoJLy8JCWluIGEgcGFnZS4NCglyZXF1aXJlOiBbXSwNCgkvLyBkZWZhdWx0RHVyYXRpb246IEFycmF5DQoJLy8JCURlZmF1bHQgZHVyYXRpb24sIGluIG1pbGxpc2Vjb25kcywgZm9yIHdpcGUgYW5kIGZhZGUgYW5pbWF0aW9ucyB3aXRoaW4gZGlqaXRzLg0KCS8vCQlBc3NpZ25lZCB0byBkaWppdC5kZWZhdWx0RHVyYXRpb24uDQoJZGVmYXVsdER1cmF0aW9uOiAyMDAsDQoJLy8gZG9qb0JsYW5rSHRtbFVybDogU3RyaW5nDQoJLy8JCVVzZWQgYnkgc29tZSBtb2R1bGVzIHRvIGNvbmZpZ3VyZSBhbiBlbXB0eSBpZnJhbWUuIFVzZWQgYnkgZG9qby5pby5pZnJhbWUgYW5kDQoJLy8JCWRvam8uYmFjaywgYW5kIGRpaml0IHBvcHVwIHN1cHBvcnQgaW4gSUUgd2hlcmUgYW4gaWZyYW1lIGlzIG5lZWRlZCB0byBtYWtlIHN1cmUgbmF0aXZlDQoJLy8JCWNvbnRyb2xzIGRvIG5vdCBibGVlZCB0aHJvdWdoIHRoZSBwb3B1cHMuIE5vcm1hbGx5IHRoaXMgY29uZmlndXJhdGlvbiB2YXJpYWJsZSANCgkvLwkJZG9lcyBub3QgbmVlZCB0byBiZSBzZXQsIGV4Y2VwdCB3aGVuIHVzaW5nIGNyb3NzLWRvbWFpbi9DRE4gRG9qbyBidWlsZHMuDQoJLy8JCVNhdmUgZG9qby9yZXNvdXJjZXMvYmxhbmsuaHRtbCB0byB5b3VyIGRvbWFpbiBhbmQgc2V0IGBkakNvbmZpZy5kb2pvQmxhbmtIdG1sVXJsYA0KCS8vCQl0byB0aGUgcGF0aCBvbiB5b3VyIGRvbWFpbiB5b3VyIGNvcHkgb2YgYmxhbmsuaHRtbC4NCglkb2pvQmxhbmtIdG1sVXJsOiB1bmRlZmluZWQsDQoJLy8JaW9QdWJsaXNoOiBCb29sZWFuPw0KCS8vCQlTZXQgdGhpcyB0byB0cnVlIHRvIGVuYWJsZSBwdWJsaXNoaW5nIG9mIHRvcGljcyBmb3IgdGhlIGRpZmZlcmVudCBwaGFzZXMgb2YNCgkvLyAJCUlPIG9wZXJhdGlvbnMuIFB1Ymxpc2hpbmcgaXMgZG9uZSB2aWEgZG9qby5wdWJsaXNoLiBTZWUgZG9qby5fX0lvUHVibGlzaCBmb3IgYSBsaXN0DQoJLy8gCQlvZiB0b3BpY3MgdGhhdCBhcmUgcHVibGlzaGVkLg0KCWlvUHVibGlzaDogZmFsc2UsDQoJLy8gIHVzZUN1c3RvbUxvZ2dlcjogQW55dGhpbmc/DQoJLy8JCUlmIHNldCB0byBhIHZhbHVlIHRoYXQgZXZhbHVhdGVzIHRvIHRydWUgc3VjaCBhcyBhIHN0cmluZyBvciBhcnJheSBhbmQNCgkvLwkJaXNEZWJ1ZyBpcyB0cnVlIGFuZCBGaXJlYnVnIGlzIG5vdCBhdmFpbGFibGUgb3IgcnVubmluZywgdGhlbiBpdCBieXBhc3Nlcw0KCS8vCQl0aGUgY3JlYXRpb24gb2YgRmlyZWJ1ZyBMaXRlIGFsbG93aW5nIHlvdSB0byBkZWZpbmUgeW91ciBvd24gY29uc29sZSBvYmplY3QuDQoJdXNlQ3VzdG9tTG9nZ2VyOiB1bmRlZmluZWQsDQoJLy8gdHJhbnNwYXJlbnRDb2xvcjogQXJyYXkNCgkvLwkJQXJyYXkgY29udGFpbmluZyB0aGUgciwgZywgYiBjb21wb25lbnRzIHVzZWQgYXMgdHJhbnNwYXJlbnQgY29sb3IgaW4gZG9qby5Db2xvcjsNCgkvLwkJaWYgdW5kZWZpbmVkLCBbMjU1LDI1NSwyNTVdICh3aGl0ZSkgd2lsbCBiZSB1c2VkLg0KCXRyYW5zcGFyZW50Q29sb3I6IHVuZGVmaW5lZCwNCgkvLyBza2lwSWVEb21Mb2FkZWQ6IEJvb2xlYW4NCgkvLwkJRm9yIElFIG9ubHksIHNraXAgdGhlIERPTUNvbnRlbnRMb2FkZWQgaGFjayB1c2VkLiBTb21ldGltZXMgaXQgY2FuIGNhdXNlIGFuIE9wZXJhdGlvbg0KCS8vCQlBYm9ydGVkIGVycm9yIGlmIHRoZSByZXN0IG9mIHRoZSBwYWdlIHRyaWdnZXJzIHNjcmlwdCBkZWZlcnMgYmVmb3JlIHRoZSBET00gaXMgcmVhZHkuDQoJLy8JCUlmIHRoaXMgaXMgY29uZmlnIHZhbHVlIGlzIHNldCB0byB0cnVlLCB0aGVuIGRvam8uYWRkT25Mb2FkIGNhbGxiYWNrcyB3aWxsIG5vdCBiZQ0KCS8vCQl0cmlnZ2VyZWQgdW50aWwgdGhlIHBhZ2UgbG9hZCBldmVudCwgd2hpY2ggaXMgYWZ0ZXIgaW1hZ2VzIGFuZCBpZnJhbWVzIGxvYWQuIElmIHlvdQ0KCS8vCQl3YW50IHRvIHRyaWdnZXIgdGhlIGNhbGxiYWNrcyBzb29uZXIsIHlvdSBjYW4gcHV0IGEgc2NyaXB0IGJsb2NrIGluIHRoZSBib3R0b20gb2YNCgkvLwkJeW91ciBIVE1MIHRoYXQgY2FsbHMgZG9qby5fbG9hZEluaXQoKTsuIElmIHlvdSBhcmUgdXNpbmcgbXVsdGl2ZXJzaW9uIHN1cHBvcnQsIGNoYW5nZQ0KCS8vCQkiZG9qby4iIHRvIHRoZSBhcHByb3ByaWF0ZSBzY29wZSBuYW1lIGZvciBkb2pvLg0KCXNraXBJZURvbUxvYWRlZDogZmFsc2UNCn0NCj09PT09Ki8NCg0KKGZ1bmN0aW9uKCl7DQoJLy8gZmlyZWJ1ZyBzdHVicw0KDQoJaWYodHlwZW9mIHRoaXNbImxvYWRGaXJlYnVnQ29uc29sZSJdID09ICJmdW5jdGlvbiIpew0KCQkvLyBmb3IgRmlyZWJ1ZyAxLjINCgkJdGhpc1sibG9hZEZpcmVidWdDb25zb2xlIl0oKTsNCgl9ZWxzZXsNCgkJdGhpcy5jb25zb2xlID0gdGhpcy5jb25zb2xlIHx8IHt9Ow0KDQoJCS8vCUJlIGNhcmVmdWwgdG8gbGVhdmUgJ2xvZycgYWx3YXlzIGF0IHRoZSBlbmQNCgkJdmFyIGNuID0gWw0KCQkJImFzc2VydCIsICJjb3VudCIsICJkZWJ1ZyIsICJkaXIiLCAiZGlyeG1sIiwgImVycm9yIiwgImdyb3VwIiwNCgkJCSJncm91cEVuZCIsICJpbmZvIiwgInByb2ZpbGUiLCAicHJvZmlsZUVuZCIsICJ0aW1lIiwgInRpbWVFbmQiLA0KCQkJInRyYWNlIiwgIndhcm4iLCAibG9nIg0KCQldOw0KCQl2YXIgaT0wLCB0bjsNCgkJd2hpbGUoKHRuPWNuW2krK10pKXsNCgkJCWlmKCFjb25zb2xlW3RuXSl7DQoJCQkJKGZ1bmN0aW9uKCl7DQoJCQkJCXZhciB0Y24gPSB0bisiIjsNCgkJCQkJY29uc29sZVt0Y25dID0gKCdsb2cnIGluIGNvbnNvbGUpID8gZnVuY3Rpb24oKXsNCgkJCQkJCXZhciBhID0gQXJyYXkuYXBwbHkoe30sIGFyZ3VtZW50cyk7DQoJCQkJCQlhLnVuc2hpZnQodGNuKyI6Iik7DQoJCQkJCQljb25zb2xlWyJsb2ciXShhLmpvaW4oIiAiKSk7DQoJCQkJCX0gOiBmdW5jdGlvbigpe30NCgkJCQkJY29uc29sZVt0Y25dLl9mYWtlID0gdHJ1ZTsNCgkJCQl9KSgpOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJLy9UT0RPQzogIEhPVyBUTyBET0MgVEhJUz8NCgkvLyBkb2pvIGlzIHRoZSByb290IHZhcmlhYmxlIG9mIChhbG1vc3QgYWxsKSBvdXIgcHVibGljIHN5bWJvbHMgLS0gbWFrZSBzdXJlIGl0IGlzIGRlZmluZWQuDQoJaWYodHlwZW9mIGRvam8gPT0gInVuZGVmaW5lZCIpew0KCQlkb2pvID0gew0KCQkJX3Njb3BlTmFtZTogImRvam8iLA0KCQkJX3Njb3BlUHJlZml4OiAiIiwNCgkJCV9zY29wZVByZWZpeEFyZ3M6ICIiLA0KCQkJX3Njb3BlU3VmZml4OiAiIiwNCgkJCV9zY29wZU1hcDoge30sDQoJCQlfc2NvcGVNYXBSZXY6IHt9DQoJCX07DQoJfQ0KDQoJdmFyIGQgPSBkb2pvOw0KDQoJLy9OZWVkIHBsYWNlaG9sZGVycyBmb3IgZGlqaXQgYW5kIGRvam94IGZvciBzY29waW5nIGNvZGUuDQoJaWYodHlwZW9mIGRpaml0ID09ICJ1bmRlZmluZWQiKXsNCgkJZGlqaXQgPSB7X3Njb3BlTmFtZTogImRpaml0In07DQoJfQ0KCWlmKHR5cGVvZiBkb2pveCA9PSAidW5kZWZpbmVkIil7DQoJCWRvam94ID0ge19zY29wZU5hbWU6ICJkb2pveCJ9Ow0KCX0NCg0KCWlmKCFkLl9zY29wZUFyZ3Mpew0KCQlkLl9zY29wZUFyZ3MgPSBbZG9qbywgZGlqaXQsIGRvam94XTsNCgl9DQoNCi8qPT09PT0NCmRvam8uZ2xvYmFsID0gew0KCS8vCXN1bW1hcnk6DQoJLy8JCUFsaWFzIGZvciB0aGUgZ2xvYmFsIHNjb3BlDQoJLy8JCShlLmcuIHRoZSB3aW5kb3cgb2JqZWN0IGluIGEgYnJvd3NlcikuDQoJLy8JZGVzY3JpcHRpb246DQoJLy8JCVJlZmVyIHRvICdkb2pvLmdsb2JhbCcgcmF0aGVyIHRoYW4gcmVmZXJyaW5nIHRvIHdpbmRvdyB0byBlbnN1cmUgeW91cg0KCS8vCQljb2RlIHJ1bnMgY29ycmVjdGx5IGluIGNvbnRleHRzIG90aGVyIHRoYW4gd2ViIGJyb3dzZXJzIChlLmcuIFJoaW5vIG9uIGEgc2VydmVyKS4NCn0NCj09PT09Ki8NCglkLmdsb2JhbCA9IHRoaXM7DQoNCglkLmNvbmZpZyA9Lyo9PT09PSBkakNvbmZpZyA9ID09PT09Ki97DQoJCWlzRGVidWc6IGZhbHNlLA0KCQlkZWJ1Z0F0QWxsQ29zdHM6IGZhbHNlDQoJfTsNCg0KCWlmKHR5cGVvZiBkakNvbmZpZyAhPSAidW5kZWZpbmVkIil7DQoJCWZvcih2YXIgb3B0IGluIGRqQ29uZmlnKXsNCgkJCWQuY29uZmlnW29wdF0gPSBkakNvbmZpZ1tvcHRdOw0KCQl9DQoJfQ0KDQovKj09PT09DQoJLy8gT3ZlcnJpZGUgbG9jYWxlIHNldHRpbmcsIGlmIHNwZWNpZmllZA0KCWRvam8ubG9jYWxlID0gew0KCQkvLyBzdW1tYXJ5OiB0aGUgbG9jYWxlIGFzIGRlZmluZWQgYnkgRG9qbyAocmVhZC1vbmx5KQ0KCX07DQo9PT09PSovDQoJZG9qby5sb2NhbGUgPSBkLmNvbmZpZy5sb2NhbGU7DQoNCgl2YXIgcmV2ID0gIiRSZXY6IDIyNDg3ICQiLm1hdGNoKC9cZCsvKTsNCg0KLyo9PT09PQ0KCWRvam8udmVyc2lvbiA9IGZ1bmN0aW9uKCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlWZXJzaW9uIG51bWJlciBvZiB0aGUgRG9qbyBUb29sa2l0DQoJCS8vIG1ham9yOiBJbnRlZ2VyDQoJCS8vCQlNYWpvciB2ZXJzaW9uLiBJZiB0b3RhbCB2ZXJzaW9uIGlzICIxLjIuMGJldGExIiwgd2lsbCBiZSAxDQoJCS8vIG1pbm9yOiBJbnRlZ2VyDQoJCS8vCQlNaW5vciB2ZXJzaW9uLiBJZiB0b3RhbCB2ZXJzaW9uIGlzICIxLjIuMGJldGExIiwgd2lsbCBiZSAyDQoJCS8vIHBhdGNoOiBJbnRlZ2VyDQoJCS8vCQlQYXRjaCB2ZXJzaW9uLiBJZiB0b3RhbCB2ZXJzaW9uIGlzICIxLjIuMGJldGExIiwgd2lsbCBiZSAwDQoJCS8vIGZsYWc6IFN0cmluZw0KCQkvLwkJRGVzY3JpcHRvciBmbGFnLiBJZiB0b3RhbCB2ZXJzaW9uIGlzICIxLjIuMGJldGExIiwgd2lsbCBiZSAiYmV0YTEiDQoJCS8vIHJldmlzaW9uOiBOdW1iZXINCgkJLy8JCVRoZSBTVk4gcmV2IGZyb20gd2hpY2ggZG9qbyB3YXMgcHVsbGVkDQoJCXRoaXMubWFqb3IgPSAwOw0KCQl0aGlzLm1pbm9yID0gMDsNCgkJdGhpcy5wYXRjaCA9IDA7DQoJCXRoaXMuZmxhZyA9ICIiOw0KCQl0aGlzLnJldmlzaW9uID0gMDsNCgl9DQo9PT09PSovDQoJZG9qby52ZXJzaW9uID0gew0KCQltYWpvcjogMSwgbWlub3I6IDAsIHBhdGNoOiAwLCBmbGFnOiAiIiwNCgkJcmV2aXNpb246IHJldiA/ICtyZXZbMF0gOiBOYU4sDQoJCXRvU3RyaW5nOiBmdW5jdGlvbigpew0KCQkJd2l0aChkLnZlcnNpb24pew0KCQkJCXJldHVybiBtYWpvciArICIuIiArIG1pbm9yICsgIi4iICsgcGF0Y2ggKyBmbGFnICsgIiAoIiArIHJldmlzaW9uICsgIikiOwkvLyBTdHJpbmcNCgkJCX0NCgkJfQ0KCX0NCg0KCQkvLyBSZWdpc3RlciB3aXRoIHRoZSBPcGVuQWpheCBodWINCglpZih0eXBlb2YgT3BlbkFqYXggIT0gInVuZGVmaW5lZCIpew0KCQlPcGVuQWpheC5odWIucmVnaXN0ZXJMaWJyYXJ5KGRvam8uX3Njb3BlTmFtZSwgImh0dHA6Ly9kb2pvdG9vbGtpdC5vcmciLCBkLnZlcnNpb24udG9TdHJpbmcoKSk7DQoJfQ0KCQ0KCXZhciBleHRyYU5hbWVzLCBleHRyYUxlbiwgZW1wdHkgPSB7fTsNCglmb3IodmFyIGkgaW4ge3RvU3RyaW5nOiAxfSl7IGV4dHJhTmFtZXMgPSBbXTsgYnJlYWs7IH0NCglkb2pvLl9leHRyYU5hbWVzID0gZXh0cmFOYW1lcyA9IGV4dHJhTmFtZXMgfHwgWyJoYXNPd25Qcm9wZXJ0eSIsICJ2YWx1ZU9mIiwgImlzUHJvdG90eXBlT2YiLA0KCQkicHJvcGVydHlJc0VudW1lcmFibGUiLCAidG9Mb2NhbGVTdHJpbmciLCAidG9TdHJpbmciLCAiY29uc3RydWN0b3IiXTsNCglleHRyYUxlbiA9IGV4dHJhTmFtZXMubGVuZ3RoOw0KDQoJZG9qby5fbWl4aW4gPSBmdW5jdGlvbigvKk9iamVjdCovIHRhcmdldCwgLypPYmplY3QqLyBzb3VyY2Upew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQWRkcyBhbGwgcHJvcGVydGllcyBhbmQgbWV0aG9kcyBvZiBzb3VyY2UgdG8gdGFyZ2V0LiBUaGlzIGFkZGl0aW9uDQoJCS8vCQlpcyAicHJvdG90eXBlIGV4dGVuc2lvbiBzYWZlIiwgc28gdGhhdCBpbnN0YW5jZXMgb2Ygb2JqZWN0cw0KCQkvLwkJd2lsbCBub3QgcGFzcyBhbG9uZyBwcm90b3R5cGUgZGVmYXVsdHMuDQoJCXZhciBuYW1lLCBzLCBpOw0KCQlmb3IobmFtZSBpbiBzb3VyY2Upew0KCQkJLy8gdGhlICJ0b2JqIiBjb25kaXRpb24gYXZvaWQgY29weWluZyBwcm9wZXJ0aWVzIGluICJzb3VyY2UiDQoJCQkvLyBpbmhlcml0ZWQgZnJvbSBPYmplY3QucHJvdG90eXBlLiAgRm9yIGV4YW1wbGUsIGlmIHRhcmdldCBoYXMgYSBjdXN0b20NCgkJCS8vIHRvU3RyaW5nKCkgbWV0aG9kLCBkb24ndCBvdmVyd3JpdGUgaXQgd2l0aCB0aGUgdG9TdHJpbmcoKSBtZXRob2QNCgkJCS8vIHRoYXQgc291cmNlIGluaGVyaXRlZCBmcm9tIE9iamVjdC5wcm90b3R5cGUNCgkJCXMgPSBzb3VyY2VbbmFtZV07DQoJCQlpZighKG5hbWUgaW4gdGFyZ2V0KSB8fCAodGFyZ2V0W25hbWVdICE9PSBzICYmICghKG5hbWUgaW4gZW1wdHkpIHx8IGVtcHR5W25hbWVdICE9PSBzKSkpew0KCQkJCXRhcmdldFtuYW1lXSA9IHM7DQoJCQl9DQoJCX0NCgkJCQkvLyBJRSBkb2Vzbid0IHJlY29nbml6ZSBzb21lIGN1c3RvbSBmdW5jdGlvbnMgaW4gZm9yLi5pbg0KCQlpZihleHRyYUxlbiAmJiBzb3VyY2Upew0KCQkJZm9yKGkgPSAwOyBpIDwgZXh0cmFMZW47ICsraSl7DQoJCQkJbmFtZSA9IGV4dHJhTmFtZXNbaV07DQoJCQkJcyA9IHNvdXJjZVtuYW1lXTsNCgkJCQlpZighKG5hbWUgaW4gdGFyZ2V0KSB8fCAodGFyZ2V0W25hbWVdICE9PSBzICYmICghKG5hbWUgaW4gZW1wdHkpIHx8IGVtcHR5W25hbWVdICE9PSBzKSkpew0KCQkJCQl0YXJnZXRbbmFtZV0gPSBzOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkJCXJldHVybiB0YXJnZXQ7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8ubWl4aW4gPSBmdW5jdGlvbigvKk9iamVjdCovb2JqLCAvKk9iamVjdC4uLiovcHJvcHMpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQWRkcyBhbGwgcHJvcGVydGllcyBhbmQgbWV0aG9kcyBvZiBwcm9wcyB0byBvYmogYW5kIHJldHVybnMgdGhlDQoJCS8vCQkobm93IG1vZGlmaWVkKSBvYmouDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJYGRvam8ubWl4aW5gIGNhbiBtaXggbXVsdGlwbGUgc291cmNlIG9iamVjdHMgaW50byBhDQoJCS8vCQlkZXN0aW5hdGlvbiBvYmplY3Qgd2hpY2ggaXMgdGhlbiByZXR1cm5lZC4gVW5saWtlIHJlZ3VsYXINCgkJLy8JCWBmb3IuLi5pbmAgaXRlcmF0aW9uLCBgZG9qby5taXhpbmAgaXMgYWxzbyBzbWFydCBhYm91dCBhdm9pZGluZw0KCQkvLwkJZXh0ZW5zaW9ucyB3aGljaCBvdGhlciB0b29sa2l0cyBtYXkgdW53aXNlbHkgYWRkIHRvIHRoZSByb290DQoJCS8vCQlvYmplY3QgcHJvdG90eXBlDQoJCS8vCW9iajoNCgkJLy8JCVRoZSBvYmplY3QgdG8gbWl4IHByb3BlcnRpZXMgaW50by4gQWxzbyB0aGUgcmV0dXJuIHZhbHVlLg0KCQkvLwlwcm9wczoNCgkJLy8JCU9uZSBvciBtb3JlIG9iamVjdHMgd2hvc2UgdmFsdWVzIGFyZSBzdWNjZXNzaXZlbHkgY29waWVkIGludG8NCgkJLy8JCW9iai4gSWYgbW9yZSB0aGFuIG9uZSBvZiB0aGVzZSBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgdmFsdWUsDQoJCS8vCQl0aGUgb25lIHNwZWNpZmllZCBsYXN0IGluIHRoZSBmdW5jdGlvbiBjYWxsIHdpbGwgIndpbiIuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQltYWtlIGEgc2hhbGxvdyBjb3B5IG9mIGFuIG9iamVjdA0KCQkvLwl8CXZhciBjb3B5ID0gZG9qby5taXhpbih7fSwgc291cmNlKTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCW1hbnkgY2xhc3MgY29uc3RydWN0b3JzIG9mdGVuIHRha2UgYW4gb2JqZWN0IHdoaWNoIHNwZWNpZmllcw0KCQkvLwkJdmFsdWVzIHRvIGJlIGNvbmZpZ3VyZWQgb24gdGhlIG9iamVjdC4gSW4gdGhpcyBjYXNlLCBpdCBpcw0KCQkvLwkJb2Z0ZW4gc2ltcGxlc3QgdG8gY2FsbCBgZG9qby5taXhpbmAgb24gdGhlIGB0aGlzYCBvYmplY3Q6DQoJCS8vCXwJZG9qby5kZWNsYXJlKCJhY21lLkJhc2UiLCBudWxsLCB7DQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbihwcm9wZXJ0aWVzKXsNCgkJLy8JfAkJCS8vIHByb3BlcnR5IGNvbmZpZ3VyYXRpb246DQoJCS8vCXwJCQlkb2pvLm1peGluKHRoaXMsIHByb3BlcnRpZXMpOw0KCQkvLwl8CQ0KCQkvLwl8CQkJY29uc29sZS5sb2codGhpcy5xdWlwKTsNCgkJLy8JfAkJCS8vICAuLi4NCgkJLy8JfAkJfSwNCgkJLy8JfAkJcXVpcDogIkkgd2Fzbid0IGJvcm4geWVzdGVyZGF5LCB5b3Uga25vdyAtIEkndmUgc2VlbiBtb3ZpZXMuIiwNCgkJLy8JfAkJLy8gLi4uDQoJCS8vCXwJfSk7DQoJCS8vCXwNCgkJLy8JfAkvLyBjcmVhdGUgYW4gaW5zdGFuY2Ugb2YgdGhlIGNsYXNzIGFuZCBjb25maWd1cmUgaXQNCgkJLy8JfAl2YXIgYiA9IG5ldyBhY21lLkJhc2Uoe3F1aXA6ICJUaGF0J3Mgd2hhdCBpdCBkb2VzISIgfSk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQljb3B5IGluIHByb3BlcnRpZXMgZnJvbSBtdWx0aXBsZSBvYmplY3RzDQoJCS8vCXwJdmFyIGZsYXR0ZW5lZCA9IGRvam8ubWl4aW4oDQoJCS8vCXwJCXsNCgkJLy8JfAkJCW5hbWU6ICJGcnlsb2NrIiwNCgkJLy8JfAkJCWJyYWNlczogdHJ1ZQ0KCQkvLwl8CQl9LA0KCQkvLwl8CQl7DQoJCS8vCXwJCQluYW1lOiAiQ2FybCBCcnV0YW5hbmFuYWRpbGV3c2tpIg0KCQkvLwl8CQl9DQoJCS8vCXwJKTsNCgkJLy8JfAkNCgkJLy8JfAkvLyB3aWxsIHByaW50ICJDYXJsIEJydXRhbmFuYW5hZGlsZXdza2kiDQoJCS8vCXwJY29uc29sZS5sb2coZmxhdHRlbmVkLm5hbWUpOw0KCQkvLwl8CS8vIHdpbGwgcHJpbnQgInRydWUiDQoJCS8vCXwJY29uc29sZS5sb2coZmxhdHRlbmVkLmJyYWNlcyk7DQoJCWlmKCFvYmopeyBvYmogPSB7fTsgfQ0KCQlmb3IodmFyIGk9MSwgbD1hcmd1bWVudHMubGVuZ3RoOyBpPGw7IGkrKyl7DQoJCQlkLl9taXhpbihvYmosIGFyZ3VtZW50c1tpXSk7DQoJCX0NCgkJcmV0dXJuIG9iajsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5fZ2V0UHJvcCA9IGZ1bmN0aW9uKC8qQXJyYXkqL3BhcnRzLCAvKkJvb2xlYW4qL2NyZWF0ZSwgLypPYmplY3QqL2NvbnRleHQpew0KCQl2YXIgb2JqPWNvbnRleHQgfHwgZC5nbG9iYWw7DQoJCWZvcih2YXIgaT0wLCBwOyBvYmogJiYgKHA9cGFydHNbaV0pOyBpKyspew0KCQkJaWYoaSA9PSAwICYmIGQuX3Njb3BlTWFwW3BdKXsNCgkJCQlwID0gZC5fc2NvcGVNYXBbcF07DQoJCQl9DQoJCQlvYmogPSAocCBpbiBvYmogPyBvYmpbcF0gOiAoY3JlYXRlID8gb2JqW3BdPXt9IDogdW5kZWZpbmVkKSk7DQoJCX0NCgkJcmV0dXJuIG9iajsgLy8gbWl4ZWQNCgl9DQoNCglkb2pvLnNldE9iamVjdCA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9uYW1lLCAvKk9iamVjdCovdmFsdWUsIC8qT2JqZWN0PyovY29udGV4dCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlTZXQgYSBwcm9wZXJ0eSBmcm9tIGEgZG90LXNlcGFyYXRlZCBzdHJpbmcsIHN1Y2ggYXMgIkEuQi5DIg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVVzZWZ1bCBmb3IgbG9uZ2VyIGFwaSBjaGFpbnMgd2hlcmUgeW91IGhhdmUgdG8gdGVzdCBlYWNoIG9iamVjdCBpbg0KCQkvLwkJdGhlIGNoYWluLCBvciB3aGVuIHlvdSBoYXZlIGFuIG9iamVjdCByZWZlcmVuY2UgaW4gc3RyaW5nIGZvcm1hdC4NCgkJLy8JCU9iamVjdHMgYXJlIGNyZWF0ZWQgYXMgbmVlZGVkIGFsb25nIGBwYXRoYC4gUmV0dXJucyB0aGUgcGFzc2VkDQoJCS8vCQl2YWx1ZSBpZiBzZXR0aW5nIGlzIHN1Y2Nlc3NmdWwgb3IgYHVuZGVmaW5lZGAgaWYgbm90Lg0KCQkvLwluYW1lOg0KCQkvLwkJUGF0aCB0byBhIHByb3BlcnR5LCBpbiB0aGUgZm9ybSAiQS5CLkMiLg0KCQkvLwljb250ZXh0Og0KCQkvLwkJT3B0aW9uYWwuIE9iamVjdCB0byB1c2UgYXMgcm9vdCBvZiBwYXRoLiBEZWZhdWx0cyB0bw0KCQkvLwkJYGRvam8uZ2xvYmFsYC4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCXNldCB0aGUgdmFsdWUgb2YgYGZvby5iYXIuYmF6YCwgcmVnYXJkbGVzcyBvZiB3aGV0aGVyDQoJCS8vCQlpbnRlcm1lZGlhdGUgb2JqZWN0cyBhbHJlYWR5IGV4aXN0Og0KCQkvLwl8CWRvam8uc2V0T2JqZWN0KCJmb28uYmFyLmJheiIsIHZhbHVlKTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCXdpdGhvdXQgYGRvam8uc2V0T2JqZWN0YCwgd2Ugb2Z0ZW4gc2VlIGNvZGUgbGlrZSB0aGlzOg0KCQkvLwl8CS8vIGVuc3VyZSB0aGF0IGludGVybWVkaWF0ZSBvYmplY3RzIGFyZSBhdmFpbGFibGUNCgkJLy8JfAlpZighb2JqWyJwYXJlbnQiXSl7IG9iai5wYXJlbnQgPSB7fTsgfQ0KCQkvLwl8CWlmKCFvYmoucGFyZW50WyJjaGlsZCJdKXsgb2JqLnBhcmVudC5jaGlsZD0ge307IH0NCgkJLy8JfAkvLyBub3cgd2UgY2FuIHNhZmVseSBzZXQgdGhlIHByb3BlcnR5DQoJCS8vCXwJb2JqLnBhcmVudC5jaGlsZC5wcm9wID0gInNvbWUgdmFsdWUiOw0KCQkvLwkJd2hlcmFzIHdpdGggYGRvam8uc2V0T2JqZWN0YCwgd2UgY2FuIHNob3J0ZW4gdGhhdCB0bzoNCgkJLy8JfAlkb2pvLnNldE9iamVjdCgicGFyZW50LmNoaWxkLnByb3AiLCAic29tZSB2YWx1ZSIsIG9iaik7DQoJCXZhciBwYXJ0cz1uYW1lLnNwbGl0KCIuIiksIHA9cGFydHMucG9wKCksIG9iaj1kLl9nZXRQcm9wKHBhcnRzLCB0cnVlLCBjb250ZXh0KTsNCgkJcmV0dXJuIG9iaiAmJiBwID8gKG9ialtwXT12YWx1ZSkgOiB1bmRlZmluZWQ7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uZ2V0T2JqZWN0ID0gZnVuY3Rpb24oLypTdHJpbmcqL25hbWUsIC8qQm9vbGVhbj8qL2NyZWF0ZSwgLypPYmplY3Q/Ki9jb250ZXh0KXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUdldCBhIHByb3BlcnR5IGZyb20gYSBkb3Qtc2VwYXJhdGVkIHN0cmluZywgc3VjaCBhcyAiQS5CLkMiDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJVXNlZnVsIGZvciBsb25nZXIgYXBpIGNoYWlucyB3aGVyZSB5b3UgaGF2ZSB0byB0ZXN0IGVhY2ggb2JqZWN0IGluDQoJCS8vCQl0aGUgY2hhaW4sIG9yIHdoZW4geW91IGhhdmUgYW4gb2JqZWN0IHJlZmVyZW5jZSBpbiBzdHJpbmcgZm9ybWF0Lg0KCQkvLwluYW1lOg0KCQkvLwkJUGF0aCB0byBhbiBwcm9wZXJ0eSwgaW4gdGhlIGZvcm0gIkEuQi5DIi4NCgkJLy8JY3JlYXRlOg0KCQkvLwkJT3B0aW9uYWwuIERlZmF1bHRzIHRvIGBmYWxzZWAuIElmIGB0cnVlYCwgT2JqZWN0cyB3aWxsIGJlDQoJCS8vCQljcmVhdGVkIGF0IGFueSBwb2ludCBhbG9uZyB0aGUgJ3BhdGgnIHRoYXQgaXMgdW5kZWZpbmVkLg0KCQkvLwljb250ZXh0Og0KCQkvLwkJT3B0aW9uYWwuIE9iamVjdCB0byB1c2UgYXMgcm9vdCBvZiBwYXRoLiBEZWZhdWx0cyB0bw0KCQkvLwkJJ2Rvam8uZ2xvYmFsJy4gTnVsbCBtYXkgYmUgcGFzc2VkLg0KCQlyZXR1cm4gZC5fZ2V0UHJvcChuYW1lLnNwbGl0KCIuIiksIGNyZWF0ZSwgY29udGV4dCk7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uZXhpc3RzID0gZnVuY3Rpb24oLypTdHJpbmcqL25hbWUsIC8qT2JqZWN0Pyovb2JqKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWRldGVybWluZSBpZiBhbiBvYmplY3Qgc3VwcG9ydHMgYSBnaXZlbiBtZXRob2QNCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQl1c2VmdWwgZm9yIGxvbmdlciBhcGkgY2hhaW5zIHdoZXJlIHlvdSBoYXZlIHRvIHRlc3QgZWFjaCBvYmplY3QgaW4NCgkJLy8JCXRoZSBjaGFpbi4gVXNlZnVsIG9ubHkgZm9yIG9iamVjdCBhbmQgbWV0aG9kIGRldGVjdGlvbi4NCgkJLy8JCU5vdCB1c2VmdWwgZm9yIHRlc3RpbmcgZ2VuZXJpYyBwcm9wZXJ0aWVzIG9uIGFuIG9iamVjdC4NCgkJLy8JCUluIHBhcnRpY3VsYXIsIGRvam8uZXhpc3RzKCJmb28uYmFyIikgd2hlbiBmb28uYmFyID0gIiINCgkJLy8JCXdpbGwgcmV0dXJuIGZhbHNlLiBVc2UgKCJiYXIiIGluIGZvbykgdG8gdGVzdCBmb3IgdGhvc2UgY2FzZXMuDQoJCS8vCW5hbWU6DQoJCS8vCQlQYXRoIHRvIGFuIG9iamVjdCwgaW4gdGhlIGZvcm0gIkEuQi5DIi4NCgkJLy8Jb2JqOg0KCQkvLwkJT2JqZWN0IHRvIHVzZSBhcyByb290IG9mIHBhdGguIERlZmF1bHRzIHRvDQoJCS8vCQknZG9qby5nbG9iYWwnLiBOdWxsIG1heSBiZSBwYXNzZWQuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gZGVmaW5lIGFuIG9iamVjdA0KCQkvLwl8CXZhciBmb28gPSB7DQoJCS8vCXwJCWJhcjogeyB9DQoJCS8vCXwJfTsNCgkJLy8JfA0KCQkvLwl8CS8vIHNlYXJjaCB0aGUgZ2xvYmFsIHNjb3BlDQoJCS8vCXwJZG9qby5leGlzdHMoImZvby5iYXIiKTsgLy8gdHJ1ZQ0KCQkvLwl8CWRvam8uZXhpc3RzKCJmb28uYmFyLmJheiIpOyAvLyBmYWxzZQ0KCQkvLwl8DQoJCS8vCXwJLy8gc2VhcmNoIGZyb20gYSBwYXJ0aWN1bGFyIHNjb3BlDQoJCS8vCXwJZG9qby5leGlzdHMoImJhciIsIGZvbyk7IC8vIHRydWUNCgkJLy8JfAlkb2pvLmV4aXN0cygiYmFyLmJheiIsIGZvbyk7IC8vIGZhbHNlDQoJCXJldHVybiAhIWQuZ2V0T2JqZWN0KG5hbWUsIGZhbHNlLCBvYmopOyAvLyBCb29sZWFuDQoJfQ0KDQoJZG9qb1siZXZhbCJdID0gZnVuY3Rpb24oLypTdHJpbmcqLyBzY3JpcHRGcmFnbWVudCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlBIGxlZ2FjeSBtZXRob2QgY3JlYXRlZCBmb3IgdXNlIGV4Y2x1c2l2ZWx5IGJ5IGludGVybmFsIERvam8gbWV0aG9kcy4gRG8gbm90IHVzZQ0KCQkvLwkJdGhpcyBtZXRob2QgZGlyZWN0bHksIHRoZSBiZWhhdmlvciBvZiB0aGlzIGV2YWwgd2lsbCBkaWZmZXIgZnJvbSB0aGUgbm9ybWFsDQoJCS8vCQlicm93c2VyIGV2YWwuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJUGxhY2VkIGluIGEgc2VwYXJhdGUgZnVuY3Rpb24gdG8gbWluaW1pemUgc2l6ZSBvZiB0cmFwcGVkDQoJCS8vCQlleGNlcHRpb25zLiBDYWxsaW5nIGV2YWwoKSBkaXJlY3RseSBmcm9tIHNvbWUgb3RoZXIgc2NvcGUgbWF5DQoJCS8vCQljb21wbGljYXRlIHRyYWNlYmFja3Mgb24gc29tZSBwbGF0Zm9ybXMuDQoJCS8vCXJldHVybnM6DQoJCS8vCQlUaGUgcmVzdWx0IG9mIHRoZSBldmFsdWF0aW9uLiBPZnRlbiBgdW5kZWZpbmVkYA0KCQlyZXR1cm4gZC5nbG9iYWwuZXZhbCA/IGQuZ2xvYmFsLmV2YWwoc2NyaXB0RnJhZ21lbnQpIDogZXZhbChzY3JpcHRGcmFnbWVudCk7IAkvLyBPYmplY3QNCgl9DQoNCgkvKj09PT09DQoJCWRvam8uZGVwcmVjYXRlZCA9IGZ1bmN0aW9uKGJlaGF2aW91ciwgZXh0cmEsIHJlbW92YWwpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlMb2cgYSBkZWJ1ZyBtZXNzYWdlIHRvIGluZGljYXRlIHRoYXQgYSBiZWhhdmlvciBoYXMgYmVlbg0KCQkJLy8JCWRlcHJlY2F0ZWQuDQoJCQkvLwliZWhhdmlvdXI6IFN0cmluZw0KCQkJLy8JCVRoZSBBUEkgb3IgYmVoYXZpb3IgYmVpbmcgZGVwcmVjYXRlZC4gVXN1YWxseSBpbiB0aGUgZm9ybQ0KCQkJLy8JCW9mICJteUFwcC5zb21lRnVuY3Rpb24oKSIuDQoJCQkvLwlleHRyYTogU3RyaW5nPw0KCQkJLy8JCVRleHQgdG8gYXBwZW5kIHRvIHRoZSBtZXNzYWdlLiBPZnRlbiBwcm92aWRlcyBhZHZpY2Ugb24gYQ0KCQkJLy8JCW5ldyBmdW5jdGlvbiBvciBmYWNpbGl0eSB0byBhY2hpZXZlIHRoZSBzYW1lIGdvYWwgZHVyaW5nDQoJCQkvLwkJdGhlIGRlcHJlY2F0aW9uIHBlcmlvZC4NCgkJCS8vCXJlbW92YWw6IFN0cmluZz8NCgkJCS8vCQlUZXh0IHRvIGluZGljYXRlIHdoZW4gaW4gdGhlIGZ1dHVyZSB0aGUgYmVoYXZpb3Igd2lsbCBiZQ0KCQkJLy8JCXJlbW92ZWQuIFVzdWFsbHkgYSB2ZXJzaW9uIG51bWJlci4NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwl8CWRvam8uZGVwcmVjYXRlZCgibXlBcHAuZ2V0VGVtcCgpIiwgInVzZSBteUFwcC5nZXRMb2NhbGVUZW1wKCkgaW5zdGVhZCIsICIxLjAiKTsNCgkJfQ0KDQoJCWRvam8uZXhwZXJpbWVudGFsID0gZnVuY3Rpb24obW9kdWxlTmFtZSwgZXh0cmEpew0KCQkJLy8Jc3VtbWFyeTogTWFya3MgY29kZSBhcyBleHBlcmltZW50YWwuDQoJCQkvLwlkZXNjcmlwdGlvbjoNCgkJCS8vCSAJVGhpcyBjYW4gYmUgdXNlZCB0byBtYXJrIGEgZnVuY3Rpb24sIGZpbGUsIG9yIG1vZHVsZSBhcw0KCQkJLy8JIAlleHBlcmltZW50YWwuICBFeHBlcmltZW50YWwgY29kZSBpcyBub3QgcmVhZHkgdG8gYmUgdXNlZCwgYW5kIHRoZQ0KCQkJLy8JIAlBUElzIGFyZSBzdWJqZWN0IHRvIGNoYW5nZSB3aXRob3V0IG5vdGljZS4gIEV4cGVyaW1lbnRhbCBjb2RlIG1heSBiZQ0KCQkJLy8JIAljb21wbGV0ZWQgZGVsZXRlZCB3aXRob3V0IGdvaW5nIHRocm91Z2ggdGhlIG5vcm1hbCBkZXByZWNhdGlvbg0KCQkJLy8JIAlwcm9jZXNzLg0KCQkJLy8JbW9kdWxlTmFtZTogU3RyaW5nDQoJCQkvLwkgCVRoZSBuYW1lIG9mIGEgbW9kdWxlLCBvciB0aGUgbmFtZSBvZiBhIG1vZHVsZSBmaWxlIG9yIGEgc3BlY2lmaWMNCgkJCS8vCSAJZnVuY3Rpb24NCgkJCS8vCWV4dHJhOiBTdHJpbmc/DQoJCQkvLwkgCXNvbWUgYWRkaXRpb25hbCBtZXNzYWdlIGZvciB0aGUgdXNlcg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJZG9qby5leHBlcmltZW50YWwoImRvam8uZGF0YS5SZXN1bHQiKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwl8CWRvam8uZXhwZXJpbWVudGFsKCJkb2pvLndlYXRoZXIudG9LZWx2aW4oKSIsICJQRU5ESU5HIGFwcHJvdmFsIGZyb20gTk9BQSIpOw0KCQl9DQoJPT09PT0qLw0KDQoJLy9SZWFsIGZ1bmN0aW9ucyBkZWNsYXJlZCBpbiBkb2pvLl9maXJlYnVnLmZpcmVidWcuDQoJZC5kZXByZWNhdGVkID0gZC5leHBlcmltZW50YWwgPSBmdW5jdGlvbigpe307DQoNCn0pKCk7DQovLyB2aW06YWk6dHM9NDpub2V0DQoNCi8qDQogKiBsb2FkZXIuanMgLSBBIGJvb3RzdHJhcCBtb2R1bGUuICBSdW5zIGJlZm9yZSB0aGUgaG9zdGVudl8qLmpzIGZpbGUuIENvbnRhaW5zDQogKiBhbGwgb2YgdGhlIHBhY2thZ2UgbG9hZGluZyBtZXRob2RzLg0KICovDQoNCihmdW5jdGlvbigpew0KCXZhciBkID0gZG9qbzsNCg0KCWQubWl4aW4oZCwgew0KCQlfbG9hZGVkTW9kdWxlczoge30sDQoJCV9pbkZsaWdodENvdW50OiAwLA0KCQlfaGFzUmVzb3VyY2U6IHt9LA0KDQoJCV9tb2R1bGVQcmVmaXhlczogew0KCQkJZG9qbzogCXsJbmFtZTogImRvam8iLCB2YWx1ZTogIi4iIH0sDQoJCQkvLyBkb2pveDogCXsJbmFtZTogImRvam94IiwgdmFsdWU6ICIuLi9kb2pveCIgfSwNCgkJCS8vIGRpaml0OiAJewluYW1lOiAiZGlqaXQiLCB2YWx1ZTogIi4uL2Rpaml0IiB9LA0KCQkJZG9oOiAJewluYW1lOiAiZG9oIiwgdmFsdWU6ICIuLi91dGlsL2RvaCIgfSwNCgkJCXRlc3RzOiAJewluYW1lOiAidGVzdHMiLCB2YWx1ZTogInRlc3RzIiB9DQoJCX0sDQoNCgkJX21vZHVsZUhhc1ByZWZpeDogZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZSl7DQoJCQkvLyBzdW1tYXJ5OiBjaGVja3MgdG8gc2VlIGlmIG1vZHVsZSBoYXMgYmVlbiBlc3RhYmxpc2hlZA0KCQkJdmFyIG1wID0gZC5fbW9kdWxlUHJlZml4ZXM7DQoJCQlyZXR1cm4gISEobXBbbW9kdWxlXSAmJiBtcFttb2R1bGVdLnZhbHVlKTsgLy8gQm9vbGVhbg0KCQl9LA0KDQoJCV9nZXRNb2R1bGVQcmVmaXg6IGZ1bmN0aW9uKC8qU3RyaW5nKi9tb2R1bGUpew0KCQkJLy8gc3VtbWFyeTogZ2V0cyB0aGUgcHJlZml4IGFzc29jaWF0ZWQgd2l0aCBtb2R1bGUNCgkJCXZhciBtcCA9IGQuX21vZHVsZVByZWZpeGVzOw0KCQkJaWYoZC5fbW9kdWxlSGFzUHJlZml4KG1vZHVsZSkpew0KCQkJCXJldHVybiBtcFttb2R1bGVdLnZhbHVlOyAvLyBTdHJpbmcNCgkJCX0NCgkJCXJldHVybiBtb2R1bGU7IC8vIFN0cmluZw0KCQl9LA0KDQoJCV9sb2FkZWRVcmxzOiBbXSwNCg0KCQkvL1dBUk5JTkc6IA0KCQkvLwkJVGhpcyB2YXJpYWJsZSBpcyByZWZlcmVuY2VkIGJ5IHBhY2thZ2VzIG91dHNpZGUgb2YgYm9vdHN0cmFwOg0KCQkvLwkJRmxvYXRpbmdQYW5lLmpzIGFuZCB1bmRvL2Jyb3dzZXIuanMNCgkJX3Bvc3RMb2FkOiBmYWxzZSwNCgkJDQoJCS8vRWdhZCEgTG90cyBvZiB0ZXN0IGZpbGVzIHB1c2ggb24gdGhpcyBkaXJlY3RseSBpbnN0ZWFkIG9mIHVzaW5nIGRvam8uYWRkT25Mb2FkLg0KCQlfbG9hZGVyczogW10sDQoJCV91bmxvYWRlcnM6IFtdLA0KCQlfbG9hZE5vdGlmeWluZzogZmFsc2UNCgl9KTsNCg0KDQoJCWRvam8uX2xvYWRQYXRoID0gZnVuY3Rpb24oLypTdHJpbmcqL3JlbHBhdGgsIC8qU3RyaW5nPyovbW9kdWxlLCAvKkZ1bmN0aW9uPyovY2Ipew0KCQkvLyAJc3VtbWFyeToNCgkJLy8JCUxvYWQgYSBKYXZhc2NyaXB0IG1vZHVsZSBnaXZlbiBhIHJlbGF0aXZlIHBhdGgNCgkJLy8NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlMb2FkcyBhbmQgaW50ZXJwcmV0cyB0aGUgc2NyaXB0IGxvY2F0ZWQgYXQgcmVscGF0aCwgd2hpY2ggaXMNCgkJLy8JCXJlbGF0aXZlIHRvIHRoZSBzY3JpcHQgcm9vdCBkaXJlY3RvcnkuICBJZiB0aGUgc2NyaXB0IGlzIGZvdW5kIGJ1dA0KCQkvLwkJaXRzIGludGVycHJldGF0aW9uIGNhdXNlcyBhIHJ1bnRpbWUgZXhjZXB0aW9uLCB0aGF0IGV4Y2VwdGlvbiBpcw0KCQkvLwkJbm90IGNhdWdodCBieSB1cywgc28gdGhlIGNhbGxlciB3aWxsIHNlZSBpdC4gIFdlIHJldHVybiBhIHRydWUNCgkJLy8JCXZhbHVlIGlmIGFuZCBvbmx5IGlmIHRoZSBzY3JpcHQgaXMgZm91bmQuDQoJCS8vDQoJCS8vIHJlbHBhdGg6IA0KCQkvLwkJQSByZWxhdGl2ZSBwYXRoIHRvIGEgc2NyaXB0IChubyBsZWFkaW5nICcvJywgYW5kIHR5cGljYWxseSBlbmRpbmcNCgkJLy8JCWluICcuanMnKS4NCgkJLy8gbW9kdWxlOiANCgkJLy8JCUEgbW9kdWxlIHdob3NlIGV4aXN0YW5jZSB0byBjaGVjayBmb3IgYWZ0ZXIgbG9hZGluZyBhIHBhdGguICBDYW4gYmUNCgkJLy8JCXVzZWQgdG8gZGV0ZXJtaW5lIHN1Y2Nlc3Mgb3IgZmFpbHVyZSBvZiB0aGUgbG9hZC4NCgkJLy8gY2I6IA0KCQkvLwkJYSBjYWxsYmFjayBmdW5jdGlvbiB0byBwYXNzIHRoZSByZXN1bHQgb2YgZXZhbHVhdGluZyB0aGUgc2NyaXB0DQoNCgkJdmFyIHVyaSA9ICgocmVscGF0aC5jaGFyQXQoMCkgPT0gJy8nIHx8IHJlbHBhdGgubWF0Y2goL15cdys6LykpID8gIiIgOiBkLmJhc2VVcmwpICsgcmVscGF0aDsNCgkJdHJ5ew0KCQkJcmV0dXJuICFtb2R1bGUgPyBkLl9sb2FkVXJpKHVyaSwgY2IpIDogZC5fbG9hZFVyaUFuZENoZWNrKHVyaSwgbW9kdWxlLCBjYik7IC8vIEJvb2xlYW4NCgkJfWNhdGNoKGUpew0KCQkJY29uc29sZS5lcnJvcihlKTsNCgkJCXJldHVybiBmYWxzZTsgLy8gQm9vbGVhbg0KCQl9DQoJfQ0KDQoJZG9qby5fbG9hZFVyaSA9IGZ1bmN0aW9uKC8qU3RyaW5nKi91cmksIC8qRnVuY3Rpb24/Ki9jYil7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlMb2FkcyBKYXZhU2NyaXB0IGZyb20gYSBVUkkNCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlSZWFkcyB0aGUgY29udGVudHMgb2YgdGhlIFVSSSwgYW5kIGV2YWx1YXRlcyB0aGUgY29udGVudHMuICBUaGlzIGlzDQoJCS8vCQl1c2VkIHRvIGxvYWQgbW9kdWxlcyBhcyB3ZWxsIGFzIHJlc291cmNlIGJ1bmRsZXMuIFJldHVybnMgdHJ1ZSBpZg0KCQkvLwkJaXQgc3VjY2VlZGVkLiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBVUkkgcmVhZGluZyBmYWlsZWQuICBUaHJvd3MgaWYNCgkJLy8JCXRoZSBldmFsdWF0aW9uIHRocm93cy4NCgkJLy8JdXJpOiBhIHVyaSB3aGljaCBwb2ludHMgYXQgdGhlIHNjcmlwdCB0byBiZSBsb2FkZWQNCgkJLy8JY2I6IA0KCQkvLwkJYSBjYWxsYmFjayBmdW5jdGlvbiB0byBwcm9jZXNzIHRoZSByZXN1bHQgb2YgZXZhbHVhdGluZyB0aGUgc2NyaXB0DQoJCS8vCQlhcyBhbiBleHByZXNzaW9uLCB0eXBpY2FsbHkgdXNlZCBieSB0aGUgcmVzb3VyY2UgYnVuZGxlIGxvYWRlciB0bw0KCQkvLwkJbG9hZCBKU09OLXN0eWxlIHJlc291cmNlcw0KDQoJCWlmKGQuX2xvYWRlZFVybHNbdXJpXSl7DQoJCQlyZXR1cm4gdHJ1ZTsgLy8gQm9vbGVhbg0KCQl9DQoJCWQuX2luRmxpZ2h0Q291bnQrKzsgLy8gYmxvY2sgYWRkT25Mb2FkIGNhbGxzIHRoYXQgYXJyaXZlIHdoaWxlIHdlJ3JlIGJ1c3kgZG93bmxvYWRpbmcNCgkJdmFyIGNvbnRlbnRzID0gZC5fZ2V0VGV4dCh1cmksIHRydWUpOw0KCQlpZihjb250ZW50cyl7IC8vIG5vdCA0MDQsIGV0IGFsDQoJCQlkLl9sb2FkZWRVcmxzW3VyaV0gPSB0cnVlOw0KCQkJZC5fbG9hZGVkVXJscy5wdXNoKHVyaSk7DQoJCQlpZihjYil7DQoJCQkJY29udGVudHMgPSAnKCcrY29udGVudHMrJyknOw0KCQkJfWVsc2V7DQoJCQkJLy9Pbmx5IGRvIHRoZSBzY29waW5nIGlmIG5vIGNhbGxiYWNrLiBJZiBhIGNhbGxiYWNrIGlzIHNwZWNpZmllZCwNCgkJCQkvL2l0IGlzIG1vc3QgbGlrZWx5IHRoZSBpMThuIGJ1bmRsZSBzdHVmZi4NCgkJCQljb250ZW50cyA9IGQuX3Njb3BlUHJlZml4ICsgY29udGVudHMgKyBkLl9zY29wZVN1ZmZpeDsNCgkJCX0NCgkJCWlmKCFkLmlzSUUpeyBjb250ZW50cyArPSAiXHJcbi8vQCBzb3VyY2VVUkw9IiArIHVyaTsgfSAvLyBkZWJ1Z2dpbmcgYXNzaXN0IGZvciBGaXJlYnVnDQoJCQl2YXIgdmFsdWUgPSBkWyJldmFsIl0oY29udGVudHMpOw0KCQkJaWYoY2IpeyBjYih2YWx1ZSk7IH0NCgkJfQ0KCQkvLyBDaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byBjYWxsIF9jYWxsTG9hZGVkKCkgZHVlIHRvIGFuIGFkZE9uTG9hZCgpIHRoYXQgYXJyaXZlZCB3aGlsZSB3ZSB3ZXJlIGJ1c3kgZG93bmxvYWRpbmcNCgkJaWYoLS1kLl9pbkZsaWdodENvdW50ID09IDAgJiYgZC5fcG9zdExvYWQgJiYgZC5fbG9hZGVycy5sZW5ndGgpew0KCQkJLy8gV2Ugc2hvdWxkbid0IGJlIGFsbG93ZWQgdG8gZ2V0IGhlcmUgYnV0IEZpcmVmb3ggYWxsb3dzIGFuIGV2ZW50IA0KCQkJLy8gKG1vdXNlLCBrZXliZCwgYXN5bmMgeGhyR2V0KSB0byBpbnRlcnJ1cHQgYSBzeW5jaHJvbm91cyB4aHJHZXQuIA0KCQkJLy8gSWYgdGhlIGN1cnJlbnQgc2NyaXB0IGJsb2NrIGNvbnRhaW5zIG11bHRpcGxlIHJlcXVpcmUoKSBzdGF0ZW1lbnRzLCB0aGVuIGFmdGVyIGVhY2gNCgkJCS8vIHJlcXVpcmUoKSByZXR1cm5zLCBpbkZsaWdodENvdW50ID09IDAsIGJ1dCB3ZSB3YW50IHRvIGhvbGQgdGhlIF9jYWxsTG9hZGVkKCkgdW50aWwNCgkJCS8vIGFsbCByZXF1aXJlKClzIGFyZSBkb25lIHNpbmNlIHRoZSBvdXQtb2Ytc2VxdWVuY2UgYWRkT25Mb2FkKCkgcHJlc3VtYWJseSBuZWVkcyB0aGVtIGFsbC4NCgkJCS8vIHNldFRpbWVvdXQgYWxsb3dzIHRoZSBuZXh0IHJlcXVpcmUoKSB0byBzdGFydCAoaWYgbmVlZGVkKSwgYW5kIHRoZW4gd2UgY2hlY2sgdGhpcyBhZ2Fpbi4NCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsgDQoJCQkJLy8gSWYgaW5GbGlnaHRDb3VudCA+IDAsIHRoZW4gbXVsdGlwbGUgcmVxdWlyZSgpcyBhcmUgcnVubmluZyBzZXF1ZW50aWFsbHkgYW5kIA0KCQkJCS8vIHRoZSBuZXh0IHJlcXVpcmUoKSBzdGFydGVkIGFmdGVyIHNldFRpbWVvdXQoKSB3YXMgZXhlY3V0ZWQgYnV0IGJlZm9yZSB3ZSBnb3QgaGVyZS4NCgkJCQlpZihkLl9pbkZsaWdodENvdW50ID09IDApeyANCgkJCQkJZC5fY2FsbExvYWRlZCgpOw0KCQkJCX0NCgkJCX0sIDApOw0KCQl9DQoJCXJldHVybiAhIWNvbnRlbnRzOyAvLyBCb29sZWFuOiBjb250ZW50cz8gdHJ1ZSA6IGZhbHNlDQoJfQ0KCQ0KCS8vIEZJWE1FOiBwcm9iYWJseSBuZWVkIHRvIGFkZCBsb2dnaW5nIHRvIHRoaXMgbWV0aG9kDQoJZG9qby5fbG9hZFVyaUFuZENoZWNrID0gZnVuY3Rpb24oLypTdHJpbmcqL3VyaSwgLypTdHJpbmcqL21vZHVsZU5hbWUsIC8qRnVuY3Rpb24/Ki9jYil7DQoJCS8vIHN1bW1hcnk6IGNhbGxzIGxvYWRVcmkgdGhlbiBmaW5kTW9kdWxlIGFuZCByZXR1cm5zIHRydWUgaWYgYm90aCBzdWNjZWVkDQoJCXZhciBvayA9IGZhbHNlOw0KCQl0cnl7DQoJCQlvayA9IGQuX2xvYWRVcmkodXJpLCBjYik7DQoJCX1jYXRjaChlKXsNCgkJCWNvbnNvbGUuZXJyb3IoImZhaWxlZCBsb2FkaW5nICIgKyB1cmkgKyAiIHdpdGggZXJyb3I6ICIgKyBlKTsNCgkJfQ0KCQlyZXR1cm4gISEob2sgJiYgZC5fbG9hZGVkTW9kdWxlc1ttb2R1bGVOYW1lXSk7IC8vIEJvb2xlYW4NCgl9DQoNCglkb2pvLmxvYWRlZCA9IGZ1bmN0aW9uKCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlzaWduYWwgZmlyZWQgd2hlbiBpbml0aWFsIGVudmlyb25tZW50IGFuZCBwYWNrYWdlIGxvYWRpbmcgaXMNCgkJLy8JCWNvbXBsZXRlLiBZb3Ugc2hvdWxkIHVzZSBkb2pvLmFkZE9uTG9hZCgpIGluc3RlYWQgb2YgZG9pbmcgYSANCgkJLy8JCWRpcmVjdCBkb2pvLmNvbm5lY3QoKSB0byB0aGlzIG1ldGhvZCBpbiBvcmRlciB0byBoYW5kbGUNCgkJLy8JCWluaXRpYWxpemF0aW9uIHRhc2tzIHRoYXQgcmVxdWlyZSB0aGUgZW52aXJvbm1lbnQgdG8gYmUNCgkJLy8JCWluaXRpYWxpemVkLiBJbiBhIGJyb3dzZXIgaG9zdCwJZGVjbGFyYXRpdmUgd2lkZ2V0cyB3aWxsIA0KCQkvLwkJYmUgY29uc3RydWN0ZWQgd2hlbiB0aGlzIGZ1bmN0aW9uIGZpbmlzaGVzIHJ1bmluZy4NCgkJZC5fbG9hZE5vdGlmeWluZyA9IHRydWU7DQoJCWQuX3Bvc3RMb2FkID0gdHJ1ZTsNCgkJdmFyIG1sbCA9IGQuX2xvYWRlcnM7DQoNCgkJLy9DbGVhciBsaXN0ZW5lcnMgc28gbmV3IG9uZXMgY2FuIGJlIGFkZGVkDQoJCS8vRm9yIG90aGVyIHhkb21haW4gcGFja2FnZSBsb2FkcyBhZnRlciB0aGUgaW5pdGlhbCBsb2FkLg0KCQlkLl9sb2FkZXJzID0gW107DQoNCgkJZm9yKHZhciB4ID0gMDsgeCA8IG1sbC5sZW5ndGg7IHgrKyl7DQoJCQltbGxbeF0oKTsNCgkJfQ0KDQoJCWQuX2xvYWROb3RpZnlpbmcgPSBmYWxzZTsNCgkJDQoJCS8vTWFrZSBzdXJlIG5vdGhpbmcgZWxzZSBnb3QgYWRkZWQgdG8gdGhlIG9ubG9hZCBxdWV1ZQ0KCQkvL2FmdGVyIHRoaXMgZmlyc3QgcnVuLiBJZiBzb21ldGhpbmcgZGlkLCBhbmQgd2UgYXJlIG5vdCB3YWl0aW5nIGZvciBhbnkNCgkJLy9tb3JlIGluZmxpZ2h0IHJlc291cmNlcywgcnVuIGFnYWluLg0KCQlpZihkLl9wb3N0TG9hZCAmJiBkLl9pbkZsaWdodENvdW50ID09IDAgJiYgbWxsLmxlbmd0aCl7DQoJCQlkLl9jYWxsTG9hZGVkKCk7DQoJCX0NCgl9DQoNCglkb2pvLnVubG9hZGVkID0gZnVuY3Rpb24oKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCXNpZ25hbCBmaXJlZCBieSBpbXBlbmRpbmcgZW52aXJvbm1lbnQgZGVzdHJ1Y3Rpb24uIFlvdSBzaG91bGQgdXNlDQoJCS8vCQlkb2pvLmFkZE9uVW5sb2FkKCkgaW5zdGVhZCBvZiBkb2luZyBhIGRpcmVjdCBkb2pvLmNvbm5lY3QoKSB0byB0aGlzIA0KCQkvLwkJbWV0aG9kIHRvIHBlcmZvcm0gcGFnZS9hcHBsaWNhdGlvbiBjbGVhbnVwIG1ldGhvZHMuIFNlZSANCgkJLy8JCWRvam8uYWRkT25VbmxvYWQgZm9yIG1vcmUgaW5mby4NCgkJdmFyIG1sbCA9IGQuX3VubG9hZGVyczsNCgkJd2hpbGUobWxsLmxlbmd0aCl7DQoJCQkobWxsLnBvcCgpKSgpOw0KCQl9DQoJfQ0KDQoJZC5fb250byA9IGZ1bmN0aW9uKGFyciwgb2JqLCBmbil7DQoJCWlmKCFmbil7DQoJCQlhcnIucHVzaChvYmopOw0KCQl9ZWxzZSBpZihmbil7DQoJCQl2YXIgZnVuYyA9ICh0eXBlb2YgZm4gPT0gInN0cmluZyIpID8gb2JqW2ZuXSA6IGZuOw0KCQkJYXJyLnB1c2goZnVuY3Rpb24oKXsgZnVuYy5jYWxsKG9iaik7IH0pOw0KCQl9DQoJfQ0KDQoJZG9qby5yZWFkeSA9IGRvam8uYWRkT25Mb2FkID0gZnVuY3Rpb24oLypPYmplY3QqL29iaiwgLypTdHJpbmd8RnVuY3Rpb24/Ki9mdW5jdGlvbk5hbWUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmVnaXN0ZXJzIGEgZnVuY3Rpb24gdG8gYmUgdHJpZ2dlcmVkIGFmdGVyIHRoZSBET00gYW5kIGRvam8ucmVxdWlyZSgpIGNhbGxzIA0KCQkvLwkJaGF2ZSBmaW5pc2hlZCBsb2FkaW5nLg0KCQkvLw0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCVJlZ2lzdGVycyBhIGZ1bmN0aW9uIHRvIGJlIHRyaWdnZXJlZCBhZnRlciB0aGUgRE9NIGhhcyBmaW5pc2hlZA0KCQkvLwkJbG9hZGluZyBhbmQgYGRvam8ucmVxdWlyZWAgbW9kdWxlcyBoYXZlIGxvYWRlZC4gV2lkZ2V0cyBkZWNsYXJlZCBpbiBtYXJrdXAgDQoJCS8vCQloYXZlIGJlZW4gaW5zdGFudGlhdGVkIGlmIGBkakNvbmZpZy5wYXJzZU9uTG9hZGAgaXMgdHJ1ZSB3aGVuIHRoaXMgZmlyZXMuIA0KCQkvLw0KCQkvLwkJSW1hZ2VzIGFuZCBDU1MgZmlsZXMgbWF5IG9yIG1heSBub3QgaGF2ZSBmaW5pc2hlZCBkb3dubG9hZGluZyB3aGVuDQoJCS8vCQl0aGUgc3BlY2lmaWVkIGZ1bmN0aW9uIGlzIGNhbGxlZC4gIChOb3RlIHRoYXQgd2lkZ2V0cycgQ1NTIGFuZCBIVE1MDQoJCS8vCQljb2RlIGlzIGd1YXJhbnRlZWQgdG8gYmUgZG93bmxvYWRlZCBiZWZvcmUgc2FpZCB3aWRnZXRzIGFyZQ0KCQkvLwkJaW5zdGFudGlhdGVkLCB0aG91Z2ggaW5jbHVkaW5nIGNzcyByZXNvdWNlcyBCRUZPUkUgYW55IHNjcmlwdCBlbGVtZW50cw0KCQkvLwkJaXMgaGlnaGx5IHJlY29tbWVuZGVkKS4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JUmVnaXN0ZXIgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHRvIHJ1biB3aGVuIGV2ZXJ5dGhpbmcgaXMgcmVhZHkNCgkJLy8JfAlkb2pvLmFkZE9uTG9hZChmdW5jdGlvbigpeyBkb1N0dWZmKCk7IH0pOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZWdpc3RlciBhIGZ1bmN0aW9uIHRvIHJ1biB3aGVuIGV2ZXJ5dGhpbmcgaXMgcmVhZHkgYnkgcG9pbnRlcjoNCgkJLy8JfAl2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7IGRvU3R1ZmYoKTsgfQ0KCQkvLwl8CWRvam8uYWRkT25Mb2FkKGluaXQpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZWdpc3RlciBhIGZ1bmN0aW9uIHRvIHJ1biBzY29wZWQgdG8gYG9iamVjdGAsIGVpdGhlciBieSBuYW1lIG9yIGFub255bW91c2x5Og0KCQkvLwl8CWRvam8uYWRkT25Mb2FkKG9iamVjdCwgImZ1bmN0aW9uTmFtZSIpOw0KCQkvLwl8CWRvam8uYWRkT25Mb2FkKG9iamVjdCwgZnVuY3Rpb24oKXsgZG9TdHVmZigpOyB9KTsNCg0KCQlkLl9vbnRvKGQuX2xvYWRlcnMsIG9iaiwgZnVuY3Rpb25OYW1lKTsNCg0KCQkvL0FkZGVkIGZvciB4ZG9tYWluIGxvYWRpbmcuIGRvam8uYWRkT25Mb2FkIGlzIHVzZWQgdG8NCgkJLy9pbmRpY2F0ZSBjYWxsYmFja3MgYWZ0ZXIgZG9pbmcgc29tZSBkb2pvLnJlcXVpcmUoKSBzdGF0ZW1lbnRzLg0KCQkvL0luIHRoZSB4ZG9tYWluIGNhc2UsIGlmIGFsbCB0aGUgcmVxdWlyZXMgYXJlIGxvYWRlZCAoYWZ0ZXIgaW5pdGlhbA0KCQkvL3BhZ2UgbG9hZCksIHRoZW4gaW1tZWRpYXRlbHkgY2FsbCBhbnkgbGlzdGVuZXJzLg0KCQlpZihkLl9wb3N0TG9hZCAmJiBkLl9pbkZsaWdodENvdW50ID09IDAgJiYgIWQuX2xvYWROb3RpZnlpbmcpew0KCQkJZC5fY2FsbExvYWRlZCgpOw0KCQl9DQoJfQ0KDQoJLy9TdXBwb3J0IGNhbGxpbmcgZG9qby5hZGRPbkxvYWQgdmlhIGRqQ29uZmlnLmFkZE9uTG9hZC4gU3VwcG9ydCBhbGwgdGhlDQoJLy9jYWxsIHBlcm11dGF0aW9ucyBvZiBkb2pvLmFkZE9uTG9hZC4gTWFpbmx5IHVzZWZ1bCB3aGVuIGRvam8gaXMgYWRkZWQNCgkvL3RvIHRoZSBwYWdlIGFmdGVyIHRoZSBwYWdlIGhhcyBsb2FkZWQuDQoJdmFyIGRjYSA9IGQuY29uZmlnLmFkZE9uTG9hZDsNCglpZihkY2Epew0KCQlkLmFkZE9uTG9hZFsoZGNhIGluc3RhbmNlb2YgQXJyYXkgPyAiYXBwbHkiIDogImNhbGwiKV0oZCwgZGNhKTsNCgl9DQoNCglkb2pvLl9tb2R1bGVzTG9hZGVkID0gZnVuY3Rpb24oKXsNCgkJaWYoZC5fcG9zdExvYWQpeyByZXR1cm47IH0NCgkJaWYoZC5faW5GbGlnaHRDb3VudCA+IDApeyANCgkJCWNvbnNvbGUud2FybigiZmlsZXMgc3RpbGwgaW4gZmxpZ2h0ISIpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCWQuX2NhbGxMb2FkZWQoKTsNCgl9DQoNCglkb2pvLl9jYWxsTG9hZGVkID0gZnVuY3Rpb24oKXsNCg0KCQkvLyBUaGUgIm9iamVjdCIgY2hlY2sgaXMgZm9yIElFLCBhbmQgdGhlIG90aGVyIG9wZXJhIGNoZWNrIGZpeGVzIGFuDQoJCS8vIGlzc3VlIGluIE9wZXJhIHdoZXJlIGl0IGNvdWxkIG5vdCBmaW5kIHRoZSBib2R5IGVsZW1lbnQgaW4gc29tZQ0KCQkvLyB3aWRnZXQgdGVzdCBjYXNlcy4gIEZvciAwLjksIG1heWJlIHJvdXRlIGFsbCBicm93c2VycyB0aHJvdWdoIHRoZQ0KCQkvLyBzZXRUaW1lb3V0IChuZWVkIHByb3RlY3Rpb24gc3RpbGwgZm9yIG5vbi1icm93c2VyIGVudmlyb25tZW50cw0KCQkvLyB0aG91Z2gpLiBUaGlzIG1pZ2h0IGFsc28gaGVscCB0aGUgaXNzdWUgd2l0aCBGRiAyLjAgYW5kIGZyZWV6aW5nDQoJCS8vIGlzc3VlcyB3aGVyZSB3ZSB0cnkgdG8gZG8gc3luYyB4aHIgd2hpbGUgYmFja2dyb3VuZCBjc3MgaW1hZ2VzIGFyZQ0KCQkvLyBiZWluZyBsb2FkZWQgKHRyYWMgIzI1NzIpPyBDb25zaWRlciBmb3IgMC45Lg0KCQlpZih0eXBlb2Ygc2V0VGltZW91dCA9PSAib2JqZWN0IiB8fCAoZC5jb25maWcudXNlWERvbWFpbiAmJiBkLmlzT3BlcmEpKXsNCgkJCXNldFRpbWVvdXQoDQoJCQkJZC5pc0FJUiA/IGZ1bmN0aW9uKCl7IGQubG9hZGVkKCk7IH0gOiBkLl9zY29wZU5hbWUgKyAiLmxvYWRlZCgpOyIsDQoJCQkJMCk7DQoJCX1lbHNlew0KCQkJZC5sb2FkZWQoKTsNCgkJfQ0KCX0NCg0KCWRvam8uX2dldE1vZHVsZVN5bWJvbHMgPSBmdW5jdGlvbigvKlN0cmluZyovbW9kdWxlbmFtZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlDb252ZXJ0cyBhIG1vZHVsZSBuYW1lIGluIGRvdHRlZCBKUyBub3RhdGlvbiB0byBhbiBhcnJheQ0KCQkvLwkJcmVwcmVzZW50aW5nIHRoZSBwYXRoIGluIHRoZSBzb3VyY2UgdHJlZQ0KCQl2YXIgc3ltcyA9IG1vZHVsZW5hbWUuc3BsaXQoIi4iKTsNCgkJZm9yKHZhciBpID0gc3ltcy5sZW5ndGg7IGk+MDsgaS0tKXsNCgkJCXZhciBwYXJlbnRNb2R1bGUgPSBzeW1zLnNsaWNlKDAsIGkpLmpvaW4oIi4iKTsNCgkJCWlmKGkgPT0gMSAmJiAhZC5fbW9kdWxlSGFzUHJlZml4KHBhcmVudE1vZHVsZSkpewkJDQoJCQkJLy8gU3VwcG9ydCBkZWZhdWx0IG1vZHVsZSBkaXJlY3RvcnkgKHNpYmxpbmcgb2YgZG9qbykgZm9yIHRvcC1sZXZlbCBtb2R1bGVzIA0KCQkJCXN5bXNbMF0gPSAiLi4vIiArIHN5bXNbMF07DQoJCQl9ZWxzZXsNCgkJCQl2YXIgcGFyZW50TW9kdWxlUGF0aCA9IGQuX2dldE1vZHVsZVByZWZpeChwYXJlbnRNb2R1bGUpOw0KCQkJCWlmKHBhcmVudE1vZHVsZVBhdGggIT0gcGFyZW50TW9kdWxlKXsNCgkJCQkJc3ltcy5zcGxpY2UoMCwgaSwgcGFyZW50TW9kdWxlUGF0aCk7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gc3ltczsgLy8gQXJyYXkNCgl9DQoNCglkb2pvLl9nbG9iYWxfb21pdF9tb2R1bGVfY2hlY2sgPSBmYWxzZTsNCg0KCWRvam8ubG9hZEluaXQgPSBmdW5jdGlvbigvKkZ1bmN0aW9uKi9pbml0KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUV4ZWN1dGVzIGEgZnVuY3Rpb24gdGhhdCBuZWVkcyB0byBiZSBleGVjdXRlZCBmb3IgdGhlIGxvYWRlcidzIGRvam8ucmVxdWlyZUlmDQoJCS8vCQlyZXNvbHV0aW9ucyB0byB3b3JrLiBUaGlzIGlzIG5lZWRlZCBtb3N0bHkgZm9yIHRoZSB4ZG9tYWluIGxvYWRlciBjYXNlIHdoZXJlDQoJCS8vCQlhIGZ1bmN0aW9uIG5lZWRzIHRvIGJlIGV4ZWN1dGVkIHRvIHNldCB1cCB0aGUgcG9zc2libGUgdmFsdWVzIGZvciBhIGRvam8ucmVxdWlyZUlmDQoJCS8vCQljYWxsLg0KCQkvLwlpbml0Og0KCQkvLwkJYSBmdW5jdGlvbiByZWZlcmVuY2UuIEV4ZWN1dGVkIGltbWVkaWF0ZWx5Lg0KCQkvLwlkZXNjcmlwdGlvbjogVGhpcyBmdW5jdGlvbiBpcyBtYWlubHkgYSBtYXJrZXIgZm9yIHRoZSB4ZG9tYWluIGxvYWRlciB0byBrbm93IHBhcnRzIG9mDQoJCS8vCQljb2RlIHRoYXQgbmVlZHMgYmUgZXhlY3V0ZWQgb3V0c2lkZSB0aGUgZnVuY3Rpb24gd3JhcHBwZXIgdGhhdCBpcyBwbGFjZWQgYXJvdW5kIG1vZHVsZXMuDQoJCS8vCQlUaGUgaW5pdCBmdW5jdGlvbiBjb3VsZCBiZSBleGVjdXRlZCBtb3JlIHRoYW4gb25jZSwgYW5kIGl0IHNob3VsZCBtYWtlIG5vIGFzc3VtcHRpb25zDQoJCS8vCQlvbiB3aGF0IGlzIGxvYWRlZCwgb3Igd2hhdCBtb2R1bGVzIGFyZSBhdmFpbGFibGUuIE9ubHkgdGhlIGZ1bmN0aW9uYWxpdHkgaW4gRG9qbyBCYXNlDQoJCS8vCQlpcyBhbGxvd2VkIHRvIGJlIHVzZWQuIEF2b2lkIHVzaW5nIHRoaXMgbWV0aG9kLiBGb3IgYSB2YWxpZCB1c2UgY2FzZSwNCgkJLy8JCXNlZSB0aGUgc291cmNlIGZvciBkb2pveC5nZnguDQoJCWluaXQoKTsNCgl9DQoNCglkb2pvLl9sb2FkTW9kdWxlID0gZG9qby5yZXF1aXJlID0gZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZU5hbWUsIC8qQm9vbGVhbj8qL29taXRNb2R1bGVDaGVjayl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlsb2FkcyBhIEphdmFzY3JpcHQgbW9kdWxlIGZyb20gdGhlIGFwcHJvcHJpYXRlIFVSSQ0KCQkvLwltb2R1bGVOYW1lOg0KCQkvLwkJbW9kdWxlIG5hbWUgdG8gbG9hZCwgdXNpbmcgcGVyaW9kcyBmb3Igc2VwYXJhdG9ycywNCgkJLy8JCSBlLmcuICJkb2pvLmRhdGUubG9jYWxlIi4gIE1vZHVsZSBwYXRocyBhcmUgZGUtcmVmZXJlbmNlZCBieSBkb2pvJ3MNCgkJLy8JCWludGVybmFsIG1hcHBpbmcgb2YgbG9jYXRpb25zIHRvIG5hbWVzIGFuZCBhcmUgZGlzYW1iaWd1YXRlZCBieQ0KCQkvLwkJbG9uZ2VzdCBwcmVmaXguIFNlZSBgZG9qby5yZWdpc3Rlck1vZHVsZVBhdGgoKWAgZm9yIGRldGFpbHMgb24NCgkJLy8JCXJlZ2lzdGVyaW5nIG5ldyBtb2R1bGVzLg0KCQkvLwlvbWl0TW9kdWxlQ2hlY2s6DQoJCS8vCQlpZiBgdHJ1ZWAsIG9taXRNb2R1bGVDaGVjayBza2lwcyB0aGUgc3RlcCBvZiBlbnN1cmluZyB0aGF0IHRoZQ0KCQkvLwkJbG9hZGVkIGZpbGUgYWN0dWFsbHkgZGVmaW5lcyB0aGUgc3ltYm9sIGl0IGlzIHJlZmVyZW5jZWQgYnkuDQoJCS8vCQlGb3IgZXhhbXBsZSBpZiBpdCBjYWxsZWQgYXMgYGRvam8ucmVxdWlyZSgiYS5iLmMiKWAgYW5kIHRoZQ0KCQkvLwkJZmlsZSBsb2NhdGVkIGF0IGBhL2IvYy5qc2AgZG9lcyBub3QgZGVmaW5lIGFuIG9iamVjdCBgYS5iLmNgLA0KCQkvLwkJYW5kIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93cyB3aGVyZWFzIG5vIGV4Y2VwdGlvbiBpcyByYWlzZWQNCgkJLy8JCXdoZW4gY2FsbGVkIGFzIGBkb2pvLnJlcXVpcmUoImEuYi5jIiwgdHJ1ZSlgDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLyAJCU1vZHVsZXMgYXJlIGxvYWRlZCB2aWEgZG9qby5yZXF1aXJlIGJ5IHVzaW5nIG9uZSBvZiB0d28gbG9hZGVyczogdGhlIG5vcm1hbCBsb2FkZXINCgkJLy8gCQlhbmQgdGhlIHhkb21haW4gbG9hZGVyLiBUaGUgeGRvbWFpbiBsb2FkZXIgaXMgdXNlZCB3aGVuIGRvam8gd2FzIGJ1aWx0IHdpdGggYQ0KCQkvLyAJCWN1c3RvbSBidWlsZCB0aGF0IHNwZWNpZmllZCBsb2FkZXI9eGRvbWFpbiBhbmQgdGhlIG1vZHVsZSBsaXZlcyBvbiBhIG1vZHVsZVBhdGgNCgkJLy8gCQl0aGF0IGlzIGEgd2hvbGUgVVJMLCB3aXRoIHByb3RvY29sIGFuZCBhIGRvbWFpbi4gVGhlIHZlcnNpb25zIG9mIERvam8gdGhhdCBhcmUgb24NCgkJLy8gCQl0aGUgR29vZ2xlIGFuZCBBT0wgQ0ROcyB1c2UgdGhlIHhkb21haW4gbG9hZGVyLg0KCQkvLyANCgkJLy8gCQlJZiB0aGUgbW9kdWxlIGlzIGxvYWRlZCB2aWEgdGhlIHhkb21haW4gbG9hZGVyLCBpdCBpcyBhbiBhc3luY2hyb25vdXMgbG9hZCwgc2luY2UNCgkJLy8gCQl0aGUgbW9kdWxlIGlzIGFkZGVkIHZpYSBhIGR5bmFtaWNhbGx5IGNyZWF0ZWQgc2NyaXB0IHRhZy4gVGhpcw0KCQkvLyAJCW1lYW5zIHRoYXQgZG9qby5yZXF1aXJlKCkgY2FuIHJldHVybiBiZWZvcmUgdGhlIG1vZHVsZSBoYXMgbG9hZGVkLiBIb3dldmVyLCB0aGlzIA0KCQkvLyAJCXNob3VsZCBvbmx5IGhhcHBlbiBpbiB0aGUgY2FzZSB3aGVyZSB5b3UgZG8gZG9qby5yZXF1aXJlIGNhbGxzIGluIHRoZSB0b3AtbGV2ZWwNCgkJLy8gCQlIVE1MIHBhZ2UsIG9yIGlmIHlvdSBwdXJwb3NlbHkgYXZvaWQgdGhlIGxvYWRlciBjaGVja2luZyBmb3IgZG9qby5yZXF1aXJlDQoJCS8vIAkJZGVwZW5kZW5jaWVzIGluIHlvdXIgbW9kdWxlIGJ5IHVzaW5nIGEgc3ludGF4IGxpa2UgZG9qb1sicmVxdWlyZSJdIHRvIGxvYWQgdGhlIG1vZHVsZS4NCgkJLy8gDQoJCS8vIAkJU29tZXRpbWVzIGl0IGlzIHVzZWZ1bCB0byBub3QgaGF2ZSB0aGUgbG9hZGVyIGRldGVjdCB0aGUgZG9qby5yZXF1aXJlIGNhbGxzIGluIHRoZQ0KCQkvLyAJCW1vZHVsZSBzbyB0aGF0IHlvdSBjYW4gZHluYW1pY2FsbHkgbG9hZCB0aGUgbW9kdWxlcyBhcyBhIHJlc3VsdCBvZiBhbiBhY3Rpb24gb24gdGhlDQoJCS8vIAkJcGFnZSwgaW5zdGVhZCBvZiByaWdodCBhdCBtb2R1bGUgbG9hZCB0aW1lLg0KCQkvLyANCgkJLy8gCQlBbHNvLCBmb3Igc2NyaXB0IGJsb2NrcyBpbiBhbiBIVE1MIHBhZ2UsIHRoZSBsb2FkZXIgZG9lcyBub3QgcHJlLXByb2Nlc3MgdGhlbSwgc28NCgkJLy8gCQlpdCBkb2VzIG5vdCBrbm93IHRvIGRvd25sb2FkIHRoZSBtb2R1bGVzIGJlZm9yZSB0aGUgZG9qby5yZXF1aXJlIGNhbGxzIG9jY3VyLg0KCQkvLyANCgkJLy8gCQlTbywgaW4gdGhvc2UgdHdvIGNhc2VzLCB3aGVuIHlvdSB3YW50IG9uLXRoZS1mbHkgbW9kdWxlIGxvYWRpbmcgb3IgZm9yIHNjcmlwdCBibG9ja3MNCgkJLy8gCQlpbiB0aGUgSFRNTCBwYWdlLCBzcGVjaWFsIGNhcmUgbXVzdCBiZSB0YWtlbiBpZiB0aGUgZG9qby5yZXF1aXJlZCBjb2RlIGlzIGxvYWRlZA0KCQkvLyAJCWFzeW5jaHJvbm91c2x5LiBUbyBtYWtlIHN1cmUgeW91IGNhbiBleGVjdXRlIGNvZGUgdGhhdCBkZXBlbmRzIG9uIHRoZSBkb2pvLnJlcXVpcmVkDQoJCS8vIAkJbW9kdWxlcywgYmUgc3VyZSB0byBhZGQgdGhlIGNvZGUgdGhhdCBkZXBlbmRzIG9uIHRoZSBtb2R1bGVzIGluIGEgZG9qby5hZGRPbkxvYWQoKQ0KCQkvLyAJCWNhbGxiYWNrLiBkb2pvLmFkZE9uTG9hZCB3YWl0cyBmb3IgYWxsIG91dHN0YW5kaW5nIG1vZHVsZXMgdG8gZmluaXNoIGxvYWRpbmcgYmVmb3JlDQoJCS8vIAkJZXhlY3V0aW5nLiBFeGFtcGxlOg0KCQkvLyANCgkJLy8JICAgCXwJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KCQkvLwkJfAlkb2pvLnJlcXVpcmUoImZvbyIpOw0KCQkvLwkJfAlkb2pvLnJlcXVpcmUoImJhciIpOw0KCQkvLwkgICAJfAlkb2pvLmFkZE9uTG9hZChmdW5jdGlvbigpew0KCQkvLwkgICAJfAkJLy95b3UgY2FuIG5vdyBzYWZlbHkgZG8gc29tZXRoaW5nIHdpdGggZm9vIGFuZCBiYXINCgkJLy8JICAgCXwJfSk7DQoJCS8vCSAgIAl8CTwvc2NyaXB0Pg0KCQkvLyANCgkJLy8gCQlUaGlzIHR5cGUgb2Ygc3ludGF4IHdvcmtzIHdpdGggYm90aCB4ZG9tYWluIGFuZCBub3JtYWwgbG9hZGVycywgc28gaXQgaXMgZ29vZA0KCQkvLyAJCXByYWN0aWNlIHRvIGFsd2F5cyB1c2UgdGhpcyBpZGlvbSBmb3Igb24tdGhlLWZseSBjb2RlIGxvYWRpbmcgYW5kIGluIEhUTUwgc2NyaXB0DQoJCS8vIAkJYmxvY2tzLiBJZiBhdCBzb21lIHBvaW50IHlvdSBjaGFuZ2UgbG9hZGVycyBhbmQgd2hlcmUgdGhlIGNvZGUgaXMgbG9hZGVkIGZyb20sDQoJCS8vIAkJaXQgd2lsbCBhbGwgc3RpbGwgd29yay4NCgkJLy8gDQoJCS8vIAkJTW9yZSBvbiBob3cgZG9qby5yZXF1aXJlDQoJCS8vCQlgZG9qby5yZXF1aXJlKCJBLkIiKWAgZmlyc3QgY2hlY2tzIHRvIHNlZSBpZiBzeW1ib2wgQS5CIGlzDQoJCS8vCQlkZWZpbmVkLiBJZiBpdCBpcywgaXQgaXMgc2ltcGx5IHJldHVybmVkIChub3RoaW5nIHRvIGRvKS4NCgkJLy8JDQoJCS8vCQlJZiBpdCBpcyBub3QgZGVmaW5lZCwgaXQgd2lsbCBsb29rIGZvciBgQS9CLmpzYCBpbiB0aGUgc2NyaXB0IHJvb3QNCgkJLy8JCWRpcmVjdG9yeS4NCgkJLy8JDQoJCS8vCQlgZG9qby5yZXF1aXJlYCB0aHJvd3MgYW4gZXhjcGV0aW9uIGlmIGl0IGNhbm5vdCBmaW5kIGEgZmlsZQ0KCQkvLwkJdG8gbG9hZCwgb3IgaWYgdGhlIHN5bWJvbCBgQS5CYCBpcyBub3QgZGVmaW5lZCBhZnRlciBsb2FkaW5nLg0KCQkvLwkNCgkJLy8JCUl0IHJldHVybnMgdGhlIG9iamVjdCBgQS5CYCwgYnV0IG5vdGUgdGhlIGNhdmVhdHMgYWJvdmUgYWJvdXQgb24tdGhlLWZseSBsb2FkaW5nIGFuZA0KCQkvLyAJCUhUTUwgc2NyaXB0IGJsb2NrcyB3aGVuIHRoZSB4ZG9tYWluIGxvYWRlciBpcyBsb2FkaW5nIGEgbW9kdWxlLg0KCQkvLwkNCgkJLy8JCWBkb2pvLnJlcXVpcmUoKWAgZG9lcyBub3RoaW5nIGFib3V0IGltcG9ydGluZyBzeW1ib2xzIGludG8NCgkJLy8JCXRoZSBjdXJyZW50IG5hbWVzcGFjZS4gIEl0IGlzIHByZXN1bWVkIHRoYXQgdGhlIGNhbGxlciB3aWxsDQoJCS8vCQl0YWtlIGNhcmUgb2YgdGhhdC4gRm9yIGV4YW1wbGUsIHRvIGltcG9ydCBhbGwgc3ltYm9scyBpbnRvIGENCgkJLy8JCWxvY2FsIGJsb2NrLCB5b3UgbWlnaHQgd3JpdGU6DQoJCS8vCQ0KCQkvLwkJfAl3aXRoIChkb2pvLnJlcXVpcmUoIkEuQiIpKSB7DQoJCS8vCQl8CQkuLi4NCgkJLy8JCXwJfQ0KCQkvLwkNCgkJLy8JCUFuZCB0byBpbXBvcnQganVzdCB0aGUgbGVhZiBzeW1ib2wgdG8gYSBsb2NhbCB2YXJpYWJsZToNCgkJLy8JDQoJCS8vCQl8CXZhciBCID0gZG9qby5yZXF1aXJlKCJBLkIiKTsNCgkJLy8JICAgCXwJLi4uDQoJCS8vCXJldHVybnM6IHRoZSByZXF1aXJlZCBuYW1lc3BhY2Ugb2JqZWN0DQoJCW9taXRNb2R1bGVDaGVjayA9IGQuX2dsb2JhbF9vbWl0X21vZHVsZV9jaGVjayB8fCBvbWl0TW9kdWxlQ2hlY2s7DQoNCgkJLy9DaGVjayBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4NCgkJdmFyIG1vZHVsZSA9IGQuX2xvYWRlZE1vZHVsZXNbbW9kdWxlTmFtZV07DQoJCWlmKG1vZHVsZSl7DQoJCQlyZXR1cm4gbW9kdWxlOw0KCQl9DQoNCgkJLy8gY29udmVydCBwZXJpb2RzIHRvIHNsYXNoZXMNCgkJdmFyIHJlbHBhdGggPSBkLl9nZXRNb2R1bGVTeW1ib2xzKG1vZHVsZU5hbWUpLmpvaW4oIi8iKSArICcuanMnOw0KDQoJCXZhciBtb2RBcmcgPSAhb21pdE1vZHVsZUNoZWNrID8gbW9kdWxlTmFtZSA6IG51bGw7DQoJCXZhciBvayA9IGQuX2xvYWRQYXRoKHJlbHBhdGgsIG1vZEFyZyk7DQoNCgkJaWYoIW9rICYmICFvbWl0TW9kdWxlQ2hlY2spew0KCQkJdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgbG9hZCAnIiArIG1vZHVsZU5hbWUgKyAiJzsgbGFzdCB0cmllZCAnIiArIHJlbHBhdGggKyAiJyIpOw0KCQl9DQoNCgkJLy8gY2hlY2sgdGhhdCB0aGUgc3ltYm9sIHdhcyBkZWZpbmVkDQoJCS8vIERvbid0IGJvdGhlciBpZiB3ZSdyZSBkb2luZyB4ZG9tYWluIChhc3luY2hyb25vdXMpIGxvYWRpbmcuDQoJCWlmKCFvbWl0TW9kdWxlQ2hlY2sgJiYgIWQuX2lzWERvbWFpbil7DQoJCQkvLyBwYXNzIGluIGZhbHNlIHNvIHdlIGNhbiBnaXZlIGJldHRlciBlcnJvcg0KCQkJbW9kdWxlID0gZC5fbG9hZGVkTW9kdWxlc1ttb2R1bGVOYW1lXTsNCgkJCWlmKCFtb2R1bGUpew0KCQkJCXRocm93IG5ldyBFcnJvcigic3ltYm9sICciICsgbW9kdWxlTmFtZSArICInIGlzIG5vdCBkZWZpbmVkIGFmdGVyIGxvYWRpbmcgJyIgKyByZWxwYXRoICsgIiciKTsgDQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gbW9kdWxlOw0KCX0NCg0KCWRvam8ucHJvdmlkZSA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gcmVzb3VyY2VOYW1lKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJlZ2lzdGVyIGEgcmVzb3VyY2Ugd2l0aCB0aGUgcGFja2FnZSBzeXN0ZW0uIFdvcmtzIGluIGNvbmp1bmN0aW9uIHdpdGggYGRvam8ucmVxdWlyZWANCgkJLy8NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlFYWNoIGphdmFzY3JpcHQgc291cmNlIGZpbGUgaXMgY2FsbGVkIGEgcmVzb3VyY2UuICBXaGVuIGENCgkJLy8JCXJlc291cmNlIGlzIGxvYWRlZCBieSB0aGUgYnJvd3NlciwgYGRvam8ucHJvdmlkZSgpYCByZWdpc3RlcnMNCgkJLy8JCXRoYXQgaXQgaGFzIGJlZW4gbG9hZGVkLg0KCQkvLw0KCQkvLwkJRWFjaCBqYXZhc2NyaXB0IHNvdXJjZSBmaWxlIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUNCgkJLy8JCWBkb2pvLnByb3ZpZGUoKWAgY2FsbCBhdCB0aGUgdG9wIG9mIHRoZSBmaWxlLCBjb3JyZXNwb25kaW5nIHRvDQoJCS8vCQl0aGUgZmlsZSBuYW1lLiAgRm9yIGV4YW1wbGUsIGBqcy9kb2pvL2Zvby5qc2AgbXVzdCBoYXZlDQoJCS8vCQlgZG9qby5wcm92aWRlKCJkb2pvLmZvbyIpO2AgYmVmb3JlIGFueSBjYWxscyB0bw0KCQkvLwkJYGRvam8ucmVxdWlyZSgpYCBhcmUgbWFkZS4NCgkJLy8JDQoJCS8vCQlGb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgcmVhc29ucywgaW4gYWRkaXRpb24gdG8gcmVnaXN0ZXJpbmcNCgkJLy8JCXRoZSByZXNvdXJjZSwgYGRvam8ucHJvdmlkZSgpYCBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgamF2YXNjcmlwdA0KCQkvLwkJb2JqZWN0IGZvciB0aGUgbW9kdWxlIGV4aXN0cy4gIEZvciBleGFtcGxlLA0KCQkvLwkJYGRvam8ucHJvdmlkZSgiZG9qb3guZGF0YS5GbGlja3JTdG9yZSIpYCwgaW4gYWRkaXRpb24gdG8NCgkJLy8JCXJlZ2lzdGVyaW5nIHRoYXQgYEZsaWNrclN0b3JlLmpzYCBpcyBhIHJlc291cmNlIGZvciB0aGUNCgkJLy8JCWBkb2pveC5kYXRhYCBtb2R1bGUsIHdpbGwgZW5zdXJlIHRoYXQgdGhlIGBkb2pveC5kYXRhYA0KCQkvLwkJamF2YXNjcmlwdCBvYmplY3QgZXhpc3RzLCBzbyB0aGF0IGNhbGxzIGxpa2UgDQoJCS8vCQlgZG9qby5kYXRhLmZvbyA9IGZ1bmN0aW9uKCl7IC4uLiB9YCBkb24ndCBmYWlsLg0KCQkvLw0KCQkvLwkJSW4gdGhlIGNhc2Ugb2YgYSBidWlsZCB3aGVyZSBtdWx0aXBsZSBqYXZhc2NyaXB0IHNvdXJjZSBmaWxlcw0KCQkvLwkJYXJlIGNvbWJpbmVkIGludG8gb25lIGJpZ2dlciBmaWxlIChzaW1pbGFyIHRvIGEgLmxpYiBvciAuamFyDQoJCS8vCQlmaWxlKSwgdGhhdCBmaWxlIG1heSBjb250YWluIG11bHRpcGxlIGRvam8ucHJvdmlkZSgpIGNhbGxzLCB0bw0KCQkvLwkJbm90ZSB0aGF0IGl0IGluY2x1ZGVzIG11bHRpcGxlIHJlc291cmNlcy4NCgkJLy8NCgkJLy8gcmVzb3VyY2VOYW1lOiBTdHJpbmcNCgkJLy8JCUEgZG90LXNwZXJhdGVkIHN0cmluZyBpZGVudGlmeWluZyBhIHJlc291cmNlLiANCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JU2FmZWx5IGNyZWF0ZSBhIGBteWAgb2JqZWN0LCBhbmQgbWFrZSBkb2pvLnJlcXVpcmUoIm15LkN1c3RvbU1vZHVsZSIpIHdvcmsNCgkJLy8JfAlkb2pvLnByb3ZpZGUoIm15LkN1c3RvbU1vZHVsZSIpOyANCg0KCQkvL01ha2Ugc3VyZSB3ZSBoYXZlIGEgc3RyaW5nLg0KCQlyZXNvdXJjZU5hbWUgPSByZXNvdXJjZU5hbWUgKyAiIjsNCgkJcmV0dXJuIChkLl9sb2FkZWRNb2R1bGVzW3Jlc291cmNlTmFtZV0gPSBkLmdldE9iamVjdChyZXNvdXJjZU5hbWUsIHRydWUpKTsgLy8gT2JqZWN0DQoJfQ0KDQoJLy9TdGFydCBvZiBvbGQgYm9vdHN0cmFwMjoNCg0KCWRvam8ucGxhdGZvcm1SZXF1aXJlID0gZnVuY3Rpb24oLypPYmplY3QqL21vZE1hcCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlyZXF1aXJlIG9uZSBvciBtb3JlIG1vZHVsZXMgYmFzZWQgb24gd2hpY2ggaG9zdCBlbnZpcm9ubWVudA0KCQkvLwkJRG9qbyBpcyBjdXJyZW50bHkgb3BlcmF0aW5nIGluDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJVGhpcyBtZXRob2QgdGFrZXMgYSAibWFwIiBvZiBhcnJheXMgd2hpY2ggb25lIGNhbiB1c2UgdG8NCgkJLy8JCW9wdGlvbmFsbHkgbG9hZCBkb2pvIG1vZHVsZXMuIFRoZSBtYXAgaXMgaW5kZXhlZCBieSB0aGUNCgkJLy8JCXBvc3NpYmxlIGRvam8ubmFtZV8gdmFsdWVzLCB3aXRoIHR3byBhZGRpdGlvbmFsIHZhbHVlczoNCgkJLy8JCSJkZWZhdWx0IiBhbmQgImNvbW1vbiIuIFRoZSBpdGVtcyBpbiB0aGUgImRlZmF1bHQiIGFycmF5IHdpbGwNCgkJLy8JCWJlIGxvYWRlZCBpZiBub25lIG9mIHRoZSBvdGhlciBpdGVtcyBoYXZlIGJlZW4gY2hvb3NlbiBiYXNlZCBvbg0KCQkvLwkJZG9qby5uYW1lXywgc2V0IGJ5IHlvdXIgaG9zdCBlbnZpcm9ubWVudC4gVGhlIGl0ZW1zIGluIHRoZQ0KCQkvLwkJImNvbW1vbiIgYXJyYXkgd2lsbCAqYWx3YXlzKiBiZSBsb2FkZWQsIHJlZ2FyZGxlc3Mgb2Ygd2hpY2gNCgkJLy8JCWxpc3QgaXMgY2hvc2VuLg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJfAlkb2pvLnBsYXRmb3JtUmVxdWlyZSh7DQoJCS8vCQl8CQlicm93c2VyOiBbDQoJCS8vCQl8CQkJImZvby5zYW1wbGUiLCAvLyBzaW1wbGUgbW9kdWxlDQoJCS8vCQl8CQkJImZvby50ZXN0IiwNCgkJLy8JCXwJCQlbImZvby5iYXIuYmF6IiwgdHJ1ZV0gLy8gc2tpcCBvYmplY3QgY2hlY2sgaW4gX2xvYWRNb2R1bGUgKGRvam8ucmVxdWlyZSkNCgkJLy8JCXwJCV0sDQoJCS8vCQl8CQlkZWZhdWx0OiBbICJmb28uc2FtcGxlLl9iYXNlIiBdLA0KCQkvLwkJfAkJY29tbW9uOiBbICJpbXBvcnRhbnQubW9kdWxlLmNvbW1vbiIgXQ0KCQkvLwkJfAl9KTsNCg0KCQl2YXIgY29tbW9uID0gbW9kTWFwLmNvbW1vbiB8fCBbXTsNCgkJdmFyIHJlc3VsdCA9IGNvbW1vbi5jb25jYXQobW9kTWFwW2QuX25hbWVdIHx8IG1vZE1hcFsiZGVmYXVsdCJdIHx8IFtdKTsNCg0KCQlmb3IodmFyIHg9MDsgeDxyZXN1bHQubGVuZ3RoOyB4Kyspew0KCQkJdmFyIGN1cnIgPSByZXN1bHRbeF07DQoJCQlpZihjdXJyLmNvbnN0cnVjdG9yID09IEFycmF5KXsNCgkJCQlkLl9sb2FkTW9kdWxlLmFwcGx5KGQsIGN1cnIpOw0KCQkJfWVsc2V7DQoJCQkJZC5fbG9hZE1vZHVsZShjdXJyKTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWRvam8ucmVxdWlyZUlmID0gZnVuY3Rpb24oLypCb29sZWFuKi8gY29uZGl0aW9uLCAvKlN0cmluZyovIHJlc291cmNlTmFtZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlJZiB0aGUgY29uZGl0aW9uIGlzIHRydWUgdGhlbiBjYWxsIGBkb2pvLnJlcXVpcmUoKWAgZm9yIHRoZSBzcGVjaWZpZWQNCgkJLy8JCXJlc291cmNlDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCXwJZG9qby5yZXF1aXJlSWYoZG9qby5pc0Jyb3dzZXIsICJteS5zcGVjaWFsLk1vZHVsZSIpOw0KCQkNCgkJaWYoY29uZGl0aW9uID09PSB0cnVlKXsNCgkJCS8vIEZJWE1FOiB3aHkgZG8gd2Ugc3VwcG9ydCBjaGFpbmVkIHJlcXVpcmUoKSdzIGhlcmU/IGRvZXMgdGhlIGJ1aWxkIHN5c3RlbT8NCgkJCXZhciBhcmdzID0gW107DQoJCQlmb3IodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKXsgDQoJCQkJYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7DQoJCQl9DQoJCQlkLnJlcXVpcmUuYXBwbHkoZCwgYXJncyk7DQoJCX0NCgl9DQoNCglkb2pvLnJlcXVpcmVBZnRlcklmID0gZC5yZXF1aXJlSWY7DQoNCglkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9tb2R1bGUsIC8qU3RyaW5nKi9wcmVmaXgpew0KCQkvLwlzdW1tYXJ5OiANCgkJLy8JCU1hcHMgYSBtb2R1bGUgbmFtZSB0byBhIHBhdGgNCgkJLy8JZGVzY3JpcHRpb246IA0KCQkvLwkJQW4gdW5yZWdpc3RlcmVkIG1vZHVsZSBpcyBnaXZlbiB0aGUgZGVmYXVsdCBwYXRoIG9mIC4uL1ttb2R1bGVdLA0KCQkvLwkJcmVsYXRpdmUgdG8gRG9qbyByb290LiBGb3IgZXhhbXBsZSwgbW9kdWxlIGFjbWUgaXMgbWFwcGVkIHRvDQoJCS8vCQkuLi9hY21lLiAgSWYgeW91IHdhbnQgdG8gdXNlIGEgZGlmZmVyZW50IG1vZHVsZSBuYW1lLCB1c2UNCgkJLy8JCWRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoLiANCgkJLy8JZXhhbXBsZToNCgkJLy8JCUlmIHlvdXIgZG9qby5qcyBpcyBsb2NhdGVkIGF0IHRoaXMgbG9jYXRpb24gaW4gdGhlIHdlYiByb290Og0KCQkvLwl8CS9teWFwcC9qcy9kb2pvL2Rvam8vZG9qby5qcw0KCQkvLwkJYW5kIHlvdXIgbW9kdWxlcyBhcmUgbG9jYXRlZCBhdDoNCgkJLy8JfAkvbXlhcHAvanMvZm9vL2Jhci5qcw0KCQkvLwl8CS9teWFwcC9qcy9mb28vYmF6LmpzDQoJCS8vCXwJL215YXBwL2pzL2Zvby90aHVkL3h5enp5LmpzDQoJCS8vCQlZb3VyIGFwcGxpY2F0aW9uIGNhbiB0ZWxsIERvam8gdG8gbG9jYXRlIHRoZSAiZm9vIiBuYW1lc3BhY2UgYnkgY2FsbGluZzoNCgkJLy8JfAlkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgiZm9vIiwgIi4uLy4uL2ZvbyIpOw0KCQkvLwkJQXQgd2hpY2ggcG9pbnQgeW91IGNhbiB0aGVuIHVzZSBkb2pvLnJlcXVpcmUoKSB0byBsb2FkIHRoZQ0KCQkvLwkJbW9kdWxlcyAoYXNzdW1pbmcgdGhleSBwcm92aWRlKCkgdGhlIHNhbWUgdGhpbmdzIHdoaWNoIGFyZQ0KCQkvLwkJcmVxdWlyZWQpLiBUaGUgZnVsbCBjb2RlIG1pZ2h0IGJlOg0KCQkvLwl8CTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiANCgkJLy8JfAkJc3JjPSIvbXlhcHAvanMvZG9qby9kb2pvL2Rvam8uanMiPjwvc2NyaXB0Pg0KCQkvLwl8CTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCgkJLy8JfAkJZG9qby5yZWdpc3Rlck1vZHVsZVBhdGgoImZvbyIsICIuLi8uLi9mb28iKTsNCgkJLy8JfAkJZG9qby5yZXF1aXJlKCJmb28uYmFyIik7DQoJCS8vCXwJCWRvam8ucmVxdWlyZSgiZm9vLmJheiIpOw0KCQkvLwl8CQlkb2pvLnJlcXVpcmUoImZvby50aHVkLnh5enp5Iik7DQoJCS8vCXwJPC9zY3JpcHQ+DQoJCWQuX21vZHVsZVByZWZpeGVzW21vZHVsZV0gPSB7IG5hbWU6IG1vZHVsZSwgdmFsdWU6IHByZWZpeCB9Ow0KCX0NCg0KCWRvam8ucmVxdWlyZUxvY2FsaXphdGlvbiA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9tb2R1bGVOYW1lLCAvKlN0cmluZyovYnVuZGxlTmFtZSwgLypTdHJpbmc/Ki9sb2NhbGUsIC8qU3RyaW5nPyovYXZhaWxhYmxlRmxhdExvY2FsZXMpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJRGVjbGFyZXMgdHJhbnNsYXRlZCByZXNvdXJjZXMgYW5kIGxvYWRzIHRoZW0gaWYgbmVjZXNzYXJ5LCBpbiB0aGUNCgkJLy8JCXNhbWUgc3R5bGUgYXMgZG9qby5yZXF1aXJlLiAgQ29udGVudHMgb2YgdGhlIHJlc291cmNlIGJ1bmRsZSBhcmUNCgkJLy8JCXR5cGljYWxseSBzdHJpbmdzLCBidXQgbWF5IGJlIGFueSBuYW1lL3ZhbHVlIHBhaXIsIHJlcHJlc2VudGVkIGluDQoJCS8vCQlKU09OIGZvcm1hdC4gIFNlZSBhbHNvIGBkb2pvLmkxOG4uZ2V0TG9jYWxpemF0aW9uYC4NCgkJLy8NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQlMb2FkIHRyYW5zbGF0ZWQgcmVzb3VyY2UgYnVuZGxlcyBwcm92aWRlZCB1bmRlcm5lYXRoIHRoZSAibmxzIg0KCQkvLwkJZGlyZWN0b3J5IHdpdGhpbiBhIHBhY2thZ2UuICBUcmFuc2xhdGVkIHJlc291cmNlcyBtYXkgYmUgbG9jYXRlZCBpbg0KCQkvLwkJZGlmZmVyZW50IHBhY2thZ2VzIHRocm91Z2hvdXQgdGhlIHNvdXJjZSB0cmVlLiAgDQoJCS8vDQoJCS8vCQlFYWNoIGRpcmVjdG9yeSBpcyBuYW1lZCBmb3IgYSBsb2NhbGUgYXMgc3BlY2lmaWVkIGJ5IFJGQyAzMDY2LA0KCQkvLwkJKGh0dHA6Ly93d3cuaWV0Zi5vcmcvcmZjL3JmYzMwNjYudHh0KSwgbm9ybWFsaXplZCBpbiBsb3dlcmNhc2UuDQoJCS8vCQlOb3RlIHRoYXQgdGhlIHR3byBidW5kbGVzIGluIHRoZSBleGFtcGxlIGRvIG5vdCBkZWZpbmUgYWxsIHRoZQ0KCQkvLwkJc2FtZSB2YXJpYW50cy4gIEZvciBhIGdpdmVuIGxvY2FsZSwgYnVuZGxlcyB3aWxsIGJlIGxvYWRlZCBmb3INCgkJLy8JCXRoYXQgbG9jYWxlIGFuZCBhbGwgbW9yZSBnZW5lcmFsIGxvY2FsZXMgYWJvdmUgaXQsIGluY2x1ZGluZyBhDQoJCS8vCQlmYWxsYmFjayBhdCB0aGUgcm9vdCBkaXJlY3RvcnkuICBGb3IgZXhhbXBsZSwgYSBkZWNsYXJhdGlvbiBmb3INCgkJLy8JCXRoZSAiZGUtYXQiIGxvY2FsZSB3aWxsIGZpcnN0IGxvYWQgYG5scy9kZS1hdC9idW5kbGVvbmUuanNgLA0KCQkvLwkJdGhlbiBgbmxzL2RlL2J1bmRsZW9uZS5qc2AgYW5kIGZpbmFsbHkgYG5scy9idW5kbGVvbmUuanNgLiAgVGhlDQoJCS8vCQlkYXRhIHdpbGwgYmUgZmxhdHRlbmVkIGludG8gYSBzaW5nbGUgT2JqZWN0IHNvIHRoYXQgbG9va3Vwcw0KCQkvLwkJd2lsbCBmb2xsb3cgdGhpcyBjYXNjYWRpbmcgcGF0dGVybi4gIEFuIG9wdGlvbmFsIGJ1aWxkIHN0ZXAgY2FuDQoJCS8vCQlwcmVsb2FkIHRoZSBidW5kbGVzIHRvIGF2b2lkIGRhdGEgcmVkdW5kYW5jeSBhbmQgdGhlIG11bHRpcGxlDQoJCS8vCQluZXR3b3JrIGhpdHMgbm9ybWFsbHkgcmVxdWlyZWQgdG8gbG9hZCB0aGVzZSByZXNvdXJjZXMuDQoJCS8vDQoJCS8vIG1vZHVsZU5hbWU6IA0KCQkvLwkJbmFtZSBvZiB0aGUgcGFja2FnZSBjb250YWluaW5nIHRoZSAibmxzIiBkaXJlY3RvcnkgaW4gd2hpY2ggdGhlDQoJCS8vCQlidW5kbGUgaXMgZm91bmQNCgkJLy8NCgkJLy8gYnVuZGxlTmFtZTogDQoJCS8vCQlidW5kbGUgbmFtZSwgaS5lLiB0aGUgZmlsZW5hbWUgd2l0aG91dCB0aGUgJy5qcycgc3VmZml4LiBVc2luZyAibmxzIiBhcyBhDQoJCS8vCQlhIGJ1bmRsZSBuYW1lIGlzIG5vdCBzdXBwb3J0ZWQsIHNpbmNlICJubHMiIGlzIHRoZSBuYW1lIG9mIHRoZSBmb2xkZXINCgkJLy8JCXRoYXQgaG9sZHMgYnVuZGxlcy4gVXNpbmcgIm5scyIgYXMgdGhlIGJ1bmRsZSBuYW1lIHdpbGwgY2F1c2UgcHJvYmxlbXMNCgkJLy8JCXdpdGggdGhlIGN1c3RvbSBidWlsZC4NCgkJLy8NCgkJLy8gbG9jYWxlOiANCgkJLy8JCXRoZSBsb2NhbGUgdG8gbG9hZCAob3B0aW9uYWwpICBCeSBkZWZhdWx0LCB0aGUgYnJvd3NlcidzIHVzZXINCgkJLy8JCWxvY2FsZSBhcyBkZWZpbmVkIGJ5IGRvam8ubG9jYWxlDQoJCS8vDQoJCS8vIGF2YWlsYWJsZUZsYXRMb2NhbGVzOiANCgkJLy8JCUEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgdGhlIGF2YWlsYWJsZSwgZmxhdHRlbmVkIGxvY2FsZXMgZm9yIHRoaXMNCgkJLy8JCWJ1bmRsZS4gVGhpcyBhcmd1bWVudCBzaG91bGQgb25seSBiZSBzZXQgYnkgdGhlIGJ1aWxkIHByb2Nlc3MuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlBIHBhcnRpY3VsYXIgd2lkZ2V0IG1heSBkZWZpbmUgb25lIG9yIG1vcmUgcmVzb3VyY2UgYnVuZGxlcywNCgkJLy8JCXN0cnVjdHVyZWQgaW4gYSBwcm9ncmFtIGFzIGZvbGxvd3MsIHdoZXJlIG1vZHVsZU5hbWUgaXMNCgkJLy8JCW15Y29kZS5teXdpZGdldCBhbmQgYnVuZGxlTmFtZXMgYXZhaWxhYmxlIGluY2x1ZGUgYnVuZGxlb25lIGFuZA0KCQkvLwkJYnVuZGxldHdvOg0KCQkvLwl8CQkuLi4NCgkJLy8JfAlteWNvZGUvDQoJCS8vCXwJCW15d2lkZ2V0Lw0KCQkvLwl8CQkJbmxzLw0KCQkvLwl8CQkJCWJ1bmRsZW9uZS5qcyAodGhlIGZhbGxiYWNrIHRyYW5zbGF0aW9uLCBFbmdsaXNoIGluIHRoaXMgZXhhbXBsZSkNCgkJLy8JfAkJCQlidW5kbGV0d28uanMgKGFsc28gYSBmYWxsYmFjayB0cmFuc2xhdGlvbikNCgkJLy8JfAkJCQlkZS8NCgkJLy8JfAkJCQkJYnVuZGxlb25lLmpzDQoJCS8vCXwJCQkJCWJ1bmRsZXR3by5qcw0KCQkvLwl8CQkJCWRlLWF0Lw0KCQkvLwl8CQkJCQlidW5kbGVvbmUuanMNCgkJLy8JfAkJCQllbi8NCgkJLy8JfAkJCQkJKGVtcHR5OyB1c2UgdGhlIGZhbGxiYWNrIHRyYW5zbGF0aW9uKQ0KCQkvLwl8CQkJCWVuLXVzLw0KCQkvLwl8CQkJCQlidW5kbGVvbmUuanMNCgkJLy8JfAkJCQllbi1nYi8NCgkJLy8JfAkJCQkJYnVuZGxlb25lLmpzDQoJCS8vCXwJCQkJZXMvDQoJCS8vCXwJCQkJCWJ1bmRsZW9uZS5qcw0KCQkvLwl8CQkJCQlidW5kbGV0d28uanMNCgkJLy8JfAkJCQkgIC4uLmV0Yw0KCQkvLwl8CQkJCS4uLg0KCQkvLw0KDQoJCWQucmVxdWlyZSgiZG9qby5pMThuIik7DQoJCWQuaTE4bi5fcmVxdWlyZUxvY2FsaXphdGlvbi5hcHBseShkLmhvc3RlbnYsIGFyZ3VtZW50cyk7DQoJfTsNCg0KDQoJdmFyIG9yZSA9IG5ldyBSZWdFeHAoIl4oKFteOi8/I10rKTopPygvLyhbXi8/I10qKSk/KFtePyNdKikoXFw/KFteI10qKSk/KCMoLiopKT8kIiksDQoJCWlyZSA9IG5ldyBSZWdFeHAoIl4oKChbXlxcWzpdKyk6KT8oW15AXSspQCk/KFxcWyhbXlxcXV0rKVxcXXwoW15cXFs6XSopKSg6KFswLTldKykpPyQiKTsNCg0KCWRvam8uX1VybCA9IGZ1bmN0aW9uKC8qZG9qby5fVXJsfFN0cmluZy4uLiovKXsNCgkJLy8gc3VtbWFyeTogDQoJCS8vCQlDb25zdHJ1Y3RvciB0byBjcmVhdGUgYW4gb2JqZWN0IHJlcHJlc2VudGluZyBhIFVSTC4NCgkJLy8JCUl0IGlzIG1hcmtlZCBhcyBwcml2YXRlLCBzaW5jZSB3ZSBtaWdodCBjb25zaWRlciByZW1vdmluZw0KCQkvLwkJb3Igc2ltcGxpZnlpbmcgaXQuDQoJCS8vIGRlc2NyaXB0aW9uOiANCgkJLy8JCUVhY2ggYXJndW1lbnQgaXMgZXZhbHVhdGVkIGluIG9yZGVyIHJlbGF0aXZlIHRvIHRoZSBuZXh0IHVudGlsDQoJCS8vCQlhIGNhbm9uaWNhbCB1cmkgaXMgcHJvZHVjZWQuIFRvIGdldCBhbiBhYnNvbHV0ZSBVcmkgcmVsYXRpdmUgdG8NCgkJLy8JCXRoZSBjdXJyZW50IGRvY3VtZW50IHVzZToNCgkJLy8gICAgICAJbmV3IGRvam8uX1VybChkb2N1bWVudC5iYXNlVVJJLCB1cmwpDQoNCgkJdmFyIG4gPSBudWxsLA0KCQkJX2EgPSBhcmd1bWVudHMsDQoJCQl1cmkgPSBbX2FbMF1dOw0KCQkvLyByZXNvbHZlIHVyaSBjb21wb25lbnRzIHJlbGF0aXZlIHRvIGVhY2ggb3RoZXINCgkJZm9yKHZhciBpID0gMTsgaTxfYS5sZW5ndGg7IGkrKyl7DQoJCQlpZighX2FbaV0peyBjb250aW51ZTsgfQ0KDQoJCQkvLyBTYWZhcmkgZG9lc24ndCBzdXBwb3J0IHRoaXMuY29uc3RydWN0b3Igc28gd2UgaGF2ZSB0byBiZSBleHBsaWNpdA0KCQkJLy8gRklYTUU6IFRyYWNrZWQgKGFuZCBmaXhlZCkgaW4gV2Via2l0IGJ1ZyAzNTM3Lg0KCQkJLy8JCWh0dHA6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTM1MzcNCgkJCXZhciByZWxvYmogPSBuZXcgZC5fVXJsKF9hW2ldKyIiKSwNCgkJCQl1cmlvYmogPSBuZXcgZC5fVXJsKHVyaVswXSsiIik7DQoNCgkJCWlmKA0KCQkJCXJlbG9iai5wYXRoID09ICIiICYmDQoJCQkJIXJlbG9iai5zY2hlbWUgJiYNCgkJCQkhcmVsb2JqLmF1dGhvcml0eSAmJg0KCQkJCSFyZWxvYmoucXVlcnkNCgkJCSl7DQoJCQkJaWYocmVsb2JqLmZyYWdtZW50ICE9IG4pew0KCQkJCQl1cmlvYmouZnJhZ21lbnQgPSByZWxvYmouZnJhZ21lbnQ7DQoJCQkJfQ0KCQkJCXJlbG9iaiA9IHVyaW9iajsNCgkJCX1lbHNlIGlmKCFyZWxvYmouc2NoZW1lKXsNCgkJCQlyZWxvYmouc2NoZW1lID0gdXJpb2JqLnNjaGVtZTsNCg0KCQkJCWlmKCFyZWxvYmouYXV0aG9yaXR5KXsNCgkJCQkJcmVsb2JqLmF1dGhvcml0eSA9IHVyaW9iai5hdXRob3JpdHk7DQoNCgkJCQkJaWYocmVsb2JqLnBhdGguY2hhckF0KDApICE9ICIvIil7DQoJCQkJCQl2YXIgcGF0aCA9IHVyaW9iai5wYXRoLnN1YnN0cmluZygwLA0KCQkJCQkJCXVyaW9iai5wYXRoLmxhc3RJbmRleE9mKCIvIikgKyAxKSArIHJlbG9iai5wYXRoOw0KDQoJCQkJCQl2YXIgc2VncyA9IHBhdGguc3BsaXQoIi8iKTsNCgkJCQkJCWZvcih2YXIgaiA9IDA7IGogPCBzZWdzLmxlbmd0aDsgaisrKXsNCgkJCQkJCQlpZihzZWdzW2pdID09ICIuIil7DQoJCQkJCQkJCS8vIGZsYXR0ZW4gIi4vIiByZWZlcmVuY2VzDQoJCQkJCQkJCWlmKGogPT0gc2Vncy5sZW5ndGggLSAxKXsNCgkJCQkJCQkJCXNlZ3Nbal0gPSAiIjsNCgkJCQkJCQkJfWVsc2V7DQoJCQkJCQkJCQlzZWdzLnNwbGljZShqLCAxKTsNCgkJCQkJCQkJCWotLTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX1lbHNlIGlmKGogPiAwICYmICEoaiA9PSAxICYmIHNlZ3NbMF0gPT0gIiIpICYmDQoJCQkJCQkJCXNlZ3Nbal0gPT0gIi4uIiAmJiBzZWdzW2otMV0gIT0gIi4uIil7DQoJCQkJCQkJCS8vIGZsYXR0ZW4gIi4uLyIgcmVmZXJlbmNlcw0KCQkJCQkJCQlpZihqID09IChzZWdzLmxlbmd0aCAtIDEpKXsNCgkJCQkJCQkJCXNlZ3Muc3BsaWNlKGosIDEpOw0KCQkJCQkJCQkJc2Vnc1tqIC0gMV0gPSAiIjsNCgkJCQkJCQkJfWVsc2V7DQoJCQkJCQkJCQlzZWdzLnNwbGljZShqIC0gMSwgMik7DQoJCQkJCQkJCQlqIC09IDI7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQlyZWxvYmoucGF0aCA9IHNlZ3Muam9pbigiLyIpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQl1cmkgPSBbXTsNCgkJCWlmKHJlbG9iai5zY2hlbWUpeyANCgkJCQl1cmkucHVzaChyZWxvYmouc2NoZW1lLCAiOiIpOw0KCQkJfQ0KCQkJaWYocmVsb2JqLmF1dGhvcml0eSl7DQoJCQkJdXJpLnB1c2goIi8vIiwgcmVsb2JqLmF1dGhvcml0eSk7DQoJCQl9DQoJCQl1cmkucHVzaChyZWxvYmoucGF0aCk7DQoJCQlpZihyZWxvYmoucXVlcnkpew0KCQkJCXVyaS5wdXNoKCI/IiwgcmVsb2JqLnF1ZXJ5KTsNCgkJCX0NCgkJCWlmKHJlbG9iai5mcmFnbWVudCl7DQoJCQkJdXJpLnB1c2goIiMiLCByZWxvYmouZnJhZ21lbnQpOw0KCQkJfQ0KCQl9DQoNCgkJdGhpcy51cmkgPSB1cmkuam9pbigiIik7DQoNCgkJLy8gYnJlYWsgdGhlIHVyaSBpbnRvIGl0cyBtYWluIGNvbXBvbmVudHMNCgkJdmFyIHIgPSB0aGlzLnVyaS5tYXRjaChvcmUpOw0KDQoJCXRoaXMuc2NoZW1lID0gclsyXSB8fCAoclsxXSA/ICIiIDogbik7DQoJCXRoaXMuYXV0aG9yaXR5ID0gcls0XSB8fCAoclszXSA/ICIiIDogbik7DQoJCXRoaXMucGF0aCA9IHJbNV07IC8vIGNhbiBuZXZlciBiZSB1bmRlZmluZWQNCgkJdGhpcy5xdWVyeSA9IHJbN10gfHwgKHJbNl0gPyAiIiA6IG4pOw0KCQl0aGlzLmZyYWdtZW50ICA9IHJbOV0gfHwgKHJbOF0gPyAiIiA6IG4pOw0KDQoJCWlmKHRoaXMuYXV0aG9yaXR5ICE9IG4pew0KCQkJLy8gc2VydmVyIGJhc2VkIG5hbWluZyBhdXRob3JpdHkNCgkJCXIgPSB0aGlzLmF1dGhvcml0eS5tYXRjaChpcmUpOw0KDQoJCQl0aGlzLnVzZXIgPSByWzNdIHx8IG47DQoJCQl0aGlzLnBhc3N3b3JkID0gcls0XSB8fCBuOw0KCQkJdGhpcy5ob3N0ID0gcls2XSB8fCByWzddOyAvLyBpcHY2IHx8IGlwdjQNCgkJCXRoaXMucG9ydCA9IHJbOV0gfHwgbjsNCgkJfQ0KCX0NCg0KCWRvam8uX1VybC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpeyByZXR1cm4gdGhpcy51cmk7IH07DQoNCglkb2pvLm1vZHVsZVVybCA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9tb2R1bGUsIC8qZG9qby5fVXJsfHxTdHJpbmcqL3VybCl7DQoJCS8vCXN1bW1hcnk6IA0KCQkvLwkJUmV0dXJucyBhIGBkb2pvLl9VcmxgIG9iamVjdCByZWxhdGl2ZSB0byBhIG1vZHVsZS4NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgcG5nUGF0aCA9IGRvam8ubW9kdWxlVXJsKCJhY21lIiwiaW1hZ2VzL3NtYWxsLnBuZyIpOw0KCQkvLwl8CWNvbnNvbGUuZGlyKHBuZ1BhdGgpOyAvLyBsaXN0IHRoZSBvYmplY3QgcHJvcGVydGllcw0KCQkvLwl8CS8vIGNyZWF0ZSBhbiBpbWFnZSBhbmQgc2V0IGl0J3Mgc291cmNlIHRvIHBuZ1BhdGgncyB2YWx1ZToNCgkJLy8JfAl2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7DQoJCS8vIAl8CS8vIE5PVEU6IHdlIGFzc2lnbiB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1cmwgb2JqZWN0DQoJCS8vCXwJaW1nLnNyYyA9IHBuZ1BhdGgudG9TdHJpbmcoKTsgDQoJCS8vCXwJLy8gYWRkIG91ciBpbWFnZSB0byB0aGUgZG9jdW1lbnQNCgkJLy8JfAlkb2pvLmJvZHkoKS5hcHBlbmRDaGlsZChpbWcpOw0KCQkvLwlleGFtcGxlOiANCgkJLy8JCXlvdSBtYXkgZGUtcmVmZXJlbmNlIGFzIGZhciBhcyB5b3UgbGlrZSBkb3duIHRoZSBwYWNrYWdlDQoJCS8vCQloaWVyYXJjaHkuICBUaGlzIGlzIHNvbWV0aW1lcyBoYW5keSB0byBhdm9pZCBsZW5naHR5IHJlbGF0aXZlDQoJCS8vCQl1cmxzIG9yIGZvciBidWlsZGluZyBwb3J0YWJsZSBzdWItcGFja2FnZXMuIEluIHRoaXMgZXhhbXBsZSwNCgkJLy8JCXRoZSBgYWNtZS53aWRnZXRgIGFuZCBgYWNtZS51dGlsYCBkaXJlY3RvcmllcyBtYXkgYmUgbG9jYXRlZA0KCQkvLwkJdW5kZXIgZGlmZmVyZW50IHJvb3RzIChzZWUgYGRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoYCkgYnV0IHRoZQ0KCQkvLwkJdGhlIG1vZHVsZXMgd2hpY2ggcmVmZXJlbmNlIHRoZW0gY2FuIGJlIHVuYXdhcmUgb2YgdGhlaXINCgkJLy8JCXJlbGF0aXZlIGxvY2F0aW9ucyBvbiB0aGUgZmlsZXN5c3RlbToNCgkJLy8JfAkvLyBzb21ld2hlcmUgaW4gYSBjb25maWd1cmF0aW9uIGJsb2NrDQoJCS8vCXwJZG9qby5yZWdpc3Rlck1vZHVsZVBhdGgoImFjbWUud2lkZ2V0IiwgIi4uLy4uL2FjbWUvd2lkZ2V0Iik7DQoJCS8vCXwJZG9qby5yZWdpc3Rlck1vZHVsZVBhdGgoImFjbWUudXRpbCIsICIuLi8uLi91dGlsIik7DQoJCS8vCXwJDQoJCS8vCXwJLy8gLi4uDQoJCS8vCXwJDQoJCS8vCXwJLy8gY29kZSBpbiBhIG1vZHVsZSB1c2luZyBhY21lIHJlc291cmNlcw0KCQkvLwl8CXZhciB0bXBsdFBhdGggPSBkb2pvLm1vZHVsZVVybCgiYWNtZS53aWRnZXQiLCJ0ZW1wbGF0ZXMvdGVtcGxhdGUuaHRtbCIpOw0KCQkvLwl8CXZhciBkYXRhUGF0aCA9IGRvam8ubW9kdWxlVXJsKCJhY21lLnV0aWwiLCJyZXNvdXJjZXMvZGF0YS5qc29uIik7DQoNCgkJdmFyIGxvYyA9IGQuX2dldE1vZHVsZVN5bWJvbHMobW9kdWxlKS5qb2luKCcvJyk7DQoJCWlmKCFsb2MpeyByZXR1cm4gbnVsbDsgfQ0KCQlpZihsb2MubGFzdEluZGV4T2YoIi8iKSAhPSBsb2MubGVuZ3RoLTEpew0KCQkJbG9jICs9ICIvIjsNCgkJfQ0KCQkNCgkJLy9JZiB0aGUgcGF0aCBpcyBhbiBhYnNvbHV0ZSBwYXRoIChzdGFydHMgd2l0aCBhIC8gb3IgaXMgb24gYW5vdGhlcg0KCQkvL2RvbWFpbi94ZG9tYWluKSB0aGVuIGRvbid0IGFkZCB0aGUgYmFzZVVybC4NCgkJdmFyIGNvbG9uSW5kZXggPSBsb2MuaW5kZXhPZigiOiIpOw0KCQlpZihsb2MuY2hhckF0KDApICE9ICIvIiAmJiAoY29sb25JbmRleCA9PSAtMSB8fCBjb2xvbkluZGV4ID4gbG9jLmluZGV4T2YoIi8iKSkpew0KCQkJbG9jID0gZC5iYXNlVXJsICsgbG9jOw0KCQl9DQoNCgkJcmV0dXJuIG5ldyBkLl9VcmwobG9jLCB1cmwpOyAvLyBkb2pvLl9VcmwNCgl9DQp9KSgpOw0KDQovKj09PT09DQpkb2pvLmlzQnJvd3NlciA9IHsNCgkvLwlleGFtcGxlOg0KCS8vCXwJaWYoZG9qby5pc0Jyb3dzZXIpeyAuLi4gfQ0KfTsNCg0KZG9qby5pc0ZGID0gew0KCS8vCWV4YW1wbGU6DQoJLy8JfAlpZihkb2pvLmlzRkYgPiAxKXsgLi4uIH0NCn07DQoNCmRvam8uaXNJRSA9IHsNCgkvLyBleGFtcGxlOg0KCS8vCXwJaWYoZG9qby5pc0lFID4gNil7DQoJLy8JfAkJLy8gd2UgYXJlIElFNw0KCS8vIAl8CX0NCn07DQoNCmRvam8uaXNTYWZhcmkgPSB7DQoJLy8JZXhhbXBsZToNCgkvLwl8CWlmKGRvam8uaXNTYWZhcmkpeyAuLi4gfQ0KCS8vCWV4YW1wbGU6IA0KCS8vCQlEZXRlY3QgaVBob25lOg0KCS8vCXwJaWYoZG9qby5pc1NhZmFyaSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoImlQaG9uZSIpICE9IC0xKXsgDQoJLy8JfAkJLy8gd2UgYXJlIGlQaG9uZS4gTm90ZSwgaVBvZCB0b3VjaCByZXBvcnRzICJpUG9kIiBhYm92ZSBhbmQgZmFpbHMgdGhpcyB0ZXN0Lg0KCS8vCXwJfQ0KfTsNCg0KZG9qbyA9IHsNCgkvLyBpc0Jyb3dzZXI6IEJvb2xlYW4NCgkvLwkJVHJ1ZSBpZiB0aGUgY2xpZW50IGlzIGEgd2ViLWJyb3dzZXINCglpc0Jyb3dzZXI6IHRydWUsDQoJLy8JaXNGRjogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIEZpcmVGb3guIHVuZGVmaW5lZCBvdGhlcndpc2UuIENvcnJlc3BvbmRzIHRvDQoJLy8JCW1ham9yIGRldGVjdGVkIEZpcmVGb3ggdmVyc2lvbiAoMS41LCAyLCAzLCBldGMuKQ0KCWlzRkY6IDIsDQoJLy8JaXNJRTogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIE1TSUUoUEMpLiB1bmRlZmluZWQgb3RoZXJ3aXNlLiBDb3JyZXNwb25kcyB0bw0KCS8vCQltYWpvciBkZXRlY3RlZCBJRSB2ZXJzaW9uICg2LCA3LCA4LCBldGMuKQ0KCWlzSUU6IDYsDQoJLy8JaXNLaHRtbDogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIGEgS0hUTUwgYnJvd3Nlci4gdW5kZWZpbmVkIG90aGVyd2lzZS4gQ29ycmVzcG9uZHMgdG8gbWFqb3INCgkvLwkJZGV0ZWN0ZWQgdmVyc2lvbi4NCglpc0todG1sOiAwLA0KCS8vCWlzV2ViS2l0OiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgYSBXZWJLaXQtZGVyaXZlZCBicm93c2VyIChLb25xdWVyb3IsDQoJLy8JCVNhZmFyaSwgQ2hyb21lLCBldGMuKS4gdW5kZWZpbmVkIG90aGVyd2lzZS4NCglpc1dlYktpdDogMCwNCgkvLwlpc01vemlsbGE6IE51bWJlciB8IHVuZGVmaW5lZA0KCS8vCQlWZXJzaW9uIGFzIGEgTnVtYmVyIGlmIGNsaWVudCBpcyBhIE1vemlsbGEtYmFzZWQgYnJvd3NlciAoRmlyZWZveCwNCgkvLwkJU2VhTW9ua2V5KS4gdW5kZWZpbmVkIG90aGVyd2lzZS4gQ29ycmVzcG9uZHMgdG8gbWFqb3IgZGV0ZWN0ZWQgdmVyc2lvbi4NCglpc01vemlsbGE6IDAsDQoJLy8JaXNPcGVyYTogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIE9wZXJhLiB1bmRlZmluZWQgb3RoZXJ3aXNlLiBDb3JyZXNwb25kcyB0bw0KCS8vCQltYWpvciBkZXRlY3RlZCB2ZXJzaW9uLg0KCWlzT3BlcmE6IDAsDQoJLy8JaXNTYWZhcmk6IE51bWJlciB8IHVuZGVmaW5lZA0KCS8vCQlWZXJzaW9uIGFzIGEgTnVtYmVyIGlmIGNsaWVudCBpcyBTYWZhcmkgb3IgaVBob25lLiB1bmRlZmluZWQgb3RoZXJ3aXNlLg0KCWlzU2FmYXJpOiAwLA0KCS8vCWlzQ2hyb21lOiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgQ2hyb21lIGJyb3dzZXIuIHVuZGVmaW5lZCBvdGhlcndpc2UuDQoJaXNDaHJvbWU6IDANCgkvLwlpc01hYzogQm9vbGVhbg0KCS8vCQlUcnVlIGlmIHRoZSBjbGllbnQgcnVucyBvbiBNYWMNCn0NCj09PT09Ki8NCg0KaWYodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyl7DQoJZG9qby5pc0Jyb3dzZXIgPSB0cnVlOw0KCWRvam8uX25hbWUgPSAiYnJvd3NlciI7DQoNCg0KCS8vIGF0dGVtcHQgdG8gZmlndXJlIG91dCB0aGUgcGF0aCB0byBkb2pvIGlmIGl0IGlzbid0IHNldCBpbiB0aGUgY29uZmlnDQoJKGZ1bmN0aW9uKCl7DQoJCXZhciBkID0gZG9qbzsNCg0KCQkvLyB0aGlzIGlzIGEgc2NvcGUgcHJvdGVjdGlvbiBjbG9zdXJlLiBXZSBzZXQgYnJvd3NlciB2ZXJzaW9ucyBhbmQgZ3JhYg0KCQkvLyB0aGUgVVJMIHdlIHdlcmUgbG9hZGVkIGZyb20gaGVyZS4NCg0KCQkvLyBncmFiIHRoZSBub2RlIHdlIHdlcmUgbG9hZGVkIGZyb20NCgkJaWYoZG9jdW1lbnQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUpew0KCQkJdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iik7DQoJCQl2YXIgcmVQa2cgPSAvZG9qbyhcLnhkKT9cLmpzKFxXfCQpL2k7DQoJCQlmb3IodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKyl7DQoJCQkJdmFyIHNyYyA9IHNjcmlwdHNbaV0uZ2V0QXR0cmlidXRlKCJzcmMiKTsNCgkJCQlpZighc3JjKXsgY29udGludWU7IH0NCgkJCQl2YXIgbSA9IHNyYy5tYXRjaChyZVBrZyk7DQoJCQkJaWYobSl7DQoJCQkJCS8vIGZpbmQgb3V0IHdoZXJlIHdlIGNhbWUgZnJvbQ0KCQkJCQlpZighZC5jb25maWcuYmFzZVVybCl7DQoJCQkJCQlkLmNvbmZpZy5iYXNlVXJsID0gc3JjLnN1YnN0cmluZygwLCBtLmluZGV4KTsNCgkJCQkJfQ0KCQkJCQkvLyBhbmQgZmluZCBvdXQgaWYgd2UgbmVlZCB0byBtb2RpZnkgb3VyIGJlaGF2aW9yDQoJCQkJCXZhciBjZmcgPSBzY3JpcHRzW2ldLmdldEF0dHJpYnV0ZSgiZGpDb25maWciKTsNCgkJCQkJaWYoY2ZnKXsNCgkJCQkJCXZhciBjZmdvID0gZXZhbCgiKHsgIitjZmcrIiB9KSIpOw0KCQkJCQkJZm9yKHZhciB4IGluIGNmZ28pew0KCQkJCQkJCWRvam8uY29uZmlnW3hdID0gY2Znb1t4XTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlicmVhazsgLy8gImZpcnN0IERvam8gd2lucyINCgkJCQl9DQoJCQl9DQoJCX0NCgkJZC5iYXNlVXJsID0gZC5jb25maWcuYmFzZVVybDsNCg0KCQkvLyBmaWxsIGluIHRoZSByZW5kZXJpbmcgc3VwcG9ydCBpbmZvcm1hdGlvbiBpbiBkb2pvLnJlbmRlci4qDQoJCXZhciBuID0gbmF2aWdhdG9yOw0KCQl2YXIgZHVhID0gbi51c2VyQWdlbnQsDQoJCQlkYXYgPSBuLmFwcFZlcnNpb24sDQoJCQl0diA9IHBhcnNlRmxvYXQoZGF2KTsNCg0KCQlpZihkdWEuaW5kZXhPZigiT3BlcmEiKSA+PSAwKXsgZC5pc09wZXJhID0gdHY7IH0NCgkJaWYoZHVhLmluZGV4T2YoIkFkb2JlQUlSIikgPj0gMCl7IGQuaXNBSVIgPSAxOyB9DQoJCWQuaXNLaHRtbCA9IChkYXYuaW5kZXhPZigiS29ucXVlcm9yIikgPj0gMCkgPyB0diA6IDA7DQoJCWQuaXNXZWJLaXQgPSBwYXJzZUZsb2F0KGR1YS5zcGxpdCgiV2ViS2l0LyIpWzFdKSB8fCB1bmRlZmluZWQ7DQoJCWQuaXNDaHJvbWUgPSBwYXJzZUZsb2F0KGR1YS5zcGxpdCgiQ2hyb21lLyIpWzFdKSB8fCB1bmRlZmluZWQ7DQoJCWQuaXNNYWMgPSBkYXYuaW5kZXhPZigiTWFjaW50b3NoIikgPj0gMDsNCg0KCQkvLyBzYWZhcmkgZGV0ZWN0aW9uIGRlcml2ZWQgZnJvbToNCgkJLy8JCWh0dHA6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2ludGVybmV0L3NhZmFyaS9mYXEuaHRtbCNhbmNob3IyDQoJCS8vCQlodHRwOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9pbnRlcm5ldC9zYWZhcmkvdWFtYXRyaXguaHRtbA0KCQl2YXIgaW5kZXggPSBNYXRoLm1heChkYXYuaW5kZXhPZigiV2ViS2l0IiksIGRhdi5pbmRleE9mKCJTYWZhcmkiKSwgMCk7DQoJCWlmKGluZGV4ICYmICFkb2pvLmlzQ2hyb21lKXsNCgkJCS8vIHRyeSB0byBncmFiIHRoZSBleHBsaWNpdCBTYWZhcmkgdmVyc2lvbiBmaXJzdC4gSWYgd2UgZG9uJ3QgZ2V0DQoJCQkvLyBvbmUsIGxvb2sgZm9yIGxlc3MgdGhhbiA0MTkuMyBhcyB0aGUgaW5kaWNhdGlvbiB0aGF0IHdlJ3JlIG9uIHNvbWV0aGluZw0KCQkJLy8gIlNhZmFyaSAyLWlzaCIuDQoJCQlkLmlzU2FmYXJpID0gcGFyc2VGbG9hdChkYXYuc3BsaXQoIlZlcnNpb24vIilbMV0pOw0KCQkJaWYoIWQuaXNTYWZhcmkgfHwgcGFyc2VGbG9hdChkYXYuc3Vic3RyKGluZGV4ICsgNykpIDw9IDQxOS4zKXsNCgkJCQlkLmlzU2FmYXJpID0gMjsNCgkJCX0NCgkJfQ0KDQoJCQkJaWYoZHVhLmluZGV4T2YoIkdlY2tvIikgPj0gMCAmJiAhZC5pc0todG1sICYmICFkLmlzV2ViS2l0KXsgZC5pc01vemlsbGEgPSBkLmlzTW96ID0gdHY7IH0NCgkJaWYoZC5pc01veil7DQoJCQkvL1dlIHJlYWxseSBuZWVkIHRvIGdldCBhd2F5IGZyb20gdGhpcy4gQ29uc2lkZXIgYSBzYW5lIGlzR2Vja28gYXBwcm9hY2ggZm9yIHRoZSBmdXR1cmUuDQoJCQlkLmlzRkYgPSBwYXJzZUZsb2F0KGR1YS5zcGxpdCgiRmlyZWZveC8iKVsxXSB8fCBkdWEuc3BsaXQoIk1pbmVmaWVsZC8iKVsxXSkgfHwgdW5kZWZpbmVkOw0KCQl9DQoJCWlmKGRvY3VtZW50LmFsbCAmJiAhZC5pc09wZXJhKXsNCgkJCWQuaXNJRSA9IHBhcnNlRmxvYXQoZGF2LnNwbGl0KCJNU0lFICIpWzFdKSB8fCB1bmRlZmluZWQ7DQoJCQkvL0luIGNhc2VzIHdoZXJlIHRoZSBwYWdlIGhhcyBhbiBIVFRQIGhlYWRlciBvciBNRVRBIHRhZyB3aXRoDQoJCQkvL1gtVUEtQ29tcGF0aWJsZSwgdGhlbiBpdCBpcyBpbiBlbXVsYXRpb24gbW9kZS4NCgkJCS8vTWFrZSBzdXJlIGlzSUUgcmVmbGVjdHMgdGhlIGRlc2lyZWQgdmVyc2lvbi4NCgkJCS8vZG9jdW1lbnQuZG9jdW1lbnRNb2RlIG9mIDUgbWVhbnMgcXVpcmtzIG1vZGUuDQoJCQkvL09ubHkgc3dpdGNoIHRoZSB2YWx1ZSBpZiBkb2N1bWVudE1vZGUncyBtYWpvciB2ZXJzaW9uDQoJCQkvL2lzIGRpZmZlcmVudCBmcm9tIGlzSUUncyBtYWpvciB2ZXJzaW9uLg0KCQkJdmFyIG1vZGUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7DQoJCQlpZihtb2RlICYmIG1vZGUgIT0gNSAmJiBNYXRoLmZsb29yKGQuaXNJRSkgIT0gbW9kZSl7DQoJCQkJZC5pc0lFID0gbW9kZTsNCgkJCX0NCgkJfQ0KDQoJCS8vV29ya2Fyb3VuZCB0byBnZXQgbG9jYWwgZmlsZSBsb2FkcyBvZiBkb2pvIHRvIHdvcmsgb24gSUUgNw0KCQkvL2J5IGZvcmNpbmcgdG8gbm90IHVzZSBuYXRpdmUgeGhyLg0KCQlpZihkb2pvLmlzSUUgJiYgd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAiZmlsZToiKXsNCgkJCWRvam8uY29uZmlnLmllRm9yY2VBY3RpdmVYWGhyPXRydWU7DQoJCX0NCgkJDQoJCWQuaXNRdWlya3MgPSBkb2N1bWVudC5jb21wYXRNb2RlID09ICJCYWNrQ29tcGF0IjsNCg0KCQkvLyBUT0RPOiBpcyB0aGUgSFRNTCBMQU5HIGF0dHJpYnV0ZSByZWxldmFudD8NCgkJZC5sb2NhbGUgPSBkb2pvLmNvbmZpZy5sb2NhbGUgfHwgKGQuaXNJRSA/IG4udXNlckxhbmd1YWdlIDogbi5sYW5ndWFnZSkudG9Mb3dlckNhc2UoKTsNCg0KCQkvLyBUaGVzZSBhcmUgaW4gb3JkZXIgb2YgZGVjcmVhc2luZyBsaWtlbGlob29kOyB0aGlzIHdpbGwgY2hhbmdlIGluIHRpbWUuDQoJCQkJZC5fWE1MSFRUUF9QUk9HSURTID0gWydNc3htbDIuWE1MSFRUUCcsICdNaWNyb3NvZnQuWE1MSFRUUCcsICdNc3htbDIuWE1MSFRUUC40LjAnXTsNCgkJDQoJCWQuX3hock9iaiA9IGZ1bmN0aW9uKCl7DQoJCQkvLyBzdW1tYXJ5OiANCgkJCS8vCQlkb2VzIHRoZSB3b3JrIG9mIHBvcnRhYmx5IGdlbmVyYXRpbmcgYSBuZXcgWE1MSFRUUFJlcXVlc3Qgb2JqZWN0Lg0KCQkJdmFyIGh0dHAsIGxhc3RfZTsNCgkJCQkJCWlmKCFkb2pvLmlzSUUgfHwgIWRvam8uY29uZmlnLmllRm9yY2VBY3RpdmVYWGhyKXsNCgkJCQkJCQl0cnl7IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgfWNhdGNoKGUpe30NCgkJCQkJCX0NCgkJCWlmKCFodHRwKXsNCgkJCQlmb3IodmFyIGk9MDsgaTwzOyArK2kpew0KCQkJCQl2YXIgcHJvZ2lkID0gZC5fWE1MSFRUUF9QUk9HSURTW2ldOw0KCQkJCQl0cnl7DQoJCQkJCQlodHRwID0gbmV3IEFjdGl2ZVhPYmplY3QocHJvZ2lkKTsNCgkJCQkJfWNhdGNoKGUpew0KCQkJCQkJbGFzdF9lID0gZTsNCgkJCQkJfQ0KDQoJCQkJCWlmKGh0dHApew0KCQkJCQkJZC5fWE1MSFRUUF9QUk9HSURTID0gW3Byb2dpZF07ICAvLyBzbyBmYXN0ZXIgbmV4dCB0aW1lDQoJCQkJCQlicmVhazsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkJaWYoIWh0dHApew0KCQkJCXRocm93IG5ldyBFcnJvcigiWE1MSFRUUCBub3QgYXZhaWxhYmxlOiAiK2xhc3RfZSk7DQoJCQl9DQoNCgkJCXJldHVybiBodHRwOyAvLyBYTUxIVFRQUmVxdWVzdCBpbnN0YW5jZQ0KCQl9DQoNCgkJZC5faXNEb2N1bWVudE9rID0gZnVuY3Rpb24oaHR0cCl7DQoJCQl2YXIgc3RhdCA9IGh0dHAuc3RhdHVzIHx8IDAsDQoJCQkJbHAgPSBsb2NhdGlvbi5wcm90b2NvbDsNCgkJCXJldHVybiAoc3RhdCA+PSAyMDAgJiYgc3RhdCA8IDMwMCkgfHwgCS8vIEJvb2xlYW4NCgkJCQlzdGF0ID09IDMwNCB8fCAJCQkJCQkvLyBhbGxvdyBhbnkgMlhYIHJlc3BvbnNlIGNvZGUNCgkJCQlzdGF0ID09IDEyMjMgfHwgCQkJCQkJLy8gZ2V0IGl0IG91dCBvZiB0aGUgY2FjaGUNCgkJCQkvLyBJbnRlcm5ldCBFeHBsb3JlciBtYW5nbGVkIHRoZSBzdGF0dXMgY29kZSBPUiB3ZSdyZSBUaXRhbml1bS9icm93c2VyIGNocm9tZS9jaHJvbWUgZXh0ZW5zaW9uIHJlcXVlc3RpbmcgYSBsb2NhbCBmaWxlDQoJCQkJKCFzdGF0ICYmIChscCA9PSAiZmlsZToiIHx8IGxwID09ICJjaHJvbWU6IiB8fCBscCA9PSAiY2hyb21lLWV4dGVuc2lvbjoiIHx8IGxwID09ICJhcHA6IikgKTsNCgkJfQ0KDQoJCS8vU2VlIGlmIGJhc2UgdGFnIGlzIGluIHVzZS4NCgkJLy9UaGlzIGlzIHRvIGZpeCBodHRwOi8vdHJhYy5kb2pvdG9vbGtpdC5vcmcvdGlja2V0LzM5NzMsDQoJCS8vYnV0IHJlYWxseSwgd2UgbmVlZCB0byBmaW5kIG91dCBob3cgdG8gZ2V0IHJpZCBvZiB0aGUgZG9qby5fVXJsIHJlZmVyZW5jZQ0KCQkvL2JlbG93IGFuZCBzdGlsbCBoYXZlIERPSCB3b3JrIHdpdGggdGhlIGRvam8uaTE4biB0ZXN0IGZvbGxvd2luZyBzb21lIG90aGVyDQoJCS8vdGVzdCB0aGF0IHVzZXMgdGhlIHRlc3QgZnJhbWUgdG8gbG9hZCBhIGRvY3VtZW50ICh0cmFjICMyNzU3KS4NCgkJLy9PcGVyYSBzdGlsbCBoYXMgcHJvYmxlbXMsIGJ1dCBwZXJoYXBzIGEgbGFyZ2VyIGlzc3VlIG9mIGJhc2UgdGFnIHN1cHBvcnQNCgkJLy93aXRoIFhIUiByZXF1ZXN0cyAoaGFzQmFzZSBpcyB0cnVlLCBidXQgdGhlIHJlcXVlc3QgaXMgc3RpbGwgbWFkZSB0byBkb2N1bWVudA0KCQkvL3BhdGgsIG5vdCBiYXNlIHBhdGgpLg0KCQl2YXIgb3dsb2MgPSB3aW5kb3cubG9jYXRpb24rIiI7DQoJCXZhciBiYXNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJhc2UiKTsNCgkJdmFyIGhhc0Jhc2UgPSAoYmFzZSAmJiBiYXNlLmxlbmd0aCA+IDApOw0KDQoJCWQuX2dldFRleHQgPSBmdW5jdGlvbigvKlVSSSovIHVyaSwgLypCb29sZWFuKi8gZmFpbF9vayl7DQoJCQkvLyBzdW1tYXJ5OiBSZWFkIHRoZSBjb250ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHVyaSBhbmQgcmV0dXJuIHRob3NlIGNvbnRlbnRzLg0KCQkJLy8gdXJpOg0KCQkJLy8JCUEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgdXJpLiBJZiBhYnNvbHV0ZSwgaXQgc3RpbGwgbXVzdCBiZSBpbg0KCQkJLy8JCXRoZSBzYW1lICJkb21haW4iIGFzIHdlIGFyZS4NCgkJCS8vIGZhaWxfb2s6DQoJCQkvLwkJRGVmYXVsdCBmYWxzZS4gSWYgZmFpbF9vayBhbmQgbG9hZGluZyBmYWlscywgcmV0dXJuIG51bGwNCgkJCS8vCQlpbnN0ZWFkIG9mIHRocm93aW5nLg0KCQkJLy8gcmV0dXJuczogVGhlIHJlc3BvbnNlIHRleHQuIG51bGwgaXMgcmV0dXJuZWQgd2hlbiB0aGVyZSBpcyBhDQoJCQkvLwkJZmFpbHVyZSBhbmQgZmFpbHVyZSBpcyBva2F5IChhbiBleGNlcHRpb24gb3RoZXJ3aXNlKQ0KDQoJCQkvLyBOT1RFOiBtdXN0IGJlIGRlY2xhcmVkIGJlZm9yZSBzY29wZSBzd2l0Y2hlcyBpZS4gdGhpcy5feGhyT2JqKCkNCgkJCXZhciBodHRwID0gZC5feGhyT2JqKCk7DQoNCgkJCWlmKCFoYXNCYXNlICYmIGRvam8uX1VybCl7DQoJCQkJdXJpID0gKG5ldyBkb2pvLl9Vcmwob3dsb2MsIHVyaSkpLnRvU3RyaW5nKCk7DQoJCQl9DQoNCgkJCWlmKGQuY29uZmlnLmNhY2hlQnVzdCl7DQoJCQkJLy9NYWtlIHN1cmUgd2UgaGF2ZSBhIHN0cmluZyBiZWZvcmUgc3RyaW5nIG1ldGhvZHMgYXJlIHVzZWQgb24gdXJpDQoJCQkJdXJpICs9ICIiOw0KCQkJCXVyaSArPSAodXJpLmluZGV4T2YoIj8iKSA9PSAtMSA/ICI/IiA6ICImIikgKyBTdHJpbmcoZC5jb25maWcuY2FjaGVCdXN0KS5yZXBsYWNlKC9cVysvZywiIik7DQoJCQl9DQoNCgkJCWh0dHAub3BlbignR0VUJywgdXJpLCBmYWxzZSk7DQoJCQl0cnl7DQoJCQkJaHR0cC5zZW5kKG51bGwpOw0KCQkJCWlmKCFkLl9pc0RvY3VtZW50T2soaHR0cCkpew0KCQkJCQl2YXIgZXJyID0gRXJyb3IoIlVuYWJsZSB0byBsb2FkICIrdXJpKyIgc3RhdHVzOiIrIGh0dHAuc3RhdHVzKTsNCgkJCQkJZXJyLnN0YXR1cyA9IGh0dHAuc3RhdHVzOw0KCQkJCQllcnIucmVzcG9uc2VUZXh0ID0gaHR0cC5yZXNwb25zZVRleHQ7DQoJCQkJCXRocm93IGVycjsNCgkJCQl9DQoJCQl9Y2F0Y2goZSl7DQoJCQkJaWYoZmFpbF9vayl7IHJldHVybiBudWxsOyB9IC8vIG51bGwNCgkJCQkvLyByZXRocm93IHRoZSBleGNlcHRpb24NCgkJCQl0aHJvdyBlOw0KCQkJfQ0KCQkJcmV0dXJuIGh0dHAucmVzcG9uc2VUZXh0OyAvLyBTdHJpbmcNCgkJfQ0KCQkNCg0KCQl2YXIgX3cgPSB3aW5kb3c7DQoJCXZhciBfaGFuZGxlTm9kZUV2ZW50ID0gZnVuY3Rpb24oLypTdHJpbmcqL2V2dE5hbWUsIC8qRnVuY3Rpb24qL2ZwKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJbm9uLWRlc3RydWN0aXZlbHkgYWRkcyB0aGUgc3BlY2lmaWVkIGZ1bmN0aW9uIHRvIHRoZSBub2RlJ3MNCgkJCS8vCQlldnROYW1lIGhhbmRsZXIuDQoJCQkvLyBldnROYW1lOiBzaG91bGQgYmUgaW4gdGhlIGZvcm0gIm9uY2xpY2siIGZvciAib25jbGljayIgaGFuZGxlcnMuDQoJCQkvLyBNYWtlIHN1cmUgeW91IHBhc3MgaW4gdGhlICJvbiIgcGFydC4NCgkJCXZhciBfYSA9IF93LmF0dGFjaEV2ZW50IHx8IF93LmFkZEV2ZW50TGlzdGVuZXI7DQoJCQlldnROYW1lID0gX3cuYXR0YWNoRXZlbnQgPyBldnROYW1lIDogZXZ0TmFtZS5zdWJzdHJpbmcoMik7DQoJCQlfYShldnROYW1lLCBmdW5jdGlvbigpew0KCQkJCWZwLmFwcGx5KF93LCBhcmd1bWVudHMpOw0KCQkJfSwgZmFsc2UpOw0KCQl9Ow0KDQoNCgkJZC5fd2luZG93VW5sb2FkZXJzID0gW107DQoJCQ0KCQlkLndpbmRvd1VubG9hZGVkID0gZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJc2lnbmFsIGZpcmVkIGJ5IGltcGVuZGluZyB3aW5kb3cgZGVzdHJ1Y3Rpb24uIFlvdSBtYXkgdXNlDQoJCQkvLwkJZG9qby5hZGRPbldpbmRvd1VubG9hZCgpIHRvIHJlZ2lzdGVyIGEgbGlzdGVuZXIgZm9yIHRoaXMNCgkJCS8vCQlldmVudC4gTk9URTogaWYgeW91IHdpc2ggdG8gZG9qby5jb25uZWN0KCkgdG8gdGhpcyBtZXRob2QNCgkJCS8vCQl0byBwZXJmb3JtIHBhZ2UvYXBwbGljYXRpb24gY2xlYW51cCwgYmUgYXdhcmUgdGhhdCB0aGlzDQoJCQkvLwkJZXZlbnQgV0lMTCBOT1QgZmlyZSBpZiBubyBoYW5kbGVyIGhhcyBiZWVuIHJlZ2lzdGVyZWQgd2l0aA0KCQkJLy8JCWRvam8uYWRkT25XaW5kb3dVbmxvYWQuIFRoaXMgYmVoYXZpb3Igc3RhcnRlZCBpbiBEb2pvIDEuMy4NCgkJCS8vCQlQcmV2aW91cyB2ZXJzaW9ucyBhbHdheXMgdHJpZ2dlcmVkIGRvam8ud2luZG93VW5sb2FkZWQuIFNlZQ0KCQkJLy8JCWRvam8uYWRkT25XaW5kb3dVbmxvYWQgZm9yIG1vcmUgaW5mby4NCgkJCXZhciBtbGwgPSBkLl93aW5kb3dVbmxvYWRlcnM7DQoJCQl3aGlsZShtbGwubGVuZ3RoKXsNCgkJCQkobWxsLnBvcCgpKSgpOw0KCQkJfQ0KCQkJZCA9IG51bGw7DQoJCX07DQoNCgkJdmFyIF9vbldpbmRvd1VubG9hZEF0dGFjaGVkID0gMDsNCgkJZC5hZGRPbldpbmRvd1VubG9hZCA9IGZ1bmN0aW9uKC8qT2JqZWN0P3xGdW5jdGlvbj8qL29iaiwgLypTdHJpbmd8RnVuY3Rpb24/Ki9mdW5jdGlvbk5hbWUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlyZWdpc3RlcnMgYSBmdW5jdGlvbiB0byBiZSB0cmlnZ2VyZWQgd2hlbiB3aW5kb3cub251bmxvYWQNCgkJCS8vCQlmaXJlcy4gDQoJCQkvLwlkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGUgZmlyc3QgdGltZSB0aGF0IGFkZE9uV2luZG93VW5sb2FkIGlzIGNhbGxlZCBEb2pvDQoJCQkvLwkJd2lsbCByZWdpc3RlciBhIHBhZ2UgbGlzdGVuZXIgdG8gdHJpZ2dlciB5b3VyIHVubG9hZA0KCQkJLy8JCWhhbmRsZXIgd2l0aC4gTm90ZSB0aGF0IHJlZ2lzdGVyaW5nIHRoZXNlIGhhbmRsZXJzIG1heQ0KCQkJLy8JCWRlc3RvcnkgImZhc3RiYWNrIiBwYWdlIGNhY2hpbmcgaW4gYnJvd3NlcnMgdGhhdCBzdXBwb3J0DQoJCQkvLwkJaXQuIEJlIGNhcmVmdWwgdHJ5aW5nIHRvIG1vZGlmeSB0aGUgRE9NIG9yIGFjY2Vzcw0KCQkJLy8JCUphdmFTY3JpcHQgcHJvcGVydGllcyBkdXJpbmcgdGhpcyBwaGFzZSBvZiBwYWdlIHVubG9hZGluZzoNCgkJCS8vCQl0aGV5IG1heSBub3QgYWx3YXlzIGJlIGF2YWlsYWJsZS4gQ29uc2lkZXINCgkJCS8vCQlkb2pvLmFkZE9uVW5sb2FkKCkgaWYgeW91IG5lZWQgdG8gbW9kaWZ5IHRoZSBET00gb3IgZG8NCgkJCS8vCQloZWF2eSBKYXZhU2NyaXB0IHdvcmsgc2luY2UgaXQgZmlyZXMgYXQgdGhlIGVxaXZhbGVudCBvZg0KCQkJLy8JCXRoZSBwYWdlJ3MgIm9uYmVmb3JldW5sb2FkIiBldmVudC4NCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CWRvam8uYWRkT25XaW5kb3dVbmxvYWQoZnVuY3Rpb25Qb2ludGVyKQ0KCQkJLy8JfAlkb2pvLmFkZE9uV2luZG93VW5sb2FkKG9iamVjdCwgImZ1bmN0aW9uTmFtZSIpOw0KCQkJLy8JfAlkb2pvLmFkZE9uV2luZG93VW5sb2FkKG9iamVjdCwgZnVuY3Rpb24oKXsgLyogLi4uICovfSk7DQoNCgkJCWQuX29udG8oZC5fd2luZG93VW5sb2FkZXJzLCBvYmosIGZ1bmN0aW9uTmFtZSk7DQoJCQlpZighX29uV2luZG93VW5sb2FkQXR0YWNoZWQpew0KCQkJCV9vbldpbmRvd1VubG9hZEF0dGFjaGVkID0gMTsNCgkJCQlfaGFuZGxlTm9kZUV2ZW50KCJvbnVubG9hZCIsIGQud2luZG93VW5sb2FkZWQpOw0KCQkJfQ0KCQl9Ow0KDQoJCXZhciBfb25VbmxvYWRBdHRhY2hlZCA9IDA7DQoJCWQuYWRkT25VbmxvYWQgPSBmdW5jdGlvbigvKk9iamVjdD98RnVuY3Rpb24/Ki9vYmosIC8qU3RyaW5nfEZ1bmN0aW9uPyovZnVuY3Rpb25OYW1lKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJcmVnaXN0ZXJzIGEgZnVuY3Rpb24gdG8gYmUgdHJpZ2dlcmVkIHdoZW4gdGhlIHBhZ2UgdW5sb2Fkcy4NCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoZSBmaXJzdCB0aW1lIHRoYXQgYWRkT25VbmxvYWQgaXMgY2FsbGVkIERvam8gd2lsbA0KCQkJLy8JCXJlZ2lzdGVyIGEgcGFnZSBsaXN0ZW5lciB0byB0cmlnZ2VyIHlvdXIgdW5sb2FkIGhhbmRsZXINCgkJCS8vCQl3aXRoLiANCgkJCS8vDQoJCQkvLwkJSW4gYSBicm93c2VyIGVudmlyb21lbnQsIHRoZSBmdW5jdGlvbnMgd2lsbCBiZSB0cmlnZ2VyZWQNCgkJCS8vCQlkdXJpbmcgdGhlIHdpbmRvdy5vbmJlZm9yZXVubG9hZCBldmVudC4gQmUgY2FyZWZ1bCBvZiBkb2luZw0KCQkJLy8JCXRvbyBtdWNoIHdvcmsgaW4gYW4gdW5sb2FkIGhhbmRsZXIuIG9uYmVmb3JldW5sb2FkIGNhbiBiZQ0KCQkJLy8JCXRyaWdnZXJlZCBpZiBhIGxpbmsgdG8gZG93bmxvYWQgYSBmaWxlIGlzIGNsaWNrZWQsIG9yIGlmDQoJCQkvLwkJdGhlIGxpbmsgaXMgYSBqYXZhc2NyaXB0OiBsaW5rLiBJbiB0aGVzZSBjYXNlcywgdGhlDQoJCQkvLwkJb25iZWZvcmV1bmxvYWQgZXZlbnQgZmlyZXMsIGJ1dCB0aGUgZG9jdW1lbnQgaXMgbm90DQoJCQkvLwkJYWN0dWFsbHkgZGVzdHJveWVkLiBTbyBiZSBjYXJlZnVsIGFib3V0IGRvaW5nIGRlc3RydWN0aXZlDQoJCQkvLwkJb3BlcmF0aW9ucyBpbiBhIGRvam8uYWRkT25VbmxvYWQgY2FsbGJhY2suDQoJCQkvLw0KCQkJLy8JCUZ1cnRoZXIgbm90ZSB0aGF0IGNhbGxpbmcgZG9qby5hZGRPblVubG9hZCB3aWxsIHByZXZlbnQNCgkJCS8vCQlicm93c2VycyBmcm9tIHVzaW5nIGEgImZhc3QgYmFjayIgY2FjaGUgdG8gbWFrZSBwYWdlDQoJCQkvLwkJbG9hZGluZyB2aWEgYmFjayBidXR0b24gaW5zdGFudGFuZW91cy4gDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAlkb2pvLmFkZE9uVW5sb2FkKGZ1bmN0aW9uUG9pbnRlcikNCgkJCS8vCXwJZG9qby5hZGRPblVubG9hZChvYmplY3QsICJmdW5jdGlvbk5hbWUiKQ0KCQkJLy8JfAlkb2pvLmFkZE9uVW5sb2FkKG9iamVjdCwgZnVuY3Rpb24oKXsgLyogLi4uICovfSk7DQoNCgkJCWQuX29udG8oZC5fdW5sb2FkZXJzLCBvYmosIGZ1bmN0aW9uTmFtZSk7DQoJCQlpZighX29uVW5sb2FkQXR0YWNoZWQpew0KCQkJCV9vblVubG9hZEF0dGFjaGVkID0gMTsNCgkJCQlfaGFuZGxlTm9kZUV2ZW50KCJvbmJlZm9yZXVubG9hZCIsIGRvam8udW5sb2FkZWQpOw0KCQkJfQ0KCQl9Ow0KDQoJfSkoKTsNCg0KCS8vU1RBUlQgRE9NQ29udGVudExvYWRlZA0KCWRvam8uX2luaXRGaXJlZCA9IGZhbHNlOw0KCWRvam8uX2xvYWRJbml0ID0gZnVuY3Rpb24oZSl7DQoJCWlmKGRvam8uX3Njcm9sbEludGVydmFsSWQpew0KCQkJY2xlYXJJbnRlcnZhbChkb2pvLl9zY3JvbGxJbnRlcnZhbElkKTsNCgkJCWRvam8uX3Njcm9sbEludGVydmFsSWQgPSAwOw0KCQl9DQoNCgkJaWYoIWRvam8uX2luaXRGaXJlZCl7DQoJCQlkb2pvLl9pbml0RmlyZWQgPSB0cnVlOw0KDQoJCQkvL0hlbHAgb3V0IElFIHRvIGF2b2lkIG1lbW9yeSBsZWFrLg0KCQkJaWYoIWRvam8uY29uZmlnLmFmdGVyT25Mb2FkICYmIHdpbmRvdy5kZXRhY2hFdmVudCl7DQoJCQkJd2luZG93LmRldGFjaEV2ZW50KCJvbmxvYWQiLCBkb2pvLl9sb2FkSW5pdCk7DQoJCQl9DQoNCgkJCWlmKGRvam8uX2luRmxpZ2h0Q291bnQgPT0gMCl7DQoJCQkJZG9qby5fbW9kdWxlc0xvYWRlZCgpOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJaWYoIWRvam8uY29uZmlnLmFmdGVyT25Mb2FkKXsJCQ0KCQlpZihkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKXsNCgkJCS8vU3RhbmRhcmRzLiBIb29yYXkhIEFzc3VtcHRpb24gaGVyZSB0aGF0IGlmIHN0YW5kYXJkcyBiYXNlZCwNCgkJCS8vaXQga25vd3MgYWJvdXQgRE9NQ29udGVudExvYWRlZC4gSXQgaXMgT0sgaWYgaXQgZG9lcyBub3QsIHRoZSBmYWxsIHRocm91Z2gNCgkJCS8vdG8gd2luZG93IG9ubG9hZCBzaG91bGQgYmUgZ29vZCBlbm91Z2guDQoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZG9qby5fbG9hZEluaXQsIGZhbHNlKTsNCgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZG9qby5fbG9hZEluaXQsIGZhbHNlKTsNCgkJfWVsc2UgaWYod2luZG93LmF0dGFjaEV2ZW50KXsNCgkJCXdpbmRvdy5hdHRhY2hFdmVudCgib25sb2FkIiwgZG9qby5fbG9hZEluaXQpOw0KDQoJCQkvL0RPTUNvbnRlbnRMb2FkZWQgYXBwcm94aW1hdGlvbi4gRGllZ28gUGVyaW5pIGZvdW5kIHRoaXMgTVNETiBhcnRpY2xlDQoJCQkvL3RoYXQgaW5kaWNhdGVzIGRvU2Nyb2xsIGlzIGF2YWlsYWJsZSBhZnRlciBET00gcmVhZHksIHNvIGRvIGEgc2V0VGltZW91dA0KCQkJLy90byBjaGVjayB3aGVuIGl0IGlzIGF2YWlsYWJsZS4NCgkJCS8vaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTMxNDI2LmFzcHgNCgkJCWlmKCFkb2pvLmNvbmZpZy5za2lwSWVEb21Mb2FkZWQgJiYgc2VsZiA9PT0gc2VsZi50b3Apew0KCQkJCWRvam8uX3Njcm9sbEludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKXsNCgkJCQkJdHJ5ew0KCQkJCQkJLy9XaGVuIGRvam8gaXMgbG9hZGVkIGludG8gYW4gaWZyYW1lIGluIGFuIElFIEhUTUwgQXBwbGljYXRpb24gDQoJCQkJCQkvLyhIVEEpLCBzdWNoIGFzIGluIGEgc2VsZW5pdW0gdGVzdCwgamF2YXNjcmlwdCBpbiB0aGUgaWZyYW1lDQoJCQkJCQkvL2Nhbid0IHNlZSBhbnl0aGluZyBvdXRzaWRlIG9mIGl0LCBzbyBzZWxmPT09c2VsZi50b3AgaXMgdHJ1ZSwNCgkJCQkJCS8vYnV0IHRoZSBpZnJhbWUgaXMgbm90IHRoZSB0b3Agd2luZG93IGFuZCBkb1Njcm9sbCB3aWxsIGJlIA0KCQkJCQkJLy9hdmFpbGFibGUgYmVmb3JlIGRvY3VtZW50LmJvZHkgaXMgc2V0LiBUZXN0IGRvY3VtZW50LmJvZHkNCgkJCQkJCS8vYmVmb3JlIHRyeWluZyB0aGUgZG9TY3JvbGwgdHJpY2sNCgkJCQkJCWlmKGRvY3VtZW50LmJvZHkpew0KCQkJCQkJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpOw0KCQkJCQkJCWRvam8uX2xvYWRJbml0KCk7DQoJCQkJCQl9DQoJCQkJCX1jYXRjaCAoZSl7fQ0KCQkJCX0sIDMwKTsNCgkJCX0NCgkJfQ0KCX0NCg0KCQlpZihkb2pvLmlzSUUpew0KCQl0cnl7DQoJCQkoZnVuY3Rpb24oKXsNCgkJCQlkb2N1bWVudC5uYW1lc3BhY2VzLmFkZCgidiIsICJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnZtbCIpOw0KCQkJCXZhciB2bWxFbGVtcyA9IFsiKiIsICJncm91cCIsICJyb3VuZHJlY3QiLCAib3ZhbCIsICJzaGFwZSIsICJyZWN0IiwgImltYWdlZGF0YSIsICJwYXRoIiwgInRleHRwYXRoIiwgInRleHQiXSwNCgkJCQkJaSA9IDAsIGwgPSAxLCBzID0gZG9jdW1lbnQuY3JlYXRlU3R5bGVTaGVldCgpOw0KCQkJCWlmKGRvam8uaXNJRSA+PSA4KXsNCgkJCQkJaSA9IDE7DQoJCQkJCWwgPSB2bWxFbGVtcy5sZW5ndGg7DQoJCQkJfQ0KCQkJCWZvcig7IGkgPCBsOyArK2kpew0KCQkJCQlzLmFkZFJ1bGUoInZcXDoiICsgdm1sRWxlbXNbaV0sICJiZWhhdmlvcjp1cmwoI2RlZmF1bHQjVk1MKTsgZGlzcGxheTppbmxpbmUtYmxvY2siKTsNCgkJCQl9DQoJCQl9KSgpOw0KCQl9Y2F0Y2goZSl7fQ0KCX0NCgkJLy9FTkQgRE9NQ29udGVudExvYWRlZA0KDQoNCgkvKg0KCU9wZW5BamF4LnN1YnNjcmliZSgiT3BlbkFqYXgiLCAib25sb2FkIiwgZnVuY3Rpb24oKXsNCgkJaWYoZG9qby5faW5GbGlnaHRDb3VudCA9PSAwKXsNCgkJCWRvam8uX21vZHVsZXNMb2FkZWQoKTsNCgkJfQ0KCX0pOw0KDQoJT3BlbkFqYXguc3Vic2NyaWJlKCJPcGVuQWpheCIsICJvbnVubG9hZCIsIGZ1bmN0aW9uKCl7DQoJCWRvam8udW5sb2FkZWQoKTsNCgl9KTsNCgkqLw0KfSAvL2lmICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnKQ0KDQovL1JlZ2lzdGVyIGFueSBtb2R1bGUgcGF0aHMgc2V0IHVwIGluIGRqQ29uZmlnLiBOZWVkIHRvIGRvIHRoaXMNCi8vaW4gdGhlIGhvc3RlbnZzIHNpbmNlIGhvc3RlbnZfYnJvd3NlciBjYW4gcmVhZCBkakNvbmZpZyBmcm9tIGENCi8vc2NyaXB0IHRhZydzIGF0dHJpYnV0ZS4NCihmdW5jdGlvbigpew0KCXZhciBtcCA9IGRvam8uY29uZmlnWyJtb2R1bGVQYXRocyJdOw0KCWlmKG1wKXsNCgkJZm9yKHZhciBwYXJhbSBpbiBtcCl7DQoJCQlkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aChwYXJhbSwgbXBbcGFyYW1dKTsNCgkJfQ0KCX0NCn0pKCk7DQoNCi8vTG9hZCBkZWJ1ZyBjb2RlIGlmIG5lY2Vzc2FyeS4NCmlmKGRvam8uY29uZmlnLmlzRGVidWcpew0KCWRvam8ucmVxdWlyZSgiZG9qby5fZmlyZWJ1Zy5maXJlYnVnIik7DQp9DQoNCmlmKGRvam8uY29uZmlnLmRlYnVnQXRBbGxDb3N0cyl7DQoJZG9qby5jb25maWcudXNlWERvbWFpbiA9IHRydWU7DQoJZG9qby5yZXF1aXJlKCJkb2pvLl9iYXNlLl9sb2FkZXIubG9hZGVyX3hkIik7DQoJZG9qby5yZXF1aXJlKCJkb2pvLl9iYXNlLl9sb2FkZXIubG9hZGVyX2RlYnVnIik7DQoJZG9qby5yZXF1aXJlKCJkb2pvLmkxOG4iKTsNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmxhbmciXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UubGFuZyJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5sYW5nIik7DQoNCihmdW5jdGlvbigpew0KCXZhciBkID0gZG9qbywgb3B0cyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7DQoNCgkvLyBDcm9ja2ZvcmQgKGlzaCkgZnVuY3Rpb25zDQoNCglkb2pvLmlzU3RyaW5nID0gZnVuY3Rpb24oLyphbnl0aGluZyovIGl0KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybiB0cnVlIGlmIGl0IGlzIGEgU3RyaW5nDQoJCXJldHVybiAodHlwZW9mIGl0ID09ICJzdHJpbmciIHx8IGl0IGluc3RhbmNlb2YgU3RyaW5nKTsgLy8gQm9vbGVhbg0KCX0NCg0KCWRvam8uaXNBcnJheSA9IGZ1bmN0aW9uKC8qYW55dGhpbmcqLyBpdCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm4gdHJ1ZSBpZiBpdCBpcyBhbiBBcnJheS4NCgkJLy8JCURvZXMgbm90IHdvcmsgb24gQXJyYXlzIGNyZWF0ZWQgaW4gb3RoZXIgd2luZG93cy4NCgkJcmV0dXJuIGl0ICYmIChpdCBpbnN0YW5jZW9mIEFycmF5IHx8IHR5cGVvZiBpdCA9PSAiYXJyYXkiKTsgLy8gQm9vbGVhbg0KCX0NCg0KCWRvam8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKC8qYW55dGhpbmcqLyBpdCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZXR1cm4gdHJ1ZSBpZiBpdCBpcyBhIEZ1bmN0aW9uDQoJCXJldHVybiBvcHRzLmNhbGwoaXQpID09PSAiW29iamVjdCBGdW5jdGlvbl0iOw0KCX07DQoNCglkb2pvLmlzT2JqZWN0ID0gZnVuY3Rpb24oLyphbnl0aGluZyovIGl0KXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgdHJ1ZSBpZiBpdCBpcyBhIEphdmFTY3JpcHQgb2JqZWN0IChvciBhbiBBcnJheSwgYSBGdW5jdGlvbg0KCQkvLwkJb3IgbnVsbCkNCgkJcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYNCgkJCShpdCA9PT0gbnVsbCB8fCB0eXBlb2YgaXQgPT0gIm9iamVjdCIgfHwgZC5pc0FycmF5KGl0KSB8fCBkLmlzRnVuY3Rpb24oaXQpKTsgLy8gQm9vbGVhbg0KCX0NCg0KCWRvam8uaXNBcnJheUxpa2UgPSBmdW5jdGlvbigvKmFueXRoaW5nKi8gaXQpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJc2ltaWxhciB0byBkb2pvLmlzQXJyYXkoKSBidXQgbW9yZSBwZXJtaXNzaXZlDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJRG9lc24ndCBzdHJvbmdseSB0ZXN0IGZvciAiYXJyYXluZXNzIi4gIEluc3RlYWQsIHNldHRsZXMgZm9yICJpc24ndA0KCQkvLwkJYSBzdHJpbmcgb3IgbnVtYmVyIGFuZCBoYXMgYSBsZW5ndGggcHJvcGVydHkiLiBBcmd1bWVudHMgb2JqZWN0cw0KCQkvLwkJYW5kIERPTSBjb2xsZWN0aW9ucyB3aWxsIHJldHVybiB0cnVlIHdoZW4gcGFzc2VkIHRvDQoJCS8vCQlkb2pvLmlzQXJyYXlMaWtlKCksIGJ1dCB3aWxsIHJldHVybiBmYWxzZSB3aGVuIHBhc3NlZCB0bw0KCQkvLwkJZG9qby5pc0FycmF5KCkuDQoJCS8vCXJldHVybnM6DQoJCS8vCQlJZiBpdCB3YWxrcyBsaWtlIGEgZHVjayBhbmQgcXVhY2tzIGxpa2UgYSBkdWNrLCByZXR1cm4gYHRydWVgDQoJCXJldHVybiBpdCAmJiBpdCAhPT0gdW5kZWZpbmVkICYmIC8vIEJvb2xlYW4NCgkJCS8vIGtlZXAgb3V0IGJ1aWx0LWluIGNvbnN0cnVjdG9ycyAoTnVtYmVyLCBTdHJpbmcsIC4uLikgd2hpY2ggaGF2ZSBsZW5ndGgNCgkJCS8vIHByb3BlcnRpZXMNCgkJCSFkLmlzU3RyaW5nKGl0KSAmJiAhZC5pc0Z1bmN0aW9uKGl0KSAmJg0KCQkJIShpdC50YWdOYW1lICYmIGl0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnZm9ybScpICYmDQoJCQkoZC5pc0FycmF5KGl0KSB8fCBpc0Zpbml0ZShpdC5sZW5ndGgpKTsNCgl9DQoNCglkb2pvLmlzQWxpZW4gPSBmdW5jdGlvbigvKmFueXRoaW5nKi8gaXQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyB0cnVlIGlmIGl0IGlzIGEgYnVpbHQtaW4gZnVuY3Rpb24gb3Igc29tZSBvdGhlciBraW5kIG9mDQoJCS8vCQlvZGRiYWxsIHRoYXQgKnNob3VsZCogcmVwb3J0IGFzIGEgZnVuY3Rpb24gYnV0IGRvZXNuJ3QNCgkJcmV0dXJuIGl0ICYmICFkLmlzRnVuY3Rpb24oaXQpICYmIC9ce1xzKlxbbmF0aXZlIGNvZGVcXVxzKlx9Ly50ZXN0KFN0cmluZyhpdCkpOyAvLyBCb29sZWFuDQoJfQ0KDQoJZG9qby5leHRlbmQgPSBmdW5jdGlvbigvKk9iamVjdCovIGNvbnN0cnVjdG9yLCAvKk9iamVjdC4uLiovIHByb3BzKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUFkZHMgYWxsIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMgb2YgcHJvcHMgdG8gY29uc3RydWN0b3Incw0KCQkvLwkJcHJvdG90eXBlLCBtYWtpbmcgdGhlbSBhdmFpbGFibGUgdG8gYWxsIGluc3RhbmNlcyBjcmVhdGVkIHdpdGgNCgkJLy8JCWNvbnN0cnVjdG9yLg0KCQlmb3IodmFyIGk9MSwgbD1hcmd1bWVudHMubGVuZ3RoOyBpPGw7IGkrKyl7DQoJCQlkLl9taXhpbihjb25zdHJ1Y3Rvci5wcm90b3R5cGUsIGFyZ3VtZW50c1tpXSk7DQoJCX0NCgkJcmV0dXJuIGNvbnN0cnVjdG9yOyAvLyBPYmplY3QNCgl9DQoNCglkb2pvLl9oaXRjaEFyZ3MgPSBmdW5jdGlvbihzY29wZSwgbWV0aG9kIC8qLC4uLiovKXsNCgkJdmFyIHByZSA9IGQuX3RvQXJyYXkoYXJndW1lbnRzLCAyKTsNCgkJdmFyIG5hbWVkID0gZC5pc1N0cmluZyhtZXRob2QpOw0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCS8vIGFycmF5aWZ5IGFyZ3VtZW50cw0KCQkJdmFyIGFyZ3MgPSBkLl90b0FycmF5KGFyZ3VtZW50cyk7DQoJCQkvLyBsb2NhdGUgb3VyIG1ldGhvZA0KCQkJdmFyIGYgPSBuYW1lZCA/IChzY29wZXx8ZC5nbG9iYWwpW21ldGhvZF0gOiBtZXRob2Q7DQoJCQkvLyBpbnZva2Ugd2l0aCBjb2xsZWN0ZWQgYXJncw0KCQkJcmV0dXJuIGYgJiYgZi5hcHBseShzY29wZSB8fCB0aGlzLCBwcmUuY29uY2F0KGFyZ3MpKTsgLy8gbWl4ZWQNCgkJfSAvLyBGdW5jdGlvbg0KCX0NCg0KCWRvam8uaGl0Y2ggPSBmdW5jdGlvbigvKk9iamVjdCovc2NvcGUsIC8qRnVuY3Rpb258U3RyaW5nKi9tZXRob2QgLyosLi4uKi8pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGV2ZXIgZXhlY3V0ZSBpbiB0aGUgYSBnaXZlbiBzY29wZS4NCgkJLy8JCVRoaXMgYWxsb3dzIGZvciBlYXN5IHVzZSBvZiBvYmplY3QgbWVtYmVyIGZ1bmN0aW9ucw0KCQkvLwkJaW4gY2FsbGJhY2tzIGFuZCBvdGhlciBwbGFjZXMgaW4gd2hpY2ggdGhlICJ0aGlzIiBrZXl3b3JkIG1heQ0KCQkvLwkJb3RoZXJ3aXNlIG5vdCByZWZlcmVuY2UgdGhlIGV4cGVjdGVkIHNjb3BlLg0KCQkvLwkJQW55IG51bWJlciBvZiBkZWZhdWx0IHBvc2l0aW9uYWwgYXJndW1lbnRzIG1heSBiZSBwYXNzZWQgYXMgcGFyYW1ldGVycyANCgkJLy8JCWJleW9uZCAibWV0aG9kIi4NCgkJLy8JCUVhY2ggb2YgdGhlc2UgdmFsdWVzIHdpbGwgYmUgdXNlZCB0byAicGxhY2Vob2xkIiAoc2ltaWxhciB0byBjdXJyeSkNCgkJLy8JCWZvciB0aGUgaGl0Y2hlZCBmdW5jdGlvbi4NCgkJLy8Jc2NvcGU6DQoJCS8vCQlUaGUgc2NvcGUgdG8gdXNlIHdoZW4gbWV0aG9kIGV4ZWN1dGVzLiBJZiBtZXRob2QgaXMgYSBzdHJpbmcsDQoJCS8vCQlzY29wZSBpcyBhbHNvIHRoZSBvYmplY3QgY29udGFpbmluZyBtZXRob2QuDQoJCS8vCW1ldGhvZDoNCgkJLy8JCUEgZnVuY3Rpb24gdG8gYmUgaGl0Y2hlZCB0byBzY29wZSwgb3IgdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCBpbg0KCQkvLwkJc2NvcGUgdG8gYmUgaGl0Y2hlZC4NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAlkb2pvLmhpdGNoKGZvbywgImJhciIpKCk7DQoJCS8vCQlydW5zIGZvby5iYXIoKSBpbiB0aGUgc2NvcGUgb2YgZm9vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJZG9qby5oaXRjaChmb28sIG15RnVuY3Rpb24pOw0KCQkvLwkJcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgcnVucyBteUZ1bmN0aW9uIGluIHRoZSBzY29wZSBvZiBmb28NCgkJLy8JZXhhbXBsZToNCgkJLy8JCUV4cGFuc2lvbiBvbiB0aGUgZGVmYXVsdCBwb3NpdGlvbmFsIGFyZ3VtZW50cyBwYXNzZWQgYWxvbmcgZnJvbQ0KCQkvLwkJaGl0Y2guIFBhc3NlZCBhcmdzIGFyZSBtaXhlZCBmaXJzdCwgYWRkaXRpb25hbCBhcmdzIGFmdGVyLg0KCQkvLwl8CXZhciBmb28gPSB7IGJhcjogZnVuY3Rpb24oYSwgYiwgYyl7IGNvbnNvbGUubG9nKGEsIGIsIGMpOyB9IH07DQoJCS8vCXwJdmFyIGZuID0gZG9qby5oaXRjaChmb28sICJiYXIiLCAxLCAyKTsNCgkJLy8JfAlmbigzKTsgLy8gbG9ncyAiMSwgMiwgMyINCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgZm9vID0geyBiYXI6IDIgfTsNCgkJLy8JfAlkb2pvLmhpdGNoKGZvbywgZnVuY3Rpb24oKXsgdGhpcy5iYXIgPSAxMDsgfSkoKTsNCgkJLy8JCWV4ZWN1dGUgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIGluIHNjb3BlIG9mIGZvbw0KCQkNCgkJaWYoYXJndW1lbnRzLmxlbmd0aCA+IDIpew0KCQkJcmV0dXJuIGQuX2hpdGNoQXJncy5hcHBseShkLCBhcmd1bWVudHMpOyAvLyBGdW5jdGlvbg0KCQl9DQoJCWlmKCFtZXRob2Qpew0KCQkJbWV0aG9kID0gc2NvcGU7DQoJCQlzY29wZSA9IG51bGw7DQoJCX0NCgkJaWYoZC5pc1N0cmluZyhtZXRob2QpKXsNCgkJCXNjb3BlID0gc2NvcGUgfHwgZC5nbG9iYWw7DQoJCQlpZighc2NvcGVbbWV0aG9kXSl7IHRocm93KFsnZG9qby5oaXRjaDogc2NvcGVbIicsIG1ldGhvZCwgJyJdIGlzIG51bGwgKHNjb3BlPSInLCBzY29wZSwgJyIpJ10uam9pbignJykpOyB9DQoJCQlyZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIHNjb3BlW21ldGhvZF0uYXBwbHkoc2NvcGUsIGFyZ3VtZW50cyB8fCBbXSk7IH07IC8vIEZ1bmN0aW9uDQoJCX0NCgkJcmV0dXJuICFzY29wZSA/IG1ldGhvZCA6IGZ1bmN0aW9uKCl7IHJldHVybiBtZXRob2QuYXBwbHkoc2NvcGUsIGFyZ3VtZW50cyB8fCBbXSk7IH07IC8vIEZ1bmN0aW9uDQoJfQ0KDQoJLyo9PT09PQ0KCWRvam8uZGVsZWdhdGUgPSBmdW5jdGlvbihvYmosIHByb3BzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYSBuZXcgb2JqZWN0IHdoaWNoICJsb29rcyIgdG8gb2JqIGZvciBwcm9wZXJ0aWVzIHdoaWNoIGl0DQoJCS8vCQlkb2VzIG5vdCBoYXZlIGEgdmFsdWUgZm9yLiBPcHRpb25hbGx5IHRha2VzIGEgYmFnIG9mIHByb3BlcnRpZXMgdG8NCgkJLy8JCXNlZWQgdGhlIHJldHVybmVkIG9iamVjdCB3aXRoIGluaXRpYWxseS4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlUaGlzIGlzIGEgc21hbGwgaW1wbGVtZW50YXRvbiBvZiB0aGUgQm9vZG1hbi9Dcm9ja2ZvcmQgZGVsZWdhdGlvbg0KCQkvLwkJcGF0dGVybiBpbiBKYXZhU2NyaXB0LiBBbiBpbnRlcm1lZGlhdGUgb2JqZWN0IGNvbnN0cnVjdG9yIG1lZGlhdGVzDQoJCS8vCQl0aGUgcHJvdG90eXBlIGNoYWluIGZvciB0aGUgcmV0dXJuZWQgb2JqZWN0LCB1c2luZyBpdCB0byBkZWxlZ2F0ZQ0KCQkvLwkJZG93biB0byBvYmogZm9yIHByb3BlcnR5IGxvb2t1cCB3aGVuIG9iamVjdC1sb2NhbCBsb29rdXAgZmFpbHMuDQoJCS8vCQlUaGlzIGNhbiBiZSB0aG91Z2h0IG9mIHNpbWlsYXJseSB0byBFUzQncyAid3JhcCIsIHNhdmUgdGhhdCBpdCBkb2VzDQoJCS8vCQlub3QgYWN0IG9uIHR5cGVzIGJ1dCByYXRoZXIgb24gcHVyZSBvYmplY3RzLg0KCQkvLwlvYmo6DQoJCS8vCQlUaGUgb2JqZWN0IHRvIGRlbGVnYXRlIHRvIGZvciBwcm9wZXJ0aWVzIG5vdCBmb3VuZCBkaXJlY3RseSBvbiB0aGUNCgkJLy8JCXJldHVybiBvYmplY3Qgb3IgaW4gcHJvcHMuDQoJCS8vCXByb3BzOg0KCQkvLwkJYW4gb2JqZWN0IGNvbnRhaW5pbmcgcHJvcGVydGllcyB0byBhc3NpZ24gdG8gdGhlIHJldHVybmVkIG9iamVjdA0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJYW4gT2JqZWN0IG9mIGFub255bW91cyB0eXBlDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIGZvbyA9IHsgYmFyOiAiYmF6IiB9Ow0KCQkvLwl8CXZhciB0aGluZ2VyID0gZG9qby5kZWxlZ2F0ZShmb28sIHsgdGh1ZDogInh5enp5In0pOw0KCQkvLwl8CXRoaW5nZXIuYmFyID09ICJiYXoiOyAvLyBkZWxlZ2F0ZWQgdG8gZm9vDQoJCS8vCXwJZm9vLnRodWQgPT0gdW5kZWZpbmVkOyAvLyBieSBkZWZpbml0aW9uDQoJCS8vCXwJdGhpbmdlci50aHVkID09ICJ4eXp6eSI7IC8vIG1peGVkIGluIGZyb20gcHJvcHMNCgkJLy8JfAlmb28uYmFyID0gInRob25rIjsNCgkJLy8JfAl0aGluZ2VyLmJhciA9PSAidGhvbmsiOyAvLyBzdGlsbCBkZWxlZ2F0ZWQgdG8gZm9vJ3MgYmFyDQoJfQ0KCT09PT09Ki8NCg0KCWRvam8uZGVsZWdhdGUgPSBkb2pvLl9kZWxlZ2F0ZSA9IChmdW5jdGlvbigpew0KCQkvLyBib29kbWFuL2Nyb2NrZm9yZCBkZWxlZ2F0aW9uIHcvIGNvcm5mb3JkIG9wdGltaXphdGlvbg0KCQlmdW5jdGlvbiBUTVAoKXt9DQoJCXJldHVybiBmdW5jdGlvbihvYmosIHByb3BzKXsNCgkJCVRNUC5wcm90b3R5cGUgPSBvYmo7DQoJCQl2YXIgdG1wID0gbmV3IFRNUCgpOw0KCQkJVE1QLnByb3RvdHlwZSA9IG51bGw7DQoJCQlpZihwcm9wcyl7DQoJCQkJZC5fbWl4aW4odG1wLCBwcm9wcyk7DQoJCQl9DQoJCQlyZXR1cm4gdG1wOyAvLyBPYmplY3QNCgkJfQ0KCX0pKCk7DQoNCgkvKj09PT09DQoJZG9qby5fdG9BcnJheSA9IGZ1bmN0aW9uKG9iaiwgb2Zmc2V0LCBzdGFydFdpdGgpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQ29udmVydHMgYW4gYXJyYXktbGlrZSBvYmplY3QgKGkuZS4gYXJndW1lbnRzLCBET01Db2xsZWN0aW9uKSB0byBhbg0KCQkvLwkJYXJyYXkuIFJldHVybnMgYSBuZXcgQXJyYXkgd2l0aCB0aGUgZWxlbWVudHMgb2Ygb2JqLg0KCQkvLwlvYmo6IE9iamVjdA0KCQkvLwkJdGhlIG9iamVjdCB0byAiYXJyYXlpZnkiLiBXZSBleHBlY3QgdGhlIG9iamVjdCB0byBoYXZlLCBhdCBhDQoJCS8vCQltaW5pbXVtLCBhIGxlbmd0aCBwcm9wZXJ0eSB3aGljaCBjb3JyZXNwb25kcyB0byBpbnRlZ2VyLWluZGV4ZWQNCgkJLy8JCXByb3BlcnRpZXMuDQoJCS8vCW9mZnNldDogTnVtYmVyPw0KCQkvLwkJdGhlIGxvY2F0aW9uIGluIG9iaiB0byBzdGFydCBpdGVyYXRpbmcgZnJvbS4gRGVmYXVsdHMgdG8gMC4NCgkJLy8JCU9wdGlvbmFsLg0KCQkvLwlzdGFydFdpdGg6IEFycmF5Pw0KCQkvLwkJQW4gYXJyYXkgdG8gcGFjayB3aXRoIHRoZSBwcm9wZXJ0aWVzIG9mIG9iai4gSWYgcHJvdmlkZWQsDQoJCS8vCQlwcm9wZXJ0aWVzIGluIG9iaiBhcmUgYXBwZW5kZWQgYXQgdGhlIGVuZCBvZiBzdGFydFdpdGggYW5kDQoJCS8vCQlzdGFydFdpdGggaXMgdGhlIHJldHVybmVkIGFycmF5Lg0KCX0NCgk9PT09PSovDQoNCgl2YXIgZWZmaWNpZW50ID0gZnVuY3Rpb24ob2JqLCBvZmZzZXQsIHN0YXJ0V2l0aCl7DQoJCXJldHVybiAoc3RhcnRXaXRofHxbXSkuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG9iaiwgb2Zmc2V0fHwwKSk7DQoJfTsNCg0KCQl2YXIgc2xvdyA9IGZ1bmN0aW9uKG9iaiwgb2Zmc2V0LCBzdGFydFdpdGgpew0KCQl2YXIgYXJyID0gc3RhcnRXaXRofHxbXTsNCgkJZm9yKHZhciB4ID0gb2Zmc2V0IHx8IDA7IHggPCBvYmoubGVuZ3RoOyB4Kyspew0KCQkJYXJyLnB1c2gob2JqW3hdKTsNCgkJfQ0KCQlyZXR1cm4gYXJyOw0KCX07DQoJDQoJZG9qby5fdG9BcnJheSA9DQoJCQkJZC5pc0lFID8gIGZ1bmN0aW9uKG9iail7DQoJCQlyZXR1cm4gKChvYmouaXRlbSkgPyBzbG93IDogZWZmaWNpZW50KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQl9IDoNCgkJCQllZmZpY2llbnQ7DQoNCglkb2pvLnBhcnRpYWwgPSBmdW5jdGlvbigvKkZ1bmN0aW9ufFN0cmluZyovbWV0aG9kIC8qLCAuLi4qLyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlzaW1pbGFyIHRvIGhpdGNoKCkgZXhjZXB0IHRoYXQgdGhlIHNjb3BlIG9iamVjdCBpcyBsZWZ0IHRvIGJlDQoJCS8vCQl3aGF0ZXZlciB0aGUgZXhlY3V0aW9uIGNvbnRleHQgZXZlbnR1YWxseSBiZWNvbWVzLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUNhbGxpbmcgZG9qby5wYXJ0aWFsIGlzIHRoZSBmdW5jdGlvbmFsIGVxdWl2YWxlbnQgb2YgY2FsbGluZzoNCgkJLy8JCXwJZG9qby5oaXRjaChudWxsLCBmdW5jTmFtZSwgLi4uKTsNCgkJdmFyIGFyciA9IFsgbnVsbCBdOw0KCQlyZXR1cm4gZC5oaXRjaC5hcHBseShkLCBhcnIuY29uY2F0KGQuX3RvQXJyYXkoYXJndW1lbnRzKSkpOyAvLyBGdW5jdGlvbg0KCX0NCg0KCXZhciBleHRyYU5hbWVzID0gZC5fZXh0cmFOYW1lcywgZXh0cmFMZW4gPSBleHRyYU5hbWVzLmxlbmd0aCwgZW1wdHkgPSB7fTsNCg0KCWRvam8uY2xvbmUgPSBmdW5jdGlvbigvKmFueXRoaW5nKi8gbyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlDbG9uZXMgb2JqZWN0cyAoaW5jbHVkaW5nIERPTSBub2RlcykgYW5kIGFsbCBjaGlsZHJlbi4NCgkJLy8JCVdhcm5pbmc6IGRvIG5vdCBjbG9uZSBjeWNsaWMgc3RydWN0dXJlcy4NCgkJaWYoIW8gfHwgdHlwZW9mIG8gIT0gIm9iamVjdCIgfHwgZC5pc0Z1bmN0aW9uKG8pKXsNCgkJCS8vIG51bGwsIHVuZGVmaW5lZCwgYW55IG5vbi1vYmplY3QsIG9yIGZ1bmN0aW9uDQoJCQlyZXR1cm4gbzsJLy8gYW55dGhpbmcNCgkJfQ0KCQlpZihvLm5vZGVUeXBlICYmICJjbG9uZU5vZGUiIGluIG8pew0KCQkJLy8gRE9NIE5vZGUNCgkJCXJldHVybiBvLmNsb25lTm9kZSh0cnVlKTsgLy8gTm9kZQ0KCQl9DQoJCWlmKG8gaW5zdGFuY2VvZiBEYXRlKXsNCgkJCS8vIERhdGUNCgkJCXJldHVybiBuZXcgRGF0ZShvLmdldFRpbWUoKSk7CS8vIERhdGUNCgkJfQ0KCQl2YXIgciwgaSwgbCwgcywgbmFtZTsNCgkJaWYoZC5pc0FycmF5KG8pKXsNCgkJCS8vIGFycmF5DQoJCQlyID0gW107DQoJCQlmb3IoaSA9IDAsIGwgPSBvLmxlbmd0aDsgaSA8IGw7ICsraSl7DQoJCQkJaWYoaSBpbiBvKXsNCgkJCQkJci5wdXNoKGQuY2xvbmUob1tpXSkpOw0KCQkJCX0NCgkJCX0NCi8vIHdlIGRvbid0IGNsb25lIGZ1bmN0aW9ucyBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucw0KLy8JCX1lbHNlIGlmKGQuaXNGdW5jdGlvbihvKSl7DQovLwkJCS8vIGZ1bmN0aW9uDQovLwkJCXIgPSBmdW5jdGlvbigpeyByZXR1cm4gby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9Ow0KCQl9ZWxzZXsNCgkJCS8vIGdlbmVyaWMgb2JqZWN0cw0KCQkJciA9IG8uY29uc3RydWN0b3IgPyBuZXcgby5jb25zdHJ1Y3RvcigpIDoge307DQoJCX0NCgkJZm9yKG5hbWUgaW4gbyl7DQoJCQkvLyB0aGUgInRvYmoiIGNvbmRpdGlvbiBhdm9pZCBjb3B5aW5nIHByb3BlcnRpZXMgaW4gInNvdXJjZSINCgkJCS8vIGluaGVyaXRlZCBmcm9tIE9iamVjdC5wcm90b3R5cGUuICBGb3IgZXhhbXBsZSwgaWYgdGFyZ2V0IGhhcyBhIGN1c3RvbQ0KCQkJLy8gdG9TdHJpbmcoKSBtZXRob2QsIGRvbid0IG92ZXJ3cml0ZSBpdCB3aXRoIHRoZSB0b1N0cmluZygpIG1ldGhvZA0KCQkJLy8gdGhhdCBzb3VyY2UgaW5oZXJpdGVkIGZyb20gT2JqZWN0LnByb3RvdHlwZQ0KCQkJcyA9IG9bbmFtZV07DQoJCQlpZighKG5hbWUgaW4gcikgfHwgKHJbbmFtZV0gIT09IHMgJiYgKCEobmFtZSBpbiBlbXB0eSkgfHwgZW1wdHlbbmFtZV0gIT09IHMpKSl7DQoJCQkJcltuYW1lXSA9IGQuY2xvbmUocyk7DQoJCQl9DQoJCX0NCgkJCQkvLyBJRSBkb2Vzbid0IHJlY29nbml6ZSBzb21lIGN1c3RvbSBmdW5jdGlvbnMgaW4gZm9yLi5pbg0KCQlpZihleHRyYUxlbil7DQoJCQlmb3IoaSA9IDA7IGkgPCBleHRyYUxlbjsgKytpKXsNCgkJCQluYW1lID0gZXh0cmFOYW1lc1tpXTsNCgkJCQlzID0gb1tuYW1lXTsNCgkJCQlpZighKG5hbWUgaW4gcikgfHwgKHJbbmFtZV0gIT09IHMgJiYgKCEobmFtZSBpbiBlbXB0eSkgfHwgZW1wdHlbbmFtZV0gIT09IHMpKSl7DQoJCQkJCXJbbmFtZV0gPSBzOyAvLyBmdW5jdGlvbnMgb25seSwgd2UgZG9uJ3QgY2xvbmUgdGhlbQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkJCXJldHVybiByOyAvLyBPYmplY3QNCgl9DQoNCgkvKj09PT09DQoJZG9qby50cmltID0gZnVuY3Rpb24oc3RyKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVRyaW1zIHdoaXRlc3BhY2UgZnJvbSBib3RoIHNpZGVzIG9mIHRoZSBzdHJpbmcNCgkJLy8Jc3RyOiBTdHJpbmcNCgkJLy8JCVN0cmluZyB0byBiZSB0cmltbWVkDQoJCS8vCXJldHVybnM6IFN0cmluZw0KCQkvLwkJUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcNCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlUaGlzIHZlcnNpb24gb2YgdHJpbSgpIHdhcyBzZWxlY3RlZCBmb3IgaW5jbHVzaW9uIGludG8gdGhlIGJhc2UgZHVlDQoJCS8vCQl0byBpdHMgY29tcGFjdCBzaXplIGFuZCByZWxhdGl2ZWx5IGdvb2QgcGVyZm9ybWFuY2UNCgkJLy8JCShzZWUgW1N0ZXZlbiBMZXZpdGhhbidzIGJsb2ddKGh0dHA6Ly9ibG9nLnN0ZXZlbmxldml0aGFuLmNvbS9hcmNoaXZlcy9mYXN0ZXItdHJpbS1qYXZhc2NyaXB0KQ0KCQkvLwkJVXNlcyBTdHJpbmcucHJvdG90eXBlLnRyaW0gaW5zdGVhZCwgaWYgYXZhaWxhYmxlLg0KCQkvLwkJVGhlIGZhc3Rlc3QgYnV0IGxvbmdlc3QgdmVyc2lvbiBvZiB0aGlzIGZ1bmN0aW9uIGlzIGxvY2F0ZWQgYXQNCgkJLy8JCWRvam8uc3RyaW5nLnRyaW0oKQ0KCQlyZXR1cm4gIiI7CS8vIFN0cmluZw0KCX0NCgk9PT09PSovDQoNCglkb2pvLnRyaW0gPSBTdHJpbmcucHJvdG90eXBlLnRyaW0gPw0KCQlmdW5jdGlvbihzdHIpeyByZXR1cm4gc3RyLnRyaW0oKTsgfSA6DQoJCWZ1bmN0aW9uKHN0cil7IHJldHVybiBzdHIucmVwbGFjZSgvXlxzXHMqLywgJycpLnJlcGxhY2UoL1xzXHMqJC8sICcnKTsgfTsNCg0KCS8qPT09PT0NCglkb2pvLnJlcGxhY2UgPSBmdW5jdGlvbih0bXBsLCBtYXAsIHBhdHRlcm4pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUGVyZm9ybXMgcGFyYW1ldGVyaXplZCBzdWJzdGl0dXRpb25zIG9uIGEgc3RyaW5nLiBUaHJvd3MgYW4NCgkJLy8JCWV4Y2VwdGlvbiBpZiBhbnkgcGFyYW1ldGVyIGlzIHVubWF0Y2hlZC4gDQoJCS8vCXRtcGw6IFN0cmluZw0KCQkvLwkJU3RyaW5nIHRvIGJlIHVzZWQgYXMgYSB0ZW1wbGF0ZS4NCgkJLy8JbWFwOiBPYmplY3R8RnVuY3Rpb24NCgkJLy8JCUlmIGFuIG9iamVjdCwgaXQgaXMgdXNlZCBhcyBhIGRpY3Rpb25hcnkgdG8gbG9vayB1cCBzdWJzdGl0dXRpb25zLg0KCQkvLwkJSWYgYSBmdW5jdGlvbiwgaXQgaXMgY2FsbGVkIGZvciBldmVyeSBzdWJzdGl0dXRpb24gd2l0aCBmb2xsb3dpbmcNCgkJLy8JCXBhcmFtZXRlcnM6IGEgd2hvbGUgbWF0Y2gsIGEgbmFtZSwgYW4gb2Zmc2V0LCBhbmQgdGhlIHdob2xlIHRlbXBsYXRlDQoJCS8vCQlzdHJpbmcgKHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9TdHJpbmcvcmVwbGFjZQ0KCQkvLwkJZm9yIG1vcmUgZGV0YWlscykuDQoJCS8vCXBhdHRlcm46IFJlZ0V4Pw0KCQkvLwkJT3B0aW9uYWwgcmVndWxhciBleHByZXNzaW9uIG9iamVjdHMgdGhhdCBvdmVycmlkZXMgdGhlIGRlZmF1bHQgcGF0dGVybi4NCgkJLy8JCU11c3QgYmUgZ2xvYmFsIGFuZCBtYXRjaCBvbmUgaXRlbS4gVGhlIGRlZmF1bHQgaXM6IC9ceyhbXlx9XSspXH0vZywNCgkJLy8JCXdoaWNoIG1hdGNoZXMgcGF0dGVybnMgbGlrZSB0aGF0OiAie3h4eH0iLCB3aGVyZSAieHh4IiBpcyBhbnkgc2VxdWVuY2UNCgkJLy8JCW9mIGNoYXJhY3RlcnMsIHdoaWNoIGRvZXNuJ3QgaW5jbHVkZSAifSIuDQoJCS8vCXJldHVybnM6IFN0cmluZw0KCQkvLwkJUmV0dXJucyB0aGUgc3Vic3RpdHV0ZWQgc3RyaW5nLg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CS8vIHVzZXMgYSBkaWN0aW9uYXJ5IGZvciBzdWJzdGl0dXRpb25zOg0KCQkvLwl8CWRvam8ucmVwbGFjZSgiSGVsbG8sIHtuYW1lLmZpcnN0fSB7bmFtZS5sYXN0fSBBS0Ege25pY2t9ISIsDQoJCS8vCXwJICB7DQoJCS8vCXwJICAgIG5pY2s6ICJCb2IiLA0KCQkvLwl8CSAgICBuYW1lOiB7DQoJCS8vCXwJICAgICAgZmlyc3Q6ICAiUm9iZXJ0IiwNCgkJLy8JfAkgICAgICBtaWRkbGU6ICJYIiwNCgkJLy8JfAkgICAgICBsYXN0OiAgICJDcmluZ2VseSINCgkJLy8JfAkgICAgfQ0KCQkvLwl8CSAgfSk7DQoJCS8vCXwJLy8gcmV0dXJuczogSGVsbG8sIFJvYmVydCBDcmluZ2VseSBBS0EgQm9iIQ0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CS8vIHVzZXMgYW4gYXJyYXkgZm9yIHN1YnN0aXR1dGlvbnM6DQoJCS8vCXwJZG9qby5yZXBsYWNlKCJIZWxsbywgezB9IHsyfSEiLA0KCQkvLwl8CSAgWyJSb2JlcnQiLCAiWCIsICJDcmluZ2VseSJdKTsNCgkJLy8JfAkvLyByZXR1cm5zOiBIZWxsbywgUm9iZXJ0IENyaW5nZWx5IQ0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CS8vIHVzZXMgYSBmdW5jdGlvbiBmb3Igc3Vic3RpdHV0aW9uczoNCgkJLy8JfAlmdW5jdGlvbiBzdW0oYSl7DQoJCS8vCXwJICB2YXIgdCA9IDA7DQoJCS8vCXwJICBkb2pvLmZvckVhY2goYSwgZnVuY3Rpb24oeCl7IHQgKz0geDsgfSk7DQoJCS8vCXwJICByZXR1cm4gdDsNCgkJLy8JfAl9DQoJCS8vCXwJZG9qby5yZXBsYWNlKA0KCQkvLwl8CSAgIntjb3VudH0gcGF5bWVudHMgYXZlcmFnaW5nIHthdmd9IFVTRCBwZXIgcGF5bWVudC4iLA0KCQkvLwl8CSAgZG9qby5oaXRjaCgNCgkJLy8JfAkgICAgeyBwYXltZW50czogWzExLCAxNiwgMTJdIH0sDQoJCS8vCXwJICAgIGZ1bmN0aW9uKF8sIGtleSl7DQoJCS8vCXwJICAgICAgc3dpdGNoKGtleSl7DQoJCS8vCXwJICAgICAgICBjYXNlICJjb3VudCI6IHJldHVybiB0aGlzLnBheW1lbnRzLmxlbmd0aDsNCgkJLy8JfAkgICAgICAgIGNhc2UgIm1pbiI6ICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIHRoaXMucGF5bWVudHMpOw0KCQkvLwl8CSAgICAgICAgY2FzZSAibWF4IjogICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgdGhpcy5wYXltZW50cyk7DQoJCS8vCXwJICAgICAgICBjYXNlICJzdW0iOiAgIHJldHVybiBzdW0odGhpcy5wYXltZW50cyk7DQoJCS8vCXwJICAgICAgICBjYXNlICJhdmciOiAgIHJldHVybiBzdW0odGhpcy5wYXltZW50cykgLyB0aGlzLnBheW1lbnRzLmxlbmd0aDsNCgkJLy8JfAkgICAgICB9DQoJCS8vCXwJICAgIH0NCgkJLy8JfAkgICkNCgkJLy8JfAkpOw0KCQkvLwl8CS8vIHByaW50czogMyBwYXltZW50cyBhdmVyYWdpbmcgMTMgVVNEIHBlciBwYXltZW50Lg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CS8vIHVzZXMgYW4gYWx0ZXJuYXRpdmUgUEhQLWxpa2UgcGF0dGVybiBmb3Igc3Vic3RpdHV0aW9uczoNCgkJLy8JfAlkb2pvLnJlcGxhY2UoIkhlbGxvLCAkezB9ICR7Mn0hIiwNCgkJLy8JfAkgIFsiUm9iZXJ0IiwgIlgiLCAiQ3JpbmdlbHkiXSwgL1wkXHsoW15cfV0rKVx9L2cpOw0KCQkvLwl8CS8vIHJldHVybnM6IEhlbGxvLCBSb2JlcnQgQ3JpbmdlbHkhDQoJCXJldHVybiAiIjsJLy8gU3RyaW5nDQoJfQ0KCT09PT09Ki8NCg0KCXZhciBfcGF0dGVybiA9IC9ceyhbXlx9XSspXH0vZzsNCglkb2pvLnJlcGxhY2UgPSBmdW5jdGlvbih0bXBsLCBtYXAsIHBhdHRlcm4pew0KCQlyZXR1cm4gdG1wbC5yZXBsYWNlKHBhdHRlcm4gfHwgX3BhdHRlcm4sIGQuaXNGdW5jdGlvbihtYXApID8NCgkJCW1hcCA6IGZ1bmN0aW9uKF8sIGspeyByZXR1cm4gZC5nZXRPYmplY3QoaywgZmFsc2UsIG1hcCk7IH0pOw0KCX07DQp9KSgpOw0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5hcnJheSJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5hcnJheSJdID0gdHJ1ZTsNCg0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmFycmF5Iik7DQoNCihmdW5jdGlvbigpew0KCXZhciBfZ2V0UGFydHMgPSBmdW5jdGlvbihhcnIsIG9iaiwgY2Ipew0KCQlyZXR1cm4gWyANCgkJCSh0eXBlb2YgYXJyID09ICJzdHJpbmciKSA/IGFyci5zcGxpdCgiIikgOiBhcnIsIA0KCQkJb2JqIHx8IGRvam8uZ2xvYmFsLA0KCQkJLy8gRklYTUU6IGNhY2hlIHRoZSBhbm9ueW1vdXMgZnVuY3Rpb25zIHdlIGNyZWF0ZSBoZXJlPw0KCQkJKHR5cGVvZiBjYiA9PSAic3RyaW5nIikgPyBuZXcgRnVuY3Rpb24oIml0ZW0iLCAiaW5kZXgiLCAiYXJyYXkiLCBjYikgOiBjYg0KCQldOw0KCX07DQoNCgl2YXIgZXZlcnlPclNvbWUgPSBmdW5jdGlvbigvKkJvb2xlYW4qL2V2ZXJ5LCAvKkFycmF5fFN0cmluZyovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qT2JqZWN0PyovdGhpc09iamVjdCl7DQoJCXZhciBfcCA9IF9nZXRQYXJ0cyhhcnIsIHRoaXNPYmplY3QsIGNhbGxiYWNrKTsgYXJyID0gX3BbMF07DQoJCWZvcih2YXIgaT0wLGw9YXJyLmxlbmd0aDsgaTxsOyArK2kpew0KCQkJdmFyIHJlc3VsdCA9ICEhX3BbMl0uY2FsbChfcFsxXSwgYXJyW2ldLCBpLCBhcnIpOw0KCQkJaWYoZXZlcnkgXiByZXN1bHQpew0KCQkJCXJldHVybiByZXN1bHQ7IC8vIEJvb2xlYW4NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gZXZlcnk7IC8vIEJvb2xlYW4NCgl9Ow0KDQoJZG9qby5taXhpbihkb2pvLCB7DQoJCWluZGV4T2Y6IGZ1bmN0aW9uKAkvKkFycmF5Ki8JCWFycmF5LCANCgkJCQkJCQkvKk9iamVjdCovCQl2YWx1ZSwNCgkJCQkJCQkvKkludGVnZXI/Ki8JZnJvbUluZGV4LA0KCQkJCQkJCS8qQm9vbGVhbj8qLwlmaW5kTGFzdCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCWxvY2F0ZXMgdGhlIGZpcnN0IGluZGV4IG9mIHRoZSBwcm92aWRlZCB2YWx1ZSBpbiB0aGUNCgkJCS8vCQlwYXNzZWQgYXJyYXkuIElmIHRoZSB2YWx1ZSBpcyBub3QgZm91bmQsIC0xIGlzIHJldHVybmVkLg0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBtZXRob2QgY29ycmVzcG9uZHMgdG8gdGhlIEphdmFTY3JpcHQgMS42IEFycmF5LmluZGV4T2YgbWV0aG9kLCB3aXRoIG9uZSBkaWZmZXJlbmNlOiB3aGVuDQoJCQkvLwkJcnVuIG92ZXIgc3BhcnNlIGFycmF5cywgdGhlIERvam8gZnVuY3Rpb24gaW52b2tlcyB0aGUgY2FsbGJhY2sgZm9yIGV2ZXJ5IGluZGV4IHdoZXJlYXMgSmF2YVNjcmlwdCANCgkJCS8vCQkxLjYncyBpbmRleE9mIHNraXBzIHRoZSBob2xlcyBpbiB0aGUgc3BhcnNlIGFycmF5Lg0KCQkJLy8JCUZvciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLCBzZWU6DQoJCQkvLwkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvaW5kZXhPZg0KDQoJCQl2YXIgc3RlcCA9IDEsIGVuZCA9IGFycmF5Lmxlbmd0aCB8fCAwLCBpID0gMDsNCgkJCWlmKGZpbmRMYXN0KXsNCgkJCQlpID0gZW5kIC0gMTsNCgkJCQlzdGVwID0gZW5kID0gLTE7DQoJCQl9DQoJCQlpZihmcm9tSW5kZXggIT0gdW5kZWZpbmVkKXsgaSA9IGZyb21JbmRleDsgfQ0KCQkJaWYoKGZpbmRMYXN0ICYmIGkgPiBlbmQpIHx8IGkgPCBlbmQpew0KCQkJCWZvcig7IGkgIT0gZW5kOyBpICs9IHN0ZXApew0KCQkJCQlpZihhcnJheVtpXSA9PSB2YWx1ZSl7IHJldHVybiBpOyB9DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIC0xOwkvLyBOdW1iZXINCgkJfSwNCg0KCQlsYXN0SW5kZXhPZjogZnVuY3Rpb24oLypBcnJheSovYXJyYXksIC8qT2JqZWN0Ki92YWx1ZSwgLypJbnRlZ2VyPyovZnJvbUluZGV4KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJbG9jYXRlcyB0aGUgbGFzdCBpbmRleCBvZiB0aGUgcHJvdmlkZWQgdmFsdWUgaW4gdGhlIHBhc3NlZA0KCQkJLy8JCWFycmF5LiBJZiB0aGUgdmFsdWUgaXMgbm90IGZvdW5kLCAtMSBpcyByZXR1cm5lZC4NCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgbWV0aG9kIGNvcnJlc3BvbmRzIHRvIHRoZSBKYXZhU2NyaXB0IDEuNiBBcnJheS5sYXN0SW5kZXhPZiBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4NCgkJCS8vCQlydW4gb3ZlciBzcGFyc2UgYXJyYXlzLCB0aGUgRG9qbyBmdW5jdGlvbiBpbnZva2VzIHRoZSBjYWxsYmFjayBmb3IgZXZlcnkgaW5kZXggd2hlcmVhcyBKYXZhU2NyaXB0IA0KCQkJLy8JCTEuNidzIGxhc3RJbmRleE9mIHNraXBzIHRoZSBob2xlcyBpbiB0aGUgc3BhcnNlIGFycmF5Lg0KCQkJLy8JCUZvciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLCBzZWU6DQoJCQkvLyAJCQlodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZS9PYmplY3RzL0FycmF5L2xhc3RJbmRleE9mDQoJCQlyZXR1cm4gZG9qby5pbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4LCB0cnVlKTsgLy8gTnVtYmVyDQoJCX0sDQoNCgkJZm9yRWFjaDogZnVuY3Rpb24oLypBcnJheXxTdHJpbmcqL2FyciwgLypGdW5jdGlvbnxTdHJpbmcqL2NhbGxiYWNrLCAvKk9iamVjdD8qL3RoaXNPYmplY3Qpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlmb3IgZXZlcnkgaXRlbSBpbiBhcnIsIGNhbGxiYWNrIGlzIGludm9rZWQuIFJldHVybiB2YWx1ZXMgYXJlIGlnbm9yZWQuDQoJCQkvLwkJSWYgeW91IHdhbnQgdG8gYnJlYWsgb3V0IG9mIHRoZSBsb29wLCBjb25zaWRlciB1c2luZyBkb2pvLmV2ZXJ5KCkgb3IgZG9qby5zb21lKCkuDQoJCQkvLwkJZm9yRWFjaCBkb2VzIG5vdCBhbGxvdyBicmVha2luZyBvdXQgb2YgdGhlIGxvb3Agb3ZlciB0aGUgaXRlbXMgaW4gYXJyLg0KCQkJLy8JYXJyOg0KCQkJLy8JCXRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuIElmIGEgc3RyaW5nLCBvcGVyYXRlcyBvbiBpbmRpdmlkdWFsIGNoYXJhY3RlcnMuDQoJCQkvLwljYWxsYmFjazoNCgkJCS8vCQlhIGZ1bmN0aW9uIGlzIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6IGl0ZW0sIGluZGV4LCBhbmQgYXJyYXkNCgkJCS8vCXRoaXNPYmplY3Q6DQoJCQkvLwkJbWF5IGJlIHVzZWQgdG8gc2NvcGUgdGhlIGNhbGwgdG8gY2FsbGJhY2sNCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gdGhlIEphdmFTY3JpcHQgMS42IEFycmF5LmZvckVhY2goKSBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4gDQoJCQkvLwkJcnVuIG92ZXIgc3BhcnNlIGFycmF5cywgdGhpcyBpbXBsZW1lbmF0aW9uIHBhc3NlcyB0aGUgImhvbGVzIiBpbiB0aGUgc3BhcnNlIGFycmF5IHRvDQoJCQkvLwkJdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpdGggYSB2YWx1ZSBvZiB1bmRlZmluZWQuIEphdmFTY3JpcHQgMS42J3MgZm9yRWFjaCBza2lwcyB0aGUgaG9sZXMgaW4gdGhlIHNwYXJzZSBhcnJheS4NCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzLCBzZWU6DQoJCQkvLwkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvZm9yRWFjaA0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJLy8gbG9nIG91dCBhbGwgbWVtYmVycyBvZiB0aGUgYXJyYXk6DQoJCQkvLwl8CWRvam8uZm9yRWFjaCgNCgkJCS8vCXwJCVsgInRoaW5nZXIiLCAiYmxhaCIsICJob3dkeSIsIDEwIF0sDQoJCQkvLwl8CQlmdW5jdGlvbihpdGVtKXsNCgkJCS8vCXwJCQljb25zb2xlLmxvZyhpdGVtKTsNCgkJCS8vCXwJCX0NCgkJCS8vCXwJKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwl8CS8vIGxvZyBvdXQgdGhlIG1lbWJlcnMgYW5kIHRoZWlyIGluZGV4ZXMNCgkJCS8vCXwJZG9qby5mb3JFYWNoKA0KCQkJLy8JfAkJWyAidGhpbmdlciIsICJibGFoIiwgImhvd2R5IiwgMTAgXSwNCgkJCS8vCXwJCWZ1bmN0aW9uKGl0ZW0sIGlkeCwgYXJyKXsNCgkJCS8vCXwJCQljb25zb2xlLmxvZyhpdGVtLCAiYXQgaW5kZXg6IiwgaWR4KTsNCgkJCS8vCXwJCX0NCgkJCS8vCXwJKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwl8CS8vIHVzZSBhIHNjb3BlZCBvYmplY3QgbWVtYmVyIGFzIHRoZSBjYWxsYmFjaw0KCQkJLy8JfAkNCgkJCS8vCXwJdmFyIG9iaiA9IHsNCgkJCS8vCXwJCXByZWZpeDogImxvZ2dlZCB2aWEgb2JqLmNhbGxiYWNrOiIsIA0KCQkJLy8JfAkJY2FsbGJhY2s6IGZ1bmN0aW9uKGl0ZW0pew0KCQkJLy8JfAkJCWNvbnNvbGUubG9nKHRoaXMucHJlZml4LCBpdGVtKTsNCgkJCS8vCXwJCX0NCgkJCS8vCXwJfTsNCgkJCS8vCXwJDQoJCQkvLwl8CS8vIHNwZWNpZnlpbmcgdGhlIHNjb3BlIGZ1bmN0aW9uIGV4ZWN1dGVzIHRoZSBjYWxsYmFjayBpbiB0aGF0IHNjb3BlDQoJCQkvLwl8CWRvam8uZm9yRWFjaCgNCgkJCS8vCXwJCVsgInRoaW5nZXIiLCAiYmxhaCIsICJob3dkeSIsIDEwIF0sDQoJCQkvLwl8CQlvYmouY2FsbGJhY2ssDQoJCQkvLwl8CQlvYmoNCgkJCS8vCXwJKTsNCgkJCS8vCXwJDQoJCQkvLwl8CS8vIGFsdGVybmF0ZWx5LCB3ZSBjYW4gYWNjb21wbGlzaCB0aGUgc2FtZSB0aGluZyB3aXRoIGRvam8uaGl0Y2goKQ0KCQkJLy8JfAlkb2pvLmZvckVhY2goDQoJCQkvLwl8CQlbICJ0aGluZ2VyIiwgImJsYWgiLCAiaG93ZHkiLCAxMCBdLA0KCQkJLy8JfAkJZG9qby5oaXRjaChvYmosICJjYWxsYmFjayIpDQoJCQkvLwl8CSk7DQoNCgkJCS8vIG1hdGNoIHRoZSBiZWhhdmlvciBvZiB0aGUgYnVpbHQtaW4gZm9yRWFjaCBXUlQgZW1wdHkgYXJycw0KCQkJaWYoIWFyciB8fCAhYXJyLmxlbmd0aCl7IHJldHVybjsgfQ0KDQoJCQkvLyBGSVhNRTogdGhlcmUgYXJlIHNldmVyYWwgd2F5cyBvZiBoYW5kaWxuZyB0aGlzT2JqZWN0LiBJcw0KCQkJLy8gZG9qby5nbG9iYWwgYWx3YXlzIHRoZSBkZWZhdWx0IGNvbnRleHQ/DQoJCQl2YXIgX3AgPSBfZ2V0UGFydHMoYXJyLCB0aGlzT2JqZWN0LCBjYWxsYmFjayk7IGFyciA9IF9wWzBdOw0KCQkJZm9yKHZhciBpPTAsbD1hcnIubGVuZ3RoOyBpPGw7ICsraSl7IA0KCQkJCV9wWzJdLmNhbGwoX3BbMV0sIGFycltpXSwgaSwgYXJyKTsNCgkJCX0NCgkJfSwNCg0KCQlldmVyeTogZnVuY3Rpb24oLypBcnJheXxTdHJpbmcqL2FyciwgLypGdW5jdGlvbnxTdHJpbmcqL2NhbGxiYWNrLCAvKk9iamVjdD8qL3RoaXNPYmplY3Qpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlEZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IGV2ZXJ5IGl0ZW0gaW4gYXJyIHNhdGlzZmllcyB0aGUNCgkJCS8vCQljb25kaXRpb24gaW1wbGVtZW50ZWQgYnkgY2FsbGJhY2suDQoJCQkvLyBhcnI6DQoJCQkvLwkJdGhlIGFycmF5IHRvIGl0ZXJhdGUgb24uIElmIGEgc3RyaW5nLCBvcGVyYXRlcyBvbiBpbmRpdmlkdWFsIGNoYXJhY3RlcnMuDQoJCQkvLyBjYWxsYmFjazoNCgkJCS8vCQlhIGZ1bmN0aW9uIGlzIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6IGl0ZW0sIGluZGV4LA0KCQkJLy8JCWFuZCBhcnJheSBhbmQgcmV0dXJucyB0cnVlIGlmIHRoZSBjb25kaXRpb24gaXMgbWV0Lg0KCQkJLy8gdGhpc09iamVjdDoNCgkJCS8vCQltYXkgYmUgdXNlZCB0byBzY29wZSB0aGUgY2FsbCB0byBjYWxsYmFjaw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBmdW5jdGlvbiBjb3JyZXNwb25kcyB0byB0aGUgSmF2YVNjcmlwdCAxLjYgQXJyYXkuZXZlcnkoKSBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4gDQoJCQkvLwkJcnVuIG92ZXIgc3BhcnNlIGFycmF5cywgdGhpcyBpbXBsZW1lbmF0aW9uIHBhc3NlcyB0aGUgImhvbGVzIiBpbiB0aGUgc3BhcnNlIGFycmF5IHRvDQoJCQkvLwkJdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpdGggYSB2YWx1ZSBvZiB1bmRlZmluZWQuIEphdmFTY3JpcHQgMS42J3MgZXZlcnkgc2tpcHMgdGhlIGhvbGVzIGluIHRoZSBzcGFyc2UgYXJyYXkuDQoJCQkvLwkJRm9yIG1vcmUgZGV0YWlscywgc2VlOg0KCQkJLy8JCQlodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZS9PYmplY3RzL0FycmF5L2V2ZXJ5DQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAkvLyByZXR1cm5zIGZhbHNlDQoJCQkvLwl8CWRvam8uZXZlcnkoWzEsIDIsIDMsIDRdLCBmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0+MTsgfSk7DQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAkvLyByZXR1cm5zIHRydWUgDQoJCQkvLwl8CWRvam8uZXZlcnkoWzEsIDIsIDMsIDRdLCBmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0+MDsgfSk7DQoJCQlyZXR1cm4gZXZlcnlPclNvbWUodHJ1ZSwgYXJyLCBjYWxsYmFjaywgdGhpc09iamVjdCk7IC8vIEJvb2xlYW4NCgkJfSwNCg0KCQlzb21lOiBmdW5jdGlvbigvKkFycmF5fFN0cmluZyovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qT2JqZWN0PyovdGhpc09iamVjdCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCURldGVybWluZXMgd2hldGhlciBvciBub3QgYW55IGl0ZW0gaW4gYXJyIHNhdGlzZmllcyB0aGUNCgkJCS8vCQljb25kaXRpb24gaW1wbGVtZW50ZWQgYnkgY2FsbGJhY2suDQoJCQkvLyBhcnI6DQoJCQkvLwkJdGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4gSWYgYSBzdHJpbmcsIG9wZXJhdGVzIG9uIGluZGl2aWR1YWwgY2hhcmFjdGVycy4NCgkJCS8vIGNhbGxiYWNrOg0KCQkJLy8JCWEgZnVuY3Rpb24gaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogaXRlbSwgaW5kZXgsDQoJCQkvLwkJYW5kIGFycmF5IGFuZCByZXR1cm5zIHRydWUgaWYgdGhlIGNvbmRpdGlvbiBpcyBtZXQuDQoJCQkvLyB0aGlzT2JqZWN0Og0KCQkJLy8JCW1heSBiZSB1c2VkIHRvIHNjb3BlIHRoZSBjYWxsIHRvIGNhbGxiYWNrDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGlzIGZ1bmN0aW9uIGNvcnJlc3BvbmRzIHRvIHRoZSBKYXZhU2NyaXB0IDEuNiBBcnJheS5zb21lKCkgbWV0aG9kLCB3aXRoIG9uZSBkaWZmZXJlbmNlOiB3aGVuIA0KCQkJLy8JCXJ1biBvdmVyIHNwYXJzZSBhcnJheXMsIHRoaXMgaW1wbGVtZW5hdGlvbiBwYXNzZXMgdGhlICJob2xlcyIgaW4gdGhlIHNwYXJzZSBhcnJheSB0bw0KCQkJLy8JCXRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIGEgdmFsdWUgb2YgdW5kZWZpbmVkLiBKYXZhU2NyaXB0IDEuNidzIHNvbWUgc2tpcHMgdGhlIGhvbGVzIGluIHRoZSBzcGFyc2UgYXJyYXkuDQoJCQkvLwkJRm9yIG1vcmUgZGV0YWlscywgc2VlOg0KCQkJLy8JCQlodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZS9PYmplY3RzL0FycmF5L3NvbWUNCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CS8vIGlzIHRydWUNCgkJCS8vCXwJZG9qby5zb21lKFsxLCAyLCAzLCA0XSwgZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtPjE7IH0pOw0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJLy8gaXMgZmFsc2UNCgkJCS8vCXwJZG9qby5zb21lKFsxLCAyLCAzLCA0XSwgZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtPDE7IH0pOw0KCQkJcmV0dXJuIGV2ZXJ5T3JTb21lKGZhbHNlLCBhcnIsIGNhbGxiYWNrLCB0aGlzT2JqZWN0KTsgLy8gQm9vbGVhbg0KCQl9LA0KDQoJCW1hcDogZnVuY3Rpb24oLypBcnJheXxTdHJpbmcqL2FyciwgLypGdW5jdGlvbnxTdHJpbmcqL2NhbGxiYWNrLCAvKkZ1bmN0aW9uPyovdGhpc09iamVjdCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCWFwcGxpZXMgY2FsbGJhY2sgdG8gZWFjaCBlbGVtZW50IG9mIGFyciBhbmQgcmV0dXJucw0KCQkJLy8JCWFuIEFycmF5IHdpdGggdGhlIHJlc3VsdHMNCgkJCS8vIGFycjoNCgkJCS8vCQl0aGUgYXJyYXkgdG8gaXRlcmF0ZSBvbi4gSWYgYSBzdHJpbmcsIG9wZXJhdGVzIG9uDQoJCQkvLwkJaW5kaXZpZHVhbCBjaGFyYWN0ZXJzLg0KCQkJLy8gY2FsbGJhY2s6DQoJCQkvLwkJYSBmdW5jdGlvbiBpcyBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzLCAoaXRlbSwgaW5kZXgsDQoJCQkvLwkJYXJyYXkpLCAgYW5kIHJldHVybnMgYSB2YWx1ZQ0KCQkJLy8gdGhpc09iamVjdDoNCgkJCS8vCQltYXkgYmUgdXNlZCB0byBzY29wZSB0aGUgY2FsbCB0byBjYWxsYmFjaw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBmdW5jdGlvbiBjb3JyZXNwb25kcyB0byB0aGUgSmF2YVNjcmlwdCAxLjYgQXJyYXkubWFwKCkgbWV0aG9kLCB3aXRoIG9uZSBkaWZmZXJlbmNlOiB3aGVuIA0KCQkJLy8JCXJ1biBvdmVyIHNwYXJzZSBhcnJheXMsIHRoaXMgaW1wbGVtZW5hdGlvbiBwYXNzZXMgdGhlICJob2xlcyIgaW4gdGhlIHNwYXJzZSBhcnJheSB0bw0KCQkJLy8JCXRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIGEgdmFsdWUgb2YgdW5kZWZpbmVkLiBKYXZhU2NyaXB0IDEuNidzIG1hcCBza2lwcyB0aGUgaG9sZXMgaW4gdGhlIHNwYXJzZSBhcnJheS4NCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzLCBzZWU6DQoJCQkvLwkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvbWFwDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAkvLyByZXR1cm5zIFsyLCAzLCA0LCA1XQ0KCQkJLy8JfAlkb2pvLm1hcChbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbSsxIH0pOw0KDQoJCQl2YXIgX3AgPSBfZ2V0UGFydHMoYXJyLCB0aGlzT2JqZWN0LCBjYWxsYmFjayk7IGFyciA9IF9wWzBdOw0KCQkJdmFyIG91dEFyciA9IChhcmd1bWVudHNbM10gPyAobmV3IGFyZ3VtZW50c1szXSgpKSA6IFtdKTsNCgkJCWZvcih2YXIgaT0wLGw9YXJyLmxlbmd0aDsgaTxsOyArK2kpew0KCQkJCW91dEFyci5wdXNoKF9wWzJdLmNhbGwoX3BbMV0sIGFycltpXSwgaSwgYXJyKSk7DQoJCQl9DQoJCQlyZXR1cm4gb3V0QXJyOyAvLyBBcnJheQ0KCQl9LA0KDQoJCWZpbHRlcjogZnVuY3Rpb24oLypBcnJheSovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qT2JqZWN0PyovdGhpc09iamVjdCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBuZXcgQXJyYXkgd2l0aCB0aG9zZSBpdGVtcyBmcm9tIGFyciB0aGF0IG1hdGNoIHRoZQ0KCQkJLy8JCWNvbmRpdGlvbiBpbXBsZW1lbnRlZCBieSBjYWxsYmFjay4NCgkJCS8vIGFycjoNCgkJCS8vCQl0aGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLg0KCQkJLy8gY2FsbGJhY2s6DQoJCQkvLwkJYSBmdW5jdGlvbiB0aGF0IGlzIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHMgKGl0ZW0sDQoJCQkvLwkJaW5kZXgsIGFycmF5KS4gVGhlIHJldHVybiBvZiB0aGlzIGZ1bmN0aW9uIGlzIGV4cGVjdGVkIHRvDQoJCQkvLwkJYmUgYSBib29sZWFuIHdoaWNoIGRldGVybWluZXMgd2hldGhlciB0aGUgcGFzc2VkLWluIGl0ZW0NCgkJCS8vCQl3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSByZXR1cm5lZCBhcnJheS4NCgkJCS8vIHRoaXNPYmplY3Q6DQoJCQkvLwkJbWF5IGJlIHVzZWQgdG8gc2NvcGUgdGhlIGNhbGwgdG8gY2FsbGJhY2sNCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gdGhlIEphdmFTY3JpcHQgMS42IEFycmF5LmZpbHRlcigpIG1ldGhvZCwgd2l0aCBvbmUgZGlmZmVyZW5jZTogd2hlbiANCgkJCS8vCQlydW4gb3ZlciBzcGFyc2UgYXJyYXlzLCB0aGlzIGltcGxlbWVuYXRpb24gcGFzc2VzIHRoZSAiaG9sZXMiIGluIHRoZSBzcGFyc2UgYXJyYXkgdG8NCgkJCS8vCQl0aGUgY2FsbGJhY2sgZnVuY3Rpb24gd2l0aCBhIHZhbHVlIG9mIHVuZGVmaW5lZC4gSmF2YVNjcmlwdCAxLjYncyBmaWx0ZXIgc2tpcHMgdGhlIGhvbGVzIGluIHRoZSBzcGFyc2UgYXJyYXkuIA0KCQkJLy8JCUZvciBtb3JlIGRldGFpbHMsIHNlZToNCgkJCS8vCQkJaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2UvT2JqZWN0cy9BcnJheS9maWx0ZXINCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CS8vIHJldHVybnMgWzIsIDMsIDRdDQoJCQkvLwl8CWRvam8uZmlsdGVyKFsxLCAyLCAzLCA0XSwgZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtPjE7IH0pOw0KDQoJCQl2YXIgX3AgPSBfZ2V0UGFydHMoYXJyLCB0aGlzT2JqZWN0LCBjYWxsYmFjayk7IGFyciA9IF9wWzBdOw0KCQkJdmFyIG91dEFyciA9IFtdOw0KCQkJZm9yKHZhciBpPTAsbD1hcnIubGVuZ3RoOyBpPGw7ICsraSl7DQoJCQkJaWYoX3BbMl0uY2FsbChfcFsxXSwgYXJyW2ldLCBpLCBhcnIpKXsNCgkJCQkJb3V0QXJyLnB1c2goYXJyW2ldKTsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gb3V0QXJyOyAvLyBBcnJheQ0KCQl9DQoJfSk7DQp9KSgpOw0KLyoNCiovDQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmRlY2xhcmUiXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuZGVjbGFyZSJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5kZWNsYXJlIik7DQoNCg0KDQoNCihmdW5jdGlvbigpew0KCXZhciBkID0gZG9qbywgbWl4ID0gZC5fbWl4aW4sIG9wID0gT2JqZWN0LnByb3RvdHlwZSwgb3B0cyA9IG9wLnRvU3RyaW5nLA0KCQl4dG9yID0gbmV3IEZ1bmN0aW9uLCBjb3VudGVyID0gMCwgY25hbWUgPSAiY29uc3RydWN0b3IiOw0KDQoJZnVuY3Rpb24gZXJyKG1zZyl7IHRocm93IG5ldyBFcnJvcigiZGVjbGFyZTogIiArIG1zZyk7IH0NCg0KCS8vIEMzIE1ldGhvZCBSZXNvbHV0aW9uIE9yZGVyIChzZWUgaHR0cDovL3d3dy5weXRob24ub3JnL2Rvd25sb2FkL3JlbGVhc2VzLzIuMy9tcm8vKQ0KCWZ1bmN0aW9uIGMzbXJvKGJhc2VzKXsNCgkJdmFyIHJlc3VsdCA9IFtdLCByb290cyA9IFt7Y2xzOiAwLCByZWZzOiBbXX1dLCBuYW1lTWFwID0ge30sIGNsc0NvdW50ID0gMSwNCgkJCWwgPSBiYXNlcy5sZW5ndGgsIGkgPSAwLCBqLCBsaW4sIGJhc2UsIHRvcCwgcHJvdG8sIHJlYywgbmFtZSwgcmVmczsNCg0KCQkvLyBidWlsZCBhIGxpc3Qgb2YgYmFzZXMgbmFtaW5nIHRoZW0gaWYgbmVlZGVkDQoJCWZvcig7IGkgPCBsOyArK2kpew0KCQkJYmFzZSA9IGJhc2VzW2ldOw0KCQkJaWYoIWJhc2Upew0KCQkJCWVycigibWl4aW4gIyIgKyBpICsgIiBpcyB1bmtub3duLiBEaWQgeW91IHVzZSBkb2pvLnJlcXVpcmUgdG8gcHVsbCBpdCBpbj8iKTsNCgkJCX1lbHNlIGlmKG9wdHMuY2FsbChiYXNlKSAhPSAiW29iamVjdCBGdW5jdGlvbl0iKXsNCgkJCQllcnIoIm1peGluICMiICsgaSArICIgaXMgbm90IGEgY2FsbGFibGUgY29uc3RydWN0b3IuIik7DQoJCQl9DQoJCQlsaW4gPSBiYXNlLl9tZXRhID8gYmFzZS5fbWV0YS5iYXNlcyA6IFtiYXNlXTsNCgkJCXRvcCA9IDA7DQoJCQkvLyBhZGQgYmFzZXMgdG8gdGhlIG5hbWUgbWFwDQoJCQlmb3IoaiA9IGxpbi5sZW5ndGggLSAxOyBqID49IDA7IC0tail7DQoJCQkJcHJvdG8gPSBsaW5bal0ucHJvdG90eXBlOw0KCQkJCWlmKCFwcm90by5oYXNPd25Qcm9wZXJ0eSgiZGVjbGFyZWRDbGFzcyIpKXsNCgkJCQkJcHJvdG8uZGVjbGFyZWRDbGFzcyA9ICJ1bmlxTmFtZV8iICsgKGNvdW50ZXIrKyk7DQoJCQkJfQ0KCQkJCW5hbWUgPSBwcm90by5kZWNsYXJlZENsYXNzOw0KCQkJCWlmKCFuYW1lTWFwLmhhc093blByb3BlcnR5KG5hbWUpKXsNCgkJCQkJbmFtZU1hcFtuYW1lXSA9IHtjb3VudDogMCwgcmVmczogW10sIGNsczogbGluW2pdfTsNCgkJCQkJKytjbHNDb3VudDsNCgkJCQl9DQoJCQkJcmVjID0gbmFtZU1hcFtuYW1lXTsNCgkJCQlpZih0b3AgJiYgdG9wICE9PSByZWMpew0KCQkJCQlyZWMucmVmcy5wdXNoKHRvcCk7DQoJCQkJCSsrdG9wLmNvdW50Ow0KCQkJCX0NCgkJCQl0b3AgPSByZWM7DQoJCQl9DQoJCQkrK3RvcC5jb3VudDsNCgkJCXJvb3RzWzBdLnJlZnMucHVzaCh0b3ApOw0KCQl9DQoNCgkJLy8gcmVtb3ZlIGNsYXNzZXMgd2l0aG91dCBleHRlcm5hbCByZWZlcmVuY2VzIHJlY3Vyc2l2ZWx5DQoJCXdoaWxlKHJvb3RzLmxlbmd0aCl7DQoJCQl0b3AgPSByb290cy5wb3AoKTsNCgkJCXJlc3VsdC5wdXNoKHRvcC5jbHMpOw0KCQkJLS1jbHNDb3VudDsNCgkJCS8vIG9wdGltaXphdGlvbjogZm9sbG93IGEgc2luZ2xlLWxpbmtlZCBjaGFpbg0KCQkJd2hpbGUocmVmcyA9IHRvcC5yZWZzLCByZWZzLmxlbmd0aCA9PSAxKXsNCgkJCQl0b3AgPSByZWZzWzBdOw0KCQkJCWlmKCF0b3AgfHwgLS10b3AuY291bnQpew0KCQkJCQkvLyBicmFuY2ggb3IgZW5kIG9mIGNoYWluID0+IGRvIG5vdCBlbmQgdG8gcm9vdHMNCgkJCQkJdG9wID0gMDsNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJCXJlc3VsdC5wdXNoKHRvcC5jbHMpOw0KCQkJCS0tY2xzQ291bnQ7DQoJCQl9DQoJCQlpZih0b3Apew0KCQkJCS8vIGJyYW5jaA0KCQkJCWZvcihpID0gMCwgbCA9IHJlZnMubGVuZ3RoOyBpIDwgbDsgKytpKXsNCgkJCQkJdG9wID0gcmVmc1tpXTsNCgkJCQkJaWYoIS0tdG9wLmNvdW50KXsNCgkJCQkJCXJvb3RzLnB1c2godG9wKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlpZihjbHNDb3VudCl7DQoJCQllcnIoImNhbid0IGJ1aWxkIGNvbnNpc3RlbnQgbGluZWFyaXphdGlvbiIpOw0KCQl9DQoNCgkJLy8gY2FsY3VsYXRlIHRoZSBzdXBlcmNsYXNzIG9mZnNldA0KCQliYXNlID0gYmFzZXNbMF07DQoJCXJlc3VsdFswXSA9IGJhc2UgPw0KCQkJYmFzZS5fbWV0YSAmJiBiYXNlID09PSByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIGJhc2UuX21ldGEuYmFzZXMubGVuZ3RoXSA/DQoJCQkJYmFzZS5fbWV0YS5iYXNlcy5sZW5ndGggOiAxIDogMDsNCg0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCg0KCWZ1bmN0aW9uIGluaGVyaXRlZChhcmdzLCBhLCBmKXsNCgkJdmFyIG5hbWUsIGNoYWlucywgYmFzZXMsIGNhbGxlciwgbWV0YSwgYmFzZSwgcHJvdG8sIG9wZiwgcG9zLA0KCQkJY2FjaGUgPSB0aGlzLl9pbmhlcml0ZWQgPSB0aGlzLl9pbmhlcml0ZWQgfHwge307DQoNCgkJLy8gY3JhY2sgYXJndW1lbnRzDQoJCWlmKHR5cGVvZiBhcmdzID09ICJzdHJpbmciKXsNCgkJCW5hbWUgPSBhcmdzOw0KCQkJYXJncyA9IGE7DQoJCQlhID0gZjsNCgkJfQ0KCQlmID0gMDsNCg0KCQljYWxsZXIgPSBhcmdzLmNhbGxlZTsNCgkJbmFtZSA9IG5hbWUgfHwgY2FsbGVyLm5vbTsNCgkJaWYoIW5hbWUpew0KCQkJZXJyKCJjYW4ndCBkZWR1Y2UgYSBuYW1lIHRvIGNhbGwgaW5oZXJpdGVkKCkiKTsNCgkJfQ0KDQoJCW1ldGEgPSB0aGlzLmNvbnN0cnVjdG9yLl9tZXRhOw0KCQliYXNlcyA9IG1ldGEuYmFzZXM7DQoNCgkJcG9zID0gY2FjaGUucDsNCgkJaWYobmFtZSAhPSBjbmFtZSl7DQoJCQkvLyBtZXRob2QNCgkJCWlmKGNhY2hlLmMgIT09IGNhbGxlcil7DQoJCQkJLy8gY2FjaGUgYnVzdA0KCQkJCXBvcyA9IDA7DQoJCQkJYmFzZSA9IGJhc2VzWzBdOw0KCQkJCW1ldGEgPSBiYXNlLl9tZXRhOw0KCQkJCWlmKG1ldGEuaGlkZGVuW25hbWVdICE9PSBjYWxsZXIpew0KCQkJCQkvLyBlcnJvciBkZXRlY3Rpb24NCgkJCQkJY2hhaW5zID0gbWV0YS5jaGFpbnM7DQoJCQkJCWlmKGNoYWlucyAmJiB0eXBlb2YgY2hhaW5zW25hbWVdID09ICJzdHJpbmciKXsNCgkJCQkJCWVycigiY2FsbGluZyBjaGFpbmVkIG1ldGhvZCB3aXRoIGluaGVyaXRlZDogIiArIG5hbWUpOw0KCQkJCQl9DQoJCQkJCS8vIGZpbmQgY2FsbGVyDQoJCQkJCWRvew0KCQkJCQkJbWV0YSA9IGJhc2UuX21ldGE7DQoJCQkJCQlwcm90byA9IGJhc2UucHJvdG90eXBlOw0KCQkJCQkJaWYobWV0YSAmJiAocHJvdG9bbmFtZV0gPT09IGNhbGxlciAmJiBwcm90by5oYXNPd25Qcm9wZXJ0eShuYW1lKSB8fCBtZXRhLmhpZGRlbltuYW1lXSA9PT0gY2FsbGVyKSl7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCX13aGlsZShiYXNlID0gYmFzZXNbKytwb3NdKTsgLy8gaW50ZW50aW9uYWwgYXNzaWdubWVudA0KCQkJCQlwb3MgPSBiYXNlID8gcG9zIDogLTE7DQoJCQkJfQ0KCQkJfQ0KCQkJLy8gZmluZCBuZXh0DQoJCQliYXNlID0gYmFzZXNbKytwb3NdOw0KCQkJaWYoYmFzZSl7DQoJCQkJcHJvdG8gPSBiYXNlLnByb3RvdHlwZTsNCgkJCQlpZihiYXNlLl9tZXRhICYmIHByb3RvLmhhc093blByb3BlcnR5KG5hbWUpKXsNCgkJCQkJZiA9IHByb3RvW25hbWVdOw0KCQkJCX1lbHNlew0KCQkJCQlvcGYgPSBvcFtuYW1lXTsNCgkJCQkJZG97DQoJCQkJCQlwcm90byA9IGJhc2UucHJvdG90eXBlOw0KCQkJCQkJZiA9IHByb3RvW25hbWVdOw0KCQkJCQkJaWYoZiAmJiAoYmFzZS5fbWV0YSA/IHByb3RvLmhhc093blByb3BlcnR5KG5hbWUpIDogZiAhPT0gb3BmKSl7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCX13aGlsZShiYXNlID0gYmFzZXNbKytwb3NdKTsgLy8gaW50ZW50aW9uYWwgYXNzaWdubWVudA0KCQkJCX0NCgkJCX0NCgkJCWYgPSBiYXNlICYmIGYgfHwgb3BbbmFtZV07DQoJCX1lbHNlew0KCQkJLy8gY29uc3RydWN0b3INCgkJCWlmKGNhY2hlLmMgIT09IGNhbGxlcil7DQoJCQkJLy8gY2FjaGUgYnVzdA0KCQkJCXBvcyA9IDA7DQoJCQkJbWV0YSA9IGJhc2VzWzBdLl9tZXRhOw0KCQkJCWlmKG1ldGEgJiYgbWV0YS5jdG9yICE9PSBjYWxsZXIpew0KCQkJCQkvLyBlcnJvciBkZXRlY3Rpb24NCgkJCQkJY2hhaW5zID0gbWV0YS5jaGFpbnM7DQoJCQkJCWlmKCFjaGFpbnMgfHwgY2hhaW5zLmNvbnN0cnVjdG9yICE9PSAibWFudWFsIil7DQoJCQkJCQllcnIoImNhbGxpbmcgY2hhaW5lZCBjb25zdHJ1Y3RvciB3aXRoIGluaGVyaXRlZCIpOw0KCQkJCQl9DQoJCQkJCS8vIGZpbmQgY2FsbGVyDQoJCQkJCXdoaWxlKGJhc2UgPSBiYXNlc1srK3Bvc10peyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJCQltZXRhID0gYmFzZS5fbWV0YTsNCgkJCQkJCWlmKG1ldGEgJiYgbWV0YS5jdG9yID09PSBjYWxsZXIpew0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCXBvcyA9IGJhc2UgPyBwb3MgOiAtMTsNCgkJCQl9DQoJCQl9DQoJCQkvLyBmaW5kIG5leHQNCgkJCXdoaWxlKGJhc2UgPSBiYXNlc1srK3Bvc10pewkvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJbWV0YSA9IGJhc2UuX21ldGE7DQoJCQkJZiA9IG1ldGEgPyBtZXRhLmN0b3IgOiBiYXNlOw0KCQkJCWlmKGYpew0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQl9DQoJCQlmID0gYmFzZSAmJiBmOw0KCQl9DQoNCgkJLy8gY2FjaGUgdGhlIGZvdW5kIHN1cGVyIG1ldGhvZA0KCQljYWNoZS5jID0gZjsNCgkJY2FjaGUucCA9IHBvczsNCg0KCQkvLyBub3cgd2UgaGF2ZSB0aGUgcmVzdWx0DQoJCWlmKGYpew0KCQkJcmV0dXJuIGEgPT09IHRydWUgPyBmIDogZi5hcHBseSh0aGlzLCBhIHx8IGFyZ3MpOw0KCQl9DQoJCS8vIGludGVudGlvbmFsbHkgaWYgYSBzdXBlciBtZXRob2Qgd2FzIG5vdCBmb3VuZA0KCX0NCg0KCWZ1bmN0aW9uIGdldEluaGVyaXRlZChuYW1lLCBhcmdzKXsNCgkJaWYodHlwZW9mIG5hbWUgPT0gInN0cmluZyIpew0KCQkJcmV0dXJuIHRoaXMuaW5oZXJpdGVkKG5hbWUsIGFyZ3MsIHRydWUpOw0KCQl9DQoJCXJldHVybiB0aGlzLmluaGVyaXRlZChuYW1lLCB0cnVlKTsNCgl9DQoNCgkvLyBlbXVsYXRpb24gb2YgImluc3RhbmNlb2YiDQoJZnVuY3Rpb24gaXNJbnN0YW5jZU9mKGNscyl7DQoJCXZhciBiYXNlcyA9IHRoaXMuY29uc3RydWN0b3IuX21ldGEuYmFzZXM7DQoJCWZvcih2YXIgaSA9IDAsIGwgPSBiYXNlcy5sZW5ndGg7IGkgPCBsOyArK2kpew0KCQkJaWYoYmFzZXNbaV0gPT09IGNscyl7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBjbHM7DQoJfQ0KDQoJZnVuY3Rpb24gbWl4T3duKHRhcmdldCwgc291cmNlKXsNCgkJdmFyIG5hbWUsIGkgPSAwLCBsID0gZC5fZXh0cmFOYW1lcy5sZW5ndGg7DQoJCS8vIGFkZCBwcm9wcyBhZGRpbmcgbWV0YWRhdGEgZm9yIGluY29taW5nIGZ1bmN0aW9ucyBza2lwcGluZyBhIGNvbnN0cnVjdG9yDQoJCWZvcihuYW1lIGluIHNvdXJjZSl7DQoJCQlpZihuYW1lICE9IGNuYW1lICYmIHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSl7DQoJCQkJdGFyZ2V0W25hbWVdID0gc291cmNlW25hbWVdOw0KCQkJfQ0KCQl9DQoJCS8vIHByb2Nlc3MgdW5lbnVtZXJhYmxlIG1ldGhvZHMgb24gSUUNCgkJZm9yKDsgaSA8IGw7ICsraSl7DQoJCQluYW1lID0gZC5fZXh0cmFOYW1lc1tpXTsNCgkJCWlmKG5hbWUgIT0gY25hbWUgJiYgc291cmNlLmhhc093blByb3BlcnR5KG5hbWUpKXsNCgkJCQl0YXJnZXRbbmFtZV0gPSBzb3VyY2VbbmFtZV07DQoJCQl9DQoJCX0NCgl9DQoNCgkvLyBpbXBsZW1lbnRhdGlvbiBvZiBzYWZlIG1peGluIGZ1bmN0aW9uDQoJZnVuY3Rpb24gc2FmZU1peGluKHRhcmdldCwgc291cmNlKXsNCgkJdmFyIG5hbWUsIHQsIGkgPSAwLCBsID0gZC5fZXh0cmFOYW1lcy5sZW5ndGg7DQoJCS8vIGFkZCBwcm9wcyBhZGRpbmcgbWV0YWRhdGEgZm9yIGluY29taW5nIGZ1bmN0aW9ucyBza2lwcGluZyBhIGNvbnN0cnVjdG9yDQoJCWZvcihuYW1lIGluIHNvdXJjZSl7DQoJCQl0ID0gc291cmNlW25hbWVdOw0KCQkJaWYoKHQgIT09IG9wW25hbWVdIHx8ICEobmFtZSBpbiBvcCkpICYmIG5hbWUgIT0gY25hbWUpew0KCQkJCWlmKG9wdHMuY2FsbCh0KSA9PSAiW29iamVjdCBGdW5jdGlvbl0iKXsNCgkJCQkJLy8gbm9uLXRyaXZpYWwgZnVuY3Rpb24gbWV0aG9kID0+IGF0dGFjaCBpdHMgbmFtZQ0KCQkJCQl0Lm5vbSA9IG5hbWU7DQoJCQkJfQ0KCQkJCXRhcmdldFtuYW1lXSA9IHQ7DQoJCQl9DQoJCX0NCgkJLy8gcHJvY2VzcyB1bmVudW1lcmFibGUgbWV0aG9kcyBvbiBJRQ0KCQlmb3IoOyBpIDwgbDsgKytpKXsNCgkJCW5hbWUgPSBkLl9leHRyYU5hbWVzW2ldOw0KCQkJdCA9IHNvdXJjZVtuYW1lXTsNCgkJCWlmKCh0ICE9PSBvcFtuYW1lXSB8fCAhKG5hbWUgaW4gb3ApKSAmJiBuYW1lICE9IGNuYW1lKXsNCgkJCQlpZihvcHRzLmNhbGwodCkgPT0gIltvYmplY3QgRnVuY3Rpb25dIil7DQoJCQkJCS8vIG5vbi10cml2aWFsIGZ1bmN0aW9uIG1ldGhvZCA9PiBhdHRhY2ggaXRzIG5hbWUNCgkJCQkJdC5ub20gPSBuYW1lOw0KCQkJCX0NCgkJCQl0YXJnZXRbbmFtZV0gPSB0Ow0KCQkJfQ0KCQl9DQoJCXJldHVybiB0YXJnZXQ7DQoJfQ0KDQoJZnVuY3Rpb24gZXh0ZW5kKHNvdXJjZSl7DQoJCXNhZmVNaXhpbih0aGlzLnByb3RvdHlwZSwgc291cmNlKTsNCgkJcmV0dXJuIHRoaXM7DQoJfQ0KDQoJLy8gY2hhaW5lZCBjb25zdHJ1Y3RvciBjb21wYXRpYmxlIHdpdGggdGhlIGxlZ2FjeSBkb2pvLmRlY2xhcmUoKQ0KCWZ1bmN0aW9uIGNoYWluZWRDb25zdHJ1Y3RvcihiYXNlcywgY3RvclNwZWNpYWwpew0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBhID0gYXJndW1lbnRzLCBhcmdzID0gYSwgYTAgPSBhWzBdLCBmLCBpLCBtLA0KCQkJCWwgPSBiYXNlcy5sZW5ndGgsIHByZUFyZ3M7DQoNCgkJCWlmKCEodGhpcyBpbnN0YW5jZW9mIGEuY2FsbGVlKSl7DQoJCQkJLy8gbm90IGNhbGxlZCB2aWEgbmV3LCBzbyBmb3JjZSBpdA0KCQkJCXJldHVybiBhcHBseU5ldyhhKTsNCgkJCX0NCg0KCQkJLy90aGlzLl9pbmhlcml0ZWQgPSB7fTsNCgkJCS8vIHBlcmZvcm0gdGhlIHNoYW1hbidzIHJpdHVhbHMgb2YgdGhlIG9yaWdpbmFsIGRvam8uZGVjbGFyZSgpDQoJCQkvLyAxKSBjYWxsIHR3byB0eXBlcyBvZiB0aGUgcHJlYW1ibGUNCgkJCWlmKGN0b3JTcGVjaWFsICYmIChhMCAmJiBhMC5wcmVhbWJsZSB8fCB0aGlzLnByZWFtYmxlKSl7DQoJCQkJLy8gZnVsbCBibG93biByaXR1YWwNCgkJCQlwcmVBcmdzID0gbmV3IEFycmF5KGJhc2VzLmxlbmd0aCk7DQoJCQkJLy8gcHJlcGFyZSBwYXJhbWV0ZXJzDQoJCQkJcHJlQXJnc1swXSA9IGE7DQoJCQkJZm9yKGkgPSAwOzspew0KCQkJCQkvLyBwcm9jZXNzIHRoZSBwcmVhbWJsZSBvZiB0aGUgMXN0IGFyZ3VtZW50DQoJCQkJCWEwID0gYVswXTsNCgkJCQkJaWYoYTApew0KCQkJCQkJZiA9IGEwLnByZWFtYmxlOw0KCQkJCQkJaWYoZil7DQoJCQkJCQkJYSA9IGYuYXBwbHkodGhpcywgYSkgfHwgYTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkvLyBwcm9jZXNzIHRoZSBwcmVhbWJsZSBvZiB0aGlzIGNsYXNzDQoJCQkJCWYgPSBiYXNlc1tpXS5wcm90b3R5cGU7DQoJCQkJCWYgPSBmLmhhc093blByb3BlcnR5KCJwcmVhbWJsZSIpICYmIGYucHJlYW1ibGU7DQoJCQkJCWlmKGYpew0KCQkJCQkJYSA9IGYuYXBwbHkodGhpcywgYSkgfHwgYTsNCgkJCQkJfQ0KCQkJCQkvLyBvbmUgcGVjdWxpYXJpdHkgb2YgdGhlIHByZWFtYmxlOg0KCQkJCQkvLyBpdCBpcyBjYWxsZWQgaWYgaXQgaXMgbm90IG5lZWRlZCwNCgkJCQkJLy8gZS5nLiwgdGhlcmUgaXMgbm8gY29uc3RydWN0b3IgdG8gY2FsbA0KCQkJCQkvLyBsZXQncyB3YXRjaCBmb3IgdGhlIGxhc3QgY29uc3RydWN0b3INCgkJCQkJLy8gKHNlZSB0aWNrZXQgIzk3OTUpDQoJCQkJCWlmKCsraSA9PSBsKXsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJCXByZUFyZ3NbaV0gPSBhOw0KCQkJCX0NCgkJCX0NCgkJCS8vIDIpIGNhbGwgYWxsIG5vbi10cml2aWFsIGNvbnN0cnVjdG9ycyB1c2luZyBwcmVwYXJlZCBhcmd1bWVudHMNCgkJCWZvcihpID0gbCAtIDE7IGkgPj0gMDsgLS1pKXsNCgkJCQlmID0gYmFzZXNbaV07DQoJCQkJbSA9IGYuX21ldGE7DQoJCQkJZiA9IG0gPyBtLmN0b3IgOiBmOw0KCQkJCWlmKGYpew0KCQkJCQlmLmFwcGx5KHRoaXMsIHByZUFyZ3MgPyBwcmVBcmdzW2ldIDogYSk7DQoJCQkJfQ0KCQkJfQ0KCQkJLy8gMykgY29udGludWUgdGhlIG9yaWdpbmFsIHJpdHVhbDogY2FsbCB0aGUgcG9zdHNjcmlwdA0KCQkJZiA9IHRoaXMucG9zdHNjcmlwdDsNCgkJCWlmKGYpew0KCQkJCWYuYXBwbHkodGhpcywgYXJncyk7DQoJCQl9DQoJCX07DQoJfQ0KDQoNCgkvLyBjaGFpbmVkIGNvbnN0cnVjdG9yIGNvbXBhdGlibGUgd2l0aCB0aGUgbGVnYWN5IGRvam8uZGVjbGFyZSgpDQoJZnVuY3Rpb24gc2luZ2xlQ29uc3RydWN0b3IoY3RvciwgY3RvclNwZWNpYWwpew0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBhID0gYXJndW1lbnRzLCB0ID0gYSwgYTAgPSBhWzBdLCBmOw0KDQoJCQlpZighKHRoaXMgaW5zdGFuY2VvZiBhLmNhbGxlZSkpew0KCQkJCS8vIG5vdCBjYWxsZWQgdmlhIG5ldywgc28gZm9yY2UgaXQNCgkJCQlyZXR1cm4gYXBwbHlOZXcoYSk7DQoJCQl9DQoNCgkJCS8vdGhpcy5faW5oZXJpdGVkID0ge307DQoJCQkvLyBwZXJmb3JtIHRoZSBzaGFtYW4ncyByaXR1YWxzIG9mIHRoZSBvcmlnaW5hbCBkb2pvLmRlY2xhcmUoKQ0KCQkJLy8gMSkgY2FsbCB0d28gdHlwZXMgb2YgdGhlIHByZWFtYmxlDQoJCQlpZihjdG9yU3BlY2lhbCl7DQoJCQkJLy8gZnVsbCBibG93biByaXR1YWwNCgkJCQlpZihhMCl7DQoJCQkJCS8vIHByb2Nlc3MgdGhlIHByZWFtYmxlIG9mIHRoZSAxc3QgYXJndW1lbnQNCgkJCQkJZiA9IGEwLnByZWFtYmxlOw0KCQkJCQlpZihmKXsNCgkJCQkJCXQgPSBmLmFwcGx5KHRoaXMsIHQpIHx8IHQ7DQoJCQkJCX0NCgkJCQl9DQoJCQkJZiA9IHRoaXMucHJlYW1ibGU7DQoJCQkJaWYoZil7DQoJCQkJCS8vIHByb2Nlc3MgdGhlIHByZWFtYmxlIG9mIHRoaXMgY2xhc3MNCgkJCQkJZi5hcHBseSh0aGlzLCB0KTsNCgkJCQkJLy8gb25lIHBlY3VsaWFyaXR5IG9mIHRoZSBwcmVhbWJsZToNCgkJCQkJLy8gaXQgaXMgY2FsbGVkIGV2ZW4gaWYgaXQgaXMgbm90IG5lZWRlZCwNCgkJCQkJLy8gZS5nLiwgdGhlcmUgaXMgbm8gY29uc3RydWN0b3IgdG8gY2FsbA0KCQkJCQkvLyBsZXQncyB3YXRjaCBmb3IgdGhlIGxhc3QgY29uc3RydWN0b3INCgkJCQkJLy8gKHNlZSB0aWNrZXQgIzk3OTUpDQoJCQkJfQ0KCQkJfQ0KCQkJLy8gMikgY2FsbCBhIGNvbnN0cnVjdG9yDQoJCQlpZihjdG9yKXsNCgkJCQljdG9yLmFwcGx5KHRoaXMsIGEpOw0KCQkJfQ0KCQkJLy8gMykgY29udGludWUgdGhlIG9yaWdpbmFsIHJpdHVhbDogY2FsbCB0aGUgcG9zdHNjcmlwdA0KCQkJZiA9IHRoaXMucG9zdHNjcmlwdDsNCgkJCWlmKGYpew0KCQkJCWYuYXBwbHkodGhpcywgYSk7DQoJCQl9DQoJCX07DQoJfQ0KDQoJLy8gcGxhaW4gdmFuaWxsYSBjb25zdHJ1Y3RvciAoY2FuIHVzZSBpbmhlcml0ZWQoKSB0byBjYWxsIGl0cyBiYXNlIGNvbnN0cnVjdG9yKQ0KCWZ1bmN0aW9uIHNpbXBsZUNvbnN0cnVjdG9yKGJhc2VzKXsNCgkJcmV0dXJuIGZ1bmN0aW9uKCl7DQoJCQl2YXIgYSA9IGFyZ3VtZW50cywgaSA9IDAsIGYsIG07DQoNCgkJCWlmKCEodGhpcyBpbnN0YW5jZW9mIGEuY2FsbGVlKSl7DQoJCQkJLy8gbm90IGNhbGxlZCB2aWEgbmV3LCBzbyBmb3JjZSBpdA0KCQkJCXJldHVybiBhcHBseU5ldyhhKTsNCgkJCX0NCg0KCQkJLy90aGlzLl9pbmhlcml0ZWQgPSB7fTsNCgkJCS8vIHBlcmZvcm0gdGhlIHNoYW1hbidzIHJpdHVhbHMgb2YgdGhlIG9yaWdpbmFsIGRvam8uZGVjbGFyZSgpDQoJCQkvLyAxKSBkbyBub3QgY2FsbCB0aGUgcHJlYW1ibGUNCgkJCS8vIDIpIGNhbGwgdGhlIHRvcCBjb25zdHJ1Y3RvciAoaXQgY2FuIHVzZSB0aGlzLmluaGVyaXRlZCgpKQ0KCQkJZm9yKDsgZiA9IGJhc2VzW2ldOyArK2kpeyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJbSA9IGYuX21ldGE7DQoJCQkJZiA9IG0gPyBtLmN0b3IgOiBmOw0KCQkJCWlmKGYpew0KCQkJCQlmLmFwcGx5KHRoaXMsIGEpOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQl9DQoJCQkvLyAzKSBjYWxsIHRoZSBwb3N0c2NyaXB0DQoJCQlmID0gdGhpcy5wb3N0c2NyaXB0Ow0KCQkJaWYoZil7DQoJCQkJZi5hcHBseSh0aGlzLCBhKTsNCgkJCX0NCgkJfTsNCgl9DQoNCglmdW5jdGlvbiBjaGFpbihuYW1lLCBiYXNlcywgcmV2ZXJzZWQpew0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBiLCBtLCBmLCBpID0gMCwgc3RlcCA9IDE7DQoJCQlpZihyZXZlcnNlZCl7DQoJCQkJaSA9IGJhc2VzLmxlbmd0aCAtIDE7DQoJCQkJc3RlcCA9IC0xOw0KCQkJfQ0KCQkJZm9yKDsgYiA9IGJhc2VzW2ldOyBpICs9IHN0ZXApeyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJbSA9IGIuX21ldGE7DQoJCQkJZiA9IChtID8gbS5oaWRkZW4gOiBiLnByb3RvdHlwZSlbbmFtZV07DQoJCQkJaWYoZil7DQoJCQkJCWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCQl9DQoJCQl9DQoJCX07DQoJfQ0KDQoJLy8gZm9yY2VOZXcoY3RvcikNCgkvLyByZXR1cm4gYSBuZXcgb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSBjdG9yLnByb3RvdHlwZSBidXQNCgkvLyB3aXRob3V0IGFjdHVhbGx5IHJ1bm5pbmcgY3RvciBvbiB0aGUgb2JqZWN0Lg0KCWZ1bmN0aW9uIGZvcmNlTmV3KGN0b3Ipew0KCQkvLyBjcmVhdGUgb2JqZWN0IHdpdGggY29ycmVjdCBwcm90b3R5cGUgdXNpbmcgYSBkby1ub3RoaW5nDQoJCS8vIGNvbnN0cnVjdG9yDQoJCXh0b3IucHJvdG90eXBlID0gY3Rvci5wcm90b3R5cGU7DQoJCXZhciB0ID0gbmV3IHh0b3I7DQoJCXh0b3IucHJvdG90eXBlID0gbnVsbDsJLy8gY2xlYW4gdXANCgkJcmV0dXJuIHQ7DQoJfQ0KDQoJLy8gYXBwbHlOZXcoYXJncykNCgkvLyBqdXN0IGxpa2UgJ25ldyBjdG9yKCknIGV4Y2VwdCB0aGF0IHRoZSBjb25zdHJ1Y3RvciBhbmQgaXRzIGFyZ3VtZW50cyBjb21lDQoJLy8gZnJvbSBhcmdzLCB3aGljaCBtdXN0IGJlIGFuIGFycmF5IG9yIGFuIGFyZ3VtZW50cyBvYmplY3QNCglmdW5jdGlvbiBhcHBseU5ldyhhcmdzKXsNCgkJLy8gY3JlYXRlIGFuIG9iamVjdCB3aXRoIGN0b3IncyBwcm90b3R5cGUgYnV0IHdpdGhvdXQNCgkJLy8gY2FsbGluZyBjdG9yIG9uIGl0Lg0KCQl2YXIgY3RvciA9IGFyZ3MuY2FsbGVlLCB0ID0gZm9yY2VOZXcoY3Rvcik7DQoJCS8vIGV4ZWN1dGUgdGhlIHJlYWwgY29uc3RydWN0b3Igb24gdGhlIG5ldyBvYmplY3QNCgkJY3Rvci5hcHBseSh0LCBhcmdzKTsNCgkJcmV0dXJuIHQ7DQoJfQ0KDQoJZC5kZWNsYXJlID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBzdXBlcmNsYXNzLCBwcm9wcyl7DQoJCS8vIGNyYWNrIHBhcmFtZXRlcnMNCgkJaWYodHlwZW9mIGNsYXNzTmFtZSAhPSAic3RyaW5nIil7DQoJCQlwcm9wcyA9IHN1cGVyY2xhc3M7DQoJCQlzdXBlcmNsYXNzID0gY2xhc3NOYW1lOw0KCQkJY2xhc3NOYW1lID0gIiI7DQoJCX0NCgkJcHJvcHMgPSBwcm9wcyB8fCB7fTsNCg0KCQl2YXIgcHJvdG8sIGksIHQsIGN0b3IsIG5hbWUsIGJhc2VzLCBjaGFpbnMsIG1peGlucyA9IDEsIHBhcmVudHMgPSBzdXBlcmNsYXNzOw0KDQoJCS8vIGJ1aWxkIGEgcHJvdG90eXBlDQoJCWlmKG9wdHMuY2FsbChzdXBlcmNsYXNzKSA9PSAiW29iamVjdCBBcnJheV0iKXsNCgkJCS8vIEMzIE1STw0KCQkJYmFzZXMgPSBjM21ybyhzdXBlcmNsYXNzKTsNCgkJCXQgPSBiYXNlc1swXTsNCgkJCW1peGlucyA9IGJhc2VzLmxlbmd0aCAtIHQ7DQoJCQlzdXBlcmNsYXNzID0gYmFzZXNbbWl4aW5zXTsNCgkJfWVsc2V7DQoJCQliYXNlcyA9IFswXTsNCgkJCWlmKHN1cGVyY2xhc3Mpew0KCQkJCWlmKG9wdHMuY2FsbChzdXBlcmNsYXNzKSA9PSAiW29iamVjdCBGdW5jdGlvbl0iKXsNCgkJCQkJdCA9IHN1cGVyY2xhc3MuX21ldGE7DQoJCQkJCWJhc2VzID0gYmFzZXMuY29uY2F0KHQgPyB0LmJhc2VzIDogc3VwZXJjbGFzcyk7DQoJCQkJfWVsc2V7DQoJCQkJCWVycigiYmFzZSBjbGFzcyBpcyBub3QgYSBjYWxsYWJsZSBjb25zdHJ1Y3Rvci4iKTsNCgkJCQl9DQoJCQl9ZWxzZSBpZihzdXBlcmNsYXNzICE9PSBudWxsKXsNCgkJCQllcnIoInVua25vd24gYmFzZSBjbGFzcy4gRGlkIHlvdSB1c2UgZG9qby5yZXF1aXJlIHRvIHB1bGwgaXQgaW4/IikNCgkJCX0NCgkJfQ0KCQlpZihzdXBlcmNsYXNzKXsNCgkJCWZvcihpID0gbWl4aW5zIC0gMTs7IC0taSl7DQoJCQkJcHJvdG8gPSBmb3JjZU5ldyhzdXBlcmNsYXNzKTsNCgkJCQlpZighaSl7DQoJCQkJCS8vIHN0b3AgaWYgbm90aGluZyB0byBhZGQgKHRoZSBsYXN0IGJhc2UpDQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQkvLyBtaXggaW4gcHJvcGVydGllcw0KCQkJCXQgPSBiYXNlc1tpXTsNCgkJCQkodC5fbWV0YSA/IG1peE93biA6IG1peCkocHJvdG8sIHQucHJvdG90eXBlKTsNCgkJCQkvLyBjaGFpbiBpbiBuZXcgY29uc3RydWN0b3INCgkJCQljdG9yID0gbmV3IEZ1bmN0aW9uOw0KCQkJCWN0b3Iuc3VwZXJjbGFzcyA9IHN1cGVyY2xhc3M7DQoJCQkJY3Rvci5wcm90b3R5cGUgPSBwcm90bzsNCgkJCQlzdXBlcmNsYXNzID0gcHJvdG8uY29uc3RydWN0b3IgPSBjdG9yOw0KCQkJfQ0KCQl9ZWxzZXsNCgkJCXByb3RvID0ge307DQoJCX0NCgkJLy8gYWRkIGFsbCBwcm9wZXJ0aWVzDQoJCXNhZmVNaXhpbihwcm90bywgcHJvcHMpOw0KCQkvLyBhZGQgY29uc3RydWN0b3INCgkJdCA9IHByb3BzLmNvbnN0cnVjdG9yOw0KCQlpZih0ICE9PSBvcC5jb25zdHJ1Y3Rvcil7DQoJCQl0Lm5vbSA9IGNuYW1lOw0KCQkJcHJvdG8uY29uc3RydWN0b3IgPSB0Ow0KCQl9DQoNCgkJLy8gY29sbGVjdCBjaGFpbnMgYW5kIGZsYWdzDQoJCWZvcihpID0gbWl4aW5zIC0gMTsgaTsgLS1pKXsgLy8gaW50ZW50aW9uYWwgYXNzaWdubWVudA0KCQkJdCA9IGJhc2VzW2ldLl9tZXRhOw0KCQkJaWYodCAmJiB0LmNoYWlucyl7DQoJCQkJY2hhaW5zID0gbWl4KGNoYWlucyB8fCB7fSwgdC5jaGFpbnMpOw0KCQkJfQ0KCQl9DQoJCWlmKHByb3RvWyItY2hhaW5zLSJdKXsNCgkJCWNoYWlucyA9IG1peChjaGFpbnMgfHwge30sIHByb3RvWyItY2hhaW5zLSJdKTsNCgkJfQ0KDQoJCS8vIGJ1aWxkIGN0b3INCgkJdCA9ICFjaGFpbnMgfHwgIWNoYWlucy5oYXNPd25Qcm9wZXJ0eShjbmFtZSk7DQoJCWJhc2VzWzBdID0gY3RvciA9IChjaGFpbnMgJiYgY2hhaW5zLmNvbnN0cnVjdG9yID09PSAibWFudWFsIikgPyBzaW1wbGVDb25zdHJ1Y3RvcihiYXNlcykgOg0KCQkJKGJhc2VzLmxlbmd0aCA9PSAxID8gc2luZ2xlQ29uc3RydWN0b3IocHJvcHMuY29uc3RydWN0b3IsIHQpIDogY2hhaW5lZENvbnN0cnVjdG9yKGJhc2VzLCB0KSk7DQoNCgkJLy8gYWRkIG1ldGEgaW5mb3JtYXRpb24gdG8gdGhlIGNvbnN0cnVjdG9yDQoJCWN0b3IuX21ldGEgID0ge2Jhc2VzOiBiYXNlcywgaGlkZGVuOiBwcm9wcywgY2hhaW5zOiBjaGFpbnMsDQoJCQlwYXJlbnRzOiBwYXJlbnRzLCBjdG9yOiBwcm9wcy5jb25zdHJ1Y3Rvcn07DQoJCWN0b3Iuc3VwZXJjbGFzcyA9IHN1cGVyY2xhc3MgJiYgc3VwZXJjbGFzcy5wcm90b3R5cGU7DQoJCWN0b3IuZXh0ZW5kID0gZXh0ZW5kOw0KCQljdG9yLnByb3RvdHlwZSA9IHByb3RvOw0KCQlwcm90by5jb25zdHJ1Y3RvciA9IGN0b3I7DQoNCgkJLy8gYWRkICJzdGFuZGFyZCIgbWV0aG9kcyB0byB0aGUgcHJvdG90eXBlDQoJCXByb3RvLmdldEluaGVyaXRlZCA9IGdldEluaGVyaXRlZDsNCgkJcHJvdG8uaW5oZXJpdGVkID0gaW5oZXJpdGVkOw0KCQlwcm90by5pc0luc3RhbmNlT2YgPSBpc0luc3RhbmNlT2Y7DQoNCgkJLy8gYWRkIG5hbWUgaWYgc3BlY2lmaWVkDQoJCWlmKGNsYXNzTmFtZSl7DQoJCQlwcm90by5kZWNsYXJlZENsYXNzID0gY2xhc3NOYW1lOw0KCQkJZC5zZXRPYmplY3QoY2xhc3NOYW1lLCBjdG9yKTsNCgkJfQ0KDQoJCS8vIGJ1aWxkIGNoYWlucyBhbmQgYWRkIHRoZW0gdG8gdGhlIHByb3RvdHlwZQ0KCQlpZihjaGFpbnMpew0KCQkJZm9yKG5hbWUgaW4gY2hhaW5zKXsNCgkJCQlpZihwcm90b1tuYW1lXSAmJiB0eXBlb2YgY2hhaW5zW25hbWVdID09ICJzdHJpbmciICYmIG5hbWUgIT0gY25hbWUpew0KCQkJCQl0ID0gcHJvdG9bbmFtZV0gPSBjaGFpbihuYW1lLCBiYXNlcywgY2hhaW5zW25hbWVdID09PSAiYWZ0ZXIiKTsNCgkJCQkJdC5ub20gPSBuYW1lOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkvLyBjaGFpbmVkIG1ldGhvZHMgZG8gbm90IHJldHVybiB2YWx1ZXMNCgkJLy8gbm8gbmVlZCB0byBjaGFpbiAiaW52aXNpYmxlIiBmdW5jdGlvbnMNCg0KCQlyZXR1cm4gY3RvcjsJLy8gRnVuY3Rpb24NCgl9Ow0KDQoJZC5zYWZlTWl4aW4gPSBzYWZlTWl4aW47DQoNCgkvKj09PT09DQoJZG9qby5kZWNsYXJlID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBzdXBlcmNsYXNzLCBwcm9wcyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlDcmVhdGUgYSBmZWF0dXJlLXJpY2ggY29uc3RydWN0b3IgZnJvbSBjb21wYWN0IG5vdGF0aW9uLg0KCQkvLwljbGFzc05hbWU6IFN0cmluZz86DQoJCS8vCQlUaGUgb3B0aW9uYWwgbmFtZSBvZiB0aGUgY29uc3RydWN0b3IgKGxvb3NlbHksIGEgImNsYXNzIikNCgkJLy8JCXN0b3JlZCBpbiB0aGUgImRlY2xhcmVkQ2xhc3MiIHByb3BlcnR5IGluIHRoZSBjcmVhdGVkIHByb3RvdHlwZS4NCgkJLy8JCUl0IHdpbGwgYmUgdXNlZCBhcyBhIGdsb2JhbCBuYW1lIGZvciBhIGNyZWF0ZWQgY29uc3RydWN0b3IuDQoJCS8vCXN1cGVyY2xhc3M6IEZ1bmN0aW9ufEZ1bmN0aW9uW106DQoJCS8vCQlNYXkgYmUgbnVsbCwgYSBGdW5jdGlvbiwgb3IgYW4gQXJyYXkgb2YgRnVuY3Rpb25zLiBUaGlzIGFyZ3VtZW50DQoJCS8vCQlzcGVjaWZpZXMgYSBsaXN0IG9mIGJhc2VzICh0aGUgbGVmdC1tb3N0IG9uZSBpcyB0aGUgbW9zdCBkZWVwZXN0DQoJCS8vCQliYXNlKS4NCgkJLy8JcHJvcHM6IE9iamVjdDoNCgkJLy8JCUFuIG9iamVjdCB3aG9zZSBwcm9wZXJ0aWVzIGFyZSBjb3BpZWQgdG8gdGhlIGNyZWF0ZWQgcHJvdG90eXBlLg0KCQkvLwkJQWRkIGFuIGluc3RhbmNlLWluaXRpYWxpemF0aW9uIGZ1bmN0aW9uIGJ5IG1ha2luZyBpdCBhIHByb3BlcnR5DQoJCS8vCQluYW1lZCAiY29uc3RydWN0b3IiLg0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJTmV3IGNvbnN0cnVjdG9yIGZ1bmN0aW9uLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUNyZWF0ZSBhIGNvbnN0cnVjdG9yIHVzaW5nIGEgY29tcGFjdCBub3RhdGlvbiBmb3IgaW5oZXJpdGFuY2UgYW5kDQoJCS8vCQlwcm90b3R5cGUgZXh0ZW5zaW9uLg0KCQkvLw0KCQkvLwkJTWl4aW4gYW5jZXN0b3JzIHByb3ZpZGUgYSB0eXBlIG9mIG11bHRpcGxlIGluaGVyaXRhbmNlLg0KCQkvLwkJUHJvdG90eXBlcyBvZiBtaXhpbiBhbmNlc3RvcnMgYXJlIGNvcGllZCB0byB0aGUgbmV3IGNsYXNzOg0KCQkvLwkJY2hhbmdlcyB0byBtaXhpbiBwcm90b3R5cGVzIHdpbGwgbm90IGFmZmVjdCBjbGFzc2VzIHRvIHdoaWNoDQoJCS8vCQl0aGV5IGhhdmUgYmVlbiBtaXhlZCBpbi4NCgkJLy8NCgkJLy8JCUFuY2VzdG9ycyBjYW4gYmUgY29tcG91bmQgY2xhc3NlcyBjcmVhdGVkIGJ5IHRoaXMgdmVyc2lvbiBvZg0KCQkvLwkJZG9qby5kZWNsYXJlLiBJbiBjb21wbGV4IGNhc2VzIGFsbCBiYXNlIGNsYXNzZXMgYXJlIGdvaW5nIHRvIGJlDQoJCS8vCQlsaW5lYXJpemVkIGFjY29yZGluZyB0byBDMyBNUk8gYWxnb3JpdGhtDQoJCS8vCQkoc2VlIGh0dHA6Ly93d3cucHl0aG9uLm9yZy9kb3dubG9hZC9yZWxlYXNlcy8yLjMvbXJvLyBmb3IgbW9yZQ0KCQkvLwkJZGV0YWlscykuDQoJCS8vDQoJCS8vCQkiY2xhc3NOYW1lIiBpcyBjYWNoZWQgaW4gImRlY2xhcmVkQ2xhc3MiIHByb3BlcnR5IG9mIHRoZSBuZXcgY2xhc3MsDQoJCS8vCQlpZiBpdCB3YXMgc3VwcGxpZWQuIFRoZSBpbW1lZGlhdGUgc3VwZXIgY2xhc3Mgd2lsbCBiZSBjYWNoZWQgaW4NCgkJLy8JCSJzdXBlcmNsYXNzIiBwcm9wZXJ0eSBvZiB0aGUgbmV3IGNsYXNzLg0KCQkvLw0KCQkvLwkJTWV0aG9kcyBpbiAicHJvcHMiIHdpbGwgYmUgY29waWVkIGFuZCBtb2RpZmllZDogIm5vbSIgcHJvcGVydHkNCgkJLy8JCSh0aGUgZGVjbGFyZWQgbmFtZSBvZiB0aGUgbWV0aG9kKSB3aWxsIGJlIGFkZGVkIHRvIGFsbCBjb3BpZWQNCgkJLy8JCWZ1bmN0aW9ucyB0byBoZWxwIGlkZW50aWZ5IHRoZW0gZm9yIHRoZSBpbnRlcm5hbCBtYWNoaW5lcnkuIEJlDQoJCS8vCQl2ZXJ5IGNhcmVmdWwsIHdoaWxlIHJldXNpbmcgbWV0aG9kczogaWYgeW91IHVzZSB0aGUgc2FtZQ0KCQkvLwkJZnVuY3Rpb24gdW5kZXIgZGlmZmVyZW50IG5hbWVzLCBpdCBjYW4gcHJvZHVjZSBlcnJvcnMgaW4gc29tZQ0KCQkvLwkJY2FzZXMuDQoJCS8vDQoJCS8vCQlJdCBpcyBwb3NzaWJsZSB0byB1c2UgY29uc3RydWN0b3JzIGNyZWF0ZWQgIm1hbnVhbGx5IiAod2l0aG91dA0KCQkvLwkJZG9qby5kZWNsYXJlKSBhcyBiYXNlcy4gVGhleSB3aWxsIGJlIGNhbGxlZCBhcyB1c3VhbCBkdXJpbmcgdGhlDQoJCS8vCQljcmVhdGlvbiBvZiBhbiBpbnN0YW5jZSwgdGhlaXIgbWV0aG9kcyB3aWxsIGJlIGNoYWluZWQsIGFuZCBldmVuDQoJCS8vCQljYWxsZWQgYnkgInRoaXMuaW5oZXJpdGVkKCkiLg0KCQkvLw0KCQkvLwkJU3BlY2lhbCBwcm9wZXJ0eSAiLWNoYWlucy0iIGdvdmVybnMgaG93IHRvIGNoYWluIG1ldGhvZHMuIEl0IGlzDQoJCS8vCQlhIGRpY3Rpb25hcnksIHdoaWNoIHVzZXMgbWV0aG9kIG5hbWVzIGFzIGtleXMsIGFuZCBoaW50IHN0cmluZ3MNCgkJLy8JCWFzIHZhbHVlcy4gSWYgYSBoaW50IHN0cmluZyBpcyAiYWZ0ZXIiLCB0aGlzIG1ldGhvZCB3aWxsIGJlDQoJCS8vCQljYWxsZWQgYWZ0ZXIgbWV0aG9kcyBvZiBpdHMgYmFzZSBjbGFzc2VzLiBJZiBhIGhpbnQgc3RyaW5nIGlzDQoJCS8vCQkiYmVmb3JlIiwgdGhpcyBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgYmVmb3JlIG1ldGhvZHMgb2YgaXRzIGJhc2UNCgkJLy8JCWNsYXNzZXMuDQoJCS8vDQoJCS8vCQlJZiAiY29uc3RydWN0b3IiIGlzIG5vdCBtZW50aW9uZWQgaW4gIi1jaGFpbnMtIiBwcm9wZXJ0eSwgaXQgd2lsbA0KCQkvLwkJYmUgY2hhaW5lZCB1c2luZyB0aGUgbGVnYWN5IG1vZGU6IHVzaW5nICJhZnRlciIgY2hhaW5pbmcsDQoJCS8vCQljYWxsaW5nIHByZWFtYmxlKCkgbWV0aG9kIGJlZm9yZSBlYWNoIGNvbnN0cnVjdG9yLCBpZiBhdmFpbGFibGUsDQoJCS8vCQlhbmQgY2FsbGluZyBwb3N0c2NyaXB0KCkgYWZ0ZXIgYWxsIGNvbnN0cnVjdG9ycyB3ZXJlIGV4ZWN1dGVkLg0KCQkvLwkJSWYgdGhlIGhpbnQgaXMgImFmdGVyIiwgaXQgaXMgY2hhaW5lZCBhcyBhIHJlZ3VsYXIgbWV0aG9kLCBidXQNCgkJLy8JCXBvc3RzY3JpcHQoKSB3aWxsIGJlIGNhbGxlZCBhZnRlciB0aGUgY2hhaW4gb2YgY29uc3RydWN0b3JzLg0KCQkvLwkJImNvbnN0cnVjdG9yIiBjYW5ub3QgYmUgY2hhaW5lZCAiYmVmb3JlIiwgYnV0IGl0IGFsbG93cw0KCQkvLwkJYSBzcGVjaWFsIGhpbnQgc3RyaW5nOiAibWFudWFsIiwgd2hpY2ggbWVhbnMgdGhhdCBjb25zdHJ1Y3RvcnMNCgkJLy8JCWFyZSBub3QgZ29pbmcgdG8gYmUgY2hhaW5lZCBpbiBhbnkgd2F5LCBhbmQgcHJvZ3JhbW1lciB3aWxsIGNhbGwNCgkJLy8JCXRoZW0gbWFudWFsbHkgdXNpbmcgdGhpcy5pbmhlcml0ZWQoKS4gSW4gdGhlIGxhdHRlciBjYXNlDQoJCS8vCQlwb3N0c2NyaXB0KCkgd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGNvbnN0cnVjdGlvbi4NCgkJLy8NCgkJLy8JCUFsbCBjaGFpbmluZyBoaW50cyBhcmUgImluaGVyaXRlZCIgZnJvbSBiYXNlIGNsYXNzZXMgYW5kDQoJCS8vCQlwb3RlbnRpYWxseSBjYW4gYmUgb3ZlcnJpZGRlbi4gQmUgdmVyeSBjYXJlZnVsIHdoZW4gb3ZlcnJpZGluZw0KCQkvLwkJaGludHMhIE1ha2Ugc3VyZSB0aGF0IGFsbCBjaGFpbmVkIG1ldGhvZHMgY2FuIHdvcmsgaW4gYSBwcm9wb3NlZA0KCQkvLwkJbWFubmVyIG9mIGNoYWluaW5nLg0KCQkvLw0KCQkvLwkJT25jZSBhIG1ldGhvZCB3YXMgY2hhaW5lZCwgaXQgaXMgaW1wb3NzaWJsZSB0byB1bmNoYWluIGl0LiBUaGUNCgkJLy8JCW9ubHkgZXhjZXB0aW9uIGlzICJjb25zdHJ1Y3RvciIuIFlvdSBkb24ndCBuZWVkIHRvIGRlZmluZSBhDQoJCS8vCQltZXRob2QgaW4gb3JkZXIgdG8gc3VwcGx5IGEgY2hhaW5pbmcgaGludC4NCgkJLy8NCgkJLy8JCUlmIGEgbWV0aG9kIGlzIGNoYWluZWQsIGl0IGNhbm5vdCB1c2UgdGhpcy5pbmhlcml0ZWQoKSBiZWNhdXNlDQoJCS8vCQlhbGwgb3RoZXIgbWV0aG9kcyBpbiB0aGUgaGllcmFyY2h5IHdpbGwgYmUgY2FsbGVkIGF1dG9tYXRpY2FsbHkuDQoJCS8vDQoJCS8vCQlVc3VhbGx5IGNvbnN0cnVjdG9ycyBhbmQgaW5pdGlhbGl6ZXJzIG9mIGFueSBraW5kIGFyZSBjaGFpbmVkDQoJCS8vCQl1c2luZyAiYWZ0ZXIiIGFuZCBkZXN0cnVjdG9ycyBvZiBhbnkga2luZCBhcmUgY2hhaW5lZCBhcw0KCQkvLwkJImJlZm9yZSIuIE5vdGUgdGhhdCBjaGFpbmluZyBhc3N1bWVzIHRoYXQgY2hhaW5lZCBtZXRob2RzIGRvIG5vdA0KCQkvLwkJcmV0dXJuIGFueSB2YWx1ZTogYW55IHJldHVybmVkIHZhbHVlIHdpbGwgYmUgZGlzY2FyZGVkLg0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CWRvam8uZGVjbGFyZSgibXkuY2xhc3Nlcy5iYXIiLCBteS5jbGFzc2VzLmZvbywgew0KCQkvLwl8CQkvLyBwcm9wZXJ0aWVzIHRvIGJlIGFkZGVkIHRvIHRoZSBjbGFzcyBwcm90b3R5cGUNCgkJLy8JfAkJc29tZVZhbHVlOiAyLA0KCQkvLwl8CQkvLyBpbml0aWFsaXphdGlvbiBmdW5jdGlvbg0KCQkvLwl8CQljb25zdHJ1Y3RvcjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCXRoaXMubXlDb21wbGljYXRlZE9iamVjdCA9IG5ldyBSZWFsbHlDb21wbGljYXRlZE9iamVjdCgpOw0KCQkvLwl8CQl9LA0KCQkvLwl8CQkvLyBvdGhlciBmdW5jdGlvbnMNCgkJLy8JfAkJc29tZU1ldGhvZDogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWRvU3R1ZmYoKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBNeUJhc2UgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgTXlDbGFzczEgPSBkb2pvLmRlY2xhcmUoTXlCYXNlLCB7DQoJCS8vCXwJCS8vIGNvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzLCBhbmQgbWV0aG9kcyBnbyBoZXJlDQoJCS8vCXwJCS8vIC4uLg0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBNeUNsYXNzMiA9IGRvam8uZGVjbGFyZShNeUJhc2UsIHsNCgkJLy8JfAkJLy8gY29uc3RydWN0b3IsIHByb3BlcnRpZXMsIGFuZCBtZXRob2RzIGdvIGhlcmUNCgkJLy8JfAkJLy8gLi4uDQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIE15RGlhbW9uZCA9IGRvam8uZGVjbGFyZShbTXlDbGFzczEsIE15Q2xhc3MyXSwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgRiA9IGZ1bmN0aW9uKCl7IGNvbnNvbGUubG9nKCJyYXcgY29uc3RydWN0b3IiKTsgfTsNCgkJLy8JfAlGLnByb3RvdHlwZS5tZXRob2QgPSBmdW5jdGlvbigpew0KCQkvLwl8CQljb25zb2xlLmxvZygicmF3IG1ldGhvZCIpOw0KCQkvLwl8CX07DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUoRiwgew0KCQkvLwl8CQljb25zdHJ1Y3RvcjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJBLmNvbnN0cnVjdG9yIik7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW1ldGhvZDogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJiZWZvcmUgY2FsbGluZyBGLm1ldGhvZC4uLiIpOw0KCQkvLwl8CQkJdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzKTsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCIuLi5iYWNrIGluIEEiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CW5ldyBBKCkubWV0aG9kKCk7DQoJCS8vCXwJLy8gd2lsbCBwcmludDoNCgkJLy8JfAkvLyByYXcgY29uc3RydWN0b3INCgkJLy8JfAkvLyBBLmNvbnN0cnVjdG9yDQoJCS8vCXwJLy8gYmVmb3JlIGNhbGxpbmcgRi5tZXRob2QuLi4NCgkJLy8JfAkvLyByYXcgbWV0aG9kDQoJCS8vCXwJLy8gLi4uYmFjayBpbiBBDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkiLWNoYWlucy0iOiB7DQoJCS8vCXwJCQlkZXN0cm95OiAiYmVmb3JlIg0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQljb25zdHJ1Y3RvcjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJCLmNvbnN0cnVjdG9yIik7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCWRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQi5kZXN0cm95Iik7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQyA9IGRvam8uZGVjbGFyZShCLCB7DQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkMuY29uc3RydWN0b3IiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJZGVzdHJveTogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJDLmRlc3Ryb3kiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CW5ldyBDKCkuZGVzdHJveSgpOw0KCQkvLwl8CS8vIHByaW50czoNCgkJLy8JfAkvLyBCLmNvbnN0cnVjdG9yDQoJCS8vCXwJLy8gQy5jb25zdHJ1Y3Rvcg0KCQkvLwl8CS8vIEMuZGVzdHJveQ0KCQkvLwl8CS8vIEIuZGVzdHJveQ0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBBID0gZG9qby5kZWNsYXJlKG51bGwsIHsNCgkJLy8JfAkJIi1jaGFpbnMtIjogew0KCQkvLwl8CQkJY29uc3RydWN0b3I6ICJtYW51YWwiDQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJLy8gLi4uDQoJCS8vCXwJCQkvLyBjYWxsIHRoZSBiYXNlIGNvbnN0cnVjdG9yIHdpdGggbmV3IHBhcmFtZXRlcnMNCgkJLy8JfAkJCXRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cywgWzEsIDIsIDNdKTsNCgkJLy8JfAkJCS8vIC4uLg0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkiLWNoYWlucy0iOiB7DQoJCS8vCXwJCQltMTogImJlZm9yZSINCgkJLy8JfAkJfSwNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQS5tMSIpOw0KCQkvLwl8CQl9LA0KCQkvLwl8CQltMjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJBLm0yIik7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCSItY2hhaW5zLSI6IHsNCgkJLy8JfAkJCW0yOiAiYWZ0ZXIiDQoJCS8vCXwJCX0sDQoJCS8vCXwJCW0xOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkIubTEiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJbTI6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQi5tMiIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIHggPSBuZXcgQigpOw0KCQkvLwl8CXgubTEoKTsNCgkJLy8JfAkvLyBwcmludHM6DQoJCS8vCXwJLy8gQi5tMQ0KCQkvLwl8CS8vIEEubTENCgkJLy8JfAl4Lm0yKCk7DQoJCS8vCXwJLy8gcHJpbnRzOg0KCQkvLwl8CS8vIEEubTINCgkJLy8JfAkvLyBCLm0yDQoJCXJldHVybiBuZXcgRnVuY3Rpb24oKTsgLy8gRnVuY3Rpb24NCgl9Ow0KCT09PT09Ki8NCg0KCS8qPT09PT0NCglkb2pvLnNhZmVNaXhpbiA9IGZ1bmN0aW9uKHRhcmdldCwgc291cmNlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCU1peCBpbiBwcm9wZXJ0aWVzIHNraXBwaW5nIGEgY29uc3RydWN0b3IgYW5kIGRlY29yYXRpbmcgZnVuY3Rpb25zDQoJCS8vCQlsaWtlIGl0IGlzIGRvbmUgYnkgZG9qby5kZWNsYXJlLg0KCQkvLwl0YXJnZXQ6IE9iamVjdA0KCQkvLwkJVGFyZ2V0IG9iamVjdCB0byBhY2NlcHQgbmV3IHByb3BlcnRpZXMuDQoJCS8vCXNvdXJjZTogT2JqZWN0DQoJCS8vCQlTb3VyY2Ugb2JqZWN0IGZvciBuZXcgcHJvcGVydGllcy4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gbWl4IGluIHByb3BlcnRpZXMgbGlrZSBkb2pvLl9taXhpbiBkb2VzLA0KCQkvLwkJYnV0IGl0IHNraXBzIGEgY29uc3RydWN0b3IgcHJvcGVydHkgYW5kIGRlY29yYXRlcyBmdW5jdGlvbnMgbGlrZQ0KCQkvLwkJZG9qby5kZWNsYXJlIGRvZXMuDQoJCS8vDQoJCS8vCQlJdCBpcyBtZWFudCB0byBiZSB1c2VkIHdpdGggY2xhc3NlcyBhbmQgb2JqZWN0cyBwcm9kdWNlZCB3aXRoDQoJCS8vCQlkb2pvLmRlY2xhcmUuIEZ1bmN0aW9ucyBtaXhlZCBpbiB3aXRoIGRvam8uc2FmZU1peGluIGNhbiB1c2UNCgkJLy8JCXRoaXMuaW5oZXJpdGVkKCkgbGlrZSBub3JtYWwgbWV0aG9kcy4NCgkJLy8NCgkJLy8JCVRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBpbXBsZW1lbnQgZXh0ZW5kKCkgbWV0aG9kIG9mIGEgY29uc3RydWN0b3INCgkJLy8JCXByb2R1Y2VkIHdpdGggZG9qby5kZWNsYXJlKCkuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQltMTogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJBLm0xIik7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW0yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkEubTIiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBCID0gZG9qby5kZWNsYXJlKEEsIHsNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQl0aGlzLmluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJY29uc29sZS5sb2coIkIubTEiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CUIuZXh0ZW5kKHsNCgkJLy8JfAkJbTI6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQl0aGlzLmluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJY29uc29sZS5sb2coIkIubTIiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciB4ID0gbmV3IEIoKTsNCgkJLy8JfAlkb2pvLnNhZmVNaXhpbih4LCB7DQoJCS8vCXwJCW0xOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzKTsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJYLm0xIik7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW0yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzKTsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJYLm0yIik7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl4Lm0yKCk7DQoJCS8vCXwJLy8gcHJpbnRzOg0KCQkvLwl8CS8vIEEubTENCgkJLy8JfAkvLyBCLm0xDQoJCS8vCXwJLy8gWC5tMQ0KCX07DQoJPT09PT0qLw0KDQoJLyo9PT09PQ0KCU9iamVjdC5pbmhlcml0ZWQgPSBmdW5jdGlvbihuYW1lLCBhcmdzLCBuZXdBcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUNhbGxzIGEgc3VwZXIgbWV0aG9kLg0KCQkvLwluYW1lOiBTdHJpbmc/DQoJCS8vCQlUaGUgb3B0aW9uYWwgbWV0aG9kIG5hbWUuIFNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgY2FsbGVyJ3MNCgkJLy8JCW5hbWUuIFVzdWFsbHkgIm5hbWUiIGlzIHNwZWNpZmllZCBpbiBjb21wbGV4IGR5bmFtaWMgY2FzZXMsIHdoZW4NCgkJLy8JCXRoZSBjYWxsaW5nIG1ldGhvZCB3YXMgZHluYW1pY2FsbHkgYWRkZWQsIHVuZGVjb3JhdGVkIGJ5DQoJCS8vCQlkb2pvLmRlY2xhcmUsIGFuZCBpdCBjYW5ub3QgYmUgZGV0ZXJtaW5lZC4NCgkJLy8JYXJnczogQXJndW1lbnRzDQoJCS8vCQlUaGUgY2FsbGVyIHN1cHBseSB0aGlzIGFyZ3VtZW50LCB3aGljaCBzaG91bGQgYmUgdGhlIG9yaWdpbmFsDQoJCS8vCQkiYXJndW1lbnRzIi4NCgkJLy8JbmV3QXJnczogT2JqZWN0Pw0KCQkvLwkJSWYgInRydWUiLCB0aGUgZm91bmQgZnVuY3Rpb24gd2lsbCBiZSByZXR1cm5lZCB3aXRob3V0DQoJCS8vCQlleGVjdXRpbmcgaXQuDQoJCS8vCQlJZiBBcnJheSwgaXQgd2lsbCBiZSB1c2VkIHRvIGNhbGwgYSBzdXBlciBtZXRob2QuIE90aGVyd2lzZQ0KCQkvLwkJImFyZ3MiIHdpbGwgYmUgdXNlZC4NCgkJLy8JcmV0dXJuczoNCgkJLy8JCVdoYXRldmVyIGlzIHJldHVybmVkIGJ5IGEgc3VwZXIgbWV0aG9kLCBvciBhIHN1cGVyIG1ldGhvZCBpdHNlbGYsDQoJCS8vCQlpZiAidHJ1ZSIgd2FzIHNwZWNpZmllZCBhcyBuZXdBcmdzLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgbWV0aG9kIGlzIHVzZWQgaW5zaWRlIG1ldGhvZCBvZiBjbGFzc2VzIHByb2R1Y2VkIHdpdGgNCgkJLy8JCWRvam8uZGVjbGFyZSB0byBjYWxsIGEgc3VwZXIgbWV0aG9kIChuZXh0IGluIHRoZSBjaGFpbikuIEl0IGlzDQoJCS8vCQl1c2VkIGZvciBtYW51YWxseSBjb250cm9sbGVkIGNoYWluaW5nLiBDb25zaWRlciB1c2luZyB0aGUgcmVndWxhcg0KCQkvLwkJY2hhaW5pbmcsIGJlY2F1c2UgaXQgaXMgZmFzdGVyLiBVc2UgInRoaXMuaW5oZXJpdGVkKCkiIG9ubHkgaW4NCgkJLy8JCWNvbXBsZXggY2FzZXMuDQoJCS8vDQoJCS8vCQlUaGlzIG1ldGhvZCBjYW5ub3QgbWUgY2FsbGVkIGZyb20gYXV0b21hdGljYWxseSBjaGFpbmVkDQoJCS8vCQljb25zdHJ1Y3RvcnMgaW5jbHVkaW5nIHRoZSBjYXNlIG9mIGEgc3BlY2lhbCAobGVnYWN5KQ0KCQkvLwkJY29uc3RydWN0b3IgY2hhaW5pbmcuIEl0IGNhbm5vdCBiZSBjYWxsZWQgZnJvbSBjaGFpbmVkIG1ldGhvZHMuDQoJCS8vDQoJCS8vCQlJZiAidGhpcy5pbmhlcml0ZWQoKSIgY2Fubm90IGZpbmQgdGhlIG5leHQtaW4tY2hhaW4gbWV0aG9kLCBpdA0KCQkvLwkJZG9lcyBub3RoaW5nIGFuZCByZXR1cm5zICJ1bmRlZmluZWQiLiBUaGUgbGFzdCBtZXRob2QgaW4gY2hhaW4NCgkJLy8JCWNhbiBiZSBhIGRlZmF1bHQgbWV0aG9kIGltcGxlbWVudGVkIGluIE9iamVjdCwgd2hpY2ggd2lsbCBiZQ0KCQkvLwkJY2FsbGVkIGxhc3QuDQoJCS8vDQoJCS8vCQlJZiAibmFtZSIgaXMgc3BlY2lmaWVkLCBpdCBpcyBhc3N1bWVkIHRoYXQgdGhlIG1ldGhvZCB0aGF0DQoJCS8vCQlyZWNlaXZlZCAiYXJncyIgaXMgdGhlIHBhcmVudCBtZXRob2QgZm9yIHRoaXMgY2FsbC4gSXQgaXMgbG9va2VkDQoJCS8vCQl1cCBpbiB0aGUgY2hhaW4gbGlzdCBhbmQgaWYgaXQgaXMgZm91bmQgdGhlIG5leHQtaW4tY2hhaW4gbWV0aG9kDQoJCS8vCQlpcyBjYWxsZWQuIElmIGl0IGlzIG5vdCBmb3VuZCwgdGhlIGZpcnN0LWluLWNoYWluIG1ldGhvZCBpcw0KCQkvLwkJY2FsbGVkLg0KCQkvLw0KCQkvLwkJSWYgIm5hbWUiIGlzIG5vdCBzcGVjaWZpZWQsIGl0IHdpbGwgYmUgZGVyaXZlZCBmcm9tIHRoZSBjYWxsaW5nDQoJCS8vCQltZXRob2QgKHVzaW5nIGEgbWV0aG9pZCBwcm9wZXJ0eSAibm9tIikuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQltZXRob2QxOiBmdW5jdGlvbihhLCBiLCBjKXsNCgkJLy8JfAkJCXRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cyk7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW1ldGhvZDI6IGZ1bmN0aW9uKGEsIGIpew0KCQkvLwl8CQkJcmV0dXJuIHRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cywgW2EgKyBiXSk7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAkvLyBuZXh0IG1ldGhvZCBpcyBub3QgaW4gdGhlIGNoYWluIGxpc3QgYmVjYXVzZSBpdCBpcyBhZGRlZA0KCQkvLwl8CS8vIG1hbnVhbGx5IGFmdGVyIHRoZSBjbGFzcyB3YXMgY3JlYXRlZC4NCgkJLy8JfAlCLnByb3RvdHlwZS5tZXRob2QzID0gZnVuY3Rpb24oKXsNCgkJLy8JfAkJY29uc29sZS5sb2coIlRoaXMgaXMgYSBkeW5hbWljYWxseS1hZGRlZCBtZXRob2QuIik7DQoJCS8vCXwJCXRoaXMuaW5oZXJpdGVkKCJtZXRob2QzIiwgYXJndW1lbnRzKTsNCgkJLy8JfAl9Ow0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBCID0gZG9qby5kZWNsYXJlKEEsIHsNCgkJLy8JfAkJbWV0aG9kOiBmdW5jdGlvbihhLCBiKXsNCgkJLy8JfAkJCXZhciBzdXBlciA9IHRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cywgdHJ1ZSk7DQoJCS8vCXwJCQkvLyAuLi4NCgkJLy8JfAkJCWlmKCFzdXBlcil7DQoJCS8vCXwJCQkJY29uc29sZS5sb2coInRoZXJlIGlzIG5vIHN1cGVyIG1ldGhvZCIpOw0KCQkvLwl8CQkJCXJldHVybiAwOw0KCQkvLwl8CQkJfQ0KCQkvLwl8CQkJcmV0dXJuIHN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJcmV0dXJuCXt9OwkvLyBPYmplY3QNCgl9DQoJPT09PT0qLw0KDQoJLyo9PT09PQ0KCU9iamVjdC5nZXRJbmhlcml0ZWQgPSBmdW5jdGlvbihuYW1lLCBhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYSBzdXBlciBtZXRob2QuDQoJCS8vCW5hbWU6IFN0cmluZz8NCgkJLy8JCVRoZSBvcHRpb25hbCBtZXRob2QgbmFtZS4gU2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBjYWxsZXIncw0KCQkvLwkJbmFtZS4gVXN1YWxseSAibmFtZSIgaXMgc3BlY2lmaWVkIGluIGNvbXBsZXggZHluYW1pYyBjYXNlcywgd2hlbg0KCQkvLwkJdGhlIGNhbGxpbmcgbWV0aG9kIHdhcyBkeW5hbWljYWxseSBhZGRlZCwgdW5kZWNvcmF0ZWQgYnkNCgkJLy8JCWRvam8uZGVjbGFyZSwgYW5kIGl0IGNhbm5vdCBiZSBkZXRlcm1pbmVkLg0KCQkvLwlhcmdzOiBBcmd1bWVudHMNCgkJLy8JCVRoZSBjYWxsZXIgc3VwcGx5IHRoaXMgYXJndW1lbnQsIHdoaWNoIHNob3VsZCBiZSB0aGUgb3JpZ2luYWwNCgkJLy8JCSJhcmd1bWVudHMiLg0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJUmV0dXJucyBhIHN1cGVyIG1ldGhvZCAoRnVuY3Rpb24pIG9yICJ1bmRlZmluZWQiLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgbWV0aG9kIGlzIGEgY29udmVuaWVuY2UgbWV0aG9kIGZvciAidGhpcy5pbmhlcml0ZWQoKSIuDQoJCS8vCQlJdCB1c2VzIHRoZSBzYW1lIGFsZ29yaXRobSBidXQgaW5zdGVhZCBvZiBleGVjdXRpbmcgYSBzdXBlcg0KCQkvLwkJbWV0aG9kLCBpdCByZXR1cm5zIGl0LCBvciAidW5kZWZpbmVkIiBpZiBub3QgZm91bmQuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQltZXRob2Q6IGZ1bmN0aW9uKGEsIGIpew0KCQkvLwl8CQkJdmFyIHN1cGVyID0gdGhpcy5nZXRJbmhlcml0ZWQoYXJndW1lbnRzKTsNCgkJLy8JfAkJCS8vIC4uLg0KCQkvLwl8CQkJaWYoIXN1cGVyKXsNCgkJLy8JfAkJCQljb25zb2xlLmxvZygidGhlcmUgaXMgbm8gc3VwZXIgbWV0aG9kIik7DQoJCS8vCXwJCQkJcmV0dXJuIDA7DQoJCS8vCXwJCQl9DQoJCS8vCXwJCQlyZXR1cm4gc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQlyZXR1cm4Je307CS8vIE9iamVjdA0KCX0NCgk9PT09PSovDQoNCgkvKj09PT09DQoJT2JqZWN0LmlzSW5zdGFuY2VPZiA9IGZ1bmN0aW9uKGNscyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlDaGVja3MgdGhlIGluaGVyaXRhbmNlIGNoYWluIHRvIHNlZSBpZiBpdCBpcyBpbmhlcml0ZWQgZnJvbSB0aGlzDQoJCS8vCQljbGFzcy4NCgkJLy8JY2xzOiBGdW5jdGlvbg0KCQkvLwkJQ2xhc3MgY29uc3RydWN0b3IuDQoJCS8vCXJldHVybnM6DQoJCS8vCQkidHJ1ZSIsIGlmIHRoaXMgb2JqZWN0IGlzIGluaGVyaXRlZCBmcm9tIHRoaXMgY2xhc3MsICJmYWxzZSINCgkJLy8JCW90aGVyd2lzZS4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlUaGlzIG1ldGhvZCBpcyB1c2VkIHdpdGggaW5zdGFuY2VzIG9mIGNsYXNzZXMgcHJvZHVjZWQgd2l0aA0KCQkvLwkJZG9qby5kZWNsYXJlIHRvIGRldGVybWluZSBvZiB0aGV5IHN1cHBvcnQgYSBjZXJ0YWluIGludGVyZmFjZSBvcg0KCQkvLwkJbm90LiBJdCBtb2RlbHMgImluc3RhbmNlb2YiIG9wZXJhdG9yLg0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBBID0gZG9qby5kZWNsYXJlKG51bGwsIHsNCgkJLy8JfAkJLy8gY29uc3RydWN0b3IsIHByb3BlcnRpZXMsIGFuZCBtZXRob2RzIGdvIGhlcmUNCgkJLy8JfAkJLy8gLi4uDQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQyA9IGRvam8uZGVjbGFyZShbQSwgQl0sIHsNCgkJLy8JfAkJLy8gY29uc3RydWN0b3IsIHByb3BlcnRpZXMsIGFuZCBtZXRob2RzIGdvIGhlcmUNCgkJLy8JfAkJLy8gLi4uDQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIEQgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfA0KCQkvLwl8CXZhciBhID0gbmV3IEEoKSwgYiA9IG5ldyBCKCksIGMgPSBuZXcgQygpLCBkID0gbmV3IEQoKTsNCgkJLy8JfA0KCQkvLwl8CWNvbnNvbGUubG9nKGEuaXNJbnN0YW5jZU9mKEEpKTsgLy8gdHJ1ZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGIuaXNJbnN0YW5jZU9mKEEpKTsgLy8gZmFsc2UNCgkJLy8JfAljb25zb2xlLmxvZyhjLmlzSW5zdGFuY2VPZihBKSk7IC8vIHRydWUNCgkJLy8JfAljb25zb2xlLmxvZyhkLmlzSW5zdGFuY2VPZihBKSk7IC8vIHRydWUNCgkJLy8JfA0KCQkvLwl8CWNvbnNvbGUubG9nKGEuaXNJbnN0YW5jZU9mKEIpKTsgLy8gZmFsc2UNCgkJLy8JfAljb25zb2xlLmxvZyhiLmlzSW5zdGFuY2VPZihCKSk7IC8vIHRydWUNCgkJLy8JfAljb25zb2xlLmxvZyhjLmlzSW5zdGFuY2VPZihCKSk7IC8vIHRydWUNCgkJLy8JfAljb25zb2xlLmxvZyhkLmlzSW5zdGFuY2VPZihCKSk7IC8vIGZhbHNlDQoJCS8vCXwNCgkJLy8JfAljb25zb2xlLmxvZyhhLmlzSW5zdGFuY2VPZihDKSk7IC8vIGZhbHNlDQoJCS8vCXwJY29uc29sZS5sb2coYi5pc0luc3RhbmNlT2YoQykpOyAvLyBmYWxzZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGMuaXNJbnN0YW5jZU9mKEMpKTsgLy8gdHJ1ZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGQuaXNJbnN0YW5jZU9mKEMpKTsgLy8gZmFsc2UNCgkJLy8JfA0KCQkvLwl8CWNvbnNvbGUubG9nKGEuaXNJbnN0YW5jZU9mKEQpKTsgLy8gZmFsc2UNCgkJLy8JfAljb25zb2xlLmxvZyhiLmlzSW5zdGFuY2VPZihEKSk7IC8vIGZhbHNlDQoJCS8vCXwJY29uc29sZS5sb2coYy5pc0luc3RhbmNlT2YoRCkpOyAvLyBmYWxzZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGQuaXNJbnN0YW5jZU9mKEQpKTsgLy8gdHJ1ZQ0KCQlyZXR1cm4Je307CS8vIE9iamVjdA0KCX0NCgk9PT09PSovDQoNCgkvKj09PT09DQoJT2JqZWN0LmV4dGVuZCA9IGZ1bmN0aW9uKHNvdXJjZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlBZGRzIGFsbCBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9mIHNvdXJjZSB0byBjb25zdHJ1Y3RvcidzDQoJCS8vCQlwcm90b3R5cGUsIG1ha2luZyB0aGVtIGF2YWlsYWJsZSB0byBhbGwgaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aA0KCQkvLwkJY29uc3RydWN0b3IuIFRoaXMgbWV0aG9kIGlzIHNwZWNpZmljIHRvIGNvbnN0cnVjdG9ycyBjcmVhdGVkIHdpdGgNCgkJLy8JCWRvam8uZGVjbGFyZS4NCgkJLy8Jc291cmNlOiBPYmplY3QNCgkJLy8JCVNvdXJjZSBvYmplY3Qgd2hpY2ggcHJvcGVydGllcyBhcmUgZ29pbmcgdG8gYmUgY29waWVkIHRvIHRoZQ0KCQkvLwkJY29uc3RydWN0b3IncyBwcm90b3R5cGUuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJQWRkcyBzb3VyY2UgcHJvcGVydGllcyB0byB0aGUgY29uc3RydWN0b3IncyBwcm90b3R5cGUuIEl0IGNhbg0KCQkvLwkJb3ZlcnJpZGUgZXhpc3RpbmcgcHJvcGVydGllcy4NCgkJLy8NCgkJLy8JCVRoaXMgbWV0aG9kIGlzIHNpbWlsYXIgdG8gZG9qby5leHRlbmQgZnVuY3Rpb24sIGJ1dCBpdCBpcyBzcGVjaWZpYw0KCQkvLwkJdG8gY29uc3RydWN0b3JzIHByb2R1Y2VkIGJ5IGRvam8uZGVjbGFyZS4gSXQgaXMgaW1wbGVtZW50ZWQNCgkJLy8JCXVzaW5nIGRvam8uc2FmZU1peGluLCBhbmQgaXQgc2tpcHMgYSBjb25zdHJ1Y3RvciBwcm9wZXJ0eSwNCgkJLy8JCWFuZCBwcm9wZXJseSBkZWNvcmF0ZXMgY29waWVkIGZ1bmN0aW9ucy4NCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQSA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCW0xOiBmdW5jdGlvbigpe30sDQoJCS8vCXwJCXMxOiAiUG9wb2thdGVwZXRsIg0KCQkvLwl8CX0pOw0KCQkvLwl8CUEuZXh0ZW5kKHsNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7fSwNCgkJLy8JfAkJbTI6IGZ1bmN0aW9uKCl7fSwNCgkJLy8JfAkJZjE6IHRydWUsDQoJCS8vCXwJCWQxOiA0Mg0KCQkvLwl8CX0pOw0KCX07DQoJPT09PT0qLw0KfSkoKTsNCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuY29ubmVjdCJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5jb25uZWN0Il0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmNvbm5lY3QiKTsNCg0KDQovLyB0aGlzIGZpbGUgY291cnRlc3kgb2YgdGhlIFR1cmJvQWpheCBHcm91cCwgbGljZW5zZWQgdW5kZXIgYSBEb2pvIENMQQ0KDQovLyBsb3ctbGV2ZWwgZGVsZWdhdGlvbiBtYWNoaW5lcnkNCmRvam8uX2xpc3RlbmVyID0gew0KCS8vIGNyZWF0ZSBhIGRpc3BhdGNoZXIgZnVuY3Rpb24NCglnZXREaXNwYXRjaGVyOiBmdW5jdGlvbigpew0KCQkvLyBmb2xsb3dpbmcgY29tbWVudHMgcHVsbGVkIG91dC1vZi1saW5lIHRvIHByZXZlbnQgY2xvbmluZyB0aGVtIA0KCQkvLyBpbiB0aGUgcmV0dXJuZWQgZnVuY3Rpb24uDQoJCS8vIC0gaW5kaWNlcyAoaSkgdGhhdCBhcmUgcmVhbGx5IGluIHRoZSBhcnJheSBvZiBsaXN0ZW5lcnMgKGxzKSB3aWxsIA0KCQkvLyAgIG5vdCBiZSBpbiBBcnJheS5wcm90b3R5cGUuIFRoaXMgaXMgdGhlICdzcGFyc2UgYXJyYXknIHRyaWNrDQoJCS8vICAgdGhhdCBrZWVwcyB1cyBzYWZlIGZyb20gbGlicyB0aGF0IHRha2UgbGliZXJ0aWVzIHdpdGggYnVpbHQtaW4gDQoJCS8vICAgb2JqZWN0cw0KCQkvLyAtIGxpc3RlbmVyIGlzIGludm9rZWQgd2l0aCBjdXJyZW50IHNjb3BlICh0aGlzKQ0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBhcD1BcnJheS5wcm90b3R5cGUsIGM9YXJndW1lbnRzLmNhbGxlZSwgbHM9Yy5fbGlzdGVuZXJzLCB0PWMudGFyZ2V0Ow0KCQkJLy8gcmV0dXJuIHZhbHVlIGNvbWVzIGZyb20gb3JpZ2luYWwgdGFyZ2V0IGZ1bmN0aW9uDQoJCQl2YXIgciA9IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJLy8gbWFrZSBsb2NhbCBjb3B5IG9mIGxpc3RlbmVyIGFycmF5IHNvIGl0IGlzIGltbXV0YWJsZSBkdXJpbmcgcHJvY2Vzc2luZw0KCQkJdmFyIGksIGxsczsNCgkJCQkJCQkJCQkJbGxzID0gW10uY29uY2F0KGxzKTsNCgkJCQkJCQkNCgkJCS8vIGludm9rZSBsaXN0ZW5lcnMgYWZ0ZXIgdGFyZ2V0IGZ1bmN0aW9uDQoJCQlmb3IoaSBpbiBsbHMpew0KCQkJCWlmKCEoaSBpbiBhcCkpew0KCQkJCQlsbHNbaV0uYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCQl9DQoJCQl9DQoJCQkvLyByZXR1cm4gdmFsdWUgY29tZXMgZnJvbSBvcmlnaW5hbCB0YXJnZXQgZnVuY3Rpb24NCgkJCXJldHVybiByOw0KCQl9Ow0KCX0sDQoJLy8gYWRkIGEgbGlzdGVuZXIgdG8gYW4gb2JqZWN0DQoJYWRkOiBmdW5jdGlvbigvKk9iamVjdCovIHNvdXJjZSwgLypTdHJpbmcqLyBtZXRob2QsIC8qRnVuY3Rpb24qLyBsaXN0ZW5lcil7DQoJCS8vIFdoZW5ldmVyICdtZXRob2QnIGlzIGludm9rZWQsICdsaXN0ZW5lcicgd2lsbCBoYXZlIHRoZSBzYW1lIHNjb3BlLg0KCQkvLyBUcnlpbmcgdG8gc3VwcG9ydGluZyBhIGNvbnRleHQgb2JqZWN0IGZvciB0aGUgbGlzdGVuZXIgbGVkIHRvIA0KCQkvLyBjb21wbGV4aXR5LiANCgkJLy8gTm9uIHRyaXZpYWwgdG8gcHJvdmlkZSAnb25jZScgZnVuY3Rpb25hbGl0eSBoZXJlDQoJCS8vIGJlY2F1c2UgbGlzdGVuZXIgY291bGQgYmUgdGhlIHJlc3VsdCBvZiBhIGRvam8uaGl0Y2ggY2FsbCwNCgkJLy8gaW4gd2hpY2ggY2FzZSB0d28gcmVmZXJlbmNlcyB0byB0aGUgc2FtZSBoaXRjaCB0YXJnZXQgd291bGQgbm90DQoJCS8vIGJlIGVxdWl2YWxlbnQuIA0KCQlzb3VyY2UgPSBzb3VyY2UgfHwgZG9qby5nbG9iYWw7DQoJCS8vIFRoZSBzb3VyY2UgbWV0aG9kIGlzIGVpdGhlciBudWxsLCBhIGRpc3BhdGNoZXIsIG9yIHNvbWUgb3RoZXIgZnVuY3Rpb24NCgkJdmFyIGYgPSBzb3VyY2VbbWV0aG9kXTsNCgkJLy8gRW5zdXJlIGEgZGlzcGF0Y2hlcg0KCQlpZighZiB8fCAhZi5fbGlzdGVuZXJzKXsNCgkJCXZhciBkID0gZG9qby5fbGlzdGVuZXIuZ2V0RGlzcGF0Y2hlcigpOw0KCQkJLy8gb3JpZ2luYWwgdGFyZ2V0IGZ1bmN0aW9uIGlzIHNwZWNpYWwNCgkJCWQudGFyZ2V0ID0gZjsNCgkJCS8vIGRpc3BhdGNoZXIgaG9sZHMgYSBsaXN0IG9mIGxpc3RlbmVycw0KCQkJZC5fbGlzdGVuZXJzID0gW107IA0KCQkJLy8gcmVkaXJlY3Qgc291cmNlIHRvIGRpc3BhdGNoZXINCgkJCWYgPSBzb3VyY2VbbWV0aG9kXSA9IGQ7DQoJCX0NCgkJLy8gVGhlIGNvbnRyYWN0IGlzIHRoYXQgYSBoYW5kbGUgaXMgcmV0dXJuZWQgdGhhdCBjYW4gDQoJCS8vIGlkZW50aWZ5IHRoaXMgbGlzdGVuZXIgZm9yIGRpc2Nvbm5lY3QuIA0KCQkvLw0KCQkvLyBUaGUgdHlwZSBvZiB0aGUgaGFuZGxlIGlzIHByaXZhdGUuIEhlcmUgaXMgaXQgaW1wbGVtZW50ZWQgYXMgSW50ZWdlci4gDQoJCS8vIERPTSBldmVudCBjb2RlIGhhcyB0aGlzIHNhbWUgY29udHJhY3QgYnV0IGhhbmRsZSBpcyBGdW5jdGlvbiANCgkJLy8gaW4gbm9uLUlFIGJyb3dzZXJzLg0KCQkvLw0KCQkvLyBXZSBjb3VsZCBoYXZlIHNlcGFyYXRlIGxpc3RzIG9mIGJlZm9yZSBhbmQgYWZ0ZXIgbGlzdGVuZXJzLg0KCQlyZXR1cm4gZi5fbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOyAvKkhhbmRsZSovDQoJfSwNCgkvLyByZW1vdmUgYSBsaXN0ZW5lciBmcm9tIGFuIG9iamVjdA0KCXJlbW92ZTogZnVuY3Rpb24oLypPYmplY3QqLyBzb3VyY2UsIC8qU3RyaW5nKi8gbWV0aG9kLCAvKkhhbmRsZSovIGhhbmRsZSl7DQoJCXZhciBmID0gKHNvdXJjZSB8fCBkb2pvLmdsb2JhbClbbWV0aG9kXTsNCgkJLy8gcmVtZW1iZXIgdGhhdCBoYW5kbGUgaXMgdGhlIGluZGV4KzEgKDAgaXMgbm90IGEgdmFsaWQgaGFuZGxlKQ0KCQlpZihmICYmIGYuX2xpc3RlbmVycyAmJiBoYW5kbGUtLSl7DQoJCQlkZWxldGUgZi5fbGlzdGVuZXJzW2hhbmRsZV07DQoJCX0NCgl9DQp9Ow0KDQovLyBNdWx0aXBsZSBkZWxlZ2F0aW9uIGZvciBhcmJpdHJhcnkgbWV0aG9kcy4NCg0KLy8gVGhpcyB1bml0IGtub3dzIG5vdGhpbmcgYWJvdXQgRE9NLCBidXQgd2UgaW5jbHVkZSBET00gYXdhcmUgZG9jdW1lbnRhdGlvbg0KLy8gYW5kIGRvbnRGaXggYXJndW1lbnQgaGVyZSB0byBoZWxwIHRoZSBhdXRvZG9jcy4gQWN0dWFsIERPTSBhd2FyZSBjb2RlIGlzIGluDQovLyBldmVudC5qcy4NCg0KZG9qby5jb25uZWN0ID0gZnVuY3Rpb24oLypPYmplY3R8bnVsbCovIG9iaiwgDQoJCQkJCQkvKlN0cmluZyovIGV2ZW50LCANCgkJCQkJCS8qT2JqZWN0fG51bGwqLyBjb250ZXh0LCANCgkJCQkJCS8qU3RyaW5nfEZ1bmN0aW9uKi8gbWV0aG9kLA0KCQkJCQkJLypCb29sZWFuPyovIGRvbnRGaXgpew0KCS8vIHN1bW1hcnk6DQoJLy8JCWBkb2pvLmNvbm5lY3RgIGlzIHRoZSBjb3JlIGV2ZW50IGhhbmRsaW5nIGFuZCBkZWxlZ2F0aW9uIG1ldGhvZCBpbg0KCS8vCQlEb2pvLiBJdCBhbGxvd3Mgb25lIGZ1bmN0aW9uIHRvICJsaXN0ZW4gaW4iIG9uIHRoZSBleGVjdXRpb24gb2YNCgkvLwkJYW55IG90aGVyLCB0cmlnZ2VyaW5nIHRoZSBzZWNvbmQgd2hlbmV2ZXIgdGhlIGZpcnN0IGlzIGNhbGxlZC4gTWFueQ0KCS8vCQlsaXN0ZW5lcnMgbWF5IGJlIGF0dGFjaGVkIHRvIGEgZnVuY3Rpb24sIGFuZCBzb3VyY2UgZnVuY3Rpb25zIG1heQ0KCS8vCQliZSBlaXRoZXIgcmVndWxhciBmdW5jdGlvbiBjYWxscyBvciBET00gZXZlbnRzLg0KCS8vDQoJLy8gZGVzY3JpcHRpb246DQoJLy8JCUNvbm5lY3RzIGxpc3RlbmVycyB0byBhY3Rpb25zLCBzbyB0aGF0IGFmdGVyIGV2ZW50IGZpcmVzLCBhDQoJLy8JCWxpc3RlbmVyIGlzIGNhbGxlZCB3aXRoIHRoZSBzYW1lIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIG9yaWdpbmFsDQoJLy8JCWZ1bmN0aW9uLg0KCS8vDQoJLy8JCVNpbmNlIGBkb2pvLmNvbm5lY3RgIGFsbG93cyB0aGUgc291cmNlIG9mIGV2ZW50cyB0byBiZSBlaXRoZXIgYQ0KCS8vCQkicmVndWxhciIgSmF2YVNjcmlwdCBmdW5jdGlvbiBvciBhIERPTSBldmVudCwgaXQgcHJvdmlkZXMgYSB1bmlmb3JtDQoJLy8JCWludGVyZmFjZSBmb3IgbGlzdGVuaW5nIHRvIGFsbCB0aGUgdHlwZXMgb2YgZXZlbnRzIHRoYXQgYW4NCgkvLwkJYXBwbGljYXRpb24gaXMgbGlrZWx5IHRvIGRlYWwgd2l0aCB0aG91Z2ggYSBzaW5nbGUsIHVuaWZpZWQNCgkvLwkJaW50ZXJmYWNlLiBET00gcHJvZ3JhbW1lcnMgbWF5IHdhbnQgdG8gdGhpbmsgb2YgaXQgYXMNCgkvLwkJImFkZEV2ZW50TGlzdGVuZXIgZm9yIGV2ZXJ5dGhpbmcgYW5kIGFueXRoaW5nIi4NCgkvLw0KCS8vCQlXaGVuIHNldHRpbmcgdXAgYSBjb25uZWN0aW9uLCB0aGUgYGV2ZW50YCBwYXJhbWV0ZXIgbXVzdCBiZSBhDQoJLy8JCXN0cmluZyB0aGF0IGlzIHRoZSBuYW1lIG9mIHRoZSBtZXRob2QvZXZlbnQgdG8gYmUgbGlzdGVuZWQgZm9yLiBJZg0KCS8vCQlgb2JqYCBpcyBudWxsLCBgZG9qby5nbG9iYWxgIGlzIGFzc3VtZWQsIG1lYW5pbmcgdGhhdCBjb25uZWN0aW9ucw0KCS8vCQl0byBnbG9iYWwgbWV0aG9kcyBhcmUgc3VwcG9ydGVkIGJ1dCBhbHNvIHRoYXQgeW91IG1heSBpbmFkdmVydGVudGx5DQoJLy8JCWNvbm5lY3QgdG8gYSBnbG9iYWwgYnkgcGFzc2luZyBhbiBpbmNvcnJlY3Qgb2JqZWN0IG5hbWUgb3IgaW52YWxpZA0KCS8vCQlyZWZlcmVuY2UuDQoJLy8NCgkvLwkJYGRvam8uY29ubmVjdGAgZ2VuZXJhbGx5IGlzIGZvcmdpdmluZy4gSWYgeW91IHBhc3MgdGhlIG5hbWUgb2YgYQ0KCS8vCQlmdW5jdGlvbiBvciBtZXRob2QgdGhhdCBkb2VzIG5vdCB5ZXQgZXhpc3Qgb24gYG9iamAsIGNvbm5lY3Qgd2lsbA0KCS8vCQlub3QgZmFpbCwgYnV0IHdpbGwgaW5zdGVhZCBzZXQgdXAgYSBzdHViIG1ldGhvZC4gU2ltaWxhcmx5LCBudWxsDQoJLy8JCWFyZ3VtZW50cyBtYXkgc2ltcGx5IGJlIG9taXR0ZWQgc3VjaCB0aGF0IGZld2VyIHRoYW4gNCBhcmd1bWVudHMNCgkvLwkJbWF5IGJlIHJlcXVpcmVkIHRvIHNldCB1cCBhIGNvbm5lY3Rpb24gU2VlIHRoZSBleGFtcGxlcyBmb3IgZGV0YWlscy4NCgkvLw0KCS8vCQlUaGUgcmV0dXJuIHZhbHVlIGlzIGEgaGFuZGxlIHRoYXQgaXMgbmVlZGVkIHRvIA0KCS8vCQlyZW1vdmUgdGhpcyBjb25uZWN0aW9uIHdpdGggYGRvam8uZGlzY29ubmVjdGAuDQoJLy8NCgkvLyBvYmo6IA0KCS8vCQlUaGUgc291cmNlIG9iamVjdCBmb3IgdGhlIGV2ZW50IGZ1bmN0aW9uLiANCgkvLwkJRGVmYXVsdHMgdG8gYGRvam8uZ2xvYmFsYCBpZiBudWxsLg0KCS8vCQlJZiBvYmogaXMgYSBET00gbm9kZSwgdGhlIGNvbm5lY3Rpb24gaXMgZGVsZWdhdGVkIA0KCS8vCQl0byB0aGUgRE9NIGV2ZW50IG1hbmFnZXIgKHVubGVzcyBkb250Rml4IGlzIHRydWUpLg0KCS8vDQoJLy8gZXZlbnQ6DQoJLy8JCVN0cmluZyBuYW1lIG9mIHRoZSBldmVudCBmdW5jdGlvbiBpbiBvYmouIA0KCS8vCQlJLmUuIGlkZW50aWZpZXMgYSBwcm9wZXJ0eSBgb2JqW2V2ZW50XWAuDQoJLy8NCgkvLyBjb250ZXh0OiANCgkvLwkJVGhlIG9iamVjdCB0aGF0IG1ldGhvZCB3aWxsIHJlY2VpdmUgYXMgInRoaXMiLg0KCS8vDQoJLy8JCUlmIGNvbnRleHQgaXMgbnVsbCBhbmQgbWV0aG9kIGlzIGEgZnVuY3Rpb24sIHRoZW4gbWV0aG9kDQoJLy8JCWluaGVyaXRzIHRoZSBjb250ZXh0IG9mIGV2ZW50Lg0KCS8vCQ0KCS8vCQlJZiBtZXRob2QgaXMgYSBzdHJpbmcgdGhlbiBjb250ZXh0IG11c3QgYmUgdGhlIHNvdXJjZSANCgkvLwkJb2JqZWN0IG9iamVjdCBmb3IgbWV0aG9kIChjb250ZXh0W21ldGhvZF0pLiBJZiBjb250ZXh0IGlzIG51bGwsDQoJLy8JCWRvam8uZ2xvYmFsIGlzIHVzZWQuDQoJLy8NCgkvLyBtZXRob2Q6DQoJLy8JCUEgZnVuY3Rpb24gcmVmZXJlbmNlLCBvciBuYW1lIG9mIGEgZnVuY3Rpb24gaW4gY29udGV4dC4gDQoJLy8JCVRoZSBmdW5jdGlvbiBpZGVudGlmaWVkIGJ5IG1ldGhvZCBmaXJlcyBhZnRlciBldmVudCBkb2VzLiANCgkvLwkJbWV0aG9kIHJlY2VpdmVzIHRoZSBzYW1lIGFyZ3VtZW50cyBhcyB0aGUgZXZlbnQuDQoJLy8JCVNlZSBjb250ZXh0IGFyZ3VtZW50IGNvbW1lbnRzIGZvciBpbmZvcm1hdGlvbiBvbiBtZXRob2QncyBzY29wZS4NCgkvLw0KCS8vIGRvbnRGaXg6DQoJLy8JCUlmIG9iaiBpcyBhIERPTSBub2RlLCBzZXQgZG9udEZpeCB0byB0cnVlIHRvIHByZXZlbnQgZGVsZWdhdGlvbiANCgkvLwkJb2YgdGhpcyBjb25uZWN0aW9uIHRvIHRoZSBET00gZXZlbnQgbWFuYWdlci4NCgkvLw0KCS8vIGV4YW1wbGU6DQoJLy8JCVdoZW4gb2JqLm9uY2hhbmdlKCksIGRvIHVpLnVwZGF0ZSgpOg0KCS8vCXwJZG9qby5jb25uZWN0KG9iaiwgIm9uY2hhbmdlIiwgdWksICJ1cGRhdGUiKTsNCgkvLwl8CWRvam8uY29ubmVjdChvYmosICJvbmNoYW5nZSIsIHVpLCB1aS51cGRhdGUpOyAvLyBzYW1lDQoJLy8NCgkvLyBleGFtcGxlOg0KCS8vCQlVc2luZyByZXR1cm4gdmFsdWUgZm9yIGRpc2Nvbm5lY3Q6DQoJLy8JfAl2YXIgbGluayA9IGRvam8uY29ubmVjdChvYmosICJvbmNoYW5nZSIsIHVpLCAidXBkYXRlIik7DQoJLy8JfAkuLi4NCgkvLwl8CWRvam8uZGlzY29ubmVjdChsaW5rKTsNCgkvLw0KCS8vIGV4YW1wbGU6DQoJLy8JCVdoZW4gb25nbG9iYWxldmVudCBleGVjdXRlcywgd2F0Y2hlci5oYW5kbGVyIGlzIGludm9rZWQ6DQoJLy8JfAlkb2pvLmNvbm5lY3QobnVsbCwgIm9uZ2xvYmFsZXZlbnQiLCB3YXRjaGVyLCAiaGFuZGxlciIpOw0KCS8vDQoJLy8gZXhhbXBsZToNCgkvLwkJV2hlbiBvYi5vbkN1c3RvbUV2ZW50IGV4ZWN1dGVzLCBjdXN0b21FdmVudEhhbmRsZXIgaXMgaW52b2tlZDoNCgkvLwl8CWRvam8uY29ubmVjdChvYiwgIm9uQ3VzdG9tRXZlbnQiLCBudWxsLCAiY3VzdG9tRXZlbnRIYW5kbGVyIik7DQoJLy8JfAlkb2pvLmNvbm5lY3Qob2IsICJvbkN1c3RvbUV2ZW50IiwgImN1c3RvbUV2ZW50SGFuZGxlciIpOyAvLyBzYW1lDQoJLy8NCgkvLyBleGFtcGxlOg0KCS8vCQlXaGVuIG9iLm9uQ3VzdG9tRXZlbnQgZXhlY3V0ZXMsIGN1c3RvbUV2ZW50SGFuZGxlciBpcyBpbnZva2VkDQoJLy8JCXdpdGggdGhlIHNhbWUgc2NvcGUgKHRoaXMpOg0KCS8vCXwJZG9qby5jb25uZWN0KG9iLCAib25DdXN0b21FdmVudCIsIG51bGwsIGN1c3RvbUV2ZW50SGFuZGxlcik7DQoJLy8JfAlkb2pvLmNvbm5lY3Qob2IsICJvbkN1c3RvbUV2ZW50IiwgY3VzdG9tRXZlbnRIYW5kbGVyKTsgLy8gc2FtZQ0KCS8vDQoJLy8gZXhhbXBsZToNCgkvLwkJV2hlbiBnbG9iYWxFdmVudCBleGVjdXRlcywgZ2xvYmFsSGFuZGxlciBpcyBpbnZva2VkDQoJLy8JCXdpdGggdGhlIHNhbWUgc2NvcGUgKHRoaXMpOg0KCS8vCXwJZG9qby5jb25uZWN0KG51bGwsICJnbG9iYWxFdmVudCIsIG51bGwsIGdsb2JhbEhhbmRsZXIpOw0KCS8vCXwJZG9qby5jb25uZWN0KCJnbG9iYWxFdmVudCIsIGdsb2JhbEhhbmRsZXIpOyAvLyBzYW1lDQoNCgkvLyBub3JtYWxpemUgYXJndW1lbnRzDQoJdmFyIGE9YXJndW1lbnRzLCBhcmdzPVtdLCBpPTA7DQoJLy8gaWYgYVswXSBpcyBhIFN0cmluZywgb2JqIHdhcyBvbWl0dGVkDQoJYXJncy5wdXNoKGRvam8uaXNTdHJpbmcoYVswXSkgPyBudWxsIDogYVtpKytdLCBhW2krK10pOw0KCS8vIGlmIHRoZSBhcmctYWZ0ZXItbmV4dCBpcyBhIFN0cmluZyBvciBGdW5jdGlvbiwgY29udGV4dCB3YXMgTk9UIG9taXR0ZWQNCgl2YXIgYTEgPSBhW2krMV07DQoJYXJncy5wdXNoKGRvam8uaXNTdHJpbmcoYTEpfHxkb2pvLmlzRnVuY3Rpb24oYTEpID8gYVtpKytdIDogbnVsbCwgYVtpKytdKTsNCgkvLyBhYnNvcmIgYW55IGFkZGl0aW9uYWwgYXJndW1lbnRzDQoJZm9yKHZhciBsPWEubGVuZ3RoOyBpPGw7IGkrKyl7CWFyZ3MucHVzaChhW2ldKTsgfQ0KCS8vIGRvIHRoZSBhY3R1YWwgd29yaw0KCXJldHVybiBkb2pvLl9jb25uZWN0LmFwcGx5KHRoaXMsIGFyZ3MpOyAvKkhhbmRsZSovDQp9DQoNCi8vIHVzZWQgYnkgbm9uLWJyb3dzZXIgaG9zdGVudnMuIGFsd2F5cyBvdmVycmlkZW4gYnkgZXZlbnQuanMNCmRvam8uX2Nvbm5lY3QgPSBmdW5jdGlvbihvYmosIGV2ZW50LCBjb250ZXh0LCBtZXRob2Qpew0KCXZhciBsPWRvam8uX2xpc3RlbmVyLCBoPWwuYWRkKG9iaiwgZXZlbnQsIGRvam8uaGl0Y2goY29udGV4dCwgbWV0aG9kKSk7IA0KCXJldHVybiBbb2JqLCBldmVudCwgaCwgbF07IC8vIEhhbmRsZQ0KfQ0KDQpkb2pvLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbigvKkhhbmRsZSovIGhhbmRsZSl7DQoJLy8gc3VtbWFyeToNCgkvLwkJUmVtb3ZlIGEgbGluayBjcmVhdGVkIGJ5IGRvam8uY29ubmVjdC4NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLwkJUmVtb3ZlcyB0aGUgY29ubmVjdGlvbiBiZXR3ZWVuIGV2ZW50IGFuZCB0aGUgbWV0aG9kIHJlZmVyZW5jZWQgYnkgaGFuZGxlLg0KCS8vIGhhbmRsZToNCgkvLwkJdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZG9qby5jb25uZWN0IGNhbGwgdGhhdCBjcmVhdGVkIHRoZSBjb25uZWN0aW9uLg0KCWlmKGhhbmRsZSAmJiBoYW5kbGVbMF0gIT09IHVuZGVmaW5lZCl7DQoJCWRvam8uX2Rpc2Nvbm5lY3QuYXBwbHkodGhpcywgaGFuZGxlKTsNCgkJLy8gbGV0J3Mgbm90IGtlZXAgdGhpcyByZWZlcmVuY2UNCgkJZGVsZXRlIGhhbmRsZVswXTsNCgl9DQp9DQoNCmRvam8uX2Rpc2Nvbm5lY3QgPSBmdW5jdGlvbihvYmosIGV2ZW50LCBoYW5kbGUsIGxpc3RlbmVyKXsNCglsaXN0ZW5lci5yZW1vdmUob2JqLCBldmVudCwgaGFuZGxlKTsNCn0NCg0KLy8gdG9waWMgcHVibGlzaC9zdWJzY3JpYmUNCg0KZG9qby5fdG9waWNzID0ge307DQoNCmRvam8uc3Vic2NyaWJlID0gZnVuY3Rpb24oLypTdHJpbmcqLyB0b3BpYywgLypPYmplY3R8bnVsbCovIGNvbnRleHQsIC8qU3RyaW5nfEZ1bmN0aW9uKi8gbWV0aG9kKXsNCgkvLwlzdW1tYXJ5Og0KCS8vCQlBdHRhY2ggYSBsaXN0ZW5lciB0byBhIG5hbWVkIHRvcGljLiBUaGUgbGlzdGVuZXIgZnVuY3Rpb24gaXMgaW52b2tlZCB3aGVuZXZlciB0aGUNCgkvLwkJbmFtZWQgdG9waWMgaXMgcHVibGlzaGVkIChzZWU6IGRvam8ucHVibGlzaCkuDQoJLy8JCVJldHVybnMgYSBoYW5kbGUgd2hpY2ggaXMgbmVlZGVkIHRvIHVuc3Vic2NyaWJlIHRoaXMgbGlzdGVuZXIuDQoJLy8JY29udGV4dDoNCgkvLwkJU2NvcGUgaW4gd2hpY2ggbWV0aG9kIHdpbGwgYmUgaW52b2tlZCwgb3IgbnVsbCBmb3IgZGVmYXVsdCBzY29wZS4NCgkvLwltZXRob2Q6DQoJLy8JCVRoZSBuYW1lIG9mIGEgZnVuY3Rpb24gaW4gY29udGV4dCwgb3IgYSBmdW5jdGlvbiByZWZlcmVuY2UuIFRoaXMgaXMgdGhlIGZ1bmN0aW9uIHRoYXQNCgkvLwkJaXMgaW52b2tlZCB3aGVuIHRvcGljIGlzIHB1Ymxpc2hlZC4NCgkvLwlleGFtcGxlOg0KCS8vCXwJZG9qby5zdWJzY3JpYmUoImFsZXJ0cyIsIG51bGwsIGZ1bmN0aW9uKGNhcHRpb24sIG1lc3NhZ2UpeyBhbGVydChjYXB0aW9uICsgIlxuIiArIG1lc3NhZ2UpOyB9KTsNCgkvLwl8CWRvam8ucHVibGlzaCgiYWxlcnRzIiwgWyAicmVhZCB0aGlzIiwgImhlbGxvIHdvcmxkIiBdKTsJCQkJCQkJCQkJCQkJCQkJCQ0KDQoJLy8gc3VwcG9ydCBmb3IgMiBhcmd1bWVudCBpbnZvY2F0aW9uIChvbWl0dGluZyBjb250ZXh0KSBkZXBlbmRzIG9uIGhpdGNoDQoJcmV0dXJuIFt0b3BpYywgZG9qby5fbGlzdGVuZXIuYWRkKGRvam8uX3RvcGljcywgdG9waWMsIGRvam8uaGl0Y2goY29udGV4dCwgbWV0aG9kKSldOyAvKkhhbmRsZSovDQp9DQoNCmRvam8udW5zdWJzY3JpYmUgPSBmdW5jdGlvbigvKkhhbmRsZSovIGhhbmRsZSl7DQoJLy8Jc3VtbWFyeToNCgkvLwkgCVJlbW92ZSBhIHRvcGljIGxpc3RlbmVyLiANCgkvLwloYW5kbGU6DQoJLy8JIAlUaGUgaGFuZGxlIHJldHVybmVkIGZyb20gYSBjYWxsIHRvIHN1YnNjcmliZS4NCgkvLwlleGFtcGxlOg0KCS8vCXwJdmFyIGFsZXJ0ZXIgPSBkb2pvLnN1YnNjcmliZSgiYWxlcnRzIiwgbnVsbCwgZnVuY3Rpb24oY2FwdGlvbiwgbWVzc2FnZSl7IGFsZXJ0KGNhcHRpb24gKyAiXG4iICsgbWVzc2FnZSk7IH07DQoJLy8JfAkuLi4NCgkvLwl8CWRvam8udW5zdWJzY3JpYmUoYWxlcnRlcik7DQoJaWYoaGFuZGxlKXsNCgkJZG9qby5fbGlzdGVuZXIucmVtb3ZlKGRvam8uX3RvcGljcywgaGFuZGxlWzBdLCBoYW5kbGVbMV0pOw0KCX0NCn0NCg0KZG9qby5wdWJsaXNoID0gZnVuY3Rpb24oLypTdHJpbmcqLyB0b3BpYywgLypBcnJheSovIGFyZ3Mpew0KCS8vCXN1bW1hcnk6DQoJLy8JIAlJbnZva2UgYWxsIGxpc3RlbmVyIG1ldGhvZCBzdWJzY3JpYmVkIHRvIHRvcGljLg0KCS8vCXRvcGljOg0KCS8vCSAJVGhlIG5hbWUgb2YgdGhlIHRvcGljIHRvIHB1Ymxpc2guDQoJLy8JYXJnczoNCgkvLwkgCUFuIGFycmF5IG9mIGFyZ3VtZW50cy4gVGhlIGFyZ3VtZW50cyB3aWxsIGJlIGFwcGxpZWQgDQoJLy8JIAl0byBlYWNoIHRvcGljIHN1YnNjcmliZXIgKGFzIGZpcnN0IGNsYXNzIHBhcmFtZXRlcnMsIHZpYSBhcHBseSkuDQoJLy8JZXhhbXBsZToNCgkvLwl8CWRvam8uc3Vic2NyaWJlKCJhbGVydHMiLCBudWxsLCBmdW5jdGlvbihjYXB0aW9uLCBtZXNzYWdlKXsgYWxlcnQoY2FwdGlvbiArICJcbiIgKyBtZXNzYWdlKTsgfTsNCgkvLwl8CWRvam8ucHVibGlzaCgiYWxlcnRzIiwgWyAicmVhZCB0aGlzIiwgImhlbGxvIHdvcmxkIiBdKTsJDQoNCgkvLyBOb3RlIHRoYXQgYXJncyBpcyBhbiBhcnJheSwgd2hpY2ggaXMgbW9yZSBlZmZpY2llbnQgdnMgdmFyaWFibGUgbGVuZ3RoDQoJLy8gYXJndW1lbnQgbGlzdC4gIElkZWFsbHksIHZhciBhcmdzIHdvdWxkIGJlIGltcGxlbWVudGVkIHZpYSBBcnJheQ0KCS8vIHRocm91Z2hvdXQgdGhlIEFQSXMuDQoJdmFyIGYgPSBkb2pvLl90b3BpY3NbdG9waWNdOw0KCWlmKGYpew0KCQlmLmFwcGx5KHRoaXMsIGFyZ3N8fFtdKTsNCgl9DQp9DQoNCmRvam8uY29ubmVjdFB1Ymxpc2hlciA9IGZ1bmN0aW9uKAkvKlN0cmluZyovIHRvcGljLCANCgkJCQkJCQkJCS8qT2JqZWN0fG51bGwqLyBvYmosIA0KCQkJCQkJCQkJLypTdHJpbmcqLyBldmVudCl7DQoJLy8Jc3VtbWFyeToNCgkvLwkgCUVuc3VyZSB0aGF0IGV2ZXJ5IHRpbWUgb2JqLmV2ZW50KCkgaXMgY2FsbGVkLCBhIG1lc3NhZ2UgaXMgcHVibGlzaGVkDQoJLy8JIAlvbiB0aGUgdG9waWMuIFJldHVybnMgYSBoYW5kbGUgd2hpY2ggY2FuIGJlIHBhc3NlZCB0bw0KCS8vCSAJZG9qby5kaXNjb25uZWN0KCkgdG8gZGlzYWJsZSBzdWJzZXF1ZW50IGF1dG9tYXRpYyBwdWJsaWNhdGlvbiBvbg0KCS8vCSAJdGhlIHRvcGljLg0KCS8vCXRvcGljOg0KCS8vCSAJVGhlIG5hbWUgb2YgdGhlIHRvcGljIHRvIHB1Ymxpc2guDQoJLy8Jb2JqOiANCgkvLwkgCVRoZSBzb3VyY2Ugb2JqZWN0IGZvciB0aGUgZXZlbnQgZnVuY3Rpb24uIERlZmF1bHRzIHRvIGRvam8uZ2xvYmFsDQoJLy8JIAlpZiBudWxsLg0KCS8vCWV2ZW50Og0KCS8vCSAJVGhlIG5hbWUgb2YgdGhlIGV2ZW50IGZ1bmN0aW9uIGluIG9iai4gDQoJLy8JIAlJLmUuIGlkZW50aWZpZXMgYSBwcm9wZXJ0eSBvYmpbZXZlbnRdLg0KCS8vCWV4YW1wbGU6DQoJLy8JfAlkb2pvLmNvbm5lY3RQdWJsaXNoZXIoIi9hamF4L3N0YXJ0IiwgZG9qbywgInhockdldCIpOw0KCXZhciBwZiA9IGZ1bmN0aW9uKCl7IGRvam8ucHVibGlzaCh0b3BpYywgYXJndW1lbnRzKTsgfQ0KCXJldHVybiBldmVudCA/IGRvam8uY29ubmVjdChvYmosIGV2ZW50LCBwZikgOiBkb2pvLmNvbm5lY3Qob2JqLCBwZik7IC8vSGFuZGxlDQp9Ow0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5EZWZlcnJlZCJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5EZWZlcnJlZCJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5EZWZlcnJlZCIpOw0KDQoNCihmdW5jdGlvbigpew0KCXZhciBtdXRhdG9yID0gZnVuY3Rpb24oKXt9OwkJDQoJdmFyIGZyZWV6ZSA9IE9iamVjdC5mcmVlemUgfHwgZnVuY3Rpb24oKXt9Ow0KCS8vIEEgZGVmZXJyZWQgcHJvdmlkZXMgYW4gQVBJIGZvciBjcmVhdGluZyBhbmQgcmVzb2x2aW5nIGEgcHJvbWlzZS4NCglkb2pvLkRlZmVycmVkID0gZnVuY3Rpb24oLypGdW5jdGlvbj8qL2NhbmNlbGxlcil7DQoJLy8gc3VtbWFyeToNCgkvLwkJRGVmZXJyZWRzIHByb3ZpZGUgYSBnZW5lcmljIG1lYW5zIGZvciBlbmNhcHN1bGF0aW5nIGFuIGFzeW5jaHJvbm91cw0KCS8vIAkJb3BlcmF0aW9uIGFuZCBub3RpZnlpbmcgdXNlcnMgb2YgdGhlIGNvbXBsZXRpb24gYW5kIHJlc3VsdCBvZiB0aGUgb3BlcmF0aW9uLiANCgkvLyBkZXNjcmlwdGlvbjoNCgkvLwkJVGhlIGRvam8uRGVmZXJyZWQgQVBJIGlzIGJhc2VkIG9uIHRoZSBjb25jZXB0IG9mIHByb21pc2VzIHRoYXQgcHJvdmlkZSBhDQoJLy8JCWdlbmVyaWMgaW50ZXJmYWNlIGludG8gdGhlIGV2ZW50dWFsIGNvbXBsZXRpb24gb2YgYW4gYXN5bmNocm9ub3VzIGFjdGlvbi4NCgkvLwkJVGhlIG1vdGl2YXRpb24gZm9yIHByb21pc2VzIGZ1bmRhbWVudGFsbHkgaXMgYWJvdXQgY3JlYXRpbmcgYSANCgkvLwkJc2VwYXJhdGlvbiBvZiBjb25jZXJucyB0aGF0IGFsbG93cyBvbmUgdG8gYWNoaWV2ZSB0aGUgc2FtZSB0eXBlIG9mIA0KCS8vCQljYWxsIHBhdHRlcm5zIGFuZCBsb2dpY2FsIGRhdGEgZmxvdyBpbiBhc3luY2hyb25vdXMgY29kZSBhcyBjYW4gYmUgDQoJLy8JCWFjaGlldmVkIGluIHN5bmNocm9ub3VzIGNvZGUuIFByb21pc2VzIGFsbG93cyBvbmUgDQoJLy8JCXRvIGJlIGFibGUgdG8gY2FsbCBhIGZ1bmN0aW9uIHB1cmVseSB3aXRoIGFyZ3VtZW50cyBuZWVkZWQgZm9yIA0KCS8vCQlleGVjdXRpb24sIHdpdGhvdXQgY29uZmxhdGluZyB0aGUgY2FsbCB3aXRoIGNvbmNlcm5zIG9mIHdoZXRoZXIgaXQgaXMgDQoJLy8JCXN5bmMgb3IgYXN5bmMuIE9uZSBzaG91bGRuJ3QgbmVlZCB0byBhbHRlciBhIGNhbGwncyBhcmd1bWVudHMgaWYgdGhlIA0KCS8vCQlpbXBsZW1lbnRhdGlvbiBzd2l0Y2hlcyBmcm9tIHN5bmMgdG8gYXN5bmMgKG9yIHZpY2UgdmVyc2EpLiBCeSBoYXZpbmcgDQoJLy8JCWFzeW5jIGZ1bmN0aW9ucyByZXR1cm4gcHJvbWlzZXMsIHRoZSBjb25jZXJucyBvZiBtYWtpbmcgdGhlIGNhbGwgYXJlIA0KCS8vCQlzZXBhcmF0ZWQgZnJvbSB0aGUgY29uY2VybnMgb2YgYXN5bmNocm9ub3VzIGludGVyYWN0aW9uICh3aGljaCBhcmUgDQoJLy8JCWhhbmRsZWQgYnkgdGhlIHByb21pc2UpLg0KCS8vIA0KCS8vICAJVGhlIGRvam8uRGVmZXJyZWQgaXMgYSB0eXBlIG9mIHByb21pc2UgdGhhdCBwcm92aWRlcyBtZXRob2RzIGZvciBmdWxmaWxsaW5nIHRoZSANCgkvLyAJCXByb21pc2Ugd2l0aCBhIHN1Y2Nlc3NmdWwgcmVzdWx0IG9yIGFuIGVycm9yLiBUaGUgbW9zdCBpbXBvcnRhbnQgbWV0aG9kIGZvciANCgkvLyAJCXdvcmtpbmcgd2l0aCBEb2pvJ3MgcHJvbWlzZXMgaXMgdGhlIHRoZW4oKSBtZXRob2QsIHdoaWNoIGZvbGxvd3MgdGhlIA0KCS8vIAkJQ29tbW9uSlMgcHJvcG9zZWQgcHJvbWlzZSBBUEkuIEFuIGV4YW1wbGUgb2YgdXNpbmcgYSBEb2pvIHByb21pc2U6DQoJLy8JCQ0KCS8vCQl8IAl2YXIgcmVzdWx0aW5nUHJvbWlzZSA9IHNvbWVBc3luY09wZXJhdGlvbi50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7DQoJLy8JCXwJCS4uLiBoYW5kbGUgcmVzdWx0IC4uLg0KCS8vCQl8CX0sDQoJLy8JCXwJZnVuY3Rpb24oZXJyb3Ipew0KCS8vCQl8CQkuLi4gaGFuZGxlIGVycm9yIC4uLg0KCS8vCQl8CX0pOw0KCS8vCQ0KCS8vCQlUaGUgLnRoZW4oKSBjYWxsIHJldHVybnMgYSBuZXcgcHJvbWlzZSB0aGF0IHJlcHJlc2VudHMgdGhlIHJlc3VsdCBvZiB0aGUgDQoJLy8gCQlleGVjdXRpb24gb2YgdGhlIGNhbGxiYWNrLiBUaGUgY2FsbGJhY2tzIHdpbGwgbmV2ZXIgYWZmZWN0IHRoZSBvcmlnaW5hbCBwcm9taXNlcyB2YWx1ZS4NCgkvLw0KCS8vCQlUaGUgZG9qby5EZWZlcnJlZCBpbnN0YW5jZXMgYWxzbyBwcm92aWRlIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eToNCgkvLw0KCS8vCQkJKiBhZGRDYWxsYmFjayhoYW5kbGVyKQ0KCS8vCQkJKiBhZGRFcnJiYWNrKGhhbmRsZXIpDQoJLy8JCQkqIGNhbGxiYWNrKHJlc3VsdCkNCgkvLwkJCSogZXJyYmFjayhyZXN1bHQpDQoJLy8NCgkvLwkJQ2FsbGJhY2tzIGFyZSBhbGxvd2VkIHRvIHJldHVybiBwcm9taXNlc3RoZW1zZWx2ZXMsIHNvDQoJLy8JCXlvdSBjYW4gYnVpbGQgY29tcGxpY2F0ZWQgc2VxdWVuY2VzIG9mIGV2ZW50cyB3aXRoIGVhc2UuDQoJLy8NCgkvLwkJVGhlIGNyZWF0b3Igb2YgdGhlIERlZmVycmVkIG1heSBzcGVjaWZ5IGEgY2FuY2VsbGVyLiAgVGhlIGNhbmNlbGxlcg0KCS8vCQlpcyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgaWYgRGVmZXJyZWQuY2FuY2VsIGlzIGNhbGxlZA0KCS8vCQliZWZvcmUgdGhlIERlZmVycmVkIGZpcmVzLiBZb3UgY2FuIHVzZSB0aGlzIHRvIGltcGxlbWVudCBjbGVhbg0KCS8vCQlhYm9ydGluZyBvZiBhbiBYTUxIdHRwUmVxdWVzdCwgZXRjLiBOb3RlIHRoYXQgY2FuY2VsIHdpbGwgZmlyZSB0aGUNCgkvLwkJZGVmZXJyZWQgd2l0aCBhIENhbmNlbGxlZEVycm9yICh1bmxlc3MgeW91ciBjYW5jZWxsZXIgcmV0dXJucw0KCS8vCQlhbm90aGVyIGtpbmQgb2YgZXJyb3IpLCBzbyB0aGUgZXJyYmFja3Mgc2hvdWxkIGJlIHByZXBhcmVkIHRvDQoJLy8JCWhhbmRsZSB0aGF0IGVycm9yIGZvciBjYW5jZWxsYWJsZSBEZWZlcnJlZHMuDQoJLy8gZXhhbXBsZToNCgkvLwl8CXZhciBkZWZlcnJlZCA9IG5ldyBkb2pvLkRlZmVycmVkKCk7DQoJLy8JfAlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGRlZmVycmVkLmNhbGxiYWNrKHtzdWNjZXNzOiB0cnVlfSk7IH0sIDEwMDApOw0KCS8vCXwJcmV0dXJuIGRlZmVycmVkOw0KCS8vIGV4YW1wbGU6DQoJLy8JCURlZmVycmVkIG9iamVjdHMgYXJlIG9mdGVuIHVzZWQgd2hlbiBtYWtpbmcgY29kZSBhc3luY2hyb25vdXMuIEl0DQoJLy8JCW1heSBiZSBlYXNpZXN0IHRvIHdyaXRlIGZ1bmN0aW9ucyBpbiBhIHN5bmNocm9ub3VzIG1hbm5lciBhbmQgdGhlbg0KCS8vCQlzcGxpdCBjb2RlIHVzaW5nIGEgZGVmZXJyZWQgdG8gdHJpZ2dlciBhIHJlc3BvbnNlIHRvIGEgbG9uZy1saXZlZA0KCS8vCQlvcGVyYXRpb24uIEZvciBleGFtcGxlLCBpbnN0ZWFkIG9mIHJlZ2lzdGVyIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8NCgkvLwkJZGVub3RlIHdoZW4gYSByZW5kZXJpbmcgb3BlcmF0aW9uIGNvbXBsZXRlcywgdGhlIGZ1bmN0aW9uIGNhbg0KCS8vCQlzaW1wbHkgcmV0dXJuIGEgZGVmZXJyZWQ6DQoJLy8NCgkvLwkJfAkvLyBjYWxsYmFjayBzdHlsZToNCgkvLwkJfAlmdW5jdGlvbiByZW5kZXJMb3RzT2ZEYXRhKGRhdGEsIGNhbGxiYWNrKXsNCgkvLwkJfAkJdmFyIHN1Y2Nlc3MgPSBmYWxzZQ0KCS8vCQl8CQl0cnl7DQoJLy8JCXwJCQlmb3IodmFyIHggaW4gZGF0YSl7DQoJLy8JCXwJCQkJcmVuZGVyRGF0YWl0ZW0oZGF0YVt4XSk7DQoJLy8JCXwJCQl9DQoJLy8JCXwJCQlzdWNjZXNzID0gdHJ1ZTsNCgkvLwkJfAkJfWNhdGNoKGUpeyB9DQoJLy8JCXwJCWlmKGNhbGxiYWNrKXsNCgkvLwkJfAkJCWNhbGxiYWNrKHN1Y2Nlc3MpOw0KCS8vCQl8CQl9DQoJLy8JCXwJfQ0KCS8vDQoJLy8JCXwJLy8gdXNpbmcgY2FsbGJhY2sgc3R5bGUNCgkvLwkJfAlyZW5kZXJMb3RzT2ZEYXRhKHNvbWVEYXRhT2JqLCBmdW5jdGlvbihzdWNjZXNzKXsNCgkvLwkJfAkJLy8gaGFuZGxlcyBzdWNjZXNzIG9yIGZhaWx1cmUNCgkvLwkJfAkJaWYoIXN1Y2Nlc3Mpew0KCS8vCQl8CQkJcHJvbXB0VXNlclRvUmVjb3ZlcigpOw0KCS8vCQl8CQl9DQoJLy8JCXwJfSk7DQoJLy8JCXwJLy8gTk9URTogbm8gd2F5IHRvIGFkZCBhbm90aGVyIGNhbGxiYWNrIGhlcmUhIQ0KCS8vIGV4YW1wbGU6DQoJLy8JCVVzaW5nIGEgRGVmZXJyZWQgZG9lc24ndCBzaW1wbGlmeSB0aGUgc2VuZGluZyBjb2RlIGFueSwgYnV0IGl0DQoJLy8JCXByb3ZpZGVzIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciBjYWxsZXJzIGFuZCBzZW5kZXJzIGFsaWtlLA0KCS8vCQlwcm92aWRpbmcgYm90aCB3aXRoIGEgc2ltcGxlIHdheSB0byBzZXJ2aWNlIG11bHRpcGxlIGNhbGxiYWNrcyBmb3INCgkvLwkJYW4gb3BlcmF0aW9uIGFuZCBmcmVlaW5nIGJvdGggc2lkZXMgZnJvbSB3b3JyeWluZyBhYm91dCBkZXRhaWxzDQoJLy8JCXN1Y2ggYXMgImRpZCB0aGlzIGdldCBjYWxsZWQgYWxyZWFkeT8iLiBXaXRoIERlZmVycmVkcywgbmV3DQoJLy8JCWNhbGxiYWNrcyBjYW4gYmUgYWRkZWQgYXQgYW55IHRpbWUuDQoJLy8NCgkvLwkJfAkvLyBEZWZlcnJlZCBzdHlsZToNCgkvLwkJfAlmdW5jdGlvbiByZW5kZXJMb3RzT2ZEYXRhKGRhdGEpew0KCS8vCQl8CQl2YXIgZCA9IG5ldyBkb2pvLkRlZmVycmVkKCk7DQoJLy8JCXwJCXRyeXsNCgkvLwkJfAkJCWZvcih2YXIgeCBpbiBkYXRhKXsNCgkvLwkJfAkJCQlyZW5kZXJEYXRhaXRlbShkYXRhW3hdKTsNCgkvLwkJfAkJCX0NCgkvLwkJfAkJCWQuY2FsbGJhY2sodHJ1ZSk7DQoJLy8JCXwJCX1jYXRjaChlKXsgDQoJLy8JCXwJCQlkLmVycmJhY2sobmV3IEVycm9yKCJyZW5kZXJpbmcgZmFpbGVkIikpOw0KCS8vCQl8CQl9DQoJLy8JCXwJCXJldHVybiBkOw0KCS8vCQl8CX0NCgkvLw0KCS8vCQl8CS8vIHVzaW5nIERlZmVycmVkIHN0eWxlDQoJLy8JCXwJcmVuZGVyTG90c09mRGF0YShzb21lRGF0YU9iaikudGhlbihudWxsLCBmdW5jdGlvbigpew0KCS8vCQl8CQlwcm9tcHRVc2VyVG9SZWNvdmVyKCk7DQoJLy8JCXwJfSk7DQoJLy8JCXwJLy8gTk9URTogYWRkRXJyYmFjayBhbmQgYWRkQ2FsbGJhY2sgYm90aCByZXR1cm4gdGhlIERlZmVycmVkDQoJLy8JCXwJLy8gYWdhaW4sIHNvIHdlIGNvdWxkIGNoYWluIGFkZGluZyBjYWxsYmFja3Mgb3Igc2F2ZSB0aGUNCgkvLwkJfAkvLyBkZWZlcnJlZCBmb3IgbGF0ZXIgc2hvdWxkIHdlIG5lZWQgdG8gYmUgbm90aWZpZWQgYWdhaW4uDQoJLy8gZXhhbXBsZToNCgkvLwkJSW4gdGhpcyBleGFtcGxlLCByZW5kZXJMb3RzT2ZEYXRhIGlzIHN5bmNyaG9ub3VzIGFuZCBzbyBib3RoDQoJLy8JCXZlcnNpb25zIGFyZSBwcmV0dHkgYXJ0aWZpY2lhbC4gUHV0dGluZyB0aGUgZGF0YSBkaXNwbGF5IG9uIGENCgkvLwkJdGltZW91dCBoZWxwcyBzaG93IHdoeSBEZWZlcnJlZHMgcm9jazoNCgkvLw0KCS8vCQl8CS8vIERlZmVycmVkIHN0eWxlIGFuZCBhc3luYyBmdW5jDQoJLy8JCXwJZnVuY3Rpb24gcmVuZGVyTG90c09mRGF0YShkYXRhKXsNCgkvLwkJfAkJdmFyIGQgPSBuZXcgZG9qby5EZWZlcnJlZCgpOw0KCS8vCQl8CQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJLy8JCXwJCQl0cnl7DQoJLy8JCXwJCQkJZm9yKHZhciB4IGluIGRhdGEpew0KCS8vCQl8CQkJCQlyZW5kZXJEYXRhaXRlbShkYXRhW3hdKTsNCgkvLwkJfAkJCQl9DQoJLy8JCXwJCQkJZC5jYWxsYmFjayh0cnVlKTsNCgkvLwkJfAkJCX1jYXRjaChlKXsgDQoJLy8JCXwJCQkJZC5lcnJiYWNrKG5ldyBFcnJvcigicmVuZGVyaW5nIGZhaWxlZCIpKTsNCgkvLwkJfAkJCX0NCgkvLwkJfAkJfSwgMTAwKTsNCgkvLwkJfAkJcmV0dXJuIGQ7DQoJLy8JCXwJfQ0KCS8vDQoJLy8JCXwJLy8gdXNpbmcgRGVmZXJyZWQgc3R5bGUNCgkvLwkJfAlyZW5kZXJMb3RzT2ZEYXRhKHNvbWVEYXRhT2JqKS50aGVuKG51bGwsIGZ1bmN0aW9uKCl7DQoJLy8JCXwJCXByb21wdFVzZXJUb1JlY292ZXIoKTsNCgkvLwkJfAl9KTsNCgkvLw0KCS8vCQlOb3RlIHRoYXQgdGhlIGNhbGxlciBkb2Vzbid0IGhhdmUgdG8gY2hhbmdlIGhpcyBjb2RlIGF0IGFsbCB0bw0KCS8vCQloYW5kbGUgdGhlIGFzeW5jaHJvbm91cyBjYXNlLg0KCQl2YXIgcmVzdWx0LCBmaW5pc2hlZCwgaXNFcnJvciwgaGVhZCwgbmV4dExpc3RlbmVyOw0KCQl2YXIgcHJvbWlzZSA9IHRoaXMucHJvbWlzZSA9IHt9Ow0KCQkNCgkJZnVuY3Rpb24gY29tcGxldGUodmFsdWUpew0KCQkJaWYoZmluaXNoZWQpew0KCQkJCXRocm93IG5ldyBFcnJvcigiVGhpcyBkZWZlcnJlZCBoYXMgYWxyZWFkeSBiZWVuIHJlc29sdmVkIik7CQkJCQ0KCQkJfQ0KCQkJcmVzdWx0ID0gdmFsdWU7DQoJCQlmaW5pc2hlZCA9IHRydWU7DQoJCQlub3RpZnkoKTsNCgkJfQ0KCQlmdW5jdGlvbiBub3RpZnkoKXsNCgkJCXZhciBtdXRhdGVkOw0KCQkJd2hpbGUoIW11dGF0ZWQgJiYgbmV4dExpc3RlbmVyKXsNCgkJCQl2YXIgbGlzdGVuZXIgPSBuZXh0TGlzdGVuZXI7DQoJCQkJbmV4dExpc3RlbmVyID0gbmV4dExpc3RlbmVyLm5leHQ7DQoJCQkJaWYobXV0YXRlZCA9IChsaXN0ZW5lci5wcm9ncmVzcyA9PSBtdXRhdG9yKSl7IC8vIGFzc2lnbm1lbnQgYW5kIGNoZWNrDQoJCQkJCWZpbmlzaGVkID0gZmFsc2U7DQoJCQkJfQ0KCQkJCXZhciBmdW5jID0gKGlzRXJyb3IgPyBsaXN0ZW5lci5lcnJvciA6IGxpc3RlbmVyLnJlc29sdmVkKTsNCgkJCQlpZiAoZnVuYykgew0KCQkJCQl0cnkgew0KCQkJCQkJdmFyIG5ld1Jlc3VsdCA9IGZ1bmMocmVzdWx0KTsNCgkJCQkJCWlmIChuZXdSZXN1bHQgJiYgdHlwZW9mIG5ld1Jlc3VsdC50aGVuID09PSAiZnVuY3Rpb24iKSB7DQoJCQkJCQkJbmV3UmVzdWx0LnRoZW4oZG9qby5oaXRjaChsaXN0ZW5lci5kZWZlcnJlZCwgInJlc29sdmUiKSwgZG9qby5oaXRjaChsaXN0ZW5lci5kZWZlcnJlZCwgInJlamVjdCIpKTsNCgkJCQkJCQljb250aW51ZTsNCgkJCQkJCX0NCgkJCQkJCXZhciB1bmNoYW5nZWQgPSBtdXRhdGVkICYmIG5ld1Jlc3VsdCA9PT0gdW5kZWZpbmVkOw0KCQkJCQkJbGlzdGVuZXIuZGVmZXJyZWRbdW5jaGFuZ2VkICYmIGlzRXJyb3IgPyAicmVqZWN0IiA6ICJyZXNvbHZlIl0odW5jaGFuZ2VkID8gcmVzdWx0IDogbmV3UmVzdWx0KTsNCgkJCQkJfQ0KCQkJCQljYXRjaCAoZSkgew0KCQkJCQkJbGlzdGVuZXIuZGVmZXJyZWQucmVqZWN0KGUpOw0KCQkJCQl9DQoJCQkJfWVsc2Ugew0KCQkJCQlpZihpc0Vycm9yKXsNCgkJCQkJCWxpc3RlbmVyLmRlZmVycmVkLnJlamVjdChyZXN1bHQpOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCWxpc3RlbmVyLmRlZmVycmVkLnJlc29sdmUocmVzdWx0KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0JDQoJCX0NCgkJLy8gY2FsbGluZyByZXNvbHZlIHdpbGwgcmVzb2x2ZSB0aGUgcHJvbWlzZQ0KCQl0aGlzLnJlc29sdmUgPSB0aGlzLmNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlGdWxmaWxscyB0aGUgRGVmZXJyZWQgaW5zdGFuY2Ugc3VjY2Vzc2Z1bGx5IHdpdGggdGhlIHByb3ZpZGUgdmFsdWUNCgkJCXRoaXMuZmlyZWQgPSAwOw0KCQkJdGhpcy5yZXN1bHRzID0gW3ZhbHVlLCBudWxsXTsNCgkJCWNvbXBsZXRlKHZhbHVlKTsNCgkJfTsNCgkJDQoJCQ0KCQkvLyBjYWxsaW5nIGVycm9yIHdpbGwgaW5kaWNhdGUgdGhhdCB0aGUgcHJvbWlzZSBmYWlsZWQNCgkJdGhpcy5yZWplY3QgPSB0aGlzLmVycmJhY2sgPSBmdW5jdGlvbihlcnJvcil7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUZ1bGZpbGxzIHRoZSBEZWZlcnJlZCBpbnN0YW5jZSBhcyBhbiBlcnJvciB3aXRoIHRoZSBwcm92aWRlZCBlcnJvciANCgkJCWlzRXJyb3IgPSB0cnVlOw0KCQkJdGhpcy5maXJlZCA9IDE7DQoJCQljb21wbGV0ZShlcnJvcik7DQoJCQl0aGlzLnJlc3VsdHMgPSBbbnVsbCwgZXJyb3JdOw0KCQkJaWYoIWVycm9yIHx8IGVycm9yLmxvZyAhPT0gZmFsc2Upew0KCQkJCShkb2pvLmNvbmZpZy5kZWZlcnJlZE9uRXJyb3IgfHwgZnVuY3Rpb24oeCl7IGNvbnNvbGUuZXJyb3IoeCk7IH0pKGVycm9yKTsNCgkJCX0NCgkJfTsNCgkJLy8gY2FsbCBwcm9ncmVzcyB0byBwcm92aWRlIHVwZGF0ZXMgb24gdGhlIHByb2dyZXNzIG9uIHRoZSBjb21wbGV0aW9uIG9mIHRoZSBwcm9taXNlDQoJCXRoaXMucHJvZ3Jlc3MgPSBmdW5jdGlvbih1cGRhdGUpew0KCQkJLy8gc3VtbWFyeQ0KCQkJLy8JCVNlbmQgcHJvZ3Jlc3MgZXZlbnRzIHRvIGFsbCBsaXN0ZW5lcnMNCgkJCXZhciBsaXN0ZW5lciA9IG5leHRMaXN0ZW5lcjsNCgkJCXdoaWxlKGxpc3RlbmVyKXsNCgkJCQl2YXIgcHJvZ3Jlc3MgPSBsaXN0ZW5lci5wcm9ncmVzczsNCgkJCQlwcm9ncmVzcyAmJiBwcm9ncmVzcyh1cGRhdGUpOw0KCQkJCWxpc3RlbmVyID0gbGlzdGVuZXIubmV4dDsJDQoJCQl9DQoJCX07DQoJCXRoaXMuYWRkQ2FsbGJhY2tzID0gZnVuY3Rpb24oLypGdW5jdGlvbj8qL2NhbGxiYWNrLCAvKkZ1bmN0aW9uPyovZXJyYmFjayl7DQoJCQl0aGlzLnRoZW4oY2FsbGJhY2ssIGVycmJhY2ssIG11dGF0b3IpOw0KCQkJcmV0dXJuIHRoaXM7DQoJCX07DQoJCS8vIHByb3ZpZGUgdGhlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBwcm9taXNlDQoJCXRoaXMudGhlbiA9IHByb21pc2UudGhlbiA9IGZ1bmN0aW9uKC8qRnVuY3Rpb24/Ki9yZXNvbHZlZENhbGxiYWNrLCAvKkZ1bmN0aW9uPyovZXJyb3JDYWxsYmFjaywgLypGdW5jdGlvbj8qL3Byb2dyZXNzQ2FsbGJhY2spew0KCQkJLy8gc3VtbWFyeQ0KCQkJLy8gCQlBZGRzIGEgZnVsZmlsbGVkSGFuZGxlciwgZXJyb3JIYW5kbGVyLCBhbmQgcHJvZ3Jlc3NIYW5kbGVyIHRvIGJlIGNhbGxlZCBmb3IgDQoJCQkvLyAJCWNvbXBsZXRpb24gb2YgYSBwcm9taXNlLiBUaGUgZnVsZmlsbGVkSGFuZGxlciBpcyBjYWxsZWQgd2hlbiB0aGUgcHJvbWlzZSANCgkJCS8vIAkJaXMgZnVsZmlsbGVkLiBUaGUgZXJyb3JIYW5kbGVyIGlzIGNhbGxlZCB3aGVuIGEgcHJvbWlzZSBmYWlscy4gVGhlIA0KCQkJLy8gCQlwcm9ncmVzc0hhbmRsZXIgaXMgY2FsbGVkIGZvciBwcm9ncmVzcyBldmVudHMuIEFsbCBhcmd1bWVudHMgYXJlIG9wdGlvbmFsIA0KCQkJLy8gCQlhbmQgbm9uLWZ1bmN0aW9uIHZhbHVlcyBhcmUgaWdub3JlZC4gVGhlIHByb2dyZXNzSGFuZGxlciBpcyBub3Qgb25seSBhbiANCgkJCS8vIAkJb3B0aW9uYWwgYXJndW1lbnQsIGJ1dCBwcm9ncmVzcyBldmVudHMgYXJlIHB1cmVseSBvcHRpb25hbC4gUHJvbWlzZSANCgkJCS8vIAkJcHJvdmlkZXJzIGFyZSBub3QgcmVxdWlyZWQgdG8gZXZlciBjcmVhdGUgcHJvZ3Jlc3MgZXZlbnRzLg0KCQkJLy8gDQoJCQkvLyAJCVRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gYSBuZXcgcHJvbWlzZSB0aGF0IGlzIGZ1bGZpbGxlZCB3aGVuIHRoZSBnaXZlbiANCgkJCS8vIAkJZnVsZmlsbGVkSGFuZGxlciBvciBlcnJvckhhbmRsZXIgY2FsbGJhY2sgaXMgZmluaXNoZWQuIFRoaXMgYWxsb3dzIHByb21pc2UgDQoJCQkvLyAJCW9wZXJhdGlvbnMgdG8gYmUgY2hhaW5lZCB0b2dldGhlci4gVGhlIHZhbHVlIHJldHVybmVkIGZyb20gdGhlIGNhbGxiYWNrIA0KCQkJLy8gCQloYW5kbGVyIGlzIHRoZSBmdWxmaWxsbWVudCB2YWx1ZSBmb3IgdGhlIHJldHVybmVkIHByb21pc2UuIElmIHRoZSBjYWxsYmFjayANCgkJCS8vIAkJdGhyb3dzIGFuIGVycm9yLCB0aGUgcmV0dXJuZWQgcHJvbWlzZSB3aWxsIGJlIG1vdmVkIHRvIGZhaWxlZCBzdGF0ZS4NCgkJCS8vCQ0KCQkJLy8gZXhhbXBsZToNCgkJCS8vIAkJQW4gZXhhbXBsZSBvZiB1c2luZyBhIENvbW1vbkpTIGNvbXBsaWFudCBwcm9taXNlOg0KICAJCQkvLwkJfAlhc3luY0NvbXB1dGVUaGVBbnN3ZXJUb0V2ZXJ5dGhpbmcoKS4NCgkJCS8vCQl8CQl0aGVuKGFkZFR3bykuDQoJCQkvLwkJfAkJdGhlbihwcmludFJlc3VsdCwgb25FcnJvcik7DQogIAkJCS8vCQl8CT40NCANCgkJCS8vIAkJDQoJCQl2YXIgcmV0dXJuRGVmZXJyZWQgPSBwcm9ncmVzc0NhbGxiYWNrID09IG11dGF0b3IgPyB0aGlzIDogbmV3IGRvam8uRGVmZXJyZWQocHJvbWlzZS5jYW5jZWwpOw0KCQkJdmFyIGxpc3RlbmVyID0gew0KCQkJCXJlc29sdmVkOiByZXNvbHZlZENhbGxiYWNrLCANCgkJCQllcnJvcjogZXJyb3JDYWxsYmFjaywgDQoJCQkJcHJvZ3Jlc3M6IHByb2dyZXNzQ2FsbGJhY2ssIA0KCQkJCWRlZmVycmVkOiByZXR1cm5EZWZlcnJlZA0KCQkJfTsgDQoJCQlpZihuZXh0TGlzdGVuZXIpew0KCQkJCWhlYWQgPSBoZWFkLm5leHQgPSBsaXN0ZW5lcjsNCgkJCX0NCgkJCWVsc2V7DQoJCQkJbmV4dExpc3RlbmVyID0gaGVhZCA9IGxpc3RlbmVyOw0KCQkJfQ0KCQkJaWYoZmluaXNoZWQpew0KCQkJCW5vdGlmeSgpOw0KCQkJfQ0KCQkJcmV0dXJuIHJldHVybkRlZmVycmVkLnByb21pc2U7DQoJCX07DQoJCXZhciBkZWZlcnJlZCA9IHRoaXM7DQoJCXRoaXMuY2FuY2VsID0gcHJvbWlzZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUNhbmNlbHMgdGhlIGFzeW5jaHJvbm91cyBvcGVyYXRpb24NCgkJCWlmKCFmaW5pc2hlZCl7DQoJCQkJdmFyIGVycm9yID0gY2FuY2VsbGVyICYmIGNhbmNlbGxlcihkZWZlcnJlZCk7DQoJCQkJaWYoIWZpbmlzaGVkKXsNCgkJCQkJaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikpIHsNCgkJCQkJCWVycm9yID0gbmV3IEVycm9yKGVycm9yKTsNCgkJCQkJfQ0KCQkJCQllcnJvci5sb2cgPSBmYWxzZTsNCgkJCQkJZGVmZXJyZWQucmVqZWN0KGVycm9yKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJZnJlZXplKHByb21pc2UpOw0KCX07DQoJZG9qby5leHRlbmQoZG9qby5EZWZlcnJlZCwgew0KCQlhZGRDYWxsYmFjazogZnVuY3Rpb24gKC8qRnVuY3Rpb24qL2NhbGxiYWNrKSB7DQoJCQlyZXR1cm4gdGhpcy5hZGRDYWxsYmFja3MoZG9qby5oaXRjaC5hcHBseShkb2pvLCBhcmd1bWVudHMpKTsNCgkJfSwNCgkNCgkJYWRkRXJyYmFjazogZnVuY3Rpb24gKC8qRnVuY3Rpb24qL2VycmJhY2spIHsNCgkJCXJldHVybiB0aGlzLmFkZENhbGxiYWNrcyhudWxsLCBkb2pvLmhpdGNoLmFwcGx5KGRvam8sIGFyZ3VtZW50cykpOw0KCQl9LA0KCQ0KCQlhZGRCb3RoOiBmdW5jdGlvbiAoLypGdW5jdGlvbiovY2FsbGJhY2spIHsNCgkJCXZhciBlbmNsb3NlZCA9IGRvam8uaGl0Y2guYXBwbHkoZG9qbywgYXJndW1lbnRzKTsNCgkJCXJldHVybiB0aGlzLmFkZENhbGxiYWNrcyhlbmNsb3NlZCwgZW5jbG9zZWQpOw0KCQl9LA0KCQlmaXJlZDogLTENCgl9KTsNCn0pKCk7DQpkb2pvLndoZW4gPSBmdW5jdGlvbihwcm9taXNlT3JWYWx1ZSwgLypGdW5jdGlvbj8qL2NhbGxiYWNrLCAvKkZ1bmN0aW9uPyovZXJyYmFjaywgLypGdW5jdGlvbj8qL3Byb2dyZXNzSGFuZGxlcil7DQoJLy8gc3VtbWFyeToNCgkvLwkJVGhpcyBwcm92aWRlcyBub3JtYWxpemF0aW9uIGJldHdlZW4gbm9ybWFsIHN5bmNocm9ub3VzIHZhbHVlcyBhbmQgDQoJLy8JCWFzeW5jaHJvbm91cyBwcm9taXNlcywgc28geW91IGNhbiBpbnRlcmFjdCB3aXRoIHRoZW0gaW4gYSBjb21tb24gd2F5DQoJLy8JZXhhbXBsZToNCgkvLwkJfAlmdW5jdGlvbiBwcmludEZpcnN0QW5kTGlzdChpdGVtcyl7DQoJLy8JCXwJCWRvam8ud2hlbihmaW5kRmlyc3QoaXRlbXMpLCBjb25zb2xlLmxvZyk7DQoJLy8JCXwJCWRvam8ud2hlbihmaW5kTGFzdChpdGVtcyksIGNvbnNvbGUubG9nKTsNCgkvLwkJfAl9DQoJLy8JCXwJZnVuY3Rpb24gZmluZEZpcnN0KGl0ZW1zKXsNCgkvLwkJfAkJcmV0dXJuIGRvam8ud2hlbihpdGVtcywgZnVuY3Rpb24oaXRlbXMpew0KCS8vCQl8CQkJcmV0dXJuIGl0ZW1zWzBdOw0KCS8vCQl8CQl9KTsNCgkvLwkJfAl9DQoJLy8JCXwJZnVuY3Rpb24gZmluZExhc3QoaXRlbXMpew0KCS8vCQl8CQlyZXR1cm4gZG9qby53aGVuKGl0ZW1zLCBmdW5jdGlvbihpdGVtcyl7DQoJLy8JCXwJCQlyZXR1cm4gaXRlbXNbaXRlbXMubGVuZ3RoXTsNCgkvLwkJfAkJfSk7DQoJLy8JCXwJfQ0KCS8vCQlBbmQgbm93IGFsbCB0aHJlZSBvZiBoaXMgZnVuY3Rpb25zIGNhbiBiZSB1c2VkIHN5bmMgb3IgYXN5bmMuDQoJLy8JCXwJcHJpbnRGaXJzdEFuZExhc3QoWzEsMiwzLDRdKSB3aWxsIHdvcmsganVzdCBhcyB3ZWxsIGFzDQoJLy8JCXwJcHJpbnRGaXJzdEFuZExhc3QoZG9qby54aHJHZXQoLi4uKSk7DQoJDQoJaWYocHJvbWlzZU9yVmFsdWUgJiYgdHlwZW9mIHByb21pc2VPclZhbHVlLnRoZW4gPT09ICJmdW5jdGlvbiIpew0KCQlyZXR1cm4gcHJvbWlzZU9yVmFsdWUudGhlbihjYWxsYmFjaywgZXJyYmFjaywgcHJvZ3Jlc3NIYW5kbGVyKTsNCgl9DQoJcmV0dXJuIGNhbGxiYWNrKHByb21pc2VPclZhbHVlKTsNCn07DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmpzb24iXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuanNvbiJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5qc29uIik7DQoNCmRvam8uZnJvbUpzb24gPSBmdW5jdGlvbigvKlN0cmluZyovIGpzb24pew0KCS8vIHN1bW1hcnk6DQoJLy8gCQlQYXJzZXMgYSBbSlNPTl0oaHR0cDovL2pzb24ub3JnKSBzdHJpbmcgdG8gcmV0dXJuIGEgSmF2YVNjcmlwdCBvYmplY3QuDQoJLy8gZGVzY3JpcHRpb246DQoJLy8gCQlUaHJvd3MgZm9yIGludmFsaWQgSlNPTiBzdHJpbmdzLCBidXQgaXQgZG9lcyBub3QgdXNlIGEgc3RyaWN0IEpTT04gcGFyc2VyLiBJdA0KCS8vIAkJZGVsZWdhdGVzIHRvIGV2YWwoKS4gIFRoZSBjb250ZW50IHBhc3NlZCB0byB0aGlzIG1ldGhvZCBtdXN0IHRoZXJlZm9yZSBjb21lDQoJLy8JCWZyb20gYSB0cnVzdGVkIHNvdXJjZS4NCgkvLyBqc29uOiANCgkvLwkJYSBzdHJpbmcgbGl0ZXJhbCBvZiBhIEpTT04gaXRlbSwgZm9yIGluc3RhbmNlOg0KCS8vCQkJYCd7ICJmb28iOiBbICJiYXIiLCAxLCB7ICJiYXoiOiAidGh1ZCIgfSBdIH0nYA0KDQoJcmV0dXJuIGV2YWwoIigiICsganNvbiArICIpIik7IC8vIE9iamVjdA0KfQ0KDQpkb2pvLl9lc2NhcGVTdHJpbmcgPSBmdW5jdGlvbigvKlN0cmluZyovc3RyKXsNCgkvL3N1bW1hcnk6DQoJLy8JCUFkZHMgZXNjYXBlIHNlcXVlbmNlcyBmb3Igbm9uLXZpc3VhbCBjaGFyYWN0ZXJzLCBkb3VibGUgcXVvdGUgYW5kDQoJLy8JCWJhY2tzbGFzaCBhbmQgc3Vycm91bmRzIHdpdGggZG91YmxlIHF1b3RlcyB0byBmb3JtIGEgdmFsaWQgc3RyaW5nDQoJLy8JCWxpdGVyYWwuDQoJcmV0dXJuICgnIicgKyBzdHIucmVwbGFjZSgvKFsiXFxdKS9nLCAnXFwkMScpICsgJyInKS4NCgkJcmVwbGFjZSgvW1xmXS9nLCAiXFxmIikucmVwbGFjZSgvW1xiXS9nLCAiXFxiIikucmVwbGFjZSgvW1xuXS9nLCAiXFxuIikuDQoJCXJlcGxhY2UoL1tcdF0vZywgIlxcdCIpLnJlcGxhY2UoL1tccl0vZywgIlxcciIpOyAvLyBzdHJpbmcNCn0NCg0KZG9qby50b0pzb25JbmRlbnRTdHIgPSAiXHQiOw0KZG9qby50b0pzb24gPSBmdW5jdGlvbigvKk9iamVjdCovIGl0LCAvKkJvb2xlYW4/Ki8gcHJldHR5UHJpbnQsIC8qU3RyaW5nPyovIF9pbmRlbnRTdHIpew0KCS8vCXN1bW1hcnk6DQoJLy8JCVJldHVybnMgYSBbSlNPTl0oaHR0cDovL2pzb24ub3JnKSBzZXJpYWxpemF0aW9uIG9mIGFuIG9iamVjdC4NCgkvLwlkZXNjcmlwdGlvbjoNCgkvLwkJUmV0dXJucyBhIFtKU09OXShodHRwOi8vanNvbi5vcmcpIHNlcmlhbGl6YXRpb24gb2YgYW4gb2JqZWN0Lg0KCS8vCQlOb3RlIHRoYXQgdGhpcyBkb2Vzbid0IGNoZWNrIGZvciBpbmZpbml0ZSByZWN1cnNpb24sIHNvIGRvbid0IGRvIHRoYXQhDQoJLy8JaXQ6DQoJLy8JCWFuIG9iamVjdCB0byBiZSBzZXJpYWxpemVkLiBPYmplY3RzIG1heSBkZWZpbmUgdGhlaXIgb3duDQoJLy8JCXNlcmlhbGl6YXRpb24gdmlhIGEgc3BlY2lhbCAiX19qc29uX18iIG9yICJqc29uIiBmdW5jdGlvbg0KCS8vCQlwcm9wZXJ0eS4gSWYgYSBzcGVjaWFsaXplZCBzZXJpYWxpemVyIGhhcyBiZWVuIGRlZmluZWQsIGl0IHdpbGwNCgkvLwkJYmUgdXNlZCBhcyBhIGZhbGxiYWNrLg0KCS8vCXByZXR0eVByaW50Og0KCS8vCQlpZiB0cnVlLCB3ZSBpbmRlbnQgb2JqZWN0cyBhbmQgYXJyYXlzIHRvIG1ha2UgdGhlIG91dHB1dCBwcmV0dGllci4NCgkvLwkJVGhlIHZhcmlhYmxlIGBkb2pvLnRvSnNvbkluZGVudFN0cmAgaXMgdXNlZCBhcyB0aGUgaW5kZW50IHN0cmluZyAtLQ0KCS8vCQl0byB1c2Ugc29tZXRoaW5nIG90aGVyIHRoYW4gdGhlIGRlZmF1bHQgKHRhYiksIGNoYW5nZSB0aGF0IHZhcmlhYmxlDQoJLy8JCWJlZm9yZSBjYWxsaW5nIGRvam8udG9Kc29uKCkuDQoJLy8JX2luZGVudFN0cjoNCgkvLwkJcHJpdmF0ZSB2YXJpYWJsZSBmb3IgcmVjdXJzaXZlIGNhbGxzIHdoZW4gcHJldHR5IHByaW50aW5nLCBkbyBub3QgdXNlLg0KCS8vCWV4YW1wbGU6DQoJLy8JCXNpbXBsZSBzZXJpYWxpemF0aW9uIG9mIGEgdHJpdmlhbCBvYmplY3QNCgkvLwkJfAl2YXIganNvblN0ciA9IGRvam8udG9Kc29uKHsgaG93ZHk6ICJzdHJhbmdlciEiLCBpc1N0cmFuZ2U6IHRydWUgfSk7DQoJLy8JCXwJZG9oLmlzKCd7Imhvd2R5Ijoic3RyYW5nZXIhIiwiaXNTdHJhbmdlIjp0cnVlfScsIGpzb25TdHIpOw0KCS8vCWV4YW1wbGU6DQoJLy8JCWEgY3VzdG9tIHNlcmlhbGl6ZXIgZm9yIGFuIG9iamVjdHMgb2YgYSBwYXJ0aWN1bGFyIGNsYXNzOg0KCS8vCQl8CWRvam8uZGVjbGFyZSgiRnVyYnkiLCBudWxsLCB7DQoJLy8JCXwJCWZ1cmJpZXM6ICJhcmUgc3RyYW5nZSIsDQoJLy8JCXwJCWZ1cmJ5Q291bnQ6IDEwLA0KCS8vCQl8CQlfX2pzb25fXzogZnVuY3Rpb24oKXsNCgkvLwkJfAkJfSwNCgkvLwkJfAl9KTsNCg0KCWlmKGl0ID09PSB1bmRlZmluZWQpew0KCQlyZXR1cm4gInVuZGVmaW5lZCI7DQoJfQ0KCXZhciBvYmp0eXBlID0gdHlwZW9mIGl0Ow0KCWlmKG9ianR5cGUgPT0gIm51bWJlciIgfHwgb2JqdHlwZSA9PSAiYm9vbGVhbiIpew0KCQlyZXR1cm4gaXQgKyAiIjsNCgl9DQoJaWYoaXQgPT09IG51bGwpew0KCQlyZXR1cm4gIm51bGwiOw0KCX0NCglpZihkb2pvLmlzU3RyaW5nKGl0KSl7IA0KCQlyZXR1cm4gZG9qby5fZXNjYXBlU3RyaW5nKGl0KTsgDQoJfQ0KCS8vIHJlY3Vyc2UNCgl2YXIgcmVjdXJzZSA9IGFyZ3VtZW50cy5jYWxsZWU7DQoJLy8gc2hvcnQtY2lyY3VpdCBmb3Igb2JqZWN0cyB0aGF0IHN1cHBvcnQgImpzb24iIHNlcmlhbGl6YXRpb24NCgkvLyBpZiB0aGV5IHJldHVybiAic2VsZiIgdGhlbiBqdXN0IHBhc3MtdGhyb3VnaC4uLg0KCXZhciBuZXdPYmo7DQoJX2luZGVudFN0ciA9IF9pbmRlbnRTdHIgfHwgIiI7DQoJdmFyIG5leHRJbmRlbnQgPSBwcmV0dHlQcmludCA/IF9pbmRlbnRTdHIgKyBkb2pvLnRvSnNvbkluZGVudFN0ciA6ICIiOw0KCXZhciB0ZiA9IGl0Ll9fanNvbl9ffHxpdC5qc29uOw0KCWlmKGRvam8uaXNGdW5jdGlvbih0Zikpew0KCQluZXdPYmogPSB0Zi5jYWxsKGl0KTsNCgkJaWYoaXQgIT09IG5ld09iail7DQoJCQlyZXR1cm4gcmVjdXJzZShuZXdPYmosIHByZXR0eVByaW50LCBuZXh0SW5kZW50KTsNCgkJfQ0KCX0NCglpZihpdC5ub2RlVHlwZSAmJiBpdC5jbG9uZU5vZGUpeyAvLyBpc05vZGUNCgkJLy8gd2UgY2FuJ3Qgc2VyaWFpbGl6ZSBET00gbm9kZXMgYXMgcmVndWxhciBvYmplY3RzIGJlY2F1c2UgdGhleSBoYXZlIGN5Y2xlcw0KCQkvLyBET00gbm9kZXMgY291bGQgYmUgc2VyaWFsaXplZCB3aXRoIHNvbWV0aGluZyBsaWtlIG91dGVySFRNTCwgYnV0DQoJCS8vIHRoYXQgY2FuIGJlIHByb3ZpZGVkIGJ5IHVzZXJzIGluIHRoZSBmb3JtIG9mIC5qc29uIG9yIC5fX2pzb25fXyBmdW5jdGlvbi4NCgkJdGhyb3cgbmV3IEVycm9yKCJDYW4ndCBzZXJpYWxpemUgRE9NIG5vZGVzIik7DQoJfQ0KDQoJdmFyIHNlcCA9IHByZXR0eVByaW50ID8gIiAiIDogIiI7DQoJdmFyIG5ld0xpbmUgPSBwcmV0dHlQcmludCA/ICJcbiIgOiAiIjsNCg0KCS8vIGFycmF5DQoJaWYoZG9qby5pc0FycmF5KGl0KSl7DQoJCXZhciByZXMgPSBkb2pvLm1hcChpdCwgZnVuY3Rpb24ob2JqKXsNCgkJCXZhciB2YWwgPSByZWN1cnNlKG9iaiwgcHJldHR5UHJpbnQsIG5leHRJbmRlbnQpOw0KCQkJaWYodHlwZW9mIHZhbCAhPSAic3RyaW5nIil7DQoJCQkJdmFsID0gInVuZGVmaW5lZCI7DQoJCQl9DQoJCQlyZXR1cm4gbmV3TGluZSArIG5leHRJbmRlbnQgKyB2YWw7DQoJCX0pOw0KCQlyZXR1cm4gIlsiICsgcmVzLmpvaW4oIiwiICsgc2VwKSArIG5ld0xpbmUgKyBfaW5kZW50U3RyICsgIl0iOw0KCX0NCgkvKg0KCS8vIGxvb2sgaW4gdGhlIHJlZ2lzdHJ5DQoJdHJ5IHsNCgkJd2luZG93Lm8gPSBpdDsNCgkJbmV3T2JqID0gZG9qby5qc29uLmpzb25SZWdpc3RyeS5tYXRjaChpdCk7DQoJCXJldHVybiByZWN1cnNlKG5ld09iaiwgcHJldHR5UHJpbnQsIG5leHRJbmRlbnQpOw0KCX1jYXRjaChlKXsNCgkJLy8gY29uc29sZS5sb2coZSk7DQoJfQ0KCS8vIGl0J3MgYSBmdW5jdGlvbiB3aXRoIG5vIGFkYXB0ZXIsIHNraXAgaXQNCgkqLw0KCWlmKG9ianR5cGUgPT0gImZ1bmN0aW9uIil7DQoJCXJldHVybiBudWxsOyAvLyBudWxsDQoJfQ0KCS8vIGdlbmVyaWMgb2JqZWN0IGNvZGUgcGF0aA0KCXZhciBvdXRwdXQgPSBbXSwga2V5Ow0KCWZvcihrZXkgaW4gaXQpew0KCQl2YXIga2V5U3RyLCB2YWw7DQoJCWlmKHR5cGVvZiBrZXkgPT0gIm51bWJlciIpew0KCQkJa2V5U3RyID0gJyInICsga2V5ICsgJyInOw0KCQl9ZWxzZSBpZih0eXBlb2Yga2V5ID09ICJzdHJpbmciKXsNCgkJCWtleVN0ciA9IGRvam8uX2VzY2FwZVN0cmluZyhrZXkpOw0KCQl9ZWxzZXsNCgkJCS8vIHNraXAgbm9uLXN0cmluZyBvciBudW1iZXIga2V5cw0KCQkJY29udGludWU7DQoJCX0NCgkJdmFsID0gcmVjdXJzZShpdFtrZXldLCBwcmV0dHlQcmludCwgbmV4dEluZGVudCk7DQoJCWlmKHR5cGVvZiB2YWwgIT0gInN0cmluZyIpew0KCQkJLy8gc2tpcCBub24tc2VyaWFsaXphYmxlIHZhbHVlcw0KCQkJY29udGludWU7DQoJCX0NCgkJLy8gRklYTUU6IHVzZSArPSBvbiBNb3ohIQ0KCQkvLwkgTU9XIE5PVEU6IHVzaW5nICs9IGlzIGEgcGFpbiBiZWNhdXNlIHlvdSBoYXZlIHRvIGFjY291bnQgZm9yIHRoZSBkYW5nbGluZyBjb21tYS4uLg0KCQlvdXRwdXQucHVzaChuZXdMaW5lICsgbmV4dEluZGVudCArIGtleVN0ciArICI6IiArIHNlcCArIHZhbCk7DQoJfQ0KCXJldHVybiAieyIgKyBvdXRwdXQuam9pbigiLCIgKyBzZXApICsgbmV3TGluZSArIF9pbmRlbnRTdHIgKyAifSI7IC8vIFN0cmluZw0KfQ0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5Db2xvciJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5Db2xvciJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5Db2xvciIpOw0KDQoNCg0KKGZ1bmN0aW9uKCl7DQoNCgl2YXIgZCA9IGRvam87DQoNCglkb2pvLkNvbG9yID0gZnVuY3Rpb24oLypBcnJheXxTdHJpbmd8T2JqZWN0Ki8gY29sb3Ipew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkgCVRha2VzIGEgbmFtZWQgc3RyaW5nLCBoZXggc3RyaW5nLCBhcnJheSBvZiByZ2Igb3IgcmdiYSB2YWx1ZXMsDQoJCS8vCSAJYW4gb2JqZWN0IHdpdGggciwgZywgYiwgYW5kIGEgcHJvcGVydGllcywgb3IgYW5vdGhlciBgZG9qby5Db2xvcmAgb2JqZWN0DQoJCS8vCSAJYW5kIGNyZWF0ZXMgYSBuZXcgQ29sb3IgaW5zdGFuY2UgdG8gd29yayBmcm9tLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJV29yayB3aXRoIGEgQ29sb3IgaW5zdGFuY2U6DQoJCS8vCSB8IHZhciBjID0gbmV3IGRvam8uQ29sb3IoKTsNCgkJLy8JIHwgYy5zZXRDb2xvcihbMCwwLDBdKTsgLy8gYmxhY2sNCgkJLy8JIHwgdmFyIGhleCA9IGMudG9IZXgoKTsgLy8gIzAwMDAwMA0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJV29yayB3aXRoIGEgbm9kZSdzIGNvbG9yOg0KCQkvLwkgfCB2YXIgY29sb3IgPSBkb2pvLnN0eWxlKCJzb21lTm9kZSIsICJiYWNrZ3JvdW5kQ29sb3IiKTsNCgkJLy8JIHwgdmFyIG4gPSBuZXcgZG9qby5Db2xvcihjb2xvcik7DQoJCS8vCSB8IC8vIGFkanVzdCB0aGUgY29sb3Igc29tZQ0KCQkvLwkgfCBuLnIgKj0gLjU7DQoJCS8vCSB8IGNvbnNvbGUubG9nKG4udG9TdHJpbmcoKSk7IC8vIHJnYigxMjgsIDI1NSwgMjU1KTsNCgkJaWYoY29sb3IpeyB0aGlzLnNldENvbG9yKGNvbG9yKTsgfQ0KCX07DQoNCgkvLyBGSVhNRToNCgkvLyAJdGhlcmUncyBnb3QgdG8gYmUgYSBtb3JlIHNwYWNlLWVmZmljaWVudCB3YXkgdG8gZW5jb2RlIG9yIGRpc2NvdmVyDQoJLy8gCXRoZXNlISEgIFVzZSBoZXg/DQoJZG9qby5Db2xvci5uYW1lZCA9IHsNCgkJYmxhY2s6ICAgICAgWzAsMCwwXSwNCgkJc2lsdmVyOiAgICAgWzE5MiwxOTIsMTkyXSwNCgkJZ3JheTogICAgICAgWzEyOCwxMjgsMTI4XSwNCgkJd2hpdGU6ICAgICAgWzI1NSwyNTUsMjU1XSwNCgkJbWFyb29uOgkJWzEyOCwwLDBdLA0KCQlyZWQ6ICAgICAgICBbMjU1LDAsMF0sDQoJCXB1cnBsZToJCVsxMjgsMCwxMjhdLA0KCQlmdWNoc2lhOglbMjU1LDAsMjU1XSwNCgkJZ3JlZW46CSAgICBbMCwxMjgsMF0sDQoJCWxpbWU6CSAgICBbMCwyNTUsMF0sDQoJCW9saXZlOgkJWzEyOCwxMjgsMF0sDQoJCXllbGxvdzoJCVsyNTUsMjU1LDBdLA0KCQluYXZ5OiAgICAgICBbMCwwLDEyOF0sDQoJCWJsdWU6ICAgICAgIFswLDAsMjU1XSwNCgkJdGVhbDoJCVswLDEyOCwxMjhdLA0KCQlhcXVhOgkJWzAsMjU1LDI1NV0sDQoJCXRyYW5zcGFyZW50OiBkLmNvbmZpZy50cmFuc3BhcmVudENvbG9yIHx8IFsyNTUsMjU1LDI1NV0NCgl9Ow0KDQoJZG9qby5leHRlbmQoZG9qby5Db2xvciwgew0KCQlyOiAyNTUsIGc6IDI1NSwgYjogMjU1LCBhOiAxLA0KCQlfc2V0OiBmdW5jdGlvbihyLCBnLCBiLCBhKXsNCgkJCXZhciB0ID0gdGhpczsgdC5yID0gcjsgdC5nID0gZzsgdC5iID0gYjsgdC5hID0gYTsNCgkJfSwNCgkJc2V0Q29sb3I6IGZ1bmN0aW9uKC8qQXJyYXl8U3RyaW5nfE9iamVjdCovIGNvbG9yKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJVGFrZXMgYSBuYW1lZCBzdHJpbmcsIGhleCBzdHJpbmcsIGFycmF5IG9mIHJnYiBvciByZ2JhIHZhbHVlcywNCgkJCS8vCQlhbiBvYmplY3Qgd2l0aCByLCBnLCBiLCBhbmQgYSBwcm9wZXJ0aWVzLCBvciBhbm90aGVyIGBkb2pvLkNvbG9yYCBvYmplY3QNCgkJCS8vCQlhbmQgc2V0cyB0aGlzIGNvbG9yIGluc3RhbmNlIHRvIHRoYXQgdmFsdWUuDQoJCQkvLw0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJdmFyIGMgPSBuZXcgZG9qby5Db2xvcigpOyAvLyBubyBjb2xvcg0KCQkJLy8JfAljLnNldENvbG9yKCIjZWRlZGVkIik7IC8vIGdyZXlpc2gNCgkJCWlmKGQuaXNTdHJpbmcoY29sb3IpKXsNCgkJCQlkLmNvbG9yRnJvbVN0cmluZyhjb2xvciwgdGhpcyk7DQoJCQl9ZWxzZSBpZihkLmlzQXJyYXkoY29sb3IpKXsNCgkJCQlkLmNvbG9yRnJvbUFycmF5KGNvbG9yLCB0aGlzKTsNCgkJCX1lbHNlew0KCQkJCXRoaXMuX3NldChjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iLCBjb2xvci5hKTsNCgkJCQlpZighKGNvbG9yIGluc3RhbmNlb2YgZC5Db2xvcikpeyB0aGlzLnNhbml0aXplKCk7IH0NCgkJCX0NCgkJCXJldHVybiB0aGlzOwkvLyBkb2pvLkNvbG9yDQoJCX0sDQoJCXNhbml0aXplOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlFbnN1cmVzIHRoZSBvYmplY3QgaGFzIGNvcnJlY3QgYXR0cmlidXRlcw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZG9lcyBub3RoaW5nLCBpbmNsdWRlIGRvam8uY29sb3JzIHRvDQoJCQkvLwkJYXVnbWVudCBpdCB3aXRoIHJlYWwgY2hlY2tzDQoJCQlyZXR1cm4gdGhpczsJLy8gZG9qby5Db2xvcg0KCQl9LA0KCQl0b1JnYjogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyAzIGNvbXBvbmVudCBhcnJheSBvZiByZ2IgdmFsdWVzDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAl2YXIgYyA9IG5ldyBkb2pvLkNvbG9yKCIjMDAwMDAwIik7DQoJCQkvLwl8IAljb25zb2xlLmxvZyhjLnRvUmdiKCkpOyAvLyBbMCwwLDBdDQoJCQl2YXIgdCA9IHRoaXM7DQoJCQlyZXR1cm4gW3QuciwgdC5nLCB0LmJdOwkvLyBBcnJheQ0KCQl9LA0KCQl0b1JnYmE6IGZ1bmN0aW9uKCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSA0IGNvbXBvbmVudCBhcnJheSBvZiByZ2JhIHZhbHVlcyBmcm9tIHRoZSBjb2xvcg0KCQkJLy8JCXJlcHJlc2VudGVkIGJ5IHRoaXMgb2JqZWN0Lg0KCQkJdmFyIHQgPSB0aGlzOw0KCQkJcmV0dXJuIFt0LnIsIHQuZywgdC5iLCB0LmFdOwkvLyBBcnJheQ0KCQl9LA0KCQl0b0hleDogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIENTUyBjb2xvciBzdHJpbmcgaW4gaGV4YWRlY2ltYWwgcmVwcmVzZW50YXRpb24NCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8IAljb25zb2xlLmxvZyhuZXcgZG9qby5Db2xvcihbMCwwLDBdKS50b0hleCgpKTsgLy8gIzAwMDAwMA0KCQkJdmFyIGFyciA9IGQubWFwKFsiciIsICJnIiwgImIiXSwgZnVuY3Rpb24oeCl7DQoJCQkJdmFyIHMgPSB0aGlzW3hdLnRvU3RyaW5nKDE2KTsNCgkJCQlyZXR1cm4gcy5sZW5ndGggPCAyID8gIjAiICsgcyA6IHM7DQoJCQl9LCB0aGlzKTsNCgkJCXJldHVybiAiIyIgKyBhcnIuam9pbigiIik7CS8vIFN0cmluZw0KCQl9LA0KCQl0b0NzczogZnVuY3Rpb24oLypCb29sZWFuPyovIGluY2x1ZGVBbHBoYSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBjc3MgY29sb3Igc3RyaW5nIGluIHJnYihhKSByZXByZXNlbnRhdGlvbg0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJdmFyIGMgPSBuZXcgZG9qby5Db2xvcigiI0ZGRiIpLnRvQ3NzKCk7DQoJCQkvLwl8CWNvbnNvbGUubG9nKGMpOyAvLyByZ2IoJzI1NScsJzI1NScsJzI1NScpDQoJCQl2YXIgdCA9IHRoaXMsIHJnYiA9IHQuciArICIsICIgKyB0LmcgKyAiLCAiICsgdC5iOw0KCQkJcmV0dXJuIChpbmNsdWRlQWxwaGEgPyAicmdiYSgiICsgcmdiICsgIiwgIiArIHQuYSA6ICJyZ2IoIiArIHJnYikgKyAiKSI7CS8vIFN0cmluZw0KCQl9LA0KCQl0b1N0cmluZzogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIHZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY29sb3INCgkJCXJldHVybiB0aGlzLnRvQ3NzKHRydWUpOyAvLyBTdHJpbmcNCgkJfQ0KCX0pOw0KDQoJZG9qby5ibGVuZENvbG9ycyA9IGZ1bmN0aW9uKA0KCQkvKmRvam8uQ29sb3IqLyBzdGFydCwNCgkJLypkb2pvLkNvbG9yKi8gZW5kLA0KCQkvKk51bWJlciovIHdlaWdodCwNCgkJLypkb2pvLkNvbG9yPyovIG9iag0KCSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlCbGVuZCBjb2xvcnMgZW5kIGFuZCBzdGFydCB3aXRoIHdlaWdodCBmcm9tIDAgdG8gMSwgMC41IGJlaW5nIGEgNTAvNTAgYmxlbmQsDQoJCS8vCQljYW4gcmV1c2UgYSBwcmV2aW91c2x5IGFsbG9jYXRlZCBkb2pvLkNvbG9yIG9iamVjdCBmb3IgdGhlIHJlc3VsdA0KCQl2YXIgdCA9IG9iaiB8fCBuZXcgZC5Db2xvcigpOw0KCQlkLmZvckVhY2goWyJyIiwgImciLCAiYiIsICJhIl0sIGZ1bmN0aW9uKHgpew0KCQkJdFt4XSA9IHN0YXJ0W3hdICsgKGVuZFt4XSAtIHN0YXJ0W3hdKSAqIHdlaWdodDsNCgkJCWlmKHggIT0gImEiKXsgdFt4XSA9IE1hdGgucm91bmQodFt4XSk7IH0NCgkJfSk7DQoJCXJldHVybiB0LnNhbml0aXplKCk7CS8vIGRvam8uQ29sb3INCgl9Ow0KDQoJZG9qby5jb2xvckZyb21SZ2IgPSBmdW5jdGlvbigvKlN0cmluZyovIGNvbG9yLCAvKmRvam8uQ29sb3I/Ki8gb2JqKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYSBgZG9qby5Db2xvcmAgaW5zdGFuY2UgZnJvbSBhIHN0cmluZyBvZiB0aGUgZm9ybQ0KCQkvLwkJInJnYiguLi4pIiBvciAicmdiYSguLi4pIi4gT3B0aW9uYWxseSBhY2NlcHRzIGEgYGRvam8uQ29sb3JgDQoJCS8vCQlvYmplY3QgdG8gdXBkYXRlIHdpdGggdGhlIHBhcnNlZCB2YWx1ZSBhbmQgcmV0dXJuIGluc3RlYWQgb2YNCgkJLy8JCWNyZWF0aW5nIGEgbmV3IG9iamVjdC4NCgkJLy8gcmV0dXJuczoNCgkJLy8JCUEgZG9qby5Db2xvciBvYmplY3QuIElmIG9iaiBpcyBwYXNzZWQsIGl0IHdpbGwgYmUgdGhlIHJldHVybiB2YWx1ZS4NCgkJdmFyIG0gPSBjb2xvci50b0xvd2VyQ2FzZSgpLm1hdGNoKC9ecmdiYT9cKChbXHNcLiwwLTldKylcKS8pOw0KCQlyZXR1cm4gbSAmJiBkb2pvLmNvbG9yRnJvbUFycmF5KG1bMV0uc3BsaXQoL1xzKixccyovKSwgb2JqKTsJLy8gZG9qby5Db2xvcg0KCX07DQoNCglkb2pvLmNvbG9yRnJvbUhleCA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gY29sb3IsIC8qZG9qby5Db2xvcj8qLyBvYmopew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQ29udmVydHMgYSBoZXggc3RyaW5nIHdpdGggYSAnIycgcHJlZml4IHRvIGEgY29sb3Igb2JqZWN0Lg0KCQkvLwkJU3VwcG9ydHMgMTItYml0ICNyZ2Igc2hvcnRoYW5kLiBPcHRpb25hbGx5IGFjY2VwdHMgYQ0KCQkvLwkJYGRvam8uQ29sb3JgIG9iamVjdCB0byB1cGRhdGUgd2l0aCB0aGUgcGFyc2VkIHZhbHVlLg0KCQkvLw0KCQkvLyByZXR1cm5zOg0KCQkvLwkJQSBkb2pvLkNvbG9yIG9iamVjdC4gSWYgb2JqIGlzIHBhc3NlZCwgaXQgd2lsbCBiZSB0aGUgcmV0dXJuIHZhbHVlLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkgfCB2YXIgdGhpbmcgPSBkb2pvLmNvbG9yRnJvbUhleCgiI2VkZWRlZCIpOyAvLyBncmV5LCBsb25naGFuZA0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwl8IHZhciB0aGluZyA9IGRvam8uY29sb3JGcm9tSGV4KCIjMDAwIik7IC8vIGJsYWNrLCBzaG9ydGhhbmQNCgkJdmFyIHQgPSBvYmogfHwgbmV3IGQuQ29sb3IoKSwNCgkJCWJpdHMgPSAoY29sb3IubGVuZ3RoID09IDQpID8gNCA6IDgsDQoJCQltYXNrID0gKDEgPDwgYml0cykgLSAxOw0KCQljb2xvciA9IE51bWJlcigiMHgiICsgY29sb3Iuc3Vic3RyKDEpKTsNCgkJaWYoaXNOYU4oY29sb3IpKXsNCgkJCXJldHVybiBudWxsOyAvLyBkb2pvLkNvbG9yDQoJCX0NCgkJZC5mb3JFYWNoKFsiYiIsICJnIiwgInIiXSwgZnVuY3Rpb24oeCl7DQoJCQl2YXIgYyA9IGNvbG9yICYgbWFzazsNCgkJCWNvbG9yID4+PSBiaXRzOw0KCQkJdFt4XSA9IGJpdHMgPT0gNCA/IDE3ICogYyA6IGM7DQoJCX0pOw0KCQl0LmEgPSAxOw0KCQlyZXR1cm4gdDsJLy8gZG9qby5Db2xvcg0KCX07DQoNCglkb2pvLmNvbG9yRnJvbUFycmF5ID0gZnVuY3Rpb24oLypBcnJheSovIGEsIC8qZG9qby5Db2xvcj8qLyBvYmopew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQnVpbGRzIGEgYGRvam8uQ29sb3JgIGZyb20gYSAzIG9yIDQgZWxlbWVudCBhcnJheSwgbWFwcGluZyBlYWNoDQoJCS8vCQllbGVtZW50IGluIHNlcXVlbmNlIHRvIHRoZSByZ2IoYSkgdmFsdWVzIG9mIHRoZSBjb2xvci4NCgkJLy8gZXhhbXBsZToNCgkJLy8JCXwgdmFyIG15Q29sb3IgPSBkb2pvLmNvbG9yRnJvbUFycmF5KFsyMzcsMjM3LDIzNywwLjVdKTsgLy8gZ3JleSwgNTAlIGFscGhhIA0KCQkvLyByZXR1cm5zOg0KCQkvLwkJQSBkb2pvLkNvbG9yIG9iamVjdC4gSWYgb2JqIGlzIHBhc3NlZCwgaXQgd2lsbCBiZSB0aGUgcmV0dXJuIHZhbHVlLg0KCQl2YXIgdCA9IG9iaiB8fCBuZXcgZC5Db2xvcigpOw0KCQl0Ll9zZXQoTnVtYmVyKGFbMF0pLCBOdW1iZXIoYVsxXSksIE51bWJlcihhWzJdKSwgTnVtYmVyKGFbM10pKTsNCgkJaWYoaXNOYU4odC5hKSl7IHQuYSA9IDE7IH0NCgkJcmV0dXJuIHQuc2FuaXRpemUoKTsJLy8gZG9qby5Db2xvcg0KCX07DQoNCglkb2pvLmNvbG9yRnJvbVN0cmluZyA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gc3RyLCAvKmRvam8uQ29sb3I/Ki8gb2JqKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVBhcnNlcyBgc3RyYCBmb3IgYSBjb2xvciB2YWx1ZS4gQWNjZXB0cyBoZXgsIHJnYiwgYW5kIHJnYmENCgkJLy8JCXN0eWxlIGNvbG9yIHZhbHVlcy4NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQlBY2NlcHRhYmxlIGlucHV0IHZhbHVlcyBmb3Igc3RyIG1heSBpbmNsdWRlIGFycmF5cyBvZiBhbnkgZm9ybQ0KCQkvLwkJYWNjZXB0ZWQgYnkgZG9qby5jb2xvckZyb21BcnJheSwgaGV4IHN0cmluZ3Mgc3VjaCBhcyAiI2FhYWFhYSIsIG9yDQoJCS8vCQlyZ2Igb3IgcmdiYSBzdHJpbmdzIHN1Y2ggYXMgInJnYigxMzMsIDIwMCwgMTYpIiBvciAicmdiYSgxMCwgMTAsDQoJCS8vCQkxMCwgNTApIg0KCQkvLyByZXR1cm5zOg0KCQkvLwkJQSBkb2pvLkNvbG9yIG9iamVjdC4gSWYgb2JqIGlzIHBhc3NlZCwgaXQgd2lsbCBiZSB0aGUgcmV0dXJuIHZhbHVlLg0KCQl2YXIgYSA9IGQuQ29sb3IubmFtZWRbc3RyXTsNCgkJcmV0dXJuIGEgJiYgZC5jb2xvckZyb21BcnJheShhLCBvYmopIHx8IGQuY29sb3JGcm9tUmdiKHN0ciwgb2JqKSB8fCBkLmNvbG9yRnJvbUhleChzdHIsIG9iaik7DQoJfTsNCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlIik7DQoNCg0KDQoNCg0KDQoNCg0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS53aW5kb3ciXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2Uud2luZG93Il0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLndpbmRvdyIpOw0KDQovKj09PT09DQpkb2pvLmRvYyA9IHsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlBbGlhcyBmb3IgdGhlIGN1cnJlbnQgZG9jdW1lbnQuICdkb2pvLmRvYycgY2FuIGJlIG1vZGlmaWVkDQoJLy8JCWZvciB0ZW1wb3JhcnkgY29udGV4dCBzaGlmdGluZy4gQWxzbyBzZWUgZG9qby53aXRoRG9jKCkuDQoJLy8gZGVzY3JpcHRpb246DQoJLy8gICAgUmVmZXIgdG8gZG9qby5kb2MgcmF0aGVyDQoJLy8gICAgdGhhbiByZWZlcnJpbmcgdG8gJ3dpbmRvdy5kb2N1bWVudCcgdG8gZW5zdXJlIHlvdXIgY29kZSBydW5zDQoJLy8gICAgY29ycmVjdGx5IGluIG1hbmFnZWQgY29udGV4dHMuDQoJLy8gZXhhbXBsZToNCgkvLyAJfAluLmFwcGVuZENoaWxkKGRvam8uZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsNCn0NCj09PT09Ki8NCmRvam8uZG9jID0gd2luZG93WyJkb2N1bWVudCJdIHx8IG51bGw7DQoNCmRvam8uYm9keSA9IGZ1bmN0aW9uKCl7DQoJLy8gc3VtbWFyeToNCgkvLwkJUmV0dXJuIHRoZSBib2R5IGVsZW1lbnQgb2YgdGhlIGRvY3VtZW50DQoJLy8JCXJldHVybiB0aGUgYm9keSBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIGRvam8uZG9jDQoJLy8gZXhhbXBsZToNCgkvLyAJfAlkb2pvLmJvZHkoKS5hcHBlbmRDaGlsZChkb2pvLmRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKSk7DQoNCgkvLyBOb3RlOiBkb2N1bWVudC5ib2R5IGlzIG5vdCBkZWZpbmVkIGZvciBhIHN0cmljdCB4aHRtbCBkb2N1bWVudA0KCS8vIFdvdWxkIGxpa2UgdG8gbWVtb2l6ZSB0aGlzLCBidXQgZG9qby5kb2MgY2FuIGNoYW5nZSB2aSBkb2pvLndpdGhEb2MoKS4NCglyZXR1cm4gZG9qby5kb2MuYm9keSB8fCBkb2pvLmRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOyAvLyBOb2RlDQp9DQoNCmRvam8uc2V0Q29udGV4dCA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki9nbG9iYWxPYmplY3QsIC8qRG9jdW1lbnRFbGVtZW50Ki9nbG9iYWxEb2N1bWVudCl7DQoJLy8gc3VtbWFyeToNCgkvLwkJY2hhbmdlcyB0aGUgYmVoYXZpb3Igb2YgbWFueSBjb3JlIERvam8gZnVuY3Rpb25zIHRoYXQgZGVhbCB3aXRoDQoJLy8JCW5hbWVzcGFjZSBhbmQgRE9NIGxvb2t1cCwgY2hhbmdpbmcgdGhlbSB0byB3b3JrIGluIGEgbmV3IGdsb2JhbA0KCS8vCQljb250ZXh0IChlLmcuLCBhbiBpZnJhbWUpLiBUaGUgdmFyaWJsZXMgZG9qby5nbG9iYWwgYW5kIGRvam8uZG9jDQoJLy8JCWFyZSBtb2RpZmllZCBhcyBhIHJlc3VsdCBvZiBjYWxsaW5nIHRoaXMgZnVuY3Rpb24gYW5kIHRoZSByZXN1bHQgb2YNCgkvLwkJYGRvam8uYm9keSgpYCBsaWtld2lzZSBkaWZmZXJzLg0KCWRvam8uZ2xvYmFsID0gZ2xvYmFsT2JqZWN0Ow0KCWRvam8uZG9jID0gZ2xvYmFsRG9jdW1lbnQ7DQp9Ow0KDQpkb2pvLndpdGhHbG9iYWwgPSBmdW5jdGlvbigJLypPYmplY3QqL2dsb2JhbE9iamVjdCwgDQoJCQkJCQkJLypGdW5jdGlvbiovY2FsbGJhY2ssIA0KCQkJCQkJCS8qT2JqZWN0PyovdGhpc09iamVjdCwgDQoJCQkJCQkJLypBcnJheT8qL2NiQXJndW1lbnRzKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlJbnZva2UgY2FsbGJhY2sgd2l0aCBnbG9iYWxPYmplY3QgYXMgZG9qby5nbG9iYWwgYW5kDQoJLy8JCWdsb2JhbE9iamVjdC5kb2N1bWVudCBhcyBkb2pvLmRvYy4NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLwkJSW52b2tlIGNhbGxiYWNrIHdpdGggZ2xvYmFsT2JqZWN0IGFzIGRvam8uZ2xvYmFsIGFuZA0KCS8vCQlnbG9iYWxPYmplY3QuZG9jdW1lbnQgYXMgZG9qby5kb2MuIElmIHByb3ZpZGVkLCBnbG9iYWxPYmplY3QNCgkvLwkJd2lsbCBiZSBleGVjdXRlZCBpbiB0aGUgY29udGV4dCBvZiBvYmplY3QgdGhpc09iamVjdA0KCS8vCQlXaGVuIGNhbGxiYWNrKCkgcmV0dXJucyBvciB0aHJvd3MgYW4gZXJyb3IsIHRoZSBkb2pvLmdsb2JhbA0KCS8vCQlhbmQgZG9qby5kb2Mgd2lsbCBiZSByZXN0b3JlZCB0byBpdHMgcHJldmlvdXMgc3RhdGUuDQoNCgl2YXIgb2xkR2xvYiA9IGRvam8uZ2xvYmFsOw0KCXRyeXsNCgkJZG9qby5nbG9iYWwgPSBnbG9iYWxPYmplY3Q7DQoJCXJldHVybiBkb2pvLndpdGhEb2MuY2FsbChudWxsLCBnbG9iYWxPYmplY3QuZG9jdW1lbnQsIGNhbGxiYWNrLCB0aGlzT2JqZWN0LCBjYkFyZ3VtZW50cyk7DQoJfWZpbmFsbHl7DQoJCWRvam8uZ2xvYmFsID0gb2xkR2xvYjsNCgl9DQp9DQoNCmRvam8ud2l0aERvYyA9IGZ1bmN0aW9uKAkvKkRvY3VtZW50RWxlbWVudCovZG9jdW1lbnRPYmplY3QsIA0KCQkJCQkJCS8qRnVuY3Rpb24qL2NhbGxiYWNrLCANCgkJCQkJCQkvKk9iamVjdD8qL3RoaXNPYmplY3QsIA0KCQkJCQkJCS8qQXJyYXk/Ki9jYkFyZ3VtZW50cyl7DQoJLy8gc3VtbWFyeToNCgkvLwkJSW52b2tlIGNhbGxiYWNrIHdpdGggZG9jdW1lbnRPYmplY3QgYXMgZG9qby5kb2MuDQoJLy8gZGVzY3JpcHRpb246DQoJLy8JCUludm9rZSBjYWxsYmFjayB3aXRoIGRvY3VtZW50T2JqZWN0IGFzIGRvam8uZG9jLiBJZiBwcm92aWRlZCwNCgkvLwkJY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCBpbiB0aGUgY29udGV4dCBvZiBvYmplY3QgdGhpc09iamVjdA0KCS8vCQlXaGVuIGNhbGxiYWNrKCkgcmV0dXJucyBvciB0aHJvd3MgYW4gZXJyb3IsIHRoZSBkb2pvLmRvYyB3aWxsDQoJLy8JCWJlIHJlc3RvcmVkIHRvIGl0cyBwcmV2aW91cyBzdGF0ZS4NCg0KCXZhciBvbGREb2MgPSBkb2pvLmRvYywNCgkJb2xkTHRyID0gZG9qby5fYm9keUx0ciwNCgkJb2xkUSA9IGRvam8uaXNRdWlya3M7DQoNCgl0cnl7DQoJCWRvam8uZG9jID0gZG9jdW1lbnRPYmplY3Q7DQoJCWRlbGV0ZSBkb2pvLl9ib2R5THRyOyAvLyB1bmNhY2hlDQoJCWRvam8uaXNRdWlya3MgPSBkb2pvLmRvYy5jb21wYXRNb2RlID09ICJCYWNrQ29tcGF0IjsgLy8gbm8gbmVlZCB0byBjaGVjayBmb3IgUXVpcmtzTW9kZSB3aGljaCB3YXMgT3BlcmEgNyBvbmx5DQoNCgkJaWYodGhpc09iamVjdCAmJiB0eXBlb2YgY2FsbGJhY2sgPT0gInN0cmluZyIpew0KCQkJY2FsbGJhY2sgPSB0aGlzT2JqZWN0W2NhbGxiYWNrXTsNCgkJfQ0KDQoJCXJldHVybiBjYWxsYmFjay5hcHBseSh0aGlzT2JqZWN0LCBjYkFyZ3VtZW50cyB8fCBbXSk7DQoJfWZpbmFsbHl7DQoJCWRvam8uZG9jID0gb2xkRG9jOw0KCQlkZWxldGUgZG9qby5fYm9keUx0cjsgLy8gaW4gY2FzZSBpdCB3YXMgdW5kZWZpbmVkIG9yaWdpbmFsbHksIGFuZCBzZXQgdG8gdHJ1ZS9mYWxzZSBieSB0aGUgYWx0ZXJuYXRlIGRvY3VtZW50DQoJCWlmKG9sZEx0ciAhPT0gdW5kZWZpbmVkKXsgZG9qby5fYm9keUx0ciA9IG9sZEx0cjsgfQ0KCQlkb2pvLmlzUXVpcmtzID0gb2xkUTsNCgl9DQp9Ow0KCQ0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5ldmVudCJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5ldmVudCJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5ldmVudCIpOw0KDQoNCi8vIHRoaXMgZmlsZSBjb3VydGVzeSBvZiB0aGUgVHVyYm9BamF4IEdyb3VwLCBsaWNlbnNlZCB1bmRlciBhIERvam8gQ0xBDQoNCihmdW5jdGlvbigpew0KCS8vIERPTSBldmVudCBsaXN0ZW5lciBtYWNoaW5lcnkNCgl2YXIgZGVsID0gKGRvam8uX2V2ZW50X2xpc3RlbmVyID0gew0KCQlhZGQ6IGZ1bmN0aW9uKC8qRE9NTm9kZSovIG5vZGUsIC8qU3RyaW5nKi8gbmFtZSwgLypGdW5jdGlvbiovIGZwKXsNCgkJCWlmKCFub2RlKXtyZXR1cm47fSANCgkJCW5hbWUgPSBkZWwuX25vcm1hbGl6ZUV2ZW50TmFtZShuYW1lKTsNCgkJCWZwID0gZGVsLl9maXhDYWxsYmFjayhuYW1lLCBmcCk7DQoJCQl2YXIgb25hbWUgPSBuYW1lOw0KCQkJaWYoDQoJCQkJCQkJCSFkb2pvLmlzSUUgJiYgDQoJCQkJCQkJCShuYW1lID09ICJtb3VzZWVudGVyIiB8fCBuYW1lID09ICJtb3VzZWxlYXZlIikNCgkJCSl7DQoJCQkJdmFyIG9mcCA9IGZwOw0KCQkJCS8vb25hbWUgPSBuYW1lOw0KCQkJCW5hbWUgPSAobmFtZSA9PSAibW91c2VlbnRlciIpID8gIm1vdXNlb3ZlciIgOiAibW91c2VvdXQiOw0KCQkJCWZwID0gZnVuY3Rpb24oZSl7DQoJCQkJCWlmKCFkb2pvLmlzRGVzY2VuZGFudChlLnJlbGF0ZWRUYXJnZXQsIG5vZGUpKXsNCgkJCQkJCS8vIGUudHlwZSA9IG9uYW1lOyAvLyBGSVhNRTogZG9lc24ndCB0YWtlPyBTSk06IGV2ZW50LnR5cGUgaXMgZ2VuZXJhbGx5IGltbXV0YWJsZS4NCgkJCQkJCXJldHVybiBvZnAuY2FsbCh0aGlzLCBlKTsgDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQlub2RlLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZnAsIGZhbHNlKTsNCgkJCXJldHVybiBmcDsgLypIYW5kbGUqLw0KCQl9LA0KCQlyZW1vdmU6IGZ1bmN0aW9uKC8qRE9NTm9kZSovIG5vZGUsIC8qU3RyaW5nKi8gZXZlbnQsIC8qSGFuZGxlKi8gaGFuZGxlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJY2xvYmJlcnMgdGhlIGxpc3RlbmVyIGZyb20gdGhlIG5vZGUNCgkJCS8vIG5vZGU6DQoJCQkvLwkJRE9NIG5vZGUgdG8gYXR0YWNoIHRoZSBldmVudCB0bw0KCQkJLy8gZXZlbnQ6DQoJCQkvLwkJdGhlIG5hbWUgb2YgdGhlIGhhbmRsZXIgdG8gcmVtb3ZlIHRoZSBmdW5jdGlvbiBmcm9tDQoJCQkvLyBoYW5kbGU6DQoJCQkvLwkJdGhlIGhhbmRsZSByZXR1cm5lZCBmcm9tIGFkZA0KCQkJaWYobm9kZSl7DQoJCQkJZXZlbnQgPSBkZWwuX25vcm1hbGl6ZUV2ZW50TmFtZShldmVudCk7DQoJCQkJaWYoIWRvam8uaXNJRSAmJiAoZXZlbnQgPT0gIm1vdXNlZW50ZXIiIHx8IGV2ZW50ID09ICJtb3VzZWxlYXZlIikpew0KCQkJCQlldmVudCA9IChldmVudCA9PSAibW91c2VlbnRlciIpID8gIm1vdXNlb3ZlciIgOiAibW91c2VvdXQiOw0KCQkJCX0NCg0KCQkJCW5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlLCBmYWxzZSk7DQoJCQl9DQoJCX0sDQoJCV9ub3JtYWxpemVFdmVudE5hbWU6IGZ1bmN0aW9uKC8qU3RyaW5nKi8gbmFtZSl7DQoJCQkvLyBHZW5lcmFsbHksIG5hbWUgc2hvdWxkIGJlIGxvd2VyIGNhc2UsIHVubGVzcyBpdCBpcyBzcGVjaWFsDQoJCQkvLyBzb21laG93IChlLmcuIGEgTW96aWxsYSBET00gZXZlbnQpLg0KCQkJLy8gUmVtb3ZlICdvbicuDQoJCQlyZXR1cm4gbmFtZS5zbGljZSgwLDIpID09Im9uIiA/IG5hbWUuc2xpY2UoMikgOiBuYW1lOw0KCQl9LA0KCQlfZml4Q2FsbGJhY2s6IGZ1bmN0aW9uKC8qU3RyaW5nKi8gbmFtZSwgZnApew0KCQkJLy8gQnkgZGVmYXVsdCwgd2Ugb25seSBpbnZva2UgX2ZpeEV2ZW50IGZvciAna2V5cHJlc3MnDQoJCQkvLyBJZiBjb2RlIGlzIGFkZGVkIHRvIF9maXhFdmVudCBmb3Igb3RoZXIgZXZlbnRzLCB3ZSBoYXZlDQoJCQkvLyB0byByZXZpc2l0IHRoaXMgb3B0aW1pemF0aW9uLg0KCQkJLy8gVGhpcyBhbHNvIGFwcGxpZXMgdG8gX2ZpeEV2ZW50IG92ZXJyaWRlcyBmb3IgU2FmYXJpIGFuZCBPcGVyYQ0KCQkJLy8gYmVsb3cuDQoJCQlyZXR1cm4gbmFtZSAhPSAia2V5cHJlc3MiID8gZnAgOiBmdW5jdGlvbihlKXsgcmV0dXJuIGZwLmNhbGwodGhpcywgZGVsLl9maXhFdmVudChlLCB0aGlzKSk7IH07DQoJCX0sDQoJCV9maXhFdmVudDogZnVuY3Rpb24oZXZ0LCBzZW5kZXIpew0KCQkJLy8gX2ZpeENhbGxiYWNrIG9ubHkgYXR0YWNoZXMgdXMgdG8ga2V5cHJlc3MuDQoJCQkvLyBTd2l0Y2ggb24gZXZ0LnR5cGUgYW55d2F5IGJlY2F1c2Ugd2UgbWlnaHQgDQoJCQkvLyBiZSBjYWxsZWQgZGlyZWN0bHkgZnJvbSBkb2pvLmZpeEV2ZW50Lg0KCQkJc3dpdGNoKGV2dC50eXBlKXsNCgkJCQljYXNlICJrZXlwcmVzcyI6DQoJCQkJCWRlbC5fc2V0S2V5Q2hhcihldnQpOw0KCQkJCQlicmVhazsNCgkJCX0NCgkJCXJldHVybiBldnQ7DQoJCX0sDQoJCV9zZXRLZXlDaGFyOiBmdW5jdGlvbihldnQpew0KCQkJZXZ0LmtleUNoYXIgPSBldnQuY2hhckNvZGUgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2dC5jaGFyQ29kZSkgOiAnJzsNCgkJCWV2dC5jaGFyT3JDb2RlID0gZXZ0LmtleUNoYXIgfHwgZXZ0LmtleUNvZGU7DQoJCX0sDQoJCS8vIEZvciBJRSBhbmQgU2FmYXJpOiBzb21lIGN0cmwta2V5IGNvbWJpbmF0aW9ucyAobW9zdGx5IHcvcHVuY3R1YXRpb24pIGRvIG5vdCBlbWl0IGEgY2hhciBjb2RlIGluIElFDQoJCS8vIHdlIG1hcCB0aG9zZSB2aXJ0dWFsIGtleSBjb2RlcyB0byBhc2NpaSBoZXJlDQoJCS8vIG5vdCB2YWxpZCBmb3IgYWxsIChub24tVVMpIGtleWJvYXJkcywgc28gbWF5YmUgd2Ugc2hvdWxkbid0IGJvdGhlcg0KCQlfcHVuY3RNYXA6IHsgDQoJCQkxMDY6NDIsIA0KCQkJMTExOjQ3LCANCgkJCTE4Njo1OSwgDQoJCQkxODc6NDMsIA0KCQkJMTg4OjQ0LCANCgkJCTE4OTo0NSwgDQoJCQkxOTA6NDYsIA0KCQkJMTkxOjQ3LCANCgkJCTE5Mjo5NiwgDQoJCQkyMTk6OTEsIA0KCQkJMjIwOjkyLCANCgkJCTIyMTo5MywgDQoJCQkyMjI6MzkgDQoJCX0NCgl9KTsNCg0KCS8vIERPTSBldmVudHMNCgkNCglkb2pvLmZpeEV2ZW50ID0gZnVuY3Rpb24oLypFdmVudCovIGV2dCwgLypET01Ob2RlKi8gc2VuZGVyKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCW5vcm1hbGl6ZXMgcHJvcGVydGllcyBvbiB0aGUgZXZlbnQgb2JqZWN0IGluY2x1ZGluZyBldmVudA0KCQkvLwkJYnViYmxpbmcgbWV0aG9kcywga2V5c3Ryb2tlIG5vcm1hbGl6YXRpb24sIGFuZCB4L3kgcG9zaXRpb25zDQoJCS8vIGV2dDogRXZlbnQNCgkJLy8JCW5hdGl2ZSBldmVudCBvYmplY3QNCgkJLy8gc2VuZGVyOiBET01Ob2RlDQoJCS8vCQlub2RlIHRvIHRyZWF0IGFzICJjdXJyZW50VGFyZ2V0Ig0KCQlyZXR1cm4gZGVsLl9maXhFdmVudChldnQsIHNlbmRlcik7DQoJfQ0KDQoJZG9qby5zdG9wRXZlbnQgPSBmdW5jdGlvbigvKkV2ZW50Ki8gZXZ0KXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCXByZXZlbnRzIHByb3BhZ2F0aW9uIGFuZCBjbG9iYmVycyB0aGUgZGVmYXVsdCBhY3Rpb24gb2YgdGhlDQoJCS8vCQlwYXNzZWQgZXZlbnQNCgkJLy8gZXZ0OiBFdmVudA0KCQkvLwkJVGhlIGV2ZW50IG9iamVjdC4gSWYgb21pdHRlZCwgd2luZG93LmV2ZW50IGlzIHVzZWQgb24gSUUuDQoJCWV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KCQlldnQuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCS8vIE5PVEU6IGJlbG93LCB0aGlzIG1ldGhvZCBpcyBvdmVycmlkZGVuIGZvciBJRQ0KCX0NCg0KCS8vIHRoZSBkZWZhdWx0IGxpc3RlbmVyIHRvIHVzZSBvbiBkb250Rml4IG5vZGVzLCBvdmVycmlkZW4gZm9yIElFDQoJdmFyIG5vZGVfbGlzdGVuZXIgPSBkb2pvLl9saXN0ZW5lcjsNCgkNCgkvLyBVbmlmeSBjb25uZWN0IGFuZCBldmVudCBsaXN0ZW5lcnMNCglkb2pvLl9jb25uZWN0ID0gZnVuY3Rpb24ob2JqLCBldmVudCwgY29udGV4dCwgbWV0aG9kLCBkb250Rml4KXsNCgkJLy8gRklYTUU6IG5lZWQgYSBtb3JlIHN0cmljdCB0ZXN0DQoJCXZhciBpc05vZGUgPSBvYmogJiYgKG9iai5ub2RlVHlwZXx8b2JqLmF0dGFjaEV2ZW50fHxvYmouYWRkRXZlbnRMaXN0ZW5lcik7DQoJCS8vIGNob29zZSBvbmUgb2YgdGhyZWUgbGlzdGVuZXIgb3B0aW9uczogcmF3IChjb25uZWN0LmpzKSwgRE9NIGV2ZW50IG9uIGEgTm9kZSwgY3VzdG9tIGV2ZW50IG9uIGEgTm9kZQ0KCQkvLyB3ZSBuZWVkIHRoZSB0aGlyZCBvcHRpb24gdG8gcHJvdmlkZSBsZWFrIHByZXZlbnRpb24gb24gYnJva2VuIGJyb3dzZXJzIChJRSkNCgkJdmFyIGxpZCA9IGlzTm9kZSA/IChkb250Rml4ID8gMiA6IDEpIDogMCwgbCA9IFtkb2pvLl9saXN0ZW5lciwgZGVsLCBub2RlX2xpc3RlbmVyXVtsaWRdOw0KCQkvLyBjcmVhdGUgYSBsaXN0ZW5lcg0KCQl2YXIgaCA9IGwuYWRkKG9iaiwgZXZlbnQsIGRvam8uaGl0Y2goY29udGV4dCwgbWV0aG9kKSk7DQoJCS8vIGZvcm1lcmx5LCB0aGUgZGlzY29ubmVjdCBwYWNrYWdlIGNvbnRhaW5lZCAibCIgZGlyZWN0bHksIGJ1dCBpZiBjbGllbnQgY29kZQ0KCQkvLyBsZWFrcyB0aGUgZGlzY29ubmVjdCBwYWNrYWdlIChieSBjb25uZWN0aW5nIGl0IHRvIGEgbm9kZSksIHJlZmVyZW5jaW5nICJsIiANCgkJLy8gY29tcG91bmRzIHRoZSBwcm9ibGVtLg0KCQkvLyBpbnN0ZWFkIHdlIHJldHVybiBhIGxpc3RlbmVyIGlkLCB3aGljaCByZXF1aXJlcyBjdXN0b20gX2Rpc2Nvbm5lY3QgYmVsb3cuDQoJCS8vIHJldHVybiBkaXNjb25uZWN0IHBhY2thZ2UNCgkJcmV0dXJuIFsgb2JqLCBldmVudCwgaCwgbGlkIF07DQoJfQ0KDQoJZG9qby5fZGlzY29ubmVjdCA9IGZ1bmN0aW9uKG9iaiwgZXZlbnQsIGhhbmRsZSwgbGlzdGVuZXIpew0KCQkoW2Rvam8uX2xpc3RlbmVyLCBkZWwsIG5vZGVfbGlzdGVuZXJdW2xpc3RlbmVyXSkucmVtb3ZlKG9iaiwgZXZlbnQsIGhhbmRsZSk7DQoJfQ0KDQoJLy8gQ29uc3RhbnRzDQoNCgkvLyBQdWJsaWM6IGNsaWVudCBjb2RlIHNob3VsZCB0ZXN0DQoJLy8ga2V5Q29kZSBhZ2FpbnN0IHRoZXNlIG5hbWVkIGNvbnN0YW50cywgYXMgdGhlDQoJLy8gYWN0dWFsIGNvZGVzIGNhbiB2YXJ5IGJ5IGJyb3dzZXIuDQoJZG9qby5rZXlzID0gew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJRGVmaW5pdGlvbnMgZm9yIGNvbW1vbiBrZXkgdmFsdWVzDQoJCUJBQ0tTUEFDRTogOCwNCgkJVEFCOiA5LA0KCQlDTEVBUjogMTIsDQoJCUVOVEVSOiAxMywNCgkJU0hJRlQ6IDE2LA0KCQlDVFJMOiAxNywNCgkJQUxUOiAxOCwNCgkJTUVUQTogZG9qby5pc1NhZmFyaSA/IDkxIDogMjI0LAkJLy8gdGhlIGFwcGxlIGtleSBvbiBtYWNzDQoJCVBBVVNFOiAxOSwNCgkJQ0FQU19MT0NLOiAyMCwNCgkJRVNDQVBFOiAyNywNCgkJU1BBQ0U6IDMyLA0KCQlQQUdFX1VQOiAzMywNCgkJUEFHRV9ET1dOOiAzNCwNCgkJRU5EOiAzNSwNCgkJSE9NRTogMzYsDQoJCUxFRlRfQVJST1c6IDM3LA0KCQlVUF9BUlJPVzogMzgsDQoJCVJJR0hUX0FSUk9XOiAzOSwNCgkJRE9XTl9BUlJPVzogNDAsDQoJCUlOU0VSVDogNDUsDQoJCURFTEVURTogNDYsDQoJCUhFTFA6IDQ3LA0KCQlMRUZUX1dJTkRPVzogOTEsDQoJCVJJR0hUX1dJTkRPVzogOTIsDQoJCVNFTEVDVDogOTMsDQoJCU5VTVBBRF8wOiA5NiwNCgkJTlVNUEFEXzE6IDk3LA0KCQlOVU1QQURfMjogOTgsDQoJCU5VTVBBRF8zOiA5OSwNCgkJTlVNUEFEXzQ6IDEwMCwNCgkJTlVNUEFEXzU6IDEwMSwNCgkJTlVNUEFEXzY6IDEwMiwNCgkJTlVNUEFEXzc6IDEwMywNCgkJTlVNUEFEXzg6IDEwNCwNCgkJTlVNUEFEXzk6IDEwNSwNCgkJTlVNUEFEX01VTFRJUExZOiAxMDYsDQoJCU5VTVBBRF9QTFVTOiAxMDcsDQoJCU5VTVBBRF9FTlRFUjogMTA4LA0KCQlOVU1QQURfTUlOVVM6IDEwOSwNCgkJTlVNUEFEX1BFUklPRDogMTEwLA0KCQlOVU1QQURfRElWSURFOiAxMTEsDQoJCUYxOiAxMTIsDQoJCUYyOiAxMTMsDQoJCUYzOiAxMTQsDQoJCUY0OiAxMTUsDQoJCUY1OiAxMTYsDQoJCUY2OiAxMTcsDQoJCUY3OiAxMTgsDQoJCUY4OiAxMTksDQoJCUY5OiAxMjAsDQoJCUYxMDogMTIxLA0KCQlGMTE6IDEyMiwNCgkJRjEyOiAxMjMsDQoJCUYxMzogMTI0LA0KCQlGMTQ6IDEyNSwNCgkJRjE1OiAxMjYsDQoJCU5VTV9MT0NLOiAxNDQsDQoJCVNDUk9MTF9MT0NLOiAxNDUsDQoJCS8vIHZpcnR1YWwga2V5IG1hcHBpbmcNCgkJY29weUtleTogZG9qby5pc01hYyAmJiAhZG9qby5pc0FJUiA/IChkb2pvLmlzU2FmYXJpID8gOTEgOiAyMjQgKSA6IDE3DQoJfTsNCgkNCgl2YXIgZXZ0Q29weUtleSA9IGRvam8uaXNNYWMgPyAibWV0YUtleSIgOiAiY3RybEtleSI7DQoJDQoJZG9qby5pc0NvcHlLZXkgPSBmdW5jdGlvbihlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUNoZWNrcyBhbiBldmVudCBmb3IgdGhlIGNvcHkga2V5IChtZXRhIG9uIE1hYywgYW5kIGN0cmwgYW55d2hlcmUgZWxzZSkNCgkJLy8gZTogRXZlbnQNCgkJLy8JCUV2ZW50IG9iamVjdCB0byBleGFtaW5lDQoJCXJldHVybiBlW2V2dENvcHlLZXldOwkvLyBCb29sZWFuDQoJfTsNCg0KCS8vIFB1YmxpYzogZGVjb2RpbmcgbW91c2UgYnV0dG9ucyBmcm9tIGV2ZW50cw0KDQovKj09PT09DQoJZG9qby5tb3VzZUJ1dHRvbnMgPSB7DQoJCS8vIExFRlQ6IE51bWJlcg0KCQkvLwkJTnVtZXJpYyB2YWx1ZSBvZiB0aGUgbGVmdCBtb3VzZSBidXR0b24gZm9yIHRoZSBwbGF0Zm9ybS4NCgkJTEVGVDogICAwLA0KCQkvLyBNSURETEU6IE51bWJlcg0KCQkvLwkJTnVtZXJpYyB2YWx1ZSBvZiB0aGUgbWlkZGxlIG1vdXNlIGJ1dHRvbiBmb3IgdGhlIHBsYXRmb3JtLg0KCQlNSURETEU6IDEsDQoJCS8vIFJJR0hUOiBOdW1iZXINCgkJLy8JCU51bWVyaWMgdmFsdWUgb2YgdGhlIHJpZ2h0IG1vdXNlIGJ1dHRvbiBmb3IgdGhlIHBsYXRmb3JtLg0KCQlSSUdIVDogIDIsDQoJDQoJCWlzQnV0dG9uOiBmdW5jdGlvbihlLCBidXR0b24pew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlDaGVja3MgYW4gZXZlbnQgb2JqZWN0IGZvciBhIHByZXNzZWQgYnV0dG9uDQoJCQkvLyBlOiBFdmVudA0KCQkJLy8JCUV2ZW50IG9iamVjdCB0byBleGFtaW5lDQoJCQkvLyBidXR0b246IE51bWJlcg0KCQkJLy8JCVRoZSBidXR0b24gdmFsdWUgKGV4YW1wbGU6IGRvam8ubW91c2VCdXR0b24uTEVGVCkNCgkJCXJldHVybiBlLmJ1dHRvbiA9PSBidXR0b247IC8vIEJvb2xlYW4NCgkJfSwNCgkJaXNMZWZ0OiBmdW5jdGlvbihlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJQ2hlY2tzIGFuIGV2ZW50IG9iamVjdCBmb3IgdGhlIHByZXNzZWQgbGVmdCBidXR0b24NCgkJCS8vIGU6IEV2ZW50DQoJCQkvLwkJRXZlbnQgb2JqZWN0IHRvIGV4YW1pbmUNCgkJCXJldHVybiBlLmJ1dHRvbiA9PSAwOyAvLyBCb29sZWFuDQoJCX0sDQoJCWlzTWlkZGxlOiBmdW5jdGlvbihlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJQ2hlY2tzIGFuIGV2ZW50IG9iamVjdCBmb3IgdGhlIHByZXNzZWQgbWlkZGxlIGJ1dHRvbg0KCQkJLy8gZTogRXZlbnQNCgkJCS8vCQlFdmVudCBvYmplY3QgdG8gZXhhbWluZQ0KCQkJcmV0dXJuIGUuYnV0dG9uID09IDE7IC8vIEJvb2xlYW4NCgkJfSwNCgkJaXNSaWdodDogZnVuY3Rpb24oZSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUNoZWNrcyBhbiBldmVudCBvYmplY3QgZm9yIHRoZSBwcmVzc2VkIHJpZ2h0IGJ1dHRvbg0KCQkJLy8gZTogRXZlbnQNCgkJCS8vCQlFdmVudCBvYmplY3QgdG8gZXhhbWluZQ0KCQkJcmV0dXJuIGUuYnV0dG9uID09IDI7IC8vIEJvb2xlYW4NCgkJfQ0KCX07DQo9PT09PSovDQoNCgkJaWYoZG9qby5pc0lFKXsNCgkJZG9qby5tb3VzZUJ1dHRvbnMgPSB7DQoJCQlMRUZUOiAgIDEsDQoJCQlNSURETEU6IDQsDQoJCQlSSUdIVDogIDIsDQoJCQkvLyBoZWxwZXIgZnVuY3Rpb25zDQoJCQlpc0J1dHRvbjogZnVuY3Rpb24oZSwgYnV0dG9uKXsgcmV0dXJuIGUuYnV0dG9uICYgYnV0dG9uOyB9LA0KCQkJaXNMZWZ0OiAgIGZ1bmN0aW9uKGUpeyByZXR1cm4gZS5idXR0b24gJiAxOyB9LA0KCQkJaXNNaWRkbGU6IGZ1bmN0aW9uKGUpeyByZXR1cm4gZS5idXR0b24gJiA0OyB9LA0KCQkJaXNSaWdodDogIGZ1bmN0aW9uKGUpeyByZXR1cm4gZS5idXR0b24gJiAyOyB9DQoJCX07DQoJfWVsc2V7DQoJCQlkb2pvLm1vdXNlQnV0dG9ucyA9IHsNCgkJCUxFRlQ6ICAgMCwNCgkJCU1JRERMRTogMSwNCgkJCVJJR0hUOiAgMiwNCgkJCS8vIGhlbHBlciBmdW5jdGlvbnMNCgkJCWlzQnV0dG9uOiBmdW5jdGlvbihlLCBidXR0b24peyByZXR1cm4gZS5idXR0b24gPT0gYnV0dG9uOyB9LA0KCQkJaXNMZWZ0OiAgIGZ1bmN0aW9uKGUpeyByZXR1cm4gZS5idXR0b24gPT0gMDsgfSwNCgkJCWlzTWlkZGxlOiBmdW5jdGlvbihlKXsgcmV0dXJuIGUuYnV0dG9uID09IDE7IH0sDQoJCQlpc1JpZ2h0OiAgZnVuY3Rpb24oZSl7IHJldHVybiBlLmJ1dHRvbiA9PSAyOyB9DQoJCX07DQoJCX0NCgkNCgkJLy8gSUUgZXZlbnQgbm9ybWFsaXphdGlvbg0KCWlmKGRvam8uaXNJRSl7IA0KCQl2YXIgX3RyeVNldEtleUNvZGUgPSBmdW5jdGlvbihlLCBjb2RlKXsNCgkJCXRyeXsNCgkJCQkvLyBzcXVlbGNoIGVycm9ycyB3aGVuIGtleUNvZGUgaXMgcmVhZC1vbmx5DQoJCQkJLy8gKGUuZy4gaWYga2V5Q29kZSBpcyBjdHJsIG9yIHNoaWZ0KQ0KCQkJCXJldHVybiAoZS5rZXlDb2RlID0gY29kZSk7DQoJCQl9Y2F0Y2goZSl7DQoJCQkJcmV0dXJuIDA7DQoJCQl9DQoJCX0NCg0KCQkvLyBieSBkZWZhdWx0LCB1c2UgdGhlIHN0YW5kYXJkIGxpc3RlbmVyDQoJCXZhciBpZWwgPSBkb2pvLl9saXN0ZW5lcjsNCgkJdmFyIGxpc3RlbmVyc05hbWUgPSAoZG9qby5faWVMaXN0ZW5lcnNOYW1lID0gIl8iICsgZG9qby5fc2NvcGVOYW1lICsgIl9saXN0ZW5lcnMiKTsNCgkJLy8gZGlzcGF0Y2hlciB0cmFja2luZyBwcm9wZXJ0eQ0KCQlpZighZG9qby5jb25maWcuX2FsbG93X2xlYWtzKXsNCgkJCS8vIGN1c3RvbSBsaXN0ZW5lciB0aGF0IGhhbmRsZXMgbGVhayBwcm90ZWN0aW9uIGZvciBET00gZXZlbnRzDQoJCQlub2RlX2xpc3RlbmVyID0gaWVsID0gZG9qby5faWVfbGlzdGVuZXIgPSB7DQoJCQkJLy8gc3VwcG9ydCBoYW5kbGVyIGluZGlyZWN0aW9uOiBldmVudCBoYW5kbGVyIGZ1bmN0aW9ucyBhcmUgDQoJCQkJLy8gcmVmZXJlbmNlZCBoZXJlLiBFdmVudCBkaXNwYXRjaGVycyBob2xkIG9ubHkgaW5kaWNlcy4NCgkJCQloYW5kbGVyczogW10sDQoJCQkJLy8gYWRkIGEgbGlzdGVuZXIgdG8gYW4gb2JqZWN0DQoJCQkJYWRkOiBmdW5jdGlvbigvKk9iamVjdCovIHNvdXJjZSwgLypTdHJpbmcqLyBtZXRob2QsIC8qRnVuY3Rpb24qLyBsaXN0ZW5lcil7DQoJCQkJCXNvdXJjZSA9IHNvdXJjZSB8fCBkb2pvLmdsb2JhbDsNCgkJCQkJdmFyIGYgPSBzb3VyY2VbbWV0aG9kXTsNCgkJCQkJaWYoIWZ8fCFmW2xpc3RlbmVyc05hbWVdKXsNCgkJCQkJCXZhciBkID0gZG9qby5fZ2V0SWVEaXNwYXRjaGVyKCk7DQoJCQkJCQkvLyBvcmlnaW5hbCB0YXJnZXQgZnVuY3Rpb24gaXMgc3BlY2lhbA0KCQkJCQkJZC50YXJnZXQgPSBmICYmIChpZWgucHVzaChmKSAtIDEpOw0KCQkJCQkJLy8gZGlzcGF0Y2hlciBob2xkcyBhIGxpc3Qgb2YgaW5kaWNlcyBpbnRvIGhhbmRsZXJzIHRhYmxlDQoJCQkJCQlkW2xpc3RlbmVyc05hbWVdID0gW107DQoJCQkJCQkvLyByZWRpcmVjdCBzb3VyY2UgdG8gZGlzcGF0Y2hlcg0KCQkJCQkJZiA9IHNvdXJjZVttZXRob2RdID0gZDsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gZltsaXN0ZW5lcnNOYW1lXS5wdXNoKGllaC5wdXNoKGxpc3RlbmVyKSAtIDEpIDsgLypIYW5kbGUqLw0KCQkJCX0sDQoJCQkJLy8gcmVtb3ZlIGEgbGlzdGVuZXIgZnJvbSBhbiBvYmplY3QNCgkJCQlyZW1vdmU6IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gc291cmNlLCAvKlN0cmluZyovIG1ldGhvZCwgLypIYW5kbGUqLyBoYW5kbGUpew0KCQkJCQl2YXIgZiA9IChzb3VyY2V8fGRvam8uZ2xvYmFsKVttZXRob2RdLCBsID0gZiAmJiBmW2xpc3RlbmVyc05hbWVdOw0KCQkJCQlpZihmICYmIGwgJiYgaGFuZGxlLS0pew0KCQkJCQkJZGVsZXRlIGllaFtsW2hhbmRsZV1dOw0KCQkJCQkJZGVsZXRlIGxbaGFuZGxlXTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX07DQoJCQkvLyBhbGlhcyB1c2VkIGFib3ZlDQoJCQl2YXIgaWVoID0gaWVsLmhhbmRsZXJzOw0KCQl9DQoNCgkJZG9qby5taXhpbihkZWwsIHsNCgkJCWFkZDogZnVuY3Rpb24oLypET01Ob2RlKi8gbm9kZSwgLypTdHJpbmcqLyBldmVudCwgLypGdW5jdGlvbiovIGZwKXsNCgkJCQlpZighbm9kZSl7cmV0dXJuO30gLy8gdW5kZWZpbmVkDQoJCQkJZXZlbnQgPSBkZWwuX25vcm1hbGl6ZUV2ZW50TmFtZShldmVudCk7DQoJCQkJaWYoZXZlbnQ9PSJvbmtleXByZXNzIil7DQoJCQkJCS8vIHdlIG5lZWQgdG8gbGlzdGVuIHRvIG9ua2V5ZG93biB0byBzeW50aGVzaXplDQoJCQkJCS8vIGtleXByZXNzIGV2ZW50cyB0aGF0IG90aGVyd2lzZSB3b24ndCBmaXJlDQoJCQkJCS8vIG9uIElFDQoJCQkJCXZhciBrZCA9IG5vZGUub25rZXlkb3duOw0KCQkJCQlpZigha2QgfHwgIWtkW2xpc3RlbmVyc05hbWVdIHx8ICFrZC5fc3RlYWx0aEtleWRvd25IYW5kbGUpew0KCQkJCQkJdmFyIGggPSBkZWwuYWRkKG5vZGUsICJvbmtleWRvd24iLCBkZWwuX3N0ZWFsdGhLZXlEb3duKTsNCgkJCQkJCWtkID0gbm9kZS5vbmtleWRvd247DQoJCQkJCQlrZC5fc3RlYWx0aEtleWRvd25IYW5kbGUgPSBoOw0KCQkJCQkJa2QuX3N0ZWFsdGhLZXlkb3duUmVmcyA9IDE7DQoJCQkJCX1lbHNlew0KCQkJCQkJa2QuX3N0ZWFsdGhLZXlkb3duUmVmcysrOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiBpZWwuYWRkKG5vZGUsIGV2ZW50LCBkZWwuX2ZpeENhbGxiYWNrKGZwKSk7DQoJCQl9LA0KCQkJcmVtb3ZlOiBmdW5jdGlvbigvKkRPTU5vZGUqLyBub2RlLCAvKlN0cmluZyovIGV2ZW50LCAvKkhhbmRsZSovIGhhbmRsZSl7DQoJCQkJZXZlbnQgPSBkZWwuX25vcm1hbGl6ZUV2ZW50TmFtZShldmVudCk7DQoJCQkJaWVsLnJlbW92ZShub2RlLCBldmVudCwgaGFuZGxlKTsgDQoJCQkJaWYoZXZlbnQ9PSJvbmtleXByZXNzIil7DQoJCQkJCXZhciBrZCA9IG5vZGUub25rZXlkb3duOw0KCQkJCQlpZigtLWtkLl9zdGVhbHRoS2V5ZG93blJlZnMgPD0gMCl7DQoJCQkJCQlpZWwucmVtb3ZlKG5vZGUsICJvbmtleWRvd24iLCBrZC5fc3RlYWx0aEtleWRvd25IYW5kbGUpOw0KCQkJCQkJZGVsZXRlIGtkLl9zdGVhbHRoS2V5ZG93bkhhbmRsZTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0sDQoJCQlfbm9ybWFsaXplRXZlbnROYW1lOiBmdW5jdGlvbigvKlN0cmluZyovIGV2ZW50TmFtZSl7DQoJCQkJLy8gR2VuZXJhbGx5LCBldmVudE5hbWUgc2hvdWxkIGJlIGxvd2VyIGNhc2UsIHVubGVzcyBpdCBpcw0KCQkJCS8vIHNwZWNpYWwgc29tZWhvdyAoZS5nLiBhIE1vemlsbGEgZXZlbnQpDQoJCQkJLy8gZW5zdXJlICdvbicNCgkJCQlyZXR1cm4gZXZlbnROYW1lLnNsaWNlKDAsMikgIT0gIm9uIiA/ICJvbiIgKyBldmVudE5hbWUgOiBldmVudE5hbWU7DQoJCQl9LA0KCQkJX25vcDogZnVuY3Rpb24oKXt9LA0KCQkJX2ZpeEV2ZW50OiBmdW5jdGlvbigvKkV2ZW50Ki8gZXZ0LCAvKkRPTU5vZGUqLyBzZW5kZXIpew0KCQkJCS8vIHN1bW1hcnk6DQoJCQkJLy8JCW5vcm1hbGl6ZXMgcHJvcGVydGllcyBvbiB0aGUgZXZlbnQgb2JqZWN0IGluY2x1ZGluZyBldmVudA0KCQkJCS8vCQlidWJibGluZyBtZXRob2RzLCBrZXlzdHJva2Ugbm9ybWFsaXphdGlvbiwgYW5kIHgveSBwb3NpdGlvbnMNCgkJCQkvLyBldnQ6DQoJCQkJLy8JCW5hdGl2ZSBldmVudCBvYmplY3QNCgkJCQkvLyBzZW5kZXI6DQoJCQkJLy8JCW5vZGUgdG8gdHJlYXQgYXMgImN1cnJlbnRUYXJnZXQiDQoJCQkJaWYoIWV2dCl7DQoJCQkJCXZhciB3ID0gc2VuZGVyICYmIChzZW5kZXIub3duZXJEb2N1bWVudCB8fCBzZW5kZXIuZG9jdW1lbnQgfHwgc2VuZGVyKS5wYXJlbnRXaW5kb3cgfHwgd2luZG93Ow0KCQkJCQlldnQgPSB3LmV2ZW50OyANCgkJCQl9DQoJCQkJaWYoIWV2dCl7cmV0dXJuKGV2dCk7fQ0KCQkJCWV2dC50YXJnZXQgPSBldnQuc3JjRWxlbWVudDsgDQoJCQkJZXZ0LmN1cnJlbnRUYXJnZXQgPSAoc2VuZGVyIHx8IGV2dC5zcmNFbGVtZW50KTsgDQoJCQkJZXZ0LmxheWVyWCA9IGV2dC5vZmZzZXRYOw0KCQkJCWV2dC5sYXllclkgPSBldnQub2Zmc2V0WTsNCgkJCQkvLyBGSVhNRTogc2Nyb2xsIHBvc2l0aW9uIHF1ZXJ5IGlzIGR1cGVkIGZyb20gZG9qby5odG1sIHRvDQoJCQkJLy8gYXZvaWQgZGVwZW5kZW5jeSBvbiB0aGF0IGVudGlyZSBtb2R1bGUuIE5vdyB0aGF0IEhUTUwgaXMgaW4NCgkJCQkvLyBCYXNlLCB3ZSBzaG91bGQgY29udmVydCBiYWNrIHRvIHNvbWV0aGluZyBzaW1pbGFyIHRoZXJlLg0KCQkJCXZhciBzZSA9IGV2dC5zcmNFbGVtZW50LCBkb2MgPSAoc2UgJiYgc2Uub3duZXJEb2N1bWVudCkgfHwgZG9jdW1lbnQ7DQoJCQkJLy8gRE8gTk9UIHJlcGxhY2UgdGhlIGZvbGxvd2luZyB0byB1c2UgZG9qby5ib2R5KCksIGluIElFLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgc2hvdWxkIGJlIHVzZWQNCgkJCQkvLyBoZXJlIHJhdGhlciB0aGFuIGRvY3VtZW50LmJvZHkNCgkJCQl2YXIgZG9jQm9keSA9ICgoZG9qby5pc0lFIDwgNikgfHwgKGRvY1siY29tcGF0TW9kZSJdID09ICJCYWNrQ29tcGF0IikpID8gZG9jLmJvZHkgOiBkb2MuZG9jdW1lbnRFbGVtZW50Ow0KCQkJCXZhciBvZmZzZXQgPSBkb2pvLl9nZXRJZURvY3VtZW50RWxlbWVudE9mZnNldCgpOw0KCQkJCWV2dC5wYWdlWCA9IGV2dC5jbGllbnRYICsgZG9qby5fZml4SWVCaURpU2Nyb2xsTGVmdChkb2NCb2R5LnNjcm9sbExlZnQgfHwgMCkgLSBvZmZzZXQueDsNCgkJCQlldnQucGFnZVkgPSBldnQuY2xpZW50WSArIChkb2NCb2R5LnNjcm9sbFRvcCB8fCAwKSAtIG9mZnNldC55Ow0KCQkJCWlmKGV2dC50eXBlID09ICJtb3VzZW92ZXIiKXsgDQoJCQkJCWV2dC5yZWxhdGVkVGFyZ2V0ID0gZXZ0LmZyb21FbGVtZW50Ow0KCQkJCX0NCgkJCQlpZihldnQudHlwZSA9PSAibW91c2VvdXQiKXsgDQoJCQkJCWV2dC5yZWxhdGVkVGFyZ2V0ID0gZXZ0LnRvRWxlbWVudDsNCgkJCQl9DQoJCQkJZXZ0LnN0b3BQcm9wYWdhdGlvbiA9IGRlbC5fc3RvcFByb3BhZ2F0aW9uOw0KCQkJCWV2dC5wcmV2ZW50RGVmYXVsdCA9IGRlbC5fcHJldmVudERlZmF1bHQ7DQoJCQkJcmV0dXJuIGRlbC5fZml4S2V5cyhldnQpOw0KCQkJfSwNCgkJCV9maXhLZXlzOiBmdW5jdGlvbihldnQpew0KCQkJCXN3aXRjaChldnQudHlwZSl7DQoJCQkJCWNhc2UgImtleXByZXNzIjoNCgkJCQkJCXZhciBjID0gKCJjaGFyQ29kZSIgaW4gZXZ0ID8gZXZ0LmNoYXJDb2RlIDogZXZ0LmtleUNvZGUpOw0KCQkJCQkJaWYgKGM9PTEwKXsNCgkJCQkJCQkvLyBDVFJMLUVOVEVSIGlzIENUUkwtQVNDSUkoMTApIG9uIElFLCBidXQgQ1RSTC1FTlRFUiBvbiBNb3ppbGxhDQoJCQkJCQkJYz0wOw0KCQkJCQkJCWV2dC5rZXlDb2RlID0gMTM7DQoJCQkJCQl9ZWxzZSBpZihjPT0xM3x8Yz09Mjcpew0KCQkJCQkJCWM9MDsgLy8gTW96aWxsYSBjb25zaWRlcnMgRU5URVIgYW5kIEVTQyBub24tcHJpbnRhYmxlDQoJCQkJCQl9ZWxzZSBpZihjPT0zKXsNCgkJCQkJCQljPTk5OyAvLyBNb3ppbGxhIG1hcHMgQ1RSTC1CUkVBSyB0byBDVFJMLWMNCgkJCQkJCX0NCgkJCQkJCS8vIE1vemlsbGEgc2V0cyBrZXlDb2RlIHRvIDAgd2hlbiB0aGVyZSBpcyBhIGNoYXJDb2RlDQoJCQkJCQkvLyBidXQgdGhhdCBzdG9wcyB0aGUgZXZlbnQgb24gSUUuDQoJCQkJCQlldnQuY2hhckNvZGUgPSBjOw0KCQkJCQkJZGVsLl9zZXRLZXlDaGFyKGV2dCk7DQoJCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJcmV0dXJuIGV2dDsNCgkJCX0sDQoJCQlfc3RlYWx0aEtleURvd246IGZ1bmN0aW9uKGV2dCl7DQoJCQkJLy8gSUUgZG9lc24ndCBmaXJlIGtleXByZXNzIGZvciBtb3N0IG5vbi1wcmludGFibGUgY2hhcmFjdGVycy4NCgkJCQkvLyBvdGhlciBicm93c2VycyBkbywgd2Ugc2ltdWxhdGUgaXQgaGVyZS4NCgkJCQl2YXIga3AgPSBldnQuY3VycmVudFRhcmdldC5vbmtleXByZXNzOw0KCQkJCS8vIG9ubHkgd29ya3MgaWYga3AgZXhpc3RzIGFuZCBpcyBhIGRpc3BhdGNoZXINCgkJCQlpZigha3AgfHwgIWtwW2xpc3RlbmVyc05hbWVdKXsgcmV0dXJuOyB9DQoJCQkJLy8gbXVuZ2Uga2V5L2NoYXJDb2RlDQoJCQkJdmFyIGs9ZXZ0LmtleUNvZGU7DQoJCQkJLy8gVGhlc2UgYXJlIFdpbmRvd3MgVmlydHVhbCBLZXkgQ29kZXMNCgkJCQkvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2xpYnJhcnkvZGVmYXVsdC5hc3A/dXJsPS9saWJyYXJ5L2VuLXVzL3dpbnVpL1dpblVJL1dpbmRvd3NVc2VySW50ZXJmYWNlL1VzZXJJbnB1dC9WaXJ0dWFsS2V5Q29kZXMuYXNwDQoJCQkJdmFyIHVucHJpbnRhYmxlID0gayE9MTMgJiYgayE9MzIgJiYgayE9MjcgJiYgKGs8NDh8fGs+OTApICYmIChrPDk2fHxrPjExMSkgJiYgKGs8MTg2fHxrPjE5MikgJiYgKGs8MjE5fHxrPjIyMik7DQoJCQkJLy8gc3ludGhlc2l6ZSBrZXlwcmVzcyBmb3IgbW9zdCB1bnByaW50YWJsZXMgYW5kIENUUkwta2V5cw0KCQkJCWlmKHVucHJpbnRhYmxlfHxldnQuY3RybEtleSl7DQoJCQkJCXZhciBjID0gdW5wcmludGFibGUgPyAwIDogazsNCgkJCQkJaWYoZXZ0LmN0cmxLZXkpew0KCQkJCQkJaWYoaz09MyB8fCBrPT0xMyl7DQoJCQkJCQkJcmV0dXJuOyAvLyBJRSB3aWxsIHBvc3QgQ1RSTC1CUkVBSywgQ1RSTC1FTlRFUiBhcyBrZXlwcmVzcyBuYXRpdmVseSANCgkJCQkJCX1lbHNlIGlmKGM+OTUgJiYgYzwxMDYpeyANCgkJCQkJCQljIC09IDQ4OyAvLyBtYXAgQ1RSTC1bbnVtcGFkIDAtOV0gdG8gQVNDSUkNCgkJCQkJCX1lbHNlIGlmKCghZXZ0LnNoaWZ0S2V5KSYmKGM+PTY1JiZjPD05MCkpeyANCgkJCQkJCQljICs9IDMyOyAvLyBtYXAgQ1RSTC1bQS1aXSB0byBsb3dlcmNhc2UNCgkJCQkJCX1lbHNleyANCgkJCQkJCQljID0gZGVsLl9wdW5jdE1hcFtjXSB8fCBjOyAvLyBtYXAgb3RoZXIgcHJvYmxlbWF0aWMgQ1RSTCBjb21iaW5hdGlvbnMgdG8gQVNDSUkNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkvLyBzaW11bGF0ZSBhIGtleXByZXNzIGV2ZW50DQoJCQkJCXZhciBmYXV4ID0gZGVsLl9zeW50aGVzaXplRXZlbnQoZXZ0LCB7dHlwZTogJ2tleXByZXNzJywgZmF1eDogdHJ1ZSwgY2hhckNvZGU6IGN9KTsNCgkJCQkJa3AuY2FsbChldnQuY3VycmVudFRhcmdldCwgZmF1eCk7DQoJCQkJCWV2dC5jYW5jZWxCdWJibGUgPSBmYXV4LmNhbmNlbEJ1YmJsZTsNCgkJCQkJZXZ0LnJldHVyblZhbHVlID0gZmF1eC5yZXR1cm5WYWx1ZTsNCgkJCQkJX3RyeVNldEtleUNvZGUoZXZ0LCBmYXV4LmtleUNvZGUpOw0KCQkJCX0NCgkJCX0sDQoJCQkvLyBDYWxsZWQgaW4gRXZlbnQgc2NvcGUNCgkJCV9zdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uKCl7DQoJCQkJdGhpcy5jYW5jZWxCdWJibGUgPSB0cnVlOyANCgkJCX0sDQoJCQlfcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCl7DQoJCQkJLy8gU2V0dGluZyBrZXlDb2RlIHRvIDAgaXMgdGhlIG9ubHkgd2F5IHRvIHByZXZlbnQgY2VydGFpbiBrZXlwcmVzc2VzIChuYW1lbHkNCgkJCQkvLyBjdHJsLWNvbWJpbmF0aW9ucyB0aGF0IGNvcnJlc3BvbmQgdG8gbWVudSBhY2NlbGVyYXRvciBrZXlzKS4NCgkJCQkvLyBPdG9oLCBpdCBwcmV2ZW50cyB1cHN0cmVhbSBsaXN0ZW5lcnMgZnJvbSBnZXR0aW5nIHRoaXMgaW5mb3JtYXRpb24NCgkJCQkvLyBUcnkgdG8gc3BsaXQgdGhlIGRpZmZlcmVuY2UgaGVyZSBieSBjbG9iYmVyaW5nIGtleUNvZGUgb25seSBmb3IgY3RybCANCgkJCQkvLyBjb21iaW5hdGlvbnMuIElmIHlvdSBzdGlsbCBuZWVkIHRvIGFjY2VzcyB0aGUga2V5IHVwc3RyZWFtLCBidWJibGVkS2V5Q29kZSBpcw0KCQkJCS8vIHByb3ZpZGVkIGFzIGEgd29ya2Fyb3VuZC4NCgkJCQl0aGlzLmJ1YmJsZWRLZXlDb2RlID0gdGhpcy5rZXlDb2RlOw0KCQkJCWlmKHRoaXMuY3RybEtleSl7X3RyeVNldEtleUNvZGUodGhpcywgMCk7fQ0KCQkJCXRoaXMucmV0dXJuVmFsdWUgPSBmYWxzZTsNCgkJCX0NCgkJfSk7DQoJCQkJDQoJCS8vIG92ZXJyaWRlIHN0b3BFdmVudCBmb3IgSUUNCgkJZG9qby5zdG9wRXZlbnQgPSBmdW5jdGlvbihldnQpew0KCQkJZXZ0ID0gZXZ0IHx8IHdpbmRvdy5ldmVudDsNCgkJCWRlbC5fc3RvcFByb3BhZ2F0aW9uLmNhbGwoZXZ0KTsNCgkJCWRlbC5fcHJldmVudERlZmF1bHQuY2FsbChldnQpOw0KCQl9DQoJfQ0KCQ0KCWRlbC5fc3ludGhlc2l6ZUV2ZW50ID0gZnVuY3Rpb24oZXZ0LCBwcm9wcyl7DQoJCQl2YXIgZmF1eCA9IGRvam8ubWl4aW4oe30sIGV2dCwgcHJvcHMpOw0KCQkJZGVsLl9zZXRLZXlDaGFyKGZhdXgpOw0KCQkJLy8gRklYTUU6IHdvdWxkIHByZWZlciB0byB1c2UgZG9qby5oaXRjaDogZG9qby5oaXRjaChldnQsIGV2dC5wcmV2ZW50RGVmYXVsdCk7IA0KCQkJLy8gYnV0IGl0IHRocm93cyBhbiBlcnJvciB3aGVuIHByZXZlbnREZWZhdWx0IGlzIGludm9rZWQgb24gU2FmYXJpDQoJCQkvLyBkb2VzIEV2ZW50LnByZXZlbnREZWZhdWx0IG5vdCBzdXBwb3J0ICJhcHBseSIgb24gU2FmYXJpPw0KCQkJZmF1eC5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKCl7IGV2dC5wcmV2ZW50RGVmYXVsdCgpOyB9OyANCgkJCWZhdXguc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oKXsgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOyB9OyANCgkJCXJldHVybiBmYXV4Ow0KCX0NCgkNCgkJLy8gT3BlcmEgZXZlbnQgbm9ybWFsaXphdGlvbg0KCWlmKGRvam8uaXNPcGVyYSl7DQoJCWRvam8ubWl4aW4oZGVsLCB7DQoJCQlfZml4RXZlbnQ6IGZ1bmN0aW9uKGV2dCwgc2VuZGVyKXsNCgkJCQlzd2l0Y2goZXZ0LnR5cGUpew0KCQkJCQljYXNlICJrZXlwcmVzcyI6DQoJCQkJCQl2YXIgYyA9IGV2dC53aGljaDsNCgkJCQkJCWlmKGM9PTMpew0KCQkJCQkJCWM9OTk7IC8vIE1vemlsbGEgbWFwcyBDVFJMLUJSRUFLIHRvIENUUkwtYw0KCQkJCQkJfQ0KCQkJCQkJLy8gY2FuJ3QgdHJhcCBzb21lIGtleXMgYXQgYWxsLCBsaWtlIElOU0VSVCBhbmQgREVMRVRFDQoJCQkJCQkvLyB0aGVyZSBpcyBubyBkaWZmZXJlbnRpYXRpbmcgaW5mbyBiZXR3ZWVuIERFTEVURSBhbmQgIi4iLCBvciBJTlNFUlQgYW5kICItIg0KCQkJCQkJYyA9IGM8NDEgJiYgIWV2dC5zaGlmdEtleSA/IDAgOiBjOw0KCQkJCQkJaWYoZXZ0LmN0cmxLZXkgJiYgIWV2dC5zaGlmdEtleSAmJiBjPj02NSAmJiBjPD05MCl7DQoJCQkJCQkJLy8gbG93ZXJjYXNlIENUUkwtW0EtWl0ga2V5cw0KCQkJCQkJCWMgKz0gMzI7DQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4gZGVsLl9zeW50aGVzaXplRXZlbnQoZXZ0LCB7IGNoYXJDb2RlOiBjIH0pOw0KCQkJCX0NCgkJCQlyZXR1cm4gZXZ0Ow0KCQkJfQ0KCQl9KTsNCgl9DQoJDQoJCS8vIFdlYmtpdCBldmVudCBub3JtYWxpemF0aW9uDQoJaWYoZG9qby5pc1dlYktpdCl7DQoJCQkJZGVsLl9hZGQgPSBkZWwuYWRkOw0KCQlkZWwuX3JlbW92ZSA9IGRlbC5yZW1vdmU7DQoNCgkJZG9qby5taXhpbihkZWwsIHsNCgkJCWFkZDogZnVuY3Rpb24oLypET01Ob2RlKi8gbm9kZSwgLypTdHJpbmcqLyBldmVudCwgLypGdW5jdGlvbiovIGZwKXsNCgkJCQlpZighbm9kZSl7cmV0dXJuO30gLy8gdW5kZWZpbmVkDQoJCQkJdmFyIGhhbmRsZSA9IGRlbC5fYWRkKG5vZGUsIGV2ZW50LCBmcCk7DQoJCQkJaWYoZGVsLl9ub3JtYWxpemVFdmVudE5hbWUoZXZlbnQpID09ICJrZXlwcmVzcyIpew0KCQkJCQkvLyB3ZSBuZWVkIHRvIGxpc3RlbiB0byBvbmtleWRvd24gdG8gc3ludGhlc2l6ZQ0KCQkJCQkvLyBrZXlwcmVzcyBldmVudHMgdGhhdCBvdGhlcndpc2Ugd29uJ3QgZmlyZQ0KCQkJCQkvLyBpbiBTYWZhcmkgMy4xKzogaHR0cHM6Ly9saXN0cy53ZWJraXQub3JnL3BpcGVybWFpbC93ZWJraXQtZGV2LzIwMDctRGVjZW1iZXIvMDAyOTkyLmh0bWwNCgkJCQkJaGFuZGxlLl9zdGVhbHRoS2V5RG93bkhhbmRsZSA9IGRlbC5fYWRkKG5vZGUsICJrZXlkb3duIiwgZnVuY3Rpb24oZXZ0KXsNCgkJCQkJCS8vQSB2YXJpYXRpb24gb24gdGhlIElFIF9zdGVhbHRoS2V5ZG93biBmdW5jdGlvbg0KCQkJCQkJLy9TeW50aGVzaXplIGFuIG9ua2V5cHJlc3MgZXZlbnQsIGJ1dCBvbmx5IGZvciB1bnByaW50YWJsZSBjaGFyYWN0ZXJzLg0KCQkJCQkJdmFyIGs9ZXZ0LmtleUNvZGU7DQoJCQkJCQkvLyBUaGVzZSBhcmUgV2luZG93cyBWaXJ0dWFsIEtleSBDb2Rlcw0KCQkJCQkJLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9saWJyYXJ5L2RlZmF1bHQuYXNwP3VybD0vbGlicmFyeS9lbi11cy93aW51aS9XaW5VSS9XaW5kb3dzVXNlckludGVyZmFjZS9Vc2VySW5wdXQvVmlydHVhbEtleUNvZGVzLmFzcA0KCQkJCQkJdmFyIHVucHJpbnRhYmxlID0gayE9MTMgJiYgayE9MzIgJiYgKGs8NDggfHwgaz45MCkgJiYgKGs8OTYgfHwgaz4xMTEpICYmIChrPDE4NiB8fCBrPjE5MikgJiYgKGs8MjE5IHx8IGs+MjIyKTsNCgkJCQkJCS8vIHN5bnRoZXNpemUga2V5cHJlc3MgZm9yIG1vc3QgdW5wcmludGFibGVzIGFuZCBDVFJMLWtleXMNCgkJCQkJCWlmKHVucHJpbnRhYmxlIHx8IGV2dC5jdHJsS2V5KXsNCgkJCQkJCQl2YXIgYyA9IHVucHJpbnRhYmxlID8gMCA6IGs7DQoJCQkJCQkJaWYoZXZ0LmN0cmxLZXkpew0KCQkJCQkJCQlpZihrPT0zIHx8IGs9PTEzKXsNCgkJCQkJCQkJCXJldHVybjsgLy8gSUUgd2lsbCBwb3N0IENUUkwtQlJFQUssIENUUkwtRU5URVIgYXMga2V5cHJlc3MgbmF0aXZlbHkgDQoJCQkJCQkJCX1lbHNlIGlmKGM+OTUgJiYgYzwxMDYpeyANCgkJCQkJCQkJCWMgLT0gNDg7IC8vIG1hcCBDVFJMLVtudW1wYWQgMC05XSB0byBBU0NJSQ0KCQkJCQkJCQl9ZWxzZSBpZighZXZ0LnNoaWZ0S2V5ICYmIGM+PTY1ICYmIGM8PTkwKXsgDQoJCQkJCQkJCQljICs9IDMyOyAvLyBtYXAgQ1RSTC1bQS1aXSB0byBsb3dlcmNhc2UNCgkJCQkJCQkJfWVsc2V7IA0KCQkJCQkJCQkJYyA9IGRlbC5fcHVuY3RNYXBbY10gfHwgYzsgLy8gbWFwIG90aGVyIHByb2JsZW1hdGljIENUUkwgY29tYmluYXRpb25zIHRvIEFTQ0lJDQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQkJLy8gc2ltdWxhdGUgYSBrZXlwcmVzcyBldmVudA0KCQkJCQkJCXZhciBmYXV4ID0gZGVsLl9zeW50aGVzaXplRXZlbnQoZXZ0LCB7dHlwZTogJ2tleXByZXNzJywgZmF1eDogdHJ1ZSwgY2hhckNvZGU6IGN9KTsNCgkJCQkJCQlmcC5jYWxsKGV2dC5jdXJyZW50VGFyZ2V0LCBmYXV4KTsNCgkJCQkJCX0NCgkJCQkJfSk7DQoJCQkJfQ0KCQkJCXJldHVybiBoYW5kbGU7IC8qSGFuZGxlKi8NCgkJCX0sDQoNCgkJCXJlbW92ZTogZnVuY3Rpb24oLypET01Ob2RlKi8gbm9kZSwgLypTdHJpbmcqLyBldmVudCwgLypIYW5kbGUqLyBoYW5kbGUpew0KCQkJCWlmKG5vZGUpew0KCQkJCQlpZihoYW5kbGUuX3N0ZWFsdGhLZXlEb3duSGFuZGxlKXsNCgkJCQkJCWRlbC5fcmVtb3ZlKG5vZGUsICJrZXlkb3duIiwgaGFuZGxlLl9zdGVhbHRoS2V5RG93bkhhbmRsZSk7DQoJCQkJCX0NCgkJCQkJZGVsLl9yZW1vdmUobm9kZSwgZXZlbnQsIGhhbmRsZSk7DQoJCQkJfQ0KCQkJfSwNCgkJCV9maXhFdmVudDogZnVuY3Rpb24oZXZ0LCBzZW5kZXIpew0KCQkJCXN3aXRjaChldnQudHlwZSl7DQoJCQkJCWNhc2UgImtleXByZXNzIjoNCgkJCQkJCWlmKGV2dC5mYXV4KXsgcmV0dXJuIGV2dDsgfQ0KCQkJCQkJdmFyIGMgPSBldnQuY2hhckNvZGU7DQoJCQkJCQljID0gYz49MzIgPyBjIDogMDsNCgkJCQkJCXJldHVybiBkZWwuX3N5bnRoZXNpemVFdmVudChldnQsIHtjaGFyQ29kZTogYywgZmF1eDogdHJ1ZX0pOw0KCQkJCX0NCgkJCQlyZXR1cm4gZXZ0Ow0KCQkJfQ0KCQl9KTsNCgkJfQ0KCX0pKCk7DQoNCmlmKGRvam8uaXNJRSl7DQoJLy8ga2VlcCB0aGlzIG91dCBvZiB0aGUgY2xvc3VyZQ0KCS8vIGNsb3Npbmcgb3ZlciAnaWVsJyBvciAnaWVoJyBiMHJrcyBsZWFrIHByZXZlbnRpb24NCgkvLyBsc1tpXSBpcyBhbiBpbmRleCBpbnRvIHRoZSBtYXN0ZXIgaGFuZGxlciBhcnJheQ0KCWRvam8uX2llRGlzcGF0Y2hlciA9IGZ1bmN0aW9uKGFyZ3MsIHNlbmRlcil7DQoJCXZhciBhcCA9IEFycmF5LnByb3RvdHlwZSwNCgkJCWggPSBkb2pvLl9pZV9saXN0ZW5lci5oYW5kbGVycywNCgkJCWMgPSBhcmdzLmNhbGxlZSwNCgkJCWxzID0gY1tkb2pvLl9pZUxpc3RlbmVyc05hbWVdLA0KCQkJdCA9IGhbYy50YXJnZXRdOw0KCQkvLyByZXR1cm4gdmFsdWUgY29tZXMgZnJvbSBvcmlnaW5hbCB0YXJnZXQgZnVuY3Rpb24NCgkJdmFyIHIgPSB0ICYmIHQuYXBwbHkoc2VuZGVyLCBhcmdzKTsNCgkJLy8gbWFrZSBsb2NhbCBjb3B5IG9mIGxpc3RlbmVyIGFycmF5IHNvIGl0J3MgaW1tdXRhYmxlIGR1cmluZyBwcm9jZXNzaW5nDQoJCXZhciBsbHMgPSBbXS5jb25jYXQobHMpOw0KCQkvLyBpbnZva2UgbGlzdGVuZXJzIGFmdGVyIHRhcmdldCBmdW5jdGlvbg0KCQlmb3IodmFyIGkgaW4gbGxzKXsNCgkJCXZhciBmID0gaFtsbHNbaV1dOw0KCQkJaWYoIShpIGluIGFwKSAmJiBmKXsNCgkJCQlmLmFwcGx5KHNlbmRlciwgYXJncyk7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHI7DQoJfQ0KCWRvam8uX2dldEllRGlzcGF0Y2hlciA9IGZ1bmN0aW9uKCl7DQoJCS8vIGVuc3VyZSB0aGUgcmV0dXJuZWQgZnVuY3Rpb24gY2xvc2VzIG92ZXIgbm90aGluZyAoIm5ldyBGdW5jdGlvbiIgYXBwYXJlbnRseSBkb2Vzbid0IGNsb3NlKQ0KCQlyZXR1cm4gbmV3IEZ1bmN0aW9uKGRvam8uX3Njb3BlTmFtZSArICIuX2llRGlzcGF0Y2hlcihhcmd1bWVudHMsIHRoaXMpIik7IC8vIGZ1bmN0aW9uDQoJfQ0KCS8vIGtlZXAgdGhpcyBvdXQgb2YgdGhlIGNsb3N1cmUgdG8gcmVkdWNlIFJBTSBhbGxvY2F0aW9uDQoJZG9qby5fZXZlbnRfbGlzdGVuZXIuX2ZpeENhbGxiYWNrID0gZnVuY3Rpb24oZnApew0KCQl2YXIgZiA9IGRvam8uX2V2ZW50X2xpc3RlbmVyLl9maXhFdmVudDsNCgkJcmV0dXJuIGZ1bmN0aW9uKGUpeyByZXR1cm4gZnAuY2FsbCh0aGlzLCBmKGUsIHRoaXMpKTsgfTsNCgl9DQp9DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmh0bWwiXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuaHRtbCJdID0gdHJ1ZTsNCg0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmh0bWwiKTsNCg0KLy8gRklYTUU6IG5lZWQgdG8gYWRkIHVuaXQgdGVzdHMgZm9yIGFsbCB0aGUgc2VtaS1wdWJsaWMgbWV0aG9kcw0KDQp0cnl7DQoJZG9jdW1lbnQuZXhlY0NvbW1hbmQoIkJhY2tncm91bmRJbWFnZUNhY2hlIiwgZmFsc2UsIHRydWUpOw0KfWNhdGNoKGUpew0KCS8vIHNhbmUgYnJvd3NlcnMgZG9uJ3QgaGF2ZSBjYWNoZSAiaXNzdWVzIg0KfQ0KDQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLy8gRE9NIEZ1bmN0aW9ucw0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KLyo9PT09PQ0KZG9qby5ieUlkID0gZnVuY3Rpb24oaWQsIGRvYyl7DQoJLy8Jc3VtbWFyeToNCgkvLwkJUmV0dXJucyBET00gbm9kZSB3aXRoIG1hdGNoaW5nIGBpZGAgYXR0cmlidXRlIG9yIGBudWxsYA0KCS8vCQlpZiBub3QgZm91bmQuIElmIGBpZGAgaXMgYSBEb21Ob2RlLCB0aGlzIGZ1bmN0aW9uIGlzIGEgbm8tb3AuDQoJLy8NCgkvLwlpZDogU3RyaW5nfERPTU5vZGUNCgkvLwkgCUEgc3RyaW5nIHRvIG1hdGNoIGFuIEhUTUwgaWQgYXR0cmlidXRlIG9yIGEgcmVmZXJlbmNlIHRvIGEgRE9NIE5vZGUNCgkvLw0KCS8vCWRvYzogRG9jdW1lbnQ/DQoJLy8JCURvY3VtZW50IHRvIHdvcmsgaW4uIERlZmF1bHRzIHRvIHRoZSBjdXJyZW50IHZhbHVlIG9mDQoJLy8JCWRvam8uZG9jLiAgQ2FuIGJlIHVzZWQgdG8gcmV0cmlldmUNCgkvLwkJbm9kZSByZWZlcmVuY2VzIGZyb20gb3RoZXIgZG9jdW1lbnRzLg0KCS8vDQoJLy8JZXhhbXBsZToNCgkvLwlMb29rIHVwIGEgbm9kZSBieSBJRDoNCgkvLwl8CXZhciBuID0gZG9qby5ieUlkKCJmb28iKTsNCgkvLw0KCS8vCWV4YW1wbGU6DQoJLy8JQ2hlY2sgaWYgYSBub2RlIGV4aXN0cywgYW5kIHVzZSBpdC4NCgkvLwl8CXZhciBuID0gZG9qby5ieUlkKCJiYXIiKTsNCgkvLwl8CWlmKG4peyBkb1N0dWZmKCkgLi4uIH0NCgkvLw0KCS8vCWV4YW1wbGU6DQoJLy8JQWxsb3cgc3RyaW5nIG9yIERvbU5vZGUgcmVmZXJlbmNlcyB0byBiZSBwYXNzZWQgdG8gYSBjdXN0b20gZnVuY3Rpb246DQoJLy8JfAl2YXIgZm9vID0gZnVuY3Rpb24obm9kZU9ySWQpew0KCS8vCXwJCW5vZGVPcklkID0gZG9qby5ieUlkKG5vZGVPcklkKTsNCgkvLwl8CQkvLyAuLi4gbW9yZSBzdHVmZg0KCS8vCXwJfQ0KPT09PT0qLw0KDQppZihkb2pvLmlzSUUgfHwgZG9qby5pc09wZXJhKXsNCglkb2pvLmJ5SWQgPSBmdW5jdGlvbihpZCwgZG9jKXsNCgkJaWYodHlwZW9mIGlkICE9ICJzdHJpbmciKXsNCgkJCXJldHVybiBpZDsNCgkJfQ0KCQl2YXIgX2QgPSBkb2MgfHwgZG9qby5kb2MsIHRlID0gX2QuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQkvLyBhdHRyaWJ1dGVzLmlkLnZhbHVlIGlzIGJldHRlciB0aGFuIGp1c3QgaWQgaW4gY2FzZSB0aGUgDQoJCS8vIHVzZXIgaGFzIGEgbmFtZT1pZCBpbnNpZGUgYSBmb3JtDQoJCWlmKHRlICYmICh0ZS5hdHRyaWJ1dGVzLmlkLnZhbHVlID09IGlkIHx8IHRlLmlkID09IGlkKSl7DQoJCQlyZXR1cm4gdGU7DQoJCX1lbHNlew0KCQkJdmFyIGVsZXMgPSBfZC5hbGxbaWRdOw0KCQkJaWYoIWVsZXMgfHwgZWxlcy5ub2RlTmFtZSl7DQoJCQkJZWxlcyA9IFtlbGVzXTsNCgkJCX0NCgkJCS8vIGlmIG1vcmUgdGhhbiAxLCBjaG9vc2UgZmlyc3Qgd2l0aCB0aGUgY29ycmVjdCBpZA0KCQkJdmFyIGk9MDsNCgkJCXdoaWxlKCh0ZT1lbGVzW2krK10pKXsNCgkJCQlpZigodGUuYXR0cmlidXRlcyAmJiB0ZS5hdHRyaWJ1dGVzLmlkICYmIHRlLmF0dHJpYnV0ZXMuaWQudmFsdWUgPT0gaWQpDQoJCQkJCXx8IHRlLmlkID09IGlkKXsNCgkJCQkJcmV0dXJuIHRlOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX07DQp9ZWxzZXsNCglkb2pvLmJ5SWQgPSBmdW5jdGlvbihpZCwgZG9jKXsNCgkJLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQlyZXR1cm4gKHR5cGVvZiBpZCA9PSAic3RyaW5nIikgPyAoZG9jIHx8IGRvam8uZG9jKS5nZXRFbGVtZW50QnlJZChpZCkgOiBpZDsgLy8gRG9tTm9kZQ0KCX07DQp9DQovKj09PT09DQp9Ow0KPT09PT0qLw0KDQooZnVuY3Rpb24oKXsNCgl2YXIgZCA9IGRvam87DQoJdmFyIGJ5SWQgPSBkLmJ5SWQ7DQoNCgl2YXIgX2Rlc3Ryb3lDb250YWluZXIgPSBudWxsLA0KCQlfZGVzdHJveURvYzsNCgkJZC5hZGRPbldpbmRvd1VubG9hZChmdW5jdGlvbigpew0KCQlfZGVzdHJveUNvbnRhaW5lciA9IG51bGw7IC8vcHJldmVudCBJRSBsZWFrDQoJfSk7DQoJDQovKj09PT09DQoJZG9qby5fZGVzdHJveUVsZW1lbnQgPSBmdW5jdGlvbihub2RlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8gCQlFeGlzdGluZyBhbGlhcyBmb3IgYGRvam8uZGVzdHJveWAuIERlcHJlY2F0ZWQsIHdpbGwgYmUgcmVtb3ZlZA0KCQkvLyAJCWluIDIuMA0KCX0NCj09PT09Ki8NCglkb2pvLl9kZXN0cm95RWxlbWVudCA9IGRvam8uZGVzdHJveSA9IGZ1bmN0aW9uKC8qU3RyaW5nfERvbU5vZGUqL25vZGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmVtb3ZlcyBhIG5vZGUgZnJvbSBpdHMgcGFyZW50LCBjbG9iYmVyaW5nIGl0IGFuZCBhbGwgb2YgaXRzDQoJCS8vCQljaGlsZHJlbi4NCgkJLy8NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlSZW1vdmVzIGEgbm9kZSBmcm9tIGl0cyBwYXJlbnQsIGNsb2JiZXJpbmcgaXQgYW5kIGFsbCBvZiBpdHMNCgkJLy8JCWNoaWxkcmVuLiBGdW5jdGlvbiBvbmx5IHdvcmtzIHdpdGggRG9tTm9kZXMsIGFuZCByZXR1cm5zIG5vdGhpbmcuDQoJCS8vDQoJCS8vCW5vZGU6DQoJCS8vCQlBIFN0cmluZyBJRCBvciBEb21Ob2RlIHJlZmVyZW5jZSBvZiB0aGUgZWxlbWVudCB0byBiZSBkZXN0cm95ZWQNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JRGVzdHJveSBhIG5vZGUgYnlJZDoNCgkJLy8JfAlkb2pvLmRlc3Ryb3koInNvbWVJZCIpOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlEZXN0cm95IGFsbCBub2RlcyBpbiBhIGxpc3QgYnkgcmVmZXJlbmNlOg0KCQkvLwl8CWRvam8ucXVlcnkoIi5zb21lTm9kZSIpLmZvckVhY2goZG9qby5kZXN0cm95KTsNCg0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJdHJ5ew0KCQkJdmFyIGRvYyA9IG5vZGUub3duZXJEb2N1bWVudDsNCgkJCS8vIGNhbm5vdCB1c2UgX2Rlc3Ryb3lDb250YWluZXIub3duZXJEb2N1bWVudCBzaW5jZSB0aGlzIGNhbiB0aHJvdyBhbiBleGNlcHRpb24gb24gSUUNCgkJCWlmKCFfZGVzdHJveUNvbnRhaW5lciB8fCBfZGVzdHJveURvYyAhPSBkb2Mpew0KCQkJCV9kZXN0cm95Q29udGFpbmVyID0gZG9jLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCV9kZXN0cm95RG9jID0gZG9jOw0KCQkJfQ0KCQkJX2Rlc3Ryb3lDb250YWluZXIuYXBwZW5kQ2hpbGQobm9kZS5wYXJlbnROb2RlID8gbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpIDogbm9kZSk7DQoJCQkvLyBOT1RFOiBzZWUgaHR0cDovL3RyYWMuZG9qb3Rvb2xraXQub3JnL3RpY2tldC8yOTMxLiBUaGlzIG1heSBiZSBhIGJ1ZyBhbmQgbm90IGEgZmVhdHVyZQ0KCQkJX2Rlc3Ryb3lDb250YWluZXIuaW5uZXJIVE1MID0gIiI7DQoJCX1jYXRjaChlKXsNCgkJCS8qIHNxdWVsY2ggKi8NCgkJfQ0KCX07DQoNCglkb2pvLmlzRGVzY2VuZGFudCA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qRG9tTm9kZXxTdHJpbmcqL2FuY2VzdG9yKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgdHJ1ZSBpZiBub2RlIGlzIGEgZGVzY2VuZGFudCBvZiBhbmNlc3Rvcg0KCQkvLwlub2RlOiBzdHJpbmcgaWQgb3Igbm9kZSByZWZlcmVuY2UgdG8gdGVzdA0KCQkvLwlhbmNlc3Rvcjogc3RyaW5nIGlkIG9yIG5vZGUgcmVmZXJlbmNlIG9mIHBvdGVudGlhbCBwYXJlbnQgdG8gdGVzdCBhZ2FpbnN0DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCVRlc3QgaXMgbm9kZSBpZD0iYmFyIiBpcyBhIGRlc2NlbmRhbnQgb2Ygbm9kZSBpZD0iZm9vIg0KCQkvLwl8CWlmKGRvam8uaXNEZXNjZW5kYW50KCJiYXIiLCAiZm9vIikpeyAuLi4gfQ0KCQl0cnl7DQoJCQlub2RlID0gYnlJZChub2RlKTsNCgkJCWFuY2VzdG9yID0gYnlJZChhbmNlc3Rvcik7DQoJCQl3aGlsZShub2RlKXsNCgkJCQlpZihub2RlID09IGFuY2VzdG9yKXsNCgkJCQkJcmV0dXJuIHRydWU7IC8vIEJvb2xlYW4NCgkJCQl9DQoJCQkJbm9kZSA9IG5vZGUucGFyZW50Tm9kZTsNCgkJCX0NCgkJfWNhdGNoKGUpeyAvKiBzcXVlbGNoLCByZXR1cm4gZmFsc2UgKi8gfQ0KCQlyZXR1cm4gZmFsc2U7IC8vIEJvb2xlYW4NCgl9Ow0KDQoJZG9qby5zZXRTZWxlY3RhYmxlID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypCb29sZWFuKi9zZWxlY3RhYmxlKXsNCgkJLy8Jc3VtbWFyeTogDQoJCS8vCQlFbmFibGUgb3IgZGlzYWJsZSBzZWxlY3Rpb24gb24gYSBub2RlDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gbm9kZQ0KCQkvLwlzZWxlY3RhYmxlOg0KCQkvLwkJc3RhdGUgdG8gcHV0IHRoZSBub2RlIGluLiBmYWxzZSBpbmRpY2F0ZXMgdW5zZWxlY3RhYmxlLCB0cnVlIA0KCQkvLwkJYWxsb3dzIHNlbGVjdGlvbi4NCgkJLy8JZXhhbXBsZToNCgkJLy8JTWFrZSB0aGUgbm9kZSBpZD0iYmFyIiB1bnNlbGVjdGFibGUNCgkJLy8JfAlkb2pvLnNldFNlbGVjdGFibGUoImJhciIpOyANCgkJLy8JZXhhbXBsZToNCgkJLy8JTWFrZSB0aGUgbm9kZSBpZD0iYmFyIiBzZWxlY3RhYmxlDQoJCS8vCXwJZG9qby5zZXRTZWxlY3RhYmxlKCJiYXIiLCB0cnVlKTsNCgkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCQkJaWYoZC5pc01vemlsbGEpew0KCQkJbm9kZS5zdHlsZS5Nb3pVc2VyU2VsZWN0ID0gc2VsZWN0YWJsZSA/ICIiIDogIm5vbmUiOw0KCQl9ZWxzZSBpZihkLmlzS2h0bWwgfHwgZC5pc1dlYktpdCl7DQoJCQkJCW5vZGUuc3R5bGUuS2h0bWxVc2VyU2VsZWN0ID0gc2VsZWN0YWJsZSA/ICJhdXRvIiA6ICJub25lIjsNCgkJCQl9ZWxzZSBpZihkLmlzSUUpew0KCQkJdmFyIHYgPSAobm9kZS51bnNlbGVjdGFibGUgPSBzZWxlY3RhYmxlID8gIiIgOiAib24iKTsNCgkJCWQucXVlcnkoIioiLCBub2RlKS5mb3JFYWNoKCJpdGVtLnVuc2VsZWN0YWJsZSA9ICciK3YrIiciKTsNCgkJfQ0KCQkJCS8vRklYTUU6IGVsc2U/ICBPcGVyYT8NCgl9Ow0KDQoJdmFyIF9pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIC8qRG9tTm9kZSovcmVmKXsNCgkJdmFyIHBhcmVudCA9IHJlZi5wYXJlbnROb2RlOw0KCQlpZihwYXJlbnQpew0KCQkJcGFyZW50Lmluc2VydEJlZm9yZShub2RlLCByZWYpOw0KCQl9DQoJfTsNCg0KCXZhciBfaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIC8qRG9tTm9kZSovcmVmKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVRyeSB0byBpbnNlcnQgbm9kZSBhZnRlciByZWYNCgkJdmFyIHBhcmVudCA9IHJlZi5wYXJlbnROb2RlOw0KCQlpZihwYXJlbnQpew0KCQkJaWYocGFyZW50Lmxhc3RDaGlsZCA9PSByZWYpew0KCQkJCXBhcmVudC5hcHBlbmRDaGlsZChub2RlKTsNCgkJCX1lbHNlew0KCQkJCXBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgcmVmLm5leHRTaWJsaW5nKTsNCgkJCX0NCgkJfQ0KCX07DQoNCglkb2pvLnBsYWNlID0gZnVuY3Rpb24obm9kZSwgcmVmTm9kZSwgcG9zaXRpb24pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQXR0ZW1wdCB0byBpbnNlcnQgbm9kZSBpbnRvIHRoZSBET00sIGNob29zaW5nIGZyb20gdmFyaW91cyBwb3NpdGlvbmluZyBvcHRpb25zLg0KCQkvLwkJUmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgcmVzb2x2ZWQgdG8gYSBET00gbm9kZS4NCgkJLy8NCgkJLy8Jbm9kZTogU3RyaW5nfERvbU5vZGUNCgkJLy8JCWlkIG9yIG5vZGUgcmVmZXJlbmNlLCBvciBIVE1MIGZyYWdtZW50IHN0YXJ0aW5nIHdpdGggIjwiIHRvIHBsYWNlIHJlbGF0aXZlIHRvIHJlZk5vZGUNCgkJLy8NCgkJLy8JcmVmTm9kZTogU3RyaW5nfERvbU5vZGUNCgkJLy8JCWlkIG9yIG5vZGUgcmVmZXJlbmNlIHRvIHVzZSBhcyBiYXNpcyBmb3IgcGxhY2VtZW50DQoJCS8vDQoJCS8vCXBvc2l0aW9uOiBTdHJpbmd8TnVtYmVyPw0KCQkvLwkJc3RyaW5nIG5vdGluZyB0aGUgcG9zaXRpb24gb2Ygbm9kZSByZWxhdGl2ZSB0byByZWZOb2RlIG9yIGENCgkJLy8JCW51bWJlciBpbmRpY2F0aW5nIHRoZSBsb2NhdGlvbiBpbiB0aGUgY2hpbGROb2RlcyBjb2xsZWN0aW9uIG9mIHJlZk5vZGUuDQoJCS8vCQlBY2NlcHRlZCBzdHJpbmcgdmFsdWVzIGFyZToNCgkJLy8JfAkqIGJlZm9yZQ0KCQkvLwl8CSogYWZ0ZXINCgkJLy8JfAkqIHJlcGxhY2UNCgkJLy8JfAkqIG9ubHkNCgkJLy8JfAkqIGZpcnN0DQoJCS8vCXwJKiBsYXN0DQoJCS8vCQkiZmlyc3QiIGFuZCAibGFzdCIgaW5kaWNhdGUgcG9zaXRpb25zIGFzIGNoaWxkcmVuIG9mIHJlZk5vZGUsICJyZXBsYWNlIiByZXBsYWNlcyByZWZOb2RlLA0KCQkvLwkJIm9ubHkiIHJlcGxhY2VzIGFsbCBjaGlsZHJlbi4gIHBvc2l0aW9uIGRlZmF1bHRzIHRvICJsYXN0IiBpZiBub3Qgc3BlY2lmaWVkDQoJCS8vDQoJCS8vCXJldHVybnM6IERvbU5vZGUNCgkJLy8JCVJldHVybmVkIHZhbHVlcyBpcyB0aGUgZmlyc3QgYXJndW1lbnQgcmVzb2x2ZWQgdG8gYSBET00gbm9kZS4NCgkJLy8NCgkJLy8JCS5wbGFjZSgpIGlzIGFsc28gYSBtZXRob2Qgb2YgYGRvam8uTm9kZUxpc3RgLCBhbGxvd2luZyBgZG9qby5xdWVyeWAgbm9kZSBsb29rdXBzLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJUGxhY2UgYSBub2RlIGJ5IHN0cmluZyBpZCBhcyB0aGUgbGFzdCBjaGlsZCBvZiBhbm90aGVyIG5vZGUgYnkgc3RyaW5nIGlkOg0KCQkvLwl8CWRvam8ucGxhY2UoInNvbWVOb2RlIiwgImFub3RoZXJOb2RlIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlQbGFjZSBhIG5vZGUgYnkgc3RyaW5nIGlkIGJlZm9yZSBhbm90aGVyIG5vZGUgYnkgc3RyaW5nIGlkDQoJCS8vCXwJZG9qby5wbGFjZSgic29tZU5vZGUiLCAiYW5vdGhlck5vZGUiLCAiYmVmb3JlIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlDcmVhdGUgYSBOb2RlLCBhbmQgcGxhY2UgaXQgaW4gdGhlIGJvZHkgZWxlbWVudCAobGFzdCBjaGlsZCk6DQoJCS8vCXwJZG9qby5wbGFjZSgiPGRpdj48L2Rpdj4iLCBkb2pvLmJvZHkoKSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlQdXQgYSBuZXcgTEkgYXMgdGhlIGZpcnN0IGNoaWxkIG9mIGEgbGlzdCBieSBpZDoNCgkJLy8JfAlkb2pvLnBsYWNlKCI8bGk+PC9saT4iLCAic29tZVVsIiwgImZpcnN0Iik7DQoNCgkJcmVmTm9kZSA9IGJ5SWQocmVmTm9kZSk7DQoJCWlmKHR5cGVvZiBub2RlID09ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJbm9kZSA9IG5vZGUuY2hhckF0KDApID09ICI8IiA/IGQuX3RvRG9tKG5vZGUsIHJlZk5vZGUub3duZXJEb2N1bWVudCkgOiBieUlkKG5vZGUpOw0KCQl9DQoJCWlmKHR5cGVvZiBwb3NpdGlvbiA9PSAibnVtYmVyIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCXZhciBjbiA9IHJlZk5vZGUuY2hpbGROb2RlczsNCgkJCWlmKCFjbi5sZW5ndGggfHwgY24ubGVuZ3RoIDw9IHBvc2l0aW9uKXsNCgkJCQlyZWZOb2RlLmFwcGVuZENoaWxkKG5vZGUpOw0KCQkJfWVsc2V7DQoJCQkJX2luc2VydEJlZm9yZShub2RlLCBjbltwb3NpdGlvbiA8IDAgPyAwIDogcG9zaXRpb25dKTsNCgkJCX0NCgkJfWVsc2V7DQoJCQlzd2l0Y2gocG9zaXRpb24pew0KCQkJCWNhc2UgImJlZm9yZSI6DQoJCQkJCV9pbnNlcnRCZWZvcmUobm9kZSwgcmVmTm9kZSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgImFmdGVyIjoNCgkJCQkJX2luc2VydEFmdGVyKG5vZGUsIHJlZk5vZGUpOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICJyZXBsYWNlIjoNCgkJCQkJcmVmTm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChub2RlLCByZWZOb2RlKTsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAib25seSI6DQoJCQkJCWQuZW1wdHkocmVmTm9kZSk7DQoJCQkJCXJlZk5vZGUuYXBwZW5kQ2hpbGQobm9kZSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgImZpcnN0IjoNCgkJCQkJaWYocmVmTm9kZS5maXJzdENoaWxkKXsNCgkJCQkJCV9pbnNlcnRCZWZvcmUobm9kZSwgcmVmTm9kZS5maXJzdENoaWxkKTsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJCS8vIGVsc2UgZmFsbHRocm91Z2guLi4NCgkJCQlkZWZhdWx0OiAvLyBha2E6IGxhc3QNCgkJCQkJcmVmTm9kZS5hcHBlbmRDaGlsZChub2RlKTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gbm9kZTsgLy8gRG9tTm9kZQ0KCX0NCg0KCS8vIEJveCBmdW5jdGlvbnMgd2lsbCBhc3N1bWUgdGhpcyBtb2RlbC4NCgkvLyBPbiBJRS9PcGVyYSwgQk9SREVSX0JPWCB3aWxsIGJlIHNldCBpZiB0aGUgcHJpbWFyeSBkb2N1bWVudCBpcyBpbiBxdWlya3MgbW9kZS4NCgkvLyBDYW4gYmUgc2V0IHRvIGNoYW5nZSBiZWhhdmlvciBvZiBib3ggc2V0dGVycy4NCg0KCS8vIGNhbiBiZSBlaXRoZXI6DQoJLy8JImJvcmRlci1ib3giDQoJLy8JImNvbnRlbnQtYm94IiAoZGVmYXVsdCkNCglkb2pvLmJveE1vZGVsID0gImNvbnRlbnQtYm94IjsNCg0KCS8vIFdlIHB1bnQgcGVyLW5vZGUgYm94IG1vZGUgdGVzdGluZyBjb21wbGV0ZWx5Lg0KCS8vIElmIGFueWJvZHkgY2FyZXMsIHdlIGNhbiBwcm92aWRlIGFuIGFkZGl0aW9uYWwgKG9wdGlvbmFsKSB1bml0IA0KCS8vIHRoYXQgb3ZlcnJpZGVzIGV4aXN0aW5nIGNvZGUgdG8gaW5jbHVkZSBwZXItbm9kZSBib3ggc2Vuc2l0aXZpdHkuDQoNCgkvLyBPcGVyYSBkb2N1bWVudGF0aW9uIGNsYWltcyB0aGF0IE9wZXJhIDkgdXNlcyBib3JkZXItYm94IGluIEJhY2tDb21wYXQgbW9kZS4NCgkvLyBidXQgZXhwZXJpbWVudHMgKE9wZXJhIDkuMTAuODY3OSBvbiBXaW5kb3dzIFZpc3RhKSBpbmRpY2F0ZSB0aGF0IGl0IGFjdHVhbGx5IGNvbnRpbnVlcyB0byB1c2UgY29udGVudC1ib3guDQoJLy8gSUlSQywgZWFybGllciB2ZXJzaW9ucyBvZiBPcGVyYSBkaWQgaW4gZmFjdCB1c2UgYm9yZGVyLWJveC4NCgkvLyBPcGVyYSBndXlzLCB0aGlzIGlzIHJlYWxseSBjb25mdXNpbmcuIE9wZXJhIGJlaW5nIGJyb2tlbiBpbiBxdWlya3MgbW9kZSBpcyBub3Qgb3VyIGZhdWx0Lg0KDQoJCWlmKGQuaXNJRSAvKnx8IGRvam8uaXNPcGVyYSovKXsNCgkJLy8gY2xpZW50IGNvZGUgbWF5IGhhdmUgdG8gYWRqdXN0IGlmIGNvbXBhdE1vZGUgdmFyaWVzIGFjcm9zcyBpZnJhbWVzDQoJCWQuYm94TW9kZWwgPSBkb2N1bWVudC5jb21wYXRNb2RlID09ICJCYWNrQ29tcGF0IiA/ICJib3JkZXItYm94IiA6ICJjb250ZW50LWJveCI7DQoJfQ0KCQ0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoJLy8gU3R5bGUgRnVuY3Rpb25zDQoJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KCS8vIGdldENvbXB1dGVkU3R5bGUgZHJpdmVzIG1vc3Qgb2YgdGhlIHN0eWxlIGNvZGUuDQoJLy8gV2hlcmV2ZXIgcG9zc2libGUsIHJldXNlIHRoZSByZXR1cm5lZCBvYmplY3QuDQoJLy8NCgkvLyBBUEkgZnVuY3Rpb25zIGJlbG93IHRoYXQgbmVlZCB0byBhY2Nlc3MgY29tcHV0ZWQgc3R5bGVzIGFjY2VwdCBhbiANCgkvLyBvcHRpb25hbCBjb21wdXRlZFN0eWxlIHBhcmFtZXRlci4NCgkvLyBJZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLCB0aGUgZnVuY3Rpb25zIHdpbGwgY2FsbCBnZXRDb21wdXRlZFN0eWxlIHRoZW1zZWx2ZXMuDQoJLy8gVGhpcyB3YXksIGNhbGxpbmcgY29kZSBjYW4gYWNjZXNzIGNvbXB1dGVkU3R5bGUgb25jZSwgYW5kIHRoZW4gcGFzcyB0aGUgcmVmZXJlbmNlIHRvIA0KCS8vIG11bHRpcGxlIEFQSSBmdW5jdGlvbnMuDQoNCi8qPT09PT0NCglkb2pvLmdldENvbXB1dGVkU3R5bGUgPSBmdW5jdGlvbihub2RlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYSAiY29tcHV0ZWQgc3R5bGUiIG9iamVjdC4NCgkJLy8NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlHZXRzIGEgImNvbXB1dGVkIHN0eWxlIiBvYmplY3Qgd2hpY2ggY2FuIGJlIHVzZWQgdG8gZ2F0aGVyDQoJCS8vCQlpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgcmVuZGVyZWQgbm9kZS4NCgkJLy8NCgkJLy8JCU5vdGUgdGhhdCB0aGlzIG1heSBiZWhhdmUgZGlmZmVyZW50bHkgb24gZGlmZmVyZW50IGJyb3dzZXJzLg0KCQkvLwkJVmFsdWVzIG1heSBoYXZlIGRpZmZlcmVudCBmb3JtYXRzIGFuZCB2YWx1ZSBlbmNvZGluZ3MgYWNyb3NzDQoJCS8vCQlicm93c2Vycy4NCgkJLy8NCgkJLy8JCU5vdGUgYWxzbyB0aGF0IHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZS4gIFdoZXJldmVyIHBvc3NpYmxlLA0KCQkvLwkJcmV1c2UgdGhlIHJldHVybmVkIG9iamVjdC4NCgkJLy8NCgkJLy8JCVVzZSB0aGUgZG9qby5zdHlsZSgpIG1ldGhvZCBmb3IgbW9yZSBjb25zaXN0ZW50IChwaXhlbGl6ZWQpDQoJCS8vCQlyZXR1cm4gdmFsdWVzLg0KCQkvLw0KCQkvLwlub2RlOiBET01Ob2RlDQoJCS8vCQlBIHJlZmVyZW5jZSB0byBhIERPTSBub2RlLiBEb2VzIE5PVCBzdXBwb3J0IHRha2luZyBhbg0KCQkvLwkJSUQgc3RyaW5nIGZvciBzcGVlZCByZWFzb25zLg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CWRvam8uZ2V0Q29tcHV0ZWRTdHlsZShkb2pvLmJ5SWQoJ2ZvbycpKS5ib3JkZXJXaWR0aDsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JUmV1c2luZyB0aGUgcmV0dXJuZWQgb2JqZWN0LCBhdm9pZGluZyBtdWx0aXBsZSBsb29rdXBzOg0KCQkvLwl8CXZhciBjcyA9IGRvam8uZ2V0Q29tcHV0ZWRTdHlsZShkb2pvLmJ5SWQoInNvbWVOb2RlIikpOw0KCQkvLwl8CXZhciB3ID0gY3Mud2lkdGgsIGggPSBjcy5oZWlnaHQ7DQoJCXJldHVybjsgLy8gQ1NTMlByb3BlcnRpZXMNCgl9DQo9PT09PSovDQoNCgkvLyBBbHRob3VnaCB3ZSBub3JtYWxseSBlc2NoZXcgYXJndW1lbnQgdmFsaWRhdGlvbiBhdCB0aGlzDQoJLy8gbGV2ZWwsIGhlcmUgd2UgdGVzdCBhcmd1bWVudCAnbm9kZScgZm9yIChkdWNrKXR5cGUsDQoJLy8gYnkgdGVzdGluZyBub2RlVHlwZSwgZWNhdXNlICdkb2N1bWVudCcgaXMgdGhlICdwYXJlbnROb2RlJyBvZiAnYm9keScNCgkvLyBpdCBpcyBmcmVxdWVudGx5IHNlbnQgdG8gdGhpcyBmdW5jdGlvbiBldmVuIA0KCS8vIHRob3VnaCBpdCBpcyBub3QgRWxlbWVudC4NCgl2YXIgZ2NzOw0KCQlpZihkLmlzV2ViS2l0KXsNCgkJCWdjcyA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSl7DQoJCQl2YXIgczsNCgkJCWlmKG5vZGUubm9kZVR5cGUgPT0gMSl7DQoJCQkJdmFyIGR2ID0gbm9kZS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Ow0KCQkJCXMgPSBkdi5nZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpOw0KCQkJCWlmKCFzICYmIG5vZGUuc3R5bGUpew0KCQkJCQlub2RlLnN0eWxlLmRpc3BsYXkgPSAiIjsNCgkJCQkJcyA9IGR2LmdldENvbXB1dGVkU3R5bGUobm9kZSwgbnVsbCk7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIHMgfHwge307DQoJCX07DQoJCX1lbHNlIGlmKGQuaXNJRSl7DQoJCWdjcyA9IGZ1bmN0aW9uKG5vZGUpew0KCQkJLy8gSUUgKGFzIG9mIDcpIGRvZXNuJ3QgZXhwb3NlIEVsZW1lbnQgbGlrZSBzYW5lIGJyb3dzZXJzDQoJCQlyZXR1cm4gbm9kZS5ub2RlVHlwZSA9PSAxIC8qIEVMRU1FTlRfTk9ERSovID8gbm9kZS5jdXJyZW50U3R5bGUgOiB7fTsNCgkJfTsNCgl9ZWxzZXsNCgkJZ2NzID0gZnVuY3Rpb24obm9kZSl7DQoJCQlyZXR1cm4gbm9kZS5ub2RlVHlwZSA9PSAxID8NCgkJCQlub2RlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShub2RlLCBudWxsKSA6IHt9Ow0KCQl9Ow0KCX0NCgkJZG9qby5nZXRDb21wdXRlZFN0eWxlID0gZ2NzOw0KDQoJCWlmKCFkLmlzSUUpew0KCQkJZC5fdG9QaXhlbFZhbHVlID0gZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpew0KCQkJLy8gc3R5bGUgdmFsdWVzIGNhbiBiZSBmbG9hdHMsIGNsaWVudCBjb2RlIG1heSB3YW50DQoJCQkvLyB0byByb3VuZCBmb3IgaW50ZWdlciBwaXhlbHMuDQoJCQlyZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZSkgfHwgMDsNCgkJfTsNCgkJfWVsc2V7DQoJCWQuX3RvUGl4ZWxWYWx1ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGF2YWx1ZSl7DQoJCQlpZighYXZhbHVlKXsgcmV0dXJuIDA7IH0NCgkJCS8vIG9uIElFNywgbWVkaXVtIGlzIHVzdWFsbHkgNCBwaXhlbHMNCgkJCWlmKGF2YWx1ZSA9PSAibWVkaXVtIil7IHJldHVybiA0OyB9DQoJCQkvLyBzdHlsZSB2YWx1ZXMgY2FuIGJlIGZsb2F0cywgY2xpZW50IGNvZGUgbWF5DQoJCQkvLyB3YW50IHRvIHJvdW5kIHRoaXMgdmFsdWUgZm9yIGludGVnZXIgcGl4ZWxzLg0KCQkJaWYoYXZhbHVlLnNsaWNlICYmIGF2YWx1ZS5zbGljZSgtMikgPT0gJ3B4Jyl7IHJldHVybiBwYXJzZUZsb2F0KGF2YWx1ZSk7IH0NCgkJCXdpdGgoZWxlbWVudCl7DQoJCQkJdmFyIHNMZWZ0ID0gc3R5bGUubGVmdDsNCgkJCQl2YXIgcnNMZWZ0ID0gcnVudGltZVN0eWxlLmxlZnQ7DQoJCQkJcnVudGltZVN0eWxlLmxlZnQgPSBjdXJyZW50U3R5bGUubGVmdDsNCgkJCQl0cnl7DQoJCQkJCS8vICdhdmFsdWUnIG1heSBiZSBpbmNvbXBhdGlibGUgd2l0aCBzdHlsZS5sZWZ0LCB3aGljaCBjYW4gY2F1c2UgSUUgdG8gdGhyb3cNCgkJCQkJLy8gdGhpcyBoYXMgYmVlbiBvYnNlcnZlZCBmb3IgYm9yZGVyIHdpZHRocyB1c2luZyAidGhpbiIsICJtZWRpdW0iLCAidGhpY2siIGNvbnN0YW50cw0KCQkJCQkvLyB0aG9zZSBwYXJ0aWN1bGFyIGNvbnN0YW50cyBjb3VsZCBiZSB0cmFwcGVkIGJ5IGEgbG9va3VwDQoJCQkJCS8vIGJ1dCBwZXJoYXBzIHRoZXJlIGFyZSBtb3JlDQoJCQkJCXN0eWxlLmxlZnQgPSBhdmFsdWU7DQoJCQkJCWF2YWx1ZSA9IHN0eWxlLnBpeGVsTGVmdDsNCgkJCQl9Y2F0Y2goZSl7DQoJCQkJCWF2YWx1ZSA9IDA7DQoJCQkJfQ0KCQkJCXN0eWxlLmxlZnQgPSBzTGVmdDsNCgkJCQlydW50aW1lU3R5bGUubGVmdCA9IHJzTGVmdDsNCgkJCX0NCgkJCXJldHVybiBhdmFsdWU7DQoJCX0NCgl9DQoJCXZhciBweCA9IGQuX3RvUGl4ZWxWYWx1ZTsNCg0KCS8vIEZJWE1FOiB0aGVyZSBvcGFjaXR5IHF1aXJrcyBvbiBGRiB0aGF0IHdlIGhhdmVuJ3QgcG9ydGVkIG92ZXIuIEhybS4NCgkvKj09PT09DQoJZG9qby5fZ2V0T3BhY2l0eSA9IGZ1bmN0aW9uKG5vZGUpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIHRoZSBjdXJyZW50IG9wYWNpdHkgb2YgdGhlIHBhc3NlZCBub2RlIGFzIGENCgkJCS8vCQlmbG9hdGluZy1wb2ludCB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEuDQoJCQkvLwlub2RlOiBEb21Ob2RlDQoJCQkvLwkJYSByZWZlcmVuY2UgdG8gYSBET00gbm9kZS4gRG9lcyBOT1Qgc3VwcG9ydCB0YWtpbmcgYW4NCgkJCS8vCQlJRCBzdHJpbmcgZm9yIHNwZWVkIHJlYXNvbnMuDQoJCQkvLwlyZXR1cm5zOiBOdW1iZXIgYmV0d2VlbiAwIGFuZCAxDQoJCQlyZXR1cm47IC8vIE51bWJlcg0KCX0NCgk9PT09PSovDQoNCgkJdmFyIGFzdHIgPSAiRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGEiOw0KCXZhciBhZiA9IGZ1bmN0aW9uKG4sIGYpew0KCQl0cnl7DQoJCQlyZXR1cm4gbi5maWx0ZXJzLml0ZW0oYXN0cik7DQoJCX1jYXRjaChlKXsNCgkJCXJldHVybiBmID8ge30gOiBudWxsOw0KCQl9DQoJfTsNCg0KCQlkb2pvLl9nZXRPcGFjaXR5ID0NCgkJCWQuaXNJRSA/IGZ1bmN0aW9uKG5vZGUpew0KCQkJdHJ5ew0KCQkJCXJldHVybiBhZihub2RlKS5PcGFjaXR5IC8gMTAwOyAvLyBOdW1iZXINCgkJCX1jYXRjaChlKXsNCgkJCQlyZXR1cm4gMTsgLy8gTnVtYmVyDQoJCQl9DQoJCX0gOg0KCQkJZnVuY3Rpb24obm9kZSl7DQoJCQlyZXR1cm4gZ2NzKG5vZGUpLm9wYWNpdHk7DQoJCX07DQoNCgkvKj09PT09DQoJZG9qby5fc2V0T3BhY2l0eSA9IGZ1bmN0aW9uKG5vZGUsIG9wYWNpdHkpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlzZXQgdGhlIG9wYWNpdHkgb2YgdGhlIHBhc3NlZCBub2RlIHBvcnRhYmx5LiBSZXR1cm5zIHRoZQ0KCQkJLy8JCW5ldyBvcGFjaXR5IG9mIHRoZSBub2RlLg0KCQkJLy8Jbm9kZTogRE9NTm9kZQ0KCQkJLy8JCWEgcmVmZXJlbmNlIHRvIGEgRE9NIG5vZGUuIERvZXMgTk9UIHN1cHBvcnQgdGFraW5nIGFuDQoJCQkvLwkJSUQgc3RyaW5nIGZvciBwZXJmb3JtYW5jZSByZWFzb25zLg0KCQkJLy8Jb3BhY2l0eTogTnVtYmVyDQoJCQkvLwkJQSBOdW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHNwZWNpZmllcyB0cmFuc3BhcmVudC4NCgkJCS8vCXJldHVybnM6IE51bWJlciBiZXR3ZWVuIDAgYW5kIDENCgkJCXJldHVybjsgLy8gTnVtYmVyDQoJfQ0KCT09PT09Ki8NCg0KCWRvam8uX3NldE9wYWNpdHkgPQ0KCQkJCWQuaXNJRSA/IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypOdW1iZXIqL29wYWNpdHkpew0KCQkJdmFyIG92ID0gb3BhY2l0eSAqIDEwMCwgb3BhcXVlID0gb3BhY2l0eSA9PSAxOw0KCQkJbm9kZS5zdHlsZS56b29tID0gb3BhcXVlID8gIiIgOiAxOw0KDQoJCQlpZighYWYobm9kZSkpew0KCQkJCWlmKG9wYXF1ZSl7DQoJCQkJCXJldHVybiBvcGFjaXR5Ow0KCQkJCX0NCgkJCQlub2RlLnN0eWxlLmZpbHRlciArPSAiIHByb2dpZDoiICsgYXN0ciArICIoT3BhY2l0eT0iICsgb3YgKyAiKSI7DQoJCQl9ZWxzZXsNCgkJCQlhZihub2RlLCAxKS5PcGFjaXR5ID0gb3Y7DQoJCQl9DQoNCgkJCS8vIG9uIElFNyBBbHBoYShGaWx0ZXIgb3BhY2l0eT0xMDApIG1ha2VzIHRleHQgbG9vayBmdXp6eSBzbyBkaXNhYmxlIGl0IGFsdG9nZXRoZXIgKGJ1ZyAjMjY2MSksDQoJCQkvL2J1dCBzdGlsbCB1cGRhdGUgdGhlIG9wYWNpdHkgdmFsdWUgc28gd2UgY2FuIGdldCBhIGNvcnJlY3QgcmVhZGluZyBpZiBpdCBpcyByZWFkIGxhdGVyLg0KCQkJYWYobm9kZSwgMSkuRW5hYmxlZCA9ICFvcGFxdWU7DQoNCgkJCWlmKG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSAidHIiKXsNCgkJCQlkLnF1ZXJ5KCI+IHRkIiwgbm9kZSkuZm9yRWFjaChmdW5jdGlvbihpKXsNCgkJCQkJZC5fc2V0T3BhY2l0eShpLCBvcGFjaXR5KTsNCgkJCQl9KTsNCgkJCX0NCgkJCXJldHVybiBvcGFjaXR5Ow0KCQl9IDoNCgkJCQlmdW5jdGlvbihub2RlLCBvcGFjaXR5KXsNCgkJCXJldHVybiBub2RlLnN0eWxlLm9wYWNpdHkgPSBvcGFjaXR5Ow0KCQl9Ow0KDQoJdmFyIF9waXhlbE5hbWVzQ2FjaGUgPSB7DQoJCWxlZnQ6IHRydWUsIHRvcDogdHJ1ZQ0KCX07DQoJdmFyIF9waXhlbFJlZ0V4cCA9IC9tYXJnaW58cGFkZGluZ3x3aWR0aHxoZWlnaHR8bWF4fG1pbnxvZmZzZXQvOyAgLy8gfGJvcmRlcg0KCXZhciBfdG9TdHlsZVZhbHVlID0gZnVuY3Rpb24obm9kZSwgdHlwZSwgdmFsdWUpew0KCQl0eXBlID0gdHlwZS50b0xvd2VyQ2FzZSgpOyAvLyBGSVhNRTogc2hvdWxkIHdlIHJlYWxseSBiZSBkb2luZyBzdHJpbmcgY2FzZSBjb252ZXJzaW9uIGhlcmU/IFNob3VsZCB3ZSBjYWNoZSBpdD8gTmVlZCB0byBwcm9maWxlIQ0KCQkJCWlmKGQuaXNJRSl7DQoJCQlpZih2YWx1ZSA9PSAiYXV0byIpew0KCQkJCWlmKHR5cGUgPT0gImhlaWdodCIpeyByZXR1cm4gbm9kZS5vZmZzZXRIZWlnaHQ7IH0NCgkJCQlpZih0eXBlID09ICJ3aWR0aCIpeyByZXR1cm4gbm9kZS5vZmZzZXRXaWR0aDsgfQ0KCQkJfQ0KCQkJaWYodHlwZSA9PSAiZm9udHdlaWdodCIpew0KCQkJCXN3aXRjaCh2YWx1ZSl7DQoJCQkJCWNhc2UgNzAwOiByZXR1cm4gImJvbGQiOw0KCQkJCQljYXNlIDQwMDoNCgkJCQkJZGVmYXVsdDogcmV0dXJuICJub3JtYWwiOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkJCWlmKCEodHlwZSBpbiBfcGl4ZWxOYW1lc0NhY2hlKSl7DQoJCQlfcGl4ZWxOYW1lc0NhY2hlW3R5cGVdID0gX3BpeGVsUmVnRXhwLnRlc3QodHlwZSk7DQoJCX0NCgkJcmV0dXJuIF9waXhlbE5hbWVzQ2FjaGVbdHlwZV0gPyBweChub2RlLCB2YWx1ZSkgOiB2YWx1ZTsNCgl9Ow0KDQoJdmFyIF9mbG9hdFN0eWxlID0gZC5pc0lFID8gInN0eWxlRmxvYXQiIDogImNzc0Zsb2F0IiwNCgkJX2Zsb2F0QWxpYXNlcyA9IHsgImNzc0Zsb2F0IjogX2Zsb2F0U3R5bGUsICJzdHlsZUZsb2F0IjogX2Zsb2F0U3R5bGUsICJmbG9hdCI6IF9mbG9hdFN0eWxlIH0NCgk7DQoNCgkvLyBwdWJsaWMgQVBJDQoNCglkb2pvLnN0eWxlID0gZnVuY3Rpb24oCS8qRG9tTm9kZXxTdHJpbmcqLyBub2RlLA0KCQkJCQkJCS8qU3RyaW5nP3xPYmplY3Q/Ki8gc3R5bGUsDQoJCQkJCQkJLypTdHJpbmc/Ki8gdmFsdWUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQWNjZXNzZXMgc3R5bGVzIG9uIGEgbm9kZS4gSWYgMiBhcmd1bWVudHMgYXJlDQoJCS8vCQlwYXNzZWQsIGFjdHMgYXMgYSBnZXR0ZXIuIElmIDMgYXJndW1lbnRzIGFyZSBwYXNzZWQsIGFjdHMNCgkJLy8JCWFzIGEgc2V0dGVyLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUdldHRpbmcgdGhlIHN0eWxlIHZhbHVlIHVzZXMgdGhlIGNvbXB1dGVkIHN0eWxlIGZvciB0aGUgbm9kZSwgc28gdGhlIHZhbHVlDQoJCS8vCQl3aWxsIGJlIGEgY2FsY3VsYXRlZCB2YWx1ZSwgbm90IGp1c3QgdGhlIGltbWVkaWF0ZSBub2RlLnN0eWxlIHZhbHVlLg0KCQkvLwkJQWxzbyB3aGVuIGdldHRpbmcgdmFsdWVzLCB1c2Ugc3BlY2lmaWMgc3R5bGUgbmFtZXMsDQoJCS8vCQlsaWtlICJib3JkZXJCb3R0b21XaWR0aCIgaW5zdGVhZCBvZiAiYm9yZGVyIiBzaW5jZSBjb21wb3VuZCB2YWx1ZXMgbGlrZQ0KCQkvLwkJImJvcmRlciIgYXJlIG5vdCBuZWNlc3NhcmlseSByZWZsZWN0ZWQgYXMgZXhwZWN0ZWQuDQoJCS8vCQlJZiB5b3Ugd2FudCB0byBnZXQgbm9kZSBkaW1lbnNpb25zLCB1c2UgYGRvam8ubWFyZ2luQm94KClgLCANCgkJLy8JCWBkb2pvLmNvbnRlbnRCb3goKWAgb3IgYGRvam8ucG9zaXRpb24oKWAuDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gbm9kZSB0byBnZXQvc2V0IHN0eWxlIGZvcg0KCQkvLwlzdHlsZToNCgkJLy8JCXRoZSBzdHlsZSBwcm9wZXJ0eSB0byBzZXQgaW4gRE9NLWFjY2Vzc29yIGZvcm1hdA0KCQkvLwkJKCJib3JkZXJXaWR0aCIsIG5vdCAiYm9yZGVyLXdpZHRoIikgb3IgYW4gb2JqZWN0IHdpdGgga2V5L3ZhbHVlDQoJCS8vCQlwYWlycyBzdWl0YWJsZSBmb3Igc2V0dGluZyBlYWNoIHByb3BlcnR5Lg0KCQkvLwl2YWx1ZToNCgkJLy8JCUlmIHBhc3NlZCwgc2V0cyB2YWx1ZSBvbiB0aGUgbm9kZSBmb3Igc3R5bGUsIGhhbmRsaW5nDQoJCS8vCQljcm9zcy1icm93c2VyIGNvbmNlcm5zLiAgV2hlbiBzZXR0aW5nIGEgcGl4ZWwgdmFsdWUsDQoJCS8vCQliZSBzdXJlIHRvIGluY2x1ZGUgInB4IiBpbiB0aGUgdmFsdWUuIEZvciBpbnN0YW5jZSwgdG9wOiAiMjAwcHgiLg0KCQkvLwkJT3RoZXJ3aXNlLCBpbiBzb21lIGNhc2VzLCBzb21lIGJyb3dzZXJzIHdpbGwgbm90IGFwcGx5IHRoZSBzdHlsZS4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCVBhc3Npbmcgb25seSBhbiBJRCBvciBub2RlIHJldHVybnMgdGhlIGNvbXB1dGVkIHN0eWxlIG9iamVjdCBvZg0KCQkvLwkJdGhlIG5vZGU6DQoJCS8vCXwJZG9qby5zdHlsZSgidGhpbmdlciIpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJUGFzc2luZyBhIG5vZGUgYW5kIGEgc3R5bGUgcHJvcGVydHkgcmV0dXJucyB0aGUgY3VycmVudA0KCQkvLwkJbm9ybWFsaXplZCwgY29tcHV0ZWQgdmFsdWUgZm9yIHRoYXQgcHJvcGVydHk6DQoJCS8vCXwJZG9qby5zdHlsZSgidGhpbmdlciIsICJvcGFjaXR5Iik7IC8vIDEgYnkgZGVmYXVsdA0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJUGFzc2luZyBhIG5vZGUsIGEgc3R5bGUgcHJvcGVydHksIGFuZCBhIHZhbHVlIGNoYW5nZXMgdGhlDQoJCS8vCQljdXJyZW50IGRpc3BsYXkgb2YgdGhlIG5vZGUgYW5kIHJldHVybnMgdGhlIG5ldyBjb21wdXRlZCB2YWx1ZQ0KCQkvLwl8CWRvam8uc3R5bGUoInRoaW5nZXIiLCAib3BhY2l0eSIsIDAuNSk7IC8vID09IDAuNQ0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJUGFzc2luZyBhIG5vZGUsIGFuIG9iamVjdC1zdHlsZSBzdHlsZSBwcm9wZXJ0eSBzZXRzIGVhY2ggb2YgdGhlIHZhbHVlcyBpbiB0dXJuIGFuZCByZXR1cm5zIHRoZSBjb21wdXRlZCBzdHlsZSBvYmplY3Qgb2YgdGhlIG5vZGU6DQoJCS8vCXwJZG9qby5zdHlsZSgidGhpbmdlciIsIHsNCgkJLy8JfAkJIm9wYWNpdHkiOiAwLjUsDQoJCS8vCXwJCSJib3JkZXIiOiAiM3B4IHNvbGlkIGJsYWNrIiwNCgkJLy8JfAkJImhlaWdodCI6ICIzMDBweCINCgkJLy8JfAl9KTsNCgkJLy8NCgkJLy8gCWV4YW1wbGU6DQoJCS8vCQlXaGVuIHRoZSBDU1Mgc3R5bGUgcHJvcGVydHkgaXMgaHlwaGVuYXRlZCwgdGhlIEphdmFTY3JpcHQgcHJvcGVydHkgaXMgY2FtZWxDYXNlZC4NCgkJLy8JCWZvbnQtc2l6ZSBiZWNvbWVzIGZvbnRTaXplLCBhbmQgc28gb24uDQoJCS8vCXwJZG9qby5zdHlsZSgidGhpbmdlciIsew0KCQkvLwl8CQlmb250U2l6ZToiMTRwdCIsDQoJCS8vCXwJCWxldHRlclNwYWNpbmc6IjEuMmVtIg0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJZG9qby5Ob2RlTGlzdCBpbXBsZW1lbnRzIC5zdHlsZSgpIHVzaW5nIHRoZSBzYW1lIHN5bnRheCwgb21pdHRpbmcgdGhlICJub2RlIiBwYXJhbWV0ZXIsIGNhbGxpbmcNCgkJLy8JCWRvam8uc3R5bGUoKSBvbiBldmVyeSBlbGVtZW50IG9mIHRoZSBsaXN0LiBTZWU6IGBkb2pvLnF1ZXJ5KClgIGFuZCBgZG9qby5Ob2RlTGlzdCgpYA0KCQkvLwl8CWRvam8ucXVlcnkoIi5zb21lQ2xhc3NOYW1lIikuc3R5bGUoInZpc2liaWxpdHkiLCJoaWRkZW4iKTsNCgkJLy8JfAkvLyBvcg0KCQkvLwl8CWRvam8ucXVlcnkoIiNiYXogPiBkaXYiKS5zdHlsZSh7DQoJCS8vCXwJCW9wYWNpdHk6MC43NSwNCgkJLy8JfAkJZm9udFNpemU6IjEzcHQiDQoJCS8vCXwJfSk7DQoNCgkJdmFyIG4gPSBieUlkKG5vZGUpLCBhcmdzID0gYXJndW1lbnRzLmxlbmd0aCwgb3AgPSAoc3R5bGUgPT0gIm9wYWNpdHkiKTsNCgkJc3R5bGUgPSBfZmxvYXRBbGlhc2VzW3N0eWxlXSB8fCBzdHlsZTsNCgkJaWYoYXJncyA9PSAzKXsNCgkJCXJldHVybiBvcCA/IGQuX3NldE9wYWNpdHkobiwgdmFsdWUpIDogbi5zdHlsZVtzdHlsZV0gPSB2YWx1ZTsgLypOdW1iZXIqLw0KCQl9DQoJCWlmKGFyZ3MgPT0gMiAmJiBvcCl7DQoJCQlyZXR1cm4gZC5fZ2V0T3BhY2l0eShuKTsNCgkJfQ0KCQl2YXIgcyA9IGdjcyhuKTsNCgkJaWYoYXJncyA9PSAyICYmIHR5cGVvZiBzdHlsZSAhPSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCWZvcih2YXIgeCBpbiBzdHlsZSl7DQoJCQkJZC5zdHlsZShub2RlLCB4LCBzdHlsZVt4XSk7DQoJCQl9DQoJCQlyZXR1cm4gczsNCgkJfQ0KCQlyZXR1cm4gKGFyZ3MgPT0gMSkgPyBzIDogX3RvU3R5bGVWYWx1ZShuLCBzdHlsZSwgc1tzdHlsZV0gfHwgbi5zdHlsZVtzdHlsZV0pOyAvKiBDU1MyUHJvcGVydGllc3x8U3RyaW5nfHxOdW1iZXIgKi8NCgl9DQoNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KCS8vIEJveCBGdW5jdGlvbnMNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KDQoJZG9qby5fZ2V0UGFkRXh0ZW50cyA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbiwgLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLyAJCVJldHVybnMgb2JqZWN0IHdpdGggc3BlY2lhbCB2YWx1ZXMgc3BlY2lmaWNhbGx5IHVzZWZ1bCBmb3Igbm9kZQ0KCQkvLyAJCWZpdHRpbmcuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBgd2AsIGBoYCwgYGxgLCBgdGAgcHJvcGVydGllczoNCgkJLy8JfAkJbC90ID0gbGVmdC90b3AgcGFkZGluZyAocmVzcGVjdGl2ZWx5KQ0KCQkvLwl8CQl3ID0gdGhlIHRvdGFsIG9mIHRoZSBsZWZ0IGFuZCByaWdodCBwYWRkaW5nIA0KCQkvLwl8CQloID0gdGhlIHRvdGFsIG9mIHRoZSB0b3AgYW5kIGJvdHRvbSBwYWRkaW5nDQoJCS8vCQlJZiAnbm9kZScgaGFzIHBvc2l0aW9uLCBsL3QgZm9ybXMgdGhlIG9yaWdpbiBmb3IgY2hpbGQgbm9kZXMuDQoJCS8vCQlUaGUgdy9oIGFyZSB1c2VkIGZvciBjYWxjdWxhdGluZyBib3hlcy4NCgkJLy8JCU5vcm1hbGx5IGFwcGxpY2F0aW9uIGNvZGUgd2lsbCBub3QgbmVlZCB0byBpbnZva2UgdGhpcw0KCQkvLwkJZGlyZWN0bHksIGFuZCB3aWxsIHVzZSB0aGUgLi4uYm94Li4uIGZ1bmN0aW9ucyBpbnN0ZWFkLg0KCQl2YXIgDQoJCQlzID0gY29tcHV0ZWRTdHlsZXx8Z2NzKG4pLA0KCQkJbCA9IHB4KG4sIHMucGFkZGluZ0xlZnQpLA0KCQkJdCA9IHB4KG4sIHMucGFkZGluZ1RvcCk7DQoJCXJldHVybiB7DQoJCQlsOiBsLA0KCQkJdDogdCwNCgkJCXc6IGwrcHgobiwgcy5wYWRkaW5nUmlnaHQpLA0KCQkJaDogdCtweChuLCBzLnBhZGRpbmdCb3R0b20pDQoJCX07DQoJfQ0KDQoJZG9qby5fZ2V0Qm9yZGVyRXh0ZW50cyA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbiwgLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJcmV0dXJucyBhbiBvYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIHVzZWZ1bCBmb3Igbm90aW5nIHRoZSBib3JkZXINCgkJLy8JCWRpbWVuc2lvbnMuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLyAJCSogbC90ID0gdGhlIHN1bSBvZiBsZWZ0L3RvcCBib3JkZXIgKHJlc3BlY3RpdmVseSkNCgkJLy8JCSogdyA9IHRoZSBzdW0gb2YgdGhlIGxlZnQgYW5kIHJpZ2h0IGJvcmRlcg0KCQkvLwkJKiBoID0gdGhlIHN1bSBvZiB0aGUgdG9wIGFuZCBib3R0b20gYm9yZGVyDQoJCS8vDQoJCS8vCQlUaGUgdy9oIGFyZSB1c2VkIGZvciBjYWxjdWxhdGluZyBib3hlcy4NCgkJLy8JCU5vcm1hbGx5IGFwcGxpY2F0aW9uIGNvZGUgd2lsbCBub3QgbmVlZCB0byBpbnZva2UgdGhpcw0KCQkvLwkJZGlyZWN0bHksIGFuZCB3aWxsIHVzZSB0aGUgLi4uYm94Li4uIGZ1bmN0aW9ucyBpbnN0ZWFkLg0KCQl2YXIgDQoJCQluZSA9ICJub25lIiwNCgkJCXMgPSBjb21wdXRlZFN0eWxlfHxnY3MobiksDQoJCQlibCA9IChzLmJvcmRlckxlZnRTdHlsZSAhPSBuZSA/IHB4KG4sIHMuYm9yZGVyTGVmdFdpZHRoKSA6IDApLA0KCQkJYnQgPSAocy5ib3JkZXJUb3BTdHlsZSAhPSBuZSA/IHB4KG4sIHMuYm9yZGVyVG9wV2lkdGgpIDogMCk7DQoJCXJldHVybiB7DQoJCQlsOiBibCwNCgkJCXQ6IGJ0LA0KCQkJdzogYmwgKyAocy5ib3JkZXJSaWdodFN0eWxlIT1uZSA/IHB4KG4sIHMuYm9yZGVyUmlnaHRXaWR0aCkgOiAwKSwNCgkJCWg6IGJ0ICsgKHMuYm9yZGVyQm90dG9tU3R5bGUhPW5lID8gcHgobiwgcy5ib3JkZXJCb3R0b21XaWR0aCkgOiAwKQ0KCQl9Ow0KCX0NCg0KCWRvam8uX2dldFBhZEJvcmRlckV4dGVudHMgPSBmdW5jdGlvbigvKkRvbU5vZGUqL24sIC8qT2JqZWN0Ki9jb21wdXRlZFN0eWxlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgb2JqZWN0IHdpdGggcHJvcGVydGllcyB1c2VmdWwgZm9yIGJveCBmaXR0aW5nIHdpdGgNCgkJLy8JCXJlZ2FyZHMgdG8gcGFkZGluZy4NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQkqIGwvdCA9IHRoZSBzdW0gb2YgbGVmdC90b3AgcGFkZGluZyBhbmQgbGVmdC90b3AgYm9yZGVyIChyZXNwZWN0aXZlbHkpDQoJCS8vCQkqIHcgPSB0aGUgc3VtIG9mIHRoZSBsZWZ0IGFuZCByaWdodCBwYWRkaW5nIGFuZCBib3JkZXINCgkJLy8JCSogaCA9IHRoZSBzdW0gb2YgdGhlIHRvcCBhbmQgYm90dG9tIHBhZGRpbmcgYW5kIGJvcmRlcg0KCQkvLw0KCQkvLwkJVGhlIHcvaCBhcmUgdXNlZCBmb3IgY2FsY3VsYXRpbmcgYm94ZXMuDQoJCS8vCQlOb3JtYWxseSBhcHBsaWNhdGlvbiBjb2RlIHdpbGwgbm90IG5lZWQgdG8gaW52b2tlIHRoaXMNCgkJLy8JCWRpcmVjdGx5LCBhbmQgd2lsbCB1c2UgdGhlIC4uLmJveC4uLiBmdW5jdGlvbnMgaW5zdGVhZC4NCgkJdmFyIA0KCQkJcyA9IGNvbXB1dGVkU3R5bGV8fGdjcyhuKSwNCgkJCXAgPSBkLl9nZXRQYWRFeHRlbnRzKG4sIHMpLA0KCQkJYiA9IGQuX2dldEJvcmRlckV4dGVudHMobiwgcyk7DQoJCXJldHVybiB7DQoJCQlsOiBwLmwgKyBiLmwsDQoJCQl0OiBwLnQgKyBiLnQsDQoJCQl3OiBwLncgKyBiLncsDQoJCQloOiBwLmggKyBiLmgNCgkJfTsNCgl9DQoNCglkb2pvLl9nZXRNYXJnaW5FeHRlbnRzID0gZnVuY3Rpb24obiwgY29tcHV0ZWRTdHlsZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlyZXR1cm5zIG9iamVjdCB3aXRoIHByb3BlcnRpZXMgdXNlZnVsIGZvciBib3ggZml0dGluZyB3aXRoDQoJCS8vCQlyZWdhcmRzIHRvIGJveCBtYXJnaW5zIChpLmUuLCB0aGUgb3V0ZXItYm94KS4NCgkJLy8NCgkJLy8JCSogbC90ID0gbWFyZ2luTGVmdCwgbWFyZ2luVG9wLCByZXNwZWN0aXZlbHkNCgkJLy8JCSogdyA9IHRvdGFsIHdpZHRoLCBtYXJnaW4gaW5jbHVzaXZlDQoJCS8vCQkqIGggPSB0b3RhbCBoZWlnaHQsIG1hcmdpbiBpbmNsdXNpdmUNCgkJLy8NCgkJLy8JCVRoZSB3L2ggYXJlIHVzZWQgZm9yIGNhbGN1bGF0aW5nIGJveGVzLg0KCQkvLwkJTm9ybWFsbHkgYXBwbGljYXRpb24gY29kZSB3aWxsIG5vdCBuZWVkIHRvIGludm9rZSB0aGlzDQoJCS8vCQlkaXJlY3RseSwgYW5kIHdpbGwgdXNlIHRoZSAuLi5ib3guLi4gZnVuY3Rpb25zIGluc3RlYWQuDQoJCXZhciANCgkJCXMgPSBjb21wdXRlZFN0eWxlfHxnY3MobiksDQoJCQlsID0gcHgobiwgcy5tYXJnaW5MZWZ0KSwNCgkJCXQgPSBweChuLCBzLm1hcmdpblRvcCksDQoJCQlyID0gcHgobiwgcy5tYXJnaW5SaWdodCksDQoJCQliID0gcHgobiwgcy5tYXJnaW5Cb3R0b20pOw0KCQlpZihkLmlzV2ViS2l0ICYmIChzLnBvc2l0aW9uICE9ICJhYnNvbHV0ZSIpKXsNCgkJCS8vIEZJWE1FOiBTYWZhcmkncyB2ZXJzaW9uIG9mIHRoZSBjb21wdXRlZCByaWdodCBtYXJnaW4NCgkJCS8vIGlzIHRoZSBzcGFjZSBiZXR3ZWVuIG91ciByaWdodCBlZGdlIGFuZCB0aGUgcmlnaHQgZWRnZSANCgkJCS8vIG9mIG91ciBvZmZzZXRQYXJlbnQuDQoJCQkvLyBXaGF0IHdlIGFyZSBsb29raW5nIGZvciBpcyB0aGUgYWN0dWFsIG1hcmdpbiB2YWx1ZSBhcyANCgkJCS8vIGRldGVybWluZWQgYnkgQ1NTLg0KCQkJLy8gSGFjayBzb2x1dGlvbiBpcyB0byBhc3N1bWUgbGVmdC9yaWdodCBtYXJnaW5zIGFyZSB0aGUgc2FtZS4NCgkJCXIgPSBsOw0KCQl9DQoJCXJldHVybiB7DQoJCQlsOiBsLA0KCQkJdDogdCwNCgkJCXc6IGwrciwNCgkJCWg6IHQrYg0KCQl9Ow0KCX0NCg0KCS8vIEJveCBnZXR0ZXJzIHdvcmsgaW4gYW55IGJveCBjb250ZXh0IGJlY2F1c2Ugb2Zmc2V0V2lkdGgvY2xpZW50V2lkdGgNCgkvLyBhcmUgaW52YXJpYW50IHdydCBib3ggY29udGV4dA0KCS8vDQoJLy8gVGhleSBkbyAqbm90KiB3b3JrIGZvciBkaXNwbGF5OiBpbmxpbmUgb2JqZWN0cyB0aGF0IGhhdmUgcGFkZGluZyBzdHlsZXMNCgkvLyBiZWNhdXNlIHRoZSB1c2VyIGFnZW50IGlnbm9yZXMgcGFkZGluZyAoaXQncyBib2d1cyBzdHlsaW5nIGluIGFueSBjYXNlKQ0KCS8vDQoJLy8gQmUgY2FyZWZ1bCB3aXRoIElNR3MgYmVjYXVzZSB0aGV5IGFyZSBpbmxpbmUgb3IgYmxvY2sgZGVwZW5kaW5nIG9uIA0KCS8vIGJyb3dzZXIgYW5kIGJyb3dzZXIgbW9kZS4NCg0KCS8vIEFsdGhvdWdoIGl0IHdvdWxkIGJlIGVhc2llciB0byByZWFkLCB0aGVyZSBhcmUgbm90IHNlcGFyYXRlIHZlcnNpb25zIG9mIA0KCS8vIF9nZXRNYXJnaW5Cb3ggZm9yIGVhY2ggYnJvd3NlciBiZWNhdXNlOg0KCS8vIDEuIHRoZSBicmFuY2hpbmcgaXMgbm90IGV4cGVuc2l2ZQ0KCS8vIDIuIGZhY3RvcmluZyB0aGUgc2hhcmVkIGNvZGUgd2FzdGVzIGN5Y2xlcyAoZnVuY3Rpb24gY2FsbCBvdmVyaGVhZCkNCgkvLyAzLiBkdXBsaWNhdGluZyB0aGUgc2hhcmVkIGNvZGUgd2FzdGVzIGJ5dGVzDQoNCglkb2pvLl9nZXRNYXJnaW5Cb3ggPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIC8qT2JqZWN0Ki9jb21wdXRlZFN0eWxlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCXJldHVybnMgYW4gb2JqZWN0IHRoYXQgZW5jb2RlcyB0aGUgd2lkdGgsIGhlaWdodCwgbGVmdCBhbmQgdG9wDQoJCS8vCQlwb3NpdGlvbnMgb2YgdGhlIG5vZGUncyBtYXJnaW4gYm94Lg0KCQl2YXIgcyA9IGNvbXB1dGVkU3R5bGUgfHwgZ2NzKG5vZGUpLCBtZSA9IGQuX2dldE1hcmdpbkV4dGVudHMobm9kZSwgcyk7DQoJCXZhciBsID0gbm9kZS5vZmZzZXRMZWZ0IC0gbWUubCwgdCA9IG5vZGUub2Zmc2V0VG9wIC0gbWUudCwgcCA9IG5vZGUucGFyZW50Tm9kZTsNCgkJCQlpZihkLmlzTW96KXsNCgkJCS8vIE1vemlsbGE6DQoJCQkvLyBJZiBvZmZzZXRQYXJlbnQgaGFzIGEgY29tcHV0ZWQgb3ZlcmZsb3cgIT0gdmlzaWJsZSwgdGhlIG9mZnNldExlZnQgaXMgZGVjcmVhc2VkDQoJCQkvLyBieSB0aGUgcGFyZW50J3MgYm9yZGVyLg0KCQkJLy8gV2UgZG9uJ3Qgd2FudCB0byBjb21wdXRlIHRoZSBwYXJlbnQncyBzdHlsZSwgc28gaW5zdGVhZCB3ZSBleGFtaW5lIG5vZGUncw0KCQkJLy8gY29tcHV0ZWQgbGVmdC90b3Agd2hpY2ggaXMgbW9yZSBzdGFibGUuDQoJCQl2YXIgc2wgPSBwYXJzZUZsb2F0KHMubGVmdCksIHN0ID0gcGFyc2VGbG9hdChzLnRvcCk7DQoJCQlpZighaXNOYU4oc2wpICYmICFpc05hTihzdCkpew0KCQkJCWwgPSBzbCwgdCA9IHN0Ow0KCQkJfWVsc2V7DQoJCQkJLy8gSWYgY2hpbGQncyBjb21wdXRlZCBsZWZ0L3RvcCBhcmUgbm90IHBhcnNlYWJsZSBhcyBhIG51bWJlciAoZS5nLiAiYXV0byIpLCB3ZQ0KCQkJCS8vIGhhdmUgbm8gY2hvaWNlIGJ1dCB0byBleGFtaW5lIHRoZSBwYXJlbnQncyBjb21wdXRlZCBzdHlsZS4NCgkJCQlpZihwICYmIHAuc3R5bGUpew0KCQkJCQl2YXIgcGNzID0gZ2NzKHApOw0KCQkJCQlpZihwY3Mub3ZlcmZsb3cgIT0gInZpc2libGUiKXsNCgkJCQkJCXZhciBiZSA9IGQuX2dldEJvcmRlckV4dGVudHMocCwgcGNzKTsNCgkJCQkJCWwgKz0gYmUubCwgdCArPSBiZS50Ow0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9ZWxzZSBpZihkLmlzT3BlcmEgfHwgKGQuaXNJRSA+IDcgJiYgIWQuaXNRdWlya3MpKXsNCgkJCS8vIE9uIE9wZXJhIGFuZCBJRSA4LCBvZmZzZXRMZWZ0L1RvcCBpbmNsdWRlcyB0aGUgcGFyZW50J3MgYm9yZGVyDQoJCQlpZihwKXsNCgkJCQliZSA9IGQuX2dldEJvcmRlckV4dGVudHMocCk7DQoJCQkJbCAtPSBiZS5sOw0KCQkJCXQgLT0gYmUudDsNCgkJCX0NCgkJfQ0KCQkJCXJldHVybiB7DQoJCQlsOiBsLA0KCQkJdDogdCwNCgkJCXc6IG5vZGUub2Zmc2V0V2lkdGggKyBtZS53LA0KCQkJaDogbm9kZS5vZmZzZXRIZWlnaHQgKyBtZS5oIA0KCQl9Ow0KCX0NCg0KCWRvam8uX2dldENvbnRlbnRCb3ggPSBmdW5jdGlvbihub2RlLCBjb21wdXRlZFN0eWxlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gb2JqZWN0IHRoYXQgZW5jb2RlcyB0aGUgd2lkdGgsIGhlaWdodCwgbGVmdCBhbmQgdG9wDQoJCS8vCQlwb3NpdGlvbnMgb2YgdGhlIG5vZGUncyBjb250ZW50IGJveCwgaXJyZXNwZWN0aXZlIG9mIHRoZQ0KCQkvLwkJY3VycmVudCBib3ggbW9kZWwuDQoNCgkJLy8gY2xpZW50V2lkdGgvSGVpZ2h0IGFyZSBpbXBvcnRhbnQgc2luY2UgdGhlIGF1dG9tYXRpY2FsbHkgYWNjb3VudCBmb3Igc2Nyb2xsYmFycw0KCQkvLyBmYWxsYmFjayB0byBvZmZzZXRXaWR0aC9IZWlnaHQgZm9yIHNwZWNpYWwgY2FzZXMgKHNlZSAjMzM3OCkNCgkJdmFyIHMgPSBjb21wdXRlZFN0eWxlIHx8IGdjcyhub2RlKSwNCgkJCXBlID0gZC5fZ2V0UGFkRXh0ZW50cyhub2RlLCBzKSwNCgkJCWJlID0gZC5fZ2V0Qm9yZGVyRXh0ZW50cyhub2RlLCBzKSwNCgkJCXcgPSBub2RlLmNsaWVudFdpZHRoLA0KCQkJaA0KCQk7DQoJCWlmKCF3KXsNCgkJCXcgPSBub2RlLm9mZnNldFdpZHRoLCBoID0gbm9kZS5vZmZzZXRIZWlnaHQ7DQoJCX1lbHNlew0KCQkJaCA9IG5vZGUuY2xpZW50SGVpZ2h0LCBiZS53ID0gYmUuaCA9IDA7DQoJCX0NCgkJLy8gT24gT3BlcmEsIG9mZnNldExlZnQgaW5jbHVkZXMgdGhlIHBhcmVudCdzIGJvcmRlcg0KCQkJCWlmKGQuaXNPcGVyYSl7IHBlLmwgKz0gYmUubDsgcGUudCArPSBiZS50OyB9Ow0KCQkJCXJldHVybiB7DQoJCQlsOiBwZS5sLA0KCQkJdDogcGUudCwNCgkJCXc6IHcgLSBwZS53IC0gYmUudywNCgkJCWg6IGggLSBwZS5oIC0gYmUuaA0KCQl9Ow0KCX0NCg0KCWRvam8uX2dldEJvcmRlckJveCA9IGZ1bmN0aW9uKG5vZGUsIGNvbXB1dGVkU3R5bGUpew0KCQl2YXIgcyA9IGNvbXB1dGVkU3R5bGUgfHwgZ2NzKG5vZGUpLA0KCQkJcGUgPSBkLl9nZXRQYWRFeHRlbnRzKG5vZGUsIHMpLA0KCQkJY2IgPSBkLl9nZXRDb250ZW50Qm94KG5vZGUsIHMpDQoJCTsNCgkJcmV0dXJuIHsNCgkJCWw6IGNiLmwgLSBwZS5sLA0KCQkJdDogY2IudCAtIHBlLnQsDQoJCQl3OiBjYi53ICsgcGUudywNCgkJCWg6IGNiLmggKyBwZS5oDQoJCX07DQoJfQ0KDQoJLy8gQm94IHNldHRlcnMgZGVwZW5kIG9uIGJveCBjb250ZXh0IGJlY2F1c2UgaW50ZXJwcmV0YXRpb24gb2Ygd2lkdGgvaGVpZ2h0IHN0eWxlcw0KCS8vIHZhcnkgd3J0IGJveCBjb250ZXh0Lg0KCS8vDQoJLy8gVGhlIHZhbHVlIG9mIGRvam8uYm94TW9kZWwgaXMgdXNlZCB0byBkZXRlcm1pbmUgYm94IGNvbnRleHQuDQoJLy8gZG9qby5ib3hNb2RlbCBjYW4gYmUgc2V0IGRpcmVjdGx5IHRvIGNoYW5nZSBiZWhhdmlvci4NCgkvLw0KCS8vIEJld2FyZSBvZiBkaXNwbGF5OiBpbmxpbmUgb2JqZWN0cyB0aGF0IGhhdmUgcGFkZGluZyBzdHlsZXMNCgkvLyBiZWNhdXNlIHRoZSB1c2VyIGFnZW50IGlnbm9yZXMgcGFkZGluZyAoaXQncyBhIGJvZ3VzIHNldHVwIGFueXdheSkNCgkvLw0KCS8vIEJlIGNhcmVmdWwgd2l0aCBJTUdzIGJlY2F1c2UgdGhleSBhcmUgaW5saW5lIG9yIGJsb2NrIGRlcGVuZGluZyBvbiANCgkvLyBicm93c2VyIGFuZCBicm93c2VyIG1vZGUuDQoJLy8NCgkvLyBFbGVtZW50cyBvdGhlciB0aGFuIERJViBtYXkgaGF2ZSBzcGVjaWFsIHF1aXJrcywgbGlrZSBidWlsdC1pbg0KCS8vIG1hcmdpbnMgb3IgcGFkZGluZywgb3IgdmFsdWVzIG5vdCBkZXRlY3RhYmxlIHZpYSBjb21wdXRlZFN0eWxlLg0KCS8vIEluIHBhcnRpY3VsYXIsIG1hcmdpbnMgb24gVEFCTEUgZG8gbm90IHNlZW1zIHRvIGFwcGVhciANCgkvLyBhdCBhbGwgaW4gY29tcHV0ZWRTdHlsZSBvbiBNb3ppbGxhLg0KDQoJZG9qby5fc2V0Qm94ID0gZnVuY3Rpb24oLypEb21Ob2RlKi9ub2RlLCAvKk51bWJlcj8qL2wsIC8qTnVtYmVyPyovdCwgLypOdW1iZXI/Ki93LCAvKk51bWJlcj8qL2gsIC8qU3RyaW5nPyovdSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlzZXRzIHdpZHRoL2hlaWdodC9sZWZ0L3RvcCBpbiB0aGUgY3VycmVudCAobmF0aXZlKSBib3gtbW9kZWwNCgkJLy8JCWRpbWVudGlvbnMuIFVzZXMgdGhlIHVuaXQgcGFzc2VkIGluIHUuDQoJCS8vCW5vZGU6DQoJCS8vCQlET00gTm9kZSByZWZlcmVuY2UuIElkIHN0cmluZyBub3Qgc3VwcG9ydGVkIGZvciBwZXJmb3JtYW5jZQ0KCQkvLwkJcmVhc29ucy4NCgkJLy8JbDoNCgkJLy8JCWxlZnQgb2Zmc2V0IGZyb20gcGFyZW50Lg0KCQkvLwl0Og0KCQkvLwkJdG9wIG9mZnNldCBmcm9tIHBhcmVudC4NCgkJLy8JdzoNCgkJLy8JCXdpZHRoIGluIGN1cnJlbnQgYm94IG1vZGVsLg0KCQkvLwloOg0KCQkvLwkJd2lkdGggaW4gY3VycmVudCBib3ggbW9kZWwuDQoJCS8vCXU6DQoJCS8vCQl1bml0IG1lYXN1cmUgdG8gdXNlIGZvciBvdGhlciBtZWFzdXJlcy4gRGVmYXVsdHMgdG8gInB4Ii4NCgkJdSA9IHUgfHwgInB4IjsNCgkJdmFyIHMgPSBub2RlLnN0eWxlOw0KCQlpZighaXNOYU4obCkpeyBzLmxlZnQgPSBsICsgdTsgfQ0KCQlpZighaXNOYU4odCkpeyBzLnRvcCA9IHQgKyB1OyB9DQoJCWlmKHcgPj0gMCl7IHMud2lkdGggPSB3ICsgdTsgfQ0KCQlpZihoID49IDApeyBzLmhlaWdodCA9IGggKyB1OyB9DQoJfQ0KDQoJZG9qby5faXNCdXR0b25UYWcgPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUpIHsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVRydWUgaWYgdGhlIG5vZGUgaXMgQlVUVE9OIG9yIElOUFVULnR5cGU9ImJ1dHRvbiIuDQoJCXJldHVybiBub2RlLnRhZ05hbWUgPT0gIkJVVFRPTiINCgkJCXx8IG5vZGUudGFnTmFtZT09IklOUFVUIiAmJiAobm9kZS5nZXRBdHRyaWJ1dGUoInR5cGUiKXx8JycpLnRvVXBwZXJDYXNlKCkgPT0gIkJVVFRPTiI7IC8vIGJvb2xlYW4NCgl9DQoNCglkb2pvLl91c2VzQm9yZGVyQm94ID0gZnVuY3Rpb24oLypEb21Ob2RlKi9ub2RlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVRydWUgaWYgdGhlIG5vZGUgdXNlcyBib3JkZXItYm94IGxheW91dC4NCg0KCQkvLyBXZSBjb3VsZCB0ZXN0IHRoZSBjb21wdXRlZCBzdHlsZSBvZiBub2RlIHRvIHNlZSBpZiBhIHBhcnRpY3VsYXIgYm94DQoJCS8vIGhhcyBiZWVuIHNwZWNpZmllZCwgYnV0IHRoZXJlIGFyZSBkZXRhaWxzIGFuZCB3ZSBjaG9vc2Ugbm90IHRvIGJvdGhlci4NCg0KCQkvLyBUQUJMRSBhbmQgQlVUVE9OIChhbmQgSU5QVVQgdHlwZT1idXR0b24pIGFyZSBhbHdheXMgYm9yZGVyLWJveCBieSBkZWZhdWx0Lg0KCQkvLyBJZiB5b3UgaGF2ZSBhc3NpZ25lZCBhIGRpZmZlcmVudCBib3ggdG8gZWl0aGVyIG9uZSB2aWEgQ1NTIHRoZW4NCgkJLy8gYm94IGZ1bmN0aW9ucyB3aWxsIGJyZWFrLg0KDQoJCXZhciBuID0gbm9kZS50YWdOYW1lOw0KCQlyZXR1cm4gZC5ib3hNb2RlbD09ImJvcmRlci1ib3giIHx8IG49PSJUQUJMRSIgfHwgZC5faXNCdXR0b25UYWcobm9kZSk7IC8vIGJvb2xlYW4NCgl9DQoNCglkb2pvLl9zZXRDb250ZW50U2l6ZSA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypOdW1iZXIqL3dpZHRoUHgsIC8qTnVtYmVyKi9oZWlnaHRQeCwgLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJU2V0cyB0aGUgc2l6ZSBvZiB0aGUgbm9kZSdzIGNvbnRlbnRzLCBpcnJlc3BlY3RpdmUgb2YgbWFyZ2lucywNCgkJLy8JCXBhZGRpbmcsIG9yIGJvcmRlcnMuDQoJCWlmKGQuX3VzZXNCb3JkZXJCb3gobm9kZSkpew0KCQkJdmFyIHBiID0gZC5fZ2V0UGFkQm9yZGVyRXh0ZW50cyhub2RlLCBjb21wdXRlZFN0eWxlKTsNCgkJCWlmKHdpZHRoUHggPj0gMCl7IHdpZHRoUHggKz0gcGIudzsgfQ0KCQkJaWYoaGVpZ2h0UHggPj0gMCl7IGhlaWdodFB4ICs9IHBiLmg7IH0NCgkJfQ0KCQlkLl9zZXRCb3gobm9kZSwgTmFOLCBOYU4sIHdpZHRoUHgsIGhlaWdodFB4KTsNCgl9DQoNCglkb2pvLl9zZXRNYXJnaW5Cb3ggPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIAkvKk51bWJlcj8qL2xlZnRQeCwgLypOdW1iZXI/Ki90b3BQeCwNCgkJCQkJCQkJCQkJCQkvKk51bWJlcj8qL3dpZHRoUHgsIC8qTnVtYmVyPyovaGVpZ2h0UHgsDQoJCQkJCQkJCQkJCQkJLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJc2V0cyB0aGUgc2l6ZSBvZiB0aGUgbm9kZSdzIG1hcmdpbiBib3ggYW5kIHBsYWNlbWVudA0KCQkvLwkJKGxlZnQvdG9wKSwgaXJyZXNwZWN0aXZlIG9mIGJveCBtb2RlbC4gVGhpbmsgb2YgaXQgYXMgYQ0KCQkvLwkJcGFzc3Rocm91Z2ggdG8gZG9qby5fc2V0Qm94IHRoYXQgaGFuZGxlcyBib3gtbW9kZWwgdmFnYXJpZXMgZm9yDQoJCS8vCQl5b3UuDQoNCgkJdmFyIHMgPSBjb21wdXRlZFN0eWxlIHx8IGdjcyhub2RlKSwNCgkJLy8gU29tZSBlbGVtZW50cyBoYXZlIHNwZWNpYWwgcGFkZGluZywgbWFyZ2luLCBhbmQgYm94LW1vZGVsIHNldHRpbmdzLg0KCQkvLyBUbyB1c2UgYm94IGZ1bmN0aW9ucyB5b3UgbWF5IG5lZWQgdG8gc2V0IHBhZGRpbmcsIG1hcmdpbiBleHBsaWNpdGx5Lg0KCQkvLyBDb250cm9sbGluZyBib3gtbW9kZWwgaXMgaGFyZGVyLCBpbiBhIHBpbmNoIHlvdSBtaWdodCBzZXQgZG9qby5ib3hNb2RlbC4NCgkJCWJiID0gZC5fdXNlc0JvcmRlckJveChub2RlKSwNCgkJCXBiID0gYmIgPyBfbmlsRXh0ZW50cyA6IGQuX2dldFBhZEJvcmRlckV4dGVudHMobm9kZSwgcykNCgkJOw0KCQlpZihkLmlzV2ViS2l0KXsNCgkJCS8vIG9uIFNhZmFyaSAoMy4xLjIpLCBidXR0b24gbm9kZXMgd2l0aCBubyBleHBsaWNpdCBzaXplIGhhdmUgYSBkZWZhdWx0IG1hcmdpbg0KCQkJLy8gc2V0dGluZyBhbiBleHBsaWNpdCBzaXplIGVsaW1pbmF0ZXMgdGhlIG1hcmdpbi4NCgkJCS8vIFdlIGhhdmUgdG8gc3dpenpsZSB0aGUgd2lkdGggdG8gZ2V0IGNvcnJlY3QgbWFyZ2luIHJlYWRpbmcuDQoJCQlpZihkLl9pc0J1dHRvblRhZyhub2RlKSl7DQoJCQkJdmFyIG5zID0gbm9kZS5zdHlsZTsNCgkJCQlpZih3aWR0aFB4ID49IDAgJiYgIW5zLndpZHRoKSB7IG5zLndpZHRoID0gIjRweCI7IH0NCgkJCQlpZihoZWlnaHRQeCA+PSAwICYmICFucy5oZWlnaHQpIHsgbnMuaGVpZ2h0ID0gIjRweCI7IH0NCgkJCX0NCgkJfQ0KCQl2YXIgbWIgPSBkLl9nZXRNYXJnaW5FeHRlbnRzKG5vZGUsIHMpOw0KCQlpZih3aWR0aFB4ID49IDApeyB3aWR0aFB4ID0gTWF0aC5tYXgod2lkdGhQeCAtIHBiLncgLSBtYi53LCAwKTsgfQ0KCQlpZihoZWlnaHRQeCA+PSAwKXsgaGVpZ2h0UHggPSBNYXRoLm1heChoZWlnaHRQeCAtIHBiLmggLSBtYi5oLCAwKTsgfQ0KCQlkLl9zZXRCb3gobm9kZSwgbGVmdFB4LCB0b3BQeCwgd2lkdGhQeCwgaGVpZ2h0UHgpOw0KCX0NCg0KCXZhciBfbmlsRXh0ZW50cyA9IHsgbDowLCB0OjAsIHc6MCwgaDowIH07DQoNCgkvLyBwdWJsaWMgQVBJDQoNCglkb2pvLm1hcmdpbkJveCA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qT2JqZWN0PyovYm94KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUdldHRlci9zZXR0ZXIgZm9yIHRoZSBtYXJnaW4tYm94IG9mIG5vZGUuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJR2V0dGVyL3NldHRlciBmb3IgdGhlIG1hcmdpbi1ib3ggb2Ygbm9kZS4NCgkJLy8JCVJldHVybnMgYW4gb2JqZWN0IGluIHRoZSBleHBlY3RlZCBmb3JtYXQgb2YgYm94IChyZWdhcmRsZXNzDQoJCS8vCQlpZiBib3ggaXMgcGFzc2VkKS4gVGhlIG9iamVjdCBtaWdodCBsb29rIGxpa2U6DQoJCS8vCQkJYHsgbDogNTAsIHQ6IDIwMCwgdzogMzAwOiBoOiAxNTAgfWANCgkJLy8JCWZvciBhIG5vZGUgb2Zmc2V0IGZyb20gaXRzIHBhcmVudCA1MHB4IHRvIHRoZSBsZWZ0LCAyMDBweCBmcm9tDQoJCS8vCQl0aGUgdG9wIHdpdGggYSBtYXJnaW4gd2lkdGggb2YgMzAwcHggYW5kIGEgbWFyZ2luLWhlaWdodCBvZg0KCQkvLwkJMTUwcHguDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gRE9NIE5vZGUgdG8gZ2V0L3NldCBib3ggZm9yDQoJCS8vCWJveDoNCgkJLy8JCUlmIHBhc3NlZCwgZGVub3RlcyB0aGF0IGRvam8ubWFyZ2luQm94KCkgc2hvdWxkDQoJCS8vCQl1cGRhdGUvc2V0IHRoZSBtYXJnaW4gYm94IGZvciBub2RlLiBCb3ggaXMgYW4gb2JqZWN0IGluIHRoZQ0KCQkvLwkJYWJvdmUgZm9ybWF0LiBBbGwgcHJvcGVydGllcyBhcmUgb3B0aW9uYWwgaWYgcGFzc2VkLg0KCQkvLwlleGFtcGxlOg0KCQkvLwlSZXRyaWV2ZSB0aGUgbWFyZ2luYm94IG9mIGEgcGFzc2VkIG5vZGUNCgkJLy8JfAl2YXIgYm94ID0gZG9qby5tYXJnaW5Cb3goInNvbWVOb2RlSWQiKTsNCgkJLy8JfAljb25zb2xlLmRpcihib3gpOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlTZXQgYSBub2RlJ3MgbWFyZ2luYm94IHRvIHRoZSBzaXplIG9mIGFub3RoZXIgbm9kZQ0KCQkvLwl8CXZhciBib3ggPSBkb2pvLm1hcmdpbkJveCgic29tZU5vZGVJZCIpOw0KCQkvLwl8CWRvam8ubWFyZ2luQm94KCJzb21lT3RoZXJOb2RlIiwgYm94KTsNCgkJDQoJCXZhciBuID0gYnlJZChub2RlKSwgcyA9IGdjcyhuKSwgYiA9IGJveDsNCgkJcmV0dXJuICFiID8gZC5fZ2V0TWFyZ2luQm94KG4sIHMpIDogZC5fc2V0TWFyZ2luQm94KG4sIGIubCwgYi50LCBiLncsIGIuaCwgcyk7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uY29udGVudEJveCA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qT2JqZWN0PyovYm94KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUdldHRlci9zZXR0ZXIgZm9yIHRoZSBjb250ZW50LWJveCBvZiBub2RlLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVJldHVybnMgYW4gb2JqZWN0IGluIHRoZSBleHBlY3RlZCBmb3JtYXQgb2YgYm94IChyZWdhcmRsZXNzIGlmIGJveCBpcyBwYXNzZWQpLg0KCQkvLwkJVGhlIG9iamVjdCBtaWdodCBsb29rIGxpa2U6DQoJCS8vCQkJYHsgbDogNTAsIHQ6IDIwMCwgdzogMzAwOiBoOiAxNTAgfWANCgkJLy8JCWZvciBhIG5vZGUgb2Zmc2V0IGZyb20gaXRzIHBhcmVudCA1MHB4IHRvIHRoZSBsZWZ0LCAyMDBweCBmcm9tDQoJCS8vCQl0aGUgdG9wIHdpdGggYSBjb250ZW50IHdpZHRoIG9mIDMwMHB4IGFuZCBhIGNvbnRlbnQtaGVpZ2h0IG9mDQoJCS8vCQkxNTBweC4gTm90ZSB0aGF0IHRoZSBjb250ZW50IGJveCBtYXkgaGF2ZSBhIG11Y2ggbGFyZ2VyIGJvcmRlcg0KCQkvLwkJb3IgbWFyZ2luIGJveCwgZGVwZW5kaW5nIG9uIHRoZSBib3ggbW9kZWwgY3VycmVudGx5IGluIHVzZSBhbmQNCgkJLy8JCUNTUyB2YWx1ZXMgc2V0L2luaGVyaXRlZCBmb3Igbm9kZS4NCgkJLy8JCVdoaWxlIHRoZSBnZXR0ZXIgd2lsbCByZXR1cm4gdG9wIGFuZCBsZWZ0IHZhbHVlcywgdGhlDQoJCS8vCQlzZXR0ZXIgb25seSBhY2NlcHRzIHNldHRpbmcgdGhlIHdpZHRoIGFuZCBoZWlnaHQuDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gRE9NIE5vZGUgdG8gZ2V0L3NldCBib3ggZm9yDQoJCS8vCWJveDoNCgkJLy8JCUlmIHBhc3NlZCwgZGVub3RlcyB0aGF0IGRvam8uY29udGVudEJveCgpIHNob3VsZA0KCQkvLwkJdXBkYXRlL3NldCB0aGUgY29udGVudCBib3ggZm9yIG5vZGUuIEJveCBpcyBhbiBvYmplY3QgaW4gdGhlDQoJCS8vCQlhYm92ZSBmb3JtYXQsIGJ1dCBvbmx5IHcgKHdpZHRoKSBhbmQgaCAoaGVpZ2h0KSBhcmUgc3VwcG9ydGVkLg0KCQkvLwkJQWxsIHByb3BlcnRpZXMgYXJlIG9wdGlvbmFsIGlmIHBhc3NlZC4NCgkJdmFyIG4gPSBieUlkKG5vZGUpLCBzID0gZ2NzKG4pLCBiID0gYm94Ow0KCQlyZXR1cm4gIWIgPyBkLl9nZXRDb250ZW50Qm94KG4sIHMpIDogZC5fc2V0Q29udGVudFNpemUobiwgYi53LCBiLmgsIHMpOyAvLyBPYmplY3QNCgl9DQoNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KCS8vIFBvc2l0aW9uaW5nIA0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCgl2YXIgX3N1bUFuY2VzdG9yUHJvcGVydGllcyA9IGZ1bmN0aW9uKG5vZGUsIHByb3Apew0KCQlpZighKG5vZGUgPSAobm9kZXx8MCkucGFyZW50Tm9kZSkpe3JldHVybiAwfQ0KCQl2YXIgdmFsLCByZXRWYWwgPSAwLCBfYiA9IGQuYm9keSgpOw0KCQl3aGlsZShub2RlICYmIG5vZGUuc3R5bGUpew0KCQkJaWYoZ2NzKG5vZGUpLnBvc2l0aW9uID09ICJmaXhlZCIpew0KCQkJCXJldHVybiAwOw0KCQkJfQ0KCQkJdmFsID0gbm9kZVtwcm9wXTsNCgkJCWlmKHZhbCl7DQoJCQkJcmV0VmFsICs9IHZhbCAtIDA7DQoJCQkJLy8gb3BlcmEgYW5kIGtodG1sICNib2R5ICYgI2h0bWwgaGFzIHRoZSBzYW1lIHZhbHVlcywgd2Ugb25seQ0KCQkJCS8vIG5lZWQgb25lIHZhbHVlDQoJCQkJaWYobm9kZSA9PSBfYil7IGJyZWFrOyB9DQoJCQl9DQoJCQlub2RlID0gbm9kZS5wYXJlbnROb2RlOw0KCQl9DQoJCXJldHVybiByZXRWYWw7CS8vCWludGVnZXINCgl9DQoNCglkb2pvLl9kb2NTY3JvbGwgPSBmdW5jdGlvbigpew0KCQl2YXIgbiA9IGQuZ2xvYmFsOw0KCQlyZXR1cm4gInBhZ2VYT2Zmc2V0IiBpbiBuPyB7IHg6bi5wYWdlWE9mZnNldCwgeTpuLnBhZ2VZT2Zmc2V0IH0gOg0KCQkJKG49ZC5kb2MuZG9jdW1lbnRFbGVtZW50LCBuLmNsaWVudEhlaWdodD8geyB4OmQuX2ZpeEllQmlEaVNjcm9sbExlZnQobi5zY3JvbGxMZWZ0KSwgeTpuLnNjcm9sbFRvcCB9IDoNCgkJCShuPWQuYm9keSgpLCB7IHg6bi5zY3JvbGxMZWZ0fHwwLCB5Om4uc2Nyb2xsVG9wfHwwIH0pKTsNCgl9Ow0KDQoJZG9qby5faXNCb2R5THRyID0gZnVuY3Rpb24oKXsNCgkJcmV0dXJuICJfYm9keUx0ciIgaW4gZD8gZC5fYm9keUx0ciA6DQoJCQlkLl9ib2R5THRyID0gKGQuYm9keSgpLmRpciB8fCBkLmRvYy5kb2N1bWVudEVsZW1lbnQuZGlyIHx8ICJsdHIiKS50b0xvd2VyQ2FzZSgpID09ICJsdHIiOyAvLyBCb29sZWFuIA0KCX0NCg0KCQlkb2pvLl9nZXRJZURvY3VtZW50RWxlbWVudE9mZnNldCA9IGZ1bmN0aW9uKCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlyZXR1cm5zIHRoZSBvZmZzZXQgaW4geCBhbmQgeSBmcm9tIHRoZSBkb2N1bWVudCBib2R5IHRvIHRoZQ0KCQkvLwkJdmlzdWFsIGVkZ2Ugb2YgdGhlIHBhZ2UNCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vIFRoZSBmb2xsb3dpbmcgdmFsdWVzIGluIElFIGNvbnRhaW4gYW4gb2Zmc2V0Og0KCQkvLwl8CQlldmVudC5jbGllbnRYDQoJCS8vCXwJCWV2ZW50LmNsaWVudFkNCgkJLy8JfAkJbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0DQoJCS8vCXwJCW5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wDQoJCS8vCSAJQnV0IG90aGVyIHBvc2l0aW9uIHJlbGF0ZWQgdmFsdWVzIGRvIG5vdCBjb250YWluIHRoaXMgb2Zmc2V0LA0KCQkvLwkgCXN1Y2ggYXMgbm9kZS5vZmZzZXRMZWZ0LCBub2RlLm9mZnNldFRvcCwgbm9kZS5zdHlsZS5sZWZ0IGFuZA0KCQkvLwkgCW5vZGUuc3R5bGUudG9wLiBUaGUgb2Zmc2V0IGlzIGFsd2F5cyAoMiwgMikgaW4gTFRSIGRpcmVjdGlvbi4NCgkJLy8JIAlXaGVuIHRoZSBib2R5IGlzIGluIFJUTCBkaXJlY3Rpb24sIHRoZSBvZmZzZXQgY291bnRzIHRoZSB3aWR0aA0KCQkvLwkgCW9mIGxlZnQgc2Nyb2xsIGJhcidzIHdpZHRoLiAgVGhpcyBmdW5jdGlvbiBjb21wdXRlcyB0aGUgYWN0dWFsDQoJCS8vCSAJb2Zmc2V0Lg0KDQoJCS8vTk9URTogYXNzdW1lcyB3ZSdyZSBiZWluZyBjYWxsZWQgaW4gYW4gSUUgYnJvd3Nlcg0KDQoJCXZhciBkZSA9IGQuZG9jLmRvY3VtZW50RWxlbWVudDsgLy8gb25seSBkZWFsIHdpdGggSFRNTCBlbGVtZW50IGhlcmUsIF9hYnMgaGFuZGxlcyBib2R5L3F1aXJrcyANCg0KCQlpZihkLmlzSUUgPCA4KXsNCgkJCXZhciByID0gZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7IC8vIHdvcmtzIHdlbGwgZm9yIElFNisNCgkJCS8vY29uc29sZS5kZWJ1ZygncmVjdCBsZWZ0LHRvcCA9ICcgKyByLmxlZnQrJywnK3IudG9wICsgJywgaHRtbCBjbGllbnQgbGVmdC90b3AgPSAnICsgZGUuY2xpZW50TGVmdCsnLCcrZGUuY2xpZW50VG9wICsgJywgcnRsID0gJyArICghZC5faXNCb2R5THRyKCkpICsgJywgcXVpcmtzID0gJyArIGQuaXNRdWlya3MpOw0KCQkJdmFyIGwgPSByLmxlZnQsDQoJCQkgICAgdCA9IHIudG9wOw0KCQkJaWYoZC5pc0lFIDwgNyl7DQoJCQkJbCArPSBkZS5jbGllbnRMZWZ0OwkvLyBzY3JvbGxiYXIgc2l6ZSBpbiBzdHJpY3QvUlRMLCBvciwNCgkJCQl0ICs9IGRlLmNsaWVudFRvcDsJLy8gSFRNTCBib3JkZXIgc2l6ZSBpbiBzdHJpY3QNCgkJCX0NCgkJCXJldHVybiB7DQoJCQkJeDogbCA8IDA/IDAgOiBsLCAvLyBGUkFNRSBlbGVtZW50IGJvcmRlciBzaXplIGNhbiBsZWFkIHRvIGluYWNjdXJhdGUgbmVnYXRpdmUgdmFsdWVzDQoJCQkJeTogdCA8IDA/IDAgOiB0DQoJCQl9Ow0KCQl9ZWxzZXsNCgkJCXJldHVybiB7DQoJCQkJeDogMCwNCgkJCQl5OiAwDQoJCQl9Ow0KCQl9DQoNCgl9Ow0KCQ0KCWRvam8uX2ZpeEllQmlEaVNjcm9sbExlZnQgPSBmdW5jdGlvbigvKkludGVnZXIqLyBzY3JvbGxMZWZ0KXsNCgkJLy8gSW4gUlRMIGRpcmVjdGlvbiwgc2Nyb2xsTGVmdCBzaG91bGQgYmUgYSBuZWdhdGl2ZSB2YWx1ZSwgYnV0IElFIDwgOA0KCQkvLyByZXR1cm5zIGEgcG9zaXRpdmUgb25lLiBBbGwgY29kZXMgdXNpbmcgZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQNCgkJLy8gbXVzdCBjYWxsIHRoaXMgZnVuY3Rpb24gdG8gZml4IHRoaXMgZXJyb3IsIG90aGVyd2lzZSB0aGUgcG9zaXRpb24NCgkJLy8gd2lsbCBvZmZzZXQgdG8gcmlnaHQgd2hlbiB0aGVyZSBpcyBhIGhvcml6b250YWwgc2Nyb2xsYmFyLg0KDQoJCQkJdmFyIGRkID0gZC5kb2M7DQoJCWlmKGQuaXNJRSA8IDggJiYgIWQuX2lzQm9keUx0cigpKXsNCgkJCXZhciBkZSA9IGQuaXNRdWlya3MgPyBkZC5ib2R5IDogZGQuZG9jdW1lbnRFbGVtZW50Ow0KCQkJcmV0dXJuIHNjcm9sbExlZnQgKyBkZS5jbGllbnRXaWR0aCAtIGRlLnNjcm9sbFdpZHRoOyAvLyBJbnRlZ2VyDQoJCX0NCgkJCQlyZXR1cm4gc2Nyb2xsTGVmdDsgLy8gSW50ZWdlcg0KCX0NCg0KCS8vIEZJWE1FOiBuZWVkIGEgc2V0dGVyIGZvciBjb29yZHMgb3IgYSBtb3ZlVG8hIQ0KCWRvam8uX2FicyA9IGRvam8ucG9zaXRpb24gPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIC8qQm9vbGVhbj8qL2luY2x1ZGVTY3JvbGwpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJR2V0cyB0aGUgcG9zaXRpb24gYW5kIHNpemUgb2YgdGhlIHBhc3NlZCBlbGVtZW50IHJlbGF0aXZlIHRvDQoJCS8vCQl0aGUgdmlld3BvcnQgKGlmIGluY2x1ZGVTY3JvbGw9PWZhbHNlKSwgb3IgcmVsYXRpdmUgdG8gdGhlDQoJCS8vCQlkb2N1bWVudCByb290IChpZiBpbmNsdWRlU2Nyb2xsPT10cnVlKS4NCgkJLy8NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlSZXR1cm5zIGFuIG9iamVjdCBvZiB0aGUgZm9ybToNCgkJLy8JCQl7IHg6IDEwMCwgeTogMzAwLCB3OiAyMCwgaDogMTUgfQ0KCQkvLwkJSWYgaW5jbHVkZVNjcm9sbD09dHJ1ZSwgdGhlIHggYW5kIHkgdmFsdWVzIHdpbGwgaW5jbHVkZSBhbnkNCgkJLy8JCWRvY3VtZW50IG9mZnNldHMgdGhhdCBtYXkgYWZmZWN0IHRoZSBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUNCgkJLy8JCXZpZXdwb3J0Lg0KCQkvLwkJVXNlcyB0aGUgYm9yZGVyLWJveCBtb2RlbCAoaW5jbHVzaXZlIG9mIGJvcmRlciBhbmQgcGFkZGluZyBidXQNCgkJLy8JCW5vdCBtYXJnaW4pLiAgRG9lcyBub3QgYWN0IGFzIGEgc2V0dGVyLg0KDQoJCXZhciBkYiA9IGQuYm9keSgpLCBkaCA9IGRiLnBhcmVudE5vZGUsIHJldDsNCgkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCWlmKG5vZGVbImdldEJvdW5kaW5nQ2xpZW50UmVjdCJdKXsNCgkJCS8vIElFNissIEZGMyssIHN1cGVyLW1vZGVybiBXZWJLaXQsIGFuZCBPcGVyYSA5LjYrIGFsbCB0YWtlIHRoaXMgYnJhbmNoDQoJCQlyZXQgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KCQkJcmV0ID0geyB4OiByZXQubGVmdCwgeTogcmV0LnRvcCwgdzogcmV0LnJpZ2h0IC0gcmV0LmxlZnQsIGg6IHJldC5ib3R0b20gLSByZXQudG9wIH07DQoJCQkJCWlmKGQuaXNJRSl7DQoJCQkJLy8gT24gSUUgdGhlcmUncyBhIDJweCBvZmZzZXQgdGhhdCB3ZSBuZWVkIHRvIGFkanVzdCBmb3IsIHNlZSBfZ2V0SWVEb2N1bWVudEVsZW1lbnRPZmZzZXQoKQ0KCQkJCXZhciBvZmZzZXQgPSBkLl9nZXRJZURvY3VtZW50RWxlbWVudE9mZnNldCgpOw0KDQoJCQkJLy8gZml4ZXMgdGhlIHBvc2l0aW9uIGluIElFLCBxdWlya3MgbW9kZQ0KCQkJCXJldC54IC09IG9mZnNldC54ICsgKGQuaXNRdWlya3MgPyBkYi5jbGllbnRMZWZ0K2RiLm9mZnNldExlZnQgOiAwKTsNCgkJCQlyZXQueSAtPSBvZmZzZXQueSArIChkLmlzUXVpcmtzID8gZGIuY2xpZW50VG9wK2RiLm9mZnNldFRvcCA6IDApOw0KCQkJfWVsc2UgaWYoZC5pc0ZGID09IDMpew0KCQkJCS8vIEluIEZGMyB5b3UgaGF2ZSB0byBzdWJ0cmFjdCB0aGUgZG9jdW1lbnQgZWxlbWVudCBtYXJnaW5zLg0KCQkJCS8vIEZpeGVkIGluIEZGMy41IHRob3VnaC4NCgkJCQl2YXIgY3MgPSBnY3MoZGgpOw0KCQkJCXJldC54IC09IHB4KGRoLCBjcy5tYXJnaW5MZWZ0KSArIHB4KGRoLCBjcy5ib3JkZXJMZWZ0V2lkdGgpOw0KCQkJCXJldC55IC09IHB4KGRoLCBjcy5tYXJnaW5Ub3ApICsgcHgoZGgsIGNzLmJvcmRlclRvcFdpZHRoKTsNCgkJCX0NCgkJCQl9ZWxzZXsNCgkJCS8vIEZGMiBhbmQgb2xkZXIgV2ViS2l0DQoJCQlyZXQgPSB7DQoJCQkJeDogMCwNCgkJCQl5OiAwLA0KCQkJCXc6IG5vZGUub2Zmc2V0V2lkdGgsDQoJCQkJaDogbm9kZS5vZmZzZXRIZWlnaHQNCgkJCX07DQoJCQlpZihub2RlWyJvZmZzZXRQYXJlbnQiXSl7DQoJCQkJcmV0LnggLT0gX3N1bUFuY2VzdG9yUHJvcGVydGllcyhub2RlLCAic2Nyb2xsTGVmdCIpOw0KCQkJCXJldC55IC09IF9zdW1BbmNlc3RvclByb3BlcnRpZXMobm9kZSwgInNjcm9sbFRvcCIpOw0KDQoJCQkJdmFyIGN1cm5vZGUgPSBub2RlOw0KCQkJCWRvew0KCQkJCQl2YXIgbiA9IGN1cm5vZGUub2Zmc2V0TGVmdCwNCgkJCQkJCXQgPSBjdXJub2RlLm9mZnNldFRvcDsNCgkJCQkJcmV0LnggKz0gaXNOYU4obikgPyAwIDogbjsNCgkJCQkJcmV0LnkgKz0gaXNOYU4odCkgPyAwIDogdDsNCg0KCQkJCQljcyA9IGdjcyhjdXJub2RlKTsNCgkJCQkJaWYoY3Vybm9kZSAhPSBub2RlKXsNCgkJCQkJCQkJaWYoZC5pc01veil7DQoJCQkJCQkJLy8gdHJpZWQgbGVmdCtyaWdodCB3aXRoIGRpZmZlcmVudGx5IHNpemVkIGxlZnQvcmlnaHQgYm9yZGVycw0KCQkJCQkJCS8vIGl0IHJlYWxseSBpcyAyeGxlZnQgYm9yZGVyIGluIEZGLCBub3QgbGVmdCtyaWdodCwgZXZlbiBpbiBSVEwhDQoJCQkJCQkJcmV0LnggKz0gMiAqIHB4KGN1cm5vZGUsY3MuYm9yZGVyTGVmdFdpZHRoKTsNCgkJCQkJCQlyZXQueSArPSAyICogcHgoY3Vybm9kZSxjcy5ib3JkZXJUb3BXaWR0aCk7DQoJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJCXJldC54ICs9IHB4KGN1cm5vZGUsIGNzLmJvcmRlckxlZnRXaWR0aCk7DQoJCQkJCQkJcmV0LnkgKz0gcHgoY3Vybm9kZSwgY3MuYm9yZGVyVG9wV2lkdGgpOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkvLyBzdGF0aWMgY2hpbGRyZW4gaW4gYSBzdGF0aWMgZGl2IGluIEZGMiBhcmUgYWZmZWN0ZWQgYnkgdGhlIGRpdidzIGJvcmRlciBhcyB3ZWxsDQoJCQkJCS8vIGJ1dCBvZmZzZXRQYXJlbnQgd2lsbCBza2lwIHRoaXMgZGl2IQ0KCQkJCQkJCWlmKGQuaXNNb3ogJiYgY3MucG9zaXRpb249PSJzdGF0aWMiKXsNCgkJCQkJCXZhciBwYXJlbnQ9Y3Vybm9kZS5wYXJlbnROb2RlOw0KCQkJCQkJd2hpbGUocGFyZW50IT1jdXJub2RlLm9mZnNldFBhcmVudCl7DQoJCQkJCQkJdmFyIHBjcz1nY3MocGFyZW50KTsNCgkJCQkJCQlpZihwY3MucG9zaXRpb249PSJzdGF0aWMiKXsNCgkJCQkJCQkJcmV0LnggKz0gcHgoY3Vybm9kZSxwY3MuYm9yZGVyTGVmdFdpZHRoKTsNCgkJCQkJCQkJcmV0LnkgKz0gcHgoY3Vybm9kZSxwY3MuYm9yZGVyVG9wV2lkdGgpOw0KCQkJCQkJCX0NCgkJCQkJCQlwYXJlbnQ9cGFyZW50LnBhcmVudE5vZGU7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJCQljdXJub2RlID0gY3Vybm9kZS5vZmZzZXRQYXJlbnQ7DQoJCQkJfXdoaWxlKChjdXJub2RlICE9IGRoKSAmJiBjdXJub2RlKTsNCgkJCX1lbHNlIGlmKG5vZGUueCAmJiBub2RlLnkpew0KCQkJCXJldC54ICs9IGlzTmFOKG5vZGUueCkgPyAwIDogbm9kZS54Ow0KCQkJCXJldC55ICs9IGlzTmFOKG5vZGUueSkgPyAwIDogbm9kZS55Ow0KCQkJfQ0KCQl9DQoJCS8vIGFjY291bnQgZm9yIGRvY3VtZW50IHNjcm9sbGluZw0KCQkvLyBpZiBvZmZzZXRQYXJlbnQgaXMgdXNlZCwgcmV0IHZhbHVlIGFscmVhZHkgaW5jbHVkZXMgc2Nyb2xsIHBvc2l0aW9uDQoJCS8vIHNvIHdlIG1heSBoYXZlIHRvIGFjdHVhbGx5IHJlbW92ZSB0aGF0IHZhbHVlIGlmICFpbmNsdWRlU2Nyb2xsDQoJCWlmKGluY2x1ZGVTY3JvbGwpew0KCQkJdmFyIHNjcm9sbCA9IGQuX2RvY1Njcm9sbCgpOw0KCQkJcmV0LnggKz0gc2Nyb2xsLng7DQoJCQlyZXQueSArPSBzY3JvbGwueTsNCgkJfQ0KDQoJCXJldHVybiByZXQ7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uY29vcmRzID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypCb29sZWFuPyovaW5jbHVkZVNjcm9sbCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlEZXByZWNhdGVkOiBVc2UgcG9zaXRpb24oKSBmb3IgYm9yZGVyLWJveCB4L3kvdy9oDQoJCS8vCQlvciBtYXJnaW5Cb3goKSBmb3IgbWFyZ2luLWJveCB3L2gvbC90Lg0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3QgcmVwcmVzZW50aW5nIGEgbm9kZSdzIHNpemUgYW5kIHBvc2l0aW9uLg0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVJldHVybnMgYW4gb2JqZWN0IHRoYXQgbWVhc3VyZXMgbWFyZ2luLWJveCAodylpZHRoLyhoKWVpZ2h0DQoJCS8vCQlhbmQgYWJzb2x1dGUgcG9zaXRpb24geC95IG9mIHRoZSBib3JkZXItYm94LiBBbHNvIHJldHVybmVkDQoJCS8vCQlpcyBjb21wdXRlZCAobCllZnQgYW5kICh0KW9wIHZhbHVlcyBpbiBwaXhlbHMgZnJvbSB0aGUNCgkJLy8JCW5vZGUncyBvZmZzZXRQYXJlbnQgYXMgcmV0dXJuZWQgZnJvbSBtYXJnaW5Cb3goKS4NCgkJLy8JCVJldHVybiB2YWx1ZSB3aWxsIGJlIGluIHRoZSBmb3JtOg0KCQkvL3wJCQl7IGw6IDUwLCB0OiAyMDAsIHc6IDMwMDogaDogMTUwLCB4OiAxMDAsIHk6IDMwMCB9DQoJCS8vCQlEb2VzIG5vdCBhY3QgYXMgYSBzZXR0ZXIuIElmIGluY2x1ZGVTY3JvbGwgaXMgcGFzc2VkLCB0aGUgeCBhbmQNCgkJLy8JCXkgcGFyYW1zIGFyZSBhZmZlY3RlZCBhcyBvbmUgd291bGQgZXhwZWN0IGluIGRvam8ucG9zaXRpb24oKS4NCgkJdmFyIG4gPSBieUlkKG5vZGUpLCBzID0gZ2NzKG4pLCBtYiA9IGQuX2dldE1hcmdpbkJveChuLCBzKTsNCgkJdmFyIGFicyA9IGQucG9zaXRpb24obiwgaW5jbHVkZVNjcm9sbCk7DQoJCW1iLnggPSBhYnMueDsNCgkJbWIueSA9IGFicy55Ow0KCQlyZXR1cm4gbWI7DQoJfQ0KDQoJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCgkvLyBFbGVtZW50IGF0dHJpYnV0ZSBGdW5jdGlvbnMNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KDQoJLy8gZG9qby5hdHRyKCkgc2hvdWxkIGNvbmZvcm0gdG8gaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItQ29yZS8NCg0KCXZhciBfcHJvcE5hbWVzID0gew0KCQkJLy8gcHJvcGVydGllcyByZW5hbWVkIHRvIGF2b2lkIGNsYXNoZXMgd2l0aCByZXNlcnZlZCB3b3Jkcw0KCQkJImNsYXNzIjogICAiY2xhc3NOYW1lIiwNCgkJCSJmb3IiOiAgICAgImh0bWxGb3IiLA0KCQkJLy8gcHJvcGVydGllcyB3cml0dGVuIGFzIGNhbWVsQ2FzZQ0KCQkJdGFiaW5kZXg6ICAidGFiSW5kZXgiLA0KCQkJcmVhZG9ubHk6ICAicmVhZE9ubHkiLA0KCQkJY29sc3BhbjogICAiY29sU3BhbiIsDQoJCQlmcmFtZWJvcmRlcjogImZyYW1lQm9yZGVyIiwNCgkJCXJvd3NwYW46ICAgInJvd1NwYW4iLA0KCQkJdmFsdWV0eXBlOiAidmFsdWVUeXBlIg0KCQl9LA0KCQlfYXR0ck5hbWVzID0gew0KCQkJLy8gb3JpZ2luYWwgYXR0cmlidXRlIG5hbWVzDQoJCQljbGFzc25hbWU6ICJjbGFzcyIsDQoJCQlodG1sZm9yOiAgICJmb3IiLA0KCQkJLy8gZm9yIElFDQoJCQl0YWJpbmRleDogICJ0YWJJbmRleCIsDQoJCQlyZWFkb25seTogICJyZWFkT25seSINCgkJfSwNCgkJX2ZvcmNlUHJvcE5hbWVzID0gew0KCQkJaW5uZXJIVE1MOiAxLA0KCQkJY2xhc3NOYW1lOiAxLA0KCQkJaHRtbEZvcjogICBkLmlzSUUsDQoJCQl2YWx1ZTogICAgIDENCgkJfTsNCg0KCXZhciBfZml4QXR0ck5hbWUgPSBmdW5jdGlvbigvKlN0cmluZyovIG5hbWUpew0KCQlyZXR1cm4gX2F0dHJOYW1lc1tuYW1lLnRvTG93ZXJDYXNlKCldIHx8IG5hbWU7DQoJfTsNCg0KCXZhciBfaGFzQXR0ciA9IGZ1bmN0aW9uKG5vZGUsIG5hbWUpew0KCQl2YXIgYXR0ciA9IG5vZGUuZ2V0QXR0cmlidXRlTm9kZSAmJiBub2RlLmdldEF0dHJpYnV0ZU5vZGUobmFtZSk7DQoJCXJldHVybiBhdHRyICYmIGF0dHIuc3BlY2lmaWVkOyAvLyBCb29sZWFuDQoJfTsNCg0KCS8vIFRoZXJlIGlzIGEgZGlmZmVyZW5jZSBpbiB0aGUgcHJlc2VuY2Ugb2YgY2VydGFpbiBwcm9wZXJ0aWVzIGFuZCB0aGVpciBkZWZhdWx0IHZhbHVlcw0KCS8vIGJldHdlZW4gYnJvd3NlcnMuIEZvciBleGFtcGxlLCBvbiBJRSAiZGlzYWJsZWQiIGlzIHByZXNlbnQgb24gYWxsIGVsZW1lbnRzLA0KCS8vIGJ1dCBpdCBpcyB2YWx1ZSBpcyAiZmFsc2UiOyAidGFiSW5kZXgiIG9mIDxkaXY+IHJldHVybnMgMCBieSBkZWZhdWx0IG9uIElFLCB5ZXQgb3RoZXIgYnJvd3NlcnMNCgkvLyBjYW4gcmV0dXJuIC0xLg0KDQoJZG9qby5oYXNBdHRyID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypTdHJpbmcqL25hbWUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyB0cnVlIGlmIHRoZSByZXF1ZXN0ZWQgYXR0cmlidXRlIGlzIHNwZWNpZmllZCBvbiB0aGUNCgkJLy8JCWdpdmVuIGVsZW1lbnQsIGFuZCBmYWxzZSBvdGhlcndpc2UuDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gY2hlY2sNCgkJLy8JbmFtZToNCgkJLy8JCXRoZSBuYW1lIG9mIHRoZSBhdHRyaWJ1dGUNCgkJLy8JcmV0dXJuczoNCgkJLy8JCXRydWUgaWYgdGhlIHJlcXVlc3RlZCBhdHRyaWJ1dGUgaXMgc3BlY2lmaWVkIG9uIHRoZQ0KCQkvLwkJZ2l2ZW4gZWxlbWVudCwgYW5kIGZhbHNlIG90aGVyd2lzZQ0KCQl2YXIgbGMgPSBuYW1lLnRvTG93ZXJDYXNlKCk7DQoJCXJldHVybiBfZm9yY2VQcm9wTmFtZXNbX3Byb3BOYW1lc1tsY10gfHwgbmFtZV0gfHwgX2hhc0F0dHIoYnlJZChub2RlKSwgX2F0dHJOYW1lc1tsY10gfHwgbmFtZSk7CS8vIEJvb2xlYW4NCgl9DQoNCgl2YXIgX2V2dEhkbHJNYXAgPSB7fSwgX2N0ciA9IDAsDQoJCV9hdHRySWQgPSBkb2pvLl9zY29wZU5hbWUgKyAiYXR0cmlkIiwNCgkJLy8gdGhlIG5leHQgZGljdGlvbmFyeSBsaXN0cyBlbGVtZW50cyB3aXRoIHJlYWQtb25seSBpbm5lckhUTUwgb24gSUUNCgkJX3JvSW5uZXJIdG1sID0ge2NvbDogMSwgY29sZ3JvdXA6IDEsDQoJCQkvLyBmcmFtZXNldDogMSwgaGVhZDogMSwgaHRtbDogMSwgc3R5bGU6IDEsDQoJCQl0YWJsZTogMSwgdGJvZHk6IDEsIHRmb290OiAxLCB0aGVhZDogMSwgdHI6IDEsIHRpdGxlOiAxfTsNCg0KCWRvam8uYXR0ciA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qU3RyaW5nfE9iamVjdCovbmFtZSwgLypTdHJpbmc/Ki92YWx1ZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlHZXRzIG9yIHNldHMgYW4gYXR0cmlidXRlIG9uIGFuIEhUTUwgZWxlbWVudC4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlIYW5kbGVzIG5vcm1hbGl6ZWQgZ2V0dGluZyBhbmQgc2V0dGluZyBvZiBhdHRyaWJ1dGVzIG9uIERPTQ0KCQkvLwkJTm9kZXMuIElmIDIgYXJndW1lbnRzIGFyZSBwYXNzZWQsIGFuZCBhIHRoZSBzZWNvbmQgYXJndW1udCBpcyBhDQoJCS8vCQlzdHJpbmcsIGFjdHMgYXMgYSBnZXR0ZXIuDQoJCS8vDQoJCS8vCQlJZiBhIHRoaXJkIGFyZ3VtZW50IGlzIHBhc3NlZCwgb3IgaWYgdGhlIHNlY29uZCBhcmd1bWVudCBpcyBhDQoJCS8vCQltYXAgb2YgYXR0cmlidXRlcywgYWN0cyBhcyBhIHNldHRlci4NCgkJLy8NCgkJLy8JCVdoZW4gcGFzc2luZyBmdW5jdGlvbnMgYXMgdmFsdWVzLCBub3RlIHRoYXQgdGhleSB3aWxsIG5vdCBiZQ0KCQkvLwkJZGlyZWN0bHkgYXNzaWduZWQgdG8gc2xvdHMgb24gdGhlIG5vZGUsIGJ1dCByYXRoZXIgdGhlIGRlZmF1bHQNCgkJLy8JCWJlaGF2aW9yIHdpbGwgYmUgcmVtb3ZlZCBhbmQgdGhlIG5ldyBiZWhhdmlvciB3aWxsIGJlIGFkZGVkDQoJCS8vCQl1c2luZyBgZG9qby5jb25uZWN0KClgLCBtZWFuaW5nIHRoYXQgZXZlbnQgaGFuZGxlciBwcm9wZXJ0aWVzDQoJCS8vCQl3aWxsIGJlIG5vcm1hbGl6ZWQgYW5kIHRoYXQgc29tZSBjYXZlYXRzIHdpdGggcmVnYXJkcyB0bw0KCQkvLwkJbm9uLXN0YW5kYXJkIGJlaGF2aW9ycyBmb3Igb25zdWJtaXQgYXBwbHkuIE5hbWVseSB0aGF0IHlvdQ0KCQkvLwkJc2hvdWxkIGNhbmNlbCBmb3JtIHN1Ym1pc3Npb24gdXNpbmcgYGRvam8uc3RvcEV2ZW50KClgIG9uIHRoZQ0KCQkvLwkJcGFzc2VkIGV2ZW50IG9iamVjdCBpbnN0ZWFkIG9mIHJldHVybmluZyBhIGJvb2xlYW4gdmFsdWUgZnJvbQ0KCQkvLwkJdGhlIGhhbmRsZXIgaXRzZWxmLg0KCQkvLwlub2RlOg0KCQkvLwkJaWQgb3IgcmVmZXJlbmNlIHRvIHRoZSBlbGVtZW50IHRvIGdldCBvciBzZXQgdGhlIGF0dHJpYnV0ZSBvbg0KCQkvLwluYW1lOg0KCQkvLwkJdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBnZXQgb3Igc2V0Lg0KCQkvLwl2YWx1ZToNCgkJLy8JCVRoZSB2YWx1ZSB0byBzZXQgZm9yIHRoZSBhdHRyaWJ1dGUNCgkJLy8JcmV0dXJuczoNCgkJLy8JCXdoZW4gdXNlZCBhcyBhIGdldHRlciwgdGhlIHZhbHVlIG9mIHRoZSByZXF1ZXN0ZWQgYXR0cmlidXRlDQoJCS8vCQlvciBudWxsIGlmIHRoYXQgYXR0cmlidXRlIGRvZXMgbm90IGhhdmUgYSBzcGVjaWZpZWQgb3INCgkJLy8JCWRlZmF1bHQgdmFsdWU7DQoJCS8vDQoJCS8vCQl3aGVuIHVzZWQgYXMgYSBzZXR0ZXIsIHRoZSBET00gbm9kZQ0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CS8vIGdldCB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgImZvbyIgYXR0cmlidXRlIG9uIGEgbm9kZQ0KCQkvLwl8CWRvam8uYXR0cihkb2pvLmJ5SWQoIm5vZGVJZCIpLCAiZm9vIik7DQoJCS8vCXwJLy8gb3Igd2UgY2FuIGp1c3QgcGFzcyB0aGUgaWQ6DQoJCS8vCXwJZG9qby5hdHRyKCJub2RlSWQiLCAiZm9vIik7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gdXNlIGF0dHIoKSB0byBzZXQgdGhlIHRhYiBpbmRleA0KCQkvLwl8CWRvam8uYXR0cigibm9kZUlkIiwgInRhYkluZGV4IiwgMyk7DQoJCS8vCXwNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JU2V0IG11bHRpcGxlIHZhbHVlcyBhdCBvbmNlLCBpbmNsdWRpbmcgZXZlbnQgaGFuZGxlcnM6DQoJCS8vCXwJZG9qby5hdHRyKCJmb3JtSWQiLCB7DQoJCS8vCXwJCSJmb28iOiAiYmFyIiwNCgkJLy8JfAkJInRhYkluZGV4IjogLTEsDQoJCS8vCXwJCSJtZXRob2QiOiAiUE9TVCIsDQoJCS8vCXwJCSJvbnN1Ym1pdCI6IGZ1bmN0aW9uKGUpew0KCQkvLwl8CQkJLy8gc3RvcCBzdWJtaXR0aW5nIHRoZSBmb3JtLiBOb3RlIHRoYXQgdGhlIElFIGJlaGF2aW9yDQoJCS8vCXwJCQkvLyBvZiByZXR1cm5pbmcgdHJ1ZSBvciBmYWxzZSB3aWxsIGhhdmUgbm8gZWZmZWN0IGhlcmUNCgkJLy8JfAkJCS8vIHNpbmNlIG91ciBoYW5kbGVyIGlzIGNvbm5lY3QoKWVkIHRvIHRoZSBidWlsdC1pbg0KCQkvLwl8CQkJLy8gb25zdWJtaXQgYmVoYXZpb3IgYW5kIHNvIHdlIG5lZWQgdG8gdXNlDQoJCS8vCXwJCQkvLyBkb2pvLnN0b3BFdmVudCgpIHRvIGVuc3VyZSB0aGF0IHRoZSBzdWJtaXNzaW9uDQoJCS8vCXwJCQkvLyBkb2Vzbid0IHByb2NlZWQuDQoJCS8vCXwJCQlkb2pvLnN0b3BFdmVudChlKTsNCgkJLy8JfA0KCQkvLwl8CQkJLy8gc3VibWl0IHRoZSBmb3JtIHdpdGggQWpheA0KCQkvLwl8CQkJZG9qby54aHJQb3N0KHsgZm9ybTogImZvcm1JZCIgfSk7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JU3R5bGUgaXMgcyBzcGVjaWFsIGNhc2U6IE9ubHkgc2V0IHdpdGggYW4gb2JqZWN0IGhhc2ggb2Ygc3R5bGVzDQoJCS8vCXwJZG9qby5hdHRyKCJzb21lTm9kZSIsew0KCQkvLwl8CQlpZDoiYmFyIiwNCgkJLy8JfAkJc3R5bGU6ew0KCQkvLwl8CQkJd2lkdGg6IjIwMHB4IiwgaGVpZ2h0OiIxMDBweCIsIGNvbG9yOiIjMDAwIg0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCUFnYWluLCBvbmx5IHNldCBzdHlsZSBhcyBhbiBvYmplY3QgaGFzaCBvZiBzdHlsZXM6DQoJCS8vCXwJdmFyIG9iaiA9IHsgY29sb3I6IiNmZmYiLCBiYWNrZ3JvdW5kQ29sb3I6IiMwMDAiIH07DQoJCS8vCXwJZG9qby5hdHRyKCJzb21lTm9kZSIsICJzdHlsZSIsIG9iaik7DQoJCS8vCXwNCgkJLy8JfAkvLyB0aG91Z2ggc2hvcnRlciB0byB1c2UgYGRvam8uc3R5bGUoKWAgaW4gdGhpcyBjYXNlOg0KCQkvLwl8CWRvam8uc3R5bGUoInNvbWVOb2RlIiwgb2JqKTsNCg0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJdmFyIGFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoLCBwcm9wOw0KCQlpZihhcmdzID09IDIgJiYgdHlwZW9mIG5hbWUgIT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQkvLyB0aGUgb2JqZWN0IGZvcm0gb2Ygc2V0dGVyOiB0aGUgMm5kIGFyZ3VtZW50IGlzIGEgZGljdGlvbmFyeQ0KCQkJZm9yKHZhciB4IGluIG5hbWUpew0KCQkJCWQuYXR0cihub2RlLCB4LCBuYW1lW3hdKTsNCgkJCX0NCgkJCXJldHVybiBub2RlOyAvLyBEb21Ob2RlDQoJCX0NCgkJdmFyIGxjID0gbmFtZS50b0xvd2VyQ2FzZSgpLA0KCQkJcHJvcE5hbWUgPSBfcHJvcE5hbWVzW2xjXSB8fCBuYW1lLA0KCQkJZm9yY2VQcm9wID0gX2ZvcmNlUHJvcE5hbWVzW3Byb3BOYW1lXSwNCgkJCWF0dHJOYW1lID0gX2F0dHJOYW1lc1tsY10gfHwgbmFtZTsNCgkJaWYoYXJncyA9PSAzKXsNCgkJCS8vIHNldHRlcg0KCQkJZG97DQoJCQkJaWYocHJvcE5hbWUgPT0gInN0eWxlIiAmJiB0eXBlb2YgdmFsdWUgIT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQkJCS8vIHNwZWNpYWwgY2FzZTogc2V0dGluZyBhIHN0eWxlDQoJCQkJCWQuc3R5bGUobm9kZSwgdmFsdWUpOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJaWYocHJvcE5hbWUgPT0gImlubmVySFRNTCIpew0KCQkJCQkvLyBzcGVjaWFsIGNhc2U6IGFzc2lnbmluZyBIVE1MDQoJCQkJCQkJCQkJaWYoZC5pc0lFICYmIG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpIGluIF9yb0lubmVySHRtbCl7DQoJCQkJCQlkLmVtcHR5KG5vZGUpOw0KCQkJCQkJbm9kZS5hcHBlbmRDaGlsZChkLl90b0RvbSh2YWx1ZSwgbm9kZS5vd25lckRvY3VtZW50KSk7DQoJCQkJCX1lbHNlew0KCQkJCQkJCQkJCQlub2RlW3Byb3BOYW1lXSA9IHZhbHVlOw0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJaWYoZC5pc0Z1bmN0aW9uKHZhbHVlKSl7DQoJCQkJCS8vIHNwZWNpYWwgY2FzZTogYXNzaWduaW5nIGFuIGV2ZW50IGhhbmRsZXINCgkJCQkJLy8gY2xvYmJlciBpZiB3ZSBjYW4NCgkJCQkJdmFyIGF0dHJJZCA9IGQuYXR0cihub2RlLCBfYXR0cklkKTsNCgkJCQkJaWYoIWF0dHJJZCl7DQoJCQkJCQlhdHRySWQgPSBfY3RyKys7DQoJCQkJCQlkLmF0dHIobm9kZSwgX2F0dHJJZCwgYXR0cklkKTsNCgkJCQkJfQ0KCQkJCQlpZighX2V2dEhkbHJNYXBbYXR0cklkXSl7DQoJCQkJCQlfZXZ0SGRsck1hcFthdHRySWRdID0ge307DQoJCQkJCX0NCgkJCQkJdmFyIGggPSBfZXZ0SGRsck1hcFthdHRySWRdW3Byb3BOYW1lXTsNCgkJCQkJaWYoaCl7DQoJCQkJCQlkLmRpc2Nvbm5lY3QoaCk7DQoJCQkJCX1lbHNlew0KCQkJCQkJdHJ5ew0KCQkJCQkJCWRlbGV0ZSBub2RlW3Byb3BOYW1lXTsNCgkJCQkJCX1jYXRjaChlKXt9DQoJCQkJCX0NCgkJCQkJLy8gZW5zdXJlIHRoYXQgZXZlbnQgb2JqZWN0cyBhcmUgbm9ybWFsaXplZCwgZXRjLg0KCQkJCQlfZXZ0SGRsck1hcFthdHRySWRdW3Byb3BOYW1lXSA9IGQuY29ubmVjdChub2RlLCBwcm9wTmFtZSwgdmFsdWUpOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJaWYoZm9yY2VQcm9wIHx8IHR5cGVvZiB2YWx1ZSA9PSAiYm9vbGVhbiIpew0KCQkJCQkvLyBzcGVjaWFsIGNhc2U6IGZvcmNpbmcgYXNzaWdubWVudCB0byB0aGUgcHJvcGVydHkNCgkJCQkJLy8gc3BlY2lhbCBjYXNlOiBzZXR0aW5nIGJvb2xlYW4gdG8gYSBwcm9wZXJ0eSBpbnN0ZWFkIG9mIGF0dHJpYnV0ZQ0KCQkJCQlub2RlW3Byb3BOYW1lXSA9IHZhbHVlOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJLy8gbm9kZSdzIGF0dHJpYnV0ZQ0KCQkJCW5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCB2YWx1ZSk7DQoJCQl9d2hpbGUoZmFsc2UpOw0KCQkJcmV0dXJuIG5vZGU7IC8vIERvbU5vZGUNCgkJfQ0KCQkvLyBnZXR0ZXINCgkJLy8gc2hvdWxkIHdlIGFjY2VzcyB0aGlzIGF0dHJpYnV0ZSB2aWEgYSBwcm9wZXJ0eSBvcg0KCQkvLyB2aWEgZ2V0QXR0cmlidXRlKCk/DQoJCXZhbHVlID0gbm9kZVtwcm9wTmFtZV07DQoJCWlmKGZvcmNlUHJvcCAmJiB0eXBlb2YgdmFsdWUgIT0gInVuZGVmaW5lZCIpew0KCQkJLy8gbm9kZSdzIHByb3BlcnR5DQoJCQlyZXR1cm4gdmFsdWU7CS8vIEFueXRoaW5nDQoJCX0NCgkJaWYocHJvcE5hbWUgIT0gImhyZWYiICYmICh0eXBlb2YgdmFsdWUgPT0gImJvb2xlYW4iIHx8IGQuaXNGdW5jdGlvbih2YWx1ZSkpKXsNCgkJCS8vIG5vZGUncyBwcm9wZXJ0eQ0KCQkJcmV0dXJuIHZhbHVlOwkvLyBBbnl0aGluZw0KCQl9DQoJCS8vIG5vZGUncyBhdHRyaWJ1dGUNCgkJLy8gd2UgbmVlZCBfaGFzQXR0cigpIGhlcmUgdG8gZ3VhcmQgYWdhaW5zdCBJRSByZXR1cm5pbmcgYSBkZWZhdWx0IHZhbHVlDQoJCXJldHVybiBfaGFzQXR0cihub2RlLCBhdHRyTmFtZSkgPyBub2RlLmdldEF0dHJpYnV0ZShhdHRyTmFtZSkgOiBudWxsOyAvLyBBbnl0aGluZw0KCX0NCg0KCWRvam8ucmVtb3ZlQXR0ciA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqLyBub2RlLCAvKlN0cmluZyovIG5hbWUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmVtb3ZlcyBhbiBhdHRyaWJ1dGUgZnJvbSBhbiBIVE1MIGVsZW1lbnQuDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gcmVtb3ZlIHRoZSBhdHRyaWJ1dGUgZnJvbQ0KCQkvLwluYW1lOg0KCQkvLwkJdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byByZW1vdmUNCgkJYnlJZChub2RlKS5yZW1vdmVBdHRyaWJ1dGUoX2ZpeEF0dHJOYW1lKG5hbWUpKTsNCgl9DQoNCglkb2pvLmdldE5vZGVQcm9wID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovIG5vZGUsIC8qU3RyaW5nKi8gbmFtZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIGFuIGVmZmVjdGl2ZSB2YWx1ZSBvZiBhIHByb3BlcnR5IG9yIGFuIGF0dHJpYnV0ZS4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byB0aGUgZWxlbWVudCB0byByZW1vdmUgdGhlIGF0dHJpYnV0ZSBmcm9tDQoJCS8vCW5hbWU6DQoJCS8vCQl0aGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlDQoJCW5vZGUgPSBieUlkKG5vZGUpOw0KCQl2YXIgbGMgPSBuYW1lLnRvTG93ZXJDYXNlKCksDQoJCQlwcm9wTmFtZSA9IF9wcm9wTmFtZXNbbGNdIHx8IG5hbWU7DQoJCWlmKChwcm9wTmFtZSBpbiBub2RlKSAmJiBwcm9wTmFtZSAhPSAiaHJlZiIpew0KCQkJLy8gbm9kZSdzIHByb3BlcnR5DQoJCQlyZXR1cm4gbm9kZVtwcm9wTmFtZV07CS8vIEFueXRoaW5nDQoJCX0NCgkJLy8gbm9kZSdzIGF0dHJpYnV0ZQ0KCQl2YXIgYXR0ck5hbWUgPSBfYXR0ck5hbWVzW2xjXSB8fCBuYW1lOw0KCQlyZXR1cm4gX2hhc0F0dHIobm9kZSwgYXR0ck5hbWUpID8gbm9kZS5nZXRBdHRyaWJ1dGUoYXR0ck5hbWUpIDogbnVsbDsgLy8gQW55dGhpbmcNCgl9DQoNCglkb2pvLmNyZWF0ZSA9IGZ1bmN0aW9uKHRhZywgYXR0cnMsIHJlZk5vZGUsIHBvcyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlDcmVhdGUgYW4gZWxlbWVudCwgYWxsb3dpbmcgZm9yIG9wdGlvbmFsIGF0dHJpYnV0ZSBkZWNvcmF0aW9uDQoJCS8vCQlhbmQgcGxhY2VtZW50Lg0KCQkvLw0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCUEgRE9NIEVsZW1lbnQgY3JlYXRpb24gZnVuY3Rpb24uIEEgc2hvcnRoYW5kIG1ldGhvZCBmb3IgY3JlYXRpbmcgYSBub2RlIG9yDQoJCS8vCQlhIGZyYWdtZW50LCBhbmQgYWxsb3dpbmcgZm9yIGEgY29udmVuaWVudCBvcHRpb25hbCBhdHRyaWJ1dGUgc2V0dGluZyBzdGVwLA0KCQkvLwkJYXMgd2VsbCBhcyBhbiBvcHRpb25hbCBET00gcGxhY2VtZW50IHJlZmVyZW5jZS4NCgkJLy98DQoJCS8vCQlBdHRyaWJ1dGVzIGFyZSBzZXQgYnkgcGFzc2luZyB0aGUgb3B0aW9uYWwgb2JqZWN0IHRocm91Z2ggYGRvam8uYXR0cmAuDQoJCS8vCQlTZWUgYGRvam8uYXR0cmAgZm9yIG5vdGVkIGNhdmVhdHMgYW5kIG51YW5jZXMsIGFuZCBBUEkgaWYgYXBwbGljYWJsZS4NCgkJLy98DQoJCS8vCQlQbGFjZW1lbnQgaXMgZG9uZSB2aWEgYGRvam8ucGxhY2VgLCBhc3N1bWluZyB0aGUgbmV3IG5vZGUgdG8gYmUgdGhlIGFjdGlvbiANCgkJLy8JCW5vZGUsIHBhc3NpbmcgYWxvbmcgdGhlIG9wdGlvbmFsIHJlZmVyZW5jZSBub2RlIGFuZCBwb3NpdGlvbi4NCgkJLy8NCgkJLy8gdGFnOiBTdHJpbmd8RG9tTm9kZQ0KCQkvLwkJQSBzdHJpbmcgb2YgdGhlIGVsZW1lbnQgdG8gY3JlYXRlIChlZzogImRpdiIsICJhIiwgInAiLCAibGkiLCAic2NyaXB0IiwgImJyIiksDQoJCS8vCQlvciBhbiBleGlzdGluZyBET00gbm9kZSB0byBwcm9jZXNzLg0KCQkvLw0KCQkvLyBhdHRyczogT2JqZWN0DQoJCS8vCQlBbiBvYmplY3QtaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIHNldCBvbiB0aGUgbmV3bHkgY3JlYXRlZCBub2RlLg0KCQkvLwkJQ2FuIGJlIG51bGwsIGlmIHlvdSBkb24ndCB3YW50IHRvIHNldCBhbnkgYXR0cmlidXRlcy9zdHlsZXMuDQoJCS8vCQlTZWU6IGBkb2pvLmF0dHJgIGZvciBhIGRlc2NyaXB0aW9uIG9mIGF2YWlsYWJsZSBhdHRyaWJ1dGVzLg0KCQkvLw0KCQkvLyByZWZOb2RlOiBTdHJpbmc/fERvbU5vZGU/DQoJCS8vCQlPcHRpb25hbCByZWZlcmVuY2Ugbm9kZS4gVXNlZCBieSBgZG9qby5wbGFjZWAgdG8gcGxhY2UgdGhlIG5ld2x5IGNyZWF0ZWQNCgkJLy8JCW5vZGUgc29tZXdoZXJlIGluIHRoZSBkb20gcmVsYXRpdmUgdG8gcmVmTm9kZS4gQ2FuIGJlIGEgRG9tTm9kZSByZWZlcmVuY2UNCgkJLy8JCW9yIFN0cmluZyBJRCBvZiBhIG5vZGUuDQoJCS8vDQoJCS8vIHBvczogU3RyaW5nPw0KCQkvLwkJT3B0aW9uYWwgcG9zaXRpb25hbCByZWZlcmVuY2UuIERlZmF1bHRzIHRvICJsYXN0IiBieSB3YXkgb2YgYGRvam8ucGxhY2VgLA0KCQkvLwkJdGhvdWdoIGNhbiBiZSBzZXQgdG8gImZpcnN0IiwiYWZ0ZXIiLCJiZWZvcmUiLCJsYXN0IiwgInJlcGxhY2UiIG9yICJvbmx5Ig0KCQkvLwkJdG8gZnVydGhlciBjb250cm9sIHRoZSBwbGFjZW1lbnQgb2YgdGhlIG5ldyBub2RlIHJlbGF0aXZlIHRvIHRoZSByZWZOb2RlLg0KCQkvLwkJJ3JlZk5vZGUnIGlzIHJlcXVpcmVkIGlmIGEgJ3BvcycgaXMgc3BlY2lmaWVkLg0KCQkvLw0KCQkvLyByZXR1cm5zOiBEb21Ob2RlDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUNyZWF0ZSBhIERJVjoNCgkJLy8JfAl2YXIgbiA9IGRvam8uY3JlYXRlKCJkaXYiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQ3JlYXRlIGEgRElWIHdpdGggY29udGVudDoNCgkJLy8JfAl2YXIgbiA9IGRvam8uY3JlYXRlKCJkaXYiLCB7IGlubmVySFRNTDoiPHA+aGk8L3A+IiB9KTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JUGxhY2UgYSBuZXcgRElWIGluIHRoZSBCT0RZLCB3aXRoIG5vIGF0dHJpYnV0ZXMgc2V0DQoJCS8vCXwJdmFyIG4gPSBkb2pvLmNyZWF0ZSgiZGl2IiwgbnVsbCwgZG9qby5ib2R5KCkpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlDcmVhdGUgYW4gVUwsIGFuZCBwb3B1bGF0ZSBpdCB3aXRoIExJJ3MuIFBsYWNlIHRoZSBsaXN0IGFzIHRoZSBmaXJzdC1jaGlsZCBvZiBhIA0KCQkvLwlub2RlIHdpdGggaWQ9InNvbWVJZCI6DQoJCS8vCXwJdmFyIHVsID0gZG9qby5jcmVhdGUoInVsIiwgbnVsbCwgInNvbWVJZCIsICJmaXJzdCIpOw0KCQkvLwl8CXZhciBpdGVtcyA9IFsib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIl07DQoJCS8vCXwJZG9qby5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbihkYXRhKXsNCgkJLy8JfAkJZG9qby5jcmVhdGUoImxpIiwgeyBpbm5lckhUTUw6IGRhdGEgfSwgdWwpOw0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlDcmVhdGUgYW4gYW5jaG9yLCB3aXRoIGFuIGhyZWYuIFBsYWNlIGluIEJPRFk6DQoJCS8vCXwJZG9qby5jcmVhdGUoImEiLCB7IGhyZWY6ImZvby5odG1sIiwgdGl0bGU6IkdvdG8gRk9PISIgfSwgZG9qby5ib2R5KCkpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlDcmVhdGUgYSBgZG9qby5Ob2RlTGlzdCgpYCBmcm9tIGEgbmV3IGVsZW1lbnQgKGZvciBzeW50YXRpYyBzdWdhcik6DQoJCS8vCXwJZG9qby5xdWVyeShkb2pvLmNyZWF0ZSgnZGl2JykpDQoJCS8vCXwJCS5hZGRDbGFzcygibmV3RGl2IikNCgkJLy8JfAkJLm9uY2xpY2soZnVuY3Rpb24oZSl7IGNvbnNvbGUubG9nKCdjbGlja2VkJywgZS50YXJnZXQpIH0pDQoJCS8vCXwJCS5wbGFjZSgiI3NvbWVOb2RlIik7IC8vIHJlZHVuZGFudCwgYnV0IGNsZWFuZXIuDQoNCgkJdmFyIGRvYyA9IGQuZG9jOw0KCQlpZihyZWZOb2RlKXsNCgkJCXJlZk5vZGUgPSBieUlkKHJlZk5vZGUpOw0KCQkJZG9jID0gcmVmTm9kZS5vd25lckRvY3VtZW50Ow0KCQl9DQoJCWlmKHR5cGVvZiB0YWcgPT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQl0YWcgPSBkb2MuY3JlYXRlRWxlbWVudCh0YWcpOw0KCQl9DQoJCWlmKGF0dHJzKXsgZC5hdHRyKHRhZywgYXR0cnMpOyB9DQoJCWlmKHJlZk5vZGUpeyBkLnBsYWNlKHRhZywgcmVmTm9kZSwgcG9zKTsgfQ0KCQlyZXR1cm4gdGFnOyAvLyBEb21Ob2RlDQoJfQ0KDQoJLyo9PT09PQ0KCWRvam8uZW1wdHkgPSBmdW5jdGlvbihub2RlKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJc2FmZWx5IHJlbW92ZXMgYWxsIGNoaWxkcmVuIG9mIHRoZSBub2RlLg0KCQkJLy8Jbm9kZTogRE9NTm9kZXxTdHJpbmcNCgkJCS8vCQlhIHJlZmVyZW5jZSB0byBhIERPTSBub2RlIG9yIGFuIGlkLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCURlc3Ryb3kgbm9kZSdzIGNoaWxkcmVuIGJ5SWQ6DQoJCQkvLwl8CWRvam8uZW1wdHkoInNvbWVJZCIpOw0KCQkJLy8NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwlEZXN0cm95IGFsbCBub2RlcycgY2hpbGRyZW4gaW4gYSBsaXN0IGJ5IHJlZmVyZW5jZToNCgkJCS8vCXwJZG9qby5xdWVyeSgiLnNvbWVOb2RlIikuZm9yRWFjaChkb2pvLmVtcHR5KTsNCgl9DQoJPT09PT0qLw0KDQoJZC5lbXB0eSA9DQoJCQkJZC5pc0lFID8gIGZ1bmN0aW9uKG5vZGUpew0KCQkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCQlmb3IodmFyIGM7IGMgPSBub2RlLmxhc3RDaGlsZDspeyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJZC5kZXN0cm95KGMpOw0KCQkJfQ0KCQl9IDoNCgkJCQlmdW5jdGlvbihub2RlKXsNCgkJCWJ5SWQobm9kZSkuaW5uZXJIVE1MID0gIiI7DQoJCX07DQoNCgkvKj09PT09DQoJZG9qby5fdG9Eb20gPSBmdW5jdGlvbihmcmFnLCBkb2Mpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlpbnN0YW50aWF0ZXMgYW4gSFRNTCBmcmFnbWVudCByZXR1cm5pbmcgdGhlIGNvcnJlc3BvbmRpbmcgRE9NLg0KCQkJLy8JZnJhZzogU3RyaW5nDQoJCQkvLwkJdGhlIEhUTUwgZnJhZ21lbnQNCgkJCS8vCWRvYzogRG9jdW1lbnROb2RlPw0KCQkJLy8JCW9wdGlvbmFsIGRvY3VtZW50IHRvIHVzZSB3aGVuIGNyZWF0aW5nIERPTSBub2RlcywgZGVmYXVsdHMgdG8NCgkJCS8vCQlkb2pvLmRvYyBpZiBub3Qgc3BlY2lmaWVkLg0KCQkJLy8JcmV0dXJuczogRG9jdW1lbnRGcmFnbWVudA0KCQkJLy8NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwlDcmVhdGUgYSB0YWJsZSByb3c6DQoJCQkvLwl8CXZhciB0ciA9IGRvam8uX3RvRG9tKCI8dHI+PHRkPkZpcnN0ITwvdGQ+PC90cj4iKTsNCgl9DQoJPT09PT0qLw0KDQoJLy8gc3VwcG9ydCBzdHVmZiBmb3IgZG9qby5fdG9Eb20NCgl2YXIgdGFnV3JhcCA9IHsNCgkJCW9wdGlvbjogWyJzZWxlY3QiXSwNCgkJCXRib2R5OiBbInRhYmxlIl0sDQoJCQl0aGVhZDogWyJ0YWJsZSJdLA0KCQkJdGZvb3Q6IFsidGFibGUiXSwNCgkJCXRyOiBbInRhYmxlIiwgInRib2R5Il0sDQoJCQl0ZDogWyJ0YWJsZSIsICJ0Ym9keSIsICJ0ciJdLA0KCQkJdGg6IFsidGFibGUiLCAidGhlYWQiLCAidHIiXSwNCgkJCWxlZ2VuZDogWyJmaWVsZHNldCJdLA0KCQkJY2FwdGlvbjogWyJ0YWJsZSJdLA0KCQkJY29sZ3JvdXA6IFsidGFibGUiXSwNCgkJCWNvbDogWyJ0YWJsZSIsICJjb2xncm91cCJdLA0KCQkJbGk6IFsidWwiXQ0KCQl9LA0KCQlyZVRhZyA9IC88XHMqKFtcd1w6XSspLywNCgkJbWFzdGVyTm9kZSA9IHt9LCBtYXN0ZXJOdW0gPSAwLA0KCQltYXN0ZXJOYW1lID0gIl9fIiArIGQuX3Njb3BlTmFtZSArICJUb0RvbUlkIjsNCg0KCS8vIGdlbmVyYXRlIHN0YXJ0L2VuZCB0YWcgc3RyaW5ncyB0byB1c2UNCgkvLyBmb3IgdGhlIGluamVjdGlvbiBmb3IgZWFjaCBzcGVjaWFsIHRhZyB3cmFwIGNhc2UuDQoJZm9yKHZhciBwYXJhbSBpbiB0YWdXcmFwKXsNCgkJdmFyIHR3ID0gdGFnV3JhcFtwYXJhbV07DQoJCXR3LnByZSAgPSBwYXJhbSA9PSAib3B0aW9uIiA/ICc8c2VsZWN0IG11bHRpcGxlPSJtdWx0aXBsZSI+JyA6ICI8IiArIHR3LmpvaW4oIj48IikgKyAiPiI7DQoJCXR3LnBvc3QgPSAiPC8iICsgdHcucmV2ZXJzZSgpLmpvaW4oIj48LyIpICsgIj4iOw0KCQkvLyB0aGUgbGFzdCBsaW5lIGlzIGRlc3RydWN0aXZlOiBpdCByZXZlcnNlcyB0aGUgYXJyYXksDQoJCS8vIGJ1dCB3ZSBkb24ndCBjYXJlIGF0IHRoaXMgcG9pbnQNCgl9DQoNCglkLl90b0RvbSA9IGZ1bmN0aW9uKGZyYWcsIGRvYyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vIAkJY29udmVydHMgSFRNTCBzdHJpbmcgaW50byBET00gbm9kZXMuDQoNCgkJZG9jID0gZG9jIHx8IGQuZG9jOw0KCQl2YXIgbWFzdGVySWQgPSBkb2NbbWFzdGVyTmFtZV07DQoJCWlmKCFtYXN0ZXJJZCl7DQoJCQlkb2NbbWFzdGVyTmFtZV0gPSBtYXN0ZXJJZCA9ICsrbWFzdGVyTnVtICsgIiI7DQoJCQltYXN0ZXJOb2RlW21hc3RlcklkXSA9IGRvYy5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJfQ0KDQoJCS8vIG1ha2Ugc3VyZSB0aGUgZnJhZyBpcyBhIHN0cmluZy4NCgkJZnJhZyArPSAiIjsNCg0KCQkvLyBmaW5kIHRoZSBzdGFydGluZyB0YWcsIGFuZCBnZXQgbm9kZSB3cmFwcGVyDQoJCXZhciBtYXRjaCA9IGZyYWcubWF0Y2gocmVUYWcpLA0KCQkJdGFnID0gbWF0Y2ggPyBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpIDogIiIsDQoJCQltYXN0ZXIgPSBtYXN0ZXJOb2RlW21hc3RlcklkXSwNCgkJCXdyYXAsIGksIGZjLCBkZjsNCgkJaWYobWF0Y2ggJiYgdGFnV3JhcFt0YWddKXsNCgkJCXdyYXAgPSB0YWdXcmFwW3RhZ107DQoJCQltYXN0ZXIuaW5uZXJIVE1MID0gd3JhcC5wcmUgKyBmcmFnICsgd3JhcC5wb3N0Ow0KCQkJZm9yKGkgPSB3cmFwLmxlbmd0aDsgaTsgLS1pKXsNCgkJCQltYXN0ZXIgPSBtYXN0ZXIuZmlyc3RDaGlsZDsNCgkJCX0NCgkJfWVsc2V7DQoJCQltYXN0ZXIuaW5uZXJIVE1MID0gZnJhZzsNCgkJfQ0KDQoJCS8vIG9uZSBub2RlIHNob3J0Y3V0ID0+IHJldHVybiB0aGUgbm9kZSBpdHNlbGYNCgkJaWYobWFzdGVyLmNoaWxkTm9kZXMubGVuZ3RoID09IDEpew0KCQkJcmV0dXJuIG1hc3Rlci5yZW1vdmVDaGlsZChtYXN0ZXIuZmlyc3RDaGlsZCk7IC8vIERPTU5vZGUNCgkJfQ0KDQoJCS8vIHJldHVybiBtdWx0aXBsZSBub2RlcyBhcyBhIGRvY3VtZW50IGZyYWdtZW50DQoJCWRmID0gZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCgkJd2hpbGUoZmMgPSBtYXN0ZXIuZmlyc3RDaGlsZCl7IC8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCWRmLmFwcGVuZENoaWxkKGZjKTsNCgkJfQ0KCQlyZXR1cm4gZGY7IC8vIERPTU5vZGUNCgl9DQoNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KCS8vIChDU1MpIENsYXNzIEZ1bmN0aW9ucw0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoJdmFyIF9jbGFzc05hbWUgPSAiY2xhc3NOYW1lIjsNCg0KCWRvam8uaGFzQ2xhc3MgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKlN0cmluZyovY2xhc3NTdHIpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGNsYXNzZXMgYXJlIGEgcG9ydGlvbiBvZiB0aGUNCgkJLy8JCWNsYXNzIGxpc3QgY3VycmVudGx5IGFwcGxpZWQgdG8gdGhlIG5vZGUuDQoJCS8vDQoJCS8vCW5vZGU6DQoJCS8vCQlTdHJpbmcgSUQgb3IgRG9tTm9kZSByZWZlcmVuY2UgdG8gY2hlY2sgdGhlIGNsYXNzIGZvci4NCgkJLy8NCgkJLy8JY2xhc3NTdHI6DQoJCS8vCQlBIHN0cmluZyBjbGFzcyBuYW1lIHRvIGxvb2sgZm9yLg0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlEbyBzb21ldGhpbmcgaWYgYSBub2RlIHdpdGggaWQ9InNvbWVOb2RlIiBoYXMgY2xhc3M9ImFTaWxseUNsYXNzTmFtZSIgcHJlc2VudA0KCQkvLwl8CWlmKGRvam8uaGFzQ2xhc3MoInNvbWVOb2RlIiwiYVNpbGx5Q2xhc3NOYW1lIikpeyAuLi4gfQ0KDQoJCXJldHVybiAoKCIgIisgYnlJZChub2RlKVtfY2xhc3NOYW1lXSArIiAiKS5pbmRleE9mKCIgIiArIGNsYXNzU3RyICsgIiAiKSA+PSAwKTsgIC8vIEJvb2xlYW4NCgl9Ow0KDQoJdmFyIHNwYWNlcyA9IC9ccysvLCBhMSA9IFsiIl0sDQoJCXN0cjJhcnJheSA9IGZ1bmN0aW9uKHMpew0KCQkJaWYodHlwZW9mIHMgPT0gInN0cmluZyIgfHwgcyBpbnN0YW5jZW9mIFN0cmluZyl7DQoJCQkJaWYocy5pbmRleE9mKCIgIikgPCAwKXsNCgkJCQkJYTFbMF0gPSBzOw0KCQkJCQlyZXR1cm4gYTE7DQoJCQkJfWVsc2V7DQoJCQkJCXJldHVybiBzLnNwbGl0KHNwYWNlcyk7DQoJCQkJfQ0KCQkJfQ0KCQkJLy8gYXNzdW1lZCB0byBiZSBhbiBhcnJheQ0KCQkJcmV0dXJuIHMgfHwgIiI7DQoJCX07DQoNCglkb2pvLmFkZENsYXNzID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypTdHJpbmd8QXJyYXkqL2NsYXNzU3RyKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUFkZHMgdGhlIHNwZWNpZmllZCBjbGFzc2VzIHRvIHRoZSBlbmQgb2YgdGhlIGNsYXNzIGxpc3Qgb24gdGhlDQoJCS8vCQlwYXNzZWQgbm9kZS4gV2lsbCBub3QgcmUtYXBwbHkgZHVwbGljYXRlIGNsYXNzZXMuDQoJCS8vDQoJCS8vCW5vZGU6DQoJCS8vCQlTdHJpbmcgSUQgb3IgRG9tTm9kZSByZWZlcmVuY2UgdG8gYWRkIGEgY2xhc3Mgc3RyaW5nIHRvbw0KCQkvLw0KCQkvLwljbGFzc1N0cjoNCgkJLy8JCUEgU3RyaW5nIGNsYXNzIG5hbWUgdG8gYWRkLCBvciBzZXZlcmFsIHNwYWNlLXNlcGFyYXRlZCBjbGFzcyBuYW1lcywNCgkJLy8JCW9yIGFuIGFycmF5IG9mIGNsYXNzIG5hbWVzLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlBZGQgYSBjbGFzcyB0byBzb21lIG5vZGU6DQoJCS8vCXwJZG9qby5hZGRDbGFzcygic29tZU5vZGUiLCAiYW5ld0NsYXNzIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUFkZCB0d28gY2xhc3NlcyBhdCBvbmNlOg0KCQkvLwl8CWRvam8uYWRkQ2xhc3MoInNvbWVOb2RlIiwgImZpcnN0Q2xhc3Mgc2Vjb25kQ2xhc3MiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQWRkIHR3byBjbGFzc2VzIGF0IG9uY2UgKHVzaW5nIGFycmF5KToNCgkJLy8JfAlkb2pvLmFkZENsYXNzKCJzb21lTm9kZSIsIFsiZmlyc3RDbGFzcyIsICJzZWNvbmRDbGFzcyJdKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQXZhaWxhYmxlIGluIGBkb2pvLk5vZGVMaXN0YCBmb3IgbXVsdGlwbGUgYWRkaXRpb25zDQoJCS8vCXwJZG9qby5xdWVyeSgidWwgPiBsaSIpLmFkZENsYXNzKCJmaXJzdExldmVsIik7DQoNCgkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCWNsYXNzU3RyID0gc3RyMmFycmF5KGNsYXNzU3RyKTsNCgkJdmFyIGNscyA9IG5vZGVbX2NsYXNzTmFtZV0sIG9sZExlbjsNCgkJY2xzID0gY2xzID8gIiAiICsgY2xzICsgIiAiIDogIiAiOw0KCQlvbGRMZW4gPSBjbHMubGVuZ3RoOw0KCQlmb3IodmFyIGkgPSAwLCBsZW4gPSBjbGFzc1N0ci5sZW5ndGgsIGM7IGkgPCBsZW47ICsraSl7DQoJCQljID0gY2xhc3NTdHJbaV07DQoJCQlpZihjICYmIGNscy5pbmRleE9mKCIgIiArIGMgKyAiICIpIDwgMCl7DQoJCQkJY2xzICs9IGMgKyAiICI7DQoJCQl9DQoJCX0NCgkJaWYob2xkTGVuIDwgY2xzLmxlbmd0aCl7DQoJCQlub2RlW19jbGFzc05hbWVdID0gY2xzLnN1YnN0cigxLCBjbHMubGVuZ3RoIC0gMik7DQoJCX0NCgl9Ow0KDQoJZG9qby5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qU3RyaW5nfEFycmF5PyovY2xhc3NTdHIpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNsYXNzZXMgZnJvbSBub2RlLiBObyBgZG9qby5oYXNDbGFzc2ANCgkJLy8JCWNoZWNrIGlzIHJlcXVpcmVkLg0KCQkvLw0KCQkvLyBub2RlOg0KCQkvLyAJCVN0cmluZyBJRCBvciBEb21Ob2RlIHJlZmVyZW5jZSB0byByZW1vdmUgdGhlIGNsYXNzIGZyb20uDQoJCS8vDQoJCS8vIGNsYXNzU3RyOg0KCQkvLwkJQW4gb3B0aW9uYWwgU3RyaW5nIGNsYXNzIG5hbWUgdG8gcmVtb3ZlLCBvciBzZXZlcmFsIHNwYWNlLXNlcGFyYXRlZA0KCQkvLwkJY2xhc3MgbmFtZXMsIG9yIGFuIGFycmF5IG9mIGNsYXNzIG5hbWVzLiBJZiBvbWl0dGVkLCBhbGwgY2xhc3MgbmFtZXMNCgkJLy8JCXdpbGwgYmUgZGVsZXRlZC4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JUmVtb3ZlIGEgY2xhc3MgZnJvbSBzb21lIG5vZGU6DQoJCS8vCXwJZG9qby5yZW1vdmVDbGFzcygic29tZU5vZGUiLCAiZmlyc3RDbGFzcyIpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZW1vdmUgdHdvIGNsYXNzZXMgZnJvbSBzb21lIG5vZGU6DQoJCS8vCXwJZG9qby5yZW1vdmVDbGFzcygic29tZU5vZGUiLCAiZmlyc3RDbGFzcyBzZWNvbmRDbGFzcyIpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZW1vdmUgdHdvIGNsYXNzZXMgZnJvbSBzb21lIG5vZGUgKHVzaW5nIGFycmF5KToNCgkJLy8JfAlkb2pvLnJlbW92ZUNsYXNzKCJzb21lTm9kZSIsIFsiZmlyc3RDbGFzcyIsICJzZWNvbmRDbGFzcyJdKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JUmVtb3ZlIGFsbCBjbGFzc2VzIGZyb20gc29tZSBub2RlOg0KCQkvLwl8CWRvam8ucmVtb3ZlQ2xhc3MoInNvbWVOb2RlIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUF2YWlsYWJsZSBpbiBgZG9qby5Ob2RlTGlzdCgpYCBmb3IgbXVsdGlwbGUgcmVtb3ZhbA0KCQkvLwl8CWRvam8ucXVlcnkoIi5mb28iKS5yZW1vdmVDbGFzcygiZm9vIik7DQoNCgkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCXZhciBjbHM7DQoJCWlmKGNsYXNzU3RyICE9PSB1bmRlZmluZWQpew0KCQkJY2xhc3NTdHIgPSBzdHIyYXJyYXkoY2xhc3NTdHIpOw0KCQkJY2xzID0gIiAiICsgbm9kZVtfY2xhc3NOYW1lXSArICIgIjsNCgkJCWZvcih2YXIgaSA9IDAsIGxlbiA9IGNsYXNzU3RyLmxlbmd0aDsgaSA8IGxlbjsgKytpKXsNCgkJCQljbHMgPSBjbHMucmVwbGFjZSgiICIgKyBjbGFzc1N0cltpXSArICIgIiwgIiAiKTsNCgkJCX0NCgkJCWNscyA9IGQudHJpbShjbHMpOw0KCQl9ZWxzZXsNCgkJCWNscyA9ICIiOw0KCQl9DQoJCWlmKG5vZGVbX2NsYXNzTmFtZV0gIT0gY2xzKXsgbm9kZVtfY2xhc3NOYW1lXSA9IGNsczsgfQ0KCX07DQoNCglkb2pvLnRvZ2dsZUNsYXNzID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypTdHJpbmd8QXJyYXkqL2NsYXNzU3RyLCAvKkJvb2xlYW4/Ki9jb25kaXRpb24pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQWRkcyBhIGNsYXNzIHRvIG5vZGUgaWYgbm90IHByZXNlbnQsIG9yIHJlbW92ZXMgaWYgcHJlc2VudC4NCgkJLy8JCVBhc3MgYSBib29sZWFuIGNvbmRpdGlvbiBpZiB5b3Ugd2FudCB0byBleHBsaWNpdGx5IGFkZCBvciByZW1vdmUuDQoJCS8vCWNvbmRpdGlvbjoNCgkJLy8JCUlmIHBhc3NlZCwgdHJ1ZSBtZWFucyB0byBhZGQgdGhlIGNsYXNzLCBmYWxzZSBtZWFucyB0byByZW1vdmUuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCXwJZG9qby50b2dnbGVDbGFzcygic29tZU5vZGUiLCAiaG92ZXJlZCIpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlGb3JjZWZ1bGx5IGFkZCBhIGNsYXNzDQoJCS8vCXwJZG9qby50b2dnbGVDbGFzcygic29tZU5vZGUiLCAiaG92ZXJlZCIsIHRydWUpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlBdmFpbGFibGUgaW4gYGRvam8uTm9kZUxpc3QoKWAgZm9yIG11bHRpcGxlIHRvZ2dsZXMNCgkJLy8JfAlkb2pvLnF1ZXJ5KCIudG9nZ2xlTWUiKS50b2dnbGVDbGFzcygidG9nZ2xlTWUiKTsNCg0KCQlpZihjb25kaXRpb24gPT09IHVuZGVmaW5lZCl7DQoJCQljb25kaXRpb24gPSAhZC5oYXNDbGFzcyhub2RlLCBjbGFzc1N0cik7DQoJCX0NCgkJZFtjb25kaXRpb24gPyAiYWRkQ2xhc3MiIDogInJlbW92ZUNsYXNzIl0obm9kZSwgY2xhc3NTdHIpOw0KCX07DQoNCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLk5vZGVMaXN0Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLk5vZGVMaXN0Il0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLk5vZGVMaXN0Iik7DQoNCg0KDQooZnVuY3Rpb24oKXsNCg0KCXZhciBkID0gZG9qbzsNCg0KCXZhciBhcCA9IEFycmF5LnByb3RvdHlwZSwgYXBzID0gYXAuc2xpY2UsIGFwYyA9IGFwLmNvbmNhdDsNCg0KCXZhciB0bmwgPSBmdW5jdGlvbigvKkFycmF5Ki8gYSwgLypkb2pvLk5vZGVMaXN0PyovIHBhcmVudCwgLypGdW5jdGlvbj8qLyBOb2RlTGlzdEN0b3Ipew0KCQkvLyBzdW1tYXJ5Og0KCQkvLyAJCWRlY29yYXRlIGFuIGFycmF5IHRvIG1ha2UgaXQgbG9vayBsaWtlIGEgYGRvam8uTm9kZUxpc3RgLg0KCQkvLyBhOg0KCQkvLyAJCUFycmF5IG9mIG5vZGVzIHRvIGRlY29yYXRlLg0KCQkvLyBwYXJlbnQ6DQoJCS8vIAkJQW4gb3B0aW9uYWwgcGFyZW50IE5vZGVMaXN0IHRoYXQgZ2VuZXJhdGVkIHRoZSBjdXJyZW50DQoJCS8vIAkJbGlzdCBvZiBub2Rlcy4gVXNlZCB0byBjYWxsIF9zdGFzaCgpIHNvIHRoZSBwYXJlbnQgTm9kZUxpc3QNCgkJLy8gCQljYW4gYmUgYWNjZXNzZWQgdmlhIGVuZCgpIGxhdGVyLg0KCQkvLyBOb2RlTGlzdEN0b3I6DQoJCS8vIAkJQW4gb3B0aW9uYWwgY29uc3RydWN0b3IgZnVuY3Rpb24gdG8gdXNlIGZvciBhbnkNCgkJLy8gCQluZXcgTm9kZUxpc3QgY2FsbHMuIFRoaXMgYWxsb3dzIGEgY2VydGFpbiBjaGFpbiBvZg0KCQkvLyAJCU5vZGVMaXN0IGNhbGxzIHRvIHVzZSBhIGRpZmZlcmVudCBvYmplY3QgdGhhbiBkb2pvLk5vZGVMaXN0Lg0KCQlpZighYS5zb3J0KXsNCgkJCS8vIG1ha2Ugc3VyZSBpdCdzIGEgcmVhbCBhcnJheSBiZWZvcmUgd2UgcGFzcyBpdCBvbiB0byBiZSB3cmFwcGVkDQoJCQlhID0gYXBzLmNhbGwoYSwgMCk7DQoJCX0NCgkJdmFyIGN0b3IgPSBOb2RlTGlzdEN0b3IgfHwgdGhpcy5fTm9kZUxpc3RDdG9yIHx8IGQuX05vZGVMaXN0Q3RvcjsNCgkJYS5jb25zdHJ1Y3RvciA9IGN0b3I7DQoJCWRvam8uX21peGluKGEsIGN0b3IucHJvdG90eXBlKTsNCgkJYS5fTm9kZUxpc3RDdG9yID0gY3RvcjsNCgkJcmV0dXJuIHBhcmVudCA/IGEuX3N0YXNoKHBhcmVudCkgOiBhOw0KCX07DQoNCgl2YXIgbG9vcEJvZHkgPSBmdW5jdGlvbihmLCBhLCBvKXsNCgkJYSA9IFswXS5jb25jYXQoYXBzLmNhbGwoYSwgMCkpOw0KCQlvID0gbyB8fCBkLmdsb2JhbDsNCgkJcmV0dXJuIGZ1bmN0aW9uKG5vZGUpew0KCQkJYVswXSA9IG5vZGU7DQoJCQlyZXR1cm4gZi5hcHBseShvLCBhKTsNCgkJfTsNCgl9Ow0KDQoJLy8gYWRhcHRlcnMNCg0KCXZhciBhZGFwdEFzRm9yRWFjaCA9IGZ1bmN0aW9uKGYsIG8pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJYWRhcHRzIGEgc2luZ2xlIG5vZGUgZnVuY3Rpb24gdG8gYmUgdXNlZCBpbiB0aGUgZm9yRWFjaC10eXBlDQoJCS8vCQlhY3Rpb25zLiBUaGUgaW5pdGlhbCBvYmplY3QgaXMgcmV0dXJuZWQgZnJvbSB0aGUgc3BlY2lhbGl6ZWQNCgkJLy8JCWZ1bmN0aW9uLg0KCQkvLwlmOiBGdW5jdGlvbg0KCQkvLwkJYSBmdW5jdGlvbiB0byBhZGFwdA0KCQkvLwlvOiBPYmplY3Q/DQoJCS8vCQlhbiBvcHRpb25hbCBjb250ZXh0IGZvciBmDQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdGhpcy5mb3JFYWNoKGxvb3BCb2R5KGYsIGFyZ3VtZW50cywgbykpOw0KCQkJcmV0dXJuIHRoaXM7CS8vIE9iamVjdA0KCQl9Ow0KCX07DQoNCgl2YXIgYWRhcHRBc01hcCA9IGZ1bmN0aW9uKGYsIG8pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJYWRhcHRzIGEgc2luZ2xlIG5vZGUgZnVuY3Rpb24gdG8gYmUgdXNlZCBpbiB0aGUgbWFwLXR5cGUNCgkJLy8JCWFjdGlvbnMuIFRoZSByZXR1cm4gaXMgYSBuZXcgYXJyYXkgb2YgdmFsdWVzLCBhcyB2aWEgYGRvam8ubWFwYA0KCQkvLwlmOiBGdW5jdGlvbg0KCQkvLwkJYSBmdW5jdGlvbiB0byBhZGFwdA0KCQkvLwlvOiBPYmplY3Q/DQoJCS8vCQlhbiBvcHRpb25hbCBjb250ZXh0IGZvciBmDQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJcmV0dXJuIHRoaXMubWFwKGxvb3BCb2R5KGYsIGFyZ3VtZW50cywgbykpOw0KCQl9Ow0KCX07DQoNCgl2YXIgYWRhcHRBc0ZpbHRlciA9IGZ1bmN0aW9uKGYsIG8pew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJYWRhcHRzIGEgc2luZ2xlIG5vZGUgZnVuY3Rpb24gdG8gYmUgdXNlZCBpbiB0aGUgZmlsdGVyLXR5cGUgYWN0aW9ucw0KCQkvLwlmOiBGdW5jdGlvbg0KCQkvLwkJYSBmdW5jdGlvbiB0byBhZGFwdA0KCQkvLwlvOiBPYmplY3Q/DQoJCS8vCQlhbiBvcHRpb25hbCBjb250ZXh0IGZvciBmDQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJcmV0dXJuIHRoaXMuZmlsdGVyKGxvb3BCb2R5KGYsIGFyZ3VtZW50cywgbykpOw0KCQl9Ow0KCX07DQoNCgl2YXIgYWRhcHRXaXRoQ29uZGl0aW9uID0gZnVuY3Rpb24oZiwgZywgbyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlhZGFwdHMgYSBzaW5nbGUgbm9kZSBmdW5jdGlvbiB0byBiZSB1c2VkIGluIHRoZSBtYXAtdHlwZQ0KCQkvLwkJYWN0aW9ucywgYmVoYXZlcyBsaWtlIGZvckVhY2goKSBvciBtYXAoKSBkZXBlbmRpbmcgb24gYXJndW1lbnRzDQoJCS8vCWY6IEZ1bmN0aW9uDQoJCS8vCQlhIGZ1bmN0aW9uIHRvIGFkYXB0DQoJCS8vCWc6IEZ1bmN0aW9uDQoJCS8vCQlhIGNvbmRpdGlvbiBmdW5jdGlvbiwgaWYgdHJ1ZSBydW5zIGFzIG1hcCgpLCBvdGhlcndpc2UgcnVucyBhcyBmb3JFYWNoKCkNCgkJLy8JbzogT2JqZWN0Pw0KCQkvLwkJYW4gb3B0aW9uYWwgY29udGV4dCBmb3IgZiBhbmQgZw0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBhID0gYXJndW1lbnRzLCBib2R5ID0gbG9vcEJvZHkoZiwgYSwgbyk7DQoJCQlpZihnLmNhbGwobyB8fCBkLmdsb2JhbCwgYSkpew0KCQkJCXJldHVybiB0aGlzLm1hcChib2R5KTsJLy8gc2VsZg0KCQkJfQ0KCQkJdGhpcy5mb3JFYWNoKGJvZHkpOw0KCQkJcmV0dXJuIHRoaXM7CS8vIHNlbGYNCgkJfTsNCgl9Ow0KDQoJdmFyIG1hZ2ljR3VhcmQgPSBmdW5jdGlvbihhKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXRoZSBndWFyZCBmdW5jdGlvbiBmb3IgZG9qby5hdHRyKCkgYW5kIGRvam8uc3R5bGUoKQ0KCQlyZXR1cm4gYS5sZW5ndGggPT0gMSAmJiAodHlwZW9mIGFbMF0gPT0gInN0cmluZyIpOyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJfTsNCg0KCXZhciBvcnBoYW4gPSBmdW5jdGlvbihub2RlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWZ1bmN0aW9uIHRvIG9ycGhhbiBub2Rlcw0KCQl2YXIgcCA9IG5vZGUucGFyZW50Tm9kZTsNCgkJaWYocCl7DQoJCQlwLnJlbW92ZUNoaWxkKG5vZGUpOw0KCQl9DQoJfTsNCgkvLyBGSVhNRTogc2hvdWxkIHdlIG1vdmUgb3JwaGFuKCkgdG8gZG9qby5odG1sPw0KDQoJZG9qby5Ob2RlTGlzdCA9IGZ1bmN0aW9uKCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlkb2pvLk5vZGVMaXN0IGlzIGFuIG9mIEFycmF5IHN1YmNsYXNzIHdoaWNoIGFkZHMgc3ludGFjdGljDQoJCS8vCQlzdWdhciBmb3IgY2hhaW5pbmcsIGNvbW1vbiBpdGVyYXRpb24gb3BlcmF0aW9ucywgYW5pbWF0aW9uLCBhbmQNCgkJLy8JCW5vZGUgbWFuaXB1bGF0aW9uLiBOb2RlTGlzdHMgYXJlIG1vc3Qgb2Z0ZW4gcmV0dXJuZWQgYXMgdGhlDQoJCS8vCQlyZXN1bHQgb2YgZG9qby5xdWVyeSgpIGNhbGxzLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCWRvam8uTm9kZUxpc3QgaW5zdGFuY2VzIHByb3ZpZGUgbWFueSB1dGlsaXRpZXMgdGhhdCByZWZsZWN0DQoJCS8vCQljb3JlIERvam8gQVBJcyBmb3IgQXJyYXkgaXRlcmF0aW9uIGFuZCBtYW5pcHVsYXRpb24sIERPTQ0KCQkvLwkJbWFuaXB1bGF0aW9uLCBhbmQgZXZlbnQgaGFuZGxpbmcuIEluc3RlYWQgb2YgbmVlZGluZyB0byBkaWcgdXANCgkJLy8JCWZ1bmN0aW9ucyBpbiB0aGUgZG9qby4qIG5hbWVzcGFjZSwgTm9kZUxpc3RzIGdlbmVyYWxseSBtYWtlIHRoZQ0KCQkvLwkJZnVsbCBwb3dlciBvZiBEb2pvIGF2YWlsYWJsZSBmb3IgRE9NIG1hbmlwdWxhdGlvbiB0YXNrcyBpbiBhDQoJCS8vCQlzaW1wbGUsIGNoYWluYWJsZSB3YXkuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQljcmVhdGUgYSBub2RlIGxpc3QgZnJvbSBhIG5vZGUNCgkJLy8JCXwJbmV3IGRvam8uTm9kZUxpc3QoZG9qby5ieUlkKCJmb28iKSk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlnZXQgYSBOb2RlTGlzdCBmcm9tIGEgQ1NTIHF1ZXJ5IGFuZCBpdGVyYXRlIG9uIGl0DQoJCS8vCQl8CXZhciBsID0gZG9qby5xdWVyeSgiLnRoaW5nZXIiKTsNCgkJLy8JCXwJbC5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsIGluZGV4LCBub2RlTGlzdCl7DQoJCS8vCQl8CQljb25zb2xlLmxvZyhpbmRleCwgbm9kZS5pbm5lckhUTUwpOw0KCQkvLwkJfAl9KTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCXVzZSBuYXRpdmUgYW5kIERvam8tcHJvdmlkZWQgYXJyYXkgbWV0aG9kcyB0byBtYW5pcHVsYXRlIGENCgkJLy8JCU5vZGVMaXN0IHdpdGhvdXQgbmVlZGluZyB0byB1c2UgZG9qby4qIGZ1bmN0aW9ucyBleHBsaWNpdGx5Og0KCQkvLwkJfAl2YXIgbCA9IGRvam8ucXVlcnkoIi50aGluZ2VyIik7DQoJCS8vCQl8CS8vIHNpbmNlIE5vZGVMaXN0cyBhcmUgcmVhbCBhcnJheXMsIHRoZXkgaGF2ZSBhIGxlbmd0aA0KCQkvLwkJfAkvLyBwcm9wZXJ0eSB0aGF0IGlzIGJvdGggcmVhZGFibGUgYW5kIHdyaXRhYmxlIGFuZA0KCQkvLwkJfAkvLyBwdXNoL3BvcC9zaGlmdC91bnNoaWZ0IG1ldGhvZHMNCgkJLy8JCXwJY29uc29sZS5sb2cobC5sZW5ndGgpOw0KCQkvLwkJfAlsLnB1c2goZG9qby5jcmVhdGUoInNwYW4iKSk7DQoJCS8vCQl8DQoJCS8vCQl8CS8vIGRvam8ncyBub3JtYWxpemVkIGFycmF5IG1ldGhvZHMgd29yayB0b286DQoJCS8vCQl8CWNvbnNvbGUubG9nKCBsLmluZGV4T2YoZG9qby5ieUlkKCJmb28iKSkgKTsNCgkJLy8JCXwJLy8gLi4uaW5jbHVkaW5nIHRoZSBzcGVjaWFsICJmdW5jdGlvbiBhcyBzdHJpbmciIHNob3J0aGFuZA0KCQkvLwkJfAljb25zb2xlLmxvZyggbC5ldmVyeSgiaXRlbS5ub2RlVHlwZSA9PSAxIikgKTsNCgkJLy8JCXwNCgkJLy8JCXwJLy8gTm9kZUxpc3RzIGNhbiBiZSBbLi5dIGluZGV4ZWQsIG9yIHlvdSBjYW4gdXNlIHRoZSBhdCgpDQoJCS8vCQl8CS8vIGZ1bmN0aW9uIHRvIGdldCBzcGVjaWZpYyBpdGVtcyB3cmFwcGVkIGluIGEgbmV3IE5vZGVMaXN0Og0KCQkvLwkJfAl2YXIgbm9kZSA9IGxbM107IC8vIHRoZSA0dGggZWxlbWVudA0KCQkvLwkJfAl2YXIgbmV3TGlzdCA9IGwuYXQoMSwgMyk7IC8vIHRoZSAybmQgYW5kIDR0aCBlbGVtZW50cw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJdGhlIHN0eWxlIGZ1bmN0aW9ucyB5b3UgZXhwZWN0IGFyZSBhbGwgdGhlcmUgdG9vOg0KCQkvLwkJfAkvLyBzdHlsZSgpIGFzIGEgZ2V0dGVyLi4uDQoJCS8vCQl8CXZhciBib3JkZXJzID0gZG9qby5xdWVyeSgiLnRoaW5nZXIiKS5zdHlsZSgiYm9yZGVyIik7DQoJCS8vCQl8CS8vIC4uLmFuZCBhcyBhIHNldHRlcjoNCgkJLy8JCXwJZG9qby5xdWVyeSgiLnRoaW5nZXIiKS5zdHlsZSgiYm9yZGVyIiwgIjFweCBzb2xpZCBibGFjayIpOw0KCQkvLwkJfAkvLyBjbGFzcyBtYW5pcHVsYXRpb24NCgkJLy8JCXwJZG9qby5xdWVyeSgibGk6bnRoLWNoaWxkKGV2ZW4pIikuYWRkQ2xhc3MoImV2ZW4iKTsNCgkJLy8JCXwJLy8gZXZlbiBnZXR0aW5nIHRoZSBjb29yZGluYXRlcyBvZiBhbGwgdGhlIGl0ZW1zDQoJCS8vCQl8CXZhciBjb29yZHMgPSBkb2pvLnF1ZXJ5KCIudGhpbmdlciIpLmNvb3JkcygpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJRE9NIG1hbmlwdWxhdGlvbiBmdW5jdGlvbnMgZnJvbSB0aGUgZG9qby4qIG5hbWVzcGFjZSBhcmVhIGFsc28NCgkJLy8JCWF2YWlsYWJsZToNCgkJLy8JCXwJLy8gcmVtb3ZlIGFsbCBvZiB0aGUgZWxlbWVudHMgaW4gdGhlIGxpc3QgZnJvbSB0aGVpcg0KCQkvLwkJfAkvLyBwYXJlbnRzIChha2luIHRvICJkZWxldGluZyIgdGhlbSBmcm9tIHRoZSBkb2N1bWVudCkNCgkJLy8JCXwJZG9qby5xdWVyeSgiLnRoaW5nZXIiKS5vcnBoYW4oKTsNCgkJLy8JCXwJLy8gcGxhY2UgYWxsIGVsZW1lbnRzIGluIHRoZSBsaXN0IGF0IHRoZSBmcm9udCBvZiAjZm9vDQoJCS8vCQl8CWRvam8ucXVlcnkoIi50aGluZ2VyIikucGxhY2UoImZvbyIsICJmaXJzdCIpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJRXZlbnQgaGFuZGxpbmcgY291bGRuJ3QgYmUgZWFzaWVyLiBgZG9qby5jb25uZWN0YCBpcyBtYXBwZWQgaW4sDQoJCS8vCQlhbmQgc2hvcnRjdXQgaGFuZGxlcnMgYXJlIHByb3ZpZGVkIGZvciBtb3N0IERPTSBldmVudHM6DQoJCS8vCQl8CS8vIGxpa2UgZG9qby5jb25uZWN0KCksIGJ1dCB3aXRoIGltcGxpY2l0IHNjb3BlDQoJCS8vCQl8CWRvam8ucXVlcnkoImxpIikuY29ubmVjdCgib25jbGljayIsIGNvbnNvbGUsICJsb2ciKTsNCgkJLy8JCXwNCgkJLy8JCXwJLy8gbWFueSBjb21tb24gZXZlbnQgaGFuZGxlcnMgYXJlIGFscmVhZHkgYXZhaWxhYmxlIGRpcmVjdGx5Og0KCQkvLwkJfAlkb2pvLnF1ZXJ5KCJsaSIpLm9uY2xpY2soY29uc29sZSwgImxvZyIpOw0KCQkvLwkJfAl2YXIgdG9nZ2xlSG92ZXJlZCA9IGRvam8uaGl0Y2goZG9qbywgInRvZ2dsZUNsYXNzIiwgImhvdmVyZWQiKTsNCgkJLy8JCXwJZG9qby5xdWVyeSgicCIpDQoJCS8vCQl8CQkub25tb3VzZWVudGVyKHRvZ2dsZUhvdmVyZWQpDQoJCS8vCQl8CQkub25tb3VzZWxlYXZlKHRvZ2dsZUhvdmVyZWQpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJY2hhaW5hYmlsaXR5IGlzIGEga2V5IGFkdmFudGFnZSBvZiBOb2RlTGlzdHM6DQoJCS8vCQl8CWRvam8ucXVlcnkoIi50aGluZ2VyIikNCgkJLy8JCXwJCS5vbmNsaWNrKGZ1bmN0aW9uKGUpeyAvKiAuLi4gKi8gfSkNCgkJLy8JCXwJCS5hdCgxLCAzLCA4KSAvLyBnZXQgYSBzdWJzZXQNCgkJLy8JCXwJCQkuc3R5bGUoInBhZGRpbmciLCAiNXB4IikNCgkJLy8JCXwJCQkuZm9yRWFjaChjb25zb2xlLmxvZyk7DQoNCgkJcmV0dXJuIHRubChBcnJheS5hcHBseShudWxsLCBhcmd1bWVudHMpKTsNCgl9Ow0KDQoJLy9BbGxvdyB0aGluZ3MgdGhhdCBuZXcgdXAgYSBOb2RlTGlzdCB0byB1c2UgYSBkZWxlZ2F0ZWQgb3IgYWx0ZXJuYXRlIE5vZGVMaXN0IGltcGxlbWVudGF0aW9uLg0KCWQuX05vZGVMaXN0Q3RvciA9IGQuTm9kZUxpc3Q7DQoNCgl2YXIgbmwgPSBkLk5vZGVMaXN0LCBubHAgPSBubC5wcm90b3R5cGU7DQoNCgkvLyBleHBvc2UgYWRhcHRlcnMgYW5kIHRoZSB3cmFwcGVyIGFzIHByaXZhdGUgZnVuY3Rpb25zDQoNCglubC5fd3JhcCA9IG5scC5fd3JhcCA9IHRubDsNCglubC5fYWRhcHRBc01hcCA9IGFkYXB0QXNNYXA7DQoJbmwuX2FkYXB0QXNGb3JFYWNoID0gYWRhcHRBc0ZvckVhY2g7DQoJbmwuX2FkYXB0QXNGaWx0ZXIgID0gYWRhcHRBc0ZpbHRlcjsNCglubC5fYWRhcHRXaXRoQ29uZGl0aW9uID0gYWRhcHRXaXRoQ29uZGl0aW9uOw0KDQoJLy8gbWFzcyBhc3NpZ25tZW50DQoNCgkvLyBhZGQgYXJyYXkgcmVkaXJlY3RvcnMNCglkLmZvckVhY2goWyJzbGljZSIsICJzcGxpY2UiXSwgZnVuY3Rpb24obmFtZSl7DQoJCXZhciBmID0gYXBbbmFtZV07DQoJCS8vVXNlIGEgY29weSBvZiB0aGUgdGhpcyBhcnJheSB2aWEgdGhpcy5zbGljZSgpIHRvIGFsbG93IC5lbmQoKSB0byB3b3JrIHJpZ2h0IGluIHRoZSBzcGxpY2UgY2FzZS4NCgkJLy8gQ0FOTk9UIGFwcGx5IC5fc3Rhc2goKS9lbmQoKSB0byBzcGxpY2Ugc2luY2UgaXQgY3VycmVudGx5IG1vZGlmaWVzDQoJCS8vIHRoZSBleGlzdGluZyB0aGlzIGFycmF5IC0tIGl0IHdvdWxkIGJyZWFrIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgaWYgd2UgY29weSB0aGUgYXJyYXkgYmVmb3JlDQoJCS8vIHRoZSBzcGxpY2Ugc28gdGhhdCB3ZSBjYW4gdXNlIC5lbmQoKS4gU28gb25seSBkb2luZyB0aGUgc3Rhc2ggb3B0aW9uIHRvIHRoaXMuX3dyYXAgZm9yIHNsaWNlLg0KCQlubHBbbmFtZV0gPSBmdW5jdGlvbigpeyByZXR1cm4gdGhpcy5fd3JhcChmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIG5hbWUgPT0gInNsaWNlIiA/IHRoaXMgOiBudWxsKTsgfTsNCgl9KTsNCgkvLyBjb25jYXQgc2hvdWxkIGJlIGhlcmUgYnV0IHNvbWUgYnJvd3NlcnMgd2l0aCBuYXRpdmUgTm9kZUxpc3QgaGF2ZSBwcm9ibGVtcyB3aXRoIGl0DQoNCgkvLyBhZGQgYXJyYXkuanMgcmVkaXJlY3RvcnMNCglkLmZvckVhY2goWyJpbmRleE9mIiwgImxhc3RJbmRleE9mIiwgImV2ZXJ5IiwgInNvbWUiXSwgZnVuY3Rpb24obmFtZSl7DQoJCXZhciBmID0gZFtuYW1lXTsNCgkJbmxwW25hbWVdID0gZnVuY3Rpb24oKXsgcmV0dXJuIGYuYXBwbHkoZCwgW3RoaXNdLmNvbmNhdChhcHMuY2FsbChhcmd1bWVudHMsIDApKSk7IH07DQoJfSk7DQoNCgkvLyBhZGQgY29uZGl0aW9uYWwgbWV0aG9kcw0KCWQuZm9yRWFjaChbImF0dHIiLCAic3R5bGUiXSwgZnVuY3Rpb24obmFtZSl7DQoJCW5scFtuYW1lXSA9IGFkYXB0V2l0aENvbmRpdGlvbihkW25hbWVdLCBtYWdpY0d1YXJkKTsNCgl9KTsNCg0KCS8vIGFkZCBmb3JFYWNoIGFjdGlvbnMNCglkLmZvckVhY2goWyJjb25uZWN0IiwgImFkZENsYXNzIiwgInJlbW92ZUNsYXNzIiwgInRvZ2dsZUNsYXNzIiwgImVtcHR5IiwgInJlbW92ZUF0dHIiXSwgZnVuY3Rpb24obmFtZSl7DQoJCW5scFtuYW1lXSA9IGFkYXB0QXNGb3JFYWNoKGRbbmFtZV0pOw0KCX0pOw0KDQoJZG9qby5leHRlbmQoZG9qby5Ob2RlTGlzdCwgew0KCQlfbm9ybWFsaXplOiBmdW5jdGlvbigvKlN0cmluZ3x8RWxlbWVudHx8T2JqZWN0fHxOb2RlTGlzdCovY29udGVudCwgLypET01Ob2RlPyovcmVmTm9kZSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8gCQlub3JtYWxpemVzIGRhdGEgdG8gYW4gYXJyYXkgb2YgaXRlbXMgdG8gaW5zZXJ0Lg0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLyAJCUlmIGNvbnRlbnQgaXMgYW4gb2JqZWN0LCBpdCBjYW4gaGF2ZSBzcGVjaWFsIHByb3BlcnRpZXMgInRlbXBsYXRlIiBhbmQNCgkJCS8vIAkJInBhcnNlIi4gSWYgInRlbXBsYXRlIiBpcyBkZWZpbmVkLCB0aGVuIHRoZSB0ZW1wbGF0ZSB2YWx1ZSBpcyBydW4gdGhyb3VnaA0KCQkJLy8gCQlkb2pvLnN0cmluZy5zdWJzdGl0dXRlIChpZiBkb2pvLnN0cmluZy5zdWJzdGl0dXRlIGhhcyBiZWVuIGRvam8ucmVxdWlyZWQgZWxzZXdoZXJlKSwNCgkJCS8vIAkJb3IgaWYgdGVtcGxhdGVGdW5jIGlzIGEgZnVuY3Rpb24gb24gdGhlIGNvbnRlbnQsIHRoYXQgZnVuY3Rpb24gd2lsbCBiZSB1c2VkIHRvDQoJCQkvLyAJCXRyYW5zZm9ybSB0aGUgdGVtcGxhdGUgaW50byBhIGZpbmFsIHN0cmluZyB0byBiZSB1c2VkIGZvciBmb3IgcGFzc2luZyB0byBkb2pvLl90b0RvbS4NCgkJCS8vIAkJSWYgY29udGVudC5wYXJzZSBpcyB0cnVlLCB0aGVuIGl0IGlzIHJlbWVtYmVyZWQgZm9yIGxhdGVyLCBmb3Igd2hlbiB0aGUgY29udGVudA0KCQkJLy8gCQlub2RlcyBhcmUgaW5zZXJ0ZWQgaW50byB0aGUgRE9NLiBBdCB0aGF0IHBvaW50LCB0aGUgbm9kZXMgd2lsbCBiZSBwYXJzZWQgZm9yIHdpZGdldHMNCgkJCS8vIAkJKGlmIGRvam8ucGFyc2VyIGhhcyBiZWVuIGRvam8ucmVxdWlyZWQgZWxzZXdoZXJlKS4NCg0KCQkJLy9XYW50ZWQgdG8ganVzdCB1c2UgYSBEb2N1bWVudEZyYWdtZW50LCBidXQgZm9yIHRoZSBhcnJheS9Ob2RlTGlzdA0KCQkJLy9jYXNlIHRoYXQgbWVhbnQgIHVzaW5nIGNsb25lTm9kZSwgYnV0IHdlIG1heSBub3Qgd2FudCB0aGF0Lg0KCQkJLy9DbG9uaW5nIHNob3VsZCBvbmx5IGhhcHBlbiBpZiB0aGUgbm9kZSBvcGVyYXRpb25zIHNwYW4NCgkJCS8vbXVsdGlwbGUgcmVmTm9kZXMuIEFsc28sIG5lZWQgYSByZWFsIGFycmF5LCBub3QgYSBOb2RlTGlzdCBmcm9tIHRoZQ0KCQkJLy9ET00gc2luY2UgdGhlIG5vZGUgbW92ZW1lbnRzIGNvdWxkIGNoYW5nZSB0aG9zZSBOb2RlTGlzdHMuDQoNCgkJCXZhciBwYXJzZSA9IGNvbnRlbnQucGFyc2UgPT09IHRydWUgPyB0cnVlIDogZmFsc2U7DQoNCgkJCS8vRG8gd2UgaGF2ZSBhbiBvYmplY3QgdGhhdCBuZWVkcyB0byBiZSBydW4gdGhyb3VnaCBhIHRlbXBsYXRlPw0KCQkJaWYodHlwZW9mIGNvbnRlbnQudGVtcGxhdGUgPT0gInN0cmluZyIpew0KCQkJCXZhciB0ZW1wbGF0ZUZ1bmMgPSBjb250ZW50LnRlbXBsYXRlRnVuYyB8fCAoZG9qby5zdHJpbmcgJiYgZG9qby5zdHJpbmcuc3Vic3RpdHV0ZSk7DQoJCQkJY29udGVudCA9IHRlbXBsYXRlRnVuYyA/IHRlbXBsYXRlRnVuYyhjb250ZW50LnRlbXBsYXRlLCBjb250ZW50KSA6IGNvbnRlbnQ7DQoJCQl9DQoNCgkJCXZhciB0eXBlID0gKHR5cGVvZiBjb250ZW50KTsNCgkJCWlmKHR5cGUgPT0gInN0cmluZyIgfHwgdHlwZSA9PSAibnVtYmVyIil7DQoJCQkJY29udGVudCA9IGRvam8uX3RvRG9tKGNvbnRlbnQsIChyZWZOb2RlICYmIHJlZk5vZGUub3duZXJEb2N1bWVudCkpOw0KCQkJCWlmKGNvbnRlbnQubm9kZVR5cGUgPT0gMTEpew0KCQkJCQkvL0RvY3VtZW50RnJhZ21lbnQuIEl0IGNhbm5vdCBoYW5kbGUgY2xvbmVOb2RlIGNhbGxzLCBzbyBwdWxsIG91dCB0aGUgY2hpbGRyZW4uDQoJCQkJCWNvbnRlbnQgPSBkb2pvLl90b0FycmF5KGNvbnRlbnQuY2hpbGROb2Rlcyk7DQoJCQkJfWVsc2V7DQoJCQkJCWNvbnRlbnQgPSBbY29udGVudF07DQoJCQkJfQ0KCQkJfWVsc2UgaWYoIWRvam8uaXNBcnJheUxpa2UoY29udGVudCkpew0KCQkJCWNvbnRlbnQgPSBbY29udGVudF07DQoJCQl9ZWxzZSBpZighZG9qby5pc0FycmF5KGNvbnRlbnQpKXsNCgkJCQkvL1RvIGdldCB0byB0aGlzIHBvaW50LCBjb250ZW50IGlzIGFycmF5LWxpa2UsIGJ1dA0KCQkJCS8vbm90IGFuIGFycmF5LCB3aGljaCBsaWtlbHkgbWVhbnMgYSBET00gTm9kZUxpc3QuIENvbnZlcnQgaXQgbm93Lg0KCQkJCWNvbnRlbnQgPSBkb2pvLl90b0FycmF5KGNvbnRlbnQpOw0KCQkJfQ0KDQoJCQkvL1Bhc3MgYXJvdW5kIHRoZSBwYXJzZSBpbmZvDQoJCQlpZihwYXJzZSl7DQoJCQkJY29udGVudC5fcnVuUGFyc2UgPSB0cnVlOw0KCQkJfQ0KCQkJcmV0dXJuIGNvbnRlbnQ7IC8vQXJyYXkNCgkJfSwNCg0KCQlfY2xvbmVOb2RlOiBmdW5jdGlvbigvKkRPTU5vZGUqLyBub2RlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLyAJCXByaXZhdGUgdXRpbHRpdHkgdG8gY2xvbmUgYSBub2RlLiBOb3QgdmVyeSBpbnRlcmVzdGluZyBpbiB0aGUgdmFuaWxsYQ0KCQkJLy8gCQlkb2pvLk5vZGVMaXN0IGNhc2UsIGJ1dCBkZWxlZ2F0ZXMgY291bGQgZG8gaW50ZXJlc3RpbmcgdGhpbmdzIGxpa2UNCgkJCS8vIAkJY2xvbmUgZXZlbnQgaGFuZGxlcnMgaWYgdGhhdCBpcyBkZXJpdmFibGUgZnJvbSB0aGUgbm9kZS4NCgkJCXJldHVybiBub2RlLmNsb25lTm9kZSh0cnVlKTsNCgkJfSwNCg0KCQlfcGxhY2U6IGZ1bmN0aW9uKC8qQXJyYXkqL2FyeSwgLypET01Ob2RlKi9yZWZOb2RlLCAvKlN0cmluZyovcG9zaXRpb24sIC8qQm9vbGVhbiovdXNlQ2xvbmUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vIAkJcHJpdmF0ZSB1dGlsaXR5IHRvIGhhbmRsZSBwbGFjaW5nIGFuIGFycmF5IG9mIG5vZGVzIHJlbGF0aXZlIHRvIGFub3RoZXIgbm9kZS4NCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8gCQlBbGxvd3MgZm9yIGNsb25pbmcgdGhlIG5vZGVzIGluIHRoZSBhcnJheSwgYW5kIGZvcg0KCQkJLy8gCQlvcHRpb25hbGx5IHBhcnNpbmcgd2lkZ2V0cywgaWYgYXJ5Ll9ydW5QYXJzZSBpcyB0cnVlLg0KDQoJCQkvL0F2b2lkIGEgZGlzYWxsb3dlZCBvcGVyYXRpb24gaWYgdHJ5aW5nIHRvIGRvIGFuIGlubmVySFRNTCBvbiBhIG5vbi1lbGVtZW50IG5vZGUuDQoJCQlpZihyZWZOb2RlLm5vZGVUeXBlICE9IDEgJiYgcG9zaXRpb24gPT0gIm9ubHkiKXsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQl2YXIgck5vZGUgPSByZWZOb2RlLCB0ZW1wTm9kZTsNCg0KCQkJLy9BbHdheXMgY3ljbGUgYmFja3dhcmRzIGluIGNhc2UgdGhlIGFycmF5IGlzIHJlYWxseSBhDQoJCQkvL0RPTSBOb2RlTGlzdCBhbmQgdGhlIERPTSBvcGVyYXRpb25zIHRha2UgaXQgb3V0IG9mIHRoZSBsaXZlIGNvbGxlY3Rpb24uDQoJCQl2YXIgbGVuZ3RoID0gYXJ5Lmxlbmd0aDsNCgkJCWZvcih2YXIgaSA9IGxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsNCgkJCQl2YXIgbm9kZSA9ICh1c2VDbG9uZSA/IHRoaXMuX2Nsb25lTm9kZShhcnlbaV0pIDogYXJ5W2ldKTsNCg0KCQkJCS8vSWYgbmVlZCB3aWRnZXQgcGFyc2luZywgdXNlIGEgdGVtcCBub2RlLCBpbnN0ZWFkIG9mIHdhaXRpbmcgYWZ0ZXIgaW5zZXJ0aW5nIGludG8NCgkJCQkvL3JlYWwgRE9NIGJlY2F1c2Ugd2UgbmVlZCB0byBzdGFydCB3aWRnZXQgcGFyc2luZyBhdCBvbmUgbm9kZSB1cCBmcm9tIGN1cnJlbnQgbm9kZSwNCgkJCQkvL3doaWNoIGNvdWxkIGNhdXNlIHNvbWUgYWxyZWFkeSBwYXJzZWQgd2lkZ2V0cyB0byBiZSBwYXJzZWQgYWdhaW4uDQoJCQkJaWYoYXJ5Ll9ydW5QYXJzZSAmJiBkb2pvLnBhcnNlciAmJiBkb2pvLnBhcnNlci5wYXJzZSl7DQoJCQkJCWlmKCF0ZW1wTm9kZSl7DQoJCQkJCQl0ZW1wTm9kZSA9IHJOb2RlLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQkJCX0NCgkJCQkJdGVtcE5vZGUuYXBwZW5kQ2hpbGQobm9kZSk7DQoJCQkJCWRvam8ucGFyc2VyLnBhcnNlKHRlbXBOb2RlKTsNCgkJCQkJbm9kZSA9IHRlbXBOb2RlLmZpcnN0Q2hpbGQ7DQoJCQkJCXdoaWxlKHRlbXBOb2RlLmZpcnN0Q2hpbGQpew0KCQkJCQkJdGVtcE5vZGUucmVtb3ZlQ2hpbGQodGVtcE5vZGUuZmlyc3RDaGlsZCk7DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlpZihpID09IGxlbmd0aCAtIDEpew0KCQkJCQlkb2pvLnBsYWNlKG5vZGUsIHJOb2RlLCBwb3NpdGlvbik7DQoJCQkJfWVsc2V7DQoJCQkJCXJOb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIHJOb2RlKTsNCgkJCQl9DQoJCQkJck5vZGUgPSBub2RlOw0KCQkJfQ0KCQl9LA0KDQoJCV9zdGFzaDogZnVuY3Rpb24ocGFyZW50KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLyAJCXByaXZhdGUgZnVuY3Rpb24gdG8gaG9sZCB0byBhIHBhcmVudCBOb2RlTGlzdC4gZW5kKCkgdG8gcmV0dXJuIHRoZSBwYXJlbnQgTm9kZUxpc3QuDQoJCQkvLw0KCQkJLy8gZXhhbXBsZToNCgkJCS8vIEhvdyB0byBtYWtlIGEgYGRvam8uTm9kZUxpc3RgIG1ldGhvZCB0aGF0IG9ubHkgcmV0dXJucyB0aGUgdGhpcmQgbm9kZSBpbg0KCQkJLy8gdGhlIGRvam8uTm9kZUxpc3QgYnV0IGFsbG93cyBhY2Nlc3MgdG8gdGhlIG9yaWdpbmFsIE5vZGVMaXN0IGJ5IHVzaW5nIHRoaXMuX3N0YXNoOg0KCQkJLy8JfAlkb2pvLmV4dGVuZChkb2pvLk5vZGVMaXN0LCB7DQoJCQkvLwl8CQl0aGlyZDogZnVuY3Rpb24oKXsNCgkJCS8vICB8CQkJdmFyIG5ld05vZGVMaXN0ID0gZG9qby5Ob2RlTGlzdCh0aGlzWzJdKTsNCgkJCS8vCXwJCQlyZXR1cm4gbmV3Tm9kZUxpc3QuX3N0YXNoKHRoaXMpOw0KCQkJLy8JfAkJfQ0KCQkJLy8JfAl9KTsNCgkJCS8vCXwJLy8gdGhlbiBzZWUgaG93IF9zdGFzaCBhcHBsaWVzIGEgc3ViLWxpc3QsIHRvIGJlIC5lbmQoKSdlZCBvdXQgb2YNCgkJCS8vCXwJZG9qby5xdWVyeSgiLmZvbyIpDQoJCQkvLwl8CQkudGhpcmQoKQ0KCQkJLy8JfAkJCS5hZGRDbGFzcygidGhpcmRGb28iKQ0KCQkJLy8JfAkJLmVuZCgpDQoJCQkvLwl8CQkvLyBhY2Nlc3MgdG8gdGhlIG9yaWcgLmZvbyBsaXN0DQoJCQkvLwl8CQkucmVtb3ZlQ2xhc3MoImZvbyIpDQoJCQkvLwl8DQoJCQkvLw0KCQkJdGhpcy5fcGFyZW50ID0gcGFyZW50Ow0KCQkJcmV0dXJuIHRoaXM7IC8vZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCWVuZDogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLyAJCUVuZHMgdXNlIG9mIHRoZSBjdXJyZW50IGBkb2pvLk5vZGVMaXN0YCBieSByZXR1cm5pbmcgdGhlIHByZXZpb3VzIGRvam8uTm9kZUxpc3QNCgkJCS8vIAkJdGhhdCBnZW5lcmF0ZWQgdGhlIGN1cnJlbnQgZG9qby5Ob2RlTGlzdC4NCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8gCQlSZXR1cm5zIHRoZSBgZG9qby5Ob2RlTGlzdGAgdGhhdCBnZW5lcmF0ZWQgdGhlIGN1cnJlbnQgYGRvam8uTm9kZUxpc3RgLiBJZiB0aGVyZQ0KCQkJLy8gCQlpcyBubyBwYXJlbnQgZG9qby5Ob2RlTGlzdCwgYW4gZW1wdHkgZG9qby5Ob2RlTGlzdCBpcyByZXR1cm5lZC4NCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CWRvam8ucXVlcnkoImEiKQ0KCQkJLy8JfAkJLmZpbHRlcigiLmRpc2FibGVkIikNCgkJCS8vCXwJCQkvLyBvcGVyYXRlIG9uIHRoZSBhbmNob3JzIHRoYXQgb25seSBoYXZlIGEgZGlzYWJsZWQgY2xhc3MNCgkJCS8vCXwJCQkuc3R5bGUoImNvbG9yIiwgImdyZXkiKQ0KCQkJLy8JfAkJLmVuZCgpDQoJCQkvLwl8CQkvLyBqdW1wIGJhY2sgdG8gdGhlIGxpc3Qgb2YgYW5jaG9ycw0KCQkJLy8JfAkJLnN0eWxlKC4uLikNCgkJCS8vDQoJCQlpZih0aGlzLl9wYXJlbnQpew0KCQkJCXJldHVybiB0aGlzLl9wYXJlbnQ7DQoJCQl9ZWxzZXsNCgkJCQkvL0p1c3QgcmV0dXJuIGVtcHkgbGlzdC4NCgkJCQlyZXR1cm4gbmV3IHRoaXMuX05vZGVMaXN0Q3RvcigpOw0KCQkJfQ0KCQl9LA0KDQoJCS8vIGh0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheSNNZXRob2RzDQoNCgkJLy8gRklYTUU6IGhhbmRsZSByZXR1cm4gdmFsdWVzIGZvciAjMzI0NA0KCQkvLwkJaHR0cDovL3RyYWMuZG9qb3Rvb2xraXQub3JnL3RpY2tldC8zMjQ0DQoNCgkJLy8gRklYTUU6DQoJCS8vCQluZWVkIHRvIHdyYXAgb3IgaW1wbGVtZW50Og0KCQkvLwkJCWpvaW4gKHBlcmhhcHMgdy8gaW5uZXJIVE1ML291dGVySFRNTCBvdmVybG9hZCBmb3IgdG9TdHJpbmcoKSBvZiBpdGVtcz8pDQoJCS8vCQkJcmVkdWNlDQoJCS8vCQkJcmVkdWNlUmlnaHQNCg0KCQkvKj09PT09DQoJCXNsaWNlOiBmdW5jdGlvbihiZWdpbiwgZW5kKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIG5ldyBOb2RlTGlzdCwgbWFpbnRhaW5pbmcgdGhpcyBvbmUgaW4gcGxhY2UNCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgbWV0aG9kIGJlaGF2ZXMgZXhhY3RseSBsaWtlIHRoZSBBcnJheS5zbGljZSBtZXRob2QNCgkJCS8vCQl3aXRoIHRoZSBjYXZlYXQgdGhhdCBpdCByZXR1cm5zIGEgZG9qby5Ob2RlTGlzdCBhbmQgbm90IGENCgkJCS8vCQlyYXcgQXJyYXkuIEZvciBtb3JlIGRldGFpbHMsIHNlZSBNb3ppbGxhJ3MgKHNsaWNlDQoJCQkvLwkJZG9jdW1lbnRhdGlvbilbaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlOkdsb2JhbF9PYmplY3RzOkFycmF5OnNsaWNlXQ0KCQkJLy8gYmVnaW46IEludGVnZXINCgkJCS8vCQlDYW4gYmUgYSBwb3NpdGl2ZSBvciBuZWdhdGl2ZSBpbnRlZ2VyLCB3aXRoIHBvc2l0aXZlDQoJCQkvLwkJaW50ZWdlcnMgbm90aW5nIHRoZSBvZmZzZXQgdG8gYmVnaW4gYXQsIGFuZCBuZWdhdGl2ZQ0KCQkJLy8JCWludGVnZXJzIGRlbm90aW5nIGFuIG9mZnNldCBmcm9tIHRoZSBlbmQgKGkuZS4sIHRvIHRoZSBsZWZ0DQoJCQkvLwkJb2YgdGhlIGVuZCkNCgkJCS8vIGVuZDogSW50ZWdlcj8NCgkJCS8vCQlPcHRpb25hbCBwYXJhbWV0ZXIgdG8gZGVzY3JpYmUgd2hhdCBwb3NpdGlvbiByZWxhdGl2ZSB0bw0KCQkJLy8JCXRoZSBOb2RlTGlzdCdzIHplcm8gaW5kZXggdG8gZW5kIHRoZSBzbGljZSBhdC4gTGlrZSBiZWdpbiwNCgkJCS8vCQljYW4gYmUgcG9zaXRpdmUgb3IgbmVnYXRpdmUuDQoJCQlyZXR1cm4gdGhpcy5fd3JhcChhLnNsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOw0KCQl9LA0KDQoJCXNwbGljZTogZnVuY3Rpb24oaW5kZXgsIGhvd21hbnksIGl0ZW0pew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgbmV3IE5vZGVMaXN0LCBtYW5pcHVsYXRpbmcgdGhpcyBOb2RlTGlzdCBiYXNlZCBvbg0KCQkJLy8JCXRoZSBhcmd1bWVudHMgcGFzc2VkLCBwb3RlbnRpYWxseSBzcGxpY2luZyBpbiBuZXcgZWxlbWVudHMNCgkJCS8vCQlhdCBhbiBvZmZzZXQsIG9wdGlvbmFsbHkgZGVsZXRpbmcgZWxlbWVudHMNCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgbWV0aG9kIGJlaGF2ZXMgZXhhY3RseSBsaWtlIHRoZSBBcnJheS5zcGxpY2UgbWV0aG9kDQoJCQkvLwkJd2l0aCB0aGUgY2F2ZWF0IHRoYXQgaXQgcmV0dXJucyBhIGRvam8uTm9kZUxpc3QgYW5kIG5vdCBhDQoJCQkvLwkJcmF3IEFycmF5LiBGb3IgbW9yZSBkZXRhaWxzLCBzZWUgTW96aWxsYSdzIChzcGxpY2UNCgkJCS8vCQlkb2N1bWVudGF0aW9uKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6c3BsaWNlXQ0KCQkJLy8gCQlGb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHksIGNhbGxpbmcgLmVuZCgpIG9uIHRoZSBzcGxpY2VkIE5vZGVMaXN0DQoJCQkvLyAJCWRvZXMgbm90IHJldHVybiB0aGUgb3JpZ2luYWwgTm9kZUxpc3QgLS0gc3BsaWNlIGFsdGVycyB0aGUgTm9kZUxpc3QgaW4gcGxhY2UuDQoJCQkvLyBpbmRleDogSW50ZWdlcg0KCQkJLy8JCWJlZ2luIGNhbiBiZSBhIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIGludGVnZXIsIHdpdGggcG9zaXRpdmUNCgkJCS8vCQlpbnRlZ2VycyBub3RpbmcgdGhlIG9mZnNldCB0byBiZWdpbiBhdCwgYW5kIG5lZ2F0aXZlDQoJCQkvLwkJaW50ZWdlcnMgZGVub3RpbmcgYW4gb2Zmc2V0IGZyb20gdGhlIGVuZCAoaS5lLiwgdG8gdGhlIGxlZnQNCgkJCS8vCQlvZiB0aGUgZW5kKQ0KCQkJLy8gaG93bWFueTogSW50ZWdlcj8NCgkJCS8vCQlPcHRpb25hbCBwYXJhbWV0ZXIgdG8gZGVzY3JpYmUgd2hhdCBwb3NpdGlvbiByZWxhdGl2ZSB0bw0KCQkJLy8JCXRoZSBOb2RlTGlzdCdzIHplcm8gaW5kZXggdG8gZW5kIHRoZSBzbGljZSBhdC4gTGlrZSBiZWdpbiwNCgkJCS8vCQljYW4gYmUgcG9zaXRpdmUgb3IgbmVnYXRpdmUuDQoJCQkvLyBpdGVtOiBPYmplY3QuLi4/DQoJCQkvLwkJQW55IG51bWJlciBvZiBvcHRpb25hbCBwYXJhbWV0ZXJzIG1heSBiZSBwYXNzZWQgaW4gdG8gYmUNCgkJCS8vCQlzcGxpY2VkIGludG8gdGhlIE5vZGVMaXN0DQoJCQkvLyByZXR1cm5zOg0KCQkJLy8JCWRvam8uTm9kZUxpc3QNCgkJCXJldHVybiB0aGlzLl93cmFwKGEuc3BsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOw0KCQl9LA0KDQoJCWluZGV4T2Y6IGZ1bmN0aW9uKHZhbHVlLCBmcm9tSW5kZXgpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlzZWUgZG9qby5pbmRleE9mKCkuIFRoZSBwcmltYXJ5IGRpZmZlcmVuY2UgaXMgdGhhdCB0aGUgYWN0ZWQtb24gDQoJCQkvLwkJYXJyYXkgaXMgaW1wbGljaXRseSB0aGlzIE5vZGVMaXN0DQoJCQkvLyB2YWx1ZTogT2JqZWN0Og0KCQkJLy8JCVRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLg0KCQkJLy8gZnJvbUluZGV4OiBJbnRlZ2VyPzoNCgkJCS8vCQlUaGUgbG9jdGlvbiB0byBzdGFydCBzZWFyY2hpbmcgZnJvbS4gT3B0aW9uYWwuIERlZmF1bHRzIHRvIDAuDQoJCQkvLwlkZXNjcmlwdGlvbjoNCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzIG9uIHRoZSBiZWhhdmlvciBvZiBpbmRleE9mLCBzZWUgTW96aWxsYSdzDQoJCQkvLwkJKGluZGV4T2YNCgkJCS8vCQlkb2NzKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6aW5kZXhPZl0NCgkJCS8vCXJldHVybnM6DQoJCQkvLwkJUG9zaXRpdmUgSW50ZWdlciBvciAwIGZvciBhIG1hdGNoLCAtMSBvZiBub3QgZm91bmQuDQoJCQlyZXR1cm4gZC5pbmRleE9mKHRoaXMsIHZhbHVlLCBmcm9tSW5kZXgpOyAvLyBJbnRlZ2VyDQoJCX0sDQoNCgkJbGFzdEluZGV4T2Y6IGZ1bmN0aW9uKHZhbHVlLCBmcm9tSW5kZXgpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlzZWUgZG9qby5sYXN0SW5kZXhPZigpLiBUaGUgcHJpbWFyeSBkaWZmZXJlbmNlIGlzIHRoYXQgdGhlDQoJCQkvLwkJYWN0ZWQtb24gYXJyYXkgaXMgaW1wbGljaXRseSB0aGlzIE5vZGVMaXN0DQoJCQkvLwlkZXNjcmlwdGlvbjoNCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzIG9uIHRoZSBiZWhhdmlvciBvZiBsYXN0SW5kZXhPZiwgc2VlDQoJCQkvLwkJTW96aWxsYSdzIChsYXN0SW5kZXhPZg0KCQkJLy8JCWRvY3MpW2h0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheTpsYXN0SW5kZXhPZl0NCgkJCS8vIHZhbHVlOiBPYmplY3QNCgkJCS8vCQlUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4NCgkJCS8vIGZyb21JbmRleDogSW50ZWdlcj8NCgkJCS8vCQlUaGUgbG9jdGlvbiB0byBzdGFydCBzZWFyY2hpbmcgZnJvbS4gT3B0aW9uYWwuIERlZmF1bHRzIHRvIDAuDQoJCQkvLyByZXR1cm5zOg0KCQkJLy8JCVBvc2l0aXZlIEludGVnZXIgb3IgMCBmb3IgYSBtYXRjaCwgLTEgb2Ygbm90IGZvdW5kLg0KCQkJcmV0dXJuIGQubGFzdEluZGV4T2YodGhpcywgdmFsdWUsIGZyb21JbmRleCk7IC8vIEludGVnZXINCgkJfSwNCg0KCQlldmVyeTogZnVuY3Rpb24oY2FsbGJhY2ssIHRoaXNPYmplY3Qpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlzZWUgYGRvam8uZXZlcnkoKWAgYW5kIHRoZSAoQXJyYXkuZXZlcnkNCgkJCS8vCQlkb2NzKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6ZXZlcnldLg0KCQkJLy8JCVRha2VzIHRoZSBzYW1lIHN0cnVjdHVyZSBvZiBhcmd1bWVudHMgYW5kIHJldHVybnMgYXMNCgkJCS8vCQlkb2pvLmV2ZXJ5KCkgd2l0aCB0aGUgY2F2ZWF0IHRoYXQgdGhlIHBhc3NlZCBhcnJheSBpcw0KCQkJLy8JCWltcGxpY2l0bHkgdGhpcyBOb2RlTGlzdA0KCQkJLy8gY2FsbGJhY2s6IEZ1bmN0aW9uOiB0aGUgY2FsbGJhY2sNCgkJCS8vIHRoaXNPYmplY3Q6IE9iamVjdD86IHRoZSBjb250ZXh0DQoJCQlyZXR1cm4gZC5ldmVyeSh0aGlzLCBjYWxsYmFjaywgdGhpc09iamVjdCk7IC8vIEJvb2xlYW4NCgkJfSwNCg0KCQlzb21lOiBmdW5jdGlvbihjYWxsYmFjaywgdGhpc09iamVjdCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVRha2VzIHRoZSBzYW1lIHN0cnVjdHVyZSBvZiBhcmd1bWVudHMgYW5kIHJldHVybnMgYXMNCgkJCS8vCQlgZG9qby5zb21lKClgIHdpdGggdGhlIGNhdmVhdCB0aGF0IHRoZSBwYXNzZWQgYXJyYXkgaXMNCgkJCS8vCQlpbXBsaWNpdGx5IHRoaXMgTm9kZUxpc3QuICBTZWUgYGRvam8uc29tZSgpYCBhbmQgTW96aWxsYSdzDQoJCQkvLwkJKEFycmF5LnNvbWUNCgkJCS8vCQlkb2N1bWVudGF0aW9uKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6c29tZV0uDQoJCQkvLyBjYWxsYmFjazogRnVuY3Rpb246IHRoZSBjYWxsYmFjaw0KCQkJLy8gdGhpc09iamVjdDogT2JqZWN0PzogdGhlIGNvbnRleHQNCgkJCXJldHVybiBkLnNvbWUodGhpcywgY2FsbGJhY2ssIHRoaXNPYmplY3QpOyAvLyBCb29sZWFuDQoJCX0sDQoJCT09PT09Ki8NCg0KCQljb25jYXQ6IGZ1bmN0aW9uKGl0ZW0pew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgbmV3IE5vZGVMaXN0IGNvbXByaXNlZCBvZiBpdGVtcyBpbiB0aGlzIE5vZGVMaXN0DQoJCQkvLwkJYXMgd2VsbCBhcyBpdGVtcyBwYXNzZWQgaW4gYXMgcGFyYW1ldGVycw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBtZXRob2QgYmVoYXZlcyBleGFjdGx5IGxpa2UgdGhlIEFycmF5LmNvbmNhdCBtZXRob2QNCgkJCS8vCQl3aXRoIHRoZSBjYXZlYXQgdGhhdCBpdCByZXR1cm5zIGEgYGRvam8uTm9kZUxpc3RgIGFuZCBub3QgYQ0KCQkJLy8JCXJhdyBBcnJheS4gRm9yIG1vcmUgZGV0YWlscywgc2VlIHRoZSAoQXJyYXkuY29uY2F0DQoJCQkvLwkJZG9jcylbaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlOkdsb2JhbF9PYmplY3RzOkFycmF5OmNvbmNhdF0NCgkJCS8vIGl0ZW06IE9iamVjdD8NCgkJCS8vCQlBbnkgbnVtYmVyIG9mIG9wdGlvbmFsIHBhcmFtZXRlcnMgbWF5IGJlIHBhc3NlZCBpbiB0byBiZQ0KCQkJLy8JCXNwbGljZWQgaW50byB0aGUgTm9kZUxpc3QNCgkJCS8vIHJldHVybnM6DQoJCQkvLwkJZG9qby5Ob2RlTGlzdA0KDQoJCQkvL3JldHVybiB0aGlzLl93cmFwKGFwYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsNCgkJCS8vIHRoZSBsaW5lIGFib3ZlIHdvbid0IHdvcmsgZm9yIHRoZSBuYXRpdmUgTm9kZUxpc3QgOi0oDQoNCgkJCS8vIGltcGxlbWVudGF0aW9uIG5vdGVzOg0KCQkJLy8gMSkgTmF0aXZlIE5vZGVMaXN0IGlzIG5vdCBhbiBhcnJheSwgYW5kIGNhbm5vdCBiZSB1c2VkIGRpcmVjdGx5DQoJCQkvLyBpbiBjb25jYXQoKSAtLS0gdGhlIGxhdHRlciBkb2Vzbid0IHJlY29nbml6ZSBpdCBhcyBhbiBhcnJheSwgYW5kDQoJCQkvLyBkb2VzIG5vdCBpbmxpbmUgaXQsIGJ1dCBhcHBlbmQgYXMgYSBzaW5nbGUgZW50aXR5Lg0KCQkJLy8gMikgT24gc29tZSBicm93c2VycyAoZS5nLiwgU2FmYXJpKSB0aGUgImNvbnN0cnVjdG9yIiBwcm9wZXJ0eSBpcw0KCQkJLy8gcmVhZC1vbmx5IGFuZCBjYW5ub3QgYmUgY2hhbmdlZC4gU28gd2UgaGF2ZSB0byB0ZXN0IGZvciBib3RoDQoJCQkvLyBuYXRpdmUgTm9kZUxpc3QgYW5kIGRvam8uTm9kZUxpc3QgaW4gdGhpcyBwcm9wZXJ0eSB0byByZWNvZ25pemUNCgkJCS8vIHRoZSBub2RlIGxpc3QuDQoNCgkJCXZhciB0ID0gZC5pc0FycmF5KHRoaXMpID8gdGhpcyA6IGFwcy5jYWxsKHRoaXMsIDApLA0KCQkJCW0gPSBkLm1hcChhcmd1bWVudHMsIGZ1bmN0aW9uKGEpew0KCQkJCQlyZXR1cm4gYSAmJiAhZC5pc0FycmF5KGEpICYmDQoJCQkJCQkodHlwZW9mIE5vZGVMaXN0ICE9ICJ1bmRlZmluZWQiICYmIGEuY29uc3RydWN0b3IgPT09IE5vZGVMaXN0IHx8IGEuY29uc3RydWN0b3IgPT09IHRoaXMuX05vZGVMaXN0Q3RvcikgPw0KCQkJCQkJCWFwcy5jYWxsKGEsIDApIDogYTsNCgkJCQl9KTsNCgkJCXJldHVybiB0aGlzLl93cmFwKGFwYy5hcHBseSh0LCBtKSwgdGhpcyk7CS8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQltYXA6IGZ1bmN0aW9uKC8qRnVuY3Rpb24qLyBmdW5jLCAvKkZ1bmN0aW9uPyovIG9iail7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXNlZSBkb2pvLm1hcCgpLiBUaGUgcHJpbWFyeSBkaWZmZXJlbmNlIGlzIHRoYXQgdGhlIGFjdGVkLW9uDQoJCQkvLwkJYXJyYXkgaXMgaW1wbGljaXRseSB0aGlzIE5vZGVMaXN0IGFuZCB0aGUgcmV0dXJuIGlzIGENCgkJCS8vCQlkb2pvLk5vZGVMaXN0IChhIHN1YmNsYXNzIG9mIEFycmF5KQ0KCQkJLy8vcmV0dXJuIGQubWFwKHRoaXMsIGZ1bmMsIG9iaiwgZC5Ob2RlTGlzdCk7IC8vIGRvam8uTm9kZUxpc3QNCgkJCXJldHVybiB0aGlzLl93cmFwKGQubWFwKHRoaXMsIGZ1bmMsIG9iaiksIHRoaXMpOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJZm9yRWFjaDogZnVuY3Rpb24oY2FsbGJhY2ssIHRoaXNPYmopew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlzZWUgYGRvam8uZm9yRWFjaCgpYC4gVGhlIHByaW1hcnkgZGlmZmVyZW5jZSBpcyB0aGF0IHRoZSBhY3RlZC1vbiANCgkJCS8vCQlhcnJheSBpcyBpbXBsaWNpdGx5IHRoaXMgTm9kZUxpc3QuIElmIHlvdSB3YW50IHRoZSBvcHRpb24gdG8gYnJlYWsgb3V0DQoJCQkvLwkJb2YgdGhlIGZvckVhY2ggbG9vcCwgdXNlIGV2ZXJ5KCkgb3Igc29tZSgpIGluc3RlYWQuDQoJCQlkLmZvckVhY2godGhpcywgY2FsbGJhY2ssIHRoaXNPYmopOw0KCQkJLy8gbm9uLXN0YW5kYXJkIHJldHVybiB0byBhbGxvdyBlYXNpZXIgY2hhaW5pbmcNCgkJCXJldHVybiB0aGlzOyAvLyBkb2pvLk5vZGVMaXN0IA0KCQl9LA0KDQoJCS8qPT09PT0NCgkJY29vcmRzOiBmdW5jdGlvbigpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIHRoZSBib3ggb2JqZWN0cyBvZiBhbGwgZWxlbWVudHMgaW4gYSBub2RlIGxpc3QgYXMNCgkJCS8vCQlhbiBBcnJheSAoKm5vdCogYSBOb2RlTGlzdCkuIEFjdHMgbGlrZSBgZG9qby5jb29yZHNgLCB0aG91Z2ggYXNzdW1lcw0KCQkJLy8JCXRoZSBub2RlIHBhc3NlZCBpcyBlYWNoIG5vZGUgaW4gdGhpcyBsaXN0Lg0KDQoJCQlyZXR1cm4gZC5tYXAodGhpcywgZC5jb29yZHMpOyAvLyBBcnJheQ0KCQl9LA0KDQoJCXBvc2l0aW9uOiBmdW5jdGlvbigpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGJvcmRlci1ib3ggb2JqZWN0cyAoeC95L3cvaCkgb2YgYWxsIGVsZW1lbnRzIGluIGEgbm9kZSBsaXN0DQoJCQkvLwkJYXMgYW4gQXJyYXkgKCpub3QqIGEgTm9kZUxpc3QpLiBBY3RzIGxpa2UgYGRvam8ucG9zaXRpb25gLCB0aG91Z2gNCgkJCS8vCQlhc3N1bWVzIHRoZSBub2RlIHBhc3NlZCBpcyBlYWNoIG5vZGUgaW4gdGhpcyBsaXN0LiANCg0KCQkJcmV0dXJuIGQubWFwKHRoaXMsIGQucG9zaXRpb24pOyAvLyBBcnJheQ0KCQl9LA0KDQoJCWF0dHI6IGZ1bmN0aW9uKHByb3BlcnR5LCB2YWx1ZSl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWdldHMgb3Igc2V0cyB0aGUgRE9NIGF0dHJpYnV0ZSBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUNCgkJCS8vCQlOb2RlTGlzdC4gU2VlIGFsc28gYGRvam8uYXR0cmANCgkJCS8vCXByb3BlcnR5OiBTdHJpbmcNCgkJCS8vCQl0aGUgYXR0cmlidXRlIHRvIGdldC9zZXQNCgkJCS8vCXZhbHVlOiBTdHJpbmc/DQoJCQkvLwkJb3B0aW9uYWwuIFRoZSB2YWx1ZSB0byBzZXQgdGhlIHByb3BlcnR5IHRvDQoJCQkvLwlyZXR1cm5zOg0KCQkJLy8JCWlmIG5vIHZhbHVlIGlzIHBhc3NlZCwgdGhlIHJlc3VsdCBpcyBhbiBhcnJheSBvZiBhdHRyaWJ1dGUgdmFsdWVzDQoJCQkvLwkJSWYgYSB2YWx1ZSBpcyBwYXNzZWQsIHRoZSByZXR1cm4gaXMgdGhpcyBOb2RlTGlzdA0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlNYWtlIGFsbCBub2RlcyB3aXRoIGEgcGFydGljdWxhciBjbGFzcyBmb2N1c2FibGU6DQoJCQkvLwl8CWRvam8ucXVlcnkoIi5mb2N1c2FibGUiKS5hdHRyKCJ0YWJJbmRleCIsIC0xKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJRGlzYWJsZSBhIGdyb3VwIG9mIGJ1dHRvbnM6DQoJCQkvLwl8CWRvam8ucXVlcnkoImJ1dHRvbi5ncm91cCIpLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7DQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCWlubmVySFRNTCBjYW4gYmUgYXNzaWduZWQgb3IgcmV0cmVpdmVkIGFzIHdlbGw6DQoJCQkvLwl8CS8vIGdldCB0aGUgaW5uZXJIVE1MIChhcyBhbiBhcnJheSkgZm9yIGVhY2ggbGlzdCBpdGVtDQoJCQkvLwl8CXZhciBpaCA9IGRvam8ucXVlcnkoImxpLnJlcGxhY2VhYmxlIikuYXR0cigiaW5uZXJIVE1MIik7DQoJCQlyZXR1cm47IC8vIGRvam8uTm9kZUxpc3QNCgkJCXJldHVybjsgLy8gQXJyYXkNCgkJfSwNCg0KCQlzdHlsZTogZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJZ2V0cyBvciBzZXRzIHRoZSBDU1MgcHJvcGVydHkgZm9yIGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIE5vZGVMaXN0DQoJCQkvLwlwcm9wZXJ0eTogU3RyaW5nDQoJCQkvLwkJdGhlIENTUyBwcm9wZXJ0eSB0byBnZXQvc2V0LCBpbiBKYXZhU2NyaXB0IG5vdGF0aW9uDQoJCQkvLwkJKCJsaW5lSGllZ2h0IiBpbnN0ZWFkIG9mICJsaW5lLWhlaWdodCIpDQoJCQkvLwl2YWx1ZTogU3RyaW5nPw0KCQkJLy8JCW9wdGlvbmFsLiBUaGUgdmFsdWUgdG8gc2V0IHRoZSBwcm9wZXJ0eSB0bw0KCQkJLy8JcmV0dXJuczoNCgkJCS8vCQlpZiBubyB2YWx1ZSBpcyBwYXNzZWQsIHRoZSByZXN1bHQgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncy4NCgkJCS8vCQlJZiBhIHZhbHVlIGlzIHBhc3NlZCwgdGhlIHJldHVybiBpcyB0aGlzIE5vZGVMaXN0DQoJCQlyZXR1cm47IC8vIGRvam8uTm9kZUxpc3QNCgkJCXJldHVybjsgLy8gQXJyYXkNCgkJfSwNCg0KCQlhZGRDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJYWRkcyB0aGUgc3BlY2lmaWVkIGNsYXNzIHRvIGV2ZXJ5IG5vZGUgaW4gdGhlIGxpc3QNCgkJCS8vCWNsYXNzTmFtZTogU3RyaW5nfEFycmF5DQoJCQkvLwkJQSBTdHJpbmcgY2xhc3MgbmFtZSB0byBhZGQsIG9yIHNldmVyYWwgc3BhY2Utc2VwYXJhdGVkIGNsYXNzIG5hbWVzLA0KCQkJLy8JCW9yIGFuIGFycmF5IG9mIGNsYXNzIG5hbWVzLg0KCQkJcmV0dXJuOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKGNsYXNzTmFtZSl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXJlbW92ZXMgdGhlIHNwZWNpZmllZCBjbGFzcyBmcm9tIGV2ZXJ5IG5vZGUgaW4gdGhlIGxpc3QNCgkJCS8vCWNsYXNzTmFtZTogU3RyaW5nfEFycmF5Pw0KCQkJLy8JCUFuIG9wdGlvbmFsIFN0cmluZyBjbGFzcyBuYW1lIHRvIHJlbW92ZSwgb3Igc2V2ZXJhbCBzcGFjZS1zZXBhcmF0ZWQNCgkJCS8vCQljbGFzcyBuYW1lcywgb3IgYW4gYXJyYXkgb2YgY2xhc3MgbmFtZXMuIElmIG9taXR0ZWQsIGFsbCBjbGFzcyBuYW1lcw0KCQkJLy8JCXdpbGwgYmUgZGVsZXRlZC4NCgkJCS8vCXJldHVybnM6DQoJCQkvLwkJZG9qby5Ob2RlTGlzdCwgdGhpcyBsaXN0DQoJCQlyZXR1cm47IC8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQl0b2dnbGVDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lLCBjb25kaXRpb24pew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlBZGRzIGEgY2xhc3MgdG8gbm9kZSBpZiBub3QgcHJlc2VudCwgb3IgcmVtb3ZlcyBpZiBwcmVzZW50Lg0KCQkJLy8JCVBhc3MgYSBib29sZWFuIGNvbmRpdGlvbiBpZiB5b3Ugd2FudCB0byBleHBsaWNpdGx5IGFkZCBvciByZW1vdmUuDQoJCQkvLwljb25kaXRpb246IEJvb2xlYW4/DQoJCQkvLwkJSWYgcGFzc2VkLCB0cnVlIG1lYW5zIHRvIGFkZCB0aGUgY2xhc3MsIGZhbHNlIG1lYW5zIHRvIHJlbW92ZS4NCgkJCS8vCWNsYXNzTmFtZTogU3RyaW5nDQoJCQkvLwkJdGhlIENTUyBjbGFzcyB0byBhZGQNCgkJCXJldHVybjsgLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCWNvbm5lY3Q6IGZ1bmN0aW9uKG1ldGhvZE5hbWUsIG9iak9yRnVuYywgZnVuY05hbWUpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlhdHRhY2ggZXZlbnQgaGFuZGxlcnMgdG8gZXZlcnkgaXRlbSBvZiB0aGUgTm9kZUxpc3QuIFVzZXMgZG9qby5jb25uZWN0KCkNCgkJCS8vCQlzbyBldmVudCBwcm9wZXJ0aWVzIGFyZSBub3JtYWxpemVkDQoJCQkvLwltZXRob2ROYW1lOiBTdHJpbmcNCgkJCS8vCQl0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIHRvIGF0dGFjaCB0by4gRm9yIERPTSBldmVudHMsIHRoaXMgc2hvdWxkIGJlDQoJCQkvLwkJdGhlIGxvd2VyLWNhc2UgbmFtZSBvZiB0aGUgZXZlbnQNCgkJCS8vCW9iak9yRnVuYzogT2JqZWN0fEZ1bmN0aW9ufFN0cmluZw0KCQkJLy8JCWlmIDIgYXJndW1lbnRzIGFyZSBwYXNzZWQgKG1ldGhvZE5hbWUsIG9iak9yRnVuYyksIG9iak9yRnVuYyBzaG91bGQNCgkJCS8vCQlyZWZlcmVuY2UgYSBmdW5jdGlvbiBvciBiZSB0aGUgbmFtZSBvZiB0aGUgZnVuY3Rpb24gaW4gdGhlIGdsb2JhbA0KCQkJLy8JCW5hbWVzcGFjZSB0byBhdHRhY2guIElmIDMgYXJndW1lbnRzIGFyZSBwcm92aWRlZA0KCQkJLy8JCShtZXRob2ROYW1lLCBvYmpPckZ1bmMsIGZ1bmNOYW1lKSwgb2JqT3JGdW5jIG11c3QgYmUgdGhlIHNjb3BlIHRvIA0KCQkJLy8JCWxvY2F0ZSB0aGUgYm91bmQgZnVuY3Rpb24gaW4NCgkJCS8vCWZ1bmNOYW1lOiBTdHJpbmc/DQoJCQkvLwkJb3B0aW9uYWwuIEEgc3RyaW5nIG5hbWluZyB0aGUgZnVuY3Rpb24gaW4gb2JqT3JGdW5jIHRvIGJpbmQgdG8gdGhlDQoJCQkvLwkJZXZlbnQuIE1heSBhbHNvIGJlIGEgZnVuY3Rpb24gcmVmZXJlbmNlLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhZGQgYW4gb25jbGljayBoYW5kbGVyIHRvIGV2ZXJ5IGJ1dHRvbiBvbiB0aGUgcGFnZQ0KCQkJLy8JCXwJZG9qby5xdWVyeSgiZGl2Om50aC1jaGlsZChvZGQpIikuY29ubmVjdCgib25jbGljayIsIGZ1bmN0aW9uKGUpew0KCQkJLy8JCXwJCWNvbnNvbGUubG9nKCJjbGlja2VkISIpOw0KCQkJLy8JCXwJfSk7DQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JCWF0dGFjaCBmb28uYmFyKCkgdG8gZXZlcnkgb2RkIGRpdidzIG9ubW91c2VvdmVyDQoJCQkvLwkJfAlkb2pvLnF1ZXJ5KCJkaXY6bnRoLWNoaWxkKG9kZCkiKS5jb25uZWN0KCJvbm1vdXNlb3ZlciIsIGZvbywgImJhciIpOw0KCQl9LA0KDQoJCWVtcHR5OiBmdW5jdGlvbigpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQljbGVhcnMgYWxsIGNvbnRlbnQgZnJvbSBlYWNoIG5vZGUgaW4gdGhlIGxpc3QuIEVmZmVjdGl2ZWx5DQoJCQkvLwkJZXF1aXZhbGVudCB0byByZW1vdmluZyBhbGwgY2hpbGQgbm9kZXMgZnJvbSBldmVyeSBpdGVtIGluDQoJCQkvLwkJdGhlIGxpc3QuDQoJCQlyZXR1cm4gdGhpcy5mb3JFYWNoKCJpdGVtLmlubmVySFRNTD0nJzsiKTsgLy8gZG9qby5Ob2RlTGlzdA0KCQkJLy8gRklYTUU6IHNob3VsZCB3ZSBiZSBjaGVja2luZyBmb3IgYW5kL29yIGRpc3Bvc2luZyBvZiB3aWRnZXRzIGJlbG93IHRoZXNlIG5vZGVzPw0KCQl9LA0KCQk9PT09PSovDQoNCgkJLy8gdXNlZnVsIGh0bWwgbWV0aG9kcw0KCQljb29yZHM6CWFkYXB0QXNNYXAoZC5jb29yZHMpLA0KCQlwb3NpdGlvbjogYWRhcHRBc01hcChkLnBvc2l0aW9uKSwNCg0KCQkvLyBGSVhNRTogY29ubmVjdFB1Ymxpc2hlcigpPyBjb25uZWN0UnVuT25jZSgpPw0KDQoJCS8qDQoJCWRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWRlc3Ryb3lzIGV2ZXJ5IGl0ZW0gaW4gCXRoZSBsaXN0Lg0KCQkJdGhpcy5mb3JFYWNoKGQuZGVzdHJveSk7DQoJCQkvLyBGSVhNRTogc2hvdWxkIHdlIGJlIGNoZWNraW5nIGZvciBhbmQvb3IgZGlzcG9zaW5nIG9mIHdpZGdldHMgYmVsb3cgdGhlc2Ugbm9kZXM/DQoJCX0sDQoJCSovDQoNCgkJcGxhY2U6IGZ1bmN0aW9uKC8qU3RyaW5nfHxOb2RlKi8gcXVlcnlPck5vZGUsIC8qU3RyaW5nKi8gcG9zaXRpb24pew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlwbGFjZXMgZWxlbWVudHMgb2YgdGhpcyBub2RlIGxpc3QgcmVsYXRpdmUgdG8gdGhlIGZpcnN0IGVsZW1lbnQgbWF0Y2hlZA0KCQkJLy8JCWJ5IHF1ZXJ5T3JOb2RlLiBSZXR1cm5zIHRoZSBvcmlnaW5hbCBOb2RlTGlzdC4gU2VlOiBgZG9qby5wbGFjZWANCgkJCS8vCXF1ZXJ5T3JOb2RlOg0KCQkJLy8JCW1heSBiZSBhIHN0cmluZyByZXByZXNlbnRpbmcgYW55IHZhbGlkIENTUzMgc2VsZWN0b3Igb3IgYSBET00gbm9kZS4NCgkJCS8vCQlJbiB0aGUgc2VsZWN0b3IgY2FzZSwgb25seSB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCB3aWxsIGJlIHVzZWQgDQoJCQkvLwkJZm9yIHJlbGF0aXZlIHBvc2l0aW9uaW5nLg0KCQkJLy8JcG9zaXRpb246DQoJCQkvLwkJY2FuIGJlIG9uZSBvZjoNCgkJCS8vCQl8CSJsYXN0IiAoZGVmYXVsdCkNCgkJCS8vCQl8CSJmaXJzdCINCgkJCS8vCQl8CSJiZWZvcmUiDQoJCQkvLwkJfAkiYWZ0ZXIiDQoJCQkvLwkJfAkib25seSINCgkJCS8vCQl8CSJyZXBsYWNlIg0KCQkJLy8gCQlvciBhbiBvZmZzZXQgaW4gdGhlIGNoaWxkTm9kZXMgcHJvcGVydHkNCgkJCXZhciBpdGVtID0gZC5xdWVyeShxdWVyeU9yTm9kZSlbMF07DQoJCQlyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpeyBkLnBsYWNlKG5vZGUsIGl0ZW0sIHBvc2l0aW9uKTsgfSk7IC8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlvcnBoYW46IGZ1bmN0aW9uKC8qU3RyaW5nPyovIHNpbXBsZUZpbHRlcil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXJlbW92ZXMgZWxlbWVudHMgaW4gdGhpcyBsaXN0IHRoYXQgbWF0Y2ggdGhlIHNpbXBsZSBmaWx0ZXINCgkJCS8vCQlmcm9tIHRoZWlyIHBhcmVudHMgYW5kIHJldHVybnMgdGhlbSBhcyBhIG5ldyBOb2RlTGlzdC4NCgkJCS8vCXNpbXBsZUZpbHRlcjoNCgkJCS8vCQlzaW5nbGUtZXhwcmVzc2lvbiBDU1MgcnVsZS4gRm9yIGV4YW1wbGUsICIudGhpbmdlciIgb3INCgkJCS8vCQkiI3NvbWVJZFthdHRyTmFtZT0ndmFsdWUnXSIgYnV0IG5vdCAiZGl2ID4gc3BhbiIuIEluIHNob3J0LA0KCQkJLy8JCWFueXRoaW5nIHdoaWNoIGRvZXMgbm90IGludm9rZSBhIGRlc2NlbnQgdG8gZXZhbHVhdGUgYnV0DQoJCQkvLwkJY2FuIGluc3RlYWQgYmUgdXNlZCB0byB0ZXN0IGEgc2luZ2xlIG5vZGUgaXMgYWNjZXB0YWJsZS4NCgkJCS8vCXJldHVybnM6DQoJCQkvLwkJYGRvam8uTm9kZUxpc3RgIGNvbnRhaW5pbmcgdGhlIG9ycGFobmVkIGVsZW1lbnRzIA0KCQkJcmV0dXJuIChzaW1wbGVGaWx0ZXIgPyBkLl9maWx0ZXJRdWVyeVJlc3VsdCh0aGlzLCBzaW1wbGVGaWx0ZXIpIDogdGhpcykuZm9yRWFjaChvcnBoYW4pOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJYWRvcHQ6IGZ1bmN0aW9uKC8qU3RyaW5nfHxBcnJheXx8RG9tTm9kZSovIHF1ZXJ5T3JMaXN0T3JOb2RlLCAvKlN0cmluZz8qLyBwb3NpdGlvbil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXBsYWNlcyBhbnkvYWxsIGVsZW1lbnRzIGluIHF1ZXJ5T3JMaXN0T3JOb2RlIGF0IGENCgkJCS8vCQlwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGlzIGxpc3QuDQoJCQkvLwkJUmV0dXJucyBhIGRvam8uTm9kZUxpc3Qgb2YgdGhlIGFkb3B0ZWQgZWxlbWVudHMuDQoJCQkvLwlxdWVyeU9yTGlzdE9yTm9kZToNCgkJCS8vCQlhIERPTSBub2RlIG9yIGEgcXVlcnkgc3RyaW5nIG9yIGEgcXVlcnkgcmVzdWx0Lg0KCQkJLy8JCVJlcHJlc2VudHMgdGhlIG5vZGVzIHRvIGJlIGFkb3B0ZWQgcmVsYXRpdmUgdG8gdGhlDQoJCQkvLwkJZmlyc3QgZWxlbWVudCBvZiB0aGlzIE5vZGVMaXN0Lg0KCQkJLy8JcG9zaXRpb246DQoJCQkvLwkJY2FuIGJlIG9uZSBvZjoNCgkJCS8vCQl8CSJsYXN0IiAoZGVmYXVsdCkNCgkJCS8vCQl8CSJmaXJzdCINCgkJCS8vCQl8CSJiZWZvcmUiDQoJCQkvLwkJfAkiYWZ0ZXIiDQoJCQkvLwkJfAkib25seSINCgkJCS8vCQl8CSJyZXBsYWNlIg0KCQkJLy8gCQlvciBhbiBvZmZzZXQgaW4gdGhlIGNoaWxkTm9kZXMgcHJvcGVydHkNCgkJCXJldHVybiBkLnF1ZXJ5KHF1ZXJ5T3JMaXN0T3JOb2RlKS5wbGFjZSh0aGlzWzBdLCBwb3NpdGlvbikuX3N0YXNoKHRoaXMpOwkvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJLy8gRklYTUU6IGRvIHdlIG5lZWQgdGhpcz8NCgkJcXVlcnk6IGZ1bmN0aW9uKC8qU3RyaW5nKi8gcXVlcnlTdHIpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgbmV3IGxpc3Qgd2hvc2UgbWVtZWJlcnMgbWF0Y2ggdGhlIHBhc3NlZCBxdWVyeSwNCgkJCS8vCQlhc3N1bWluZyBlbGVtZW50cyBvZiB0aGUgY3VycmVudCBOb2RlTGlzdCBhcyB0aGUgcm9vdCBmb3INCgkJCS8vCQllYWNoIHNlYXJjaC4NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJYXNzdW1lIGEgRE9NIGNyZWF0ZWQgYnkgdGhpcyBtYXJrdXA6DQoJCQkvLwl8CTxkaXYgaWQ9ImZvbyI+DQoJCQkvLwl8CQk8cD4NCgkJCS8vCXwJCQliYWNvbiBpcyB0YXN0eSwgPHNwYW4+ZG9udGNoYSB0aGluaz88L3NwYW4+DQoJCQkvLwl8CQk8L3A+DQoJCQkvLwl8CTwvZGl2Pg0KCQkJLy8JfAk8ZGl2IGlkPSJiYXIiPg0KCQkJLy8JfAkJPHA+Z3JlYXQgY29tbWVkaWFucyBtYXkgbm90IGJlIGZ1bm55IDxzcGFuPmluIHBlcnNvbjwvc3Bhbj48L3A+DQoJCQkvLwl8CTwvZGl2Pg0KCQkJLy8JCUlmIHdlIGFyZSBwcmVzZW50ZWQgd2l0aCB0aGUgZm9sbG93aW5nIGRlZmludGlvbiBmb3IgYSBOb2RlTGlzdDoNCgkJCS8vCXwJdmFyIGwgPSBuZXcgZG9qby5Ob2RlTGlzdChkb2pvLmJ5SWQoImZvbyIpLCBkb2pvLmJ5SWQoImJhciIpKTsNCgkJCS8vCQlpdCdzIHBvc3NpYmxlIHRvIGZpbmQgYWxsIHNwYW4gZWxlbWVudHMgdW5kZXIgcGFyYWdyYXBocw0KCQkJLy8JCWNvbnRhaW5lZCBieSB0aGVzZSBlbGVtZW50cyB3aXRoIHRoaXMgc3ViLXF1ZXJ5Og0KCQkJLy8JfCAJdmFyIHNwYW5zID0gbC5xdWVyeSgicCBzcGFuIik7DQoNCgkJCS8vIEZJWE1FOiBwcm9iYWJseSBzbG93DQoJCQlpZighcXVlcnlTdHIpeyByZXR1cm4gdGhpczsgfQ0KCQkJdmFyIHJldCA9IHRoaXMubWFwKGZ1bmN0aW9uKG5vZGUpew0KCQkJCS8vIEZJWE1FOiB3aHkgd291bGQgd2UgZXZlciBnZXQgdW5kZWZpbmVkIGhlcmU/DQoJCQkJcmV0dXJuIGQucXVlcnkocXVlcnlTdHIsIG5vZGUpLmZpbHRlcihmdW5jdGlvbihzdWJOb2RlKXsgcmV0dXJuIHN1Yk5vZGUgIT09IHVuZGVmaW5lZDsgfSk7DQoJCQl9KTsNCgkJCXJldHVybiB0aGlzLl93cmFwKGFwYy5hcHBseShbXSwgcmV0KSwgdGhpcyk7CS8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlmaWx0ZXI6IGZ1bmN0aW9uKC8qU3RyaW5nfEZ1bmN0aW9uKi8gc2ltcGxlRmlsdGVyKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLyAJCSJtYXNrcyIgdGhlIGJ1aWx0LWluIGphdmFzY3JpcHQgZmlsdGVyKCkgbWV0aG9kIChzdXBwb3J0ZWQNCgkJCS8vIAkJaW4gRG9qbyB2aWEgYGRvam8uZmlsdGVyYCkgdG8gc3VwcG9ydCBwYXNzaW5nIGEgc2ltcGxlDQoJCQkvLyAJCXN0cmluZyBmaWx0ZXIgaW4gYWRkaXRpb24gdG8gc3VwcG9ydGluZyBmaWx0ZXJpbmcgZnVuY3Rpb24NCgkJCS8vIAkJb2JqZWN0cy4NCgkJCS8vCXNpbXBsZUZpbHRlcjoNCgkJCS8vCQlJZiBhIHN0cmluZywgYSBzaW5nbGUtZXhwcmVzc2lvbiBDU1MgcnVsZS4gRm9yIGV4YW1wbGUsDQoJCQkvLwkJIi50aGluZ2VyIiBvciAiI3NvbWVJZFthdHRyTmFtZT0ndmFsdWUnXSIgYnV0IG5vdCAiZGl2ID4NCgkJCS8vCQlzcGFuIi4gSW4gc2hvcnQsIGFueXRoaW5nIHdoaWNoIGRvZXMgbm90IGludm9rZSBhIGRlc2NlbnQNCgkJCS8vCQl0byBldmFsdWF0ZSBidXQgY2FuIGluc3RlYWQgYmUgdXNlZCB0byB0ZXN0IGEgc2luZ2xlIG5vZGUNCgkJCS8vCQlpcyBhY2NlcHRhYmxlLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQkicmVndWxhciIgSlMgZmlsdGVyIHN5bnRheCBhcyBleHBvc2VkIGluIGRvam8uZmlsdGVyOg0KCQkJLy8JCXwJZG9qby5xdWVyeSgiKiIpLmZpbHRlcihmdW5jdGlvbihpdGVtKXsNCgkJCS8vCQl8CQkvLyBoaWdobGlnaHQgZXZlcnkgcGFyYWdyYXBoDQoJCQkvLwkJfAkJcmV0dXJuIChpdGVtLm5vZGVOYW1lID09ICJwIik7DQoJCQkvLwkJfAl9KS5zdHlsZSgiYmFja2dyb3VuZENvbG9yIiwgInllbGxvdyIpOw0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCQl0aGUgc2FtZSBmaWx0ZXJpbmcgdXNpbmcgYSBDU1Mgc2VsZWN0b3INCgkJCS8vCQl8CWRvam8ucXVlcnkoIioiKS5maWx0ZXIoInAiKS5zdHlsZXMoImJhY2tncm91bmRDb2xvciIsICJ5ZWxsb3ciKTsNCg0KCQkJdmFyIGEgPSBhcmd1bWVudHMsIGl0ZW1zID0gdGhpcywgc3RhcnQgPSAwOw0KCQkJaWYodHlwZW9mIHNpbXBsZUZpbHRlciA9PSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCQlpdGVtcyA9IGQuX2ZpbHRlclF1ZXJ5UmVzdWx0KHRoaXMsIGFbMF0pOw0KCQkJCWlmKGEubGVuZ3RoID09IDEpew0KCQkJCQkvLyBpZiB3ZSBvbmx5IGdvdCBhIHN0cmluZyBxdWVyeSwgcGFzcyBiYWNrIHRoZSBmaWx0ZXJlZCByZXN1bHRzDQoJCQkJCXJldHVybiBpdGVtcy5fc3Rhc2godGhpcyk7IC8vIGRvam8uTm9kZUxpc3QNCgkJCQl9DQoJCQkJLy8gaWYgd2UgZ290IGEgY2FsbGJhY2ssIHJ1biBpdCBvdmVyIHRoZSBmaWx0ZXJlZCBpdGVtcw0KCQkJCXN0YXJ0ID0gMTsNCgkJCX0NCgkJCXJldHVybiB0aGlzLl93cmFwKGQuZmlsdGVyKGl0ZW1zLCBhW3N0YXJ0XSwgYVtzdGFydCArIDFdKSwgdGhpcyk7CS8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQkvKg0KCQkvLyBGSVhNRTogc2hvdWxkIHRoaXMgYmUgImNvcHlUbyIgYW5kIGluY2x1ZGUgcGFyZW50aW5nIGluZm8/DQoJCWNsb25lOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQljcmVhdGVzIG5vZGUgY2xvbmVzIG9mIGVhY2ggZWxlbWVudCBvZiB0aGlzIGxpc3QNCgkJCS8vCQlhbmQgcmV0dXJucyBhIG5ldyBsaXN0IGNvbnRhaW5pbmcgdGhlIGNsb25lcw0KCQl9LA0KCQkqLw0KDQoJCWFkZENvbnRlbnQ6IGZ1bmN0aW9uKC8qU3RyaW5nfHxEb21Ob2RlfHxPYmplY3R8fGRvam8uTm9kZUxpc3QqLyBjb250ZW50LCAvKlN0cmluZ3x8SW50ZWdlcj8qLyBwb3NpdGlvbil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWFkZCBhIG5vZGUsIE5vZGVMaXN0IG9yIHNvbWUgSFRNTCBhcyBhIHN0cmluZyB0byBldmVyeSBpdGVtIGluIHRoZQ0KCQkJLy8JCWxpc3QuICBSZXR1cm5zIHRoZSBvcmlnaW5hbCBsaXN0Lg0KCQkJLy8JZGVzY3JpcHRpb246DQoJCQkvLwkJYSBjb3B5IG9mIHRoZSBIVE1MIGNvbnRlbnQgaXMgYWRkZWQgdG8gZWFjaCBpdGVtIGluIHRoZQ0KCQkJLy8JCWxpc3QsIHdpdGggYW4gb3B0aW9uYWwgcG9zaXRpb24gYXJndW1lbnQuIElmIG5vIHBvc2l0aW9uDQoJCQkvLwkJYXJndW1lbnQgaXMgcHJvdmlkZWQsIHRoZSBjb250ZW50IGlzIGFwcGVuZGVkIHRvIHRoZSBlbmQgb2YNCgkJCS8vCQllYWNoIGl0ZW0uDQoJCQkvLwljb250ZW50Og0KCQkJLy8JCURPTSBub2RlLCBIVE1MIGluIHN0cmluZyBmb3JtYXQsIGEgTm9kZUxpc3Qgb3IgYW4gT2JqZWN0LiBJZiBhIERPTSBub2RlIG9yDQoJCQkvLyAJCU5vZGVMaXN0LCB0aGUgY29udGVudCB3aWxsIGJlIGNsb25lZCBpZiB0aGUgY3VycmVudCBOb2RlTGlzdCBoYXMgbW9yZSB0aGFuIG9uZQ0KCQkJLy8gCQllbGVtZW50LiBPbmx5IHRoZSBET00gbm9kZXMgYXJlIGNsb25lZCwgbm8gZXZlbnQgaGFuZGxlcnMuIElmIGl0IGlzIGFuIE9iamVjdCwNCgkJCS8vIAkJaXQgc2hvdWxkIGJlIGFuIG9iamVjdCB3aXRoIGF0ICJ0ZW1wbGF0ZSIgU3RyaW5nIHByb3BlcnR5IHRoYXQgaGFzIHRoZSBIVE1MIHN0cmluZw0KCQkJLy8gCQl0byBpbnNlcnQuIElmIGRvam8uc3RyaW5nIGhhcyBhbHJlYWR5IGJlZW4gZG9qby5yZXF1aXJlZCwgdGhlbiBkb2pvLnN0cmluZy5zdWJzdGl0dXRlDQoJCQkvLyAJCXdpbGwgYmUgdXNlZCBvbiB0aGUgInRlbXBsYXRlIiB0byBnZW5lcmF0ZSB0aGUgZmluYWwgSFRNTCBzdHJpbmcuIE90aGVyIGFsbG93ZWQNCgkJCS8vIAkJcHJvcGVydGllcyBvbiB0aGUgb2JqZWN0IGFyZTogInBhcnNlIiBpZiB0aGUgSFRNTA0KCQkJLy8gCQlzdHJpbmcgc2hvdWxkIGJlIHBhcnNlZCBmb3Igd2lkZ2V0cyAoZG9qby5yZXF1aXJlKCJkb2pvLnBhcnNlciIpIHRvIGdldCB0aGF0DQoJCQkvLyAJCW9wdGlvbiB0byB3b3JrKSwgYW5kICJ0ZW1wbGF0ZUZ1bmMiIGlmIGEgdGVtcGxhdGUgZnVuY3Rpb24gYmVzaWRlcyBkb2pvLnN0cmluZy5zdWJzdGl0dXRlDQoJCQkvLyAJCXNob3VsZCBiZSB1c2VkIHRvIHRyYW5zZm9ybSB0aGUgInRlbXBsYXRlIi4NCgkJCS8vCXBvc2l0aW9uOg0KCQkJLy8JCWNhbiBiZSBvbmUgb2Y6DQoJCQkvLwkJfAkibGFzdCJ8fCJlbmQiIChkZWZhdWx0KQ0KCQkJLy8JCXwJImZpcnN0fHwic3RhcnQiDQoJCQkvLwkJfAkiYmVmb3JlIg0KCQkJLy8JCXwJImFmdGVyIg0KCQkJLy8JCXwJInJlcGxhY2UiIChyZXBsYWNlcyBub2RlcyBpbiB0aGlzIE5vZGVMaXN0IHdpdGggbmV3IGNvbnRlbnQpDQoJCQkvLwkJfAkib25seSIgKHJlbW92ZXMgb3RoZXIgY2hpbGRyZW4gb2YgdGhlIG5vZGVzIHNvIG5ldyBjb250ZW50IGlzIGh0ZSBvbmx5IGNoaWxkKQ0KCQkJLy8gCQlvciBhbiBvZmZzZXQgaW4gdGhlIGNoaWxkTm9kZXMgcHJvcGVydHkNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJYXBwZW5kcyBjb250ZW50IHRvIHRoZSBlbmQgaWYgdGhlIHBvc2l0aW9uIGlzIG9tbWl0dGVkDQoJCQkvLwl8CWRvam8ucXVlcnkoImgzID4gcCIpLmFkZENvbnRlbnQoImhleSB0aGVyZSEiKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJYWRkIHNvbWV0aGluZyB0byB0aGUgZnJvbnQgb2YgZWFjaCBlbGVtZW50IHRoYXQgaGFzIGENCgkJCS8vCQkidGhpbmdlciIgcHJvcGVydHk6DQoJCQkvLwl8CWRvam8ucXVlcnkoIlt0aGluZ2VyXSIpLmFkZENvbnRlbnQoIi4uLiIsICJmaXJzdCIpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhZGRzIGEgaGVhZGVyIGJlZm9yZSBlYWNoIGVsZW1lbnQgb2YgdGhlIGxpc3QNCgkJCS8vCXwJZG9qby5xdWVyeSgiLm5vdGUiKS5hZGRDb250ZW50KCI8aDQ+Tk9URTo8L2g0PiIsICJiZWZvcmUiKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJYWRkIGEgY2xvbmUgb2YgYSBET00gbm9kZSB0byB0aGUgZW5kIG9mIGV2ZXJ5IGVsZW1lbnQgaW4NCgkJCS8vCQl0aGUgbGlzdCwgcmVtb3ZpbmcgaXQgZnJvbSBpdHMgZXhpc3RpbmcgcGFyZW50Lg0KCQkJLy8JfAlkb2pvLnF1ZXJ5KCIubm90ZSIpLmFkZENvbnRlbnQoZG9qby5ieUlkKCJmb28iKSk7DQoJCQkvLyAgZXhhbXBsZToNCgkJCS8vICAJQXBwZW5kIG5vZGVzIGZyb20gYSB0ZW1wbGF0aXplZCBzdHJpbmcuDQoJCQkvLyAJCWRvam8ucmVxdWlyZSgiZG9qby5zdHJpbmciKTsNCgkJCS8vIAkJZG9qby5xdWVyeSgiLm5vdGUiKS5hZGRDb250ZW50KHsNCgkJCS8vICAJCXRlbXBsYXRlOiAnPGI+JHtpZH06IDwvYj48c3Bhbj4ke25hbWV9PC9zcGFuPicsDQoJCQkvLyAJCQlpZDogInVzZXIzMzIiLA0KCQkJLy8gIAkJbmFtZTogIk1yLiBBbmRlcnNvbiINCgkJCS8vICAJfSk7DQoJCQkvLyAgZXhhbXBsZToNCgkJCS8vICAJQXBwZW5kIG5vZGVzIGZyb20gYSB0ZW1wbGF0aXplZCBzdHJpbmcgdGhhdCBhbHNvIGhhcyB3aWRnZXRzIHBhcnNlZC4NCgkJCS8vICAJZG9qby5yZXF1aXJlKCJkb2pvLnN0cmluZyIpOw0KCQkJLy8gIAlkb2pvLnJlcXVpcmUoImRvam8ucGFyc2VyIik7DQoJCQkvLyAgCXZhciBub3RlcyA9IGRvam8ucXVlcnkoIi5ub3RlIikuYWRkQ29udGVudCh7DQoJCQkvLyAgCQl0ZW1wbGF0ZTogJzxidXR0b24gZG9qb1R5cGU9ImRpaml0LmZvcm0uQnV0dG9uIj4ke3RleHR9PC9idXR0b24+JywNCgkJCS8vICAJCXBhcnNlOiB0cnVlLA0KCQkJLy8gIAkJdGV4dDogIlNlbmQiDQoJCQkvLyAgCX0pOw0KCQkJY29udGVudCA9IHRoaXMuX25vcm1hbGl6ZShjb250ZW50LCB0aGlzWzBdKTsNCgkJCWZvcih2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSB0aGlzW2ldOyBpKyspew0KCQkJCXRoaXMuX3BsYWNlKGNvbnRlbnQsIG5vZGUsIHBvc2l0aW9uLCBpID4gMCk7DQoJCQl9DQoJCQlyZXR1cm4gdGhpczsgLy9kb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJaW5zdGFudGlhdGU6IGZ1bmN0aW9uKC8qU3RyaW5nfE9iamVjdCovIGRlY2xhcmVkQ2xhc3MsIC8qT2JqZWN0PyovIHByb3BlcnRpZXMpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgYSBzcGVjaWZpZWQgY2xhc3MsIHVzaW5nIHRoZQ0KCQkJLy8JCXNwZWNpZmllZCBwcm9wZXJ0aWVzIGFuZCBlYWNoIG5vZGUgaW4gdGhlIG5vZGVMaXN0IGFzIGENCgkJCS8vCQlzcmNOb2RlUmVmLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlHcmFicyBhbGwgYnV0dG9ucyBpbiB0aGUgcGFnZSBhbmQgY29udmVydHMgdGhlbSB0byBkaWppLmZvcm0uQnV0dG9ucy4NCgkJCS8vCXwJdmFyIGJ1dHRvbnMgPSBkb2pvLnF1ZXJ5KCJidXR0b24iKS5pbnN0YW50aWF0ZSgiZGlqaXQuZm9ybS5CdXR0b24iLCB7c2hvd0xhYmVsOiB0cnVlfSk7DQoJCQl2YXIgYyA9IGQuaXNGdW5jdGlvbihkZWNsYXJlZENsYXNzKSA/IGRlY2xhcmVkQ2xhc3MgOiBkLmdldE9iamVjdChkZWNsYXJlZENsYXNzKTsNCgkJCXByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9Ow0KCQkJcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXsNCgkJCQluZXcgYyhwcm9wZXJ0aWVzLCBub2RlKTsNCgkJCX0pOwkvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJYXQ6IGZ1bmN0aW9uKC8qPT09PT0gaW5kZXggPT09PT0qLyl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBuZXcgTm9kZUxpc3QgY29tcHJpc2VkIG9mIGl0ZW1zIGluIHRoaXMgTm9kZUxpc3QNCgkJCS8vCQlhdCB0aGUgZ2l2ZW4gaW5kZXggb3IgaW5kaWNlcy4NCgkJCS8vDQoJCQkvLwlpbmRleDogSW50ZWdlci4uLg0KCQkJLy8JCU9uZSBvciBtb3JlIDAtYmFzZWQgaW5kaWNlcyBvZiBpdGVtcyBpbiB0aGUgY3VycmVudA0KCQkJLy8JCU5vZGVMaXN0LiBBIG5lZ2F0aXZlIGluZGV4IHdpbGwgc3RhcnQgYXQgdGhlIGVuZCBvZiB0aGUNCgkJCS8vCQlsaXN0IGFuZCBnbyBiYWNrd2FyZHMuIA0KCQkJLy8NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwlTaG9ydGVuIHRoZSBsaXN0IHRvIHRoZSBmaXJzdCwgc2Vjb25kLCBhbmQgdGhpcmQgZWxlbWVudHMNCgkJCS8vCXwJZG9qby5xdWVyeSgiYSIpLmF0KDAsIDEsIDIpLmZvckVhY2goZm4pOyANCgkJCS8vDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JUmV0cmlldmUgdGhlIGZpcnN0IGFuZCBsYXN0IGVsZW1lbnRzIG9mIGEgdW5vcmRlcmVkIGxpc3Q6DQoJCQkvLwl8CWRvam8ucXVlcnkoInVsID4gbGkiKS5hdCgwLCAtMSkuZm9yRWFjaChjYik7DQoJCQkvLw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCURvIHNvbWV0aGluZyBmb3IgdGhlIGZpcnN0IGVsZW1lbnQgb25seSwgYnV0IGVuZCgpIG91dCBiYWNrIHRvDQoJCQkvLwl0aGUgb3JpZ2luYWwgbGlzdCBhbmQgY29udGludWUgY2hhaW5pbmc6DQoJCQkvLwl8CWRvam8ucXVlcnkoImEiKS5hdCgwKS5vbmNsaWNrKGZuKS5lbmQoKS5mb3JFYWNoKGZ1bmN0aW9uKG4pew0KCQkJLy8JfAkJY29uc29sZS5sb2cobik7IC8vIGFsbCBhbmNob3JzIG9uIHRoZSBwYWdlLiANCgkJCS8vCXwJfSkJDQoJCQkvLw0KCQkJLy8JcmV0dXJuczoNCgkJCS8vCQlkb2pvLk5vZGVMaXN0DQoJCQl2YXIgdCA9IG5ldyB0aGlzLl9Ob2RlTGlzdEN0b3IoKTsNCgkJCWQuZm9yRWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKGkpeyANCgkJCQlpZihpIDwgMCl7IGkgPSB0aGlzLmxlbmd0aCArIGkgfQ0KCQkJCWlmKHRoaXNbaV0peyB0LnB1c2godGhpc1tpXSk7IH0NCgkJCX0sIHRoaXMpOw0KCQkJcmV0dXJuIHQuX3N0YXNoKHRoaXMpOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0NCg0KCX0pOw0KDQoJbmwuZXZlbnRzID0gWw0KCQkvLyBzdW1tYXJ5OiBsaXN0IG9mIGFsbCBET00gZXZlbnRzIHVzZWQgaW4gTm9kZUxpc3QNCgkJImJsdXIiLCAiZm9jdXMiLCAiY2hhbmdlIiwgImNsaWNrIiwgImVycm9yIiwgImtleWRvd24iLCAia2V5cHJlc3MiLA0KCQkia2V5dXAiLCAibG9hZCIsICJtb3VzZWRvd24iLCAibW91c2VlbnRlciIsICJtb3VzZWxlYXZlIiwgIm1vdXNlbW92ZSIsDQoJCSJtb3VzZW91dCIsICJtb3VzZW92ZXIiLCAibW91c2V1cCIsICJzdWJtaXQiDQoJXTsNCgkNCgkvLyBGSVhNRTogcHNldWRvLWRvYyB0aGUgYWJvdmUgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgb24tZXZlbnQgZnVuY3Rpb25zDQoNCgkvLyBzeW50YWN0aWMgc3VnYXIgZm9yIERPTSBldmVudHMNCglkLmZvckVhY2gobmwuZXZlbnRzLCBmdW5jdGlvbihldnQpew0KCQkJdmFyIF9vZSA9ICJvbiIgKyBldnQ7DQoJCQlubHBbX29lXSA9IGZ1bmN0aW9uKGEsIGIpew0KCQkJCXJldHVybiB0aGlzLmNvbm5lY3QoX29lLCBhLCBiKTsNCgkJCX0NCgkJCQkvLyBGSVhNRTogc2hvdWxkIHRoZXNlIGV2ZW50cyB0cmlnZ2VyIHB1Ymxpc2hlcz8NCgkJCQkvKg0KCQkJCXJldHVybiAoYSA/IHRoaXMuY29ubmVjdChfb2UsIGEsIGIpIDoNCgkJCQkJCQl0aGlzLmZvckVhY2goZnVuY3Rpb24obil7DQoJCQkJCQkJCS8vIEZJWE1FOg0KCQkJCQkJCQkvLwkJbGlzdGVuZXJzIGdldCBidXJpZWQgYnkNCgkJCQkJCQkJLy8JCWFkZEV2ZW50TGlzdGVuZXIgYW5kIGNhbid0IGJlIGR1ZyBiYWNrDQoJCQkJCQkJCS8vCQlvdXQgdG8gYmUgdHJpZ2dlcmVkIGV4dGVybmFsbHkuDQoJCQkJCQkJCS8vIHNlZToNCgkJCQkJCQkJLy8JCWh0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9ET006ZWxlbWVudA0KDQoJCQkJCQkJCWNvbnNvbGUubG9nKG4sIGV2dCwgX29lKTsNCg0KCQkJCQkJCQkvLyBGSVhNRTogbmVlZCBzeW50aGV0aWMgZXZlbnQgc3VwcG9ydCENCgkJCQkJCQkJdmFyIF9lID0geyB0YXJnZXQ6IG4sIGZhdXg6IHRydWUsIHR5cGU6IGV2dCB9Ow0KCQkJCQkJCQkvLyBkb2pvLl9ldmVudF9saXN0ZW5lci5fc3ludGhlc2l6ZUV2ZW50KHt9LCB7IHRhcmdldDogbiwgZmF1eDogdHJ1ZSwgdHlwZTogZXZ0IH0pOw0KCQkJCQkJCQl0cnl7IG5bZXZ0XShfZSk7IH1jYXRjaChlKXsgY29uc29sZS5sb2coZSk7IH0NCgkJCQkJCQkJdHJ5eyBuW19vZV0oX2UpOyB9Y2F0Y2goZSl7IGNvbnNvbGUubG9nKGUpOyB9DQoJCQkJCQkJfSkNCgkJCQkpOw0KCQkJCSovDQoJCX0NCgkpOw0KDQp9KSgpOw0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5xdWVyeSJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5xdWVyeSJdID0gdHJ1ZTsNCmlmKHR5cGVvZiBkb2pvICE9ICJ1bmRlZmluZWQiKXsNCglkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UucXVlcnkiKTsNCgkNCgkNCg0KfQ0KDQovKg0KCWRvam8ucXVlcnkoKSBhcmNoaXRlY3R1cmFsIG92ZXJ2aWV3Og0KDQoJCWRvam8ucXVlcnkgaXMgYSByZWxhdGl2ZWx5IGZ1bGwtZmVhdHVyZWQgQ1NTMyBxdWVyeSBsaWJyYXJ5LiBJdCBpcw0KCQlkZXNpZ25lZCB0byB0YWtlIGFueSB2YWxpZCBDU1MzIHNlbGVjdG9yIGFuZCByZXR1cm4gdGhlIG5vZGVzIG1hdGNoaW5nDQoJCXRoZSBzZWxlY3Rvci4gVG8gZG8gdGhpcyBxdWlja2x5LCBpdCBwcm9jZXNzZXMgcXVlcmllcyBpbiBzZXZlcmFsDQoJCXN0ZXBzLCBhcHBseWluZyBjYWNoaW5nIHdoZXJlIHByb2ZpdGFibGUuDQoJCQ0KCQlUaGUgc3RlcHMgKHJvdWdobHkgaW4gcmV2ZXJzZSBvcmRlciBvZiB0aGUgd2F5IHRoZXkgYXBwZWFyIGluIHRoZSBjb2RlKToNCgkJCTEuKSBjaGVjayB0byBzZWUgaWYgd2UgYWxyZWFkeSBoYXZlIGEgInF1ZXJ5IGRpc3BhdGNoZXIiDQoJCQkJLSBpZiBzbywgdXNlIHRoYXQgd2l0aCB0aGUgZ2l2ZW4gcGFyYW1ldGVyaXphdGlvbi4gU2tpcCB0byBzdGVwIDQuDQoJCQkyLikgYXR0ZW1wdCB0byBkZXRlcm1pbmUgd2hpY2ggYnJhbmNoIHRvIGRpc3BhdGNoIHRoZSBxdWVyeSB0bzoNCgkJCQktIEpTIChvcHRpbWl6ZWQgRE9NIGl0ZXJhdGlvbikNCgkJCQktIG5hdGl2ZSAoRkYzLjErLCBTYWZhcmkgMy4xKywgSUUgOCspDQoJCQkzLikgdG9rZW5pemUgYW5kIGNvbnZlcnQgdG8gZXhlY3V0YWJsZSAicXVlcnkgZGlzcGF0Y2hlciINCgkJCQktIHRoaXMgaXMgd2hlcmUgdGhlIGxpb24ncyBzaGFyZSBvZiB0aGUgY29tcGxleGl0eSBpbiB0aGUNCgkJCQkgIHN5c3RlbSBsaWVzLiBJbiB0aGUgRE9NIHZlcnNpb24sIHRoZSBxdWVyeSBkaXNwYXRjaGVyIGlzDQoJCQkJICBhc3NlbWJsZWQgYXMgYSBjaGFpbiBvZiAieWVzL25vIiB0ZXN0IGZ1bmN0aW9ucyBwZXJ0YWluaW5nIHRvDQoJCQkJICBhIHNlY3Rpb24gb2YgYSBzaW1wbGUgcXVlcnkgc3RhdGVtZW50ICgiLmJsYWg6bnRoLWNoaWxkKG9kZCkiDQoJCQkJICBidXQgbm90ICJkaXYgZGl2Iiwgd2hpY2ggaXMgMiBzaW1wbGUgc3RhdGVtZW50cykuIEluZGl2aWR1YWwNCgkJCQkgIHN0YXRlbWVudCBkaXNwYXRjaGVycyBhcmUgY2FjaGVkICh0byBwcmV2ZW50IHJlLWRlZmluaXRpb24pDQoJCQkJICBhcyBhcmUgZW50aXJlIGRpc3BhdGNoIGNoYWlucyAodG8gbWFrZSByZS1leGVjdXRpb24gb2YgdGhlDQoJCQkJICBzYW1lIHF1ZXJ5IGZhc3QpDQoJCQk0LikgdGhlIHJlc3VsdGluZyBxdWVyeSBkaXNwYXRjaGVyIGlzIGNhbGxlZCBpbiB0aGUgcGFzc2VkIHNjb3BlDQoJCQkgICAgKGJ5IGRlZmF1bHQgdGhlIHRvcC1sZXZlbCBkb2N1bWVudCkNCgkJCQktIGZvciBET00gcXVlcmllcywgdGhpcyByZXN1bHRzIGluIGEgcmVjdXJzaXZlLCB0b3AtZG93bg0KCQkJCSAgZXZhbHVhdGlvbiBvZiBub2RlcyBiYXNlZCBvbiBlYWNoIHNpbXBsZSBxdWVyeSBzZWN0aW9uDQoJCQkJLSBmb3IgbmF0aXZlIGltcGxlbWVudGF0aW9ucywgdGhpcyBtYXkgbWVhbiB3b3JraW5nIGFyb3VuZCBzcGVjDQoJCQkJICBidWdzLiBTbyBiZSBpdC4NCgkJCTUuKSBtYXRjaGVkIG5vZGVzIGFyZSBwcnVuZWQgdG8gZW5zdXJlIHRoZXkgYXJlIHVuaXF1ZSAoaWYgbmVjZXNzYXJ5KQ0KKi8NCg0KOyhmdW5jdGlvbihkKXsNCgkvLyBkZWZpbmUgZXZlcnl0aGluZyBpbiBhIGNsb3N1cmUgZm9yIGNvbXByZXNzYWJpbGl0eSByZWFzb25zLiAiZCIgaXMgYW4NCgkvLyBhbGlhcyB0byAiZG9qbyIgKG9yIHRoZSB0b29sa2l0IGFsaWFzIG9iamVjdCwgZS5nLiwgImFjbWUiKS4NCg0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KCS8vIFRvb2xraXQgYWxpYXNlcw0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQoJLy8gaWYgeW91IGFyZSBleHRyYWNpbmcgZG9qby5xdWVyeSBmb3IgdXNlIGluIHlvdXIgb3duIHN5c3RlbSwgeW91IHdpbGwNCgkvLyBuZWVkIHRvIHByb3ZpZGUgdGhlc2UgbWV0aG9kcyBhbmQgcHJvcGVydGllcy4gTm8gb3RoZXIgcG9ydGluZyBzaG91bGQgYmUNCgkvLyBuZWNlc3NhcnksIHNhdmUgZm9yIGNvbmZpZ3VyaW5nIHRoZSBzeXN0ZW0gdG8gdXNlIGEgY2xhc3Mgb3RoZXIgdGhhbg0KCS8vIGRvam8uTm9kZUxpc3QgYXMgdGhlIHJldHVybiBpbnN0YW5jZSBpbnN0YW50aWF0b3INCgl2YXIgdHJpbSA9IAkJCWQudHJpbTsNCgl2YXIgZWFjaCA9IAkJCWQuZm9yRWFjaDsNCgkvLyAJCQkJCWQuaXNJRTsgLy8gZmxvYXQNCgkvLyAJCQkJCWQuaXNTYWZhcmk7IC8vIGZsb2F0DQoJLy8gCQkJCQlkLmlzT3BlcmE7IC8vIGZsb2F0DQoJLy8gCQkJCQlkLmlzV2ViS2l0OyAvLyBmbG9hdA0KCS8vIAkJCQkJZC5kb2MgOyAvLyBkb2N1bWVudCBlbGVtZW50DQoJdmFyIHFsYyA9IGQuX05vZGVMaXN0Q3RvciA9IAkJZC5Ob2RlTGlzdDsNCg0KCXZhciBnZXREb2MgPSBmdW5jdGlvbigpeyByZXR1cm4gZC5kb2M7IH07DQoJLy8gTk9URShhbGV4KTogdGhlIHNwZWMgaXMgaWRpb3RpYy4gQ1NTIHF1ZXJpZXMgc2hvdWxkIEFMV0FZUyBiZSBjYXNlLXNlbnNpdGl2ZSwgYnV0IG5vb29vb29vDQoJdmFyIGNzc0Nhc2VCdWcgPSAoKGQuaXNXZWJLaXR8fGQuaXNNb3ppbGxhKSAmJiAoKGdldERvYygpLmNvbXBhdE1vZGUpID09ICJCYWNrQ29tcGF0IikpOw0KDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJLy8gR2xvYmFsIHV0aWxpdGllcw0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQoNCgkvLyBvbiBicm93c2VycyB0aGF0IHN1cHBvcnQgdGhlICJjaGlsZHJlbiIgY29sbGVjdGlvbiB3ZSBjYW4gYXZvaWQgYSBsb3Qgb2YNCgkvLyBpdGVyYXRpb24gb24gY2hhZmYgKG5vbi1lbGVtZW50KSBub2Rlcy4NCgkvLyB3aHkuDQoJdmFyIGNoaWxkTm9kZXNOYW1lID0gISFnZXREb2MoKS5maXJzdENoaWxkWyJjaGlsZHJlbiJdID8gImNoaWxkcmVuIiA6ICJjaGlsZE5vZGVzIjsNCg0KCXZhciBzcGVjaWFscyA9ICI+fisiOw0KDQoJLy8gZ2xvYmFsIHRodW5rIHRvIGRldGVybWluZSB3aGV0aGVyIHdlIHNob3VsZCB0cmVhdCB0aGUgY3VycmVudCBxdWVyeSBhcw0KCS8vIGNhc2Ugc2Vuc2l0aXZlIG9yIG5vdC4gVGhpcyBzd2l0Y2ggaXMgZmxpcHBlZCBieSB0aGUgcXVlcnkgZXZhbHVhdG9yDQoJLy8gYmFzZWQgb24gdGhlIGRvY3VtZW50IHBhc3NlZCBhcyB0aGUgY29udGV4dCB0byBzZWFyY2guDQoJdmFyIGNhc2VTZW5zaXRpdmUgPSBmYWxzZTsNCg0KCS8vIGhvdyBoaWdoPw0KCXZhciB5ZXNtYW4gPSBmdW5jdGlvbigpeyByZXR1cm4gdHJ1ZTsgfTsNCg0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KCS8vIFRva2VuaXplcg0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQoJdmFyIGdldFF1ZXJ5UGFydHMgPSBmdW5jdGlvbihxdWVyeSl7DQoJCS8vCXN1bW1hcnk6IA0KCQkvLwkJc3RhdGUgbWFjaGluZSBmb3IgcXVlcnkgdG9rZW5pemF0aW9uDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJaW5zdGVhZCBvZiB1c2luZyBhIGJyaXR0bGUgYW5kIHNsb3cgcmVnZXgtYmFzZWQgQ1NTIHBhcnNlciwNCgkJLy8JCWRvam8ucXVlcnkgaW1wbGVtZW50cyBhbiBBU1Qtc3R5bGUgcXVlcnkgcmVwcmVzZW50YXRpb24uIFRoaXMNCgkJLy8JCXJlcHJlc2VudGF0aW9uIGlzIG9ubHkgZ2VuZXJhdGVkIG9uY2UgcGVyIHF1ZXJ5LiBGb3IgZXhhbXBsZSwNCgkJLy8JCXRoZSBzYW1lIHF1ZXJ5IHJ1biBtdWx0aXBsZSB0aW1lcyBvciB1bmRlciBkaWZmZXJlbnQgcm9vdCBub2Rlcw0KCQkvLwkJZG9lcyBub3QgcmUtcGFyc2UgdGhlIHNlbGVjdG9yIGV4cHJlc3Npb24gYnV0IGluc3RlYWQgdXNlcyB0aGUNCgkJLy8JCWNhY2hlZCBkYXRhIHN0cnVjdHVyZS4gVGhlIHN0YXRlIG1hY2hpbmUgaW1wbGVtZW50ZWQgaGVyZQ0KCQkvLwkJdGVybWluYXRlcyBvbiB0aGUgbGFzdCAiICIgKHNwYWNlKSBjaGFyYWNodGVyIGFuZCByZXR1cm5zIGFuDQoJCS8vCQlvcmRlcmVkIGFycmF5IG9mIHF1ZXJ5IGNvbXBvbmVudCBzdHJ1Y3R1cmVzIChvciAicGFydHMiKS4gRWFjaA0KCQkvLwkJcGFydCByZXByZXNlbnRzIGFuIG9wZXJhdG9yIG9yIGEgc2ltcGxlIENTUyBmaWx0ZXJpbmcNCgkJLy8JCWV4cHJlc3Npb24uIFRoZSBzdHJ1Y3R1cmUgZm9yIHBhcnRzIGlzIGRvY3VtZW50ZWQgaW4gdGhlIGNvZGUNCgkJLy8JCWJlbG93Lg0KDQoNCgkJLy8gTk9URTogDQoJCS8vCQl0aGlzIGNvZGUgaXMgZGVzaWduZWQgdG8gcnVuIGZhc3QgYW5kIGNvbXByZXNzIHdlbGwuIFNhY3JpZmljZXMNCgkJLy8JCXRvIHJlYWRpYmlsaXR5IGFuZCBtYWludGFpbmFiaWxpdHkgaGF2ZSBiZWVuIG1hZGUuICBZb3VyIGJlc3QNCgkJLy8JCWJldCB3aGVuIGhhY2tpbmcgdGhlIHRva2VuaXplciBpcyB0byBwdXQgVGhlIERvbm5hcyBvbiAqcmVhbGx5Kg0KCQkvLwkJbG91ZCAobWF5IHdlIHJlY29tbWVuZCB0aGVpciAiU3BlbmQgVGhlIE5pZ2h0IiByZWxlYXNlPykgYW5kDQoJCS8vCQlqdXN0IGFzc3VtZSB5b3UncmUgZ29ubmEgbWFrZSBtaXN0YWtlcy4gS2VlcCB0aGUgdW5pdCB0ZXN0cw0KCQkvLwkJb3BlbiBhbmQgcnVuIHRoZW0gZnJlcXVlbnRseS4gS25vd2luZyBpcyBoYWxmIHRoZSBiYXR0bGUgOy0pDQoJCWlmKHNwZWNpYWxzLmluZGV4T2YocXVlcnkuc2xpY2UoLTEpKSA+PSAwKXsNCgkJCS8vIGlmIHdlIGVuZCB3aXRoIGEgIj4iLCAiKyIsIG9yICJ+IiwgdGhhdCBtZWFucyB3ZSdyZSBpbXBsaWNpdGx5DQoJCQkvLyBzZWFyY2hpbmcgYWxsIGNoaWxkcmVuLCBzbyBtYWtlIGl0IGV4cGxpY2l0DQoJCQlxdWVyeSArPSAiICogIg0KCQl9ZWxzZXsNCgkJCS8vIGlmIHlvdSBoYXZlIG5vdCBwcm92aWRlZCBhIHRlcm1pbmF0b3IsIG9uZSB3aWxsIGJlIHByb3ZpZGVkIGZvcg0KCQkJLy8geW91Li4uDQoJCQlxdWVyeSArPSAiICI7DQoJCX0NCg0KCQl2YXIgdHMgPSBmdW5jdGlvbigvKkludGVnZXIqLyBzLCAvKkludGVnZXIqLyBlKXsNCgkJCS8vIHRyaW0gYW5kIHNsaWNlLiANCg0KCQkJLy8gdGFrZSBhbiBpbmRleCB0byBzdGFydCBhIHN0cmluZyBzbGljZSBmcm9tIGFuZCBhbiBlbmQgcG9zaXRpb24NCgkJCS8vIGFuZCByZXR1cm4gYSB0cmltbWVkIGNvcHkgb2YgdGhhdCBzdWItc3RyaW5nDQoJCQlyZXR1cm4gdHJpbShxdWVyeS5zbGljZShzLCBlKSk7DQoJCX0NCg0KCQkvLyB0aGUgb3ZlcmFsbCBkYXRhIGdyYXBoIG9mIHRoZSBmdWxsIHF1ZXJ5LCBhcyByZXByZXNlbnRlZCBieSBxdWVyeVBhcnQgb2JqZWN0cw0KCQl2YXIgcXVlcnlQYXJ0cyA9IFtdOyANCg0KDQoJCS8vIHN0YXRlIGtlZXBpbmcgdmFycw0KCQl2YXIgaW5CcmFja2V0cyA9IC0xLCBpblBhcmVucyA9IC0xLCBpbk1hdGNoRm9yID0gLTEsIA0KCQkJaW5Qc2V1ZG8gPSAtMSwgaW5DbGFzcyA9IC0xLCBpbklkID0gLTEsIGluVGFnID0gLTEsIA0KCQkJbGMgPSAiIiwgY2MgPSAiIiwgcFN0YXJ0Ow0KDQoJCS8vIGl0ZXJhdGlvbiB2YXJzDQoJCXZhciB4ID0gMCwgLy8gaW5kZXggaW4gdGhlIHF1ZXJ5DQoJCQlxbCA9IHF1ZXJ5Lmxlbmd0aCwNCgkJCWN1cnJlbnRQYXJ0ID0gbnVsbCwgLy8gZGF0YSBzdHJ1Y3R1cmUgcmVwcmVzZW50aW5nIHRoZSBlbnRpcmUgY2xhdXNlDQoJCQlfY3AgPSBudWxsOyAvLyB0aGUgY3VycmVudCBwc2V1ZG8gb3IgYXR0ciBtYXRjaGVyDQoNCgkJLy8gc2V2ZXJhbCB0ZW1wb3JhcnkgdmFyaWFibGVzIGFyZSBhc3NpZ25lZCB0byB0aGlzIHN0cnVjdHVyZSBkdXJyaW5nIGENCgkJLy8gcG90ZW50aWFsIHN1Yi1leHByZXNzaW9uIG1hdGNoOg0KCQkvLwkJYXR0cjoNCgkJLy8JCQlhIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgZnVsbCBhdHRyaWJ1dGUgbWF0Y2ggaW4gYQ0KCQkvLwkJCWJyYWNrZXQgZXhwcmVzc2lvbg0KCQkvLwkJdHlwZToNCgkJLy8JCQlpZiB0aGVyZSdzIGFuIG9wZXJhdG9yIGluIGEgYnJhY2tldCBleHByZXNzaW9uLCB0aGlzIGlzDQoJCS8vCQkJdXNlZCB0byBrZWVwIHRyYWNrIG9mIGl0DQoJCS8vCQl2YWx1ZToNCgkJLy8JCQl0aGUgaW50ZXJuYWxzIG9mIHBhcmVudGhldGljYWwgZXhwcmVzc2lvbiBmb3IgYSBwc2V1ZG8uIGZvcg0KCQkvLwkJCTpudGgtY2hpbGQoMm4rMSksIHZhbHVlIG1pZ2h0IGJlICIybisxIg0KDQoJCXZhciBlbmRUYWcgPSBmdW5jdGlvbigpew0KCQkJLy8gY2FsbGVkIHdoZW4gdGhlIHRva2VuaXplciBoaXRzIHRoZSBlbmQgb2YgYSBwYXJ0aWN1bGFyIHRhZyBuYW1lLg0KCQkJLy8gUmUtc2V0cyBzdGF0ZSB2YXJpYWJsZXMgZm9yIHRhZyBtYXRjaGluZyBhbmQgc2V0cyB1cCB0aGUgbWF0Y2hlcg0KCQkJLy8gdG8gaGFuZGxlIHRoZSBuZXh0IHR5cGUgb2YgdG9rZW4gKHRhZyBvciBvcGVyYXRvcikuDQoJCQlpZihpblRhZyA+PSAwKXsNCgkJCQl2YXIgdHYgPSAoaW5UYWcgPT0geCkgPyBudWxsIDogdHMoaW5UYWcsIHgpOyAvLyAudG9Mb3dlckNhc2UoKTsNCgkJCQljdXJyZW50UGFydFsgKHNwZWNpYWxzLmluZGV4T2YodHYpIDwgMCkgPyAidGFnIiA6ICJvcGVyIiBdID0gdHY7DQoJCQkJaW5UYWcgPSAtMTsNCgkJCX0NCgkJfQ0KDQoJCXZhciBlbmRJZCA9IGZ1bmN0aW9uKCl7DQoJCQkvLyBjYWxsZWQgd2hlbiB0aGUgdG9rZW5pemVyIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgYW4gSUQgcG9ydGlvbiBvZiBhIG1hdGNoDQoJCQlpZihpbklkID49IDApew0KCQkJCWN1cnJlbnRQYXJ0LmlkID0gdHMoaW5JZCwgeCkucmVwbGFjZSgvXFwvZywgIiIpOw0KCQkJCWluSWQgPSAtMTsNCgkJCX0NCgkJfQ0KDQoJCXZhciBlbmRDbGFzcyA9IGZ1bmN0aW9uKCl7DQoJCQkvLyBjYWxsZWQgd2hlbiB0aGUgdG9rZW5pemVyIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgYSBjbGFzcyBuYW1lDQoJCQkvLyBtYXRjaC4gQ1NTIGFsbG93cyBmb3IgbXVsdGlwbGUgY2xhc3Nlcywgc28gd2UgYXVnbWVudCB0aGUNCgkJCS8vIGN1cnJlbnQgaXRlbSB3aXRoIGFub3RoZXIgY2xhc3MgaW4gaXRzIGxpc3QNCgkJCWlmKGluQ2xhc3MgPj0gMCl7DQoJCQkJY3VycmVudFBhcnQuY2xhc3Nlcy5wdXNoKHRzKGluQ2xhc3MrMSwgeCkucmVwbGFjZSgvXFwvZywgIiIpKTsNCgkJCQlpbkNsYXNzID0gLTE7DQoJCQl9DQoJCX0NCg0KCQl2YXIgZW5kQWxsID0gZnVuY3Rpb24oKXsNCgkJCS8vIGF0IHRoZSBlbmQgb2YgYSBzaW1wbGUgZnJhZ21lbnQsIHNvIHdhbGwgb2ZmIHRoZSBtYXRjaGVzDQoJCQllbmRJZCgpOyBlbmRUYWcoKTsgZW5kQ2xhc3MoKTsNCgkJfQ0KDQoJCXZhciBlbmRQYXJ0ID0gZnVuY3Rpb24oKXsNCgkJCWVuZEFsbCgpOw0KCQkJaWYoaW5Qc2V1ZG8gPj0gMCl7DQoJCQkJY3VycmVudFBhcnQucHNldWRvcy5wdXNoKHsgbmFtZTogdHMoaW5Qc2V1ZG8rMSwgeCkgfSk7DQoJCQl9DQoJCQkvLyBoaW50IHRvIHRoZSBzZWxlY3RvciBlbmdpbmUgdG8gdGVsbCBpdCB3aGV0aGVyIG9yIG5vdCBpdA0KCQkJLy8gbmVlZHMgdG8gZG8gYW55IGl0ZXJhdGlvbi4gTWFueSBzaW1wbGUgc2VsZWN0b3JzIGRvbid0LCBhbmQNCgkJCS8vIHdlIGNhbiBhdm9pZCBzaWduaWZpY2FudCBjb25zdHJ1Y3Rpb24tdGltZSB3b3JrIGJ5IGFkdmlzaW5nDQoJCQkvLyB0aGUgc3lzdGVtIHRvIHNraXAgdGhlbQ0KCQkJY3VycmVudFBhcnQubG9vcHMgPSAoCQ0KCQkJCQljdXJyZW50UGFydC5wc2V1ZG9zLmxlbmd0aCB8fCANCgkJCQkJY3VycmVudFBhcnQuYXR0cnMubGVuZ3RoIHx8IA0KCQkJCQljdXJyZW50UGFydC5jbGFzc2VzLmxlbmd0aAkpOw0KDQoJCQljdXJyZW50UGFydC5vcXVlcnkgPSBjdXJyZW50UGFydC5xdWVyeSA9IHRzKHBTdGFydCwgeCk7IC8vIHNhdmUgdGhlIGZ1bGwgZXhwcmVzc2lvbiBhcyBhIHN0cmluZw0KDQoNCgkJCS8vIG90YWcvdGFnIGFyZSBoaW50cyB0byBzdWdnZXN0IHRvIHRoZSBzeXN0ZW0gd2hldGhlciBvciBub3QNCgkJCS8vIGl0J3MgYW4gb3BlcmF0b3Igb3IgYSB0YWcuIFdlIHNhdmUgYSBjb3B5IG9mIG90YWcgc2luY2UgdGhlDQoJCQkvLyB0YWcgbmFtZSBpcyBjYXN0IHRvIHVwcGVyLWNhc2UgaW4gcmVndWxhciBIVE1MIG1hdGNoZXMuIFRoZQ0KCQkJLy8gc3lzdGVtIGhhcyBhIGdsb2JhbCBzd2l0Y2ggdG8gZmlndXJlIG91dCBpZiB0aGUgY3VycmVudA0KCQkJLy8gZXhwcmVzc2lvbiBuZWVkcyB0byBiZSBjYXNlIHNlbnNpdGl2ZSBvciBub3QgYW5kIGl0IHdpbGwgdXNlDQoJCQkvLyBvdGFnIG9yIHRhZyBhY2NvcmRpbmdseQ0KCQkJY3VycmVudFBhcnQub3RhZyA9IGN1cnJlbnRQYXJ0LnRhZyA9IChjdXJyZW50UGFydFsib3BlciJdKSA/IG51bGwgOiAoY3VycmVudFBhcnQudGFnIHx8ICIqIik7DQoNCgkJCWlmKGN1cnJlbnRQYXJ0LnRhZyl7DQoJCQkJLy8gaWYgd2UncmUgaW4gYSBjYXNlLWluc2Vuc2l0aXZlIEhUTUwgZG9jLCB3ZSBsaWtlbHkgd2FudA0KCQkJCS8vIHRoZSB0b1VwcGVyQ2FzZSB3aGVuIG1hdGNoaW5nIG9uIGVsZW1lbnQudGFnTmFtZS4gSWYgd2UNCgkJCQkvLyBkbyBpdCBoZXJlLCB3ZSBjYW4gc2tpcCB0aGUgc3RyaW5nIG9wIHBlciBub2RlDQoJCQkJLy8gY29tcGFyaXNvbg0KCQkJCWN1cnJlbnRQYXJ0LnRhZyA9IGN1cnJlbnRQYXJ0LnRhZy50b1VwcGVyQ2FzZSgpOw0KCQkJfQ0KDQoJCQkvLyBhZGQgdGhlIHBhcnQgdG8gdGhlIGxpc3QNCgkJCWlmKHF1ZXJ5UGFydHMubGVuZ3RoICYmIChxdWVyeVBhcnRzW3F1ZXJ5UGFydHMubGVuZ3RoLTFdLm9wZXIpKXsNCgkJCQkvLyBvcGVyYXRvcnMgYXJlIGFsd2F5cyBpbmZpeCwgc28gd2UgcmVtb3ZlIHRoZW0gZnJvbSB0aGUNCgkJCQkvLyBsaXN0IGFuZCBhdHRhY2ggdGhlbSB0byB0aGUgbmV4dCBtYXRjaC4gVGhlIGV2YWx1YXRvciBpcw0KCQkJCS8vIHJlc3BvbnNpYmxlIGZvciBzb3J0aW5nIG91dCBob3cgdG8gaGFuZGxlIHRoZW0uDQoJCQkJY3VycmVudFBhcnQuaW5maXhPcGVyID0gcXVlcnlQYXJ0cy5wb3AoKTsNCgkJCQljdXJyZW50UGFydC5xdWVyeSA9IGN1cnJlbnRQYXJ0LmluZml4T3Blci5xdWVyeSArICIgIiArIGN1cnJlbnRQYXJ0LnF1ZXJ5Ow0KCQkJCS8qDQoJCQkJY29uc29sZS5kZWJ1ZygJInN3YXBwaW5nIG91dCB0aGUgaW5maXgiLCANCgkJCQkJCQkJY3VycmVudFBhcnQuaW5maXhPcGVyLCANCgkJCQkJCQkJImFuZCBhdHRhY2hpbmcgaXQgdG8iLCANCgkJCQkJCQkJY3VycmVudFBhcnQpOw0KCQkJCSovDQoJCQl9DQoJCQlxdWVyeVBhcnRzLnB1c2goY3VycmVudFBhcnQpOw0KDQoJCQljdXJyZW50UGFydCA9IG51bGw7DQoJCX0NCg0KCQkvLyBpdGVyYXRlIG92ZXIgdGhlIHF1ZXJ5LCBjaGFyYWNodGVyIGJ5IGNoYXJhY2h0ZXIsIGJ1aWxkaW5nIHVwIGEgDQoJCS8vIGxpc3Qgb2YgcXVlcnkgcGFydCBvYmplY3RzDQoJCWZvcig7IGxjPWNjLCBjYz1xdWVyeS5jaGFyQXQoeCksIHggPCBxbDsgeCsrKXsNCgkJCS8vCQljYzogdGhlIGN1cnJlbnQgY2hhcmFjdGVyIGluIHRoZSBtYXRjaA0KCQkJLy8JCWxjOiB0aGUgbGFzdCBjaGFyYWNodGVyIChpZiBhbnkpDQoNCgkJCS8vIHNvbWVvbmUgaXMgdHJ5aW5nIHRvIGVzY2FwZSBzb21ldGhpbmcsIHNvIGRvbid0IHRyeSB0byBtYXRjaCBhbnkNCgkJCS8vIGZyYWdtZW50cy4gV2UgYXNzdW1lIHdlJ3JlIGluc2lkZSBhIGxpdGVyYWwuDQoJCQlpZihsYyA9PSAiXFwiKXsgY29udGludWU7IH0gDQoJCQlpZighY3VycmVudFBhcnQpeyAvLyBhIHBhcnQgd2FzIGp1c3QgZW5kZWQgb3Igbm9uZSBoYXMgeWV0IGJlZW4gY3JlYXRlZA0KCQkJCS8vIE5PVEU6IEkgaGF0ZSBhbGwgdGhpcyBhbGxvYywgYnV0IGl0J3Mgc2hvcnRlciB0aGFuIHdyaXRpbmcgdG9ucyBvZiBpZidzDQoJCQkJcFN0YXJ0ID0geDsNCgkJCQkvLwlydWxlcyBkZXNjcmliZSBmdWxsIENTUyBzdWItZXhwcmVzc2lvbnMsIGxpa2U6DQoJCQkJLy8JCSNzb21lSWQNCgkJCQkvLwkJLmNsYXNzTmFtZTpmaXJzdC1jaGlsZA0KCQkJCS8vCWJ1dCBub3Q6DQoJCQkJLy8JCXRoaW5nZXIgPiBkaXYuaG93ZHlbdHlwZT10aGluZ2VyXQ0KCQkJCS8vCXRoZSBpbmRpZHVhbCBjb21wb25lbnRzIG9mIHRoZSBwcmV2aW91cyBxdWVyeSB3b3VsZCBiZQ0KCQkJCS8vCXNwbGl0IGludG8gMyBwYXJ0cyB0aGF0IHdvdWxkIGJlIHJlcHJlc2VudGVkIGEgc3RydWN0dXJlDQoJCQkJLy8JbGlrZToNCgkJCQkvLwkJWw0KCQkJCS8vCQkJew0KCQkJCS8vCQkJCXF1ZXJ5OiAidGhpbmdlciIsDQoJCQkJLy8JCQkJdGFnOiAidGhpbmdlciIsDQoJCQkJLy8JCQl9LA0KCQkJCS8vCQkJew0KCQkJCS8vCQkJCXF1ZXJ5OiAiZGl2Lmhvd2R5W3R5cGU9dGhpbmdlcl0iLA0KCQkJCS8vCQkJCWNsYXNzZXM6IFsiaG93ZHkiXSwNCgkJCQkvLwkJCQlpbmZpeE9wZXI6IHsNCgkJCQkvLwkJCQkJcXVlcnk6ICI+IiwNCgkJCQkvLwkJCQkJb3BlcjogIj4iLA0KCQkJCS8vCQkJCX0NCgkJCQkvLwkJCX0sDQoJCQkJLy8JCV0NCgkJCQljdXJyZW50UGFydCA9IHsNCgkJCQkJcXVlcnk6IG51bGwsIC8vIHRoZSBmdWxsIHRleHQgb2YgdGhlIHBhcnQncyBydWxlDQoJCQkJCXBzZXVkb3M6IFtdLCAvLyBDU1Mgc3VwcG9ydHMgbXVsdGlwbGUgcHNldWQtY2xhc3MgbWF0Y2hlcyBpbiBhIHNpbmdsZSBydWxlDQoJCQkJCWF0dHJzOiBbXSwgCS8vIENTUyBzdXBwb3J0cyBtdWx0aS1hdHRyaWJ1dGUgbWF0Y2gsIHNvIHdlIG5lZWQgYW4gYXJyYXkNCgkJCQkJY2xhc3NlczogW10sIC8vIGNsYXNzIG1hdGNoZXMgbWF5IGJlIGFkZGl0aXZlLCBlLmcuOiAudGhpbmdlci5ibGFoLmhvd2R5DQoJCQkJCXRhZzogbnVsbCwgCS8vIG9ubHkgb25lIHRhZy4uLg0KCQkJCQlvcGVyOiBudWxsLCAvLyAuLi5vciBvcGVyYXRvciBwZXIgY29tcG9uZW50LiBOb3RlIHRoYXQgdGhlc2Ugd2luZCB1cCBiZWluZyBleGNsdXNpdmUuDQoJCQkJCWlkOiBudWxsLCAJLy8gdGhlIGlkIGNvbXBvbmVudCBvZiBhIHJ1bGUNCgkJCQkJZ2V0VGFnOiBmdW5jdGlvbigpew0KCQkJCQkJcmV0dXJuIChjYXNlU2Vuc2l0aXZlKSA/IHRoaXMub3RhZyA6IHRoaXMudGFnOw0KCQkJCQl9DQoJCQkJfTsNCg0KCQkJCS8vIGlmIHdlIGRvbid0IGhhdmUgYSBwYXJ0LCB3ZSBhc3N1bWUgd2UncmUgZ29pbmcgdG8gc3RhcnQgYXQNCgkJCQkvLyB0aGUgYmVnaW5uaW5nIG9mIGEgbWF0Y2gsIHdoaWNoIHNob3VsZCBiZSBhIHRhZyBuYW1lLiBUaGlzDQoJCQkJLy8gbWlnaHQgZmF1bHQgYSBsaXR0bGUgbGF0ZXIgb24sIGJ1dCB3ZSBkZXRlY3QgdGhhdCBhbmQgdGhpcw0KCQkJCS8vIGl0ZXJhdGlvbiB3aWxsIHN0aWxsIGJlIGZpbmUuDQoJCQkJaW5UYWcgPSB4OyANCgkJCX0NCg0KCQkJaWYoaW5CcmFja2V0cyA+PSAwKXsNCgkJCQkvLyBsb29rIGZvciBhIHRoZSBjbG9zZSBmaXJzdA0KCQkJCWlmKGNjID09ICJdIil7IC8vIGlmIHdlJ3JlIGluIGEgWy4uLl0gY2xhdXNlIGFuZCB3ZSBlbmQsIGRvIGFzc2lnbm1lbnQNCgkJCQkJaWYoIV9jcC5hdHRyKXsNCgkJCQkJCS8vIG5vIGF0dHJpYnV0ZSBtYXRjaCB3YXMgcHJldmlvdXNseSBiZWd1biwgc28gd2UNCgkJCQkJCS8vIGFzc3VtZSB0aGlzIGlzIGFuIGF0dHJpYnV0ZSBleGlzdGFuY2UgbWF0Y2ggaW4gdGhlDQoJCQkJCQkvLyBmb3JtIG9mIFtzb21lQXR0cmlidXRlTmFtZV0NCgkJCQkJCV9jcC5hdHRyID0gdHMoaW5CcmFja2V0cysxLCB4KTsNCgkJCQkJfWVsc2V7DQoJCQkJCQkvLyB3ZSBoYWQgYW4gYXR0cmlidXRlIGFscmVhZHksIHNvIHdlIGtub3cgdGhhdCB3ZSdyZQ0KCQkJCQkJLy8gbWF0Y2hpbmcgc29tZSBzb3J0IG9mIHZhbHVlLCBhcyBpbiBbYXR0ck5hbWU9aG93ZHldDQoJCQkJCQlfY3AubWF0Y2hGb3IgPSB0cygoaW5NYXRjaEZvcnx8aW5CcmFja2V0cysxKSwgeCk7DQoJCQkJCX0NCgkJCQkJdmFyIGNtZiA9IF9jcC5tYXRjaEZvcjsNCgkJCQkJaWYoY21mKXsNCgkJCQkJCS8vIHRyeSB0byBzdHJpcCBxdW90ZXMgZnJvbSB0aGUgbWF0Y2hGb3IgdmFsdWUuIFdlIHdhbnQNCgkJCQkJCS8vIFthdHRyTmFtZT1ob3dkeV0gdG8gbWF0Y2ggdGhlIHNhbWUgDQoJCQkJCQkvLwlhcyBbYXR0ck5hbWUgPSAnaG93ZHknIF0NCgkJCQkJCWlmKAkoY21mLmNoYXJBdCgwKSA9PSAnIicpIHx8IChjbWYuY2hhckF0KDApICA9PSAiJyIpICl7DQoJCQkJCQkJX2NwLm1hdGNoRm9yID0gY21mLnNsaWNlKDEsIC0xKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkvLyBlbmQgdGhlIGF0dHJpYnV0ZSBieSBhZGRpbmcgaXQgdG8gdGhlIGxpc3Qgb2YgYXR0cmlidXRlcy4gDQoJCQkJCWN1cnJlbnRQYXJ0LmF0dHJzLnB1c2goX2NwKTsNCgkJCQkJX2NwID0gbnVsbDsgLy8gbmVjZXNzYXJ5Pw0KCQkJCQlpbkJyYWNrZXRzID0gaW5NYXRjaEZvciA9IC0xOw0KCQkJCX1lbHNlIGlmKGNjID09ICI9Iil7DQoJCQkJCS8vIGlmIHRoZSBsYXN0IGNoYXIgd2FzIGFuIG9wZXJhdG9yIHByZWZpeCwgbWFrZSBzdXJlIHdlDQoJCQkJCS8vIHJlY29yZCBpdCBhbG9uZyB3aXRoIHRoZSAiPSIgb3BlcmF0b3IuIA0KCQkJCQl2YXIgYWRkVG9DYyA9ICgifH5eJCoiLmluZGV4T2YobGMpID49MCApID8gbGMgOiAiIjsNCgkJCQkJX2NwLnR5cGUgPSBhZGRUb0NjK2NjOw0KCQkJCQlfY3AuYXR0ciA9IHRzKGluQnJhY2tldHMrMSwgeC1hZGRUb0NjLmxlbmd0aCk7DQoJCQkJCWluTWF0Y2hGb3IgPSB4KzE7DQoJCQkJfQ0KCQkJCS8vIG5vdyBsb29rIGZvciBvdGhlciBjbGF1c2UgcGFydHMNCgkJCX1lbHNlIGlmKGluUGFyZW5zID49IDApew0KCQkJCS8vIGlmIHdlJ3JlIGluIGEgcGFyZW50aGV0aWNhbCBleHByZXNzaW9uLCB3ZSBuZWVkIHRvIGZpZ3VyZQ0KCQkJCS8vIG91dCBpZiBpdCdzIGF0dGFjaGVkIHRvIGEgcHNlZHVvLXNlbGVjdG9yIHJ1bGUgbGlrZQ0KCQkJCS8vIDpudGgtY2hpbGQoMSkNCgkJCQlpZihjYyA9PSAiKSIpew0KCQkJCQlpZihpblBzZXVkbyA+PSAwKXsNCgkJCQkJCV9jcC52YWx1ZSA9IHRzKGluUGFyZW5zKzEsIHgpOw0KCQkJCQl9DQoJCQkJCWluUHNldWRvID0gaW5QYXJlbnMgPSAtMTsNCgkJCQl9DQoJCQl9ZWxzZSBpZihjYyA9PSAiIyIpew0KCQkJCS8vIHN0YXJ0IG9mIGFuIElEIG1hdGNoDQoJCQkJZW5kQWxsKCk7DQoJCQkJaW5JZCA9IHgrMTsNCgkJCX1lbHNlIGlmKGNjID09ICIuIil7DQoJCQkJLy8gc3RhcnQgb2YgYSBjbGFzcyBtYXRjaA0KCQkJCWVuZEFsbCgpOw0KCQkJCWluQ2xhc3MgPSB4Ow0KCQkJfWVsc2UgaWYoY2MgPT0gIjoiKXsNCgkJCQkvLyBzdGFydCBvZiBhIHBzZXVkby1zZWxlY3RvciBtYXRjaA0KCQkJCWVuZEFsbCgpOw0KCQkJCWluUHNldWRvID0geDsNCgkJCX1lbHNlIGlmKGNjID09ICJbIil7DQoJCQkJLy8gc3RhcnQgb2YgYW4gYXR0cmlidXRlIG1hdGNoLiANCgkJCQllbmRBbGwoKTsNCgkJCQlpbkJyYWNrZXRzID0geDsNCgkJCQkvLyBwcm92aWRlIGEgbmV3IHN0cnVjdHVyZSBmb3IgdGhlIGF0dHJpYnV0ZSBtYXRjaCB0byBmaWxsLWluDQoJCQkJX2NwID0gew0KCQkJCQkvKj09PT09DQoJCQkJCWF0dHI6IG51bGwsIHR5cGU6IG51bGwsIG1hdGNoRm9yOiBudWxsDQoJCQkJCT09PT09Ki8NCgkJCQl9Ow0KCQkJfWVsc2UgaWYoY2MgPT0gIigiKXsNCgkJCQkvLyB3ZSByZWFsbHkgb25seSBjYXJlIGlmIHdlJ3ZlIGVudGVyZWQgYSBwYXJlbnRoZXRpY2FsDQoJCQkJLy8gZXhwcmVzc2lvbiBpZiB3ZSdyZSBhbHJlYWR5IGluc2lkZSBhIHBzZXVkby1zZWxlY3RvciBtYXRjaA0KCQkJCWlmKGluUHNldWRvID49IDApew0KCQkJCQkvLyBwcm92aWRlIGEgbmV3IHN0cnVjdHVyZSBmb3IgdGhlIHBzZXVkbyBtYXRjaCB0byBmaWxsLWluDQoJCQkJCV9jcCA9IHsgDQoJCQkJCQluYW1lOiB0cyhpblBzZXVkbysxLCB4KSwgDQoJCQkJCQl2YWx1ZTogbnVsbA0KCQkJCQl9DQoJCQkJCWN1cnJlbnRQYXJ0LnBzZXVkb3MucHVzaChfY3ApOw0KCQkJCX0NCgkJCQlpblBhcmVucyA9IHg7DQoJCQl9ZWxzZSBpZigNCgkJCQkoY2MgPT0gIiAiKSAmJiANCgkJCQkvLyBpZiBpdCdzIGEgc3BhY2UgY2hhciBhbmQgdGhlIGxhc3QgY2hhciBpcyB0b28sIGNvbnN1bWUgdGhlDQoJCQkJLy8gY3VycmVudCBvbmUgd2l0aG91dCBkb2luZyBtb3JlIHdvcmsNCgkJCQkobGMgIT0gY2MpDQoJCQkpew0KCQkJCWVuZFBhcnQoKTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcXVlcnlQYXJ0czsNCgl9Ow0KCQ0KDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJLy8gRE9NIHF1ZXJ5IGluZnJhc3RydWN0dXJlDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCgl2YXIgYWdyZWUgPSBmdW5jdGlvbihmaXJzdCwgc2Vjb25kKXsNCgkJLy8gdGhlIGJhc2ljIGJ1aWxkaW5nIGJsb2NrIG9mIHRoZSB5ZXMvbm8gY2hhaW5pbmcgc3lzdGVtLiBhZ3JlZShmMSwNCgkJLy8gZjIpIGdlbmVyYXRlcyBhIG5ldyBmdW5jdGlvbiB3aGljaCByZXR1cm5zIHRoZSBib29sZWFuIHJlc3VsdHMgb2YNCgkJLy8gYm90aCBvZiB0aGUgcGFzc2VkIGZ1bmN0aW9ucyB0byBhIHNpbmdsZSBsb2dpY2FsLWFuZGVkIHJlc3VsdC4gSWYNCgkJLy8gZWl0aGVyIGFyZSBub3QgcG9zc2VkLCB0aGUgb3RoZXIgaXMgdXNlZCBleGNsdXNpdmVseS4NCgkJaWYoIWZpcnN0KXsgcmV0dXJuIHNlY29uZDsgfQ0KCQlpZighc2Vjb25kKXsgcmV0dXJuIGZpcnN0OyB9DQoNCgkJcmV0dXJuIGZ1bmN0aW9uKCl7DQoJCQlyZXR1cm4gZmlyc3QuYXBwbHkod2luZG93LCBhcmd1bWVudHMpICYmIHNlY29uZC5hcHBseSh3aW5kb3csIGFyZ3VtZW50cyk7DQoJCX0NCgl9Ow0KDQoJdmFyIGdldEFyciA9IGZ1bmN0aW9uKGksIGFycil7DQoJCS8vIGhlbHBzIHVzIGF2b2lkIGFycmF5IGFsbG9jIHdoZW4gd2UgZG9uJ3QgbmVlZCBpdA0KCQl2YXIgciA9IGFycnx8W107IC8vIEZJWE1FOiBzaG91bGQgdGhpcyBiZSAnbmV3IGQuX05vZGVMaXN0Q3RvcigpJyA/DQoJCWlmKGkpeyByLnB1c2goaSk7IH0NCgkJcmV0dXJuIHI7DQoJfTsNCg0KCXZhciBfaXNFbGVtZW50ID0gZnVuY3Rpb24obil7IHJldHVybiAoMSA9PSBuLm5vZGVUeXBlKTsgfTsNCg0KCS8vIEZJWE1FOiBuZWVkIHRvIGNvYWxlc2NlIF9nZXRBdHRyIHdpdGggZGVmYXVsdEdldHRlcg0KCXZhciBibGFuayA9ICIiOw0KCXZhciBfZ2V0QXR0ciA9IGZ1bmN0aW9uKGVsZW0sIGF0dHIpew0KCQlpZighZWxlbSl7IHJldHVybiBibGFuazsgfQ0KCQlpZihhdHRyID09ICJjbGFzcyIpew0KCQkJcmV0dXJuIGVsZW0uY2xhc3NOYW1lIHx8IGJsYW5rOw0KCQl9DQoJCWlmKGF0dHIgPT0gImZvciIpew0KCQkJcmV0dXJuIGVsZW0uaHRtbEZvciB8fCBibGFuazsNCgkJfQ0KCQlpZihhdHRyID09ICJzdHlsZSIpew0KCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCBibGFuazsNCgkJfQ0KCQlyZXR1cm4gKGNhc2VTZW5zaXRpdmUgPyBlbGVtLmdldEF0dHJpYnV0ZShhdHRyKSA6IGVsZW0uZ2V0QXR0cmlidXRlKGF0dHIsIDIpKSB8fCBibGFuazsNCgl9Ow0KDQoJdmFyIGF0dHJzID0gew0KCQkiKj0iOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJLy8gRVtmb28qPSJiYXIiXQ0KCQkJCS8vCQlhbiBFIGVsZW1lbnQgd2hvc2UgImZvbyIgYXR0cmlidXRlIHZhbHVlIGNvbnRhaW5zDQoJCQkJLy8JCXRoZSBzdWJzdHJpbmcgImJhciINCgkJCQlyZXR1cm4gKF9nZXRBdHRyKGVsZW0sIGF0dHIpLmluZGV4T2YodmFsdWUpPj0wKTsNCgkJCX0NCgkJfSwNCgkJIl49IjogZnVuY3Rpb24oYXR0ciwgdmFsdWUpew0KCQkJLy8gRVtmb29ePSJiYXIiXQ0KCQkJLy8JCWFuIEUgZWxlbWVudCB3aG9zZSAiZm9vIiBhdHRyaWJ1dGUgdmFsdWUgYmVnaW5zIGV4YWN0bHkNCgkJCS8vCQl3aXRoIHRoZSBzdHJpbmcgImJhciINCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQlyZXR1cm4gKF9nZXRBdHRyKGVsZW0sIGF0dHIpLmluZGV4T2YodmFsdWUpPT0wKTsNCgkJCX0NCgkJfSwNCgkJIiQ9IjogZnVuY3Rpb24oYXR0ciwgdmFsdWUpew0KCQkJLy8gRVtmb28kPSJiYXIiXQkNCgkJCS8vCQlhbiBFIGVsZW1lbnQgd2hvc2UgImZvbyIgYXR0cmlidXRlIHZhbHVlIGVuZHMgZXhhY3RseQ0KCQkJLy8JCXdpdGggdGhlIHN0cmluZyAiYmFyIg0KCQkJdmFyIHR2YWwgPSAiICIrdmFsdWU7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJdmFyIGVhID0gIiAiK19nZXRBdHRyKGVsZW0sIGF0dHIpOw0KCQkJCXJldHVybiAoZWEubGFzdEluZGV4T2YodmFsdWUpPT0oZWEubGVuZ3RoLXZhbHVlLmxlbmd0aCkpOw0KCQkJfQ0KCQl9LA0KCQkifj0iOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7DQoJCQkvLyBFW2Zvb349ImJhciJdCQ0KCQkJLy8JCWFuIEUgZWxlbWVudCB3aG9zZSAiZm9vIiBhdHRyaWJ1dGUgdmFsdWUgaXMgYSBsaXN0IG9mDQoJCQkvLwkJc3BhY2Utc2VwYXJhdGVkIHZhbHVlcywgb25lIG9mIHdoaWNoIGlzIGV4YWN0bHkgZXF1YWwNCgkJCS8vCQl0byAiYmFyIg0KDQoJCQkvLyByZXR1cm4gIltjb250YWlucyhjb25jYXQoJyAnLEAiK2F0dHIrIiwnICcpLCAnICIrIHZhbHVlICsiICcpXSI7DQoJCQl2YXIgdHZhbCA9ICIgIit2YWx1ZSsiICI7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJdmFyIGVhID0gIiAiK19nZXRBdHRyKGVsZW0sIGF0dHIpKyIgIjsNCgkJCQlyZXR1cm4gKGVhLmluZGV4T2YodHZhbCk+PTApOw0KCQkJfQ0KCQl9LA0KCQkifD0iOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7DQoJCQkvLyBFW2hyZWZsYW5nfD0iZW4iXQ0KCQkJLy8JCWFuIEUgZWxlbWVudCB3aG9zZSAiaHJlZmxhbmciIGF0dHJpYnV0ZSBoYXMgYQ0KCQkJLy8JCWh5cGhlbi1zZXBhcmF0ZWQgbGlzdCBvZiB2YWx1ZXMgYmVnaW5uaW5nIChmcm9tIHRoZQ0KCQkJLy8JCWxlZnQpIHdpdGggImVuIg0KCQkJdmFyIHZhbHVlRGFzaCA9ICIgIit2YWx1ZSsiLSI7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJdmFyIGVhID0gIiAiK19nZXRBdHRyKGVsZW0sIGF0dHIpOw0KCQkJCXJldHVybiAoDQoJCQkJCShlYSA9PSB2YWx1ZSkgfHwNCgkJCQkJKGVhLmluZGV4T2YodmFsdWVEYXNoKT09MCkNCgkJCQkpOw0KCQkJfQ0KCQl9LA0KCQkiPSI6IGZ1bmN0aW9uKGF0dHIsIHZhbHVlKXsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQlyZXR1cm4gKF9nZXRBdHRyKGVsZW0sIGF0dHIpID09IHZhbHVlKTsNCgkJCX0NCgkJfQ0KCX07DQoNCgkvLyBhdm9pZCB0ZXN0aW5nIGZvciBub2RlIHR5cGUgaWYgd2UgY2FuLiBEZWZpbmluZyB0aGlzIGluIHRoZSBuZWdhdGl2ZQ0KCS8vIGhlcmUgdG8gYXZvaWQgbmVnYXRpb24gaW4gdGhlIGZhc3QgcGF0aC4NCgl2YXIgX25vTkVTID0gKHR5cGVvZiBnZXREb2MoKS5maXJzdENoaWxkLm5leHRFbGVtZW50U2libGluZyA9PSAidW5kZWZpbmVkIik7DQoJdmFyIF9ucyA9ICFfbm9ORVMgPyAibmV4dEVsZW1lbnRTaWJsaW5nIiA6ICJuZXh0U2libGluZyI7DQoJdmFyIF9wcyA9ICFfbm9ORVMgPyAicHJldmlvdXNFbGVtZW50U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIjsNCgl2YXIgX3NpbXBsZU5vZGVUZXN0ID0gKF9ub05FUyA/IF9pc0VsZW1lbnQgOiB5ZXNtYW4pOw0KDQoJdmFyIF9sb29rTGVmdCA9IGZ1bmN0aW9uKG5vZGUpew0KCQkvLyBsb29rIGxlZnQNCgkJd2hpbGUobm9kZSA9IG5vZGVbX3BzXSl7DQoJCQlpZihfc2ltcGxlTm9kZVRlc3Qobm9kZSkpeyByZXR1cm4gZmFsc2U7IH0NCgkJfQ0KCQlyZXR1cm4gdHJ1ZTsNCgl9Ow0KDQoJdmFyIF9sb29rUmlnaHQgPSBmdW5jdGlvbihub2RlKXsNCgkJLy8gbG9vayByaWdodA0KCQl3aGlsZShub2RlID0gbm9kZVtfbnNdKXsNCgkJCWlmKF9zaW1wbGVOb2RlVGVzdChub2RlKSl7IHJldHVybiBmYWxzZTsgfQ0KCQl9DQoJCXJldHVybiB0cnVlOw0KCX07DQoNCgl2YXIgZ2V0Tm9kZUluZGV4ID0gZnVuY3Rpb24obm9kZSl7DQoJCXZhciByb290ID0gbm9kZS5wYXJlbnROb2RlOw0KCQl2YXIgaSA9IDAsDQoJCQl0cmV0ID0gcm9vdFtjaGlsZE5vZGVzTmFtZV0sDQoJCQljaSA9IChub2RlWyJfaSJdfHwtMSksDQoJCQljbCA9IChyb290WyJfbCJdfHwtMSk7DQoNCgkJaWYoIXRyZXQpeyByZXR1cm4gLTE7IH0NCgkJdmFyIGwgPSB0cmV0Lmxlbmd0aDsNCg0KCQkvLyB3ZSBjYWxjdWF0ZSB0aGUgcGFyZW50IGxlbmd0aCBhcyBhIGNoZWFwIHdheSB0byBpbnZhbGlkYXRlIHRoZQ0KCQkvLyBjYWNoZS4gSXQncyBub3QgMTAwJSBhY2N1cmF0ZSwgYnV0IGl0J3MgbXVjaCBtb3JlIGhvbmVzdCB0aGFuIHdoYXQNCgkJLy8gb3RoZXIgbGlicmFyaWVzIGRvDQoJCWlmKCBjbCA9PSBsICYmIGNpID49IDAgJiYgY2wgPj0gMCApew0KCQkJLy8gaWYgaXQncyBsZWdpdCwgdGFnIGFuZCByZWxlYXNlDQoJCQlyZXR1cm4gY2k7DQoJCX0NCg0KCQkvLyBlbHNlIHJlLWtleSB0aGluZ3MNCgkJcm9vdFsiX2wiXSA9IGw7DQoJCWNpID0gLTE7DQoJCWZvcih2YXIgdGUgPSByb290WyJmaXJzdEVsZW1lbnRDaGlsZCJdfHxyb290WyJmaXJzdENoaWxkIl07IHRlOyB0ZSA9IHRlW19uc10pew0KCQkJaWYoX3NpbXBsZU5vZGVUZXN0KHRlKSl7IA0KCQkJCXRlWyJfaSJdID0gKytpOw0KCQkJCWlmKG5vZGUgPT09IHRlKXsgDQoJCQkJCS8vIE5PVEU6DQoJCQkJCS8vIAlzaG9ydGN1dGluZyB0aGUgcmV0dXJuIGF0IHRoaXMgc3RlcCBpbiBpbmRleGluZyB3b3Jrcw0KCQkJCQkvLyAJdmVyeSB3ZWxsIGZvciBiZW5jaG1hcmtpbmcgYnV0IHdlIGF2b2lkIGl0IGhlcmUgc2luY2UNCgkJCQkJLy8gCWl0IGxlYWRzIHRvIHBvdGVudGlhbCBPKG5eMikgYmVoYXZpb3IgaW4gc2VxdWVudGlhbA0KCQkJCQkvLyAJZ2V0Tm9kZXhJbmRleCBvcGVyYXRpb25zIG9uIGEgcHJldmlvdXNseSB1bi1pbmRleGVkDQoJCQkJCS8vIAlwYXJlbnQuIFdlIG1heSByZXZpc2l0IHRoaXMgYXQgYSBsYXRlciB0aW1lLCBidXQgZm9yDQoJCQkJCS8vIAlub3cgd2UganVzdCB3YW50IHRvIGdldCB0aGUgcmlnaHQgYW5zd2VyIG1vcmUgb2Z0ZW4NCgkJCQkJLy8gCXRoYW4gbm90Lg0KCQkJCQljaSA9IGk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCXJldHVybiBjaTsNCgl9Ow0KDQoJdmFyIGlzRXZlbiA9IGZ1bmN0aW9uKGVsZW0pew0KCQlyZXR1cm4gISgoZ2V0Tm9kZUluZGV4KGVsZW0pKSAlIDIpOw0KCX07DQoNCgl2YXIgaXNPZGQgPSBmdW5jdGlvbihlbGVtKXsNCgkJcmV0dXJuICgoZ2V0Tm9kZUluZGV4KGVsZW0pKSAlIDIpOw0KCX07DQoNCgl2YXIgcHNldWRvcyA9IHsNCgkJImNoZWNrZWQiOiBmdW5jdGlvbihuYW1lLCBjb25kaXRpb24pew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJCXJldHVybiAhISgiY2hlY2tlZCIgaW4gZWxlbSA/IGVsZW0uY2hlY2tlZCA6IGVsZW0uc2VsZWN0ZWQpOw0KCQkJfQ0KCQl9LA0KCQkiZmlyc3QtY2hpbGQiOiBmdW5jdGlvbigpeyByZXR1cm4gX2xvb2tMZWZ0OyB9LA0KCQkibGFzdC1jaGlsZCI6IGZ1bmN0aW9uKCl7IHJldHVybiBfbG9va1JpZ2h0OyB9LA0KCQkib25seS1jaGlsZCI6IGZ1bmN0aW9uKG5hbWUsIGNvbmRpdGlvbil7DQoJCQlyZXR1cm4gZnVuY3Rpb24obm9kZSl7IA0KCQkJCWlmKCFfbG9va0xlZnQobm9kZSkpeyByZXR1cm4gZmFsc2U7IH0NCgkJCQlpZighX2xvb2tSaWdodChub2RlKSl7IHJldHVybiBmYWxzZTsgfQ0KCQkJCXJldHVybiB0cnVlOw0KCQkJfTsNCgkJfSwNCgkJImVtcHR5IjogZnVuY3Rpb24obmFtZSwgY29uZGl0aW9uKXsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQkvLyBEb21RdWVyeSBhbmQgalF1ZXJ5IGdldCB0aGlzIHdyb25nLCBvZGRseSBlbm91Z2guDQoJCQkJLy8gVGhlIENTUyAzIHNlbGVjdG9ycyBzcGVjIGlzIHByZXR0eSBleHBsaWNpdCBhYm91dCBpdCwgdG9vLg0KCQkJCXZhciBjbiA9IGVsZW0uY2hpbGROb2RlczsNCgkJCQl2YXIgY25sID0gZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsNCgkJCQkvLyBpZighY25sKXsgcmV0dXJuIHRydWU7IH0NCgkJCQlmb3IodmFyIHg9Y25sLTE7IHggPj0gMDsgeC0tKXsNCgkJCQkJdmFyIG50ID0gY25beF0ubm9kZVR5cGU7DQoJCQkJCWlmKChudCA9PT0gMSl8fChudCA9PSAzKSl7IHJldHVybiBmYWxzZTsgfQ0KCQkJCX0NCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfSwNCgkJImNvbnRhaW5zIjogZnVuY3Rpb24obmFtZSwgY29uZGl0aW9uKXsNCgkJCXZhciBjeiA9IGNvbmRpdGlvbi5jaGFyQXQoMCk7DQoJCQlpZiggY3ogPT0gJyInIHx8IGN6ID09ICInIiApeyAvL3JlbW92ZSBxdW90ZQ0KCQkJCWNvbmRpdGlvbiA9IGNvbmRpdGlvbi5zbGljZSgxLCAtMSk7DQoJCQl9DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJcmV0dXJuIChlbGVtLmlubmVySFRNTC5pbmRleE9mKGNvbmRpdGlvbikgPj0gMCk7DQoJCQl9DQoJCX0sDQoJCSJub3QiOiBmdW5jdGlvbihuYW1lLCBjb25kaXRpb24pew0KCQkJdmFyIHAgPSBnZXRRdWVyeVBhcnRzKGNvbmRpdGlvbilbMF07DQoJCQl2YXIgaWdub3JlcyA9IHsgZWw6IDEgfTsgDQoJCQlpZihwLnRhZyAhPSAiKiIpew0KCQkJCWlnbm9yZXMudGFnID0gMTsNCgkJCX0NCgkJCWlmKCFwLmNsYXNzZXMubGVuZ3RoKXsNCgkJCQlpZ25vcmVzLmNsYXNzZXMgPSAxOw0KCQkJfQ0KCQkJdmFyIG50ZiA9IGdldFNpbXBsZUZpbHRlckZ1bmMocCwgaWdub3Jlcyk7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJcmV0dXJuICghbnRmKGVsZW0pKTsNCgkJCX0NCgkJfSwNCgkJIm50aC1jaGlsZCI6IGZ1bmN0aW9uKG5hbWUsIGNvbmRpdGlvbil7DQoJCQl2YXIgcGkgPSBwYXJzZUludDsNCgkJCS8vIGF2b2lkIHJlLWRlZmluaW5nIGZ1bmN0aW9uIG9iamVjdHMgaWYgd2UgY2FuDQoJCQlpZihjb25kaXRpb24gPT0gIm9kZCIpew0KCQkJCXJldHVybiBpc09kZDsNCgkJCX1lbHNlIGlmKGNvbmRpdGlvbiA9PSAiZXZlbiIpew0KCQkJCXJldHVybiBpc0V2ZW47DQoJCQl9DQoJCQkvLyBGSVhNRTogY2FuIHdlIHNob3J0ZW4gdGhpcz8NCgkJCWlmKGNvbmRpdGlvbi5pbmRleE9mKCJuIikgIT0gLTEpew0KCQkJCXZhciB0cGFydHMgPSBjb25kaXRpb24uc3BsaXQoIm4iLCAyKTsNCgkJCQl2YXIgcHJlZCA9IHRwYXJ0c1swXSA/ICgodHBhcnRzWzBdID09ICctJykgPyAtMSA6IHBpKHRwYXJ0c1swXSkpIDogMTsNCgkJCQl2YXIgaWR4ID0gdHBhcnRzWzFdID8gcGkodHBhcnRzWzFdKSA6IDA7DQoJCQkJdmFyIGxiID0gMCwgdWIgPSAtMTsNCgkJCQlpZihwcmVkID4gMCl7DQoJCQkJCWlmKGlkeCA8IDApew0KCQkJCQkJaWR4ID0gKGlkeCAlIHByZWQpICYmIChwcmVkICsgKGlkeCAlIHByZWQpKTsNCgkJCQkJfWVsc2UgaWYoaWR4PjApew0KCQkJCQkJaWYoaWR4ID49IHByZWQpew0KCQkJCQkJCWxiID0gaWR4IC0gaWR4ICUgcHJlZDsNCgkJCQkJCX0NCgkJCQkJCWlkeCA9IGlkeCAlIHByZWQ7DQoJCQkJCX0NCgkJCQl9ZWxzZSBpZihwcmVkPDApew0KCQkJCQlwcmVkICo9IC0xOw0KCQkJCQkvLyBpZHggaGFzIHRvIGJlIGdyZWF0ZXIgdGhhbiAwIHdoZW4gcHJlZCBpcyBuZWdhdGl2ZTsNCgkJCQkJLy8gc2hhbGwgd2UgdGhyb3cgYW4gZXJyb3IgaGVyZT8NCgkJCQkJaWYoaWR4ID4gMCl7DQoJCQkJCQl1YiA9IGlkeDsNCgkJCQkJCWlkeCA9IGlkeCAlIHByZWQ7DQoJCQkJCX0NCgkJCQl9DQoJCQkJaWYocHJlZCA+IDApew0KCQkJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJCQl2YXIgaSA9IGdldE5vZGVJbmRleChlbGVtKTsNCgkJCQkJCXJldHVybiAoaT49bGIpICYmICh1YjwwIHx8IGk8PXViKSAmJiAoKGkgJSBwcmVkKSA9PSBpZHgpOw0KCQkJCQl9DQoJCQkJfWVsc2V7DQoJCQkJCWNvbmRpdGlvbiA9IGlkeDsNCgkJCQl9DQoJCQl9DQoJCQl2YXIgbmNvdW50ID0gcGkoY29uZGl0aW9uKTsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQlyZXR1cm4gKGdldE5vZGVJbmRleChlbGVtKSA9PSBuY291bnQpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCXZhciBkZWZhdWx0R2V0dGVyID0gKGQuaXNJRSkgPyBmdW5jdGlvbihjb25kKXsNCgkJdmFyIGNsYyA9IGNvbmQudG9Mb3dlckNhc2UoKTsNCgkJaWYoY2xjID09ICJjbGFzcyIpeyBjb25kID0gImNsYXNzTmFtZSI7IH0NCgkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJcmV0dXJuIChjYXNlU2Vuc2l0aXZlID8gZWxlbS5nZXRBdHRyaWJ1dGUoY29uZCkgOiBlbGVtW2NvbmRdfHxlbGVtW2NsY10pOw0KCQl9DQoJfSA6IGZ1bmN0aW9uKGNvbmQpew0KCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQlyZXR1cm4gKGVsZW0gJiYgZWxlbS5nZXRBdHRyaWJ1dGUgJiYgZWxlbS5oYXNBdHRyaWJ1dGUoY29uZCkpOw0KCQl9DQoJfTsNCg0KCXZhciBnZXRTaW1wbGVGaWx0ZXJGdW5jID0gZnVuY3Rpb24ocXVlcnksIGlnbm9yZXMpew0KCQkvLyBnZW5lcmF0ZXMgYSBub2RlIHRlc3RlciBmdW5jdGlvbiBiYXNlZCBvbiB0aGUgcGFzc2VkIHF1ZXJ5IHBhcnQuIFRoZQ0KCQkvLyBxdWVyeSBwYXJ0IGlzIG9uZSBvZiB0aGUgc3RydWN0dXJlcyBnZW5lcmF0ZCBieSB0aGUgcXVlcnkgcGFyc2VyDQoJCS8vIHdoZW4gaXQgY3JlYXRlcyB0aGUgcXVlcnkgQVNULiBUaGUgImlnbm9yZXMiIG9iamVjdCBzcGVjaWZpZXMgd2hpY2gNCgkJLy8gKGlmIGFueSkgdGVzdHMgdG8gc2tpcCwgYWxsb3dpbmcgdGhlIHN5c3RlbSB0byBhdm9pZCBkdXBsaWNhdGluZw0KCQkvLyB3b3JrIHdoZXJlIGl0IG1heSBoYXZlIGFscmVhZHkgYmVlbiB0YWtlbiBpbnRvIGFjY291bnQgYnkgb3RoZXINCgkJLy8gZmFjdG9ycyBzdWNoIGFzIGhvdyB0aGUgbm9kZXMgdG8gdGVzdCB3ZXJlIGZldGNoZWQgaW4gdGhlIGZpcnN0DQoJCS8vIHBsYWNlDQoJCWlmKCFxdWVyeSl7IHJldHVybiB5ZXNtYW47IH0NCgkJaWdub3JlcyA9IGlnbm9yZXN8fHt9Ow0KDQoJCXZhciBmZiA9IG51bGw7DQoNCgkJaWYoISgiZWwiIGluIGlnbm9yZXMpKXsNCgkJCWZmID0gYWdyZWUoZmYsIF9pc0VsZW1lbnQpOw0KCQl9DQoNCgkJaWYoISgidGFnIiBpbiBpZ25vcmVzKSl7DQoJCQlpZihxdWVyeS50YWcgIT0gIioiKXsNCgkJCQlmZiA9IGFncmVlKGZmLCBmdW5jdGlvbihlbGVtKXsNCgkJCQkJcmV0dXJuIChlbGVtICYmIChlbGVtLnRhZ05hbWUgPT0gcXVlcnkuZ2V0VGFnKCkpKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KDQoJCWlmKCEoImNsYXNzZXMiIGluIGlnbm9yZXMpKXsNCgkJCWVhY2gocXVlcnkuY2xhc3NlcywgZnVuY3Rpb24oY25hbWUsIGlkeCwgYXJyKXsNCgkJCQkvLyBnZXQgdGhlIGNsYXNzIG5hbWUNCgkJCQkvKg0KCQkJCXZhciBpc1dpbGRjYXJkID0gY25hbWUuY2hhckF0KGNuYW1lLmxlbmd0aC0xKSA9PSAiKiI7DQoJCQkJaWYoaXNXaWxkY2FyZCl7DQoJCQkJCWNuYW1lID0gY25hbWUuc3Vic3RyKDAsIGNuYW1lLmxlbmd0aC0xKTsNCgkJCQl9DQoJCQkJLy8gSSBkaXNsaWtlIHRoZSByZWdleCB0aGluZywgZXZlbiBpZiBtZW1vemllZCBpbiBhIGNhY2hlLCBidXQgaXQncyBWRVJZIHNob3J0DQoJCQkJdmFyIHJlID0gbmV3IFJlZ0V4cCgiKD86XnxcXHMpIiArIGNuYW1lICsgKGlzV2lsZGNhcmQgPyAiLioiIDogIiIpICsgIig/Olxcc3wkKSIpOw0KCQkJCSovDQoJCQkJdmFyIHJlID0gbmV3IFJlZ0V4cCgiKD86XnxcXHMpIiArIGNuYW1lICsgIig/Olxcc3wkKSIpOw0KCQkJCWZmID0gYWdyZWUoZmYsIGZ1bmN0aW9uKGVsZW0pew0KCQkJCQlyZXR1cm4gcmUudGVzdChlbGVtLmNsYXNzTmFtZSk7DQoJCQkJfSk7DQoJCQkJZmYuY291bnQgPSBpZHg7DQoJCQl9KTsNCgkJfQ0KDQoJCWlmKCEoInBzZXVkb3MiIGluIGlnbm9yZXMpKXsNCgkJCWVhY2gocXVlcnkucHNldWRvcywgZnVuY3Rpb24ocHNldWRvKXsNCgkJCQl2YXIgcG4gPSBwc2V1ZG8ubmFtZTsNCgkJCQlpZihwc2V1ZG9zW3BuXSl7DQoJCQkJCWZmID0gYWdyZWUoZmYsIHBzZXVkb3NbcG5dKHBuLCBwc2V1ZG8udmFsdWUpKTsNCgkJCQl9DQoJCQl9KTsNCgkJfQ0KDQoJCWlmKCEoImF0dHJzIiBpbiBpZ25vcmVzKSl7DQoJCQllYWNoKHF1ZXJ5LmF0dHJzLCBmdW5jdGlvbihhdHRyKXsNCgkJCQl2YXIgbWF0Y2hlcjsNCgkJCQl2YXIgYSA9IGF0dHIuYXR0cjsNCgkJCQkvLyB0eXBlLCBhdHRyLCBtYXRjaEZvcg0KCQkJCWlmKGF0dHIudHlwZSAmJiBhdHRyc1thdHRyLnR5cGVdKXsNCgkJCQkJbWF0Y2hlciA9IGF0dHJzW2F0dHIudHlwZV0oYSwgYXR0ci5tYXRjaEZvcik7DQoJCQkJfWVsc2UgaWYoYS5sZW5ndGgpew0KCQkJCQltYXRjaGVyID0gZGVmYXVsdEdldHRlcihhKTsNCgkJCQl9DQoJCQkJaWYobWF0Y2hlcil7DQoJCQkJCWZmID0gYWdyZWUoZmYsIG1hdGNoZXIpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoNCgkJaWYoISgiaWQiIGluIGlnbm9yZXMpKXsNCgkJCWlmKHF1ZXJ5LmlkKXsNCgkJCQlmZiA9IGFncmVlKGZmLCBmdW5jdGlvbihlbGVtKXsgDQoJCQkJCXJldHVybiAoISFlbGVtICYmIChlbGVtLmlkID09IHF1ZXJ5LmlkKSk7DQoJCQkJfSk7DQoJCQl9DQoJCX0NCg0KCQlpZighZmYpew0KCQkJaWYoISgiZGVmYXVsdCIgaW4gaWdub3Jlcykpew0KCQkJCWZmID0geWVzbWFuOyANCgkJCX0NCgkJfQ0KCQlyZXR1cm4gZmY7DQoJfTsNCg0KCXZhciBfbmV4dFNpYmxpbmcgPSBmdW5jdGlvbihmaWx0ZXJGdW5jKXsNCgkJcmV0dXJuIGZ1bmN0aW9uKG5vZGUsIHJldCwgYmFnKXsNCgkJCXdoaWxlKG5vZGUgPSBub2RlW19uc10pew0KCQkJCWlmKF9ub05FUyAmJiAoIV9pc0VsZW1lbnQobm9kZSkpKXsgY29udGludWU7IH0NCgkJCQlpZigNCgkJCQkJKCFiYWcgfHwgX2lzVW5pcXVlKG5vZGUsIGJhZykpICYmDQoJCQkJCWZpbHRlckZ1bmMobm9kZSkNCgkJCQkpew0KCQkJCQlyZXQucHVzaChub2RlKTsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQl9DQoJCQlyZXR1cm4gcmV0Ow0KCQl9DQoJfTsNCg0KCXZhciBfbmV4dFNpYmxpbmdzID0gZnVuY3Rpb24oZmlsdGVyRnVuYyl7DQoJCXJldHVybiBmdW5jdGlvbihyb290LCByZXQsIGJhZyl7DQoJCQl2YXIgdGUgPSByb290W19uc107DQoJCQl3aGlsZSh0ZSl7DQoJCQkJaWYoX3NpbXBsZU5vZGVUZXN0KHRlKSl7DQoJCQkJCWlmKGJhZyAmJiAhX2lzVW5pcXVlKHRlLCBiYWcpKXsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJCWlmKGZpbHRlckZ1bmModGUpKXsNCgkJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQl0ZSA9IHRlW19uc107DQoJCQl9DQoJCQlyZXR1cm4gcmV0Ow0KCQl9DQoJfTsNCg0KCS8vIGdldCBhbiBhcnJheSBvZiBjaGlsZCAqZWxlbWVudHMqLCBza2lwcGluZyB0ZXh0IGFuZCBjb21tZW50IG5vZGVzDQoJdmFyIF9jaGlsZEVsZW1lbnRzID0gZnVuY3Rpb24oZmlsdGVyRnVuYyl7DQoJCWZpbHRlckZ1bmMgPSBmaWx0ZXJGdW5jfHx5ZXNtYW47DQoJCXJldHVybiBmdW5jdGlvbihyb290LCByZXQsIGJhZyl7DQoJCQkvLyBnZXQgYW4gYXJyYXkgb2YgY2hpbGQgZWxlbWVudHMsIHNraXBwaW5nIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMNCgkJCXZhciB0ZSwgeCA9IDAsIHRyZXQgPSByb290W2NoaWxkTm9kZXNOYW1lXTsNCgkJCXdoaWxlKHRlID0gdHJldFt4KytdKXsNCgkJCQlpZigNCgkJCQkJX3NpbXBsZU5vZGVUZXN0KHRlKSAmJg0KCQkJCQkoIWJhZyB8fCBfaXNVbmlxdWUodGUsIGJhZykpICYmDQoJCQkJCShmaWx0ZXJGdW5jKHRlLCB4KSkNCgkJCQkpeyANCgkJCQkJcmV0LnB1c2godGUpOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiByZXQ7DQoJCX07DQoJfTsNCgkNCgkvKg0KCS8vIHRoYW5rcywgRGVhbiENCgl2YXIgaXRlbUlzQWZ0ZXJSb290ID0gZC5pc0lFID8gZnVuY3Rpb24oaXRlbSwgcm9vdCl7DQoJCXJldHVybiAoaXRlbS5zb3VyY2VJbmRleCA+IHJvb3Quc291cmNlSW5kZXgpOw0KCX0gOiBmdW5jdGlvbihpdGVtLCByb290KXsNCgkJcmV0dXJuIChpdGVtLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHJvb3QpID09IDIpOw0KCX07DQoJKi8NCg0KCS8vIHRlc3QgdG8gc2VlIGlmIG5vZGUgaXMgYmVsb3cgcm9vdA0KCXZhciBfaXNEZXNjZW5kYW50ID0gZnVuY3Rpb24obm9kZSwgcm9vdCl7DQoJCXZhciBwbiA9IG5vZGUucGFyZW50Tm9kZTsNCgkJd2hpbGUocG4pew0KCQkJaWYocG4gPT0gcm9vdCl7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCQlwbiA9IHBuLnBhcmVudE5vZGU7DQoJCX0NCgkJcmV0dXJuICEhcG47DQoJfTsNCg0KCXZhciBfZ2V0RWxlbWVudHNGdW5jQ2FjaGUgPSB7fTsNCg0KCXZhciBnZXRFbGVtZW50c0Z1bmMgPSBmdW5jdGlvbihxdWVyeSl7DQoJCXZhciByZXRGdW5jID0gX2dldEVsZW1lbnRzRnVuY0NhY2hlW3F1ZXJ5LnF1ZXJ5XTsNCgkJLy8gaWYgd2UndmUgZ290IGEgY2FjaGVkIGRpc3BhdGNoZXIsIGp1c3QgdXNlIHRoYXQNCgkJaWYocmV0RnVuYyl7IHJldHVybiByZXRGdW5jOyB9DQoJCS8vIGVsc2UsIGdlbmVyYXRlIGEgbmV3IG9uDQoNCgkJLy8gTk9URToNCgkJLy8JCXRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgc2VhcmNoZXMgZm9yIG5vZGVzIGFuZA0KCQkvLwkJZmlsdGVycyB0aGVtLiAgVGhlIHNlYXJjaCBtYXkgYmUgc3BlY2lhbGl6ZWQgYnkgaW5maXggb3BlcmF0b3JzDQoJCS8vCQkoIj4iLCAifiIsIG9yICIrIikgZWxzZSBpdCB3aWxsIGRlZmF1bHQgdG8gc2VhcmNoaW5nIGFsbA0KCQkvLwkJZGVzY2VuZGFudHMgKHRoZSAiICIgc2VsZWN0b3IpLiBPbmNlIGEgZ3JvdXAgb2YgY2hpbGRyZW4gaXMNCgkJLy8JCWZvdW5kZSwgYSB0ZXN0IGZ1bmN0aW9uIGlzIGFwcGxpZWQgdG8gd2VlZCBvdXQgdGhlIG9uZXMgd2UNCgkJLy8JCWRvbid0IHdhbnQuIE1hbnkgY29tbW9uIGNhc2VzIGNhbiBiZSBmYXN0LXBhdGhlZC4gV2Ugc3BlbmQgYQ0KCQkvLwkJbG90IG9mIGN5Y2xlcyB0byBjcmVhdGUgYSBkaXNwYXRjaGVyIHRoYXQgZG9lc24ndCBkbyBtb3JlIHdvcmsNCgkJLy8JCXRoYW4gbmVjZXNzYXJ5IGF0IGFueSBwb2ludCBzaW5jZSwgdW5saWtlIHRoaXMgZnVuY3Rpb24sIHRoZQ0KCQkvLwkJZGlzcGF0Y2hlcnMgd2lsbCBiZSBjYWxsZWQgZXZlcnkgdGltZS4gVGhlIGxvZ2ljIG9mIGdlbmVyYXRpbmcNCgkJLy8JCWVmZmljaWVudCBkaXNwYXRjaGVycyBsb29rcyBsaWtlIHRoaXMgaW4gcHNldWRvIGNvZGU6DQoJCS8vDQoJCS8vCQkjIGlmIGl0J3MgYSBwdXJlbHkgZGVzY2VuZGFudCBxdWVyeSAobm8gIj4iLCAiKyIsIG9yICJ+IiBtb2RpZmllcnMpDQoJCS8vCQlpZiBpbmZpeE9wZXJhdG9yID09ICIgIjoNCgkJLy8JCQlpZiBvbmx5KGlkKToNCgkJLy8JCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJCXJldHVybiBkLmJ5SWQoaWQsIHJvb3QpOw0KCQkvLw0KCQkvLwkJCWVsaWYgaWQ6DQoJCS8vCQkJCXJldHVybiBkZWYocm9vdCk6DQoJCS8vCQkJCQlyZXR1cm4gZmlsdGVyKGQuYnlJZChpZCwgcm9vdCkpOw0KCQkvLw0KCQkvLwkJCWVsaWYgY3NzQ2xhc3MgJiYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZToNCgkJLy8JCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJCXJldHVybiBmaWx0ZXIocm9vdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNzc0NsYXNzKSk7DQoJCS8vDQoJCS8vCQkJZWxpZiBvbmx5KHRhZyk6DQoJCS8vCQkJCXJldHVybiBkZWYocm9vdCk6DQoJCS8vCQkJCQlyZXR1cm4gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKTsNCgkJLy8NCgkJLy8JCQllbHNlOg0KCQkvLwkJCQkjIHNlYXJjaCBieSB0YWcgbmFtZSwgdGhlbiBmaWx0ZXINCgkJLy8JCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJCXJldHVybiBmaWx0ZXIocm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lfHwiKiIpKTsNCgkJLy8NCgkJLy8JCWVsaWYgaW5maXhPcGVyYXRvciA9PSAiPiI6DQoJCS8vCQkJIyBzZWFyY2ggZGlyZWN0IGNoaWxkcmVuDQoJCS8vCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJcmV0dXJuIGZpbHRlcihyb290LmNoaWxkcmVuKTsNCgkJLy8NCgkJLy8JCWVsaWYgaW5maXhPcGVyYXRvciA9PSAiKyI6DQoJCS8vCQkJIyBzZWFyY2ggbmV4dCBzaWJsaW5nDQoJCS8vCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJcmV0dXJuIGZpbHRlcihyb290Lm5leHRFbGVtZW50U2libGluZyk7DQoJCS8vDQoJCS8vCQllbGlmIGluZml4T3BlcmF0b3IgPT0gIn4iOg0KCQkvLwkJCSMgc2VhcmNoIHJpZ2h0d2FyZCBzaWJsaW5ncw0KCQkvLwkJCXJldHVybiBkZWYocm9vdCk6DQoJCS8vCQkJCXJldHVybiBmaWx0ZXIobmV4dFNpYmxpbmdzKHJvb3QpKTsNCg0KCQl2YXIgaW8gPSBxdWVyeS5pbmZpeE9wZXI7DQoJCXZhciBvcGVyID0gKGlvID8gaW8ub3BlciA6ICIiKTsNCgkJLy8gdGhlIGRlZmF1bHQgZmlsdGVyIGZ1bmMgd2hpY2ggdGVzdHMgZm9yIGFsbCBjb25kaXRpb25zIGluIHRoZSBxdWVyeQ0KCQkvLyBwYXJ0LiBUaGlzIGlzIHBvdGVudGlhbGx5IGluZWZmaWNpZW50LCBzbyBzb21lIG9wdGltaXplZCBwYXRocyBtYXkNCgkJLy8gcmUtZGVmaW5lIGl0IHRvIHRlc3QgZmV3ZXIgdGhpbmdzLg0KCQl2YXIgZmlsdGVyRnVuYyA9IGdldFNpbXBsZUZpbHRlckZ1bmMocXVlcnksIHsgZWw6IDEgfSk7DQoJCXZhciBxdCA9IHF1ZXJ5LnRhZzsNCgkJdmFyIHdpbGRjYXJkVGFnID0gKCIqIiA9PSBxdCk7DQoJCXZhciBlY3MgPSBnZXREb2MoKVsiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSJdOyANCg0KCQlpZighb3Blcil7DQoJCQkvLyBpZiB0aGVyZSdzIG5vIGluZml4IG9wZXJhdG9yLCB0aGVuIGl0J3MgYSBkZXNjZW5kYW50IHF1ZXJ5LiBJRA0KCQkJLy8gYW5kICJlbGVtZW50cyBieSBjbGFzcyBuYW1lIiB2YXJpYW50cyBjYW4gYmUgYWNjZWxlcmF0ZWQgc28gd2UNCgkJCS8vIGNhbGwgdGhlbSBvdXQgZXhwbGljaXRseToNCgkJCWlmKHF1ZXJ5LmlkKXsNCgkJCQkvLyB0ZXN0aW5nIHNob3dzIHRoYXQgdGhlIG92ZXJoZWFkIG9mIHllc21hbigpIGlzIGFjY2VwdGFibGUNCgkJCQkvLyBhbmQgY2FuIHNhdmUgdXMgc29tZSBieXRlcyB2cy4gcmUtZGVmaW5pbmcgdGhlIGZ1bmN0aW9uDQoJCQkJLy8gZXZlcnl3aGVyZS4NCgkJCQlmaWx0ZXJGdW5jID0gKCFxdWVyeS5sb29wcyAmJiB3aWxkY2FyZFRhZykgPyANCgkJCQkJeWVzbWFuIDogDQoJCQkJCWdldFNpbXBsZUZpbHRlckZ1bmMocXVlcnksIHsgZWw6IDEsIGlkOiAxIH0pOw0KDQoJCQkJcmV0RnVuYyA9IGZ1bmN0aW9uKHJvb3QsIGFycil7DQoJCQkJCXZhciB0ZSA9IGQuYnlJZChxdWVyeS5pZCwgKHJvb3Qub3duZXJEb2N1bWVudHx8cm9vdCkpOw0KCQkJCQlpZighdGUgfHwgIWZpbHRlckZ1bmModGUpKXsgcmV0dXJuOyB9DQoJCQkJCWlmKDkgPT0gcm9vdC5ub2RlVHlwZSl7IC8vIGlmIHJvb3QncyBhIGRvYywgd2UganVzdCByZXR1cm4gZGlyZWN0bHkNCgkJCQkJCXJldHVybiBnZXRBcnIodGUsIGFycik7DQoJCQkJCX1lbHNleyAvLyBvdGhlcndpc2UgY2hlY2sgYW5jZXN0cnkNCgkJCQkJCWlmKF9pc0Rlc2NlbmRhbnQodGUsIHJvb3QpKXsNCgkJCQkJCQlyZXR1cm4gZ2V0QXJyKHRlLCBhcnIpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfWVsc2UgaWYoDQoJCQkJZWNzICYmIA0KCQkJCS8vIGlzQWxpZW4gY2hlY2suIFdvcmthcm91bmQgZm9yIFByb3RvdHlwZS5qcyBiZWluZyB0b3RhbGx5IGV2aWwvZHVtYi4NCgkJCQkvXHtccypcW25hdGl2ZSBjb2RlXF1ccypcfS8udGVzdChTdHJpbmcoZWNzKSkgJiYgDQoJCQkJcXVlcnkuY2xhc3Nlcy5sZW5ndGggJiYNCgkJCQkhY3NzQ2FzZUJ1Zw0KCQkJKXsNCgkJCQkvLyBpdCdzIGEgY2xhc3MtYmFzZWQgcXVlcnkgYW5kIHdlJ3ZlIGdvdCBhIGZhc3Qgd2F5IHRvIHJ1biBpdC4NCg0KCQkJCS8vIGlnbm9yZSBjbGFzcyBhbmQgSUQgZmlsdGVycyBzaW5jZSB3ZSB3aWxsIGhhdmUgaGFuZGxlZCBib3RoDQoJCQkJZmlsdGVyRnVuYyA9IGdldFNpbXBsZUZpbHRlckZ1bmMocXVlcnksIHsgZWw6IDEsIGNsYXNzZXM6IDEsIGlkOiAxIH0pOw0KCQkJCXZhciBjbGFzc2VzU3RyaW5nID0gcXVlcnkuY2xhc3Nlcy5qb2luKCIgIik7DQoJCQkJcmV0RnVuYyA9IGZ1bmN0aW9uKHJvb3QsIGFyciwgYmFnKXsNCgkJCQkJdmFyIHJldCA9IGdldEFycigwLCBhcnIpLCB0ZSwgeD0wOw0KCQkJCQl2YXIgdHJldCA9IHJvb3QuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc2VzU3RyaW5nKTsNCgkJCQkJd2hpbGUoKHRlID0gdHJldFt4KytdKSl7DQoJCQkJCQlpZihmaWx0ZXJGdW5jKHRlLCByb290KSAmJiBfaXNVbmlxdWUodGUsIGJhZykpew0KCQkJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gcmV0Ow0KCQkJCX07DQoNCgkJCX1lbHNlIGlmKCF3aWxkY2FyZFRhZyAmJiAhcXVlcnkubG9vcHMpew0KCQkJCS8vIGl0J3MgdGFnIG9ubHkuIEZhc3QtcGF0aCBpdC4NCgkJCQlyZXRGdW5jID0gZnVuY3Rpb24ocm9vdCwgYXJyLCBiYWcpew0KCQkJCQl2YXIgcmV0ID0gZ2V0QXJyKDAsIGFyciksIHRlLCB4PTA7DQoJCQkJCXZhciB0cmV0ID0gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZShxdWVyeS5nZXRUYWcoKSk7DQoJCQkJCXdoaWxlKCh0ZSA9IHRyZXRbeCsrXSkpew0KCQkJCQkJaWYoX2lzVW5pcXVlKHRlLCBiYWcpKXsNCgkJCQkJCQlyZXQucHVzaCh0ZSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIHJldDsNCgkJCQl9Ow0KCQkJfWVsc2V7DQoJCQkJLy8gdGhlIGNvbW1vbiBjYXNlOg0KCQkJCS8vCQlhIGRlc2NlbmRhbnQgc2VsZWN0b3Igd2l0aG91dCBhIGZhc3QgcGF0aC4gQnkgbm93IGl0J3MgZ290DQoJCQkJLy8JCXRvIGhhdmUgYSB0YWcgc2VsZWN0b3IsIGV2ZW4gaWYgaXQncyBqdXN0ICIqIiBzbyB3ZSBxdWVyeQ0KCQkJCS8vCQlieSB0aGF0IGFuZCBmaWx0ZXINCgkJCQlmaWx0ZXJGdW5jID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhxdWVyeSwgeyBlbDogMSwgdGFnOiAxLCBpZDogMSB9KTsNCgkJCQlyZXRGdW5jID0gZnVuY3Rpb24ocm9vdCwgYXJyLCBiYWcpew0KCQkJCQl2YXIgcmV0ID0gZ2V0QXJyKDAsIGFyciksIHRlLCB4PTA7DQoJCQkJCS8vIHdlIHVzZSBnZXRUYWcoKSB0byBhdm9pZCBjYXNlIHNlbnNpdGl2aXR5IGlzc3Vlcw0KCQkJCQl2YXIgdHJldCA9IHJvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUocXVlcnkuZ2V0VGFnKCkpOw0KCQkJCQl3aGlsZSgodGUgPSB0cmV0W3grK10pKXsNCgkJCQkJCWlmKGZpbHRlckZ1bmModGUsIHJvb3QpICYmIF9pc1VuaXF1ZSh0ZSwgYmFnKSl7DQoJCQkJCQkJcmV0LnB1c2godGUpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfTsNCgkJCX0NCgkJfWVsc2V7DQoJCQkvLyB0aGUgcXVlcnkgaXMgc2NvcGVkIGluIHNvbWUgd2F5LiBJbnN0ZWFkIG9mIHF1ZXJ5aW5nIGJ5IHRhZyB3ZQ0KCQkJLy8gdXNlIHNvbWUgb3RoZXIgY29sbGVjdGlvbiB0byBmaW5kIGNhbmRpZGF0ZSBub2Rlcw0KCQkJdmFyIHNraXBGaWx0ZXJzID0geyBlbDogMSB9Ow0KCQkJaWYod2lsZGNhcmRUYWcpew0KCQkJCXNraXBGaWx0ZXJzLnRhZyA9IDE7DQoJCQl9DQoJCQlmaWx0ZXJGdW5jID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhxdWVyeSwgc2tpcEZpbHRlcnMpOw0KCQkJaWYoIisiID09IG9wZXIpew0KCQkJCXJldEZ1bmMgPSBfbmV4dFNpYmxpbmcoZmlsdGVyRnVuYyk7DQoJCQl9ZWxzZSBpZigifiIgPT0gb3Blcil7DQoJCQkJcmV0RnVuYyA9IF9uZXh0U2libGluZ3MoZmlsdGVyRnVuYyk7DQoJCQl9ZWxzZSBpZigiPiIgPT0gb3Blcil7DQoJCQkJcmV0RnVuYyA9IF9jaGlsZEVsZW1lbnRzKGZpbHRlckZ1bmMpOw0KCQkJfQ0KCQl9DQoJCS8vIGNhY2hlIGl0IGFuZCByZXR1cm4NCgkJcmV0dXJuIF9nZXRFbGVtZW50c0Z1bmNDYWNoZVtxdWVyeS5xdWVyeV0gPSByZXRGdW5jOw0KCX07DQoNCgl2YXIgZmlsdGVyRG93biA9IGZ1bmN0aW9uKHJvb3QsIHF1ZXJ5UGFydHMpew0KCQkvLyBOT1RFOg0KCQkvLwkJdGhpcyBpcyB0aGUgZ3V0cyBvZiB0aGUgRE9NIHF1ZXJ5IHN5c3RlbS4gSXQgdGFrZXMgYSBsaXN0IG9mDQoJCS8vCQlwYXJzZWQgcXVlcnkgcGFydHMgYW5kIGEgcm9vdCBhbmQgZmluZHMgY2hpbGRyZW4gd2hpY2ggbWF0Y2gNCgkJLy8JCXRoZSBzZWxlY3RvciByZXByZXNlbnRlZCBieSB0aGUgcGFydHMNCgkJdmFyIGNhbmRpZGF0ZXMgPSBnZXRBcnIocm9vdCksIHFwLCB4LCB0ZSwgcXBsID0gcXVlcnlQYXJ0cy5sZW5ndGgsIGJhZywgcmV0Ow0KDQoJCWZvcih2YXIgaSA9IDA7IGkgPCBxcGw7IGkrKyl7DQoJCQlyZXQgPSBbXTsNCgkJCXFwID0gcXVlcnlQYXJ0c1tpXTsNCgkJCXggPSBjYW5kaWRhdGVzLmxlbmd0aCAtIDE7DQoJCQlpZih4ID4gMCl7DQoJCQkJLy8gaWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIHJvb3QgYXQgdGhpcyBsZXZlbCwgcHJvdmlkZSBhIG5ldw0KCQkJCS8vIGhhc2ggdG8gdXNlIGZvciBjaGVja2luZyBncm91cCBtZW1iZXJzaGlwIGJ1dCB0ZWxsIHRoZQ0KCQkJCS8vIHN5c3RlbSBub3QgdG8gcG9zdC1maWx0ZXIgdXMgc2luY2Ugd2Ugd2lsbCBhbHJlYWR5IGhhdmUgYmVlbg0KCQkJCS8vIGdhdXJhbnRlZWQgdG8gYmUgdW5pcXVlDQoJCQkJYmFnID0ge307DQoJCQkJcmV0Lm5vemlwID0gdHJ1ZTsNCgkJCX0NCgkJCXZhciBnZWYgPSBnZXRFbGVtZW50c0Z1bmMocXApOw0KCQkJZm9yKHZhciBqID0gMDsgKHRlID0gY2FuZGlkYXRlc1tqXSk7IGorKyl7DQoJCQkJLy8gZm9yIGV2ZXJ5IHJvb3QsIGdldCB0aGUgZWxlbWVudHMgdGhhdCBtYXRjaCB0aGUgZGVzY2VuZGFudA0KCQkJCS8vIHNlbGVjdG9yLCBhZGRpbmcgdGhlbSB0byB0aGUgInJldCIgYXJyYXkgYW5kIGZpbHRlcmluZyB0aGVtDQoJCQkJLy8gdmlhIG1lbWJlcnNoaXAgaW4gdGhpcyBsZXZlbCdzIGJhZy4gSWYgdGhlcmUgYXJlIG1vcmUgcXVlcnkNCgkJCQkvLyBwYXJ0cywgdGhlbiB0aGlzIGxldmVsJ3MgcmV0dXJuIHdpbGwgYmUgdXNlZCBhcyB0aGUgbmV4dA0KCQkJCS8vIGxldmVsJ3MgY2FuZGlkYXRlcw0KCQkJCWdlZih0ZSwgcmV0LCBiYWcpOw0KCQkJfQ0KCQkJaWYoIXJldC5sZW5ndGgpeyBicmVhazsgfQ0KCQkJY2FuZGlkYXRlcyA9IHJldDsNCgkJfQ0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCgkvLyB0aGUgcXVlcnkgcnVubmVyDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCgkvLyB0aGVzZSBhcmUgdGhlIHByaW1hcnkgY2FjaGVzIGZvciBmdWxsLXF1ZXJ5IHJlc3VsdHMuIFRoZSBxdWVyeQ0KCS8vIGRpc3BhdGNoZXIgZnVuY3Rpb25zIGFyZSBnZW5lcmF0ZWQgdGhlbiBzdG9yZWQgaGVyZSBmb3IgaGFzaCBsb29rdXAgaW4NCgkvLyB0aGUgZnV0dXJlDQoJdmFyIF9xdWVyeUZ1bmNDYWNoZURPTSA9IHt9LA0KCQlfcXVlcnlGdW5jQ2FjaGVRU0EgPSB7fTsNCg0KCS8vIHRoaXMgaXMgdGhlIHNlY29uZCBsZXZlbCBvZiBzcGxpdGluZywgZnJvbSBmdWxsLWxlbmd0aCBxdWVyaWVzIChlLmcuLA0KCS8vICJkaXYuZm9vIC5iYXIiKSBpbnRvIHNpbXBsZSBxdWVyeSBleHByZXNzaW9ucyAoZS5nLiwgWyJkaXYuZm9vIiwNCgkvLyAiLmJhciJdKQ0KCXZhciBnZXRTdGVwUXVlcnlGdW5jID0gZnVuY3Rpb24ocXVlcnkpew0KCQl2YXIgcXBhcnRzID0gZ2V0UXVlcnlQYXJ0cyh0cmltKHF1ZXJ5KSk7DQoNCgkJLy8gaWYgaXQncyB0cml2aWFsLCBhdm9pZCBpdGVyYXRpb24gYW5kIHppcHBpbmcgY29zdHMNCgkJaWYocXBhcnRzLmxlbmd0aCA9PSAxKXsNCgkJCS8vIHdlIG9wdGltaXplIHRoaXMgY2FzZSBoZXJlIHRvIHByZXZlbnQgZGlzcGF0Y2ggZnVydGhlciBkb3duIHRoZQ0KCQkJLy8gY2hhaW4sIHBvdGVudGlhbGx5IHNsb3dpbmcgdGhpbmdzIGRvd24uIFdlIGNvdWxkIG1vcmUgZWxlZ2FudGx5DQoJCQkvLyBoYW5kbGUgdGhpcyBpbiBmaWx0ZXJEb3duKCksIGJ1dCBpdCdzIHNsb3dlciBmb3Igc2ltcGxlIHRoaW5ncw0KCQkJLy8gdGhhdCBuZWVkIHRvIGJlIGZhc3QgKGUuZy4sICIjc29tZUlkIikuDQoJCQl2YXIgdGVmID0gZ2V0RWxlbWVudHNGdW5jKHFwYXJ0c1swXSk7DQoJCQlyZXR1cm4gZnVuY3Rpb24ocm9vdCl7DQoJCQkJdmFyIHIgPSB0ZWYocm9vdCwgbmV3IHFsYygpKTsNCgkJCQlpZihyKXsgci5ub3ppcCA9IHRydWU7IH0NCgkJCQlyZXR1cm4gcjsNCgkJCX0NCgkJfQ0KDQoJCS8vIG90aGVyd2lzZSwgYnJlYWsgaXQgdXAgYW5kIHJldHVybiBhIHJ1bm5lciB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhlIHBhcnRzIHJlY3Vyc2l2ZWx5DQoJCXJldHVybiBmdW5jdGlvbihyb290KXsNCgkJCXJldHVybiBmaWx0ZXJEb3duKHJvb3QsIHFwYXJ0cyk7DQoJCX0NCgl9Ow0KDQoJLy8gTk9URVM6DQoJLy8JKiB3ZSBjYW4ndCB0cnVzdCBRU0EgZm9yIGFueXRoaW5nIGJ1dCBkb2N1bWVudC1yb290ZWQgcXVlcmllcywgc28NCgkvLwkgIGNhY2hpbmcgaXMgc3BsaXQgaW50byBET00gcXVlcnkgZXZhbHVhdG9ycyBhbmQgUVNBIHF1ZXJ5IGV2YWx1YXRvcnMNCgkvLwkqIGNhY2hpbmcgcXVlcnkgcmVzdWx0cyBpcyBkaXJ0eSBhbmQgbGVhay1wcm9uZSAob3IsIGF0IGEgbWluaW11bSwNCgkvLwkgIHByb25lIHRvIHVuYm91bmRlZCBncm93dGgpLiBPdGhlciB0b29sa2l0cyBtYXkgZ28gdGhpcyByb3V0ZSwgYnV0DQoJLy8JICB0aGV5IHRvdGFsbHkgZGVzdHJveSB0aGVpciBvd24gYWJpbGl0eSB0byBtYW5hZ2UgdGhlaXIgbWVtb3J5DQoJLy8JICBmb290cHJpbnQuIElmIHdlIGltcGxlbWVudCBpdCwgaXQgc2hvdWxkIG9ubHkgZXZlciBiZSB3aXRoIGEgZml4ZWQNCgkvLwkgIHRvdGFsIGVsZW1lbnQgcmVmZXJlbmNlICMgbGltaXQgYW5kIGFuIExSVS1zdHlsZSBhbGdvcml0aG0gc2luY2UgSlMNCgkvLwkgIGhhcyBubyB3ZWFrcmVmIHN1cHBvcnQuIENhY2hpbmcgY29tcGlsZWQgcXVlcnkgZXZhbHVhdG9ycyBpcyBhbHNvDQoJLy8JICBwb3RlbnRpYWxseSBwcm9ibGVtYXRpYywgYnV0IGV2ZW4gb24gbGFyZ2UgZG9jdW1lbnRzIHRoZSBzaXplIG9mIHRoZQ0KCS8vCSAgcXVlcnkgZXZhbHVhdG9ycyBpcyBvZnRlbiA8IDEwMCBmdW5jdGlvbiBvYmplY3RzIHBlciBldmFsdWF0b3IgKGFuZA0KCS8vCSAgTFJVIGNhbiBiZSBhcHBsaWVkIGlmIGl0J3MgZXZlciBzaG93biB0byBiZSBhbiBpc3N1ZSkuDQoJLy8JKiBzaW5jZSBJRSdzIFFTQSBzdXBwb3J0IGlzIGN1cnJlbnRseSBvbmx5IGZvciBIVE1MIGRvY3VtZW50cyBhbmQgZXZlbg0KCS8vCSAgdGhlbiBvbmx5IGluIElFIDgncyAic3RhbmRhcmRzIG1vZGUiLCB3ZSBoYXZlIHRvIGRldGVjdCBvdXIgZGlzcGF0Y2gNCgkvLwkgIHJvdXRlIGF0IHF1ZXJ5IHRpbWUgYW5kIGtlZXAgMiBzZXBhcmF0ZSBjYWNoZXMuIFVnZy4NCg0KCS8vIHdlIG5lZWQgdG8gZGV0ZXJtaW5lIGlmIHdlIHRoaW5rIHdlIGNhbiBydW4gYSBnaXZlbiBxdWVyeSB2aWENCgkvLyBxdWVyeVNlbGVjdG9yQWxsIG9yIGlmIHdlJ2xsIG5lZWQgdG8gZmFsbCBiYWNrIG9uIERPTSBxdWVyaWVzIHRvIGdldA0KCS8vIHRoZXJlLiBXZSBuZWVkIGEgbG90IG9mIGluZm9ybWF0aW9uIGFib3V0IHRoZSBlbnZpcm9ubWVudCBhbmQgdGhlIHF1ZXJ5DQoJLy8gdG8gbWFrZSB0aGUgZGV0ZXJtaW5pYXRpb24gKGUuZy4gZG9lcyBpdCBzdXBwb3J0IFFTQSwgZG9lcyB0aGUgcXVlcnkgaW4NCgkvLyBxdWVzdGlvbiB3b3JrIGluIHRoZSBuYXRpdmUgUVNBIGltcGwsIGV0Yy4pLg0KCXZhciBudWEgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KCS8vIHNvbWUgdmVyc2lvbnMgb2YgU2FmYXJpIHByb3ZpZGVkIFFTQSwgYnV0IGl0IHdhcyBidWdneSBhbmQgY3Jhc2gtcHJvbmUuDQoJLy8gV2UgbmVlZCB0ZSBkZXRlY3QgdGhlIHJpZ2h0ICJpbnRlcm5hbCIgd2Via2l0IHZlcnNpb24gdG8gbWFrZSB0aGlzIHdvcmsuDQoJdmFyIHdrID0gIldlYktpdC8iOw0KCXZhciBpczUyNSA9ICgNCgkJZC5pc1dlYktpdCAmJiANCgkJKG51YS5pbmRleE9mKHdrKSA+IDApICYmIA0KCQkocGFyc2VGbG9hdChudWEuc3BsaXQod2spWzFdKSA+IDUyOCkNCgkpOw0KDQoJLy8gSUUgUVNBIHF1ZXJpZXMgbWF5IGluY29ycmVjdGx5IGluY2x1ZGUgY29tbWVudCBub2Rlcywgc28gd2UgdGhyb3cgdGhlDQoJLy8gemlwcGluZyBmdW5jdGlvbiBpbnRvICJyZW1vdmUiIGNvbW1lbnRzIG1vZGUgaW5zdGVhZCBvZiB0aGUgbm9ybWFsICJza2lwDQoJLy8gaXQiIHdoaWNoIGV2ZXJ5IG90aGVyIFFTQS1jbHVlZCBicm93c2VyIGVuam95cw0KCXZhciBub1ppcCA9IGQuaXNJRSA/ICJjb21tZW50U3RyaXAiIDogIm5vemlwIjsNCg0KCXZhciBxc2EgPSAicXVlcnlTZWxlY3RvckFsbCI7DQoJdmFyIHFzYUF2YWlsID0gKA0KCQkhIWdldERvYygpW3FzYV0gJiYgDQoJCS8vIHNlZSAjNTgzMg0KCQkoIWQuaXNTYWZhcmkgfHwgKGQuaXNTYWZhcmkgPiAzLjEpIHx8IGlzNTI1ICkNCgkpOw0KDQoJLy9Eb24ndCBib3RoZXIgd2l0aCBuKzMgdHlwZSBvZiBtYXRjaGVzLCBJRSBjb21wbGFpbnMgaWYgd2UgbW9kaWZ5IHRob3NlLg0KCXZhciBpbmZpeFNwYWNlUmUgPSAvblwrXGR8KFteIF0pPyhbPn4rXSkoW14gPV0pPy9nOw0KCXZhciBpbmZpeFNwYWNlRnVuYyA9IGZ1bmN0aW9uKG1hdGNoLCBwcmUsIGNoLCBwb3N0KSB7DQoJCXJldHVybiBjaCA/IChwcmUgPyBwcmUgKyAiICIgOiAiIikgKyBjaCArIChwb3N0ID8gIiAiICsgcG9zdCA6ICIiKSA6IC8qbiszKi8gbWF0Y2g7DQoJfTsNCg0KCXZhciBnZXRRdWVyeUZ1bmMgPSBmdW5jdGlvbihxdWVyeSwgZm9yY2VET00pew0KCQkvL05vcm1hbGl6ZSBxdWVyeS4gVGhlIENTUzMgc2VsZWN0b3JzIHNwZWMgYWxsb3dzIGZvciBvbWl0dGluZyBzcGFjZXMgYXJvdW5kDQoJCS8vaW5maXggb3BlcmF0b3JzLCA+LCB+IGFuZCArDQoJCS8vRG8gdGhlIHdvcmsgaGVyZSBzaW5jZSBkZXRlY3Rpb24gZm9yIHNwYWNlcyBpcyB1c2VkIGFzIGEgc2ltcGxlICJub3QgdXNlIFFTQSINCgkJLy90ZXN0IGJlbG93Lg0KCQlxdWVyeSA9IHF1ZXJ5LnJlcGxhY2UoaW5maXhTcGFjZVJlLCBpbmZpeFNwYWNlRnVuYyk7DQoNCgkJaWYocXNhQXZhaWwpew0KCQkJLy8gaWYgd2UndmUgZ290IGEgY2FjaGVkIHZhcmlhbnQgYW5kIHdlIHRoaW5rIHdlIGNhbiBkbyBpdCwgcnVuIGl0IQ0KCQkJdmFyIHFzYUNhY2hlZCA9IF9xdWVyeUZ1bmNDYWNoZVFTQVtxdWVyeV07DQoJCQlpZihxc2FDYWNoZWQgJiYgIWZvcmNlRE9NKXsgcmV0dXJuIHFzYUNhY2hlZDsgfQ0KCQl9DQoNCgkJLy8gZWxzZSBpZiB3ZSd2ZSBnb3QgYSBET00gY2FjaGVkIHZhcmlhbnQsIGFzc3VtZSB0aGF0IHdlIGFscmVhZHkga25vdw0KCQkvLyBhbGwgd2UgbmVlZCB0byBhbmQgdXNlIGl0DQoJCXZhciBkb21DYWNoZWQgPSBfcXVlcnlGdW5jQ2FjaGVET01bcXVlcnldOw0KCQlpZihkb21DYWNoZWQpeyByZXR1cm4gZG9tQ2FjaGVkOyB9DQoNCgkJLy8gVE9ETzogDQoJCS8vCQl0b2RheSB3ZSdyZSBjYWNoaW5nIERPTSBhbmQgUVNBIGJyYW5jaGVzIHNlcGFyYXRlbHkgc28gd2UNCgkJLy8JCXJlY2FsYyB1c2VRU0EgZXZlcnkgdGltZS4gSWYgd2UgaGFkIGEgd2F5IHRvIHRhZyByb290K3F1ZXJ5DQoJCS8vCQllZmZpY2llbnRseSwgd2UnZCBiZSBpbiBnb29kIHNoYXBlIHRvIGRvIGEgZ2xvYmFsIGNhY2hlLg0KDQoJCXZhciBxY3ogPSBxdWVyeS5jaGFyQXQoMCk7DQoJCXZhciBub3NwYWNlID0gKC0xID09IHF1ZXJ5LmluZGV4T2YoIiAiKSk7DQoNCgkJLy8gYnlJZCBzZWFyY2hlcyBhcmUgd2lja2VkIGZhc3QgY29tcGFyZWQgdG8gUVNBLCBldmVuIHdoZW4gZmlsdGVyaW5nDQoJCS8vIGlzIHJlcXVpcmVkDQoJCWlmKCAocXVlcnkuaW5kZXhPZigiIyIpID49IDApICYmIChub3NwYWNlKSApew0KCQkJZm9yY2VET00gPSB0cnVlOw0KCQl9DQoNCgkJdmFyIHVzZVFTQSA9ICggDQoJCQlxc2FBdmFpbCAmJiAoIWZvcmNlRE9NKSAmJg0KCQkJLy8gYXMgcGVyIENTUyAzLCB3ZSBjYW4ndCBjdXJyZW50bHkgc3RhcnQgdy8gY29tYmluYXRvcjoNCgkJCS8vCQlodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jdzNjc2VsZ3JhbW1hcg0KCQkJKHNwZWNpYWxzLmluZGV4T2YocWN6KSA9PSAtMSkgJiYgDQoJCQkvLyBJRSdzIFFTQSBpbXBsIHN1Y2tzIG9uIHBzZXVkb3MNCgkJCSghZC5pc0lFIHx8IChxdWVyeS5pbmRleE9mKCI6IikgPT0gLTEpKSAmJg0KDQoJCQkoIShjc3NDYXNlQnVnICYmIChxdWVyeS5pbmRleE9mKCIuIikgPj0gMCkpKSAmJg0KDQoJCQkvLyBGSVhNRToNCgkJCS8vCQluZWVkIHRvIHRpZ2h0ZW4gdXAgYnJvd3NlciBydWxlcyBvbiAiOmNvbnRhaW5zIiBhbmQgInw9IiB0bw0KCQkJLy8JCWZpZ3VyZSBvdXQgd2hpY2ggYXJlbid0IGdvb2QNCgkJCS8vCQlMYXRlc3Qgd2Via2l0IChhcm91bmQgNTMxLjIxLjgpIGRvZXMgbm90IHNlZW0gdG8gZG8gd2VsbCB3aXRoIDpjaGVja2VkIG9uIG9wdGlvbg0KCQkJLy8JCWVsZW1lbnRzLCBldmVuIHRob3VnaCBhY2NvcmRpbmcgdG8gc3BlYywgc2VsZWN0ZWQgb3B0aW9ucyBzaG91bGQNCgkJCS8vCQltYXRjaCA6Y2hlY2tlZC4gU28gZ28gbm9uUVNBIGZvciBpdDoNCgkJCS8vCQlodHRwOi8vYnVncy5kb2pvdG9vbGtpdC5vcmcvdGlja2V0LzUxNzkNCgkJCShxdWVyeS5pbmRleE9mKCI6Y29udGFpbnMiKSA9PSAtMSkgJiYgKHF1ZXJ5LmluZGV4T2YoIjpjaGVja2VkIikgPT0gLTEpICYmIA0KCQkJKHF1ZXJ5LmluZGV4T2YoInw9IikgPT0gLTEpIC8vIHNvbWUgYnJvd3NlcnMgZG9uJ3QgZ3JvayBpdA0KCQkpOw0KDQoJCS8vIFRPRE86IA0KCQkvLwkJaWYgd2UndmUgZ290IGEgZGVzY2VuZGFudCBxdWVyeSAoZS5nLiwgIj4gLnRoaW5nZXIiIGluc3RlYWQgb2YNCgkJLy8JCWp1c3QgIi50aGluZ2VyIikgaW4gYSBRU0EtYWJsZSBkb2MsIGJ1dCBhcmUgcGFzc2VkIGEgY2hpbGQgYXMgYQ0KCQkvLwkJcm9vdCwgaXQgc2hvdWxkIGJlIHBvc3NpYmxlIHRvIGdpdmUgdGhlIGl0ZW0gYSBzeW50aGV0aWMgSUQgYW5kDQoJCS8vCQl0cml2aWFsbHkgcmV3cml0ZSB0aGUgcXVlcnkgdG8gdGhlIGZvcm0gIiNzeW5pZCA+IC50aGluZ2VyIiB0bw0KCQkvLwkJdXNlIHRoZSBRU0EgYnJhbmNoDQoNCg0KCQlpZih1c2VRU0Epew0KCQkJdmFyIHRxID0gKHNwZWNpYWxzLmluZGV4T2YocXVlcnkuY2hhckF0KHF1ZXJ5Lmxlbmd0aC0xKSkgPj0gMCkgPyANCgkJCQkJCShxdWVyeSArICIgKiIpIDogcXVlcnk7DQoJCQlyZXR1cm4gX3F1ZXJ5RnVuY0NhY2hlUVNBW3F1ZXJ5XSA9IGZ1bmN0aW9uKHJvb3Qpew0KCQkJCXRyeXsNCgkJCQkJLy8gdGhlIFFTQSBzeXN0ZW0gY29udGFpbnMgYW4gZWdyZWdpb3VzIHNwZWMgYnVnIHdoaWNoDQoJCQkJCS8vIGxpbWl0cyB1cywgZWZmZWN0aXZlbHksIHRvIG9ubHkgcnVubmluZyBRU0EgcXVlcmllcyBvdmVyDQoJCQkJCS8vIGVudGlyZSBkb2N1bWVudHMuICBTZWU6DQoJCQkJCS8vCQlodHRwOi8vZWpvaG4ub3JnL2Jsb2cvdGhvdWdodHMtb24tcXVlcnlzZWxlY3RvcmFsbC8NCgkJCQkJLy8JZGVzcGl0ZSB0aGlzLCB3ZSBjYW4gYWxzbyBoYW5kbGUgUVNBIHJ1bnMgb24gc2ltcGxlDQoJCQkJCS8vCXNlbGVjdG9ycywgYnV0IHdlIGRvbid0IHdhbnQgZGV0ZWN0aW9uIHRvIGJlIGV4cGVuc2l2ZQ0KCQkJCQkvLwlzbyB3ZSdyZSBqdXN0IGNoZWNraW5nIGZvciB0aGUgcHJlc2VuY2Ugb2YgYSBzcGFjZSBjaGFyDQoJCQkJCS8vCXJpZ2h0IG5vdy4gTm90IGVsZWdhbnQsIGJ1dCBpdCdzIGNoZWFwZXIgdGhhbiBydW5uaW5nDQoJCQkJCS8vCXRoZSBxdWVyeSBwYXJzZXIgd2hlbiB3ZSBtaWdodCBub3QgbmVlZCB0bw0KCQkJCQlpZighKCg5ID09IHJvb3Qubm9kZVR5cGUpIHx8IG5vc3BhY2UpKXsgdGhyb3cgIiI7IH0NCgkJCQkJdmFyIHIgPSByb290W3FzYV0odHEpOw0KCQkJCQkvLyBza2lwIGV4cGVuc2l2ZSBkdXBsaWNhdGlvbiBjaGVja3MgYW5kIGp1c3Qgd3JhcCBpbiBhIE5vZGVMaXN0DQoJCQkJCXJbbm9aaXBdID0gdHJ1ZTsNCgkJCQkJcmV0dXJuIHI7DQoJCQkJfWNhdGNoKGUpew0KCQkJCQkvLyBlbHNlIHJ1biB0aGUgRE9NIGJyYW5jaCBvbiB0aGlzIHF1ZXJ5LCBlbnN1cmluZyB0aGF0IHdlDQoJCQkJCS8vIGRlZmF1bHQgdGhhdCB3YXkgaW4gdGhlIGZ1dHVyZQ0KCQkJCQlyZXR1cm4gZ2V0UXVlcnlGdW5jKHF1ZXJ5LCB0cnVlKShyb290KTsNCgkJCQl9DQoJCQl9DQoJCX1lbHNlew0KCQkJLy8gRE9NIGJyYW5jaA0KCQkJdmFyIHBhcnRzID0gcXVlcnkuc3BsaXQoL1xzKixccyovKTsNCgkJCXJldHVybiBfcXVlcnlGdW5jQ2FjaGVET01bcXVlcnldID0gKChwYXJ0cy5sZW5ndGggPCAyKSA/IA0KCQkJCS8vIGlmIG5vdCBhIGNvbXBvdW5kIHF1ZXJ5IChlLmcuLCAiLmZvbywgLmJhciIpLCBjYWNoZSBhbmQgcmV0dXJuIGEgZGlzcGF0Y2hlcg0KCQkJCWdldFN0ZXBRdWVyeUZ1bmMocXVlcnkpIDogDQoJCQkJLy8gaWYgaXQgKmlzKiBhIGNvbXBsZXggcXVlcnksIGJyZWFrIGl0IHVwIGludG8gaXRzDQoJCQkJLy8gY29uc3RpdHVlbnQgcGFydHMgYW5kIHJldHVybiBhIGRpc3BhdGNoZXIgdGhhdCB3aWxsDQoJCQkJLy8gbWVyZ2UgdGhlIHBhcnRzIHdoZW4gcnVuDQoJCQkJZnVuY3Rpb24ocm9vdCl7DQoJCQkJCXZhciBwaW5kZXggPSAwLCAvLyBhdm9pZCBhcnJheSBhbGxvYyBmb3IgZXZlcnkgaW52b2NhdGlvbg0KCQkJCQkJcmV0ID0gW10sDQoJCQkJCQl0cDsNCgkJCQkJd2hpbGUoKHRwID0gcGFydHNbcGluZGV4KytdKSl7DQoJCQkJCQlyZXQgPSByZXQuY29uY2F0KGdldFN0ZXBRdWVyeUZ1bmModHApKHJvb3QpKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gcmV0Ow0KCQkJCX0NCgkJCSk7DQoJCX0NCgl9Ow0KDQoJdmFyIF96aXBJZHggPSAwOw0KDQoJLy8gTk9URToNCgkvLwkJdGhpcyBmdW5jdGlvbiBpcyBNb28gaW5zcGlyZWQsIGJ1dCBvdXIgb3duIGltcGwgdG8gZGVhbCBjb3JyZWN0bHkNCgkvLwkJd2l0aCBYTUwgaW4gSUUNCgl2YXIgX25vZGVVSUQgPSBkLmlzSUUgPyBmdW5jdGlvbihub2RlKXsNCgkJaWYoY2FzZVNlbnNpdGl2ZSl7DQoJCQkvLyBYTUwgZG9jcyBkb24ndCBoYXZlIHVuaXF1ZUlEIG9uIHRoZWlyIG5vZGVzDQoJCQlyZXR1cm4gKG5vZGUuZ2V0QXR0cmlidXRlKCJfdWlkIikgfHwgbm9kZS5zZXRBdHRyaWJ1dGUoIl91aWQiLCArK196aXBJZHgpIHx8IF96aXBJZHgpOw0KDQoJCX1lbHNlew0KCQkJcmV0dXJuIG5vZGUudW5pcXVlSUQ7DQoJCX0NCgl9IDogDQoJZnVuY3Rpb24obm9kZSl7DQoJCXJldHVybiAobm9kZS5fdWlkIHx8IChub2RlLl91aWQgPSArK196aXBJZHgpKTsNCgl9Ow0KDQoJLy8gZGV0ZXJtaW5lIGlmIGEgbm9kZSBpbiBpcyB1bmlxdWUgaW4gYSAiYmFnIi4gSW4gdGhpcyBjYXNlIHdlIGRvbid0IHdhbnQNCgkvLyB0byBmbGF0dGVuIGEgbGlzdCBvZiB1bmlxdWUgaXRlbXMsIGJ1dCByYXRoZXIganVzdCB0ZWxsIGlmIHRoZSBpdGVtIGluDQoJLy8gcXVlc3Rpb24gaXMgYWxyZWFkeSBpbiB0aGUgYmFnLiBOb3JtYWxseSB3ZSdkIGp1c3QgdXNlIGhhc2ggbG9va3VwIHRvIGRvDQoJLy8gdGhpcyBmb3IgdXMgYnV0IElFJ3MgRE9NIGlzIGJ1c3RlZCBzbyB3ZSBjYW4ndCByZWFsbHkgY291bnQgb24gdGhhdC4gT24NCgkvLyB0aGUgdXBzaWRlLCBpdCBnaXZlcyB1cyBhIGJ1aWx0IGluIHVuaXF1ZSBJRCBmdW5jdGlvbi4gDQoJdmFyIF9pc1VuaXF1ZSA9IGZ1bmN0aW9uKG5vZGUsIGJhZyl7DQoJCWlmKCFiYWcpeyByZXR1cm4gMTsgfQ0KCQl2YXIgaWQgPSBfbm9kZVVJRChub2RlKTsNCgkJaWYoIWJhZ1tpZF0peyByZXR1cm4gYmFnW2lkXSA9IDE7IH0NCgkJcmV0dXJuIDA7DQoJfTsNCg0KCS8vIGF0dGVtcHQgdG8gZWZmaWNpZW50bHkgZGV0ZXJtaW5lIGlmIGFuIGl0ZW0gaW4gYSBsaXN0IGlzIGEgZHVwZSwNCgkvLyByZXR1cm5pbmcgYSBsaXN0IG9mICJ1bmlxdWVzIiwgaG9wZWZ1bGx5IGluIGRvdWNtZW50IG9yZGVyDQoJdmFyIF96aXBJZHhOYW1lID0gIl96aXBJZHgiOw0KCXZhciBfemlwID0gZnVuY3Rpb24oYXJyKXsNCgkJaWYoYXJyICYmIGFyci5ub3ppcCl7IA0KCQkJcmV0dXJuIChxbGMuX3dyYXApID8gcWxjLl93cmFwKGFycikgOiBhcnI7DQoJCX0NCgkJLy8gdmFyIHJldCA9IG5ldyBkLl9Ob2RlTGlzdEN0b3IoKTsNCgkJdmFyIHJldCA9IG5ldyBxbGMoKTsNCgkJaWYoIWFyciB8fCAhYXJyLmxlbmd0aCl7IHJldHVybiByZXQ7IH0NCgkJaWYoYXJyWzBdKXsNCgkJCXJldC5wdXNoKGFyclswXSk7DQoJCX0NCgkJaWYoYXJyLmxlbmd0aCA8IDIpeyByZXR1cm4gcmV0OyB9DQoNCgkJX3ppcElkeCsrOw0KCQkNCgkJLy8gd2UgaGF2ZSB0byBmb3JrIGhlcmUgZm9yIElFIGFuZCBYTUwgZG9jcyBiZWNhdXNlIHdlIGNhbid0IHNldA0KCQkvLyBleHBhbmRvcyBvbiB0aGVpciBub2RlcyAoYXBwYXJlbnRseSkuICpzaWdoKg0KCQlpZihkLmlzSUUgJiYgY2FzZVNlbnNpdGl2ZSl7DQoJCQl2YXIgc3ppZHggPSBfemlwSWR4KyIiOw0KCQkJYXJyWzBdLnNldEF0dHJpYnV0ZShfemlwSWR4TmFtZSwgc3ppZHgpOw0KCQkJZm9yKHZhciB4ID0gMSwgdGU7IHRlID0gYXJyW3hdOyB4Kyspew0KCQkJCWlmKGFyclt4XS5nZXRBdHRyaWJ1dGUoX3ppcElkeE5hbWUpICE9IHN6aWR4KXsgDQoJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQl9DQoJCQkJdGUuc2V0QXR0cmlidXRlKF96aXBJZHhOYW1lLCBzemlkeCk7DQoJCQl9DQoJCX1lbHNlIGlmKGQuaXNJRSAmJiBhcnIuY29tbWVudFN0cmlwKXsNCgkJCXRyeXsNCgkJCQlmb3IodmFyIHggPSAxLCB0ZTsgdGUgPSBhcnJbeF07IHgrKyl7DQoJCQkJCWlmKF9pc0VsZW1lbnQodGUpKXsgDQoJCQkJCQlyZXQucHVzaCh0ZSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9Y2F0Y2goZSl7IC8qIHNxdWVsY2ggKi8gfQ0KCQl9ZWxzZXsNCgkJCWlmKGFyclswXSl7IGFyclswXVtfemlwSWR4TmFtZV0gPSBfemlwSWR4OyB9DQoJCQlmb3IodmFyIHggPSAxLCB0ZTsgdGUgPSBhcnJbeF07IHgrKyl7DQoJCQkJaWYoYXJyW3hdW196aXBJZHhOYW1lXSAhPSBfemlwSWR4KXsgDQoJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQl9DQoJCQkJdGVbX3ppcElkeE5hbWVdID0gX3ppcElkeDsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgkvLyB0aGUgbWFpbiBleGVjdXRvcg0KCWQucXVlcnkgPSBmdW5jdGlvbigvKlN0cmluZyovIHF1ZXJ5LCAvKlN0cmluZ3xET01Ob2RlPyovIHJvb3Qpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBub2RlcyB3aGljaCBtYXRjaCB0aGUgZ2l2ZW4gQ1NTMyBzZWxlY3Rvciwgc2VhcmNoaW5nIHRoZQ0KCQkvLwkJZW50aXJlIGRvY3VtZW50IGJ5IGRlZmF1bHQgYnV0IG9wdGlvbmFsbHkgdGFraW5nIGEgbm9kZSB0byBzY29wZQ0KCQkvLwkJdGhlIHNlYXJjaCBieS4gUmV0dXJucyBhbiBpbnN0YW5jZSBvZiBkb2pvLk5vZGVMaXN0Lg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCWRvam8ucXVlcnkoKSBpcyB0aGUgc3dpc3MgYXJteSBrbmlmZSBvZiBET00gbm9kZSBtYW5pcHVsYXRpb24gaW4NCgkJLy8JCURvam8uIE11Y2ggbGlrZSBQcm90b3R5cGUncyAiJCQiIChibGluZy1ibGluZykgZnVuY3Rpb24gb3IgSlF1ZXJ5J3MNCgkJLy8JCSIkIiBmdW5jdGlvbiwgZG9qby5xdWVyeSBwcm92aWRlcyByb2J1c3QsIGhpZ2gtcGVyZm9ybWFuY2UNCgkJLy8JCUNTUy1iYXNlZCBub2RlIHNlbGVjdG9yIHN1cHBvcnQgd2l0aCB0aGUgb3B0aW9uIG9mIHNjb3Bpbmcgc2VhcmNoZXMNCgkJLy8JCXRvIGEgcGFydGljdWxhciBzdWItdHJlZSBvZiBhIGRvY3VtZW50Lg0KCQkvLw0KCQkvLwkJU3VwcG9ydGVkIFNlbGVjdG9yczoNCgkJLy8JCS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCS8vDQoJCS8vCQlkb2pvLnF1ZXJ5KCkgc3VwcG9ydHMgYSByaWNoIHNldCBvZiBDU1MzIHNlbGVjdG9ycywgaW5jbHVkaW5nOg0KCQkvLw0KCQkvLwkJCSogY2xhc3Mgc2VsZWN0b3JzIChlLmcuLCBgLmZvb2ApDQoJCS8vCQkJKiBub2RlIHR5cGUgc2VsZWN0b3JzIGxpa2UgYHNwYW5gDQoJCS8vCQkJKiBgIGAgZGVzY2VuZGFudCBzZWxlY3RvcnMNCgkJLy8JCQkqIGA+YCBjaGlsZCBlbGVtZW50IHNlbGVjdG9ycyANCgkJLy8JCQkqIGAjZm9vYCBzdHlsZSBJRCBzZWxlY3RvcnMNCgkJLy8JCQkqIGAqYCB1bml2ZXJzYWwgc2VsZWN0b3INCgkJLy8JCQkqIGB+YCwgdGhlIGltbWVkaWF0ZWx5IHByZWNlZWRlZC1ieSBzaWJsaW5nIHNlbGVjdG9yDQoJCS8vCQkJKiBgK2AsIHRoZSBwcmVjZWVkZWQtYnkgc2libGluZyBzZWxlY3Rvcg0KCQkvLwkJCSogYXR0cmlidXRlIHF1ZXJpZXM6DQoJCS8vCQkJfAkqIGBbZm9vXWAgYXR0cmlidXRlIHByZXNlbmNlIHNlbGVjdG9yDQoJCS8vCQkJfAkqIGBbZm9vPSdiYXInXWAgYXR0cmlidXRlIHZhbHVlIGV4YWN0IG1hdGNoDQoJCS8vCQkJfAkqIGBbZm9vfj0nYmFyJ11gIGF0dHJpYnV0ZSB2YWx1ZSBsaXN0IGl0ZW0gbWF0Y2gNCgkJLy8JCQl8CSogYFtmb29ePSdiYXInXWAgYXR0cmlidXRlIHN0YXJ0IG1hdGNoDQoJCS8vCQkJfAkqIGBbZm9vJD0nYmFyJ11gIGF0dHJpYnV0ZSBlbmQgbWF0Y2gNCgkJLy8JCQl8CSogYFtmb28qPSdiYXInXWAgYXR0cmlidXRlIHN1YnN0cmluZyBtYXRjaA0KCQkvLwkJCSogYDpmaXJzdC1jaGlsZGAsIGA6bGFzdC1jaGlsZGAsIGFuZCBgOm9ubHktY2hpbGRgIHBvc2l0aW9uYWwgc2VsZWN0b3JzDQoJCS8vCQkJKiBgOmVtcHR5YCBjb250ZW50IGVtdHB5IHNlbGVjdG9yDQoJCS8vCQkJKiBgOmNoZWNrZWRgIHBzZXVkbyBzZWxlY3Rvcg0KCQkvLwkJCSogYDpudGgtY2hpbGQobilgLCBgOm50aC1jaGlsZCgybisxKWAgc3R5bGUgcG9zaXRpb25hbCBjYWxjdWxhdGlvbnMNCgkJLy8JCQkqIGA6bnRoLWNoaWxkKGV2ZW4pYCwgYDpudGgtY2hpbGQob2RkKWAgcG9zaXRpb25hbCBzZWxlY3RvcnMNCgkJLy8JCQkqIGA6bm90KC4uLilgIG5lZ2F0aW9uIHBzZXVkbyBzZWxlY3RvcnMNCgkJLy8NCgkJLy8JCUFueSBsZWdhbCBjb21iaW5hdGlvbiBvZiB0aGVzZSBzZWxlY3RvcnMgd2lsbCB3b3JrIHdpdGgNCgkJLy8JCWBkb2pvLnF1ZXJ5KClgLCBpbmNsdWRpbmcgY29tcG91bmQgc2VsZWN0b3JzICgiLCIgZGVsaW1pdGVkKS4NCgkJLy8JCVZlcnkgY29tcGxleCBhbmQgdXNlZnVsIHNlYXJjaGVzIGNhbiBiZSBjb25zdHJ1Y3RlZCB3aXRoIHRoaXMNCgkJLy8JCXBhbGV0dGUgb2Ygc2VsZWN0b3JzIGFuZCB3aGVuIGNvbWJpbmVkIHdpdGggZnVuY3Rpb25zIGZvcg0KCQkvLwkJbWFuaXB1bGF0aW9uIHByZXNlbnRlZCBieSBkb2pvLk5vZGVMaXN0LCBtYW55IHR5cGVzIG9mIERPTQ0KCQkvLwkJbWFuaXB1bGF0aW9uIG9wZXJhdGlvbnMgYmVjb21lIHZlcnkgc3RyYWlnaHRmb3J3YXJkLg0KCQkvLwkJDQoJCS8vCQlVbnN1cHBvcnRlZCBTZWxlY3RvcnM6DQoJCS8vCQktLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCS8vDQoJCS8vCQlXaGlsZSBkb2pvLnF1ZXJ5IGhhbmRsZXMgbWFueSBDU1MzIHNlbGVjdG9ycywgc29tZSBmYWxsIG91dHNpZGUgb2YNCgkJLy8JCXdoYXQncyByZXNhb25hYmxlIGZvciBhIHByb2dyYW1tYXRpYyBub2RlIHF1ZXJ5aW5nIGVuZ2luZSB0bw0KCQkvLwkJaGFuZGxlLiBDdXJyZW50bHkgdW5zdXBwb3J0ZWQgc2VsZWN0b3JzIGluY2x1ZGU6DQoJCS8vCQkNCgkJLy8JCQkqIG5hbWVzcGFjZS1kaWZmZXJlbnRpYXRlZCBzZWxlY3RvcnMgb2YgYW55IGZvcm0NCgkJLy8JCQkqIGFsbCBgOjpgIHBzZWR1by1lbGVtZW50IHNlbGVjdG9ycw0KCQkvLwkJCSogY2VydGFpbiBwc2VkdW8tc2VsZWN0b3JzIHdoaWNoIGRvbid0IGdldCBhIGxvdCBvZiBkYXktdG8tZGF5IHVzZToNCgkJLy8JCQl8CSogYDpyb290YCwgYDpsYW5nKClgLCBgOnRhcmdldGAsIGA6Zm9jdXNgDQoJCS8vCQkJKiBhbGwgdmlzdWFsIGFuZCBzdGF0ZSBzZWxlY3RvcnM6DQoJCS8vCQkJfAkqIGA6cm9vdGAsIGA6YWN0aXZlYCwgYDpob3ZlcmAsIGA6dmlzaXN0ZWRgLCBgOmxpbmtgLA0KCQkvLwkJCQkgIGA6ZW5hYmxlZGAsIGA6ZGlzYWJsZWRgDQoJCS8vCQkJKiBgOiotb2YtdHlwZWAgcHNldWRvIHNlbGVjdG9ycw0KCQkvLwkJDQoJCS8vCQlkb2pvLnF1ZXJ5IGFuZCBYTUwgRG9jdW1lbnRzOg0KCQkvLwkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJLy8JCQ0KCQkvLwkJYGRvam8ucXVlcnlgIChhcyBvZiBkb2pvIDEuMikgc3VwcG9ydHMgc2VhcmNoaW5nIFhNTCBkb2N1bWVudHMNCgkJLy8JCWluIGEgY2FzZS1zZW5zaXRpdmUgbWFubmVyLiBJZiBhbiBIVE1MIGRvY3VtZW50IGlzIHNlcnZlZCB3aXRoDQoJCS8vCQlhIGRvY3R5cGUgdGhhdCBmb3JjZXMgY2FzZS1zZW5zaXRpdml0eSAoZS5nLiwgWEhUTUwgMS4xDQoJCS8vCQlTdHJpY3QpLCBkb2pvLnF1ZXJ5KCkgd2lsbCBkZXRlY3QgdGhpcyBhbmQgImRvIHRoZSByaWdodA0KCQkvLwkJdGhpbmciLiBDYXNlIHNlbnNpdGl2aXR5IGlzIGRlcGVuZGVudCB1cG9uIHRoZSBkb2N1bWVudCBiZWluZw0KCQkvLwkJc2VhcmNoZWQgYW5kIG5vdCB0aGUgcXVlcnkgdXNlZC4gSXQgaXMgdGhlcmVmb3JlIHBvc3NpYmxlIHRvDQoJCS8vCQl1c2UgY2FzZS1zZW5zaXRpdmUgcXVlcmllcyBvbiBzdHJpY3Qgc3ViLWRvY3VtZW50cyAoaWZyYW1lcywNCgkJLy8JCWV0Yy4pIG9yIFhNTCBkb2N1bWVudHMgd2hpbGUgc3RpbGwgYXNzdW1pbmcgY2FzZS1pbnNlbnNpdGl2aXR5DQoJCS8vCQlmb3IgYSBob3N0L3Jvb3QgZG9jdW1lbnQuDQoJCS8vDQoJCS8vCQlOb24tc2VsZWN0b3IgUXVlcmllczoNCgkJLy8JCS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkvLw0KCQkvLwkJSWYgc29tZXRoaW5nIG90aGVyIHRoYW4gYSBTdHJpbmcgaXMgcGFzc2VkIGZvciB0aGUgcXVlcnksDQoJCS8vCQlgZG9qby5xdWVyeWAgd2lsbCByZXR1cm4gYSBuZXcgYGRvam8uTm9kZUxpc3RgIGluc3RhbmNlDQoJCS8vCQljb25zdHJ1Y3RlZCBmcm9tIHRoYXQgcGFyYW1ldGVyIGFsb25lIGFuZCBhbGwgZnVydGhlcg0KCQkvLwkJcHJvY2Vzc2luZyB3aWxsIHN0b3AuIFRoaXMgbWVhbnMgdGhhdCBpZiB5b3UgaGF2ZSBhIHJlZmVyZW5jZQ0KCQkvLwkJdG8gYSBub2RlIG9yIE5vZGVMaXN0LCB5b3UgY2FuIHF1aWNrbHkgY29uc3RydWN0IGEgbmV3IE5vZGVMaXN0DQoJCS8vCQlmcm9tIHRoZSBvcmlnaW5hbCBieSBjYWxsaW5nIGBkb2pvLnF1ZXJ5KG5vZGUpYCBvcg0KCQkvLwkJYGRvam8ucXVlcnkobGlzdClgLg0KCQkvLw0KCQkvLwlxdWVyeToNCgkJLy8JCVRoZSBDU1MzIGV4cHJlc3Npb24gdG8gbWF0Y2ggYWdhaW5zdC4gRm9yIGRldGFpbHMgb24gdGhlIHN5bnRheCBvZg0KCQkvLwkJQ1NTMyBzZWxlY3RvcnMsIHNlZSA8aHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3NlbGVjdG9ycz4NCgkJLy8Jcm9vdDoNCgkJLy8JCUEgRE9NTm9kZSAob3Igbm9kZSBpZCkgdG8gc2NvcGUgdGhlIHNlYXJjaCBmcm9tLiBPcHRpb25hbC4NCgkJLy8JcmV0dXJuczogZG9qby5Ob2RlTGlzdA0KCQkvLwkJQW4gaW5zdGFuY2Ugb2YgYGRvam8uTm9kZUxpc3RgLiBNYW55IG1ldGhvZHMgYXJlIGF2YWlsYWJsZSBvbg0KCQkvLwkJTm9kZUxpc3RzIGZvciBzZWFyY2hpbmcsIGl0ZXJhdGluZywgbWFuaXB1bGF0aW5nLCBhbmQgaGFuZGxpbmcNCgkJLy8JCWV2ZW50cyBvbiB0aGUgbWF0Y2hlZCBub2RlcyBpbiB0aGUgcmV0dXJuZWQgbGlzdC4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCXNlYXJjaCB0aGUgZW50aXJlIGRvY3VtZW50IGZvciBlbGVtZW50cyB3aXRoIHRoZSBjbGFzcyAiZm9vIjoNCgkJLy8JfAlkb2pvLnF1ZXJ5KCIuZm9vIik7DQoJCS8vCQl0aGVzZSBlbGVtZW50cyB3aWxsIG1hdGNoOg0KCQkvLwl8CTxzcGFuIGNsYXNzPSJmb28iPjwvc3Bhbj4NCgkJLy8JfAk8c3BhbiBjbGFzcz0iZm9vIGJhciI+PC9zcGFuPg0KCQkvLwl8CTxwIGNsYXNzPSJ0aHVkIGZvbyI+PC9wPg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJc2VhcmNoIHRoZSBlbnRpcmUgZG9jdW1lbnQgZm9yIGVsZW1lbnRzIHdpdGggdGhlIGNsYXNzZXMgImZvbyIgKmFuZCogImJhciI6DQoJCS8vCXwJZG9qby5xdWVyeSgiLmZvby5iYXIiKTsNCgkJLy8JCXRoZXNlIGVsZW1lbnRzIHdpbGwgbWF0Y2g6DQoJCS8vCXwJPHNwYW4gY2xhc3M9ImZvbyBiYXIiPjwvc3Bhbj4NCgkJLy8JCXdoaWxlIHRoZXNlIHdpbGwgbm90Og0KCQkvLwl8CTxzcGFuIGNsYXNzPSJmb28iPjwvc3Bhbj4NCgkJLy8JfAk8cCBjbGFzcz0idGh1ZCBmb28iPjwvcD4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCWZpbmQgYDxzcGFuPmAgZWxlbWVudHMgd2hpY2ggYXJlIGRlc2NlbmRhbnRzIG9mIHBhcmFncmFwaHMgYW5kDQoJCS8vCQl3aGljaCBoYXZlIGEgImhpZ2hsaWdodGVkIiBjbGFzczoNCgkJLy8JfAlkb2pvLnF1ZXJ5KCJwIHNwYW4uaGlnaGxpZ2h0ZWQiKTsNCgkJLy8JCXRoZSBpbm5lcm1vc3Qgc3BhbiBpbiB0aGlzIGZyYWdtZW50IG1hdGNoZXM6DQoJCS8vCXwJPHAgY2xhc3M9ImZvbyI+DQoJCS8vCXwJCTxzcGFuPi4uLg0KCQkvLwl8CQkJPHNwYW4gY2xhc3M9ImhpZ2hsaWdodGVkIGZvbyBiYXIiPi4uLjwvc3Bhbj4NCgkJLy8JfAkJPC9zcGFuPg0KCQkvLwl8CTwvcD4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCXNldCBhbiAib2RkIiBjbGFzcyBvbiBhbGwgb2RkIHRhYmxlIHJvd3MgaW5zaWRlIG9mIHRoZSB0YWJsZQ0KCQkvLwkJYCN0YWJ1bGFyX2RhdGFgLCB1c2luZyB0aGUgYD5gIChkaXJlY3QgY2hpbGQpIHNlbGVjdG9yIHRvIGF2b2lkDQoJCS8vCQlhZmZlY3RpbmcgYW55IG5lc3RlZCB0YWJsZXM6DQoJCS8vCXwJZG9qby5xdWVyeSgiI3RhYnVsYXJfZGF0YSA+IHRib2R5ID4gdHI6bnRoLWNoaWxkKG9kZCkiKS5hZGRDbGFzcygib2RkIik7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlyZW1vdmUgYWxsIGVsZW1lbnRzIHdpdGggdGhlIGNsYXNzICJlcnJvciIgZnJvbSB0aGUgZG9jdW1lbnQNCgkJLy8JCWFuZCBzdG9yZSB0aGVtIGluIGEgbGlzdDoNCgkJLy8JfAl2YXIgZXJyb3JzID0gZG9qby5xdWVyeSgiLmVycm9yIikub3JwaGFuKCk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlhZGQgYW4gb25jbGljayBoYW5kbGVyIHRvIGV2ZXJ5IHN1Ym1pdCBidXR0b24gaW4gdGhlIGRvY3VtZW50DQoJCS8vCQl3aGljaCBjYXVzZXMgdGhlIGZvcm0gdG8gYmUgc2VudCB2aWEgQWpheCBpbnN0ZWFkOg0KCQkvLwl8CWRvam8ucXVlcnkoImlucHV0W3R5cGU9J3N1Ym1pdCddIikub25jbGljayhmdW5jdGlvbihlKXsNCgkJLy8JfAkJZG9qby5zdG9wRXZlbnQoZSk7IC8vIHByZXZlbnQgc2VuZGluZyB0aGUgZm9ybQ0KCQkvLwl8CQl2YXIgYnRuID0gZS50YXJnZXQ7DQoJCS8vCXwJCWRvam8ueGhyUG9zdCh7DQoJCS8vCXwJCQlmb3JtOiBidG4uZm9ybSwNCgkJLy8JfAkJCWxvYWQ6IGZ1bmN0aW9uKGRhdGEpew0KCQkvLwl8CQkJCS8vIHJlcGxhY2UgdGhlIGZvcm0gd2l0aCB0aGUgcmVzcG9uc2UNCgkJLy8JfAkJCQl2YXIgZGl2ID0gZG9qby5kb2MuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCS8vCXwJCQkJZG9qby5wbGFjZShkaXYsIGJ0bi5mb3JtLCAiYWZ0ZXIiKTsNCgkJLy8JfAkJCQlkaXYuaW5uZXJIVE1MID0gZGF0YTsNCgkJLy8JfAkJCQlkb2pvLnN0eWxlKGJ0bi5mb3JtLCAiZGlzcGxheSIsICJub25lIik7DQoJCS8vCXwJCQl9DQoJCS8vCXwJCX0pOw0KCQkvLwl8CX0pOw0KDQoJCS8vU2V0IGxpc3QgY29uc3RydWN0b3IgdG8gZGVzaXJlZCB2YWx1ZS4gVGhpcyBjYW4gY2hhbmdlDQoJCS8vYmV0d2VlbiBjYWxscywgc28gYWx3YXlzIHJlLWFzc2lnbiBoZXJlLg0KCQlxbGMgPSBkLl9Ob2RlTGlzdEN0b3I7DQoNCgkJaWYoIXF1ZXJ5KXsNCgkJCXJldHVybiBuZXcgcWxjKCk7DQoJCX0NCg0KCQlpZihxdWVyeS5jb25zdHJ1Y3RvciA9PSBxbGMpew0KCQkJcmV0dXJuIHF1ZXJ5Ow0KCQl9DQoJCWlmKHR5cGVvZiBxdWVyeSAhPSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCXJldHVybiBuZXcgcWxjKHF1ZXJ5KTsgLy8gZG9qby5Ob2RlTGlzdA0KCQl9DQoJCWlmKHR5cGVvZiByb290ID09ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJcm9vdCA9IGQuYnlJZChyb290KTsNCgkJCWlmKCFyb290KXsgcmV0dXJuIG5ldyBxbGMoKTsgfQ0KCQl9DQoNCgkJcm9vdCA9IHJvb3R8fGdldERvYygpOw0KCQl2YXIgb2QgPSByb290Lm93bmVyRG9jdW1lbnR8fHJvb3QuZG9jdW1lbnRFbGVtZW50Ow0KDQoJCS8vIHRocm93IHRoZSBiaWcgY2FzZSBzZW5zaXRpdml0eSBzd2l0Y2gNCg0KCQkvLyBOT1RFOg0KCQkvLyAJCU9wZXJhIGluIFhIVE1MIG1vZGUgZG9lc24ndCBkZXRlY3QgY2FzZS1zZW5zaXRpdml0eSBjb3JyZWN0bHkNCgkJLy8gCQlhbmQgaXQncyBub3QgY2xlYXIgdGhhdCB0aGVyZSdzIGFueSB3YXkgdG8gdGVzdCBmb3IgaXQNCgkJY2FzZVNlbnNpdGl2ZSA9IChyb290LmNvbnRlbnRUeXBlICYmIHJvb3QuY29udGVudFR5cGU9PSJhcHBsaWNhdGlvbi94bWwiKSB8fCANCgkJCQkJCShkLmlzT3BlcmEgJiYgKHJvb3QuZG9jdHlwZSB8fCBvZC50b1N0cmluZygpID09ICJbb2JqZWN0IFhNTERvY3VtZW50XSIpKSB8fA0KCQkJCQkJKCEhb2QpICYmIA0KCQkJCQkJKGQuaXNJRSA/IG9kLnhtbCA6IChyb290LnhtbFZlcnNpb258fG9kLnhtbFZlcnNpb24pKTsNCg0KCQkvLyBOT1RFOiANCgkJLy8JCWFkZGluZyAidHJ1ZSIgYXMgdGhlIDJuZCBhcmd1bWVudCB0byBnZXRRdWVyeUZ1bmMgaXMgdXNlZnVsIGZvcg0KCQkvLwkJdGVzdGluZyB0aGUgRE9NIGJyYW5jaCB3aXRob3V0IHdvcnJ5aW5nIGFib3V0IHRoZQ0KCQkvLwkJYmVoYXZpb3IvcGVyZm9ybWFuY2Ugb2YgdGhlIFFTQSBicmFuY2guDQoJCXZhciByID0gZ2V0UXVlcnlGdW5jKHF1ZXJ5KShyb290KTsNCg0KCQkvLyBGSVhNRToNCgkJLy8JCW5lZWQgdG8gaW52ZXN0aWdhdGUgdGhpcyBicmFuY2ggV1JUICM4MDc0IGFuZCAjODA3NQ0KCQlpZihyICYmIHIubm96aXAgJiYgIXFsYy5fd3JhcCl7DQoJCQlyZXR1cm4gcjsNCgkJfQ0KCQlyZXR1cm4gX3ppcChyKTsgLy8gZG9qby5Ob2RlTGlzdA0KCX0NCg0KCS8vIEZJWE1FOiBuZWVkIHRvIGFkZCBpbmZyYXN0cnVjdHVyZSBmb3IgcG9zdC1maWx0ZXJpbmcgcHNldWRvcywgYWxhIDpsYXN0DQoJZC5xdWVyeS5wc2V1ZG9zID0gcHNldWRvczsNCg0KCS8vIG9uZS1vZmYgZnVuY3Rpb24gZm9yIGZpbHRlcmluZyBhIE5vZGVMaXN0IGJhc2VkIG9uIGEgc2ltcGxlIHNlbGVjdG9yDQoJZC5fZmlsdGVyUXVlcnlSZXN1bHQgPSBmdW5jdGlvbihub2RlTGlzdCwgc2ltcGxlRmlsdGVyKXsNCgkJdmFyIHRtcE5vZGVMaXN0ID0gbmV3IGQuX05vZGVMaXN0Q3RvcigpOw0KCQl2YXIgZmlsdGVyRnVuYyA9IGdldFNpbXBsZUZpbHRlckZ1bmMoZ2V0UXVlcnlQYXJ0cyhzaW1wbGVGaWx0ZXIpWzBdKTsNCgkJZm9yKHZhciB4ID0gMCwgdGU7IHRlID0gbm9kZUxpc3RbeF07IHgrKyl7DQoJCQlpZihmaWx0ZXJGdW5jKHRlKSl7IHRtcE5vZGVMaXN0LnB1c2godGUpOyB9DQoJCX0NCgkJcmV0dXJuIHRtcE5vZGVMaXN0Ow0KCX0NCn0pKHRoaXNbInF1ZXJ5UG9ydGFiaWxpdHkiXXx8dGhpc1siYWNtZSJdfHxkb2pvKTsNCg0KLyoNCiovDQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLnhociJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS54aHIiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UueGhyIik7DQoNCg0KDQoNCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIF9kID0gZG9qbywgY2ZnID0gX2QuY29uZmlnOw0KDQoJZnVuY3Rpb24gc2V0VmFsdWUoLypPYmplY3QqL29iaiwgLypTdHJpbmcqL25hbWUsIC8qU3RyaW5nKi92YWx1ZSl7DQoJCS8vc3VtbWFyeToNCgkJLy8JCUZvciB0aGUgbmFtZWQgcHJvcGVydHkgaW4gb2JqZWN0LCBzZXQgdGhlIHZhbHVlLiBJZiBhIHZhbHVlDQoJCS8vCQlhbHJlYWR5IGV4aXN0cyBhbmQgaXQgaXMgYSBzdHJpbmcsIGNvbnZlcnQgdGhlIHZhbHVlIHRvIGJlIGFuDQoJCS8vCQlhcnJheSBvZiB2YWx1ZXMuDQoNCgkJLy9Ta2lwIGl0IGlmIHRoZXJlIGlzIG5vIHZhbHVlDQoJCWlmKHZhbHVlID09PSBudWxsKXsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXZhciB2YWwgPSBvYmpbbmFtZV07DQoJCWlmKHR5cGVvZiB2YWwgPT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQlvYmpbbmFtZV0gPSBbdmFsLCB2YWx1ZV07DQoJCX1lbHNlIGlmKF9kLmlzQXJyYXkodmFsKSl7DQoJCQl2YWwucHVzaCh2YWx1ZSk7DQoJCX1lbHNlew0KCQkJb2JqW25hbWVdID0gdmFsdWU7DQoJCX0NCgl9DQoJDQoJZG9qby5maWVsZFRvT2JqZWN0ID0gZnVuY3Rpb24oLypET01Ob2RlfHxTdHJpbmcqLyBpbnB1dE5vZGUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJU2VyaWFsaXplIGEgZm9ybSBmaWVsZCB0byBhIEphdmFTY3JpcHQgb2JqZWN0Lg0KCQkvLw0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCVJldHVybnMgdGhlIHZhbHVlIGVuY29kZWQgaW4gYSBmb3JtIGZpZWxkIGFzDQoJCS8vCQlhcyBhIHN0cmluZyBvciBhbiBhcnJheSBvZiBzdHJpbmdzLiBEaXNhYmxlZCBmb3JtIGVsZW1lbnRzDQoJCS8vCQlhbmQgdW5jaGVja2VkIHJhZGlvIGFuZCBjaGVja2JveGVzIGFyZSBza2lwcGVkLglNdWx0aS1zZWxlY3QNCgkJLy8JCWVsZW1lbnRzIGFyZSByZXR1cm5lZCBhcyBhbiBhcnJheSBvZiBzdHJpbmcgdmFsdWVzLg0KCQl2YXIgcmV0ID0gbnVsbDsNCgkJdmFyIGl0ZW0gPSBfZC5ieUlkKGlucHV0Tm9kZSk7DQoJCWlmKGl0ZW0pew0KCQkJdmFyIF9pbiA9IGl0ZW0ubmFtZTsNCgkJCXZhciB0eXBlID0gKGl0ZW0udHlwZXx8IiIpLnRvTG93ZXJDYXNlKCk7DQoJCQlpZihfaW4gJiYgdHlwZSAmJiAhaXRlbS5kaXNhYmxlZCl7DQoJCQkJaWYodHlwZSA9PSAicmFkaW8iIHx8IHR5cGUgPT0gImNoZWNrYm94Iil7DQoJCQkJCWlmKGl0ZW0uY2hlY2tlZCl7IHJldCA9IGl0ZW0udmFsdWUgfQ0KCQkJCX1lbHNlIGlmKGl0ZW0ubXVsdGlwbGUpew0KCQkJCQlyZXQgPSBbXTsNCgkJCQkJX2QucXVlcnkoIm9wdGlvbiIsIGl0ZW0pLmZvckVhY2goZnVuY3Rpb24ob3B0KXsNCgkJCQkJCWlmKG9wdC5zZWxlY3RlZCl7DQoJCQkJCQkJcmV0LnB1c2gob3B0LnZhbHVlKTsNCgkJCQkJCX0NCgkJCQkJfSk7DQoJCQkJfWVsc2V7DQoJCQkJCXJldCA9IGl0ZW0udmFsdWU7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCXJldHVybiByZXQ7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uZm9ybVRvT2JqZWN0ID0gZnVuY3Rpb24oLypET01Ob2RlfHxTdHJpbmcqLyBmb3JtTm9kZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlTZXJpYWxpemUgYSBmb3JtIG5vZGUgdG8gYSBKYXZhU2NyaXB0IG9iamVjdC4NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQlSZXR1cm5zIHRoZSB2YWx1ZXMgZW5jb2RlZCBpbiBhbiBIVE1MIGZvcm0gYXMNCgkJLy8JCXN0cmluZyBwcm9wZXJ0aWVzIGluIGFuIG9iamVjdCB3aGljaCBpdCB0aGVuIHJldHVybnMuIERpc2FibGVkIGZvcm0NCgkJLy8JCWVsZW1lbnRzLCBidXR0b25zLCBhbmQgb3RoZXIgbm9uLXZhbHVlIGZvcm0gZWxlbWVudHMgYXJlIHNraXBwZWQuDQoJCS8vCQlNdWx0aS1zZWxlY3QgZWxlbWVudHMgYXJlIHJldHVybmVkIGFzIGFuIGFycmF5IG9mIHN0cmluZyB2YWx1ZXMuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlUaGlzIGZvcm06DQoJCS8vCQl8CTxmb3JtIGlkPSJ0ZXN0X2Zvcm0iPg0KCQkvLwkJfAkJPGlucHV0IHR5cGU9InRleHQiIG5hbWU9ImJsYWgiIHZhbHVlPSJibGFoIj4NCgkJLy8JCXwJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJub192YWx1ZSIgdmFsdWU9ImJsYWgiIGRpc2FibGVkPg0KCQkvLwkJfAkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgbmFtZT0ibm9fdmFsdWUyIiB2YWx1ZT0iYmxhaCI+DQoJCS8vCQl8CQk8c2VsZWN0IHR5cGU9InNlbGVjdCIgbXVsdGlwbGUgbmFtZT0ibXVsdGkiIHNpemU9IjUiPg0KCQkvLwkJfAkJCTxvcHRpb24gdmFsdWU9ImJsYWgiPmJsYWg8L29wdGlvbj4NCgkJLy8JCXwJCQk8b3B0aW9uIHZhbHVlPSJ0aHVkIiBzZWxlY3RlZD50aHVkPC9vcHRpb24+DQoJCS8vCQl8CQkJPG9wdGlvbiB2YWx1ZT0idGhvbmsiIHNlbGVjdGVkPnRob25rPC9vcHRpb24+DQoJCS8vCQl8CQk8L3NlbGVjdD4NCgkJLy8JCXwJPC9mb3JtPg0KCQkvLw0KCQkvLwkJeWllbGRzIHRoaXMgb2JqZWN0IHN0cnVjdHVyZSBhcyB0aGUgcmVzdWx0IG9mIGEgY2FsbCB0bw0KCQkvLwkJZm9ybVRvT2JqZWN0KCk6DQoJCS8vDQoJCS8vCQl8CXsgDQoJCS8vCQl8CQlibGFoOiAiYmxhaCIsDQoJCS8vCQl8CQltdWx0aTogWw0KCQkvLwkJfAkJCSJ0aHVkIiwNCgkJLy8JCXwJCQkidGhvbmsiDQoJCS8vCQl8CQldDQoJCS8vCQl8CX07DQoNCgkJdmFyIHJldCA9IHt9Ow0KCQl2YXIgZXhjbHVkZSA9ICJmaWxlfHN1Ym1pdHxpbWFnZXxyZXNldHxidXR0b258IjsNCgkJX2QuZm9yRWFjaChkb2pvLmJ5SWQoZm9ybU5vZGUpLmVsZW1lbnRzLCBmdW5jdGlvbihpdGVtKXsNCgkJCXZhciBfaW4gPSBpdGVtLm5hbWU7DQoJCQl2YXIgdHlwZSA9IChpdGVtLnR5cGV8fCIiKS50b0xvd2VyQ2FzZSgpOw0KCQkJaWYoX2luICYmIHR5cGUgJiYgZXhjbHVkZS5pbmRleE9mKHR5cGUpID09IC0xICYmICFpdGVtLmRpc2FibGVkKXsNCgkJCQlzZXRWYWx1ZShyZXQsIF9pbiwgX2QuZmllbGRUb09iamVjdChpdGVtKSk7DQoJCQkJaWYodHlwZSA9PSAiaW1hZ2UiKXsNCgkJCQkJcmV0W19pbisiLngiXSA9IHJldFtfaW4rIi55Il0gPSByZXRbX2luXS54ID0gcmV0W19pbl0ueSA9IDA7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCgkJcmV0dXJuIHJldDsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5vYmplY3RUb1F1ZXJ5ID0gZnVuY3Rpb24oLypPYmplY3QqLyBtYXApew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJdGFrZXMgYSBuYW1lL3ZhbHVlIG1hcHBpbmcgb2JqZWN0IGFuZCByZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGluZw0KCQkvLwkJYSBVUkwtZW5jb2RlZCB2ZXJzaW9uIG9mIHRoYXQgb2JqZWN0Lg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJdGhpcyBvYmplY3Q6DQoJCS8vDQoJCS8vCQl8CXsgDQoJCS8vCQl8CQlibGFoOiAiYmxhaCIsDQoJCS8vCQl8CQltdWx0aTogWw0KCQkvLwkJfAkJCSJ0aHVkIiwNCgkJLy8JCXwJCQkidGhvbmsiDQoJCS8vCQl8CQldDQoJCS8vCQl8CX07DQoJCS8vDQoJCS8vCXlpZWxkcyB0aGUgZm9sbG93aW5nIHF1ZXJ5IHN0cmluZzoNCgkJLy8JDQoJCS8vCXwJImJsYWg9YmxhaCZtdWx0aT10aHVkJm11bHRpPXRob25rIg0KDQoJCS8vIEZJWE1FOiBuZWVkIHRvIGltcGxlbWVudCBlbmNvZGVBc2NpaSEhDQoJCXZhciBlbmMgPSBlbmNvZGVVUklDb21wb25lbnQ7DQoJCXZhciBwYWlycyA9IFtdOw0KCQl2YXIgYmFja3N0b3AgPSB7fTsNCgkJZm9yKHZhciBuYW1lIGluIG1hcCl7DQoJCQl2YXIgdmFsdWUgPSBtYXBbbmFtZV07DQoJCQlpZih2YWx1ZSAhPSBiYWNrc3RvcFtuYW1lXSl7DQoJCQkJdmFyIGFzc2lnbiA9IGVuYyhuYW1lKSArICI9IjsNCgkJCQlpZihfZC5pc0FycmF5KHZhbHVlKSl7DQoJCQkJCWZvcih2YXIgaT0wOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspew0KCQkJCQkJcGFpcnMucHVzaChhc3NpZ24gKyBlbmModmFsdWVbaV0pKTsNCgkJCQkJfQ0KCQkJCX1lbHNlew0KCQkJCQlwYWlycy5wdXNoKGFzc2lnbiArIGVuYyh2YWx1ZSkpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcGFpcnMuam9pbigiJiIpOyAvLyBTdHJpbmcNCgl9DQoNCglkb2pvLmZvcm1Ub1F1ZXJ5ID0gZnVuY3Rpb24oLypET01Ob2RlfHxTdHJpbmcqLyBmb3JtTm9kZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIGEgVVJMLWVuY29kZWQgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgZm9ybSBwYXNzZWQgYXMgZWl0aGVyIGENCgkJLy8JCW5vZGUgb3Igc3RyaW5nIElEIGlkZW50aWZ5aW5nIHRoZSBmb3JtIHRvIHNlcmlhbGl6ZQ0KCQlyZXR1cm4gX2Qub2JqZWN0VG9RdWVyeShfZC5mb3JtVG9PYmplY3QoZm9ybU5vZGUpKTsgLy8gU3RyaW5nDQoJfQ0KDQoJZG9qby5mb3JtVG9Kc29uID0gZnVuY3Rpb24oLypET01Ob2RlfHxTdHJpbmcqLyBmb3JtTm9kZSwgLypCb29sZWFuPyovcHJldHR5UHJpbnQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQ3JlYXRlIGEgc2VyaWFsaXplZCBKU09OIHN0cmluZyBmcm9tIGEgZm9ybSBub2RlIG9yIHN0cmluZw0KCQkvLwkJSUQgaWRlbnRpZnlpbmcgdGhlIGZvcm0gdG8gc2VyaWFsaXplDQoJCXJldHVybiBfZC50b0pzb24oX2QuZm9ybVRvT2JqZWN0KGZvcm1Ob2RlKSwgcHJldHR5UHJpbnQpOyAvLyBTdHJpbmcNCgl9DQoNCglkb2pvLnF1ZXJ5VG9PYmplY3QgPSBmdW5jdGlvbigvKlN0cmluZyovIHN0cil7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlDcmVhdGUgYW4gb2JqZWN0IHJlcHJlc2VudGluZyBhIGRlLXNlcmlhbGl6ZWQgcXVlcnkgc2VjdGlvbiBvZiBhDQoJCS8vCQlVUkwuIFF1ZXJ5IGtleXMgd2l0aCBtdWx0aXBsZSB2YWx1ZXMgYXJlIHJldHVybmVkIGluIGFuIGFycmF5Lg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJVGhpcyBzdHJpbmc6DQoJCS8vDQoJCS8vCXwJCSJmb289YmFyJmZvbz1iYXomdGhpbmdlcj0lMjBzcGFjZXMlMjA9YmxhaCZ6b25rPWJsYXJnJiINCgkJLy8JCQ0KCQkvLwkJcmVzdWx0cyBpbiB0aGlzIG9iamVjdCBzdHJ1Y3R1cmU6DQoJCS8vDQoJCS8vCXwJCXsNCgkJLy8JfAkJCWZvbzogWyAiYmFyIiwgImJheiIgXSwNCgkJLy8JfAkJCXRoaW5nZXI6ICIgc3BhY2VzID1ibGFoIiwNCgkJLy8JfAkJCXpvbms6ICJibGFyZyINCgkJLy8JfAkJfQ0KCQkvLwkNCgkJLy8JCU5vdGUgdGhhdCBzcGFjZXMgYW5kIG90aGVyIHVybGVuY29kZWQgZW50aXRpZXMgYXJlIGNvcnJlY3RseQ0KCQkvLwkJaGFuZGxlZC4NCg0KCQkvLyBGSVhNRTogc2hvdWxkIHdlIGdyYWIgdGhlIFVSTCBzdHJpbmcgaWYgd2UncmUgbm90IHBhc3NlZCBvbmU/DQoJCXZhciByZXQgPSB7fTsNCgkJdmFyIHFwID0gc3RyLnNwbGl0KCImIik7DQoJCXZhciBkZWMgPSBkZWNvZGVVUklDb21wb25lbnQ7DQoJCV9kLmZvckVhY2gocXAsIGZ1bmN0aW9uKGl0ZW0pew0KCQkJaWYoaXRlbS5sZW5ndGgpew0KCQkJCXZhciBwYXJ0cyA9IGl0ZW0uc3BsaXQoIj0iKTsNCgkJCQl2YXIgbmFtZSA9IGRlYyhwYXJ0cy5zaGlmdCgpKTsNCgkJCQl2YXIgdmFsID0gZGVjKHBhcnRzLmpvaW4oIj0iKSk7DQoJCQkJaWYodHlwZW9mIHJldFtuYW1lXSA9PSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCQkJcmV0W25hbWVdID0gW3JldFtuYW1lXV07DQoJCQkJfQ0KDQoJCQkJaWYoX2QuaXNBcnJheShyZXRbbmFtZV0pKXsNCgkJCQkJcmV0W25hbWVdLnB1c2godmFsKTsNCgkJCQl9ZWxzZXsNCgkJCQkJcmV0W25hbWVdID0gdmFsOw0KCQkJCX0NCgkJCX0NCgkJfSk7DQoJCXJldHVybiByZXQ7IC8vIE9iamVjdA0KCX0NCg0KCS8vIG5lZWQgdG8gYmxvY2sgYXN5bmMgY2FsbGJhY2tzIGZyb20gc25hdGNoaW5nIHRoaXMgdGhyZWFkIGFzIHRoZSByZXN1bHQNCgkvLyBvZiBhbiBhc3luYyBjYWxsYmFjayBtaWdodCBjYWxsIGFub3RoZXIgc3luYyBYSFIsIHRoaXMgaGFuZ3Mga2h0bWwgZm9yZXZlcg0KCS8vIG11c3QgY2hlY2tlZCBieSB3YXRjaEluRmxpZ2h0KCkNCg0KCWRvam8uX2Jsb2NrQXN5bmMgPSBmYWxzZTsNCg0KCS8vIE1PVzogcmVtb3ZlIGRvam8uX2NvbnRlbnRIYW5kbGVycyBhbGlhcyBpbiAyLjANCgl2YXIgaGFuZGxlcnMgPSBfZC5fY29udGVudEhhbmRsZXJzID0gZG9qby5jb250ZW50SGFuZGxlcnMgPSB7DQoJCS8vIHN1bW1hcnk6IA0KCQkvLwkJQSBtYXAgb2YgYXZhaWxibGUgWEhSIHRyYW5zcG9ydCBoYW5kbGUgdHlwZXMuIE5hbWUgbWF0Y2hlcyB0aGUNCgkJLy8JCWBoYW5kbGVBc2AgYXR0cmlidXRlIHBhc3NlZCB0byBYSFIgY2FsbHMuDQoJCS8vDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLwkJQSBtYXAgb2YgYXZhaWxibGUgWEhSIHRyYW5zcG9ydCBoYW5kbGUgdHlwZXMuIE5hbWUgbWF0Y2hlcyB0aGUNCgkJLy8JCWBoYW5kbGVBc2AgYXR0cmlidXRlIHBhc3NlZCB0byBYSFIgY2FsbHMuIEVhY2ggY29udGVudEhhbmRsZXIgaXMNCgkJLy8JCWNhbGxlZCwgcGFzc2luZyB0aGUgeGhyIG9iamVjdCBmb3IgbWFuaXB1bGF0aW9uLiBUaGUgcmV0dXJuIHZhbHVlDQoJCS8vCQlmcm9tIHRoZSBjb250ZW50SGFuZGxlciB3aWxsIGJlIHBhc3NlZCB0byB0aGUgYGxvYWRgIG9yIGBoYW5kbGVgIA0KCQkvLwkJZnVuY3Rpb25zIGRlZmluZWQgaW4gdGhlIG9yaWdpbmFsIHhociBjYWxsLiANCgkJLy8JCQ0KCQkvLyBleGFtcGxlOg0KCQkvLwkJQ3JlYXRpbmcgYSBjdXN0b20gY29udGVudC1oYW5kbGVyOg0KCQkvLwl8CWRvam8uY29udGVudEhhbmRsZXJzLm1ha2VDYXBzID0gZnVuY3Rpb24oeGhyKXsNCgkJLy8JfAkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQudG9VcHBlckNhc2UoKTsNCgkJLy8JfAl9DQoJCS8vCXwJLy8gYW5kIGxhdGVyOg0KCQkvLwl8CWRvam8ueGhyR2V0KHsgDQoJCS8vCXwJCXVybDoiZm9vLnR4dCIsDQoJCS8vCXwJCWhhbmRsZUFzOiJtYWtlQ2FwcyIsDQoJCS8vCXwJCWxvYWQ6IGZ1bmN0aW9uKGRhdGEpeyAvKiBkYXRhIGlzIGEgdG9VcHBlciB2ZXJzaW9uIG9mIGZvby50eHQgKi8gfQ0KCQkvLwl8CX0pOw0KDQoJCXRleHQ6IGZ1bmN0aW9uKHhocil7IA0KCQkJLy8gc3VtbWFyeTogQSBjb250ZW50SGFuZGxlciB3aGljaCBzaW1wbHkgcmV0dXJucyB0aGUgcGxhaW50ZXh0IHJlc3BvbnNlIGRhdGENCgkJCXJldHVybiB4aHIucmVzcG9uc2VUZXh0OyANCgkJfSwNCgkJanNvbjogZnVuY3Rpb24oeGhyKXsNCgkJCS8vIHN1bW1hcnk6IEEgY29udGVudEhhbmRsZXIgd2hpY2ggcmV0dXJucyBhIEphdmFTY3JpcHQgb2JqZWN0IGNyZWF0ZWQgZnJvbSB0aGUgcmVzcG9uc2UgZGF0YQ0KCQkJcmV0dXJuIF9kLmZyb21Kc29uKHhoci5yZXNwb25zZVRleHQgfHwgbnVsbCk7DQoJCX0sDQoJCSJqc29uLWNvbW1lbnQtZmlsdGVyZWQiOiBmdW5jdGlvbih4aHIpeyANCgkJCS8vIHN1bW1hcnk6IEEgY29udGVudEhhbmRsZXIgd2hpY2ggZXhwZWN0cyBjb21tZW50LWZpbHRlcmVkIEpTT04uIA0KCQkJLy8gZGVzY3JpcHRpb246IA0KCQkJLy8JCUEgY29udGVudEhhbmRsZXIgd2hpY2ggZXhwZWN0cyBjb21tZW50LWZpbHRlcmVkIEpTT04uIA0KCQkJLy8JCXRoZSBqc29uLWNvbW1lbnQtZmlsdGVyZWQgb3B0aW9uIHdhcyBpbXBsZW1lbnRlZCB0byBwcmV2ZW50DQoJCQkvLwkJIkphdmFTY3JpcHQgSGlqYWNraW5nIiwgYnV0IGl0IGlzIGxlc3Mgc2VjdXJlIHRoYW4gc3RhbmRhcmQgSlNPTi4gVXNlDQoJCQkvLwkJc3RhbmRhcmQgSlNPTiBpbnN0ZWFkLiBKU09OIHByZWZpeGluZyBjYW4gYmUgdXNlZCB0byBzdWJ2ZXJ0IGhpamFja2luZy4NCgkJCS8vCQkNCgkJCS8vCQlXaWxsIHRocm93IGEgbm90aWNlIHN1Z2dlc3RpbmcgdG8gdXNlIGFwcGxpY2F0aW9uL2pzb24gbWltZXR5cGUsIGFzDQoJCQkvLwkJanNvbi1jb21tZW50aW5nIGNhbiBpbnRyb2R1Y2Ugc2VjdXJpdHkgaXNzdWVzLiBUbyBkZWNyZWFzZSB0aGUgY2hhbmNlcyBvZiBoaWphY2tpbmcsDQoJCQkvLwkJdXNlIHRoZSBzdGFuZGFyZCBganNvbmAgY29udGVudEhhbmRsZXIsIGFuZCBwcmVmaXggeW91ciAiSlNPTiIgd2l0aDoge30mJiANCgkJCS8vCQkNCgkJCS8vCQl1c2UgZGpDb25maWcudXNlQ29tbWVudGVkSnNvbiA9IHRydWUgdG8gdHVybiBvZmYgdGhlIG5vdGljZQ0KCQkJaWYoIWRvam8uY29uZmlnLnVzZUNvbW1lbnRlZEpzb24pew0KCQkJCWNvbnNvbGUud2FybigiQ29uc2lkZXIgdXNpbmcgdGhlIHN0YW5kYXJkIG1pbWV0eXBlOmFwcGxpY2F0aW9uL2pzb24uIg0KCQkJCQkrICIganNvbi1jb21tZW50aW5nIGNhbiBpbnRyb2R1Y2Ugc2VjdXJpdHkgaXNzdWVzLiBUbyINCgkJCQkJKyAiIGRlY3JlYXNlIHRoZSBjaGFuY2VzIG9mIGhpamFja2luZywgdXNlIHRoZSBzdGFuZGFyZCB0aGUgJ2pzb24nIGhhbmRsZXIgYW5kIg0KCQkJCQkrICIgcHJlZml4IHlvdXIganNvbiB3aXRoOiB7fSYmXG4iDQoJCQkJCSsgIlVzZSBkakNvbmZpZy51c2VDb21tZW50ZWRKc29uPXRydWUgdG8gdHVybiBvZmYgdGhpcyBtZXNzYWdlLiIpOw0KCQkJfQ0KDQoJCQl2YXIgdmFsdWUgPSB4aHIucmVzcG9uc2VUZXh0Ow0KCQkJdmFyIGNTdGFydElkeCA9IHZhbHVlLmluZGV4T2YoIlwvKiIpOw0KCQkJdmFyIGNFbmRJZHggPSB2YWx1ZS5sYXN0SW5kZXhPZigiKlwvIik7DQoJCQlpZihjU3RhcnRJZHggPT0gLTEgfHwgY0VuZElkeCA9PSAtMSl7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJKU09OIHdhcyBub3QgY29tbWVudCBmaWx0ZXJlZCIpOw0KCQkJfQ0KCQkJcmV0dXJuIF9kLmZyb21Kc29uKHZhbHVlLnN1YnN0cmluZyhjU3RhcnRJZHgrMiwgY0VuZElkeCkpOw0KCQl9LA0KCQlqYXZhc2NyaXB0OiBmdW5jdGlvbih4aHIpeyANCgkJCS8vIHN1bW1hcnk6IEEgY29udGVudEhhbmRsZXIgd2hpY2ggZXZhbHVhdGVzIHRoZSByZXNwb25zZSBkYXRhLCBleHBlY3RpbmcgaXQgdG8gYmUgdmFsaWQgSmF2YVNjcmlwdA0KDQoJCQkvLyBGSVhNRTogdHJ5IE1veiBhbmQgSUUgc3BlY2lmaWMgZXZhbCB2YXJpYW50cz8NCgkJCXJldHVybiBfZC5ldmFsKHhoci5yZXNwb25zZVRleHQpOw0KCQl9LA0KCQl4bWw6IGZ1bmN0aW9uKHhocil7DQoJCQkvLyBzdW1tYXJ5OiBBIGNvbnRlbnRIYW5kbGVyIHJldHVybmluZyBhbiBYTUwgRG9jdW1lbnQgcGFyc2VkIGZyb20gdGhlIHJlc3BvbnNlIGRhdGENCgkJCXZhciByZXN1bHQgPSB4aHIucmVzcG9uc2VYTUw7DQoJCQkJCQlpZihfZC5pc0lFICYmICghcmVzdWx0IHx8ICFyZXN1bHQuZG9jdW1lbnRFbGVtZW50KSl7DQoJCQkJLy9XQVJOSU5HOiB0aGlzIGJyYW5jaCB1c2VkIGJ5IHRoZSB4bWwgaGFuZGxpbmcgaW4gZG9qby5pby5pZnJhbWUsDQoJCQkJLy9zbyBiZSBzdXJlIHRvIHRlc3QgZG9qby5pby5pZnJhbWUgaWYgbWFraW5nIGNoYW5nZXMgYmVsb3cuDQoJCQkJdmFyIG1zID0gZnVuY3Rpb24obil7IHJldHVybiAiTVNYTUwiICsgbiArICIuRE9NRG9jdW1lbnQiOyB9DQoJCQkJdmFyIGRwID0gWyJNaWNyb3NvZnQuWE1MRE9NIiwgbXMoNiksIG1zKDQpLCBtcygzKSwgbXMoMildOw0KCQkJCV9kLnNvbWUoZHAsIGZ1bmN0aW9uKHApew0KCQkJCQl0cnl7DQoJCQkJCQl2YXIgZG9tID0gbmV3IEFjdGl2ZVhPYmplY3QocCk7DQoJCQkJCQlkb20uYXN5bmMgPSBmYWxzZTsNCgkJCQkJCWRvbS5sb2FkWE1MKHhoci5yZXNwb25zZVRleHQpOw0KCQkJCQkJcmVzdWx0ID0gZG9tOw0KCQkJCQl9Y2F0Y2goZSl7IHJldHVybiBmYWxzZTsgfQ0KCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQl9KTsNCgkJCX0NCgkJCQkJCXJldHVybiByZXN1bHQ7IC8vIERPTURvY3VtZW50DQoJCX0sDQoJCSJqc29uLWNvbW1lbnQtb3B0aW9uYWwiOiBmdW5jdGlvbih4aHIpew0KCQkJLy8gc3VtbWFyeTogQSBjb250ZW50SGFuZGxlciB3aGljaCBjaGVja3MgdGhlIHByZXNlbmNlIG9mIGNvbW1lbnQtZmlsdGVyZWQgSlNPTiBhbmQgDQoJCQkvLwkJYWx0ZXJuYXRlcyBiZXR3ZWVuIHRoZSBganNvbmAgYW5kIGBqc29uLWNvbW1lbnQtZmlsdGVyZWRgIGNvbnRlbnRIYW5kbGVycy4NCgkJCWlmKHhoci5yZXNwb25zZVRleHQgJiYgL15bXntcW10qXC9cKi8udGVzdCh4aHIucmVzcG9uc2VUZXh0KSl7DQoJCQkJcmV0dXJuIGhhbmRsZXJzWyJqc29uLWNvbW1lbnQtZmlsdGVyZWQiXSh4aHIpOw0KCQkJfWVsc2V7DQoJCQkJcmV0dXJuIGhhbmRsZXJzWyJqc29uIl0oeGhyKTsNCgkJCX0NCgkJfQ0KCX07DQoNCgkvKj09PT09DQoJZG9qby5fX0lvQXJncyA9IGZ1bmN0aW9uKCl7DQoJCS8vCXVybDogU3RyaW5nDQoJCS8vCQlVUkwgdG8gc2VydmVyIGVuZHBvaW50Lg0KCQkvLwljb250ZW50OiBPYmplY3Q/DQoJCS8vCQlDb250YWlucyBwcm9wZXJ0aWVzIHdpdGggc3RyaW5nIHZhbHVlcy4gVGhlc2UNCgkJLy8JCXByb3BlcnRpZXMgd2lsbCBiZSBzZXJpYWxpemVkIGFzIG5hbWUxPXZhbHVlMiBhbmQNCgkJLy8JCXBhc3NlZCBpbiB0aGUgcmVxdWVzdC4NCgkJLy8JdGltZW91dDogSW50ZWdlcj8NCgkJLy8JCU1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgcmVzcG9uc2UuIElmIHRoaXMgdGltZQ0KCQkvLwkJcGFzc2VzLCB0aGUgdGhlbiBlcnJvciBjYWxsYmFja3MgYXJlIGNhbGxlZC4NCgkJLy8JZm9ybTogRE9NTm9kZT8NCgkJLy8JCURPTSBub2RlIGZvciBhIGZvcm0uIFVzZWQgdG8gZXh0cmFjdCB0aGUgZm9ybSB2YWx1ZXMNCgkJLy8JCWFuZCBzZW5kIHRvIHRoZSBzZXJ2ZXIuDQoJCS8vCXByZXZlbnRDYWNoZTogQm9vbGVhbj8NCgkJLy8JCURlZmF1bHQgaXMgZmFsc2UuIElmIHRydWUsIHRoZW4gYQ0KCQkvLwkJImRvam8ucHJldmVudENhY2hlIiBwYXJhbWV0ZXIgaXMgc2VudCBpbiB0aGUgcmVxdWVzdA0KCQkvLwkJd2l0aCBhIHZhbHVlIHRoYXQgY2hhbmdlcyB3aXRoIGVhY2ggcmVxdWVzdA0KCQkvLwkJKHRpbWVzdGFtcCkuIFVzZWZ1bCBvbmx5IHdpdGggR0VULXR5cGUgcmVxdWVzdHMuDQoJCS8vCWhhbmRsZUFzOiBTdHJpbmc/DQoJCS8vCQlBY2NlcHRhYmxlIHZhbHVlcyBkZXBlbmQgb24gdGhlIHR5cGUgb2YgSU8NCgkJLy8JCXRyYW5zcG9ydCAoc2VlIHNwZWNpZmljIElPIGNhbGxzIGZvciBtb3JlIGluZm9ybWF0aW9uKS4NCgkJLy8gCXJhd0JvZHk6IFN0cmluZz8NCgkJLy8gCQlTZXRzIHRoZSByYXcgYm9keSBmb3IgYW4gSFRUUCByZXF1ZXN0LiBJZiB0aGlzIGlzIHVzZWQsIHRoZW4gdGhlIGNvbnRlbnQNCgkJLy8gCQlwcm9wZXJ0eSBpcyBpZ25vcmVkLiBUaGlzIGlzIG1vc3RseSB1c2VmdWwgZm9yIEhUVFAgbWV0aG9kcyB0aGF0IGhhdmUNCgkJLy8gCQlhIGJvZHkgdG8gdGhlaXIgcmVxdWVzdHMsIGxpa2UgUFVUIG9yIFBPU1QuIFRoaXMgcHJvcGVydHkgY2FuIGJlIHVzZWQgaW5zdGVhZA0KCQkvLyAJCW9mIHBvc3REYXRhIGFuZCBwdXREYXRhIGZvciBkb2pvLnJhd1hoclBvc3QgYW5kIGRvam8ucmF3WGhyUHV0IHJlc3BlY3RpdmVseS4NCgkJLy8JaW9QdWJsaXNoOiBCb29sZWFuPw0KCQkvLwkJU2V0IHRoaXMgZXhwbGljaXRseSB0byBmYWxzZSB0byBwcmV2ZW50IHB1Ymxpc2hpbmcgb2YgdG9waWNzIHJlbGF0ZWQgdG8NCgkJLy8gCQlJTyBvcGVyYXRpb25zLiBPdGhlcndpc2UsIGlmIGRqQ29uZmlnLmlvUHVibGlzaCBpcyBzZXQgdG8gdHJ1ZSwgdG9waWNzDQoJCS8vIAkJd2lsbCBiZSBwdWJsaXNoZWQgdmlhIGRvam8ucHVibGlzaCBmb3IgZGlmZmVyZW50IHBoYXNlcyBvZiBhbiBJTyBvcGVyYXRpb24uDQoJCS8vIAkJU2VlIGRvam8uX19Jb1B1Ymxpc2ggZm9yIGEgbGlzdCBvZiB0b3BpY3MgdGhhdCBhcmUgcHVibGlzaGVkLg0KCQkvLwlsb2FkOiBGdW5jdGlvbj8NCgkJLy8JCVRoaXMgZnVuY3Rpb24gd2lsbCBiZQ0KCQkvLwkJY2FsbGVkIG9uIGEgc3VjY2Vzc2Z1bCBIVFRQIHJlc3BvbnNlIGNvZGUuDQoJCS8vCWVycm9yOiBGdW5jdGlvbj8NCgkJLy8JCVRoaXMgZnVuY3Rpb24gd2lsbA0KCQkvLwkJYmUgY2FsbGVkIHdoZW4gdGhlIHJlcXVlc3QgZmFpbHMgZHVlIHRvIGEgbmV0d29yayBvciBzZXJ2ZXIgZXJyb3IsIHRoZSB1cmwNCgkJLy8JCWlzIGludmFsaWQsIGV0Yy4gSXQgd2lsbCBhbHNvIGJlIGNhbGxlZCBpZiB0aGUgbG9hZCBvciBoYW5kbGUgY2FsbGJhY2sgdGhyb3dzIGFuDQoJCS8vCQlleGNlcHRpb24sIHVubGVzcyBkakNvbmZpZy5kZWJ1Z0F0QWxsQ29zdHMgaXMgdHJ1ZS4gIFRoaXMgYWxsb3dzIGRlcGxveWVkIGFwcGxpY2F0aW9ucw0KCQkvLwkJdG8gY29udGludWUgdG8gcnVuIGV2ZW4gd2hlbiBhIGxvZ2ljIGVycm9yIGhhcHBlbnMgaW4gdGhlIGNhbGxiYWNrLCB3aGlsZSBtYWtpbmcNCgkJLy8JCWl0IGVhc2llciB0byB0cm91Ymxlc2hvb3Qgd2hpbGUgaW4gZGVidWcgbW9kZS4NCgkJLy8JaGFuZGxlOiBGdW5jdGlvbj8NCgkJLy8JCVRoaXMgZnVuY3Rpb24gd2lsbA0KCQkvLwkJYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgZXZlcnkgcmVxdWVzdCwgd2hldGhlciBvciBub3QgYW4gZXJyb3Igb2NjdXJzLg0KCQl0aGlzLnVybCA9IHVybDsNCgkJdGhpcy5jb250ZW50ID0gY29udGVudDsNCgkJdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCgkJdGhpcy5mb3JtID0gZm9ybTsNCgkJdGhpcy5wcmV2ZW50Q2FjaGUgPSBwcmV2ZW50Q2FjaGU7DQoJCXRoaXMuaGFuZGxlQXMgPSBoYW5kbGVBczsNCgkJdGhpcy5pb1B1Ymxpc2ggPSBpb1B1Ymxpc2g7DQoJCXRoaXMubG9hZCA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBpb0FyZ3Mpew0KCQkJLy8gaW9BcmdzOiBkb2pvLl9fSW9DYWxsYmFja0FyZ3MNCgkJCS8vCQlQcm92aWRlcyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSByZXF1ZXN0Lg0KCQkJLy8gcmVzcG9uc2U6IE9iamVjdA0KCQkJLy8JCVRoZSByZXNwb25zZSBpbiB0aGUgZm9ybWF0IGFzIGRlZmluZWQgd2l0aCBoYW5kbGVBcy4NCgkJfQ0KCQl0aGlzLmVycm9yID0gZnVuY3Rpb24ocmVzcG9uc2UsIGlvQXJncyl7DQoJCQkvLyBpb0FyZ3M6IGRvam8uX19Jb0NhbGxiYWNrQXJncw0KCQkJLy8JCVByb3ZpZGVzIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHJlcXVlc3QuDQoJCQkvLyByZXNwb25zZTogT2JqZWN0DQoJCQkvLwkJVGhlIHJlc3BvbnNlIGluIHRoZSBmb3JtYXQgYXMgZGVmaW5lZCB3aXRoIGhhbmRsZUFzLg0KCQl9DQoJCXRoaXMuaGFuZGxlID0gZnVuY3Rpb24obG9hZE9yRXJyb3IsIHJlc3BvbnNlLCBpb0FyZ3Mpew0KCQkJLy8gbG9hZE9yRXJyb3I6IFN0cmluZw0KCQkJLy8JCVByb3ZpZGVzIGEgc3RyaW5nIHRoYXQgdGVsbHMgeW91IHdoZXRoZXIgdGhpcyBmdW5jdGlvbg0KCQkJLy8JCXdhcyBjYWxsZWQgYmVjYXVzZSBvZiBzdWNjZXNzIChsb2FkKSBvciBmYWlsdXJlIChlcnJvcikuDQoJCQkvLyByZXNwb25zZTogT2JqZWN0DQoJCQkvLwkJVGhlIHJlc3BvbnNlIGluIHRoZSBmb3JtYXQgYXMgZGVmaW5lZCB3aXRoIGhhbmRsZUFzLg0KCQkJLy8gaW9BcmdzOiBkb2pvLl9fSW9DYWxsYmFja0FyZ3MNCgkJCS8vCQlQcm92aWRlcyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSByZXF1ZXN0Lg0KCQl9DQoJfQ0KCT09PT09Ki8NCg0KCS8qPT09PT0NCglkb2pvLl9fSW9DYWxsYmFja0FyZ3MgPSBmdW5jdGlvbihhcmdzLCB4aHIsIHVybCwgcXVlcnksIGhhbmRsZUFzLCBpZCwgY2FuRGVsZXRlLCBqc29uKXsNCgkJLy8JYXJnczogT2JqZWN0DQoJCS8vCQl0aGUgb3JpZ2luYWwgb2JqZWN0IGFyZ3VtZW50IHRvIHRoZSBJTyBjYWxsLg0KCQkvLwl4aHI6IFhNTEh0dHBSZXF1ZXN0DQoJCS8vCQlGb3IgWE1MSHR0cFJlcXVlc3QgY2FsbHMgb25seSwgdGhlDQoJCS8vCQlYTUxIdHRwUmVxdWVzdCBvYmplY3QgdGhhdCB3YXMgdXNlZCBmb3IgdGhlDQoJCS8vCQlyZXF1ZXN0Lg0KCQkvLwl1cmw6IFN0cmluZw0KCQkvLwkJVGhlIGZpbmFsIFVSTCB1c2VkIGZvciB0aGUgY2FsbC4gTWFueSB0aW1lcyBpdA0KCQkvLwkJd2lsbCBiZSBkaWZmZXJlbnQgdGhhbiB0aGUgb3JpZ2luYWwgYXJncy51cmwNCgkJLy8JCXZhbHVlLg0KCQkvLwlxdWVyeTogU3RyaW5nDQoJCS8vCQlGb3Igbm9uLUdFVCByZXF1ZXN0cywgdGhlDQoJCS8vCQluYW1lMT12YWx1ZTEmbmFtZTI9dmFsdWUyIHBhcmFtZXRlcnMgc2VudCB1cCBpbg0KCQkvLwkJdGhlIHJlcXVlc3QuDQoJCS8vCWhhbmRsZUFzOiBTdHJpbmcNCgkJLy8JCVRoZSBmaW5hbCBpbmRpY2F0b3Igb24gaG93IHRoZSByZXNwb25zZSB3aWxsIGJlDQoJCS8vCQloYW5kbGVkLg0KCQkvLwlpZDogU3RyaW5nDQoJCS8vCQlGb3IgZG9qby5pby5zY3JpcHQgY2FsbHMgb25seSwgdGhlIGludGVybmFsDQoJCS8vCQlzY3JpcHQgSUQgdXNlZCBmb3IgdGhlIHJlcXVlc3QuDQoJCS8vCWNhbkRlbGV0ZTogQm9vbGVhbg0KCQkvLwkJRm9yIGRvam8uaW8uc2NyaXB0IGNhbGxzIG9ubHksIGluZGljYXRlcw0KCQkvLwkJd2hldGhlciB0aGUgc2NyaXB0IHRhZyB0aGF0IHJlcHJlc2VudHMgdGhlDQoJCS8vCQlyZXF1ZXN0IGNhbiBiZSBkZWxldGVkIGFmdGVyIGNhbGxiYWNrcyBoYXZlDQoJCS8vCQliZWVuIGNhbGxlZC4gVXNlZCBpbnRlcm5hbGx5IHRvIGtub3cgd2hlbg0KCQkvLwkJY2xlYW51cCBjYW4gaGFwcGVuIG9uIEpTT05QLXR5cGUgcmVxdWVzdHMuDQoJCS8vCWpzb246IE9iamVjdA0KCQkvLwkJRm9yIGRvam8uaW8uc2NyaXB0IGNhbGxzIG9ubHk6IGhvbGRzIHRoZSBKU09ODQoJCS8vCQlyZXNwb25zZSBmb3IgSlNPTlAtdHlwZSByZXF1ZXN0cy4gVXNlZA0KCQkvLwkJaW50ZXJuYWxseSB0byBob2xkIG9uIHRvIHRoZSBKU09OIHJlc3BvbnNlcy4NCgkJLy8JCVlvdSBzaG91bGQgbm90IG5lZWQgdG8gYWNjZXNzIGl0IGRpcmVjdGx5IC0tDQoJCS8vCQl0aGUgc2FtZSBvYmplY3Qgc2hvdWxkIGJlIHBhc3NlZCB0byB0aGUgc3VjY2Vzcw0KCQkvLwkJY2FsbGJhY2tzIGRpcmVjdGx5Lg0KCQl0aGlzLmFyZ3MgPSBhcmdzOw0KCQl0aGlzLnhociA9IHhocjsNCgkJdGhpcy51cmwgPSB1cmw7DQoJCXRoaXMucXVlcnkgPSBxdWVyeTsNCgkJdGhpcy5oYW5kbGVBcyA9IGhhbmRsZUFzOw0KCQl0aGlzLmlkID0gaWQ7DQoJCXRoaXMuY2FuRGVsZXRlID0gY2FuRGVsZXRlOw0KCQl0aGlzLmpzb24gPSBqc29uOw0KCX0NCgk9PT09PSovDQoNCg0KCS8qPT09PT0NCglkb2pvLl9fSW9QdWJsaXNoID0gZnVuY3Rpb24oKXsNCgkJLy8gCXN1bW1hcnk6DQoJCS8vIAkJVGhpcyBpcyBhIGxpc3Qgb2YgSU8gdG9waWNzIHRoYXQgY2FuIGJlIHB1Ymxpc2hlZA0KCQkvLyAJCWlmIGRqQ29uZmlnLmlvUHVibGlzaCBpcyBzZXQgdG8gdHJ1ZS4gSU8gdG9waWNzIGNhbiBiZQ0KCQkvLyAJCXB1Ymxpc2hlZCBmb3IgYW55IElucHV0L091dHB1dCwgbmV0d29yayBvcGVyYXRpb24uIFNvLA0KCQkvLyAJCWRvam8ueGhyLCBkb2pvLmlvLnNjcmlwdCBhbmQgZG9qby5pby5pZnJhbWUgY2FuIGFsbA0KCQkvLyAJCXRyaWdnZXIgdGhlc2UgdG9waWNzIHRvIGJlIHB1Ymxpc2hlZC4NCgkJLy8Jc3RhcnQ6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL3N0YXJ0IiBpcyBzZW50IHdoZW4gdGhlcmUgYXJlIG5vIG91dHN0YW5kaW5nIElPDQoJCS8vIAkJcmVxdWVzdHMsIGFuZCBhIG5ldyBJTyByZXF1ZXN0IGlzIHN0YXJ0ZWQuIE5vIGFyZ3VtZW50cw0KCQkvLyAJCWFyZSBwYXNzZWQgd2l0aCB0aGlzIHRvcGljLg0KCQkvLwlzZW5kOiBTdHJpbmcNCgkJLy8JCSIvZG9qby9pby9zZW5kIiBpcyBzZW50IHdoZW5ldmVyIGEgbmV3IElPIHJlcXVlc3QgaXMgc3RhcnRlZC4NCgkJLy8gCQlJdCBwYXNzZXMgdGhlIGRvam8uRGVmZXJyZWQgZm9yIHRoZSByZXF1ZXN0IHdpdGggdGhlIHRvcGljLg0KCQkvLwlsb2FkOiBTdHJpbmcNCgkJLy8JCSIvZG9qby9pby9sb2FkIiBpcyBzZW50IHdoZW5ldmVyIGFuIElPIHJlcXVlc3QgaGFzIGxvYWRlZA0KCQkvLyAJCXN1Y2Nlc3NmdWxseS4gSXQgcGFzc2VzIHRoZSByZXNwb25zZSBhbmQgdGhlIGRvam8uRGVmZXJyZWQNCgkJLy8gCQlmb3IgdGhlIHJlcXVlc3Qgd2l0aCB0aGUgdG9waWMuDQoJCS8vCWVycm9yOiBTdHJpbmcNCgkJLy8JCSIvZG9qby9pby9lcnJvciIgaXMgc2VudCB3aGVuZXZlciBhbiBJTyByZXF1ZXN0IGhhcyBlcnJvcmVkLg0KCQkvLyAJCUl0IHBhc3NlcyB0aGUgZXJyb3IgYW5kIHRoZSBkb2pvLkRlZmVycmVkDQoJCS8vIAkJZm9yIHRoZSByZXF1ZXN0IHdpdGggdGhlIHRvcGljLg0KCQkvLwlkb25lOiBTdHJpbmcNCgkJLy8JCSIvZG9qby9pby9kb25lIiBpcyBzZW50IHdoZW5ldmVyIGFuIElPIHJlcXVlc3QgaGFzIGNvbXBsZXRlZCwNCgkJLy8gCQllaXRoZXIgYnkgbG9hZGluZyBvciBieSBlcnJvcmluZy4gSXQgcGFzc2VzIHRoZSBlcnJvciBhbmQNCgkJLy8gCQl0aGUgZG9qby5EZWZlcnJlZCBmb3IgdGhlIHJlcXVlc3Qgd2l0aCB0aGUgdG9waWMuDQoJCS8vCXN0b3A6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL3N0b3AiIGlzIHNlbnQgd2hlbiBhbGwgb3V0c3RhbmRpbmcgSU8gcmVxdWVzdHMgaGF2ZQ0KCQkvLyAJCWZpbmlzaGVkLiBObyBhcmd1bWVudHMgYXJlIHBhc3NlZCB3aXRoIHRoaXMgdG9waWMuDQoJCXRoaXMuc3RhcnQgPSAiL2Rvam8vaW8vc3RhcnQiOw0KCQl0aGlzLnNlbmQgPSAiL2Rvam8vaW8vc2VuZCI7DQoJCXRoaXMubG9hZCA9ICIvZG9qby9pby9sb2FkIjsNCgkJdGhpcy5lcnJvciA9ICIvZG9qby9pby9lcnJvciI7DQoJCXRoaXMuZG9uZSA9ICIvZG9qby9pby9kb25lIjsNCgkJdGhpcy5zdG9wID0gIi9kb2pvL2lvL3N0b3AiOw0KCX0NCgk9PT09PSovDQoNCg0KCWRvam8uX2lvU2V0QXJncyA9IGZ1bmN0aW9uKC8qZG9qby5fX0lvQXJncyovYXJncywNCgkJCS8qRnVuY3Rpb24qL2NhbmNlbGxlciwNCgkJCS8qRnVuY3Rpb24qL29rSGFuZGxlciwNCgkJCS8qRnVuY3Rpb24qL2VyckhhbmRsZXIpew0KCQkvLwlzdW1tYXJ5OiANCgkJLy8JCXNldHMgdXAgdGhlIERlZmVycmVkIGFuZCBpb0FyZ3MgcHJvcGVydHkgb24gdGhlIERlZmVycmVkIHNvIGl0DQoJCS8vCQljYW4gYmUgdXNlZCBpbiBhbiBpbyBjYWxsLg0KCQkvLwlhcmdzOg0KCQkvLwkJVGhlIGFyZ3Mgb2JqZWN0IHBhc3NlZCBpbnRvIHRoZSBwdWJsaWMgaW8gY2FsbC4gUmVjb2duaXplZCBwcm9wZXJ0aWVzIG9uDQoJCS8vCQl0aGUgYXJncyBvYmplY3QgYXJlOg0KCQkvLwljYW5jZWxsZXI6DQoJCS8vCQlUaGUgY2FuY2VsbGVyIGZ1bmN0aW9uIHVzZWQgZm9yIHRoZSBEZWZlcnJlZCBvYmplY3QuIFRoZSBmdW5jdGlvbg0KCQkvLwkJd2lsbCByZWNlaXZlIG9uZSBhcmd1bWVudCwgdGhlIERlZmVycmVkIG9iamVjdCB0aGF0IGlzIHJlbGF0ZWQgdG8gdGhlDQoJCS8vCQljYW5jZWxsZXIuDQoJCS8vCW9rSGFuZGxlcjoNCgkJLy8JCVRoZSBmaXJzdCBPSyBjYWxsYmFjayB0byBiZSByZWdpc3RlcmVkIHdpdGggRGVmZXJyZWQuIEl0IGhhcyB0aGUgb3Bwb3J0dW5pdHkNCgkJLy8JCXRvIHRyYW5zZm9ybSB0aGUgT0sgcmVzcG9uc2UuIEl0IHdpbGwgcmVjZWl2ZSBvbmUgYXJndW1lbnQgLS0gdGhlIERlZmVycmVkDQoJCS8vCQlvYmplY3QgcmV0dXJuZWQgZnJvbSB0aGlzIGZ1bmN0aW9uLg0KCQkvLwllcnJIYW5kbGVyOg0KCQkvLwkJVGhlIGZpcnN0IGVycm9yIGNhbGxiYWNrIHRvIGJlIHJlZ2lzdGVyZWQgd2l0aCBEZWZlcnJlZC4gSXQgaGFzIHRoZSBvcHBvcnR1bml0eQ0KCQkvLwkJdG8gZG8gY2xlYW51cCBvbiBhbiBlcnJvci4gSXQgd2lsbCByZWNlaXZlIHR3byBhcmd1bWVudHM6IGVycm9yICh0aGUgDQoJCS8vCQlFcnJvciBvYmplY3QpIGFuZCBkZmQsIHRoZSBEZWZlcnJlZCBvYmplY3QgcmV0dXJuZWQgZnJvbSB0aGlzIGZ1bmN0aW9uLg0KDQoJCXZhciBpb0FyZ3MgPSB7YXJnczogYXJncywgdXJsOiBhcmdzLnVybH07DQoNCgkJLy9HZXQgdmFsdWVzIGZyb20gZm9ybSBpZiByZXF1ZXN0ZC4NCgkJdmFyIGZvcm1PYmplY3QgPSBudWxsOw0KCQlpZihhcmdzLmZvcm0peyANCgkJCXZhciBmb3JtID0gX2QuYnlJZChhcmdzLmZvcm0pOw0KCQkJLy9JRSByZXF1aXJlcyBnb2luZyB0aHJvdWdoIGdldEF0dHJpYnV0ZU5vZGUgaW5zdGVhZCBvZiBqdXN0IGdldEF0dHJpYnV0ZSBpbiBzb21lIGZvcm0gY2FzZXMsIA0KCQkJLy9zbyB1c2UgaXQgZm9yIGFsbC4gIFNlZSAjMjg0NA0KCQkJdmFyIGFjdG5Ob2RlID0gZm9ybS5nZXRBdHRyaWJ1dGVOb2RlKCJhY3Rpb24iKTsNCgkJCWlvQXJncy51cmwgPSBpb0FyZ3MudXJsIHx8IChhY3RuTm9kZSA/IGFjdG5Ob2RlLnZhbHVlIDogbnVsbCk7IA0KCQkJZm9ybU9iamVjdCA9IF9kLmZvcm1Ub09iamVjdChmb3JtKTsNCgkJfQ0KDQoJCS8vIHNldCB1cCB0aGUgcXVlcnkgcGFyYW1zDQoJCXZhciBtaUFyZ3MgPSBbe31dOw0KCQ0KCQlpZihmb3JtT2JqZWN0KXsNCgkJCS8vIHBvdGVudGlhbGx5IG92ZXItcmlkZSB1cmwtcHJvdmlkZWQgcGFyYW1zIHcvIGZvcm0gdmFsdWVzDQoJCQltaUFyZ3MucHVzaChmb3JtT2JqZWN0KTsNCgkJfQ0KCQlpZihhcmdzLmNvbnRlbnQpew0KCQkJLy8gc3R1ZmYgaW4gY29udGVudCBvdmVyLXJpZGVzIHdoYXQncyBzZXQgYnkgZm9ybQ0KCQkJbWlBcmdzLnB1c2goYXJncy5jb250ZW50KTsNCgkJfQ0KCQlpZihhcmdzLnByZXZlbnRDYWNoZSl7DQoJCQltaUFyZ3MucHVzaCh7ImRvam8ucHJldmVudENhY2hlIjogbmV3IERhdGUoKS52YWx1ZU9mKCl9KTsNCgkJfQ0KCQlpb0FyZ3MucXVlcnkgPSBfZC5vYmplY3RUb1F1ZXJ5KF9kLm1peGluLmFwcGx5KG51bGwsIG1pQXJncykpOw0KCQ0KCQkvLyAuLiBhbmQgdGhlIHJlYWwgd29yayBvZiBnZXR0aW5nIHRoZSBkZWZlcnJlZCBpbiBvcmRlciwgZXRjLg0KCQlpb0FyZ3MuaGFuZGxlQXMgPSBhcmdzLmhhbmRsZUFzIHx8ICJ0ZXh0IjsNCgkJdmFyIGQgPSBuZXcgX2QuRGVmZXJyZWQoY2FuY2VsbGVyKTsNCgkJZC5hZGRDYWxsYmFja3Mob2tIYW5kbGVyLCBmdW5jdGlvbihlcnJvcil7DQoJCQlyZXR1cm4gZXJySGFuZGxlcihlcnJvciwgZCk7DQoJCX0pOw0KDQoJCS8vU3VwcG9ydCBzcGVjaWZ5aW5nIGxvYWQsIGVycm9yIGFuZCBoYW5kbGUgY2FsbGJhY2sgZnVuY3Rpb25zIGZyb20gdGhlIGFyZ3MuDQoJCS8vRm9yIHRob3NlIGNhbGxiYWNrcywgdGhlICJ0aGlzIiBvYmplY3Qgd2lsbCBiZSB0aGUgYXJncyBvYmplY3QuDQoJCS8vVGhlIGNhbGxiYWNrcyB3aWxsIGdldCB0aGUgZGVmZXJyZWQgcmVzdWx0IHZhbHVlIGFzIHRoZQ0KCQkvL2ZpcnN0IGFyZ3VtZW50IGFuZCB0aGUgaW9BcmdzIG9iamVjdCBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50Lg0KCQl2YXIgbGQgPSBhcmdzLmxvYWQ7DQoJCWlmKGxkICYmIF9kLmlzRnVuY3Rpb24obGQpKXsNCgkJCWQuYWRkQ2FsbGJhY2soZnVuY3Rpb24odmFsdWUpew0KCQkJCXJldHVybiBsZC5jYWxsKGFyZ3MsIHZhbHVlLCBpb0FyZ3MpOw0KCQkJfSk7DQoJCX0NCgkJdmFyIGVyciA9IGFyZ3MuZXJyb3I7DQoJCWlmKGVyciAmJiBfZC5pc0Z1bmN0aW9uKGVycikpew0KCQkJZC5hZGRFcnJiYWNrKGZ1bmN0aW9uKHZhbHVlKXsNCgkJCQlyZXR1cm4gZXJyLmNhbGwoYXJncywgdmFsdWUsIGlvQXJncyk7DQoJCQl9KTsNCgkJfQ0KCQl2YXIgaGFuZGxlID0gYXJncy5oYW5kbGU7DQoJCWlmKGhhbmRsZSAmJiBfZC5pc0Z1bmN0aW9uKGhhbmRsZSkpew0KCQkJZC5hZGRCb3RoKGZ1bmN0aW9uKHZhbHVlKXsNCgkJCQlyZXR1cm4gaGFuZGxlLmNhbGwoYXJncywgdmFsdWUsIGlvQXJncyk7DQoJCQl9KTsNCgkJfQ0KDQoJCS8vUGx1ZyBpbiB0b3BpYyBwdWJsaXNoaW5nLCBpZiBkb2pvLnB1Ymxpc2ggaXMgbG9hZGVkLg0KCQlpZihjZmcuaW9QdWJsaXNoICYmIF9kLnB1Ymxpc2ggJiYgaW9BcmdzLmFyZ3MuaW9QdWJsaXNoICE9PSBmYWxzZSl7DQoJCQlkLmFkZENhbGxiYWNrcygNCgkJCQlmdW5jdGlvbihyZXMpew0KCQkJCQlfZC5wdWJsaXNoKCIvZG9qby9pby9sb2FkIiwgW2QsIHJlc10pOw0KCQkJCQlyZXR1cm4gcmVzOw0KCQkJCX0sDQoJCQkJZnVuY3Rpb24ocmVzKXsNCgkJCQkJX2QucHVibGlzaCgiL2Rvam8vaW8vZXJyb3IiLCBbZCwgcmVzXSk7DQoJCQkJCXJldHVybiByZXM7DQoJCQkJfQ0KCQkJKTsNCgkJCWQuYWRkQm90aChmdW5jdGlvbihyZXMpew0KCQkJCV9kLnB1Ymxpc2goIi9kb2pvL2lvL2RvbmUiLCBbZCwgcmVzXSk7DQoJCQkJcmV0dXJuIHJlczsNCgkJCX0pOw0KCQl9DQoNCgkJZC5pb0FyZ3MgPSBpb0FyZ3M7DQoJDQoJCS8vIEZJWE1FOiBuZWVkIHRvIHdpcmUgdXAgdGhlIHhociBvYmplY3QncyBhYm9ydCBtZXRob2QgdG8gc29tZXRoaW5nDQoJCS8vIGFuYWxhZ291cyBpbiB0aGUgRGVmZXJyZWQNCgkJcmV0dXJuIGQ7DQoJfQ0KDQoJdmFyIF9kZWZlcnJlZENhbmNlbCA9IGZ1bmN0aW9uKC8qRGVmZXJyZWQqL2RmZCl7DQoJCS8vIHN1bW1hcnk6IGNhbmNlbGxlciBmdW5jdGlvbiBmb3IgZG9qby5faW9TZXRBcmdzIGNhbGwuDQoJCQ0KCQlkZmQuY2FuY2VsZWQgPSB0cnVlOw0KCQl2YXIgeGhyID0gZGZkLmlvQXJncy54aHI7DQoJCXZhciBfYXQgPSB0eXBlb2YgeGhyLmFib3J0Ow0KCQlpZihfYXQgPT0gImZ1bmN0aW9uIiB8fCBfYXQgPT0gIm9iamVjdCIgfHwgX2F0ID09ICJ1bmtub3duIil7DQoJCQl4aHIuYWJvcnQoKTsNCgkJfQ0KCQl2YXIgZXJyID0gZGZkLmlvQXJncy5lcnJvcjsNCgkJaWYoIWVycil7DQoJCQllcnIgPSBuZXcgRXJyb3IoInhociBjYW5jZWxsZWQiKTsNCgkJCWVyci5kb2pvVHlwZT0iY2FuY2VsIjsNCgkJfQ0KCQlyZXR1cm4gZXJyOw0KCX0NCgl2YXIgX2RlZmVycmVkT2sgPSBmdW5jdGlvbigvKkRlZmVycmVkKi9kZmQpew0KCQkvLyBzdW1tYXJ5OiBva0hhbmRsZXIgZnVuY3Rpb24gZm9yIGRvam8uX2lvU2V0QXJncyBjYWxsLg0KDQoJCXZhciByZXQgPSBoYW5kbGVyc1tkZmQuaW9BcmdzLmhhbmRsZUFzXShkZmQuaW9BcmdzLnhocik7DQoJCXJldHVybiByZXQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiByZXQ7DQoJfQ0KCXZhciBfZGVmZXJFcnJvciA9IGZ1bmN0aW9uKC8qRXJyb3IqL2Vycm9yLCAvKkRlZmVycmVkKi9kZmQpew0KCQkvLyBzdW1tYXJ5OiBlcnJIYW5kbGVyIGZ1bmN0aW9uIGZvciBkb2pvLl9pb1NldEFyZ3MgY2FsbC4NCg0KCQlpZighZGZkLmlvQXJncy5hcmdzLmZhaWxPayl7DQoJCQljb25zb2xlLmVycm9yKGVycm9yKTsNCgkJfQ0KCQlyZXR1cm4gZXJyb3I7DQoJfQ0KDQoJLy8gYXZvaWQgc2V0dGluZyBhIHRpbWVyIHBlciByZXF1ZXN0LiBJdCBkZWdyYWRlcyBwZXJmb3JtYW5jZSBvbiBJRQ0KCS8vIHNvbWV0aGluZyBmaWVyZWNlIGlmIHdlIGRvbid0IHVzZSB1bmlmaWVkIGxvb3BzLg0KCXZhciBfaW5GbGlnaHRJbnR2bCA9IG51bGw7DQoJdmFyIF9pbkZsaWdodCA9IFtdOw0KCQ0KCQ0KCS8vVXNlIGEgc2VwYXJhdGUgY291bnQgZm9yIGtub3dpbmcgaWYgd2UgYXJlIHN0YXJ0aW5nL3N0b3BwaW5nIGlvIGNhbGxzLg0KCS8vQ2Fubm90IHVzZSBfaW5GbGlnaHQubGVuZ3RoIHNpbmNlIGl0IGNhbiBjaGFuZ2UgYXQgYSBkaWZmZXJlbnQgdGltZSB0aGFuDQoJLy93aGVuIHdlIHdhbnQgdG8gZG8gdGhpcyBraW5kIG9mIHRlc3QuIFdlIG9ubHkgd2FudCB0byBkZWNyZW1lbnQgdGhlIGNvdW50DQoJLy9hZnRlciBhIGNhbGxiYWNrL2VycmJhY2sgaGFzIGZpbmlzaGVkLCBzaW5jZSB0aGUgY2FsbGJhY2svZXJyYmFjayBzaG91bGQgYmUNCgkvL2NvbnNpZGVyZWQgYXMgcGFydCBvZiBmaW5pc2hpbmcgYSByZXF1ZXN0Lg0KCXZhciBfcHViQ291bnQgPSAwOw0KCXZhciBfY2hlY2tQdWJDb3VudCA9IGZ1bmN0aW9uKGRmZCl7DQoJCWlmKF9wdWJDb3VudCA8PSAwKXsNCgkJCV9wdWJDb3VudCA9IDA7DQoJCQlpZihjZmcuaW9QdWJsaXNoICYmIF9kLnB1Ymxpc2ggJiYgKCFkZmQgfHwgZGZkICYmIGRmZC5pb0FyZ3MuYXJncy5pb1B1Ymxpc2ggIT09IGZhbHNlKSl7DQoJCQkJX2QucHVibGlzaCgiL2Rvam8vaW8vc3RvcCIpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCXZhciBfd2F0Y2hJbkZsaWdodCA9IGZ1bmN0aW9uKCl7DQoJCS8vc3VtbWFyeTogDQoJCS8vCQlpbnRlcm5hbCBtZXRob2QgdGhhdCBjaGVja3MgZWFjaCBpbmZsaWdodCBYTUxIdHRwUmVxdWVzdCB0byBzZWUNCgkJLy8JCWlmIGl0IGhhcyBjb21wbGV0ZWQgb3IgaWYgdGhlIHRpbWVvdXQgc2l0dWF0aW9uIGFwcGxpZXMuDQoJCQ0KCQl2YXIgbm93ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCgkJLy8gbWFrZSBzdXJlIHN5bmMgY2FsbHMgc3RheSB0aHJlYWQgc2FmZSwgaWYgdGhpcyBjYWxsYmFjayBpcyBjYWxsZWQNCgkJLy8gZHVyaW5nIGEgc3luYyBjYWxsIGFuZCB0aGlzIHJlc3VsdHMgaW4gYW5vdGhlciBzeW5jIGNhbGwgYmVmb3JlIHRoZQ0KCQkvLyBmaXJzdCBzeW5jIGNhbGwgZW5kcyB0aGUgYnJvd3NlciBoYW5ncw0KCQlpZighX2QuX2Jsb2NrQXN5bmMpew0KCQkJLy8gd2UgbmVlZCBtYW51YWwgbG9vcCBiZWNhdXNlIHdlIG9mdGVuIG1vZGlmeSBfaW5GbGlnaHQgKGFuZCB0aGVyZWZvcmUgJ2knKSB3aGlsZSBpdGVyYXRpbmcNCgkJCS8vIG5vdGU6IHRoZSBzZWNvbmQgY2xhdXNlIGlzIGFuIGFzc2lnbWVudCBvbiBwdXJwb3NlLCBsaW50IG1heSBjb21wbGFpbg0KCQkJZm9yKHZhciBpID0gMCwgdGlmOyBpIDwgX2luRmxpZ2h0Lmxlbmd0aCAmJiAodGlmID0gX2luRmxpZ2h0W2ldKTsgaSsrKXsNCgkJCQl2YXIgZGZkID0gdGlmLmRmZDsNCgkJCQl2YXIgZnVuYyA9IGZ1bmN0aW9uKCl7DQoJCQkJCWlmKCFkZmQgfHwgZGZkLmNhbmNlbGVkIHx8ICF0aWYudmFsaWRDaGVjayhkZmQpKXsNCgkJCQkJCV9pbkZsaWdodC5zcGxpY2UoaS0tLCAxKTsgDQoJCQkJCQlfcHViQ291bnQgLT0gMTsNCgkJCQkJfWVsc2UgaWYodGlmLmlvQ2hlY2soZGZkKSl7DQoJCQkJCQlfaW5GbGlnaHQuc3BsaWNlKGktLSwgMSk7DQoJCQkJCQl0aWYucmVzSGFuZGxlKGRmZCk7DQoJCQkJCQlfcHViQ291bnQgLT0gMTsNCgkJCQkJfWVsc2UgaWYoZGZkLnN0YXJ0VGltZSl7DQoJCQkJCQkvL2RpZCB3ZSB0aW1lb3V0Pw0KCQkJCQkJaWYoZGZkLnN0YXJ0VGltZSArIChkZmQuaW9BcmdzLmFyZ3MudGltZW91dCB8fCAwKSA8IG5vdyl7DQoJCQkJCQkJX2luRmxpZ2h0LnNwbGljZShpLS0sIDEpOw0KCQkJCQkJCXZhciBlcnIgPSBuZXcgRXJyb3IoInRpbWVvdXQgZXhjZWVkZWQiKTsNCgkJCQkJCQllcnIuZG9qb1R5cGUgPSAidGltZW91dCI7DQoJCQkJCQkJZGZkLmVycmJhY2soZXJyKTsNCgkJCQkJCQkvL0NhbmNlbCB0aGUgcmVxdWVzdCBzbyB0aGUgaW8gbW9kdWxlIGNhbiBkbyBhcHByb3ByaWF0ZSBjbGVhbnVwLg0KCQkJCQkJCWRmZC5jYW5jZWwoKTsNCgkJCQkJCQlfcHViQ291bnQgLT0gMTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX07DQoJCQkJaWYoZG9qby5jb25maWcuZGVidWdBdEFsbENvc3RzKXsNCgkJCQkJZnVuYy5jYWxsKHRoaXMpOw0KCQkJCX1lbHNlew0KCQkJCQl0cnl7DQoJCQkJCQlmdW5jLmNhbGwodGhpcyk7DQoJCQkJCX1jYXRjaChlKXsNCgkJCQkJCWRmZC5lcnJiYWNrKGUpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJX2NoZWNrUHViQ291bnQoZGZkKTsNCg0KCQlpZighX2luRmxpZ2h0Lmxlbmd0aCl7DQoJCQljbGVhckludGVydmFsKF9pbkZsaWdodEludHZsKTsNCgkJCV9pbkZsaWdodEludHZsID0gbnVsbDsNCgkJCXJldHVybjsNCgkJfQ0KCX0NCg0KCWRvam8uX2lvQ2FuY2VsQWxsID0gZnVuY3Rpb24oKXsNCgkJLy9zdW1tYXJ5OiBDYW5jZWxzIGFsbCBwZW5kaW5nIElPIHJlcXVlc3RzLCByZWdhcmRsZXNzIG9mIElPIHR5cGUNCgkJLy8oeGhyLCBzY3JpcHQsIGlmcmFtZSkuDQoJCXRyeXsNCgkJCV9kLmZvckVhY2goX2luRmxpZ2h0LCBmdW5jdGlvbihpKXsNCgkJCQl0cnl7DQoJCQkJCWkuZGZkLmNhbmNlbCgpOw0KCQkJCX1jYXRjaChlKXsvKnNxdWVsY2gqL30NCgkJCX0pOw0KCQl9Y2F0Y2goZSl7LypzcXVlbGNoKi99DQoJfQ0KDQoJLy9BdXRvbWF0aWNhbGx5IGNhbGwgY2FuY2VsIGFsbCBpbyBjYWxscyBvbiB1bmxvYWQNCgkvL2luIElFIGZvciB0cmFjIGlzc3VlICMyMzU3Lg0KCQlpZihfZC5pc0lFKXsNCgkJX2QuYWRkT25XaW5kb3dVbmxvYWQoX2QuX2lvQ2FuY2VsQWxsKTsNCgl9DQoJDQoJX2QuX2lvTm90aWZ5U3RhcnQgPSBmdW5jdGlvbigvKkRlZmVycmVkKi9kZmQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLyAJCUlmIGRvam8ucHVibGlzaCBpcyBhdmFpbGFibGUsIHB1Ymxpc2ggdG9waWNzDQoJCS8vIAkJYWJvdXQgdGhlIHN0YXJ0IG9mIGEgcmVxdWVzdCBxdWV1ZSBhbmQvb3IgdGhlDQoJCS8vIAkJdGhlIGJlZ2lubmluZyBvZiByZXF1ZXN0Lg0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8gCQlVc2VkIGJ5IElPIHRyYW5zcG9ydHMuIEFuIElPIHRyYW5zcG9ydCBzaG91bGQNCgkJLy8gCQljYWxsIHRoaXMgbWV0aG9kIGJlZm9yZSBtYWtpbmcgdGhlIG5ldHdvcmsgY29ubmVjdGlvbi4NCgkJaWYoY2ZnLmlvUHVibGlzaCAmJiBfZC5wdWJsaXNoICYmIGRmZC5pb0FyZ3MuYXJncy5pb1B1Ymxpc2ggIT09IGZhbHNlKXsNCgkJCWlmKCFfcHViQ291bnQpew0KCQkJCV9kLnB1Ymxpc2goIi9kb2pvL2lvL3N0YXJ0Iik7DQoJCQl9DQoJCQlfcHViQ291bnQgKz0gMTsNCgkJCV9kLnB1Ymxpc2goIi9kb2pvL2lvL3NlbmQiLCBbZGZkXSk7DQoJCX0NCgl9DQoNCglfZC5faW9XYXRjaCA9IGZ1bmN0aW9uKGRmZCwgdmFsaWRDaGVjaywgaW9DaGVjaywgcmVzSGFuZGxlKXsNCgkJLy8gc3VtbWFyeTogDQoJCS8vCQlXYXRjaGVzIHRoZSBpbyByZXF1ZXN0IHJlcHJlc2VudGVkIGJ5IGRmZCB0byBzZWUgaWYgaXQgY29tcGxldGVzLg0KCQkvLyBkZmQ6IERlZmVycmVkDQoJCS8vCQlUaGUgRGVmZXJyZWQgb2JqZWN0IHRvIHdhdGNoLg0KCQkvLyB2YWxpZENoZWNrOiBGdW5jdGlvbg0KCQkvLwkJRnVuY3Rpb24gdXNlZCB0byBjaGVjayBpZiB0aGUgSU8gcmVxdWVzdCBpcyBzdGlsbCB2YWxpZC4gR2V0cyB0aGUgZGZkDQoJCS8vCQlvYmplY3QgYXMgaXRzIG9ubHkgYXJndW1lbnQuDQoJCS8vIGlvQ2hlY2s6IEZ1bmN0aW9uDQoJCS8vCQlGdW5jdGlvbiB1c2VkIHRvIGNoZWNrIGlmIGJhc2ljIElPIGNhbGwgd29ya2VkLiBHZXRzIHRoZSBkZmQNCgkJLy8JCW9iamVjdCBhcyBpdHMgb25seSBhcmd1bWVudC4NCgkJLy8gcmVzSGFuZGxlOiBGdW5jdGlvbg0KCQkvLwkJRnVuY3Rpb24gdXNlZCB0byBwcm9jZXNzIHJlc3BvbnNlLiBHZXRzIHRoZSBkZmQNCgkJLy8JCW9iamVjdCBhcyBpdHMgb25seSBhcmd1bWVudC4NCgkJdmFyIGFyZ3MgPSBkZmQuaW9BcmdzLmFyZ3M7DQoJCWlmKGFyZ3MudGltZW91dCl7DQoJCQlkZmQuc3RhcnRUaW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCgkJfQ0KCQkNCgkJX2luRmxpZ2h0LnB1c2goe2RmZDogZGZkLCB2YWxpZENoZWNrOiB2YWxpZENoZWNrLCBpb0NoZWNrOiBpb0NoZWNrLCByZXNIYW5kbGU6IHJlc0hhbmRsZX0pOw0KCQlpZighX2luRmxpZ2h0SW50dmwpew0KCQkJX2luRmxpZ2h0SW50dmwgPSBzZXRJbnRlcnZhbChfd2F0Y2hJbkZsaWdodCwgNTApOw0KCQl9DQoJCS8vIGhhbmRsZSBzeW5jIHJlcXVlc3RzDQoJCS8vQSB3ZWFrbmVzczogYXN5bmMgY2FsbHMgaW4gZmxpZ2h0DQoJCS8vY291bGQgaGF2ZSB0aGVpciBoYW5kbGVycyBjYWxsZWQgYXMgcGFydCBvZiB0aGUNCgkJLy9fd2F0Y2hJbkZsaWdodCBjYWxsLCBiZWZvcmUgdGhlIHN5bmMncyBjYWxsYmFja3MNCgkJLy8gYXJlIGNhbGxlZC4NCgkJaWYoYXJncy5zeW5jKXsNCgkJCV93YXRjaEluRmxpZ2h0KCk7DQoJCX0NCgl9DQoNCgl2YXIgX2RlZmF1bHRDb250ZW50VHlwZSA9ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOw0KDQoJdmFyIF92YWxpZENoZWNrID0gZnVuY3Rpb24oLypEZWZlcnJlZCovZGZkKXsNCgkJcmV0dXJuIGRmZC5pb0FyZ3MueGhyLnJlYWR5U3RhdGU7IC8vYm9vbGVhbg0KCX0NCgl2YXIgX2lvQ2hlY2sgPSBmdW5jdGlvbigvKkRlZmVycmVkKi9kZmQpew0KCQlyZXR1cm4gNCA9PSBkZmQuaW9BcmdzLnhoci5yZWFkeVN0YXRlOyAvL2Jvb2xlYW4NCgl9DQoJdmFyIF9yZXNIYW5kbGUgPSBmdW5jdGlvbigvKkRlZmVycmVkKi9kZmQpew0KCQl2YXIgeGhyID0gZGZkLmlvQXJncy54aHI7DQoJCWlmKF9kLl9pc0RvY3VtZW50T2soeGhyKSl7DQoJCQlkZmQuY2FsbGJhY2soZGZkKTsNCgkJfWVsc2V7DQoJCQl2YXIgZXJyID0gbmV3IEVycm9yKCJVbmFibGUgdG8gbG9hZCAiICsgZGZkLmlvQXJncy51cmwgKyAiIHN0YXR1czoiICsgeGhyLnN0YXR1cyk7DQoJCQllcnIuc3RhdHVzID0geGhyLnN0YXR1czsNCgkJCWVyci5yZXNwb25zZVRleHQgPSB4aHIucmVzcG9uc2VUZXh0Ow0KCQkJZGZkLmVycmJhY2soZXJyKTsNCgkJfQ0KCX0NCg0KCWRvam8uX2lvQWRkUXVlcnlUb1VybCA9IGZ1bmN0aW9uKC8qZG9qby5fX0lvQ2FsbGJhY2tBcmdzKi9pb0FyZ3Mpew0KCQkvL3N1bW1hcnk6IEFkZHMgcXVlcnkgcGFyYW1zIGRpc2NvdmVyZWQgYnkgdGhlIGlvIGRlZmVycmVkIGNvbnN0cnVjdGlvbiB0byB0aGUgVVJMLg0KCQkvL09ubHkgdXNlIHRoaXMgZm9yIG9wZXJhdGlvbnMgd2hpY2ggYXJlIGZ1bmRhbWVudGFsbHkgR0VULXR5cGUgb3BlcmF0aW9ucy4NCgkJaWYoaW9BcmdzLnF1ZXJ5Lmxlbmd0aCl7DQoJCQlpb0FyZ3MudXJsICs9IChpb0FyZ3MudXJsLmluZGV4T2YoIj8iKSA9PSAtMSA/ICI/IiA6ICImIikgKyBpb0FyZ3MucXVlcnk7DQoJCQlpb0FyZ3MucXVlcnkgPSBudWxsOw0KCQl9CQkNCgl9DQoNCgkvKj09PT09DQoJZG9qby5kZWNsYXJlKCJkb2pvLl9fWGhyQXJncyIsIGRvam8uX19Jb0FyZ3MsIHsNCgkJY29uc3RydWN0b3I6IGZ1bmN0aW9uKCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCUluIGFkZGl0aW9uIHRvIHRoZSBwcm9wZXJ0aWVzIGxpc3RlZCBmb3IgdGhlIGRvam8uX0lvQXJncyB0eXBlLA0KCQkJLy8JCXRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBhcmUgYWxsb3dlZCBmb3IgZG9qby54aHIqIG1ldGhvZHMuDQoJCQkvLwloYW5kbGVBczogU3RyaW5nPw0KCQkJLy8JCUFjY2VwdGFibGUgdmFsdWVzIGFyZTogdGV4dCAoZGVmYXVsdCksIGpzb24sIGpzb24tY29tbWVudC1vcHRpb25hbCwNCgkJCS8vCQlqc29uLWNvbW1lbnQtZmlsdGVyZWQsIGphdmFzY3JpcHQsIHhtbC4gU2VlIGBkb2pvLmNvbnRlbnRIYW5kbGVyc2ANCgkJCS8vCXN5bmM6IEJvb2xlYW4/DQoJCQkvLwkJZmFsc2UgaXMgZGVmYXVsdC4gSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHJlcXVlc3Qgc2hvdWxkDQoJCQkvLwkJYmUgYSBzeW5jaHJvbm91cyAoYmxvY2tpbmcpIHJlcXVlc3QuDQoJCQkvLwloZWFkZXJzOiBPYmplY3Q/DQoJCQkvLwkJQWRkaXRpb25hbCBIVFRQIGhlYWRlcnMgdG8gc2VuZCBpbiB0aGUgcmVxdWVzdC4NCgkJCS8vCWZhaWxPazogQm9vbGVhbj8NCgkJCS8vCQlmYWxzZSBpcyBkZWZhdWx0LiBJbmRpY2F0ZXMgd2hldGhlciBhIHJlcXVlc3Qgc2hvdWxkIGJlDQoJCQkvLwkJYWxsb3dlZCB0byBmYWlsIChhbmQgdGhlcmVmb3JlIG5vIGNvbnNvbGUgZXJyb3IgbWVzc2FnZSBpbg0KCQkJLy8JCXRoZSBldmVudCBvZiBhIGZhaWx1cmUpDQoJCQl0aGlzLmhhbmRsZUFzID0gaGFuZGxlQXM7DQoJCQl0aGlzLnN5bmMgPSBzeW5jOw0KCQkJdGhpcy5oZWFkZXJzID0gaGVhZGVyczsNCgkJCXRoaXMuZmFpbE9rID0gZmFpbE9rOw0KCQl9DQoJfSk7DQoJPT09PT0qLw0KDQoJZG9qby54aHIgPSBmdW5jdGlvbigvKlN0cmluZyovIG1ldGhvZCwgLypkb2pvLl9fWGhyQXJncyovIGFyZ3MsIC8qQm9vbGVhbj8qLyBoYXNCb2R5KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVNlbmRzIGFuIEhUVFAgcmVxdWVzdCB3aXRoIHRoZSBnaXZlbiBtZXRob2QuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJU2VuZHMgYW4gSFRUUCByZXF1ZXN0IHdpdGggdGhlIGdpdmVuIG1ldGhvZC4NCgkJLy8JCVNlZSBhbHNvIGRvam8ueGhyR2V0KCksIHhoclBvc3QoKSwgeGhyUHV0KCkgYW5kIGRvam8ueGhyRGVsZXRlKCkgZm9yIHNob3J0Y3V0cw0KCQkvLwkJZm9yIHRob3NlIEhUVFAgbWV0aG9kcy4gVGhlcmUgYXJlIGFsc28gbWV0aG9kcyBmb3IgInJhdyIgUFVUIGFuZCBQT1NUIG1ldGhvZHMNCgkJLy8JCXZpYSBkb2pvLnJhd1hoclB1dCgpIGFuZCBkb2pvLnJhd1hoclBvc3QoKSByZXNwZWN0aXZlbHkuDQoJCS8vCW1ldGhvZDoNCgkJLy8JCUhUVFAgbWV0aG9kIHRvIGJlIHVzZWQsIHN1Y2ggYXMgR0VULCBQT1NULCBQVVQsIERFTEVURS4gIFNob3VsZCBiZSB1cHBlcmNhc2UuDQoJCS8vCWhhc0JvZHk6DQoJCS8vCQlJZiB0aGUgcmVxdWVzdCBoYXMgYW4gSFRUUCBib2R5LCB0aGVuIHBhc3MgdHJ1ZSBmb3IgaGFzQm9keS4NCg0KCQkvL01ha2UgdGhlIERlZmVycmVkIG9iamVjdCBmb3IgdGhpcyB4aHIgcmVxdWVzdC4NCgkJdmFyIGRmZCA9IF9kLl9pb1NldEFyZ3MoYXJncywgX2RlZmVycmVkQ2FuY2VsLCBfZGVmZXJyZWRPaywgX2RlZmVyRXJyb3IpOw0KCQl2YXIgaW9BcmdzID0gZGZkLmlvQXJnczsNCg0KCQkvL1Bhc3MgdGhlIGFyZ3MgdG8gX3hock9iaiwgdG8gYWxsb3cgYWx0ZXJuYXRlIFhIUiBjYWxscyBiYXNlZCBzcGVjaWZpYyBjYWxscywgbGlrZQ0KCQkvL3RoZSBvbmUgdXNlZCBmb3IgaWZyYW1lIHByb3hpZXMuDQoJCXZhciB4aHIgPSBpb0FyZ3MueGhyID0gX2QuX3hock9iaihpb0FyZ3MuYXJncyk7DQoJCS8vSWYgWEhSIGZhY3RvcnkgZmFpbHMsIGNhbmNlbCB0aGUgZGVmZXJyZWQuDQoJCWlmKCF4aHIpew0KCQkJZGZkLmNhbmNlbCgpOw0KCQkJcmV0dXJuIGRmZDsNCgkJfQ0KDQoJCS8vQWxsb3cgZm9yIHNwZWNpZnlpbmcgdGhlIEhUVFAgYm9keSBjb21wbGV0ZWx5Lg0KCQlpZigicG9zdERhdGEiIGluIGFyZ3Mpew0KCQkJaW9BcmdzLnF1ZXJ5ID0gYXJncy5wb3N0RGF0YTsNCgkJfWVsc2UgaWYoInB1dERhdGEiIGluIGFyZ3Mpew0KCQkJaW9BcmdzLnF1ZXJ5ID0gYXJncy5wdXREYXRhOw0KCQl9ZWxzZSBpZigicmF3Qm9keSIgaW4gYXJncyl7DQoJCQlpb0FyZ3MucXVlcnkgPSBhcmdzLnJhd0JvZHk7DQoJCX1lbHNlIGlmKChhcmd1bWVudHMubGVuZ3RoID4gMiAmJiAhaGFzQm9keSkgfHwgIlBPU1R8UFVUIi5pbmRleE9mKG1ldGhvZC50b1VwcGVyQ2FzZSgpKSA9PSAtMSl7DQoJCQkvL0NoZWNrIGZvciBoYXNCb2R5IGJlaW5nIHBhc3NlZC4gSWYgbm8gaGFzQm9keSwNCgkJCS8vdGhlbiBvbmx5IGFwcGVuZCBxdWVyeSBzdHJpbmcgaWYgbm90IGEgUE9TVCBvciBQVVQgcmVxdWVzdC4NCgkJCV9kLl9pb0FkZFF1ZXJ5VG9VcmwoaW9BcmdzKTsNCgkJfQ0KDQoJCS8vIElFIDYgaXMgYSBzdGVhbWluZyBwaWxlLiBJdCB3b24ndCBsZXQgeW91IGNhbGwgYXBwbHkoKSBvbiB0aGUgbmF0aXZlIGZ1bmN0aW9uICh4aHIub3BlbikuDQoJCS8vIHdvcmthcm91bmQgZm9yIElFNidzIGFwcGx5KCkgImlzc3VlcyINCgkJeGhyLm9wZW4obWV0aG9kLCBpb0FyZ3MudXJsLCBhcmdzLnN5bmMgIT09IHRydWUsIGFyZ3MudXNlciB8fCB1bmRlZmluZWQsIGFyZ3MucGFzc3dvcmQgfHwgdW5kZWZpbmVkKTsNCgkJaWYoYXJncy5oZWFkZXJzKXsNCgkJCWZvcih2YXIgaGRyIGluIGFyZ3MuaGVhZGVycyl7DQoJCQkJaWYoaGRyLnRvTG93ZXJDYXNlKCkgPT09ICJjb250ZW50LXR5cGUiICYmICFhcmdzLmNvbnRlbnRUeXBlKXsNCgkJCQkJYXJncy5jb250ZW50VHlwZSA9IGFyZ3MuaGVhZGVyc1toZHJdOw0KCQkJCX1lbHNlIGlmKGFyZ3MuaGVhZGVyc1toZHJdKXsNCgkJCQkJLy9Pbmx5IGFkZCBoZWFkZXIgaWYgaXQgaGFzIGEgdmFsdWUuIFRoaXMgYWxsb3dzIGZvciBpbnN0bmFjZSwgc2tpcHBpbmcNCgkJCQkJLy9pbnNlcnRpb24gb2YgWC1SZXF1ZXN0ZWQtV2l0aCBieSBzcGVjaWZ5aW5nIGVtcHR5IHZhbHVlLg0KCQkJCQl4aHIuc2V0UmVxdWVzdEhlYWRlcihoZHIsIGFyZ3MuaGVhZGVyc1toZHJdKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJLy8gRklYTUU6IGlzIHRoaXMgYXBwcm9wcmlhdGUgZm9yIGFsbCBjb250ZW50IHR5cGVzPw0KCQl4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgYXJncy5jb250ZW50VHlwZSB8fCBfZGVmYXVsdENvbnRlbnRUeXBlKTsNCgkJaWYoIWFyZ3MuaGVhZGVycyB8fCAhKCJYLVJlcXVlc3RlZC1XaXRoIiBpbiBhcmdzLmhlYWRlcnMpKXsNCgkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCJYLVJlcXVlc3RlZC1XaXRoIiwgIlhNTEh0dHBSZXF1ZXN0Iik7DQoJCX0NCgkJLy8gRklYTUU6IHNldCBvdGhlciBoZWFkZXJzIGhlcmUhDQoJCV9kLl9pb05vdGlmeVN0YXJ0KGRmZCk7DQoJCWlmKGRvam8uY29uZmlnLmRlYnVnQXRBbGxDb3N0cyl7DQoJCQl4aHIuc2VuZChpb0FyZ3MucXVlcnkpOw0KCQl9ZWxzZXsNCgkJCXRyeXsNCgkJCQl4aHIuc2VuZChpb0FyZ3MucXVlcnkpOw0KCQkJfWNhdGNoKGUpew0KCQkJCWlvQXJncy5lcnJvciA9IGU7DQoJCQkJZGZkLmNhbmNlbCgpOw0KCQkJfQ0KCQl9DQoJCV9kLl9pb1dhdGNoKGRmZCwgX3ZhbGlkQ2hlY2ssIF9pb0NoZWNrLCBfcmVzSGFuZGxlKTsNCgkJeGhyID0gbnVsbDsNCgkJcmV0dXJuIGRmZDsgLy8gZG9qby5EZWZlcnJlZA0KCX0NCg0KCWRvam8ueGhyR2V0ID0gZnVuY3Rpb24oLypkb2pvLl9fWGhyQXJncyovIGFyZ3Mpew0KCQkvLwlzdW1tYXJ5OiANCgkJLy8JCVNlbmRzIGFuIEhUVFAgR0VUIHJlcXVlc3QgdG8gdGhlIHNlcnZlci4NCgkJcmV0dXJuIF9kLnhocigiR0VUIiwgYXJncyk7IC8vIGRvam8uRGVmZXJyZWQNCgl9DQoNCglkb2pvLnJhd1hoclBvc3QgPSBkb2pvLnhoclBvc3QgPSBmdW5jdGlvbigvKmRvam8uX19YaHJBcmdzKi8gYXJncyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlTZW5kcyBhbiBIVFRQIFBPU1QgcmVxdWVzdCB0byB0aGUgc2VydmVyLiBJbiBhZGR0aW9uIHRvIHRoZSBwcm9wZXJ0aWVzDQoJCS8vCQlsaXN0ZWQgZm9yIHRoZSBkb2pvLl9fWGhyQXJncyB0eXBlLCB0aGUgZm9sbG93aW5nIHByb3BlcnR5IGlzIGFsbG93ZWQ6DQoJCS8vCXBvc3REYXRhOg0KCQkvLwkJU3RyaW5nLiBTZW5kIHJhdyBkYXRhIGluIHRoZSBib2R5IG9mIHRoZSBQT1NUIHJlcXVlc3QuDQoJCXJldHVybiBfZC54aHIoIlBPU1QiLCBhcmdzLCB0cnVlKTsgLy8gZG9qby5EZWZlcnJlZA0KCX0NCg0KCWRvam8ucmF3WGhyUHV0ID0gZG9qby54aHJQdXQgPSBmdW5jdGlvbigvKmRvam8uX19YaHJBcmdzKi8gYXJncyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlTZW5kcyBhbiBIVFRQIFBVVCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIuIEluIGFkZHRpb24gdG8gdGhlIHByb3BlcnRpZXMNCgkJLy8JCWxpc3RlZCBmb3IgdGhlIGRvam8uX19YaHJBcmdzIHR5cGUsIHRoZSBmb2xsb3dpbmcgcHJvcGVydHkgaXMgYWxsb3dlZDoNCgkJLy8JcHV0RGF0YToNCgkJLy8JCVN0cmluZy4gU2VuZCByYXcgZGF0YSBpbiB0aGUgYm9keSBvZiB0aGUgUFVUIHJlcXVlc3QuDQoJCXJldHVybiBfZC54aHIoIlBVVCIsIGFyZ3MsIHRydWUpOyAvLyBkb2pvLkRlZmVycmVkDQoJfQ0KDQoJZG9qby54aHJEZWxldGUgPSBmdW5jdGlvbigvKmRvam8uX19YaHJBcmdzKi8gYXJncyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlTZW5kcyBhbiBIVFRQIERFTEVURSByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIuDQoJCXJldHVybiBfZC54aHIoIkRFTEVURSIsIGFyZ3MpOyAvL2Rvam8uRGVmZXJyZWQNCgl9DQoNCgkvKg0KCWRvam8ud3JhcEZvcm0gPSBmdW5jdGlvbihmb3JtTm9kZSl7DQoJCS8vc3VtbWFyeToNCgkJLy8JCUEgcmVwbGFjZW1lbnQgZm9yIEZvcm1CaW5kLCBidXQgbm90IGltcGxlbWVudGVkIHlldC4NCg0KCQkvLyBGSVhNRTogbmVlZCB0byB0aGluayBoYXJkZXIgYWJvdXQgd2hhdCBleHRlbnNpb25zIHRvIHRoaXMgd2UgbWlnaHQNCgkJLy8gd2FudC4gV2hhdCBzaG91bGQgd2UgYWxsb3cgZm9sa3MgdG8gZG8gdy8gdGhpcz8gV2hhdCBldmVudHMgdG8NCgkJLy8gc2V0L3NlbmQ/DQoJCXRocm93IG5ldyBFcnJvcigiZG9qby53cmFwRm9ybSBub3QgeWV0IGltcGxlbWVudGVkIik7DQoJfQ0KCSovDQp9KSgpOw0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5meCJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5meCJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5meCIpOw0KDQoNCg0KDQoNCi8qDQoJQW5pbWF0aW9uIGxvb3NlbHkgcGFja2FnZSBiYXNlZCBvbiBEYW4gUHVwaXVzJyB3b3JrLCBjb250cmlidXRlZCB1bmRlciBDTEE6DQoJCWh0dHA6Ly9wdXBpdXMuY28udWsvanMvVG9vbGtpdC5EcmF3aW5nLmpzDQoqLw0KKGZ1bmN0aW9uKCl7DQoJdmFyIGQgPSBkb2pvOw0KCXZhciBfbWl4aW4gPSBkLl9taXhpbjsNCg0KCWRvam8uX0xpbmUgPSBmdW5jdGlvbigvKmludCovIHN0YXJ0LCAvKmludCovIGVuZCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlkb2pvLl9MaW5lIGlzIHRoZSBvYmplY3QgdXNlZCB0byBnZW5lcmF0ZSB2YWx1ZXMgZnJvbSBhIHN0YXJ0IHZhbHVlDQoJCS8vCQl0byBhbiBlbmQgdmFsdWUNCgkJLy8Jc3RhcnQ6IGludA0KCQkvLwkJQmVnaW5uaW5nIHZhbHVlIGZvciByYW5nZQ0KCQkvLwllbmQ6IGludA0KCQkvLwkJRW5kaW5nIHZhbHVlIGZvciByYW5nZQ0KCQl0aGlzLnN0YXJ0ID0gc3RhcnQ7DQoJCXRoaXMuZW5kID0gZW5kOw0KCX07DQoNCglkb2pvLl9MaW5lLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uKC8qZmxvYXQqLyBuKXsNCgkJLy8Jc3VtbWFyeTogUmV0dXJucyB0aGUgcG9pbnQgb24gdGhlIGxpbmUNCgkJLy8JbjogYSBmbG9hdGluZyBwb2ludCBudW1iZXIgZ3JlYXRlciB0aGFuIDAgYW5kIGxlc3MgdGhhbiAxDQoJCXJldHVybiAoKHRoaXMuZW5kIC0gdGhpcy5zdGFydCkgKiBuKSArIHRoaXMuc3RhcnQ7IC8vIERlY2ltYWwNCgl9Ow0KDQoJZG9qby5BbmltYXRpb24gPSBmdW5jdGlvbihhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUEgZ2VuZXJpYyBhbmltYXRpb24gY2xhc3MgdGhhdCBmaXJlcyBjYWxsYmFja3MgaW50byBpdHMgaGFuZGxlcnMNCgkJLy8JCW9iamVjdCBhdCB2YXJpb3VzIHN0YXRlcy4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlBIGdlbmVyaWMgYW5pbWF0aW9uIGNsYXNzIHRoYXQgZmlyZXMgY2FsbGJhY2tzIGludG8gaXRzIGhhbmRsZXJzDQoJCS8vCQlvYmplY3QgYXQgdmFyaW91cyBzdGF0ZXMuIE5lYXJseSBhbGwgZG9qbyBhbmltYXRpb24gZnVuY3Rpb25zDQoJCS8vCQlyZXR1cm4gYW4gaW5zdGFuY2Ugb2YgdGhpcyBtZXRob2QsIHVzdWFsbHkgd2l0aG91dCBjYWxsaW5nIHRoZQ0KCQkvLwkJLnBsYXkoKSBtZXRob2QgYmVmb3JlaGFuZC4gVGhlcmVmb3JlLCB5b3Ugd2lsbCBsaWtlbHkgbmVlZCB0bw0KCQkvLwkJY2FsbCAucGxheSgpIG9uIGluc3RhbmNlcyBvZiBgZG9qby5BbmltYXRpb25gIHdoZW4gb25lIGlzDQoJCS8vCQlyZXR1cm5lZC4NCgkJLy8gYXJnczogT2JqZWN0DQoJCS8vCQlUaGUgJ21hZ2ljIGFyZ3VtZW50JywgbWl4aW5nIGFsbCB0aGUgcHJvcGVydGllcyBpbnRvIHRoaXMNCgkJLy8JCWFuaW1hdGlvbiBpbnN0YW5jZS4NCg0KCQlfbWl4aW4odGhpcywgYXJncyk7DQoJCWlmKGQuaXNBcnJheSh0aGlzLmN1cnZlKSl7DQoJCQl0aGlzLmN1cnZlID0gbmV3IGQuX0xpbmUodGhpcy5jdXJ2ZVswXSwgdGhpcy5jdXJ2ZVsxXSk7DQoJCX0NCg0KCX07DQoNCgkvLyBBbGlhcyB0byBkcm9wIGNvbWUgMi4wOg0KCWQuX0FuaW1hdGlvbiA9IGQuQW5pbWF0aW9uOw0KDQoJZC5leHRlbmQoZG9qby5BbmltYXRpb24sIHsNCgkJLy8gZHVyYXRpb246IEludGVnZXINCgkJLy8JCVRoZSB0aW1lIGluIG1pbGxpc2VvbmRzIHRoZSBhbmltYXRpb24gd2lsbCB0YWtlIHRvIHJ1bg0KCQlkdXJhdGlvbjogMzUwLA0KDQoJLyo9PT09PQ0KCQkvLyBjdXJ2ZTogZG9qby5fTGluZXxBcnJheQ0KCQkvLwkJQSB0d28gZWxlbWVudCBhcnJheSBvZiBzdGFydCBhbmQgZW5kIHZhbHVlcywgb3IgYSBgZG9qby5fTGluZWAgaW5zdGFuY2UgdG8gYmUNCgkJLy8JCXVzZWQgaW4gdGhlIEFuaW1hdGlvbi4NCgkJY3VydmU6IG51bGwsDQoNCgkJLy8gZWFzaW5nOiBGdW5jdGlvbj8NCgkJLy8JCUEgRnVuY3Rpb24gdG8gYWRqdXN0IHRoZSBhY2NlbGVyYXRpb24gKG9yIGRlY2VsZXJhdGlvbikgb2YgdGhlIHByb2dyZXNzDQoJCS8vCQlhY3Jvc3MgYSBkb2pvLl9MaW5lDQoJCWVhc2luZzogbnVsbCwNCgk9PT09PSovDQoNCgkJLy8gcmVwZWF0OiBJbnRlZ2VyPw0KCQkvLwkJVGhlIG51bWJlciBvZiB0aW1lcyB0byBsb29wIHRoZSBhbmltYXRpb24NCgkJcmVwZWF0OiAwLA0KDQoJCS8vIHJhdGU6IEludGVnZXI/DQoJCS8vCQl0aGUgdGltZSBpbiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgYWR2YW5jaW5nIHRvIG5leHQgZnJhbWUNCgkJLy8JCSh1c2VkIGFzIGEgZnBzIHRpbWVyOiAxMDAwL3JhdGUgPSBmcHMpDQoJCXJhdGU6IDIwIC8qIDUwIGZwcyAqLywNCg0KCS8qPT09PT0NCgkJLy8gZGVsYXk6IEludGVnZXI/DQoJCS8vCQlUaGUgdGltZSBpbiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgc3RhcnRpbmcgYW5pbWF0aW9uIGFmdGVyIGl0DQoJCS8vCQloYXMgYmVlbiAucGxheSgpJ2VkDQoJCWRlbGF5OiBudWxsLA0KDQoJCS8vIGJlZm9yZUJlZ2luOiBFdmVudD8NCgkJLy8JCVN5bnRoZXRpYyBldmVudCBmaXJlZCBiZWZvcmUgYSBkb2pvLkFuaW1hdGlvbiBiZWdpbnMgcGxheWluZyAoc3luY2hyb25vdXMpDQoJCWJlZm9yZUJlZ2luOiBudWxsLA0KDQoJCS8vIG9uQmVnaW46IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIGFzIGEgZG9qby5BbmltYXRpb24gYmVnaW5zIHBsYXlpbmcgKHVzZWZ1bD8pDQoJCW9uQmVnaW46IG51bGwsDQoNCgkJLy8gb25BbmltYXRlOiBFdmVudD8NCgkJLy8JCVN5bnRoZXRpYyBldmVudCBmaXJlZCBhdCBlYWNoIGludGVydmFsIG9mIGEgYGRvam8uQW5pbWF0aW9uYA0KCQlvbkFuaW1hdGU6IG51bGwsDQoNCgkJLy8gb25FbmQ6IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIGFmdGVyIHRoZSBmaW5hbCBmcmFtZSBvZiBhIGBkb2pvLkFuaW1hdGlvbmANCgkJb25FbmQ6IG51bGwsDQoNCgkJLy8gb25QbGF5OiBFdmVudD8NCgkJLy8JCVN5bnRoZXRpYyBldmVudCBmaXJlZCBhbnkgdGltZSBhIGBkb2pvLkFuaW1hdGlvbmAgaXMgcGxheSgpJ2VkDQoJCW9uUGxheTogbnVsbCwNCg0KCQkvLyBvblBhdXNlOiBFdmVudD8NCgkJLy8JCVN5bnRoZXRpYyBldmVudCBmaXJlZCB3aGVuIGEgYGRvam8uQW5pbWF0aW9uYCBpcyBwYXVzZWQNCgkJb25QYXVzZTogbnVsbCwNCg0KCQkvLyBvblN0b3A6IEV2ZW50DQoJCS8vCQlTeW50aGV0aWMgZXZlbnQgZmlyZXMgd2hlbiBhIGBkb2pvLkFuaW1hdGlvbmAgaXMgc3RvcHBlZA0KCQlvblN0b3A6IG51bGwsDQoNCgk9PT09PSovDQoNCgkJX3BlcmNlbnQ6IDAsDQoJCV9zdGFydFJlcGVhdENvdW50OiAwLA0KDQoJCV9nZXRTdGVwOiBmdW5jdGlvbigpew0KCQkJdmFyIF9wID0gdGhpcy5fcGVyY2VudCwNCgkJCQlfZSA9IHRoaXMuZWFzaW5nDQoJCQk7DQoJCQlyZXR1cm4gX2UgPyBfZShfcCkgOiBfcDsNCgkJfSwNCgkJX2ZpcmU6IGZ1bmN0aW9uKC8qRXZlbnQqLyBldnQsIC8qQXJyYXk/Ki8gYXJncyl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCUNvbnZlbmllbmNlIGZ1bmN0aW9uLiAgRmlyZSBldmVudCAiZXZ0IiBhbmQgcGFzcyBpdCB0aGUNCgkJCS8vCQlhcmd1bWVudHMgc3BlY2lmaWVkIGluICJhcmdzIi4NCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCUNvbnZlbmllbmNlIGZ1bmN0aW9uLiAgRmlyZSBldmVudCAiZXZ0IiBhbmQgcGFzcyBpdCB0aGUNCgkJCS8vCQlhcmd1bWVudHMgc3BlY2lmaWVkIGluICJhcmdzIi4NCgkJCS8vCQlGaXJlcyB0aGUgY2FsbGJhY2sgaW4gdGhlIHNjb3BlIG9mIHRoZSBgZG9qby5BbmltYXRpb25gDQoJCQkvLwkJaW5zdGFuY2UuDQoJCQkvLwlldnQ6DQoJCQkvLwkJVGhlIGV2ZW50IHRvIGZpcmUuDQoJCQkvLwlhcmdzOg0KCQkJLy8JCVRoZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgZXZlbnQuDQoJCQl2YXIgYSA9IGFyZ3N8fFtdOw0KCQkJaWYodGhpc1tldnRdKXsNCgkJCQlpZihkLmNvbmZpZy5kZWJ1Z0F0QWxsQ29zdHMpew0KCQkJCQl0aGlzW2V2dF0uYXBwbHkodGhpcywgYSk7DQoJCQkJfWVsc2V7DQoJCQkJCXRyeXsNCgkJCQkJCXRoaXNbZXZ0XS5hcHBseSh0aGlzLCBhKTsNCgkJCQkJfWNhdGNoKGUpew0KCQkJCQkJLy8gc3F1ZWxjaCBhbmQgbG9nIGJlY2F1c2Ugd2Ugc2hvdWxkbid0IGFsbG93IGV4Y2VwdGlvbnMgaW4NCgkJCQkJCS8vIHN5bnRoZXRpYyBldmVudCBoYW5kbGVycyB0byBjYXVzZSB0aGUgaW50ZXJuYWwgdGltZXIgdG8gcnVuDQoJCQkJCQkvLyBhbXVjaywgcG90ZW50aWFsbHkgcGVnZ2luZyB0aGUgQ1BVLiBJJ20gbm90IGEgZmFuIG9mIHRoaXMNCgkJCQkJCS8vIHNxdWVsY2gsIGJ1dCBob3BlZnVsbHkgbG9nZ2luZyB3aWxsIG1ha2UgaXQgY2xlYXIgd2hhdCdzDQoJCQkJCQkvLyBnb2luZyBvbg0KCQkJCQkJY29uc29sZS5lcnJvcigiZXhjZXB0aW9uIGluIGFuaW1hdGlvbiBoYW5kbGVyIGZvcjoiLCBldnQpOw0KCQkJCQkJY29uc29sZS5lcnJvcihlKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiB0aGlzOyAvLyBkb2pvLkFuaW1hdGlvbg0KCQl9LA0KDQoJCXBsYXk6IGZ1bmN0aW9uKC8qaW50PyovIGRlbGF5LCAvKkJvb2xlYW4/Ki8gZ290b1N0YXJ0KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJU3RhcnQgdGhlIGFuaW1hdGlvbi4NCgkJCS8vIGRlbGF5Og0KCQkJLy8JCUhvdyBtYW55IG1pbGxpc2Vjb25kcyB0byBkZWxheSBiZWZvcmUgc3RhcnRpbmcuDQoJCQkvLyBnb3RvU3RhcnQ6DQoJCQkvLwkJSWYgdHJ1ZSwgc3RhcnRzIHRoZSBhbmltYXRpb24gZnJvbSB0aGUgYmVnaW5uaW5nOyBvdGhlcndpc2UsDQoJCQkvLwkJc3RhcnRzIGl0IGZyb20gaXRzIGN1cnJlbnQgcG9zaXRpb24uDQoJCQkvLyByZXR1cm5zOiBkb2pvLkFuaW1hdGlvbg0KCQkJLy8JCVRoZSBpbnN0YW5jZSB0byBhbGxvdyBjaGFpbmluZy4NCg0KCQkJdmFyIF90ID0gdGhpczsNCgkJCWlmKF90Ll9kZWxheVRpbWVyKXsgX3QuX2NsZWFyVGltZXIoKTsgfQ0KCQkJaWYoZ290b1N0YXJ0KXsNCgkJCQlfdC5fc3RvcFRpbWVyKCk7DQoJCQkJX3QuX2FjdGl2ZSA9IF90Ll9wYXVzZWQgPSBmYWxzZTsNCgkJCQlfdC5fcGVyY2VudCA9IDA7DQoJCQl9ZWxzZSBpZihfdC5fYWN0aXZlICYmICFfdC5fcGF1c2VkKXsNCgkJCQlyZXR1cm4gX3Q7DQoJCQl9DQoNCgkJCV90Ll9maXJlKCJiZWZvcmVCZWdpbiIsIFtfdC5ub2RlXSk7DQoNCgkJCXZhciBkZSA9IGRlbGF5IHx8IF90LmRlbGF5LA0KCQkJCV9wID0gZG9qby5oaXRjaChfdCwgIl9wbGF5IiwgZ290b1N0YXJ0KTsNCg0KCQkJaWYoZGUgPiAwKXsNCgkJCQlfdC5fZGVsYXlUaW1lciA9IHNldFRpbWVvdXQoX3AsIGRlKTsNCgkJCQlyZXR1cm4gX3Q7DQoJCQl9DQoJCQlfcCgpOw0KCQkJcmV0dXJuIF90Ow0KCQl9LA0KDQoJCV9wbGF5OiBmdW5jdGlvbihnb3RvU3RhcnQpew0KCQkJdmFyIF90ID0gdGhpczsNCgkJCWlmKF90Ll9kZWxheVRpbWVyKXsgX3QuX2NsZWFyVGltZXIoKTsgfQ0KCQkJX3QuX3N0YXJ0VGltZSA9IG5ldyBEYXRlKCkudmFsdWVPZigpOw0KCQkJaWYoX3QuX3BhdXNlZCl7DQoJCQkJX3QuX3N0YXJ0VGltZSAtPSBfdC5kdXJhdGlvbiAqIF90Ll9wZXJjZW50Ow0KCQkJfQ0KDQoJCQlfdC5fYWN0aXZlID0gdHJ1ZTsNCgkJCV90Ll9wYXVzZWQgPSBmYWxzZTsNCgkJCXZhciB2YWx1ZSA9IF90LmN1cnZlLmdldFZhbHVlKF90Ll9nZXRTdGVwKCkpOw0KCQkJaWYoIV90Ll9wZXJjZW50KXsNCgkJCQlpZighX3QuX3N0YXJ0UmVwZWF0Q291bnQpew0KCQkJCQlfdC5fc3RhcnRSZXBlYXRDb3VudCA9IF90LnJlcGVhdDsNCgkJCQl9DQoJCQkJX3QuX2ZpcmUoIm9uQmVnaW4iLCBbdmFsdWVdKTsNCgkJCX0NCg0KCQkJX3QuX2ZpcmUoIm9uUGxheSIsIFt2YWx1ZV0pOw0KDQoJCQlfdC5fY3ljbGUoKTsNCgkJCXJldHVybiBfdDsgLy8gZG9qby5BbmltYXRpb24NCgkJfSwNCg0KCQlwYXVzZTogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6IFBhdXNlcyBhIHJ1bm5pbmcgYW5pbWF0aW9uLg0KCQkJdmFyIF90ID0gdGhpczsNCgkJCWlmKF90Ll9kZWxheVRpbWVyKXsgX3QuX2NsZWFyVGltZXIoKTsgfQ0KCQkJX3QuX3N0b3BUaW1lcigpOw0KCQkJaWYoIV90Ll9hY3RpdmUpeyByZXR1cm4gX3Q7IC8qZG9qby5BbmltYXRpb24qLyB9DQoJCQlfdC5fcGF1c2VkID0gdHJ1ZTsNCgkJCV90Ll9maXJlKCJvblBhdXNlIiwgW190LmN1cnZlLmdldFZhbHVlKF90Ll9nZXRTdGVwKCkpXSk7DQoJCQlyZXR1cm4gX3Q7IC8vIGRvam8uQW5pbWF0aW9uDQoJCX0sDQoNCgkJZ290b1BlcmNlbnQ6IGZ1bmN0aW9uKC8qRGVjaW1hbCovIHBlcmNlbnQsIC8qQm9vbGVhbj8qLyBhbmRQbGF5KXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJU2V0cyB0aGUgcHJvZ3Jlc3Mgb2YgdGhlIGFuaW1hdGlvbi4NCgkJCS8vCXBlcmNlbnQ6DQoJCQkvLwkJQSBwZXJjZW50YWdlIGluIGRlY2ltYWwgbm90YXRpb24gKGJldHdlZW4gYW5kIGluY2x1ZGluZyAwLjAgYW5kIDEuMCkuDQoJCQkvLwlhbmRQbGF5Og0KCQkJLy8JCUlmIHRydWUsIHBsYXkgdGhlIGFuaW1hdGlvbiBhZnRlciBzZXR0aW5nIHRoZSBwcm9ncmVzcy4NCgkJCXZhciBfdCA9IHRoaXM7DQoJCQlfdC5fc3RvcFRpbWVyKCk7DQoJCQlfdC5fYWN0aXZlID0gX3QuX3BhdXNlZCA9IHRydWU7DQoJCQlfdC5fcGVyY2VudCA9IHBlcmNlbnQ7DQoJCQlpZihhbmRQbGF5KXsgX3QucGxheSgpOyB9DQoJCQlyZXR1cm4gX3Q7IC8vIGRvam8uQW5pbWF0aW9uDQoJCX0sDQoNCgkJc3RvcDogZnVuY3Rpb24oLypib29sZWFuPyovIGdvdG9FbmQpew0KCQkJLy8gc3VtbWFyeTogU3RvcHMgYSBydW5uaW5nIGFuaW1hdGlvbi4NCgkJCS8vIGdvdG9FbmQ6IElmIHRydWUsIHRoZSBhbmltYXRpb24gd2lsbCBlbmQuDQoJCQl2YXIgX3QgPSB0aGlzOw0KCQkJaWYoX3QuX2RlbGF5VGltZXIpeyBfdC5fY2xlYXJUaW1lcigpOyB9DQoJCQlpZighX3QuX3RpbWVyKXsgcmV0dXJuIF90OyAvKiBkb2pvLkFuaW1hdGlvbiAqLyB9DQoJCQlfdC5fc3RvcFRpbWVyKCk7DQoJCQlpZihnb3RvRW5kKXsNCgkJCQlfdC5fcGVyY2VudCA9IDE7DQoJCQl9DQoJCQlfdC5fZmlyZSgib25TdG9wIiwgW190LmN1cnZlLmdldFZhbHVlKF90Ll9nZXRTdGVwKCkpXSk7DQoJCQlfdC5fYWN0aXZlID0gX3QuX3BhdXNlZCA9IGZhbHNlOw0KCQkJcmV0dXJuIF90OyAvLyBkb2pvLkFuaW1hdGlvbg0KCQl9LA0KDQoJCXN0YXR1czogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIHN0cmluZyB0b2tlbiByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3RhdHVzIG9mDQoJCQkvLwkJdGhlIGFuaW1hdGlvbiwgb25lIG9mOiAicGF1c2VkIiwgInBsYXlpbmciLCAic3RvcHBlZCINCgkJCWlmKHRoaXMuX2FjdGl2ZSl7DQoJCQkJcmV0dXJuIHRoaXMuX3BhdXNlZCA/ICJwYXVzZWQiIDogInBsYXlpbmciOyAvLyBTdHJpbmcNCgkJCX0NCgkJCXJldHVybiAic3RvcHBlZCI7IC8vIFN0cmluZw0KCQl9LA0KDQoJCV9jeWNsZTogZnVuY3Rpb24oKXsNCgkJCXZhciBfdCA9IHRoaXM7DQoJCQlpZihfdC5fYWN0aXZlKXsNCgkJCQl2YXIgY3VyciA9IG5ldyBEYXRlKCkudmFsdWVPZigpOw0KCQkJCXZhciBzdGVwID0gKGN1cnIgLSBfdC5fc3RhcnRUaW1lKSAvIChfdC5kdXJhdGlvbik7DQoNCgkJCQlpZihzdGVwID49IDEpew0KCQkJCQlzdGVwID0gMTsNCgkJCQl9DQoJCQkJX3QuX3BlcmNlbnQgPSBzdGVwOw0KDQoJCQkJLy8gUGVyZm9ybSBlYXNpbmcNCgkJCQlpZihfdC5lYXNpbmcpew0KCQkJCQlzdGVwID0gX3QuZWFzaW5nKHN0ZXApOw0KCQkJCX0NCg0KCQkJCV90Ll9maXJlKCJvbkFuaW1hdGUiLCBbX3QuY3VydmUuZ2V0VmFsdWUoc3RlcCldKTsNCg0KCQkJCWlmKF90Ll9wZXJjZW50IDwgMSl7DQoJCQkJCV90Ll9zdGFydFRpbWVyKCk7DQoJCQkJfWVsc2V7DQoJCQkJCV90Ll9hY3RpdmUgPSBmYWxzZTsNCg0KCQkJCQlpZihfdC5yZXBlYXQgPiAwKXsNCgkJCQkJCV90LnJlcGVhdC0tOw0KCQkJCQkJX3QucGxheShudWxsLCB0cnVlKTsNCgkJCQkJfWVsc2UgaWYoX3QucmVwZWF0ID09IC0xKXsNCgkJCQkJCV90LnBsYXkobnVsbCwgdHJ1ZSk7DQoJCQkJCX1lbHNlew0KCQkJCQkJaWYoX3QuX3N0YXJ0UmVwZWF0Q291bnQpew0KCQkJCQkJCV90LnJlcGVhdCA9IF90Ll9zdGFydFJlcGVhdENvdW50Ow0KCQkJCQkJCV90Ll9zdGFydFJlcGVhdENvdW50ID0gMDsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlfdC5fcGVyY2VudCA9IDA7DQoJCQkJCV90Ll9maXJlKCJvbkVuZCIsIFtfdC5ub2RlXSk7DQoJCQkJCSFfdC5yZXBlYXQgJiYgX3QuX3N0b3BUaW1lcigpOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBfdDsgLy8gZG9qby5BbmltYXRpb24NCgkJfSwNCg0KCQlfY2xlYXJUaW1lcjogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6IENsZWFyIHRoZSBwbGF5IGRlbGF5IHRpbWVyDQoJCQljbGVhclRpbWVvdXQodGhpcy5fZGVsYXlUaW1lcik7DQoJCQlkZWxldGUgdGhpcy5fZGVsYXlUaW1lcjsNCgkJfQ0KDQoJfSk7DQoNCgkvLyB0aGUgbG9jYWwgdGltZXIsIHN0dWJiZWQgaW50byBhbGwgQW5pbWF0aW9uIGluc3RhbmNlcw0KCXZhciBjdHIgPSAwLA0KCQl0aW1lciA9IG51bGwsDQoJCXJ1bm5lciA9IHsNCgkJCXJ1bjogZnVuY3Rpb24oKXt9DQoJCX07DQoNCglkLmV4dGVuZChkLkFuaW1hdGlvbiwgew0KDQoJCV9zdGFydFRpbWVyOiBmdW5jdGlvbigpew0KCQkJaWYoIXRoaXMuX3RpbWVyKXsNCgkJCQl0aGlzLl90aW1lciA9IGQuY29ubmVjdChydW5uZXIsICJydW4iLCB0aGlzLCAiX2N5Y2xlIik7DQoJCQkJY3RyKys7DQoJCQl9DQoJCQlpZighdGltZXIpew0KCQkJCXRpbWVyID0gc2V0SW50ZXJ2YWwoZC5oaXRjaChydW5uZXIsICJydW4iKSwgdGhpcy5yYXRlKTsNCgkJCX0NCgkJfSwNCg0KCQlfc3RvcFRpbWVyOiBmdW5jdGlvbigpew0KCQkJaWYodGhpcy5fdGltZXIpew0KCQkJCWQuZGlzY29ubmVjdCh0aGlzLl90aW1lcik7DQoJCQkJdGhpcy5fdGltZXIgPSBudWxsOw0KCQkJCWN0ci0tOw0KCQkJfQ0KCQkJaWYoY3RyIDw9IDApew0KCQkJCWNsZWFySW50ZXJ2YWwodGltZXIpOw0KCQkJCXRpbWVyID0gbnVsbDsNCgkJCQljdHIgPSAwOw0KCQkJfQ0KCQl9DQoNCgl9KTsNCg0KCXZhciBfbWFrZUZhZGVhYmxlID0NCgkJCQlkLmlzSUUgPyBmdW5jdGlvbihub2RlKXsNCgkJCS8vIG9ubHkgc2V0IHRoZSB6b29tIGlmIHRoZSAidGlja2xlIiB2YWx1ZSB3b3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUNCgkJCS8vIGRlZmF1bHQNCgkJCXZhciBucyA9IG5vZGUuc3R5bGU7DQoJCQkvLyBkb24ndCBzZXQgdGhlIHdpZHRoIHRvIGF1dG8gaWYgaXQgZGlkbid0IGFscmVhZHkgY2FzY2FkZSB0aGF0IHdheS4NCgkJCS8vIFdlIGRvbid0IHdhbnQgdG8gZiBhbnlvbmVzIGRlc2lnbnMNCgkJCWlmKCFucy53aWR0aC5sZW5ndGggJiYgZC5zdHlsZShub2RlLCAid2lkdGgiKSA9PSAiYXV0byIpew0KCQkJCW5zLndpZHRoID0gImF1dG8iOw0KCQkJfQ0KCQl9IDoNCgkJCQlmdW5jdGlvbigpe307DQoNCglkb2pvLl9mYWRlID0gZnVuY3Rpb24oLypPYmplY3QqLyBhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gYW5pbWF0aW9uIHRoYXQgd2lsbCBmYWRlIHRoZSBub2RlIGRlZmluZWQgYnkNCgkJLy8JCWFyZ3Mubm9kZSBmcm9tIHRoZSBzdGFydCB0byBlbmQgdmFsdWVzIHBhc3NlZCAoYXJncy5zdGFydA0KCQkvLwkJYXJncy5lbmQpIChlbmQgaXMgbWFuZGF0b3J5LCBzdGFydCBpcyBvcHRpb25hbCkNCg0KCQlhcmdzLm5vZGUgPSBkLmJ5SWQoYXJncy5ub2RlKTsNCgkJdmFyIGZBcmdzID0gX21peGluKHsgcHJvcGVydGllczoge30gfSwgYXJncyksDQoJCQlwcm9wcyA9IChmQXJncy5wcm9wZXJ0aWVzLm9wYWNpdHkgPSB7fSk7DQoNCgkJcHJvcHMuc3RhcnQgPSAhKCJzdGFydCIgaW4gZkFyZ3MpID8NCgkJCWZ1bmN0aW9uKCl7DQoJCQkJcmV0dXJuICtkLnN0eWxlKGZBcmdzLm5vZGUsICJvcGFjaXR5Iil8fDA7DQoJCQl9IDogZkFyZ3Muc3RhcnQ7DQoJCXByb3BzLmVuZCA9IGZBcmdzLmVuZDsNCg0KCQl2YXIgYW5pbSA9IGQuYW5pbWF0ZVByb3BlcnR5KGZBcmdzKTsNCgkJZC5jb25uZWN0KGFuaW0sICJiZWZvcmVCZWdpbiIsIGQucGFydGlhbChfbWFrZUZhZGVhYmxlLCBmQXJncy5ub2RlKSk7DQoNCgkJcmV0dXJuIGFuaW07IC8vIGRvam8uQW5pbWF0aW9uDQoJfTsNCg0KCS8qPT09PT0NCglkb2pvLl9fRmFkZUFyZ3MgPSBmdW5jdGlvbihub2RlLCBkdXJhdGlvbiwgZWFzaW5nKXsNCgkJLy8Jbm9kZTogRE9NTm9kZXxTdHJpbmcNCgkJLy8JCVRoZSBub2RlIHJlZmVyZW5jZWQgaW4gdGhlIGFuaW1hdGlvbg0KCQkvLwlkdXJhdGlvbjogSW50ZWdlcj8NCgkJLy8JCUR1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24gaW4gbWlsbGlzZWNvbmRzLg0KCQkvLwllYXNpbmc6IEZ1bmN0aW9uPw0KCQkvLwkJQW4gZWFzaW5nIGZ1bmN0aW9uLg0KCQl0aGlzLm5vZGUgPSBub2RlOw0KCQl0aGlzLmR1cmF0aW9uID0gZHVyYXRpb247DQoJCXRoaXMuZWFzaW5nID0gZWFzaW5nOw0KCX0NCgk9PT09PSovDQoNCglkb2pvLmZhZGVJbiA9IGZ1bmN0aW9uKC8qZG9qby5fX0ZhZGVBcmdzKi8gYXJncyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIGFuIGFuaW1hdGlvbiB0aGF0IHdpbGwgZmFkZSBub2RlIGRlZmluZWQgaW4gJ2FyZ3MnIGZyb20NCgkJLy8JCWl0cyBjdXJyZW50IG9wYWNpdHkgdG8gZnVsbHkgb3BhcXVlLg0KCQlyZXR1cm4gZC5fZmFkZShfbWl4aW4oeyBlbmQ6IDEgfSwgYXJncykpOyAvLyBkb2pvLkFuaW1hdGlvbg0KCX07DQoNCglkb2pvLmZhZGVPdXQgPSBmdW5jdGlvbigvKmRvam8uX19GYWRlQXJncyovICBhcmdzKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gYW5pbWF0aW9uIHRoYXQgd2lsbCBmYWRlIG5vZGUgZGVmaW5lZCBpbiAnYXJncycNCgkJLy8JCWZyb20gaXRzIGN1cnJlbnQgb3BhY2l0eSB0byBmdWxseSB0cmFuc3BhcmVudC4NCgkJcmV0dXJuIGQuX2ZhZGUoX21peGluKHsgZW5kOiAwIH0sIGFyZ3MpKTsgLy8gZG9qby5BbmltYXRpb24NCgl9Ow0KDQoJZG9qby5fZGVmYXVsdEVhc2luZyA9IGZ1bmN0aW9uKC8qRGVjaW1hbD8qLyBuKXsNCgkJLy8gc3VtbWFyeTogVGhlIGRlZmF1bHQgZWFzaW5nIGZ1bmN0aW9uIGZvciBkb2pvLkFuaW1hdGlvbihzKQ0KCQlyZXR1cm4gMC41ICsgKChNYXRoLnNpbigobiArIDEuNSkgKiBNYXRoLlBJKSkgLyAyKTsNCgl9Ow0KDQoJdmFyIFByb3BMaW5lID0gZnVuY3Rpb24ocHJvcGVydGllcyl7DQoJCS8vIFByb3BMaW5lIGlzIGFuIGludGVybmFsIGNsYXNzIHdoaWNoIGlzIHVzZWQgdG8gbW9kZWwgdGhlIHZhbHVlcyBvZg0KCQkvLyBhbiBhIGdyb3VwIG9mIENTUyBwcm9wZXJ0aWVzIGFjcm9zcyBhbiBhbmltYXRpb24gbGlmZWN5Y2xlLiBJbg0KCQkvLyBwYXJ0aWN1bGFyLCB0aGUgImdldFZhbHVlIiBmdW5jdGlvbiBoYW5kbGVzIGdldHRpbmcgaW50ZXJwb2xhdGVkDQoJCS8vIHZhbHVlcyBiZXR3ZWVuIHN0YXJ0IGFuZCBlbmQgZm9yIGEgcGFydGljdWxhciBDU1MgdmFsdWUuDQoJCXRoaXMuX3Byb3BlcnRpZXMgPSBwcm9wZXJ0aWVzOw0KCQlmb3IodmFyIHAgaW4gcHJvcGVydGllcyl7DQoJCQl2YXIgcHJvcCA9IHByb3BlcnRpZXNbcF07DQoJCQlpZihwcm9wLnN0YXJ0IGluc3RhbmNlb2YgZC5Db2xvcil7DQoJCQkJLy8gY3JlYXRlIGEgcmV1c2FibGUgdGVtcCBjb2xvciBvYmplY3QgdG8ga2VlcCBpbnRlcm1lZGlhdGUgcmVzdWx0cw0KCQkJCXByb3AudGVtcENvbG9yID0gbmV3IGQuQ29sb3IoKTsNCgkJCX0NCgkJfQ0KCX07DQoNCglQcm9wTGluZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbihyKXsNCgkJdmFyIHJldCA9IHt9Ow0KCQlmb3IodmFyIHAgaW4gdGhpcy5fcHJvcGVydGllcyl7DQoJCQl2YXIgcHJvcCA9IHRoaXMuX3Byb3BlcnRpZXNbcF0sDQoJCQkJc3RhcnQgPSBwcm9wLnN0YXJ0Ow0KCQkJaWYoc3RhcnQgaW5zdGFuY2VvZiBkLkNvbG9yKXsNCgkJCQlyZXRbcF0gPSBkLmJsZW5kQ29sb3JzKHN0YXJ0LCBwcm9wLmVuZCwgciwgcHJvcC50ZW1wQ29sb3IpLnRvQ3NzKCk7DQoJCQl9ZWxzZSBpZighZC5pc0FycmF5KHN0YXJ0KSl7DQoJCQkJcmV0W3BdID0gKChwcm9wLmVuZCAtIHN0YXJ0KSAqIHIpICsgc3RhcnQgKyAocCAhPSAib3BhY2l0eSIgPyBwcm9wLnVuaXRzIHx8ICJweCIgOiAwKTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgkvKj09PT09DQoJZG9qby5kZWNsYXJlKCJkb2pvLl9fQW5pbUFyZ3MiLCBbZG9qby5fX0ZhZGVBcmdzXSwgew0KCQkvLyBQcm9wZXJ0aWVzOiBPYmplY3Q/DQoJCS8vCUEgaGFzaCBtYXAgb2Ygc3R5bGUgcHJvcGVydGllcyB0byBPYmplY3RzIGRlc2NyaWJpbmcgdGhlIHRyYW5zaXRpb24sDQoJCS8vCXN1Y2ggYXMgdGhlIHByb3BlcnRpZXMgb2YgZG9qby5fTGluZSB3aXRoIGFuIGFkZGl0aW9uYWwgJ3VuaXRzJyBwcm9wZXJ0eQ0KCQlwcm9wZXJ0aWVzOiB7fQ0KDQoJCS8vVE9ET0M6IGFkZCBldmVudCBjYWxsYmFja3MNCgl9KTsNCgk9PT09PSovDQoNCglkb2pvLmFuaW1hdGVQcm9wZXJ0eSA9IGZ1bmN0aW9uKC8qZG9qby5fX0FuaW1BcmdzKi8gYXJncyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIGFuIGFuaW1hdGlvbiB0aGF0IHdpbGwgdHJhbnNpdGlvbiB0aGUgcHJvcGVydGllcyBvZg0KCQkvLwkJbm9kZSBkZWZpbmVkIGluIGBhcmdzYCBkZXBlbmRpbmcgaG93IHRoZXkgYXJlIGRlZmluZWQgaW4NCgkJLy8JCWBhcmdzLnByb3BlcnRpZXNgDQoJCS8vDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLwkJYGRvam8uYW5pbWF0ZVByb3BlcnR5YCBpcyB0aGUgZm91bmRhdGlvbiBvZiBtb3N0IGBkb2pvLmZ4YA0KCQkvLwkJYW5pbWF0aW9ucy4gSXQgdGFrZXMgYW4gb2JqZWN0IG9mICJwcm9wZXJ0aWVzIiBjb3JyZXNwb25kaW5nIHRvDQoJCS8vCQlzdHlsZSBwcm9wZXJ0aWVzLCBhbmQgYW5pbWF0ZXMgdGhlbSBpbiBwYXJhbGxlbCBvdmVyIGEgc2V0DQoJCS8vCQlkdXJhdGlvbi4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCUEgc2ltcGxlIGFuaW1hdGlvbiB0aGF0IGNoYW5nZXMgdGhlIHdpZHRoIG9mIHRoZSBzcGVjaWZpZWQgbm9kZS4NCgkJLy8JfAlkb2pvLmFuaW1hdGVQcm9wZXJ0eSh7DQoJCS8vCXwJCW5vZGU6ICJub2RlSWQiLA0KCQkvLwl8CQlwcm9wZXJ0aWVzOiB7IHdpZHRoOiA0MDAgfSwNCgkJLy8JfAl9KS5wbGF5KCk7DQoJCS8vCQlEb2pvIGZpZ3VyZXMgb3V0IHRoZSBzdGFydCB2YWx1ZSBmb3IgdGhlIHdpZHRoIGFuZCBjb252ZXJ0cyB0aGUNCgkJLy8JCWludGVnZXIgc3BlY2lmaWVkIGZvciB0aGUgd2lkdGggdG8gdGhlIG1vcmUgZXhwcmVzc2l2ZSBidXQNCgkJLy8JCXZlcmJvc2UgZm9ybSBgeyB3aWR0aDogeyBlbmQ6ICc0MDAnLCB1bml0czogJ3B4JyB9IH1gIHdoaWNoIHlvdQ0KCQkvLwkJY2FuIGFsc28gc3BlY2lmeSBkaXJlY3RseS4gRGVmYXVsdHMgdG8gJ3B4JyBpZiBvbW1pdHRlZC4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCUFuaW1hdGUgd2lkdGgsIGhlaWdodCwgYW5kIHBhZGRpbmcgb3ZlciAyIHNlY29uZHMuLi4gdGhlDQoJCS8vCQlwZWRhbnRpYyB3YXk6DQoJCS8vCXwJZG9qby5hbmltYXRlUHJvcGVydHkoeyBub2RlOiBub2RlLCBkdXJhdGlvbjoyMDAwLA0KCQkvLwl8CQlwcm9wZXJ0aWVzOiB7DQoJCS8vCXwJCQl3aWR0aDogeyBzdGFydDogJzIwMCcsIGVuZDogJzQwMCcsIHVuaXRzOiJweCIgfSwNCgkJLy8JfAkJCWhlaWdodDogeyBzdGFydDonMjAwJywgZW5kOiAnNDAwJywgdW5pdHM6InB4IiB9LA0KCQkvLwl8CQkJcGFkZGluZ1RvcDogeyBzdGFydDonNScsIGVuZDonNTAnLCB1bml0czoicHgiIH0NCgkJLy8JfAkJfQ0KCQkvLwl8CX0pLnBsYXkoKTsNCgkJLy8JCU5vdGUgJ3BhZGRpbmdUb3AnIGlzIHVzZWQgb3ZlciAncGFkZGluZy10b3AnLiBNdWx0aS1uYW1lIENTUyBwcm9wZXJ0aWVzDQoJCS8vCQlhcmUgd3JpdHRlbiB1c2luZyAibWl4ZWQgY2FzZSIsIGFzIHRoZSBoeXBoZW4gaXMgaWxsZWdhbCBhcyBhbiBvYmplY3Qga2V5Lg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJUGx1ZyBpbiBhIGRpZmZlcmVudCBlYXNpbmcgZnVuY3Rpb24gYW5kIHJlZ2lzdGVyIGEgY2FsbGJhY2sgZm9yDQoJCS8vCQl3aGVuIHRoZSBhbmltYXRpb24gZW5kcy4gRWFzaW5nIGZ1bmN0aW9ucyBhY2NlcHQgdmFsdWVzIGJldHdlZW4NCgkJLy8JCXplcm8gYW5kIG9uZSBhbmQgcmV0dXJuIGEgdmFsdWUgb24gdGhhdCBiYXNpcy4gSW4gdGhpcyBjYXNlLCBhbg0KCQkvLwkJZXhwb25lbnRpYWwtaW4gY3VydmUuDQoJCS8vCXwJZG9qby5hbmltYXRlUHJvcGVydHkoew0KCQkvLwl8CQlub2RlOiAibm9kZUlkIiwNCgkJLy8JfAkJLy8gZG9qbyBmaWd1cmVzIG91dCB0aGUgc3RhcnQgdmFsdWUNCgkJLy8JfAkJcHJvcGVydGllczogeyB3aWR0aDogeyBlbmQ6IDQwMCB9IH0sDQoJCS8vCXwJCWVhc2luZzogZnVuY3Rpb24obil7DQoJCS8vCXwJCQlyZXR1cm4gKG49PTApID8gMCA6IE1hdGgucG93KDIsIDEwICogKG4gLSAxKSk7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW9uRW5kOiBmdW5jdGlvbihub2RlKXsNCgkJLy8JfAkJCS8vIGNhbGxlZCB3aGVuIHRoZSBhbmltYXRpb24gZmluaXNoZXMuIFRoZSBhbmltYXRpb24NCgkJLy8JfAkJCS8vIHRhcmdldCBpcyBwYXNzZWQgdG8gdGhpcyBmdW5jdGlvbg0KCQkvLwl8CQl9DQoJCS8vCXwJfSkucGxheSg1MDApOyAvLyBkZWxheSBwbGF5aW5nIGhhbGYgYSBzZWNvbmQNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCUxpa2UgYWxsIGBkb2pvLkFuaW1hdGlvbmBzLCBhbmltYXRlUHJvcGVydHkgcmV0dXJucyBhIGhhbmRsZSB0byB0aGUNCgkJLy8JCUFuaW1hdGlvbiBpbnN0YW5jZSwgd2hpY2ggZmlyZXMgdGhlIGV2ZW50cyBjb21tb24gdG8gRG9qbyBGWC4gVXNlIGBkb2pvLmNvbm5lY3RgDQoJCS8vCQl0byBhY2Nlc3MgdGhlc2UgZXZlbnRzIG91dHNpZGUgb2YgdGhlIEFuaW1hdGlvbiBkZWZpbml0b246DQoJCS8vCXwJdmFyIGFuaW0gPSBkb2pvLmFuaW1hdGVQcm9wZXJ0eSh7DQoJCS8vCXwJCW5vZGU6InNvbWVJZCIsDQoJCS8vCXwJCXByb3BlcnRpZXM6ew0KCQkvLwl8CQkJd2lkdGg6NDAwLCBoZWlnaHQ6NTAwDQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAlkb2pvLmNvbm5lY3QoYW5pbSwib25FbmQiLCBmdW5jdGlvbigpew0KCQkvLwl8CQljb25zb2xlLmxvZygiYW5pbWF0aW9uIGVuZGVkIik7DQoJCS8vCXwJfSk7DQoJCS8vCXwJLy8gcGxheSB0aGUgYW5pbWF0aW9uIG5vdzoNCgkJLy8JfAlhbmltLnBsYXkoKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCUVhY2ggcHJvcGVydHkgY2FuIGJlIGEgZnVuY3Rpb24gd2hvc2UgcmV0dXJuIHZhbHVlIGlzIHN1YnN0aXR1dGVkIGFsb25nLg0KCQkvLwkJQWRkaXRpb25hbGx5LCBlYWNoIG1lYXN1cmVtZW50IChlZzogc3RhcnQsIGVuZCkgY2FuIGJlIGEgZnVuY3Rpb24uIFRoZSBub2RlDQoJCS8vCQlyZWZlcmVuY2UgaXMgcGFzc2VkIGRpcmVjbHkgdG8gY2FsbGJhY2tzLg0KCQkvLwl8CWRvam8uYW5pbWF0ZVByb3BlcnR5KHsNCgkJLy8JfAkJbm9kZToibWluZSIsDQoJCS8vCXwJCXByb3BlcnRpZXM6ew0KCQkvLwl8CQkJaGVpZ2h0OmZ1bmN0aW9uKG5vZGUpew0KCQkvLwl8CQkJCS8vIHNocmluayB0aGlzIG5vZGUgYnkgNTAlDQoJCS8vCXwJCQkJcmV0dXJuIGRvam8ucG9zaXRpb24obm9kZSkuaCAvIDINCgkJLy8JfAkJCX0sDQoJCS8vCXwJCQl3aWR0aDp7DQoJCS8vCXwJCQkJc3RhcnQ6ZnVuY3Rpb24obm9kZSl7IHJldHVybiAxMDA7IH0sDQoJCS8vCXwJCQkJZW5kOmZ1bmN0aW9uKG5vZGUpeyByZXR1cm4gMjAwOyB9DQoJCS8vCXwJCQl9DQoJCS8vCXwJCX0NCgkJLy8JfAl9KS5wbGF5KCk7DQoJCS8vDQoNCgkJdmFyIG4gPSBhcmdzLm5vZGUgPSBkLmJ5SWQoYXJncy5ub2RlKTsNCgkJaWYoIWFyZ3MuZWFzaW5nKXsgYXJncy5lYXNpbmcgPSBkLl9kZWZhdWx0RWFzaW5nOyB9DQoNCgkJdmFyIGFuaW0gPSBuZXcgZC5BbmltYXRpb24oYXJncyk7DQoJCWQuY29ubmVjdChhbmltLCAiYmVmb3JlQmVnaW4iLCBhbmltLCBmdW5jdGlvbigpew0KCQkJdmFyIHBtID0ge307DQoJCQlmb3IodmFyIHAgaW4gdGhpcy5wcm9wZXJ0aWVzKXsNCgkJCQkvLyBNYWtlIHNoYWxsb3cgY29weSBvZiBwcm9wZXJ0aWVzIGludG8gcG0gYmVjYXVzZSB3ZSBvdmVyd3JpdGUNCgkJCQkvLyBzb21lIHZhbHVlcyBiZWxvdy4gSW4gcGFydGljdWxhciBpZiBzdGFydC9lbmQgYXJlIGZ1bmN0aW9ucw0KCQkJCS8vIHdlIGRvbid0IHdhbnQgdG8gb3ZlcndyaXRlIHRoZW0gb3IgdGhlIGZ1bmN0aW9ucyB3b24ndCBiZQ0KCQkJCS8vIGNhbGxlZCBpZiB0aGUgYW5pbWF0aW9uIGlzIHJldXNlZC4NCgkJCQlpZihwID09ICJ3aWR0aCIgfHwgcCA9PSAiaGVpZ2h0Iil7DQoJCQkJCXRoaXMubm9kZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQl9DQoJCQkJdmFyIHByb3AgPSB0aGlzLnByb3BlcnRpZXNbcF07DQoJCQkJaWYoZC5pc0Z1bmN0aW9uKHByb3ApKXsNCgkJCQkJcHJvcCA9IHByb3Aobik7DQoJCQkJfQ0KCQkJCXByb3AgPSBwbVtwXSA9IF9taXhpbih7fSwgKGQuaXNPYmplY3QocHJvcCkgPyBwcm9wOiB7IGVuZDogcHJvcCB9KSk7DQoNCgkJCQlpZihkLmlzRnVuY3Rpb24ocHJvcC5zdGFydCkpew0KCQkJCQlwcm9wLnN0YXJ0ID0gcHJvcC5zdGFydChuKTsNCgkJCQl9DQoJCQkJaWYoZC5pc0Z1bmN0aW9uKHByb3AuZW5kKSl7DQoJCQkJCXByb3AuZW5kID0gcHJvcC5lbmQobik7DQoJCQkJfQ0KCQkJCXZhciBpc0NvbG9yID0gKHAudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJjb2xvciIpID49IDApOw0KCQkJCWZ1bmN0aW9uIGdldFN0eWxlKG5vZGUsIHApew0KCQkJCQkvLyBkb2pvLnN0eWxlKG5vZGUsICJoZWlnaHQiKSBjYW4gcmV0dXJuICJhdXRvIiBvciAiIiBvbiBJRTsgdGhpcyBpcyBtb3JlIHJlbGlhYmxlOg0KCQkJCQl2YXIgdiA9IHsgaGVpZ2h0OiBub2RlLm9mZnNldEhlaWdodCwgd2lkdGg6IG5vZGUub2Zmc2V0V2lkdGggfVtwXTsNCgkJCQkJaWYodiAhPT0gdW5kZWZpbmVkKXsgcmV0dXJuIHY7IH0NCgkJCQkJdiA9IGQuc3R5bGUobm9kZSwgcCk7DQoJCQkJCXJldHVybiAocCA9PSAib3BhY2l0eSIpID8gK3YgOiAoaXNDb2xvciA/IHYgOiBwYXJzZUZsb2F0KHYpKTsNCgkJCQl9DQoJCQkJaWYoISgiZW5kIiBpbiBwcm9wKSl7DQoJCQkJCXByb3AuZW5kID0gZ2V0U3R5bGUobiwgcCk7DQoJCQkJfWVsc2UgaWYoISgic3RhcnQiIGluIHByb3ApKXsNCgkJCQkJcHJvcC5zdGFydCA9IGdldFN0eWxlKG4sIHApOw0KCQkJCX0NCg0KCQkJCWlmKGlzQ29sb3Ipew0KCQkJCQlwcm9wLnN0YXJ0ID0gbmV3IGQuQ29sb3IocHJvcC5zdGFydCk7DQoJCQkJCXByb3AuZW5kID0gbmV3IGQuQ29sb3IocHJvcC5lbmQpOw0KCQkJCX1lbHNlew0KCQkJCQlwcm9wLnN0YXJ0ID0gKHAgPT0gIm9wYWNpdHkiKSA/ICtwcm9wLnN0YXJ0IDogcGFyc2VGbG9hdChwcm9wLnN0YXJ0KTsNCgkJCQl9DQoJCQl9DQoJCQl0aGlzLmN1cnZlID0gbmV3IFByb3BMaW5lKHBtKTsNCgkJfSk7DQoJCWQuY29ubmVjdChhbmltLCAib25BbmltYXRlIiwgZC5oaXRjaChkLCAic3R5bGUiLCBhbmltLm5vZGUpKTsNCgkJcmV0dXJuIGFuaW07IC8vIGRvam8uQW5pbWF0aW9uDQoJfTsNCg0KCWRvam8uYW5pbSA9IGZ1bmN0aW9uKAkvKkRPTU5vZGV8U3RyaW5nKi8Jbm9kZSwNCgkJCQkJCQkvKk9iamVjdCovCQkJcHJvcGVydGllcywNCgkJCQkJCQkvKkludGVnZXI/Ki8JCWR1cmF0aW9uLA0KCQkJCQkJCS8qRnVuY3Rpb24/Ki8JCWVhc2luZywNCgkJCQkJCQkvKkZ1bmN0aW9uPyovCQlvbkVuZCwNCgkJCQkJCQkvKkludGVnZXI/Ki8JCWRlbGF5KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUEgc2ltcGxlciBpbnRlcmZhY2UgdG8gYGRvam8uYW5pbWF0ZVByb3BlcnR5KClgLCBhbHNvIHJldHVybnMNCgkJLy8JCWFuIGluc3RhbmNlIG9mIGBkb2pvLkFuaW1hdGlvbmAgYnV0IGJlZ2lucyB0aGUgYW5pbWF0aW9uDQoJCS8vCQlpbW1lZGlhdGVseSwgdW5saWtlIG5lYXJseSBldmVyeSBvdGhlciBEb2pvIGFuaW1hdGlvbiBBUEkuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJYGRvam8uYW5pbWAgaXMgYSBzaW1wbGVyIChidXQgc29tZXdoYXQgbGVzcyBwb3dlcmZ1bCkgdmVyc2lvbg0KCQkvLwkJb2YgYGRvam8uYW5pbWF0ZVByb3BlcnR5YC4gIEl0IHVzZXMgZGVmYXVsdHMgZm9yIG1hbnkgYmFzaWMgcHJvcGVydGllcw0KCQkvLwkJYW5kIGFsbG93cyBmb3IgcG9zaXRpb25hbCBwYXJhbWV0ZXJzIHRvIGJlIHVzZWQgaW4gcGxhY2Ugb2YgdGhlDQoJCS8vCQlwYWNrZWQgInByb3BlcnR5IGJhZyIgd2hpY2ggaXMgdXNlZCBmb3Igb3RoZXIgRG9qbyBhbmltYXRpb24NCgkJLy8JCW1ldGhvZHMuDQoJCS8vDQoJCS8vCQlUaGUgYGRvam8uQW5pbWF0aW9uYCBvYmplY3QgcmV0dXJuZWQgZnJvbSBgZG9qby5hbmltYCB3aWxsIGJlDQoJCS8vCQlhbHJlYWR5IHBsYXlpbmcgd2hlbiBpdCBpcyByZXR1cm5lZCBmcm9tIHRoaXMgZnVuY3Rpb24sIHNvDQoJCS8vCQljYWxsaW5nIHBsYXkoKSBvbiBpdCBhZ2FpbiBpcyAodXN1YWxseSkgYSBuby1vcC4NCgkJLy8Jbm9kZToNCgkJLy8JCWEgRE9NIG5vZGUgb3IgdGhlIGlkIG9mIGEgbm9kZSB0byBhbmltYXRlIENTUyBwcm9wZXJ0aWVzIG9uDQoJCS8vCWR1cmF0aW9uOg0KCQkvLwkJVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgb3ZlciB3aGljaCB0aGUgYW5pbWF0aW9uDQoJCS8vCQlzaG91bGQgcnVuLiBEZWZhdWx0cyB0byB0aGUgZ2xvYmFsIGFuaW1hdGlvbiBkZWZhdWx0IGR1cmF0aW9uDQoJCS8vCQkoMzUwbXMpLg0KCQkvLwllYXNpbmc6DQoJCS8vCQlBbiBlYXNpbmcgZnVuY3Rpb24gb3ZlciB3aGljaCB0byBjYWxjdWxhdGUgYWNjZWxlcmF0aW9uDQoJCS8vCQlhbmQgZGVjZWxlcmF0aW9uIG9mIHRoZSBhbmltYXRpb24gdGhyb3VnaCBpdHMgZHVyYXRpb24uDQoJCS8vCQlBIGRlZmF1bHQgZWFzaW5nIGFsZ29yaXRobSBpcyBwcm92aWRlZCwgYnV0IHlvdSBtYXkNCgkJLy8JCXBsdWcgaW4gYW55IHlvdSB3aXNoLiBBIGxhcmdlIHNlbGVjdGlvbiBvZiBlYXNpbmcgYWxnb3JpdGhtcw0KCQkvLwkJYXJlIGF2YWlsYWJsZSBpbiBgZG9qby5meC5lYXNpbmdgLg0KCQkvLwlvbkVuZDoNCgkJLy8JCUEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGFuaW1hdGlvbiBmaW5pc2hlcw0KCQkvLwkJcnVubmluZy4NCgkJLy8JZGVsYXk6DQoJCS8vCQlUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheSBiZWdpbm5pbmcgdGhlDQoJCS8vCQlhbmltYXRpb24gYnkuIFRoZSBkZWZhdWx0IGlzIDAuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlGYWRlIG91dCBhIG5vZGUNCgkJLy8JfAlkb2pvLmFuaW0oImlkIiwgeyBvcGFjaXR5OiAwIH0pOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJRmFkZSBvdXQgYSBub2RlIG92ZXIgYSBmdWxsIHNlY29uZA0KCQkvLwl8CWRvam8uYW5pbSgiaWQiLCB7IG9wYWNpdHk6IDAgfSwgMTAwMCk7DQoJCXJldHVybiBkLmFuaW1hdGVQcm9wZXJ0eSh7IC8vIGRvam8uQW5pbWF0aW9uDQoJCQlub2RlOiBub2RlLA0KCQkJZHVyYXRpb246IGR1cmF0aW9uIHx8IGQuQW5pbWF0aW9uLnByb3RvdHlwZS5kdXJhdGlvbiwNCgkJCXByb3BlcnRpZXM6IHByb3BlcnRpZXMsDQoJCQllYXNpbmc6IGVhc2luZywNCgkJCW9uRW5kOiBvbkVuZA0KCQl9KS5wbGF5KGRlbGF5IHx8IDApOw0KCX07DQp9KSgpOw0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5icm93c2VyIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmJyb3dzZXIiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UuYnJvd3NlciIpOw0KDQoNCg0KDQoNCg0KDQoNCg0KDQovL05lZWQgdGhpcyB0byBiZSB0aGUgbGFzdCBjb2RlIHNlZ21lbnQgaW4gYmFzZSwgc28gZG8gbm90IHBsYWNlIGFueQ0KLy9kb2pvLnJlcXVpcmVJZiBjYWxscyBpbiB0aGlzIGZpbGUuIE90aGVyd2lzZSwgZHVlIHRvIGhvdyB0aGUgYnVpbGQgc3lzdGVtDQovL3B1dHMgYWxsIHJlcXVpcmVJZiBkZXBlbmRlbmNpZXMgYWZ0ZXIgdGhlIGN1cnJlbnQgZmlsZSwgdGhlIHJlcXVpcmUgY2FsbHMNCi8vY291bGQgYmUgY2FsbGVkIGJlZm9yZSBhbGwgb2YgYmFzZSBpcyBkZWZpbmVkLg0KZG9qby5mb3JFYWNoKGRvam8uY29uZmlnLnJlcXVpcmUsIGZ1bmN0aW9uKGkpew0KCWRvam9bInJlcXVpcmUiXShpKTsNCn0pOw0KDQp9DQoNCi8qDQoJQ29weXJpZ2h0IChjKSAyMDA0LTIwMTAsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4NCglBdmFpbGFibGUgdmlhIEFjYWRlbWljIEZyZWUgTGljZW5zZSA+PSAyLjEgT1IgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlLg0KCXNlZTogaHR0cDovL2Rvam90b29sa2l0Lm9yZy9saWNlbnNlIGZvciBkZXRhaWxzDQoqLw0KDQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qb3guaW8ud2luZG93TmFtZSJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qb3guaW8ud2luZG93TmFtZSJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qb3guaW8ud2luZG93TmFtZSIpOw0KLy8gSW1wbGVtZW50cyB0aGUgd2luZG93Lm5hbWUgdHJhbnNwb3J0ICANCg0KZG9qb3guaW8ud2luZG93TmFtZSA9IHsNCglzZW5kOiBmdW5jdGlvbigvKlN0cmluZyovIG1ldGhvZCwgLypkb2pvLl9fSW9BcmdzKi8gYXJncyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlQcm92aWRlcyBzZWN1cmUgY3Jvc3MtZG9tYWluIHJlcXVlc3QgY2FwYWJpbGl0eS4NCgkJLy8gCQlTZW5kcyBhIHJlcXVlc3QgdXNpbmcgYW4gaWZyYW1lIChQT1NUIG9yIEdFVCkgYW5kIHJlYWRzIHRoZSByZXNwb25zZSB0aHJvdWdoIHRoZSANCgkJLy8gCQlmcmFtZSdzIHdpbmRvdy5uYW1lLg0KCQkvLw0KCQkvLwltZXRob2Q6DQoJCS8vCQlUaGUgbWV0aG9kIHRvIHVzZSB0byBzZW5kIHRoZSByZXF1ZXN0LCBHRVQgb3IgUE9TVA0KCQkvLw0KCQkvLwlhcmdzOg0KCQkvLwkJU2VlIGRvam8ueGhyDQoJCS8vDQoJCS8vCWFyZ3MuYXV0aEVsZW1lbnQ6IERPTU5vZGU/DQoJCS8vCQlCeSBwcm92aWRpbmcgYW4gYXV0aEVsZW1lbnQsIHRoaXMgaW5kaWNhdGVzIHRoYXQgd2luZG93TmFtZSBzaG91bGQgdXNlIHRoZSANCgkJLy8gCQlhdXRob3JpemVkIHdpbmRvdy5uYW1lIHByb3RvY29sLCByZWx5aW5nIG9uDQoJCS8vCQl0aGUgbG9hZGVkIFhEIHJlc291cmNlIHRvIHJldHVybiB0byB0aGUgcHJvdmlkZWQgcmV0dXJuIFVSTCBvbiBjb21wbGV0aW9uDQoJCS8vCQlvZiBhdXRob3JpemF0aW9uL2F1dGhlbnRpY2F0aW9uLiBUaGUgcHJvdmlkZWQgYXV0aEVsZW1lbnQgd2lsbCBiZSB1c2VkIHRvIHBsYWNlDQoJCS8vCQl0aGUgaWZyYW1lIGluLCBzbyB0aGUgdXNlciBjYW4gaW50ZXJhY3Qgd2l0aCB0aGUgc2VydmVyIHJlc291cmNlIGZvciBhdXRoZW50aWNhdGlvbg0KCQkvLwkJYW5kL29yIGF1dGhvcml6YXRpb24gdG8gYWNjZXNzIHRoZSByZXNvdXJjZS4NCgkJLy8NCgkJLy8JYXJncy5vbkF1dGhMb2FkOiBGdW5jdGlvbj8NCgkJLy8JCVdoZW4gdXNpbmcgYXV0aG9yaXplZCBhY2Nlc3MgdG8gcmVzb3VyY2VzLCB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlDQoJCS8vIAkJYXV0aG9yaXphdGlvbiBwYWdlIGhhcyBiZWVuIGxvYWRlZC4gKFdoZW4gYXV0aG9yaXphdGlvbiBpcyBhY3R1YWxseSBjb21wbGV0ZWQsDQoJCS8vIAkJdGhlIGRlZmVycmVkIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aXRoIHRoZSByZXN1bHQpLiBUaGUgcHJpbWFyeSB1c2UgZm9yIHRoaXMNCgkJLy8gCQlpcyB0byBtYWtlIHRoZSBhdXRoRWxlbWVudCB2aXNpYmxlIHRvIHRoZSB1c2VyIG9uY2UgdGhlIHJlc291cmNlIGhhcyBsb2FkZWQNCgkJLy8gCQkodGhpcyBjYW4gYmUgcHJlZmVyYWJsZSB0byBzaG93aW5nIHRoZSBpZnJhbWUgd2hpbGUgdGhlIHJlc291cmNlIGlzIGxvYWRpbmcNCgkJLy8gCQlzaW5jZSBpdCBtYXkgbm90IHJlcXVpcmUgYXV0aG9yaXphdGlvbiwgaXQgbWF5IHNpbXBseSByZXR1cm4gdGhlIHJlc291cmNlKS4gDQoJCS8vICANCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlJbiBvcmRlciB0byBwcm92aWRlIGEgd2luZG93bmFtZSB0cmFuc3BvcnQgYWNjZXNzaWJsZSByZXNvdXJjZXMvd2ViIHNlcnZpY2VzLCBhIHNlcnZlcg0KCQkvLyAJCXNob3VsZCBjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGEgcGFyYW1ldGVyIHdpbmRvdy5uYW1lPXRydWUgYW5kIGlmIGEgcmVxdWVzdCBpbmNsdWRlcw0KCQkvLyAJCXN1Y2ggYSBwYXJhbWV0ZXIsIGl0IHNob3VsZCByZXNwb25kIHRvIHRoZSByZXF1ZXN0IHdpdGggYW4gSFRNTCANCgkJLy8gCQlkb2N1bWVudCB0aGF0IHNldHMgaXQncyB3aW5kb3cubmFtZSB0byB0aGUgc3RyaW5nIHRoYXQgaXMgdG8gYmUgDQoJCS8vIAkJZGVsaXZlcmVkIHRvIHRoZSBjbGllbnQuIEZvciBleGFtcGxlLCBpZiBhIGNsaWVudCBtYWtlcyBhIHdpbmRvdy5uYW1lIHJlcXVlc3QgbGlrZToNCgkJLy8gCXwJaHR0cDovL290aGVyc2l0ZS5jb20vZ3JlZXRpbmc/d2luZG93bmFtZT10cnVlDQoJCS8vIAkJQW5kIHNlcnZlciB3YW50cyB0byByZXNwb25kIHRvIHRoZSBjbGllbnQgd2l0aCAiSGVsbG8iLCBpdCBzaG91bGQgcmV0dXJuIGFuIGh0bWwgcGFnZToNCgkJLy8gfAk8aHRtbD48c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCS8vIHwJd2luZG93Lm5hbWU9IkhlbGxvIjsNCgkJLy8gfAk8L3NjcmlwdD48L2h0bWw+DQoJCS8vIAkJT25lIGNhbiBwcm92aWRlIFhNTCBvciBKU09OIGRhdGEgYnkgc2ltcGx5IHF1b3RpbmcgdGhlIGRhdGEgYXMgYSBzdHJpbmcsIGFuZCBwYXJzaW5nIHRoZSBkYXRhDQoJCS8vIAkJb24gdGhlIGNsaWVudC4NCgkJLy8JCUlmIHlvdSB1c2UgdGhlIGF1dGhvcml6YXRpb24gd2luZG93Lm5hbWUgcHJvdG9jb2wsIHRoZSByZXF1ZXN0ZXIgc2hvdWxkIGluY2x1ZGUgYW4NCgkJLy8gCQlhdXRoRWxlbWVudCBlbGVtZW50IGluIHRoZSBhcmdzLCBhbmQgYSByZXF1ZXN0IHdpbGwgYmUgY3JlYXRlZCBsaWtlOg0KCQkvLyAJfAlodHRwOi8vb3RoZXJzaXRlLmNvbS9ncmVldGluZz93aW5kb3duYW1lPWF1dGgNCgkJLy8gCQlBbmQgdGhlIHNlcnZlciBjYW4gcmVzcG9uZCBsaWtlIHRoaXM6DQoJCS8vIHwJPGh0bWw+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KCQkvLyB8CXZhciBsb2MgPSB3aW5kb3cubmFtZTsNCgkJLy8gfAlhdXRob3JpemF0aW9uQnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpewkNCgkJLy8gfAkJd2luZG93Lm5hbWU9IkhlbGxvIjsNCgkJLy8gfAkJbG9jYXRpb24gPSBsb2M7DQoJCS8vIHwJfTsNCgkJLy8gfAk8L3NjcmlwdD48L2h0bWw+DQoJCS8vCQlXaGVuIHVzaW5nIHdpbmRvd05hbWUgZnJvbSBhIFhEIERvam8gYnVpbGQsIG1ha2Ugc3VyZSB0byBzZXQgdGhlIA0KCQkvLyAJCWRvam8uZG9qb0JsYW5rSHRtbFVybCBwcm9wZXJ0eSB0byBhIGxvY2FsIFVSTC4NCgkJYXJncy51cmwgKz0gKGFyZ3MudXJsLm1hdGNoKC9cPy8pID8gJyYnIDogJz8nKSArICJ3aW5kb3duYW1lPSIgKyAoYXJncy5hdXRoRWxlbWVudCA/ICJhdXRoIiA6IHRydWUpOyAvLyBpbmRpY2F0ZSBvdXIgZGVzaXJlIGZvciB3aW5kb3cubmFtZSBjb21tdW5pY2F0aW9uDQoJCXZhciBhdXRoRWxlbWVudCA9IGFyZ3MuYXV0aEVsZW1lbnQ7DQoJCXZhciBjbGVhbnVwID0gZnVuY3Rpb24ocmVzdWx0KXsNCgkJCXRyeXsNCgkJCQkvLyB3ZSBoYXZlIHRvIGRvIHRoaXMgdG8gc3RvcCB0aGUgd2FpdCBjdXJzb3IgaW4gRkYgDQoJCQkJdmFyIGlubmVyRG9jID0gZGZkLmlvQXJncy5mcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50Ow0KCQkJCWlubmVyRG9jLndyaXRlKCIgIik7DQoJCQkJaW5uZXJEb2MuY2xvc2UoKTsNCgkJCX1jYXRjaChlKXt9DQoJCQkoYXV0aEVsZW1lbnQgfHwgZG9qby5ib2R5KCkpLnJlbW92ZUNoaWxkKGRmZC5pb0FyZ3Mub3V0ZXJGcmFtZSk7IC8vIGNsZWFuIHVwDQoJCQlyZXR1cm4gcmVzdWx0Ow0KCQl9DQoJCXZhciBkZmQgPSBkb2pvLl9pb1NldEFyZ3MoYXJncyxjbGVhbnVwLGNsZWFudXAsY2xlYW51cCk7DQoJCWlmKGFyZ3MudGltZW91dCl7DQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJCWlmKGRmZC5maXJlZCA9PSAtMSl7DQoJCQkJCQlkZmQuY2FsbGJhY2sobmV3IEVycm9yKCJUaW1lb3V0IikpOw0KCQkJCQl9DQoJCQkJfSwNCgkJCQlhcmdzLnRpbWVvdXQNCgkJCSk7DQoJCX0NCgkJdmFyIHNlbGYgPSBkb2pveC5pby53aW5kb3dOYW1lOw0KCQlpZihkb2pvLmJvZHkoKSl7DQoJCQkvLyB0aGUgRE9NIGlzIHJlYWR5DQoJCQlzZWxmLl9zZW5kKGRmZCwgbWV0aG9kLCBhdXRoRWxlbWVudCwgYXJncy5vbkF1dGhMb2FkKTsNCgkJfWVsc2V7DQoJCQkvLyB3ZSB3aWxsIHdhaXQgZm9yIHRoZSBET00gdG8gYmUgcmVhZHkgdG8gcHJvY2VlZA0KCQkJZG9qby5hZGRPbkxvYWQoZnVuY3Rpb24oKXsNCgkJCQlzZWxmLl9zZW5kKGRmZCwgbWV0aG9kLCBhdXRoRWxlbWVudCwgYXJncy5vbkF1dGhMb2FkKTsNCgkJCX0pOw0KCQl9DQoJCXJldHVybiBkZmQ7DQoJfSwNCglfc2VuZDogZnVuY3Rpb24oZGZkLCBtZXRob2QsIGF1dGhUYXJnZXQsIG9uQXV0aExvYWQpew0KDQoJCXZhciBpb0FyZ3MgPSBkZmQuaW9BcmdzOw0KCQl2YXIgZnJhbWVOdW0gPSBkb2pveC5pby53aW5kb3dOYW1lLl9mcmFtZU51bSsrOw0KCQl2YXIgc2FtZURvbWFpblVybCA9IChkb2pvLmNvbmZpZy5kb2pvQmxhbmtIdG1sVXJsfHxkb2pvLmNvbmZpZy5kb2pvQ2FsbGJhY2tVcmx8fGRvam8ubW9kdWxlVXJsKCJkb2pvIiwgInJlc291cmNlcy9ibGFuay5odG1sIikpICsgIiMiICsgZnJhbWVOdW07DQoJCXZhciBmcmFtZU5hbWUgPSBuZXcgZG9qby5fVXJsKHdpbmRvdy5sb2NhdGlvbiwgc2FtZURvbWFpblVybCk7DQoJCXZhciBkb2MgPSBkb2pvLmRvYzsNCgkJdmFyIGZyYW1lQ29udGFpbmVyID0gYXV0aFRhcmdldCB8fCBkb2pvLmJvZHkoKTsNCgkJZnVuY3Rpb24gc3R5bGVGcmFtZShmcmFtZSl7DQoJCQlmcmFtZS5zdHlsZS53aWR0aD0iMTAwJSI7DQoJCQlmcmFtZS5zdHlsZS5oZWlnaHQ9IjEwMCUiOw0KCQkJZnJhbWUuc3R5bGUuYm9yZGVyPSIwcHgiOw0KCQl9DQoJCWlmKGRvam8uaXNNb3ogJiYgIVtdLnJlZHVjZSl7DQoJCQkvLyBGRjIgYWxsb3dzIHVuc2FmZSBzaWJsaW5nIGZyYW1lIG1vZGlmaWNhdGlvbiwNCgkJCS8vIHRoZSBmaXggZm9yIHRoaXMgaXMgdG8gY3JlYXRlIG5lc3RlZCBmcmFtZXMgd2l0aCBnZXR0ZXJzIGFuZCBzZXR0ZXJzIHRvIHByb3RlY3QgYWNjZXNzDQoJCQl2YXIgb3V0ZXJGcmFtZSA9IGRvYy5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTsNCgkJCXN0eWxlRnJhbWUob3V0ZXJGcmFtZSk7DQoJCQlpZighYXV0aFRhcmdldCl7DQoJCQkJb3V0ZXJGcmFtZS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCgkJCX0NCgkJCWZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKG91dGVyRnJhbWUpOw0KCQkJDQoJCQl2YXIgZmlyc3RXaW5kb3cgPSBvdXRlckZyYW1lLmNvbnRlbnRXaW5kb3c7DQoJCQlkb2MgPSBmaXJzdFdpbmRvdy5kb2N1bWVudDsNCgkJCWRvYy53cml0ZSgiPGh0bWw+PGJvZHkgbWFyZ2luPScwcHgnPjxpZnJhbWUgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Ym9yZGVyOjBweCcgbmFtZT0ncHJvdGVjdGVkRnJhbWUnPjwvaWZyYW1lPjwvYm9keT48L2h0bWw+Iik7DQoJCQlkb2MuY2xvc2UoKTsNCgkJCXZhciBzZWNvbmRXaW5kb3cgPSBmaXJzdFdpbmRvd1swXTsgDQoJCQlmaXJzdFdpbmRvdy5fX2RlZmluZUdldHRlcl9fKDAsZnVuY3Rpb24oKXt9KTsNCgkJCWZpcnN0V2luZG93Ll9fZGVmaW5lR2V0dGVyX18oInByb3RlY3RlZEZyYW1lIixmdW5jdGlvbigpe30pOw0KCQkJZG9jID0gc2Vjb25kV2luZG93LmRvY3VtZW50Ow0KCQkJZG9jLndyaXRlKCI8aHRtbD48Ym9keSBtYXJnaW49JzBweCc+PC9ib2R5PjwvaHRtbD4iKTsNCgkJCWRvYy5jbG9zZSgpOw0KCQkJZnJhbWVDb250YWluZXIgPSBkb2MuYm9keTsNCgkJfQ0KDQogICAgICAgIC8qKiBPV0YgUEFUQ0ggdG8gZml4IGNyZWF0ZUVsZW1lbnQgdXNhZ2UgZm9yIElFOSBzdGFuZGFyZHMgbW9kZSAqKi8NCgkJLy92YXIgZnJhbWUgPSBpb0FyZ3MuZnJhbWUgPSBmcmFtZSA9IGRvYy5jcmVhdGVFbGVtZW50KGRvam8uaXNJRSA/ICc8aWZyYW1lIHNyYz0iaW5pdF9zcmMuaHRtbCIgbmFtZT0iJyArIGZyYW1lTmFtZSArICciIG9ubG9hZD0iJytkb2pveC5fc2NvcGVOYW1lKycuaW8ud2luZG93TmFtZVsnK2ZyYW1lTnVtKyddKCkiPicgOiAnaWZyYW1lJyk7DQoJCXZhciBmcmFtZSA9IGlvQXJncy5mcmFtZSA9IGZyYW1lID0gZG9jLmNyZWF0ZUVsZW1lbnQoZG9qby5pc0lFIDwgOSA/ICc8aWZyYW1lIHNyYz0iaW5pdF9zcmMuaHRtbCIgbmFtZT0iJyArIGZyYW1lTmFtZSArICciIG9ubG9hZD0iJytkb2pveC5fc2NvcGVOYW1lKycuaW8ud2luZG93TmFtZVsnK2ZyYW1lTnVtKyddKCkiPicgOiAnaWZyYW1lJyk7DQoJCXN0eWxlRnJhbWUoZnJhbWUpOw0KCQlpb0FyZ3Mub3V0ZXJGcmFtZSA9IG91dGVyRnJhbWUgPSBvdXRlckZyYW1lIHx8IGZyYW1lOw0KCQlpZighYXV0aFRhcmdldCl7DQoJCQlvdXRlckZyYW1lLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KCQl9DQoJCXZhciBzdGF0ZSA9IDA7DQoJCWZ1bmN0aW9uIGdldERhdGEoKXsNCgkJCXZhciBkYXRhID0gZnJhbWUuY29udGVudFdpbmRvdy5uYW1lOw0KCQkJaWYodHlwZW9mIGRhdGEgPT0gJ3N0cmluZycpew0KCQkJCWlmKGRhdGEgIT0gZnJhbWVOYW1lKXsNCgkJCQkJc3RhdGUgPSAyOyAvLyB3ZSBhcmUgZG9uZSBub3cNCgkJCQkJZGZkLmlvQXJncy5oYXNoID0gZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbi5oYXNoOw0KCQkJCQlkZmQuY2FsbGJhY2soZGF0YSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCWRvam94LmlvLndpbmRvd05hbWVbZnJhbWVOdW1dID0gZnJhbWUub25sb2FkID0gZnVuY3Rpb24oKXsNCgkJCXRyeXsNCgkJCQlpZihmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uID09J2Fib3V0OmJsYW5rJyl7DQoJCQkJCS8vIG9wZXJhIGFuZCBzYWZhcmkgd2lsbCBkbyBhbiBvbmxvYWQgZm9yIGFib3V0OmJsYW5rIGZpcnN0LCB3ZSBjYW4gaWdub3JlIHRoaXMgZmlyc3Qgb25sb2FkDQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQl9Y2F0Y2goZSl7DQoJCQkJLy8gaWYgd2UgYXJlIGluIHRoZSB0YXJnZXQgZG9tYWluLCBmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uIHdpbGwgdGhyb3cgYW4gaWdub3JhYmxlIGVycm9yIA0KCQkJfQ0KCQkJaWYoIXN0YXRlKXsNCgkJCQkvLyB3ZSBoYXZlIGxvYWRlZCB0aGUgdGFyZ2V0IHJlc291cmNlLCBub3cgdGltZSB0byBuYXZpZ2F0ZSBiYWNrIHRvIG91ciBkb21haW4gc28gd2UgY2FuIHJlYWQgdGhlIGZyYW1lIG5hbWUNCgkJCQlzdGF0ZT0xOw0KCQkJCWlmKGF1dGhUYXJnZXQpew0KCQkJCQkvLyBjYWxsIHRoZSBjYWxsYmFjayBzbyBpdCBjYW4gbWFrZSBpdCB2aXNpYmxlDQoJCQkJCWlmKG9uQXV0aExvYWQpew0KCQkJCQkJb25BdXRoTG9hZCgpOw0KCQkJCQl9DQoJCQkJfWVsc2V7DQoJCQkJCS8vIHdlIGFyZSBkb2luZyBhIHN5bmNocm9ub3VzIGNhcHR1cmUsIGdvIGRpcmVjdGx5IHRvIG91ciBzYW1lIGRvbWFpbiBVUkwgYW5kIHJldHJpZXZlIHRoZSByZXNvdXJjZQ0KCQkJCQlmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uID0gc2FtZURvbWFpblVybDsNCgkJCQl9DQoJCQl9DQoJCQkvLyBiYWNrIHRvIG91ciBkb21haW4sIHdlIHNob3VsZCBiZSBhYmxlIHRvIGFjY2VzcyB0aGUgZnJhbWUgbmFtZSBub3cNCgkJCXRyeXsNCgkJCQlpZihzdGF0ZTwyKXsNCgkJCQkJZ2V0RGF0YSgpOw0KCQkJCX0NCgkJCX0NCgkJCWNhdGNoKGUpew0KCQkJfQ0KCQkJDQoJCX07DQoJCWZyYW1lLm5hbWUgPSBmcmFtZU5hbWU7DQoJCWlmKG1ldGhvZC5tYXRjaCgvR0VUL2kpKXsNCgkJCS8vIGlmIGl0IGlzIGEgR0VUIHdlIGNhbiBqdXN0IHRoZSBpZnJhbWUgb3VyIHNyYyB1cmwNCgkJCWRvam8uX2lvQWRkUXVlcnlUb1VybChpb0FyZ3MpOw0KCQkJZnJhbWUuc3JjID0gaW9BcmdzLnVybDsNCgkJCWZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYW1lKTsNCgkJCS8vIENvbW1lbnRlZCB0aGVzZSBsaW5lcyBvdXQgZm9yIE9XRi0zMTMxOiBSRVNUIGNhbGxzIGdldCBhYm9ydGVkIHdoZW4gTWFya2V0cGxhY2Ugd2lkZ2V0IGlzIHVzZWQgaW4gT1dGLg0KLy8JCQlpZihmcmFtZS5jb250ZW50V2luZG93KXsNCi8vCQkJCWZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVwbGFjZShpb0FyZ3MudXJsKTsNCi8vCQkJfQ0KCQl9ZWxzZSBpZihtZXRob2QubWF0Y2goL1BPU1QvaSkpew0KCQkJLy8gaWYgaXQgaXMgYSBQT1NUIHdlIHdpbGwgYnVpbGQgYSBmb3JtIHRvIHBvc3QgaXQNCgkJCWZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYW1lKTsNCgkJCXZhciBmb3JtID0gZG9qby5kb2MuY3JlYXRlRWxlbWVudCgiZm9ybSIpOw0KCQkJZG9qby5ib2R5KCkuYXBwZW5kQ2hpbGQoZm9ybSk7DQoJCQl2YXIgcXVlcnkgPSBkb2pvLnF1ZXJ5VG9PYmplY3QoaW9BcmdzLnF1ZXJ5KTsNCgkJCWZvcih2YXIgaSBpbiBxdWVyeSl7DQoJCQkJdmFyIHZhbHVlcyA9IHF1ZXJ5W2ldOw0KCQkJCXZhbHVlcyA9IHZhbHVlcyBpbnN0YW5jZW9mIEFycmF5ID8gdmFsdWVzIDogW3ZhbHVlc107DQoJCQkJZm9yKHZhciBqID0gMDsgaiA8IHZhbHVlcy5sZW5ndGg7IGorKyl7DQoJCQkJCS8vIGNyZWF0ZSBoaWRkZW4gaW5wdXRzIGZvciBhbGwgdGhlIHBhcmFtZXRlcnMNCgkJCQkJdmFyIGlucHV0ID0gZG9jLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoJCQkJCWlucHV0LnR5cGUgPSAnaGlkZGVuJzsNCgkJCQkJaW5wdXQubmFtZSA9IGk7DQoJCQkJCWlucHV0LnZhbHVlID0gdmFsdWVzW2pdOw0KCQkJCQlmb3JtLmFwcGVuZENoaWxkKGlucHV0KTsNCgkJCQl9DQoJCQl9DQoJCQlmb3JtLm1ldGhvZCA9ICdQT1NUJzsNCgkJCWZvcm0uYWN0aW9uID0gaW9BcmdzLnVybDsNCgkJCWZvcm0udGFyZ2V0ID0gZnJhbWVOYW1lOy8vIGNvbm5lY3QgdGhlIGZvcm0gdG8gdGhlIGlmcmFtZQ0KCQkJDQoJCQlmb3JtLnN1Ym1pdCgpOw0KCQkJZm9ybS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZvcm0pOw0KCQl9ZWxzZXsNCgkJCXRocm93IG5ldyBFcnJvcigiTWV0aG9kICIgKyBtZXRob2QgKyAiIG5vdCBzdXBwb3J0ZWQgd2l0aCB0aGUgd2luZG93TmFtZSB0cmFuc3BvcnQiKTsNCgkJfQ0KCQlpZihmcmFtZS5jb250ZW50V2luZG93KXsNCgkJCWZyYW1lLmNvbnRlbnRXaW5kb3cubmFtZSA9IGZyYW1lTmFtZTsgLy8gSUUgbGlrZXMgaXQgYWZ0ZXJ3YXJkcw0KCQl9DQoJfSwNCglfZnJhbWVOdW06IDAgDQoJDQp9DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pveC5zZWN1cmUuY2FwYWJpbGl0eSJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qb3guc2VjdXJlLmNhcGFiaWxpdHkiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam94LnNlY3VyZS5jYXBhYmlsaXR5Iik7DQoNCmRvam94LnNlY3VyZS5iYWRQcm9wcyA9IC9eX198XihhcHBseXxjYWxsfGNhbGxlZXxjYWxsZXJ8Y29uc3RydWN0b3J8ZXZhbHxwcm90b3R5cGV8dGhpc3x1bndhdGNofHZhbHVlT2Z8d2F0Y2gpJHxfXyQvOw0KZG9qb3guc2VjdXJlLmNhcGFiaWxpdHkgPSB7DQoJa2V5d29yZHM6IFsiYnJlYWsiLCAiY2FzZSIsICJjYXRjaCIsICJjb25zdCIsICJjb250aW51ZSIsImRlYnVnZ2VyIiwgImRlZmF1bHQiLCAiZGVsZXRlIiwgImRvIiwNCgkJICJlbHNlIiwgImVudW0iLCJmYWxzZSIsICJmaW5hbGx5IiwgImZvciIsICJmdW5jdGlvbiIsImlmIiwgImluIiwgImluc3RhbmNlb2YiLCAibmV3IiwgDQoJCSAibnVsbCIsInlpZWxkIiwicmV0dXJuIiwgInN3aXRjaCIsICANCgkJICJ0aHJvdyIsICJ0cnVlIiwgInRyeSIsICJ0eXBlb2YiLCAidmFyIiwgInZvaWQiLCAid2hpbGUiXSwNCgl2YWxpZGF0ZSA6IGZ1bmN0aW9uKC8qc3RyaW5nKi9zY3JpcHQsLypBcnJheSovc2FmZUxpYnJhcmllcywvKk9iamVjdCovc2FmZUdsb2JhbHMpIHsNCgkJLy8gc3VtbWFyeToNCgkJLy8gCQlwYXNzIGluIHRoZSB0ZXh0IG9mIGEgc2NyaXB0LiBJZiBpdCBwYXNzZXMgYW5kIGl0IGNhbiBiZSBldmFsJ2VkLCBpdCBzaG91bGQgYmUgc2FmZS4gDQoJCS8vIAkJTm90ZSB0aGF0IHRoaXMgZG9lcyBub3QgZG8gZnVsbCBzeW50YXggY2hlY2tpbmcsIGl0IHJlbGllcyBvbiBldmFsIHRvIHJlamVjdCBpbnZhbGlkIHNjcmlwdHMuDQoJCS8vIAkJVGhlcmUgYXJlIGFsc28ga25vd24gZmFsc2UgcmVqZWN0aW9uczoNCgkJLy8gCQkJTmVzdGluZyB2YXJzIGluc2lkZSBibG9ja3Mgd2lsbCBub3QgZGVjbGFyZSB0aGUgdmFyaWFibGUgZm9yIHRoZSBvdXRlciBibG9jaw0KCQkvLyAJIAkJTmFtZWQgZnVuY3Rpb25zIGFyZSBub3QgdHJlYXRlZCBhcyBkZWNsYXJhdGlvbiBzbyB0aGV5IGFyZSBnZW5lcmFsbHkgbm90IGFsbG93ZWQgdW5sZXNzIHRoZSBuYW1lIGlzIGRlY2xhcmVkIHdpdGggYSB2YXIuCQ0KCQkvLwkJCVZhciBkZWNsYXJhdGlvbiB0aGF0IGludm9sdmUgbXVsdGlwbGUgY29tbWEgZGVsaW1pdGVkIHZhcmlhYmxlIGFzc2lnbm1lbnRzIGFyZSBub3QgYWNjZXB0ZWQNCgkJLy8NCgkJLy8gc2NyaXB0Og0KCQkvLyAJCSB0aGUgc2NyaXB0IHRvIGV4ZWN1dGUNCgkJLy8NCgkJLy8gc2FmZUxpYnJhcmllczoNCgkJLy8gCQlUaGUgc2FmZSBsaWJyYXJpZXMgdGhhdCBjYW4gYmUgY2FsbGVkICh0aGUgZnVuY3Rpb25zIGNhbiBub3QgYmUgYWNjZXNzL21vZGlmaWVkIGJ5IHRoZSB1bnRydXN0ZWQgY29kZSwgb25seSBjYWxsZWQpIA0KCQkvLw0KCQkvLyBzYWZlR2xvYmFsczoNCgkJLy8gCQlUaGVzZSBnbG9iYWxzIGNhbiBiZSBmcmVlbHkgaW50ZXJhY3RlZCB3aXRoIGJ5IHRoZSB1bnRydXN0ZWQgY29kZQ0KCQkNCgkNCgkJdmFyIGtleXdvcmRzID0gdGhpcy5rZXl3b3JkczsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBrZXl3b3Jkcy5sZW5ndGg7IGkrKykgew0KCQkJc2FmZUdsb2JhbHNba2V5d29yZHNbaV1dPXRydWU7DQoJCX0NCgkJdmFyIGJhZFRoaXMgPSAifHRoaXN8IGtleXdvcmQgaW4gb2JqZWN0IGxpdGVyYWwgd2l0aG91dCBhIENsYXNzIGNhbGwiOw0KCQl2YXIgYmxvY2tzID0gW107IC8vIGtlZXBzIHRyYWNrIG9mIHRoZSBvdXRlciByZWZlcmVuY2VzIGZyb20gZWFjaCBpbm5lciBibG9jaw0KCQlpZihzY3JpcHQubWF0Y2goL1tcdTIwMGMtXHUyMDBmXHUyMDJhLVx1MjAyZVx1MjA2YS1cdTIwNmZcdWZmMDAtXHVmZmZmXS8pKXsNCgkJCXRocm93IG5ldyBFcnJvcigiSWxsZWdhbCB1bmljb2RlIGNoYXJhY3RlcnMgZGV0ZWN0ZWQiKTsNCgkJfQ0KCQlpZihzY3JpcHQubWF0Y2goL1wvXCpAY2Nfb24vKSl7DQoJCQl0aHJvdyBuZXcgRXJyb3IoIkNvbmRpdGlvbmFsIGNvbXBpbGF0aW9uIHRva2VuIGlzIG5vdCBhbGxvd2VkIik7DQoJCX0NCgkJc2NyaXB0ID0gc2NyaXB0LnJlcGxhY2UoL1xcWyInXFxcL2JmbnJ0dV0vZywgJ0AnKS4gLy8gYm9ycm93cyBzb21lIHRyaWNrcyBmcm9tIGpzb24uanMNCgkJCS8vIG5vdyBjbGVhciBsaW5lIGNvbW1lbnRzLCBibG9jayBjb21tZW50cywgcmVndWxhciBleHByZXNzaW9ucywgYW5kIHN0cmluZ3MuDQoJCQkvLyBCeSBkb2luZyBpdCBhbGwgYXQgb25jZSwgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VzIGxlZnQgdG8gcmlnaHQgcGFyc2luZywgYW5kIHRoZSBtb3N0DQoJCQkvLyBsZWZ0IHRva2VuIGlzIHJlYWQgZmlyc3QuIEl0IGlzIGFsc28gbW9yZSBjb21wYWN0Lg0KCQkJcmVwbGFjZSgvXC9cLy4qfFwvXCpbXHdcV10qP1wqXC98XC8oXFxbXC9cXF18W14qXC9dKShcXC58W15cL1xuXFxdKSpcL1tnaW1dKnwoIlteIl0qIil8KCdbXiddKicpL2csZnVuY3Rpb24odCkgew0KCQkJCXJldHVybiB0Lm1hdGNoKC9eXC9cL3xeXC9cKi8pID8gJyAnIDogJzAnOyAvLyBjb21tZW50cyBhcmUgcmVwbGFjZWQgd2l0aCBhIHNwYWNlLCBzdHJpbmdzIGFuZCByZWdleCBhcmUgcmVwbGFjZWQgd2l0aCBhIHNpbmdsZSBzYWZlIHRva2VuICgwKQ0KCQkJfSkuDQoJCQlyZXBsYWNlKC9cLlxzKihbYS16XCRfQS1aXVtcd1wkX10qKXwoWzsse10pXHMqKFthLXpcJF9BLVpdW1x3XCRfXSpccyopOi9nLGZ1bmN0aW9uKHQscHJvcCxwcmVmaXgsa2V5KSB7IA0KCQkJCS8vIGZpbmQgYWxsIHRoZSBkb3QgcHJvcGVydHkgcmVmZXJlbmNlcywgYWxsIHRoZSBvYmplY3QgbGl0ZXJhbCBrZXlzLCBhbmQgbGFiZWxzDQoJCQkJcHJvcCA9IHByb3AgfHwga2V5OyANCgkJCQlpZigvXl9ffF4oYXBwbHl8Y2FsbHxjYWxsZWV8Y2FsbGVyfGNvbnN0cnVjdG9yfGV2YWx8cHJvdG90eXBlfHRoaXN8dW53YXRjaHx2YWx1ZU9mfHdhdGNoKSR8X18kLy50ZXN0KHByb3ApKXsNCgkJCQkJdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIHByb3BlcnR5IG5hbWUgIiArIHByb3ApOw0KCQkJCX0NCgkJCQlyZXR1cm4gKHByZWZpeCAmJiAocHJlZml4ICsgIjA6IikpIHx8ICd+JzsgLy8gcmVwbGFjZSBsaXRlcmFsIGtleXMgd2l0aCAwOiBhbmQgcmVwbGFjZSBwcm9wZXJ0aWVzIHdpdGggdGhlIGlubm9jdW91cyB+DQoJCQl9KTsNCgkJc2NyaXB0LnJlcGxhY2UoLyhbXlxbXVtcXVx9XVxzKj0pfCgoXFdyZXR1cm58XFMpXHMqXFtccypcKz8pfChbXj0hXVs9IV09W149XSkvZyxmdW5jdGlvbihvcGVyKSB7Ly8gY2hlY2sgZm9yIGlsbGVnYWwgb3BlcmF0b3IgdXNhZ2VzDQoJCQlpZighb3Blci5tYXRjaCgvKChcV3JldHVybnxbPVwmXHxcOlw/XCxdKVxzKlxbKXxcW1xzKlwrJC8pKXsgLy8gdGhlIHdoaXRlbGlzdCBmb3IgWyBvcGVyYXRvciBmb3IgYXJyYXkgaW5pdGlhbGl6ZXIgY29udGV4dCBvciBbK251bV0gc3ludGF4DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIG9wZXJhdG9yICIgKyBvcGVyLnN1YnN0cmluZygxKSk7DQoJCQl9DQoJCX0pOw0KCQlzY3JpcHQgPSBzY3JpcHQucmVwbGFjZShuZXcgUmVnRXhwKCIoIiArIHNhZmVMaWJyYXJpZXMuam9pbigifCIpICsgIilbXFxzfl0qXFwoIiwiZyIpLGZ1bmN0aW9uKGNhbGwpIHsgLy8gZmluZCBsaWJyYXJ5IGNhbGxzIGFuZCBtYWtlIHRoZW0gbG9vayBzYWZlDQoJCQlyZXR1cm4gIm5ldygiOyAvLyB0dXJuIGludG8gYSBrbm93biBzYWZlIGNhbGwgDQoJCX0pOw0KCQlmdW5jdGlvbiBmaW5kT3V0ZXJSZWZzKGJsb2NrLGZ1bmMpIHsNCgkJCXZhciBvdXRlclJlZnMgPSB7fTsNCgkJCWJsb2NrLnJlcGxhY2UoLyNcZCsvZyxmdW5jdGlvbihiKSB7IC8vIGdyYWZ0IGluIHRoZSBvdXRlciByZWZlcmVuY2VzIGZyb20gdGhlIGlubmVyIHNjb3Blcw0KCQkJCXZhciByZWZzID0gYmxvY2tzW2Iuc3Vic3RyaW5nKDEpXTsNCgkJCQlmb3IgKHZhciBpIGluIHJlZnMpIHsNCgkJCQkJaWYoaSA9PSBiYWRUaGlzKSB7DQoJCQkJCQl0aHJvdyBpOw0KCQkJCQl9DQoJCQkJCWlmKGkgPT0gJ3RoaXMnICYmIHJlZnNbJzptZXRob2QnXSAmJiByZWZzWyd0aGlzJ10gPT0gMSkgew0KCQkJCQkJLy8gaWYgd2UgYXJlIGluIGFuIG9iamVjdCBsaXRlcmFsIHRoZSBmdW5jdGlvbiBtYXkgYmUgYSBiaW5kYWJsZSBtZXRob2QsIHRoaXMgbXVzdCBvbmx5IGJlIGluIHRoZSBsb2NhbCBzY29wZQ0KCQkJCQkJaSA9IGJhZFRoaXM7DQoJCQkJCX0NCgkJCQkJaWYoaSAhPSAnOm1ldGhvZCcpew0KCQkJCQkJb3V0ZXJSZWZzW2ldID0gMjsgLy8gdGhlIHJlZmVyZW5jZSBpcyBtb3JlIHRoYW4ganVzdCBsb2NhbA0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoJCQlibG9jay5yZXBsYWNlKC8oXFd8XikoW2Etel9cJEEtWl1bXHdfXCRdKikvZyxmdW5jdGlvbih0LGEsaWRlbnRpZmllcikgeyAvLyBmaW5kIGFsbCB0aGUgaWRlbnRpZmllcnMNCgkJCQlpZihpZGVudGlmaWVyLmNoYXJBdCgwKT09J18nKXsNCgkJCQkJdGhyb3cgbmV3IEVycm9yKCJOYW1lcyBtYXkgbm90IHN0YXJ0IHdpdGggXyIpOw0KCQkJCX0NCgkJCQlvdXRlclJlZnNbaWRlbnRpZmllcl0gPSAxOw0KCQkJfSk7DQoJCQlyZXR1cm4gb3V0ZXJSZWZzOw0KCQl9CQ0KCQl2YXIgbmV3U2NyaXB0LG91dGVyUmVmczsNCgkJZnVuY3Rpb24gcGFyc2VCbG9jayh0LGZ1bmMsYSxiLHBhcmFtcyxibG9jaykgew0KCQkJYmxvY2sucmVwbGFjZSgvKF58LCkwOlxzKmZ1bmN0aW9uIyhcZCspL2csZnVuY3Rpb24odCxhLGIpIHsgLy8gZmluZCBmdW5jdGlvbnMgaW4gb2JqZWN0IGxpdGVyYWxzDQoJCQkvLyBub3RlIHRoYXQgaWYgbmFtZWQgZnVuY3Rpb25zIGFyZSBhbGxvd2VkLCBpdCBjb3VsZCBiZSBwb3NzaWJsZSB0byBoYXZlIGxhYmVsOiBmdW5jdGlvbiBuYW1lKCkge30gd2hpY2ggaXMgYSBzZWN1cml0eSBicmVhY2gNCgkJCQkJdmFyIHJlZnMgPSBibG9ja3NbYl07IA0KCQkJCQlyZWZzWyc6bWV0aG9kJ10gPSAxOy8vbWFyayBpdCBhcyBhIG1ldGhvZA0KCQkJfSk7DQoJCQlibG9jayA9IGJsb2NrLnJlcGxhY2UoLyhefFteX1x3XCRdKUNsYXNzXHMqXChccyooW19cd1wkXStccyosXHMqKSojKFxkKykvZyxmdW5jdGlvbih0LHAsYSxiKSB7IC8vIGZpbmQgQ2xhc3MgY2FsbHMNCgkJCQkJdmFyIHJlZnMgPSBibG9ja3NbYl07DQoJCQkJCWRlbGV0ZSByZWZzW2JhZFRoaXNdOw0KCQkJCQlyZXR1cm4gKHB8fCcnKSArIChhfHwnJykgKyAiIyIgKyBiOw0KCQkJfSk7DQoJCQlvdXRlclJlZnMgPSBmaW5kT3V0ZXJSZWZzKGJsb2NrLGZ1bmMpOyAvLyBmaW5kIHRoZSB2YXJpYWJsZXMgaW4gdGhpcyBibG9jaw0KCQkJZnVuY3Rpb24gcGFyc2VWYXJzKHQsYSxiLGRlY2wpIHsgLy8gZmluZCB2YXIgZGVjbHMNCgkJCQlkZWNsLnJlcGxhY2UoLyw/KFthLXpcJEEtWl1bX1x3XCRdKikvZyxmdW5jdGlvbih0LGlkZW50aWZpZXIpIHsNCgkJCQkJaWYoaWRlbnRpZmllciA9PSAnQ2xhc3MnKXsNCgkJCQkJCXRocm93IG5ldyBFcnJvcigiQ2xhc3MgaXMgcmVzZXJ2ZWQiKTsNCgkJCQkJfQ0KCQkJCQlkZWxldGUgb3V0ZXJSZWZzW2lkZW50aWZpZXJdOyAvLyBvdXRlciByZWZlcmVuY2UgaXMgc2FmZWx5IHJlZmVyZW5jZWQgaGVyZQ0KCQkJCX0pOw0KCQkJfQ0KCQkJDQoJCQlpZihmdW5jKSB7DQoJCQkJcGFyc2VWYXJzKHQsYSxhLHBhcmFtcyk7IC8vIHRoZSBwYXJhbWV0ZXJzIGFyZSBkZWNsYXJlIHZhcmlhYmxlcw0KCQkJfQ0KCQkJYmxvY2sucmVwbGFjZSgvKFxXfF4pKHZhcikgKFsgXHQsX1x3XCRdKykvZyxwYXJzZVZhcnMpOyAvLyBhbmQgdmFycyBkZWNsYXJlIHZhcmlhYmxlcw0KCQkJLy8gRklYTUU6IEdpdmUgbmFtZWQgZnVuY3Rpb25zICNuYW1lIHN5bnRheCBzbyB0aGV5IGNhbiBiZSBkZXRlY3RlZCBhcyB2YXJzIGluIG91dGVyIHNjb3BlcyAoYnV0IGJlIGNhcmVmdWwgb2YgbmVzdGluZykNCgkJCXJldHVybiAoYSB8fCAnJykgKyAoYiB8fCAnJykgKyAiIyIgKyAoYmxvY2tzLnB1c2gob3V0ZXJSZWZzKS0xKTsgLy8gcmV0dXJuIGEgYmxvY2sgcmVmZXJlbmNlIHNvIHRoZSBvdXRlciBibG9jayBjYW4gZmV0Y2ggaXQgDQoJCX0JDQoJCWRvIHsNCgkJCS8vIGdldCBhbGwgdGhlIGJsb2Nrcywgc3RhcnRpbmcgd2l0aCBpbnNpZGUgYW5kIG1vdmluZyBvdXQsIGNhcHR1cmluZyB0aGUgcGFyYW1ldGVycyBvZiBmdW5jdGlvbnMgYW5kIGNhdGNocyBhcyB2YXJpYWJsZXMgYWxvbmcgdGhlIHdheQ0KCQkJbmV3U2NyaXB0ID0gc2NyaXB0LnJlcGxhY2UoLygoZnVuY3Rpb258Y2F0Y2gpKFxzK1tfXHdcJF0rKT9ccypcKChbXlwpXSopXClccyopP3soW157fV0qKX0vZywgcGFyc2VCbG9jayk7IA0KCQl9DQoJCXdoaWxlKG5ld1NjcmlwdCAhPSBzY3JpcHQgJiYgKHNjcmlwdCA9IG5ld1NjcmlwdCkpOyAvLyBrZWVwIGdvaW5nIHVudGlsIHdlIGNhbid0IGZpbmQgYW55bW9yZSBibG9ja3MNCgkJcGFyc2VCbG9jaygwLDAsMCwwLDAsc2NyaXB0KTsgLy9maW5kT3V0ZXJSZWZzKHNjcmlwdCk7IC8vIGZpbmQgdGhlIHJlZmVyZW5jZXMgaW4gdGhlIG91dHNpZGUgc2NvcGUNCgkJZm9yIChpIGluIG91dGVyUmVmcykgew0KCQkJaWYoIShpIGluIHNhZmVHbG9iYWxzKSkgew0KCQkJCXRocm93IG5ldyBFcnJvcigiSWxsZWdhbCByZWZlcmVuY2UgdG8gIiArIGkpOw0KCQkJfQ0KCQl9DQoJCQ0KCX0NCn07DQoNCn0NCg0KCS8vSU5TRVJUIGRvam8uaTE4bi5fcHJlbG9hZExvY2FsaXphdGlvbnMgSEVSRQ0KDQoJLy9DaGVjayBpZiBkb2N1bWVudCBhbHJlYWR5IGNvbXBsZXRlLCBhbmQgaWYgc28sIGp1c3QgdHJpZ2dlciBwYWdlIGxvYWQNCgkvL2xpc3RlbmVycy4gTk9URTogZG9lcyBub3Qgd29yayB3aXRoIEZpcmVmb3ggYmVmb3JlIDMuNi4gVG8gc3VwcG9ydA0KCS8vdGhvc2UgYnJvd3NlcnMsIHNldCBkakNvbmZpZy5hZnRlck9uTG9hZCA9IHRydWUgd2hlbiB5b3Uga25vdyBEb2pvIGlzIGFkZGVkDQoJLy9hZnRlciBwYWdlIGxvYWQuIFVzaW5nIGEgdGltZW91dCBzbyB0aGUgcmVzdCBvZiB0aGlzDQoJLy9zY3JpcHQgZ2V0cyBldmFsdWF0ZWQgcHJvcGVybHkuIFRoaXMgd29yayBuZWVkcyB0byBoYXBwZW4gYWZ0ZXIgdGhlDQoJLy9kb2pvLmNvbmZpZy5yZXF1aXJlIHdvcmsgZG9uZSBpbiBkb2pvLl9iYXNlLg0KCWlmKGRvam8uaXNCcm93c2VyICYmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiIHx8IGRvam8uY29uZmlnLmFmdGVyT25Mb2FkKSl7DQoJCXdpbmRvdy5zZXRUaW1lb3V0KGRvam8uX2xvYWRJbml0LCAxMDApOw0KCX0NCn0pKCk7DQoNCgovKioNCiAqIEBpZ25vcmUNCiAqLw0KdmFyIE96b25lID0gT3pvbmUgfHwge307DQovKioNCiAqIEBpZ25vcmUNCiAqLw0KT3pvbmUudXRpbCA9IE96b25lLnV0aWwgfHwge307DQovKioNCiAqIEBuYW1lc3BhY2UNCiAqLw0KT3pvbmUudXRpbC5wYWdlTG9hZCA9IE96b25lLnV0aWwucGFnZUxvYWQgfHwge307DQoNCi8qKg0KICogQGZpZWxkDQogKiBAZGVzY3JpcHRpb24gZW5hYmxlIG9yIGRpc2FibGUgdGhlIGF1dG9tYXRpYyBzZW5kaW5nIG9mIGxvYWR0aW1lDQogKi8NCk96b25lLnV0aWwucGFnZUxvYWQuYXV0b1NlbmQgPSB0cnVlOw0KDQovKioNCiAqIEBmaWVsZA0KICogQGRlc2NyaXB0aW9uIGhvbGRzIHRoZSBjdXJyZW50IGRhdGUgdGltZSwgYmVmb3JlIHRoZSBvbmxvYWQgb2YgdGhlIHdpZGdldA0KICovDQpPem9uZS51dGlsLnBhZ2VMb2FkLmJlZm9yZUxvYWQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOw0KDQovKioNCiAqIEBmaWVsZA0KICogQGRlc2NyaXB0aW9uIGhvbGRzIGN1cnJlbnQgZGF0ZSB0aW1lIGFmdGVyIHRoZSBvbmxvYWQgb2YgdGhlIHdpZGdldC4gIHRoaXMgdmFsdWUgd2lsbCBiZSBzZXQgYWZ0ZXIgb25sb2FkDQogKi8NCk96b25lLnV0aWwucGFnZUxvYWQuYWZ0ZXJMb2FkID0gbnVsbDsNCg0KDQpPem9uZS51dGlsLnBhZ2VMb2FkLmNhbGNMb2FkVGltZSA9IGZ1bmN0aW9uKHRpbWUpIHsNCiAgLyoqDQogICAqIEBmaWVsZA0KICAgKiBAZGVzY3JpcHRpb24gSG9sZHMgdGhlIGxvYWQgdGltZSBvZiB0aGUgd2lkZ2V0LiAgVGhpcyBtYXkgYmUgYWx0ZXJlZCB0byBhbGxvdyB0aGUgd2lkZ2V0IHRvIGRldGVybWluZSBpdCdzIGxvYWQgdGltZS4NCiAgICogICBsb2FkVGltZSBpcyBzZW50IHZpYSB0aGUgRXZlbnRpbmcgQVBJLCBpZiBhbHRlcmluZyB0aGlzIHZhbHVlIGRvIHNvIGJlZm9yZSBFdmVudGluZyBpcyBpbml0aWFsaXplZA0KICAgKi8NCiAgT3pvbmUudXRpbC5wYWdlTG9hZC5sb2FkVGltZSA9ICh0aW1lICE9IG51bGwgPyB0aW1lIDogT3pvbmUudXRpbC5wYWdlTG9hZC5hZnRlckxvYWQpIC0gT3pvbmUudXRpbC5wYWdlTG9hZC5iZWZvcmVMb2FkOw0KICByZXR1cm4gT3pvbmUudXRpbC5wYWdlTG9hZC5sb2FkVGltZTsNCn07DQoKdmFyIE96b25lID0gT3pvbmUgfHwge307DQpPem9uZS52ZXJzaW9uID0gT3pvbmUudmVyc2lvbiB8fCB7fTsNCg0KT3pvbmUudmVyc2lvbiA9IHsNCg0KICAgIG93ZnZlcnNpb246ICc3LjAuMS1HQScsDQoNCiAgICBtcHZlcnNpb246ICcyLjMnLA0KDQogICAgcHJlZmVyZW5jZTogJy12MScsDQoNCiAgICBldmVudGluZzogJy12MScsDQoNCiAgICB3aWRnZXRMYXVuY2hlcjogJy12MScsDQoNCiAgICBzdGF0ZTogJy12MScsDQoNCiAgICBkcmFnQW5kRHJvcDogJy12MScsDQoNCiAgICB3aWRnZXRDaHJvbWU6ICctdjEnLA0KDQogICAgbG9nZ2luZzogJy12MScsDQoNCiAgICBsYW5ndWFnZTogJy12MScNCg0KfTsNCgovKioKICogQGlnbm9yZQogKi8KdmFyIE96b25lID0gT3pvbmUgfHwge307Ck96b25lLnV0aWwgPSBPem9uZS51dGlsIHx8IHt9OwpPem9uZS51dGlsLmZvcm1GaWVsZCA9IE96b25lLnV0aWwuZm9ybUZpZWxkIHx8IHt9OwpPem9uZS5jb25maWcgPSBPem9uZS5jb25maWcgfHwge307CgovKioKICogQHByaXZhdGUKICogCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gc2VlIGlmIGEgc3BlY2ZpYyB1cmwgaXMgdGhlIHNhbWUKICogYXMgdGhlIGxvY2FsIHVybC4gIENhbiBiZSB1c2VkIHRvIHRlc3QgaWYgQUpBWCBjYW4gYmUgdXNlZC4gIElmIHVybAogKiBpcyBub3QgYSBVUkwsIGl0J3MgYXNzdW1lZCB0byBiZSBhIHJlbGF0aXZlIGZpbGVuYW1lLCBzbyB0aGlzIGZ1bmN0aW9uCiAqIHJldHVybnMgdHJ1ZS4KICoKICogQHBhcmFtIHtTdHJpbmd9IHVybCBTdHJpbmcgdGhhdCB5b3Ugd2FudCB0byBjaGVjayB0byBzZWUgaWYgaXRzIGxvY2FsLgogKgogKiBAcmV0dXJucyBCb29sZWFuCiAqCiAqIEB0aHJvd3MgIk5vdCBhIHZhbGlkIFVSTCIgaWYgdGhlIHBhcmFtZXRlciBpcyBub3QgYSB2YWxpZCB1cmwKICovCk96b25lLnV0aWwuaXNVcmxMb2NhbCA9IGZ1bmN0aW9uKHVybCkgewoKICAgIHZhciB3ZWJDb250ZXh0UGF0aCA9IE96b25lLnV0aWwuY29udGV4dFBhdGgoKTsKCiAgICAvL2FwcGVuZCBsYXN0ICcvJyB0aGlzIHZhbHVlIHNob3VsZCBuZXZlciBiZSBudWxsCiAgICBpZiAod2ViQ29udGV4dFBhdGggIT0gJycgJiYgd2ViQ29udGV4dFBhdGggIT0gbnVsbCkgewogICAgICAgIHdlYkNvbnRleHRQYXRoICs9ICcvJzsKICAgIH0KCiAgICAvL3RoaXMgcmVnZXggbWF0Y2hlcyB1cmxzIGFnYWluc3QgdGhlIGNvbmZpZ3VyZWQgd2ViY29udGV4dCBwYXRoIGh0dHBzOi8vPGNvbnRleHRQYXRoPi8uLi4uLgogICAgLy9vbmx5IG9uZSBtYXRjaCBpcyBwb3NzaWJsZSBzaW5jZSB0aGlzIHJlZ2V4IG1hdGNoZXMgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHN0cmluZwogICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgiXihodHRwcz86KS8vKFteLzpdKyk6PyguKikiICsgd2ViQ29udGV4dFBhdGgpOwogICAgdmFyIHNlcnZlciA9IHVybC5tYXRjaChyZWdleCk7CgogICAgLy9jaGVjayBpZiB0aGlzIG1pZ2h0IGJlIGEgcmVsYXRpdmUgdXJsIAogICAgaWYgKCFzZXJ2ZXIpIHsKICAgICAgICBpZiAodXJsLm1hdGNoKG5ldyBSZWdFeHAoJ15odHRwcz86XC9cLycpKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIHBvcnQgPSB3aW5kb3cubG9jYXRpb24ucG9ydDsvLyB8fCAoIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gImh0dHBzOiIgPyAiNDQzIiA6ICI4MCIgKQoKICAgIC8vdG9kbyBuZWVkIHRvIGZpbmQgYSBiZXR0ZXIgd2F5IG9mIGNoZWNraW5nIHNhbWUgZG9tYWluIHJlcXVlc3RzCiAgICAvLyBzZWUgaWYgc29sdXRpb24gcG9zdGVkIGhlcmUgd29ya3M6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTQwNDc5My9jaGVjay1pZi1zYW1lLW9yaWdpbi1wb2xpY3ktYXBwbGllcwogICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gc2VydmVyWzFdICYmIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gc2VydmVyWzJdICYmIHBvcnQgPT09IHNlcnZlclszXQp9OwoKLyoqCiAqIEBwcml2YXRlCiAqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCB3aWxsIGNvbnZlcnQgYSBzdHJpbmcgaW50byBhIGpzb24gb2JqZWN0LiAgVGhlcmUgaXMgYSBjaGVjawogKiBkb25lIHRvIGVuc3VyZSBubyB1bnNhZmUganNvbiBpcyBpbmNsdWRlZC4KICoKICogQHBhcmFtIHtTdHJpbmd9IHN0ciBTdHJpbmcgdGhhdCByZXByZXNlbnRzIGEganNvbiBvYmplY3QKICoKICogQHJldHVybnMge09iamVjdH0ganNvbiBvYmplY3QKICoKICogQHRocm93cyBFcnJvciBpZiBwYXJhbWV0ZXIgaXMgbm90IGEgc3RyaW5nCiAqIEB0aHJvd3MgRXJyb3IgaWYgc2VjdXJlIGNoZWNrIGZpbmRzIHVuc2FmZSBKU09OCiAqIEB0aHJvd3MgRXJyb3IgaWYgdGhlcmUgaXMgYW4gaXNzdWUgY29udmVydGluZyB0byBKU09OCiAqCiAqIEByZXF1aXJlcyBkb2pveC5zZWN1cmUuY2FwYWJpbGl0eQogKiBAcmVxdWlyZXMgZG9qbyBiYXNlCiAqLwpPem9uZS51dGlsLnBhcnNlSnNvbiA9IGZ1bmN0aW9uKHN0cikgewogICAgaWYgKHR5cGVvZihzdHIpID09PSAnc3RyaW5nJykgewogICAgICAgIG93ZmRvam94LnNlY3VyZS5jYXBhYmlsaXR5LnZhbGlkYXRlKHN0cixbXSx7fSk7IC8vIHdpbGwgZXJyb3IgaWYgdGhlcmUgaXMgdW5zYWZlIEpTT04KICAgICAgICB2YXIgeCA9IG93ZmRvam8uZnJvbUpzb24oc3RyKTsKICAgICAgICByZXR1cm4geDsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgIk96b25lLnV0aWwucGFyc2VKc29uIGV4cGVjdGVkIGEgc3RyaW5nLCBidXQgZGlkbid0IGdldCBvbmUiOwogICAgfQp9OwoKLyoqCiAqIEBwcml2YXRlCiAqLwpPem9uZS51dGlsLkhUTUxFbmNvZGVSZXNlcnZlZEpTID0gZnVuY3Rpb24oc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyIvZywgJyZxdW90OycpLnJlcGxhY2UoLycvZywgIiYjMzk7Iik7Cn07CgovKioKICogQHByaXZhdGUKICogCiAqIEBkZXNjcmlwdGlvbiBTaW1pbGFyIHRvIEV4dC51dGlsLkZvcm1hdC5odG1sRW5jb2RlIGV4Y2VwdCB0aGlzIG1ldGhvZCBhbHNvIGhhbmRsZXMgdGhlIHNpbmdsZSBxdW90ZQogKi8KT3pvbmUudXRpbC5IVE1MRW5jb2RlID0gZnVuY3Rpb24oc3RyKXsKICAgIHJldHVybiAhc3RyID8gc3RyIDogU3RyaW5nKHN0cikucmVwbGFjZSgvJi9nLCAiJmFtcDsiKS5yZXBsYWNlKC8+L2csICImZ3Q7IikucmVwbGFjZSgvPC9nLCAiJmx0OyIpLnJlcGxhY2UoLyIvZywgIiZxdW90OyIpLnJlcGxhY2UoLycvZywgIiYjMzk7Iik7Cn07CgovKioKICogQHByaXZhdGUKICoKICogQ29uc3RydWN0aXZlbHkgY2xlYXJzIHRoZSBlbnRpcmUgYXJyYXkKICovCk96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSA9IGZ1bmN0aW9uKCkgewogIHZhciBjb25maWdQYXJhbXMgPSBudWxsOwogIHJldHVybiBmdW5jdGlvbigpIHsKCiAgICAvL2lmIGFscmVhZHkgcGFyc2VkIGp1c3QgcmV0dXJuIHRoZSB2YWx1ZQogICAgaWYgKGNvbmZpZ1BhcmFtcykgcmV0dXJuIGNvbmZpZ1BhcmFtczsKCiAgICAvL3BhcnNlIG91dCB0aGUgY29uZmlnCiAgICB0cnkgewogICAgICBjb25maWdQYXJhbXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbigKICAgICAgICAgICAgICB3aW5kb3cubmFtZQogICAgICApOwogICAgICByZXR1cm4gY29uZmlnUGFyYW1zOwogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQp9KCk7CgoKLyoqCiAqIEBwcml2YXRlCiAqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCByZXR1cm5zIHRoZSBjdXJyZW50IGNvbnRleHQgcGF0aCBieQogKiBjYWxsaW5nIGEgY29udHJvbGxlciBhdCB0aGUgc2VydmVyICh3aWxsIG5vdAogKiBtYWtlIHRoZSBjYWxsIGlmIGl0IGhhcyBhbHJlYWR5IGJlZW4gZG9uZSkuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gbyB1bnVzZWQKICoKICogQHJldHVybnMgY29udGV4dCBwYXRoIHdpdGggbGVhZGluZyBzbGFzaAogKiAgICAgICAgICAoZXguICIvb3dmIikKICoKICogQHJlcXVpcmVzIEV4dCBiYXNlLCBkb2pvCiAqLwpPem9uZS51dGlsLmNvbnRleHRQYXRoID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpLAogICAgICAgIGNvbnRleHRQYXRoID0gT3pvbmUuY29uZmlnLndlYkNvbnRleHRQYXRoOwoKICAgIGlmIChjb25maWdQYXJhbXMgJiYgY29uZmlnUGFyYW1zLndlYkNvbnRleHRQYXRoKSB7CiAgICAgICAgY29udGV4dFBhdGggPSBPem9uZS5jb25maWcud2ViQ29udGV4dFBhdGggPSBjb25maWdQYXJhbXMud2ViQ29udGV4dFBhdGg7CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gY29udGV4dFBhdGggfHwgJyc7CiAgICB9Cn0pKCk7CgovKioKICogQHByaXZhdGUKICogCiAqIEBkZXNjcmlwdGlvbiBDaGVja3Mgd2hldGhlciB0aGUgdXJsIGNvbnRleHQgaXMgbG9jYWwgb3Igbm90LAogKiB0aGVuIHJldHVybnMgdGhlIHZhbGlkIHVybCB3LyBjb250ZXh0LgogKiAKICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIHRoZSB1cmwKICogQHBhcmFtIHtTdHJpbmd9IHZhbGlkQ29udGV4dCB2YWxpZCBjb250ZXh0CiAqCiAqIEByZXR1cm5zIHZhbGlkIHVybCB3L2NvbnRleHQgaWYgbmVjZXNzYXJ5LCBpZiBub3QgbG9jYWwgdGhlbiB0aGUgdXJsCiAqLwpPem9uZS51dGlsLnZhbGlkVXJsQ29udGV4dCA9IGZ1bmN0aW9uKHZhbHVlLCB2YWxpZENvbnRleHQpewogICAgdmFyIGNvbnRhaW5zUmVsRG90UGF0aCA9ICh2YWx1ZS5pbmRleE9mKCIuLi8iKSA9PSAwKT90cnVlOmZhbHNlOwogICAgdmFyIGNvbnRhaW5zUmVsUGF0aCA9ICh2YWx1ZS5pbmRleE9mKCIvIikgPT0gMCk/dHJ1ZTpmYWxzZTsKICAgIHZhciBpc0xvY2FsVXJsID0gKGNvbnRhaW5zUmVsUGF0aCB8fCBjb250YWluc1JlbERvdFBhdGggfHwgKHZhbHVlLmluZGV4T2YoImxvY2FsaG9zdCIpID09IDcpIHx8ICh2YWx1ZS5pbmRleE9mKCJsb2NhbGhvc3QiKSA9PSAxMSkgfHwgKHZhbHVlLmluZGV4T2YoIjEyNy4wLjAuMSIpID09IDcpKSA/IHRydWUgOiBmYWxzZTsKICAgIHZhciB1cmxWYWxpZENvbnRleHQgPSB2YWx1ZTsKICAgIHZhbGlkQ29udGV4dCA9ICgodmFsaWRDb250ZXh0ID09IHVuZGVmaW5lZCkgPyBPem9uZS51dGlsLmNvbnRleHRQYXRoKCkgOiB2YWxpZENvbnRleHQpOwogICAgaWYoKGlzTG9jYWxVcmwgPT0gdHJ1ZSkgJiYgKHZhbGlkQ29udGV4dCAhPSBudWxsKSl7CiAgICAgICAgaWYoY29udGFpbnNSZWxQYXRoKXsKICAgICAgICAgICAgdXJsVmFsaWRDb250ZXh0ID0gU3RyaW5nLmZvcm1hdCgiezB9ezF9IiwgdmFsaWRDb250ZXh0LCB2YWx1ZSk7CiAgICAgICAgfWVsc2UgaWYoY29udGFpbnNSZWxEb3RQYXRoKXsKICAgICAgICAgICAgdmFyIHZhbHVlUGF0aE5vUmVsID0gdmFsdWUuc3Vic3RyaW5nKDMpOwogICAgICAgICAgICB1cmxWYWxpZENvbnRleHQgPSBTdHJpbmcuZm9ybWF0KCJ7MH0vezF9IiwgdmFsaWRDb250ZXh0LCB2YWx1ZVBhdGhOb1JlbCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHVybFZhbGlkQ29udGV4dDsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKgogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgY2VudHJhbGl6ZXMgdGhlIGNvbnRhaW5lciByZWxheSBmaWxlIGZvcgogKiBSUEMgY2FsbHMuCiAqCiAqIEByZXR1cm5zIHJlbGF5IGZpbGUgcGF0aCB3aXRoIGNvbnRleHQKICovCk96b25lLnV0aWwuZ2V0Q29udGFpbmVyUmVsYXkgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBPem9uZS51dGlsLmNvbnRleHRQYXRoKCkgKyAKICAgICcvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJzsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKiAKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIHdpbGwgY29udmVydCBhbnl0aGluZyB0byBhIHN0cmluZy4KICogVGhlcmUgaXMgbm8gY2hlY2sgZm9yIHJlY3Vyc2lvbiwgc28gZG9uJ3QgZG8gdGhhdAogKgogKiBAcGFyYW0ge09iamVjdH0gb2JqIG9iamVjdCB0byBjb252ZXJ0CiAqCiAqIEByZXR1cm5zIHN0cmluZwogKgogKiBAcmVxdWlyZXMgZG9qbyBiYXNlCiAqLwpPem9uZS51dGlsLnRvU3RyaW5nID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7CiAgICAgICAgcmV0dXJuIG93ZmRvam8udG9Kc29uKG9iaik7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvYmorJyc7CiAgICB9Cn07CgovKioKICogQHByaXZhdGUKICovCk96b25lLnV0aWwuZm9ybWF0V2luZG93TmFtZURhdGEgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAvLyB0aGlzIHZhbHVlIG5lZWRzIHRvIGJlIG5vdCB1cmkgZW5jb2RlZAogICAgLy8gcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChvd2Zkb2pvLm9iamVjdFRvUXVlcnkoZGF0YSkpOwogICAgcmV0dXJuIE96b25lLnV0aWwudG9TdHJpbmcoZGF0YSk7Cn07CgovKioKICogQHByaXZhdGUKICogIAogKiBSZW1vdmVzIHRoZSBMZWFkaW5nIGFuZCBUcmFpbGluZyBTcGFjZXMgaW4gYW55IEV4dEpzIEZvcm0gRmllbGQKICovCk96b25lLnV0aWwuZm9ybUZpZWxkLnJlbW92ZUxlYWRpbmdUcmFpbGluZ1NwYWNlcyA9IGZ1bmN0aW9uKHRoaXNGaWVsZCl7CiAgICB2YXIgdGhpc0ZpZWxkX25vTGVhZGluZ1RyYWlsaW5nU3BhY2VzVmFsdWUgPSB0aGlzRmllbGQuZ2V0VmFsdWUoKS5yZXBsYWNlKG5ldyBSZWdFeHAoT3pvbmUubGFuZy5yZWdleExlYWRpbmdUYWlsaW5nU3BhY2VDaGFycyksICcnKTsKICAgIHRoaXNGaWVsZC5zZXRWYWx1ZSh0aGlzRmllbGRfbm9MZWFkaW5nVHJhaWxpbmdTcGFjZXNWYWx1ZSk7CiAgICByZXR1cm4gdGhpc0ZpZWxkX25vTGVhZGluZ1RyYWlsaW5nU3BhY2VzVmFsdWU7Cn07CgppZiAoIU96b25lLnV0aWwuTW9kYWxCb3gpIHsKICAgIE96b25lLnV0aWwuTW9kYWxCb3ggPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYWIgPSAnYWJzb2x1dGUnOwogICAgICAgIHZhciBuID0gJ25vbmUnOwogICAgICAgIHZhciBvYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CiAgICAgICAgdmFyIGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgdmFyIG9ib2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBvYm9sLnNldEF0dHJpYnV0ZSgnaWQnLCAnb2wnKTsKICAgICAgICBvYm9sLnN0eWxlLmRpc3BsYXkgPSBuOwogICAgICAgIG9ib2wuc3R5bGUucG9zaXRpb24gPSBhYjsKICAgICAgICBvYm9sLnN0eWxlLnRvcCA9IDA7CiAgICAgICAgb2JvbC5zdHlsZS5sZWZ0ID0gMDsKICAgICAgICBvYm9sLnN0eWxlLnpJbmRleCA9IDEwMDAwOwogICAgICAgIG9ib2wuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgb2JvbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzU1NSI7CiAgICAgICAgb2JvbC5zdHlsZS5maWx0ZXIgPSAnYWxwaGEob3BhY2l0eT01MCknOwogICAgICAgIG9ib2wuc3R5bGUuTW96T3BhY2l0eSA9IDAuNTsKICAgICAgICBvYm9sLnN0eWxlLm9wYWNpdHkgPSAwLjU7CgogICAgICAgIAogICAgICAgIGZyYWcuYXBwZW5kQ2hpbGQob2JvbCk7CiAgICAgICAgdGhpcy5vYm9sID0gb2JvbDsKICAgICAgICB2YXIgb2JieCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG9iYnguc2V0QXR0cmlidXRlKCdpZCcsICdtYm94Jyk7CiAgICAgICAgb2JieC5zdHlsZS5kaXNwbGF5ID0gbjsKICAgICAgICBvYmJ4LnN0eWxlLnBvc2l0aW9uID0gYWI7CiAgICAgICAgb2JieC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2VlZSc7CiAgICAgICAgb2JieC5zdHlsZS5wYWRkaW5nID0gJzhweCc7CiAgICAgICAgb2JieC5zdHlsZS5ib3JkZXIgPSAnMnB4IG91dHNldCAjNjY2JzsKICAgICAgICBvYmJ4LnN0eWxlLnpJbmRleCA9IDEwMDAxOwogICAgICAgIHRoaXMub2JieCA9IG9iYng7CiAgICAgICAgdmFyIG9ibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICBvYmJ4LmFwcGVuZENoaWxkKG9ibCk7CiAgICAgICAgdmFyIG9iYnhkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgb2JieGQuc2V0QXR0cmlidXRlKCdpZCcsICdtYmQnKTsKICAgICAgICB2YXIgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHZhciB0eHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgdHh0LmlubmVySFRNTCA9ICdQcmVzcyBPSyB0byBjb250aW51ZS4nOwogICAgICAgIHRoaXMudHh0ID0gdHh0OwogICAgICAgIHZhciBkMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGQyLnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGQyLnN0eWxlLmZvbnRTaXplID0gJzE0cHgnOwogICAgICAgIGQyLmFwcGVuZENoaWxkKHR4dCk7CiAgICAgICAgZDIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKSk7ICAgICAgIAogICAgICAgIHZhciBidXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAKICAgICAgICBidXQuaW5uZXJIVE1MID0gJ09LJzsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgYnV0Lm9uY2xpY2s9IGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAgIHNlbGYuaGlkZSgpOwogICAgICAgIH0KICAgICAgICBkMi5hcHBlbmRDaGlsZChidXQpOwogICAgICAgIGQuYXBwZW5kQ2hpbGQoZDIpOwogICAgICAgIG9iYnhkLmFwcGVuZENoaWxkKGQpOwogICAgICAgIHRoaXMub2JieGQgPSBvYmJ4ZDsKICAgICAgICBvYmwuYXBwZW5kQ2hpbGQob2JieGQpOwogICAgICAgIGZyYWcuaW5zZXJ0QmVmb3JlKG9iYngsIG9ib2wubmV4dFNpYmxpbmcpOwogICAgICAgIG9ib2R5Lmluc2VydEJlZm9yZShmcmFnLCBvYm9keS5maXJzdENoaWxkKTsKICAgICAgICB3aW5kb3cub25zY3JvbGwgPSBmdW5jdGlvbigpewogICAgICAgICAgICBzZWxmLnNjcm9sbEZpeCgpOwogICAgICAgIH0KICAgICAgICB3aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbigpewogICAgICAgICAgICBzZWxmLnNpemVGaXgoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLnBhZ2VXaWR0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gd2luZG93LmlubmVyV2lkdGggIT0gbnVsbCA/IHdpbmRvdy5pbm5lcldpZHRoCiAgICAgICAgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoCiAgICAgICAgOiBkb2N1bWVudC5ib2R5ICE9IG51bGwgPyBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIDogbnVsbDsKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLnBhZ2VIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodCAhPSBudWxsID8gd2luZG93LmlubmVySGVpZ2h0CiAgICAgICAgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQKICAgICAgICA6IGRvY3VtZW50LmJvZHkgIT0gbnVsbCA/IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IDogbnVsbDsKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLnBvc0xlZnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHdpbmRvdy5wYWdlWE9mZnNldCAhPSAndW5kZWZpbmVkJyA/IHdpbmRvdy5wYWdlWE9mZnNldAogICAgICAgIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQKICAgICAgICA6IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCA/IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCA6IDA7CiAgICB9CiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5wb3NUb3AgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cucGFnZVlPZmZzZXQgIT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cucGFnZVlPZmZzZXQKICAgICAgICA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcAogICAgICAgIDogZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPyBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA6IDA7CiAgICB9CgogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUuc2Nyb2xsRml4ID0gZnVuY3Rpb24oKSAKICAgIHsKICAgICAgICAvL3ZhciBvYm9sID0gJCgnb2wnKTsKICAgICAgICB0aGlzLm9ib2wuc3R5bGUudG9wID0gdGhpcy5wb3NUb3AoKSArICdweCc7CiAgICAgICAgdGhpcy5vYm9sLnN0eWxlLmxlZnQgPSB0aGlzLnBvc0xlZnQoKSArICdweCcKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLnNpemVGaXggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy92YXIgb2JvbCA9ICQoJ29sJyk7CiAgICAgICAgdGhpcy5vYm9sLnN0eWxlLmhlaWdodCA9IHRoaXMucGFnZUhlaWdodCgpICsgJ3B4JzsKICAgICAgICB0aGlzLm9ib2wuc3R5bGUud2lkdGggPSB0aGlzLnBhZ2VXaWR0aCgpICsgJ3B4JzsKICAgICAgICB2YXIgdHAgPSB0aGlzLnBvc1RvcCgpICsgKCh0aGlzLnBhZ2VIZWlnaHQoKSAtIHRoaXMuaGVpZ2h0KSAvIDIpIC0gMTI7CiAgICAgICAgdmFyIGx0ID0gdGhpcy5wb3NMZWZ0KCkgKyAoKHRoaXMucGFnZVdpZHRoKCkgLSB0aGlzLndpZHRoKSAvIDIpIC0gMTI7CiAgICAgICAgdGhpcy5vYmJ4LnN0eWxlLnRvcCA9ICh0cCA8IDAgPyAwIDogdHApICsgJ3B4JzsKICAgICAgICB0aGlzLm9iYnguc3R5bGUubGVmdCA9IChsdCA8IDAgPyAwIDogbHQpICsgJ3B4JzsKCiAgICB9CiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5rcCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAga3kgPSBlID8gZS53aGljaCA6IGV2ZW50LmtleUNvZGU7CiAgICAgICAgaWYgKGt5ID09IDg4IHx8IGt5ID09IDEyMCkKICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5pbmYgPSBmdW5jdGlvbiAoaCkgewogICAgICAgIHRhZyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZWxlY3QnKTsKICAgICAgICBmb3IgKGkgPSB0YWcubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCiAgICAgICAgICAgIHRhZ1tpXS5zdHlsZS52aXNpYmlsaXR5ID0gaDsKICAgICAgICB0YWcgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaWZyYW1lJyk7CiAgICAgICAgZm9yIChpID0gdGFnLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKQogICAgICAgICAgICB0YWdbaV0uc3R5bGUudmlzaWJpbGl0eSA9IGg7CiAgICAgICAgdGFnID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ29iamVjdCcpOwogICAgICAgIGZvciAoaSA9IHRhZy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAgdGFnW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBoOwogICAgfQogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdiA9ICd2aXNpYmxlJzsKICAgICAgICB2YXIgbiA9ICdub25lJzsKICAgICAgICB0aGlzLm9ib2wuc3R5bGUuZGlzcGxheSA9IG47CiAgICAgICAgdGhpcy5vYmJ4LnN0eWxlLmRpc3BsYXkgPSBuOwogICAgICAgIHRoaXMuaW5mKHYpOwogICAgICAgIGRvY3VtZW50Lm9ua2V5cHJlc3MgPSAnJwogICAgfQogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChtc2csd2QsIGh0KSB7CiAgICAgICAgdmFyIGggPSAnaGlkZGVuJzsKICAgICAgICB2YXIgYiA9ICdibG9jayc7CiAgICAgICAgdmFyIHAgPSAncHgnOwogICAgICAgIHdkID0gd2QgfCAyMDA7CiAgICAgICAgaHQgPSBodCB8IDEwMDsKICAgICAgICB2YXIgb2JvbCA9IHRoaXMub2JvbAogICAgICAgIHZhciBvYmJ4ZCA9IHRoaXMub2JieGQ7CiAgICAgICAgdGhpcy50eHQuaW5uZXJIVE1MID0gbXNnOwogICAgICAgIG9ib2wuc3R5bGUuaGVpZ2h0ID0gdGhpcy5wYWdlSGVpZ2h0KCkgKyBwOwogICAgICAgIG9ib2wuc3R5bGUud2lkdGggPSB0aGlzLnBhZ2VXaWR0aCgpICsgcDsKICAgICAgICBvYm9sLnN0eWxlLnRvcCA9IHRoaXMucG9zVG9wKCkgKyBwOwogICAgICAgIG9ib2wuc3R5bGUubGVmdCA9IHRoaXMucG9zTGVmdCgpICsgcDsKICAgICAgICBvYm9sLnN0eWxlLmRpc3BsYXkgPSBiOwogICAgICAgIHZhciB0cCA9IHRoaXMucG9zVG9wKCkgKyAoKHRoaXMucGFnZUhlaWdodCgpIC0gaHQpIC8gMikgLSAxMjsKICAgICAgICB2YXIgbHQgPSB0aGlzLnBvc0xlZnQoKSArICgodGhpcy5wYWdlV2lkdGgoKSAtIHdkKSAvIDIpIC0gMTI7CiAgICAgICAgdmFyIG9iYnggPSB0aGlzLm9iYngKICAgICAgICBvYmJ4LnN0eWxlLnRvcCA9ICh0cCA8IDAgPyAwIDogdHApICsgcDsKICAgICAgICBvYmJ4LnN0eWxlLmxlZnQgPSAobHQgPCAwID8gMCA6IGx0KSArIHA7CiAgICAgICAgb2JieC5zdHlsZS53aWR0aCA9IHdkICsgcDsKICAgICAgICBvYmJ4LnN0eWxlLmhlaWdodCA9IGh0ICsgcDsKICAgICAgICB0aGlzLmluZihoKTsKICAgICAgICBvYmJ4LnN0eWxlLmRpc3BsYXkgPSBiOwogICAgICAgIHRoaXMud2lkdGggPSB3ZDsKICAgICAgICB0aGlzLmhlaWdodCA9IGh0OwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQppZiAoIU96b25lLnV0aWwuRXJyb3JEbGcpIAp7CiAgICBPem9uZS51dGlsLkVycm9yRGxnID0ge307CiAgICBPem9uZS51dGlsLkVycm9yRGxnLnNob3c9ZnVuY3Rpb24obXNnLHdpZHRoLGhlaWdodCkKICAgIHsKICAgICAgICBpZiAoIXRoaXMuZGxnQm94KQogICAgICAgICAgICB0aGlzLmRsZ0JveCA9IG5ldyBPem9uZS51dGlsLk1vZGFsQm94KCk7CiAgICAgICAgdGhpcy5kbGdCb3guc2hvdyhtc2csd2lkdGgsaGVpZ2h0KTsKICAgIH07Cn0KCgovKioKICogQHByaXZhdGUKICovCk96b25lLnV0aWwuZmlyZUJyb3dzZXJFdmVudCA9IGZ1bmN0aW9uKGRvbSwgdHlwZSwgYnViYmxlLCBjYW5jZWxhYmxlKSB7CiAgICBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnQpIHsKICAgICAgICB2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnRzJyk7CiAgICAgICAgZXZlbnQuaW5pdEV2ZW50KHR5cGUsIGJ1YmJsZSB8fCB0cnVlLCBjYW5jZWxhYmxlIHx8IHRydWUpOwogICAgICAgIGRvbS5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgIH0KICAgIGVsc2UgaWYgKGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KSB7CiAgICAgICAgZG9tLmZpcmVFdmVudCgnb24nICsgdHlwZSk7CiAgICB9Cn07CgovKioKICAgIENsb25lcyBkYXNoYm9hcmQgYW5kIHJldHVybnMgYSBkYXNoYm9hcmQgY2ZnIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBuZXcgZGFzaGJvYXJkcy4KICAgIEBuYW1lIGNsb25lRGFzaGJvYXJkCiAgICBAbWV0aG9kT2YgT1dGLlV0aWwKCiAgICBAcmV0dXJucyBPYmplY3QgZGFzaGJvYXJkIGNmZyBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgbmV3IGRhc2hib2FyZHMuCiAqLwpPem9uZS51dGlsLmNsb25lRGFzaGJvYXJkID0gZnVuY3Rpb24oZGFzaGJvYXJkQ2ZnLCByZWdlbmVyYXRlSWRzLCByZW1vdmVMYXVuY2hEYXRhKSB7CiAgICAKICAgIHZhciBkYXNoYm9hcmRTdHIgPSBPem9uZS51dGlsLnRvU3RyaW5nKGRhc2hib2FyZENmZyk7CgogICAgaWYocmVnZW5lcmF0ZUlkcyA9PT0gdHJ1ZSkgewogICAgICAgIHZhciBuZXdEYXNoYm9hcmRHdWlkID0gZ3VpZC51dGlsLmd1aWQoKSwKICAgICAgICAgICAgZGFzaGJvYXJkR3VpZCA9IGRhc2hib2FyZENmZy5ndWlkOwoKICAgICAgICAvLyB1cGRhdGUgZGFzaGJvYXJkIGd1aWQKICAgICAgICBkYXNoYm9hcmRTdHIgPSBkYXNoYm9hcmRTdHIucmVwbGFjZShuZXcgUmVnRXhwKGRhc2hib2FyZEd1aWQsICdnJyksIG5ld0Rhc2hib2FyZEd1aWQpOwogICAgICAgIGRhc2hib2FyZFN0ckNvcHkgPSBkYXNoYm9hcmRTdHI7CgogICAgICAgIC8vIHVwZGF0ZSB3aWRnZXQgaW5zdGFuY2UgaWRzCiAgICAgICAgdmFyIHdpZGdldEluc3RhbmNlSWRSZWdleCA9IC9cInVuaXF1ZUlkXCJcOlwiKFtBLUZhLWZcZF17OH0tW0EtRmEtZlxkXXs0fS1bQS1GYS1mXGRdezR9LVtBLUZhLWZcZF17NH0tW0EtRmEtZlxkXXsxMn0pXCIvZzsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIHdoaWxlICgocmVzdWx0ID0gd2lkZ2V0SW5zdGFuY2VJZFJlZ2V4LmV4ZWMoZGFzaGJvYXJkU3RyQ29weSkpICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gdmFyIG1zZyA9ICJGb3VuZCAiICsgcmVzdWx0WzFdOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtc2cpOwogICAgICAgICAgICBkYXNoYm9hcmRTdHIgPSBkYXNoYm9hcmRTdHIucmVwbGFjZShuZXcgUmVnRXhwKHJlc3VsdFsxXSwgJ2cnKSwgZ3VpZC51dGlsLmd1aWQoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHZhciBkYXNoYm9hcmQgPSBPem9uZS51dGlsLnBhcnNlSnNvbihkYXNoYm9hcmRTdHIpOwogICAgCiAgICBpZihyZW1vdmVMYXVuY2hEYXRhID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGNsZWFuRGF0YSA9IGZ1bmN0aW9uKGNmZykgewogICAgICAgICAgICBpZighY2ZnIHx8ICFjZmcuaXRlbXMpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZihjZmcuaXRlbXMubGVuZ3RoID09PSAwICYmIGNmZy53aWRnZXRzKSB7CiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBjZmcud2lkZ2V0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjZmcud2lkZ2V0c1tpXS5sYXVuY2hEYXRhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMCwgbGVuID0gY2ZnLml0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYW5EYXRhKGNmZy5pdGVtc1tpXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY2xlYW5EYXRhKGRhc2hib2FyZC5sYXlvdXRDb25maWcpOwogICAgfQoKICAgIHJldHVybiBkYXNoYm9hcmQ7Cn07CgpPem9uZS51dGlsLmNyZWF0ZVJlcXVpcmVkTGFiZWw9IGZ1bmN0aW9uKGxhYmVsKSB7CiAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSdyZXF1aXJlZC1sYWJlbCc+IiArIGxhYmVsICsgIiA8c3BhbiBjbGFzcz0ncmVxdWlyZWQtaW5kaWNhdG9yJz4qPC9zcGFuPjwvc3Bhbj4iOwp9CnZhciBndWlkID0gZ3VpZCB8fCB7fTsKdmFyIE96b25lID0gT3pvbmUgfHwge307Ck96b25lLnV0aWwgPSBPem9uZS51dGlsIHx8IHt9OwoKZ3VpZC51dGlsID0gZnVuY3Rpb24oKSB7CglmdW5jdGlvbiBTNCgpIHsKCQlyZXR1cm4gKCgoMStNYXRoLnJhbmRvbSgpKSoweDEwMDAwKXwwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpOwoJfQoJcmV0dXJuIHsKCQlndWlkIDogZnVuY3Rpb24gKCkgewoJCSAgCXJldHVybiAoUzQoKStTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpK1M0KCkrUzQoKSk7CgkJfQoJfTsKfSgpOwoKLyoqCiAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIGEgZ2xvYmFsbHkgdW5pcXVlIGlkZW50aWZpZXIgKGd1aWQpCiAqIAogKiBAcmV0dXJucyB7U3RyaW5nfSBndWlkCiAqLwpPem9uZS51dGlsLmd1aWQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBndWlkLnV0aWwuZ3VpZCgpOwp9Ci8qCiAqIFRoaXMgZmlsZSBjb250YWlucyBjb25zdGFudCBkZWZpbml0aW9ucyB0aGF0IGRlZmluZSBnbG9iYWwgT1dGIGhvdGtleXMKICovCgpPem9uZSA9IE96b25lIHx8IHt9OwpPem9uZS5jb21wb25lbnRzID0gT3pvbmUuY29tcG9uZW50cyB8fCB7fTsKT3pvbmUuY29tcG9uZW50cy5rZXlzID0gT3pvbmUuY29tcG9uZW50cy5rZXlzIHx8IHt9OwpPem9uZS5jb21wb25lbnRzLmtleXMuRVZFTlRfTkFNRSA9ICdrZXl1cCc7IC8va2V5dXAgb25seSBmaXJlcyBvbmNlLCB3aGljaCBpcyB3aGF0IHdlIHdhbnQuIGtleWRvd24gbWF5IGZpcmUgcmVwZWF0ZWRseQpPem9uZS5jb21wb25lbnRzLmtleXMuSG90S2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Ib3RLZXlzIHx8IHt9OwpPem9uZS5jb21wb25lbnRzLmtleXMuTW92ZUhvdEtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMuTW92ZUhvdEtleXMgfHwge307CgooZnVuY3Rpb24oKSB7CiAgICB2YXIgayA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Ib3RLZXlzOwogICAgCiAgICAvKgogICAgKiBrZXlzIGFyZSBkZWZpbmVkIGhlcmUuICBFYWNoIGtleSBpcyBkZWZpbmVkCiAgICAqIGFzIHRoZSBFeHQuRXZlbnRPYmplY3QgY29uc3RhbnQgcmVwcmVzZW50aW5nCiAgICAqIHRoYXQga2V5LiBVbmZvcnR1bmF0ZWx5LCBzaW5jZSB0aGlzIGZpbGUgaXMKICAgICogaW5jbHVkZWQgYm90aCBjb250YWluZXIgc2lkZSBhbmQgd2lkZ2V0IHNpZGUsIAogICAgKiBpdCBjYW5ub3QgYWN0dWFsbHkgdXNlIHRoZSBFeHQuRXZlbnRPYmplY3QgY29uc3RhbnRzCiAgICAqIHNpbmNlIEV4dCBpcyBub3QgZGVmaW5lZCB3aWRnZXQgc2lkZS4gVGhlcmVmb3JlCiAgICAqIHdlIHVzZSB0aGUgb3dmZG9qbyBjb25zdGFudHMgYW5kIGFzY2lpIGNvZGVzLCB3aGljaCBoYXBwZW4KICAgICogdG8gYWxsIGJlIHRoZSBzYW1lIGFzIHRoZSBFeHQgY29uc3RhbnRzLiAgCiAgICAqLwogICAgay5TRVRUSU5HUyA9IHsKICAgICAgICBrZXk6ICdTJy5jaGFyQ29kZUF0KDApLAogICAgICAgIGV4Y2x1c2l2ZTogdHJ1ZQogICAgfTsgCiAgICAKICAgIGsuQURNSU5JU1RSQVRJT049IHsKICAgICAgICBrZXk6ICdBJy5jaGFyQ29kZUF0KDApLAogICAgICAgIGV4Y2x1c2l2ZTogdHJ1ZQogICAgfTsKCiAgICBrLk1BUktFVFBMQUNFPSB7CiAgICAgICAga2V5OiAnTScuY2hhckNvZGVBdCgwKSwKICAgICAgICBleGNsdXNpdmU6IHRydWUKICAgIH07CgogICAgay5NRVRSSUM9IHsKICAgICAgICBrZXk6ICdSJy5jaGFyQ29kZUF0KDApLAogICAgICAgIGV4Y2x1c2l2ZTogdHJ1ZQogICAgfTsKCiAgICBrLkxBVU5DSF9NRU5VID0geyBrZXk6ICdMJy5jaGFyQ29kZUF0KDApIH07CgogICAgay5IRUxQID0gewogICAgICAgIGtleTogJ0gnLmNoYXJDb2RlQXQoMCksCiAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICB9OwoKICAgIGsuTE9HT1VUID0geyBrZXk6ICdPJy5jaGFyQ29kZUF0KDApIH07IC8vTyBmb3IgJ291dCcKCiAgICBrLlBSRVZJT1VTX0RBU0hCT0FSRCA9IHsga2V5OiBvd2Zkb2pvLmtleXMuUEFHRV9VUCB9OyAKICAgIAogICAgay5ORVhUX0RBU0hCT0FSRCA9IHsga2V5OiBvd2Zkb2pvLmtleXMuUEFHRV9ET1dOIH07CgogICAgay5EQVNIQk9BUkRfU1dJVENIRVIgPSB7CiAgICAgICAga2V5OiAnQycuY2hhckNvZGVBdCgwKSwKICAgICAgICBleGNsdXNpdmU6IHRydWUKICAgIH07CiAgICAKICAgIGsuV0lER0VUX1NXSVRDSEVSID0gewogICAgICAgIGtleTogJ1EnLmNoYXJDb2RlQXQoMCksCiAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICB9OyAKICAgIAogICAgay5ERUZBVUxUX0RBU0hCT0FSRCA9IHsga2V5OiBvd2Zkb2pvLmtleXMuSE9NRSB9OwogICAgCiAgICBrLkNMT1NFX1dJREdFVCA9IHsga2V5OiAnVycuY2hhckNvZGVBdCgwKSB9OyAKICAgIAogICAgay5NQVhJTUlaRV9DT0xMQVBTRV9XSURHRVQgPSB7IAogICAgICAgIGtleTogb3dmZG9qby5rZXlzLlVQX0FSUk9XLAogICAgICAgIGZvY3VzUGFyZW50OiBmYWxzZQogICAgfTsKICAgIAogICAgay5NSU5JTUlaRV9FWFBBTkRfV0lER0VUID0geyAKICAgICAgICBrZXk6IG93ZmRvam8ua2V5cy5ET1dOX0FSUk9XLAogICAgICAgIGZvY3VzUGFyZW50OiBmYWxzZQogICAgfTsKICAgIAogICAgay5FU0NBUEVfRk9DVVMgPSB7IAogICAgICAgIGtleTogb3dmZG9qby5rZXlzLkVTQ0FQRSwKICAgICAgICAvL3RoZSBlc2NhcGUga2V5IHNob3VsZCBub3QgdXNlIGFsdCtzaGlmdAogICAgICAgIGFsdDogZmFsc2UsCiAgICAgICAgc2hpZnQ6IGZhbHNlCiAgICB9OwoKICAgIC8vIGhhc2ggbWFwIG9mIGtleSBjb2RlcwogICAgdmFyIGtleUNvZGVzID0ge307CgogICAgLy9BZGQgc2hpZnQgYW5kIGFsdCBtb2RpZmllcnMgdG8gCiAgICAvL2FsbCBrZXlzIHRoYXQgZG9uJ3QgYWxyZWFkeSBoYXZlCiAgICAvL3RoZW0uIERlZmF1bHQgdG8gcmVxdWlyaW5nIGJvdGgKICAgIC8vc2hpZnQgYW5kIGFsdAogICAgZm9yICh2YXIga2V5X2kgaW4gaykgewogICAgICAgIHZhciBob3RLZXkgPSBrW2tleV9pXTsKCiAgICAgICAgaWYgKGhvdEtleS5hbHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuYWx0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhvdEtleS5zaGlmdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhvdEtleS5zaGlmdCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChob3RLZXkuZm9jdXNQYXJlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuZm9jdXNQYXJlbnQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBrZXlDb2Rlc1tob3RLZXkua2V5XSA9IGhvdEtleTsKICAgIH0KCiAgICAvLyBmb3Igb3dmIHNwZWNpZmljIGhvdGtleXMsIHByZXZlbnQgZGVmYXVsdCBvbiBrZXlkb3duCiAgICAvLyB0aGlzIGlzIG5lY2Vzc2FyeSBmb3IgSUUKICAgIG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ29ua2V5ZG93bicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgdmFyIGhvdEtleSA9IGtleUNvZGVzW2V2ZW50LmtleUNvZGVdOwoKICAgICAgICBpZihob3RLZXkgJiYgZXZlbnQuYWx0S2V5ID09PSBob3RLZXkuYWx0IAogICAgICAgICAgICAmJiBldmVudC5zaGlmdEtleSA9PT0gaG90S2V5LnNoaWZ0KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIG1vdmVLZXlzID0gT3pvbmUuY29tcG9uZW50cy5rZXlzLk1vdmVIb3RLZXlzOwogICAgbW92ZUtleXMuTU9WRV9VUCA9IHsKICAgICAgICBrZXk6IG93ZmRvam8ua2V5cy5VUF9BUlJPVwogICAgfTsKICAgIG1vdmVLZXlzLk1PVkVfUklHSFQgPSB7CiAgICAgICAga2V5OiBvd2Zkb2pvLmtleXMuUklHSFRfQVJST1cKICAgIH07CiAgICBtb3ZlS2V5cy5NT1ZFX0RPV04gPSB7CiAgICAgICAga2V5OiBvd2Zkb2pvLmtleXMuRE9XTl9BUlJPVwogICAgfTsKICAgIG1vdmVLZXlzLk1PVkVfTEVGVCA9IHsKICAgICAgICBrZXk6IG93ZmRvam8ua2V5cy5MRUZUX0FSUk9XCiAgICB9OwoKICAgIGZvciAoa2V5X2kgaW4gbW92ZUtleXMpIHsKICAgICAgICB2YXIgaG90S2V5ID0gbW92ZUtleXNba2V5X2ldOwoKICAgICAgICBpZiAoaG90S2V5LmN0cmwgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuY3RybCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChob3RLZXkuYWx0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaG90S2V5LmFsdCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoaG90S2V5LnNoaWZ0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaG90S2V5LnNoaWZ0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChob3RLZXkuZm9jdXNQYXJlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuZm9jdXNQYXJlbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICB9Cn0pKCk7CgoKT3pvbmUgPSBPem9uZSB8fCB7fTsKT3pvbmUuY29tcG9uZW50cyA9IE96b25lLmNvbXBvbmVudHMgfHwge307Ck96b25lLmNvbXBvbmVudHMua2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cyB8fCB7fTsKCk96b25lLmNvbXBvbmVudHMua2V5cy5jcmVhdGVLZXlFdmVudFNlbmRlciA9IGZ1bmN0aW9uKHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcikgewogICAgdmFyIGtleUNoYW5uZWxOYW1lID0gJ19rZXlFdmVudCcsCiAgICAgICAgcnBjID0gZ2FkZ2V0cy5ycGMsCiAgICAgICAgY2FsbHJwYyA9IHJwYy5jYWxsOwoKICAgIAogICAgcnBjLnJlZ2lzdGVyKCdfZm9jdXNfd2lkZ2V0X3dpbmRvdycsIGZ1bmN0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOwogICAgICAgIH0KICAgICAgICBjYXRjaChlKSB7fQogICAgfSk7CgogICAgY2FsbHJwYygnLi4nLCAnX3dpZGdldF9pZnJhbWVfcmVhZHknLCBudWxsLCB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSk7CgogICAgb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb24nICsgT3pvbmUuY29tcG9uZW50cy5rZXlzLkVWRU5UX05BTUUsIHRoaXMsIGZ1bmN0aW9uKGtleWV2ZW50KSB7CiAgICAgICAgdmFyIGtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMuSG90S2V5cywKICAgICAgICAgICAga2V5LCBmb3VuZCA9IGZhbHNlOwoKICAgICAgICBmb3IgKHZhciBrZXlfaSBpbiBrZXlzKSB7CiAgICAgICAgICAgIGtleSA9IGtleXNba2V5X2ldOwoKICAgICAgICAgICAgaWYgKGtleS5rZXkgPT09IGtleWV2ZW50LmtleUNvZGUgCiAgICAgICAgICAgICAgICAmJiBrZXkuYWx0ID09PSBrZXlldmVudC5hbHRLZXkKICAgICAgICAgICAgICAgICYmIGtleS5zaGlmdCA9PT0ga2V5ZXZlbnQuc2hpZnRLZXkpIHsKCiAgICAgICAgICAgICAgICBpZihrZXkuZm9jdXNQYXJlbnQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAvL3dpbmRvdy5ibHVyKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2FsbHJwYygnLi4nLCAnX2tleV9ldmVudGluZycsIG51bGwsIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCB7CiAgICAgICAgICAgICAgICAgICAga2V5Q29kZToga2V5ZXZlbnQua2V5Q29kZSwKICAgICAgICAgICAgICAgICAgICBhbHRLZXk6IGtleWV2ZW50LmFsdEtleSwKICAgICAgICAgICAgICAgICAgICBzaGlmdEtleToga2V5ZXZlbnQuc2hpZnRLZXksCiAgICAgICAgICAgICAgICAgICAgZm9jdXNQYXJlbnQ6IGtleS5mb2N1c1BhcmVudAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7ICAvL2luIGNhc2UgdGhlIHNhbWUga2V5IGlzIGluIGtleXMgdHdpY2UsIHdlIHN0aWxsIG9ubHkgd2FudAogICAgICAgICAgICAgICAgICAgICAgICAvL3RvIHNlbmQgb25lIGV2ZW50CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKGZvdW5kID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMuTW92ZUhvdEtleXM7CgogICAgICAgIGZvciAodmFyIGtleV9pIGluIGtleXMpIHsKICAgICAgICAgICAga2V5ID0ga2V5c1trZXlfaV07CgogICAgICAgICAgICBpZiAoa2V5LmtleSA9PT0ga2V5ZXZlbnQua2V5Q29kZSAKICAgICAgICAgICAgICAgICYmIGtleS5jdHJsID09PSBrZXlldmVudC5jdHJsS2V5CiAgICAgICAgICAgICAgICAmJiBrZXkuYWx0ID09PSBrZXlldmVudC5hbHRLZXkKICAgICAgICAgICAgICAgICYmIGtleS5zaGlmdCA9PT0ga2V5ZXZlbnQuc2hpZnRLZXkpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2FsbHJwYygnLi4nLCAnX2tleV9ldmVudGluZycsIG51bGwsIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCB7CiAgICAgICAgICAgICAgICAgICAga2V5Q29kZToga2V5ZXZlbnQua2V5Q29kZSwKICAgICAgICAgICAgICAgICAgICBjdHJsS2V5OiBrZXlldmVudC5jdHJsS2V5LAogICAgICAgICAgICAgICAgICAgIGFsdEtleToga2V5ZXZlbnQuYWx0S2V5LAogICAgICAgICAgICAgICAgICAgIHNoaWZ0S2V5OiBrZXlldmVudC5zaGlmdEtleSwKICAgICAgICAgICAgICAgICAgICBmb2N1c1BhcmVudDoga2V5LmZvY3VzUGFyZW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKICAgIG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ29ua2V5ZG93bicsIHRoaXMsIGZ1bmN0aW9uKGtleWV2ZW50KSB7CiAgICAgICAgdmFyIGtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMuTW92ZUhvdEtleXMsCiAgICAgICAgICAgIGtleTsKCiAgICAgICAgZm9yICh2YXIga2V5X2kgaW4ga2V5cykgewogICAgICAgICAgICBrZXkgPSBrZXlzW2tleV9pXTsKCiAgICAgICAgICAgIGlmIChrZXkua2V5ID09PSBrZXlldmVudC5rZXlDb2RlIAogICAgICAgICAgICAgICAgJiYga2V5LmN0cmwgPT09IGtleWV2ZW50LmN0cmxLZXkKICAgICAgICAgICAgICAgICYmIGtleS5hbHQgPT09IGtleWV2ZW50LmFsdEtleQogICAgICAgICAgICAgICAgJiYga2V5LnNoaWZ0ID09PSBrZXlldmVudC5zaGlmdEtleSkgewoKICAgICAgICAgICAgICAgIGNhbGxycGMoJy4uJywgJ19rZXlfZXZlbnRpbmcnLCBudWxsLCB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwgewogICAgICAgICAgICAgICAgICAgIGtleUNvZGU6IGtleWV2ZW50LmtleUNvZGUsCiAgICAgICAgICAgICAgICAgICAgY3RybEtleToga2V5ZXZlbnQuY3RybEtleSwKICAgICAgICAgICAgICAgICAgICBhbHRLZXk6IGtleWV2ZW50LmFsdEtleSwKICAgICAgICAgICAgICAgICAgICBzaGlmdEtleToga2V5ZXZlbnQuc2hpZnRLZXksCiAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBmb2N1c1BhcmVudDoga2V5LmZvY3VzUGFyZW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9OwoKdmFyIE96b25lID0gT3pvbmUgfHwge307DQpPem9uZS5sYXlvdXQgPSBPem9uZS5sYXlvdXQgfHwge307DQpPem9uZS51eCA9IE96b25lLnV4IHx8IHt9Ow0KT3pvbmUudXRpbCA9IE96b25lLnV0aWwgfHwge307DQoNCi8qDQogKiBHZW5lcmFsIEFsZ29yaXRobSANCiAqIA0KICogaWYgcXVlcnlTdHJpbmcgY29udGFpbnMgbGFuZyBwYXJhbWV0ZXIgc3dpdGggdG8gdGhhdCBsb2NhbGUNCiAqIGVsc2UgY2hlY2sgYnJvd3NlciBsYW5ndWFnZSBzZXR0aW5nDQogKiANCiAqIExhbmd1YWdlIHN3aXRjaGluZyBpcyBhY2NvbXBsaXNoZWQgYnkgaW5jbGl1ZGluZyBhIGxvY2FsZQ0KICogc3BlY2lmaWMgamF2YXNjcmlwdCBmaWxlDQogKi8NCi8qKg0KICogQGNsYXNzDQogKiBAZGVzY3JpcHRpb24gUHJvdmlkZXMgdXRpbGl0eSBtZXRob2RzIGZvciBsb2NhbGl6YXRpb24NCiAqLw0KT3pvbmUubGFuZyA9IHsNCglsYW5ndWFnZVNldHRpbmcgOiAnZW4tVVMnLCANCgkNCglyZWdleExlYWRpbmdUYWlsaW5nU3BhY2VDaGFyczogL15ccyt8XHMrJC9nLA0KCQ0KCXJlZ2V4VHJhaWxpbmdTcGFjZUNoYXJzOiAvXHMrJC8sDQoJDQoJcmVnZXhMZWFkaW5nU3BhY2VDaGFyczogL15ccysvLA0KCQ0KCXZlcnNpb24gOiBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLmxhbmd1YWdlLA0KCQ0KCXVybERlY29kZTogZnVuY3Rpb24oc3RyaW5nLCBvdmVyd3JpdGUpew0KICAgICAgICBpZiAoIXN0cmluZyB8fCAhc3RyaW5nLmxlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIHt9Ow0KICAgICAgICB9DQogICAgICAgIHZhciBvYmogPSB7fTsNCiAgICAgICAgdmFyIHBhaXJzID0gc3RyaW5nLnNwbGl0KCcmJyk7DQogICAgICAgIHZhciBwYWlyLCBuYW1lLCB2YWx1ZTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBhaXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICBwYWlyID0gcGFpcnNbaV0uc3BsaXQoJz0nKTsNCiAgICAgICAgICAgIG5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQocGFpclswXSk7DQogICAgICAgICAgICB2YWx1ZSA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzFdKTsNCiAgICAgICAgICAgIGlmIChvdmVyd3JpdGUgIT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9ialtuYW1lXSA9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgICAgICBvYmpbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbbmFtZV0gPT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtuYW1lXSA9IFtvYmpbbmFtZV1dOw0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW25hbWVdLnB1c2godmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW25hbWVdLnB1c2godmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBvYmpbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb2JqOw0KICAgIH0sDQoJDQogICAgLyoqDQogICAgICogQGRlc2NyaXB0aW9uIEdldHMgdGhlIGxhbmd1YWdlIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIHVzZWQgYnkgT1dGDQogICAgICogQHJldHVybiBSZXR1cm5zIHRoZSBJU08gNjM5LTEgbGFuZ3VhZ2UgY29kZSBmb3IgdGhlIGxhbmd1YWdlIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIHVzZWQgYnkgT1dGDQogICAgICogQGV4YW1wbGUNCiAgICAgKiBpZiAoT3pvbmUubGFuZy5nZXRMYW5ndWFnZSgpID09ICdlcycpIHsNCiAgICAgKiAgIEFubm91bmNpbmdDbG9ja1N0cmluZ3MudGltZUxhYmVsID0gJ0VsIHRpZW1wbyBlcyc7DQogICAgICogfSANCiAgICAgKiANCiAgICAgKi8NCglnZXRMYW5ndWFnZSA6IGZ1bmN0aW9uKCkgew0KCSAgICB2YXIgcGFyYW1zID0gT3pvbmUubGFuZy51cmxEZWNvZGUod2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkpOw0KICAgICAgICBpZiAocGFyYW1zLmxhbmcpIHsNCgkJCXJldHVybiBwYXJhbXMubGFuZzsNCgkJfQ0KICAgICAgICBlbHNlIHsNCg0KICAgICAgICAgIC8vdHJ5IHRvIGZpbmQgaXQgaW4gdGhlIHdpbmRvdy5uYW1lDQogICAgICAgICAgaWYgKE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSkgew0KDQogICAgICAgICAgICB2YXIgZGF0YSA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOw0KICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBkYXRhLmxhbmcpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubGFuZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL2p1c3QgdXNlIGRlZmF1bHQNCiAgICAgICAgcmV0dXJuIE96b25lLmxhbmcubGFuZ3VhZ2VTZXR0aW5nOyAgDQogICAgfSANCn07DQoNCk96b25lLmxheW91dC5NZW51ID0gew0KCW92ZXJmbG93TWVudUJ1dHRvblRvb2x0aXAgOiAiQ2xpY2sgdG8gc2hvdyBtb3JlIGJ1dHRvbnMiDQp9Ow0KDQpPem9uZS5sYXlvdXQuQ29uZmlndXJhdGlvbldpbmRvd1N0cmluZyA9IHsNCglzZXRBc05ldyA6ICJTYXZlIGFzIG5ldyIsIA0KICAgIHNldEFzRGVmYXVsdCA6ICJTZXQgYXMgZGVmYXVsdCIsDQogICAgc2hvd0Nhcm91c2VsIDogIlNob3cgTGF1bmNoIE1lbnUiLA0KICAgIHNob3dTaG9ydGN1dHMgOiAiU2hvdyBTaG9ydGN1dHMiLA0KICAgIHNob3dUb29sYmFyIDogIlNob3cgdG9vbGJhciBvcHRpb25zIiwNCiAgICBkb2N1bWVudFRpdGxlIDogIkRvY3VtZW50IFRpdGxlIiwNCgkNCgl0b3BTZWxlY3RvciA6ICdUb3AnLCANCiAgICBjZW50ZXJTZWxlY3RvciA6ICdDZW50ZXInLA0KICAgIGFjY29yZGlvblNlbGVjdG9yIDogJ0FjY29yZGlvbicsIA0KICAgIHRvb2xiYXJCdXR0b25zIDogJ1Rvb2xiYXIgQnV0dG9ucycsIA0KICAgIGNsZWFyIDogJ0NsZWFyJywNCiAgICBzYXZlIDogJ09LJywNCiAgICBjYW5jZWwgOiAnQ2FuY2VsJywNCiAgICBjbGVhckFsbDogJ0NsZWFyIEFsbCcsDQoJDQogICAgY29sdW1uIDogJ0NvbHVtbicsIA0KICAgIGNvbHVtbnMgOiAnQ29sdW1ucycsDQoJDQogICAgdGFiIDogJ1RhYicsIA0KICAgIHRhYnMgOiAnVGFicycNCn07DQoNCk96b25lLmxheW91dC5DcmVhdGVWaWV3V2luZG93U3RyaW5nID0gew0KICAgIGNyZWF0ZU5ldzogJ0NyZWF0ZSBuZXcnLA0KICAgIGNyZWF0ZUZyb21FeGlzaXRpbmc6ICdDcmVhdGUgZnJvbSBleGlzdGluZycsDQogICAgaW1wb3J0VmlldzogJ0ltcG9ydCcNCn07DQoNCk96b25lLmxheW91dC5NYW5hZ2VWaWV3c1dpbmRvd1N0cmluZyA9IHsNCiAgICBsYW5ndWFnZXM6ICdMYW5ndWFnZScNCn07DQoNCk96b25lLmxheW91dC5Ub29sYmFyU3RyaW5nID0gew0KICAgY29uZmlndXJhdGlvbk1hbmFnZXIgOiAnQ29uZmlndXJhdGlvbiBNYW5hZ2VyJw0KfTsNCg0KT3pvbmUubGF5b3V0LkRlc2t0b3BXaW5kb3dNYW5hZ2VyU3RyaW5nID0gew0KICAgIGNvbmZpZ3VyZURhc2hib2FyZCA6ICdDb25maWd1cmUgRGFzaGJvYXJkJywgDQogICAgdG9nZ2xlQ2Fyb3VzZWwgOiAnVG9nZ2xlIExhdW5jaCBNZW51JywNCiAgICB3ZWxjb21lTWVzc2FnZSA6ICdXZWxjb21lJw0KfTsNCg0KT3pvbmUubGF5b3V0LnRvb2x0aXBTdHJpbmcgPSB7DQoJd2lkZ2V0TGF1bmNoTWVudVRpdGxlOiAJCQknTGF1bmNoIE1lbnUnLA0KCW1hbmFnZURhc2hib2FyZHNUaXRsZTogCQkJJ0Rhc2hib2FyZCBTZXR0aW5ncycsDQoJbWFuYWdlRGFzaGJvYXJkc0NvbnRlbnQ6IAkJJ1RoaXMgc2NyZWVuIGFsbG93cyB1c2VycyB0byByZWFycmFuZ2UsIGVkaXQsIGFuZCBkZWxldGUgZGFzaGJvYXJkcy4gSXQgYWxzbyBhbGxvd3MgdXNlcnMgdG8gc2V0IHRoZWlyIGxhbmd1YWdlIHByZWZlcmVuY2UuJywNCgljcmVhdGVEYXNoYm9hcmRUaXRsZTogCQkJJ0NyZWF0ZSBEYXNoYm9hcmQnLA0KCWNyZWF0ZURhc2hib2FyZENvbnRlbnQ6IAkJJ1RoaXMgc2NyZWVuIGFsbG93cyB1c2VycyB0byBjcmVhdGUgYmxhbmsgZGFzaGJvYXJkcywgY29weSBhbiBleGlzdGluZyBkYXNoYm9hcmQsIG9yIGltcG9ydCBhIGRhc2hib2FyZCBmcm9tIGEgc2hhcmVkIGNvbmZpZ3VyYXRpb24uJywNCglhZGRXaWRnZXRzVGl0bGU6IAkJCQknTGF1bmNoIE1lbnUgKEFsdCtTaGlmdCtMKScsDQoJYWRkV2lkZ2V0c0NvbnRlbnQ6IAkJCQknVGhpcyBidXR0b24gb3BlbnMgb3IgY2xvc2VzIHRoZSBMYXVuY2ggTWVudSwgYWxsb3dpbmcgdXNlcnMgdG8gYWRkIHdpZGdldHMgdG8gdGhlaXIgY3VycmVudCBkYXNoYm9hcmQuJywNCglkYXNoYm9hcmRTd2l0Y2hlclRpdGxlOgkJCSdTd2l0Y2hlciAoQWx0K1NoaWZ0K0MpJywNCglkYXNoYm9hcmRTd2l0Y2hlckNvbnRlbnQ6CQknVGhpcyBidXR0b24gb3BlbnMgb3IgY2xvc2VzIHRoZSBTd2l0Y2hlciwgYWxsb3dpbmcgdXNlcnMgdG8gc3dpdGNoIGJldHdlZW4gdGhlaXIgZGFzaGJvYXJkcy4nLA0KCW1hcmtldHBsYWNlV2luZG93VGl0bGU6CQkJJ01hcmtldHBsYWNlIChBbHQrU2hpZnQrTSknLA0KCW1hcmtldHBsYWNlV2luZG93Q29udGVudDoJCSdUaGlzIGJ1dHRvbiBvcGVucyB0aGUgTWFya2V0cGxhY2Ugd2luZG93LCBhbGxvd2luZyB1c2VycyB0byBkaXNjb3ZlciB3aWRnZXRzIGluIE1hcmtldHBsYWNlIGFuZCBhZGQgdGhlbSB0byB0aGVpciBPV0YgaW5zdGFuY2UuJywNCiAgICBtZXRyaWNXaW5kb3dUaXRsZToJCSAgICAJJ01ldHJpYyAoQWx0K1NoaWZ0K1IpJywNCiAgICBtZXRyaWNXaW5kb3dDb250ZW50OiAgICAgIAkJJ1RoaXMgYnV0dG9uIG9wZW5zIHRoZSBNZXRyaWMgd2luZG93LCB3aGVyZSB3aWRnZXRzIHRoYXQgbW9uaXRvciBPV0YgYW5kIHdpZGdldCBzdGF0aXN0aWNzIGFyZSBsb2NhdGVkLicsDQoJc2V0dGluZ3NUaXRsZToJCQkJCSdTZXR0aW5ncyAoQWx0K1NoaWZ0K1MpJywNCglzZXR0aW5nc0NvbnRlbnQ6CQkJCSdUaGlzIGJ1dHRvbiBvcGVucyB0aGUgU2V0dGluZ3Mgd2luZG93LCBhbGxvd2luZyB1c2VycyB0byBjdXN0b21pemUgdGhlaXIgd2lkZ2V0cyBvciBjaGFuZ2UgdGhlbWVzLicsDQoJYWRtaW5Ub29sc1RpdGxlOgkJCQknQWRtaW5pc3RyYXRpb24gKEFsdCtTaGlmdCtBKScsDQoJYWRtaW5Ub29sc0NvbnRlbnQ6CQkJCSdUaGlzIGJ1dHRvbiBvcGVucyB0aGUgQWRtaW5pc3RyYXRpb24gd2luZG93LCBleHBvc2luZyBhZG1pbmlzdHJhdG9ycyB0byBmdW5jdGlvbmFsaXR5IGZvciBtYW5hZ2luZyBncm91cHMsIGRhc2hib2FyZHMsIHdpZGdldHMsIGFuZCB1c2Vycy4nLA0KCWhlbHBUaXRsZToJCQkJCQknSGVscCAoQWx0K1NoaWZ0K0gpJywNCgloZWxwQ29udGVudDoJCQkJCSdUaGlzIGJ1dHRvbiBvcGVucyB0aGUgSGVscCB3aW5kb3csIGFsbG93aW5nIHVzZXJzIHRvIGJyb3dzZSBoZWxwIGZpbGVzIGZvciBhc3Npc3RhbmNlIG9uIHVzaW5nIE9XRi4nLA0KCXNoYXJlVGl0bGU6IAkJCQkJJ1NoYXJlIERhc2hib2FyZCcsDQoJc2hhcmVDb250ZW50OiAJCQkJCSdUaGlzIGZlYXR1cmUgYWxsb3dzIGEgdXNlciB0byBleHBvcnQgdGhlaXIgY3VycmVudCBkYXNoYm9hcmQgc28gdGhhdCBvdGhlciB1c2VycyBjYW4gaW1wb3J0IGl0LicsDQoJY3VzdG9taXplRGFzaGJvYXJkVGl0bGU6CQknQ3VzdG9taXplIERhc2hib2FyZCcsDQoJY3VzdG9taXplRGFzaGJvYXJkQ29udGVudDogCQknVGhpcyBzY3JlZW4gYWxsb3dzIHVzZXJzIHRvIGN1c3RvbWl6ZSB0aGUgY3VycmVudCBkYXNoYm9hcmQuJywNCglldmVudGluZ1RpdGxlOgkJCQkJJ0R5bmFtaWMgRXZlbnRpbmcnLA0KCWV2ZW50aW5nQ29udGVudDogCQkJCSdUaGlzIHNjcmVlbiBhbGxvd3MgdXNlcnMgdG8gbWFuYWdlIGR5bmFtaWMgd2lkZ2V0IGV2ZW50aW5nLicsDQogICAgdGhlbWVTZWxlY3RvclRpdGxlOiAgICAgICAgICAgICAnQ2hhbmdlIHRoZSBzdHlsaW5nIG9mIHlvdXIgT1dGJywNCiAgICB0aGVtZVNlbGVjdG9yQ29udGVudDogICAgICAgICAgICdUaGlzIHNjcmVlbiBhbGxvd3MgdXNlcnMgdG8gY2hhbmdlIHRoZSBiYWNrZ3JvdW5kLCB3aW5kb3cgY29sb3IgYW5kIHN0eWxlIGZvciBPV0YuJywNCglzaG93QmFubmVyVGl0bGU6IAkJCQknU2hvdy9IaWRlIEJhbm5lcicsDQoJc2hvd0Jhbm5lckNvbnRlbnQ6IAkJCQknVGhpcyBidXR0b24gc2hvd3MgYW5kIGhpZGVzIHRoZSBib3R0b20gdHdvIHJvd3Mgb2YgdGhlIGRhc2hib2FyZCBiYW5uZXIuJywNCgljYXJvdXNlbENsb3NlQ29udGVudDogCQkJJ1RoaXMgYnV0dG9uIGNsb3NlcyB0aGUgd2lkZ2V0IExhdW5jaCBNZW51LicsDQoJY2Fyb3VzZWxDbG9zZVRpdGxlOiAJCQknQ2xvc2UgTGF1bmNoIE1lbnUnLA0KCWNhcm91c2VsTWFuYWdlV2lkZ2V0c1RpdGxlOgkJJ1dpZGdldCBTZXR0aW5ncycsDQoJY2Fyb3VzZWxNYW5hZ2VXaWRnZXRzQ29udGVudDogCSdUaGlzIHNjcmVlbiBhbGxvd3MgdXNlcnMgdG8gY3VzdG9taXplIHRoZWlyIExhdW5jaCBNZW51LCBjb250cm9sbGluZyB3aGljaCB3aWRnZXRzIGFyZSB2aXNpYmxlIGFuZCB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBhcHBlYXIuIEl0IGFsc28gYWxsb3dzIGZvciB0aGUgZGVsZXRpb24gb2Ygd2lkZ2V0cyBhbmQgY29udGFpbnMgYSBsaW5rIHRvIHRoZSBPV0YgTWFya2V0cGxhY2UuIFRoZSBncm91cGluZyB0YWdzIG9mIGEgd2lkZ2V0IGNhbiBhbHNvIGJlIG1vZGlmaWVkIGluIHRoaXMgc2NyZWVuLicsDQoJYWRtaW5XREVkaXRUaXRsZTogCQkJCSdFZGl0IFdpZGdldCBEZWZpbml0aW9uJywNCglhZG1pbldERWRpdENvbnRlbnQ6IAkJCSdDaGFuZ2UgdGhlIHByb3BlcnRpZXMgb2YgYSB3aWRnZXQgZGVmaW5pdGlvbi4gTm90ZSB0aGF0IHdoaWxlIHByb3BlcnRpZXMgc3VjaCBhcyBVUkxzIHdpbGwgcHJvcGFnYXRlIHRvIGFscmVhZHkgZXhpc3RpbmcgaW5zdGFuY2VzIG9mIGEgd2lkZ2V0LCBtYWxsZWFibGUgcHJvcGVydGllcyBzdWNoIGFzIGhlaWdodCB3aWxsIG5vdCBiZSBhZmZlY3RlZC4nLA0KCWFkbWluV0REZWxldGVUaXRsZTogCQkJJ0RlbGV0ZSBXaWRnZXQgRGVmaW5pdGlvbicsDQoJYWRtaW5XRERlbGV0ZUNvbnRlbnQ6IAkJCSdEZWxldGVzIHRoZSBzZWxlY3RlZCB3aWRnZXQgZGVmaW5pdGlvbi4gSW4gYWRkaXRpb24gdG8gcmVtb3ZpbmcgdGhlIGRlZmluaXRpb24gaXRzZWxmLCBhbGwgaW5zdGFuY2VzIG9mIHRoaXMgd2lkZ2V0IHdpbGwgYmUgcmVtb3ZlZCBmcm9tIGFsbCB1c2VyIGRhc2hib2FyZHMuJywNCglhZG1pbkRhc2hBZGRUaXRsZToJCQkJJ0FkZCBEYXNoYm9hcmQnLA0KCWFkbWluUFdEQXBwbHlUaXRsZToJCQkJJ0FwcGx5IFVzZXIgV2lkZ2V0cycsDQogICAgYWRtaW5QV0RBcHByb3ZlVGl0bGU6CQkJJ0FwcHJvdmUgVXNlciBXaWRnZXRzJywNCglhZG1pbkRhc2hDb3B5VGl0bGU6IAkJCSdDb3B5IERhc2hib2FyZCcsDQoJYWRtaW5EYXNoQ29weUNvbnRlbnQ6IAkJCSdDb3B5IGFuIGV4aXN0aW5nIGRhc2hib2FyZCB0byBvbmUgb3IgbW9yZSB1c2Vycy4gTm90ZSB0aGF0IG9uY2UgY29waWVkLCBlYWNoIGRhc2hib2FyZCBpbnN0YW5jZSBpcyBhbiBpbmRlcGVuZGVudCBlbnRpdHkuIENoYW5nZXMgbWFkZSB0byB0aGUgaW5pdGlhbCBkYXNoYm9hcmQgYXQgYSBsYXRlciBkYXRlIHdpbGwgbm90IGJlIGNvcGllZC4nLA0KCWFkbWluRGFzaEVkaXRUaXRsZTogCQkJJ0VkaXQgRGFzaGJvYXJkJywNCglhZG1pbkRhc2hFZGl0Q29udGVudDogCQkJJ0NoYW5nZXMgdGhlIHByb3BlcnRpZXMgb2YgYSBkYXNoYm9hcmQuIE5vdGUgdGhhdCBkYXNoYm9hcmQgc3RhdGUgaXMgcmVwcmVzZW50ZWQgYXMgYSBKU09OIG9iamVjdCwgYW5kIGFueSBjaGFuZ2VzIG1hZGUgdG8gaXQgbXVzdCBiZSB2YWxpZCBKU09OLicsDQoJYWRtaW5EYXNoRGVsZXRlVGl0bGU6IAkJCSdEZWxldGUgRGFzaGJvYXJkJywNCglhZG1pbkRhc2hEZWxldGVDb250ZW50OiAJCSdEZWxldGVzIHRoZSBzZWxlY3RlZCBkYXNoYm9hcmQuIE5vdGUgdGhhdCBpZiBhIHVzZXIgaXMgY3VycmVudGx5IHVzaW5nIHRoZSBkYXNoYm9hcmQsIHRoZXkgd2lsbCBub3QgYmUga2lja2VkIG91dC4gSG93ZXZlciwgaXQgd2lsbCBub3QgYmUgYXZhaWxhYmxlIG9uY2UgdGhleSBuYXZpZ2F0ZSBhd2F5LicsDQoJYWRtaW5QcmVmc0NvcHlUaXRsZTogCQkJJ0NvcHkgUHJlZmVyZW5jZScsDQoJYWRtaW5QcmVmc0NvcHlDb250ZW50OiAJCQknQ29weSBhbiBleGlzdGluZyBwcmVmZXJlbmNlIHRvIG9uZSBvciBtb3JlIHVzZXJzLiBOb3RlIHRoYXQgb25jZSBjb3BpZWQsIGVhY2ggcHJlZmVyZW5jZSBpbnN0YW5jZSBpcyBhbiBpbmRlcGVuZGVudCBlbnRpdHkuIENoYW5nZXMgbWFkZSB0byB0aGUgaW5pdGlhbCBwcmVmZXJlbmNlIGF0IGEgbGF0ZXIgZGF0ZSB3aWxsIG5vdCBiZSBjb3BpZWQuJywNCglhZG1pblByZWZzRWRpdFRpdGxlOiAJCQknRWRpdCBQcmVmZXJlbmNlJywNCglhZG1pblByZWZzRWRpdENvbnRlbnQ6IAkJCSdDaGFuZ2VzIHRoZSBwcm9wZXJ0aWVzIG9mIGEgcHJlZmVyZW5jZS4nLA0KCWFkbWluUHJlZnNEZWxldGVUaXRsZTogCQkJJ0RlbGV0ZSBQcmVmZXJlbmNlLicsDQoJYWRtaW5QcmVmc0RlbGV0ZUNvbnRlbnQ6IAkJJ0RlbGV0ZXMgdGhlIHNlbGVjdGVkIHByZWZlcmVuY2UuJywNCglhZG1pblVzZXJzRWRpdFRpdGxlOiAJCQknRWRpdCBVc2VyJywNCglhZG1pblVzZXJzRWRpdENvbnRlbnQ6IAkJCSdDaGFuZ2VzIHRoZSBwcm9wZXJ0aWVzIG9mIGEgdXNlci4gTm90ZSB0aGF0IHRoaXMgZG9lcyBub3QgZWRpdCBhbnkgdXNlciBpbmZvcm1hdGlvbiBpbiBhbiB1bmRlcmx5aW5nIHNlY3VyaXR5IGltcGxlbWVudGF0aW9uLiBPbmx5IHRoZSBpbmZvcm1hdGlvbiB0aGF0IGlzIHN0b3JlZCBpbiB0aGUgZnJhbWV3b3JrIGl0c2VsZiB3aWxsIGJlIGNoYW5nZWQuJywNCglhZG1pblVzZXJzRGVsZXRlVGl0bGU6IAkJCSdEZWxldGUgVXNlcicsDQoJYWRtaW5Vc2Vyc0RlbGV0ZUNvbnRlbnQ6CQknRGVsZXRlcyBhIGdpdmVuIHVzZXIgZnJvbSB0aGUgZnJhbWV3b3JrLiBOb3RlIHRoYXQgdGhpcyBkb2VzIG5vdCBkZWxldGUgdGhlIHVzZXIgaW5mb3JtYXRpb24gaW4gYW4gdW5kZXJseWluZyBzZWN1cml0eSBpbXBsZW1lbnRhdGlvbi4gT25seSB0aGUgdXNlciBpbmZvcm1hdGlvbiB0aGF0IGlzIHN0b3JlZCBpbiB0aGUgZnJhbWV3b3JrIGl0c2VsZiB3aWxsIGJlIHJlbW92ZWQuIEluIGFkZGl0aW9uLCBpdCBpcyBwb3NzaWJsZSB0aGF0IHdpdGggY2VydGFpbiBzZWN1cml0eSBpbXBsZW1lbnRhdGlvbnMgc3VjaCBhcyB4NTA5IGNlcnRpZmljYXRlcywgYSB1c2VyIHdpbGwgYmUgcmUtY3JlYXRlZCBieSB0aGUgZnJhbWV3b3JrIGlmIHRoZXkgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZS4nLA0KCWFkbWluVXNlcldpZGdldHNEZWxldGVUaXRsZTogCSdEZWxldGUgVXNlciBXaWRnZXQnLA0KCWFkbWluVXNlcldpZGdldHNEZWxldGVDb250ZW50OiAnUmVtb3ZlcyBhY2Nlc3MgdG8gdGhpcyB3aWRnZXQgZm9yIGEgZ2l2ZW4gdXNlci4gUGxlYXNlIG5vdGUgdGhhdCB0aGlzIHdpbGwgbm90IGRlbGV0ZSB0aGUgdW5kZXJseWluZyB3aWRnZXQgZGVmaW5pdGlvbiAtIG90aGVyIHVzZXJzIHdpbGwgc3RpbGwgaGF2ZSBhY2Nlc3MuJywNCgljbGVhckNvbm5lY3Rpb25zVGl0bGU6IAknQ2xlYXIgQWxsIENvbm5lY3Rpb25zJywNCgljbGVhckNvbm5lY3Rpb25zQ29udGVudDogJ1JlbW92ZXMgYWxsIGRpcmVjdGVkIGR5bmFtaWMgZXZlbnRpbmcgY29ubmVjdGlvbnMgYmV0d2VlbiB0aGUgd2lkZ2V0cyBvbiB0aGlzIGRhc2hib2FyZC4nLA0KICAgICAgICBiYW5uZXJEb2NrVGl0bGU6ICAgICAgICAgICAgICAgICAgICAgICAgJ0RvY2snLA0KICAgICAgICBiYW5uZXJEb2NrQ29udGVudDogICAgICAgICAgICAgICAgICAgICAgJ0RvY2sgdG9vbGJhciB0byBiYW5uZXIgYXQgdG9wIG9mIHBhZ2UuJywNCiAgICAgICAgYmFubmVyVW5kb2NrVGl0bGU6ICAgICAgICAgICAgICAgICAgICAgICdVbmRvY2snLA0KICAgICAgICBiYW5uZXJVbmRvY2tDb250ZW50OiAgICAgICAgICAgICAgICAgICAgJ1VuZG9jayB0b29sYmFyIHRvIGZsb2F0aW5nIHBvc2l0aW9uIGFuZCBoaWRlIGJhbm5lci4nDQp9Ow0KDQpPem9uZS5sYXlvdXQuYWRtaW4gPSB7DQoJdXBkYXRlRGFzaGJvYXJkVGl0bGU6IAkJCSdVcGRhdGUgRGFzaGJvYXJkJywNCglkYXNoYm9hcmRVcGRhdGVkQ29udGVudDogCQknRGFzaGJvYXJkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LicNCn07DQoNCk96b25lLnV4LkRhc2hib2FyZE1nbXRTdHJpbmcgPSB7DQogICAgY3JlYXRlRGFzaGJvYXJkIDogJ0NyZWF0ZSBhIERhc2hib2FyZCcsIA0KICAgIHNlbGVjdERhc2hib2FyZERvdERvdCA6ICdTZWxlY3QgYSBkYXNoYm9hcmQuLi4nLA0KICAgIGRlbGV0ZURhc2hib2FyZCA6ICdEZWxldGUgYSBEYXNoYm9hcmQnLCANCiAgICBpbXBvcnRhRGFzaGJvYXJkIDogJ0ltcG9ydCBhIERhc2hib2FyZCcsDQogICAgZXhwb3J0RGFzaGJvYXJkIDogJ0V4cG9ydCBDdXJyZW50IERhc2hib2FyZCcsIA0KICAgIGV4cG9ydERhc2hib2FyZENvbmZpZyA6ICdFeHBvcnQgRGFzaGJvYXJkIENvbmZpZ3VyYXRpb24nLCANCiAgICB1cGxvYWRDb25maWcgOiAnVXBsb2FkLi4uJywgDQogICAgc2V0QXNEZWZhdWx0IDogJ1NldCBhcyBkZWZhdWx0JywgDQogICAgZGFzaGJvYXJkcyA6ICdEYXNoYm9hcmRzJywgDQogICAgdGl0bGUgOiAnVGl0bGUnLCANCiAgICBsYXlvdXQgOiAnTGF5b3V0JywgDQogICAgZGVzY3JpcHRpb24gOiAnRGVzY3JpcHRpb24nLA0KICAgIHRvcCA6ICdUb3AnLCANCiAgICBib3R0b20gOiAnQm90dG9tJywgDQogICAgY29sdW1ucyA6ICdDb2x1bW5zJywgDQogICAgYXJyYW5nZW1lbnQgOiAnQXJyYW5nZW1lbnQnLCANCiAgICBzZWxlY3REYXNoYm9hcmQgOiAnU2VsZWN0IERhc2hib2FyZCcsIA0KICAgIGFjY29yZGlvbiA6ICdBY2NvcmRpb24nLCANCiAgICBwb3J0YWwgOiAnUG9ydGFsJywgDQogICAgdGFiYmVkIDogJ1RhYmJlZCcsIA0KICAgIGRlc2t0b3AgOiAnRGVza3RvcCcsIA0KICAgIGZpdCA6ICdGaXQnLCANCgl0b29sdGlwTWFuYWdlRGFzaGJvYXJkczogJ0Rhc2hib2FyZCBTZXR0aW5ncycsDQoJdG9vbHRpcENyZWF0ZURhc2hib2FyZDogJ0NyZWF0ZSBEYXNoYm9hcmQnLA0KCQ0KICAgIG9rIDogJ09LJywgDQogICAgcmVzZXQgOiAnUmVzZXQnLA0KICAgIGFib3V0OiAnQWJvdXQnLCANCiAgICBsb2dvdXQ6ICdMb2dvdXQnLCANCiAgICBpbXBvcnREYXNoYm9hcmQgOiAnSW1wb3J0IERhc2hib2FyZCcsIA0KICAgIGRhc2hib2FyZFRpdGxlIDogJ0Rhc2hib2FyZCBUaXRsZScsIA0KICAgIGVudGVyRGFzaGJvYXJkVGl0bGUgOiAnRW50ZXIgRGFzaGJvYXJkIFRpdGxlLi4uJywNCiAgICBicm93c2UgOiAnQnJvd3NlLi4uJywgDQoJDQoJbG9hZERlZmF1bHRNc2cgOiAnTG9hZCBEZWZhdWx0IENvbmZpZ3VyYXRpb24/JywNCglub0Rhc2hib2FyZFNlbGVjdGVkTXNnIDogJ05vIGNvbmZpZ3VyYXRpb24gd2FzIHNlbGVjdGVkLiAgRG8geW91IHdhbnQgdG8gbG9hZCB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uPycsDQoJY2hhbmdlTGFuZ3VhZ2UgOiAnQ2hhbmdlIExhbmd1YWdlJywNCgllcyA6ICdTcGFuaXNoJywNCgllbl9VUyA6ICdFbmdsaXNoJywNCglrbyA6ICdLb3JlYW4nDQp9Ow0KDQpPem9uZS5sYXlvdXQuQWNjb3JkaW9uV2luZG93TWFuYWdlclN0cmluZyA9IHsNCiAgICBjb25maWd1cmVBY2NvcmRpb24gOiAnQ29uZmlndXJlIEFjY29yZGlvbicgDQp9Ow0KDQpPem9uZS5sYXlvdXQuUG9ydGFsV2luZG93TWFuYWdlclN0cmluZyA9IHsNCiAgICBjb25maWd1cmVQb3J0bGV0cyA6ICdDb25maWd1cmUgUG9ydGxldHMnICAgIA0KfTsNCg0KT3pvbmUubGF5b3V0LlRhYmJlZFdpbmRvd01hbmFnZXJTdHJpbmcgPSB7DQogICAgY29uZmlndXJlVGFicyA6ICc8c3BhbiBjbGFzcz0iY29uZmlndXJlVGFiQnV0dG9uIj5Db25maWd1cmUgVGFiczwvc3Bhbj4nICAgDQp9Ow0KDQpPem9uZS51dGlsLkVycm9yTWVzc2FnZVN0cmluZyA9IHsNCgllcnJvclRpdGxlIDogJ0Vycm9yJywNCglkYXNoYm9hcmRDb25maWcgOiAnRGFzaGJvYXJkIENvbmZpZ3VyYXRpb24nLA0KCXdpZGdldENvbmZpZ3VyYXRpb24gOiAnV2lkZ2V0IENvbmZpZ3VyYXRpb24nLCANCglub1dpZGdldHMgOiAnVGhlcmUgYXJlIG5vIHdpZGdldHMgdG8gd2hpY2ggeW91IGhhdmUgYWNjZXNzLicsIA0KCWNvbmZpZ3VyYXRpb25Nc2cgOiAnRmFpbGVkIHRvIHJldHJpZXZlIGNvbmZpZ3VyYXRpb24gZGF0YScsIA0KCWRhc2hib2FyZEJsYW5rTXNnOiAnSW52YWxpZCBEYXNoYm9hcmQgTmFtZSwgaXQgY2Fubm90IGJlIGJsYW5rLiA8YnIgLz5QbGVhc2UgcHJvdmlkZSBhIHZhbGlkIERhc2hib2FyZCBOYW1lLicsDQoJZGFzaGJvYXJkSW52YWxpZEVudHJ5TXNnOiAiVW5hYmxlIHRvIHVwZGF0ZSBkYXNoYm9hcmQgbmFtZShzKSBkdWUgPGJyLz50byBpbnZhbGlkIGNoYXJhY3RlcnMuIiwNCglpbnZhbGlkRm9ybSA6ICdJbnZhbGlkIEZvcm0nLA0KCWludmFsaWRGb3JtTXNnIDogJ0Zvcm0gaXMgaW52YWxpZC4gIFBsZWFzZSBtYWtlIHN1cmUgYWxsIHJlcXVpcmVkIGZpZWxkcyBhcmUgY29tcGxldGVkLicsDQoJbGFuZ3VhZ2VQcmVmZXJlbmNlIDogJ0xhbmd1YWdlIFByZWZlcmVuY2UnLA0KCWxhbmd1YWdlUHJlZmVyZW5jZU1zZyA6ICdFcnJvciBzYXZpbmcgbGFuZ3VhZ2UgcHJlZmVyZW5jZScsDQoJc2V0dGluZ1Nlc3Npb25EYXRhTXNnIDogJ0Vycm9yIHNldHRpbmcgc2Vzc2lvbiBkYXRhJywNCglyZXRyaWV2aW5nU2Vzc2lvbkRhdGFNc2cgOiAnRXJyb3IgcmV0cmlldmluZyBzZXNzaW9uIGRhdGEnLA0KCXNhdmVVc2VyUHJlZmVyZW5jZXMgOiAnRXJyb3Igc2F2aW5nIHVzZXIgcHJlZmVyZW5jZScsDQoJc3RvcmVFcnJvck1zZyA6ICdTdG9yZSBFcnJvciBNZXNzYWdlJywNCglzZW5kQW5kRm9yZ2V0IDogJ1NlbmQgYW5kIEZvcmdldCcsDQoJdXNlck5hbWUgOiAnVXNlciBOYW1lJywNCgl1cGRhdGVEYXNoYm9hcmRNc2cgOiAnRXJyb3IgdXBkYXRpbmcgZGFzaGJvYXJkJywNCglzYXZlVXBkYXRlZFZpZXdzIDogJ1VwZGF0ZSBEYXNoYm9hcmRzJywNCglzYXZlVXBkYXRlZFZpZXdzTXNnIDogJ0Vycm9yIHVwZGF0aW5nIERhc2hib2FyZHMnLA0KCXNhdmVVcGRhdGVkV2lkZ2V0cyA6ICdVcGRhdGUgV2lkZ2V0cycsDQoJc2F2ZVVwZGF0ZWRXaWRnZXRzTXNnIDogJ0Vycm9yIHVwZGF0aW5nIHdpZGdldHMnLA0KCXJldHJpZXZlVXBkYXRlZFdpZGdldHMgOiAnUmV0cmlldmluZyBVcGRhdGVkIFdpZGdldHMnLA0KCXJldHJpZXZlVXBkYXRlZFdpZGdldHNNc2cgOiAnRXJyb3IgcmV0cmlldmluZyB1cGRhdGVkIHdpZGdldHMnLA0KCWludmFsaWRVcmw6ICdJbnZhbGlkIFVybCcsDQoJaW52YWxpZFVybE1zZzogJ1RoZSBkYXNoYm9hcmQgY2FuIG5vdCBiZSBmb3VuZC4gSXQgbWF5IGhhdmUgYmVlbiBkZWxldGVkLiBZb3Ugd2lsbCBiZSByZWRpcmVjdGVkIHRvIHlvdXIgZGVmYXVsdCBkYXNoYm9hcmQuJywNCiAgICBpbnZhbGlkRGFzaGJvYXJkOiAnSW52YWxpZCBEYXNoYm9hcmQgSWQnLA0KICAgIGludmFsaWREYXNoYm9hcmRHb3RvRGVmYXVsdE1zZzogJ1RoZSBkYXNoYm9hcmQgY2FuIG5vdCBiZSBmb3VuZC4gSXQgbWF5IGhhdmUgYmVlbiBkZWxldGVkLiBZb3Ugd2lsbCBiZSByZWRpcmVjdGVkIHRvIHlvdXIgZGVmYXVsdCBkYXNoYm9hcmQuJywNCiAgICBpbnZhbGlkRGFzaGJvYXJkTXNnOiAnVGhlIGRhc2hib2FyZCBjYW4gbm90IGJlIGZvdW5kLiBJdCBtYXkgaGF2ZSBiZWVuIGRlbGV0ZWQuIFlvdSB3aWxsIGJlIHJlZGlyZWN0ZWQgdG8gdGhlIHByZXZpb3VzIGRhc2hib2FyZCcsDQoJaW52YWxpZERhc2hib2FyZE5hbWVNc2c6ICdEYXNoYm9hcmQgbmFtZSBpcyBpbnZhbGlkLiAgSXQgY2Fubm90IGluY2x1ZGUgc3RhcnQgb3IgZW5kIHdpdGggYSBzcGFjZS4nLA0KCWxlYWRpbmdPclRyYWlsaW5nV2hpdGVTcGFjZXNNc2cgOiAnTGVhZGluZyBvciB0cmFpbGluZyBzcGFjZXMgYXJvdW5kIGRhc2hib2FyZCBuYW1lIGFyZSBub3QgYWxsb3dlZCcsDQoJbG9nb3V0RXJyb3I6ICdMb2dvdXQgRXJyb3InLA0KCWxvZ291dEVycm9yTXNnOiAnUGxlYXNlIGNsb3NlIHlvdXIgYnJvd3NlciB0byBlbnN1cmUgbG9nb3V0IHN1Y2Nlc3MuJywNCgl3aWRnZXROYW1lIDogJ1dpZGdldCBOYW1lJywNCgltYXhpbXVtTGVuZ3RoIDogJ1RoZSBtYXhpbXVtIGxlbmd0aCBmb3IgdGhpcyBmaWVsZCBpcyB7MH0nLA0KCWFib3V0IDogJ0Fib3V0JywNCglhYm91dEVycm9yTXNnOiAnRXJyb3IgcmV0cmlldmluZyBhcHBsaWNhdGlvbiBpbmZvcm1hdGlvbi4nLA0KCXdpZGdldE5vdEFwcHJvdmVkOiAnVGhpcyB3aWRnZXQgaGFzIG5vdCB5ZXQgYmVlbiBhcHByb3ZlZCBmb3IgdXNlLiAgUGxlYXNlIHNlZSBhIHN5c3RlbSBhZG1pbmlzdHJhdG9yIGZvciBhcHByb3ZhbC4nLA0KICAgIHJlc3RyaWN0ZWRUYWdFcnJvcjogJyBpcyBhIHJlc3RyaWN0ZWQgdGFnLiAgWW91IG1heSBub3QgZWRpdCBpdCBvciBhZGQgaXQgdG8gb3RoZXIgd2lkZ2V0cycsDQogICAgbXBFcnJvclRpdGxlOiAnTWFya2V0cGxhY2UgRXJyb3InLA0KICAgIG1wRXJyb3JNc2c6ICdUaGVyZSBoYXMgYmVlbiBhbiBlcnJvciBhY2Nlc3NpbmcgTWFya2V0cGxhY2UuIFBsZWFzZSBjb250YWN0IHlvdXIgU3lzdGVtIEFkbWluaXN0cmF0b3IgdG8gdmVyaWZ5IHRoYXQgTWFya2V0cGxhY2UgY29ubmVjdGl2aXR5IGhhcyBiZWVuIGNvcnJlY3RseSBjb25maWd1cmVkIGFuZCB0aGF0IHRoZSBNYXJrZXRwbGFjZSBzZXJ2ZXIgaXMgY3VycmVudGx5IHJ1bm5pbmcuJywNCiAgICBvbmVTaW5nbGV0b246ICdPbmx5IG9uZSBpbnN0YW5jZSBvZiBhIFNpbmdsZXRvbiBpcyBwZXJtaXR0ZWQnDQp9Ow0KDQpPem9uZS5sYXlvdXQuTWVzc2FnZUJveEJ1dHRvblRleHQgPSB7DQoJb2s6ICdPSycsDQoJY2FuY2VsIDogJ0NhbmNlbCcsDQogICAgeWVzIDogJ1llcycsDQogICAgbm8gOiAnTm8nDQp9Ow0KDQpPem9uZS5sYXlvdXQuRGlhbG9nTWVzc2FnZXMgPSB7DQoJdXBkYXRlOiAnVXBkYXRlJywNCgl1cGRhdGluZzogJ1VwZGF0aW5nLi4uJywNCgl1cGRhdGVkOiAnVXBkYXRlZCcsDQoJYWRkOiAnQWRkJywNCglhZGRpbmcgOiAnQWRkaW5nLi4uJywNCglhZGRlZDogJ0FkZGVkJywNCglhZGRlZF9jb2xvbjogJ0FkZGVkOicsDQogICAgYWRkZWRfc3VjY2Vzc2Z1bGx5OiAnYWRkZWQgc3VjY2Vzc2Z1bGx5JywNCgljb3B5OiAnQ29weScsDQogICAgY29weWluZyA6ICdDb3B5aW5nLi4uJywNCiAgICBjb3BpZWQ6ICdDb3BpZWQnLA0KICAgIGNhbmNlbDogJ0NhbmNlbCcsDQogICAgb2s6ICdPSycsDQogICAgZXJyb3I6ICdFcnJvcicsDQogICAgYWRkV2lkZ2V0OiAnQWRkIFdpZGdldCcsDQogICAgZWRpdFdpZGdldDogJ0VkaXQgV2lkZ2V0JywNCiAgICByZW1vdmVkX2NvbG9uOiAnUmVtb3ZlZDonLA0KICAgIHJldGFpbmVkX2NvbG9uOiAnUmV0YWluZWQ6JywNCiAgICBhcHBsaWVkX2NvbG9uOiAnQXBwbGllZDonLA0KICAgIHVwZGF0ZWRfc3VjY2Vzc2Z1bGx5OiAndXBkYXRlZCBzdWNjZXNzZnVsbHknLA0KICAgIGFkZGVkX2ZvcjogJ2FkZGVkIGZvcicsDQogICAgZm9ybUludmFsaWRfQ2hlY2tGaWVsZE1lc3NhZ2VzOiAnRm9ybSBJbnZhbGlkLjxiciAvPkNoZWNrIGhpZ2hsaWdodGVkIGZpZWxkIG1lc3NhZ2VzICghKS4nLA0KICAgIGZvcm1JbnZhbGlkX1NlbGVjdE9uZVVzZXI6ICdGb3JtIEludmFsaWQuPGJyIC8+WW91IG5lZWQgdG8gc2VsZWN0IGF0IGxlYXN0IDEgdXNlci4nLA0KICAgIGZvcm1JbnZhbGlkX1NlbGVjdE9uZVdpZGdldDogJ0Zvcm0gSW52YWxpZC48YnIgLz5Zb3UgbmVlZCB0byBzZWxlY3QgYXQgbGVhc3QgMSB3aWRnZXQuJywNCiAgICB2aWV3OiAnRGFzaGJvYXJkJywNCiAgICB2aWV3X3N0YXR1czogJ0Rhc2hib2FyZCBTdGF0dXMnLA0KICAgIHZpZXdfZGFzaGJvYXJkTmFtZUZpZWxkX2xhYmVsOiAnRGFzaGJvYXJkIG5hbWUnLA0KICAgIHZpZXdfZGFzaGJvYXJkTmFtZUZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBEYXNoYm9hcmQgTmFtZScsDQogICAgdmlld19kYXNoYm9hcmRTdGF0ZUZpZWxkX2xhYmVsOiAnQ29uZmlndXJhdGlvbicsDQogICAgdmlld19kYXNoYm9hcmRTdGF0ZUZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBEYXNoYm9hcmQgQ29uZmlndXJhdGlvbicsDQogICAgdmlld19kYXNoYm9hcmRHdWlkRmllbGRfbGFiZWw6ICdHVUlEJywNCiAgICB2aWV3X2Rhc2hib2FyZExheW91dEZpZWxkX2xhYmVsOiAnTGF5b3V0JywNCiAgICB2aWV3X2Rhc2hib2FyZElzRGVmYXVsdEZpZWxkX2xhYmVsOiAnRGVmYXVsdCcsDQogICAgZm9ybUVycm9yX3NhdmVWaWV3OiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYXR0ZW1wdGluZyB0byBzYXZlIGEgZGFzaGJvYXJkLicsDQogICAgdXNlcjogJ1VzZXInLA0KICAgIHVzZXJzX29wdDogJ3VzZXIocyknLA0KICAgIHVzZXJfc3RhdHVzOiAnVXNlciBTdGF0dXMnLA0KICAgIHVzZXJfdXNlcm5hbWVGaWVsZF9sYWJlbDogJ1VzZXIgSUQnLA0KICAgIHVzZXJfdXNlcm5hbWVGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgVXNlciBJRCcsDQogICAgdXNlcl91c2VyUmVhbE5hbWVGaWVsZF9sYWJlbDogJ05hbWUnLCANCiAgICB1c2VyX3VzZXJSZWFsTmFtZUZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBuYW1lIGZvciB0aGUgdXNlcicsDQogICAgZm9ybUVycm9yX3NhdmVVc2VyOiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYXR0ZW1wdGluZyB0byBzYXZlIGEgdXNlci4nLA0KICAgIHByZWZlcmVuY2U6ICdQcmVmZXJlbmNlJywNCiAgICBwcmVmZXJlbmNlX3ByZWZlcmVuY2VOYW1lRmllbGRfbGFiZWw6ICdQcmVmZXJlbmNlIE5hbWUnLA0KICAgIHByZWZlcmVuY2VfcHJlZmVyZW5jZU5hbWVGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgUHJlZmVyZW5jZSBOYW1lJywNCiAgICBwcmVmZXJlbmNlX3ByZWZlcmVuY2VOYW1lc3BhY2VGaWVsZF9sYWJlbDogJ05hbWVzcGFjZScsDQogICAgcHJlZmVyZW5jZV9wcmVmZXJlbmNlTmFtZXNwYWNlRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIFByZWZlcmVuY2UgTmFtZXNwYWNlJywNCiAgICBwcmVmZXJlbmNlX3ByZWZlcmVuY2VWYWx1ZUZpZWxkX2xhYmVsOiAnVmFsdWUnLA0KICAgIHByZWZlcmVuY2VfcHJlZmVyZW5jZVZhbHVlRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIFByZWZlcmVuY2UgVmFsdWUnLA0KICAgIHByZWZlcmVuY2Vfc3RhdHVzOiAnUHJlZmVyZW5jZSBTdGF0dXMnLA0KICAgIGZvcm1FcnJvcl9zYXZlUHJlZmVyZW5jZTogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGF0dGVtcHRpbmcgdG8gc2F2ZSBhIHByZWZlcmVuY2UuJywNCiAgICB3aWRnZXREZWZpbml0aW9uOiAnV2lkZ2V0IERlZmluaXRpb24nLA0KICAgIHdpZGdldERlZmluaXRpb25fc3RhdHVzOiAnV2lkZ2V0IFN0YXR1cycsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWRnZXRBY2Nlc3M6ICdXaWRnZXQgQWNjZXNzJywNCiAgICB3aWRnZXREZWZpbml0aW9uX2Rlc2NyaXB0b3JVcmxGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgV2lkZ2V0IERlc2NyaXB0b3IgVVJMJywNCiAgICB3aWRnZXREZWZpbml0aW9uX2Rpc3BsYXlOYW1lRmllbGRfbGFiZWw6ICdXaWRnZXQgTmFtZScsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWRnZXRWZXJzaW9uRmllbGRfbGFiZWw6ICdWZXJzaW9uJywNCiAgICB3aWRnZXREZWZpbml0aW9uX2Rpc3BsYXlOYW1lRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIFdpZGdldCBOYW1lJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZGdldFZlcnNpb25GaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgV2lkZ2V0IFZlcnNpb24nLA0KICAgIHdpZGdldERlZmluaXRpb25fd2lkZ2V0R3VpZEZpZWxkX2xhYmVsOiAnR1VJRCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWRnZXRVcmxGaWVsZF9sYWJlbDogJ1VSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWRnZXRVcmxGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgV2lkZ2V0IFVSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9pbWFnZVVybFNtYWxsRmllbGRfbGFiZWw6ICdDb250YWluZXIgSWNvbiBVUkwnLA0KICAgIHdpZGdldERlZmluaXRpb25faW1hZ2VVcmxTbWFsbEZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBDb250YWluZXIgSWNvbiBVUkwnLA0KICAgIHdpZGdldERlZmluaXRpb25faW1hZ2VMYXJnZVVybEZpZWxkX2xhYmVsOiAnTGF1bmNoIE1lbnUgSWNvbiBVUkwnLA0KICAgIHdpZGdldERlZmluaXRpb25faW1hZ2VMYXJnZVVybEZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBMYXVuY2ggTWVudSBJY29uIFVSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWR0aE51bWJlckZpZWxkX2xhYmVsOiAnV2lkdGgnLA0KICAgIHdpZGdldERlZmluaXRpb25fd2lkdGhOdW1iZXJGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgV2lkZ2V0IHdpZHRoJywNCiAgICB3aWRnZXREZWZpbml0aW9uX2hlaWdodE51bWJlckZpZWxkX2xhYmVsOiAnSGVpZ2h0JywNCiAgICB3aWRnZXREZWZpbml0aW9uX2hlaWdodE51bWJlckZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBXaWRnZXQgaGVpZ2h0JyAsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9zZWN1cmVVcmxfd2FybmluZ1RleHQ6ICdFbnRlcmluZyBhIHNlY3VyZSBIVFRQUyBhZGRyZXNzIG1heSBwcmV2ZW50IGJyb3dzZXIgc2VjdXJpdHkgd2FybmluZ3Mgc3VjaCBhcyAiVGhpcyBwYWdlIGNvbnRhaW5zIHVuc2VjdXJlIGNvbnRlbnQuIicgLA0KICAgIHBlcnNvbldpZGdldERlZl9BcHBseTogJ0FwcGx5JywNCiAgICBwZXJzb25XaWRnZXREZWZfT3JkZXI6ICdPcmRlcicsDQogICAgcGVyc29uV2lkZ2V0RGVmX1dpZGdldDogJ1dpZGdldCcsDQogICAgcGVyc29uV2lkZ2V0RGVmX1dpZGdldEFjY2Vzc0FwcGxpZWQ6ICdXaWRnZXQgQWNjZXNzIEFwcGxpZWQnLA0KICAgIHBlcnNvbldpZGdldERlZl9BcHBseVN0YXR1czogJ0FwcGx5IFN0YXR1cycsDQogICAgcGVyc29uV2lkZ2V0RGVmX05vQ2hhbmdlc05lY2Vzc2FyeTogJ05vIGNoYW5nZXMgd2VyZSBuZWNlc3NhcnknLCANCiAgICBmb3JtRXJyb3Jfc2F2ZVBlcnNvbkRlZldpZGdldHM6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIHNhdmUgdXNlciB3aWRnZXQocykuJywNCiAgICBmb3JtRXJyb3Jfc2F2ZVdpZGdldERlZmluaXRpb246ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIHNhdmUgdGhlIHdpZGdldC4nLA0KICAgIHBlcnNvbldpZGdldERlZl9XaWRnZXRDb250YWluZXJQYW5lbFRpdGxlOiAnV2lkZ2V0cycsDQoJbWFya2V0cGxhY2VXaW5kb3dfQWRkV2lkZ2V0OiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYXR0ZW1wdGluZyB0byBhZGQgdGhlIHdpZGdldCBmcm9tIE1hcmtldHBsYWNlLicsDQoJbWFya2V0cGxhY2VXaW5kb3dfY3VycmVudFVzZXI6ICdDb3VsZCBub3QgcmV0cmlldmUgY3VycmVudCB1c2VyIG5hbWUgYW5kIGlkLicsDQogICAgbWFya2V0cGxhY2VXaW5kb3dfQWRkU3VjY2Vzc2Z1bDogJ1RoZSB3aWRnZXQgd2FzIGFkZGVkIHN1Y2Nlc3NmdWxseSBmcm9tIE1hcmtldHBsYWNlJywNCgl3aWRnZXRBZGRlZDogJ1NlbGVjdGVkIHdpZGdldCBpcyBhbHJlYWR5IGFkZGVkIGZvciB0aGlzIHVzZXInLA0KCW1hcmtldHBsYWNlV2luZG93X1JlcXVpcmVkTGlzdGluZ3NBbGVydE1zZzogJ1RoZSB3aWRnZXQgeW91IGhhdmUgbGF1bmNoZWQgd2lsbCBub3Qgd29yayB3aXRob3V0IHNvbWUgZGVwZW5kZW5jaWVzLiAgVGhlc2Ugd2lkZ2V0cyBhcmUgbGlzdGVkIGJlbG93IGFuZCB3aWxsIGJlIGFkZGl0aW9uYWxseSBhZGRlZCB0byB0aGUgbGF1bmNoIG1lbnUuJywNCiAgICBmaXRQYW5lRnVsbFdhcm5pbmc6ICdZb3UgYXJlIGF0dGVtcHRpbmcgdG8gYWRkIGEgd2lkZ2V0IHRvIGEgcGFuZSB3aXRoIGEgc2luZ2xlLXdpZGdldCBsYXlvdXQuIENvbnRpbnVpbmcgd2lsbCByZXBsYWNlIHRoZSBleGlzdGluZyB3aWRnZXQuJywNCiAgICBkYXNoYm9hcmRMb2NrVGl0bGU6ICdMb2NrIERhc2hib2FyZCcsDQogICAgZGFzaGJvYXJkTG9ja1dhcm5pbmc6ICdMb2NraW5nIHRoaXMgZGFzaGJvYXJkIGRpc2FibGVzIHRoZSBMYXVuY2ggTWVudS4gTmV3IHdpZGdldHMgY2Fubm90IGJlIGxhdW5jaGVkIG9yIGFkZGVkIHRvIHRoaXMgbGF5b3V0LiBEbyB5b3Ugc3RpbGwgd2FudCB0byBsb2NrIHRoaXMgZGFzaGJvYXJkPycsDQogICAgZGFzaGJvYXJkTG9ja0FsZXJ0VGl0bGU6ICdMb2NrZWQgRGFzaGJvYXJkJywNCiAgICBkYXNoYm9hcmRMb2NrQWxlcnQ6ICdUaGlzIGRhc2hib2FyZCBpcyBsb2NrZWQuIFdpZGdldHMgY2Fubm90IGJlIGFkZGVkIG9yIHJlbW92ZWQgZnJvbSBhIGxvY2tlZCBkYXNoYm9hcmQuJywNCiAgICBjbG9zZUJhY2tncm91bmRXaWRnZXRXYXJuaW5nOiAnIGlzIGEgYmFja2dyb3VuZCB3aWRnZXQuIFlvdSB3b27igJl0IHNlZSBpdCBvbiB5b3VyIHNjcmVlbiBiZWNhdXNlIGl0IHJ1bnMgYmVoaW5kIHRoZSBzY2VuZXMuPGJyLz48YnIvPlRvIGNsb3NlIHRoZSB3aWRnZXQsIGNsaWNrIE9LLicNCn07DQoNCk96b25lLmxheW91dC5UaGVtZVN3aXRjaGVyV2luZG93Q29uc3RhbnRzID0gew0KICAgIHRpdGxlOiAnVGhlbWUgU2V0dGluZ3MnLA0KICAgIGhlYWRlcjogJ0NoYW5nZSB0aGUgc3R5bGluZyBvZiB5b3VyIE9XRicsDQogICAgc3ViaGVhZGVyOiAnU2VsZWN0IGEgdGhlbWUgYmVsb3cgdG8gY2hhbmdlIHRoZSBiYWNrZ3JvdW5kLCB3aW5kb3cgY29sb3IsIGFuZCBzdHlsZSBmb3IgT1dGLicsDQogICAgb2s6ICdPSycsDQogICAgY2FuY2VsOiAnQ2FuY2VsJw0KfTsNCgovKioNCiAqIFZlcnNpb246IDEuMCBBbHBoYS0xIA0KICogQnVpbGQgRGF0ZTogMTMtTm92LTIwMDcNCiAqIENvcHlyaWdodCAoYykgMjAwNi0yMDA3LCBDb29saXRlIEluYy4gKGh0dHA6Ly93d3cuY29vbGl0ZS5jb20vKS4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqIExpY2Vuc2U6IExpY2Vuc2VkIHVuZGVyIFRoZSBNSVQgTGljZW5zZS4gU2VlIGxpY2Vuc2UudHh0IGFuZCBodHRwOi8vd3d3LmRhdGVqcy5jb20vbGljZW5zZS8uIA0KICogV2Vic2l0ZTogaHR0cDovL3d3dy5kYXRlanMuY29tLyBvciBodHRwOi8vd3d3LmNvb2xpdGUuY29tL2RhdGVqcy8NCiAqLw0KRGF0ZS5DdWx0dXJlSW5mbyA9IHsKCS8qIEN1bHR1cmUgTmFtZSAqLwogICAgbmFtZTogImVuLVVTIiwKICAgIGVuZ2xpc2hOYW1lOiAiRW5nbGlzaCAoVW5pdGVkIFN0YXRlcykiLAogICAgbmF0aXZlTmFtZTogIkVuZ2xpc2ggKFVuaXRlZCBTdGF0ZXMpIiwKICAgIAogICAgLyogRGF5IE5hbWUgU3RyaW5ncyAqLwogICAgZGF5TmFtZXM6IFsiU3VuZGF5IiwgIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiXSwKICAgIGFiYnJldmlhdGVkRGF5TmFtZXM6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sCiAgICBzaG9ydGVzdERheU5hbWVzOiBbIlN1IiwgIk1vIiwgIlR1IiwgIldlIiwgIlRoIiwgIkZyIiwgIlNhIl0sCiAgICBmaXJzdExldHRlckRheU5hbWVzOiBbIlMiLCAiTSIsICJUIiwgIlciLCAiVCIsICJGIiwgIlMiXSwKICAgIAogICAgLyogTW9udGggTmFtZSBTdHJpbmdzICovCiAgICBtb250aE5hbWVzOiBbIkphbnVhcnkiLCAiRmVicnVhcnkiLCAiTWFyY2giLCAiQXByaWwiLCAiTWF5IiwgIkp1bmUiLCAiSnVseSIsICJBdWd1c3QiLCAiU2VwdGVtYmVyIiwgIk9jdG9iZXIiLCAiTm92ZW1iZXIiLCAiRGVjZW1iZXIiXSwKICAgIGFiYnJldmlhdGVkTW9udGhOYW1lczogWyJKYW4iLCAiRmViIiwgIk1hciIsICJBcHIiLCAiTWF5IiwgIkp1biIsICJKdWwiLCAiQXVnIiwgIlNlcCIsICJPY3QiLCAiTm92IiwgIkRlYyJdLAoKCS8qIEFNL1BNIERlc2lnbmF0b3JzICovCiAgICBhbURlc2lnbmF0b3I6ICJBTSIsCiAgICBwbURlc2lnbmF0b3I6ICJQTSIsCgogICAgZmlyc3REYXlPZldlZWs6IDAsCiAgICB0d29EaWdpdFllYXJNYXg6IDIwMjksCiAgICAKICAgIC8qKgogICAgICogVGhlIGRhdGVFbGVtZW50T3JkZXIgaXMgYmFzZWQgb24gdGhlIG9yZGVyIG9mIHRoZSAKICAgICAqIGZvcm1hdCBzcGVjaWZpZXJzIGluIHRoZSBmb3JtYXRQYXR0ZXJucy5EYXRlUGF0dGVybi4gCiAgICAgKgogICAgICogRXhhbXBsZToKICAgICA8cHJlPgogICAgIHNob3J0RGF0ZVBhdHRlcm4gICAgZGF0ZUVsZW1lbnRPcmRlcgogICAgIC0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLSAKICAgICAiTS9kL3l5eXkiICAgICAgICAgICJtZHkiCiAgICAgImRkL01NL3l5eXkiICAgICAgICAiZG15IgogICAgICJ5eXl5LU1NLWRkIiAgICAgICAgInltZCIKICAgICA8L3ByZT4KICAgICAqIFRoZSBjb3JyZWN0IGRhdGVFbGVtZW50T3JkZXIgaXMgcmVxdWlyZWQgYnkgdGhlIHBhcnNlciB0bwogICAgICogZGV0ZXJtaW5lIHRoZSBleHBlY3RlZCBvcmRlciBvZiB0aGUgZGF0ZSBlbGVtZW50cyBpbiB0aGUKICAgICAqIHN0cmluZyBiZWluZyBwYXJzZWQuCiAgICAgKiAKICAgICAqIE5PVEU6IEl0IGlzIFZFUlkgaW1wb3J0YW50IHRoaXMgdmFsdWUgYmUgY29ycmVjdCBmb3IgZWFjaCBDdWx0dXJlLgogICAgICovCiAgICBkYXRlRWxlbWVudE9yZGVyOiAibWR5IiwKICAgIAogICAgLyogU3RhbmRhcmQgZGF0ZSBhbmQgdGltZSBmb3JtYXQgcGF0dGVybnMgKi8KICAgIGZvcm1hdFBhdHRlcm5zOiB7CiAgICAgICAgc2hvcnREYXRlOiAiTS9kL3l5eXkiLAogICAgICAgIGxvbmdEYXRlOiAiZGRkZCwgTU1NTSBkZCwgeXl5eSIsCiAgICAgICAgc2hvcnRUaW1lOiAiaDptbSB0dCIsCiAgICAgICAgbG9uZ1RpbWU6ICJoOm1tOnNzIHR0IiwKICAgICAgICBmdWxsRGF0ZVRpbWU6ICJkZGRkLCBNTU1NIGRkLCB5eXl5IGg6bW06c3MgdHQiLAogICAgICAgIHNvcnRhYmxlRGF0ZVRpbWU6ICJ5eXl5LU1NLWRkVEhIOm1tOnNzIiwKICAgICAgICB1bml2ZXJzYWxTb3J0YWJsZURhdGVUaW1lOiAieXl5eS1NTS1kZCBISDptbTpzc1oiLAogICAgICAgIHJmYzExMjM6ICJkZGQsIGRkIE1NTSB5eXl5IEhIOm1tOnNzIEdNVCIsCiAgICAgICAgbW9udGhEYXk6ICJNTU1NIGRkIiwKICAgICAgICB5ZWFyTW9udGg6ICJNTU1NLCB5eXl5IgogICAgfSwKCiAgICAvKioKICAgICAqIE5PVEU6IElmIGEgc3RyaW5nIGZvcm1hdCBpcyBub3QgcGFyc2luZyBjb3JyZWN0bHksIGJ1dAogICAgICogeW91IHdvdWxkIGV4cGVjdCBpdCBwYXJzZSwgdGhlIHByb2JsZW0gbGlrZWx5IGxpZXMgYmVsb3cuIAogICAgICogCiAgICAgKiBUaGUgZm9sbG93aW5nIHJlZ2V4IHBhdHRlcm5zIGNvbnRyb2wgbW9zdCBvZiB0aGUgc3RyaW5nIG1hdGNoaW5nCiAgICAgKiB3aXRoaW4gdGhlIHBhcnNlci4KICAgICAqIAogICAgICogVGhlIE1vbnRoIG5hbWUgYW5kIERheSBuYW1lIHBhdHRlcm5zIHdlcmUgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQKICAgICAqIGFuZCBpbiBnZW5lcmFsIHNob3VsZCBiZSAobW9zdGx5KSBjb3JyZWN0LiAKICAgICAqCiAgICAgKiBCZXlvbmQgdGhlIG1vbnRoIGFuZCBkYXkgbmFtZSBwYXR0ZXJucyBhcmUgbmF0dXJhbCBsYW5ndWFnZSBzdHJpbmdzLgogICAgICogRXhhbXBsZTogIm5leHQiLCAidG9kYXkiLCAibW9udGhzIgogICAgICoKICAgICAqIFRoZXNlIG5hdHVyYWwgbGFuZ3VhZ2Ugc3RyaW5nIG1heSBOT1QgYmUgY29ycmVjdCBmb3IgdGhpcyBjdWx0dXJlLiAKICAgICAqIElmIHRoZXkgYXJlIG5vdCBjb3JyZWN0LCBwbGVhc2UgdHJhbnNsYXRlIGFuZCBlZGl0IHRoaXMgZmlsZQogICAgICogcHJvdmlkaW5nIHRoZSBjb3JyZWN0IHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJuLiAKICAgICAqCiAgICAgKiBJZiB5b3UgbW9kaWZ5IHRoaXMgZmlsZSwgcGxlYXNlIHBvc3QgeW91ciByZXZpc2VkIEN1bHR1cmVJbmZvIGZpbGUKICAgICAqIHRvIHRoZSBEYXRlanMgRGlzY3Vzc2lvbnMgbG9jYXRlZCBhdAogICAgICogICAgIGh0dHA6Ly9ncm91cHMuZ29vZ2xlLmNvbS9ncm91cC9kYXRlLWpzCiAgICAgKgogICAgICogUGxlYXNlIG1hcmsgdGhlIHN1YmplY3Qgd2l0aCBbQ3VsdHVyZUluZm9dLiBFeGFtcGxlOgogICAgICogICAgU3ViamVjdDogW0N1bHR1cmVJbmZvXSBUcmFuc2xhdGVkICJkYS1ESyIgRGFuaXNoKERlbm1hcmspCiAgICAgKiAKICAgICAqIFdlIHdpbGwgYWRkIHRoZSBtb2RpZmllZCBwYXR0ZXJucyB0byB0aGUgbWFzdGVyIHNvdXJjZSBmaWxlcy4KICAgICAqCiAgICAgKiBBcyB3ZWxsLCBwbGVhc2UgcmV2aWV3IHRoZSBsaXN0IG9mICJGdXR1cmUgU3RyaW5ncyIgc2VjdGlvbiBiZWxvdy4gCiAgICAgKi8JCiAgICByZWdleFBhdHRlcm5zOiB7CiAgICAgICAgamFuOiAvXmphbih1YXJ5KT8vaSwKICAgICAgICBmZWI6IC9eZmViKHJ1YXJ5KT8vaSwKICAgICAgICBtYXI6IC9ebWFyKGNoKT8vaSwKICAgICAgICBhcHI6IC9eYXByKGlsKT8vaSwKICAgICAgICBtYXk6IC9ebWF5L2ksCiAgICAgICAganVuOiAvXmp1bihlKT8vaSwKICAgICAgICBqdWw6IC9eanVsKHkpPy9pLAogICAgICAgIGF1ZzogL15hdWcodXN0KT8vaSwKICAgICAgICBzZXA6IC9ec2VwKHQoZW1iZXIpPyk/L2ksCiAgICAgICAgb2N0OiAvXm9jdChvYmVyKT8vaSwKICAgICAgICBub3Y6IC9ebm92KGVtYmVyKT8vaSwKICAgICAgICBkZWM6IC9eZGVjKGVtYmVyKT8vaSwKCiAgICAgICAgc3VuOiAvXnN1KG4oZGF5KT8pPy9pLAogICAgICAgIG1vbjogL15tbyhuKGRheSk/KT8vaSwKICAgICAgICB0dWU6IC9edHUoZShzKGRheSk/KT8pPy9pLAogICAgICAgIHdlZDogL153ZShkKG5lc2RheSk/KT8vaSwKICAgICAgICB0aHU6IC9edGgodShyKHMoZGF5KT8pPyk/KT8vaSwKICAgICAgICBmcmk6IC9eZnIoaShkYXkpPyk/L2ksCiAgICAgICAgc2F0OiAvXnNhKHQodXJkYXkpPyk/L2ksCgogICAgICAgIGZ1dHVyZTogL15uZXh0L2ksCiAgICAgICAgcGFzdDogL15sYXN0fHBhc3R8cHJldihpb3VzKT8vaSwKICAgICAgICBhZGQ6IC9eKFwrfGFmdGVyfGZyb20pL2ksCiAgICAgICAgc3VidHJhY3Q6IC9eKFwtfGJlZm9yZXxhZ28pL2ksCiAgICAgICAgCiAgICAgICAgeWVzdGVyZGF5OiAvXnllc3RlcmRheS9pLAogICAgICAgIHRvZGF5OiAvXnQob2RheSk/L2ksCiAgICAgICAgdG9tb3Jyb3c6IC9edG9tb3Jyb3cvaSwKICAgICAgICBub3c6IC9ebihvdyk/L2ksCiAgICAgICAgCiAgICAgICAgbWlsbGlzZWNvbmQ6IC9ebXN8bWlsbGkoc2Vjb25kKT9zPy9pLAogICAgICAgIHNlY29uZDogL15zZWMob25kKT9zPy9pLAogICAgICAgIG1pbnV0ZTogL15taW4odXRlKT9zPy9pLAogICAgICAgIGhvdXI6IC9eaChvdSk/cnM/L2ksCiAgICAgICAgd2VlazogL153KGVlKT9rL2ksCiAgICAgICAgbW9udGg6IC9ebShvKG50aCk/cz8pPy9pLAogICAgICAgIGRheTogL15kKGF5cz8pPy9pLAogICAgICAgIHllYXI6IC9eeSgoZWEpP3JzPyk/L2ksCgkJCiAgICAgICAgc2hvcnRNZXJpZGlhbjogL14oYXxwKS9pLAogICAgICAgIGxvbmdNZXJpZGlhbjogL14oYVwuP20/XC4/fHBcLj9tP1wuPykvaSwKICAgICAgICB0aW1lem9uZTogL14oKGUoc3xkKXR8YyhzfGQpdHxtKHN8ZCl0fHAoc3xkKXQpfCgoZ210KT9ccyooXCt8XC0pXHMqXGRcZFxkXGQ/KXxnbXQpL2ksCiAgICAgICAgb3JkaW5hbFN1ZmZpeDogL15ccyooc3R8bmR8cmR8dGgpL2ksCiAgICAgICAgdGltZUNvbnRleHQ6IC9eXHMqKFw6fGF8cCkvaQogICAgfSwKCiAgICBhYmJyZXZpYXRlZFRpbWVab25lU3RhbmRhcmQ6IHsgR01UOiAiLTAwMCIsIEVTVDogIi0wNDAwIiwgQ1NUOiAiLTA1MDAiLCBNU1Q6ICItMDYwMCIsIFBTVDogIi0wNzAwIiB9LAogICAgYWJicmV2aWF0ZWRUaW1lWm9uZURTVDogeyBHTVQ6ICItMDAwIiwgRURUOiAiLTA1MDAiLCBDRFQ6ICItMDYwMCIsIE1EVDogIi0wNzAwIiwgUERUOiAiLTA4MDAiIH0KICAgIAp9OwoKLyoqKioqKioqKioqKioqKioqKioqCiAqKiBGdXR1cmUgU3RyaW5ncyAqKgogKioqKioqKioqKioqKioqKioqKioKICogCiAqIFRoZSBmb2xsb3dpbmcgbGlzdCBvZiBzdHJpbmdzIGFyZSBub3QgY3VycmVudGx5IGJlaW5nIHVzZWQsIGJ1dCAKICogbWF5IGJlIGluY29ycG9yYXRlZCBsYXRlci4gV2Ugd291bGQgYXBwcmVjaWF0ZSBhbnkgaGVscCB0cmFuc2xhdGluZwogKiB0aGUgc3RyaW5ncyBiZWxvdy4KICogCiAqIElmIHlvdSBtb2RpZnkgdGhpcyBmaWxlLCBwbGVhc2UgcG9zdCB5b3VyIHJldmlzZWQgQ3VsdHVyZUluZm8gZmlsZQogKiB0byB0aGUgRGF0ZWpzIERpc2N1c3Npb25zIGxvY2F0ZWQgYXQKICogICAgIGh0dHA6Ly9ncm91cHMuZ29vZ2xlLmNvbS9ncm91cC9kYXRlLWpzCiAqCiAqIFBsZWFzZSBtYXJrIHRoZSBzdWJqZWN0IHdpdGggW0N1bHR1cmVJbmZvXS4gRXhhbXBsZToKICogICAgU3ViamVjdDogW0N1bHR1cmVJbmZvXSBUcmFuc2xhdGVkICJkYS1ESyIgRGFuaXNoKERlbm1hcmspCiAqCiAqIEVuZ2xpc2ggTmFtZSAgICAgICAgVHJhbnNsYXRlZAogKiAtLS0tLS0tLS0tLS0tLS0tLS0gIC0tLS0tLS0tLS0tLS0tLS0tCiAqIGRhdGUgICAgICAgICAgICAgICAgZGF0ZQogKiB0aW1lICAgICAgICAgICAgICAgIHRpbWUKICogY2FsZW5kYXIgICAgICAgICAgICBjYWxlbmRhcgogKiBzaG93ICAgICAgICAgICAgICAgIHNob3cKICogaG91cmx5ICAgICAgICAgICAgICBob3VybHkKICogZGFpbHkgICAgICAgICAgICAgICBkYWlseQogKiB3ZWVrbHkgICAgICAgICAgICAgIHdlZWtseQogKiBiaS13ZWVrbHkgICAgICAgICAgIGJpLXdlZWtseQogKiBtb250aGx5ICAgICAgICAgICAgIG1vbnRobHkKICogYmktbW9udGhseSAgICAgICAgICBiaS1tb250aGx5CiAqIHF1YXJ0ZXIgICAgICAgICAgICAgcXVhcnRlcgogKiBxdWFydGVybHkgICAgICAgICAgIHF1YXJ0ZXJseQogKiB5ZWFybHkgICAgICAgICAgICAgIHllYXJseQogKiBhbm51YWwgICAgICAgICAgICAgIGFubnVhbAogKiBhbm51YWxseSAgICAgICAgICAgIGFubnVhbGx5CiAqIGFubnVtICAgICAgICAgICAgICAgYW5udW0KICogYWdhaW4gICAgICAgICAgICAgICBhZ2FpbgogKiBiZXR3ZWVuICAgICAgICAgICAgIGJldHdlZW4KICogYWZ0ZXIgICAgICAgICAgICAgICBhZnRlcgogKiBmcm9tIG5vdyAgICAgICAgICAgIGZyb20gbm93CiAqIHJlcGVhdCAgICAgICAgICAgICAgcmVwZWF0CiAqIHRpbWVzICAgICAgICAgICAgICAgdGltZXMKICogcGVyICAgICAgICAgICAgICAgICBwZXIKICovDQoKdmFyIE96b25lID0gT3pvbmUgfHwge307Ck96b25lLnV0aWwgPSBPem9uZS51dGlsIHx8IHt9OwoKCi8qKgogKiBAY2xhc3MKICogQHByaXZhdGUKICoKICogQGRlc2NyaXB0aW9uCiAqIE9iamVjdCB1c2VkIHRvIHRhbGsgdG8gdGhlIGNyb3NzIGRvbWFpbiBhbmQgbG9jYWxseS4gIElmIHRoZSBzZXJ2ZXIgaXMgbG9jYWwsCiAqIHRoZW4gQUpBWCB3aWxsIGJlIHVzZWQuICBJZiB0aGUgc2VydmVyIGlzIHJlbW90ZSwgdGhlbiB3ZSBtdXN0IHVzZSBhCiAqIGhhY2sgdG8gZ2V0IGFyb3VuZCBTYW1lIE9yaWdpbiBQb2xpY3kgYW5kIG1ha2UgdGhlIGNhbGwgY3Jvc3MgZG9tYWluLgogKgogKiBAcmVxdWlyZXMgdXRpbC5qcwogKi8KT3pvbmUudXRpbC5UcmFuc3BvcnQgPSB7CiAgICB2ZXJzaW9uOiBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLnByZWZlcmVuY2UKfTsKCgovKioKICogQHByaXZhdGUKICoKICogQHBhcmFtcyAgY2ZnLnVybCAgICAgICAgICAgICAgIC0gIHVybCBvZiB0aGUgcmVxdWVzdAogKiAgICAgICAgICBjZmcubWV0aG9kICAgICAgICAgICAgLSAgSFRUUCB2ZXJiIChvbmx5IFBPU1Qgb3IgR0VULCB1c2UgX21ldGhvZCA9IFBVVCBvciBERUxFVEUgd2l0aCBhIFBPU1QgKQogKiAgICAgICAgICBjZmcub25TdWNjZXNzICAgICAgICAgLSAgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQKICogICAgICAgICAgY2ZnLm9uRmFpbHVyZSAgICAgICAgIC0gIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IKICogICAgICAgICAgY2ZnLmNvbnRlbnQgICAgICAgICAgIC0gIG9wdGlvbmFsIGNvbnRlbnQgdG8gc2VuZCB3aXRoIHRoZSByZXF1ZXN0LCBpZSB7dmFsdWU6ICd4JywgX21ldGhvZDogJ1BVVCd9CiAqICAgICAgICAgIGNmZy5hc3luYwkJCSAgLSAgb3B0aW9uYWwgKGRlZmF1bHQgaXMgdHJ1ZSwgYXN5bmNocm9ub3VzIHNlbmQsIG9ubHkgYXBwbGllcyB0byBBamF4IGNhbGwpCiAqICAgICAgICAgIGNmZy5oYW5kbGVBcyAgICAgICAgICAtIHRleHQgb3IganNvbgogKiAgICAgICAgICBjZmcuYXV0b1NlbmRWZXJzaW9uICAgLSAgdHJ1ZSB0byBzZW5kIG93ZiB2ZXJzaW9uIHRvIHRoZSBzZXJ2ZXIsIGZhbHNlIGRvbid0IHNlbmQgKGRlZmF1bHRzIHRvIHRydWUpCiAqICAgICAgICAgIGNmZy5pZ25vcmVkRXJyb3JDb2RlcyAtICBvcHRpb25hbCBhcnJheSBvZiBodHRwIGVycm9yIGNvZGVzIHRvIGlnbm9yZSAoaWYgdGhlc2UgaGFwcGVuIG9uU3VjZXNzIHdpbGwgYmUgY2FsbGVkKQogKiAgICAgICAgICBjZmcuZm9yY2VYZG9tYWluICAgICAgLSAgb3B0aW9uYWwgZmxhZyB0byBmb3JjZSB4ZG9tYWluIGFqYXggY2FsbCB1c2luZyBkb2pvIHdpbmRvdy5uYW1lCiAqCiAqICBAcmV0dXJucyB2b2lkLCB1c2UgY2FsbGJhY2tzCiAqCiAqICBTdGF0aWMgbWV0aG9kLiAgTXVzdCB1c2UgMiBjYWxsYmFja3Mgc2luY2UgamF2YXNjcmlwdCBpcyBhc3luY3Jvbm91cwogKiAgd2UgaGF2ZSB0byB3YWl0IGZvciB0aGUgcmVzcG9uc2UuCiAqCiAqICBUaGlzIGltcGxlbWVudGF0aW9uIHVzZXMgdGhlIGRvam94LndpbmRvd05hbWUgaGFjayBmb3IgYSByZW1vdGUgc2VydmVyLAogICogYnV0IGNvdWxkIGJlIHJlcGxhY2VkIHdpdGggc29tZXRoaW5nIGVsc2UgbGlrZSBKU09OUCBpZiBkZXNpcmVkCiAqLwpPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kID0gZnVuY3Rpb24oY2ZnKSB7CiAgICBpZiAoT3pvbmUubG9nKSB7CiAgICAgICAgT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIoKS5kZWJ1ZygnVHJhbnNwb3J0IFNlbmQnLCBjZmcudXJsLCBjZmcubWV0aG9kLCBjZmcuY29udGVudCk7CiAgICB9CgogICAgdmFyIGRlZmF1bHRGYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgLy8gSWYgZXJyb3IgaXMgYW4gSFRNTCBwYWdlLCBqdXN0IHVzZSBib2R5CiAgICAgICAgaWYgKGVyciA9PSB1bmRlZmluZWQgfHwgZXJyID09IG51bGwpIGVyciA9ICIiOwogICAgICAgIHZhciBzdGFydCA9IGVyci5pbmRleE9mKCI8Ym9keSIpOwogICAgICAgIGlmIChzdGFydCA+IC0xKSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IGF0IHRoZSBlbmQgb2YgdGhlIGJvZHkgdGFnCiAgICAgICAgICAgIHN0YXJ0ID0gZXJyLmluZGV4T2YoIj4iLCBzdGFydCkgKyAxOwogICAgICAgICAgICB2YXIgc3RvcCA9IGVyci5pbmRleE9mKCI8L2JvZHk+Iiwgc3RhcnQpOwoKICAgICAgICAgICAgaWYgKHN0b3AgPiAtMSkgZXJyID0gZXJyLnN1YnN0cmluZyhzdGFydCwgc3RvcCk7CiAgICAgICAgICAgIGVsc2UgZXJyID0gZXJyLnN1YnN0cmluZyhzdGFydCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIU96b25lLk1zZykKICAgICAgICAgICAgT3pvbmUudXRpbC5FcnJvckRsZy5zaG93KGVyciwyMDAsNTApOwogICAgICAgIGVsc2UKICAgICAgICAgICAgT3pvbmUuTXNnLmFsZXJ0KCdTZXJ2ZXIgRXJyb3InLGVycixudWxsLHRoaXMsewogICAgICAgICAgICAgICAgY2xzOiAib3dmQWxlcnQiCiAgICAgICAgICAgIH0pOwogICAgfTsKCiAgICAvLyBjcmVhdGUgYW4gb25GYWlsdXJlIG1ldGhvZCBpZiBvbmUgZG9lc24ndCBleGlzdAogICAgaWYgKCFjZmcub25GYWlsdXJlKSB7CiAgICAgICAgY2ZnLm9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycil7CiAgICAgICAgICAgIGRlZmF1bHRGYWlsdXJlKGVycik7CiAgICAgICAgfTsKICAgIH0KCiAgICB2YXIgbWV0aG9kVG9Vc2UgPSBjZmcubWV0aG9kOwogICAgdmFyIGhhc0JvZHkgPSBmYWxzZTsKICAgIGlmIChtZXRob2RUb1VzZSA9PSAiUFVUIiB8fCBtZXRob2RUb1VzZSA9PSAiREVMRVRFIikKICAgIHsKICAgICAgICBtZXRob2RUb1VzZSA9ICJQT1NUIjsKICAgIH0KCiAgICBpZiAobWV0aG9kVG9Vc2UgPT0gIlBPU1QiKSB7CiAgICAgICAgaGFzQm9keSA9IHRydWU7CiAgICB9CgogICAgaWYoY2ZnLmNvbnRlbnQgPT0gbnVsbCkgewogICAgICAgIGNmZy5jb250ZW50ID0ge307CiAgICB9CgogICAgLy9hdXRvU2VuZFZlcnNpb24gdG8gc2VydmVyIGRlZmF1bHQgYmVoYXZpb3IgaXMgdHJ1ZQogICAgaWYgKCEoY2ZnLmF1dG9TZW5kVmVyc2lvbiA9PT0gZmFsc2UpKSB7CiAgICAgICAgLy9hZGQgdmVyc2lvbiBwcm9wZXJ0eSB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKICAgICAgICBjZmcuY29udGVudC52ZXJzaW9uID0gT3pvbmUudXRpbC5UcmFuc3BvcnQudmVyc2lvbjsKICAgIH0KCiAgICAvLyBDb252ZXJ0IHN0YXRlIEpTT04gb2JqZWN0IHRvIHN0cmluZwogICAgaWYgKGNmZy5jb250ZW50LnN0YXRlKSB7CiAgICAgICAgY2ZnLmNvbnRlbnQuc3RhdGUgPSBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy5jb250ZW50LnN0YXRlKTsKICAgIH0KCi8vICAgIC8vIENvbnZlcnQgZGVmYXVsdFNldHRpbmdzIEpTT04gb2JqZWN0IHRvIHN0cmluZwovLyAgICBpZiAoY2ZnLmNvbnRlbnQuZGVmYXVsdFNldHRpbmdzKSB7Ci8vICAgICAgICBjZmcuY29udGVudC5kZWZhdWx0U2V0dGluZ3MgPSBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy5jb250ZW50LmRlZmF1bHRTZXR0aW5ncyk7Ci8vICAgIH0KCiAgICB2YXIgIGNvbnRlbnQgPSBjZmcuY29udGVudDsKCiAgICB2YXIgaGFuZGxlQXMgPSAnanNvbic7CiAgICBpZiAoY2ZnLmhhbmRsZUFzICE9IG51bGwpIHsKICAgICAgICBoYW5kbGVBcyA9IGNmZy5oYW5kbGVBczsKICAgIH0KCiAgICAvLyBVc2UgQUpBWCBpZiB3ZSBjYW4KICAgIGlmIChPem9uZS51dGlsLmlzVXJsTG9jYWwoY2ZnLnVybCkgJiYgIWNmZy5mb3JjZVhkb21haW4pIHsKICAgICAgICByZXR1cm4gb3dmZG9qby54aHIobWV0aG9kVG9Vc2UudG9VcHBlckNhc2UoKSwgewogICAgICAgICAgICB1cmw6IGNmZy51cmwsCiAgICAgICAgICAgIGNvbnRlbnQ6IGNmZy5jb250ZW50LAogICAgICAgICAgICBwcmV2ZW50Q2FjaGU6IHRydWUsCiAgICAgICAgICAgIHN5bmM6IGNmZy5hc3luYyA9PSBmYWxzZT8gdHJ1ZSA6IGZhbHNlLCAvL2RlZmF1bHRzIHRvIGZhbHNlIChub3Qgc3luY2hyb25vdXMpCiAgICAgICAgICAgIHRpbWVvdXQgOiBjZmcudGltZW91dCA/IGNmZy50aW1lb3V0IDogMCwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxvYWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBpb0FyZ3MpIHsKICAgICAgICAgICAgICAgIGlmIChPem9uZS5sb2cpIHsKICAgICAgICAgICAgICAgICAgICBPem9uZS5sb2cuZ2V0RGVmYXVsdExvZ2dlcigpLmRlYnVnKCdUcmFuc3BvcnQgQUpBWCBSZXR1cm4nLCByZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlQXMgPT0gJ2pzb24nKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBPem9uZS51dGlsLnBhcnNlSnNvbihyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vblN1Y2Nlc3MoanNvbik7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUoZS5uYW1lICsgIiA6ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNmZy5vblN1Y2Nlc3MocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UsIGlvQXJncykgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRvam9UeXBlPT0nY2FuY2VsJykgeyByZXR1cm47IH0KICAgICAgICAgICAgICAgIC8vIEZGMiBraWxscyBhbGwgQUpBWCByZXF1ZXN0cyB3aGVuIHlvdSByZWZyZXNoLiBXaGVuIHRoaXMgaGFwcGVucywgaXQgc2V0cyB0aGUgc3RhdHVzIGNvZGUgdG8gMAogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPSAwICl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNmZy5pZ25vcmVkRXJyb3JDb2RlcyAhPSBudWxsICYmIGNmZy5pZ25vcmVkRXJyb3JDb2Rlcy5sZW5ndGggPiAwICYmIG93ZmRvam8uaW5kZXhPZihjZmcuaWdub3JlZEVycm9yQ29kZXMscmVzcG9uc2Uuc3RhdHVzKSA+IC0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2Vzcyh7fSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjZmcub25GYWlsdXJlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCwgcmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LCBoYXNCb2R5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVXNlIHdpbmRvdy5uYW1lIHRyYW5zcG9ydAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBtZXRob2RUb1VzZSA9IGNmZy5tZXRob2Q7CiAgICAgICAgICAgIGlmIChtZXRob2RUb1VzZSA9PSAiUFVUIiB8fCBtZXRob2RUb1VzZSA9PSAiREVMRVRFIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWV0aG9kVG9Vc2UgPSAiUE9TVCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gb3dmZG9qb3guaW8ud2luZG93TmFtZS5zZW5kKG1ldGhvZFRvVXNlLnRvVXBwZXJDYXNlKCksIHsKICAgICAgICAgICAgICAgIHVybDogY2ZnLnVybCwKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICBwcmV2ZW50Q2FjaGU6IHRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0OiBjZmcudGltZW91dCA/IGNmZy50aW1lb3V0IDogMjAwMDAsCiAgICAgICAgICAgICAgICBsb2FkOgogICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gT1dGLTI3NTAgLSBoYW5kbGUgdGltZW91dCBlcnJvcnMgd2hpY2ggYXJlIGFscmVhZHkgSlNPTiBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqc29uID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YocmVzdWx0KSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAganNvbiA9IE96b25lLnV0aWwucGFyc2VKc29uKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzb24gPSByZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9XRi0yNzUwIC0gZGV0ZWN0IGEgdGltZW91dCBlcnJvciBhbmQgcmV0dXJuIGl0cyBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uICYmIGpzb24ubWVzc2FnZSAmJiBqc29uLm1lc3NhZ2UgPT0gJ1RpbWVvdXQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZmcub25GYWlsdXJlKCdFcnJvcjogUmVxdWVzdCB0aW1lZCBvdXQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPem9uZS5sb2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPem9uZS5sb2cuZ2V0RGVmYXVsdExvZ2dlcigpLmRlYnVnKCdUcmFuc3BvcnQgQUpBWCBSZXR1cm4nLCBqc29uLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZUFzID09ICdqc29uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vblN1Y2Nlc3MoanNvbi5kYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vblN1Y2Nlc3MocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqc29uLnN0YXR1cyA9PT0gNTAwIHx8IGpzb24uc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUoanNvbi5kYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGl0IGlzIGFuIGVycm9yIGNvZGUgd2UgaWdub3JlIHRoYW4gY2FsbCBvblN1Y2Nlc3Mgd2l0aCBlbXB0eSBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNmZy5pZ25vcmVkRXJyb3JDb2RlcyAhPSBudWxsICYmIGNmZy5pZ25vcmVkRXJyb3JDb2Rlcy5sZW5ndGggPiAwICYmIG93ZmRvam8uaW5kZXhPZihjZmcuaWdub3JlZEVycm9yQ29kZXMsanNvbi5zdGF0dXMpID4gLTEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2Vzcyh7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcub25GYWlsdXJlKGpzb24uZGF0YSxqc29uLnN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb247CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoKGUyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUoZTIubmFtZSArICIgOiAiICsgZTIubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOgogICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmRvam9UeXBlPT0nY2FuY2VsJykgeyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgRXJyb3IpewogICAgICAgICAgICAgICAgICAgICAgICBjZmcub25GYWlsdXJlKHJlc3VsdC5uYW1lICsgIiA6ICIgKyByZXN1bHQubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICAgICAgfQogICAgICAgIGNhdGNoKGUpewogICAgICAgICAgICBjZmcub25GYWlsdXJlKGUubmFtZSArICIgOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICB9CgkKfTsKLyoqCiAqIEBwcml2YXRlCiAqCiAqIEBwYXJhbXMgIGNmZy51cmwgICAgICAgICAgICAgIC0gIHVybCBvZiB0aGUgcmVxdWVzdAogKiAgICAgICAgICBjZmcubWV0aG9kICAgICAgICAgICAtICBIVFRQIHZlcmIgKG9ubHkgUE9TVCBvciBHRVQsIHVzZSBfbWV0aG9kID0gUFVUIG9yIERFTEVURSB3aXRoIGEgUE9TVCApCiAqICAgICAgICAgIGNmZy5jb250ZW50ICAgICAgICAgIC0gIG9wdGlvbmFsIGNvbnRlbnQgdG8gc2VuZCB3aXRoIHRoZSByZXF1ZXN0LCBpZSB7dmFsdWU6ICd4JywgX21ldGhvZDogJ1BVVCd9CiAqICAgICAgICAgIGNmZy5hc3luYwkJCSAtICBvcHRpb25hbCAoZGVmYXVsdCBpcyB0cnVlLCBhc3luY2hyb25vdXMgc2VuZCwgb25seSBhcHBsaWVzIHRvIEFqYXggY2FsbCkgICAgICAgICAgCiAqCiAqICBAcmV0dXJucyB2b2lkCiAqCiAqICBTdGF0aWMgbWV0aG9kLiAgTm8gY2FsbGJhY2tzIGFyZSBwYXNzZWQgaW4sIHNvIHlvdSB3aWxsIG5vdCBnZXQgYSByZXNwb25zZS4gIFVzZWZ1bCBmb3IgZXhhbXBsZSBpbgogKiAgICAgICAgICAgICAgICAgIGluICdiZWZvcmV1bmxvYWQnIHdoZW4gdGhlIHRoZSBhc3luY3Jvbm91cyBjYWxsYmFja3MgYXJlIGd1YXJhbnRlZWQgdG8gaGF2ZSB0aGUgc2FtZQogKiAgICAgICAgICAgICAgICAgIGphdmFzY3JpcHQgaW4gdGhlIGRvbSB3aGVuIHRoZXkgYXJlIGZpcnRlZAogKgogKgogKiAgVGhpcyBpbXBsZW1lbnRhdGlvbiB1c2VzIHRoZSBkb2pveC53aW5kb3dOYW1lIGhhY2sgZm9yIGEgcmVtb3RlIHNlcnZlciwKICAqIGJ1dCBjb3VsZCBiZSByZXBsYWNlZCB3aXRoIHNvbWV0aGluZyBlbHNlIGxpa2UgSlNPTlAgaWYgZGVzaXJlZAogKi8KT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZEFuZEZvcmdldCA9IGZ1bmN0aW9uKGNmZykgewogICAgdmFyIGNmZyA9IGNmZzsKCiAgICBpZiAoT3pvbmUubG9nKSB7CiAgICAgICAgT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIoKS5kZWJ1ZygnVHJhbnNwb3J0IFNlbmRBbmRGb3JnZXQnLCBjZmcudXJsLCBjZmcubWV0aG9kLCBjZmcuY29udGVudCk7CiAgICB9CgogICAgdmFyIG1ldGhvZFRvVXNlID0gY2ZnLm1ldGhvZDsKICAgIGlmIChtZXRob2RUb1VzZSA9PSAiUFVUIiB8fCBtZXRob2RUb1VzZSA9PSAiREVMRVRFIikKICAgIHsKICAgICAgICBtZXRob2RUb1VzZSA9ICJQT1NUIjsKICAgIH0KCQogICAgdmFyIGhhc0JvZHkgPSBmYWxzZTsKICAgIGlmIChtZXRob2RUb1VzZSA9PSAiUE9TVCIpIHsKICAgICAgICBoYXNCb2R5ID0gdHJ1ZTsKICAgIH0KCQogICAgaWYoY2ZnLmNvbnRlbnQgPT0gbnVsbCkgewogICAgICAgIGNmZy5jb250ZW50ID0ge307CiAgICB9CgogICAgLy9hdXRvU2VuZFZlcnNpb24gdG8gc2VydmVyIGRlZmF1bHQgYmVoYXZpb3IgaXMgdHJ1ZQogICAgaWYgKGNmZy5hdXRvU2VuZFZlcnNpb24gPT09IGZhbHNlKSB7CiAgICAgICAgLy9hZGQgdmVyc2lvbiBwcm9wZXJ0eSB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKICAgICAgICBjZmcuY29udGVudC52ZXJzaW9uID0gT3pvbmUudXRpbC5UcmFuc3BvcnQudmVyc2lvbjsKICAgIH0KCiAgICAvLyBDb252ZXJ0IHN0YXRlIEpTT04gb2JqZWN0IHRvIHN0cmluZwogICAgaWYgKGNmZy5jb250ZW50LnN0YXRlKSB7CiAgICAgICAgY2ZnLmNvbnRlbnQuc3RhdGUgPSBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy5jb250ZW50LnN0YXRlKTsKICAgIH0KCiAgICB2YXIgY29udGVudCA9IG51bGw7CiAgICBpZiAobWV0aG9kVG9Vc2UgPT0gIkdFVCIpIHsKICAgICAgICBjb250ZW50ID0gb3dmZG9qby5vYmplY3RUb1F1ZXJ5KGNmZy5jb250ZW50KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNvbnRlbnQgPSBjZmcuY29udGVudDsKICAgIH0KCiAgICAvLyBVc2UgQUpBWCBpZiB3ZSBjYW4KICAgIGlmIChPem9uZS51dGlsLmlzVXJsTG9jYWwoY2ZnLnVybCkpIHsKICAgICAgICBvd2Zkb2pvLnhocihtZXRob2RUb1VzZS50b1VwcGVyQ2FzZSgpLCB7CiAgICAgICAgICAgIHVybDogY2ZnLnVybCwKICAgICAgICAgICAgY29udGVudDogY2ZnLmNvbnRlbnQsCiAgICAgICAgICAgIHByZXZlbnRDYWNoZTogdHJ1ZSwKICAgICAgICAgICAgc3luYzogIGNmZy5hc3luYyA9PSBmYWxzZT8gZmFsc2UgOiB0cnVlIC8vZGVmYXVsdHMgdG8gdHJ1ZQogICAgICAgIH0sIGhhc0JvZHkpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBVc2Ugd2luZG93Lm5hbWUgdHJhbnNwb3J0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIG1ldGhvZFRvVXNlID0gY2ZnLm1ldGhvZDsKICAgICAgICAgICAgaWYgKG1ldGhvZFRvVXNlID09ICJQVVQiIHx8IG1ldGhvZFRvVXNlID09ICJERUxFVEUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZXRob2RUb1VzZSA9ICJQT1NUIjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBvd2Zkb2pveC5pby53aW5kb3dOYW1lLnNlbmQobWV0aG9kVG9Vc2UudG9VcHBlckNhc2UoKSwgewogICAgICAgICAgICAgICAgdXJsOiBjZmcudXJsLAogICAgICAgICAgICAgICAgY29udGVudDogY29udGVudCwKICAgICAgICAgICAgICAgIHByZXZlbnRDYWNoZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgaWYgKCFPem9uZS5Nc2cpCiAgICAgICAgICAgICAgICBPem9uZS51dGlsLkVycm9yRGxnLnNob3coT3pvbmUudXRpbC5FcnJvck1lc3NhZ2VTdHJpbmcuc2VuZEFuZEZvcmdldCxlLm5hbWUgKyAiIDogIiArIGUubWVzc2FnZSwyMDAsNTApOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBPem9uZS5Nc2cuYWxlcnQoT3pvbmUudXRpbC5FcnJvck1lc3NhZ2VTdHJpbmcuc2VuZEFuZEZvcmdldCxlLm5hbWUgKyAiIDogIiArIGUubWVzc2FnZSk7CiAgICAgICAgfQogICAgfQp9OwoKCi8qKgogKiBAcHJpdmF0ZQogKgogKiAgQHBhcmFtcyAgY2ZnLnVybHMgICAgICAgICAgICAgIC0gIEFycmF5IG9mIHVybHMgdG8gdHJ5CiAqICAgICAgICAgICBjZmcubWV0aG9kICAgICAgICAgICAtICBIVFRQIHZlcmIgKG9ubHkgUE9TVCBvciBHRVQsIHVzZSBfbWV0aG9kID0gUFVUIG9yIERFTEVURSB3aXRoIGEgUE9TVCApCiAqICAgICAgICAgICBjZmcub25TdWNjZXNzICAgICAgICAtICBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdAogKiAgICAgICAgICAgY2ZnLm9uTGFzdEZhaWx1cmUgICAgICAgIC0gIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IKICogICAgICAgICAgIGNmZy5jb250ZW50ICAgICAgICAgIC0gIG9wdGlvbmFsIGNvbnRlbnQgdG8gc2VuZCB3aXRoIHRoZSByZXF1ZXN0LCBpZSB7dmFsdWU6ICd4JywgX21ldGhvZDogJ1BVVCd9CiAqCiAqICBAcmV0dXJucyB2b2lkLCB1c2UgY2FsbGJhY2tzCiAqCiAqICBTdGF0aWMgbWV0aG9kLiAgQWxsb3dzIHRoZSB1c2VyIHRvIHBhc3MgaW4gYW4gYXJyYXkgb2YgdXJscyB0byB0cnkuICBUaGUgZmlyc3Qgb25lIHRvIHJldHVybiBhIHJlc3BvbnNlIHN0b3BzCiAqICB0aGUgcHJvY2Vzc2luZy4gIFVzZXMgdGhlIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQgbWV0aG9kLgogKi8KT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZFRvRmlyc3QgPSBmdW5jdGlvbihjZmcpIHsKICAgIHZhciB1ID0gY2ZnLnVybHMuc2hpZnQoKTsKCQogICAgaWYgKHUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChjZmcub25MYXN0RmFpbHVyZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNmZy5vbkxhc3RGYWlsdXJlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KCQogICAgdmFyIG9uVGhpc0ZhaWx1cmUgPSBmdW5jdGlvbigpIHsKICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kVG9GaXJzdCh7CiAgICAgICAgICAgIHVybHM6Y2ZnLnVybHMsCiAgICAgICAgICAgIG1ldGhvZDpjZmcubWV0aG9kLAogICAgICAgICAgICBvblN1Y2Nlc3M6Y2ZnLm9uU3VjY2VzcywKICAgICAgICAgICAgb25MYXN0RmFpbHVyZTpjZmcub25MYXN0RmFpbHVyZSwKICAgICAgICAgICAgY29udGVudDpjZmcuY29udGVudAogICAgICAgICAgICB9KTsKICAgIH07CgkKICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoewogICAgICAgIHVybDp1LAogICAgICAgIG1ldGhvZDpjZmcubWV0aG9kLAogICAgICAgIG9uU3VjY2VzczpjZmcub25TdWNjZXNzLAogICAgICAgIG9uRmFpbHVyZTpvblRoaXNGYWlsdXJlLAogICAgICAgIGNvbnRlbnQ6Y2ZnLmNvbnRlbnQKICAgICAgICB9KTsKfTsKCnZhciBPem9uZSA9IE96b25lIHx8IHt9OwovKioKICogQG5hbWVzcGFjZQogKiBAZGVzY3JpcHRpb24gUHJvdmlkZXMgT1dGIHV0aWxpdHkgbWV0aG9kcyBmb3IgdGhlIHdpZGdldCBkZXZlbG9wZXIKICogCiAqLwpPem9uZS51dGlsID0gT3pvbmUudXRpbCB8fCB7fTsKCi8qKgogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgaW5mb3JtcyBhIHdpZGdldCBkZXZlbG9wZXIgaWYgdGhlaXIgd2lkZ2V0IGlzIHJ1bm5pbmcKICogaW4gYSBDb250YWluZXIsIGxpa2UgT1dGCiAqCiAqIEByZXR1cm5zICBib29sZWFuIHRydWUgaWYgdGhlIHdpZGdldCBpcyBpbnNpZGUgYSBjb250YWluZXIsIGZhbHNlIG90aGVyd2lzZS4KICoKICovCk96b25lLnV0aWwuaXNJbkNvbnRhaW5lciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGluQ29udGFpbmVyID0gZmFsc2U7CgogICAgLy9jaGVjayB3aW5kb3cubmFtZQogICAgaWYgKE96b25lLnV0aWwucGFyc2VKc29uKSB7CiAgICAgICAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOwogICAgICAgIGlmIChjb25maWdQYXJhbXMgIT0gbnVsbAogICAgICAgICAgICAgICAgIC8vaXMgdGhlIGZhY3QgdGhhdCBhIGpzb24gc3RyaW5nIHdhcyBpbiB3aW5kb3cubmFtZSBlbm91Z2ggdG8gZGV0ZXJtaW5lIHRoZSB3aWRnZXQgaXMgaW4gYSBjb250YWluZXI/CiAgICAgICAgICAgICAgICAvLyYmIGNvbmZpZ1BhcmFtcy5pbkNvbnRhaW5lcgogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgIGluQ29udGFpbmVyID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gaW5Db250YWluZXI7Cn07CgovKioKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIGluZm9ybXMgYSB3aWRnZXQgZGV2ZWxvcGVyIGlmIHRoZWlyIHdpZGdldCBpcyBydW5uaW5nIAogKiBmcm9tIHRoZSBPV0Ygb3IgZnJvbSBhIGRpcmVjdCBVUkwgY2FsbC4KICogCiAqIEByZXR1cm5zICBib29sZWFuIHRydWUgaWYgdGhlIHdpZGdldCBpcyBpbnNpZGUgT1dGLCBmYWxzZSBvdGhlcndpc2UuCiAqCiAqLwpPem9uZS51dGlsLmlzUnVubmluZ0luT1dGID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaXNJbk93ZiA9IGZhbHNlOwoKICAgIC8vY2hlY2sgd2luZG93Lm5hbWUKICAgIGlmIChPem9uZS51dGlsLnBhcnNlSnNvbikgewogICAgICAgIHZhciBjb25maWdQYXJhbXMgPSBPem9uZS51dGlsLnBhcnNlV2luZG93TmFtZURhdGEoKTsKICAgICAgICBpZiAoY29uZmlnUGFyYW1zICE9IG51bGwgJiYgY29uZmlnUGFyYW1zLm93ZikgewogICAgICAgICAgICBpc0luT3dmID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gaXNJbk93ZjsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKgogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgdGFrZXMgYSBzdHJpbmcgYW5kIHJlbW92ZXMgdGhlIHBhc3NlZCBoZWFkZXIgZnJvbSB0aGUgZnJvbnQgb2YgaXQuCiAqIFVzZWQgdG8gY29udmVydCBhIHVuaXF1ZSBpZCBhdHRyaWJ1dGUgaW50byBhIGlkIHRoYXQgb3RoZXIgZnVuY3Rpb25zIGFuZCBvYmplY3RzIGNhbiB1c2UuCiAqIAogKiBAcGFyYW0ge1N0cmluZ30gaWQgdGhlIGlkIGF0dHJpYnV0ZSB2YWx1ZSB0byBiZSBtYW5pcHVsYXRlZAogKiBAcGFyYW0ge1N0cmluZ30gaGVhZGVyIHRoZSBoZWFkZXIgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBpZAogKiAKICogQHJldHVybnMgU3RyaW5nIHRoZSBpZCBtaW51cyB0aGUgaGVhZGVyLiAoRXguIHBhcnNlSUQoJ2hlYWRlcjEnLCAnaGVhZGVyJykgcmV0dXJucyAnMScpCiAqIAogKi8KT3pvbmUudXRpbC5wYXJzZUlEID0gZnVuY3Rpb24oaWQsIGhlYWRlcikgewogICAgcmV0dXJuIGlkLnN1YnN0cmluZygwLCBoZWFkZXIubGVuZ3RoKSA9PSBoZWFkZXIgPyBpZC5zdWJzdHJpbmcoaGVhZGVyLmxlbmd0aCkgOiBpZDsKfQoKLyoqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCByZXR1cm5zIGZsYXNoL2ZsZXggb2JqZWN0IGZyb20gZG9tLgogKiAKICogQHJldHVybnMgIGZsYXNoL2ZsZXggb2JqZWN0IGZyb20gZG9tCiAqCiAqLwpPem9uZS51dGlsLmdldEZsYXNoQXBwID0gZnVuY3Rpb24oaWQpIHsKICAgIGlkID0gaWQgfHwgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuZ2V0SW5zdGFuY2UoKS5nZXRGbGFzaFdpZGdldElkKCk7CiAgICBpZighaWQpCiAgICAgICAgcmV0dXJuOwogICAgCiAgICBpZiAobmF2aWdhdG9yLmFwcE5hbWUuaW5kZXhPZiAoIk1pY3Jvc29mdCIpICE9LTEpIHsKICAgICAgICByZXR1cm4gd2luZG93W2lkXTsKICAgICAgICB9CiAgICBlbHNlIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnRbaWRdOwogICAgfQp9OwovKgogKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQogKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKdmFyIGdhZGdldHMgPSBnYWRnZXRzIHx8IHt9OwoKLyoqCiAqIEBmaWxlb3ZlcnZpZXcgR2VuZXJhbCBwdXJwb3NlIHV0aWxpdGllcyB0aGF0IGdhZGdldHMgY2FuIHVzZS4KICovCgovKioKICogQHN0YXRpYwogKiBAY2xhc3MgUHJvdmlkZXMgZ2VuZXJhbC1wdXJwb3NlIHV0aWxpdHkgZnVuY3Rpb25zLgogKiBAbmFtZSBnYWRnZXRzLnV0aWwKICovCgpnYWRnZXRzLnV0aWwgPSBmdW5jdGlvbigpIHsKICAvKioKICAgKiBQYXJzZXMgVVJMIHBhcmFtZXRlcnMgaW50byBhbiBvYmplY3QuCiAgICogQHJldHVybiB7QXJyYXkuJmx0O1N0cmluZyZndDt9IFRoZSBwYXJhbWV0ZXJzCiAgICovCiAgZnVuY3Rpb24gcGFyc2VVcmxQYXJhbXMoKSB7CiAgICAvLyBHZXQgc2V0dGluZ3MgZnJvbSB1cmwsICdoYXNoJyB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgJ3NlYXJjaCcgY29tcG9uZW50CiAgICAvLyBkb24ndCB1c2UgZG9jdW1lbnQubG9jYXRpb24uaGFzaCBkdWUgdG8gYnJvd3NlciBkaWZmZXJlbmNlcy4KICAgIHZhciBxdWVyeTsKICAgIHZhciBsID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjsKICAgIHZhciBxdWVyeUlkeCA9IGwuaW5kZXhPZigiPyIpOwogICAgdmFyIGhhc2hJZHggPSBsLmluZGV4T2YoIiMiKTsKICAgIGlmIChoYXNoSWR4ID09PSAtMSkgewogICAgICBxdWVyeSA9IGwuc3Vic3RyKHF1ZXJ5SWR4ICsgMSk7CiAgICB9IGVsc2UgewogICAgICAvLyBlc3NlbnRpYWxseSByZXBsYWNlcyAiIyIgd2l0aCAiJiIKICAgICAgcXVlcnkgPSBbbC5zdWJzdHIocXVlcnlJZHggKyAxLCBoYXNoSWR4IC0gcXVlcnlJZHggLSAxKSwgIiYiLAogICAgICAgICAgICAgICBsLnN1YnN0cihoYXNoSWR4ICsgMSldLmpvaW4oIiIpOwogICAgfQogICAgcmV0dXJuIHF1ZXJ5LnNwbGl0KCImIik7CiAgfQoKICB2YXIgcGFyYW1ldGVycyA9IG51bGw7CiAgdmFyIGZlYXR1cmVzID0ge307CiAgdmFyIG9uTG9hZEhhbmRsZXJzID0gW107CgogIC8vIE1hcHMgY29kZSBwb2ludHMgdG8gdGhlIHZhbHVlIHRvIHJlcGxhY2UgdGhlbSB3aXRoLgogIC8vIElmIHRoZSB2YWx1ZSBpcyAiZmFsc2UiLCB0aGUgY2hhcmFjdGVyIGlzIHJlbW92ZWQgZW50aXJlbHksIG90aGVyd2lzZQogIC8vIGl0IHdpbGwgYmUgcmVwbGFjZWQgd2l0aCBhbiBodG1sIGVudGl0eS4KICB2YXIgZXNjYXBlQ29kZVBvaW50cyA9IHsKICAgLy8gbnVsOyBtb3N0IGJyb3dzZXJzIHRydW5jYXRlIGJlY2F1c2UgdGhleSB1c2UgYyBzdHJpbmdzIHVuZGVyIHRoZSBjb3ZlcnMuCiAgIDAgOiBmYWxzZSwKICAgLy8gbmV3IGxpbmUKICAgMTAgOiB0cnVlLAogICAvLyBjYXJyaWFnZSByZXR1cm4KICAgMTMgOiB0cnVlLAogICAvLyBkb3VibGUgcXVvdGUKICAgMzQgOiB0cnVlLAogICAvLyBzaW5nbGUgcXVvdGUKICAgMzkgOiB0cnVlLAogICAvLyBsZXNzIHRoYW4KICAgNjAgOiB0cnVlLAogICAvLyBncmVhdGVyIHRoYW4KICAgNjIgOiB0cnVlLAogICAvLyBCYWNrc2xhc2gKICAgOTIgOiB0cnVlLAogICAvLyBsaW5lIHNlcGFyYXRvcgogICA4MjMyIDogdHJ1ZSwKICAgLy8gcGFyYWdyYXBoIHNlcGFyYXRvcgogICA4MjMzIDogdHJ1ZQogIH07CgogIC8qKgogICAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBjYWxsYmFjayB0aGF0IHJldHVybnMgc3RyaW5ncyBmcm9tIHVuaWNvZGUgY29kZSBwb2ludHMuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBtYXRjaCBJZ25vcmVkCiAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSBjb2RlcG9pbnQgdmFsdWUgdG8gY29udmVydAogICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGNoYXJhY3RlciBjb3JyZXNwb25kaW5nIHRvIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIHVuZXNjYXBlRW50aXR5KG1hdGNoLCB2YWx1ZSkgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUpOwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgZmVhdHVyZSBwYXJhbWV0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGluaXQoY29uZmlnKSB7CiAgICBmZWF0dXJlcyA9IGNvbmZpZ1siY29yZS51dGlsIl0gfHwge307CiAgfQogIGlmIChnYWRnZXRzLmNvbmZpZykgewogICAgZ2FkZ2V0cy5jb25maWcucmVnaXN0ZXIoImNvcmUudXRpbCIsIG51bGwsIGluaXQpOwogIH0KCiAgcmV0dXJuIC8qKiBAc2NvcGUgZ2FkZ2V0cy51dGlsICovIHsKCiAgICAvKioKICAgICAqIEdldHMgdGhlIFVSTCBwYXJhbWV0ZXJzLgogICAgICoKICAgICAqIEByZXR1cm4ge09iamVjdH0gUGFyYW1ldGVycyBwYXNzZWQgaW50byB0aGUgcXVlcnkgc3RyaW5nCiAgICAgKiBAbWVtYmVyIGdhZGdldHMudXRpbAogICAgICogQHByaXZhdGUgSW1wbGVtZW50YXRpb24gZGV0YWlsLgogICAgICovCiAgICBnZXRVcmxQYXJhbWV0ZXJzIDogZnVuY3Rpb24gKCkgewogICAgICBpZiAocGFyYW1ldGVycyAhPT0gbnVsbCkgewogICAgICAgIHJldHVybiBwYXJhbWV0ZXJzOwogICAgICB9CiAgICAgIHBhcmFtZXRlcnMgPSB7fTsKICAgICAgdmFyIHBhaXJzID0gcGFyc2VVcmxQYXJhbXMoKTsKICAgICAgdmFyIHVuZXNjID0gd2luZG93LmRlY29kZVVSSUNvbXBvbmVudCA/IGRlY29kZVVSSUNvbXBvbmVudCA6IHVuZXNjYXBlOwogICAgICBmb3IgKHZhciBpID0gMCwgaiA9IHBhaXJzLmxlbmd0aDsgaSA8IGo7ICsraSkgewogICAgICAgIHZhciBwb3MgPSBwYWlyc1tpXS5pbmRleE9mKCc9Jyk7CiAgICAgICAgaWYgKHBvcyA9PT0gLTEpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB2YXIgYXJnTmFtZSA9IHBhaXJzW2ldLnN1YnN0cmluZygwLCBwb3MpOwogICAgICAgIHZhciB2YWx1ZSA9IHBhaXJzW2ldLnN1YnN0cmluZyhwb3MgKyAxKTsKICAgICAgICAvLyBkaWZmZXJlbmNlIHRvIElHX1ByZWZzLCBpcyB0aGF0IGFyZ3MgZG9lc24ndCByZXBsYWNlIHNwYWNlcyBpbgogICAgICAgIC8vIGFyZ25hbWUuIFVuY2xlYXIgb24gaWYgaXQgc2hvdWxkIGRvOgogICAgICAgIC8vIGFyZ25hbWUgPSBhcmduYW1lLnJlcGxhY2UoL1wrL2csICIgIik7CiAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cKy9nLCAiICIpOwogICAgICAgIHBhcmFtZXRlcnNbYXJnTmFtZV0gPSB1bmVzYyh2YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcmFtZXRlcnM7CiAgICB9LAoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIGNsb3N1cmUgdGhhdCBpcyBzdWl0YWJsZSBmb3IgcGFzc2luZyBhcyBhIGNhbGxiYWNrLgogICAgICogQW55IG51bWJlciBvZiBhcmd1bWVudHMKICAgICAqIG1heSBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrOwogICAgICogdGhleSB3aWxsIGJlIHJlY2VpdmVkIGluIHRoZSBvcmRlciB0aGV5IGFyZSBwYXNzZWQgaW4uCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBleGVjdXRpb24gc2NvcGU7IG1heSBiZSBudWxsIGlmIHRoZXJlIGlzIG5vCiAgICAgKiAgICAgbmVlZCB0byBhc3NvY2lhdGUgYSBzcGVjaWZpYyBpbnN0YW5jZSBvZiBhbiBvYmplY3Qgd2l0aCB0aGlzCiAgICAgKiAgICAgY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBpbnZva2Ugd2hlbiB0aGlzIGlzIHJ1bjsKICAgICAqICAgICBhbnkgYXJndW1lbnRzIHBhc3NlZCBpbiB3aWxsIGJlIHBhc3NlZCBhZnRlciB5b3VyIGluaXRpYWwgYXJndW1lbnRzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFyX2FyZ3MgSW5pdGlhbCBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjawogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy51dGlsCiAgICAgKiBAcHJpdmF0ZSBJbXBsZW1lbnRhdGlvbiBkZXRhaWwuCiAgICAgKi8KICAgIG1ha2VDbG9zdXJlIDogZnVuY3Rpb24gKHNjb3BlLCBjYWxsYmFjaywgdmFyX2FyZ3MpIHsKICAgICAgLy8gYXJndW1lbnRzIGlzbid0IGEgcmVhbCBhcnJheSwgc28gd2UgY29weSBpdCBpbnRvIG9uZS4KICAgICAgdmFyIGJhc2VBcmdzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAyLCBqID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGo7ICsraSkgewogICAgICAgYmFzZUFyZ3MucHVzaChhcmd1bWVudHNbaV0pOwogICAgICB9CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAvLyBhcHBlbmQgbmV3IGFyZ3VtZW50cy4KICAgICAgICB2YXIgdG1wQXJncyA9IGJhc2VBcmdzLnNsaWNlKCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgajsgKytpKSB7CiAgICAgICAgICB0bXBBcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmFwcGx5KHNjb3BlLCB0bXBBcmdzKTsKICAgICAgfTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciBnZW5lcmF0aW5nIGFuICJlbnVtIiBmcm9tIGFuIGFycmF5LgogICAgICoKICAgICAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IHZhbHVlcyBUaGUgdmFsdWVzIHRvIGdlbmVyYXRlLgogICAgICogQHJldHVybiB7TWFwJmx0O1N0cmluZyxTdHJpbmcmZ3Q7fSBBbiBvYmplY3Qgd2l0aCBtZW1iZXIgZmllbGRzIHRvIGhhbmRsZQogICAgICogICB0aGUgZW51bS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZSBJbXBsZW1lbnRhdGlvbiBkZXRhaWwuCiAgICAgKi8KICAgIG1ha2VFbnVtIDogZnVuY3Rpb24gKHZhbHVlcykgewogICAgICB2YXIgb2JqID0ge307CiAgICAgIGZvciAodmFyIGkgPSAwLCB2OyB2ID0gdmFsdWVzW2ldOyArK2kpIHsKICAgICAgICBvYmpbdl0gPSB2OwogICAgICB9CiAgICAgIHJldHVybiBvYmo7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0cyB0aGUgZmVhdHVyZSBwYXJhbWV0ZXJzLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmZWF0dXJlIFRoZSBmZWF0dXJlIHRvIGdldCBwYXJhbWV0ZXJzIGZvcgogICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgcGFyYW1ldGVycyBmb3IgdGhlIGdpdmVuIGZlYXR1cmUsIG9yIG51bGwKICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMudXRpbAogICAgICovCiAgICBnZXRGZWF0dXJlUGFyYW1ldGVycyA6IGZ1bmN0aW9uIChmZWF0dXJlKSB7CiAgICAgIHJldHVybiB0eXBlb2YgZmVhdHVyZXNbZmVhdHVyZV0gPT09ICJ1bmRlZmluZWQiCiAgICAgICAgICA/IG51bGwgOiBmZWF0dXJlc1tmZWF0dXJlXTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGN1cnJlbnQgZmVhdHVyZSBpcyBzdXBwb3J0ZWQuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGZlYXR1cmUgVGhlIGZlYXR1cmUgdG8gdGVzdCBmb3IKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgdGhlIGZlYXR1cmUgaXMgc3VwcG9ydGVkCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnV0aWwKICAgICAqLwogICAgaGFzRmVhdHVyZSA6IGZ1bmN0aW9uIChmZWF0dXJlKSB7CiAgICAgIHJldHVybiB0eXBlb2YgZmVhdHVyZXNbZmVhdHVyZV0gIT09ICJ1bmRlZmluZWQiOwogICAgfSwKCiAgICAvKioKICAgICAqIFJlZ2lzdGVycyBhbiBvbmxvYWQgaGFuZGxlci4KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBoYW5kbGVyIHRvIHJ1bgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy51dGlsCiAgICAgKi8KICAgIHJlZ2lzdGVyT25Mb2FkSGFuZGxlciA6IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICBvbkxvYWRIYW5kbGVycy5wdXNoKGNhbGxiYWNrKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSdW5zIGFsbCBmdW5jdGlvbnMgcmVnaXN0ZXJlZCB2aWEgcmVnaXN0ZXJPbkxvYWRIYW5kbGVyLgogICAgICogQHByaXZhdGUgT25seSB0byBiZSB1c2VkIGJ5IHRoZSBjb250YWluZXIsIG5vdCBnYWRnZXRzLgogICAgICovCiAgICBydW5PbkxvYWRIYW5kbGVycyA6IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBvbkxvYWRIYW5kbGVycy5sZW5ndGg7IGkgPCBqOyArK2kpIHsKICAgICAgICBvbkxvYWRIYW5kbGVyc1tpXSgpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogRXNjYXBlcyB0aGUgaW5wdXQgdXNpbmcgaHRtbCBlbnRpdGllcyB0byBtYWtlIGl0IHNhZmVyLgogICAgICoKICAgICAqIElmIHRoZSBpbnB1dCBpcyBhIHN0cmluZywgdXNlcyBnYWRnZXRzLnV0aWwuZXNjYXBlU3RyaW5nLgogICAgICogSWYgaXQgaXMgYW4gYXJyYXksIGNhbGxzIGVzY2FwZSBvbiBlYWNoIG9mIHRoZSBhcnJheSBlbGVtZW50cwogICAgICogaWYgaXQgaXMgYW4gb2JqZWN0LCB3aWxsIG9ubHkgZXNjYXBlIGFsbCB0aGUgbWFwcGVkIGtleXMgYW5kIHZhbHVlcyBpZgogICAgICogdGhlIG9wdF9lc2NhcGVPYmplY3RzIGZsYWcgaXMgc2V0LiBUaGlzIG9wZXJhdGlvbiBpbnZvbHZlcyBjcmVhdGluZyBhbgogICAgICogZW50aXJlbHkgbmV3IG9iamVjdCBzbyBvbmx5IHNldCB0aGUgZmxhZyB3aGVuIHRoZSBpbnB1dCBpcyBhIHNpbXBsZQogICAgICogc3RyaW5nIHRvIHN0cmluZyBtYXAuCiAgICAgKiBPdGhlcndpc2UsIGRvZXMgbm90IGF0dGVtcHQgdG8gbW9kaWZ5IHRoZSBpbnB1dC4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXQgVGhlIG9iamVjdCB0byBlc2NhcGUKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0X2VzY2FwZU9iamVjdHMgV2hldGhlciB0byBlc2NhcGUgb2JqZWN0cy4KICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGVzY2FwZWQgb2JqZWN0CiAgICAgKiBAcHJpdmF0ZSBPbmx5IHRvIGJlIHVzZWQgYnkgdGhlIGNvbnRhaW5lciwgbm90IGdhZGdldHMuCiAgICAgKi8KICAgIGVzY2FwZSA6IGZ1bmN0aW9uKGlucHV0LCBvcHRfZXNjYXBlT2JqZWN0cykgewogICAgICBpZiAoIWlucHV0KSB7CiAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gZ2FkZ2V0cy51dGlsLmVzY2FwZVN0cmluZyhpbnB1dCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAiYXJyYXkiKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBpbnB1dC5sZW5ndGg7IGkgPCBqOyArK2kpIHsKICAgICAgICAgIGlucHV0W2ldID0gZ2FkZ2V0cy51dGlsLmVzY2FwZShpbnB1dFtpXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gIm9iamVjdCIgJiYgb3B0X2VzY2FwZU9iamVjdHMpIHsKICAgICAgICB2YXIgbmV3T2JqZWN0ID0ge307CiAgICAgICAgZm9yICh2YXIgZmllbGQgaW4gaW5wdXQpIGlmIChpbnB1dC5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHsKICAgICAgICAgIG5ld09iamVjdFtnYWRnZXRzLnV0aWwuZXNjYXBlU3RyaW5nKGZpZWxkKV0KICAgICAgICAgICAgICA9IGdhZGdldHMudXRpbC5lc2NhcGUoaW5wdXRbZmllbGRdLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ld09iamVjdDsKICAgICAgfQogICAgICByZXR1cm4gaW5wdXQ7CiAgICB9LAoKICAgIC8qKgogICAgICogRXNjYXBlcyB0aGUgaW5wdXQgdXNpbmcgaHRtbCBlbnRpdGllcyB0byBtYWtlIGl0IHNhZmVyLgogICAgICoKICAgICAqIEN1cnJlbnRseSBub3QgaW4gdGhlIHNwZWMgLS0gZnV0dXJlIHByb3Bvc2FscyBtYXkgY2hhbmdlCiAgICAgKiBob3cgdGhpcyBpcyBoYW5kbGVkLgogICAgICoKICAgICAqIFRPRE86IFBhcnNpbmcgdGhlIHN0cmluZyB3b3VsZCBwcm9iYWJseSBiZSBtb3JlIGFjY3VyYXRlIGFuZCBmYXN0ZXIgdGhhbgogICAgICogYSBidW5jaCBvZiByZWd1bGFyIGV4cHJlc3Npb25zLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBlc2NhcGUKICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGVzY2FwZWQgc3RyaW5nCiAgICAgKi8KICAgIGVzY2FwZVN0cmluZyA6IGZ1bmN0aW9uKHN0cikgewogICAgICB2YXIgb3V0ID0gW10sIGNoLCBzaG91bGRFc2NhcGU7CiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gc3RyLmxlbmd0aDsgaSA8IGo7ICsraSkgewogICAgICAgIGNoID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgc2hvdWxkRXNjYXBlID0gZXNjYXBlQ29kZVBvaW50c1tjaF07CiAgICAgICAgaWYgKHNob3VsZEVzY2FwZSA9PT0gdHJ1ZSkgewogICAgICAgICAgb3V0LnB1c2goIiYjIiwgY2gsICI7Iik7CiAgICAgICAgfSBlbHNlIGlmIChzaG91bGRFc2NhcGUgIT09IGZhbHNlKSB7CiAgICAgICAgICAvLyB1bmRlZmluZWQgb3IgbnVsbCBhcmUgT0suCiAgICAgICAgICBvdXQucHVzaChzdHIuY2hhckF0KGkpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG91dC5qb2luKCIiKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXZlcnNlcyBlc2NhcGVTdHJpbmcKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gdW5lc2NhcGUuCiAgICAgKi8KICAgIHVuZXNjYXBlU3RyaW5nIDogZnVuY3Rpb24oc3RyKSB7CiAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvJiMoWzAtOV0rKTsvZywgdW5lc2NhcGVFbnRpdHkpOwogICAgfQogIH07Cn0oKTsKLy8gSW5pdGlhbGl6ZSB1cmwgcGFyYW1ldGVycyBzbyB0aGF0IGhhc2ggZGF0YSBpcyBwdWxsZWQgaW4gYmVmb3JlIGl0IGNhbiBiZQovLyBhbHRlcmVkIGJ5IGEgY2xpY2suCmdhZGdldHMudXRpbC5nZXRVcmxQYXJhbWV0ZXJzKCk7CgoKLyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4KICogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQogKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zCiAqIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCi8qKgogKiBAZmlsZW92ZXJ2aWV3CiAqIFRoZSBnbG9iYWwgb2JqZWN0IGdhZGdldHMuanNvbiBjb250YWlucyB0d28gbWV0aG9kcy4KICoKICogZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeSh2YWx1ZSkgdGFrZXMgYSBKYXZhU2NyaXB0IHZhbHVlIGFuZCBwcm9kdWNlcyBhIEpTT04KICogdGV4dC4gVGhlIHZhbHVlIG11c3Qgbm90IGJlIGN5Y2xpY2FsLgogKgogKiBnYWRnZXRzLmpzb24ucGFyc2UodGV4dCkgdGFrZXMgYSBKU09OIHRleHQgYW5kIHByb2R1Y2VzIGEgSmF2YVNjcmlwdCB2YWx1ZS4KICogSXQgd2lsbCByZXR1cm4gZmFsc2UgaWYgdGhlcmUgaXMgYW4gZXJyb3IuCiovCgp2YXIgZ2FkZ2V0cyA9IGdhZGdldHMgfHwge307CgovKioKICogQHN0YXRpYwogKiBAY2xhc3MgUHJvdmlkZXMgb3BlcmF0aW9ucyBmb3IgdHJhbnNsYXRpbmcgb2JqZWN0cyB0byBhbmQgZnJvbSBKU09OLgogKiBAbmFtZSBnYWRnZXRzLmpzb24KICovCgovKioKICogUG9ydCBvZiB0aGUgcHVibGljIGRvbWFpbiBKU09OIGxpYnJhcnkgYnkgRG91Z2xhcyBDcm9ja2ZvcmQuCiAqIFNlZTogaHR0cDovL3d3dy5qc29uLm9yZy9qc29uMi5qcwogKi8KZ2FkZ2V0cy5qc29uID0gZnVuY3Rpb24gKCkgewoKICAvKioKICAgKiBGb3JtYXRzIGludGVnZXJzIHRvIDIgZGlnaXRzLgogICAqIEBwYXJhbSB7TnVtYmVyfSBuCiAgICovCiAgZnVuY3Rpb24gZihuKSB7CiAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgfQoKICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gW3RoaXMuZ2V0VVRDRnVsbFllYXIoKSwgJy0nLAogICAgICAgICAgIGYodGhpcy5nZXRVVENNb250aCgpICsgMSksICctJywKICAgICAgICAgICBmKHRoaXMuZ2V0VVRDRGF0ZSgpKSwgJ1QnLAogICAgICAgICAgIGYodGhpcy5nZXRVVENIb3VycygpKSwgJzonLAogICAgICAgICAgIGYodGhpcy5nZXRVVENNaW51dGVzKCkpLCAnOicsCiAgICAgICAgICAgZih0aGlzLmdldFVUQ1NlY29uZHMoKSksICdaJ10uam9pbigiIik7CiAgfTsKCiAgLy8gdGFibGUgb2YgY2hhcmFjdGVyIHN1YnN0aXR1dGlvbnMKICB2YXIgbSA9IHsKICAgICdcYic6ICdcXGInLAogICAgJ1x0JzogJ1xcdCcsCiAgICAnXG4nOiAnXFxuJywKICAgICdcZic6ICdcXGYnLAogICAgJ1xyJzogJ1xccicsCiAgICAnIicgOiAnXFwiJywKICAgICdcXCc6ICdcXFxcJwogIH07CgogIC8qKgogICAqIENvbnZlcnRzIGEganNvbiBvYmplY3QgaW50byBhIHN0cmluZy4KICAgKi8KICBmdW5jdGlvbiBzdHJpbmdpZnkodmFsdWUpIHsKICAgIHZhciBhLCAgICAgICAgICAvLyBUaGUgYXJyYXkgaG9sZGluZyB0aGUgcGFydGlhbCB0ZXh0cy4KICAgICAgICBpLCAgICAgICAgICAvLyBUaGUgbG9vcCBjb3VudGVyLgogICAgICAgIGssICAgICAgICAgIC8vIFRoZSBtZW1iZXIga2V5LgogICAgICAgIGwsICAgICAgICAgIC8vIExlbmd0aC4KICAgICAgICByID0gL1siXFxceDAwLVx4MWZceDdmLVx4OWZdL2csCiAgICAgICAgdjsgICAgICAgICAgLy8gVGhlIG1lbWJlciB2YWx1ZS4KCiAgICBzd2l0Y2ggKHR5cGVvZiB2YWx1ZSkgewogICAgY2FzZSAnc3RyaW5nJzoKICAgIC8vIElmIHRoZSBzdHJpbmcgY29udGFpbnMgbm8gY29udHJvbCBjaGFyYWN0ZXJzLCBubyBxdW90ZSBjaGFyYWN0ZXJzLCBhbmQgbm8KICAgIC8vIGJhY2tzbGFzaCBjaGFyYWN0ZXJzLCB0aGVuIHdlIGNhbiBzYWZlbHkgc2xhcCBzb21lIHF1b3RlcyBhcm91bmQgaXQuCiAgICAvLyBPdGhlcndpc2Ugd2UgbXVzdCBhbHNvIHJlcGxhY2UgdGhlIG9mZmVuZGluZyBjaGFyYWN0ZXJzIHdpdGggc2FmZSBvbmVzLgogICAgICByZXR1cm4gci50ZXN0KHZhbHVlKSA/CiAgICAgICAgICAnIicgKyB2YWx1ZS5yZXBsYWNlKHIsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHZhciBjID0gbVthXTsKICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjID0gYS5jaGFyQ29kZUF0KCk7CiAgICAgICAgICAgIHJldHVybiAnXFx1MDAnICsgTWF0aC5mbG9vcihjIC8gMTYpLnRvU3RyaW5nKDE2KSArCiAgICAgICAgICAgICAgICAoYyAlIDE2KS50b1N0cmluZygxNik7CiAgICAgICAgICAgIH0pICsgJyInCiAgICAgICAgICA6ICciJyArIHZhbHVlICsgJyInOwogICAgY2FzZSAnbnVtYmVyJzoKICAgIC8vIEpTT04gbnVtYmVycyBtdXN0IGJlIGZpbml0ZS4gRW5jb2RlIG5vbi1maW5pdGUgbnVtYmVycyBhcyBudWxsLgogICAgICByZXR1cm4gaXNGaW5pdGUodmFsdWUpID8gU3RyaW5nKHZhbHVlKSA6ICdudWxsJzsKICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgY2FzZSAnbnVsbCc6CiAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOwogICAgY2FzZSAnb2JqZWN0JzoKICAgIC8vIER1ZSB0byBhIHNwZWNpZmljYXRpb24gYmx1bmRlciBpbiBFQ01BU2NyaXB0LAogICAgLy8gdHlwZW9mIG51bGwgaXMgJ29iamVjdCcsIHNvIHdhdGNoIG91dCBmb3IgdGhhdCBjYXNlLgogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgfQogICAgICAvLyB0b0pTT04gY2hlY2sgcmVtb3ZlZDsgcmUtaW1wbGVtZW50IHdoZW4gaXQgZG9lc24ndCBicmVhayBvdGhlciBsaWJzLgogICAgICBhID0gW107CiAgICAgIGlmICh0eXBlb2YgdmFsdWUubGVuZ3RoID09PSAnbnVtYmVyJyAmJgogICAgICAgICAgISh2YWx1ZS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgnbGVuZ3RoJykpKSB7CiAgICAgICAgLy8gVGhlIG9iamVjdCBpcyBhbiBhcnJheS4gU3RyaW5naWZ5IGV2ZXJ5IGVsZW1lbnQuIFVzZSBudWxsIGFzIGEKICAgICAgICAvLyBwbGFjZWhvbGRlciBmb3Igbm9uLUpTT04gdmFsdWVzLgogICAgICAgIGwgPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGw7IGkgKz0gMSkgewogICAgICAgICAgYS5wdXNoKHN0cmluZ2lmeSh2YWx1ZVtpXSkgfHwgJ251bGwnKTsKICAgICAgICB9CiAgICAgICAgLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyIGFuZCB3cmFwIHRoZW0gaW4gYnJhY2tldHMuCiAgICAgICAgcmV0dXJuICdbJyArIGEuam9pbignLCcpICsgJ10nOwogICAgICB9CiAgICAgIC8vIE90aGVyd2lzZSwgaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUga2V5cyBpbiB0aGUgb2JqZWN0LgogICAgICBmb3IgKGsgaW4gdmFsdWUpIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgIGlmICh0eXBlb2YgayA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHYgPSBzdHJpbmdpZnkodmFsdWVba10pOwogICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgYS5wdXNoKHN0cmluZ2lmeShrKSArICc6JyArIHYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvLyBKb2luIGFsbCBvZiB0aGUgbWVtYmVyIHRleHRzIHRvZ2V0aGVyIGFuZCB3cmFwIHRoZW0gaW4gYnJhY2VzLgogICAgICByZXR1cm4gJ3snICsgYS5qb2luKCcsJykgKyAnfSc7CiAgICB9CiAgfQoKICByZXR1cm4gewogICAgc3RyaW5naWZ5OiBzdHJpbmdpZnksCiAgICBwYXJzZTogZnVuY3Rpb24gKHRleHQpIHsKLy8gUGFyc2luZyBoYXBwZW5zIGluIHRocmVlIHN0YWdlcy4gSW4gdGhlIGZpcnN0IHN0YWdlLCB3ZSBydW4gdGhlIHRleHQgYWdhaW5zdAovLyByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbG9vayBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5Ci8vIGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JwovLyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4gQnV0IGp1c3QgdG8gYmUgc2FmZSwgd2Ugd2FudCB0byByZWplY3QgYWxsCi8vIHVuZXhwZWN0ZWQgZm9ybXMuCgovLyBXZSBzcGxpdCB0aGUgZmlyc3Qgc3RhZ2UgaW50byA0IHJlZ2V4cCBvcGVyYXRpb25zIGluIG9yZGVyIHRvIHdvcmsgYXJvdW5kCi8vIGNyaXBwbGluZyBpbmVmZmljaWVuY2llcyBpbiBJRSdzIGFuZCBTYWZhcmkncyByZWdleHAgZW5naW5lcy4gRmlyc3Qgd2UKLy8gcmVwbGFjZSBhbGwgYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAovLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgogICAgICBpZiAoL15bXF0sOnt9XHNdKiQvLnRlc3QodGV4dC5yZXBsYWNlKC9cXFsiXFxcL2ItdV0vZywgJ0AnKS4KICAgICAgICAgIHJlcGxhY2UoLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLCAnXScpLgogICAgICAgICAgcmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAnJykpKSB7CiAgICAgICAgcmV0dXJuIGV2YWwoJygnICsgdGV4dCArICcpJyk7CiAgICAgIH0KICAgICAgLy8gSWYgdGhlIHRleHQgaXMgbm90IEpTT04gcGFyc2VhYmxlLCB0aGVuIHJldHVybiBmYWxzZS4KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9Owp9KCk7CgoKLyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgovKioKICogQGZpbGVvdmVydmlldyBSZW1vdGUgcHJvY2VkdXJlIGNhbGwgbGlicmFyeSBmb3IgZ2FkZ2V0LXRvLWNvbnRhaW5lciwKICogY29udGFpbmVyLXRvLWdhZGdldCwgYW5kIGdhZGdldC10by1nYWRnZXQgKHRocnUgY29udGFpbmVyKSBjb21tdW5pY2F0aW9uLgogKi8KCnZhciBnYWRnZXRzID0gZ2FkZ2V0cyB8fCB7fTsKCi8qKgogKiBAc3RhdGljCiAqIEBjbGFzcyBQcm92aWRlcyBvcGVyYXRpb25zIGZvciBtYWtpbmcgcnBjIGNhbGxzLgogKiBAbmFtZSBnYWRnZXRzLnJwYwogKi8KZ2FkZ2V0cy5ycGMgPSBmdW5jdGlvbigpIHsKICAvL2FsZXJ0KCJJbml0aW5nIGdhZGdldHMucnBjIik7CiAgLy8gR2VuZXJhbCBjb25zdGFudHMuCiAgdmFyIENBTExCQUNLX05BTUUgPSAnX19jYic7CiAgdmFyIERFRkFVTFRfTkFNRSA9ICcnOwoKICAvLyBDb25zdHMgZm9yIEZyYW1lRWxlbWVudC4KICB2YXIgRkVfRzJDX0NIQU5ORUwgPSAnX19nMmNfcnBjJzsKICB2YXIgRkVfQzJHX0NIQU5ORUwgPSAnX19jMmdfcnBjJzsKCiAgLy8gQ29uc3RzIGZvciBOSVguIFZCU2NyaXB0IGRvZXNuJ3QKICAvLyBhbGxvdyBpdGVtcyB0byBzdGFydCB3aXRoIF8gZm9yIHNvbWUgcmVhc29uLAogIC8vIHNvIHdlIG5lZWQgdG8gbWFrZSB0aGVzZSBuYW1lcyBxdWl0ZSB1bmlxdWUsIGFzCiAgLy8gdGhleSB3aWxsIGdvIGludG8gdGhlIGdsb2JhbCBuYW1lc3BhY2UuCiAgdmFyIE5JWF9XUkFQUEVSID0gJ0dSUENfX19fTklYVkJTX3dyYXBwZXInOwogIHZhciBOSVhfR0VUX1dSQVBQRVIgPSAnR1JQQ19fX19OSVhWQlNfZ2V0X3dyYXBwZXInOwogIHZhciBOSVhfSEFORExFX01FU1NBR0UgPSAnR1JQQ19fX19OSVhWQlNfaGFuZGxlX21lc3NhZ2UnOwogIHZhciBOSVhfQ1JFQVRFX0NIQU5ORUwgPSAnR1JQQ19fX19OSVhWQlNfY3JlYXRlX2NoYW5uZWwnOwoKICAvLyBKYXZhU2NyaXB0IHJlZmVyZW5jZSB0byB0aGUgTklYIFZCU2NyaXB0IHdyYXBwZXJzLgogIC8vIEdhZGdldHMgd2lsbCBoYXZlIGJ1dCBhIHNpbmdsZSBjaGFubmVsIHVuZGVyCiAgLy8gbml4X2NoYW5uZWxzWycuLiddIHdoaWxlIGNvbnRhaW5lcnMgd2lsbCBoYXZlIGEgY2hhbm5lbAogIC8vIHBlciBnYWRnZXQgc3RvcmVkIHVuZGVyIHRoZSBnYWRnZXQncyBJRC4KICB2YXIgbml4X2NoYW5uZWxzID0ge307CgogIHZhciBzZXJ2aWNlcyA9IHt9OwogIHZhciBpZnJhbWVQb29sID0gW107CiAgdmFyIHJlbGF5VXJsID0ge307CiAgdmFyIHVzZUxlZ2FjeVByb3RvY29sID0ge307CiAgdmFyIGF1dGhUb2tlbiA9IHt9OwogIHZhciBjYWxsSWQgPSAwOwogIHZhciBjYWxsYmFja3MgPSB7fTsKICB2YXIgc2V0dXAgPSB7fTsKICB2YXIgc2FtZURvbWFpbiA9IHt9OwogIHZhciBwYXJhbXMgPSB7fTsKCiAgLy8gTG9hZCB0aGUgYXV0aGVudGljYXRpb24gdG9rZW4gZm9yIHNwZWFraW5nIHRvIHRoZSBjb250YWluZXIKICAvLyBmcm9tIHRoZSBnYWRnZXQncyBwYXJhbWV0ZXJzLCBvciBkZWZhdWx0IHRvICcwJyBpZiBub3QgZm91bmQuCiAgaWYgKGdhZGdldHMudXRpbCkgewogICAgcGFyYW1zID0gZ2FkZ2V0cy51dGlsLmdldFVybFBhcmFtZXRlcnMoKTsKCS8vYWxlcnQoImdhZGdldCBwYXJhbXM6ICIgKyBwYXJhbXMpOwogIH0KCiAgYXV0aFRva2VuWycuLiddID0gcGFyYW1zLnJwY3Rva2VuIHx8IHBhcmFtcy5pZnBjdG9rIHx8IDA7CgogIC8vaWZwYyBtb2RzCiAgdmFyIFVSTF9MSU1JVCA9IDIwMDA7CiAgdmFyIG1lc3NhZ2VzSW4gPSB7fTsKICB2YXIgdXNlTXVsdGlQYXJ0TWVzc2FnZXMgPSB7fTsKICAvL2lmcGMgbW9kcwoKCiAgLyoKICAgKiBSZXR1cm4gYSBzaG9ydCBjb2RlIHJlcHJlc2VudGluZyB0aGUgYmVzdCBhdmFpbGFibGUgY3Jvc3MtZG9tYWluCiAgICogbWVzc2FnZSB0cmFuc3BvcnQgYXZhaWxhYmxlIHRvIHRoZSBicm93c2VyLgogICAqCiAgICogKyBGb3IgdGhvc2UgYnJvd3NlcnMgdGhhdCBzdXBwb3J0IG5hdGl2ZSBtZXNzYWdpbmcgKHZhcmlvdXMgaW1wbGVtZW50YXRpb25zCiAgICogICBvZiB0aGUgSFRNTDUgcG9zdE1lc3NhZ2UgbWV0aG9kKSwgdXNlIHRoYXQuIE9mZmljaWFsbHkgZGVmaW5lZCBhdAogICAqICAgaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvY29tbXMuaHRtbC4KICAgKgogICAqICAgcG9zdE1lc3NhZ2UgaXMgYSBuYXRpdmUgaW1wbGVtZW50YXRpb24gb2YgWERDLiBBIHBhZ2UgcmVnaXN0ZXJzIHRoYXQKICAgKiAgIGl0IHdvdWxkIGxpa2UgdG8gcmVjZWl2ZSBtZXNzYWdlcyBieSBsaXN0ZW5pbmcgdGhlIHRoZSAibWVzc2FnZSIgZXZlbnQKICAgKiAgIG9uIHRoZSB3aW5kb3cgKGRvY3VtZW50IGluIERQTSkgb2JqZWN0LiBJbiB0dXJuLCBhbm90aGVyIHBhZ2UgY2FuCiAgICogICByYWlzZSB0aGF0IGV2ZW50IGJ5IGNhbGxpbmcgd2luZG93LnBvc3RNZXNzYWdlIChkb2N1bWVudC5wb3N0TWVzc2FnZQogICAqICAgaW4gRFBNKSB3aXRoIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgbWVzc2FnZSBhbmQgYSBzdHJpbmcKICAgKiAgIGluZGljYXRpbmcgb24gd2hpY2ggZG9tYWluIHRoZSByZWNlaXZpbmcgcGFnZSBtdXN0IGJlIHRvIHJlY2VpdmUKICAgKiAgIHRoZSBtZXNzYWdlLiBUaGUgdGFyZ2V0IHBhZ2Ugd2lsbCB0aGVuIGhhdmUgaXRzICJtZXNzYWdlIiBldmVudCByYWlzZWQKICAgKiAgIGlmIHRoZSBkb21haW4gbWF0Y2hlcyBhbmQgY2FuLCBpbiB0dXJuLCBjaGVjayB0aGUgb3JpZ2luIG9mIHRoZSBtZXNzYWdlCiAgICogICBhbmQgcHJvY2VzcyB0aGUgZGF0YSBjb250YWluZWQgd2l0aGluLgogICAqCiAgICogICAgIHdwbTogcG9zdE1lc3NhZ2Ugb24gdGhlIHdpbmRvdyBvYmplY3QuCiAgICogICAgICAgIC0gSW50ZXJuZXQgRXhwbG9yZXIgOCsKICAgKiAgICAgICAgLSBTYWZhcmkgKGxhdGVzdCBuaWdodGxpZXMgYXMgb2YgMjYvNi8yMDA4KQogICAqICAgICAgICAtIEZpcmVmb3ggMysKICAgKiAgICAgICAgLSBPcGVyYSA5KwogICAqCiAgICogICAgIGRwbTogcG9zdE1lc3NhZ2Ugb24gdGhlIGRvY3VtZW50IG9iamVjdC4KICAgKiAgICAgICAgLSBPcGVyYSA4KwogICAqCiAgICogKyBGb3IgSW50ZXJuZXQgRXhwbG9yZXIgYmVmb3JlIHZlcnNpb24gOCwgdGhlIHNlY3VyaXR5IG1vZGVsIGFsbG93cyBhbnlvbmUKICAgKiAgIHBhcmVudCB0byBzZXQgdGhlIHZhbHVlIG9mIHRoZSAib3BlbmVyIiBwcm9wZXJ0eSBvbiBhbm90aGVyIHdpbmRvdywKICAgKiAgIHdpdGggb25seSB0aGUgcmVjZWl2aW5nIHdpbmRvdyBhYmxlIHRvIHJlYWQgaXQuCiAgICogICBUaGlzIG1ldGhvZCBpcyBkdWJiZWQgIk5hdGl2ZSBJRSBYREMiIChOSVgpLgogICAqCiAgICogICBUaGlzIG1ldGhvZCB3b3JrcyBieSBwbGFjaW5nIGEgaGFuZGxlciBvYmplY3QgaW4gdGhlICJvcGVuZXIiIHByb3BlcnR5CiAgICogICBvZiBhIGdhZGdldCB3aGVuIHRoZSBjb250YWluZXIgc2V0cyB1cCB0aGUgYXV0aGVudGljYXRpb24gaW5mb3JtYXRpb24KICAgKiAgIGZvciB0aGF0IGdhZGdldCAoYnkgY2FsbGluZyBzZXRBdXRoVG9rZW4oLi4uKSkuIEF0IHRoYXQgcG9pbnQsIGEgTklYCiAgICogICB3cmFwcGVyIGlzIGNyZWF0ZWQgYW5kIHBsYWNlZCBpbnRvIHRoZSBnYWRnZXQgYnkgY2FsbGluZwogICAqICAgdGhlZnJhbWUuY29udGVudFdpbmRvdy5vcGVuZXIgPSB3cmFwcGVyLiBOb3RlIHRoYXQgYXMgYSByZXN1bHQsIE5JWCBjYW4KICAgKiAgIG9ubHkgYmUgdXNlZCBieSBhIGNvbnRhaW5lciB0byBjYWxsIGEgcGFydGljdWxhciBnYWRnZXQgKmFmdGVyKiB0aGF0CiAgICogICBnYWRnZXQgaGFzIGNhbGxlZCB0aGUgY29udGFpbmVyIGF0IGxlYXN0IG9uY2UgdmlhIE5JWC4KICAgKgogICAqICAgVGhlIE5JWCB3cmFwcGVycyBpbiB0aGlzIFJQQyBpbXBsZW1lbnRhdGlvbiBhcmUgaW5zdGFuY2VzIG9mIGEgVkJTY3JpcHQKICAgKiAgIGNsYXNzIHRoYXQgaXMgY3JlYXRlZCB3aGVuIHRoaXMgaW1wbGVtZW50YXRpb24gbG9hZHMuIFRoZSByZWFzb24gZm9yCiAgICogICB1c2luZyBhIFZCU2NyaXB0IGNsYXNzIHN0ZW1zIGZyb20gdGhlIGZhY3QgdGhhdCBhbnkgb2JqZWN0IGNhbiBiZSBwYXNzZWQKICAgKiAgIGludG8gdGhlIG9wZW5lciBwcm9wZXJ0eS4KICAgKiAgIFdoaWxlIHRoaXMgaXMgYSBnb29kIHRoaW5nLCBhcyBpdCBsZXRzIHVzIHBhc3MgZnVuY3Rpb25zIGFuZCBzZXR1cCBhIHRydWUKICAgKiAgIGJpZGlyZWN0aW9uYWwgY2hhbm5lbCB2aWEgY2FsbGJhY2tzLCBpdCBvcGVucyBhIHBvdGVudGlhbCBzZWN1cml0eSBob2xlCiAgICogICBieSB3aGljaCB0aGUgb3RoZXIgcGFnZSBjYW4gZ2V0IGFob2xkIG9mIHRoZSAid2luZG93IiBvciAiZG9jdW1lbnQiCiAgICogICBvYmplY3RzIGluIHRoZSBwYXJlbnQgcGFnZSBhbmQgaW4gdHVybiB3cmVhayBoYXZvay4gVGhpcyBpcyBkdWUgdG8gdGhlCiAgICogICBmYWN0IHRoYXQgYW55IEpTIG9iamVjdCB1c2VmdWwgZm9yIGVzdGFibGlzaGluZyBzdWNoIGEgYmlkaXJlY3Rpb25hbAogICAqICAgY2hhbm5lbCAoc3VjaCBhcyBhIGZ1bmN0aW9uKSBjYW4gYmUgdXNlZCB0byBhY2Nlc3MgYSBmdW5jdGlvbgogICAqICAgKGVnLiBvYmoudG9TdHJpbmcsIG9yIGEgZnVuY3Rpb24gaXRzZWxmKSBjcmVhdGVkIGluIGEgc3BlY2lmaWMgY29udGV4dCwKICAgKiAgIGluIHBhcnRpY3VsYXIgdGhlIGdsb2JhbCBjb250ZXh0IG9mIHRoZSBzZW5kZXIuIFN1cHBvc2UgY29udGFpbmVyCiAgICogICBkb21haW4gQyBwYXNzZXMgb2JqZWN0IG9iaiB0byBnYWRnZXQgb24gZG9tYWluIEcuIFRoZW4gdGhlIGdhZGdldCBjYW4KICAgKiAgIGFjY2VzcyBDJ3MgZ2xvYmFsIGNvbnRleHQgdXNpbmc6CiAgICogICB2YXIgcGFyZW50V2luZG93ID0gKG5ldyBvYmoudG9TdHJpbmcuY29uc3RydWN0b3IoInJldHVybiB3aW5kb3c7IikpKCk7CiAgICogICBOdWxsaW5nIG91dCBhbGwgb2Ygb2JqJ3MgcHJvcGVydGllcyBkb2Vzbid0IGZpeCB0aGlzLCBzaW5jZSBJRSBoZWxwZnVsbHkKICAgKiAgIHJlc3RvcmVzIHRoZW0gdG8gdGhlaXIgb3JpZ2luYWwgdmFsdWVzIGlmIHlvdSBkbyBzb21ldGhpbmcgbGlrZToKICAgKiAgIGRlbGV0ZSBvYmoudG9TdHJpbmc7IGRlbGV0ZSBvYmoudG9TdHJpbmc7CiAgICogICBUaHVzLCB3ZSB3cmFwIHRoZSBuZWNlc3NhcnkgZnVuY3Rpb25zIGFuZCBpbmZvcm1hdGlvbiBpbnNpZGUgYSBWQlNjcmlwdAogICAqICAgb2JqZWN0LiBWQlNjcmlwdCBvYmplY3RzIGluIElFLCBsaWtlIERPTSBvYmplY3RzLCBhcmUgaW4gZmFjdCBDT00KICAgKiAgIHdyYXBwZXJzIHdoZW4gdXNlZCBpbiBKYXZhU2NyaXB0LCBzbyB3ZSBjYW4gc2FmZWx5IHBhc3MgdGhlbSBhcm91bmQKICAgKiAgIHdpdGhvdXQgd29ycnlpbmcgYWJvdXQgYSBicmVhY2ggb2YgY29udGV4dCB3aGlsZSBhdCB0aGUgc2FtZSB0aW1lCiAgICogICBhbGxvd2luZyB0aGVtIHRvIGFjdCBhcyBhIHBhc3MtdGhyb3VnaCBtZWNoYW5pc20gZm9yIGluZm9ybWF0aW9uCiAgICogICBhbmQgZnVuY3Rpb24gY2FsbHMuIFRoZSBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIG9mIHRoaXMgVkJTY3JpcHQgd3JhcHBlcgogICAqICAgY2FuIGJlIGZvdW5kIGluIHRoZSBzZXR1cENoYW5uZWwoKSBtZXRob2QgYmVsb3cuCiAgICoKICAgKiAgICAgbml4OiBJbnRlcm5ldCBFeHBsb3Jlci1zcGVjaWZpYyB3aW5kb3cub3BlbmVyIHRyaWNrLgogICAqICAgICAgIC0gSW50ZXJuZXQgRXhwbG9yZXIgNgogICAqICAgICAgIC0gSW50ZXJuZXQgRXhwbG9yZXIgNwogICAqCiAgICogKyBGb3IgR2Vja28tYmFzZWQgYnJvd3NlcnMsIHRoZSBzZWN1cml0eSBtb2RlbCBhbGxvd3MgYSBjaGlsZCB0byBjYWxsIGEKICAgKiAgIGZ1bmN0aW9uIG9uIHRoZSBmcmFtZUVsZW1lbnQgb2YgdGhlIGlmcmFtZSwgZXZlbiBpZiB0aGUgY2hpbGQgaXMgaW4KICAgKiAgIGEgZGlmZmVyZW50IGRvbWFpbi4gVGhpcyBtZXRob2QgaXMgZHViYmVkICJmcmFtZUVsZW1lbnQiIChmZSkuCiAgICoKICAgKiAgIFRoZSBhYmlsaXR5IHRvIGFkZCBhbmQgY2FsbCBzdWNoIGZ1bmN0aW9ucyBvbiB0aGUgZnJhbWVFbGVtZW50IGFsbG93cwogICAqICAgYSBiaWRpcmVjdGlvbmFsIGNoYW5uZWwgdG8gYmUgc2V0dXAgdmlhIHRoZSBhZGRpbmcgb2Ygc2ltcGxlIGZ1bmN0aW9uCiAgICogICByZWZlcmVuY2VzIG9uIHRoZSBmcmFtZUVsZW1lbnQgb2JqZWN0IGl0c2VsZi4gSW4gdGhpcyBpbXBsZW1lbnRhdGlvbiwKICAgKiAgIHdoZW4gdGhlIGNvbnRhaW5lciBzZXRzIHVwIHRoZSBhdXRoZW50aWNhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhhdCBnYWRnZXQKICAgKiAgIChieSBjYWxsaW5nIHNldEF1dGgoLi4uKSkgaXQgYXMgd2VsbCBhZGRzIGEgc3BlY2lhbCBmdW5jdGlvbiBvbiB0aGUKICAgKiAgIGdhZGdldCdzIGlmcmFtZS4gVGhpcyBmdW5jdGlvbiBjYW4gdGhlbiBiZSB1c2VkIGJ5IHRoZSBnYWRnZXQgdG8gc2VuZAogICAqICAgbWVzc2FnZXMgdG8gdGhlIGNvbnRhaW5lci4gSW4gdHVybiwgd2hlbiB0aGUgZ2FkZ2V0IHRyaWVzIHRvIHNlbmQgYQogICAqICAgbWVzc2FnZSwgaXQgY2hlY2tzIHRvIHNlZSBpZiB0aGlzIGZ1bmN0aW9uIGhhcyBpdHMgb3duIGZ1bmN0aW9uIHN0b3JlZAogICAqICAgdGhhdCBjYW4gYmUgdXNlZCBieSB0aGUgY29udGFpbmVyIHRvIGNhbGwgdGhlIGdhZGdldC4gSWYgbm90LCB0aGUKICAgKiAgIGZ1bmN0aW9uIGlzIGNyZWF0ZWQgYW5kIHN1YnNlcXVlbnRseSB1c2VkIGJ5IHRoZSBjb250YWluZXIuCiAgICogICBOb3RlIHRoYXQgYXMgYSByZXN1bHQsIEZFIGNhbiBvbmx5IGJlIHVzZWQgYnkgYSBjb250YWluZXIgdG8gY2FsbCBhCiAgICogICBwYXJ0aWN1bGFyIGdhZGdldCAqYWZ0ZXIqIHRoYXQgZ2FkZ2V0IGhhcyBjYWxsZWQgdGhlIGNvbnRhaW5lciBhdAogICAqICAgbGVhc3Qgb25jZSB2aWEgRkUuCiAgICoKICAgKiAgICAgZmU6IEdlY2tvLXNwZWNpZmljIGZyYW1lRWxlbWVudCB0cmljay4KICAgKiAgICAgICAgLSBGaXJlZm94IDErCiAgICoKICAgKiArIEZvciBhbGwgb3RoZXJzLCB3ZSBoYXZlIGEgZmFsbGJhY2sgbWVjaGFuaXNtIGtub3duIGFzICJpZnBjIi4gSUZQQwogICAqICAgZXhwbG9pdHMgdGhlIGZhY3QgdGhhdCB3aGlsZSBzYW1lLW9yaWdpbiBwb2xpY3kgcHJvaGliaXRzIGEgZnJhbWUgZnJvbQogICAqICAgYWNjZXNzaW5nIG1lbWJlcnMgb24gYSB3aW5kb3cgbm90IGluIHRoZSBzYW1lIGRvbWFpbiwgdGhhdCBmcmFtZSBjYW4sCiAgICogICBob3dldmVyLCBuYXZpZ2F0ZSB0aGUgd2luZG93IGhlaXJhcmNoeSAodmlhIHBhcmVudCkuIFRoaXMgaXMgZXhwbG9pdGVkIGJ5CiAgICogICBoYXZpbmcgYSBwYWdlIG9uIGRvbWFpbiBBIHRoYXQgd2FudHMgdG8gdGFsayB0byBkb21haW4gQiBjcmVhdGUgYW4gaWZyYW1lCiAgICogICBvbiBkb21haW4gQiBwb2ludGluZyB0byBhIHNwZWNpYWwgcmVsYXkgZmlsZSBhbmQgd2l0aCBhIG1lc3NhZ2UgZW5jb2RlZAogICAqICAgYWZ0ZXIgdGhlIGhhc2ggKCMpLiBUaGlzIHJlbGF5LCBpbiB0dXJuLCBmaW5kcyB0aGUgcGFnZSBvbiBkb21haW4gQiwgYW5kCiAgICogICBjYW4gY2FsbCBhIHJlY2VpcHQgZnVuY3Rpb24gd2l0aCB0aGUgbWVzc2FnZSBnaXZlbiB0byBpdC4gVGhlIHJlbGF5IFVSTAogICAqICAgdXNlZCBieSBlYWNoIGNhbGxlciBpcyBzZXQgdmlhIHRoZSBnYWRnZXRzLnJwYy5zZXRSZWxheVVybCguLikgYW5kCiAgICogICAqbXVzdCogYmUgY2FsbGVkIGJlZm9yZSB0aGUgY2FsbCBtZXRob2QgaXMgdXNlZC4KICAgKgogICAqICAgICBpZnBjOiBJZnJhbWUtYmFzZWQgbWV0aG9kLCB1dGlsaXppbmcgYSByZWxheSBwYWdlLCB0byBzZW5kIGEgbWVzc2FnZS4KICAgKi8KICBmdW5jdGlvbiBnZXRSZWxheUNoYW5uZWwoKSB7Ci8vICAgIHJldHVybiAnaWZwYyc7CiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdy5wb3N0TWVzc2FnZSA9PT0gJ2Z1bmN0aW9uJyA/ICd3cG0nIDoKICAgICAgICAgICB0eXBlb2Ygd2luZG93LnBvc3RNZXNzYWdlID09PSAnb2JqZWN0JyA/ICd3cG0nOgogICAgICAgICAgIHR5cGVvZiBkb2N1bWVudC5wb3N0TWVzc2FnZSA9PT0gJ2Z1bmN0aW9uJyA/ICdkcG0nIDoKICAgICAgICAgICB3aW5kb3cuQWN0aXZlWE9iamVjdCA/ICduaXgnIDoKICAgICAgICAgICBuYXZpZ2F0b3IucHJvZHVjdCA9PT0gJ0dlY2tvJyA/ICdmZScgOgogICAgICAgICAgICdpZnBjJzsKICB9CgogIC8qKgogICAqIENvbmR1Y3RzIGFueSBpbml0aWFsIGdsb2JhbCB3b3JrIG5lY2Vzc2FyeSB0byBzZXR1cCB0aGUKICAgKiBjaGFubmVsIHR5cGUgY2hvc2VuLgogICAqLwogIGZ1bmN0aW9uIHNldHVwQ2hhbm5lbCgpIHsKICAgIC8vIElmIHRoZSBjaGFubmVsIHR5cGUgaXMgb25lIG9mIHRoZSBuYXRpdmUKICAgIC8vIHBvc3RNZXNzYWdlIGJhc2VkIG9uZXMsIHNldHVwIHRoZSBoYW5kbGVyIHRvIHJlY2VpdmUKICAgIC8vIG1lc3NhZ2VzLgogICAgaWYgKHJlbGF5Q2hhbm5lbCA9PT0gJ2RwbScgfHwgcmVsYXlDaGFubmVsID09PSAnd3BtJykgewogICAgICB2YXIgb25tZXNzYWdlID0gZnVuY3Rpb24gKHBhY2tldCkgewogICAgICAgIC8vIFRPRE8gdmFsaWRhdGUgcGFja2V0LmRvbWFpbiBmb3Igc2VjdXJpdHkgcmVhc29ucwogICAgICAgIHByb2Nlc3MoZ2FkZ2V0cy5qc29uLnBhcnNlKHBhY2tldC5kYXRhKSk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2Ygd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG9ubWVzc2FnZSwgZmFsc2UpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cuYXR0YWNoRXZlbnQgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29ubWVzc2FnZScsIG9ubWVzc2FnZSk7CiAgICAgIH0KCiAgICB9CgogICAgLy8gSWYgdGhlIGNoYW5uZWwgdHlwZSBpcyBOSVgsIHdlIG5lZWQgdG8gZW5zdXJlIHRoZQogICAgLy8gVkJTY3JpcHQgd3JhcHBlciBjb2RlIGlzIGluIHRoZSBwYWdlIGFuZCB0aGF0IHRoZQogICAgLy8gZ2xvYmFsIEphdmFzY3JpcHQgaGFuZGxlcnMgaGF2ZSBiZWVuIHNldC4KICAgIGlmIChyZWxheUNoYW5uZWwgPT09ICduaXgnKSB7CgogICAgICAgLy9hbGVydCgnbml4IHNldHVwIScpOwoKICAgICAgLy8gVkJTY3JpcHQgbWV0aG9kcyByZXR1cm4gYSB0eXBlIG9mICd1bmtub3duJyB3aGVuCiAgICAgIC8vIGNoZWNrZWQgdmlhIHRoZSB0eXBlb2Ygb3BlcmF0b3IgaW4gSUUuIEZvcnR1bmF0ZWx5CiAgICAgIC8vIGZvciB1cywgdGhpcyBvbmx5IGFwcGxpZXMgdG8gQ09NIG9iamVjdHMsIHNvIHdlCiAgICAgIC8vIHdvbid0IHNlZSB0aGlzIGZvciBhIHJlYWwgSmF2YXNjcmlwdCBvYmplY3QuCiAgICAgIGlmICh0eXBlb2Ygd2luZG93W05JWF9HRVRfV1JBUFBFUl0gIT09ICd1bmtub3duJykgewogICAgICAgIHdpbmRvd1tOSVhfSEFORExFX01FU1NBR0VdID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgcHJvY2VzcyhnYWRnZXRzLmpzb24ucGFyc2UoZGF0YSkpOwogICAgICAgIH07CgogICAgICAgIHdpbmRvd1tOSVhfQ1JFQVRFX0NIQU5ORUxdID0gZnVuY3Rpb24obmFtZSwgY2hhbm5lbCwgdG9rZW4pIHsKICAgICAgICAgIC8vIFZlcmlmeSB0aGUgYXV0aGVudGljYXRpb24gdG9rZW4gb2YgdGhlIGdhZGdldCB0cnlpbmcKICAgICAgICAgIC8vIHRvIGNyZWF0ZSBhIGNoYW5uZWwgZm9yIHVzLgogICAgICAgICAgaWYgKGF1dGhUb2tlbltuYW1lXSA9PSB0b2tlbikgewogICAgICAgICAgICBuaXhfY2hhbm5lbHNbbmFtZV0gPSBjaGFubmVsOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIEluamVjdCB0aGUgVkJTY3JpcHQgY29kZSBuZWVkZWQuCiAgICAgICAgdmFyIHZic2NyaXB0ID0KICAgICAgICAgIC8vIFdlIGNyZWF0ZSBhIGNsYXNzIHRvIGFjdCBhcyBhIHdyYXBwZXIgZm9yCiAgICAgICAgICAvLyBhIEphdmFzY3JpcHQgY2FsbCwgdG8gcHJldmVudCBhIGJyZWFrIGluIG9mCiAgICAgICAgICAvLyB0aGUgY29udGV4dC4KICAgICAgICAgICdDbGFzcyAnICsgTklYX1dSQVBQRVIgKyAnXG4gJwoKICAgICAgICAgIC8vIEFuIGludGVybmFsIG1lbWJlciBmb3Iga2VlcGluZyB0cmFjayBvZiB0aGUKICAgICAgICAgIC8vIG5hbWUgb2YgdGhlIGRvY3VtZW50IChjb250YWluZXIgb3IgZ2FkZ2V0KQogICAgICAgICAgLy8gZm9yIHdoaWNoIHRoaXMgd3JhcHBlciBpcyBpbnRlbmRlZC4gRm9yCiAgICAgICAgICAvLyB0aG9zZSB3cmFwcGVycyBjcmVhdGVkIGJ5IGdhZGdldHMsIHRoaXMgaXMgbm90CiAgICAgICAgICAvLyB1c2VkIChhbHRob3VnaCBpdCBpcyBzZXQgdG8gIi4uIikKICAgICAgICAgICsgJ1ByaXZhdGUgbV9JbnRlbmRlZFxuJwoKICAgICAgICAgIC8vIFN0b3JlcyB0aGUgYXV0aCB0b2tlbiB1c2VkIHRvIGNvbW11bmljYXRlIHdpdGgKICAgICAgICAgIC8vIHRoZSBnYWRnZXQuIFRoZSBHZXRDaGFubmVsQ3JlYXRvciBtZXRob2QgcmV0dXJucwogICAgICAgICAgLy8gYW4gb2JqZWN0IHRoYXQgcmV0dXJucyB0aGlzIGF1dGggdG9rZW4uIFVwb24gbWF0Y2hpbmcKICAgICAgICAgIC8vIHRoYXQgd2l0aCBpdHMgb3duLCB0aGUgZ2FkZ2V0IHVzZXMgdGhlIG9iamVjdAogICAgICAgICAgLy8gdG8gYWN0dWFsbHkgZXN0YWJsaXNoIHRoZSBjb21tdW5pY2F0aW9uIGNoYW5uZWwuCiAgICAgICAgICArICdQcml2YXRlIG1fQXV0aFxuJwoKICAgICAgICAgIC8vIE1ldGhvZCBmb3IgaW50ZXJuYWxseSBzZXR0aW5nIHRoZSB2YWx1ZQogICAgICAgICAgLy8gb2YgdGhlIG1fSW50ZW5kZWQgcHJvcGVydHkuCiAgICAgICAgICArICdQdWJsaWMgU3ViIFNldEludGVuZGVkTmFtZShuYW1lKVxuICcKICAgICAgICAgICsgJ0lmIGlzRW1wdHkobV9JbnRlbmRlZCkgVGhlblxuJwogICAgICAgICAgKyAnbV9JbnRlbmRlZCA9IG5hbWVcbicKICAgICAgICAgICsgJ0VuZCBJZlxuJwogICAgICAgICAgKyAnRW5kIFN1YlxuJwoKICAgICAgICAgIC8vIE1ldGhvZCBmb3IgaW50ZXJuYWxseSBzZXR0aW5nIHRoZSB2YWx1ZSBvZiB0aGUgbV9BdXRoIHByb3BlcnR5LgogICAgICAgICAgKyAnUHVibGljIFN1YiBTZXRBdXRoKGF1dGgpXG4gJwogICAgICAgICAgKyAnSWYgaXNFbXB0eShtX0F1dGgpIFRoZW5cbicKICAgICAgICAgICsgJ21fQXV0aCA9IGF1dGhcbicKICAgICAgICAgICsgJ0VuZCBJZlxuJwogICAgICAgICAgKyAnRW5kIFN1YlxuJwoKICAgICAgICAgIC8vIEEgd3JhcHBlciBtZXRob2Qgd2hpY2ggYWN0dWFsbHkgY2F1c2VzIGEKICAgICAgICAgIC8vIG1lc3NhZ2UgdG8gYmUgc2VudCB0byB0aGUgb3RoZXIgY29udGV4dC4KICAgICAgICAgICsgJ1B1YmxpYyBTdWIgU2VuZE1lc3NhZ2UoZGF0YSlcbiAnCiAgICAgICAgICArIE5JWF9IQU5ETEVfTUVTU0FHRSArICcoZGF0YSlcbicKICAgICAgICAgICsgJ0VuZCBTdWJcbicKCiAgICAgICAgICAvLyBSZXR1cm5zIHRoZSBhdXRoIHRva2VuIHRvIHRoZSBnYWRnZXQsIHNvIGl0IGNhbgogICAgICAgICAgLy8gY29uZmlybSBhIG1hdGNoIGJlZm9yZSBpbml0aWF0aW5nIHRoZSBjb25uZWN0aW9uCiAgICAgICAgICArICdQdWJsaWMgRnVuY3Rpb24gR2V0QXV0aFRva2VuKClcbiAnCiAgICAgICAgICArICdHZXRBdXRoVG9rZW4gPSBtX0F1dGhcbicKICAgICAgICAgICsgJ0VuZCBGdW5jdGlvblxuJwoKICAgICAgICAgIC8vIE1ldGhvZCBmb3Igc2V0dGluZyB1cCB0aGUgY29udGFpbmVyLT5nYWRnZXQKICAgICAgICAgIC8vIGNoYW5uZWwuIE5vdCBzdHJpY3RseSBuZWVkZWQgaW4gdGhlIGdhZGdldCdzCiAgICAgICAgICAvLyB3cmFwcGVyLCBidXQgbm8gcmVhc29uIHRvIGdldCByaWQgb2YgaXQuIE5vdGUgaGVyZQogICAgICAgICAgLy8gdGhhdCB3ZSBwYXNzIHRoZSBpbnRlbmRlZCBuYW1lIHRvIHRoZSBOSVhfQ1JFQVRFX0NIQU5ORUwKICAgICAgICAgIC8vIG1ldGhvZCBzbyB0aGF0IGl0IGNhbiBzYXZlIHRoZSBjaGFubmVsIGluIHRoZSBwcm9wZXIgcGxhY2UKICAgICAgICAgIC8vICphbmQqIHZlcmlmeSB0aGUgY2hhbm5lbCB2aWEgdGhlIGF1dGhlbnRpY2F0aW9uIHRva2VuIHBhc3NlZAogICAgICAgICAgLy8gaGVyZS4KICAgICAgICAgICsgJ1B1YmxpYyBTdWIgQ3JlYXRlQ2hhbm5lbChjaGFubmVsLCBhdXRoKVxuICcKICAgICAgICAgICsgJ0NhbGwgJyArIE5JWF9DUkVBVEVfQ0hBTk5FTCArICcobV9JbnRlbmRlZCwgY2hhbm5lbCwgYXV0aClcbicKICAgICAgICAgICsgJ0VuZCBTdWJcbicKICAgICAgICAgICsgJ0VuZCBDbGFzc1xuJwoKICAgICAgICAgIC8vIEZ1bmN0aW9uIHRvIGdldCBhIHJlZmVyZW5jZSB0byB0aGUgd3JhcHBlci4KICAgICAgICAgICsgJ0Z1bmN0aW9uICcgKyBOSVhfR0VUX1dSQVBQRVIgKyAnKG5hbWUsIGF1dGgpXG4nCiAgICAgICAgICArICdEaW0gd3JhcFxuJwogICAgICAgICAgKyAnU2V0IHdyYXAgPSBOZXcgJyArIE5JWF9XUkFQUEVSICsgJ1xuJwogICAgICAgICAgKyAnd3JhcC5TZXRJbnRlbmRlZE5hbWUgbmFtZVxuJwogICAgICAgICAgKyAnd3JhcC5TZXRBdXRoIGF1dGhcbicKICAgICAgICAgICsgJ1NldCAnICsgTklYX0dFVF9XUkFQUEVSICsgJyA9IHdyYXBcbicKICAgICAgICAgICsgJ0VuZCBGdW5jdGlvbic7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAvL2FsZXJ0KCdleGVjU2NyaXB0ISAnK3Zic2NyaXB0KTsKICAgICAgICAgIHdpbmRvdy5leGVjU2NyaXB0KHZic2NyaXB0LCAndmJzY3JpcHQnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CgogICAgICAgICAgLy9hbGVydCgnZXhjZXB0aW9uISBiYWNrIHRvIGlmcGMnKTsKICAgICAgICAgIC8vIEZhbGwgdGhyb3VnaCB0byBJRlBDLgogICAgICAgICAgcmVsYXlDaGFubmVsID0gJ2lmcGMnOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy9TdG9yZSB0aGUgcGFyc2VkIHdpbmRvdy5uYW1lIGNvbmZpZ3VyYXRpb24sIGlmIG5lY2Vzc2FyeQogIHZhciBjb25maWcgPSBudWxsOwoKICAvL1BhcnNlIHRoZSB3aW5kb3cubmFtZSBjb25maWd1cmF0aW9uIGFuZCBjYWNoZSBpdC4gIEhhbmRsZSB0aGUgY2FzZQogIC8vd2hlcmUgY29udGFpbmVycyB1c2UgYSBKU09OIHN0cmluZyBpbiB0aGUgd2luZG93IG5hbWUgYW5kIGEgcGxhaW4gc3RyaW5nLAovLyAgZnVuY3Rpb24gZ2V0Q29uZmlnKCkgewovLyAgICBpZiAoY29uZmlnID09IG51bGwpIHsKLy8gICAgICAgIGNvbmZpZyA9IHt9OwovLyAgICAgICAgaWYgKHdpbmRvdy5uYW1lLmNoYXJBdCgwKSAhPSAneycpIHsKLy8gICAgICAgICAgICBjb25maWcucnBjSWQgPSB3aW5kb3cubmFtZTsKLy8gICAgICAgICAgICBjb25maWcua2VybmVsID0gdHJ1ZTsKLy8gICAgICAgIH0gZWxzZSB7Ci8vICAgICAgICAgICAgY29uZmlnID0gZ2FkZ2V0cy5qc29uLnBhcnNlKHdpbmRvdy5uYW1lKTsKLy8gICAgICAgICAgICBjb25maWcucnBjSWQgPSBjb25maWcuaWQ7Ci8vICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsKLy8gICAgICAgIH0KLy8gICAgfSBlbHNlIHsKLy8gICAgICAgIHJldHVybiBjb25maWc7Ci8vICAgIH0KLy8gIH0KCiAgLy9HZXQgdGhlIElGcmFtZSBJRCBmcm9tIHRoZSB3aW5kb3cubmFtZSBwcm9wZXJ0eS4gIEhhbmRsZSB0aHJlZSBjYXNlcwogIC8vMS4gT1dGIFdlYnRvcCwgd2hpY2ggYXNzdW1lcyBJRnJhbWUgSURzIGFyZSBpZGVudGljYWwgdG8gd2luZG93IG5hbWVzCiAgLy8yLiBPV0YgS2VybmVsLCB3aGljaCBhc3N1bWVzIHRoYXQgSUZyYW1lIElEcyBhcmUgY29udGlhbmVkIGluIHRoZSB3aW5kb3cgbmFtZSBhcyBKU09OIGFzIHRoZSBpZCBmaWVsZAogIC8vMy4gT3RoZXJzLCB3aGljaCB1c2UgYSBwbGFpbiBzdHJpbmcgaW4gdGhlIHdpbmRvdyBuYW1lIGFuZCBhc3N1bWUgdGhlIElGcmFtZSBpZCBpcyBhbHNvIHRoaXMgcGxhaW4gc3RyaW5nCi8vICBmdW5jdGlvbiBnZXRJZCh3aW5kb3dOYW1lKSB7Ci8vICAgIHZhciBjb25mID0gZ2V0Q29uZmlnKCk7Ci8vICAgIGlmIChjb25mLmtlcm5lbCkKLy8gICAgICAgIHJldHVybiBjb25mLnJwY0lkOwovLyAgICBlbHNlCi8vICAgICAgICByZXR1cm4gd2luZG93TmFtZTsKLy8gIH0KCiAgZnVuY3Rpb24gZ2V0SWQod2luZG93TmFtZSkgewogICAgaWYgKHdpbmRvd05hbWUuY2hhckF0KDApICE9ICd7JykgewogICAgICByZXR1cm4gd2luZG93TmFtZQogICAgfQogICAgZWxzZSB7CiAgICAgIHZhciBvYmogPSBnYWRnZXRzLmpzb24ucGFyc2Uod2luZG93TmFtZSk7CiAgICAgIHZhciBpZCA9IG9iai5pZDsKICAgICAgcmV0dXJuIGdhZGdldHMuanNvbi5zdHJpbmdpZnkoe2lkOm9iai5pZH0pOwogICAgfQogIH0KCiAgLy8gUGljayB0aGUgbW9zdCBlZmZpY2llbnQgUlBDIHJlbGF5IG1lY2hhbmlzbQogIHZhciByZWxheUNoYW5uZWwgPSBnZXRSZWxheUNoYW5uZWwoKTsKICAvL2FsZXJ0KCdyZWxheWNoYW5uZWwgaXMgJytyZWxheUNoYW5uZWwpOwoKICAvLyBDb25kdWN0IGFueSBzZXR1cCBuZWNlc3NhcnkgZm9yIHRoZSBjaG9zZW4gY2hhbm5lbC4KICBzZXR1cENoYW5uZWwoKTsKCiAgLy8gQ3JlYXRlIHRoZSBEZWZhdWx0IFJQQyBoYW5kbGVyLgogIHNlcnZpY2VzW0RFRkFVTFRfTkFNRV0gPSBmdW5jdGlvbigpIHsKICAgIC8vc3VwcHJlc3MgdGhpcyBlcnJvciAtIG5vIG9uZSBzaG91bGQgZXZlciB0cnkgdG8gdXNlIGEgc2VydmljZSB0aGF0IHdhc24ndCByZWdpc3RlcmVkIHVzaW5nIG91ciBhcGkKICAgIC8vdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIFJQQyBzZXJ2aWNlOiAnICsgdGhpcy5zKTsKICB9OwoKICAvLyBDcmVhdGUgYSBTcGVjaWFsIFJQQyBoYW5kbGVyIGZvciBjYWxsYmFja3MuCiAgc2VydmljZXNbQ0FMTEJBQ0tfTkFNRV0gPSBmdW5jdGlvbihjYWxsYmFja0lkLCByZXN1bHQpIHsKICAgIHZhciBjYWxsYmFjayA9IGNhbGxiYWNrc1tjYWxsYmFja0lkXTsKICAgIGlmIChjYWxsYmFjaykgewogICAgICBkZWxldGUgY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICBjYWxsYmFjayhyZXN1bHQpOwogICAgfQogIH07CgogIC8qKgogICAqIENvbmR1Y3RzIGFueSBmcmFtZS1zcGVjaWZpYyB3b3JrIG5lY2Vzc2FyeSB0byBzZXR1cAogICAqIHRoZSBjaGFubmVsIHR5cGUgY2hvc2VuLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbgogICAqIHRoZSBjb250YWluZXIgcGFnZSBmaXJzdCByZWdpc3RlcnMgdGhlIGdhZGdldCBpbiB0aGUKICAgKiBSUEMgbWVjaGFuaXNtLiBHYWRnZXRzLCBpbiB0dXJuLCB3aWxsIGNvbXBsZXRlIHRoZSBzZXR1cAogICAqIG9mIHRoZSBjaGFubmVsIG9uY2UgdGhleSBzZW5kIHRoZWlyIGZpcnN0IG1lc3NhZ2VzLgogICAqLwogIGZ1bmN0aW9uIHNldHVwRnJhbWUoZnJhbWVJZCwgdG9rZW4pIHsKICAgIGlmIChzZXR1cFtmcmFtZUlkXSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHJlbGF5Q2hhbm5lbCA9PT0gJ2ZlJykgewogICAgICB0cnkgewogICAgICAgIHZhciBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZyYW1lSWQpOwogICAgICAgIGZyYW1lW0ZFX0cyQ19DSEFOTkVMXSA9IGZ1bmN0aW9uKGFyZ3MpIHsKICAgICAgICAgIHByb2Nlc3MoZ2FkZ2V0cy5qc29uLnBhcnNlKGFyZ3MpKTsKICAgICAgICB9OwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gU29tZXRoaW5nIHdlbnQgd3JvbmcuIFN5c3RlbSB3aWxsIGZhbGxiYWNrIHRvCiAgICAgICAgLy8gSUZQQy4KICAgICAgfQogICAgfQoKICAgIGlmIChyZWxheUNoYW5uZWwgPT09ICduaXgnKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnJhbWVJZCk7CiAgICAgICAgdmFyIHdyYXBwZXIgPSB3aW5kb3dbTklYX0dFVF9XUkFQUEVSXShmcmFtZUlkLCB0b2tlbik7CiAgICAgICAgZnJhbWUuY29udGVudFdpbmRvdy5vcGVuZXIgPSB3cmFwcGVyOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gU29tZXRoaW5nIHdlbnQgd3JvbmcuIFN5c3RlbSB3aWxsIGZhbGxiYWNrIHRvCiAgICAgICAgLy8gSUZQQy4KICAgICAgICAvL2FsZXJ0KCdzZXR1cEZyYW1lIEVycm9yITonK2UubWVzc2FnZSk7CgogICAgICB9CiAgICB9CgogICAgc2V0dXBbZnJhbWVJZF0gPSB0cnVlOwogIH0KCiAgLyoqCiAgICogRW5jb2RlcyBhcmd1bWVudHMgZm9yIHRoZSBsZWdhY3kgSUZQQyB3aXJlIGZvcm1hdC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzCiAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgZW5jb2RlZCBhcmdzCiAgICovCiAgZnVuY3Rpb24gZW5jb2RlTGVnYWN5RGF0YShhcmdzKSB7CiAgICB2YXIgc3RyaW5naWZ5ID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeTsKICAgIHZhciBhcmdzRXNjYXBlZCA9IFtdOwogICAgZm9yKHZhciBpID0gMCwgaiA9IGFyZ3MubGVuZ3RoOyBpIDwgajsgKytpKSB7CiAgICAgIGFyZ3NFc2NhcGVkLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeShhcmdzW2ldKSkpOwogICAgfQogICAgcmV0dXJuIGFyZ3NFc2NhcGVkLmpvaW4oJyYnKTsKICB9CgogIC8qKgogICAqIEhlbHBlciBmdW5jdGlvbiB0byBwcm9jZXNzIGFuIFJQQyByZXF1ZXN0CiAgICogQHBhcmFtIHtPYmplY3R9IHJwYyBSUEMgcmVxdWVzdCBvYmplY3QKICAgKiBAcHJpdmF0ZQogICAqLwogICAgZnVuY3Rpb24gcHJvY2VzcyhycGMpIHsKICAgIC8vCiAgICAvLyBSUEMgb2JqZWN0IGNvbnRlbnRzOgogICAgLy8gICBzOiBTZXJ2aWNlIE5hbWUKICAgIC8vICAgZjogRnJvbQogICAgLy8gICBjOiBUaGUgY2FsbGJhY2sgSUQgb3IgMCBpZiBub25lLgogICAgLy8gICBhOiBUaGUgYXJndW1lbnRzIGZvciB0aGlzIFJQQyBjYWxsLgogICAgLy8gICB0OiBUaGUgYXV0aGVudGljYXRpb24gdG9rZW4uCiAgICAvLwogICAgaWYgKHJwYyAmJiB0eXBlb2YgcnBjLnMgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBycGMuZiA9PT0gJ3N0cmluZycgJiYKICAgICAgICBycGMuYSBpbnN0YW5jZW9mIEFycmF5KSB7CgogICAgICAvL2Vuc3VyZSBpZCBpcyBjb21wYXRpYmxlCiAgICAgIHJwYy5mID0gZ2V0SWQocnBjLmYpOwoKICAgICAgLy8gVmFsaWRhdGUgYXV0aCB0b2tlbi4KICAgICAgaWYgKGF1dGhUb2tlbltycGMuZl0pIHsKICAgICAgICAvLyBXZSBhbGxvdyB0eXBlIGNvZXJjaW9uIGhlcmUgYmVjYXVzZSBhbGwgdGhlIHVybCBwYXJhbXMgYXJlIHN0cmluZ3MuCiAgICAgICAgaWYgKGF1dGhUb2tlbltycGMuZl0gIT0gcnBjLnQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhdXRoIHRva2VuLiIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gSWYgdGhlcmUgaXMgYSBjYWxsYmFjayBmb3IgdGhpcyBzZXJ2aWNlLCBhdHRhY2ggYSBjYWxsYmFjayBmdW5jdGlvbgogICAgICAvLyB0byB0aGUgcnBjIGNvbnRleHQgb2JqZWN0IGZvciBhc3luY2hyb25vdXMgcnBjIHNlcnZpY2VzLgogICAgICAvLwogICAgICAvLyBTeW5jaHJvbm91cyBycGMgcmVxdWVzdCBoYW5kbGVycyBzaG91bGQgc2ltcGx5IGlnbm9yZSBpdCBhbmQgcmV0dXJuIGEKICAgICAgLy8gdmFsdWUgYXMgdXN1YWwuCiAgICAgIC8vIEFzeW5jaHJvbm91cyBycGMgcmVxdWVzdCBoYW5kbGVycywgb24gdGhlIG90aGVyIGhhbmQsIHNob3VsZCBwYXNzIGl0cwogICAgICAvLyByZXN1bHQgdG8gdGhpcyBjYWxsYmFjayBmdW5jdGlvbiBhbmQgbm90IHJldHVybiBhIHZhbHVlIG9uIGV4aXQuCiAgICAgIC8vCiAgICAgIC8vIEZvciBleGFtcGxlLCB0aGUgZm9sbG93aW5nIHJwYyBoYW5kbGVyIHBhc3NlcyB0aGUgZmlyc3QgcGFyYW1ldGVyIGJhY2sKICAgICAgLy8gdG8gaXRzIHJwYyBjbGllbnQgd2l0aCBhIG9uZS1zZWNvbmQgZGVsYXkuCiAgICAgIC8vCiAgICAgIC8vIGZ1bmN0aW9uIGFzeW5jUnBjSGFuZGxlcihwYXJhbSkgewogICAgICAvLyAgIHZhciBtZSA9IHRoaXM7CiAgICAgIC8vICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgLy8gICAgIG1lLmNhbGxiYWNrKHBhcmFtKTsKICAgICAgLy8gICB9LCAxMDAwKTsKICAgICAgLy8gfQogICAgICBpZiAocnBjLmMpIHsKICAgICAgICBycGMuY2FsbGJhY2sgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwocnBjLmYsIENBTExCQUNLX05BTUUsIG51bGwsIHJwYy5jLCByZXN1bHQpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIC8vIENhbGwgdGhlIHJlcXVlc3RlZCBSUEMgc2VydmljZS4KICAgICAgdmFyIHJlc3VsdCA9IChzZXJ2aWNlc1tycGMuc10gfHwKICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlc1tERUZBVUxUX05BTUVdKS5hcHBseShycGMsIHJwYy5hKTsKCiAgICAgIC8vIElmIHRoZSBycGMgcmVxdWVzdCBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSwgaW1tZWRpYXRlbHkgcGFzcyBpdCBiYWNrCiAgICAgIC8vIHRvIHRoZSBjYWxsYmFjay4gT3RoZXJ3aXNlLCBkbyBub3RoaW5nLCBhc3N1bWluZyB0aGF0IHRoZSBycGMgaGFuZGxlcgogICAgICAvLyB3aWxsIG1ha2UgYW4gYXN5bmNocm9ub3VzIGNhbGwgbGF0ZXIuCiAgICAgIGlmIChycGMuYyAmJiB0eXBlb2YgcmVzdWx0ICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChycGMuZiwgQ0FMTEJBQ0tfTkFNRSwgbnVsbCwgcnBjLmMsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIEF0dGVtcHRzIHRvIGNvbmR1Y3QgYW4gUlBDIGNhbGwgdG8gdGhlIHNwZWNpZmllZAogICAqIHRhcmdldCB3aXRoIHRoZSBzcGVjaWZpZWQgZGF0YSB2aWEgdGhlIE5JWAogICAqIG1ldGhvZC4gSWYgdGhpcyBtZXRob2QgZmFpbHMsIHRoZSBzeXN0ZW0gYXR0ZW1wdHMgYWdhaW4KICAgKiB1c2luZyB0aGUga25vd24gZGVmYXVsdCBvZiBJRlBDLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE1vZHVsZSBJZCBvZiB0aGUgUlBDIHNlcnZpY2UgcHJvdmlkZXIuCiAgICogQHBhcmFtIHtTdHJpbmd9IHNlcnZpY2VOYW1lIE5hbWUgb2YgdGhlIHNlcnZpY2UgdG8gY2FsbC4KICAgKiBAcGFyYW0ge1N0cmluZ30gZnJvbSBNb2R1bGUgSWQgb2YgdGhlIGNhbGxpbmcgcHJvdmlkZXIuCiAgICogQHBhcmFtIHtPYmplY3R9IHJwY0RhdGEgVGhlIFJQQyBkYXRhIGZvciB0aGlzIGNhbGwuCiAgICovCiAgZnVuY3Rpb24gY2FsbE5peCh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEpIHsKICAgIHRyeSB7Ci8vICAgICAgIGFsZXJ0KCd0cnkgbml4IHRhcmdldElkPScrdGFyZ2V0SWQpOwovLyAgICAgICBhbGVydCgndHJ5IG5peCBmcm9tPScrZnJvbSk7CiAgICAgIGlmIChmcm9tICE9ICcuLicpIHsKLy8gICAgICAgIGFsZXJ0KCd0cnkgbml4MScpOwogICAgICAgIC8vIENhbGwgZnJvbSBnYWRnZXQgdG8gdGhlIGNvbnRhaW5lci4KICAgICAgICB2YXIgaGFuZGxlciA9IG5peF9jaGFubmVsc1snLi4nXTsKCi8vICAgICAgICBhbGVydCgnTml4IGhhbmRsZXI9JytoYW5kbGVyKTsKICAgICAgICAvL2FsZXJ0KCdHZXRBdXRoVG9rZW4nKygiR2V0QXV0aFRva2VuIiBpbiB3aW5kb3cub3BlbmVyKSk7Ci8vICAgICAgICBhbGVydCgnd2luZG93Lm9wZW5lcj0nK3dpbmRvdy5vcGVuZXIpOwoKICAgICAgICAvLyBJZiB0aGUgZ2FkZ2V0IGhhcyB5ZXQgdG8gcmV0cmlldmUgYSByZWZlcmVuY2UgdG8KICAgICAgICAvLyB0aGUgTklYIGhhbmRsZXIsIHRyeSB0byBkbyBzbyBub3cuIFdlIGRvbid0IGRvIGEKICAgICAgICAvLyB0eXBlb2Yod2luZG93Lm9wZW5lci5HZXRBdXRoVG9rZW4pIGNoZWNrIGhlcmUKICAgICAgICAvLyBiZWNhdXNlIGl0IG1lYW5zIGFjY2Vzc2luZyB0aGF0IGZpZWxkIG9uIHRoZSBDT00gb2JqZWN0LCB3aGljaCwKICAgICAgICAvLyBiZWluZyBhbiBpbnRlcm5hbCBmdW5jdGlvbiByZWZlcmVuY2UsIGlzIG5vdCBhbGxvd2VkLgogICAgICAgIC8vICJpbiIgd29ya3MgYmVjYXVzZSBpdCBtZXJlbHkgY2hlY2tzIGZvciB0aGUgcHJlc2NlbmNlIG9mCiAgICAgICAgLy8gdGhlIGtleSwgcmF0aGVyIHRoYW4gYWN0dWFsbHkgYWNjZXNzaW5nIHRoZSBvYmplY3QncyBwcm9wZXJ0eS4KICAgICAgICAvLyBUaGlzIGlzIGp1c3QgYSBzYW5pdHkgY2hlY2ssIG5vdCBhIHZhbGlkaXR5IGNoZWNrLgogICAgICAgIGlmICghaGFuZGxlciAmJiB3aW5kb3cub3BlbmVyICYmICJHZXRBdXRoVG9rZW4iIGluIHdpbmRvdy5vcGVuZXIpIHsKLy8gICAgICAgICAgYWxlcnQoJ3RyeSBuaXggLSBoYW5kbGVyJyk7CiAgICAgICAgICBoYW5kbGVyID0gd2luZG93Lm9wZW5lcjsKCiAgICAgICAgICAvLyBDcmVhdGUgdGhlIGNoYW5uZWwgdG8gdGhlIHBhcmVudC9jb250YWluZXIuCiAgICAgICAgICAvLyBGaXJzdCB2ZXJpZnkgdGhhdCBpdCBrbm93cyBvdXIgYXV0aCB0b2tlbiB0byBlbnN1cmUgaXQncyBub3QKICAgICAgICAgIC8vIGFuIGltcG9zdG9yLgogICAgICAgICAgaWYgKGhhbmRsZXIuR2V0QXV0aFRva2VuKCkgPT0gYXV0aFRva2VuWycuLiddKSB7CiAgICAgICAgICAgIC8vIEF1dGggbWF0Y2ggLSBwYXNzIGl0IGJhY2sgYWxvbmcgd2l0aCBvdXIgd3JhcHBlciB0byBmaW5pc2guCiAgICAgICAgICAgIC8vIG93biB3cmFwcGVyIGFuZCBvdXIgYXV0aGVudGljYXRpb24gdG9rZW4gZm9yIGNvLXZlcmlmaWNhdGlvbi4KICAgICAgICAgICAgdmFyIHRva2VuID0gYXV0aFRva2VuWycuLiddOwogICAgICAgICAgICBoYW5kbGVyLkNyZWF0ZUNoYW5uZWwod2luZG93W05JWF9HRVRfV1JBUFBFUl0oJy4uJywgdG9rZW4pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4pOwogICAgICAgICAgICAvLyBTZXQgY2hhbm5lbCBoYW5kbGVyCiAgICAgICAgICAgIG5peF9jaGFubmVsc1snLi4nXSA9IGhhbmRsZXI7CiAgICAgICAgICAgIHdpbmRvdy5vcGVuZXIgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIGhhbmRsZXIsIGNhbGwgaXQuCiAgICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICAgIC8vYWxlcnQoJ3NlbnQgbml4Jyk7CiAgICAgICAgICBoYW5kbGVyLlNlbmRNZXNzYWdlKHJwY0RhdGEpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCi8vICAgICAgICBhbGVydCgnTml4IGRpZCBub3Qgc2VuZDMnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDYWxsIGZyb20gY29udGFpbmVyIHRvIGEgZ2FkZ2V0W3RhcmdldElkXS4KLy8gICAgICAgIGFsZXJ0KCd0cnkgbml4MiAtIG5peF9jaGFubmVsc1t0YXJnZXRJZF09JytuaXhfY2hhbm5lbHNbdGFyZ2V0SWRdKTsKCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIGhhbmRsZXIsIGNhbGwgaXQuCiAgICAgICAgaWYgKG5peF9jaGFubmVsc1t0YXJnZXRJZF0pIHsKLy8gICAgICAgICAgYWxlcnQoJ3NlbnQgbml4Jyk7CiAgICAgICAgICBuaXhfY2hhbm5lbHNbdGFyZ2V0SWRdLlNlbmRNZXNzYWdlKHJwY0RhdGEpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCi8vICAgICAgICBhbGVydCgnTml4IGRpZCBub3Qgc2VuZDEnKTsKICAgICAgfQoKLy8gICAgICBhbGVydCgnTml4IGRpZCBub3Qgc2VuZDInKTsKCiAgICB9IGNhdGNoIChlKSB7Ci8vICAgICAgYWxlcnQoJ05peCBGYWlsZWQhOicrZSk7CiAgICB9CgovLyAgICBhbGVydCgnZmFsbGJhY2sgaWZwYycpOwoKICAgIC8vIElmIHdlIGhhdmUgcmVhY2hlZCB0aGlzIHBvaW50LCBzb21ldGhpbmcgaGFzIGZhaWxlZAogICAgLy8gd2l0aCB0aGUgTklYIG1ldGhvZCwgc28gd2UgZGVmYXVsdCB0byB1c2luZwogICAgLy8gSUZQQyBmb3IgdGhpcyBjYWxsLgogICAgY2FsbElmcGModGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhKTsKICB9CgogIC8qKgogICAqIEF0dGVtcHRzIHRvIGNvbmR1Y3QgYW4gUlBDIGNhbGwgdG8gdGhlIHNwZWNpZmllZAogICAqIHRhcmdldCB3aXRoIHRoZSBzcGVjaWZpZWQgZGF0YSB2aWEgdGhlIEZyYW1lRWxlbWVudAogICAqIG1ldGhvZC4gSWYgdGhpcyBtZXRob2QgZmFpbHMsIHRoZSBzeXN0ZW0gYXR0ZW1wdHMgYWdhaW4KICAgKiB1c2luZyB0aGUga25vd24gZGVmYXVsdCBvZiBJRlBDLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE1vZHVsZSBJZCBvZiB0aGUgUlBDIHNlcnZpY2UgcHJvdmlkZXIuCiAgICogQHBhcmFtIHtTdHJpbmd9IHNlcnZpY2VOYW1lIFNlcnZpY2UgbmFtZSB0byBjYWxsLgogICAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tIE1vZHVsZSBJZCBvZiB0aGUgY2FsbGluZyBwcm92aWRlci4KICAgKiBAcGFyYW0ge09iamVjdH0gcnBjRGF0YSBUaGUgUlBDIGRhdGEgZm9yIHRoaXMgY2FsbC4KICAgKiBAcGFyYW0ge0FycmF5LjxPYmplY3Q+fSBjYWxsQXJncyBPcmlnaW5hbCBhcmd1bWVudHMgdG8gY2FsbCgpCiAgICovCiAgZnVuY3Rpb24gY2FsbEZyYW1lRWxlbWVudCh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEsIGNhbGxBcmdzKSB7CiAgICAvL2FsZXJ0KCdjYWxsRnJhbWVFbGVtZW50IScpOwogICAgdHJ5IHsKICAgICAgaWYgKGZyb20gIT0gJy4uJykgewogICAgICAgIC8vIENhbGwgZnJvbSBnYWRnZXQgdG8gdGhlIGNvbnRhaW5lci4KICAgICAgICB2YXIgZmUgPSB3aW5kb3cuZnJhbWVFbGVtZW50OwoKICAgICAgICBpZiAodHlwZW9mIGZlW0ZFX0cyQ19DSEFOTkVMXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgLy8gQ29tcGxldGUgdGhlIHNldHVwIG9mIHRoZSBGRSBjaGFubmVsIGlmIG5lZWQgYmUuCiAgICAgICAgICBpZiAodHlwZW9mIGZlW0ZFX0cyQ19DSEFOTkVMXVtGRV9DMkdfQ0hBTk5FTF0gIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgZmVbRkVfRzJDX0NIQU5ORUxdW0ZFX0MyR19DSEFOTkVMXSA9IGZ1bmN0aW9uKGFyZ3MpIHsKICAgICAgICAgICAgICBwcm9jZXNzKGdhZGdldHMuanNvbi5wYXJzZShhcmdzKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQ29uZHVjdCB0aGUgUlBDIGNhbGwuCiAgICAgICAgICBmZVtGRV9HMkNfQ0hBTk5FTF0ocnBjRGF0YSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIENhbGwgZnJvbSBjb250YWluZXIgdG8gZ2FkZ2V0W3RhcmdldElkXS4KICAgICAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRJZCk7CgogICAgICAgIGlmICh0eXBlb2YgZnJhbWVbRkVfRzJDX0NIQU5ORUxdID09PSAnZnVuY3Rpb24nICYmCiAgICAgICAgICAgIHR5cGVvZiBmcmFtZVtGRV9HMkNfQ0hBTk5FTF1bRkVfQzJHX0NIQU5ORUxdID09PSAnZnVuY3Rpb24nKSB7CgogICAgICAgICAgLy8gQ29uZHVjdCB0aGUgUlBDIGNhbGwuCiAgICAgICAgICBmcmFtZVtGRV9HMkNfQ0hBTk5FTF1bRkVfQzJHX0NIQU5ORUxdKHJwY0RhdGEpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgfQoKICAgIC8vIElmIHdlIGhhdmUgcmVhY2hlZCB0aGlzIHBvaW50LCBzb21ldGhpbmcgaGFzIGZhaWxlZAogICAgLy8gd2l0aCB0aGUgRnJhbWVFbGVtZW50IG1ldGhvZCwgc28gd2UgZGVmYXVsdCB0byB1c2luZwogICAgLy8gSUZQQyBmb3IgdGhpcyBjYWxsLgogICAgY2FsbElmcGModGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhLCBjYWxsQXJncyk7CiAgfQoKICAvKioKICAgKiBDb25kdWN0cyBhbiBSUEMgY2FsbCB0byB0aGUgc3BlY2lmaWVkCiAgICogdGFyZ2V0IHdpdGggdGhlIHNwZWNpZmllZCBkYXRhIHZpYSB0aGUgSUZQQwogICAqIG1ldGhvZC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRJZCBNb2R1bGUgSWQgb2YgdGhlIFJQQyBzZXJ2aWNlIHByb3ZpZGVyLgogICAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSBTZXJ2aWNlIG5hbWUgdG8gY2FsbC4KICAgKiBAcGFyYW0ge1N0cmluZ30gZnJvbSBNb2R1bGUgSWQgb2YgdGhlIGNhbGxpbmcgcHJvdmlkZXIuCiAgICogQHBhcmFtIHtPYmplY3R9IHJwY0RhdGEgVGhlIFJQQyBkYXRhIGZvciB0aGlzIGNhbGwuCiAgICogQHBhcmFtIHtBcnJheS48T2JqZWN0Pn0gY2FsbEFyZ3MgT3JpZ2luYWwgYXJndW1lbnRzIHRvIGNhbGwoKQogICAqLwogIGZ1bmN0aW9uIGNhbGxJZnBjKHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSwgY2FsbEFyZ3MpIHsKICAgIC8vYWxlcnQoIkNPTlRBSU5FUiBJRlBDIHBhcmFtczogIiArIHRhcmdldElkICsgIiAiICsgc2VydmljZU5hbWUgKyAiICIgKyBmcm9tICsgIiAiICsgcnBjRGF0YSArICIgIiArIGNhbGxBcmdzKTsKICAgIC8vIFJldHJpZXZlIHRoZSByZWxheSBmaWxlIHVzZWQgYnkgSUZQQy4gTm90ZSB0aGF0CiAgICAvLyB0aGlzIG11c3QgYmUgc2V0IGJlZm9yZSB0aGUgY2FsbCwgYW5kIHNvIHdlIGNvbmR1Y3QKICAgIC8vIGFuIGV4dHJhIGNoZWNrIHRvIGVuc3VyZSBpdCBpcyBub3QgYmxhbmsuCiAgICB2YXIgcmVsYXkgPSBnYWRnZXRzLnJwYy5nZXRSZWxheVVybCh0YXJnZXRJZCk7CgogICAgaWYgKCFyZWxheSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlbGF5IGZpbGUgYXNzaWduZWQgZm9yIElGUEMnKTsKICAgIH0KCiAgICAvLyBUaGUgUlBDIG1lY2hhbmlzbSBzdXBwb3J0cyB0d28gZm9ybWF0cyBmb3IgSUZQQyAobGVnYWN5IGFuZCBjdXJyZW50KS4KICAgIHZhciBzcmMgPSBudWxsLAogICAgICAgIHF1ZXVlT3V0ID0gW107CiAgICBpZiAodXNlTGVnYWN5UHJvdG9jb2xbdGFyZ2V0SWRdKSB7CiAgICAgIC8vIEZvcm1hdDogI2lmcmFtZV9pZCZjYWxsSWQmbnVtX3BhY2tldHMmcGFja2V0X251bSZibG9ja19vZl9kYXRhCiAgICAgIHNyYyA9IFtyZWxheSwgJyMnLCBlbmNvZGVMZWdhY3lEYXRhKFtmcm9tLCBjYWxsSWQsIDEsIDAsCiAgICAgICAgICAgICBlbmNvZGVMZWdhY3lEYXRhKFtmcm9tLCBzZXJ2aWNlTmFtZSwgJycsICcnLCBmcm9tXS5jb25jYXQoCiAgICAgICAgICAgICAgIGNhbGxBcmdzKSldKV0uam9pbignJyk7CiAgICAgIHF1ZXVlT3V0LnB1c2goc3JjKTsKICAgIH0gZWxzZSB7CgogICAgICAvLyBGb3JtYXQ6ICN0YXJnZXRJZCAmIHNvdXJjZUlkQGNhbGxJZCAmIHBhY2tldE51bSAmIHBhY2tldElkICYgcGFja2V0RGF0YQogICAgICBzcmMgPSBbcmVsYXksICcjJywgZW5jb2RlVVJJQ29tcG9uZW50KHRhcmdldElkKSwgJyYnLCBmcm9tLCAnQCcsIGNhbGxJZCwgJyYnXS5qb2luKCcnKTsKICAgICAgaWYgKCF1c2VNdWx0aVBhcnRNZXNzYWdlc1t0YXJnZXRJZF0pIHsKICAgICAgICAvLyBGb3JtYXQ6ICN0YXJnZXRJZCAmIHNvdXJjZUlkQGNhbGxJZCAmIHBhY2tldE51bSAmIHBhY2tldElkICYgcGFja2V0RGF0YQogICAgICAgIHF1ZXVlT3V0LnB1c2goW3NyYywgMSwgJyYnLCAwLCAnJicsICwgZW5jb2RlVVJJQ29tcG9uZW50KHJwY0RhdGEpXS5qb2luKCcnKSk7CgogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHZhciBtZXNzYWdlID0gZW5jb2RlVVJJQ29tcG9uZW50KHJwY0RhdGEpLAogICAgICAgICAgICBwYXlsb2FkTGVuZ3RoID0gVVJMX0xJTUlUIC0gc3JjLmxlbmd0aCwKICAgICAgICAgICAgbnVtUGFja2V0cyA9IE1hdGguY2VpbChtZXNzYWdlLmxlbmd0aCAvIHBheWxvYWRMZW5ndGgpLAogICAgICAgICAgICBwYWNrZXRJZHggPSAwLAogICAgICAgICAgICBwYXJ0OwogICAgICAgIHdoaWxlIChtZXNzYWdlLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHBhcnQgPSBtZXNzYWdlLnN1YnN0cmluZygwLCBwYXlsb2FkTGVuZ3RoKTsKICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnN1YnN0cmluZyhwYXlsb2FkTGVuZ3RoKTsKICAgICAgICAgIHF1ZXVlT3V0LnB1c2goW3NyYywgbnVtUGFja2V0cywgJyYnLCBwYWNrZXRJZHgsICcmJywgcGFydF0uam9pbignJykpOwogICAgICAgICAgcGFja2V0SWR4ICs9IDE7CiAgICAgICAgfQoKICAgICAgfQoKICAgIH0KCiAgICAvLyBDb25kdWN0IHRoZSBJRlBDIGNhbGwgYnkgY3JlYXRpbmcgdGhlIElmcmFtZSB3aXRoCiAgICAvLyB0aGUgcmVsYXkgVVJMIGFuZCBhcHBlbmRlZCBtZXNzYWdlLgogICAgZG8gewogICAgICBlbWl0SW52aXNpYmxlSWZyYW1lKHF1ZXVlT3V0LnNoaWZ0KCksdGFyZ2V0SWQpOwogICAgfSB3aGlsZSAocXVldWVPdXQubGVuZ3RoID4gMCk7CiAgICByZXR1cm4gdHJ1ZTsKCgogIH0KCiAgLy9JRSBvbmx5OiByZXR1cm4gdHJ1ZSBpZiBhIHRhcmdldCBpZnJhbWUgaWQgaXMgaW4gYSBjaGlsZCBwb3B1cCB3aW5kb3cKICBmdW5jdGlvbiBpc0luUG9wdXAodGFyZ2V0SWQpIHsKICAgIGlmICghdGFyZ2V0SWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRhcmdldElkID09ICIuLiIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFyZ2V0SWQpOwogICAgaWYgKGZyYW1lKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgX2NoaWxkV2luZG93cyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvL0lFIG9ubHk6IFF1ZXVlIG9mIG1lc3NhZ2VzIGZvciBjaGlsZCB3aW5kb3dzCiAgd2luZG93Ll9jaGlsZFdpbmRvd01lc3NhZ2VRdWV1ZSA9IFtdOwogIC8vSUUgb25seTogVW5pcXVlIGluY3JlYXNpbmcgSUQgZm9yIGFsbCBtZXNzYWdlcyBwdXQgb24gdGhlIGNoaWxkIHdpbmRvdyBxdWV1ZQogIHdpbmRvdy5fY2hpbGRXaW5kb3dNZXNzYWdlSWQgPSAwOwogIC8vSUUgb25seTogQWxsb3cgYSBjaGlsZCB3aW5kb3cgdG8gcmV0cmlldmUgYSBtZXNzYWdlIGZyb20gdGhlIHF1ZXVlCiAgd2luZG93Ll9nZXRDaGlsZFdpbmRvd01lc3NhZ2UgPSBmdW5jdGlvbihtc2dJZCkgewogICAgdmFyIHEgPSBfY2hpbGRXaW5kb3dNZXNzYWdlUXVldWU7CiAgICBmb3IodmFyIGlpPTA7IGlpIDwgcS5sZW5ndGg7IGlpKyspIHsKICAgICAgdmFyIG0gPSBxW2lpXTsKICAgICAgaWYgKG0uaWQgPT0gbXNnSWQpIHsKICAgICAgICByZXR1cm4gbTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNNZXNzYWdlQ29tcGxldGUoYXJyLCB0b3RhbCkgewogICAgZm9yICh2YXIgaSA9IHRvdGFsIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgaWYgKHR5cGVvZiBhcnJbaV0gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEhlbHBlciBmdW5jdGlvbiB0byBlbWl0IGFuIGludmlzaWJsZSBJRnJhbWUuCiAgICogQHBhcmFtIHtTdHJpbmd9IHNyYyBTUkMgYXR0cmlidXRlIG9mIHRoZSBJRnJhbWUgdG8gZW1pdC4KICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIGVtaXRJbnZpc2libGVJZnJhbWUoc3JjLCB0YXJnZXRJZCkgewogICAgaWYgKGlzSW5Qb3B1cCh0YXJnZXRJZCkpIHsKICAgICAgICAvL0lFIG9ubHk6CiAgICAgICAgLy9RdWV1ZSB0aGUgbWVzc2FnZSBmb3Igb3VyIGNoaWxkIGlmcmFtZXMsIHdoaWNoIHdpbGwgcG9sbCBmb3IgdGhlbS4KICAgICAgICAvL1dlIGRvIHRoaXMgYmVjYXVzZSBpbiBJRSBhIHBhcmVudCB3aW5kb3cgZG9lcyBub3QgaGF2ZSBhY2Nlc3MgdG8gdGhlCiAgICAgICAgLy9kb2N1bWVudCBvZiBjaGlsZCBwb3B1cCB3aW5kb3dzLCBhbmQgaGVuY2UgY2Fubm90IGVtaXQgYW4gaWZyYW1lCiAgICAgICAgLy93aXRoaW4gdGhlbQogICAgICAgIHZhciBpZCA9IHdpbmRvdy5fY2hpbGRXaW5kb3dNZXNzYWdlSWQ7CiAgICAgICAgaWQrKzsKICAgICAgICB3aW5kb3cuX2NoaWxkV2luZG93TWVzc2FnZVF1ZXVlLnB1c2goe2lkOmlkLCB0YXJnZXQ6dGFyZ2V0SWQsIHNyYzpzcmN9KTsKICAgICAgICB3aW5kb3cuX2NoaWxkV2luZG93TWVzc2FnZUlkKys7CiAgICAgICAgaWYod2luZG93Ll9jaGlsZFdpbmRvd01lc3NhZ2VRdWV1ZS5sZW5ndGggPiAyMCkgewogICAgICAgICAgd2luZG93Ll9jaGlsZFdpbmRvd01lc3NhZ2VRdWV1ZS5zaGlmdCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgaWZyYW1lOwogICAgLy8gUmVjeWNsZSBJRnJhbWVzCiAgICBmb3IgKHZhciBpID0gaWZyYW1lUG9vbC5sZW5ndGggLSAxOyBpID49MDsgLS1pKSB7CiAgICAgIHZhciBpZnIgPSBpZnJhbWVQb29sW2ldOwogICAgICB0cnkgewogICAgICAgIGlmIChpZnIgJiYgKGlmci5yZWN5Y2xhYmxlIHx8IGlmci5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSkgewogICAgICAgICAgaWZyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaWZyKTsKICAgICAgICAgIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgewogICAgICAgICAgICAvLyBGb3IgTVNJRSwgZGVsZXRlIGFueSBpZnJhbWVzIHRoYXQgYXJlIG5vIGxvbmdlciBiZWluZyB1c2VkLiBNU0lFCiAgICAgICAgICAgIC8vIGNhbm5vdCByZXVzZSB0aGUgSUZSQU1FIGJlY2F1c2UgYSBuYXZpZ2F0aW9uYWwgY2xpY2sgc291bmQgd2lsbAogICAgICAgICAgICAvLyBiZSB0cmlnZ2VyZWQgd2hlbiB3ZSBzZXQgdGhlIFNSQyBhdHRyaWJ1dGUuCiAgICAgICAgICAgIC8vIE90aGVyIGJyb3dzZXJzIHNjYW4gdGhlIHBvb2wgZm9yIGEgZnJlZSBpZnJhbWUgdG8gcmV1c2UuCiAgICAgICAgICAgIGlmcmFtZVBvb2xbaV0gPSBpZnIgPSBudWxsOwogICAgICAgICAgICBpZnJhbWVQb29sLnNwbGljZShpLCAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmci5yZWN5Y2xhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIGlmcmFtZSA9IGlmcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gSWdub3JlOyBJRTcgdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byByZWFkIHJlYWR5U3RhdGUgYW5kCiAgICAgICAgLy8gcmVhZHlTdGF0ZSBpc24ndCBzZXQuCiAgICAgIH0KICAgIH0KICAgIC8vIENyZWF0ZSBJRnJhbWUgaWYgbmVjZXNzYXJ5CiAgICBpZiAoIWlmcmFtZSkgewogICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgaWZyYW1lLnN0eWxlLmJvcmRlciA9IGlmcmFtZS5zdHlsZS53aWR0aCA9IGlmcmFtZS5zdHlsZS5oZWlnaHQgPSAnMHB4JzsKICAgICAgaWZyYW1lLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgaWZyYW1lLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgICAgaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uKCkgeyB0aGlzLnJlY3ljbGFibGUgPSB0cnVlOyB9OwogICAgICBpZnJhbWVQb29sLnB1c2goaWZyYW1lKTsKICAgIH0KICAgIGlmcmFtZS5zcmMgPSBzcmM7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7IH0sIDApOwogIH0KCiAgICAvL0ZpbmQgYSB0YXJnZXQgSUZyYW1lIG9yIHdpbmRvdyBiYXNlZCBvZmYgYW4gUlBDIElELCBhbGxvd2luZyBmb3IKICAgIC8vdGhlIGZhY3QgdGhhdCBjaGlsZCBwb3B1cCB3aW5kb3dzIHdpdGggSUZyYW1lcyBtaWdodCBleGlzdC4KICAgIGZ1bmN0aW9uIGdldFRhcmdldFdpbihpZCkgewogICAgICBpZiAodHlwZW9mIGlkID09PSAidW5kZWZpbmVkIiB8fCBpZCA9PT0gIi4uIikgewogICAgICAgICAgLy8gQ2hyb21lIDMwIHRocm93cyBTZWN1cml0eUVycm9yIHdoZW4gYWNjZXNzaW5nIG9wZW5lciBwcm9wZXJ0eSBvbiB3aW5kb3cucGFyZW50CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvL0NoZWNrIHRvIHNlZSBpZiB3ZSBhcmUgYW4gaWZyYW1lIGluIGEgY2hpbGQgd2luZG93LCBhbmQgaWYgc28gdXNlIHRoZSBvcGVuZXIKICAgICAgICAgICAgaWYoc2FtZURvbWFpbltpZF0gIT09IGZhbHNlICYmIHdpbmRvdy5wYXJlbnQub3BlbmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LnBhcmVudC5vcGVuZXIucGFyZW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjYXRjaChlKSB7fQogICAgICAgICAgLy9Ob3JtYWwgY2FzZSwgd2UgYXJlIGFuIElGcmFtZSBpbiBhIHBhZ2UKICAgICAgICAgIHJldHVybiB3aW5kb3cucGFyZW50OwogICAgICB9CgogICAgICAvL0F0IHRoaXMgcG9pbnQgd2UgYXJlIGEgY29udGFpbmVyIGxvb2tpbmcgZm9yIGEgY2hpbGQgaWZyYW1lCgogICAgICAvLyBDYXN0IHRvIGEgU3RyaW5nIHRvIGF2b2lkIGFuIGluZGV4IGxvb2t1cC4KICAgICAgaWQgPSBTdHJpbmcoaWQpOwoKICAgICAgdmFyIHRhcmdldCA9IG51bGw7CgogICAgICAvLyBUcnkgd2luZG93LmZyYW1lcyBmaXJzdAogICAgICAvL2FwcGFyZW50bHkgaW4gRkYgdXNpbmcgd2luZG93LmZyYW1lcyB3aWxsIHJldHVybiBhIGJvZ3VzIHdpbmRvdyBvYmplY3QgaWYgdGhlCiAgICAgIC8vaWZyYW1lIHdhcyByZW1vdmVkIGFuZCByZS1hZGRlZCB0byB0aGUgZG9jdW1lbnQgc28gaXQncyBhbHdheXMgYmV0dGVyIHRvIGp1c3QgZG8KICAgICAgLy9hIGRvbSBsb29rdXAKLy8gICAgICB0YXJnZXQgPSB3aW5kb3cuZnJhbWVzW2lkXTsKLy8gICAgICBpZiAodGFyZ2V0KSB7Ci8vICAgICAgICAgIHJldHVybiB0YXJnZXQ7Ci8vICAgICAgfQoKICAgICAgLy8gRmFsbCBiYWNrIHRvIGdldEVsZW1lbnRCeUlkKCkKICAgICAgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC5jb250ZW50V2luZG93KSB7CiAgICAgICAgcmV0dXJuIHRhcmdldC5jb250ZW50V2luZG93OwogICAgICB9CgogICAgICAvLyBBdCB0aGlzIHBvaW50IHdlIGhhdmUgbWlzc2VkIG9uIHNlYXJjaGluZyBmb3IgY2hpbGQgaWZyYW1lcwogICAgICAvLyBpbiB0aGUgbWFpbiBicm93c2VyIHdpbmRvdywgc28gc2VhcmNoIHBvcHVwIHdpbmRvd3MKICAgICAgLy8gVGhpcyBhc3N1bWVzIHRoZSBjb250YWluZXIgaXMga2VlcGluZyBhIGxpc3Qgb2YgY2hpbGQKICAgICAgLy8gd2luZG93cyBpbiB0aGUgZ2xvYmFsIF9jaGlsZFdpbmRvd3MgYXJyYXkKICAgICAgaWYgKHR5cGVvZiBfY2hpbGRXaW5kb3dzICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgZm9yKHZhciBpaT0wOyBpaTxfY2hpbGRXaW5kb3dzLmxlbmd0aDtpaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGNoaWxkV2luZG93ID0gX2NoaWxkV2luZG93c1tpaV07CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgLy9JbiBJRSA4LCB0aGlzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLgogICAgICAgICAgICAgICAgICBpZiAoY2hpbGRXaW5kb3cuZG9jdW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IGNoaWxkV2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgICAvL0JVRy4gRG9uJ3Qga25vdyBob3cgdG8gc3VwcG9ydAogICAgICAgICAgICAgICAgICAvL2RpcmVjdCBXTVAgY2FsbHMgZnJvbSBwYXJlbnQgdG8gY2hpbGQgcG9wdXBzCiAgICAgICAgICAgICAgICAgIC8vaW4gSUUgOC4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQuY29udGVudFdpbmRvdykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5jb250ZW50V2luZG93OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCgogIC8qKgogICAqIEF0dGVtcHRzIHRvIG1ha2UgYW4gcnBjIGJ5IGNhbGxpbmcgdGhlIHRhcmdldCdzIHJlY2VpdmUgbWV0aG9kIGRpcmVjdGx5LgogICAqIFRoaXMgd29ya3Mgd2hlbiBnYWRnZXRzIGFyZSByZW5kZXJlZCBvbiB0aGUgc2FtZSBkb21haW4gYXMgdGhlaXIgY29udGFpbmVyLAogICAqIGEgcG90ZW50aWFsbHkgdXNlZnVsIG9wdGltaXphdGlvbiBmb3IgdHJ1c3RlZCBjb250ZW50IHdoaWNoIGtlZXBzCiAgICogUlBDIGJlaGluZCBhIGNvbnNpc3RlbnQgaW50ZXJmYWNlLgogICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXQgTW9kdWxlIGlkIG9mIHRoZSBycGMgc2VydmljZSBwcm92aWRlcgogICAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tIE1vZHVsZSBpZCBvZiB0aGUgY2FsbGVyICh0aGlzKQogICAqIEBwYXJhbSB7U3RyaW5nfSBjYWxsYmFja0lkIElkIG9mIHRoZSBjYWxsCiAgICogQHBhcmFtIHtTdHJpbmd9IHJwY0RhdGEgSlNPTi1lbmNvZGVkIFJQQyBwYXlsb2FkCiAgICogQHJldHVybgogICAqLwogIGZ1bmN0aW9uIGNhbGxTYW1lRG9tYWluKHRhcmdldCwgcnBjKSB7CiAgICB2YXIgZm47CgogICAgaWYgKHNhbWVEb21haW5bdGFyZ2V0XSAhPT0gZmFsc2UpIHsKICAgICAgLy8gU2VlZCB3aXRoIGEgbmVnYXRpdmUsIHR5cGVkIHZhbHVlIHRvIGF2b2lkCiAgICAgIC8vIGhpdHRpbmcgdGhpcyBjb2RlIHBhdGggcmVwZWF0ZWRseQogICAgICB2YXIgdGFyZ2V0RWwgPSBnZXRUYXJnZXRXaW4odGFyZ2V0KTsKCiAgICAgIHRyeSB7CiAgICAgICAgLy8gSWYgdGhpcyBzdWNjZWVkcywgdGhlbiBzYW1lLWRvbWFpbiBwb2xpY3kgYXBwbGllZAovLyAgICAgICAgc2FtZURvbWFpblt0YXJnZXRdID0gdGFyZ2V0RWwuZ2FkZ2V0cy5ycGMucmVjZWl2ZVNhbWVEb21haW47CiAgICAgICAgZm4gPSB0YXJnZXRFbC5nYWRnZXRzLnJwYy5yZWNlaXZlU2FtZURvbWFpbjsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIFVzdWFsIGNhc2U6IGRpZmZlcmVudCBkb21haW5zCiAgICAgIH0KICAgIH0KCiAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIC8vIENhbGwgdGFyZ2V0J3MgcmVjZWl2ZSBtZXRob2QKICAgICAgZm4ocnBjKTsKICAgICAgc2FtZURvbWFpblt0YXJnZXRdID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBlbHNlCiAgICAgICAgc2FtZURvbWFpblt0YXJnZXRdID0gZmFsc2U7CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gZ2FkZ2V0cy5jb25maWcgbWlnaHQgbm90IGJlIGF2YWlsYWJsZSwgc3VjaCBhcyB3aGVuIHNlcnZpbmcgY29udGFpbmVyIGpzLgogIGlmIChnYWRnZXRzLmNvbmZpZykgewogICAgLyoqCiAgICAgKiBJbml0aWFsaXplcyBSUEMgZnJvbSB0aGUgcHJvdmlkZWQgY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdChjb25maWcpIHsKCSAgLy9hbGVydCgiQ09OVEFJTkVSIENvbmZpZzogIiArIGNvbmZpZyk7CiAgICAgIC8vIEFsbG93IGZvciB3aWxkIGNhcmQgcGFyZW50IHJlbGF5IGZpbGVzIGFzIGxvbmcgYXMgaXQncyBmcm9tIGEKICAgICAgLy8gd2hpdGUgbGlzdGVkIGRvbWFpbi4gVGhpcyBpcyBlbmZvcmNlZCBieSB0aGUgcmVuZGVyaW5nIHNlcnZsZXQuCiAgICAgIGlmIChjb25maWcucnBjLnBhcmVudFJlbGF5VXJsLnN1YnN0cmluZygwLCA3KSA9PT0gJ2h0dHA6Ly8nKSB7CiAgICAgICAgcmVsYXlVcmxbJy4uJ10gPSBjb25maWcucnBjLnBhcmVudFJlbGF5VXJsOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEl0J3MgYSByZWxhdGl2ZSBwYXRoLCBhbmQgd2UgbXVzdCBhcHBlbmQgdG8gdGhlIHBhcmVudC4KICAgICAgICAvLyBXZSdyZSByZWx5aW5nIG9uIHRoZSBzZXJ2ZXIgdmFsaWRhdGluZyB0aGUgcGFyZW50IHBhcmFtZXRlciBpbiB0aGlzCiAgICAgICAgLy8gY2FzZS4gQmVjYXVzZSBvZiB0aGlzLCBwYXJlbnQgbWF5IG9ubHkgYmUgcGFzc2VkIGluIHRoZSBxdWVyeSwgbm90CiAgICAgICAgLy8gdGhlIGZyYWdtZW50LgogICAgICAgIHZhciBwYXJhbXMgPSBkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDApLnNwbGl0KCImIik7CgkJLy9hbGVydCgiSW5pdCBDb25maWcgbWV0aG9kIC0gU2V0dGluZyBQYXJhbXM6ICIgKyBwYXJhbXMpOwogICAgICAgIHZhciBwYXJlbnRQYXJhbSA9ICIiOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBwYXJhbTsgcGFyYW0gPSBwYXJhbXNbaV07ICsraSkgewogICAgICAgICAgLy8gT25seSB0aGUgZmlyc3QgcGFyZW50IGNhbiBiZSB2YWxpZGF0ZWQuCiAgICAgICAgICBpZiAocGFyYW0uaW5kZXhPZigicGFyZW50PSIpID09PSAwKSB7CiAgICAgICAgICAgIHBhcmVudFBhcmFtID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtLnN1YnN0cmluZyg3KSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZWxheVVybFsnLi4nXSA9IHBhcmVudFBhcmFtICsgY29uZmlnLnJwYy5wYXJlbnRSZWxheVVybDsKICAgICAgfQogICAgICB1c2VMZWdhY3lQcm90b2NvbFsnLi4nXSA9ICEhY29uZmlnLnJwYy51c2VMZWdhY3lQcm90b2NvbDsKICAgIH0KCiAgICB2YXIgcmVxdWlyZWRDb25maWcgPSB7CiAgICAgIHBhcmVudFJlbGF5VXJsIDogZ2FkZ2V0cy5jb25maWcuTm9uRW1wdHlTdHJpbmdWYWxpZGF0b3IKICAgIH07CiAgICBnYWRnZXRzLmNvbmZpZy5yZWdpc3RlcigicnBjIiwgcmVxdWlyZWRDb25maWcsIGluaXQpOwogIH0KCiAgcmV0dXJuIC8qKiBAc2NvcGUgZ2FkZ2V0cy5ycGMgKi8gewogICAgLyoqCiAgICAgKiBSZWdpc3RlcnMgYW4gUlBDIHNlcnZpY2UuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgU2VydmljZSBuYW1lIHRvIHJlZ2lzdGVyLgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBTZXJ2aWNlIGhhbmRsZXIuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnJwYwogICAgICovCiAgICByZWdpc3RlcjogZnVuY3Rpb24oc2VydmljZU5hbWUsIGhhbmRsZXIpIHsKCS8vYWxlcnQoIkNPTlRBSU5FUiBSRUdJU1RFUiBWQVJJQUJMRVM6ICIgKyBzZXJ2aWNlTmFtZSArICIgLXwtICIgKyBoYW5kbGVyKTsKICAgICAgaWYgKHNlcnZpY2VOYW1lID09IENBTExCQUNLX05BTUUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBvdmVyd3JpdGUgY2FsbGJhY2sgc2VydmljZSIpOwogICAgICB9CgogICAgICBpZiAoc2VydmljZU5hbWUgPT0gREVGQVVMVF9OQU1FKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgb3ZlcndyaXRlIGRlZmF1bHQgc2VydmljZToiCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiB1c2UgcmVnaXN0ZXJEZWZhdWx0Iik7CiAgICAgIH0KCSAgc2VydmljZXNbc2VydmljZU5hbWVdID0gaGFuZGxlcjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBVbnJlZ2lzdGVycyBhbiBSUEMgc2VydmljZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSBTZXJ2aWNlIG5hbWUgdG8gdW5yZWdpc3Rlci4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIHVucmVnaXN0ZXI6IGZ1bmN0aW9uKHNlcnZpY2VOYW1lKSB7CiAgICAgIGlmIChzZXJ2aWNlTmFtZSA9PSBDQUxMQkFDS19OQU1FKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZGVsZXRlIGNhbGxiYWNrIHNlcnZpY2UiKTsKICAgICAgfQoKICAgICAgaWYgKHNlcnZpY2VOYW1lID09IERFRkFVTFRfTkFNRSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGRlbGV0ZSBkZWZhdWx0IHNlcnZpY2U6IgogICAgICAgICAgICAgICAgICAgICAgICArICIgdXNlIHVucmVnaXN0ZXJEZWZhdWx0Iik7CiAgICAgIH0KCiAgICAgIGRlbGV0ZSBzZXJ2aWNlc1tzZXJ2aWNlTmFtZV07CiAgICB9LAoKICAgIC8qKgogICAgICogUmVnaXN0ZXJzIGEgZGVmYXVsdCBzZXJ2aWNlIGhhbmRsZXIgdG8gcHJvY2Vzc2VzIGFsbCB1bmtub3duCiAgICAgKiBSUEMgY2FsbHMgd2hpY2ggcmFpc2UgYW4gZXhjZXB0aW9uIGJ5IGRlZmF1bHQuCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFNlcnZpY2UgaGFuZGxlci4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIHJlZ2lzdGVyRGVmYXVsdDogZnVuY3Rpb24oaGFuZGxlcikgewogICAgICBzZXJ2aWNlc1snJ10gPSBoYW5kbGVyOwogICAgfSwKCiAgICAvKioKICAgICAqIFVucmVnaXN0ZXJzIHRoZSBkZWZhdWx0IHNlcnZpY2UgaGFuZGxlci4gRnV0dXJlIHVua25vd24gUlBDCiAgICAgKiBjYWxscyB3aWxsIGZhaWwgc2lsZW50bHkuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnJwYwogICAgICovCiAgICB1bnJlZ2lzdGVyRGVmYXVsdDogZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0ZSBzZXJ2aWNlc1snJ107CiAgICB9LAoKICAgIC8qKgogICAgICogQ2FsbHMgYW4gUlBDIHNlcnZpY2UuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGFyZ2V0SWQgTW9kdWxlIElkIG9mIHRoZSBSUEMgc2VydmljZSBwcm92aWRlci4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBFbXB0eSBpZiBjYWxsaW5nIHRoZSBwYXJlbnQgY29udGFpbmVyLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlcnZpY2VOYW1lIFNlcnZpY2UgbmFtZSB0byBjYWxsLgogICAgICogQHBhcmFtIHtGdW5jdGlvbnxudWxsfSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiAoaWYgYW55KSB0byBwcm9jZXNzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIFJQQyByZXF1ZXN0LgogICAgICogQHBhcmFtIHsqfSB2YXJfYXJncyBQYXJhbWV0ZXJzIGZvciB0aGUgUlBDIHJlcXVlc3QuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnJwYwogICAgICovCiAgICBjYWxsOiBmdW5jdGlvbih0YXJnZXRJZCwgc2VydmljZU5hbWUsIGNhbGxiYWNrLCB2YXJfYXJncykgewogICAgICArK2NhbGxJZDsKCSAgdGFyZ2V0SWQgPSBnZXRJZCh0YXJnZXRJZCkgfHwgJy4uJzsKICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2tzW2NhbGxJZF0gPSBjYWxsYmFjazsKICAgICAgfQoKICAgICAgLy8gRGVmYXVsdCB0byB0aGUgY29udGFpbmVyIGNhbGxpbmcuCiAgICAgIHZhciBmcm9tID0gJy4uJzsKCiAgICAgIGlmICh0YXJnZXRJZCA9PT0gJy4uJykgewovLyAgICAgICAgZnJvbSA9IHdpbmRvdy5uYW1lOwogICAgICAgIGZyb20gPSBnZXRJZCh3aW5kb3cubmFtZSk7CiAgICAgIH0KCiAgICAgIC8vIE5vdCB1c2VkIGJ5IGxlZ2FjeSwgY3JlYXRlIGl0IGFueXdheS4uLgogICAgICB2YXIgcnBjID0gewogICAgICAgIHM6IHNlcnZpY2VOYW1lLAogICAgICAgIGY6IGZyb20sCiAgICAgICAgYzogY2FsbGJhY2sgPyBjYWxsSWQgOiAwLAogICAgICAgIGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyksCiAgICAgICAgdDogYXV0aFRva2VuW3RhcmdldElkXQogICAgICB9OwoKICAgICAgLy8gSWYgdGFyZ2V0IGlzIG9uIHRoZSBzYW1lIGRvbWFpbiwgY2FsbCBtZXRob2QgZGlyZWN0bHkKICAgICAgaWYgKGNhbGxTYW1lRG9tYWluKHRhcmdldElkLCBycGMpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcnBjRGF0YSA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkocnBjKTsKCiAgICAgIHZhciBjaGFubmVsVHlwZSA9IHJlbGF5Q2hhbm5lbDsKCiAgICAgIC8vIElmIHdlIGFyZSB0b2xkIHRvIHVzZSB0aGUgbGVnYWN5IGZvcm1hdCwgdGhlbiB3ZSBtdXN0CiAgICAgIC8vIGRlZmF1bHQgdG8gSUZQQy4KICAgICAgaWYgKHVzZUxlZ2FjeVByb3RvY29sW3RhcmdldElkXSkgewogICAgICAgIGNoYW5uZWxUeXBlID0gJ2lmcGMnOwogICAgICB9CgogICAgICAvL2FsZXJ0KCdjaGFubmVsVHlwZTonK2NoYW5uZWxUeXBlKTsKICAgICAgc3dpdGNoIChjaGFubmVsVHlwZSkgewogICAgICAgIGNhc2UgJ2RwbSc6IC8vIHVzZSBkb2N1bWVudC5wb3N0TWVzc2FnZS4KICAgICAgICAgIC8vIEdldCB0aGUgd2luZG93IGZyb20gdGhlIGRvY3VtZW50LiBGaXhlcyBhIGJ1ZyB3aXRoIHBvc3RNZXNzYWdlCiAgICAgICAgICAvLyBjYWxscyBvbiBhIHRhcmdldCB0aGF0IGhhZCBiZWVuIHJlbW92ZWQgdGhlbiBhcHBlbmRlZCB0byB0aGUgZG9jdW1lbnQgb2JqZWN0CiAgICAgICAgICAgIHZhciB0YXJnZXRXaW4gPSBnZXRUYXJnZXRXaW4odGFyZ2V0SWQpOwogICAgICAgICAgICB2YXIgdGFyZ2V0RG9jID0gdGFyZ2V0V2luLmRvY3VtZW50OwoKICAgICAgICAgIGlmICh0YXJnZXREb2MgIT0gbnVsbCkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB0YXJnZXREb2MucG9zdE1lc3NhZ2UocnBjRGF0YSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBjYWxsSWZwYyh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEsIHJwYy5hKTsKICAgICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ3dwbSc6IC8vIHVzZSB3aW5kb3cucG9zdE1lc3NhZ2UuCiAgICAgICAgICAvLyBHZXQgdGhlIHdpbmRvdyBmcm9tIHRoZSBkb2N1bWVudC4gRml4ZXMgYSBidWcgd2l0aCBwb3N0TWVzc2FnZQogICAgICAgICAgLy8gY2FsbHMgb24gYSB0YXJnZXQgdGhhdCBoYWQgYmVlbiByZW1vdmVkIHRoZW4gYXBwZW5kZWQgdG8gdGhlIGRvY3VtZW50IG9iamVjdAogICAgICAgICAgICB2YXIgdGFyZ2V0V2luID0gZ2V0VGFyZ2V0V2luKHRhcmdldElkKTsKCiAgICAgICAgICBpZiAodGFyZ2V0V2luICE9IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB0YXJnZXRXaW4ucG9zdE1lc3NhZ2UocnBjRGF0YSwgcmVsYXlVcmxbdGFyZ2V0SWRdKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGNhbGxJZnBjKHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSwgcnBjLmEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnbml4JzogLy8gdXNlIE5JWC4KICAgICAgICAgIC8vYWxlcnQoJ2NhbGxOaXghJyk7CiAgICAgICAgICBjYWxsTml4KHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnZmUnOiAvLyB1c2UgRnJhbWVFbGVtZW50LgogICAgICAgICAgY2FsbEZyYW1lRWxlbWVudCh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEsIHJwYy5hKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OiAvLyB1c2UgJ2lmcGMnIGFzIGEgZmFsbGJhY2sgbWVjaGFuaXNtLgogICAgICAgICAgY2FsbElmcGModGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhLCBycGMuYSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEdldHMgdGhlIHJlbGF5IFVSTCBvZiBhIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRJZCBOYW1lIG9mIHRoZSB0YXJnZXQgZnJhbWUuCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd8dW5kZWZpbmVkfSBSZWxheSBVUkwgb2YgdGhlIHRhcmdldCBmcmFtZS4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIGdldFJlbGF5VXJsOiBmdW5jdGlvbih0YXJnZXRJZCkgewogICAgICByZXR1cm4gcmVsYXlVcmxbdGFyZ2V0SWRdOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgdGhlIHJlbGF5IFVSTCBvZiBhIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRJZCBOYW1lIG9mIHRoZSB0YXJnZXQgZnJhbWUuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIEZ1bGwgcmVsYXkgVVJMIG9mIHRoZSB0YXJnZXQgZnJhbWUuCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdF91c2VMZWdhY3kgVHJ1ZSBpZiB0aGlzIHJlbGF5IG5lZWRzIHRoZSBsZWdhY3kgSUZQQwogICAgICogICAgIHdpcmUgZm9ybWF0LgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgc2V0UmVsYXlVcmw6IGZ1bmN0aW9uKHRhcmdldElkLCB1cmwsIG9wdF91c2VMZWdhY3ksIHVzZU11bHRpUGFydE1lc3NhZ2VzRm9ySUZQQykgewogICAgICByZWxheVVybFt0YXJnZXRJZF0gPSB1cmw7CiAgICAgIHVzZUxlZ2FjeVByb3RvY29sW3RhcmdldElkXSA9ICEhb3B0X3VzZUxlZ2FjeTsKICAgICAgdXNlTXVsdGlQYXJ0TWVzc2FnZXNbdGFyZ2V0SWRdID0gISF1c2VNdWx0aVBhcnRNZXNzYWdlc0ZvcklGUEM7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyB0aGUgYXV0aCB0b2tlbiBvZiBhIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRJZCBOYW1lIG9mIHRoZSB0YXJnZXQgZnJhbWUuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9rZW4gVGhlIGF1dGhlbnRpY2F0aW9uIHRva2VuIHRvIHVzZSBmb3IgYWxsCiAgICAgKiAgICAgY2FsbHMgdG8gb3IgZnJvbSB0aGlzIHRhcmdldCBpZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIHNldEF1dGhUb2tlbjogZnVuY3Rpb24odGFyZ2V0SWQsIHRva2VuKSB7CiAgICAgIGF1dGhUb2tlblt0YXJnZXRJZF0gPSB0b2tlbjsKICAgICAgc2V0dXBGcmFtZSh0YXJnZXRJZCwgdG9rZW4pOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldHMgdGhlIFJQQyByZWxheSBtZWNoYW5pc20uCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFJQQyByZWxheSBtZWNoYW5pc20uIFNlZSBhYm92ZSBmb3IKICAgICAqICAgYSBsaXN0IG9mIHN1cHBvcnRlZCB0eXBlcy4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIGdldFJlbGF5Q2hhbm5lbDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZWxheUNoYW5uZWw7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVjZWl2ZXMgYW5kIHByb2Nlc3NlcyBhbiBSUEMgcmVxdWVzdC4gKE5vdCB0byBiZSB1c2VkIGRpcmVjdGx5LikKICAgICAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IGZyYWdtZW50IEFuIFJQQyByZXF1ZXN0IGZyYWdtZW50IGVuY29kZWQgYXMKICAgICAqICAgICAgICBhbiBhcnJheS4gVGhlIGZpcnN0IDQgZWxlbWVudHMgYXJlIHRhcmdldCBpZCwgc291cmNlIGlkICYgY2FsbCBpZCwKICAgICAqICAgICAgICB0b3RhbCBwYWNrZXQgbnVtYmVyLCBwYWNrZXQgaWQuIFRoZSBsYXN0IGVsZW1lbnQgc3RvcmVzIHRoZSBhY3R1YWwKICAgICAqICAgICAgICBKU09OLWVuY29kZWQgYW5kIFVSSSBlc2NhcGVkIHBhY2tldCBkYXRhLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgcmVjZWl2ZTogZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgaWYgKGZyYWdtZW50Lmxlbmd0aCA+IDQpIHsKLy8gICAgICAgIC8vIFRPRE8gcGFyc2UgZnJhZ21lbnRbMS4uM10gdG8gbWVyZ2UgbXVsdGktZnJhZ21lbnQgbWVzc2FnZXMKLy8gICAgICAgIHByb2Nlc3MoZ2FkZ2V0cy5qc29uLnBhcnNlKAovLyAgICAgICAgICAgIGRlY29kZVVSSUNvbXBvbmVudChmcmFnbWVudFtmcmFnbWVudC5sZW5ndGggLSAxXSkpKTsKCiAgICAgICAgdmFyIGZyb20gPSBmcmFnbWVudFsxXSwgICAvLyBpbiB0aGUgZm9ybSBvZiAiPGZyb20+QDxjYWxsaWQ+IgogICAgICAgICAgICBudW1QYWNrZXRzID0gcGFyc2VJbnQoZnJhZ21lbnRbMl0sIDEwKSwKICAgICAgICAgICAgcGFja2V0SWR4ID0gcGFyc2VJbnQoZnJhZ21lbnRbM10sIDEwKSwKICAgICAgICAgICAgcGF5bG9hZCA9IGZyYWdtZW50W2ZyYWdtZW50Lmxlbmd0aCAtIDFdLAogICAgICAgICAgICBjb21wbGV0ZWQgPSBudW1QYWNrZXRzID09PSAxOwoKICAgICAgICAvLyBpZiBtZXNzYWdlIGlzIG11bHRpLXBhcnQsIHN0b3JlIHBhcnRzIGluIHRoZSBwcm9wZXIgb3JkZXIKICAgICAgICBpZiAobnVtUGFja2V0cyA+IDEpIHsKICAgICAgICAgIGlmICghbWVzc2FnZXNJbltmcm9tXSkgewogICAgICAgICAgICBtZXNzYWdlc0luW2Zyb21dID0gW107CiAgICAgICAgICB9CiAgICAgICAgICBtZXNzYWdlc0luW2Zyb21dW3BhY2tldElkeF0gPSBwYXlsb2FkOwogICAgICAgICAgLy8gY2hlY2sgaWYgYWxsIHBhcnRzIGhhdmUgYmVlbiBzZW50CiAgICAgICAgICBpZiAoaXNNZXNzYWdlQ29tcGxldGUobWVzc2FnZXNJbltmcm9tXSwgbnVtUGFja2V0cykpIHsKICAgICAgICAgICAgcGF5bG9hZCA9IG1lc3NhZ2VzSW5bZnJvbV0uam9pbignJyk7CiAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlc0luW2Zyb21dOwogICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY29tcGxldGUgbWVzc2FnZSBzZW50CiAgICAgICAgaWYgKGNvbXBsZXRlZCkgewogICAgICAgICAgcHJvY2VzcyhnYWRnZXRzLmpzb24ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KHBheWxvYWQpKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUmVjZWl2ZXMgYW5kIHByb2Nlc3NlcyBhbiBSUEMgcmVxdWVzdCBzZW50IHZpYSB0aGUgc2FtZSBkb21haW4uCiAgICAgKiAoTm90IHRvIGJlIHVzZWQgZGlyZWN0bHkpLiBDb252ZXJ0cyB0aGUgaW5ib3VuZCBycGMgb2JqZWN0J3MKICAgICAqIEFycmF5IGludG8gYSBsb2NhbCBBcnJheSB0byBwYXNzIHRoZSBwcm9jZXNzKCkgQXJyYXkgdGVzdC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBycGMgUlBDIG9iamVjdCBjb250YWluaW5nIGFsbCByZXF1ZXN0IHBhcmFtcwogICAgICovCiAgICByZWNlaXZlU2FtZURvbWFpbjogZnVuY3Rpb24ocnBjKSB7CiAgICAgIC8vIFBhc3MgdGhyb3VnaCB0byBsb2NhbCBwcm9jZXNzIG1ldGhvZCBidXQgY29udmVydGluZyB0byBhIGxvY2FsIEFycmF5CiAgICAgIHJwYy5hID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwocnBjLmEpOwoJICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsgcHJvY2VzcyhycGMpIH0sIDApOwogICAgfQogIH07Cn0oKTsKCi8qCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQogKiB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4KICogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIEBmaWxlb3ZlcnZpZXcgR2FkZ2V0LXNpZGUgUHViU3ViIGxpYnJhcnkgZm9yIGdhZGdldC10by1nYWRnZXQgY29tbXVuaWNhdGlvbi4KICovCgp2YXIgZ2FkZ2V0cyA9IGdhZGdldHMgfHwge307CgovKioKICogQHN0YXRpYwogKiBAY2xhc3MgUHJvdmlkZXMgb3BlcmF0aW9ucyBmb3IgbWFraW5nIHJwYyBjYWxscy4KICogQG5hbWUgZ2FkZ2V0cy5wdWJzdWIKICovCmdhZGdldHMucHVic3ViID0gKGZ1bmN0aW9uKCkgewogIHZhciBsaXN0ZW5lcnMgPSB7fTsKCiAgZnVuY3Rpb24gcm91dGVyKGNoYW5uZWwsIHNlbmRlciwgbWVzc2FnZSkgewogICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJzW2NoYW5uZWxdOwogICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBsaXN0ZW5lcihzZW5kZXIsIG1lc3NhZ2UsY2hhbm5lbCk7CiAgICB9CiAgfQoKICByZXR1cm4gLyoqIEBzY29wZSBnYWRnZXRzLnB1YnN1YiAqLyB7CiAgICAvKioKICAgICAqIFB1Ymxpc2hlcyBhIG1lc3NhZ2UgdG8gYSBjaGFubmVsLgogICAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWwgQ2hhbm5lbCBuYW1lLgogICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgTWVzc2FnZSB0byBwdWJsaXNoLgogICAgICovCiAgICBwdWJsaXNoOiBmdW5jdGlvbihjaGFubmVsLCBtZXNzYWdlLCBkZXN0KSB7CiAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ3B1YnN1YicsIG51bGwsICdwdWJsaXNoJywgY2hhbm5lbCwgbWVzc2FnZSwgZGVzdCk7CiAgICB9LAoKICAgIC8qKgogICAgICogU3Vic2NyaWJlcyB0byBhIGNoYW5uZWwuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbCBDaGFubmVsIG5hbWUuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IHJlY2VpdmVzIG1lc3NhZ2VzLgogICAgICogICAgICAgICAgICAgICAgICAgRm9yIGV4YW1wbGU6CiAgICAgKiAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihzZW5kZXIsIG1lc3NhZ2UpIHsKICAgICAqICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVHJ1c3RlZEdhZGdldFNwZWNVcmwoc2VuZGVyKSkgewogICAgICogICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UpOwogICAgICogICAgICAgICAgICAgICAgICAgICB9CiAgICAgKiAgICAgICAgICAgICAgICAgICB9CiAgICAgKi8KICAgIHN1YnNjcmliZTogZnVuY3Rpb24oY2hhbm5lbCwgY2FsbGJhY2spIHsKICAgICAgbGlzdGVuZXJzW2NoYW5uZWxdID0gY2FsbGJhY2s7CiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCdwdWJzdWInLCByb3V0ZXIpOwogICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdwdWJzdWInLCBudWxsLCAnc3Vic2NyaWJlJywgY2hhbm5lbCk7CiAgICB9LAoKICAgIC8qKgogICAgICogVW5zdWJzY3JpYmVzIGZyb20gYSBjaGFubmVsLgogICAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWwgQ2hhbm5lbCBuYW1lLgogICAgICovCiAgICB1bnN1YnNjcmliZTogZnVuY3Rpb24oY2hhbm5lbCkgewogICAgICBkZWxldGUgbGlzdGVuZXJzW2NoYW5uZWxdOwogICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdwdWJzdWInLCBudWxsLCAndW5zdWJzY3JpYmUnLCBjaGFubmVsKTsKICAgICAgfQoKICB9Owp9KSgpOwoKCi8qKg0KICogQ29weXJpZ2h0IDIwMDkgVGltIERvd24uDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQoNCg0KaWYoIUFycmF5LnByb3RvdHlwZS5wdXNoKXtBcnJheS5wcm90b3R5cGUucHVzaD1mdW5jdGlvbigpe2Zvcih2YXIgaT0wLGxlbj1hcmd1bWVudHMubGVuZ3RoO2k8bGVuO2krKyl7dGhpc1t0aGlzLmxlbmd0aF09YXJndW1lbnRzW2ldO30NCnJldHVybiB0aGlzLmxlbmd0aDt9O30NCmlmKCFBcnJheS5wcm90b3R5cGUuc2hpZnQpe0FycmF5LnByb3RvdHlwZS5zaGlmdD1mdW5jdGlvbigpe2lmKHRoaXMubGVuZ3RoPjApe3ZhciBmaXJzdEl0ZW09dGhpc1swXTtmb3IodmFyIGk9MCxsZW49dGhpcy5sZW5ndGgtMTtpPGxlbjtpKyspe3RoaXNbaV09dGhpc1tpKzFdO30NCnRoaXMubGVuZ3RoPXRoaXMubGVuZ3RoLTE7cmV0dXJuIGZpcnN0SXRlbTt9fTt9DQppZighQXJyYXkucHJvdG90eXBlLnNwbGljZSl7QXJyYXkucHJvdG90eXBlLnNwbGljZT1mdW5jdGlvbihzdGFydEluZGV4LGRlbGV0ZUNvdW50KXt2YXIgaXRlbXNBZnRlckRlbGV0ZWQ9dGhpcy5zbGljZShzdGFydEluZGV4K2RlbGV0ZUNvdW50KTt2YXIgaXRlbXNEZWxldGVkPXRoaXMuc2xpY2Uoc3RhcnRJbmRleCxzdGFydEluZGV4K2RlbGV0ZUNvdW50KTt0aGlzLmxlbmd0aD1zdGFydEluZGV4O3ZhciBhcmd1bWVudHNBcnJheT1bXTtmb3IodmFyIGk9MCxsZW49YXJndW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe2FyZ3VtZW50c0FycmF5W2ldPWFyZ3VtZW50c1tpXTt9DQp2YXIgaXRlbXNUb0FwcGVuZD0oYXJndW1lbnRzQXJyYXkubGVuZ3RoPjIpP2l0ZW1zQWZ0ZXJEZWxldGVkPWFyZ3VtZW50c0FycmF5LnNsaWNlKDIpLmNvbmNhdChpdGVtc0FmdGVyRGVsZXRlZCk6aXRlbXNBZnRlckRlbGV0ZWQ7Zm9yKGk9MCxsZW49aXRlbXNUb0FwcGVuZC5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLnB1c2goaXRlbXNUb0FwcGVuZFtpXSk7fQ0KcmV0dXJuIGl0ZW1zRGVsZXRlZDt9O30NCnZhciBsb2c0amF2YXNjcmlwdDsoZnVuY3Rpb24oKXtmdW5jdGlvbiBpc1VuZGVmaW5lZChvYmope3JldHVybiB0eXBlb2Ygb2JqPT0idW5kZWZpbmVkIjt9DQpmdW5jdGlvbiBFdmVudFN1cHBvcnQoKXt9DQpFdmVudFN1cHBvcnQucHJvdG90eXBlPXtldmVudFR5cGVzOltdLGV2ZW50TGlzdGVuZXJzOnt9LHNldEV2ZW50VHlwZXM6ZnVuY3Rpb24oZXZlbnRUeXBlc1BhcmFtKXtpZihldmVudFR5cGVzUGFyYW0gaW5zdGFuY2VvZiBBcnJheSl7dGhpcy5ldmVudFR5cGVzPWV2ZW50VHlwZXNQYXJhbTt0aGlzLmV2ZW50TGlzdGVuZXJzPXt9O2Zvcih2YXIgaT0wLGxlbj10aGlzLmV2ZW50VHlwZXMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5ldmVudExpc3RlbmVyc1t0aGlzLmV2ZW50VHlwZXNbaV1dPVtdO319ZWxzZXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuRXZlbnRTdXBwb3J0IFsiK3RoaXMrIl06IHNldEV2ZW50VHlwZXM6IGV2ZW50VHlwZXMgcGFyYW1ldGVyIG11c3QgYmUgYW4gQXJyYXkiKTt9fSxhZGRFdmVudExpc3RlbmVyOmZ1bmN0aW9uKGV2ZW50VHlwZSxsaXN0ZW5lcil7aWYodHlwZW9mIGxpc3RlbmVyPT0iZnVuY3Rpb24iKXtpZighYXJyYXlfY29udGFpbnModGhpcy5ldmVudFR5cGVzLGV2ZW50VHlwZSkpe2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdC5FdmVudFN1cHBvcnQgWyIrdGhpcysiXTogYWRkRXZlbnRMaXN0ZW5lcjogbm8gZXZlbnQgY2FsbGVkICciK2V2ZW50VHlwZSsiJyIpO30NCnRoaXMuZXZlbnRMaXN0ZW5lcnNbZXZlbnRUeXBlXS5wdXNoKGxpc3RlbmVyKTt9ZWxzZXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuRXZlbnRTdXBwb3J0IFsiK3RoaXMrIl06IGFkZEV2ZW50TGlzdGVuZXI6IGxpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbiIpO319LHJlbW92ZUV2ZW50TGlzdGVuZXI6ZnVuY3Rpb24oZXZlbnRUeXBlLGxpc3RlbmVyKXtpZih0eXBlb2YgbGlzdGVuZXI9PSJmdW5jdGlvbiIpe2lmKCFhcnJheV9jb250YWlucyh0aGlzLmV2ZW50VHlwZXMsZXZlbnRUeXBlKSl7aGFuZGxlRXJyb3IoImxvZzRqYXZhc2NyaXB0LkV2ZW50U3VwcG9ydCBbIit0aGlzKyJdOiByZW1vdmVFdmVudExpc3RlbmVyOiBubyBldmVudCBjYWxsZWQgJyIrZXZlbnRUeXBlKyInIik7fQ0KYXJyYXlfcmVtb3ZlKHRoaXMuZXZlbnRMaXN0ZW5lcnNbZXZlbnRUeXBlXSxsaXN0ZW5lcik7fWVsc2V7aGFuZGxlRXJyb3IoImxvZzRqYXZhc2NyaXB0LkV2ZW50U3VwcG9ydCBbIit0aGlzKyJdOiByZW1vdmVFdmVudExpc3RlbmVyOiBsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24iKTt9fSxkaXNwYXRjaEV2ZW50OmZ1bmN0aW9uKGV2ZW50VHlwZSxldmVudEFyZ3Mpe2lmKGFycmF5X2NvbnRhaW5zKHRoaXMuZXZlbnRUeXBlcyxldmVudFR5cGUpKXt2YXIgbGlzdGVuZXJzPXRoaXMuZXZlbnRMaXN0ZW5lcnNbZXZlbnRUeXBlXTtmb3IodmFyIGk9MCxsZW49bGlzdGVuZXJzLmxlbmd0aDtpPGxlbjtpKyspe2xpc3RlbmVyc1tpXSh0aGlzLGV2ZW50VHlwZSxldmVudEFyZ3MpO319ZWxzZXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuRXZlbnRTdXBwb3J0IFsiK3RoaXMrIl06IGRpc3BhdGNoRXZlbnQ6IG5vIGV2ZW50IGNhbGxlZCAnIitldmVudFR5cGUrIiciKTt9fX07dmFyIGFwcGxpY2F0aW9uU3RhcnREYXRlPW5ldyBEYXRlKCk7dmFyIHVuaXF1ZUlkPSJsb2c0amF2YXNjcmlwdF8iK2FwcGxpY2F0aW9uU3RhcnREYXRlLmdldFRpbWUoKSsiXyIrDQpNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDAwMDAwKTt2YXIgZW1wdHlGdW5jdGlvbj1mdW5jdGlvbigpe307dmFyIG5ld0xpbmU9IlxyXG4iO3ZhciBwYWdlTG9hZGVkPWZhbHNlO2Z1bmN0aW9uIExvZzRKYXZhU2NyaXB0KCl7fQ0KTG9nNEphdmFTY3JpcHQucHJvdG90eXBlPW5ldyBFdmVudFN1cHBvcnQoKTtsb2c0amF2YXNjcmlwdD1uZXcgTG9nNEphdmFTY3JpcHQoKTtsb2c0amF2YXNjcmlwdC52ZXJzaW9uPSIxLjQuMSI7bG9nNGphdmFzY3JpcHQuZWRpdGlvbj0ibG9nNGphdmFzY3JpcHQiO2Z1bmN0aW9uIHRvU3RyKG9iail7aWYob2JqJiZvYmoudG9TdHJpbmcpe3JldHVybiBvYmoudG9TdHJpbmcoKTt9ZWxzZXtyZXR1cm4gU3RyaW5nKG9iaik7fX0NCmZ1bmN0aW9uIGdldEV4Y2VwdGlvbk1lc3NhZ2UoZXgpe2lmKGV4Lm1lc3NhZ2Upe3JldHVybiBleC5tZXNzYWdlO31lbHNlIGlmKGV4LmRlc2NyaXB0aW9uKXtyZXR1cm4gZXguZGVzY3JpcHRpb247fWVsc2V7cmV0dXJuIHRvU3RyKGV4KTt9fQ0KZnVuY3Rpb24gZ2V0VXJsRmlsZU5hbWUodXJsKXt2YXIgbGFzdFNsYXNoSW5kZXg9TWF0aC5tYXgodXJsLmxhc3RJbmRleE9mKCIvIiksdXJsLmxhc3RJbmRleE9mKCJcXCIpKTtyZXR1cm4gdXJsLnN1YnN0cihsYXN0U2xhc2hJbmRleCsxKTt9DQpmdW5jdGlvbiBnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpe2lmKGV4KXt2YXIgZXhTdHI9IkV4Y2VwdGlvbjogIitnZXRFeGNlcHRpb25NZXNzYWdlKGV4KTt0cnl7aWYoZXgubGluZU51bWJlcil7ZXhTdHIrPSIgb24gbGluZSBudW1iZXIgIitleC5saW5lTnVtYmVyO30NCmlmKGV4LmZpbGVOYW1lKXtleFN0cis9IiBpbiBmaWxlICIrZ2V0VXJsRmlsZU5hbWUoZXguZmlsZU5hbWUpO319Y2F0Y2gobG9jYWxFeCl7bG9nTG9nLndhcm4oIlVuYWJsZSB0byBvYnRhaW4gZmlsZSBhbmQgbGluZSBpbmZvcm1hdGlvbiBmb3IgZXJyb3IiKTt9DQppZihzaG93U3RhY2tUcmFjZXMmJmV4LnN0YWNrKXtleFN0cis9bmV3TGluZSsiU3RhY2sgdHJhY2U6IituZXdMaW5lK2V4LnN0YWNrO30NCnJldHVybiBleFN0cjt9DQpyZXR1cm4gbnVsbDt9DQpmdW5jdGlvbiBib29sKG9iail7cmV0dXJuIEJvb2xlYW4ob2JqKTt9DQpmdW5jdGlvbiB0cmltKHN0cil7cmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrLywiIikucmVwbGFjZSgvXHMrJC8sIiIpO30NCmZ1bmN0aW9uIHNwbGl0SW50b0xpbmVzKHRleHQpe3ZhciB0ZXh0Mj10ZXh0LnJlcGxhY2UoL1xyXG4vZywiXG4iKS5yZXBsYWNlKC9cci9nLCJcbiIpO3JldHVybiB0ZXh0Mi5zcGxpdCgiXG4iKTt9DQpmdW5jdGlvbiB1cmxFbmNvZGUoc3RyKXtyZXR1cm4gZXNjYXBlKHN0cikucmVwbGFjZSgvXCsvZywiJTJCIikucmVwbGFjZSgvIi9nLCIlMjIiKS5yZXBsYWNlKC8nL2csIiUyNyIpLnJlcGxhY2UoL1wvL2csIiUyRiIpLnJlcGxhY2UoLz0vZywiJTNEIik7fQ0KZnVuY3Rpb24gdXJsRGVjb2RlKHN0cil7cmV0dXJuIHVuZXNjYXBlKHN0cikucmVwbGFjZSgvJTJCL2csIisiKS5yZXBsYWNlKC8lMjIvZywiXCIiKS5yZXBsYWNlKC8lMjcvZywiJyIpLnJlcGxhY2UoLyUyRi9nLCIvIikucmVwbGFjZSgvJTNEL2csIj0iKTt9DQpmdW5jdGlvbiBhcnJheV9yZW1vdmUoYXJyLHZhbCl7dmFyIGluZGV4PS0xO2Zvcih2YXIgaT0wLGxlbj1hcnIubGVuZ3RoO2k8bGVuO2krKyl7aWYoYXJyW2ldPT09dmFsKXtpbmRleD1pO2JyZWFrO319DQppZihpbmRleD49MCl7YXJyLnNwbGljZShpbmRleCwxKTtyZXR1cm4gdHJ1ZTt9ZWxzZXtyZXR1cm4gZmFsc2U7fX0NCmZ1bmN0aW9uIGFycmF5X2NvbnRhaW5zKGFycix2YWwpe2Zvcih2YXIgaT0wLGxlbj1hcnIubGVuZ3RoO2k8bGVuO2krKyl7aWYoYXJyW2ldPT12YWwpe3JldHVybiB0cnVlO319DQpyZXR1cm4gZmFsc2U7fQ0KZnVuY3Rpb24gZXh0cmFjdEJvb2xlYW5Gcm9tUGFyYW0ocGFyYW0sZGVmYXVsdFZhbHVlKXtpZihpc1VuZGVmaW5lZChwYXJhbSkpe3JldHVybiBkZWZhdWx0VmFsdWU7fWVsc2V7cmV0dXJuIGJvb2wocGFyYW0pO319DQpmdW5jdGlvbiBleHRyYWN0U3RyaW5nRnJvbVBhcmFtKHBhcmFtLGRlZmF1bHRWYWx1ZSl7aWYoaXNVbmRlZmluZWQocGFyYW0pKXtyZXR1cm4gZGVmYXVsdFZhbHVlO31lbHNle3JldHVybiBTdHJpbmcocGFyYW0pO319DQpmdW5jdGlvbiBleHRyYWN0SW50RnJvbVBhcmFtKHBhcmFtLGRlZmF1bHRWYWx1ZSl7aWYoaXNVbmRlZmluZWQocGFyYW0pKXtyZXR1cm4gZGVmYXVsdFZhbHVlO31lbHNle3RyeXt2YXIgdmFsdWU9cGFyc2VJbnQocGFyYW0sMTApO3JldHVybiBpc05hTih2YWx1ZSk/ZGVmYXVsdFZhbHVlOnZhbHVlO31jYXRjaChleCl7bG9nTG9nLndhcm4oIkludmFsaWQgaW50IHBhcmFtICIrcGFyYW0sZXgpO3JldHVybiBkZWZhdWx0VmFsdWU7fX19DQpmdW5jdGlvbiBleHRyYWN0RnVuY3Rpb25Gcm9tUGFyYW0ocGFyYW0sZGVmYXVsdFZhbHVlKXtpZih0eXBlb2YgcGFyYW09PSJmdW5jdGlvbiIpe3JldHVybiBwYXJhbTt9ZWxzZXtyZXR1cm4gZGVmYXVsdFZhbHVlO319DQpmdW5jdGlvbiBpc0Vycm9yKGVycil7cmV0dXJuKGVyciBpbnN0YW5jZW9mIEVycm9yKTt9DQppZighRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5KXtGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHk9ZnVuY3Rpb24ob2JqLGFyZ3Mpe3ZhciBtZXRob2ROYW1lPSJfX2FwcGx5X18iO2lmKHR5cGVvZiBvYmpbbWV0aG9kTmFtZV0hPSJ1bmRlZmluZWQiKXttZXRob2ROYW1lKz1TdHJpbmcoTWF0aC5yYW5kb20oKSkuc3Vic3RyKDIpO30NCm9ialttZXRob2ROYW1lXT10aGlzO3ZhciBhcmdzU3RyaW5ncz1bXTtmb3IodmFyIGk9MCxsZW49YXJncy5sZW5ndGg7aTxsZW47aSsrKXthcmdzU3RyaW5nc1tpXT0iYXJnc1siK2krIl0iO30NCnZhciBzY3JpcHQ9Im9iai4iK21ldGhvZE5hbWUrIigiK2FyZ3NTdHJpbmdzLmpvaW4oIiwiKSsiKSI7dmFyIHJldHVyblZhbHVlPWV2YWwoc2NyaXB0KTtkZWxldGUgb2JqW21ldGhvZE5hbWVdO3JldHVybiByZXR1cm5WYWx1ZTt9O30NCmlmKCFGdW5jdGlvbi5wcm90b3R5cGUuY2FsbCl7RnVuY3Rpb24ucHJvdG90eXBlLmNhbGw9ZnVuY3Rpb24ob2JqKXt2YXIgYXJncz1bXTtmb3IodmFyIGk9MSxsZW49YXJndW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe2FyZ3NbaS0xXT1hcmd1bWVudHNbaV07fQ0KcmV0dXJuIHRoaXMuYXBwbHkob2JqLGFyZ3MpO307fQ0KZnVuY3Rpb24gZ2V0TGlzdGVuZXJzUHJvcGVydHlOYW1lKGV2ZW50TmFtZSl7cmV0dXJuIl9fbG9nNGphdmFzY3JpcHRfbGlzdGVuZXJzX18iK2V2ZW50TmFtZTt9DQpmdW5jdGlvbiBhZGRFdmVudChub2RlLGV2ZW50TmFtZSxsaXN0ZW5lcix1c2VDYXB0dXJlLHdpbil7d2luPXdpbj93aW46d2luZG93O2lmKG5vZGUuYWRkRXZlbnRMaXN0ZW5lcil7bm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSxsaXN0ZW5lcix1c2VDYXB0dXJlKTt9ZWxzZSBpZihub2RlLmF0dGFjaEV2ZW50KXtub2RlLmF0dGFjaEV2ZW50KCJvbiIrZXZlbnROYW1lLGxpc3RlbmVyKTt9ZWxzZXt2YXIgcHJvcGVydHlOYW1lPWdldExpc3RlbmVyc1Byb3BlcnR5TmFtZShldmVudE5hbWUpO2lmKCFub2RlW3Byb3BlcnR5TmFtZV0pe25vZGVbcHJvcGVydHlOYW1lXT1bXTtub2RlWyJvbiIrZXZlbnROYW1lXT1mdW5jdGlvbihldnQpe2V2dD1nZXRFdmVudChldnQsd2luKTt2YXIgbGlzdGVuZXJzUHJvcGVydHlOYW1lPWdldExpc3RlbmVyc1Byb3BlcnR5TmFtZShldmVudE5hbWUpO3ZhciBsaXN0ZW5lcnM9dGhpc1tsaXN0ZW5lcnNQcm9wZXJ0eU5hbWVdLmNvbmNhdChbXSk7dmFyIGN1cnJlbnRMaXN0ZW5lcjt3aGlsZSgoY3VycmVudExpc3RlbmVyPWxpc3RlbmVycy5zaGlmdCgpKSl7Y3VycmVudExpc3RlbmVyLmNhbGwodGhpcyxldnQpO319O30NCm5vZGVbcHJvcGVydHlOYW1lXS5wdXNoKGxpc3RlbmVyKTt9fQ0KZnVuY3Rpb24gcmVtb3ZlRXZlbnQobm9kZSxldmVudE5hbWUsbGlzdGVuZXIsdXNlQ2FwdHVyZSl7aWYobm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKXtub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLGxpc3RlbmVyLHVzZUNhcHR1cmUpO31lbHNlIGlmKG5vZGUuZGV0YWNoRXZlbnQpe25vZGUuZGV0YWNoRXZlbnQoIm9uIitldmVudE5hbWUsbGlzdGVuZXIpO31lbHNle3ZhciBwcm9wZXJ0eU5hbWU9Z2V0TGlzdGVuZXJzUHJvcGVydHlOYW1lKGV2ZW50TmFtZSk7aWYobm9kZVtwcm9wZXJ0eU5hbWVdKXthcnJheV9yZW1vdmUobm9kZVtwcm9wZXJ0eU5hbWVdLGxpc3RlbmVyKTt9fX0NCmZ1bmN0aW9uIGdldEV2ZW50KGV2dCx3aW4pe3dpbj13aW4/d2luOndpbmRvdztyZXR1cm4gZXZ0P2V2dDp3aW4uZXZlbnQ7fQ0KZnVuY3Rpb24gc3RvcEV2ZW50UHJvcGFnYXRpb24oZXZ0KXtpZihldnQuc3RvcFByb3BhZ2F0aW9uKXtldnQuc3RvcFByb3BhZ2F0aW9uKCk7fWVsc2UgaWYodHlwZW9mIGV2dC5jYW5jZWxCdWJibGUhPSJ1bmRlZmluZWQiKXtldnQuY2FuY2VsQnViYmxlPXRydWU7fQ0KZXZ0LnJldHVyblZhbHVlPWZhbHNlO30NCnZhciBsb2dMb2c9e3F1aWV0TW9kZTpmYWxzZSxkZWJ1Z01lc3NhZ2VzOltdLHNldFF1aWV0TW9kZTpmdW5jdGlvbihxdWlldE1vZGUpe3RoaXMucXVpZXRNb2RlPWJvb2wocXVpZXRNb2RlKTt9LG51bWJlck9mRXJyb3JzOjAsYWxlcnRBbGxFcnJvcnM6ZmFsc2Usc2V0QWxlcnRBbGxFcnJvcnM6ZnVuY3Rpb24oYWxlcnRBbGxFcnJvcnMpe3RoaXMuYWxlcnRBbGxFcnJvcnM9YWxlcnRBbGxFcnJvcnM7fSxkZWJ1ZzpmdW5jdGlvbihtZXNzYWdlKXt0aGlzLmRlYnVnTWVzc2FnZXMucHVzaChtZXNzYWdlKTt9LGRpc3BsYXlEZWJ1ZzpmdW5jdGlvbigpe2FsZXJ0KHRoaXMuZGVidWdNZXNzYWdlcy5qb2luKG5ld0xpbmUpKTt9LHdhcm46ZnVuY3Rpb24obWVzc2FnZSxleGNlcHRpb24pe30sZXJyb3I6ZnVuY3Rpb24obWVzc2FnZSxleGNlcHRpb24pe2lmKCsrdGhpcy5udW1iZXJPZkVycm9ycz09MXx8dGhpcy5hbGVydEFsbEVycm9ycyl7aWYoIXRoaXMucXVpZXRNb2RlKXt2YXIgYWxlcnRNZXNzYWdlPSJsb2c0amF2YXNjcmlwdCBlcnJvcjogIittZXNzYWdlO2lmKGV4Y2VwdGlvbil7YWxlcnRNZXNzYWdlKz1uZXdMaW5lK25ld0xpbmUrIk9yaWdpbmFsIGVycm9yOiAiK2dldEV4Y2VwdGlvblN0cmluZ1JlcChleGNlcHRpb24pO30NCmFsZXJ0KGFsZXJ0TWVzc2FnZSk7fX19fTtsb2c0amF2YXNjcmlwdC5sb2dMb2c9bG9nTG9nO2xvZzRqYXZhc2NyaXB0LnNldEV2ZW50VHlwZXMoWyJsb2FkIiwiZXJyb3IiXSk7ZnVuY3Rpb24gaGFuZGxlRXJyb3IobWVzc2FnZSxleGNlcHRpb24pe2xvZ0xvZy5lcnJvcihtZXNzYWdlLGV4Y2VwdGlvbik7bG9nNGphdmFzY3JpcHQuZGlzcGF0Y2hFdmVudCgiZXJyb3IiLHsibWVzc2FnZSI6bWVzc2FnZSwiZXhjZXB0aW9uIjpleGNlcHRpb259KTt9DQpsb2c0amF2YXNjcmlwdC5oYW5kbGVFcnJvcj1oYW5kbGVFcnJvcjt2YXIgZW5hYmxlZD0hKCh0eXBlb2YgbG9nNGphdmFzY3JpcHRfZGlzYWJsZWQhPSJ1bmRlZmluZWQiKSYmbG9nNGphdmFzY3JpcHRfZGlzYWJsZWQpO2xvZzRqYXZhc2NyaXB0LnNldEVuYWJsZWQ9ZnVuY3Rpb24oZW5hYmxlKXtlbmFibGVkPWJvb2woZW5hYmxlKTt9O2xvZzRqYXZhc2NyaXB0LmlzRW5hYmxlZD1mdW5jdGlvbigpe3JldHVybiBlbmFibGVkO307dmFyIHVzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcz10cnVlO2xvZzRqYXZhc2NyaXB0LnNldFRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcz1mdW5jdGlvbih0aW1lU3RhbXBzSW5NaWxsaXNlY29uZHMpe3VzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcz1ib29sKHRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcyk7fTtsb2c0amF2YXNjcmlwdC5pc1RpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcz1mdW5jdGlvbigpe3JldHVybiB1c2VUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHM7fTtsb2c0amF2YXNjcmlwdC5ldmFsSW5TY29wZT1mdW5jdGlvbihleHByKXtyZXR1cm4gZXZhbChleHByKTt9O3ZhciBzaG93U3RhY2tUcmFjZXM9ZmFsc2U7bG9nNGphdmFzY3JpcHQuc2V0U2hvd1N0YWNrVHJhY2VzPWZ1bmN0aW9uKHNob3cpe3Nob3dTdGFja1RyYWNlcz1ib29sKHNob3cpO307dmFyIExldmVsPWZ1bmN0aW9uKGxldmVsLG5hbWUpe3RoaXMubGV2ZWw9bGV2ZWw7dGhpcy5uYW1lPW5hbWU7fTtMZXZlbC5wcm90b3R5cGU9e3RvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZTt9LGVxdWFsczpmdW5jdGlvbihsZXZlbCl7cmV0dXJuIHRoaXMubGV2ZWw9PWxldmVsLmxldmVsO30saXNHcmVhdGVyT3JFcXVhbDpmdW5jdGlvbihsZXZlbCl7cmV0dXJuIHRoaXMubGV2ZWw+PWxldmVsLmxldmVsO319O0xldmVsLkFMTD1uZXcgTGV2ZWwoTnVtYmVyLk1JTl9WQUxVRSwiQUxMIik7TGV2ZWwuVFJBQ0U9bmV3IExldmVsKDEwMDAwLCJUUkFDRSIpO0xldmVsLkRFQlVHPW5ldyBMZXZlbCgyMDAwMCwiREVCVUciKTtMZXZlbC5JTkZPPW5ldyBMZXZlbCgzMDAwMCwiSU5GTyIpO0xldmVsLldBUk49bmV3IExldmVsKDQwMDAwLCJXQVJOIik7TGV2ZWwuRVJST1I9bmV3IExldmVsKDUwMDAwLCJFUlJPUiIpO0xldmVsLkZBVEFMPW5ldyBMZXZlbCg2MDAwMCwiRkFUQUwiKTtMZXZlbC5PRkY9bmV3IExldmVsKE51bWJlci5NQVhfVkFMVUUsIk9GRiIpO2xvZzRqYXZhc2NyaXB0LkxldmVsPUxldmVsO2Z1bmN0aW9uIFRpbWVyKG5hbWUsbGV2ZWwpe3RoaXMubmFtZT1uYW1lO3RoaXMubGV2ZWw9aXNVbmRlZmluZWQobGV2ZWwpP0xldmVsLklORk86bGV2ZWw7dGhpcy5zdGFydD1uZXcgRGF0ZSgpO30NClRpbWVyLnByb3RvdHlwZS5nZXRFbGFwc2VkVGltZT1mdW5jdGlvbigpe3JldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKS10aGlzLnN0YXJ0LmdldFRpbWUoKTt9O3ZhciBhbm9ueW1vdXNMb2dnZXJOYW1lPSJbYW5vbnltb3VzXSI7dmFyIGRlZmF1bHRMb2dnZXJOYW1lPSJbZGVmYXVsdF0iO3ZhciBudWxsTG9nZ2VyTmFtZT0iW251bGxdIjt2YXIgcm9vdExvZ2dlck5hbWU9InJvb3QiO2Z1bmN0aW9uIExvZ2dlcihuYW1lKXt0aGlzLm5hbWU9bmFtZTt0aGlzLnBhcmVudD1udWxsO3RoaXMuY2hpbGRyZW49W107dmFyIGFwcGVuZGVycz1bXTt2YXIgbG9nZ2VyTGV2ZWw9bnVsbDt2YXIgaXNSb290PSh0aGlzLm5hbWU9PT1yb290TG9nZ2VyTmFtZSk7dmFyIGlzTnVsbD0odGhpcy5uYW1lPT09bnVsbExvZ2dlck5hbWUpO3ZhciBhcHBlbmRlckNhY2hlPW51bGw7dmFyIGFwcGVuZGVyQ2FjaGVJbnZhbGlkYXRlZD1mYWxzZTt0aGlzLmFkZENoaWxkPWZ1bmN0aW9uKGNoaWxkTG9nZ2VyKXt0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGRMb2dnZXIpO2NoaWxkTG9nZ2VyLnBhcmVudD10aGlzO2NoaWxkTG9nZ2VyLmludmFsaWRhdGVBcHBlbmRlckNhY2hlKCk7fTt2YXIgYWRkaXRpdmU9dHJ1ZTt0aGlzLmdldEFkZGl0aXZpdHk9ZnVuY3Rpb24oKXtyZXR1cm4gYWRkaXRpdmU7fTt0aGlzLnNldEFkZGl0aXZpdHk9ZnVuY3Rpb24oYWRkaXRpdml0eSl7dmFyIHZhbHVlQ2hhbmdlZD0oYWRkaXRpdmUhPWFkZGl0aXZpdHkpO2FkZGl0aXZlPWFkZGl0aXZpdHk7aWYodmFsdWVDaGFuZ2VkKXt0aGlzLmludmFsaWRhdGVBcHBlbmRlckNhY2hlKCk7fX07dGhpcy5hZGRBcHBlbmRlcj1mdW5jdGlvbihhcHBlbmRlcil7aWYoaXNOdWxsKXtoYW5kbGVFcnJvcigiTG9nZ2VyLmFkZEFwcGVuZGVyOiB5b3UgbWF5IG5vdCBhZGQgYW4gYXBwZW5kZXIgdG8gdGhlIG51bGwgbG9nZ2VyIik7fWVsc2V7aWYoYXBwZW5kZXIgaW5zdGFuY2VvZiBsb2c0amF2YXNjcmlwdC5BcHBlbmRlcil7aWYoIWFycmF5X2NvbnRhaW5zKGFwcGVuZGVycyxhcHBlbmRlcikpe2FwcGVuZGVycy5wdXNoKGFwcGVuZGVyKTthcHBlbmRlci5zZXRBZGRlZFRvTG9nZ2VyKHRoaXMpO3RoaXMuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGUoKTt9fWVsc2V7aGFuZGxlRXJyb3IoIkxvZ2dlci5hZGRBcHBlbmRlcjogYXBwZW5kZXIgc3VwcGxpZWQgKCciKw0KdG9TdHIoYXBwZW5kZXIpKyInKSBpcyBub3QgYSBzdWJjbGFzcyBvZiBBcHBlbmRlciIpO319fTt0aGlzLnJlbW92ZUFwcGVuZGVyPWZ1bmN0aW9uKGFwcGVuZGVyKXthcnJheV9yZW1vdmUoYXBwZW5kZXJzLGFwcGVuZGVyKTthcHBlbmRlci5zZXRSZW1vdmVkRnJvbUxvZ2dlcih0aGlzKTt0aGlzLmludmFsaWRhdGVBcHBlbmRlckNhY2hlKCk7fTt0aGlzLnJlbW92ZUFsbEFwcGVuZGVycz1mdW5jdGlvbigpe3ZhciBhcHBlbmRlckNvdW50PWFwcGVuZGVycy5sZW5ndGg7aWYoYXBwZW5kZXJDb3VudD4wKXtmb3IodmFyIGk9MDtpPGFwcGVuZGVyQ291bnQ7aSsrKXthcHBlbmRlcnNbaV0uc2V0UmVtb3ZlZEZyb21Mb2dnZXIodGhpcyk7fQ0KYXBwZW5kZXJzLmxlbmd0aD0wO3RoaXMuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGUoKTt9fTt0aGlzLmdldEVmZmVjdGl2ZUFwcGVuZGVycz1mdW5jdGlvbigpe2lmKGFwcGVuZGVyQ2FjaGU9PT1udWxsfHxhcHBlbmRlckNhY2hlSW52YWxpZGF0ZWQpe3ZhciBwYXJlbnRFZmZlY3RpdmVBcHBlbmRlcnM9KGlzUm9vdHx8IXRoaXMuZ2V0QWRkaXRpdml0eSgpKT9bXTp0aGlzLnBhcmVudC5nZXRFZmZlY3RpdmVBcHBlbmRlcnMoKTthcHBlbmRlckNhY2hlPXBhcmVudEVmZmVjdGl2ZUFwcGVuZGVycy5jb25jYXQoYXBwZW5kZXJzKTthcHBlbmRlckNhY2hlSW52YWxpZGF0ZWQ9ZmFsc2U7fQ0KcmV0dXJuIGFwcGVuZGVyQ2FjaGU7fTt0aGlzLmludmFsaWRhdGVBcHBlbmRlckNhY2hlPWZ1bmN0aW9uKCl7YXBwZW5kZXJDYWNoZUludmFsaWRhdGVkPXRydWU7Zm9yKHZhciBpPTAsbGVuPXRoaXMuY2hpbGRyZW4ubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5jaGlsZHJlbltpXS5pbnZhbGlkYXRlQXBwZW5kZXJDYWNoZSgpO319O3RoaXMubG9nPWZ1bmN0aW9uKGxldmVsLHBhcmFtcyl7aWYobGV2ZWwuaXNHcmVhdGVyT3JFcXVhbCh0aGlzLmdldEVmZmVjdGl2ZUxldmVsKCkpKXt2YXIgZXhjZXB0aW9uO3ZhciBmaW5hbFBhcmFtSW5kZXg9cGFyYW1zLmxlbmd0aC0xO3ZhciBsYXN0UGFyYW09cGFyYW1zW3BhcmFtcy5sZW5ndGgtMV07aWYocGFyYW1zLmxlbmd0aD4xJiZpc0Vycm9yKGxhc3RQYXJhbSkpe2V4Y2VwdGlvbj1sYXN0UGFyYW07ZmluYWxQYXJhbUluZGV4LS07fQ0KdmFyIG1lc3NhZ2VzPVtdO2Zvcih2YXIgaT0wO2k8PWZpbmFsUGFyYW1JbmRleDtpKyspe21lc3NhZ2VzW2ldPXBhcmFtc1tpXTt9DQp2YXIgbG9nZ2luZ0V2ZW50PW5ldyBMb2dnaW5nRXZlbnQodGhpcyxuZXcgRGF0ZSgpLGxldmVsLG1lc3NhZ2VzLGV4Y2VwdGlvbik7dGhpcy5jYWxsQXBwZW5kZXJzKGxvZ2dpbmdFdmVudCk7fX07dGhpcy5jYWxsQXBwZW5kZXJzPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIGVmZmVjdGl2ZUFwcGVuZGVycz10aGlzLmdldEVmZmVjdGl2ZUFwcGVuZGVycygpO2Zvcih2YXIgaT0wLGxlbj1lZmZlY3RpdmVBcHBlbmRlcnMubGVuZ3RoO2k8bGVuO2krKyl7ZWZmZWN0aXZlQXBwZW5kZXJzW2ldLmRvQXBwZW5kKGxvZ2dpbmdFdmVudCk7fX07dGhpcy5zZXRMZXZlbD1mdW5jdGlvbihsZXZlbCl7aWYoaXNSb290JiZsZXZlbD09PW51bGwpe2hhbmRsZUVycm9yKCJMb2dnZXIuc2V0TGV2ZWw6IHlvdSBjYW5ub3Qgc2V0IHRoZSBsZXZlbCBvZiB0aGUgcm9vdCBsb2dnZXIgdG8gbnVsbCIpO31lbHNlIGlmKGxldmVsIGluc3RhbmNlb2YgTGV2ZWwpe2xvZ2dlckxldmVsPWxldmVsO31lbHNle2hhbmRsZUVycm9yKCJMb2dnZXIuc2V0TGV2ZWw6IGxldmVsIHN1cHBsaWVkIHRvIGxvZ2dlciAiKw0KdGhpcy5uYW1lKyIgaXMgbm90IGFuIGluc3RhbmNlIG9mIGxvZzRqYXZhc2NyaXB0LkxldmVsIik7fX07dGhpcy5nZXRMZXZlbD1mdW5jdGlvbigpe3JldHVybiBsb2dnZXJMZXZlbDt9O3RoaXMuZ2V0RWZmZWN0aXZlTGV2ZWw9ZnVuY3Rpb24oKXtmb3IodmFyIGxvZ2dlcj10aGlzO2xvZ2dlciE9PW51bGw7bG9nZ2VyPWxvZ2dlci5wYXJlbnQpe3ZhciBsZXZlbD1sb2dnZXIuZ2V0TGV2ZWwoKTtpZihsZXZlbCE9PW51bGwpe3JldHVybiBsZXZlbDt9fX07dGhpcy5ncm91cD1mdW5jdGlvbihuYW1lLGluaXRpYWxseUV4cGFuZGVkKXt2YXIgZWZmZWN0aXZlQXBwZW5kZXJzPXRoaXMuZ2V0RWZmZWN0aXZlQXBwZW5kZXJzKCk7Zm9yKHZhciBpPTAsbGVuPWVmZmVjdGl2ZUFwcGVuZGVycy5sZW5ndGg7aTxsZW47aSsrKXtlZmZlY3RpdmVBcHBlbmRlcnNbaV0uZ3JvdXAobmFtZSxpbml0aWFsbHlFeHBhbmRlZCk7fX07dGhpcy5ncm91cEVuZD1mdW5jdGlvbihuYW1lKXt2YXIgZWZmZWN0aXZlQXBwZW5kZXJzPXRoaXMuZ2V0RWZmZWN0aXZlQXBwZW5kZXJzKCk7Zm9yKHZhciBpPTAsbGVuPWVmZmVjdGl2ZUFwcGVuZGVycy5sZW5ndGg7aTxsZW47aSsrKXtlZmZlY3RpdmVBcHBlbmRlcnNbaV0uZ3JvdXBFbmQoKTt9fTt2YXIgdGltZXJzPXt9O3RoaXMudGltZT1mdW5jdGlvbihuYW1lLGxldmVsKXtpZihpc1VuZGVmaW5lZChuYW1lKSl7aGFuZGxlRXJyb3IoIkxvZ2dlci50aW1lOiBhIG5hbWUgZm9yIHRoZSB0aW1lciBtdXN0IGJlIHN1cHBsaWVkIik7fWVsc2UgaWYobGV2ZWwmJiEobGV2ZWwgaW5zdGFuY2VvZiBMZXZlbCkpe2hhbmRsZUVycm9yKCJMb2dnZXIudGltZTogbGV2ZWwgc3VwcGxpZWQgdG8gdGltZXIgIisNCm5hbWUrIiBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgbG9nNGphdmFzY3JpcHQuTGV2ZWwiKTt9ZWxzZXt0aW1lcnNbbmFtZV09bmV3IFRpbWVyKG5hbWUsbGV2ZWwpO319O3RoaXMudGltZUVuZD1mdW5jdGlvbihuYW1lKXtpZihpc1VuZGVmaW5lZChuYW1lKSl7aGFuZGxlRXJyb3IoIkxvZ2dlci50aW1lRW5kOiBhIG5hbWUgZm9yIHRoZSB0aW1lciBtdXN0IGJlIHN1cHBsaWVkIik7fWVsc2UgaWYodGltZXJzW25hbWVdKXt2YXIgdGltZXI9dGltZXJzW25hbWVdO3ZhciBtaWxsaXNlY29uZHM9dGltZXIuZ2V0RWxhcHNlZFRpbWUoKTt0aGlzLmxvZyh0aW1lci5sZXZlbCxbIlRpbWVyICIrdG9TdHIobmFtZSkrIiBjb21wbGV0ZWQgaW4gIittaWxsaXNlY29uZHMrIm1zIl0pO2RlbGV0ZSB0aW1lcnNbbmFtZV07fWVsc2V7bG9nTG9nLndhcm4oIkxvZ2dlci50aW1lRW5kOiBubyB0aW1lciBmb3VuZCB3aXRoIG5hbWUgIituYW1lKTt9fTt0aGlzLmFzc2VydD1mdW5jdGlvbihleHByKXtpZighZXhwcil7dmFyIGFyZ3M9W107Zm9yKHZhciBpPTEsbGVuPWFyZ3VtZW50cy5sZW5ndGg7aTxsZW47aSsrKXthcmdzLnB1c2goYXJndW1lbnRzW2ldKTt9DQphcmdzPShhcmdzLmxlbmd0aD4wKT9hcmdzOlsiQXNzZXJ0aW9uIEZhaWx1cmUiXTthcmdzLnB1c2gobmV3TGluZSk7YXJncy5wdXNoKGV4cHIpO3RoaXMubG9nKExldmVsLkVSUk9SLGFyZ3MpO319O3RoaXMudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iTG9nZ2VyWyIrdGhpcy5uYW1lKyJdIjt9O30NCkxvZ2dlci5wcm90b3R5cGU9e3RyYWNlOmZ1bmN0aW9uKCl7dGhpcy5sb2coTGV2ZWwuVFJBQ0UsYXJndW1lbnRzKTt9LGRlYnVnOmZ1bmN0aW9uKCl7dGhpcy5sb2coTGV2ZWwuREVCVUcsYXJndW1lbnRzKTt9LGluZm86ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5JTkZPLGFyZ3VtZW50cyk7fSx3YXJuOmZ1bmN0aW9uKCl7dGhpcy5sb2coTGV2ZWwuV0FSTixhcmd1bWVudHMpO30sZXJyb3I6ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5FUlJPUixhcmd1bWVudHMpO30sZmF0YWw6ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5GQVRBTCxhcmd1bWVudHMpO30saXNFbmFibGVkRm9yOmZ1bmN0aW9uKGxldmVsKXtyZXR1cm4gbGV2ZWwuaXNHcmVhdGVyT3JFcXVhbCh0aGlzLmdldEVmZmVjdGl2ZUxldmVsKCkpO30saXNUcmFjZUVuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0VuYWJsZWRGb3IoTGV2ZWwuVFJBQ0UpO30saXNEZWJ1Z0VuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0VuYWJsZWRGb3IoTGV2ZWwuREVCVUcpO30saXNJbmZvRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5JTkZPKTt9LGlzV2FybkVuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0VuYWJsZWRGb3IoTGV2ZWwuV0FSTik7fSxpc0Vycm9yRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5FUlJPUik7fSxpc0ZhdGFsRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5GQVRBTCk7fX07TG9nZ2VyLnByb3RvdHlwZS50cmFjZS5pc0VudHJ5UG9pbnQ9dHJ1ZTtMb2dnZXIucHJvdG90eXBlLmRlYnVnLmlzRW50cnlQb2ludD10cnVlO0xvZ2dlci5wcm90b3R5cGUuaW5mby5pc0VudHJ5UG9pbnQ9dHJ1ZTtMb2dnZXIucHJvdG90eXBlLndhcm4uaXNFbnRyeVBvaW50PXRydWU7TG9nZ2VyLnByb3RvdHlwZS5lcnJvci5pc0VudHJ5UG9pbnQ9dHJ1ZTtMb2dnZXIucHJvdG90eXBlLmZhdGFsLmlzRW50cnlQb2ludD10cnVlO3ZhciBsb2dnZXJzPXt9O3ZhciBsb2dnZXJOYW1lcz1bXTt2YXIgUk9PVF9MT0dHRVJfREVGQVVMVF9MRVZFTD1MZXZlbC5ERUJVRzt2YXIgcm9vdExvZ2dlcj1uZXcgTG9nZ2VyKHJvb3RMb2dnZXJOYW1lKTtyb290TG9nZ2VyLnNldExldmVsKFJPT1RfTE9HR0VSX0RFRkFVTFRfTEVWRUwpO2xvZzRqYXZhc2NyaXB0LmdldFJvb3RMb2dnZXI9ZnVuY3Rpb24oKXtyZXR1cm4gcm9vdExvZ2dlcjt9O2xvZzRqYXZhc2NyaXB0LmdldExvZ2dlcj1mdW5jdGlvbihsb2dnZXJOYW1lKXtpZighKHR5cGVvZiBsb2dnZXJOYW1lPT0ic3RyaW5nIikpe2xvZ2dlck5hbWU9YW5vbnltb3VzTG9nZ2VyTmFtZTtsb2dMb2cud2FybigibG9nNGphdmFzY3JpcHQuZ2V0TG9nZ2VyOiBub24tc3RyaW5nIGxvZ2dlciBuYW1lICIrDQp0b1N0cihsb2dnZXJOYW1lKSsiIHN1cHBsaWVkLCByZXR1cm5pbmcgYW5vbnltb3VzIGxvZ2dlciIpO30NCmlmKGxvZ2dlck5hbWU9PXJvb3RMb2dnZXJOYW1lKXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuZ2V0TG9nZ2VyOiByb290IGxvZ2dlciBtYXkgbm90IGJlIG9idGFpbmVkIGJ5IG5hbWUiKTt9DQppZighbG9nZ2Vyc1tsb2dnZXJOYW1lXSl7dmFyIGxvZ2dlcj1uZXcgTG9nZ2VyKGxvZ2dlck5hbWUpO2xvZ2dlcnNbbG9nZ2VyTmFtZV09bG9nZ2VyO2xvZ2dlck5hbWVzLnB1c2gobG9nZ2VyTmFtZSk7dmFyIGxhc3REb3RJbmRleD1sb2dnZXJOYW1lLmxhc3RJbmRleE9mKCIuIik7dmFyIHBhcmVudExvZ2dlcjtpZihsYXN0RG90SW5kZXg+LTEpe3ZhciBwYXJlbnRMb2dnZXJOYW1lPWxvZ2dlck5hbWUuc3Vic3RyaW5nKDAsbGFzdERvdEluZGV4KTtwYXJlbnRMb2dnZXI9bG9nNGphdmFzY3JpcHQuZ2V0TG9nZ2VyKHBhcmVudExvZ2dlck5hbWUpO31lbHNle3BhcmVudExvZ2dlcj1yb290TG9nZ2VyO30NCnBhcmVudExvZ2dlci5hZGRDaGlsZChsb2dnZXIpO30NCnJldHVybiBsb2dnZXJzW2xvZ2dlck5hbWVdO307dmFyIGRlZmF1bHRMb2dnZXI9bnVsbDtsb2c0amF2YXNjcmlwdC5nZXREZWZhdWx0TG9nZ2VyPWZ1bmN0aW9uKCl7aWYoIWRlZmF1bHRMb2dnZXIpe2RlZmF1bHRMb2dnZXI9bG9nNGphdmFzY3JpcHQuZ2V0TG9nZ2VyKGRlZmF1bHRMb2dnZXJOYW1lKTt2YXIgYT1uZXcgbG9nNGphdmFzY3JpcHQuUG9wVXBBcHBlbmRlcigpO2RlZmF1bHRMb2dnZXIuYWRkQXBwZW5kZXIoYSk7fQ0KcmV0dXJuIGRlZmF1bHRMb2dnZXI7fTt2YXIgbnVsbExvZ2dlcj1udWxsO2xvZzRqYXZhc2NyaXB0LmdldE51bGxMb2dnZXI9ZnVuY3Rpb24oKXtpZighbnVsbExvZ2dlcil7bnVsbExvZ2dlcj1uZXcgTG9nZ2VyKG51bGxMb2dnZXJOYW1lKTtudWxsTG9nZ2VyLnNldExldmVsKExldmVsLk9GRik7fQ0KcmV0dXJuIG51bGxMb2dnZXI7fTtsb2c0amF2YXNjcmlwdC5yZXNldENvbmZpZ3VyYXRpb249ZnVuY3Rpb24oKXtyb290TG9nZ2VyLnNldExldmVsKFJPT1RfTE9HR0VSX0RFRkFVTFRfTEVWRUwpO2xvZ2dlcnM9e307fTt2YXIgTG9nZ2luZ0V2ZW50PWZ1bmN0aW9uKGxvZ2dlcix0aW1lU3RhbXAsbGV2ZWwsbWVzc2FnZXMsZXhjZXB0aW9uKXt0aGlzLmxvZ2dlcj1sb2dnZXI7dGhpcy50aW1lU3RhbXA9dGltZVN0YW1wO3RoaXMudGltZVN0YW1wSW5NaWxsaXNlY29uZHM9dGltZVN0YW1wLmdldFRpbWUoKTt0aGlzLnRpbWVTdGFtcEluU2Vjb25kcz1NYXRoLmZsb29yKHRoaXMudGltZVN0YW1wSW5NaWxsaXNlY29uZHMvMTAwMCk7dGhpcy5taWxsaXNlY29uZHM9dGhpcy50aW1lU3RhbXAuZ2V0TWlsbGlzZWNvbmRzKCk7dGhpcy5sZXZlbD1sZXZlbDt0aGlzLm1lc3NhZ2VzPW1lc3NhZ2VzO3RoaXMuZXhjZXB0aW9uPWV4Y2VwdGlvbjt9O0xvZ2dpbmdFdmVudC5wcm90b3R5cGU9e2dldFRocm93YWJsZVN0clJlcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmV4Y2VwdGlvbj9nZXRFeGNlcHRpb25TdHJpbmdSZXAodGhpcy5leGNlcHRpb24pOiIiO30sZ2V0Q29tYmluZWRNZXNzYWdlczpmdW5jdGlvbigpe3JldHVybih0aGlzLm1lc3NhZ2VzLmxlbmd0aD09MSk/dGhpcy5tZXNzYWdlc1swXTp0aGlzLm1lc3NhZ2VzLmpvaW4obmV3TGluZSk7fSx0b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiJMb2dnaW5nRXZlbnRbIit0aGlzLmxldmVsKyJdIjt9fTtsb2c0amF2YXNjcmlwdC5Mb2dnaW5nRXZlbnQ9TG9nZ2luZ0V2ZW50O3ZhciBMYXlvdXQ9ZnVuY3Rpb24oKXt9O0xheW91dC5wcm90b3R5cGU9e2RlZmF1bHRzOntsb2dnZXJLZXk6ImxvZ2dlciIsdGltZVN0YW1wS2V5OiJ0aW1lc3RhbXAiLG1pbGxpc2Vjb25kc0tleToibWlsbGlzZWNvbmRzIixsZXZlbEtleToibGV2ZWwiLG1lc3NhZ2VLZXk6Im1lc3NhZ2UiLGV4Y2VwdGlvbktleToiZXhjZXB0aW9uIix1cmxLZXk6InVybCJ9LGxvZ2dlcktleToibG9nZ2VyIix0aW1lU3RhbXBLZXk6InRpbWVzdGFtcCIsbWlsbGlzZWNvbmRzS2V5OiJtaWxsaXNlY29uZHMiLGxldmVsS2V5OiJsZXZlbCIsbWVzc2FnZUtleToibWVzc2FnZSIsZXhjZXB0aW9uS2V5OiJleGNlcHRpb24iLHVybEtleToidXJsIixiYXRjaEhlYWRlcjoiIixiYXRjaEZvb3RlcjoiIixiYXRjaFNlcGFyYXRvcjoiIixyZXR1cm5zUG9zdERhdGE6ZmFsc2Usb3ZlcnJpZGVUaW1lU3RhbXBzU2V0dGluZzpmYWxzZSx1c2VUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHM6bnVsbCxmb3JtYXQ6ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtoYW5kbGVFcnJvcigiTGF5b3V0LmZvcm1hdDogbGF5b3V0IHN1cHBsaWVkIGhhcyBubyBmb3JtYXQoKSBtZXRob2QiKTt9LGlnbm9yZXNUaHJvd2FibGU6ZnVuY3Rpb24oKXtoYW5kbGVFcnJvcigiTGF5b3V0Lmlnbm9yZXNUaHJvd2FibGU6IGxheW91dCBzdXBwbGllZCBoYXMgbm8gaWdub3Jlc1Rocm93YWJsZSgpIG1ldGhvZCIpO30sZ2V0Q29udGVudFR5cGU6ZnVuY3Rpb24oKXtyZXR1cm4idGV4dC9wbGFpbiI7fSxhbGxvd0JhdGNoaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIHRydWU7fSxzZXRUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHM6ZnVuY3Rpb24odGltZVN0YW1wc0luTWlsbGlzZWNvbmRzKXt0aGlzLm92ZXJyaWRlVGltZVN0YW1wc1NldHRpbmc9dHJ1ZTt0aGlzLnVzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcz1ib29sKHRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcyk7fSxpc1RpbWVTdGFtcHNJbk1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLm92ZXJyaWRlVGltZVN0YW1wc1NldHRpbmc/dGhpcy51c2VUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHM6dXNlVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzO30sZ2V0VGltZVN0YW1wVmFsdWU6ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtyZXR1cm4gdGhpcy5pc1RpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcygpP2xvZ2dpbmdFdmVudC50aW1lU3RhbXBJbk1pbGxpc2Vjb25kczpsb2dnaW5nRXZlbnQudGltZVN0YW1wSW5TZWNvbmRzO30sZ2V0RGF0YVZhbHVlczpmdW5jdGlvbihsb2dnaW5nRXZlbnQsY29tYmluZU1lc3NhZ2VzKXt2YXIgZGF0YVZhbHVlcz1bW3RoaXMubG9nZ2VyS2V5LGxvZ2dpbmdFdmVudC5sb2dnZXIubmFtZV0sW3RoaXMudGltZVN0YW1wS2V5LHRoaXMuZ2V0VGltZVN0YW1wVmFsdWUobG9nZ2luZ0V2ZW50KV0sW3RoaXMubGV2ZWxLZXksbG9nZ2luZ0V2ZW50LmxldmVsLm5hbWVdLFt0aGlzLnVybEtleSx3aW5kb3cubG9jYXRpb24uaHJlZl0sW3RoaXMubWVzc2FnZUtleSxjb21iaW5lTWVzc2FnZXM/bG9nZ2luZ0V2ZW50LmdldENvbWJpbmVkTWVzc2FnZXMoKTpsb2dnaW5nRXZlbnQubWVzc2FnZXNdXTtpZighdGhpcy5pc1RpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcygpKXtkYXRhVmFsdWVzLnB1c2goW3RoaXMubWlsbGlzZWNvbmRzS2V5LGxvZ2dpbmdFdmVudC5taWxsaXNlY29uZHNdKTt9DQppZihsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKXtkYXRhVmFsdWVzLnB1c2goW3RoaXMuZXhjZXB0aW9uS2V5LGdldEV4Y2VwdGlvblN0cmluZ1JlcChsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKV0pO30NCmlmKHRoaXMuaGFzQ3VzdG9tRmllbGRzKCkpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmN1c3RvbUZpZWxkcy5sZW5ndGg7aTxsZW47aSsrKXt2YXIgdmFsPXRoaXMuY3VzdG9tRmllbGRzW2ldLnZhbHVlO2lmKHR5cGVvZiB2YWw9PT0iZnVuY3Rpb24iKXt2YWw9dmFsKHRoaXMsbG9nZ2luZ0V2ZW50KTt9DQpkYXRhVmFsdWVzLnB1c2goW3RoaXMuY3VzdG9tRmllbGRzW2ldLm5hbWUsdmFsXSk7fX0NCnJldHVybiBkYXRhVmFsdWVzO30sc2V0S2V5czpmdW5jdGlvbihsb2dnZXJLZXksdGltZVN0YW1wS2V5LGxldmVsS2V5LG1lc3NhZ2VLZXksZXhjZXB0aW9uS2V5LHVybEtleSxtaWxsaXNlY29uZHNLZXkpe3RoaXMubG9nZ2VyS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0obG9nZ2VyS2V5LHRoaXMuZGVmYXVsdHMubG9nZ2VyS2V5KTt0aGlzLnRpbWVTdGFtcEtleT1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKHRpbWVTdGFtcEtleSx0aGlzLmRlZmF1bHRzLnRpbWVTdGFtcEtleSk7dGhpcy5sZXZlbEtleT1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKGxldmVsS2V5LHRoaXMuZGVmYXVsdHMubGV2ZWxLZXkpO3RoaXMubWVzc2FnZUtleT1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKG1lc3NhZ2VLZXksdGhpcy5kZWZhdWx0cy5tZXNzYWdlS2V5KTt0aGlzLmV4Y2VwdGlvbktleT1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKGV4Y2VwdGlvbktleSx0aGlzLmRlZmF1bHRzLmV4Y2VwdGlvbktleSk7dGhpcy51cmxLZXk9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbSh1cmxLZXksdGhpcy5kZWZhdWx0cy51cmxLZXkpO3RoaXMubWlsbGlzZWNvbmRzS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0obWlsbGlzZWNvbmRzS2V5LHRoaXMuZGVmYXVsdHMubWlsbGlzZWNvbmRzS2V5KTt9LHNldEN1c3RvbUZpZWxkOmZ1bmN0aW9uKG5hbWUsdmFsdWUpe3ZhciBmaWVsZFVwZGF0ZWQ9ZmFsc2U7Zm9yKHZhciBpPTAsbGVuPXRoaXMuY3VzdG9tRmllbGRzLmxlbmd0aDtpPGxlbjtpKyspe2lmKHRoaXMuY3VzdG9tRmllbGRzW2ldLm5hbWU9PT1uYW1lKXt0aGlzLmN1c3RvbUZpZWxkc1tpXS52YWx1ZT12YWx1ZTtmaWVsZFVwZGF0ZWQ9dHJ1ZTt9fQ0KaWYoIWZpZWxkVXBkYXRlZCl7dGhpcy5jdXN0b21GaWVsZHMucHVzaCh7Im5hbWUiOm5hbWUsInZhbHVlIjp2YWx1ZX0pO319LGhhc0N1c3RvbUZpZWxkczpmdW5jdGlvbigpe3JldHVybih0aGlzLmN1c3RvbUZpZWxkcy5sZW5ndGg+MCk7fSx0b1N0cmluZzpmdW5jdGlvbigpe2hhbmRsZUVycm9yKCJMYXlvdXQudG9TdHJpbmc6IGFsbCBsYXlvdXRzIG11c3Qgb3ZlcnJpZGUgdGhpcyBtZXRob2QiKTt9fTtsb2c0amF2YXNjcmlwdC5MYXlvdXQ9TGF5b3V0O3ZhciBBcHBlbmRlcj1mdW5jdGlvbigpe307QXBwZW5kZXIucHJvdG90eXBlPW5ldyBFdmVudFN1cHBvcnQoKTtBcHBlbmRlci5wcm90b3R5cGUubGF5b3V0PW5ldyBQYXR0ZXJuTGF5b3V0KCk7QXBwZW5kZXIucHJvdG90eXBlLnRocmVzaG9sZD1MZXZlbC5BTEw7QXBwZW5kZXIucHJvdG90eXBlLmxvZ2dlcnM9W107QXBwZW5kZXIucHJvdG90eXBlLmRvQXBwZW5kPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7aWYoZW5hYmxlZCYmbG9nZ2luZ0V2ZW50LmxldmVsLmxldmVsPj10aGlzLnRocmVzaG9sZC5sZXZlbCl7dGhpcy5hcHBlbmQobG9nZ2luZ0V2ZW50KTt9fTtBcHBlbmRlci5wcm90b3R5cGUuYXBwZW5kPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7fTtBcHBlbmRlci5wcm90b3R5cGUuc2V0TGF5b3V0PWZ1bmN0aW9uKGxheW91dCl7aWYobGF5b3V0IGluc3RhbmNlb2YgTGF5b3V0KXt0aGlzLmxheW91dD1sYXlvdXQ7fWVsc2V7aGFuZGxlRXJyb3IoIkFwcGVuZGVyLnNldExheW91dDogbGF5b3V0IHN1cHBsaWVkIHRvICIrDQp0aGlzLnRvU3RyaW5nKCkrIiBpcyBub3QgYSBzdWJjbGFzcyBvZiBMYXlvdXQiKTt9fTtBcHBlbmRlci5wcm90b3R5cGUuZ2V0TGF5b3V0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGF5b3V0O307QXBwZW5kZXIucHJvdG90eXBlLnNldFRocmVzaG9sZD1mdW5jdGlvbih0aHJlc2hvbGQpe2lmKHRocmVzaG9sZCBpbnN0YW5jZW9mIExldmVsKXt0aGlzLnRocmVzaG9sZD10aHJlc2hvbGQ7fWVsc2V7aGFuZGxlRXJyb3IoIkFwcGVuZGVyLnNldFRocmVzaG9sZDogdGhyZXNob2xkIHN1cHBsaWVkIHRvICIrDQp0aGlzLnRvU3RyaW5nKCkrIiBpcyBub3QgYSBzdWJjbGFzcyBvZiBMZXZlbCIpO319O0FwcGVuZGVyLnByb3RvdHlwZS5nZXRUaHJlc2hvbGQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50aHJlc2hvbGQ7fTtBcHBlbmRlci5wcm90b3R5cGUuc2V0QWRkZWRUb0xvZ2dlcj1mdW5jdGlvbihsb2dnZXIpe3RoaXMubG9nZ2Vycy5wdXNoKGxvZ2dlcik7fTtBcHBlbmRlci5wcm90b3R5cGUuc2V0UmVtb3ZlZEZyb21Mb2dnZXI9ZnVuY3Rpb24obG9nZ2VyKXthcnJheV9yZW1vdmUodGhpcy5sb2dnZXJzLGxvZ2dlcik7fTtBcHBlbmRlci5wcm90b3R5cGUuZ3JvdXA9ZW1wdHlGdW5jdGlvbjtBcHBlbmRlci5wcm90b3R5cGUuZ3JvdXBFbmQ9ZW1wdHlGdW5jdGlvbjtBcHBlbmRlci5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtoYW5kbGVFcnJvcigiQXBwZW5kZXIudG9TdHJpbmc6IGFsbCBhcHBlbmRlcnMgbXVzdCBvdmVycmlkZSB0aGlzIG1ldGhvZCIpO307bG9nNGphdmFzY3JpcHQuQXBwZW5kZXI9QXBwZW5kZXI7ZnVuY3Rpb24gU2ltcGxlTGF5b3V0KCl7dGhpcy5jdXN0b21GaWVsZHM9W107fQ0KU2ltcGxlTGF5b3V0LnByb3RvdHlwZT1uZXcgTGF5b3V0KCk7U2ltcGxlTGF5b3V0LnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtyZXR1cm4gbG9nZ2luZ0V2ZW50LmxldmVsLm5hbWUrIiAtICIrbG9nZ2luZ0V2ZW50LmdldENvbWJpbmVkTWVzc2FnZXMoKTt9O1NpbXBsZUxheW91dC5wcm90b3R5cGUuaWdub3Jlc1Rocm93YWJsZT1mdW5jdGlvbigpe3JldHVybiB0cnVlO307U2ltcGxlTGF5b3V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJTaW1wbGVMYXlvdXQiO307bG9nNGphdmFzY3JpcHQuU2ltcGxlTGF5b3V0PVNpbXBsZUxheW91dDtmdW5jdGlvbiBOdWxsTGF5b3V0KCl7dGhpcy5jdXN0b21GaWVsZHM9W107fQ0KTnVsbExheW91dC5wcm90b3R5cGU9bmV3IExheW91dCgpO051bGxMYXlvdXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3JldHVybiBsb2dnaW5nRXZlbnQubWVzc2FnZXM7fTtOdWxsTGF5b3V0LnByb3RvdHlwZS5pZ25vcmVzVGhyb3dhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHRydWU7fTtOdWxsTGF5b3V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJOdWxsTGF5b3V0Ijt9O2xvZzRqYXZhc2NyaXB0Lk51bGxMYXlvdXQ9TnVsbExheW91dDtmdW5jdGlvbiBYbWxMYXlvdXQoY29tYmluZU1lc3NhZ2VzKXt0aGlzLmNvbWJpbmVNZXNzYWdlcz1leHRyYWN0Qm9vbGVhbkZyb21QYXJhbShjb21iaW5lTWVzc2FnZXMsdHJ1ZSk7dGhpcy5jdXN0b21GaWVsZHM9W107fQ0KWG1sTGF5b3V0LnByb3RvdHlwZT1uZXcgTGF5b3V0KCk7WG1sTGF5b3V0LnByb3RvdHlwZS5pc0NvbWJpbmVkTWVzc2FnZXM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb21iaW5lTWVzc2FnZXM7fTtYbWxMYXlvdXQucHJvdG90eXBlLmdldENvbnRlbnRUeXBlPWZ1bmN0aW9uKCl7cmV0dXJuInRleHQveG1sIjt9O1htbExheW91dC5wcm90b3R5cGUuZXNjYXBlQ2RhdGE9ZnVuY3Rpb24oc3RyKXtyZXR1cm4gc3RyLnJlcGxhY2UoL1xdXF0+LywiXV0+XV0mZ3Q7PCFbQ0RBVEFbIik7fTtYbWxMYXlvdXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3ZhciBsYXlvdXQ9dGhpczt2YXIgaSxsZW47ZnVuY3Rpb24gZm9ybWF0TWVzc2FnZShtZXNzYWdlKXttZXNzYWdlPSh0eXBlb2YgbWVzc2FnZT09PSJzdHJpbmciKT9tZXNzYWdlOnRvU3RyKG1lc3NhZ2UpO3JldHVybiI8bG9nNGphdmFzY3JpcHQ6bWVzc2FnZT48IVtDREFUQVsiKw0KbGF5b3V0LmVzY2FwZUNkYXRhKG1lc3NhZ2UpKyJdXT48L2xvZzRqYXZhc2NyaXB0Om1lc3NhZ2U+Ijt9DQp2YXIgc3RyPSI8bG9nNGphdmFzY3JpcHQ6ZXZlbnQgbG9nZ2VyPVwiIitsb2dnaW5nRXZlbnQubG9nZ2VyLm5hbWUrIlwiIHRpbWVzdGFtcD1cIiIrdGhpcy5nZXRUaW1lU3RhbXBWYWx1ZShsb2dnaW5nRXZlbnQpKyJcIiI7aWYoIXRoaXMuaXNUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHMoKSl7c3RyKz0iIG1pbGxpc2Vjb25kcz1cIiIrbG9nZ2luZ0V2ZW50Lm1pbGxpc2Vjb25kcysiXCIiO30NCnN0cis9IiBsZXZlbD1cIiIrbG9nZ2luZ0V2ZW50LmxldmVsLm5hbWUrIlwiPiIrbmV3TGluZTtpZih0aGlzLmNvbWJpbmVNZXNzYWdlcyl7c3RyKz1mb3JtYXRNZXNzYWdlKGxvZ2dpbmdFdmVudC5nZXRDb21iaW5lZE1lc3NhZ2VzKCkpO31lbHNle3N0cis9Ijxsb2c0amF2YXNjcmlwdDptZXNzYWdlcz4iK25ld0xpbmU7Zm9yKGk9MCxsZW49bG9nZ2luZ0V2ZW50Lm1lc3NhZ2VzLmxlbmd0aDtpPGxlbjtpKyspe3N0cis9Zm9ybWF0TWVzc2FnZShsb2dnaW5nRXZlbnQubWVzc2FnZXNbaV0pK25ld0xpbmU7fQ0Kc3RyKz0iPC9sb2c0amF2YXNjcmlwdDptZXNzYWdlcz4iK25ld0xpbmU7fQ0KaWYodGhpcy5oYXNDdXN0b21GaWVsZHMoKSl7Zm9yKGk9MCxsZW49dGhpcy5jdXN0b21GaWVsZHMubGVuZ3RoO2k8bGVuO2krKyl7c3RyKz0iPGxvZzRqYXZhc2NyaXB0OmN1c3RvbWZpZWxkIG5hbWU9XCIiKw0KdGhpcy5jdXN0b21GaWVsZHNbaV0ubmFtZSsiXCI+PCFbQ0RBVEFbIisNCnRoaXMuY3VzdG9tRmllbGRzW2ldLnZhbHVlLnRvU3RyaW5nKCkrIl1dPjwvbG9nNGphdmFzY3JpcHQ6Y3VzdG9tZmllbGQ+IituZXdMaW5lO319DQppZihsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKXtzdHIrPSI8bG9nNGphdmFzY3JpcHQ6ZXhjZXB0aW9uPjwhW0NEQVRBWyIrDQpnZXRFeGNlcHRpb25TdHJpbmdSZXAobG9nZ2luZ0V2ZW50LmV4Y2VwdGlvbikrIl1dPjwvbG9nNGphdmFzY3JpcHQ6ZXhjZXB0aW9uPiIrbmV3TGluZTt9DQpzdHIrPSI8L2xvZzRqYXZhc2NyaXB0OmV2ZW50PiIrbmV3TGluZStuZXdMaW5lO3JldHVybiBzdHI7fTtYbWxMYXlvdXQucHJvdG90eXBlLmlnbm9yZXNUaHJvd2FibGU9ZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2U7fTtYbWxMYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIlhtbExheW91dCI7fTtsb2c0amF2YXNjcmlwdC5YbWxMYXlvdXQ9WG1sTGF5b3V0O2Z1bmN0aW9uIGVzY2FwZU5ld0xpbmVzKHN0cil7cmV0dXJuIHN0ci5yZXBsYWNlKC9cclxufFxyfFxuL2csIlxcclxcbiIpO30NCmZ1bmN0aW9uIEpzb25MYXlvdXQocmVhZGFibGUsY29tYmluZU1lc3NhZ2VzKXt0aGlzLnJlYWRhYmxlPWV4dHJhY3RCb29sZWFuRnJvbVBhcmFtKHJlYWRhYmxlLGZhbHNlKTt0aGlzLmNvbWJpbmVNZXNzYWdlcz1leHRyYWN0Qm9vbGVhbkZyb21QYXJhbShjb21iaW5lTWVzc2FnZXMsdHJ1ZSk7dGhpcy5iYXRjaEhlYWRlcj10aGlzLnJlYWRhYmxlPyJbIituZXdMaW5lOiJbIjt0aGlzLmJhdGNoRm9vdGVyPXRoaXMucmVhZGFibGU/Il0iK25ld0xpbmU6Il0iO3RoaXMuYmF0Y2hTZXBhcmF0b3I9dGhpcy5yZWFkYWJsZT8iLCIrbmV3TGluZToiLCI7dGhpcy5zZXRLZXlzKCk7dGhpcy5jb2xvbj10aGlzLnJlYWRhYmxlPyI6ICI6IjoiO3RoaXMudGFiPXRoaXMucmVhZGFibGU/Ilx0IjoiIjt0aGlzLmxpbmVCcmVhaz10aGlzLnJlYWRhYmxlP25ld0xpbmU6IiI7dGhpcy5jdXN0b21GaWVsZHM9W107fQ0KSnNvbkxheW91dC5wcm90b3R5cGU9bmV3IExheW91dCgpO0pzb25MYXlvdXQucHJvdG90eXBlLmlzUmVhZGFibGU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZWFkYWJsZTt9O0pzb25MYXlvdXQucHJvdG90eXBlLmlzQ29tYmluZWRNZXNzYWdlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbWJpbmVNZXNzYWdlczt9O0pzb25MYXlvdXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3ZhciBsYXlvdXQ9dGhpczt2YXIgZGF0YVZhbHVlcz10aGlzLmdldERhdGFWYWx1ZXMobG9nZ2luZ0V2ZW50LHRoaXMuY29tYmluZU1lc3NhZ2VzKTt2YXIgc3RyPSJ7Iit0aGlzLmxpbmVCcmVhazt2YXIgaTtmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWwscHJlZml4LGV4cGFuZCl7dmFyIGZvcm1hdHRlZFZhbHVlO3ZhciB2YWxUeXBlPXR5cGVvZiB2YWw7aWYodmFsIGluc3RhbmNlb2YgRGF0ZSl7Zm9ybWF0dGVkVmFsdWU9U3RyaW5nKHZhbC5nZXRUaW1lKCkpO31lbHNlIGlmKGV4cGFuZCYmKHZhbCBpbnN0YW5jZW9mIEFycmF5KSl7Zm9ybWF0dGVkVmFsdWU9IlsiK2xheW91dC5saW5lQnJlYWs7Zm9yKGk9MCxsZW49dmFsLmxlbmd0aDtpPGxlbjtpKyspe3ZhciBjaGlsZFByZWZpeD1wcmVmaXgrbGF5b3V0LnRhYjtmb3JtYXR0ZWRWYWx1ZSs9Y2hpbGRQcmVmaXgrZm9ybWF0VmFsdWUodmFsW2ldLGNoaWxkUHJlZml4LGZhbHNlKTtpZihpPHZhbC5sZW5ndGgtMSl7Zm9ybWF0dGVkVmFsdWUrPSIsIjt9DQpmb3JtYXR0ZWRWYWx1ZSs9bGF5b3V0LmxpbmVCcmVhazt9DQpmb3JtYXR0ZWRWYWx1ZSs9cHJlZml4KyJdIjt9ZWxzZSBpZih2YWxUeXBlIT09Im51bWJlciImJnZhbFR5cGUhPT0iYm9vbGVhbiIpe2Zvcm1hdHRlZFZhbHVlPSJcIiIrZXNjYXBlTmV3TGluZXModG9TdHIodmFsKS5yZXBsYWNlKC9cIi9nLCJcXFwiIikpKyJcIiI7fWVsc2V7Zm9ybWF0dGVkVmFsdWU9dmFsO30NCnJldHVybiBmb3JtYXR0ZWRWYWx1ZTt9DQpmb3IoaT0wLGxlbj1kYXRhVmFsdWVzLmxlbmd0aDtpPGxlbjtpKyspe3N0cis9dGhpcy50YWIrIlwiIitkYXRhVmFsdWVzW2ldWzBdKyJcIiIrdGhpcy5jb2xvbitmb3JtYXRWYWx1ZShkYXRhVmFsdWVzW2ldWzFdLHRoaXMudGFiLHRydWUpO2lmKGk8ZGF0YVZhbHVlcy5sZW5ndGgtMSl7c3RyKz0iLCI7fQ0Kc3RyKz10aGlzLmxpbmVCcmVhazt9DQpzdHIrPSJ9Iit0aGlzLmxpbmVCcmVhaztyZXR1cm4gc3RyO307SnNvbkxheW91dC5wcm90b3R5cGUuaWdub3Jlc1Rocm93YWJsZT1mdW5jdGlvbigpe3JldHVybiBmYWxzZTt9O0pzb25MYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkpzb25MYXlvdXQiO307SnNvbkxheW91dC5wcm90b3R5cGUuZ2V0Q29udGVudFR5cGU9ZnVuY3Rpb24oKXtyZXR1cm4iYXBwbGljYXRpb24vanNvbiI7fTtsb2c0amF2YXNjcmlwdC5Kc29uTGF5b3V0PUpzb25MYXlvdXQ7ZnVuY3Rpb24gSHR0cFBvc3REYXRhTGF5b3V0KCl7dGhpcy5zZXRLZXlzKCk7dGhpcy5jdXN0b21GaWVsZHM9W107dGhpcy5yZXR1cm5zUG9zdERhdGE9dHJ1ZTt9DQpIdHRwUG9zdERhdGFMYXlvdXQucHJvdG90eXBlPW5ldyBMYXlvdXQoKTtIdHRwUG9zdERhdGFMYXlvdXQucHJvdG90eXBlLmFsbG93QmF0Y2hpbmc9ZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2U7fTtIdHRwUG9zdERhdGFMYXlvdXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3ZhciBkYXRhVmFsdWVzPXRoaXMuZ2V0RGF0YVZhbHVlcyhsb2dnaW5nRXZlbnQpO3ZhciBxdWVyeUJpdHM9W107Zm9yKHZhciBpPTAsbGVuPWRhdGFWYWx1ZXMubGVuZ3RoO2k8bGVuO2krKyl7dmFyIHZhbD0oZGF0YVZhbHVlc1tpXVsxXWluc3RhbmNlb2YgRGF0ZSk/U3RyaW5nKGRhdGFWYWx1ZXNbaV1bMV0uZ2V0VGltZSgpKTpkYXRhVmFsdWVzW2ldWzFdO3F1ZXJ5Qml0cy5wdXNoKHVybEVuY29kZShkYXRhVmFsdWVzW2ldWzBdKSsiPSIrdXJsRW5jb2RlKHZhbCkpO30NCnJldHVybiBxdWVyeUJpdHMuam9pbigiJiIpO307SHR0cFBvc3REYXRhTGF5b3V0LnByb3RvdHlwZS5pZ25vcmVzVGhyb3dhYmxlPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7cmV0dXJuIGZhbHNlO307SHR0cFBvc3REYXRhTGF5b3V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJIdHRwUG9zdERhdGFMYXlvdXQiO307bG9nNGphdmFzY3JpcHQuSHR0cFBvc3REYXRhTGF5b3V0PUh0dHBQb3N0RGF0YUxheW91dDtmdW5jdGlvbiBmb3JtYXRPYmplY3RFeHBhbnNpb24ob2JqLGRlcHRoLGluZGVudGF0aW9uKXt2YXIgb2JqZWN0c0V4cGFuZGVkPVtdO2Z1bmN0aW9uIGRvRm9ybWF0KG9iaixkZXB0aCxpbmRlbnRhdGlvbil7dmFyIGksaixsZW4sY2hpbGREZXB0aCxjaGlsZEluZGVudGF0aW9uLGNoaWxkTGluZXMsZXhwYW5zaW9uLGNoaWxkRXhwYW5zaW9uO2lmKCFpbmRlbnRhdGlvbil7aW5kZW50YXRpb249IiI7fQ0KZnVuY3Rpb24gZm9ybWF0U3RyaW5nKHRleHQpe3ZhciBsaW5lcz1zcGxpdEludG9MaW5lcyh0ZXh0KTtmb3IodmFyIGo9MSxqTGVuPWxpbmVzLmxlbmd0aDtqPGpMZW47aisrKXtsaW5lc1tqXT1pbmRlbnRhdGlvbitsaW5lc1tqXTt9DQpyZXR1cm4gbGluZXMuam9pbihuZXdMaW5lKTt9DQppZihvYmo9PT1udWxsKXtyZXR1cm4ibnVsbCI7fWVsc2UgaWYodHlwZW9mIG9iaj09InVuZGVmaW5lZCIpe3JldHVybiJ1bmRlZmluZWQiO31lbHNlIGlmKHR5cGVvZiBvYmo9PSJzdHJpbmciKXtyZXR1cm4gZm9ybWF0U3RyaW5nKG9iaik7fWVsc2UgaWYodHlwZW9mIG9iaj09Im9iamVjdCImJmFycmF5X2NvbnRhaW5zKG9iamVjdHNFeHBhbmRlZCxvYmopKXt0cnl7ZXhwYW5zaW9uPXRvU3RyKG9iaik7fWNhdGNoKGV4KXtleHBhbnNpb249IkVycm9yIGZvcm1hdHRpbmcgcHJvcGVydHkuIERldGFpbHM6ICIrZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGV4KTt9DQpyZXR1cm4gZXhwYW5zaW9uKyIgW2FscmVhZHkgZXhwYW5kZWRdIjt9ZWxzZSBpZigob2JqIGluc3RhbmNlb2YgQXJyYXkpJiZkZXB0aD4wKXtvYmplY3RzRXhwYW5kZWQucHVzaChvYmopO2V4cGFuc2lvbj0iWyIrbmV3TGluZTtjaGlsZERlcHRoPWRlcHRoLTE7Y2hpbGRJbmRlbnRhdGlvbj1pbmRlbnRhdGlvbisiICAiO2NoaWxkTGluZXM9W107Zm9yKGk9MCxsZW49b2JqLmxlbmd0aDtpPGxlbjtpKyspe3RyeXtjaGlsZEV4cGFuc2lvbj1kb0Zvcm1hdChvYmpbaV0sY2hpbGREZXB0aCxjaGlsZEluZGVudGF0aW9uKTtjaGlsZExpbmVzLnB1c2goY2hpbGRJbmRlbnRhdGlvbitjaGlsZEV4cGFuc2lvbik7fWNhdGNoKGV4KXtjaGlsZExpbmVzLnB1c2goY2hpbGRJbmRlbnRhdGlvbisiRXJyb3IgZm9ybWF0dGluZyBhcnJheSBtZW1iZXIuIERldGFpbHM6ICIrDQpnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpKyIiKTt9fQ0KZXhwYW5zaW9uKz1jaGlsZExpbmVzLmpvaW4oIiwiK25ld0xpbmUpK25ld0xpbmUraW5kZW50YXRpb24rIl0iO3JldHVybiBleHBhbnNpb247fWVsc2UgaWYodHlwZW9mIG9iaj09Im9iamVjdCImJmRlcHRoPjApe29iamVjdHNFeHBhbmRlZC5wdXNoKG9iaik7ZXhwYW5zaW9uPSJ7IituZXdMaW5lO2NoaWxkRGVwdGg9ZGVwdGgtMTtjaGlsZEluZGVudGF0aW9uPWluZGVudGF0aW9uKyIgICI7Y2hpbGRMaW5lcz1bXTtmb3IoaSBpbiBvYmope3RyeXtjaGlsZEV4cGFuc2lvbj1kb0Zvcm1hdChvYmpbaV0sY2hpbGREZXB0aCxjaGlsZEluZGVudGF0aW9uKTtjaGlsZExpbmVzLnB1c2goY2hpbGRJbmRlbnRhdGlvbitpKyI6ICIrY2hpbGRFeHBhbnNpb24pO31jYXRjaChleCl7Y2hpbGRMaW5lcy5wdXNoKGNoaWxkSW5kZW50YXRpb24raSsiOiBFcnJvciBmb3JtYXR0aW5nIHByb3BlcnR5LiBEZXRhaWxzOiAiKw0KZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGV4KSk7fX0NCmV4cGFuc2lvbis9Y2hpbGRMaW5lcy5qb2luKCIsIituZXdMaW5lKStuZXdMaW5lK2luZGVudGF0aW9uKyJ9IjtyZXR1cm4gZXhwYW5zaW9uO31lbHNle3JldHVybiBmb3JtYXRTdHJpbmcodG9TdHIob2JqKSk7fX0NCnJldHVybiBkb0Zvcm1hdChvYmosZGVwdGgsaW5kZW50YXRpb24pO30NCnZhciBTaW1wbGVEYXRlRm9ybWF0OyhmdW5jdGlvbigpe3ZhciByZWdleD0vKCdbXiddKicpfChHK3x5K3xNK3x3K3xXK3xEK3xkK3xGK3xFK3xhK3xIK3xrK3xLK3xoK3xtK3xzK3xTK3xaKyl8KFthLXpBLVpdKyl8KFteYS16QS1aJ10rKS87dmFyIG1vbnRoTmFtZXM9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdO3ZhciBkYXlOYW1lcz1bIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il07dmFyIFRFWFQyPTAsVEVYVDM9MSxOVU1CRVI9MixZRUFSPTMsTU9OVEg9NCxUSU1FWk9ORT01O3ZhciB0eXBlcz17RzpURVhUMix5OllFQVIsTTpNT05USCx3Ok5VTUJFUixXOk5VTUJFUixEOk5VTUJFUixkOk5VTUJFUixGOk5VTUJFUixFOlRFWFQzLGE6VEVYVDIsSDpOVU1CRVIsazpOVU1CRVIsSzpOVU1CRVIsaDpOVU1CRVIsbTpOVU1CRVIsczpOVU1CRVIsUzpOVU1CRVIsWjpUSU1FWk9ORX07dmFyIE9ORV9EQVk9MjQqNjAqNjAqMTAwMDt2YXIgT05FX1dFRUs9NypPTkVfREFZO3ZhciBERUZBVUxUX01JTklNQUxfREFZU19JTl9GSVJTVF9XRUVLPTE7dmFyIG5ld0RhdGVBdE1pZG5pZ2h0PWZ1bmN0aW9uKHllYXIsbW9udGgsZGF5KXt2YXIgZD1uZXcgRGF0ZSh5ZWFyLG1vbnRoLGRheSwwLDAsMCk7ZC5zZXRNaWxsaXNlY29uZHMoMCk7cmV0dXJuIGQ7fTtEYXRlLnByb3RvdHlwZS5nZXREaWZmZXJlbmNlPWZ1bmN0aW9uKGRhdGUpe3JldHVybiB0aGlzLmdldFRpbWUoKS1kYXRlLmdldFRpbWUoKTt9O0RhdGUucHJvdG90eXBlLmlzQmVmb3JlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLmdldFRpbWUoKTxkLmdldFRpbWUoKTt9O0RhdGUucHJvdG90eXBlLmdldFVUQ1RpbWU9ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5VVEModGhpcy5nZXRGdWxsWWVhcigpLHRoaXMuZ2V0TW9udGgoKSx0aGlzLmdldERhdGUoKSx0aGlzLmdldEhvdXJzKCksdGhpcy5nZXRNaW51dGVzKCksdGhpcy5nZXRTZWNvbmRzKCksdGhpcy5nZXRNaWxsaXNlY29uZHMoKSk7fTtEYXRlLnByb3RvdHlwZS5nZXRUaW1lU2luY2U9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMuZ2V0VVRDVGltZSgpLWQuZ2V0VVRDVGltZSgpO307RGF0ZS5wcm90b3R5cGUuZ2V0UHJldmlvdXNTdW5kYXk9ZnVuY3Rpb24oKXt2YXIgbWlkZGF5PW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSx0aGlzLmdldE1vbnRoKCksdGhpcy5nZXREYXRlKCksMTIsMCwwKTt2YXIgcHJldmlvdXNTdW5kYXk9bmV3IERhdGUobWlkZGF5LmdldFRpbWUoKS10aGlzLmdldERheSgpKk9ORV9EQVkpO3JldHVybiBuZXdEYXRlQXRNaWRuaWdodChwcmV2aW91c1N1bmRheS5nZXRGdWxsWWVhcigpLHByZXZpb3VzU3VuZGF5LmdldE1vbnRoKCkscHJldmlvdXNTdW5kYXkuZ2V0RGF0ZSgpKTt9O0RhdGUucHJvdG90eXBlLmdldFdlZWtJblllYXI9ZnVuY3Rpb24obWluaW1hbERheXNJbkZpcnN0V2Vlayl7aWYoaXNVbmRlZmluZWQodGhpcy5taW5pbWFsRGF5c0luRmlyc3RXZWVrKSl7bWluaW1hbERheXNJbkZpcnN0V2Vlaz1ERUZBVUxUX01JTklNQUxfREFZU19JTl9GSVJTVF9XRUVLO30NCnZhciBwcmV2aW91c1N1bmRheT10aGlzLmdldFByZXZpb3VzU3VuZGF5KCk7dmFyIHN0YXJ0T2ZZZWFyPW5ld0RhdGVBdE1pZG5pZ2h0KHRoaXMuZ2V0RnVsbFllYXIoKSwwLDEpO3ZhciBudW1iZXJPZlN1bmRheXM9cHJldmlvdXNTdW5kYXkuaXNCZWZvcmUoc3RhcnRPZlllYXIpPzA6MStNYXRoLmZsb29yKHByZXZpb3VzU3VuZGF5LmdldFRpbWVTaW5jZShzdGFydE9mWWVhcikvT05FX1dFRUspO3ZhciBudW1iZXJPZkRheXNJbkZpcnN0V2Vlaz03LXN0YXJ0T2ZZZWFyLmdldERheSgpO3ZhciB3ZWVrSW5ZZWFyPW51bWJlck9mU3VuZGF5cztpZihudW1iZXJPZkRheXNJbkZpcnN0V2VlazxtaW5pbWFsRGF5c0luRmlyc3RXZWVrKXt3ZWVrSW5ZZWFyLS07fQ0KcmV0dXJuIHdlZWtJblllYXI7fTtEYXRlLnByb3RvdHlwZS5nZXRXZWVrSW5Nb250aD1mdW5jdGlvbihtaW5pbWFsRGF5c0luRmlyc3RXZWVrKXtpZihpc1VuZGVmaW5lZCh0aGlzLm1pbmltYWxEYXlzSW5GaXJzdFdlZWspKXttaW5pbWFsRGF5c0luRmlyc3RXZWVrPURFRkFVTFRfTUlOSU1BTF9EQVlTX0lOX0ZJUlNUX1dFRUs7fQ0KdmFyIHByZXZpb3VzU3VuZGF5PXRoaXMuZ2V0UHJldmlvdXNTdW5kYXkoKTt2YXIgc3RhcnRPZk1vbnRoPW5ld0RhdGVBdE1pZG5pZ2h0KHRoaXMuZ2V0RnVsbFllYXIoKSx0aGlzLmdldE1vbnRoKCksMSk7dmFyIG51bWJlck9mU3VuZGF5cz1wcmV2aW91c1N1bmRheS5pc0JlZm9yZShzdGFydE9mTW9udGgpPzA6MStNYXRoLmZsb29yKHByZXZpb3VzU3VuZGF5LmdldFRpbWVTaW5jZShzdGFydE9mTW9udGgpL09ORV9XRUVLKTt2YXIgbnVtYmVyT2ZEYXlzSW5GaXJzdFdlZWs9Ny1zdGFydE9mTW9udGguZ2V0RGF5KCk7dmFyIHdlZWtJbk1vbnRoPW51bWJlck9mU3VuZGF5cztpZihudW1iZXJPZkRheXNJbkZpcnN0V2Vlaz49bWluaW1hbERheXNJbkZpcnN0V2Vlayl7d2Vla0luTW9udGgrKzt9DQpyZXR1cm4gd2Vla0luTW9udGg7fTtEYXRlLnByb3RvdHlwZS5nZXREYXlJblllYXI9ZnVuY3Rpb24oKXt2YXIgc3RhcnRPZlllYXI9bmV3RGF0ZUF0TWlkbmlnaHQodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIDErTWF0aC5mbG9vcih0aGlzLmdldFRpbWVTaW5jZShzdGFydE9mWWVhcikvT05FX0RBWSk7fTtTaW1wbGVEYXRlRm9ybWF0PWZ1bmN0aW9uKGZvcm1hdFN0cmluZyl7dGhpcy5mb3JtYXRTdHJpbmc9Zm9ybWF0U3RyaW5nO307U2ltcGxlRGF0ZUZvcm1hdC5wcm90b3R5cGUuc2V0TWluaW1hbERheXNJbkZpcnN0V2Vlaz1mdW5jdGlvbihkYXlzKXt0aGlzLm1pbmltYWxEYXlzSW5GaXJzdFdlZWs9ZGF5czt9O1NpbXBsZURhdGVGb3JtYXQucHJvdG90eXBlLmdldE1pbmltYWxEYXlzSW5GaXJzdFdlZWs9ZnVuY3Rpb24oKXtyZXR1cm4gaXNVbmRlZmluZWQodGhpcy5taW5pbWFsRGF5c0luRmlyc3RXZWVrKT9ERUZBVUxUX01JTklNQUxfREFZU19JTl9GSVJTVF9XRUVLOnRoaXMubWluaW1hbERheXNJbkZpcnN0V2Vlazt9O3ZhciBwYWRXaXRoWmVyb2VzPWZ1bmN0aW9uKHN0cixsZW4pe3doaWxlKHN0ci5sZW5ndGg8bGVuKXtzdHI9IjAiK3N0cjt9DQpyZXR1cm4gc3RyO307dmFyIGZvcm1hdFRleHQ9ZnVuY3Rpb24oZGF0YSxudW1iZXJPZkxldHRlcnMsbWluTGVuZ3RoKXtyZXR1cm4obnVtYmVyT2ZMZXR0ZXJzPj00KT9kYXRhOmRhdGEuc3Vic3RyKDAsTWF0aC5tYXgobWluTGVuZ3RoLG51bWJlck9mTGV0dGVycykpO307dmFyIGZvcm1hdE51bWJlcj1mdW5jdGlvbihkYXRhLG51bWJlck9mTGV0dGVycyl7dmFyIGRhdGFTdHJpbmc9IiIrZGF0YTtyZXR1cm4gcGFkV2l0aFplcm9lcyhkYXRhU3RyaW5nLG51bWJlck9mTGV0dGVycyk7fTtTaW1wbGVEYXRlRm9ybWF0LnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24oZGF0ZSl7dmFyIGZvcm1hdHRlZFN0cmluZz0iIjt2YXIgcmVzdWx0O3ZhciBzZWFyY2hTdHJpbmc9dGhpcy5mb3JtYXRTdHJpbmc7d2hpbGUoKHJlc3VsdD1yZWdleC5leGVjKHNlYXJjaFN0cmluZykpKXt2YXIgcXVvdGVkU3RyaW5nPXJlc3VsdFsxXTt2YXIgcGF0dGVybkxldHRlcnM9cmVzdWx0WzJdO3ZhciBvdGhlckxldHRlcnM9cmVzdWx0WzNdO3ZhciBvdGhlckNoYXJhY3RlcnM9cmVzdWx0WzRdO2lmKHF1b3RlZFN0cmluZyl7aWYocXVvdGVkU3RyaW5nPT0iJyciKXtmb3JtYXR0ZWRTdHJpbmcrPSInIjt9ZWxzZXtmb3JtYXR0ZWRTdHJpbmcrPXF1b3RlZFN0cmluZy5zdWJzdHJpbmcoMSxxdW90ZWRTdHJpbmcubGVuZ3RoLTEpO319ZWxzZSBpZihvdGhlckxldHRlcnMpe31lbHNlIGlmKG90aGVyQ2hhcmFjdGVycyl7Zm9ybWF0dGVkU3RyaW5nKz1vdGhlckNoYXJhY3RlcnM7fWVsc2UgaWYocGF0dGVybkxldHRlcnMpe3ZhciBwYXR0ZXJuTGV0dGVyPXBhdHRlcm5MZXR0ZXJzLmNoYXJBdCgwKTt2YXIgbnVtYmVyT2ZMZXR0ZXJzPXBhdHRlcm5MZXR0ZXJzLmxlbmd0aDt2YXIgcmF3RGF0YT0iIjtzd2l0Y2gocGF0dGVybkxldHRlcil7Y2FzZSJHIjpyYXdEYXRhPSJBRCI7YnJlYWs7Y2FzZSJ5IjpyYXdEYXRhPWRhdGUuZ2V0RnVsbFllYXIoKTticmVhaztjYXNlIk0iOnJhd0RhdGE9ZGF0ZS5nZXRNb250aCgpO2JyZWFrO2Nhc2UidyI6cmF3RGF0YT1kYXRlLmdldFdlZWtJblllYXIodGhpcy5nZXRNaW5pbWFsRGF5c0luRmlyc3RXZWVrKCkpO2JyZWFrO2Nhc2UiVyI6cmF3RGF0YT1kYXRlLmdldFdlZWtJbk1vbnRoKHRoaXMuZ2V0TWluaW1hbERheXNJbkZpcnN0V2VlaygpKTticmVhaztjYXNlIkQiOnJhd0RhdGE9ZGF0ZS5nZXREYXlJblllYXIoKTticmVhaztjYXNlImQiOnJhd0RhdGE9ZGF0ZS5nZXREYXRlKCk7YnJlYWs7Y2FzZSJGIjpyYXdEYXRhPTErTWF0aC5mbG9vcigoZGF0ZS5nZXREYXRlKCktMSkvNyk7YnJlYWs7Y2FzZSJFIjpyYXdEYXRhPWRheU5hbWVzW2RhdGUuZ2V0RGF5KCldO2JyZWFrO2Nhc2UiYSI6cmF3RGF0YT0oZGF0ZS5nZXRIb3VycygpPj0xMik/IlBNIjoiQU0iO2JyZWFrO2Nhc2UiSCI6cmF3RGF0YT1kYXRlLmdldEhvdXJzKCk7YnJlYWs7Y2FzZSJrIjpyYXdEYXRhPWRhdGUuZ2V0SG91cnMoKXx8MjQ7YnJlYWs7Y2FzZSJLIjpyYXdEYXRhPWRhdGUuZ2V0SG91cnMoKSUxMjticmVhaztjYXNlImgiOnJhd0RhdGE9KGRhdGUuZ2V0SG91cnMoKSUxMil8fDEyO2JyZWFrO2Nhc2UibSI6cmF3RGF0YT1kYXRlLmdldE1pbnV0ZXMoKTticmVhaztjYXNlInMiOnJhd0RhdGE9ZGF0ZS5nZXRTZWNvbmRzKCk7YnJlYWs7Y2FzZSJTIjpyYXdEYXRhPWRhdGUuZ2V0TWlsbGlzZWNvbmRzKCk7YnJlYWs7Y2FzZSJaIjpyYXdEYXRhPWRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKTticmVhazt9DQpzd2l0Y2godHlwZXNbcGF0dGVybkxldHRlcl0pe2Nhc2UgVEVYVDI6Zm9ybWF0dGVkU3RyaW5nKz1mb3JtYXRUZXh0KHJhd0RhdGEsbnVtYmVyT2ZMZXR0ZXJzLDIpO2JyZWFrO2Nhc2UgVEVYVDM6Zm9ybWF0dGVkU3RyaW5nKz1mb3JtYXRUZXh0KHJhd0RhdGEsbnVtYmVyT2ZMZXR0ZXJzLDMpO2JyZWFrO2Nhc2UgTlVNQkVSOmZvcm1hdHRlZFN0cmluZys9Zm9ybWF0TnVtYmVyKHJhd0RhdGEsbnVtYmVyT2ZMZXR0ZXJzKTticmVhaztjYXNlIFlFQVI6aWYobnVtYmVyT2ZMZXR0ZXJzPD0zKXt2YXIgZGF0YVN0cmluZz0iIityYXdEYXRhO2Zvcm1hdHRlZFN0cmluZys9ZGF0YVN0cmluZy5zdWJzdHIoMiwyKTt9ZWxzZXtmb3JtYXR0ZWRTdHJpbmcrPWZvcm1hdE51bWJlcihyYXdEYXRhLG51bWJlck9mTGV0dGVycyk7fQ0KYnJlYWs7Y2FzZSBNT05USDppZihudW1iZXJPZkxldHRlcnM+PTMpe2Zvcm1hdHRlZFN0cmluZys9Zm9ybWF0VGV4dChtb250aE5hbWVzW3Jhd0RhdGFdLG51bWJlck9mTGV0dGVycyxudW1iZXJPZkxldHRlcnMpO31lbHNle2Zvcm1hdHRlZFN0cmluZys9Zm9ybWF0TnVtYmVyKHJhd0RhdGErMSxudW1iZXJPZkxldHRlcnMpO30NCmJyZWFrO2Nhc2UgVElNRVpPTkU6dmFyIGlzUG9zaXRpdmU9KHJhd0RhdGE+MCk7dmFyIHByZWZpeD1pc1Bvc2l0aXZlPyItIjoiKyI7dmFyIGFic0RhdGE9TWF0aC5hYnMocmF3RGF0YSk7dmFyIGhvdXJzPSIiK01hdGguZmxvb3IoYWJzRGF0YS82MCk7aG91cnM9cGFkV2l0aFplcm9lcyhob3VycywyKTt2YXIgbWludXRlcz0iIisoYWJzRGF0YSU2MCk7bWludXRlcz1wYWRXaXRoWmVyb2VzKG1pbnV0ZXMsMik7Zm9ybWF0dGVkU3RyaW5nKz1wcmVmaXgraG91cnMrbWludXRlczticmVhazt9fQ0Kc2VhcmNoU3RyaW5nPXNlYXJjaFN0cmluZy5zdWJzdHIocmVzdWx0LmluZGV4K3Jlc3VsdFswXS5sZW5ndGgpO30NCnJldHVybiBmb3JtYXR0ZWRTdHJpbmc7fTt9KSgpO2xvZzRqYXZhc2NyaXB0LlNpbXBsZURhdGVGb3JtYXQ9U2ltcGxlRGF0ZUZvcm1hdDtmdW5jdGlvbiBQYXR0ZXJuTGF5b3V0KHBhdHRlcm4pe2lmKHBhdHRlcm4pe3RoaXMucGF0dGVybj1wYXR0ZXJuO31lbHNle3RoaXMucGF0dGVybj1QYXR0ZXJuTGF5b3V0LkRFRkFVTFRfQ09OVkVSU0lPTl9QQVRURVJOO30NCnRoaXMuY3VzdG9tRmllbGRzPVtdO30NClBhdHRlcm5MYXlvdXQuVFRDQ19DT05WRVJTSU9OX1BBVFRFUk49IiVyICVwICVjIC0gJW0lbiI7UGF0dGVybkxheW91dC5ERUZBVUxUX0NPTlZFUlNJT05fUEFUVEVSTj0iJW0lbiI7UGF0dGVybkxheW91dC5JU084NjAxX0RBVEVGT1JNQVQ9Inl5eXktTU0tZGQgSEg6bW06c3MsU1NTIjtQYXR0ZXJuTGF5b3V0LkRBVEVUSU1FX0RBVEVGT1JNQVQ9ImRkIE1NTSB5eXl5IEhIOm1tOnNzLFNTUyI7UGF0dGVybkxheW91dC5BQlNPTFVURVRJTUVfREFURUZPUk1BVD0iSEg6bW06c3MsU1NTIjtQYXR0ZXJuTGF5b3V0LnByb3RvdHlwZT1uZXcgTGF5b3V0KCk7UGF0dGVybkxheW91dC5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIHJlZ2V4PS8lKC0/WzAtOV0rKT8oXC4/WzAtOV0rKT8oW2FjZGZtTW5wciVdKShceyhbXlx9XSspXH0pP3woW14lXSspLzt2YXIgZm9ybWF0dGVkU3RyaW5nPSIiO3ZhciByZXN1bHQ7dmFyIHNlYXJjaFN0cmluZz10aGlzLnBhdHRlcm47d2hpbGUoKHJlc3VsdD1yZWdleC5leGVjKHNlYXJjaFN0cmluZykpKXt2YXIgbWF0Y2hlZFN0cmluZz1yZXN1bHRbMF07dmFyIHBhZGRpbmc9cmVzdWx0WzFdO3ZhciB0cnVuY2F0aW9uPXJlc3VsdFsyXTt2YXIgY29udmVyc2lvbkNoYXJhY3Rlcj1yZXN1bHRbM107dmFyIHNwZWNpZmllcj1yZXN1bHRbNV07dmFyIHRleHQ9cmVzdWx0WzZdO2lmKHRleHQpe2Zvcm1hdHRlZFN0cmluZys9IiIrdGV4dDt9ZWxzZXt2YXIgcmVwbGFjZW1lbnQ9IiI7c3dpdGNoKGNvbnZlcnNpb25DaGFyYWN0ZXIpe2Nhc2UiYSI6Y2FzZSJtIjp2YXIgZGVwdGg9MDtpZihzcGVjaWZpZXIpe2RlcHRoPXBhcnNlSW50KHNwZWNpZmllciwxMCk7aWYoaXNOYU4oZGVwdGgpKXtoYW5kbGVFcnJvcigiUGF0dGVybkxheW91dC5mb3JtYXQ6IGludmFsaWQgc3BlY2lmaWVyICciKw0Kc3BlY2lmaWVyKyInIGZvciBjb252ZXJzaW9uIGNoYXJhY3RlciAnIitjb252ZXJzaW9uQ2hhcmFjdGVyKyInIC0gc2hvdWxkIGJlIGEgbnVtYmVyIik7ZGVwdGg9MDt9fQ0KdmFyIG1lc3NhZ2VzPShjb252ZXJzaW9uQ2hhcmFjdGVyPT09ImEiKT9sb2dnaW5nRXZlbnQubWVzc2FnZXNbMF06bG9nZ2luZ0V2ZW50Lm1lc3NhZ2VzO2Zvcih2YXIgaT0wLGxlbj1tZXNzYWdlcy5sZW5ndGg7aTxsZW47aSsrKXtpZihpPjAmJihyZXBsYWNlbWVudC5jaGFyQXQocmVwbGFjZW1lbnQubGVuZ3RoLTEpIT09IiAiKSl7cmVwbGFjZW1lbnQrPSIgIjt9DQppZihkZXB0aD09PTApe3JlcGxhY2VtZW50Kz1tZXNzYWdlc1tpXTt9ZWxzZXtyZXBsYWNlbWVudCs9Zm9ybWF0T2JqZWN0RXhwYW5zaW9uKG1lc3NhZ2VzW2ldLGRlcHRoKTt9fQ0KYnJlYWs7Y2FzZSJjIjp2YXIgbG9nZ2VyTmFtZT1sb2dnaW5nRXZlbnQubG9nZ2VyLm5hbWU7aWYoc3BlY2lmaWVyKXt2YXIgcHJlY2lzaW9uPXBhcnNlSW50KHNwZWNpZmllciwxMCk7dmFyIGxvZ2dlck5hbWVCaXRzPWxvZ2dpbmdFdmVudC5sb2dnZXIubmFtZS5zcGxpdCgiLiIpO2lmKHByZWNpc2lvbj49bG9nZ2VyTmFtZUJpdHMubGVuZ3RoKXtyZXBsYWNlbWVudD1sb2dnZXJOYW1lO31lbHNle3JlcGxhY2VtZW50PWxvZ2dlck5hbWVCaXRzLnNsaWNlKGxvZ2dlck5hbWVCaXRzLmxlbmd0aC1wcmVjaXNpb24pLmpvaW4oIi4iKTt9fWVsc2V7cmVwbGFjZW1lbnQ9bG9nZ2VyTmFtZTt9DQpicmVhaztjYXNlImQiOnZhciBkYXRlRm9ybWF0PVBhdHRlcm5MYXlvdXQuSVNPODYwMV9EQVRFRk9STUFUO2lmKHNwZWNpZmllcil7ZGF0ZUZvcm1hdD1zcGVjaWZpZXI7aWYoZGF0ZUZvcm1hdD09IklTTzg2MDEiKXtkYXRlRm9ybWF0PVBhdHRlcm5MYXlvdXQuSVNPODYwMV9EQVRFRk9STUFUO31lbHNlIGlmKGRhdGVGb3JtYXQ9PSJBQlNPTFVURSIpe2RhdGVGb3JtYXQ9UGF0dGVybkxheW91dC5BQlNPTFVURVRJTUVfREFURUZPUk1BVDt9ZWxzZSBpZihkYXRlRm9ybWF0PT0iREFURSIpe2RhdGVGb3JtYXQ9UGF0dGVybkxheW91dC5EQVRFVElNRV9EQVRFRk9STUFUO319DQpyZXBsYWNlbWVudD0obmV3IFNpbXBsZURhdGVGb3JtYXQoZGF0ZUZvcm1hdCkpLmZvcm1hdChsb2dnaW5nRXZlbnQudGltZVN0YW1wKTticmVhaztjYXNlImYiOmlmKHRoaXMuaGFzQ3VzdG9tRmllbGRzKCkpe3ZhciBmaWVsZEluZGV4PTA7aWYoc3BlY2lmaWVyKXtmaWVsZEluZGV4PXBhcnNlSW50KHNwZWNpZmllciwxMCk7aWYoaXNOYU4oZmllbGRJbmRleCkpe2hhbmRsZUVycm9yKCJQYXR0ZXJuTGF5b3V0LmZvcm1hdDogaW52YWxpZCBzcGVjaWZpZXIgJyIrDQpzcGVjaWZpZXIrIicgZm9yIGNvbnZlcnNpb24gY2hhcmFjdGVyICdmJyAtIHNob3VsZCBiZSBhIG51bWJlciIpO31lbHNlIGlmKGZpZWxkSW5kZXg9PT0wKXtoYW5kbGVFcnJvcigiUGF0dGVybkxheW91dC5mb3JtYXQ6IGludmFsaWQgc3BlY2lmaWVyICciKw0Kc3BlY2lmaWVyKyInIGZvciBjb252ZXJzaW9uIGNoYXJhY3RlciAnZicgLSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvIik7fWVsc2UgaWYoZmllbGRJbmRleD50aGlzLmN1c3RvbUZpZWxkcy5sZW5ndGgpe2hhbmRsZUVycm9yKCJQYXR0ZXJuTGF5b3V0LmZvcm1hdDogaW52YWxpZCBzcGVjaWZpZXIgJyIrDQpzcGVjaWZpZXIrIicgZm9yIGNvbnZlcnNpb24gY2hhcmFjdGVyICdmJyAtIHRoZXJlIGFyZW4ndCB0aGF0IG1hbnkgY3VzdG9tIGZpZWxkcyIpO31lbHNle2ZpZWxkSW5kZXg9ZmllbGRJbmRleC0xO319DQpyZXBsYWNlbWVudD10aGlzLmN1c3RvbUZpZWxkc1tmaWVsZEluZGV4XS52YWx1ZTt9DQpicmVhaztjYXNlIm4iOnJlcGxhY2VtZW50PW5ld0xpbmU7YnJlYWs7Y2FzZSJwIjpyZXBsYWNlbWVudD1sb2dnaW5nRXZlbnQubGV2ZWwubmFtZTticmVhaztjYXNlInIiOnJlcGxhY2VtZW50PSIiK2xvZ2dpbmdFdmVudC50aW1lU3RhbXAuZ2V0RGlmZmVyZW5jZShhcHBsaWNhdGlvblN0YXJ0RGF0ZSk7YnJlYWs7Y2FzZSIlIjpyZXBsYWNlbWVudD0iJSI7YnJlYWs7ZGVmYXVsdDpyZXBsYWNlbWVudD1tYXRjaGVkU3RyaW5nO2JyZWFrO30NCnZhciBsO2lmKHRydW5jYXRpb24pe2w9cGFyc2VJbnQodHJ1bmNhdGlvbi5zdWJzdHIoMSksMTApO3ZhciBzdHJMZW49cmVwbGFjZW1lbnQubGVuZ3RoO2lmKGw8c3RyTGVuKXtyZXBsYWNlbWVudD1yZXBsYWNlbWVudC5zdWJzdHJpbmcoc3RyTGVuLWwsc3RyTGVuKTt9fQ0KaWYocGFkZGluZyl7aWYocGFkZGluZy5jaGFyQXQoMCk9PSItIil7bD1wYXJzZUludChwYWRkaW5nLnN1YnN0cigxKSwxMCk7d2hpbGUocmVwbGFjZW1lbnQubGVuZ3RoPGwpe3JlcGxhY2VtZW50Kz0iICI7fX1lbHNle2w9cGFyc2VJbnQocGFkZGluZywxMCk7d2hpbGUocmVwbGFjZW1lbnQubGVuZ3RoPGwpe3JlcGxhY2VtZW50PSIgIityZXBsYWNlbWVudDt9fX0NCmZvcm1hdHRlZFN0cmluZys9cmVwbGFjZW1lbnQ7fQ0Kc2VhcmNoU3RyaW5nPXNlYXJjaFN0cmluZy5zdWJzdHIocmVzdWx0LmluZGV4K3Jlc3VsdFswXS5sZW5ndGgpO30NCnJldHVybiBmb3JtYXR0ZWRTdHJpbmc7fTtQYXR0ZXJuTGF5b3V0LnByb3RvdHlwZS5pZ25vcmVzVGhyb3dhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHRydWU7fTtQYXR0ZXJuTGF5b3V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJQYXR0ZXJuTGF5b3V0Ijt9O2xvZzRqYXZhc2NyaXB0LlBhdHRlcm5MYXlvdXQ9UGF0dGVybkxheW91dDtmdW5jdGlvbiBBbGVydEFwcGVuZGVyKCl7fQ0KQWxlcnRBcHBlbmRlci5wcm90b3R5cGU9bmV3IEFwcGVuZGVyKCk7QWxlcnRBcHBlbmRlci5wcm90b3R5cGUubGF5b3V0PW5ldyBTaW1wbGVMYXlvdXQoKTtBbGVydEFwcGVuZGVyLnByb3RvdHlwZS5hcHBlbmQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXt2YXIgZm9ybWF0dGVkTWVzc2FnZT10aGlzLmdldExheW91dCgpLmZvcm1hdChsb2dnaW5nRXZlbnQpO2lmKHRoaXMuZ2V0TGF5b3V0KCkuaWdub3Jlc1Rocm93YWJsZSgpKXtmb3JtYXR0ZWRNZXNzYWdlKz1sb2dnaW5nRXZlbnQuZ2V0VGhyb3dhYmxlU3RyUmVwKCk7fQ0KYWxlcnQoZm9ybWF0dGVkTWVzc2FnZSk7fTtBbGVydEFwcGVuZGVyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJBbGVydEFwcGVuZGVyIjt9O2xvZzRqYXZhc2NyaXB0LkFsZXJ0QXBwZW5kZXI9QWxlcnRBcHBlbmRlcjtmdW5jdGlvbiBCcm93c2VyQ29uc29sZUFwcGVuZGVyKCl7fQ0KQnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGU9bmV3IGxvZzRqYXZhc2NyaXB0LkFwcGVuZGVyKCk7QnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUubGF5b3V0PW5ldyBOdWxsTGF5b3V0KCk7QnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUudGhyZXNob2xkPUxldmVsLkRFQlVHO0Jyb3dzZXJDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmFwcGVuZD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3ZhciBhcHBlbmRlcj10aGlzO3ZhciBnZXRGb3JtYXR0ZWRNZXNzYWdlPWZ1bmN0aW9uKCl7dmFyIGxheW91dD1hcHBlbmRlci5nZXRMYXlvdXQoKTt2YXIgZm9ybWF0dGVkTWVzc2FnZT1sYXlvdXQuZm9ybWF0KGxvZ2dpbmdFdmVudCk7aWYobGF5b3V0Lmlnbm9yZXNUaHJvd2FibGUoKSYmbG9nZ2luZ0V2ZW50LmV4Y2VwdGlvbil7Zm9ybWF0dGVkTWVzc2FnZSs9bG9nZ2luZ0V2ZW50LmdldFRocm93YWJsZVN0clJlcCgpO30NCnJldHVybiBmb3JtYXR0ZWRNZXNzYWdlO307aWYoKHR5cGVvZiBvcGVyYSE9InVuZGVmaW5lZCIpJiZvcGVyYS5wb3N0RXJyb3Ipe29wZXJhLnBvc3RFcnJvcihnZXRGb3JtYXR0ZWRNZXNzYWdlKCkpO31lbHNlIGlmKHdpbmRvdy5jb25zb2xlJiZ3aW5kb3cuY29uc29sZS5sb2cpe3ZhciBmb3JtYXR0ZWRNZXNhZ2U9Z2V0Rm9ybWF0dGVkTWVzc2FnZSgpO2lmKHdpbmRvdy5jb25zb2xlLmRlYnVnJiZMZXZlbC5ERUJVRy5pc0dyZWF0ZXJPckVxdWFsKGxvZ2dpbmdFdmVudC5sZXZlbCkpe3dpbmRvdy5jb25zb2xlLmRlYnVnKGZvcm1hdHRlZE1lc2FnZSk7fWVsc2UgaWYod2luZG93LmNvbnNvbGUuaW5mbyYmTGV2ZWwuSU5GTy5lcXVhbHMobG9nZ2luZ0V2ZW50LmxldmVsKSl7d2luZG93LmNvbnNvbGUuaW5mbyhmb3JtYXR0ZWRNZXNhZ2UpO31lbHNlIGlmKHdpbmRvdy5jb25zb2xlLndhcm4mJkxldmVsLldBUk4uZXF1YWxzKGxvZ2dpbmdFdmVudC5sZXZlbCkpe3dpbmRvdy5jb25zb2xlLndhcm4oZm9ybWF0dGVkTWVzYWdlKTt9ZWxzZSBpZih3aW5kb3cuY29uc29sZS5lcnJvciYmbG9nZ2luZ0V2ZW50LmxldmVsLmlzR3JlYXRlck9yRXF1YWwoTGV2ZWwuRVJST1IpKXt3aW5kb3cuY29uc29sZS5lcnJvcihmb3JtYXR0ZWRNZXNhZ2UpO31lbHNle3dpbmRvdy5jb25zb2xlLmxvZyhmb3JtYXR0ZWRNZXNhZ2UpO319fTtCcm93c2VyQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5ncm91cD1mdW5jdGlvbihuYW1lKXtpZih3aW5kb3cuY29uc29sZSYmd2luZG93LmNvbnNvbGUuZ3JvdXApe3dpbmRvdy5jb25zb2xlLmdyb3VwKG5hbWUpO319O0Jyb3dzZXJDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmdyb3VwRW5kPWZ1bmN0aW9uKCl7aWYod2luZG93LmNvbnNvbGUmJndpbmRvdy5jb25zb2xlLmdyb3VwRW5kKXt3aW5kb3cuY29uc29sZS5ncm91cEVuZCgpO319O0Jyb3dzZXJDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkJyb3dzZXJDb25zb2xlQXBwZW5kZXIiO307bG9nNGphdmFzY3JpcHQuQnJvd3NlckNvbnNvbGVBcHBlbmRlcj1Ccm93c2VyQ29uc29sZUFwcGVuZGVyO2Z1bmN0aW9uIGdldFhtbEh0dHAoZXJyb3JIYW5kbGVyKXt2YXIgeG1sSHR0cD1udWxsO2lmKHR5cGVvZiBYTUxIdHRwUmVxdWVzdD09Im9iamVjdCJ8fHR5cGVvZiBYTUxIdHRwUmVxdWVzdD09ImZ1bmN0aW9uIil7eG1sSHR0cD1uZXcgWE1MSHR0cFJlcXVlc3QoKTt9ZWxzZXt0cnl7eG1sSHR0cD1uZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAiKTt9Y2F0Y2goZTEpe3RyeXt4bWxIdHRwPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpO31jYXRjaChlMil7aWYoZXJyb3JIYW5kbGVyKXtlcnJvckhhbmRsZXIoKTt9ZWxzZXtoYW5kbGVFcnJvcigiZ2V0WG1sSHR0cDogdW5hYmxlIHRvIG9idGFpbiBYTUxIdHRwUmVxdWVzdCBvYmplY3QiKTt9fX19DQpyZXR1cm4geG1sSHR0cDt9DQpmdW5jdGlvbiBpc0h0dHBSZXF1ZXN0U3VjY2Vzc2Z1bCh4bWxIdHRwKXtyZXR1cm4oaXNVbmRlZmluZWQoeG1sSHR0cC5zdGF0dXMpfHx4bWxIdHRwLnN0YXR1cz09PTB8fCh4bWxIdHRwLnN0YXR1cz49MjAwJiZ4bWxIdHRwLnN0YXR1czwzMDApKTt9DQpmdW5jdGlvbiBBamF4QXBwZW5kZXIodXJsKXt2YXIgYXBwZW5kZXI9dGhpczt2YXIgaXNTdXBwb3J0ZWQ9dHJ1ZTtpZighdXJsKXtoYW5kbGVFcnJvcigiQWpheEFwcGVuZGVyOiBVUkwgbXVzdCBiZSBzcGVjaWZpZWQgaW4gY29uc3RydWN0b3IiKTtpc1N1cHBvcnRlZD1mYWxzZTt9DQp2YXIgdGltZWQ9dGhpcy5kZWZhdWx0cy50aW1lZDt2YXIgd2FpdEZvclJlc3BvbnNlPXRoaXMuZGVmYXVsdHMud2FpdEZvclJlc3BvbnNlO3ZhciBiYXRjaFNpemU9dGhpcy5kZWZhdWx0cy5iYXRjaFNpemU7dmFyIHRpbWVySW50ZXJ2YWw9dGhpcy5kZWZhdWx0cy50aW1lckludGVydmFsO3ZhciByZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrPXRoaXMuZGVmYXVsdHMucmVxdWVzdFN1Y2Nlc3NDYWxsYmFjazt2YXIgZmFpbENhbGxiYWNrPXRoaXMuZGVmYXVsdHMuZmFpbENhbGxiYWNrO3ZhciBwb3N0VmFyTmFtZT10aGlzLmRlZmF1bHRzLnBvc3RWYXJOYW1lO3ZhciBzZW5kQWxsT25VbmxvYWQ9dGhpcy5kZWZhdWx0cy5zZW5kQWxsT25VbmxvYWQ7dmFyIHNlc3Npb25JZD1udWxsO3ZhciBxdWV1ZWRMb2dnaW5nRXZlbnRzPVtdO3ZhciBxdWV1ZWRSZXF1ZXN0cz1bXTt2YXIgc2VuZGluZz1mYWxzZTt2YXIgaW5pdGlhbGl6ZWQ9ZmFsc2U7ZnVuY3Rpb24gY2hlY2tDYW5Db25maWd1cmUoY29uZmlnT3B0aW9uTmFtZSl7aWYoaW5pdGlhbGl6ZWQpe2hhbmRsZUVycm9yKCJBamF4QXBwZW5kZXI6IGNvbmZpZ3VyYXRpb24gb3B0aW9uICciKw0KY29uZmlnT3B0aW9uTmFtZSsiJyBtYXkgbm90IGJlIHNldCBhZnRlciB0aGUgYXBwZW5kZXIgaGFzIGJlZW4gaW5pdGlhbGl6ZWQiKTtyZXR1cm4gZmFsc2U7fQ0KcmV0dXJuIHRydWU7fQ0KdGhpcy5nZXRTZXNzaW9uSWQ9ZnVuY3Rpb24oKXtyZXR1cm4gc2Vzc2lvbklkO307dGhpcy5zZXRTZXNzaW9uSWQ9ZnVuY3Rpb24oc2Vzc2lvbklkUGFyYW0pe3Nlc3Npb25JZD1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKHNlc3Npb25JZFBhcmFtLG51bGwpO3RoaXMubGF5b3V0LnNldEN1c3RvbUZpZWxkKCJzZXNzaW9uaWQiLHNlc3Npb25JZCk7fTt0aGlzLnNldExheW91dD1mdW5jdGlvbihsYXlvdXRQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImxheW91dCIpKXt0aGlzLmxheW91dD1sYXlvdXRQYXJhbTtpZihzZXNzaW9uSWQhPT1udWxsKXt0aGlzLnNldFNlc3Npb25JZChzZXNzaW9uSWQpO319fTt0aGlzLmlzVGltZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGltZWQ7fTt0aGlzLnNldFRpbWVkPWZ1bmN0aW9uKHRpbWVkUGFyYW0pe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJ0aW1lZCIpKXt0aW1lZD1ib29sKHRpbWVkUGFyYW0pO319O3RoaXMuZ2V0VGltZXJJbnRlcnZhbD1mdW5jdGlvbigpe3JldHVybiB0aW1lckludGVydmFsO307dGhpcy5zZXRUaW1lckludGVydmFsPWZ1bmN0aW9uKHRpbWVySW50ZXJ2YWxQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInRpbWVySW50ZXJ2YWwiKSl7dGltZXJJbnRlcnZhbD1leHRyYWN0SW50RnJvbVBhcmFtKHRpbWVySW50ZXJ2YWxQYXJhbSx0aW1lckludGVydmFsKTt9fTt0aGlzLmlzV2FpdEZvclJlc3BvbnNlPWZ1bmN0aW9uKCl7cmV0dXJuIHdhaXRGb3JSZXNwb25zZTt9O3RoaXMuc2V0V2FpdEZvclJlc3BvbnNlPWZ1bmN0aW9uKHdhaXRGb3JSZXNwb25zZVBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgid2FpdEZvclJlc3BvbnNlIikpe3dhaXRGb3JSZXNwb25zZT1ib29sKHdhaXRGb3JSZXNwb25zZVBhcmFtKTt9fTt0aGlzLmdldEJhdGNoU2l6ZT1mdW5jdGlvbigpe3JldHVybiBiYXRjaFNpemU7fTt0aGlzLnNldEJhdGNoU2l6ZT1mdW5jdGlvbihiYXRjaFNpemVQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImJhdGNoU2l6ZSIpKXtiYXRjaFNpemU9ZXh0cmFjdEludEZyb21QYXJhbShiYXRjaFNpemVQYXJhbSxiYXRjaFNpemUpO319O3RoaXMuaXNTZW5kQWxsT25VbmxvYWQ9ZnVuY3Rpb24oKXtyZXR1cm4gc2VuZEFsbE9uVW5sb2FkO307dGhpcy5zZXRTZW5kQWxsT25VbmxvYWQ9ZnVuY3Rpb24oc2VuZEFsbE9uVW5sb2FkUGFyYW0pe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJzZW5kQWxsT25VbmxvYWQiKSl7c2VuZEFsbE9uVW5sb2FkPWV4dHJhY3RJbnRGcm9tUGFyYW0oc2VuZEFsbE9uVW5sb2FkUGFyYW0sc2VuZEFsbE9uVW5sb2FkKTt9fTt0aGlzLnNldFJlcXVlc3RTdWNjZXNzQ2FsbGJhY2s9ZnVuY3Rpb24ocmVxdWVzdFN1Y2Nlc3NDYWxsYmFja1BhcmFtKXtyZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrPWV4dHJhY3RGdW5jdGlvbkZyb21QYXJhbShyZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUGFyYW0scmVxdWVzdFN1Y2Nlc3NDYWxsYmFjayk7fTt0aGlzLnNldEZhaWxDYWxsYmFjaz1mdW5jdGlvbihmYWlsQ2FsbGJhY2tQYXJhbSl7ZmFpbENhbGxiYWNrPWV4dHJhY3RGdW5jdGlvbkZyb21QYXJhbShmYWlsQ2FsbGJhY2tQYXJhbSxmYWlsQ2FsbGJhY2spO307dGhpcy5nZXRQb3N0VmFyTmFtZT1mdW5jdGlvbigpe3JldHVybiBwb3N0VmFyTmFtZTt9O3RoaXMuc2V0UG9zdFZhck5hbWU9ZnVuY3Rpb24ocG9zdFZhck5hbWVQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInBvc3RWYXJOYW1lIikpe3Bvc3RWYXJOYW1lPWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0ocG9zdFZhck5hbWVQYXJhbSxwb3N0VmFyTmFtZSk7fX07ZnVuY3Rpb24gc2VuZEFsbCgpe2lmKGlzU3VwcG9ydGVkJiZlbmFibGVkKXtzZW5kaW5nPXRydWU7dmFyIGN1cnJlbnRSZXF1ZXN0QmF0Y2g7aWYod2FpdEZvclJlc3BvbnNlKXtpZihxdWV1ZWRSZXF1ZXN0cy5sZW5ndGg+MCl7Y3VycmVudFJlcXVlc3RCYXRjaD1xdWV1ZWRSZXF1ZXN0cy5zaGlmdCgpO3NlbmRSZXF1ZXN0KHByZXBhcmVQb3N0RGF0YShjdXJyZW50UmVxdWVzdEJhdGNoKSxzZW5kQWxsKTt9ZWxzZXtzZW5kaW5nPWZhbHNlO2lmKHRpbWVkKXtzY2hlZHVsZVNlbmRpbmcoKTt9fX1lbHNle3doaWxlKChjdXJyZW50UmVxdWVzdEJhdGNoPXF1ZXVlZFJlcXVlc3RzLnNoaWZ0KCkpKXtzZW5kUmVxdWVzdChwcmVwYXJlUG9zdERhdGEoY3VycmVudFJlcXVlc3RCYXRjaCkpO30NCnNlbmRpbmc9ZmFsc2U7aWYodGltZWQpe3NjaGVkdWxlU2VuZGluZygpO319fX0NCnRoaXMuc2VuZEFsbD1zZW5kQWxsO2Z1bmN0aW9uIHNlbmRBbGxSZW1haW5pbmcoKXtpZihpc1N1cHBvcnRlZCYmZW5hYmxlZCl7dmFyIGFjdHVhbEJhdGNoU2l6ZT1hcHBlbmRlci5nZXRMYXlvdXQoKS5hbGxvd0JhdGNoaW5nKCk/YmF0Y2hTaXplOjE7dmFyIGN1cnJlbnRMb2dnaW5nRXZlbnQ7dmFyIHBvc3REYXRhPSIiO3ZhciBiYXRjaGVkTG9nZ2luZ0V2ZW50cz1bXTt3aGlsZSgoY3VycmVudExvZ2dpbmdFdmVudD1xdWV1ZWRMb2dnaW5nRXZlbnRzLnNoaWZ0KCkpKXtiYXRjaGVkTG9nZ2luZ0V2ZW50cy5wdXNoKGN1cnJlbnRMb2dnaW5nRXZlbnQpO2lmKHF1ZXVlZExvZ2dpbmdFdmVudHMubGVuZ3RoPj1hY3R1YWxCYXRjaFNpemUpe3F1ZXVlZFJlcXVlc3RzLnB1c2goYmF0Y2hlZExvZ2dpbmdFdmVudHMpO2JhdGNoZWRMb2dnaW5nRXZlbnRzPVtdO319DQppZihiYXRjaGVkTG9nZ2luZ0V2ZW50cy5sZW5ndGg+MCl7cXVldWVkUmVxdWVzdHMucHVzaChiYXRjaGVkTG9nZ2luZ0V2ZW50cyk7fQ0Kd2FpdEZvclJlc3BvbnNlPWZhbHNlO3RpbWVkPWZhbHNlO3NlbmRBbGwoKTt9fQ0KZnVuY3Rpb24gcHJlcGFyZVBvc3REYXRhKGJhdGNoZWRMb2dnaW5nRXZlbnRzKXt2YXIgZm9ybWF0dGVkTWVzc2FnZXM9W107dmFyIGN1cnJlbnRMb2dnaW5nRXZlbnQ7dmFyIHBvc3REYXRhPSIiO3doaWxlKChjdXJyZW50TG9nZ2luZ0V2ZW50PWJhdGNoZWRMb2dnaW5nRXZlbnRzLnNoaWZ0KCkpKXt2YXIgY3VycmVudEZvcm1hdHRlZE1lc3NhZ2U9YXBwZW5kZXIuZ2V0TGF5b3V0KCkuZm9ybWF0KGN1cnJlbnRMb2dnaW5nRXZlbnQpO2lmKGFwcGVuZGVyLmdldExheW91dCgpLmlnbm9yZXNUaHJvd2FibGUoKSl7Y3VycmVudEZvcm1hdHRlZE1lc3NhZ2UrPWxvZ2dpbmdFdmVudC5nZXRUaHJvd2FibGVTdHJSZXAoKTt9DQpmb3JtYXR0ZWRNZXNzYWdlcy5wdXNoKGN1cnJlbnRGb3JtYXR0ZWRNZXNzYWdlKTt9DQppZihiYXRjaGVkTG9nZ2luZ0V2ZW50cy5sZW5ndGg9PTEpe3Bvc3REYXRhPWZvcm1hdHRlZE1lc3NhZ2VzLmpvaW4oIiIpO31lbHNle3Bvc3REYXRhPWFwcGVuZGVyLmdldExheW91dCgpLmJhdGNoSGVhZGVyKw0KZm9ybWF0dGVkTWVzc2FnZXMuam9pbihhcHBlbmRlci5nZXRMYXlvdXQoKS5iYXRjaFNlcGFyYXRvcikrDQphcHBlbmRlci5nZXRMYXlvdXQoKS5iYXRjaEZvb3Rlcjt9DQpwb3N0RGF0YT1hcHBlbmRlci5nZXRMYXlvdXQoKS5yZXR1cm5zUG9zdERhdGE/cG9zdERhdGE6dXJsRW5jb2RlKHBvc3RWYXJOYW1lKSsiPSIrdXJsRW5jb2RlKHBvc3REYXRhKTtpZihwb3N0RGF0YS5sZW5ndGg+MCl7cG9zdERhdGErPSImIjt9DQpyZXR1cm4gcG9zdERhdGErImxheW91dD0iK3VybEVuY29kZShhcHBlbmRlci5nZXRMYXlvdXQoKS50b1N0cmluZygpKTt9DQpmdW5jdGlvbiBzY2hlZHVsZVNlbmRpbmcoKXtzZXRUaW1lb3V0KHNlbmRBbGwsdGltZXJJbnRlcnZhbCk7fQ0KZnVuY3Rpb24geG1sSHR0cEVycm9ySGFuZGxlcigpe3ZhciBtc2c9IkFqYXhBcHBlbmRlcjogY291bGQgbm90IGNyZWF0ZSBYTUxIdHRwUmVxdWVzdCBvYmplY3QuIEFqYXhBcHBlbmRlciBkaXNhYmxlZCI7aGFuZGxlRXJyb3IobXNnKTtpc1N1cHBvcnRlZD1mYWxzZTtpZihmYWlsQ2FsbGJhY2spe2ZhaWxDYWxsYmFjayhtc2cpO319DQpmdW5jdGlvbiBzZW5kUmVxdWVzdChwb3N0RGF0YSxzdWNjZXNzQ2FsbGJhY2spe3RyeXt2YXIgeG1sSHR0cD1nZXRYbWxIdHRwKHhtbEh0dHBFcnJvckhhbmRsZXIpO2lmKGlzU3VwcG9ydGVkKXtpZih4bWxIdHRwLm92ZXJyaWRlTWltZVR5cGUpe3htbEh0dHAub3ZlcnJpZGVNaW1lVHlwZShhcHBlbmRlci5nZXRMYXlvdXQoKS5nZXRDb250ZW50VHlwZSgpKTt9DQp4bWxIdHRwLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2lmKHhtbEh0dHAucmVhZHlTdGF0ZT09NCl7aWYoaXNIdHRwUmVxdWVzdFN1Y2Nlc3NmdWwoeG1sSHR0cCkpe2lmKHJlcXVlc3RTdWNjZXNzQ2FsbGJhY2spe3JlcXVlc3RTdWNjZXNzQ2FsbGJhY2soeG1sSHR0cCk7fQ0KaWYoc3VjY2Vzc0NhbGxiYWNrKXtzdWNjZXNzQ2FsbGJhY2soeG1sSHR0cCk7fX1lbHNle3ZhciBtc2c9IkFqYXhBcHBlbmRlci5hcHBlbmQ6IFhNTEh0dHBSZXF1ZXN0IHJlcXVlc3QgdG8gVVJMICIrDQp1cmwrIiByZXR1cm5lZCBzdGF0dXMgY29kZSAiK3htbEh0dHAuc3RhdHVzO2hhbmRsZUVycm9yKG1zZyk7aWYoZmFpbENhbGxiYWNrKXtmYWlsQ2FsbGJhY2sobXNnKTt9fQ0KeG1sSHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZW1wdHlGdW5jdGlvbjt4bWxIdHRwPW51bGw7fX07eG1sSHR0cC5vcGVuKCJQT1NUIix1cmwsdHJ1ZSk7dHJ5e3htbEh0dHAuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7fWNhdGNoKGhlYWRlckV4KXt2YXIgbXNnPSJBamF4QXBwZW5kZXIuYXBwZW5kOiB5b3VyIGJyb3dzZXIncyBYTUxIdHRwUmVxdWVzdCBpbXBsZW1lbnRhdGlvbiIrIiBkb2VzIG5vdCBzdXBwb3J0IHNldFJlcXVlc3RIZWFkZXIsIHRoZXJlZm9yZSBjYW5ub3QgcG9zdCBkYXRhLiBBamF4QXBwZW5kZXIgZGlzYWJsZWQiO2hhbmRsZUVycm9yKG1zZyk7aXNTdXBwb3J0ZWQ9ZmFsc2U7aWYoZmFpbENhbGxiYWNrKXtmYWlsQ2FsbGJhY2sobXNnKTt9DQpyZXR1cm47fQ0KeG1sSHR0cC5zZW5kKHBvc3REYXRhKTt9fWNhdGNoKGV4KXt2YXIgZXJyTXNnPSJBamF4QXBwZW5kZXIuYXBwZW5kOiBlcnJvciBzZW5kaW5nIGxvZyBtZXNzYWdlIHRvICIrdXJsO2hhbmRsZUVycm9yKGVyck1zZyxleCk7aXNTdXBwb3J0ZWQ9ZmFsc2U7aWYoZmFpbENhbGxiYWNrKXtmYWlsQ2FsbGJhY2soZXJyTXNnKyIuIERldGFpbHM6ICIrZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGV4KSk7fX19DQp0aGlzLmFwcGVuZD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe2lmKGlzU3VwcG9ydGVkKXtpZighaW5pdGlhbGl6ZWQpe2luaXQoKTt9DQpxdWV1ZWRMb2dnaW5nRXZlbnRzLnB1c2gobG9nZ2luZ0V2ZW50KTt2YXIgYWN0dWFsQmF0Y2hTaXplPXRoaXMuZ2V0TGF5b3V0KCkuYWxsb3dCYXRjaGluZygpP2JhdGNoU2l6ZToxO2lmKHF1ZXVlZExvZ2dpbmdFdmVudHMubGVuZ3RoPj1hY3R1YWxCYXRjaFNpemUpe3ZhciBjdXJyZW50TG9nZ2luZ0V2ZW50O3ZhciBwb3N0RGF0YT0iIjt2YXIgYmF0Y2hlZExvZ2dpbmdFdmVudHM9W107d2hpbGUoKGN1cnJlbnRMb2dnaW5nRXZlbnQ9cXVldWVkTG9nZ2luZ0V2ZW50cy5zaGlmdCgpKSl7YmF0Y2hlZExvZ2dpbmdFdmVudHMucHVzaChjdXJyZW50TG9nZ2luZ0V2ZW50KTt9DQpxdWV1ZWRSZXF1ZXN0cy5wdXNoKGJhdGNoZWRMb2dnaW5nRXZlbnRzKTtpZighdGltZWQpe2lmKCF3YWl0Rm9yUmVzcG9uc2V8fCh3YWl0Rm9yUmVzcG9uc2UmJiFzZW5kaW5nKSl7c2VuZEFsbCgpO319fX19O2Z1bmN0aW9uIGluaXQoKXtpbml0aWFsaXplZD10cnVlO2lmKHNlbmRBbGxPblVubG9hZCl7YWRkRXZlbnQod2luZG93LCJ1bmxvYWQiLHNlbmRBbGxSZW1haW5pbmcpO30NCmlmKHRpbWVkKXtzY2hlZHVsZVNlbmRpbmcoKTt9fX0NCkFqYXhBcHBlbmRlci5wcm90b3R5cGU9bmV3IEFwcGVuZGVyKCk7QWpheEFwcGVuZGVyLnByb3RvdHlwZS5kZWZhdWx0cz17d2FpdEZvclJlc3BvbnNlOmZhbHNlLHRpbWVkOmZhbHNlLHRpbWVySW50ZXJ2YWw6MTAwMCxiYXRjaFNpemU6MSxzZW5kQWxsT25VbmxvYWQ6dHJ1ZSxyZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrOm51bGwsZmFpbENhbGxiYWNrOm51bGwscG9zdFZhck5hbWU6ImRhdGEifTtBamF4QXBwZW5kZXIucHJvdG90eXBlLmxheW91dD1uZXcgSHR0cFBvc3REYXRhTGF5b3V0KCk7QWpheEFwcGVuZGVyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJBamF4QXBwZW5kZXIiO307bG9nNGphdmFzY3JpcHQuQWpheEFwcGVuZGVyPUFqYXhBcHBlbmRlcjtmdW5jdGlvbiBzZXRDb29raWUobmFtZSx2YWx1ZSxkYXlzLHBhdGgpe3ZhciBleHBpcmVzO3BhdGg9cGF0aD8iOyBwYXRoPSIrcGF0aDoiIjtpZihkYXlzKXt2YXIgZGF0ZT1uZXcgRGF0ZSgpO2RhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSsoZGF5cyoyNCo2MCo2MCoxMDAwKSk7ZXhwaXJlcz0iOyBleHBpcmVzPSIrZGF0ZS50b0dNVFN0cmluZygpO31lbHNle2V4cGlyZXM9IiI7fQ0KZG9jdW1lbnQuY29va2llPWVzY2FwZShuYW1lKSsiPSIrZXNjYXBlKHZhbHVlKStleHBpcmVzK3BhdGg7fQ0KZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpe3ZhciBuYW1lRXF1YWxzPWVzY2FwZShuYW1lKSsiPSI7dmFyIGNhPWRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpO2Zvcih2YXIgaT0wLGxlbj1jYS5sZW5ndGg7aTxsZW47aSsrKXt2YXIgYz1jYVtpXTt3aGlsZShjLmNoYXJBdCgwKT09PSIgIil7Yz1jLnN1YnN0cmluZygxLGMubGVuZ3RoKTt9DQppZihjLmluZGV4T2YobmFtZUVxdWFscyk9PT0wKXtyZXR1cm4gdW5lc2NhcGUoYy5zdWJzdHJpbmcobmFtZUVxdWFscy5sZW5ndGgsYy5sZW5ndGgpKTt9fQ0KcmV0dXJuIG51bGw7fQ0KZnVuY3Rpb24gZ2V0QmFzZVVybCgpe3ZhciBzY3JpcHRzPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKTtmb3IodmFyIGk9MCxsZW49c2NyaXB0cy5sZW5ndGg7aTxsZW47KytpKXtpZihzY3JpcHRzW2ldLnNyYy5pbmRleE9mKCJsb2c0amF2YXNjcmlwdCIpIT0tMSl7dmFyIGxhc3RTbGFzaD1zY3JpcHRzW2ldLnNyYy5sYXN0SW5kZXhPZigiLyIpO3JldHVybihsYXN0U2xhc2g9PS0xKT8iIjpzY3JpcHRzW2ldLnNyYy5zdWJzdHIoMCxsYXN0U2xhc2grMSk7fX0NCnJldHVybiBudWxsO30NCmZ1bmN0aW9uIGlzTG9hZGVkKHdpbil7dHJ5e3JldHVybiBib29sKHdpbi5sb2FkZWQpO31jYXRjaChleCl7cmV0dXJuIGZhbHNlO319DQp2YXIgQ29uc29sZUFwcGVuZGVyOyhmdW5jdGlvbigpe3ZhciBnZXRDb25zb2xlSHRtbExpbmVzPWZ1bmN0aW9uKCl7cmV0dXJuWyc8IURPQ1RZUEUgaHRtbCBQVUJMSUMgIi0vL1czQy8vRFREIFhIVE1MIDEuMCBTdHJpY3QvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvVFIveGh0bWwxL0RURC94aHRtbDEtc3RyaWN0LmR0ZCI+JywnPGh0bWwgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIGxhbmc9ImVuIiB4bWw6bGFuZz0iZW4iPicsJzxoZWFkPicsJzx0aXRsZT5sb2c0amF2YXNjcmlwdDwvdGl0bGU+JywnPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+JywnPCEtLSBNYWtlIElFOCBiZWhhdmUgbGlrZSBJRTcsIGhhdmluZyBnb25lIHRvIGFsbCB0aGUgdHJvdWJsZSBvZiBtYWtpbmcgSUUgd29yayAtLT4nLCc8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPTciIC8+JywnPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPnZhciBpc0llID0gZmFsc2UsIGlzSWVQcmU3ID0gZmFsc2U7PC9zY3JpcHQ+JywnPCEtLVtpZiBJRV0+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPmlzSWUgPSB0cnVlPC9zY3JpcHQ+PCFbZW5kaWZdLS0+JywnPCEtLVtpZiBsdCBJRSA3XT48c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+aXNJZVByZTcgPSB0cnVlPC9zY3JpcHQ+PCFbZW5kaWZdLS0+JywnPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPicsJy8vPCFbQ0RBVEFbJywndmFyIGxvZ2dpbmdFbmFibGVkPXRydWU7dmFyIGxvZ1F1ZXVlZEV2ZW50c1RpbWVyPW51bGw7dmFyIGxvZ0VudHJpZXM9W107dmFyIGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzPVtdO3ZhciBsb2dJdGVtcz1bXTt2YXIgcmVuZGVyRGVsYXk9MTAwO3ZhciB1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdD1mYWxzZTt2YXIgcm9vdEdyb3VwLGN1cnJlbnRHcm91cD1udWxsO3ZhciBsb2FkZWQ9ZmFsc2U7dmFyIGN1cnJlbnRMb2dJdGVtPW51bGw7dmFyIGxvZ01haW5Db250YWluZXI7ZnVuY3Rpb24gY29weVByb3BlcnRpZXMob2JqLHByb3BzKXtmb3IodmFyIGkgaW4gcHJvcHMpe29ialtpXT1wcm9wc1tpXTt9fScsJ2Z1bmN0aW9uIExvZ0l0ZW0oKXt9JywnTG9nSXRlbS5wcm90b3R5cGU9e21haW5Db250YWluZXI6bnVsbCx3cmFwcGVkQ29udGFpbmVyOm51bGwsdW53cmFwcGVkQ29udGFpbmVyOm51bGwsZ3JvdXA6bnVsbCxhcHBlbmRUb0xvZzpmdW5jdGlvbigpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uYXBwZW5kVG9Mb2coKTt9JywndGhpcy5ncm91cC51cGRhdGUoKTt9LGRvUmVtb3ZlOmZ1bmN0aW9uKGRvVXBkYXRlLHJlbW92ZUZyb21Hcm91cCl7aWYodGhpcy5yZW5kZXJlZCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5yZW1vdmUoKTt9JywndGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW51bGw7dGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcj1udWxsO3RoaXMubWFpbkVsZW1lbnRDb250YWluZXI9bnVsbDt9JywnaWYodGhpcy5ncm91cCYmcmVtb3ZlRnJvbUdyb3VwKXt0aGlzLmdyb3VwLnJlbW92ZUNoaWxkKHRoaXMsZG9VcGRhdGUpO30nLCdpZih0aGlzPT09Y3VycmVudExvZ0l0ZW0pe2N1cnJlbnRMb2dJdGVtPW51bGw7fX0scmVtb3ZlOmZ1bmN0aW9uKGRvVXBkYXRlLHJlbW92ZUZyb21Hcm91cCl7dGhpcy5kb1JlbW92ZShkb1VwZGF0ZSxyZW1vdmVGcm9tR3JvdXApO30scmVuZGVyOmZ1bmN0aW9uKCl7fSxhY2NlcHQ6ZnVuY3Rpb24odmlzaXRvcil7dmlzaXRvci52aXNpdCh0aGlzKTt9LGdldFVud3JhcHBlZERvbUNvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdyb3VwLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIuY29udGVudERpdjt9LGdldFdyYXBwZWREb21Db250YWluZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ncm91cC53cmFwcGVkRWxlbWVudENvbnRhaW5lci5jb250ZW50RGl2O30sZ2V0TWFpbkRvbUNvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdyb3VwLm1haW5FbGVtZW50Q29udGFpbmVyLmNvbnRlbnREaXY7fX07TG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXM9e0xPR19FTlRSWTowLEdST1VQX1NUQVJUOjEsR1JPVVBfRU5EOjJ9O2Z1bmN0aW9uIExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCl7fScsJ0xvZ0l0ZW1Db250YWluZXJFbGVtZW50LnByb3RvdHlwZT17YXBwZW5kVG9Mb2c6ZnVuY3Rpb24oKXt2YXIgaW5zZXJ0QmVmb3JlRmlyc3Q9KG5ld2VzdEF0VG9wJiZ0aGlzLmNvbnRhaW5lckRvbU5vZGUuaGFzQ2hpbGROb2RlcygpKTtpZihpbnNlcnRCZWZvcmVGaXJzdCl7dGhpcy5jb250YWluZXJEb21Ob2RlLmluc2VydEJlZm9yZSh0aGlzLm1haW5EaXYsdGhpcy5jb250YWluZXJEb21Ob2RlLmZpcnN0Q2hpbGQpO31lbHNle3RoaXMuY29udGFpbmVyRG9tTm9kZS5hcHBlbmRDaGlsZCh0aGlzLm1haW5EaXYpO319fTtmdW5jdGlvbiBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKGNvbnRhaW5lckRvbU5vZGUpe3RoaXMuY29udGFpbmVyRG9tTm9kZT1jb250YWluZXJEb21Ob2RlO3RoaXMubWFpbkRpdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLm1haW5EaXYuY2xhc3NOYW1lPSJzZXBhcmF0b3IiO3RoaXMubWFpbkRpdi5pbm5lckhUTUw9IiZuYnNwOyI7fScsJ1NlcGFyYXRvckVsZW1lbnRDb250YWluZXIucHJvdG90eXBlPW5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpO1NlcGFyYXRvckVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnJlbW92ZT1mdW5jdGlvbigpe3RoaXMubWFpbkRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWFpbkRpdik7dGhpcy5tYWluRGl2PW51bGw7fTtmdW5jdGlvbiBTZXBhcmF0b3IoKXt0aGlzLnJlbmRlcmVkPWZhbHNlO30nLCdTZXBhcmF0b3IucHJvdG90eXBlPW5ldyBMb2dJdGVtKCk7Y29weVByb3BlcnRpZXMoU2VwYXJhdG9yLnByb3RvdHlwZSx7cmVuZGVyOmZ1bmN0aW9uKCl7dmFyIGNvbnRhaW5lckRvbU5vZGU9dGhpcy5ncm91cC5jb250ZW50RGl2O2lmKGlzSWUpe3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcj1uZXcgU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lcih0aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpKTt0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKHRoaXMuZ2V0V3JhcHBlZERvbUNvbnRhaW5lcigpKTt0aGlzLmVsZW1lbnRDb250YWluZXJzPVt0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIsdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcl07fWVsc2V7dGhpcy5tYWluRWxlbWVudENvbnRhaW5lcj1uZXcgU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lcih0aGlzLmdldE1haW5Eb21Db250YWluZXIoKSk7dGhpcy5lbGVtZW50Q29udGFpbmVycz1bdGhpcy5tYWluRWxlbWVudENvbnRhaW5lcl07fScsJ3RoaXMuY29udGVudD10aGlzLmZvcm1hdHRlZE1lc3NhZ2U7dGhpcy5yZW5kZXJlZD10cnVlO319KTtmdW5jdGlvbiBHcm91cEVsZW1lbnRDb250YWluZXIoZ3JvdXAsY29udGFpbmVyRG9tTm9kZSxpc1Jvb3QsaXNXcmFwcGVkKXt0aGlzLmdyb3VwPWdyb3VwO3RoaXMuY29udGFpbmVyRG9tTm9kZT1jb250YWluZXJEb21Ob2RlO3RoaXMuaXNSb290PWlzUm9vdDt0aGlzLmlzV3JhcHBlZD1pc1dyYXBwZWQ7dGhpcy5leHBhbmRhYmxlPWZhbHNlO2lmKHRoaXMuaXNSb290KXtpZihpc0llKXt0aGlzLmNvbnRlbnREaXY9bG9nTWFpbkNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7dGhpcy5jb250ZW50RGl2LmlkPXRoaXMuaXNXcmFwcGVkPyJsb2dfd3JhcHBlZCI6ImxvZ191bndyYXBwZWQiO31lbHNle3RoaXMuY29udGVudERpdj1sb2dNYWluQ29udGFpbmVyO319ZWxzZXt2YXIgZ3JvdXBFbGVtZW50Q29udGFpbmVyPXRoaXM7dGhpcy5tYWluRGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMubWFpbkRpdi5jbGFzc05hbWU9Imdyb3VwIjt0aGlzLmhlYWRpbmdEaXY9dGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTt0aGlzLmhlYWRpbmdEaXYuY2xhc3NOYW1lPSJncm91cGhlYWRpbmciO3RoaXMuZXhwYW5kZXI9dGhpcy5oZWFkaW5nRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSk7dGhpcy5leHBhbmRlci5jbGFzc05hbWU9ImV4cGFuZGVyIHVuc2VsZWN0YWJsZSBncmV5ZWRvdXQiO3RoaXMuZXhwYW5kZXIudW5zZWxlY3RhYmxlPXRydWU7dmFyIGV4cGFuZGVyVGV4dD10aGlzLmdyb3VwLmV4cGFuZGVkPyItIjoiKyI7dGhpcy5leHBhbmRlclRleHROb2RlPXRoaXMuZXhwYW5kZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXhwYW5kZXJUZXh0KSk7dGhpcy5oZWFkaW5nRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIgIit0aGlzLmdyb3VwLm5hbWUpKTt0aGlzLmNvbnRlbnREaXY9dGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTt2YXIgY29udGVudENzc0NsYXNzPXRoaXMuZ3JvdXAuZXhwYW5kZWQ/ImV4cGFuZGVkIjoiY29sbGFwc2VkIjt0aGlzLmNvbnRlbnREaXYuY2xhc3NOYW1lPSJncm91cGNvbnRlbnQgIitjb250ZW50Q3NzQ2xhc3M7dGhpcy5leHBhbmRlci5vbmNsaWNrPWZ1bmN0aW9uKCl7aWYoZ3JvdXBFbGVtZW50Q29udGFpbmVyLmdyb3VwLmV4cGFuZGFibGUpe2dyb3VwRWxlbWVudENvbnRhaW5lci5ncm91cC50b2dnbGVFeHBhbmRlZCgpO319O319JywnR3JvdXBFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZT1uZXcgTG9nSXRlbUNvbnRhaW5lckVsZW1lbnQoKTtjb3B5UHJvcGVydGllcyhHcm91cEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLHt0b2dnbGVFeHBhbmRlZDpmdW5jdGlvbigpe2lmKCF0aGlzLmlzUm9vdCl7dmFyIG9sZENzc0NsYXNzLG5ld0Nzc0NsYXNzLGV4cGFuZGVyVGV4dDtpZih0aGlzLmdyb3VwLmV4cGFuZGVkKXtuZXdDc3NDbGFzcz0iZXhwYW5kZWQiO29sZENzc0NsYXNzPSJjb2xsYXBzZWQiO2V4cGFuZGVyVGV4dD0iLSI7fWVsc2V7bmV3Q3NzQ2xhc3M9ImNvbGxhcHNlZCI7b2xkQ3NzQ2xhc3M9ImV4cGFuZGVkIjtleHBhbmRlclRleHQ9IisiO30nLCdyZXBsYWNlQ2xhc3ModGhpcy5jb250ZW50RGl2LG5ld0Nzc0NsYXNzLG9sZENzc0NsYXNzKTt0aGlzLmV4cGFuZGVyVGV4dE5vZGUubm9kZVZhbHVlPWV4cGFuZGVyVGV4dDt9fSxyZW1vdmU6ZnVuY3Rpb24oKXtpZighdGhpcy5pc1Jvb3Qpe3RoaXMuaGVhZGluZ0Rpdj1udWxsO3RoaXMuZXhwYW5kZXIub25jbGljaz1udWxsO3RoaXMuZXhwYW5kZXI9bnVsbDt0aGlzLmV4cGFuZGVyVGV4dE5vZGU9bnVsbDt0aGlzLmNvbnRlbnREaXY9bnVsbDt0aGlzLmNvbnRhaW5lckRvbU5vZGU9bnVsbDt0aGlzLm1haW5EaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1haW5EaXYpO3RoaXMubWFpbkRpdj1udWxsO319LHJldmVyc2VDaGlsZHJlbjpmdW5jdGlvbigpe3ZhciBub2RlPW51bGw7dmFyIGNoaWxkRG9tTm9kZXM9W107d2hpbGUoKG5vZGU9dGhpcy5jb250ZW50RGl2LmZpcnN0Q2hpbGQpKXt0aGlzLmNvbnRlbnREaXYucmVtb3ZlQ2hpbGQobm9kZSk7Y2hpbGREb21Ob2Rlcy5wdXNoKG5vZGUpO30nLCd3aGlsZSgobm9kZT1jaGlsZERvbU5vZGVzLnBvcCgpKSl7dGhpcy5jb250ZW50RGl2LmFwcGVuZENoaWxkKG5vZGUpO319LHVwZGF0ZTpmdW5jdGlvbigpe2lmKCF0aGlzLmlzUm9vdCl7aWYodGhpcy5ncm91cC5leHBhbmRhYmxlKXtyZW1vdmVDbGFzcyh0aGlzLmV4cGFuZGVyLCJncmV5ZWRvdXQiKTt9ZWxzZXthZGRDbGFzcyh0aGlzLmV4cGFuZGVyLCJncmV5ZWRvdXQiKTt9fX0sY2xlYXI6ZnVuY3Rpb24oKXtpZih0aGlzLmlzUm9vdCl7dGhpcy5jb250ZW50RGl2LmlubmVySFRNTD0iIjt9fX0pO2Z1bmN0aW9uIEdyb3VwKG5hbWUsaXNSb290LGluaXRpYWxseUV4cGFuZGVkKXt0aGlzLm5hbWU9bmFtZTt0aGlzLmdyb3VwPW51bGw7dGhpcy5pc1Jvb3Q9aXNSb290O3RoaXMuaW5pdGlhbGx5RXhwYW5kZWQ9aW5pdGlhbGx5RXhwYW5kZWQ7dGhpcy5lbGVtZW50Q29udGFpbmVycz1bXTt0aGlzLmNoaWxkcmVuPVtdO3RoaXMuZXhwYW5kZWQ9aW5pdGlhbGx5RXhwYW5kZWQ7dGhpcy5yZW5kZXJlZD1mYWxzZTt0aGlzLmV4cGFuZGFibGU9ZmFsc2U7fScsJ0dyb3VwLnByb3RvdHlwZT1uZXcgTG9nSXRlbSgpO2NvcHlQcm9wZXJ0aWVzKEdyb3VwLnByb3RvdHlwZSx7YWRkQ2hpbGQ6ZnVuY3Rpb24obG9nSXRlbSl7dGhpcy5jaGlsZHJlbi5wdXNoKGxvZ0l0ZW0pO2xvZ0l0ZW0uZ3JvdXA9dGhpczt9LHJlbmRlcjpmdW5jdGlvbigpe2lmKGlzSWUpe3ZhciB1bndyYXBwZWREb21Db250YWluZXIsd3JhcHBlZERvbUNvbnRhaW5lcjtpZih0aGlzLmlzUm9vdCl7dW53cmFwcGVkRG9tQ29udGFpbmVyPWxvZ01haW5Db250YWluZXI7d3JhcHBlZERvbUNvbnRhaW5lcj1sb2dNYWluQ29udGFpbmVyO31lbHNle3Vud3JhcHBlZERvbUNvbnRhaW5lcj10aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpO3dyYXBwZWREb21Db250YWluZXI9dGhpcy5nZXRXcmFwcGVkRG9tQ29udGFpbmVyKCk7fScsJ3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcj1uZXcgR3JvdXBFbGVtZW50Q29udGFpbmVyKHRoaXMsdW53cmFwcGVkRG9tQ29udGFpbmVyLHRoaXMuaXNSb290LGZhbHNlKTt0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBHcm91cEVsZW1lbnRDb250YWluZXIodGhpcyx3cmFwcGVkRG9tQ29udGFpbmVyLHRoaXMuaXNSb290LHRydWUpO3RoaXMuZWxlbWVudENvbnRhaW5lcnM9W3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcix0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyXTt9ZWxzZXt2YXIgbWFpbkRvbUNvbnRhaW5lcj10aGlzLmlzUm9vdD9sb2dNYWluQ29udGFpbmVyOnRoaXMuZ2V0TWFpbkRvbUNvbnRhaW5lcigpO3RoaXMubWFpbkVsZW1lbnRDb250YWluZXI9bmV3IEdyb3VwRWxlbWVudENvbnRhaW5lcih0aGlzLG1haW5Eb21Db250YWluZXIsdGhpcy5pc1Jvb3QsZmFsc2UpO3RoaXMuZWxlbWVudENvbnRhaW5lcnM9W3RoaXMubWFpbkVsZW1lbnRDb250YWluZXJdO30nLCd0aGlzLnJlbmRlcmVkPXRydWU7fSx0b2dnbGVFeHBhbmRlZDpmdW5jdGlvbigpe3RoaXMuZXhwYW5kZWQ9IXRoaXMuZXhwYW5kZWQ7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS50b2dnbGVFeHBhbmRlZCgpO319LGV4cGFuZDpmdW5jdGlvbigpe2lmKCF0aGlzLmV4cGFuZGVkKXt0aGlzLnRvZ2dsZUV4cGFuZGVkKCk7fX0sYWNjZXB0OmZ1bmN0aW9uKHZpc2l0b3Ipe3Zpc2l0b3IudmlzaXRHcm91cCh0aGlzKTt9LHJldmVyc2VDaGlsZHJlbjpmdW5jdGlvbigpe2lmKHRoaXMucmVuZGVyZWQpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0ucmV2ZXJzZUNoaWxkcmVuKCk7fX19LHVwZGF0ZTpmdW5jdGlvbigpe3ZhciBwcmV2aW91c2x5RXhwYW5kYWJsZT10aGlzLmV4cGFuZGFibGU7dGhpcy5leHBhbmRhYmxlPSh0aGlzLmNoaWxkcmVuLmxlbmd0aCE9PTApO2lmKHRoaXMuZXhwYW5kYWJsZSE9PXByZXZpb3VzbHlFeHBhbmRhYmxlKXtmb3IodmFyIGk9MCxsZW49dGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnVwZGF0ZSgpO319fSxmbGF0dGVuOmZ1bmN0aW9uKCl7dmFyIHZpc2l0b3I9bmV3IEdyb3VwRmxhdHRlbmVyKCk7dGhpcy5hY2NlcHQodmlzaXRvcik7cmV0dXJuIHZpc2l0b3IubG9nRW50cmllc0FuZFNlcGFyYXRvcnM7fSxyZW1vdmVDaGlsZDpmdW5jdGlvbihjaGlsZCxkb1VwZGF0ZSl7YXJyYXlfcmVtb3ZlKHRoaXMuY2hpbGRyZW4sY2hpbGQpO2NoaWxkLmdyb3VwPW51bGw7aWYoZG9VcGRhdGUpe3RoaXMudXBkYXRlKCk7fX0scmVtb3ZlOmZ1bmN0aW9uKGRvVXBkYXRlLHJlbW92ZUZyb21Hcm91cCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuY2hpbGRyZW4ubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5jaGlsZHJlbltpXS5yZW1vdmUoZmFsc2UsZmFsc2UpO30nLCd0aGlzLmNoaWxkcmVuPVtdO3RoaXMudXBkYXRlKCk7aWYodGhpcz09PWN1cnJlbnRHcm91cCl7Y3VycmVudEdyb3VwPXRoaXMuZ3JvdXA7fScsJ3RoaXMuZG9SZW1vdmUoZG9VcGRhdGUscmVtb3ZlRnJvbUdyb3VwKTt9LHNlcmlhbGl6ZTpmdW5jdGlvbihpdGVtcyl7aXRlbXMucHVzaChbTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuR1JPVVBfU1RBUlQsdGhpcy5uYW1lXSk7Zm9yKHZhciBpPTAsbGVuPXRoaXMuY2hpbGRyZW4ubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5jaGlsZHJlbltpXS5zZXJpYWxpemUoaXRlbXMpO30nLCdpZih0aGlzIT09Y3VycmVudEdyb3VwKXtpdGVtcy5wdXNoKFtMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9FTkRdKTt9fSxjbGVhcjpmdW5jdGlvbigpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uY2xlYXIoKTt9fX0pO2Z1bmN0aW9uIExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpe30nLCdMb2dFbnRyeUVsZW1lbnRDb250YWluZXIucHJvdG90eXBlPW5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpO2NvcHlQcm9wZXJ0aWVzKExvZ0VudHJ5RWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUse3JlbW92ZTpmdW5jdGlvbigpe3RoaXMuZG9SZW1vdmUoKTt9LGRvUmVtb3ZlOmZ1bmN0aW9uKCl7dGhpcy5tYWluRGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tYWluRGl2KTt0aGlzLm1haW5EaXY9bnVsbDt0aGlzLmNvbnRlbnRFbGVtZW50PW51bGw7dGhpcy5jb250YWluZXJEb21Ob2RlPW51bGw7fSxzZXRDb250ZW50OmZ1bmN0aW9uKGNvbnRlbnQsd3JhcHBlZENvbnRlbnQpe2lmKGNvbnRlbnQ9PT10aGlzLmZvcm1hdHRlZE1lc3NhZ2Upe3RoaXMuY29udGVudEVsZW1lbnQuaW5uZXJIVE1MPSIiO3RoaXMuY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5mb3JtYXR0ZWRNZXNzYWdlKSk7fWVsc2V7dGhpcy5jb250ZW50RWxlbWVudC5pbm5lckhUTUw9Y29udGVudDt9fSxzZXRTZWFyY2hNYXRjaDpmdW5jdGlvbihpc01hdGNoKXt2YXIgb2xkQ3NzQ2xhc3M9aXNNYXRjaD8ic2VhcmNobm9ubWF0Y2giOiJzZWFyY2htYXRjaCI7dmFyIG5ld0Nzc0NsYXNzPWlzTWF0Y2g/InNlYXJjaG1hdGNoIjoic2VhcmNobm9ubWF0Y2giO3JlcGxhY2VDbGFzcyh0aGlzLm1haW5EaXYsbmV3Q3NzQ2xhc3Msb2xkQ3NzQ2xhc3MpO30sY2xlYXJTZWFyY2g6ZnVuY3Rpb24oKXtyZW1vdmVDbGFzcyh0aGlzLm1haW5EaXYsInNlYXJjaG1hdGNoIik7cmVtb3ZlQ2xhc3ModGhpcy5tYWluRGl2LCJzZWFyY2hub25tYXRjaCIpO319KTtmdW5jdGlvbiBMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyKGxvZ0VudHJ5LGNvbnRhaW5lckRvbU5vZGUpe3RoaXMubG9nRW50cnk9bG9nRW50cnk7dGhpcy5jb250YWluZXJEb21Ob2RlPWNvbnRhaW5lckRvbU5vZGU7dGhpcy5tYWluRGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpKTt0aGlzLm1haW5EaXYuY2xhc3NOYW1lPSJsb2dlbnRyeSB3cmFwcGVkICIrdGhpcy5sb2dFbnRyeS5sZXZlbDt0aGlzLmNvbnRlbnRFbGVtZW50PXRoaXMubWFpbkRpdjt9JywnTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGU9bmV3IExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpO0xvZ0VudHJ5V3JhcHBlZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnNldENvbnRlbnQ9ZnVuY3Rpb24oY29udGVudCx3cmFwcGVkQ29udGVudCl7aWYoY29udGVudD09PXRoaXMuZm9ybWF0dGVkTWVzc2FnZSl7dGhpcy5jb250ZW50RWxlbWVudC5pbm5lckhUTUw9IiI7dGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKTt9ZWxzZXt0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTD13cmFwcGVkQ29udGVudDt9fTtmdW5jdGlvbiBMb2dFbnRyeVVud3JhcHBlZEVsZW1lbnRDb250YWluZXIobG9nRW50cnksY29udGFpbmVyRG9tTm9kZSl7dGhpcy5sb2dFbnRyeT1sb2dFbnRyeTt0aGlzLmNvbnRhaW5lckRvbU5vZGU9Y29udGFpbmVyRG9tTm9kZTt0aGlzLm1haW5EaXY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5tYWluRGl2LmNsYXNzTmFtZT0ibG9nZW50cnkgdW53cmFwcGVkICIrdGhpcy5sb2dFbnRyeS5sZXZlbDt0aGlzLnByZT10aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicHJlIikpO3RoaXMucHJlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMubG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSkpO3RoaXMucHJlLmNsYXNzTmFtZT0idW53cmFwcGVkIjt0aGlzLmNvbnRlbnRFbGVtZW50PXRoaXMucHJlO30nLCdMb2dFbnRyeVVud3JhcHBlZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlPW5ldyBMb2dFbnRyeUVsZW1lbnRDb250YWluZXIoKTtMb2dFbnRyeVVud3JhcHBlZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnJlbW92ZT1mdW5jdGlvbigpe3RoaXMuZG9SZW1vdmUoKTt0aGlzLnByZT1udWxsO307ZnVuY3Rpb24gTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lcihsb2dFbnRyeSxjb250YWluZXJEb21Ob2RlKXt0aGlzLmxvZ0VudHJ5PWxvZ0VudHJ5O3RoaXMuY29udGFpbmVyRG9tTm9kZT1jb250YWluZXJEb21Ob2RlO3RoaXMubWFpbkRpdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLm1haW5EaXYuY2xhc3NOYW1lPSJsb2dlbnRyeSBub25pZWxvZ2VudHJ5ICIrdGhpcy5sb2dFbnRyeS5sZXZlbDt0aGlzLmNvbnRlbnRFbGVtZW50PXRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIikpO3RoaXMuY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5sb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlKSk7fScsJ0xvZ0VudHJ5TWFpbkVsZW1lbnRDb250YWluZXIucHJvdG90eXBlPW5ldyBMb2dFbnRyeUVsZW1lbnRDb250YWluZXIoKTtmdW5jdGlvbiBMb2dFbnRyeShsZXZlbCxmb3JtYXR0ZWRNZXNzYWdlKXt0aGlzLmxldmVsPWxldmVsO3RoaXMuZm9ybWF0dGVkTWVzc2FnZT1mb3JtYXR0ZWRNZXNzYWdlO3RoaXMucmVuZGVyZWQ9ZmFsc2U7fScsJ0xvZ0VudHJ5LnByb3RvdHlwZT1uZXcgTG9nSXRlbSgpO2NvcHlQcm9wZXJ0aWVzKExvZ0VudHJ5LnByb3RvdHlwZSx7cmVuZGVyOmZ1bmN0aW9uKCl7dmFyIGxvZ0VudHJ5PXRoaXM7dmFyIGNvbnRhaW5lckRvbU5vZGU9dGhpcy5ncm91cC5jb250ZW50RGl2O2lmKGlzSWUpe3RoaXMuZm9ybWF0dGVkTWVzc2FnZT10aGlzLmZvcm1hdHRlZE1lc3NhZ2UucmVwbGFjZSgvXFxyXFxuL2csIlxcciIpO3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcj1uZXcgTG9nRW50cnlVbndyYXBwZWRFbGVtZW50Q29udGFpbmVyKHRoaXMsdGhpcy5nZXRVbndyYXBwZWREb21Db250YWluZXIoKSk7dGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcj1uZXcgTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lcih0aGlzLHRoaXMuZ2V0V3JhcHBlZERvbUNvbnRhaW5lcigpKTt0aGlzLmVsZW1lbnRDb250YWluZXJzPVt0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIsdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcl07fWVsc2V7dGhpcy5tYWluRWxlbWVudENvbnRhaW5lcj1uZXcgTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lcih0aGlzLHRoaXMuZ2V0TWFpbkRvbUNvbnRhaW5lcigpKTt0aGlzLmVsZW1lbnRDb250YWluZXJzPVt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyXTt9JywndGhpcy5jb250ZW50PXRoaXMuZm9ybWF0dGVkTWVzc2FnZTt0aGlzLnJlbmRlcmVkPXRydWU7fSxzZXRDb250ZW50OmZ1bmN0aW9uKGNvbnRlbnQsd3JhcHBlZENvbnRlbnQpe2lmKGNvbnRlbnQhPXRoaXMuY29udGVudCl7aWYoaXNJZSYmKGNvbnRlbnQhPT10aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKXtjb250ZW50PWNvbnRlbnQucmVwbGFjZSgvXFxyXFxuL2csIlxcciIpO30nLCdmb3IodmFyIGk9MCxsZW49dGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnNldENvbnRlbnQoY29udGVudCx3cmFwcGVkQ29udGVudCk7fScsJ3RoaXMuY29udGVudD1jb250ZW50O319LGdldFNlYXJjaE1hdGNoZXM6ZnVuY3Rpb24oKXt2YXIgbWF0Y2hlcz1bXTt2YXIgaSxsZW47aWYoaXNJZSl7dmFyIHVud3JhcHBlZEVscz1nZXRFbGVtZW50c0J5Q2xhc3ModGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyLm1haW5EaXYsInNlYXJjaHRlcm0iLCJzcGFuIik7dmFyIHdyYXBwZWRFbHM9Z2V0RWxlbWVudHNCeUNsYXNzKHRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIubWFpbkRpdiwic2VhcmNodGVybSIsInNwYW4iKTtmb3IoaT0wLGxlbj11bndyYXBwZWRFbHMubGVuZ3RoO2k8bGVuO2krKyl7bWF0Y2hlc1tpXT1uZXcgTWF0Y2godGhpcy5sZXZlbCxudWxsLHVud3JhcHBlZEVsc1tpXSx3cmFwcGVkRWxzW2ldKTt9fWVsc2V7dmFyIGVscz1nZXRFbGVtZW50c0J5Q2xhc3ModGhpcy5tYWluRWxlbWVudENvbnRhaW5lci5tYWluRGl2LCJzZWFyY2h0ZXJtIiwic3BhbiIpO2ZvcihpPTAsbGVuPWVscy5sZW5ndGg7aTxsZW47aSsrKXttYXRjaGVzW2ldPW5ldyBNYXRjaCh0aGlzLmxldmVsLGVsc1tpXSk7fX0nLCdyZXR1cm4gbWF0Y2hlczt9LHNldFNlYXJjaE1hdGNoOmZ1bmN0aW9uKGlzTWF0Y2gpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uc2V0U2VhcmNoTWF0Y2goaXNNYXRjaCk7fX0sY2xlYXJTZWFyY2g6ZnVuY3Rpb24oKXtmb3IodmFyIGk9MCxsZW49dGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLmNsZWFyU2VhcmNoKCk7fX0sYWNjZXB0OmZ1bmN0aW9uKHZpc2l0b3Ipe3Zpc2l0b3IudmlzaXRMb2dFbnRyeSh0aGlzKTt9LHNlcmlhbGl6ZTpmdW5jdGlvbihpdGVtcyl7aXRlbXMucHVzaChbTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuTE9HX0VOVFJZLHRoaXMubGV2ZWwsdGhpcy5mb3JtYXR0ZWRNZXNzYWdlXSk7fX0pO2Z1bmN0aW9uIExvZ0l0ZW1WaXNpdG9yKCl7fScsJ0xvZ0l0ZW1WaXNpdG9yLnByb3RvdHlwZT17dmlzaXQ6ZnVuY3Rpb24obG9nSXRlbSl7fSx2aXNpdFBhcmVudDpmdW5jdGlvbihsb2dJdGVtKXtpZihsb2dJdGVtLmdyb3VwKXtsb2dJdGVtLmdyb3VwLmFjY2VwdCh0aGlzKTt9fSx2aXNpdENoaWxkcmVuOmZ1bmN0aW9uKGxvZ0l0ZW0pe2Zvcih2YXIgaT0wLGxlbj1sb2dJdGVtLmNoaWxkcmVuLmxlbmd0aDtpPGxlbjtpKyspe2xvZ0l0ZW0uY2hpbGRyZW5baV0uYWNjZXB0KHRoaXMpO319LHZpc2l0TG9nRW50cnk6ZnVuY3Rpb24obG9nRW50cnkpe3RoaXMudmlzaXQobG9nRW50cnkpO30sdmlzaXRTZXBhcmF0b3I6ZnVuY3Rpb24oc2VwYXJhdG9yKXt0aGlzLnZpc2l0KHNlcGFyYXRvcik7fSx2aXNpdEdyb3VwOmZ1bmN0aW9uKGdyb3VwKXt0aGlzLnZpc2l0KGdyb3VwKTt9fTtmdW5jdGlvbiBHcm91cEZsYXR0ZW5lcigpe3RoaXMubG9nRW50cmllc0FuZFNlcGFyYXRvcnM9W107fScsJ0dyb3VwRmxhdHRlbmVyLnByb3RvdHlwZT1uZXcgTG9nSXRlbVZpc2l0b3IoKTtHcm91cEZsYXR0ZW5lci5wcm90b3R5cGUudmlzaXRHcm91cD1mdW5jdGlvbihncm91cCl7dGhpcy52aXNpdENoaWxkcmVuKGdyb3VwKTt9O0dyb3VwRmxhdHRlbmVyLnByb3RvdHlwZS52aXNpdExvZ0VudHJ5PWZ1bmN0aW9uKGxvZ0VudHJ5KXt0aGlzLmxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2gobG9nRW50cnkpO307R3JvdXBGbGF0dGVuZXIucHJvdG90eXBlLnZpc2l0U2VwYXJhdG9yPWZ1bmN0aW9uKHNlcGFyYXRvcil7dGhpcy5sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKHNlcGFyYXRvcik7fTt3aW5kb3cub25sb2FkPWZ1bmN0aW9uKCl7aWYobG9jYXRpb24uc2VhcmNoKXt2YXIgcXVlcnlCaXRzPXVuZXNjYXBlKGxvY2F0aW9uLnNlYXJjaCkuc3Vic3RyKDEpLnNwbGl0KCImIiksbmFtZVZhbHVlQml0cztmb3IodmFyIGk9MCxsZW49cXVlcnlCaXRzLmxlbmd0aDtpPGxlbjtpKyspe25hbWVWYWx1ZUJpdHM9cXVlcnlCaXRzW2ldLnNwbGl0KCI9Iik7aWYobmFtZVZhbHVlQml0c1swXT09ImxvZzRqYXZhc2NyaXB0X2RvbWFpbiIpe2RvY3VtZW50LmRvbWFpbj1uYW1lVmFsdWVCaXRzWzFdO2JyZWFrO319fScsJ2xvZ01haW5Db250YWluZXI9JCgibG9nIik7aWYoaXNJZVByZTcpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsIm9sZEllIik7fScsJ3Jvb3RHcm91cD1uZXcgR3JvdXAoInJvb3QiLHRydWUpO3Jvb3RHcm91cC5yZW5kZXIoKTtjdXJyZW50R3JvdXA9cm9vdEdyb3VwO3NldENvbW1hbmRJbnB1dFdpZHRoKCk7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7dG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKTt0b2dnbGVTZWFyY2hFbmFibGVkKCk7dG9nZ2xlU2VhcmNoRmlsdGVyKCk7dG9nZ2xlU2VhcmNoSGlnaGxpZ2h0KCk7YXBwbHlGaWx0ZXJzKCk7Y2hlY2tBbGxMZXZlbHMoKTt0b2dnbGVXcmFwKCk7dG9nZ2xlTmV3ZXN0QXRUb3AoKTt0b2dnbGVTY3JvbGxUb0xhdGVzdCgpO3JlbmRlclF1ZXVlZExvZ0l0ZW1zKCk7bG9hZGVkPXRydWU7JCgiY29tbWFuZCIpLnZhbHVlPSIiOyQoImNvbW1hbmQiKS5hdXRvY29tcGxldGU9Im9mZiI7JCgiY29tbWFuZCIpLm9ua2V5ZG93bj1mdW5jdGlvbihldnQpe2V2dD1nZXRFdmVudChldnQpO2lmKGV2dC5rZXlDb2RlPT0xMHx8ZXZ0LmtleUNvZGU9PTEzKXtldmFsQ29tbWFuZExpbmUoKTtzdG9wUHJvcGFnYXRpb24oZXZ0KTt9ZWxzZSBpZihldnQua2V5Q29kZT09Mjcpe3RoaXMudmFsdWU9IiI7dGhpcy5mb2N1cygpO31lbHNlIGlmKGV2dC5rZXlDb2RlPT0zOCYmY29tbWFuZEhpc3RvcnkubGVuZ3RoPjApe2N1cnJlbnRDb21tYW5kSW5kZXg9TWF0aC5tYXgoMCxjdXJyZW50Q29tbWFuZEluZGV4LTEpO3RoaXMudmFsdWU9Y29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF07bW92ZUNhcmV0VG9FbmQodGhpcyk7fWVsc2UgaWYoZXZ0LmtleUNvZGU9PTQwJiZjb21tYW5kSGlzdG9yeS5sZW5ndGg+MCl7Y3VycmVudENvbW1hbmRJbmRleD1NYXRoLm1pbihjb21tYW5kSGlzdG9yeS5sZW5ndGgtMSxjdXJyZW50Q29tbWFuZEluZGV4KzEpO3RoaXMudmFsdWU9Y29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF07bW92ZUNhcmV0VG9FbmQodGhpcyk7fX07JCgiY29tbWFuZCIpLm9ua2V5cHJlc3M9ZnVuY3Rpb24oZXZ0KXtldnQ9Z2V0RXZlbnQoZXZ0KTtpZihldnQua2V5Q29kZT09MzgmJmNvbW1hbmRIaXN0b3J5Lmxlbmd0aD4wJiZldnQucHJldmVudERlZmF1bHQpe2V2dC5wcmV2ZW50RGVmYXVsdCgpO319OyQoImNvbW1hbmQiKS5vbmtleXVwPWZ1bmN0aW9uKGV2dCl7ZXZ0PWdldEV2ZW50KGV2dCk7aWYoZXZ0LmtleUNvZGU9PTI3JiZldnQucHJldmVudERlZmF1bHQpe2V2dC5wcmV2ZW50RGVmYXVsdCgpO3RoaXMuZm9jdXMoKTt9fTtkb2N1bWVudC5vbmtleWRvd249ZnVuY3Rpb24ga2V5RXZlbnRIYW5kbGVyKGV2dCl7ZXZ0PWdldEV2ZW50KGV2dCk7c3dpdGNoKGV2dC5rZXlDb2RlKXtjYXNlIDY5OmlmKGV2dC5zaGlmdEtleSYmKGV2dC5jdHJsS2V5fHxldnQubWV0YUtleSkpe2V2YWxMYXN0Q29tbWFuZCgpO2NhbmNlbEtleUV2ZW50KGV2dCk7cmV0dXJuIGZhbHNlO30nLCdicmVhaztjYXNlIDc1OmlmKGV2dC5zaGlmdEtleSYmKGV2dC5jdHJsS2V5fHxldnQubWV0YUtleSkpe2ZvY3VzU2VhcmNoKCk7Y2FuY2VsS2V5RXZlbnQoZXZ0KTtyZXR1cm4gZmFsc2U7fScsJ2JyZWFrO2Nhc2UgNDA6Y2FzZSA3NjppZihldnQuc2hpZnRLZXkmJihldnQuY3RybEtleXx8ZXZ0Lm1ldGFLZXkpKXtmb2N1c0NvbW1hbmRMaW5lKCk7Y2FuY2VsS2V5RXZlbnQoZXZ0KTtyZXR1cm4gZmFsc2U7fScsJ2JyZWFrO319O3NldFRpbWVvdXQoc2V0TG9nQ29udGFpbmVySGVpZ2h0LDIwKTtzZXRTaG93Q29tbWFuZExpbmUoc2hvd0NvbW1hbmRMaW5lKTtkb1NlYXJjaCgpO307d2luZG93Lm9udW5sb2FkPWZ1bmN0aW9uKCl7aWYobWFpbldpbmRvd0V4aXN0cygpKXthcHBlbmRlci51bmxvYWQoKTt9JywnYXBwZW5kZXI9bnVsbDt9O2Z1bmN0aW9uIHRvZ2dsZUxvZ2dpbmdFbmFibGVkKCl7c2V0TG9nZ2luZ0VuYWJsZWQoJCgiZW5hYmxlTG9nZ2luZyIpLmNoZWNrZWQpO30nLCdmdW5jdGlvbiBzZXRMb2dnaW5nRW5hYmxlZChlbmFibGUpe2xvZ2dpbmdFbmFibGVkPWVuYWJsZTt9JywndmFyIGFwcGVuZGVyPW51bGw7ZnVuY3Rpb24gc2V0QXBwZW5kZXIoYXBwZW5kZXJQYXJhbSl7YXBwZW5kZXI9YXBwZW5kZXJQYXJhbTt9JywnZnVuY3Rpb24gc2V0U2hvd0Nsb3NlQnV0dG9uKHNob3dDbG9zZUJ1dHRvbil7JCgiY2xvc2VCdXR0b24iKS5zdHlsZS5kaXNwbGF5PXNob3dDbG9zZUJ1dHRvbj8iaW5saW5lIjoibm9uZSI7fScsJ2Z1bmN0aW9uIHNldFNob3dIaWRlQnV0dG9uKHNob3dIaWRlQnV0dG9uKXskKCJoaWRlQnV0dG9uIikuc3R5bGUuZGlzcGxheT1zaG93SGlkZUJ1dHRvbj8iaW5saW5lIjoibm9uZSI7fScsJ3ZhciBuZXdlc3RBdFRvcD1mYWxzZTtmdW5jdGlvbiBMb2dJdGVtQ29udGVudFJldmVyc2VyKCl7fScsJ0xvZ0l0ZW1Db250ZW50UmV2ZXJzZXIucHJvdG90eXBlPW5ldyBMb2dJdGVtVmlzaXRvcigpO0xvZ0l0ZW1Db250ZW50UmV2ZXJzZXIucHJvdG90eXBlLnZpc2l0R3JvdXA9ZnVuY3Rpb24oZ3JvdXApe2dyb3VwLnJldmVyc2VDaGlsZHJlbigpO3RoaXMudmlzaXRDaGlsZHJlbihncm91cCk7fTtmdW5jdGlvbiBzZXROZXdlc3RBdFRvcChpc05ld2VzdEF0VG9wKXt2YXIgb2xkTmV3ZXN0QXRUb3A9bmV3ZXN0QXRUb3A7dmFyIGksaUxlbixqLGpMZW47bmV3ZXN0QXRUb3A9Qm9vbGVhbihpc05ld2VzdEF0VG9wKTtpZihvbGROZXdlc3RBdFRvcCE9bmV3ZXN0QXRUb3Ape3ZhciB2aXNpdG9yPW5ldyBMb2dJdGVtQ29udGVudFJldmVyc2VyKCk7cm9vdEdyb3VwLmFjY2VwdCh2aXNpdG9yKTtpZihjdXJyZW50U2VhcmNoKXt2YXIgY3VycmVudE1hdGNoPWN1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07dmFyIG1hdGNoSW5kZXg9MDt2YXIgbWF0Y2hlcz1bXTt2YXIgYWN0T25Mb2dFbnRyeT1mdW5jdGlvbihsb2dFbnRyeSl7dmFyIGxvZ0VudHJ5TWF0Y2hlcz1sb2dFbnRyeS5nZXRTZWFyY2hNYXRjaGVzKCk7Zm9yKGo9MCxqTGVuPWxvZ0VudHJ5TWF0Y2hlcy5sZW5ndGg7ajxqTGVuO2orKyl7bWF0Y2hlc1ttYXRjaEluZGV4XT1sb2dFbnRyeU1hdGNoZXNbal07aWYoY3VycmVudE1hdGNoJiZsb2dFbnRyeU1hdGNoZXNbal0uZXF1YWxzKGN1cnJlbnRNYXRjaCkpe2N1cnJlbnRNYXRjaEluZGV4PW1hdGNoSW5kZXg7fScsJ21hdGNoSW5kZXgrKzt9fTtpZihuZXdlc3RBdFRvcCl7Zm9yKGk9bG9nRW50cmllcy5sZW5ndGgtMTtpPj0wO2ktLSl7YWN0T25Mb2dFbnRyeShsb2dFbnRyaWVzW2ldKTt9fWVsc2V7Zm9yKGk9MCxpTGVuPWxvZ0VudHJpZXMubGVuZ3RoO2k8aUxlbjtpKyspe2FjdE9uTG9nRW50cnkobG9nRW50cmllc1tpXSk7fX0nLCdjdXJyZW50U2VhcmNoLm1hdGNoZXM9bWF0Y2hlcztpZihjdXJyZW50TWF0Y2gpe2N1cnJlbnRNYXRjaC5zZXRDdXJyZW50KCk7fX1lbHNlIGlmKHNjcm9sbFRvTGF0ZXN0KXtkb1Njcm9sbFRvTGF0ZXN0KCk7fX0nLCckKCJuZXdlc3RBdFRvcCIpLmNoZWNrZWQ9aXNOZXdlc3RBdFRvcDt9JywnZnVuY3Rpb24gdG9nZ2xlTmV3ZXN0QXRUb3AoKXt2YXIgaXNOZXdlc3RBdFRvcD0kKCJuZXdlc3RBdFRvcCIpLmNoZWNrZWQ7c2V0TmV3ZXN0QXRUb3AoaXNOZXdlc3RBdFRvcCk7fScsJ3ZhciBzY3JvbGxUb0xhdGVzdD10cnVlO2Z1bmN0aW9uIHNldFNjcm9sbFRvTGF0ZXN0KGlzU2Nyb2xsVG9MYXRlc3Qpe3Njcm9sbFRvTGF0ZXN0PWlzU2Nyb2xsVG9MYXRlc3Q7aWYoc2Nyb2xsVG9MYXRlc3Qpe2RvU2Nyb2xsVG9MYXRlc3QoKTt9JywnJCgic2Nyb2xsVG9MYXRlc3QiKS5jaGVja2VkPWlzU2Nyb2xsVG9MYXRlc3Q7fScsJ2Z1bmN0aW9uIHRvZ2dsZVNjcm9sbFRvTGF0ZXN0KCl7dmFyIGlzU2Nyb2xsVG9MYXRlc3Q9JCgic2Nyb2xsVG9MYXRlc3QiKS5jaGVja2VkO3NldFNjcm9sbFRvTGF0ZXN0KGlzU2Nyb2xsVG9MYXRlc3QpO30nLCdmdW5jdGlvbiBkb1Njcm9sbFRvTGF0ZXN0KCl7dmFyIGw9bG9nTWFpbkNvbnRhaW5lcjtpZih0eXBlb2YgbC5zY3JvbGxUb3AhPSJ1bmRlZmluZWQiKXtpZihuZXdlc3RBdFRvcCl7bC5zY3JvbGxUb3A9MDt9ZWxzZXt2YXIgbGF0ZXN0TG9nRW50cnk9bC5sYXN0Q2hpbGQ7aWYobGF0ZXN0TG9nRW50cnkpe2wuc2Nyb2xsVG9wPWwuc2Nyb2xsSGVpZ2h0O319fX0nLCd2YXIgY2xvc2VJZk9wZW5lckNsb3Nlcz10cnVlO2Z1bmN0aW9uIHNldENsb3NlSWZPcGVuZXJDbG9zZXMoaXNDbG9zZUlmT3BlbmVyQ2xvc2VzKXtjbG9zZUlmT3BlbmVyQ2xvc2VzPWlzQ2xvc2VJZk9wZW5lckNsb3Nlczt9JywndmFyIG1heE1lc3NhZ2VzPW51bGw7ZnVuY3Rpb24gc2V0TWF4TWVzc2FnZXMobWF4KXttYXhNZXNzYWdlcz1tYXg7cHJ1bmVMb2dFbnRyaWVzKCk7fScsJ3ZhciBzaG93Q29tbWFuZExpbmU9ZmFsc2U7ZnVuY3Rpb24gc2V0U2hvd0NvbW1hbmRMaW5lKGlzU2hvd0NvbW1hbmRMaW5lKXtzaG93Q29tbWFuZExpbmU9aXNTaG93Q29tbWFuZExpbmU7aWYobG9hZGVkKXskKCJjb21tYW5kTGluZSIpLnN0eWxlLmRpc3BsYXk9c2hvd0NvbW1hbmRMaW5lPyJibG9jayI6Im5vbmUiO3NldENvbW1hbmRJbnB1dFdpZHRoKCk7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fX0nLCdmdW5jdGlvbiBmb2N1c0NvbW1hbmRMaW5lKCl7aWYobG9hZGVkKXskKCJjb21tYW5kIikuZm9jdXMoKTt9fScsJ2Z1bmN0aW9uIGZvY3VzU2VhcmNoKCl7aWYobG9hZGVkKXskKCJzZWFyY2hCb3giKS5mb2N1cygpO319JywnZnVuY3Rpb24gZ2V0TG9nSXRlbXMoKXt2YXIgaXRlbXM9W107Zm9yKHZhciBpPTAsbGVuPWxvZ0l0ZW1zLmxlbmd0aDtpPGxlbjtpKyspe2xvZ0l0ZW1zW2ldLnNlcmlhbGl6ZShpdGVtcyk7fScsJ3JldHVybiBpdGVtczt9JywnZnVuY3Rpb24gc2V0TG9nSXRlbXMoaXRlbXMpe3ZhciBsb2dnaW5nUmVhbGx5RW5hYmxlZD1sb2dnaW5nRW5hYmxlZDtsb2dnaW5nRW5hYmxlZD10cnVlO2Zvcih2YXIgaT0wLGxlbj1pdGVtcy5sZW5ndGg7aTxsZW47aSsrKXtzd2l0Y2goaXRlbXNbaV1bMF0pe2Nhc2UgTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuTE9HX0VOVFJZOmxvZyhpdGVtc1tpXVsxXSxpdGVtc1tpXVsyXSk7YnJlYWs7Y2FzZSBMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9TVEFSVDpncm91cChpdGVtc1tpXVsxXSk7YnJlYWs7Y2FzZSBMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9FTkQ6Z3JvdXBFbmQoKTticmVhazt9fScsJ2xvZ2dpbmdFbmFibGVkPWxvZ2dpbmdSZWFsbHlFbmFibGVkO30nLCdmdW5jdGlvbiBsb2cobG9nTGV2ZWwsZm9ybWF0dGVkTWVzc2FnZSl7aWYobG9nZ2luZ0VuYWJsZWQpe3ZhciBsb2dFbnRyeT1uZXcgTG9nRW50cnkobG9nTGV2ZWwsZm9ybWF0dGVkTWVzc2FnZSk7bG9nRW50cmllcy5wdXNoKGxvZ0VudHJ5KTtsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKGxvZ0VudHJ5KTtsb2dJdGVtcy5wdXNoKGxvZ0VudHJ5KTtjdXJyZW50R3JvdXAuYWRkQ2hpbGQobG9nRW50cnkpO2lmKGxvYWRlZCl7aWYobG9nUXVldWVkRXZlbnRzVGltZXIhPT1udWxsKXtjbGVhclRpbWVvdXQobG9nUXVldWVkRXZlbnRzVGltZXIpO30nLCdsb2dRdWV1ZWRFdmVudHNUaW1lcj1zZXRUaW1lb3V0KHJlbmRlclF1ZXVlZExvZ0l0ZW1zLHJlbmRlckRlbGF5KTt1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdD10cnVlO319fScsJ2Z1bmN0aW9uIHJlbmRlclF1ZXVlZExvZ0l0ZW1zKCl7bG9nUXVldWVkRXZlbnRzVGltZXI9bnVsbDt2YXIgcHJ1bmVkPXBydW5lTG9nRW50cmllcygpO3ZhciBpbml0aWFsbHlIYXNNYXRjaGVzPWN1cnJlbnRTZWFyY2g/Y3VycmVudFNlYXJjaC5oYXNNYXRjaGVzKCk6ZmFsc2U7Zm9yKHZhciBpPTAsbGVuPWxvZ0l0ZW1zLmxlbmd0aDtpPGxlbjtpKyspe2lmKCFsb2dJdGVtc1tpXS5yZW5kZXJlZCl7bG9nSXRlbXNbaV0ucmVuZGVyKCk7bG9nSXRlbXNbaV0uYXBwZW5kVG9Mb2coKTtpZihjdXJyZW50U2VhcmNoJiYobG9nSXRlbXNbaV1pbnN0YW5jZW9mIExvZ0VudHJ5KSl7Y3VycmVudFNlYXJjaC5hcHBseVRvKGxvZ0l0ZW1zW2ldKTt9fX0nLCdpZihjdXJyZW50U2VhcmNoKXtpZihwcnVuZWQpe2lmKGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSl7aWYoY3VycmVudE1hdGNoSW5kZXg9PT1udWxsKXtzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTt9JywnZGlzcGxheU1hdGNoZXMoKTt9ZWxzZXtkaXNwbGF5Tm9NYXRjaGVzKCk7fX1lbHNlIGlmKCFpbml0aWFsbHlIYXNNYXRjaGVzJiZjdXJyZW50U2VhcmNoLmhhc1Zpc2libGVNYXRjaGVzKCkpe3NldEN1cnJlbnRNYXRjaEluZGV4KDApO2Rpc3BsYXlNYXRjaGVzKCk7fX0nLCdpZihzY3JvbGxUb0xhdGVzdCl7ZG9TY3JvbGxUb0xhdGVzdCgpO30nLCd1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdD1mYWxzZTt9JywnZnVuY3Rpb24gcHJ1bmVMb2dFbnRyaWVzKCl7aWYoKG1heE1lc3NhZ2VzIT09bnVsbCkmJihsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5sZW5ndGg+bWF4TWVzc2FnZXMpKXt2YXIgbnVtYmVyVG9EZWxldGU9bG9nRW50cmllc0FuZFNlcGFyYXRvcnMubGVuZ3RoLW1heE1lc3NhZ2VzO3ZhciBwcnVuZWRMb2dFbnRyaWVzPWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnNsaWNlKDAsbnVtYmVyVG9EZWxldGUpO2lmKGN1cnJlbnRTZWFyY2gpe2N1cnJlbnRTZWFyY2gucmVtb3ZlTWF0Y2hlcyhwcnVuZWRMb2dFbnRyaWVzKTt9JywndmFyIGdyb3VwO2Zvcih2YXIgaT0wO2k8bnVtYmVyVG9EZWxldGU7aSsrKXtncm91cD1sb2dFbnRyaWVzQW5kU2VwYXJhdG9yc1tpXS5ncm91cDthcnJheV9yZW1vdmUobG9nSXRlbXMsbG9nRW50cmllc0FuZFNlcGFyYXRvcnNbaV0pO2FycmF5X3JlbW92ZShsb2dFbnRyaWVzLGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldKTtsb2dFbnRyaWVzQW5kU2VwYXJhdG9yc1tpXS5yZW1vdmUodHJ1ZSx0cnVlKTtpZihncm91cC5jaGlsZHJlbi5sZW5ndGg9PT0wJiZncm91cCE9PWN1cnJlbnRHcm91cCYmZ3JvdXAhPT1yb290R3JvdXApe2FycmF5X3JlbW92ZShsb2dJdGVtcyxncm91cCk7Z3JvdXAucmVtb3ZlKHRydWUsdHJ1ZSk7fX0nLCdsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycz1hcnJheV9yZW1vdmVGcm9tU3RhcnQobG9nRW50cmllc0FuZFNlcGFyYXRvcnMsbnVtYmVyVG9EZWxldGUpO3JldHVybiB0cnVlO30nLCdyZXR1cm4gZmFsc2U7fScsJ2Z1bmN0aW9uIGdyb3VwKG5hbWUsc3RhcnRFeHBhbmRlZCl7aWYobG9nZ2luZ0VuYWJsZWQpe2luaXRpYWxseUV4cGFuZGVkPSh0eXBlb2Ygc3RhcnRFeHBhbmRlZD09PSJ1bmRlZmluZWQiKT90cnVlOkJvb2xlYW4oc3RhcnRFeHBhbmRlZCk7dmFyIG5ld0dyb3VwPW5ldyBHcm91cChuYW1lLGZhbHNlLGluaXRpYWxseUV4cGFuZGVkKTtjdXJyZW50R3JvdXAuYWRkQ2hpbGQobmV3R3JvdXApO2N1cnJlbnRHcm91cD1uZXdHcm91cDtsb2dJdGVtcy5wdXNoKG5ld0dyb3VwKTtpZihsb2FkZWQpe2lmKGxvZ1F1ZXVlZEV2ZW50c1RpbWVyIT09bnVsbCl7Y2xlYXJUaW1lb3V0KGxvZ1F1ZXVlZEV2ZW50c1RpbWVyKTt9JywnbG9nUXVldWVkRXZlbnRzVGltZXI9c2V0VGltZW91dChyZW5kZXJRdWV1ZWRMb2dJdGVtcyxyZW5kZXJEZWxheSk7dW5yZW5kZXJlZExvZ0l0ZW1zRXhpc3Q9dHJ1ZTt9fX0nLCdmdW5jdGlvbiBncm91cEVuZCgpe2N1cnJlbnRHcm91cD0oY3VycmVudEdyb3VwPT09cm9vdEdyb3VwKT9yb290R3JvdXA6Y3VycmVudEdyb3VwLmdyb3VwO30nLCdmdW5jdGlvbiBtYWluUGFnZVJlbG9hZGVkKCl7Y3VycmVudEdyb3VwPXJvb3RHcm91cDt2YXIgc2VwYXJhdG9yPW5ldyBTZXBhcmF0b3IoKTtsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKHNlcGFyYXRvcik7bG9nSXRlbXMucHVzaChzZXBhcmF0b3IpO2N1cnJlbnRHcm91cC5hZGRDaGlsZChzZXBhcmF0b3IpO30nLCdmdW5jdGlvbiBjbG9zZVdpbmRvdygpe2lmKGFwcGVuZGVyJiZtYWluV2luZG93RXhpc3RzKCkpe2FwcGVuZGVyLmNsb3NlKHRydWUpO31lbHNle3dpbmRvdy5jbG9zZSgpO319JywnZnVuY3Rpb24gaGlkZSgpe2lmKGFwcGVuZGVyJiZtYWluV2luZG93RXhpc3RzKCkpe2FwcGVuZGVyLmhpZGUoKTt9fScsJ3ZhciBtYWluV2luZG93PXdpbmRvdzt2YXIgd2luZG93SWQ9ImxvZzRqYXZhc2NyaXB0Q29uc29sZVdpbmRvd18iK25ldyBEYXRlKCkuZ2V0VGltZSgpKyJfIisoIiIrTWF0aC5yYW5kb20oKSkuc3Vic3RyKDIpO2Z1bmN0aW9uIHNldE1haW5XaW5kb3cod2luKXttYWluV2luZG93PXdpbjttYWluV2luZG93W3dpbmRvd0lkXT13aW5kb3c7aWYob3BlbmVyJiZjbG9zZUlmT3BlbmVyQ2xvc2VzKXtwb2xsT3BlbmVyKCk7fX0nLCdmdW5jdGlvbiBwb2xsT3BlbmVyKCl7aWYoY2xvc2VJZk9wZW5lckNsb3Nlcyl7aWYobWFpbldpbmRvd0V4aXN0cygpKXtzZXRUaW1lb3V0KHBvbGxPcGVuZXIsNTAwKTt9ZWxzZXtjbG9zZVdpbmRvdygpO319fScsJ2Z1bmN0aW9uIG1haW5XaW5kb3dFeGlzdHMoKXt0cnl7cmV0dXJuKG1haW5XaW5kb3cmJiFtYWluV2luZG93LmNsb3NlZCYmbWFpbldpbmRvd1t3aW5kb3dJZF09PXdpbmRvdyk7fWNhdGNoKGV4KXt9JywncmV0dXJuIGZhbHNlO30nLCd2YXIgbG9nTGV2ZWxzPVsiVFJBQ0UiLCJERUJVRyIsIklORk8iLCJXQVJOIiwiRVJST1IiLCJGQVRBTCJdO2Z1bmN0aW9uIGdldENoZWNrQm94KGxvZ0xldmVsKXtyZXR1cm4gJCgic3dpdGNoXyIrbG9nTGV2ZWwpO30nLCdmdW5jdGlvbiBnZXRJZVdyYXBwZWRMb2dDb250YWluZXIoKXtyZXR1cm4gJCgibG9nX3dyYXBwZWQiKTt9JywnZnVuY3Rpb24gZ2V0SWVVbndyYXBwZWRMb2dDb250YWluZXIoKXtyZXR1cm4gJCgibG9nX3Vud3JhcHBlZCIpO30nLCdmdW5jdGlvbiBhcHBseUZpbHRlcnMoKXtmb3IodmFyIGk9MDtpPGxvZ0xldmVscy5sZW5ndGg7aSsrKXtpZihnZXRDaGVja0JveChsb2dMZXZlbHNbaV0pLmNoZWNrZWQpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsbG9nTGV2ZWxzW2ldKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLGxvZ0xldmVsc1tpXSk7fX0nLCd1cGRhdGVTZWFyY2hGcm9tRmlsdGVycygpO30nLCdmdW5jdGlvbiB0b2dnbGVBbGxMZXZlbHMoKXt2YXIgdHVybk9uPSQoInN3aXRjaF9BTEwiKS5jaGVja2VkO2Zvcih2YXIgaT0wO2k8bG9nTGV2ZWxzLmxlbmd0aDtpKyspe2dldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZD10dXJuT247aWYodHVybk9uKXthZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLGxvZ0xldmVsc1tpXSk7fWVsc2V7cmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lcixsb2dMZXZlbHNbaV0pO319fScsJ2Z1bmN0aW9uIGNoZWNrQWxsTGV2ZWxzKCl7Zm9yKHZhciBpPTA7aTxsb2dMZXZlbHMubGVuZ3RoO2krKyl7aWYoIWdldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZCl7Z2V0Q2hlY2tCb3goIkFMTCIpLmNoZWNrZWQ9ZmFsc2U7cmV0dXJuO319JywnZ2V0Q2hlY2tCb3goIkFMTCIpLmNoZWNrZWQ9dHJ1ZTt9JywnZnVuY3Rpb24gY2xlYXJMb2coKXtyb290R3JvdXAuY2xlYXIoKTtjdXJyZW50R3JvdXA9cm9vdEdyb3VwO2xvZ0VudHJpZXM9W107bG9nSXRlbXM9W107bG9nRW50cmllc0FuZFNlcGFyYXRvcnM9W107ZG9TZWFyY2goKTt9JywnZnVuY3Rpb24gdG9nZ2xlV3JhcCgpe3ZhciBlbmFibGU9JCgid3JhcCIpLmNoZWNrZWQ7aWYoZW5hYmxlKXthZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJ3cmFwIik7fWVsc2V7cmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwid3JhcCIpO30nLCdyZWZyZXNoQ3VycmVudE1hdGNoKCk7fScsJ3ZhciBzZWFyY2hUaW1lcj1udWxsO2Z1bmN0aW9uIHNjaGVkdWxlU2VhcmNoKCl7dHJ5e2NsZWFyVGltZW91dChzZWFyY2hUaW1lcik7fWNhdGNoKGV4KXt9Jywnc2VhcmNoVGltZXI9c2V0VGltZW91dChkb1NlYXJjaCw1MDApO30nLCdmdW5jdGlvbiBTZWFyY2goc2VhcmNoVGVybSxpc1JlZ2V4LHNlYXJjaFJlZ2V4LGlzQ2FzZVNlbnNpdGl2ZSl7dGhpcy5zZWFyY2hUZXJtPXNlYXJjaFRlcm07dGhpcy5pc1JlZ2V4PWlzUmVnZXg7dGhpcy5zZWFyY2hSZWdleD1zZWFyY2hSZWdleDt0aGlzLmlzQ2FzZVNlbnNpdGl2ZT1pc0Nhc2VTZW5zaXRpdmU7dGhpcy5tYXRjaGVzPVtdO30nLCdTZWFyY2gucHJvdG90eXBlPXtoYXNNYXRjaGVzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWF0Y2hlcy5sZW5ndGg+MDt9LGhhc1Zpc2libGVNYXRjaGVzOmZ1bmN0aW9uKCl7aWYodGhpcy5oYXNNYXRjaGVzKCkpe2Zvcih2YXIgaT0wO2k8dGhpcy5tYXRjaGVzLmxlbmd0aDtpKyspe2lmKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSl7cmV0dXJuIHRydWU7fX19JywncmV0dXJuIGZhbHNlO30sbWF0Y2g6ZnVuY3Rpb24obG9nRW50cnkpe3ZhciBlbnRyeVRleHQ9U3RyaW5nKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpO3ZhciBtYXRjaGVzU2VhcmNoPWZhbHNlO2lmKHRoaXMuaXNSZWdleCl7bWF0Y2hlc1NlYXJjaD10aGlzLnNlYXJjaFJlZ2V4LnRlc3QoZW50cnlUZXh0KTt9ZWxzZSBpZih0aGlzLmlzQ2FzZVNlbnNpdGl2ZSl7bWF0Y2hlc1NlYXJjaD0oZW50cnlUZXh0LmluZGV4T2YodGhpcy5zZWFyY2hUZXJtKT4tMSk7fWVsc2V7bWF0Y2hlc1NlYXJjaD0oZW50cnlUZXh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0aGlzLnNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSk+LTEpO30nLCdyZXR1cm4gbWF0Y2hlc1NlYXJjaDt9LGdldE5leHRWaXNpYmxlTWF0Y2hJbmRleDpmdW5jdGlvbigpe2Zvcih2YXIgaT1jdXJyZW50TWF0Y2hJbmRleCsxO2k8dGhpcy5tYXRjaGVzLmxlbmd0aDtpKyspe2lmKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSl7cmV0dXJuIGk7fX0nLCdmb3IoaT0wO2k8PWN1cnJlbnRNYXRjaEluZGV4O2krKyl7aWYodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKXtyZXR1cm4gaTt9fScsJ3JldHVybi0xO30sZ2V0UHJldmlvdXNWaXNpYmxlTWF0Y2hJbmRleDpmdW5jdGlvbigpe2Zvcih2YXIgaT1jdXJyZW50TWF0Y2hJbmRleC0xO2k+PTA7aS0tKXtpZih0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpe3JldHVybiBpO319JywnZm9yKHZhciBpPXRoaXMubWF0Y2hlcy5sZW5ndGgtMTtpPj1jdXJyZW50TWF0Y2hJbmRleDtpLS0pe2lmKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSl7cmV0dXJuIGk7fX0nLCdyZXR1cm4tMTt9LGFwcGx5VG86ZnVuY3Rpb24obG9nRW50cnkpe3ZhciBkb2VzTWF0Y2g9dGhpcy5tYXRjaChsb2dFbnRyeSk7aWYoZG9lc01hdGNoKXtsb2dFbnRyeS5ncm91cC5leHBhbmQoKTtsb2dFbnRyeS5zZXRTZWFyY2hNYXRjaCh0cnVlKTt2YXIgbG9nRW50cnlDb250ZW50O3ZhciB3cmFwcGVkTG9nRW50cnlDb250ZW50O3ZhciBzZWFyY2hUZXJtUmVwbGFjZW1lbnRTdGFydFRhZz0iPHNwYW4gY2xhc3M9XFxcInNlYXJjaHRlcm1cXFwiPiI7dmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZz0iPCIrIi9zcGFuPiI7dmFyIHByZVRhZ05hbWU9aXNJZT8icHJlIjoic3BhbiI7dmFyIHByZVN0YXJ0VGFnPSI8IitwcmVUYWdOYW1lKyIgY2xhc3M9XFxcInByZVxcXCI+Ijt2YXIgcHJlRW5kVGFnPSI8IisiLyIrcHJlVGFnTmFtZSsiPiI7dmFyIHN0YXJ0SW5kZXg9MDt2YXIgc2VhcmNoSW5kZXgsbWF0Y2hlZFRleHQsdGV4dEJlZm9yZU1hdGNoO2lmKHRoaXMuaXNSZWdleCl7dmFyIGZsYWdzPXRoaXMuaXNDYXNlU2Vuc2l0aXZlPyJnIjoiZ2kiO3ZhciBjYXB0dXJpbmdSZWdleD1uZXcgUmVnRXhwKCIoIit0aGlzLnNlYXJjaFJlZ2V4LnNvdXJjZSsiKSIsZmxhZ3MpO3ZhciBybmQ9KCIiK01hdGgucmFuZG9tKCkpLnN1YnN0cigyKTt2YXIgc3RhcnRUb2tlbj0iJSVzIitybmQrIiUlIjt2YXIgZW5kVG9rZW49IiUlZSIrcm5kKyIlJSI7bG9nRW50cnlDb250ZW50PWxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UucmVwbGFjZShjYXB0dXJpbmdSZWdleCxzdGFydFRva2VuKyIkMSIrZW5kVG9rZW4pO2xvZ0VudHJ5Q29udGVudD1lc2NhcGVIdG1sKGxvZ0VudHJ5Q29udGVudCk7dmFyIHJlc3VsdDt2YXIgc2VhcmNoU3RyaW5nPWxvZ0VudHJ5Q29udGVudDtsb2dFbnRyeUNvbnRlbnQ9IiI7d3JhcHBlZExvZ0VudHJ5Q29udGVudD0iIjt3aGlsZSgoc2VhcmNoSW5kZXg9c2VhcmNoU3RyaW5nLmluZGV4T2Yoc3RhcnRUb2tlbixzdGFydEluZGV4KSk+LTEpe3ZhciBlbmRUb2tlbkluZGV4PXNlYXJjaFN0cmluZy5pbmRleE9mKGVuZFRva2VuLHNlYXJjaEluZGV4KTttYXRjaGVkVGV4dD1zZWFyY2hTdHJpbmcuc3Vic3RyaW5nKHNlYXJjaEluZGV4K3N0YXJ0VG9rZW4ubGVuZ3RoLGVuZFRva2VuSW5kZXgpO3RleHRCZWZvcmVNYXRjaD1zZWFyY2hTdHJpbmcuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsc2VhcmNoSW5kZXgpO2xvZ0VudHJ5Q29udGVudCs9cHJlU3RhcnRUYWcrdGV4dEJlZm9yZU1hdGNoK3ByZUVuZFRhZztsb2dFbnRyeUNvbnRlbnQrPXNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnK3ByZVN0YXJ0VGFnK21hdGNoZWRUZXh0KycsJ3ByZUVuZFRhZytzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWc7aWYoaXNJZSl7d3JhcHBlZExvZ0VudHJ5Q29udGVudCs9dGV4dEJlZm9yZU1hdGNoK3NlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnKycsJ21hdGNoZWRUZXh0K3NlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZzt9Jywnc3RhcnRJbmRleD1lbmRUb2tlbkluZGV4K2VuZFRva2VuLmxlbmd0aDt9JywnbG9nRW50cnlDb250ZW50Kz1wcmVTdGFydFRhZytzZWFyY2hTdHJpbmcuc3Vic3RyKHN0YXJ0SW5kZXgpK3ByZUVuZFRhZztpZihpc0llKXt3cmFwcGVkTG9nRW50cnlDb250ZW50Kz1zZWFyY2hTdHJpbmcuc3Vic3RyKHN0YXJ0SW5kZXgpO319ZWxzZXtsb2dFbnRyeUNvbnRlbnQ9IiI7d3JhcHBlZExvZ0VudHJ5Q29udGVudD0iIjt2YXIgc2VhcmNoVGVybVJlcGxhY2VtZW50TGVuZ3RoPXNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnLmxlbmd0aCsnLCd0aGlzLnNlYXJjaFRlcm0ubGVuZ3RoK3NlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZy5sZW5ndGg7dmFyIHNlYXJjaFRlcm1MZW5ndGg9dGhpcy5zZWFyY2hUZXJtLmxlbmd0aDt2YXIgc2VhcmNoVGVybUxvd2VyQ2FzZT10aGlzLnNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKTt2YXIgbG9nVGV4dExvd2VyQ2FzZT1sb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLnRvTG93ZXJDYXNlKCk7d2hpbGUoKHNlYXJjaEluZGV4PWxvZ1RleHRMb3dlckNhc2UuaW5kZXhPZihzZWFyY2hUZXJtTG93ZXJDYXNlLHN0YXJ0SW5kZXgpKT4tMSl7bWF0Y2hlZFRleHQ9ZXNjYXBlSHRtbChsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLnN1YnN0cihzZWFyY2hJbmRleCx0aGlzLnNlYXJjaFRlcm0ubGVuZ3RoKSk7dGV4dEJlZm9yZU1hdGNoPWVzY2FwZUh0bWwobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5zdWJzdHJpbmcoc3RhcnRJbmRleCxzZWFyY2hJbmRleCkpO3ZhciBzZWFyY2hUZXJtUmVwbGFjZW1lbnQ9c2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcrJywncHJlU3RhcnRUYWcrbWF0Y2hlZFRleHQrcHJlRW5kVGFnK3NlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZztsb2dFbnRyeUNvbnRlbnQrPXByZVN0YXJ0VGFnK3RleHRCZWZvcmVNYXRjaCtwcmVFbmRUYWcrc2VhcmNoVGVybVJlcGxhY2VtZW50O2lmKGlzSWUpe3dyYXBwZWRMb2dFbnRyeUNvbnRlbnQrPXRleHRCZWZvcmVNYXRjaCtzZWFyY2hUZXJtUmVwbGFjZW1lbnRTdGFydFRhZysnLCdtYXRjaGVkVGV4dCtzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWc7fScsJ3N0YXJ0SW5kZXg9c2VhcmNoSW5kZXgrc2VhcmNoVGVybUxlbmd0aDt9JywndmFyIHRleHRBZnRlckxhc3RNYXRjaD1lc2NhcGVIdG1sKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2Uuc3Vic3RyKHN0YXJ0SW5kZXgpKTtsb2dFbnRyeUNvbnRlbnQrPXByZVN0YXJ0VGFnK3RleHRBZnRlckxhc3RNYXRjaCtwcmVFbmRUYWc7aWYoaXNJZSl7d3JhcHBlZExvZ0VudHJ5Q29udGVudCs9dGV4dEFmdGVyTGFzdE1hdGNoO319JywnbG9nRW50cnkuc2V0Q29udGVudChsb2dFbnRyeUNvbnRlbnQsd3JhcHBlZExvZ0VudHJ5Q29udGVudCk7dmFyIGxvZ0VudHJ5TWF0Y2hlcz1sb2dFbnRyeS5nZXRTZWFyY2hNYXRjaGVzKCk7dGhpcy5tYXRjaGVzPXRoaXMubWF0Y2hlcy5jb25jYXQobG9nRW50cnlNYXRjaGVzKTt9ZWxzZXtsb2dFbnRyeS5zZXRTZWFyY2hNYXRjaChmYWxzZSk7bG9nRW50cnkuc2V0Q29udGVudChsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpO30nLCdyZXR1cm4gZG9lc01hdGNoO30scmVtb3ZlTWF0Y2hlczpmdW5jdGlvbihsb2dFbnRyaWVzKXt2YXIgbWF0Y2hlc1RvUmVtb3ZlQ291bnQ9MDt2YXIgY3VycmVudE1hdGNoUmVtb3ZlZD1mYWxzZTt2YXIgbWF0Y2hlc1RvUmVtb3ZlPVtdO3ZhciBpLGlMZW4saixqTGVuO2ZvcihpPTAsaUxlbj10aGlzLm1hdGNoZXMubGVuZ3RoO2k8aUxlbjtpKyspe2ZvcihqPTAsakxlbj1sb2dFbnRyaWVzLmxlbmd0aDtqPGpMZW47aisrKXtpZih0aGlzLm1hdGNoZXNbaV0uYmVsb25nc1RvKGxvZ0VudHJpZXNbal0pKXttYXRjaGVzVG9SZW1vdmUucHVzaCh0aGlzLm1hdGNoZXNbaV0pO2lmKGk9PT1jdXJyZW50TWF0Y2hJbmRleCl7Y3VycmVudE1hdGNoUmVtb3ZlZD10cnVlO319fX0nLCd2YXIgbmV3TWF0Y2g9Y3VycmVudE1hdGNoUmVtb3ZlZD9udWxsOnRoaXMubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07aWYoY3VycmVudE1hdGNoUmVtb3ZlZCl7Zm9yKGk9Y3VycmVudE1hdGNoSW5kZXgsaUxlbj10aGlzLm1hdGNoZXMubGVuZ3RoO2k8aUxlbjtpKyspe2lmKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSYmIWFycmF5X2NvbnRhaW5zKG1hdGNoZXNUb1JlbW92ZSx0aGlzLm1hdGNoZXNbaV0pKXtuZXdNYXRjaD10aGlzLm1hdGNoZXNbaV07YnJlYWs7fX19JywnZm9yKGk9MCxpTGVuPW1hdGNoZXNUb1JlbW92ZS5sZW5ndGg7aTxpTGVuO2krKyl7YXJyYXlfcmVtb3ZlKHRoaXMubWF0Y2hlcyxtYXRjaGVzVG9SZW1vdmVbaV0pO21hdGNoZXNUb1JlbW92ZVtpXS5yZW1vdmUoKTt9JywnaWYodGhpcy5oYXNWaXNpYmxlTWF0Y2hlcygpKXtpZihuZXdNYXRjaD09PW51bGwpe3NldEN1cnJlbnRNYXRjaEluZGV4KDApO31lbHNle3ZhciBuZXdNYXRjaEluZGV4PTA7Zm9yKGk9MCxpTGVuPXRoaXMubWF0Y2hlcy5sZW5ndGg7aTxpTGVuO2krKyl7aWYobmV3TWF0Y2g9PT10aGlzLm1hdGNoZXNbaV0pe25ld01hdGNoSW5kZXg9aTticmVhazt9fScsJ3NldEN1cnJlbnRNYXRjaEluZGV4KG5ld01hdGNoSW5kZXgpO319ZWxzZXtjdXJyZW50TWF0Y2hJbmRleD1udWxsO2Rpc3BsYXlOb01hdGNoZXMoKTt9fX07ZnVuY3Rpb24gZ2V0UGFnZU9mZnNldFRvcChlbCxjb250YWluZXIpe3ZhciBjdXJyZW50RWw9ZWw7dmFyIHk9MDt3aGlsZShjdXJyZW50RWwmJmN1cnJlbnRFbCE9Y29udGFpbmVyKXt5Kz1jdXJyZW50RWwub2Zmc2V0VG9wO2N1cnJlbnRFbD1jdXJyZW50RWwub2Zmc2V0UGFyZW50O30nLCdyZXR1cm4geTt9JywnZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoZWwpe3ZhciBsb2dDb250YWluZXI9bG9nTWFpbkNvbnRhaW5lcjtpZighJCgid3JhcCIpLmNoZWNrZWQpe3ZhciBsb2dDb250YWluZXJMZWZ0PWxvZ0NvbnRhaW5lci5zY3JvbGxMZWZ0O3ZhciBsb2dDb250YWluZXJSaWdodD1sb2dDb250YWluZXJMZWZ0K2xvZ0NvbnRhaW5lci5vZmZzZXRXaWR0aDt2YXIgZWxMZWZ0PWVsLm9mZnNldExlZnQ7dmFyIGVsUmlnaHQ9ZWxMZWZ0K2VsLm9mZnNldFdpZHRoO2lmKGVsTGVmdDxsb2dDb250YWluZXJMZWZ0fHxlbFJpZ2h0PmxvZ0NvbnRhaW5lclJpZ2h0KXtsb2dDb250YWluZXIuc2Nyb2xsTGVmdD1lbExlZnQtKGxvZ0NvbnRhaW5lci5vZmZzZXRXaWR0aC1lbC5vZmZzZXRXaWR0aCkvMjt9fScsJ3ZhciBsb2dDb250YWluZXJUb3A9bG9nQ29udGFpbmVyLnNjcm9sbFRvcDt2YXIgbG9nQ29udGFpbmVyQm90dG9tPWxvZ0NvbnRhaW5lclRvcCtsb2dDb250YWluZXIub2Zmc2V0SGVpZ2h0O3ZhciBlbFRvcD1nZXRQYWdlT2Zmc2V0VG9wKGVsKS1nZXRUb29sQmFyc0hlaWdodCgpO3ZhciBlbEJvdHRvbT1lbFRvcCtlbC5vZmZzZXRIZWlnaHQ7aWYoZWxUb3A8bG9nQ29udGFpbmVyVG9wfHxlbEJvdHRvbT5sb2dDb250YWluZXJCb3R0b20pe2xvZ0NvbnRhaW5lci5zY3JvbGxUb3A9ZWxUb3AtKGxvZ0NvbnRhaW5lci5vZmZzZXRIZWlnaHQtZWwub2Zmc2V0SGVpZ2h0KS8yO319JywnZnVuY3Rpb24gTWF0Y2gobG9nRW50cnlMZXZlbCxzcGFuSW5NYWluRGl2LHNwYW5JblVud3JhcHBlZFByZSxzcGFuSW5XcmFwcGVkRGl2KXt0aGlzLmxvZ0VudHJ5TGV2ZWw9bG9nRW50cnlMZXZlbDt0aGlzLnNwYW5Jbk1haW5EaXY9c3BhbkluTWFpbkRpdjtpZihpc0llKXt0aGlzLnNwYW5JblVud3JhcHBlZFByZT1zcGFuSW5VbndyYXBwZWRQcmU7dGhpcy5zcGFuSW5XcmFwcGVkRGl2PXNwYW5JbldyYXBwZWREaXY7fScsJ3RoaXMubWFpblNwYW49aXNJZT9zcGFuSW5VbndyYXBwZWRQcmU6c3BhbkluTWFpbkRpdjt9JywnTWF0Y2gucHJvdG90eXBlPXtlcXVhbHM6ZnVuY3Rpb24obWF0Y2gpe3JldHVybiB0aGlzLm1haW5TcGFuPT09bWF0Y2gubWFpblNwYW47fSxzZXRDdXJyZW50OmZ1bmN0aW9uKCl7aWYoaXNJZSl7YWRkQ2xhc3ModGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsImN1cnJlbnRtYXRjaCIpO2FkZENsYXNzKHRoaXMuc3BhbkluV3JhcHBlZERpdiwiY3VycmVudG1hdGNoIik7dmFyIGVsZW1lbnRUb1Njcm9sbD0kKCJ3cmFwIikuY2hlY2tlZD90aGlzLnNwYW5JbldyYXBwZWREaXY6dGhpcy5zcGFuSW5VbndyYXBwZWRQcmU7c2Nyb2xsSW50b1ZpZXcoZWxlbWVudFRvU2Nyb2xsKTt9ZWxzZXthZGRDbGFzcyh0aGlzLnNwYW5Jbk1haW5EaXYsImN1cnJlbnRtYXRjaCIpO3Njcm9sbEludG9WaWV3KHRoaXMuc3BhbkluTWFpbkRpdik7fX0sYmVsb25nc1RvOmZ1bmN0aW9uKGxvZ0VudHJ5KXtpZihpc0llKXtyZXR1cm4gaXNEZXNjZW5kYW50KHRoaXMuc3BhbkluVW53cmFwcGVkUHJlLGxvZ0VudHJ5LnVud3JhcHBlZFByZSk7fWVsc2V7cmV0dXJuIGlzRGVzY2VuZGFudCh0aGlzLnNwYW5Jbk1haW5EaXYsbG9nRW50cnkubWFpbkRpdik7fX0sc2V0Tm90Q3VycmVudDpmdW5jdGlvbigpe2lmKGlzSWUpe3JlbW92ZUNsYXNzKHRoaXMuc3BhbkluVW53cmFwcGVkUHJlLCJjdXJyZW50bWF0Y2giKTtyZW1vdmVDbGFzcyh0aGlzLnNwYW5JbldyYXBwZWREaXYsImN1cnJlbnRtYXRjaCIpO31lbHNle3JlbW92ZUNsYXNzKHRoaXMuc3BhbkluTWFpbkRpdiwiY3VycmVudG1hdGNoIik7fX0saXNPcnBoYW46ZnVuY3Rpb24oKXtyZXR1cm4gaXNPcnBoYW4odGhpcy5tYWluU3Bhbik7fSxpc1Zpc2libGU6ZnVuY3Rpb24oKXtyZXR1cm4gZ2V0Q2hlY2tCb3godGhpcy5sb2dFbnRyeUxldmVsKS5jaGVja2VkO30scmVtb3ZlOmZ1bmN0aW9uKCl7aWYoaXNJZSl7dGhpcy5zcGFuSW5VbndyYXBwZWRQcmU9bnVsbDt0aGlzLnNwYW5JbldyYXBwZWREaXY9bnVsbDt9ZWxzZXt0aGlzLnNwYW5Jbk1haW5EaXY9bnVsbDt9fX07dmFyIGN1cnJlbnRTZWFyY2g9bnVsbDt2YXIgY3VycmVudE1hdGNoSW5kZXg9bnVsbDtmdW5jdGlvbiBkb1NlYXJjaCgpe3ZhciBzZWFyY2hCb3g9JCgic2VhcmNoQm94Iik7dmFyIHNlYXJjaFRlcm09c2VhcmNoQm94LnZhbHVlO3ZhciBpc1JlZ2V4PSQoInNlYXJjaFJlZ2V4IikuY2hlY2tlZDt2YXIgaXNDYXNlU2Vuc2l0aXZlPSQoInNlYXJjaENhc2VTZW5zaXRpdmUiKS5jaGVja2VkO3ZhciBpO2lmKHNlYXJjaFRlcm09PT0iIil7JCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZD10cnVlOyQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXk9Im5vbmUiO3JlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksInNlYXJjaGluZyIpO3JlbW92ZUNsYXNzKHNlYXJjaEJveCwiaGFzbWF0Y2hlcyIpO3JlbW92ZUNsYXNzKHNlYXJjaEJveCwibm9tYXRjaGVzIik7Zm9yKGk9MDtpPGxvZ0VudHJpZXMubGVuZ3RoO2krKyl7bG9nRW50cmllc1tpXS5jbGVhclNlYXJjaCgpO2xvZ0VudHJpZXNbaV0uc2V0Q29udGVudChsb2dFbnRyaWVzW2ldLmZvcm1hdHRlZE1lc3NhZ2UsbG9nRW50cmllc1tpXS5mb3JtYXR0ZWRNZXNzYWdlKTt9JywnY3VycmVudFNlYXJjaD1udWxsO3NldExvZ0NvbnRhaW5lckhlaWdodCgpO31lbHNleyQoInNlYXJjaFJlc2V0IikuZGlzYWJsZWQ9ZmFsc2U7JCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheT0iYmxvY2siO3ZhciBzZWFyY2hSZWdleDt2YXIgcmVnZXhWYWxpZDtpZihpc1JlZ2V4KXt0cnl7c2VhcmNoUmVnZXg9aXNDYXNlU2Vuc2l0aXZlP25ldyBSZWdFeHAoc2VhcmNoVGVybSwiZyIpOm5ldyBSZWdFeHAoc2VhcmNoVGVybSwiZ2kiKTtyZWdleFZhbGlkPXRydWU7cmVwbGFjZUNsYXNzKHNlYXJjaEJveCwidmFsaWRyZWdleCIsImludmFsaWRyZWdleCIpO3NlYXJjaEJveC50aXRsZT0iVmFsaWQgcmVnZXgiO31jYXRjaChleCl7cmVnZXhWYWxpZD1mYWxzZTtyZXBsYWNlQ2xhc3Moc2VhcmNoQm94LCJpbnZhbGlkcmVnZXgiLCJ2YWxpZHJlZ2V4Iik7c2VhcmNoQm94LnRpdGxlPSJJbnZhbGlkIHJlZ2V4OiAiKyhleC5tZXNzYWdlP2V4Lm1lc3NhZ2U6KGV4LmRlc2NyaXB0aW9uP2V4LmRlc2NyaXB0aW9uOiJ1bmtub3duIGVycm9yIikpO3JldHVybjt9fWVsc2V7c2VhcmNoQm94LnRpdGxlPSIiO3JlbW92ZUNsYXNzKHNlYXJjaEJveCwidmFsaWRyZWdleCIpO3JlbW92ZUNsYXNzKHNlYXJjaEJveCwiaW52YWxpZHJlZ2V4Iik7fScsJ2FkZENsYXNzKGRvY3VtZW50LmJvZHksInNlYXJjaGluZyIpO2N1cnJlbnRTZWFyY2g9bmV3IFNlYXJjaChzZWFyY2hUZXJtLGlzUmVnZXgsc2VhcmNoUmVnZXgsaXNDYXNlU2Vuc2l0aXZlKTtmb3IoaT0wO2k8bG9nRW50cmllcy5sZW5ndGg7aSsrKXtjdXJyZW50U2VhcmNoLmFwcGx5VG8obG9nRW50cmllc1tpXSk7fScsJ3NldExvZ0NvbnRhaW5lckhlaWdodCgpO2lmKGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSl7c2V0Q3VycmVudE1hdGNoSW5kZXgoMCk7ZGlzcGxheU1hdGNoZXMoKTt9ZWxzZXtkaXNwbGF5Tm9NYXRjaGVzKCk7fX19JywnZnVuY3Rpb24gdXBkYXRlU2VhcmNoRnJvbUZpbHRlcnMoKXtpZihjdXJyZW50U2VhcmNoKXtpZihjdXJyZW50U2VhcmNoLmhhc01hdGNoZXMoKSl7aWYoY3VycmVudE1hdGNoSW5kZXg9PT1udWxsKXtjdXJyZW50TWF0Y2hJbmRleD0wO30nLCd2YXIgY3VycmVudE1hdGNoPWN1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07aWYoY3VycmVudE1hdGNoLmlzVmlzaWJsZSgpKXtkaXNwbGF5TWF0Y2hlcygpO3NldEN1cnJlbnRNYXRjaEluZGV4KGN1cnJlbnRNYXRjaEluZGV4KTt9ZWxzZXtjdXJyZW50TWF0Y2guc2V0Tm90Q3VycmVudCgpO3ZhciBuZXh0VmlzaWJsZU1hdGNoSW5kZXg9Y3VycmVudFNlYXJjaC5nZXROZXh0VmlzaWJsZU1hdGNoSW5kZXgoKTtpZihuZXh0VmlzaWJsZU1hdGNoSW5kZXg+LTEpe3NldEN1cnJlbnRNYXRjaEluZGV4KG5leHRWaXNpYmxlTWF0Y2hJbmRleCk7ZGlzcGxheU1hdGNoZXMoKTt9ZWxzZXtkaXNwbGF5Tm9NYXRjaGVzKCk7fX19ZWxzZXtkaXNwbGF5Tm9NYXRjaGVzKCk7fX19JywnZnVuY3Rpb24gcmVmcmVzaEN1cnJlbnRNYXRjaCgpe2lmKGN1cnJlbnRTZWFyY2gmJmN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSl7c2V0Q3VycmVudE1hdGNoSW5kZXgoY3VycmVudE1hdGNoSW5kZXgpO319JywnZnVuY3Rpb24gZGlzcGxheU1hdGNoZXMoKXtyZXBsYWNlQ2xhc3MoJCgic2VhcmNoQm94IiksImhhc21hdGNoZXMiLCJub21hdGNoZXMiKTskKCJzZWFyY2hCb3giKS50aXRsZT0iIitjdXJyZW50U2VhcmNoLm1hdGNoZXMubGVuZ3RoKyIgbWF0Y2hlcyBmb3VuZCI7JCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheT0iYmxvY2siO3NldExvZ0NvbnRhaW5lckhlaWdodCgpO30nLCdmdW5jdGlvbiBkaXNwbGF5Tm9NYXRjaGVzKCl7cmVwbGFjZUNsYXNzKCQoInNlYXJjaEJveCIpLCJub21hdGNoZXMiLCJoYXNtYXRjaGVzIik7JCgic2VhcmNoQm94IikudGl0bGU9Ik5vIG1hdGNoZXMgZm91bmQiOyQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXk9Im5vbmUiO3NldExvZ0NvbnRhaW5lckhlaWdodCgpO30nLCdmdW5jdGlvbiB0b2dnbGVTZWFyY2hFbmFibGVkKGVuYWJsZSl7ZW5hYmxlPSh0eXBlb2YgZW5hYmxlPT0idW5kZWZpbmVkIik/ISQoInNlYXJjaERpc2FibGUiKS5jaGVja2VkOmVuYWJsZTskKCJzZWFyY2hCb3giKS5kaXNhYmxlZD0hZW5hYmxlOyQoInNlYXJjaFJlc2V0IikuZGlzYWJsZWQ9IWVuYWJsZTskKCJzZWFyY2hSZWdleCIpLmRpc2FibGVkPSFlbmFibGU7JCgic2VhcmNoTmV4dCIpLmRpc2FibGVkPSFlbmFibGU7JCgic2VhcmNoUHJldmlvdXMiKS5kaXNhYmxlZD0hZW5hYmxlOyQoInNlYXJjaENhc2VTZW5zaXRpdmUiKS5kaXNhYmxlZD0hZW5hYmxlOyQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXk9KGVuYWJsZSYmKCQoInNlYXJjaEJveCIpLnZhbHVlIT09IiIpJiZjdXJyZW50U2VhcmNoJiZjdXJyZW50U2VhcmNoLmhhc1Zpc2libGVNYXRjaGVzKCkpPyJibG9jayI6Im5vbmUiO2lmKGVuYWJsZSl7cmVtb3ZlQ2xhc3MoJCgic2VhcmNoIiksImdyZXllZG91dCIpO2FkZENsYXNzKGRvY3VtZW50LmJvZHksInNlYXJjaGluZyIpO2lmKCQoInNlYXJjaEhpZ2hsaWdodCIpLmNoZWNrZWQpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGhpZ2hsaWdodCIpO31lbHNle3JlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGhpZ2hsaWdodCIpO30nLCdpZigkKCJzZWFyY2hGaWx0ZXIiKS5jaGVja2VkKXthZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hmaWx0ZXIiKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hmaWx0ZXIiKTt9JywnJCgic2VhcmNoRGlzYWJsZSIpLmNoZWNrZWQ9IWVuYWJsZTt9ZWxzZXthZGRDbGFzcygkKCJzZWFyY2giKSwiZ3JleWVkb3V0Iik7cmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwic2VhcmNoaW5nIik7cmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwic2VhcmNoaGlnaGxpZ2h0Iik7cmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwic2VhcmNoZmlsdGVyIik7fScsJ3NldExvZ0NvbnRhaW5lckhlaWdodCgpO30nLCdmdW5jdGlvbiB0b2dnbGVTZWFyY2hGaWx0ZXIoKXt2YXIgZW5hYmxlPSQoInNlYXJjaEZpbHRlciIpLmNoZWNrZWQ7aWYoZW5hYmxlKXthZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hmaWx0ZXIiKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hmaWx0ZXIiKTt9JywncmVmcmVzaEN1cnJlbnRNYXRjaCgpO30nLCdmdW5jdGlvbiB0b2dnbGVTZWFyY2hIaWdobGlnaHQoKXt2YXIgZW5hYmxlPSQoInNlYXJjaEhpZ2hsaWdodCIpLmNoZWNrZWQ7aWYoZW5hYmxlKXthZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hoaWdobGlnaHQiKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hoaWdobGlnaHQiKTt9fScsJ2Z1bmN0aW9uIGNsZWFyU2VhcmNoKCl7JCgic2VhcmNoQm94IikudmFsdWU9IiI7ZG9TZWFyY2goKTt9JywnZnVuY3Rpb24gc2VhcmNoTmV4dCgpe2lmKGN1cnJlbnRTZWFyY2ghPT1udWxsJiZjdXJyZW50TWF0Y2hJbmRleCE9PW51bGwpe2N1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF0uc2V0Tm90Q3VycmVudCgpO3ZhciBuZXh0TWF0Y2hJbmRleD1jdXJyZW50U2VhcmNoLmdldE5leHRWaXNpYmxlTWF0Y2hJbmRleCgpO2lmKG5leHRNYXRjaEluZGV4PmN1cnJlbnRNYXRjaEluZGV4fHxjb25maXJtKCJSZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHBhZ2UuIFN0YXJ0IGZyb20gdGhlIHRvcD8iKSl7c2V0Q3VycmVudE1hdGNoSW5kZXgobmV4dE1hdGNoSW5kZXgpO319fScsJ2Z1bmN0aW9uIHNlYXJjaFByZXZpb3VzKCl7aWYoY3VycmVudFNlYXJjaCE9PW51bGwmJmN1cnJlbnRNYXRjaEluZGV4IT09bnVsbCl7Y3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXROb3RDdXJyZW50KCk7dmFyIHByZXZpb3VzTWF0Y2hJbmRleD1jdXJyZW50U2VhcmNoLmdldFByZXZpb3VzVmlzaWJsZU1hdGNoSW5kZXgoKTtpZihwcmV2aW91c01hdGNoSW5kZXg8Y3VycmVudE1hdGNoSW5kZXh8fGNvbmZpcm0oIlJlYWNoZWQgdGhlIHN0YXJ0IG9mIHRoZSBwYWdlLiBDb250aW51ZSBmcm9tIHRoZSBib3R0b20/Iikpe3NldEN1cnJlbnRNYXRjaEluZGV4KHByZXZpb3VzTWF0Y2hJbmRleCk7fX19JywnZnVuY3Rpb24gc2V0Q3VycmVudE1hdGNoSW5kZXgoaW5kZXgpe2N1cnJlbnRNYXRjaEluZGV4PWluZGV4O2N1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF0uc2V0Q3VycmVudCgpO30nLCdmdW5jdGlvbiBhZGRDbGFzcyhlbCxjc3NDbGFzcyl7aWYoIWhhc0NsYXNzKGVsLGNzc0NsYXNzKSl7aWYoZWwuY2xhc3NOYW1lKXtlbC5jbGFzc05hbWUrPSIgIitjc3NDbGFzczt9ZWxzZXtlbC5jbGFzc05hbWU9Y3NzQ2xhc3M7fX19JywnZnVuY3Rpb24gaGFzQ2xhc3MoZWwsY3NzQ2xhc3Mpe2lmKGVsLmNsYXNzTmFtZSl7dmFyIGNsYXNzTmFtZXM9ZWwuY2xhc3NOYW1lLnNwbGl0KCIgIik7cmV0dXJuIGFycmF5X2NvbnRhaW5zKGNsYXNzTmFtZXMsY3NzQ2xhc3MpO30nLCdyZXR1cm4gZmFsc2U7fScsJ2Z1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLGNzc0NsYXNzKXtpZihoYXNDbGFzcyhlbCxjc3NDbGFzcykpe3ZhciBleGlzdGluZ0NsYXNzZXM9ZWwuY2xhc3NOYW1lLnNwbGl0KCIgIik7dmFyIG5ld0NsYXNzZXM9W107Zm9yKHZhciBpPTAsbGVuPWV4aXN0aW5nQ2xhc3Nlcy5sZW5ndGg7aTxsZW47aSsrKXtpZihleGlzdGluZ0NsYXNzZXNbaV0hPWNzc0NsYXNzKXtuZXdDbGFzc2VzW25ld0NsYXNzZXMubGVuZ3RoXT1leGlzdGluZ0NsYXNzZXNbaV07fX0nLCdlbC5jbGFzc05hbWU9bmV3Q2xhc3Nlcy5qb2luKCIgIik7fX0nLCdmdW5jdGlvbiByZXBsYWNlQ2xhc3MoZWwsbmV3Q3NzQ2xhc3Msb2xkQ3NzQ2xhc3Mpe3JlbW92ZUNsYXNzKGVsLG9sZENzc0NsYXNzKTthZGRDbGFzcyhlbCxuZXdDc3NDbGFzcyk7fScsJ2Z1bmN0aW9uIGdldEVsZW1lbnRzQnlDbGFzcyhlbCxjc3NDbGFzcyx0YWdOYW1lKXt2YXIgZWxlbWVudHM9ZWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnTmFtZSk7dmFyIG1hdGNoZXM9W107Zm9yKHZhciBpPTAsbGVuPWVsZW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe2lmKGhhc0NsYXNzKGVsZW1lbnRzW2ldLGNzc0NsYXNzKSl7bWF0Y2hlcy5wdXNoKGVsZW1lbnRzW2ldKTt9fScsJ3JldHVybiBtYXRjaGVzO30nLCdmdW5jdGlvbiAkKGlkKXtyZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO30nLCdmdW5jdGlvbiBpc0Rlc2NlbmRhbnQobm9kZSxhbmNlc3Rvck5vZGUpe3doaWxlKG5vZGUhPW51bGwpe2lmKG5vZGU9PT1hbmNlc3Rvck5vZGUpe3JldHVybiB0cnVlO30nLCdub2RlPW5vZGUucGFyZW50Tm9kZTt9JywncmV0dXJuIGZhbHNlO30nLCdmdW5jdGlvbiBpc09ycGhhbihub2RlKXt2YXIgY3VycmVudE5vZGU9bm9kZTt3aGlsZShjdXJyZW50Tm9kZSl7aWYoY3VycmVudE5vZGU9PWRvY3VtZW50LmJvZHkpe3JldHVybiBmYWxzZTt9JywnY3VycmVudE5vZGU9Y3VycmVudE5vZGUucGFyZW50Tm9kZTt9JywncmV0dXJuIHRydWU7fScsJ2Z1bmN0aW9uIGVzY2FwZUh0bWwoc3RyKXtyZXR1cm4gc3RyLnJlcGxhY2UoLyYvZywiJmFtcDsiKS5yZXBsYWNlKC9bPF0vZywiJmx0OyIpLnJlcGxhY2UoLz4vZywiJmd0OyIpO30nLCdmdW5jdGlvbiBnZXRXaW5kb3dXaWR0aCgpe2lmKHdpbmRvdy5pbm5lcldpZHRoKXtyZXR1cm4gd2luZG93LmlubmVyV2lkdGg7fWVsc2UgaWYoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50JiZkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpe3JldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7fWVsc2UgaWYoZG9jdW1lbnQuYm9keSl7cmV0dXJuIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7fScsJ3JldHVybiAwO30nLCdmdW5jdGlvbiBnZXRXaW5kb3dIZWlnaHQoKXtpZih3aW5kb3cuaW5uZXJIZWlnaHQpe3JldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7fWVsc2UgaWYoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50JiZkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KXtyZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDt9ZWxzZSBpZihkb2N1bWVudC5ib2R5KXtyZXR1cm4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7fScsJ3JldHVybiAwO30nLCdmdW5jdGlvbiBnZXRUb29sQmFyc0hlaWdodCgpe3JldHVybiAkKCJzd2l0Y2hlcyIpLm9mZnNldEhlaWdodDt9JywnZnVuY3Rpb24gZ2V0Q2hyb21lSGVpZ2h0KCl7dmFyIGhlaWdodD1nZXRUb29sQmFyc0hlaWdodCgpO2lmKHNob3dDb21tYW5kTGluZSl7aGVpZ2h0Kz0kKCJjb21tYW5kTGluZSIpLm9mZnNldEhlaWdodDt9JywncmV0dXJuIGhlaWdodDt9JywnZnVuY3Rpb24gc2V0TG9nQ29udGFpbmVySGVpZ2h0KCl7aWYobG9nTWFpbkNvbnRhaW5lcil7dmFyIHdpbmRvd0hlaWdodD1nZXRXaW5kb3dIZWlnaHQoKTskKCJib2R5Iikuc3R5bGUuaGVpZ2h0PWdldFdpbmRvd0hlaWdodCgpKyJweCI7bG9nTWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ9IiIrJywnTWF0aC5tYXgoMCx3aW5kb3dIZWlnaHQtZ2V0Q2hyb21lSGVpZ2h0KCkpKyJweCI7fX0nLCdmdW5jdGlvbiBzZXRDb21tYW5kSW5wdXRXaWR0aCgpe2lmKHNob3dDb21tYW5kTGluZSl7JCgiY29tbWFuZCIpLnN0eWxlLndpZHRoPSIiK01hdGgubWF4KDAsJCgiY29tbWFuZExpbmVDb250YWluZXIiKS5vZmZzZXRXaWR0aC0nLCcoJCgiZXZhbHVhdGVCdXR0b24iKS5vZmZzZXRXaWR0aCsxMykpKyJweCI7fX0nLCd3aW5kb3cub25yZXNpemU9ZnVuY3Rpb24oKXtzZXRDb21tYW5kSW5wdXRXaWR0aCgpO3NldExvZ0NvbnRhaW5lckhlaWdodCgpO307aWYoIUFycmF5LnByb3RvdHlwZS5wdXNoKXtBcnJheS5wcm90b3R5cGUucHVzaD1mdW5jdGlvbigpe2Zvcih2YXIgaT0wLGxlbj1hcmd1bWVudHMubGVuZ3RoO2k8bGVuO2krKyl7dGhpc1t0aGlzLmxlbmd0aF09YXJndW1lbnRzW2ldO30nLCdyZXR1cm4gdGhpcy5sZW5ndGg7fTt9JywnaWYoIUFycmF5LnByb3RvdHlwZS5wb3Ape0FycmF5LnByb3RvdHlwZS5wb3A9ZnVuY3Rpb24oKXtpZih0aGlzLmxlbmd0aD4wKXt2YXIgdmFsPXRoaXNbdGhpcy5sZW5ndGgtMV07dGhpcy5sZW5ndGg9dGhpcy5sZW5ndGgtMTtyZXR1cm4gdmFsO319O30nLCdpZighQXJyYXkucHJvdG90eXBlLnNoaWZ0KXtBcnJheS5wcm90b3R5cGUuc2hpZnQ9ZnVuY3Rpb24oKXtpZih0aGlzLmxlbmd0aD4wKXt2YXIgZmlyc3RJdGVtPXRoaXNbMF07Zm9yKHZhciBpPTAsbGVuPXRoaXMubGVuZ3RoLTE7aTxsZW47aSsrKXt0aGlzW2ldPXRoaXNbaSsxXTt9JywndGhpcy5sZW5ndGg9dGhpcy5sZW5ndGgtMTtyZXR1cm4gZmlyc3RJdGVtO319O30nLCdpZighQXJyYXkucHJvdG90eXBlLnNwbGljZSl7QXJyYXkucHJvdG90eXBlLnNwbGljZT1mdW5jdGlvbihzdGFydEluZGV4LGRlbGV0ZUNvdW50KXt2YXIgaXRlbXNBZnRlckRlbGV0ZWQ9dGhpcy5zbGljZShzdGFydEluZGV4K2RlbGV0ZUNvdW50KTt2YXIgaXRlbXNEZWxldGVkPXRoaXMuc2xpY2Uoc3RhcnRJbmRleCxzdGFydEluZGV4K2RlbGV0ZUNvdW50KTt0aGlzLmxlbmd0aD1zdGFydEluZGV4O3ZhciBhcmd1bWVudHNBcnJheT1bXTtmb3IodmFyIGk9MCxsZW49YXJndW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe2FyZ3VtZW50c0FycmF5W2ldPWFyZ3VtZW50c1tpXTt9JywndmFyIGl0ZW1zVG9BcHBlbmQ9KGFyZ3VtZW50c0FycmF5Lmxlbmd0aD4yKT9pdGVtc0FmdGVyRGVsZXRlZD1hcmd1bWVudHNBcnJheS5zbGljZSgyKS5jb25jYXQoaXRlbXNBZnRlckRlbGV0ZWQpOml0ZW1zQWZ0ZXJEZWxldGVkO2ZvcihpPTAsbGVuPWl0ZW1zVG9BcHBlbmQubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5wdXNoKGl0ZW1zVG9BcHBlbmRbaV0pO30nLCdyZXR1cm4gaXRlbXNEZWxldGVkO307fScsJ2Z1bmN0aW9uIGFycmF5X3JlbW92ZShhcnIsdmFsKXt2YXIgaW5kZXg9LTE7Zm9yKHZhciBpPTAsbGVuPWFyci5sZW5ndGg7aTxsZW47aSsrKXtpZihhcnJbaV09PT12YWwpe2luZGV4PWk7YnJlYWs7fX0nLCdpZihpbmRleD49MCl7YXJyLnNwbGljZShpbmRleCwxKTtyZXR1cm4gaW5kZXg7fWVsc2V7cmV0dXJuIGZhbHNlO319JywnZnVuY3Rpb24gYXJyYXlfcmVtb3ZlRnJvbVN0YXJ0KGFycmF5LG51bWJlclRvUmVtb3ZlKXtpZihBcnJheS5wcm90b3R5cGUuc3BsaWNlKXthcnJheS5zcGxpY2UoMCxudW1iZXJUb1JlbW92ZSk7fWVsc2V7Zm9yKHZhciBpPW51bWJlclRvUmVtb3ZlLGxlbj1hcnJheS5sZW5ndGg7aTxsZW47aSsrKXthcnJheVtpLW51bWJlclRvUmVtb3ZlXT1hcnJheVtpXTt9JywnYXJyYXkubGVuZ3RoPWFycmF5Lmxlbmd0aC1udW1iZXJUb1JlbW92ZTt9JywncmV0dXJuIGFycmF5O30nLCdmdW5jdGlvbiBhcnJheV9jb250YWlucyhhcnIsdmFsKXtmb3IodmFyIGk9MCxsZW49YXJyLmxlbmd0aDtpPGxlbjtpKyspe2lmKGFycltpXT09dmFsKXtyZXR1cm4gdHJ1ZTt9fScsJ3JldHVybiBmYWxzZTt9JywnZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGV4KXtpZihleC5tZXNzYWdlKXtyZXR1cm4gZXgubWVzc2FnZTt9ZWxzZSBpZihleC5kZXNjcmlwdGlvbil7cmV0dXJuIGV4LmRlc2NyaXB0aW9uO30nLCdyZXR1cm4iIitleDt9JywnZnVuY3Rpb24gbW92ZUNhcmV0VG9FbmQoaW5wdXQpe2lmKGlucHV0LnNldFNlbGVjdGlvblJhbmdlKXtpbnB1dC5mb2N1cygpO3ZhciBsZW5ndGg9aW5wdXQudmFsdWUubGVuZ3RoO2lucHV0LnNldFNlbGVjdGlvblJhbmdlKGxlbmd0aCxsZW5ndGgpO31lbHNlIGlmKGlucHV0LmNyZWF0ZVRleHRSYW5nZSl7dmFyIHJhbmdlPWlucHV0LmNyZWF0ZVRleHRSYW5nZSgpO3JhbmdlLmNvbGxhcHNlKGZhbHNlKTtyYW5nZS5zZWxlY3QoKTt9JywnaW5wdXQuZm9jdXMoKTt9JywnZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGV2dCl7aWYoZXZ0LnN0b3BQcm9wYWdhdGlvbil7ZXZ0LnN0b3BQcm9wYWdhdGlvbigpO31lbHNlIGlmKHR5cGVvZiBldnQuY2FuY2VsQnViYmxlIT0idW5kZWZpbmVkIil7ZXZ0LmNhbmNlbEJ1YmJsZT10cnVlO319JywnZnVuY3Rpb24gZ2V0RXZlbnQoZXZ0KXtyZXR1cm4gZXZ0P2V2dDpldmVudDt9JywnZnVuY3Rpb24gZ2V0VGFyZ2V0KGV2dCl7cmV0dXJuIGV2dC50YXJnZXQ/ZXZ0LnRhcmdldDpldnQuc3JjRWxlbWVudDt9JywnZnVuY3Rpb24gZ2V0UmVsYXRlZFRhcmdldChldnQpe2lmKGV2dC5yZWxhdGVkVGFyZ2V0KXtyZXR1cm4gZXZ0LnJlbGF0ZWRUYXJnZXQ7fWVsc2UgaWYoZXZ0LnNyY0VsZW1lbnQpe3N3aXRjaChldnQudHlwZSl7Y2FzZSJtb3VzZW92ZXIiOnJldHVybiBldnQuZnJvbUVsZW1lbnQ7Y2FzZSJtb3VzZW91dCI6cmV0dXJuIGV2dC50b0VsZW1lbnQ7ZGVmYXVsdDpyZXR1cm4gZXZ0LnNyY0VsZW1lbnQ7fX19JywnZnVuY3Rpb24gY2FuY2VsS2V5RXZlbnQoZXZ0KXtldnQucmV0dXJuVmFsdWU9ZmFsc2U7c3RvcFByb3BhZ2F0aW9uKGV2dCk7fScsJ2Z1bmN0aW9uIGV2YWxDb21tYW5kTGluZSgpe3ZhciBleHByPSQoImNvbW1hbmQiKS52YWx1ZTtldmFsQ29tbWFuZChleHByKTskKCJjb21tYW5kIikudmFsdWU9IiI7fScsJ2Z1bmN0aW9uIGV2YWxMYXN0Q29tbWFuZCgpe2lmKGxhc3RDb21tYW5kIT1udWxsKXtldmFsQ29tbWFuZChsYXN0Q29tbWFuZCk7fX0nLCd2YXIgbGFzdENvbW1hbmQ9bnVsbDt2YXIgY29tbWFuZEhpc3Rvcnk9W107dmFyIGN1cnJlbnRDb21tYW5kSW5kZXg9MDtmdW5jdGlvbiBldmFsQ29tbWFuZChleHByKXtpZihhcHBlbmRlcil7YXBwZW5kZXIuZXZhbENvbW1hbmRBbmRBcHBlbmQoZXhwcik7fWVsc2V7dmFyIHByZWZpeD0iPj4+ICIrZXhwcisiXFxyXFxuIjt0cnl7bG9nKCJJTkZPIixwcmVmaXgrZXZhbChleHByKSk7fWNhdGNoKGV4KXtsb2coIkVSUk9SIixwcmVmaXgrIkVycm9yOiAiK2dldEVycm9yTWVzc2FnZShleCkpO319JywnaWYoZXhwciE9Y29tbWFuZEhpc3RvcnlbY29tbWFuZEhpc3RvcnkubGVuZ3RoLTFdKXtjb21tYW5kSGlzdG9yeS5wdXNoKGV4cHIpO2lmKGFwcGVuZGVyKXthcHBlbmRlci5zdG9yZUNvbW1hbmRIaXN0b3J5KGNvbW1hbmRIaXN0b3J5KTt9fScsJ2N1cnJlbnRDb21tYW5kSW5kZXg9KGV4cHI9PWNvbW1hbmRIaXN0b3J5W2N1cnJlbnRDb21tYW5kSW5kZXhdKT9jdXJyZW50Q29tbWFuZEluZGV4KzE6Y29tbWFuZEhpc3RvcnkubGVuZ3RoO2xhc3RDb21tYW5kPWV4cHI7fScsJy8vXV0+JywnPC9zY3JpcHQ+JywnPHN0eWxlIHR5cGU9InRleHQvY3NzIj4nLCdib2R5e2JhY2tncm91bmQtY29sb3I6d2hpdGU7Y29sb3I6YmxhY2s7cGFkZGluZzowO21hcmdpbjowO2ZvbnQtZmFtaWx5OnRhaG9tYSx2ZXJkYW5hLGFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmO292ZXJmbG93OmhpZGRlbn1kaXYjc3dpdGNoZXNDb250YWluZXIgaW5wdXR7bWFyZ2luLWJvdHRvbTowfWRpdi50b29sYmFye2JvcmRlci10b3A6c29saWQgI2ZmZmZmZiAxcHg7Ym9yZGVyLWJvdHRvbTpzb2xpZCAjYWNhODk5IDFweDtiYWNrZ3JvdW5kLWNvbG9yOiNmMWVmZTc7cGFkZGluZzozcHggNXB4O2ZvbnQtc2l6ZTo2OC43NSV9ZGl2LnRvb2xiYXIsZGl2I3NlYXJjaCBpbnB1dHtmb250LWZhbWlseTp0YWhvbWEsdmVyZGFuYSxhcmlhbCxoZWx2ZXRpY2Esc2Fucy1zZXJpZn1kaXYudG9vbGJhciBpbnB1dC5idXR0b257cGFkZGluZzowIDVweDtmb250LXNpemU6MTAwJX1kaXYudG9vbGJhciBpbnB1dC5oaWRkZW57ZGlzcGxheTpub25lfWRpdiNzd2l0Y2hlcyBpbnB1dCNjbGVhckJ1dHRvbnttYXJnaW4tbGVmdDoyMHB4fWRpdiNsZXZlbHMgbGFiZWx7Zm9udC13ZWlnaHQ6Ym9sZH1kaXYjbGV2ZWxzIGxhYmVsLGRpdiNvcHRpb25zIGxhYmVse21hcmdpbi1yaWdodDo1cHh9ZGl2I2xldmVscyBsYWJlbCN3cmFwTGFiZWx7Zm9udC13ZWlnaHQ6bm9ybWFsfWRpdiNzZWFyY2ggbGFiZWx7bWFyZ2luLXJpZ2h0OjEwcHh9ZGl2I3NlYXJjaCBsYWJlbC5zZWFyY2hib3hsYWJlbHttYXJnaW4tcmlnaHQ6MH1kaXYjc2VhcmNoIGlucHV0e2ZvbnQtc2l6ZToxMDAlfWRpdiNzZWFyY2ggaW5wdXQudmFsaWRyZWdleHtjb2xvcjpncmVlbn1kaXYjc2VhcmNoIGlucHV0LmludmFsaWRyZWdleHtjb2xvcjpyZWR9ZGl2I3NlYXJjaCBpbnB1dC5ub21hdGNoZXN7Y29sb3I6d2hpdGU7YmFja2dyb3VuZC1jb2xvcjojZmY2NjY2fWRpdiNzZWFyY2ggaW5wdXQubm9tYXRjaGVze2NvbG9yOndoaXRlO2JhY2tncm91bmQtY29sb3I6I2ZmNjY2Nn1kaXYjc2VhcmNoTmF2e2Rpc3BsYXk6bm9uZX1kaXYjY29tbWFuZExpbmV7ZGlzcGxheTpub25lfWRpdiNjb21tYW5kTGluZSBpbnB1dCNjb21tYW5ke2ZvbnQtc2l6ZToxMDAlO2ZvbnQtZmFtaWx5OkNvdXJpZXIgTmV3LENvdXJpZXJ9ZGl2I2NvbW1hbmRMaW5lIGlucHV0I2V2YWx1YXRlQnV0dG9ue30qLmdyZXllZG91dHtjb2xvcjpncmF5ICFpbXBvcnRhbnQ7Ym9yZGVyLWNvbG9yOmdyYXkgIWltcG9ydGFudH0qLmdyZXllZG91dCAqLmFsd2F5c2VuYWJsZWR7Y29sb3I6YmxhY2t9Ki51bnNlbGVjdGFibGV7LWtodG1sLXVzZXItc2VsZWN0Om5vbmU7LW1vei11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmV9ZGl2I2xvZ3tmb250LWZhbWlseTpDb3VyaWVyIE5ldyxDb3VyaWVyO2ZvbnQtc2l6ZTo3NSU7d2lkdGg6MTAwJTtvdmVyZmxvdzphdXRvO2NsZWFyOmJvdGg7cG9zaXRpb246cmVsYXRpdmV9ZGl2Lmdyb3Vwe2JvcmRlci1jb2xvcjojY2NjY2NjO2JvcmRlci1zdHlsZTpzb2xpZDtib3JkZXItd2lkdGg6MXB4IDAgMXB4IDFweDtvdmVyZmxvdzp2aXNpYmxlfWRpdi5vbGRJZSBkaXYuZ3JvdXAsZGl2Lm9sZEllIGRpdi5ncm91cCAqLGRpdi5vbGRJZSAqLmxvZ2VudHJ5e2hlaWdodDoxJX1kaXYuZ3JvdXAgZGl2Lmdyb3VwaGVhZGluZyBzcGFuLmV4cGFuZGVye2JvcmRlcjpzb2xpZCBibGFjayAxcHg7Zm9udC1mYW1pbHk6Q291cmllciBOZXcsQ291cmllcjtmb250LXNpemU6MC44MzNlbTtiYWNrZ3JvdW5kLWNvbG9yOiNlZWVlZWU7cG9zaXRpb246cmVsYXRpdmU7dG9wOi0xcHg7Y29sb3I6YmxhY2s7cGFkZGluZzowIDJweDtjdXJzb3I6cG9pbnRlcjtjdXJzb3I6aGFuZDtoZWlnaHQ6MSV9ZGl2Lmdyb3VwIGRpdi5ncm91cGNvbnRlbnR7bWFyZ2luLWxlZnQ6MTBweDtwYWRkaW5nLWJvdHRvbToycHg7b3ZlcmZsb3c6dmlzaWJsZX1kaXYuZ3JvdXAgZGl2LmV4cGFuZGVke2Rpc3BsYXk6YmxvY2t9ZGl2Lmdyb3VwIGRpdi5jb2xsYXBzZWR7ZGlzcGxheTpub25lfSoubG9nZW50cnl7b3ZlcmZsb3c6dmlzaWJsZTtkaXNwbGF5Om5vbmU7d2hpdGUtc3BhY2U6cHJlfXNwYW4ucHJle3doaXRlLXNwYWNlOnByZX1wcmUudW53cmFwcGVke2Rpc3BsYXk6aW5saW5lICFpbXBvcnRhbnR9cHJlLnVud3JhcHBlZCBwcmUucHJlLGRpdi53cmFwcGVkIHByZS5wcmV7ZGlzcGxheTppbmxpbmV9ZGl2LndyYXBwZWQgcHJlLnByZXt3aGl0ZS1zcGFjZTpub3JtYWx9ZGl2LndyYXBwZWR7ZGlzcGxheTpub25lfWJvZHkuc2VhcmNoaW5nICoubG9nZW50cnkgc3Bhbi5jdXJyZW50bWF0Y2h7Y29sb3I6d2hpdGUgIWltcG9ydGFudDtiYWNrZ3JvdW5kLWNvbG9yOmdyZWVuICFpbXBvcnRhbnR9Ym9keS5zZWFyY2hpbmcgZGl2LnNlYXJjaGhpZ2hsaWdodCAqLmxvZ2VudHJ5IHNwYW4uc2VhcmNodGVybXtjb2xvcjpibGFjaztiYWNrZ3JvdW5kLWNvbG9yOnllbGxvd31kaXYud3JhcCAqLmxvZ2VudHJ5e3doaXRlLXNwYWNlOm5vcm1hbCAhaW1wb3J0YW50O2JvcmRlci13aWR0aDowIDAgMXB4IDA7Ym9yZGVyLWNvbG9yOiNkZGRkZGQ7Ym9yZGVyLXN0eWxlOmRvdHRlZH1kaXYud3JhcCAjbG9nX3dyYXBwZWQsI2xvZ191bndyYXBwZWR7ZGlzcGxheTpibG9ja31kaXYud3JhcCAjbG9nX3Vud3JhcHBlZCwjbG9nX3dyYXBwZWR7ZGlzcGxheTpub25lfWRpdi53cmFwICoubG9nZW50cnkgc3Bhbi5wcmV7b3ZlcmZsb3c6dmlzaWJsZTt3aGl0ZS1zcGFjZTpub3JtYWx9ZGl2LndyYXAgKi5sb2dlbnRyeSBwcmUudW53cmFwcGVke2Rpc3BsYXk6bm9uZX1kaXYud3JhcCAqLmxvZ2VudHJ5IHNwYW4ud3JhcHBlZHtkaXNwbGF5OmlubGluZX1kaXYuc2VhcmNoZmlsdGVyICouc2VhcmNobm9ubWF0Y2h7ZGlzcGxheTpub25lICFpbXBvcnRhbnR9ZGl2I2xvZyAqLlRSQUNFLGxhYmVsI2xhYmVsX1RSQUNFe2NvbG9yOiM2NjY2NjZ9ZGl2I2xvZyAqLkRFQlVHLGxhYmVsI2xhYmVsX0RFQlVHe2NvbG9yOmdyZWVufWRpdiNsb2cgKi5JTkZPLGxhYmVsI2xhYmVsX0lORk97Y29sb3I6IzAwMDA5OX1kaXYjbG9nICouV0FSTixsYWJlbCNsYWJlbF9XQVJOe2NvbG9yOiM5OTk5MDB9ZGl2I2xvZyAqLkVSUk9SLGxhYmVsI2xhYmVsX0VSUk9Se2NvbG9yOnJlZH1kaXYjbG9nICouRkFUQUwsbGFiZWwjbGFiZWxfRkFUQUx7Y29sb3I6IzY2MDA2Nn1kaXYuVFJBQ0UjbG9nICouVFJBQ0UsZGl2LkRFQlVHI2xvZyAqLkRFQlVHLGRpdi5JTkZPI2xvZyAqLklORk8sZGl2LldBUk4jbG9nICouV0FSTixkaXYuRVJST1IjbG9nICouRVJST1IsZGl2LkZBVEFMI2xvZyAqLkZBVEFMe2Rpc3BsYXk6YmxvY2t9ZGl2I2xvZyBkaXYuc2VwYXJhdG9ye2JhY2tncm91bmQtY29sb3I6I2NjY2NjYzttYXJnaW46NXB4IDA7bGluZS1oZWlnaHQ6MXB4fScsJzwvc3R5bGU+JywnPC9oZWFkPicsJzxib2R5IGlkPSJib2R5Ij4nLCc8ZGl2IGlkPSJzd2l0Y2hlc0NvbnRhaW5lciI+JywnPGRpdiBpZD0ic3dpdGNoZXMiPicsJzxkaXYgaWQ9ImxldmVscyIgY2xhc3M9InRvb2xiYXIiPicsJ0ZpbHRlcnM6JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX1RSQUNFIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSB0cmFjZSBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfVFJBQ0UiIGlkPSJsYWJlbF9UUkFDRSI+dHJhY2U8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9ERUJVRyIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgZGVidWcgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX0RFQlVHIiBpZD0ibGFiZWxfREVCVUciPmRlYnVnPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfSU5GTyIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgaW5mbyBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfSU5GTyIgaWQ9ImxhYmVsX0lORk8iPmluZm88L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9XQVJOIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSB3YXJuIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9XQVJOIiBpZD0ibGFiZWxfV0FSTiI+d2FybjwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0VSUk9SIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBlcnJvciBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfRVJST1IiIGlkPSJsYWJlbF9FUlJPUiI+ZXJyb3I8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9GQVRBTCIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgZmF0YWwgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX0ZBVEFMIiBpZD0ibGFiZWxfRkFUQUwiPmZhdGFsPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfQUxMIiBvbmNsaWNrPSJ0b2dnbGVBbGxMZXZlbHMoKTsgYXBwbHlGaWx0ZXJzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgYWxsIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9BTEwiIGlkPSJsYWJlbF9BTEwiPmFsbDwvbGFiZWw+JywnPC9kaXY+JywnPGRpdiBpZD0ic2VhcmNoIiBjbGFzcz0idG9vbGJhciI+JywnPGxhYmVsIGZvcj0ic2VhcmNoQm94IiBjbGFzcz0ic2VhcmNoYm94bGFiZWwiPlNlYXJjaDo8L2xhYmVsPiA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9InNlYXJjaEJveCIgb25jbGljaz0idG9nZ2xlU2VhcmNoRW5hYmxlZCh0cnVlKSIgb25rZXl1cD0ic2NoZWR1bGVTZWFyY2goKSIgc2l6ZT0iMjAiIC8+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9InNlYXJjaFJlc2V0IiBkaXNhYmxlZD0iZGlzYWJsZWQiIHZhbHVlPSJSZXNldCIgb25jbGljaz0iY2xlYXJTZWFyY2goKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IlJlc2V0IHRoZSBzZWFyY2giIC8+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoUmVnZXgiIG9uY2xpY2s9ImRvU2VhcmNoKCkiIHRpdGxlPSJJZiBjaGVja2VkLCBzZWFyY2ggaXMgdHJlYXRlZCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiIgLz48bGFiZWwgZm9yPSJzZWFyY2hSZWdleCI+UmVnZXg8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNlYXJjaENhc2VTZW5zaXRpdmUiIG9uY2xpY2s9ImRvU2VhcmNoKCkiIHRpdGxlPSJJZiBjaGVja2VkLCBzZWFyY2ggaXMgY2FzZSBzZW5zaXRpdmUiIC8+PGxhYmVsIGZvcj0ic2VhcmNoQ2FzZVNlbnNpdGl2ZSI+TWF0Y2ggY2FzZTwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoRGlzYWJsZSIgb25jbGljaz0idG9nZ2xlU2VhcmNoRW5hYmxlZCgpIiB0aXRsZT0iRW5hYmxlL2Rpc2FibGUgc2VhcmNoIiAvPjxsYWJlbCBmb3I9InNlYXJjaERpc2FibGUiIGNsYXNzPSJhbHdheXNlbmFibGVkIj5EaXNhYmxlPC9sYWJlbD4nLCc8ZGl2IGlkPSJzZWFyY2hOYXYiPicsJzxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJzZWFyY2hOZXh0IiBkaXNhYmxlZD0iZGlzYWJsZWQiIHZhbHVlPSJOZXh0IiBvbmNsaWNrPSJzZWFyY2hOZXh0KCkiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJHbyB0byB0aGUgbmV4dCBtYXRjaGluZyBsb2cgZW50cnkiIC8+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9InNlYXJjaFByZXZpb3VzIiBkaXNhYmxlZD0iZGlzYWJsZWQiIHZhbHVlPSJQcmV2aW91cyIgb25jbGljaz0ic2VhcmNoUHJldmlvdXMoKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkdvIHRvIHRoZSBwcmV2aW91cyBtYXRjaGluZyBsb2cgZW50cnkiIC8+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoRmlsdGVyIiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hGaWx0ZXIoKSIgdGl0bGU9IklmIGNoZWNrZWQsIG5vbi1tYXRjaGluZyBsb2cgZW50cmllcyBhcmUgZmlsdGVyZWQgb3V0IiAvPjxsYWJlbCBmb3I9InNlYXJjaEZpbHRlciI+RmlsdGVyPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hIaWdobGlnaHQiIG9uY2xpY2s9InRvZ2dsZVNlYXJjaEhpZ2hsaWdodCgpIiB0aXRsZT0iSGlnaGxpZ2h0IG1hdGNoZWQgc2VhcmNoIHRlcm1zIiAvPjxsYWJlbCBmb3I9InNlYXJjaEhpZ2hsaWdodCIgY2xhc3M9ImFsd2F5c2VuYWJsZWQiPkhpZ2hsaWdodCBhbGw8L2xhYmVsPicsJzwvZGl2PicsJzwvZGl2PicsJzxkaXYgaWQ9Im9wdGlvbnMiIGNsYXNzPSJ0b29sYmFyIj4nLCdPcHRpb25zOicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImVuYWJsZUxvZ2dpbmciIG9uY2xpY2s9InRvZ2dsZUxvZ2dpbmdFbmFibGVkKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJFbmFibGUvZGlzYWJsZSBsb2dnaW5nIiAvPjxsYWJlbCBmb3I9ImVuYWJsZUxvZ2dpbmciIGlkPSJlbmFibGVMb2dnaW5nTGFiZWwiPkxvZzwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0id3JhcCIgb25jbGljaz0idG9nZ2xlV3JhcCgpIiB0aXRsZT0iRW5hYmxlIC8gZGlzYWJsZSB3b3JkIHdyYXAiIC8+PGxhYmVsIGZvcj0id3JhcCIgaWQ9IndyYXBMYWJlbCI+V3JhcDwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ibmV3ZXN0QXRUb3AiIG9uY2xpY2s9InRvZ2dsZU5ld2VzdEF0VG9wKCkiIHRpdGxlPSJJZiBjaGVja2VkLCBjYXVzZXMgbmV3ZXN0IG1lc3NhZ2VzIHRvIGFwcGVhciBhdCB0aGUgdG9wIiAvPjxsYWJlbCBmb3I9Im5ld2VzdEF0VG9wIiBpZD0ibmV3ZXN0QXRUb3BMYWJlbCI+TmV3ZXN0IGF0IHRoZSB0b3A8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNjcm9sbFRvTGF0ZXN0IiBvbmNsaWNrPSJ0b2dnbGVTY3JvbGxUb0xhdGVzdCgpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iSWYgY2hlY2tlZCwgd2luZG93IGF1dG9tYXRpY2FsbHkgc2Nyb2xscyB0byBhIG5ldyBtZXNzYWdlIHdoZW4gaXQgaXMgYWRkZWQiIC8+PGxhYmVsIGZvcj0ic2Nyb2xsVG9MYXRlc3QiIGlkPSJzY3JvbGxUb0xhdGVzdExhYmVsIj5TY3JvbGwgdG8gbGF0ZXN0PC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iY2xlYXJCdXR0b24iIHZhbHVlPSJDbGVhciIgb25jbGljaz0iY2xlYXJMb2coKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkNsZWFyIGFsbCBsb2cgbWVzc2FnZXMiICAvPicsJzxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJoaWRlQnV0dG9uIiB2YWx1ZT0iSGlkZSIgb25jbGljaz0iaGlkZSgpIiBjbGFzcz0iaGlkZGVuIGJ1dHRvbiIgdGl0bGU9IkhpZGUgdGhlIGNvbnNvbGUiIC8+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImNsb3NlQnV0dG9uIiB2YWx1ZT0iQ2xvc2UiIG9uY2xpY2s9ImNsb3NlV2luZG93KCkiIGNsYXNzPSJoaWRkZW4gYnV0dG9uIiB0aXRsZT0iQ2xvc2UgdGhlIHdpbmRvdyIgLz4nLCc8L2Rpdj4nLCc8L2Rpdj4nLCc8L2Rpdj4nLCc8ZGl2IGlkPSJsb2ciIGNsYXNzPSJUUkFDRSBERUJVRyBJTkZPIFdBUk4gRVJST1IgRkFUQUwiPjwvZGl2PicsJzxkaXYgaWQ9ImNvbW1hbmRMaW5lIiBjbGFzcz0idG9vbGJhciI+JywnPGRpdiBpZD0iY29tbWFuZExpbmVDb250YWluZXIiPicsJzxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iY29tbWFuZCIgdGl0bGU9IkVudGVyIGEgSmF2YVNjcmlwdCBjb21tYW5kIGhlcmUgYW5kIGhpdCByZXR1cm4gb3IgcHJlc3MgXCdFdmFsdWF0ZVwnIiAvPicsJzxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJldmFsdWF0ZUJ1dHRvbiIgdmFsdWU9IkV2YWx1YXRlIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iRXZhbHVhdGUgdGhlIGNvbW1hbmQiIG9uY2xpY2s9ImV2YWxDb21tYW5kTGluZSgpIiAvPicsJzwvZGl2PicsJzwvZGl2PicsJzwvYm9keT4nLCc8L2h0bWw+JywnJ107fTt2YXIgZGVmYXVsdENvbW1hbmRMaW5lRnVuY3Rpb25zPVtdO0NvbnNvbGVBcHBlbmRlcj1mdW5jdGlvbigpe307dmFyIGNvbnNvbGVBcHBlbmRlcklkQ291bnRlcj0xO0NvbnNvbGVBcHBlbmRlci5wcm90b3R5cGU9bmV3IEFwcGVuZGVyKCk7Q29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5jcmVhdGU9ZnVuY3Rpb24oaW5QYWdlLGNvbnRhaW5lcixsYXp5SW5pdCxpbml0aWFsbHlNaW5pbWl6ZWQsdXNlRG9jdW1lbnRXcml0ZSx3aWR0aCxoZWlnaHQsZm9jdXNDb25zb2xlV2luZG93KXt2YXIgYXBwZW5kZXI9dGhpczt2YXIgaW5pdGlhbGl6ZWQ9ZmFsc2U7dmFyIGNvbnNvbGVXaW5kb3dDcmVhdGVkPWZhbHNlO3ZhciBjb25zb2xlV2luZG93TG9hZGVkPWZhbHNlO3ZhciBjb25zb2xlQ2xvc2VkPWZhbHNlO3ZhciBxdWV1ZWRMb2dnaW5nRXZlbnRzPVtdO3ZhciBpc1N1cHBvcnRlZD10cnVlO3ZhciBjb25zb2xlQXBwZW5kZXJJZD1jb25zb2xlQXBwZW5kZXJJZENvdW50ZXIrKztpbml0aWFsbHlNaW5pbWl6ZWQ9ZXh0cmFjdEJvb2xlYW5Gcm9tUGFyYW0oaW5pdGlhbGx5TWluaW1pemVkLHRoaXMuZGVmYXVsdHMuaW5pdGlhbGx5TWluaW1pemVkKTtsYXp5SW5pdD1leHRyYWN0Qm9vbGVhbkZyb21QYXJhbShsYXp5SW5pdCx0aGlzLmRlZmF1bHRzLmxhenlJbml0KTt1c2VEb2N1bWVudFdyaXRlPWV4dHJhY3RCb29sZWFuRnJvbVBhcmFtKHVzZURvY3VtZW50V3JpdGUsdGhpcy5kZWZhdWx0cy51c2VEb2N1bWVudFdyaXRlKTt2YXIgbmV3ZXN0TWVzc2FnZUF0VG9wPXRoaXMuZGVmYXVsdHMubmV3ZXN0TWVzc2FnZUF0VG9wO3ZhciBzY3JvbGxUb0xhdGVzdE1lc3NhZ2U9dGhpcy5kZWZhdWx0cy5zY3JvbGxUb0xhdGVzdE1lc3NhZ2U7d2lkdGg9d2lkdGg/d2lkdGg6dGhpcy5kZWZhdWx0cy53aWR0aDtoZWlnaHQ9aGVpZ2h0P2hlaWdodDp0aGlzLmRlZmF1bHRzLmhlaWdodDt2YXIgbWF4TWVzc2FnZXM9dGhpcy5kZWZhdWx0cy5tYXhNZXNzYWdlczt2YXIgc2hvd0NvbW1hbmRMaW5lPXRoaXMuZGVmYXVsdHMuc2hvd0NvbW1hbmRMaW5lO3ZhciBjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoPXRoaXMuZGVmYXVsdHMuY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aDt2YXIgc2hvd0hpZGVCdXR0b249dGhpcy5kZWZhdWx0cy5zaG93SGlkZUJ1dHRvbjt2YXIgc2hvd0Nsb3NlQnV0dG9uPXRoaXMuZGVmYXVsdHMuc2hvd0Nsb3NlQnV0dG9uO3ZhciBzaG93TG9nRW50cnlEZWxldGVCdXR0b25zPXRoaXMuZGVmYXVsdHMuc2hvd0xvZ0VudHJ5RGVsZXRlQnV0dG9uczt0aGlzLnNldExheW91dCh0aGlzLmRlZmF1bHRzLmxheW91dCk7dmFyIGluaXQsY3JlYXRlV2luZG93LHNhZmVUb0FwcGVuZCxnZXRDb25zb2xlV2luZG93LG9wZW47dmFyIGFwcGVuZGVyTmFtZT1pblBhZ2U/IkluUGFnZUFwcGVuZGVyIjoiUG9wVXBBcHBlbmRlciI7dmFyIGNoZWNrQ2FuQ29uZmlndXJlPWZ1bmN0aW9uKGNvbmZpZ09wdGlvbk5hbWUpe2lmKGNvbnNvbGVXaW5kb3dDcmVhdGVkKXtoYW5kbGVFcnJvcihhcHBlbmRlck5hbWUrIjogY29uZmlndXJhdGlvbiBvcHRpb24gJyIrY29uZmlnT3B0aW9uTmFtZSsiJyBtYXkgbm90IGJlIHNldCBhZnRlciB0aGUgYXBwZW5kZXIgaGFzIGJlZW4gaW5pdGlhbGl6ZWQiKTtyZXR1cm4gZmFsc2U7fQ0KcmV0dXJuIHRydWU7fTt2YXIgY29uc29sZVdpbmRvd0V4aXN0cz1mdW5jdGlvbigpe3JldHVybihjb25zb2xlV2luZG93TG9hZGVkJiZpc1N1cHBvcnRlZCYmIWNvbnNvbGVDbG9zZWQpO307dGhpcy5pc05ld2VzdE1lc3NhZ2VBdFRvcD1mdW5jdGlvbigpe3JldHVybiBuZXdlc3RNZXNzYWdlQXRUb3A7fTt0aGlzLnNldE5ld2VzdE1lc3NhZ2VBdFRvcD1mdW5jdGlvbihuZXdlc3RNZXNzYWdlQXRUb3BQYXJhbSl7bmV3ZXN0TWVzc2FnZUF0VG9wPWJvb2wobmV3ZXN0TWVzc2FnZUF0VG9wUGFyYW0pO2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLnNldE5ld2VzdEF0VG9wKG5ld2VzdE1lc3NhZ2VBdFRvcCk7fX07dGhpcy5pc1Njcm9sbFRvTGF0ZXN0TWVzc2FnZT1mdW5jdGlvbigpe3JldHVybiBzY3JvbGxUb0xhdGVzdE1lc3NhZ2U7fTt0aGlzLnNldFNjcm9sbFRvTGF0ZXN0TWVzc2FnZT1mdW5jdGlvbihzY3JvbGxUb0xhdGVzdE1lc3NhZ2VQYXJhbSl7c2Nyb2xsVG9MYXRlc3RNZXNzYWdlPWJvb2woc2Nyb2xsVG9MYXRlc3RNZXNzYWdlUGFyYW0pO2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLnNldFNjcm9sbFRvTGF0ZXN0KHNjcm9sbFRvTGF0ZXN0TWVzc2FnZSk7fX07dGhpcy5nZXRXaWR0aD1mdW5jdGlvbigpe3JldHVybiB3aWR0aDt9O3RoaXMuc2V0V2lkdGg9ZnVuY3Rpb24od2lkdGhQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoIndpZHRoIikpe3dpZHRoPWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0od2lkdGhQYXJhbSx3aWR0aCk7fX07dGhpcy5nZXRIZWlnaHQ9ZnVuY3Rpb24oKXtyZXR1cm4gaGVpZ2h0O307dGhpcy5zZXRIZWlnaHQ9ZnVuY3Rpb24oaGVpZ2h0UGFyYW0pe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJoZWlnaHQiKSl7aGVpZ2h0PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0oaGVpZ2h0UGFyYW0saGVpZ2h0KTt9fTt0aGlzLmdldE1heE1lc3NhZ2VzPWZ1bmN0aW9uKCl7cmV0dXJuIG1heE1lc3NhZ2VzO307dGhpcy5zZXRNYXhNZXNzYWdlcz1mdW5jdGlvbihtYXhNZXNzYWdlc1BhcmFtKXttYXhNZXNzYWdlcz1leHRyYWN0SW50RnJvbVBhcmFtKG1heE1lc3NhZ2VzUGFyYW0sbWF4TWVzc2FnZXMpO2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLnNldE1heE1lc3NhZ2VzKG1heE1lc3NhZ2VzKTt9fTt0aGlzLmlzU2hvd0NvbW1hbmRMaW5lPWZ1bmN0aW9uKCl7cmV0dXJuIHNob3dDb21tYW5kTGluZTt9O3RoaXMuc2V0U2hvd0NvbW1hbmRMaW5lPWZ1bmN0aW9uKHNob3dDb21tYW5kTGluZVBhcmFtKXtzaG93Q29tbWFuZExpbmU9Ym9vbChzaG93Q29tbWFuZExpbmVQYXJhbSk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0U2hvd0NvbW1hbmRMaW5lKHNob3dDb21tYW5kTGluZSk7fX07dGhpcy5pc1Nob3dIaWRlQnV0dG9uPWZ1bmN0aW9uKCl7cmV0dXJuIHNob3dIaWRlQnV0dG9uO307dGhpcy5zZXRTaG93SGlkZUJ1dHRvbj1mdW5jdGlvbihzaG93SGlkZUJ1dHRvblBhcmFtKXtzaG93SGlkZUJ1dHRvbj1ib29sKHNob3dIaWRlQnV0dG9uUGFyYW0pO2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLnNldFNob3dIaWRlQnV0dG9uKHNob3dIaWRlQnV0dG9uKTt9fTt0aGlzLmlzU2hvd0Nsb3NlQnV0dG9uPWZ1bmN0aW9uKCl7cmV0dXJuIHNob3dDbG9zZUJ1dHRvbjt9O3RoaXMuc2V0U2hvd0Nsb3NlQnV0dG9uPWZ1bmN0aW9uKHNob3dDbG9zZUJ1dHRvblBhcmFtKXtzaG93Q2xvc2VCdXR0b249Ym9vbChzaG93Q2xvc2VCdXR0b25QYXJhbSk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0U2hvd0Nsb3NlQnV0dG9uKHNob3dDbG9zZUJ1dHRvbik7fX07dGhpcy5nZXRDb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoPWZ1bmN0aW9uKCl7cmV0dXJuIGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg7fTt0aGlzLnNldENvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg9ZnVuY3Rpb24oY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aFBhcmFtKXtjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoPWV4dHJhY3RJbnRGcm9tUGFyYW0oY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aFBhcmFtLGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGgpO307dmFyIG1pbmltaXplZD1pbml0aWFsbHlNaW5pbWl6ZWQ7dGhpcy5pc0luaXRpYWxseU1pbmltaXplZD1mdW5jdGlvbigpe3JldHVybiBpbml0aWFsbHlNaW5pbWl6ZWQ7fTt0aGlzLnNldEluaXRpYWxseU1pbmltaXplZD1mdW5jdGlvbihpbml0aWFsbHlNaW5pbWl6ZWRQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImluaXRpYWxseU1pbmltaXplZCIpKXtpbml0aWFsbHlNaW5pbWl6ZWQ9Ym9vbChpbml0aWFsbHlNaW5pbWl6ZWRQYXJhbSk7bWluaW1pemVkPWluaXRpYWxseU1pbmltaXplZDt9fTt0aGlzLmlzVXNlRG9jdW1lbnRXcml0ZT1mdW5jdGlvbigpe3JldHVybiB1c2VEb2N1bWVudFdyaXRlO307dGhpcy5zZXRVc2VEb2N1bWVudFdyaXRlPWZ1bmN0aW9uKHVzZURvY3VtZW50V3JpdGVQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInVzZURvY3VtZW50V3JpdGUiKSl7dXNlRG9jdW1lbnRXcml0ZT1ib29sKHVzZURvY3VtZW50V3JpdGVQYXJhbSk7fX07ZnVuY3Rpb24gUXVldWVkTG9nZ2luZ0V2ZW50KGxvZ2dpbmdFdmVudCxmb3JtYXR0ZWRNZXNzYWdlKXt0aGlzLmxvZ2dpbmdFdmVudD1sb2dnaW5nRXZlbnQ7dGhpcy5sZXZlbE5hbWU9bG9nZ2luZ0V2ZW50LmxldmVsLm5hbWU7dGhpcy5mb3JtYXR0ZWRNZXNzYWdlPWZvcm1hdHRlZE1lc3NhZ2U7fQ0KUXVldWVkTG9nZ2luZ0V2ZW50LnByb3RvdHlwZS5hcHBlbmQ9ZnVuY3Rpb24oKXtnZXRDb25zb2xlV2luZG93KCkubG9nKHRoaXMubGV2ZWxOYW1lLHRoaXMuZm9ybWF0dGVkTWVzc2FnZSk7fTtmdW5jdGlvbiBRdWV1ZWRHcm91cChuYW1lLGluaXRpYWxseUV4cGFuZGVkKXt0aGlzLm5hbWU9bmFtZTt0aGlzLmluaXRpYWxseUV4cGFuZGVkPWluaXRpYWxseUV4cGFuZGVkO30NClF1ZXVlZEdyb3VwLnByb3RvdHlwZS5hcHBlbmQ9ZnVuY3Rpb24oKXtnZXRDb25zb2xlV2luZG93KCkuZ3JvdXAodGhpcy5uYW1lLHRoaXMuaW5pdGlhbGx5RXhwYW5kZWQpO307ZnVuY3Rpb24gUXVldWVkR3JvdXBFbmQoKXt9DQpRdWV1ZWRHcm91cEVuZC5wcm90b3R5cGUuYXBwZW5kPWZ1bmN0aW9uKCl7Z2V0Q29uc29sZVdpbmRvdygpLmdyb3VwRW5kKCk7fTt2YXIgY2hlY2tBbmRBcHBlbmQ9ZnVuY3Rpb24oKXtzYWZlVG9BcHBlbmQoKTtpZighaW5pdGlhbGl6ZWQpe2luaXQoKTt9ZWxzZSBpZihjb25zb2xlQ2xvc2VkJiZyZW9wZW5XaGVuQ2xvc2VkKXtjcmVhdGVXaW5kb3coKTt9DQppZihzYWZlVG9BcHBlbmQoKSl7YXBwZW5kUXVldWVkTG9nZ2luZ0V2ZW50cygpO319O3RoaXMuYXBwZW5kPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7aWYoaXNTdXBwb3J0ZWQpe3ZhciBmb3JtYXR0ZWRNZXNzYWdlPWFwcGVuZGVyLmdldExheW91dCgpLmZvcm1hdChsb2dnaW5nRXZlbnQpO2lmKHRoaXMuZ2V0TGF5b3V0KCkuaWdub3Jlc1Rocm93YWJsZSgpKXtmb3JtYXR0ZWRNZXNzYWdlKz1sb2dnaW5nRXZlbnQuZ2V0VGhyb3dhYmxlU3RyUmVwKCk7fQ0KcXVldWVkTG9nZ2luZ0V2ZW50cy5wdXNoKG5ldyBRdWV1ZWRMb2dnaW5nRXZlbnQobG9nZ2luZ0V2ZW50LGZvcm1hdHRlZE1lc3NhZ2UpKTtjaGVja0FuZEFwcGVuZCgpO319O3RoaXMuZ3JvdXA9ZnVuY3Rpb24obmFtZSxpbml0aWFsbHlFeHBhbmRlZCl7aWYoaXNTdXBwb3J0ZWQpe3F1ZXVlZExvZ2dpbmdFdmVudHMucHVzaChuZXcgUXVldWVkR3JvdXAobmFtZSxpbml0aWFsbHlFeHBhbmRlZCkpO2NoZWNrQW5kQXBwZW5kKCk7fX07dGhpcy5ncm91cEVuZD1mdW5jdGlvbigpe2lmKGlzU3VwcG9ydGVkKXtxdWV1ZWRMb2dnaW5nRXZlbnRzLnB1c2gobmV3IFF1ZXVlZEdyb3VwRW5kKCkpO2NoZWNrQW5kQXBwZW5kKCk7fX07dmFyIGFwcGVuZFF1ZXVlZExvZ2dpbmdFdmVudHM9ZnVuY3Rpb24oKXt2YXIgY3VycmVudExvZ2dpbmdFdmVudDt3aGlsZShxdWV1ZWRMb2dnaW5nRXZlbnRzLmxlbmd0aD4wKXtxdWV1ZWRMb2dnaW5nRXZlbnRzLnNoaWZ0KCkuYXBwZW5kKCk7fQ0KaWYoZm9jdXNDb25zb2xlV2luZG93KXtnZXRDb25zb2xlV2luZG93KCkuZm9jdXMoKTt9fTt0aGlzLnNldEFkZGVkVG9Mb2dnZXI9ZnVuY3Rpb24obG9nZ2VyKXt0aGlzLmxvZ2dlcnMucHVzaChsb2dnZXIpO2lmKGVuYWJsZWQmJiFsYXp5SW5pdCl7aW5pdCgpO319O3RoaXMuY2xlYXI9ZnVuY3Rpb24oKXtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS5jbGVhckxvZygpO30NCnF1ZXVlZExvZ2dpbmdFdmVudHMubGVuZ3RoPTA7fTt0aGlzLmZvY3VzPWZ1bmN0aW9uKCl7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuZm9jdXMoKTt9fTt0aGlzLmZvY3VzQ29tbWFuZExpbmU9ZnVuY3Rpb24oKXtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS5mb2N1c0NvbW1hbmRMaW5lKCk7fX07dGhpcy5mb2N1c1NlYXJjaD1mdW5jdGlvbigpe2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLmZvY3VzU2VhcmNoKCk7fX07dmFyIGNvbW1hbmRXaW5kb3c9d2luZG93O3RoaXMuZ2V0Q29tbWFuZFdpbmRvdz1mdW5jdGlvbigpe3JldHVybiBjb21tYW5kV2luZG93O307dGhpcy5zZXRDb21tYW5kV2luZG93PWZ1bmN0aW9uKGNvbW1hbmRXaW5kb3dQYXJhbSl7Y29tbWFuZFdpbmRvdz1jb21tYW5kV2luZG93UGFyYW07fTt0aGlzLmV4ZWN1dGVMYXN0Q29tbWFuZD1mdW5jdGlvbigpe2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLmV2YWxMYXN0Q29tbWFuZCgpO319O3ZhciBjb21tYW5kTGF5b3V0PW5ldyBQYXR0ZXJuTGF5b3V0KCIlbSIpO3RoaXMuZ2V0Q29tbWFuZExheW91dD1mdW5jdGlvbigpe3JldHVybiBjb21tYW5kTGF5b3V0O307dGhpcy5zZXRDb21tYW5kTGF5b3V0PWZ1bmN0aW9uKGNvbW1hbmRMYXlvdXRQYXJhbSl7Y29tbWFuZExheW91dD1jb21tYW5kTGF5b3V0UGFyYW07fTt0aGlzLmV2YWxDb21tYW5kQW5kQXBwZW5kPWZ1bmN0aW9uKGV4cHIpe3ZhciBjb21tYW5kUmV0dXJuVmFsdWU9e2FwcGVuZFJlc3VsdDp0cnVlLGlzRXJyb3I6ZmFsc2V9O3ZhciBjb21tYW5kT3V0cHV0PSIiO3RyeXt2YXIgcmVzdWx0LGk7aWYoIWNvbW1hbmRXaW5kb3cuZXZhbCYmY29tbWFuZFdpbmRvdy5leGVjU2NyaXB0KXtjb21tYW5kV2luZG93LmV4ZWNTY3JpcHQoIm51bGwiKTt9DQp2YXIgY29tbWFuZExpbmVGdW5jdGlvbnNIYXNoPXt9O2ZvcihpPTAsbGVuPWNvbW1hbmRMaW5lRnVuY3Rpb25zLmxlbmd0aDtpPGxlbjtpKyspe2NvbW1hbmRMaW5lRnVuY3Rpb25zSGFzaFtjb21tYW5kTGluZUZ1bmN0aW9uc1tpXVswXV09Y29tbWFuZExpbmVGdW5jdGlvbnNbaV1bMV07fQ0KdmFyIG9iamVjdHNUb1Jlc3RvcmU9W107dmFyIGFkZE9iamVjdFRvUmVzdG9yZT1mdW5jdGlvbihuYW1lKXtvYmplY3RzVG9SZXN0b3JlLnB1c2goW25hbWUsY29tbWFuZFdpbmRvd1tuYW1lXV0pO307YWRkT2JqZWN0VG9SZXN0b3JlKCJhcHBlbmRlciIpO2NvbW1hbmRXaW5kb3cuYXBwZW5kZXI9YXBwZW5kZXI7YWRkT2JqZWN0VG9SZXN0b3JlKCJjb21tYW5kUmV0dXJuVmFsdWUiKTtjb21tYW5kV2luZG93LmNvbW1hbmRSZXR1cm5WYWx1ZT1jb21tYW5kUmV0dXJuVmFsdWU7YWRkT2JqZWN0VG9SZXN0b3JlKCJjb21tYW5kTGluZUZ1bmN0aW9uc0hhc2giKTtjb21tYW5kV2luZG93LmNvbW1hbmRMaW5lRnVuY3Rpb25zSGFzaD1jb21tYW5kTGluZUZ1bmN0aW9uc0hhc2g7dmFyIGFkZEZ1bmN0aW9uVG9XaW5kb3c9ZnVuY3Rpb24obmFtZSl7YWRkT2JqZWN0VG9SZXN0b3JlKG5hbWUpO2NvbW1hbmRXaW5kb3dbbmFtZV09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb21tYW5kTGluZUZ1bmN0aW9uc0hhc2hbbmFtZV0oYXBwZW5kZXIsYXJndW1lbnRzLGNvbW1hbmRSZXR1cm5WYWx1ZSk7fTt9O2ZvcihpPTAsbGVuPWNvbW1hbmRMaW5lRnVuY3Rpb25zLmxlbmd0aDtpPGxlbjtpKyspe2FkZEZ1bmN0aW9uVG9XaW5kb3coY29tbWFuZExpbmVGdW5jdGlvbnNbaV1bMF0pO30NCmlmKGNvbW1hbmRXaW5kb3c9PT13aW5kb3cmJmNvbW1hbmRXaW5kb3cuZXhlY1NjcmlwdCl7YWRkT2JqZWN0VG9SZXN0b3JlKCJldmFsRXhwciIpO2FkZE9iamVjdFRvUmVzdG9yZSgicmVzdWx0Iik7d2luZG93LmV2YWxFeHByPWV4cHI7Y29tbWFuZFdpbmRvdy5leGVjU2NyaXB0KCJ3aW5kb3cucmVzdWx0PWV2YWwod2luZG93LmV2YWxFeHByKTsiKTtyZXN1bHQ9d2luZG93LnJlc3VsdDt9ZWxzZXtyZXN1bHQ9Y29tbWFuZFdpbmRvdy5ldmFsKGV4cHIpO30NCmNvbW1hbmRPdXRwdXQ9aXNVbmRlZmluZWQocmVzdWx0KT9yZXN1bHQ6Zm9ybWF0T2JqZWN0RXhwYW5zaW9uKHJlc3VsdCxjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoKTtmb3IoaT0wLGxlbj1vYmplY3RzVG9SZXN0b3JlLmxlbmd0aDtpPGxlbjtpKyspe2NvbW1hbmRXaW5kb3dbb2JqZWN0c1RvUmVzdG9yZVtpXVswXV09b2JqZWN0c1RvUmVzdG9yZVtpXVsxXTt9fWNhdGNoKGV4KXtjb21tYW5kT3V0cHV0PSJFcnJvciBldmFsdWF0aW5nIGNvbW1hbmQ6ICIrZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGV4KTtjb21tYW5kUmV0dXJuVmFsdWUuaXNFcnJvcj10cnVlO30NCmlmKGNvbW1hbmRSZXR1cm5WYWx1ZS5hcHBlbmRSZXN1bHQpe3ZhciBtZXNzYWdlPSI+Pj4gIitleHByO2lmKCFpc1VuZGVmaW5lZChjb21tYW5kT3V0cHV0KSl7bWVzc2FnZSs9bmV3TGluZStjb21tYW5kT3V0cHV0O30NCnZhciBsZXZlbD1jb21tYW5kUmV0dXJuVmFsdWUuaXNFcnJvcj9MZXZlbC5FUlJPUjpMZXZlbC5JTkZPO3ZhciBsb2dnaW5nRXZlbnQ9bmV3IExvZ2dpbmdFdmVudChudWxsLG5ldyBEYXRlKCksbGV2ZWwsW21lc3NhZ2VdLG51bGwpO3ZhciBtYWluTGF5b3V0PXRoaXMuZ2V0TGF5b3V0KCk7dGhpcy5zZXRMYXlvdXQoY29tbWFuZExheW91dCk7dGhpcy5hcHBlbmQobG9nZ2luZ0V2ZW50KTt0aGlzLnNldExheW91dChtYWluTGF5b3V0KTt9fTt2YXIgY29tbWFuZExpbmVGdW5jdGlvbnM9ZGVmYXVsdENvbW1hbmRMaW5lRnVuY3Rpb25zLmNvbmNhdChbXSk7dGhpcy5hZGRDb21tYW5kTGluZUZ1bmN0aW9uPWZ1bmN0aW9uKGZ1bmN0aW9uTmFtZSxjb21tYW5kTGluZUZ1bmN0aW9uKXtjb21tYW5kTGluZUZ1bmN0aW9ucy5wdXNoKFtmdW5jdGlvbk5hbWUsY29tbWFuZExpbmVGdW5jdGlvbl0pO307dmFyIGNvbW1hbmRIaXN0b3J5Q29va2llTmFtZT0ibG9nNGphdmFzY3JpcHRDb21tYW5kSGlzdG9yeSI7dGhpcy5zdG9yZUNvbW1hbmRIaXN0b3J5PWZ1bmN0aW9uKGNvbW1hbmRIaXN0b3J5KXtzZXRDb29raWUoY29tbWFuZEhpc3RvcnlDb29raWVOYW1lLGNvbW1hbmRIaXN0b3J5LmpvaW4oIiwiKSk7fTt2YXIgd3JpdGVIdG1sPWZ1bmN0aW9uKGRvYyl7dmFyIGxpbmVzPWdldENvbnNvbGVIdG1sTGluZXMoKTtkb2Mub3BlbigpO2Zvcih2YXIgaT0wLGxlbj1saW5lcy5sZW5ndGg7aTxsZW47aSsrKXtkb2Mud3JpdGVsbihsaW5lc1tpXSk7fQ0KZG9jLmNsb3NlKCk7fTt0aGlzLnNldEV2ZW50VHlwZXMoWyJsb2FkIiwidW5sb2FkIl0pO3ZhciBjb25zb2xlV2luZG93TG9hZEhhbmRsZXI9ZnVuY3Rpb24oKXt2YXIgd2luPWdldENvbnNvbGVXaW5kb3coKTt3aW4uc2V0QXBwZW5kZXIoYXBwZW5kZXIpO3dpbi5zZXROZXdlc3RBdFRvcChuZXdlc3RNZXNzYWdlQXRUb3ApO3dpbi5zZXRTY3JvbGxUb0xhdGVzdChzY3JvbGxUb0xhdGVzdE1lc3NhZ2UpO3dpbi5zZXRNYXhNZXNzYWdlcyhtYXhNZXNzYWdlcyk7d2luLnNldFNob3dDb21tYW5kTGluZShzaG93Q29tbWFuZExpbmUpO3dpbi5zZXRTaG93SGlkZUJ1dHRvbihzaG93SGlkZUJ1dHRvbik7d2luLnNldFNob3dDbG9zZUJ1dHRvbihzaG93Q2xvc2VCdXR0b24pO3dpbi5zZXRNYWluV2luZG93KHdpbmRvdyk7dmFyIHN0b3JlZFZhbHVlPWdldENvb2tpZShjb21tYW5kSGlzdG9yeUNvb2tpZU5hbWUpO2lmKHN0b3JlZFZhbHVlKXt3aW4uY29tbWFuZEhpc3Rvcnk9c3RvcmVkVmFsdWUuc3BsaXQoIiwiKTt3aW4uY3VycmVudENvbW1hbmRJbmRleD13aW4uY29tbWFuZEhpc3RvcnkubGVuZ3RoO30NCmFwcGVuZGVyLmRpc3BhdGNoRXZlbnQoImxvYWQiLHsid2luIjp3aW59KTt9O3RoaXMudW5sb2FkPWZ1bmN0aW9uKCl7bG9nTG9nLmRlYnVnKCJ1bmxvYWQgIit0aGlzKyIsIGNhbGxlcjogIit0aGlzLnVubG9hZC5jYWxsZXIpO2lmKCFjb25zb2xlQ2xvc2VkKXtsb2dMb2cuZGVidWcoInJlYWxseSBkb2luZyB1bmxvYWQgIit0aGlzKTtjb25zb2xlQ2xvc2VkPXRydWU7Y29uc29sZVdpbmRvd0xvYWRlZD1mYWxzZTtjb25zb2xlV2luZG93Q3JlYXRlZD1mYWxzZTthcHBlbmRlci5kaXNwYXRjaEV2ZW50KCJ1bmxvYWQiLHt9KTt9fTt2YXIgcG9sbENvbnNvbGVXaW5kb3c9ZnVuY3Rpb24od2luZG93VGVzdCxpbnRlcnZhbCxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JNZXNzYWdlKXtmdW5jdGlvbiBkb1BvbGwoKXt0cnl7aWYoY29uc29sZUNsb3NlZCl7Y2xlYXJJbnRlcnZhbChwb2xsKTt9DQppZih3aW5kb3dUZXN0KGdldENvbnNvbGVXaW5kb3coKSkpe2NsZWFySW50ZXJ2YWwocG9sbCk7c3VjY2Vzc0NhbGxiYWNrKCk7fX1jYXRjaChleCl7Y2xlYXJJbnRlcnZhbChwb2xsKTtpc1N1cHBvcnRlZD1mYWxzZTtoYW5kbGVFcnJvcihlcnJvck1lc3NhZ2UsZXgpO319DQp2YXIgcG9sbD1zZXRJbnRlcnZhbChkb1BvbGwsaW50ZXJ2YWwpO307dmFyIGdldENvbnNvbGVVcmw9ZnVuY3Rpb24oKXt2YXIgZG9jdW1lbnREb21haW5TZXQ9KGRvY3VtZW50LmRvbWFpbiE9bG9jYXRpb24uaG9zdG5hbWUpO3JldHVybiB1c2VEb2N1bWVudFdyaXRlPyIiOmdldEJhc2VVcmwoKSsiY29uc29sZS5odG1sIisNCihkb2N1bWVudERvbWFpblNldD8iP2xvZzRqYXZhc2NyaXB0X2RvbWFpbj0iK2VzY2FwZShkb2N1bWVudC5kb21haW4pOiIiKTt9O2lmKGluUGFnZSl7dmFyIGNvbnRhaW5lckVsZW1lbnQ9bnVsbDt2YXIgY3NzUHJvcGVydGllcz1bXTt0aGlzLmFkZENzc1Byb3BlcnR5PWZ1bmN0aW9uKG5hbWUsdmFsdWUpe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJjc3NQcm9wZXJ0aWVzIikpe2Nzc1Byb3BlcnRpZXMucHVzaChbbmFtZSx2YWx1ZV0pO319O3ZhciB3aW5kb3dDcmVhdGlvblN0YXJ0ZWQ9ZmFsc2U7dmFyIGlmcmFtZUNvbnRhaW5lckRpdjt2YXIgaWZyYW1lSWQ9dW5pcXVlSWQrIl9JblBhZ2VBcHBlbmRlcl8iK2NvbnNvbGVBcHBlbmRlcklkO3RoaXMuaGlkZT1mdW5jdGlvbigpe2lmKGluaXRpYWxpemVkJiZjb25zb2xlV2luZG93Q3JlYXRlZCl7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuJCgiY29tbWFuZCIpLmJsdXIoKTt9DQppZnJhbWVDb250YWluZXJEaXYuc3R5bGUuZGlzcGxheT0ibm9uZSI7bWluaW1pemVkPXRydWU7fX07dGhpcy5zaG93PWZ1bmN0aW9uKCl7aWYoaW5pdGlhbGl6ZWQpe2lmKGNvbnNvbGVXaW5kb3dDcmVhdGVkKXtpZnJhbWVDb250YWluZXJEaXYuc3R5bGUuZGlzcGxheT0iYmxvY2siO3RoaXMuc2V0U2hvd0NvbW1hbmRMaW5lKHNob3dDb21tYW5kTGluZSk7bWluaW1pemVkPWZhbHNlO31lbHNlIGlmKCF3aW5kb3dDcmVhdGlvblN0YXJ0ZWQpe2NyZWF0ZVdpbmRvdyh0cnVlKTt9fX07dGhpcy5pc1Zpc2libGU9ZnVuY3Rpb24oKXtyZXR1cm4hbWluaW1pemVkJiYhY29uc29sZUNsb3NlZDt9O3RoaXMuY2xvc2U9ZnVuY3Rpb24oZnJvbUJ1dHRvbil7aWYoIWNvbnNvbGVDbG9zZWQmJighZnJvbUJ1dHRvbnx8Y29uZmlybSgiVGhpcyB3aWxsIHBlcm1hbmVudGx5IHJlbW92ZSB0aGUgY29uc29sZSBmcm9tIHRoZSBwYWdlLiBObyBtb3JlIG1lc3NhZ2VzIHdpbGwgYmUgbG9nZ2VkLiBEbyB5b3Ugd2lzaCB0byBjb250aW51ZT8iKSkpe2lmcmFtZUNvbnRhaW5lckRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGlmcmFtZUNvbnRhaW5lckRpdik7dGhpcy51bmxvYWQoKTt9fTtvcGVuPWZ1bmN0aW9uKCl7dmFyIGluaXRFcnJvck1lc3NhZ2U9IkluUGFnZUFwcGVuZGVyLm9wZW46IHVuYWJsZSB0byBjcmVhdGUgY29uc29sZSBpZnJhbWUiO2Z1bmN0aW9uIGZpbmFsSW5pdCgpe3RyeXtpZighaW5pdGlhbGx5TWluaW1pemVkKXthcHBlbmRlci5zaG93KCk7fQ0KY29uc29sZVdpbmRvd0xvYWRIYW5kbGVyKCk7Y29uc29sZVdpbmRvd0xvYWRlZD10cnVlO2FwcGVuZFF1ZXVlZExvZ2dpbmdFdmVudHMoKTt9Y2F0Y2goZXgpe2lzU3VwcG9ydGVkPWZhbHNlO2hhbmRsZUVycm9yKGluaXRFcnJvck1lc3NhZ2UsZXgpO319DQpmdW5jdGlvbiB3cml0ZVRvRG9jdW1lbnQoKXt0cnl7dmFyIHdpbmRvd1Rlc3Q9ZnVuY3Rpb24od2luKXtyZXR1cm4gaXNMb2FkZWQod2luKTt9O2lmKHVzZURvY3VtZW50V3JpdGUpe3dyaXRlSHRtbChnZXRDb25zb2xlV2luZG93KCkuZG9jdW1lbnQpO30NCmlmKHdpbmRvd1Rlc3QoZ2V0Q29uc29sZVdpbmRvdygpKSl7ZmluYWxJbml0KCk7fWVsc2V7cG9sbENvbnNvbGVXaW5kb3cod2luZG93VGVzdCwxMDAsZmluYWxJbml0LGluaXRFcnJvck1lc3NhZ2UpO319Y2F0Y2goZXgpe2lzU3VwcG9ydGVkPWZhbHNlO2hhbmRsZUVycm9yKGluaXRFcnJvck1lc3NhZ2UsZXgpO319DQptaW5pbWl6ZWQ9ZmFsc2U7aWZyYW1lQ29udGFpbmVyRGl2PWNvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpO2lmcmFtZUNvbnRhaW5lckRpdi5zdHlsZS53aWR0aD13aWR0aDtpZnJhbWVDb250YWluZXJEaXYuc3R5bGUuaGVpZ2h0PWhlaWdodDtpZnJhbWVDb250YWluZXJEaXYuc3R5bGUuYm9yZGVyPSJzb2xpZCBncmF5IDFweCI7Zm9yKHZhciBpPTAsbGVuPWNzc1Byb3BlcnRpZXMubGVuZ3RoO2k8bGVuO2krKyl7aWZyYW1lQ29udGFpbmVyRGl2LnN0eWxlW2Nzc1Byb3BlcnRpZXNbaV1bMF1dPWNzc1Byb3BlcnRpZXNbaV1bMV07fQ0KdmFyIGlmcmFtZVNyYz11c2VEb2N1bWVudFdyaXRlPyIiOiIgc3JjPSciK2dldENvbnNvbGVVcmwoKSsiJyI7aWZyYW1lQ29udGFpbmVyRGl2LmlubmVySFRNTD0iPGlmcmFtZSBpZD0nIitpZnJhbWVJZCsiJyBuYW1lPSciK2lmcmFtZUlkKyInIHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZyYW1lYm9yZGVyPScwJyIraWZyYW1lU3JjKyJzY3JvbGxpbmc9J25vJz48L2lmcmFtZT4iO2NvbnNvbGVDbG9zZWQ9ZmFsc2U7dmFyIGlmcmFtZURvY3VtZW50RXhpc3RzVGVzdD1mdW5jdGlvbih3aW4pe3RyeXtyZXR1cm4gYm9vbCh3aW4pJiZib29sKHdpbi5kb2N1bWVudCk7fWNhdGNoKGV4KXtyZXR1cm4gZmFsc2U7fX07aWYoaWZyYW1lRG9jdW1lbnRFeGlzdHNUZXN0KGdldENvbnNvbGVXaW5kb3coKSkpe3dyaXRlVG9Eb2N1bWVudCgpO31lbHNle3BvbGxDb25zb2xlV2luZG93KGlmcmFtZURvY3VtZW50RXhpc3RzVGVzdCwxMDAsd3JpdGVUb0RvY3VtZW50LGluaXRFcnJvck1lc3NhZ2UpO30NCmNvbnNvbGVXaW5kb3dDcmVhdGVkPXRydWU7fTtjcmVhdGVXaW5kb3c9ZnVuY3Rpb24oc2hvdyl7aWYoc2hvd3x8IWluaXRpYWxseU1pbmltaXplZCl7dmFyIHBhZ2VMb2FkSGFuZGxlcj1mdW5jdGlvbigpe2lmKCFjb250YWluZXIpe2NvbnRhaW5lckVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7Y29udGFpbmVyRWxlbWVudC5zdHlsZS5wb3NpdGlvbj0iZml4ZWQiO2NvbnRhaW5lckVsZW1lbnQuc3R5bGUubGVmdD0iMCI7Y29udGFpbmVyRWxlbWVudC5zdHlsZS5yaWdodD0iMCI7Y29udGFpbmVyRWxlbWVudC5zdHlsZS5ib3R0b209IjAiO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyRWxlbWVudCk7YXBwZW5kZXIuYWRkQ3NzUHJvcGVydHkoImJvcmRlcldpZHRoIiwiMXB4IDAgMCAwIik7YXBwZW5kZXIuYWRkQ3NzUHJvcGVydHkoInpJbmRleCIsMTAwMDAwMCk7b3BlbigpO31lbHNle3RyeXt2YXIgZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVyKTtpZihlbC5ub2RlVHlwZT09MSl7Y29udGFpbmVyRWxlbWVudD1lbDt9DQpvcGVuKCk7fWNhdGNoKGV4KXtoYW5kbGVFcnJvcigiSW5QYWdlQXBwZW5kZXIuaW5pdDogaW52YWxpZCBjb250YWluZXIgZWxlbWVudCAnIitjb250YWluZXIrIicgc3VwcGxpZWQiLGV4KTt9fX07aWYocGFnZUxvYWRlZCYmY29udGFpbmVyJiZjb250YWluZXIuYXBwZW5kQ2hpbGQpe2NvbnRhaW5lckVsZW1lbnQ9Y29udGFpbmVyO29wZW4oKTt9ZWxzZSBpZihwYWdlTG9hZGVkKXtwYWdlTG9hZEhhbmRsZXIoKTt9ZWxzZXtsb2c0amF2YXNjcmlwdC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixwYWdlTG9hZEhhbmRsZXIpO30NCndpbmRvd0NyZWF0aW9uU3RhcnRlZD10cnVlO319O2luaXQ9ZnVuY3Rpb24oKXtjcmVhdGVXaW5kb3coKTtpbml0aWFsaXplZD10cnVlO307Z2V0Q29uc29sZVdpbmRvdz1mdW5jdGlvbigpe3ZhciBpZnJhbWU9d2luZG93LmZyYW1lc1tpZnJhbWVJZF07aWYoaWZyYW1lKXtyZXR1cm4gaWZyYW1lO319O3NhZmVUb0FwcGVuZD1mdW5jdGlvbigpe2lmKGlzU3VwcG9ydGVkJiYhY29uc29sZUNsb3NlZCl7aWYoY29uc29sZVdpbmRvd0NyZWF0ZWQmJiFjb25zb2xlV2luZG93TG9hZGVkJiZnZXRDb25zb2xlV2luZG93KCkmJmlzTG9hZGVkKGdldENvbnNvbGVXaW5kb3coKSkpe2NvbnNvbGVXaW5kb3dMb2FkZWQ9dHJ1ZTt9DQpyZXR1cm4gY29uc29sZVdpbmRvd0xvYWRlZDt9DQpyZXR1cm4gZmFsc2U7fTt9ZWxzZXt2YXIgdXNlT2xkUG9wVXA9YXBwZW5kZXIuZGVmYXVsdHMudXNlT2xkUG9wVXA7dmFyIGNvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nPWFwcGVuZGVyLmRlZmF1bHRzLmNvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nO3ZhciByZW9wZW5XaGVuQ2xvc2VkPXRoaXMuZGVmYXVsdHMucmVvcGVuV2hlbkNsb3NlZDt0aGlzLmlzVXNlT2xkUG9wVXA9ZnVuY3Rpb24oKXtyZXR1cm4gdXNlT2xkUG9wVXA7fTt0aGlzLnNldFVzZU9sZFBvcFVwPWZ1bmN0aW9uKHVzZU9sZFBvcFVwUGFyYW0pe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJ1c2VPbGRQb3BVcCIpKXt1c2VPbGRQb3BVcD1ib29sKHVzZU9sZFBvcFVwUGFyYW0pO319O3RoaXMuaXNDb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZz1mdW5jdGlvbigpe3JldHVybiBjb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZzt9O3RoaXMuc2V0Q29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmc9ZnVuY3Rpb24oY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmdQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImNvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nIikpe2NvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nPWJvb2woY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmdQYXJhbSk7fX07dGhpcy5pc0ZvY3VzUG9wVXA9ZnVuY3Rpb24oKXtyZXR1cm4gZm9jdXNDb25zb2xlV2luZG93O307dGhpcy5zZXRGb2N1c1BvcFVwPWZ1bmN0aW9uKGZvY3VzUG9wVXBQYXJhbSl7Zm9jdXNDb25zb2xlV2luZG93PWJvb2woZm9jdXNQb3BVcFBhcmFtKTt9O3RoaXMuaXNSZW9wZW5XaGVuQ2xvc2VkPWZ1bmN0aW9uKCl7cmV0dXJuIHJlb3BlbldoZW5DbG9zZWQ7fTt0aGlzLnNldFJlb3BlbldoZW5DbG9zZWQ9ZnVuY3Rpb24ocmVvcGVuV2hlbkNsb3NlZFBhcmFtKXtyZW9wZW5XaGVuQ2xvc2VkPWJvb2wocmVvcGVuV2hlbkNsb3NlZFBhcmFtKTt9O3RoaXMuY2xvc2U9ZnVuY3Rpb24oKXtsb2dMb2cuZGVidWcoImNsb3NlICIrdGhpcyk7dHJ5e3BvcFVwLmNsb3NlKCk7dGhpcy51bmxvYWQoKTt9Y2F0Y2goZXgpe319O3RoaXMuaGlkZT1mdW5jdGlvbigpe2xvZ0xvZy5kZWJ1ZygiaGlkZSAiK3RoaXMpO2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7dGhpcy5jbG9zZSgpO319O3RoaXMuc2hvdz1mdW5jdGlvbigpe2xvZ0xvZy5kZWJ1Zygic2hvdyAiK3RoaXMpO2lmKCFjb25zb2xlV2luZG93Q3JlYXRlZCl7b3BlbigpO319O3RoaXMuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHNhZmVUb0FwcGVuZCgpO307dmFyIHBvcFVwO29wZW49ZnVuY3Rpb24oKXt2YXIgd2luZG93UHJvcGVydGllcz0id2lkdGg9Iit3aWR0aCsiLGhlaWdodD0iK2hlaWdodCsiLHN0YXR1cyxyZXNpemFibGUiO3ZhciB3aW5kb3dOYW1lPSJQb3BVcF8iK2xvY2F0aW9uLmhvc3QucmVwbGFjZSgvW15hLXowLTldL2dpLCJfIikrIl8iK2NvbnNvbGVBcHBlbmRlcklkO2lmKCF1c2VPbGRQb3BVcHx8IXVzZURvY3VtZW50V3JpdGUpe3dpbmRvd05hbWU9d2luZG93TmFtZSsiXyIrdW5pcXVlSWQ7fQ0KdmFyIGNoZWNrUG9wVXBDbG9zZWQ9ZnVuY3Rpb24od2luKXtpZihjb25zb2xlQ2xvc2VkKXtyZXR1cm4gdHJ1ZTt9ZWxzZXt0cnl7cmV0dXJuIGJvb2wod2luKSYmd2luLmNsb3NlZDt9Y2F0Y2goZXgpe319DQpyZXR1cm4gZmFsc2U7fTt2YXIgcG9wVXBDbG9zZWRDYWxsYmFjaz1mdW5jdGlvbigpe2lmKCFjb25zb2xlQ2xvc2VkKXthcHBlbmRlci51bmxvYWQoKTt9fTtmdW5jdGlvbiBmaW5hbEluaXQoKXtnZXRDb25zb2xlV2luZG93KCkuc2V0Q2xvc2VJZk9wZW5lckNsb3NlcyghdXNlT2xkUG9wVXB8fCF1c2VEb2N1bWVudFdyaXRlKTtjb25zb2xlV2luZG93TG9hZEhhbmRsZXIoKTtjb25zb2xlV2luZG93TG9hZGVkPXRydWU7YXBwZW5kUXVldWVkTG9nZ2luZ0V2ZW50cygpO3BvbGxDb25zb2xlV2luZG93KGNoZWNrUG9wVXBDbG9zZWQsNTAwLHBvcFVwQ2xvc2VkQ2FsbGJhY2ssIlBvcFVwQXBwZW5kZXIuY2hlY2tQb3BVcENsb3NlZDogZXJyb3IgY2hlY2tpbmcgcG9wLXVwIHdpbmRvdyIpO30NCnRyeXtwb3BVcD13aW5kb3cub3BlbihnZXRDb25zb2xlVXJsKCksd2luZG93TmFtZSx3aW5kb3dQcm9wZXJ0aWVzKTtjb25zb2xlQ2xvc2VkPWZhbHNlO2NvbnNvbGVXaW5kb3dDcmVhdGVkPXRydWU7aWYocG9wVXApe2lmKHVzZURvY3VtZW50V3JpdGUmJnVzZU9sZFBvcFVwJiZpc0xvYWRlZChwb3BVcCkpe3BvcFVwLm1haW5QYWdlUmVsb2FkZWQoKTtmaW5hbEluaXQoKTt9ZWxzZXtpZih1c2VEb2N1bWVudFdyaXRlKXt3cml0ZUh0bWwocG9wVXAuZG9jdW1lbnQpO30NCnZhciBwb3BVcExvYWRlZFRlc3Q9ZnVuY3Rpb24od2luKXtyZXR1cm4gYm9vbCh3aW4pJiZpc0xvYWRlZCh3aW4pO307aWYoaXNMb2FkZWQocG9wVXApKXtmaW5hbEluaXQoKTt9ZWxzZXtwb2xsQ29uc29sZVdpbmRvdyhwb3BVcExvYWRlZFRlc3QsMTAwLGZpbmFsSW5pdCwiUG9wVXBBcHBlbmRlci5pbml0OiB1bmFibGUgdG8gY3JlYXRlIGNvbnNvbGUgd2luZG93Iik7fX19ZWxzZXtpc1N1cHBvcnRlZD1mYWxzZTtsb2dMb2cud2FybigiUG9wVXBBcHBlbmRlci5pbml0OiBwb3AtdXBzIGJsb2NrZWQsIHBsZWFzZSB1bmJsb2NrIHRvIHVzZSBQb3BVcEFwcGVuZGVyIik7aWYoY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmcpe2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdDogcG9wLXVwIHdpbmRvd3MgYXBwZWFyIHRvIGJlIGJsb2NrZWQuIFBsZWFzZSB1bmJsb2NrIHRoZW0gdG8gdXNlIHBvcC11cCBsb2dnaW5nLiIpO319fWNhdGNoKGV4KXtoYW5kbGVFcnJvcigiUG9wVXBBcHBlbmRlci5pbml0OiBlcnJvciBjcmVhdGluZyBwb3AtdXAiLGV4KTt9fTtjcmVhdGVXaW5kb3c9ZnVuY3Rpb24oKXtpZighaW5pdGlhbGx5TWluaW1pemVkKXtvcGVuKCk7fX07aW5pdD1mdW5jdGlvbigpe2NyZWF0ZVdpbmRvdygpO2luaXRpYWxpemVkPXRydWU7fTtnZXRDb25zb2xlV2luZG93PWZ1bmN0aW9uKCl7cmV0dXJuIHBvcFVwO307c2FmZVRvQXBwZW5kPWZ1bmN0aW9uKCl7aWYoaXNTdXBwb3J0ZWQmJiFpc1VuZGVmaW5lZChwb3BVcCkmJiFjb25zb2xlQ2xvc2VkKXtpZihwb3BVcC5jbG9zZWR8fChjb25zb2xlV2luZG93TG9hZGVkJiZpc1VuZGVmaW5lZChwb3BVcC5jbG9zZWQpKSl7YXBwZW5kZXIudW5sb2FkKCk7bG9nTG9nLmRlYnVnKCJQb3BVcEFwcGVuZGVyOiBwb3AtdXAgY2xvc2VkIik7cmV0dXJuIGZhbHNlO30NCmlmKCFjb25zb2xlV2luZG93TG9hZGVkJiZpc0xvYWRlZChwb3BVcCkpe2NvbnNvbGVXaW5kb3dMb2FkZWQ9dHJ1ZTt9fQ0KcmV0dXJuIGlzU3VwcG9ydGVkJiZjb25zb2xlV2luZG93TG9hZGVkJiYhY29uc29sZUNsb3NlZDt9O30NCnRoaXMuZ2V0Q29uc29sZVdpbmRvdz1nZXRDb25zb2xlV2luZG93O307Q29uc29sZUFwcGVuZGVyLmFkZEdsb2JhbENvbW1hbmRMaW5lRnVuY3Rpb249ZnVuY3Rpb24oZnVuY3Rpb25OYW1lLGNvbW1hbmRMaW5lRnVuY3Rpb24pe2RlZmF1bHRDb21tYW5kTGluZUZ1bmN0aW9ucy5wdXNoKFtmdW5jdGlvbk5hbWUsY29tbWFuZExpbmVGdW5jdGlvbl0pO307ZnVuY3Rpb24gUG9wVXBBcHBlbmRlcihsYXp5SW5pdCxpbml0aWFsbHlNaW5pbWl6ZWQsdXNlRG9jdW1lbnRXcml0ZSx3aWR0aCxoZWlnaHQpe3RoaXMuY3JlYXRlKGZhbHNlLG51bGwsbGF6eUluaXQsaW5pdGlhbGx5TWluaW1pemVkLHVzZURvY3VtZW50V3JpdGUsd2lkdGgsaGVpZ2h0LHRoaXMuZGVmYXVsdHMuZm9jdXNQb3BVcCk7fQ0KUG9wVXBBcHBlbmRlci5wcm90b3R5cGU9bmV3IENvbnNvbGVBcHBlbmRlcigpO1BvcFVwQXBwZW5kZXIucHJvdG90eXBlLmRlZmF1bHRzPXtsYXlvdXQ6bmV3IFBhdHRlcm5MYXlvdXQoIiVke0hIOm1tOnNzfSAlLTVwIC0gJW17MX0lbiIpLGluaXRpYWxseU1pbmltaXplZDpmYWxzZSxmb2N1c1BvcFVwOmZhbHNlLGxhenlJbml0OnRydWUsdXNlT2xkUG9wVXA6dHJ1ZSxjb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZzp0cnVlLG5ld2VzdE1lc3NhZ2VBdFRvcDpmYWxzZSxzY3JvbGxUb0xhdGVzdE1lc3NhZ2U6dHJ1ZSx3aWR0aDoiNjAwIixoZWlnaHQ6IjQwMCIscmVvcGVuV2hlbkNsb3NlZDpmYWxzZSxtYXhNZXNzYWdlczpudWxsLHNob3dDb21tYW5kTGluZTp0cnVlLGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg6MSxzaG93SGlkZUJ1dHRvbjpmYWxzZSxzaG93Q2xvc2VCdXR0b246dHJ1ZSxzaG93TG9nRW50cnlEZWxldGVCdXR0b25zOnRydWUsdXNlRG9jdW1lbnRXcml0ZTp0cnVlfTtQb3BVcEFwcGVuZGVyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJQb3BVcEFwcGVuZGVyIjt9O2xvZzRqYXZhc2NyaXB0LlBvcFVwQXBwZW5kZXI9UG9wVXBBcHBlbmRlcjtmdW5jdGlvbiBJblBhZ2VBcHBlbmRlcihjb250YWluZXIsbGF6eUluaXQsaW5pdGlhbGx5TWluaW1pemVkLHVzZURvY3VtZW50V3JpdGUsd2lkdGgsaGVpZ2h0KXt0aGlzLmNyZWF0ZSh0cnVlLGNvbnRhaW5lcixsYXp5SW5pdCxpbml0aWFsbHlNaW5pbWl6ZWQsdXNlRG9jdW1lbnRXcml0ZSx3aWR0aCxoZWlnaHQsZmFsc2UpO30NCkluUGFnZUFwcGVuZGVyLnByb3RvdHlwZT1uZXcgQ29uc29sZUFwcGVuZGVyKCk7SW5QYWdlQXBwZW5kZXIucHJvdG90eXBlLmRlZmF1bHRzPXtsYXlvdXQ6bmV3IFBhdHRlcm5MYXlvdXQoIiVke0hIOm1tOnNzfSAlLTVwIC0gJW17MX0lbiIpLGluaXRpYWxseU1pbmltaXplZDpmYWxzZSxsYXp5SW5pdDp0cnVlLG5ld2VzdE1lc3NhZ2VBdFRvcDpmYWxzZSxzY3JvbGxUb0xhdGVzdE1lc3NhZ2U6dHJ1ZSx3aWR0aDoiMTAwJSIsaGVpZ2h0OiIyMjBweCIsbWF4TWVzc2FnZXM6bnVsbCxzaG93Q29tbWFuZExpbmU6dHJ1ZSxjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoOjEsc2hvd0hpZGVCdXR0b246ZmFsc2Usc2hvd0Nsb3NlQnV0dG9uOmZhbHNlLHNob3dMb2dFbnRyeURlbGV0ZUJ1dHRvbnM6dHJ1ZSx1c2VEb2N1bWVudFdyaXRlOnRydWV9O0luUGFnZUFwcGVuZGVyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJJblBhZ2VBcHBlbmRlciI7fTtsb2c0amF2YXNjcmlwdC5JblBhZ2VBcHBlbmRlcj1JblBhZ2VBcHBlbmRlcjtsb2c0amF2YXNjcmlwdC5JbmxpbmVBcHBlbmRlcj1JblBhZ2VBcHBlbmRlcjt9KSgpO2Z1bmN0aW9uIHBhZFdpdGhTcGFjZXMoc3RyLGxlbil7aWYoc3RyLmxlbmd0aDxsZW4pe3ZhciBzcGFjZXM9W107dmFyIG51bWJlck9mU3BhY2VzPU1hdGgubWF4KDAsbGVuLXN0ci5sZW5ndGgpO2Zvcih2YXIgaT0wO2k8bnVtYmVyT2ZTcGFjZXM7aSsrKXtzcGFjZXNbaV09IiAiO30NCnN0cis9c3BhY2VzLmpvaW4oIiIpO30NCnJldHVybiBzdHI7fQ0KKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gZGlyKG9iail7dmFyIG1heExlbj0wO2Zvcih2YXIgcCBpbiBvYmope21heExlbj1NYXRoLm1heCh0b1N0cihwKS5sZW5ndGgsbWF4TGVuKTt9DQp2YXIgcHJvcExpc3Q9W107Zm9yKHAgaW4gb2JqKXt2YXIgcHJvcE5hbWVTdHI9IiAgIitwYWRXaXRoU3BhY2VzKHRvU3RyKHApLG1heExlbisyKTt2YXIgcHJvcFZhbDt0cnl7cHJvcFZhbD1zcGxpdEludG9MaW5lcyh0b1N0cihvYmpbcF0pKS5qb2luKHBhZFdpdGhTcGFjZXMobmV3TGluZSxtYXhMZW4rNikpO31jYXRjaChleCl7cHJvcFZhbD0iW0Vycm9yIG9idGFpbmluZyBwcm9wZXJ0eS4gRGV0YWlsczogIitnZXRFeGNlcHRpb25NZXNzYWdlKGV4KSsiXSI7fQ0KcHJvcExpc3QucHVzaChwcm9wTmFtZVN0citwcm9wVmFsKTt9DQpyZXR1cm4gcHJvcExpc3Quam9pbihuZXdMaW5lKTt9DQp2YXIgbm9kZVR5cGVzPXtFTEVNRU5UX05PREU6MSxBVFRSSUJVVEVfTk9ERToyLFRFWFRfTk9ERTozLENEQVRBX1NFQ1RJT05fTk9ERTo0LEVOVElUWV9SRUZFUkVOQ0VfTk9ERTo1LEVOVElUWV9OT0RFOjYsUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOjcsQ09NTUVOVF9OT0RFOjgsRE9DVU1FTlRfTk9ERTo5LERPQ1VNRU5UX1RZUEVfTk9ERToxMCxET0NVTUVOVF9GUkFHTUVOVF9OT0RFOjExLE5PVEFUSU9OX05PREU6MTJ9O3ZhciBwcmVGb3JtYXR0ZWRFbGVtZW50cz1bInNjcmlwdCIsInByZSJdO3ZhciBlbXB0eUVsZW1lbnRzPVsiYnIiLCJpbWciLCJociIsInBhcmFtIiwibGluayIsImFyZWEiLCJpbnB1dCIsImNvbCIsImJhc2UiLCJtZXRhIl07dmFyIGluZGVudGF0aW9uVW5pdD0iICAiO2Z1bmN0aW9uIGdldFhodG1sKHJvb3ROb2RlLGluY2x1ZGVSb290Tm9kZSxpbmRlbnRhdGlvbixzdGFydE5ld0xpbmUscHJlZm9ybWF0dGVkKXtpbmNsdWRlUm9vdE5vZGU9KHR5cGVvZiBpbmNsdWRlUm9vdE5vZGU9PSJ1bmRlZmluZWQiKT90cnVlOihpbmNsdWRlUm9vdE5vZGU/dHJ1ZTpmYWxzZSk7aWYodHlwZW9mIGluZGVudGF0aW9uIT0ic3RyaW5nIil7aW5kZW50YXRpb249IiI7fQ0Kc3RhcnROZXdMaW5lPXN0YXJ0TmV3TGluZT90cnVlOmZhbHNlO3ByZWZvcm1hdHRlZD1wcmVmb3JtYXR0ZWQ/dHJ1ZTpmYWxzZTt2YXIgeGh0bWw7ZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKG5vZGUpe3JldHVybigobm9kZS5ub2RlVHlwZT09bm9kZVR5cGVzLlRFWFRfTk9ERSkmJi9eWyBcdFxyXG5dKiQvLnRlc3Qobm9kZS5ub2RlVmFsdWUpKTt9DQpmdW5jdGlvbiBmaXhBdHRyaWJ1dGVWYWx1ZShhdHRyVmFsdWUpe3JldHVybiBhdHRyVmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKC9cJi9nLCImYW1wOyIpLnJlcGxhY2UoLzwvZywiJmx0OyIpLnJlcGxhY2UoL1wiL2csIiZxdW90OyIpO30NCmZ1bmN0aW9uIGdldFN0eWxlQXR0cmlidXRlVmFsdWUoZWwpe3ZhciBzdHlsZVBhaXJzPWVsLnN0eWxlLmNzc1RleHQuc3BsaXQoIjsiKTt2YXIgc3R5bGVWYWx1ZT0iIjt2YXIgaXNGaXJzdD10cnVlO2Zvcih2YXIgaj0wLGxlbj1zdHlsZVBhaXJzLmxlbmd0aDtqPGxlbjtqKyspe3ZhciBuYW1lVmFsdWVCaXRzPXN0eWxlUGFpcnNbal0uc3BsaXQoIjoiKTt2YXIgcHJvcHM9W107aWYoIS9eXHMqJC8udGVzdChuYW1lVmFsdWVCaXRzWzBdKSl7cHJvcHMucHVzaCh0cmltKG5hbWVWYWx1ZUJpdHNbMF0pLnRvTG93ZXJDYXNlKCkrIjoiK3RyaW0obmFtZVZhbHVlQml0c1sxXSkpO30NCnN0eWxlVmFsdWU9cHJvcHMuam9pbigiOyIpO30NCnJldHVybiBzdHlsZVZhbHVlO30NCmZ1bmN0aW9uIGdldE5hbWVzcGFjZShlbCl7aWYoZWwucHJlZml4KXtyZXR1cm4gZWwucHJlZml4O31lbHNlIGlmKGVsLm91dGVySFRNTCl7dmFyIHJlZ2V4PW5ldyBSZWdFeHAoIjwoW146XSspOiIrZWwudGFnTmFtZSsiW14+XSo+IiwiaSIpO2lmKHJlZ2V4LnRlc3QoZWwub3V0ZXJIVE1MKSl7cmV0dXJuIFJlZ0V4cC4kMS50b0xvd2VyQ2FzZSgpO319DQpyZXR1cm4iIjt9DQp2YXIgbHQ9IjwiO3ZhciBndD0iPiI7aWYoaW5jbHVkZVJvb3ROb2RlJiZyb290Tm9kZS5ub2RlVHlwZSE9bm9kZVR5cGVzLkRPQ1VNRU5UX0ZSQUdNRU5UX05PREUpe3N3aXRjaChyb290Tm9kZS5ub2RlVHlwZSl7Y2FzZSBub2RlVHlwZXMuRUxFTUVOVF9OT0RFOnZhciB0YWdOYW1lPXJvb3ROb2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTt4aHRtbD1zdGFydE5ld0xpbmU/bmV3TGluZStpbmRlbnRhdGlvbjoiIjt4aHRtbCs9bHQ7dmFyIHByZWZpeD1nZXROYW1lc3BhY2Uocm9vdE5vZGUpO3ZhciBoYXNQcmVmaXg9cHJlZml4P3RydWU6ZmFsc2U7aWYoaGFzUHJlZml4KXt4aHRtbCs9cHJlZml4KyI6Ijt9DQp4aHRtbCs9dGFnTmFtZTtmb3IoaT0wLGxlbj1yb290Tm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDtpPGxlbjtpKyspe3ZhciBjdXJyZW50QXR0cj1yb290Tm9kZS5hdHRyaWJ1dGVzW2ldO2lmKCFjdXJyZW50QXR0ci5zcGVjaWZpZWR8fGN1cnJlbnRBdHRyLm5vZGVWYWx1ZT09PW51bGx8fGN1cnJlbnRBdHRyLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0ic3R5bGUifHx0eXBlb2YgY3VycmVudEF0dHIubm9kZVZhbHVlIT09InN0cmluZyJ8fGN1cnJlbnRBdHRyLm5vZGVOYW1lLmluZGV4T2YoIl9tb3oiKT09PTApe2NvbnRpbnVlO30NCnhodG1sKz0iICIrY3VycmVudEF0dHIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSsiPVwiIjt4aHRtbCs9Zml4QXR0cmlidXRlVmFsdWUoY3VycmVudEF0dHIubm9kZVZhbHVlKTt4aHRtbCs9IlwiIjt9DQppZihyb290Tm9kZS5zdHlsZS5jc3NUZXh0KXt2YXIgc3R5bGVWYWx1ZT1nZXRTdHlsZUF0dHJpYnV0ZVZhbHVlKHJvb3ROb2RlKTtpZihzdHlsZVZhbHVlIT09IiIpe3hodG1sKz0iIHN0eWxlPVwiIitnZXRTdHlsZUF0dHJpYnV0ZVZhbHVlKHJvb3ROb2RlKSsiXCIiO319DQppZihhcnJheV9jb250YWlucyhlbXB0eUVsZW1lbnRzLHRhZ05hbWUpfHwoaGFzUHJlZml4JiYhcm9vdE5vZGUuaGFzQ2hpbGROb2RlcygpKSl7eGh0bWwrPSIvIitndDt9ZWxzZXt4aHRtbCs9Z3Q7dmFyIGNoaWxkU3RhcnROZXdMaW5lPSEocm9vdE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZyb290Tm9kZS5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlPT09bm9kZVR5cGVzLlRFWFRfTk9ERSk7dmFyIGNoaWxkUHJlZm9ybWF0dGVkPWFycmF5X2NvbnRhaW5zKHByZUZvcm1hdHRlZEVsZW1lbnRzLHRhZ05hbWUpO2Zvcih2YXIgaT0wLGxlbj1yb290Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtpPGxlbjtpKyspe3hodG1sKz1nZXRYaHRtbChyb290Tm9kZS5jaGlsZE5vZGVzW2ldLHRydWUsaW5kZW50YXRpb24raW5kZW50YXRpb25Vbml0LGNoaWxkU3RhcnROZXdMaW5lLGNoaWxkUHJlZm9ybWF0dGVkKTt9DQp2YXIgZW5kVGFnPWx0KyIvIit0YWdOYW1lK2d0O3hodG1sKz1jaGlsZFN0YXJ0TmV3TGluZT9uZXdMaW5lK2luZGVudGF0aW9uK2VuZFRhZzplbmRUYWc7fQ0KcmV0dXJuIHhodG1sO2Nhc2Ugbm9kZVR5cGVzLlRFWFRfTk9ERTppZihpc1doaXRlc3BhY2Uocm9vdE5vZGUpKXt4aHRtbD0iIjt9ZWxzZXtpZihwcmVmb3JtYXR0ZWQpe3hodG1sPXJvb3ROb2RlLm5vZGVWYWx1ZTt9ZWxzZXt2YXIgbGluZXM9c3BsaXRJbnRvTGluZXModHJpbShyb290Tm9kZS5ub2RlVmFsdWUpKTt2YXIgdHJpbW1lZExpbmVzPVtdO2Zvcih2YXIgaT0wLGxlbj1saW5lcy5sZW5ndGg7aTxsZW47aSsrKXt0cmltbWVkTGluZXNbaV09dHJpbShsaW5lc1tpXSk7fQ0KeGh0bWw9dHJpbW1lZExpbmVzLmpvaW4obmV3TGluZStpbmRlbnRhdGlvbik7fQ0KaWYoc3RhcnROZXdMaW5lKXt4aHRtbD1uZXdMaW5lK2luZGVudGF0aW9uK3hodG1sO319DQpyZXR1cm4geGh0bWw7Y2FzZSBub2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFOnJldHVybiI8IVtDREEiKyJUQVsiK3Jvb3ROb2RlLm5vZGVWYWx1ZSsiXSIrIl0+IituZXdMaW5lO2Nhc2Ugbm9kZVR5cGVzLkRPQ1VNRU5UX05PREU6eGh0bWw9IiI7Zm9yKHZhciBpPTAsbGVuPXJvb3ROb2RlLmNoaWxkTm9kZXMubGVuZ3RoO2k8bGVuO2krKyl7eGh0bWwrPWdldFhodG1sKHJvb3ROb2RlLmNoaWxkTm9kZXNbaV0sdHJ1ZSxpbmRlbnRhdGlvbik7fQ0KcmV0dXJuIHhodG1sO2RlZmF1bHQ6cmV0dXJuIiI7fX1lbHNle3hodG1sPSIiO2Zvcih2YXIgaT0wLGxlbj1yb290Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtpPGxlbjtpKyspe3hodG1sKz1nZXRYaHRtbChyb290Tm9kZS5jaGlsZE5vZGVzW2ldLHRydWUsaW5kZW50YXRpb24raW5kZW50YXRpb25Vbml0KTt9DQpyZXR1cm4geGh0bWw7fX0NCnZhciBsYXlvdXRzPXt9O2Z1bmN0aW9uIGNyZWF0ZUNvbW1hbmRMaW5lRnVuY3Rpb25zKGFwcGVuZGVyKXtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbigiJCIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7cmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGFyZ3NbMF0pO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJkaXIiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciBsaW5lcz1bXTtmb3IodmFyIGk9MCxsZW49YXJncy5sZW5ndGg7aTxsZW47aSsrKXtsaW5lc1tpXT1kaXIoYXJnc1tpXSk7fQ0KcmV0dXJuIGxpbmVzLmpvaW4obmV3TGluZStuZXdMaW5lKTt9KTtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbigiZGlyeG1sIixmdW5jdGlvbihhcHBlbmRlcixhcmdzLHJldHVyblZhbHVlKXt2YXIgbGluZXM9W107Zm9yKHZhciBpPTAsbGVuPWFyZ3MubGVuZ3RoO2k8bGVuO2krKyl7dmFyIHdpbj1hcHBlbmRlci5nZXRDb21tYW5kV2luZG93KCk7bGluZXNbaV09Z2V0WGh0bWwoYXJnc1tpXSk7fQ0KcmV0dXJuIGxpbmVzLmpvaW4obmV3TGluZStuZXdMaW5lKTt9KTtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbigiY2QiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciB3aW4sbWVzc2FnZTtpZihhcmdzLmxlbmd0aD09PTB8fGFyZ3NbMF09PT0iIil7d2luPXdpbmRvdzttZXNzYWdlPSJDb21tYW5kIGxpbmUgc2V0IHRvIHJ1biBpbiBtYWluIHdpbmRvdyI7fWVsc2V7aWYoYXJnc1swXS53aW5kb3c9PWFyZ3NbMF0pe3dpbj1hcmdzWzBdO21lc3NhZ2U9IkNvbW1hbmQgbGluZSBzZXQgdG8gcnVuIGluIGZyYW1lICciK2FyZ3NbMF0ubmFtZSsiJyI7fWVsc2V7d2luPXdpbmRvdy5mcmFtZXNbYXJnc1swXV07aWYod2luKXttZXNzYWdlPSJDb21tYW5kIGxpbmUgc2V0IHRvIHJ1biBpbiBmcmFtZSAnIithcmdzWzBdKyInIjt9ZWxzZXtyZXR1cm5WYWx1ZS5pc0Vycm9yPXRydWU7bWVzc2FnZT0iRnJhbWUgJyIrYXJnc1swXSsiJyBkb2VzIG5vdCBleGlzdCI7d2luPWFwcGVuZGVyLmdldENvbW1hbmRXaW5kb3coKTt9fX0NCmFwcGVuZGVyLnNldENvbW1hbmRXaW5kb3cod2luKTtyZXR1cm4gbWVzc2FnZTt9KTtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbigiY2xlYXIiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3JldHVyblZhbHVlLmFwcGVuZFJlc3VsdD1mYWxzZTthcHBlbmRlci5jbGVhcigpO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJrZXlzIixmdW5jdGlvbihhcHBlbmRlcixhcmdzLHJldHVyblZhbHVlKXt2YXIga2V5cz1bXTtmb3IodmFyIGsgaW4gYXJnc1swXSl7a2V5cy5wdXNoKGspO30NCnJldHVybiBrZXlzO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJ2YWx1ZXMiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciB2YWx1ZXM9W107Zm9yKHZhciBrIGluIGFyZ3NbMF0pe3RyeXt2YWx1ZXMucHVzaChhcmdzWzBdW2tdKTt9Y2F0Y2goZXgpe2xvZ0xvZy53YXJuKCJ2YWx1ZXMoKTogVW5hYmxlIHRvIG9idGFpbiB2YWx1ZSBmb3Iga2V5ICIraysiLiBEZXRhaWxzOiAiK2dldEV4Y2VwdGlvbk1lc3NhZ2UoZXgpKTt9fQ0KcmV0dXJuIHZhbHVlczt9KTtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbigiZXhwYW5zaW9uRGVwdGgiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciBleHBhbnNpb25EZXB0aD1wYXJzZUludChhcmdzWzBdLDEwKTtpZihpc05hTihleHBhbnNpb25EZXB0aCl8fGV4cGFuc2lvbkRlcHRoPDApe3JldHVyblZhbHVlLmlzRXJyb3I9dHJ1ZTtyZXR1cm4iIithcmdzWzBdKyIgaXMgbm90IGEgdmFsaWQgZXhwYW5zaW9uIGRlcHRoIjt9ZWxzZXthcHBlbmRlci5zZXRDb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoKGV4cGFuc2lvbkRlcHRoKTtyZXR1cm4iT2JqZWN0IGV4cGFuc2lvbiBkZXB0aCBzZXQgdG8gIitleHBhbnNpb25EZXB0aDt9fSk7fQ0KZnVuY3Rpb24gaW5pdCgpe2NyZWF0ZUNvbW1hbmRMaW5lRnVuY3Rpb25zKCk7aW5pdGlhbGl6ZWQ9dHJ1ZTt9DQppbml0KCk7fSkoKTtmdW5jdGlvbiBhZGRXaW5kb3dMb2FkTGlzdGVuZXIobGlzdGVuZXIpe3ZhciBvbGRPbmxvYWQ9d2luZG93Lm9ubG9hZDtpZih0eXBlb2Ygd2luZG93Lm9ubG9hZCE9ImZ1bmN0aW9uIil7d2luZG93Lm9ubG9hZD1saXN0ZW5lcjt9ZWxzZXt3aW5kb3cub25sb2FkPWZ1bmN0aW9uKGV2dCl7aWYob2xkT25sb2FkKXtvbGRPbmxvYWQoZXZ0KTt9DQpsaXN0ZW5lcihldnQpO307fX0NCmFkZFdpbmRvd0xvYWRMaXN0ZW5lcihmdW5jdGlvbigpe3BhZ2VMb2FkZWQ9dHJ1ZTtsb2c0amF2YXNjcmlwdC5kaXNwYXRjaEV2ZW50KCJsb2FkIix7fSk7fSk7d2luZG93LmxvZzRqYXZhc2NyaXB0PWxvZzRqYXZhc2NyaXB0O30pKCk7CnZhciBPem9uZSA9IE96b25lIHx8IHt9OwoKLyoqCiAqIEBjbGFzcwogKiBAZGVzY3JpcHRpb24gUHJvdmlkZXMgZnVuY3Rpb25zIHRvIGxvZyBtZXNzYWdlcyBhbmQgb2JqZWN0cwogKiBAT3pvbmUubG9nCiAqIAogKi8KLyoKICogVGhlIG9ubHkgZnVuY3Rpb24gdGhhdCBjYW4gYmUgY2FsbGVkIGZyb20gZ2FkZ2V0cyBpcyBPem9uZS5sb2cuZ2FkZ2V0TG9nCiAqLwpPem9uZS5sb2cgPSB7CgkKfTsKCk96b25lLmxvZy5sb2dFbmFibGVkID0gZmFsc2U7IAoKT3pvbmUubG9nLmRlZmF1bHRMb2dnZXIgPSBudWxsOyAKT3pvbmUubG9nLmRlZmF1bHRBcHBlbmRlciA9IG51bGw7IAoKT3pvbmUubG9nLnZlcnNpb24gPSBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLmxvZ2dpbmc7CgovKioKICogQE96b25lLmxvZy5nZXRMb2dnZXIKICogQGRlc2NyaXB0aW9uIEdldCBhIGxvZ2dlciBieSBuYW1lLCBpZiB0aGUgbG9nZ2VyIGhhcyBub3QgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgaXQgd2lsbCBiZSBjcmVhdGVkCiAqIEBwYXJhbSB7U3RyaW5nfSBsb2dnZXJOYW1lCiAqLwpPem9uZS5sb2cuZ2V0TG9nZ2VyID0gZnVuY3Rpb24obG9nZ2VyTmFtZSkgeyAKICAgIHJldHVybiBsb2c0amF2YXNjcmlwdC5nZXRMb2dnZXIobG9nZ2VyTmFtZSk7Cn07CgovKioKICogQE96b25lLmxvZy5zZXRFbmFibGVkCiAqIEBkZXNjcmlwdGlvbiBFbmFibGUvRGlzYWJsZSBsb2dnaW5nIGZvciB0aGUgT1dGIGFwcGxpY2F0aW9uCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZW5hYmxlZCB0cnVlIHdpbGwgZW5hYmxlIGxvZ2dpbmcgZmFsc2Ugd2lsbCBkaXNhYmxlCiAqLwpPem9uZS5sb2cuc2V0RW5hYmxlZCA9IGZ1bmN0aW9uKGVuYWJsZWQpewoJbG9nNGphdmFzY3JpcHQuc2V0RW5hYmxlZChlbmFibGVkKTsKfTsKCi8qKgogKiBAT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIKICogQGRlc2NyaXB0aW9uIEdldCBPV0YncyBkZWZhdWx0IGxvZ2dlcgogKi8KLy9UaGUgZGVmYXVsdCBsb2dnZXIgY2Fubm90IGJlIHVzZWQgZnJvbSBnYWRnZXRzCk96b25lLmxvZy5nZXREZWZhdWx0TG9nZ2VyID0gZnVuY3Rpb24oKSB7CglpZiAoIU96b25lLmxvZy5kZWZhdWx0TG9nZ2VyKSB7CgkJCgkKCQl2YXIgZGVmYXVsdExvZ2dlck5hbWUgPSAiW296b25lZGVmYXVsdF0iOyAKCQkKCQlPem9uZS5sb2cuZGVmYXVsdExvZ2dlciA9ICBPem9uZS5sb2cuZ2V0TG9nZ2VyKGRlZmF1bHRMb2dnZXJOYW1lKTsKCQlPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyID0gbmV3IGxvZzRqYXZhc2NyaXB0LlBvcFVwQXBwZW5kZXIoKTsKCQlPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyLnNldFVzZU9sZFBvcFVwKHRydWUpOwoJCU96b25lLmxvZy5kZWZhdWx0QXBwZW5kZXIuc2V0Q29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmcoZmFsc2UpOwoJCS8vIGNoYW5nZSB0aGUgbG9nZ2luZyBsZXZlbCBoZXJlLCBmb3IgZXhhbXBsZToKCQkvLyBPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyLnNldFRocmVzaG9sZChsb2c0amF2YXNjcmlwdC5MZXZlbC5FUlJPUik7CiAgICAgICAgT3pvbmUubG9nLmRlZmF1bHRBcHBlbmRlci5zZXRUaHJlc2hvbGQobG9nNGphdmFzY3JpcHQuTGV2ZWwuT0ZGKTsKCQlsb2c0amF2YXNjcmlwdC5nZXRSb290TG9nZ2VyKCkuYWRkQXBwZW5kZXIoT3pvbmUubG9nLmRlZmF1bHRBcHBlbmRlcik7CgkJLy9Pem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyLnNldEluaXRpYWxseU1pbmltaXplZCh0cnVlKTsKCQkKCQlyZXR1cm4gT3pvbmUubG9nLmRlZmF1bHRMb2dnZXI7Cgl9IAoJCglyZXR1cm4gT3pvbmUubG9nLmRlZmF1bHRMb2dnZXI7Cn07CgovKioKICogQGRlc2NyaXB0aW9uIExhdW5jaCB0aGUgbG9nIHdpbmRvdyBwb3AtdXAsIHRoaXMgd2lsbCByZS1sYXVuY2ggdGhlIHdpbmRvdyBpbiB0aGUgZXZlbnQgCiAqIGl0IGhhcyBiZWVuIGNsb3NlZAogKi8KT3pvbmUubG9nLmxhdW5jaFBvcHVwQXBwZW5kZXIgPSBmdW5jdGlvbigpIHsKCQoJT3pvbmUubG9nLmRlZmF1bHRBcHBlbmRlci5zaG93KCk7CgkKCU96b25lLmxvZy5nZXREZWZhdWx0TG9nZ2VyKCkuZGVidWcoIkxvZ2dlciBXaW5kb3cgTGF1Y2hlZCIpOwp9OwoKCi8qCiAqIExvZyBtZXNzYWdlcyBmcm9tIHdpZGdldHMKICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UKICovCk96b25lLmxvZy53aWRnZXRMb2cgPSBmdW5jdGlvbigpIHsgCiAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdPem9uZS5sb2cnLG51bGwsIGFyZ3VtZW50cyk7Cn07CgoKaWYgKHR5cGVvZihFeHQpICE9ICJ1bmRlZmluZWQiKSB7CglFeHQub25SZWFkeShmdW5jdGlvbigpewoJCWdhZGdldHMucnBjLnJlZ2lzdGVyKCdPem9uZS5sb2cnLCBmdW5jdGlvbihhcmdzKXsKCQkJdmFyIGxvZ2dlciA9IE96b25lLmxvZy5nZXREZWZhdWx0TG9nZ2VyKCk7IAoJCQlsb2dnZXIuZGVidWcuYXBwbHkobG9nZ2VyLCBhcmdzKTsKCQl9KTsKCX0pOwp9CgovKioNCiAqIEBmaWxlb3ZlcnZpZXcgVGhlIHByZWZlcmVuY2Ugc2VydmVyIHNjcmlwdCBjb250cm9scyBhbGwgdGhlIHByZWZlcmVuY2Ugc2VydmVyIGNvbW11bmljYXRpb24uDQogKi8NCg0KDQoNCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKi8NCk96b25lLnByZWYgPSBPem9uZS5wcmVmIHx8IHt9Ow0KDQooZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQogIC8qKg0KICAgKiBAY29uc3RydWN0b3IgIE5vbmUsIHRoaXMgaXMgYSBTaW5nbGV0b24NCiAgICogQGRlc2NyaXB0aW9uIFRoaXMgb2JqZWN0IGlzIHVzZWQgdG8gY3JlYXRlLCByZXRyaWV2ZSwgdXBkYXRlIGFuZCBkZWxldGUgdXNlciBwcmVmZXJlbmNlcy4gQSB1c2VyIHByZWZlcmVuY2UgaXMgc2ltcGx5IGEgc3RyaW5nDQogICAqIHN0b3JlZCBpbiBPV0YgdGhhdCBpcyB1bmlxdWVseSBtYXBwZWQgdG8gYSB1c2VyLCBuYW1lc3BhY2UsIGFuZCBuYW1lIGNvbWJpbmF0aW9uLg0KICAgKiA8YnI+PGJyPg0KICAgKiBBbGwgcHVibGljIG1ldGhvZHMgb2YgdGhpcyBjbGFzcyBhY2NlcHQgYW4gb25TdWNjZXNzIGZ1bmN0aW9uLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVwb24gc3VjY2Vzc2Z1bCBjb21wbGV0aW9uIG9mIHRoZSByZXF1ZXN0ZWQgb3BlcmF0aW9uIGFuZCBpcyBwYXNzZWQgYSBjb3B5IG9mIHRoZSBwcmVmZXJlbmNlIG9iamVjdC4NCiAgICogQGV4YW1wbGUNCiAgICogVGhlIGZvbGxvd2luZyBpcyBhbiBleGFtcGxlIG9mIGEgcHJlZmVyZW5jZSBvYmplY3QgcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MNCiAgICogZnVuY3Rpb246DQogICAqDQogICAqIHsNCiAgICogICAgICJ2YWx1ZSI6InRydWUiLA0KICAgKiAgICAgInBhdGgiOiJtaWxpdGFyeVRpbWUiLA0KICAgKiAgICAgInVzZXIiOg0KICAgKiAgICAgew0KICAgKiAgICAgICAgICJ1c2VySWQiOiJ0ZXN0QWRtaW4xIg0KICAgKiAgICAgfSwNCiAgICogICAgICJuYW1lc3BhY2UiOiJjb20ubXljb21wYW55LkFubm91bmNpbmdDbG9jayINCiAgICogfQ0KICAgKg0KICAgKiBXaGVyZToNCiAgICoNCiAgICogdmFsdWU6IFRoZSBwcmVmZXJlbmNlIHZhbHVlIHRoYXQgaXMgc3RvcmVkIGluIHRoZSBkYXRhYmFzZS4gVGhpcyBjYW4gYmUgYW55IHN0cmluZw0KICAgKiAgICAgICAgaW5jbHVkaW5nIEpTT04uDQogICAqIHBhdGg6IFRoZSBuYW1lIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UuDQogICAqIHVzZXI6IFRoZSB1c2VyIG9iamVjdC4gVGhlIG9ubHkgdXNlciBpbmZvcm1hdGlvbiByZXR1cm5lZCBhdCB0aGlzIHRpbWUgaXMgdGhlIHVzZXINCiAgICogICAgICAgSUQuDQogICAqIG5hbWVzcGFjZTogVGhlIG5hbWVzcGFjZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXIgcHJlZmVyZW5jZS4NCiAgICoNCiAgICogQHJlcXVpcmVzIE96b25lLnV0aWwuVHJhbnNwb3J0DQogICAqLw0KICBPem9uZS5wcmVmLlByZWZTZXJ2ZXIgPSBmdW5jdGlvbihfdXJsKSB7DQogICAgICBpZiAoIF91cmwgPT09IHVuZGVmaW5lZCB8fCBfdXJsID09PSAibnVsbCIgfHwgIF91cmwuaW5kZXhPZignJCcpICE9PSAtMSB8fCBfdXJsLmxlbmd0aCA9PT0gMCApIHsNCiAgICAgICAgICAvLyBkZWZhdWx0IGluY2FzZSBubyBwcmVmTG9jYXRpb24gaXMgZ2l2ZW4NCiAgICAgICAgICAvLyB1Z2x5IGFsZXJ0IG1lc3NhZ2UsIGJ1dCBsZXQncyBmYWlsIGZhc3QNCiAgICAgICAgICAgLy8gYWxlcnQoInByZWZzTG9jYXRpb24gaXMgbnVsbCBvciBpbmNvcnJlY3QuICBQZXJoYXBzIGluIHRoZSBPd2ZDb25maWcueG1sIGZpbGU/Iik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vU3RyaXAgb2ZmIGEgdHJhaWxpbmcgc2xhc2guDQogICAgICAgICAgaWYgKF91cmwubGFzdEluZGV4T2YoIi8iKSA9PT0gKF91cmwubGVuZ3RoIC0xKSkgew0KICAgICAgICAgICAgICBfdXJsID0gX3VybC5zdWJzdHJpbmcoMCxfdXJsLmxlbmd0aC0xKTsNCiAgICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8qKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIExvb2sgdXAgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIHVybC4gVGhpcyBzaG91bGQgZ2VuZXJhbGx5IG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIHJhdGhlciwgYW4gZW50aXR5LXNwZWNpZmljIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLg0KICAgICAgICogQHJldHVybiBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHJlcXVlc3RlZCBwcmVmZXJlbmNlDQogICAgICAgKiBAcGFyYW0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCB1cmwgdG8gYmUgdXNlZCBpbiB0aGUgY2FsbA0KICAgICAgICogQHBhcmFtIGNmZy5vblN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQNCiAgICAgICAqIEBwYXJhbSBjZmcub25GYWlsdXJlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgaXMgcHJvdmlkZWQpDQogICAgICAgKiBAcGFyYW0gY2ZnLmlnbm9yZWRFcnJvckNvZGVzIGFsbG93cyB0aGUgY2FsbGVyIHRvIGlnbm9yZSBjZXJ0YWluIGh0dHAgZXJyb3IgY29kZXMuICBJZiB0aGV5IG9jY3VyIG9uc3VjY2VzcyB3aWxsIGJlIGNhbGxlZCB3aXRoIGEgbnVsbCBwYXlsb2FkDQogICAgICAgKg0KICAgICAgICogQGV4YW1wbGUgdmFyIHByZWZzID0gbmV3IE96b25lLnByZWYuUHJlZnMoKTsNCiAgICAgICAqDQogICAgICAgKiB2YXIgbXlzdWNjZXNzID0gZnVuY3Rpb24ocmVzdWx0KXsNCiAgICAgICAqICAgICAgICAgdGhpcy52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAqICAgICAgICAgYWxlcnQocmVzdWx0KTsNCiAgICAgICAqICAgICAgICAgYWxlcnQocmVzdWx0LnZhbHVlKTsNCiAgICAgICAqDQogICAgICAgKiBnZXRWYWx1ZSh7dXJsOl91cmwgKyAiLyIgKyBuYW1lc3BhY2UgKyAiLyIgKyBwYXRoLCBvblN1Y2Nlc3M6b25TdWNjZXNzQ2FsbGJhY2ssIG9uRmFpbHVyZTpvbkZhaWxDYWxsYmFja30pOw0KICAgICAgICoNCiAgICAgICAqLw0KICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICBjZmcubWV0aG9kID0gIkdFVCI7DQogICAgICAgICAgY2ZnLmFzeW5jID0gdHJ1ZTsNCiAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICB9Ow0KDQogICAgICAvKiogQHByaXZhdGUNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBEZWxldGUgaW5zdGFuY2Ugb2YgdGhlIGdpdmVuIHVybC4gVGhpcyBzaG91bGQgZ2VuZXJhbGx5IG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIHJhdGhlciwgYW4gZW50aXR5LXNwZWNpZmljIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLg0KICAgICAgICogQHBhcmFtIGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIGNmZy51cmwgdXJsIHRvIGJlIHVzZWQgaW4gdGhlIGNhbGwNCiAgICAgICAqIEBwYXJhbSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0DQogICAgICAgKiBAcGFyYW0gY2ZnLm9uRmFpbHVyZSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IGlzIHByb3ZpZGVkKQ0KICAgICAgICoNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ocmVzdWx0KXsNCiAgICAgICAqICAgICAgICAgdGhpcy52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAqICAgICAgICAgYWxlcnQocmVzdWx0KTsNCiAgICAgICAqIH0NCiAgICAgICAqDQogICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7DQogICAgICAgKiAgIGFsZXJ0KCJUaGVyZSB3YXMgYW4gZXJyb3I6ICIgKyBlcnIpOw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIGRlbGV0ZUJhc2Uoe3VybDpfdXJsICsgIi8iICsgbmFtZXNwYWNlICsgIi8iICsgcGF0aCwgb25TdWNjZXNzOm9uU3VjY2Vzc0NhbGxiYWNrLCBvbkZhaWx1cmU6b25GYWlsQ2FsbGJhY2t9KTsNCiAgICAgICAqLw0KICAgICAgdmFyIGRlbGV0ZUJhc2UgPSBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgY2ZnLm1ldGhvZCA9ICdERUxFVEUnOw0KICAgICAgICAgIHNldFZhbHVlKGNmZyk7DQogICAgICB9Ow0KDQogICAgICAvKiogQHByaXZhdGUNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXQgYW4gYXJyYXkgb2Ygb2JqZWN0IGZvciB0aGUgcmVxdWVzdGVkIG5hbWVzcGFjZQ0KICAgICAgICogQHBhcmFtIGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIGNmZy51cmwgICAgICAgIC0gc3RyaW5nDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uU3VjY2VzcyAgICAgICAgLSBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdA0KICAgICAgICogQHBhcmFtIGNmZy5vbkZhaWx1cmUgICAgICAgIC0gY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ocmVzdWx0KXsNCiAgICAgICAqIAkJdGhpcy52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAqIAkJYWxlcnQocmVzdWx0KTsNCiAgICAgICAqIH0NCiAgICAgICAqDQogICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7DQogICAgICAgKiAgIGFsZXJ0KCJUaGVyZSB3YXMgYW4gZXJyb3I6ICIgKyBlcnIpOw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIGxpc3Qoe25hbWVzcGFjZToibmFtZXNwYWNlMSIsIG9uU3VjY2VzczpvblN1Y2Nlc3MsIG9uRmFpbHVyZTpvbkZhaWx1cmV9KTsNCiAgICAgICAqLw0KICAgICAgdmFyIGxpc3QgPSBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiLyIgKyBjZmcudXJsOw0KICAgICAgICAgIGdldChjZmcpOw0KICAgICAgfTsNCg0KICAgICAgLyoqDQogICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gdXJsLiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZSwgcmF0aGVyLCBhbiBlbnRpdHktc3BlY2lmaWMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQuDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCB1cmwgdG8gYmUgdXNlZCBpbiB0aGUgY2FsbA0KICAgICAgICogQHBhcmFtIGNmZy5jb250ZW50IFRoZSBjb250ZW50IG9mIHRoZSBzZW5kLiBFaXRoZXIgbWFwIG9yIEpTT04gd2l0aCB0aGUgX21ldGhvZCBwcm9wZXJ0eSBhbHJlYWR5IGRlZmluZWQuDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdCAob3B0aW9uYWwpDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uRmFpbHVyZSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IGlzIHByb3ZpZGVkIGlmIGFuIG9uU3VjY2VzcyBjYWxsYmFjayBpcyBwYXNzZWQgaW4pDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3VsdCl7DQogICAgICAgKiAgICAgICAgIHRoaXMudmFsdWUgPSByZXN1bHQ7DQogICAgICAgKiAgICAgICAgIGFsZXJ0KHJlc3VsdCk7ICAvL1RPRE86IHRoZSBwcmVmZXJlbmNlIHNlcnZlciBjdXJyZW50bHkgZG9lc24ndCByZXR1cm4gYW55dGhpbmcNCiAgICAgICAqIH0NCiAgICAgICAqDQogICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7DQogICAgICAgKiAgIGFsZXJ0KCJUaGVyZSB3YXMgYW4gZXJyb3I6ICIgKyBlcnIpOw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIHNldFZhbHVlQmFzZShfdXJsICsgIi8iICsgbmFtZXNwYWNlICsgIi8iICsgcGF0aCwgY29udGVudCwgb25TdWNjZXNzQ2FsbGJhY2ssIG9uRmFpbENhbGxiYWNrKTsNCiAgICAgICAqLw0KICAgICAgdmFyIHNldFZhbHVlQmFzZSA9IGZ1bmN0aW9uKGNmZykNCiAgICAgIHsNCiAgICAgICAgICAgY2ZnLm1ldGhvZCA9IGNmZy5jb250ZW50WyJfbWV0aG9kIl07DQogICAgICAgICAgIGlmIChjZmcub25TdWNjZXNzKSB7DQogICAgICAgICAgICAgIGlmICghY2ZnLm9uRmFpbHVyZSkgeyAgLy9tdXN0IGVuc3VyZSB0aGVyZSBpcyBhbiBvbmZhaWx1cmUgbWV0aG9kLCBhcyB3ZSB1c2luZyBjb250ZW50DQogICAgICAgICAgICAgICAgICBjZmcub25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoT3pvbmUudXRpbC5FcnJvck1lc3NhZ2VTdHJpbmcuc2F2ZVVzZXJQcmVmZXJlbmNlcyArICIgOiAiICsgZXJyKTsNCiAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZChjZmcpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmRBbmRGb3JnZXQoY2ZnKTsNCiAgICAgICAgICB9DQoNCiAgICAgIH07DQoNCiAgICAgIC8qKg0KICAgICAgICogQHByaXZhdGUNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXQgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIHVybC4gVGhpcyBzaG91bGQgZ2VuZXJhbGx5IG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIHJhdGhlciwgYW4gZW50aXR5LXNwZWNpZmljIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLg0KICAgICAgICogQHBhcmFtIGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIGNmZy51cmwgdXJsIHRvIGJlIHVzZWQgaW4gdGhlIGNhbGwNCiAgICAgICAqIEBwYXJhbSBjZmcuanNvbiBUaGUgdmFsdWUgdG8gc3RvcmUuDQogICAgICAgKiBAcGFyYW0gY2ZnLm1ldGhvZCBUaGUgbWV0aG9kIGZvciB0aGUgY2FsbC4gKCdERUxFVEUnLCAnUFVUJykNCiAgICAgICAqIEBwYXJhbSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0IChvcHRpb25hbCkNCiAgICAgICAqIEBwYXJhbSBjZmcub25GYWlsdXJlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgaXMgcHJvdmlkZWQgaWYgYW4gb25TdWNjZXNzIGNhbGxiYWNrIGlzIHBhc3NlZCBpbikNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ocmVzdWx0KXsNCiAgICAgICAqICAgICAgICAgdGhpcy52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAqICAgICAgICAgYWxlcnQocmVzdWx0KTsgIC8vVE9ETzogdGhlIHByZWZlcmVuY2Ugc2VydmVyIGN1cnJlbnRseSBkb2Vzbid0IHJldHVybiBhbnl0aGluZw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAqICAgYWxlcnQoIlRoZXJlIHdhcyBhbiBlcnJvcjogIiArIGVycik7DQogICAgICAgKiB9DQogICAgICAgKg0KICAgICAgICogc2V0VmFsdWUoe3VybDpfdXJsICsgIi8iICsgbmFtZXNwYWNlICsgIi8iICsgcGF0aCwganNvbjp2YWx1ZSwgbWV0aG9kOm1ldGhvZCwgb25TdWNjZXNzOm9uU3VjY2Vzc0NhbGxiYWNrLCBvbkZhaWx1cmU6b25GYWlsQ2FsbGJhY2t9KTsNCiAgICAgICAqLw0KICAgICAgdmFyIHNldFZhbHVlID0gZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgIGlmIChjZmcubWV0aG9kID09IG51bGwpIHsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQVVQnOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHZhciBjb250ZW50ID0gew0KICAgICAgICAgICAgICAnX21ldGhvZCc6IGNmZy5tZXRob2QNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgaWYgKGNmZy5qc29uKSB7DQogICAgICAgICAgICAgIGNvbnRlbnQgPSB7DQogICAgICAgICAgICAgICAgICAnX21ldGhvZCc6IGNmZy5tZXRob2QsDQogICAgICAgICAgICAgICAgICAnbmFtZSc6IGNmZy5qc29uLm5hbWUsDQogICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBjZmcuanNvbi5kZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICAgICdndWlkJzogY2ZnLmpzb24uZ3VpZCwNCiAgICAgICAgICAgICAgICAgICdpc2RlZmF1bHQnOiBjZmcuanNvbi5pc2RlZmF1bHQsDQogICAgICAgICAgICAgICAgICAnbG9ja2VkJzogY2ZnLmpzb24ubG9ja2VkLA0KICAgICAgICAgICAgICAgICAgJ3N0YXRlJzogY2ZnLmpzb24uc3RhdGUsDQogICAgICAgICAgICAgICAgICAnbGF5b3V0Q29uZmlnJzogY2ZnLmpzb24ubGF5b3V0Q29uZmlnLA0KICAgICAgICAgICAgICAgICAgJ3N0YWNrJzogY2ZnLmpzb24uc3RhY2sNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgaWYgKGNmZy5qc29uLmNsb25lZCA9PT0gdHJ1ZSkgY29udGVudC5jbG9uZWQgPSB0cnVlOw0KICAgICAgICAgICAgICBpZiAoY2ZnLmpzb24uYnlwYXNzTGF5b3V0UmVhcnJhbmdlID09PSB0cnVlKSBjb250ZW50LmJ5cGFzc0xheW91dFJlYXJyYW5nZSA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIGNmZy5jb250ZW50ID0gY29udGVudDsNCiAgICAgICAgICBzZXRWYWx1ZUJhc2UoY2ZnKTsNCiAgICAgIH07DQoNCiAgICAgIC8qKg0KICAgICAgICogQHByaXZhdGUNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXQgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIHVybCBieSB1c2luZyBhIEpTT04gb2JqZWN0LCBhbGxvd2luZyBtdWx0aXBsZSBwYXJhbWV0ZXJzIGZvciBQVVQvUE9TVC4gVGhpcyBzaG91bGQgZ2VuZXJhbGx5IG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIHJhdGhlciwgYW4gZW50aXR5LXNwZWNpZmljIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLg0KICAgICAgICogQHBhcmFtIGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIGNmZy51cmwgdXJsIHRvIGJlIHVzZWQgaW4gdGhlIGNhbGwNCiAgICAgICAqIEBwYXJhbSBjZmcuanNvbk9iamVjdCBUaGUgcGFyYW1ldGVycyB0byBwYXNzIGluLiBOb3RlIHRoYXQgdGhlIHZhbHVlIHBhcmFtZXRlciBpcyByZXF1aXJlZCwgYW5kIHRoaXMgaXMgd2hhdCB3aWxsIGJlIHN0b3JlZCBpbiB0aGUgInZhbHVlIiBjb2x1bW4gb2YgdGhlIGFwcHJvcHJpYXRlIHRhYmxlLg0KICAgICAgICogQHBhcmFtIGNmZy5tZXRob2QgVGhlIG1ldGhvZCBmb3IgdGhlIGNhbGwuICgnREVMRVRFJywgJ1BVVCcpDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdCAob3B0aW9uYWwpDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uRmFpbHVyZSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IGlzIHByb3ZpZGVkIGlmIGFuIG9uU3VjY2VzcyBjYWxsYmFjayBpcyBwYXNzZWQgaW4pDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICoNCiAgICAgICAqIC4uLmNvZGUgc2V0dGluZyB1cCBhIGRlc2t0b3AgZGFzaGJvYXJkDQogICAgICAgKg0KICAgICAgICogdmFyIHBvc3RQYXJhbXMgPQ0KICAgICAgICogICB7DQogICAgICAgKiAgICAgJ3ZhbHVlJzogdGhpcy5jb25maWcudmFsdWUsDQogICAgICAgKiAgICAgICdwYXRoJzogdGhpcy5jb25maWcudmFsdWUuZ3VpZCwNCiAgICAgICAqICAgICAgJ3R5cGUnOiAnZGVza3RvcCcsDQogICAgICAgKiAgICAgICdpc2RlZmF1bHQnOiBzYXZlQXNEZWZhdWx0DQogICAgICAgKiAgIH07DQogICAgICAgKg0KICAgICAgICoJc2V0VmFsdWVzVmlhSlNPTk9iamVjdChfdXJsICsgIi8iICsgbmFtZXNwYWNlICsgIi8iICsgcGF0aCwganNvbk9iamVjdCwgc2F2ZU1ldGhvZCwgb25TdWNjZXNzLCBvbkZhaWx1cmUpOw0KICAgICAgICovDQogICAgICB2YXIgc2V0VmFsdWVzVmlhSlNPTk9iamVjdCA9IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICAgIGlmIChjZmcuanNvbk9iamVjdC5fbWV0aG9kID09PSB1bmRlZmluZWQpDQogICAgICAgICAgew0KICAgICAgICAgICAgICBpZiAoY2ZnLm1ldGhvZCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BVVCc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY2ZnLmpzb25PYmplY3QuX21ldGhvZCA9IGNmZy5tZXRob2Q7DQogICAgICAgICAgfQ0KICAgICAgICAgIGNmZy5qc29uID0gY2ZnLmpzb25PYmplY3Q7DQogICAgICAgICAgc2V0VmFsdWUoY2ZnKTsNCg0KICAgICAgfTsNCg0KICAgICAvKioNCiAgICAgICAqIEBwcml2YXRlDQogICAgICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlIEpTT04gb2JqZWN0IHdpdGggcGFyYW1zLiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZS4NCiAgICAgICAqIEBwYXJhbSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSBjZmcuZGFzaGJvYXJkSWQNCiAgICAgICAqIEBwYXJhbSBjZmcudmFsdWUNCiAgICAgICAqIEBwYXJhbSBjZmcudHlwZQ0KICAgICAgICogQHBhcmFtIGNmZy5pc0RlZmF1bHQNCiAgICAgICAqIEByZXR1cm4gdGhlIEpTT04gb2JqZWN0DQogICAgICAgKi8NCiAgICAgIHZhciBnZW5lcmF0ZURhc2hib2FyZFBvc3RQYXJhbXNKU09OID0gZnVuY3Rpb24gKGpzb24pIHsNCiAgICAgICAgICB2YXIgcG9zdFBhcmFtcyA9IHsNCiAgICAgICAgICAgICduYW1lJzoganNvbi5uYW1lLA0KICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzoganNvbi5kZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICdndWlkJzoganNvbi5ndWlkLA0KICAgICAgICAgICAgJ2lzZGVmYXVsdCc6IGpzb24uaXNkZWZhdWx0LA0KICAgICAgICAgICAgJ2xvY2tlZCc6IGpzb24ubG9ja2VkLA0KICAgICAgICAgICAgJ3N0YXRlJzoganNvbi5zdGF0ZSwNCiAgICAgICAgICAgICdsYXlvdXRDb25maWcnOiB0eXBlb2YganNvbi5sYXlvdXRDb25maWcgPT09ICdzdHJpbmcnID8ganNvbi5sYXlvdXRDb25maWcgOiBPem9uZS51dGlsLnRvU3RyaW5nKGpzb24ubGF5b3V0Q29uZmlnKSwNCiAgICAgICAgICAgICdzdGFjayc6IGpzb24uc3RhY2sNCiAgICAgICAgICB9Ow0KICAgICAgICAgIHJldHVybiBwb3N0UGFyYW1zOw0KICAgICAgfTsNCg0KICAgICAgcmV0dXJuIC8qKiBAbGVuZHMgT3pvbmUucHJlZi5QcmVmU2VydmVyLnByb3RvdHlwZSAqL3sNCg0KICAgICAgICAgIHZlcnNpb246IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24ucHJlZmVyZW5jZSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXQgdGhlIHVybCBmb3IgdGhlIFByZWZlcmVuY2UgU2VydmVyDQogICAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gdXJsDQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0VXJsIDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIHJldHVybiBfdXJsOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gU2V0cyB0aGUgdXJsIGZvciB0aGUgUHJlZmVyZW5jZSBTZXJ2ZXINCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsDQogICAgICAgICAgICogQHJldHVybnMgdm9pZA0KICAgICAgICAgICAqLw0KICAgICAgICAgIHNldFVybCA6IGZ1bmN0aW9uKHVybCkgew0KICAgICAgICAgICAgICBfdXJsID0gdXJsOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgZGFzaGJvYXJkIHdpdGggdGhlIHNwZWNpZmllZCBpZA0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLmRhc2hib2FyZElkIFVuaWd1ZSBkYXNoYmFyZCBpZGVudGlmaWVyDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBkYXNoYm9hcmQuDQogICAgICAgICAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLg0KICAgICAgICAgICAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaA0KICAgICAgICAgICAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuDQogICAgICAgICAgICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+DQogICAgICAgICAgICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4NCiAgICAgICAgICAgKiAgICAgPC91bD4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7DQogICAgICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5nZXREYXNoYm9hcmQoew0KICAgICAgICAgICAqICAgICBkYXNoYm9hcmRJZDonOTE3YjRjZDAtZWNiZC00MTBiLWFmZDktNDJkMTUwYzI2NDI2JywNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGdldERhc2hib2FyZCA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvIiArICdkYXNoYm9hcmQnICsgIi8iICsgY2ZnLmRhc2hib2FyZElkOw0KICAgICAgICAgICAgICBnZXQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIEdldHMgdGhlIHVzZXIncyBkZWZhdWx0IGRhc2hib2FyZA0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmdldERlZmF1bHREYXNoYm9hcmQoew0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0RGVmYXVsdERhc2hib2FyZCA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArIi9kYXNoYm9hcmQ/aXNkZWZhdWx0PXRydWUiOw0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gIlBPU1QiOw0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSB1c2VyJ3MgZGVmYXVsdCBkYXNoYm9hcmQNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kYXNoYm9hcmRJZCBVbmlndWUgZGFzaGJhcmQgaWRlbnRpZmllcg0KICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2ZnLmlzRGVmYXVsdCB0cnVlIHRvIHNldCBhcyBkZWZhdWx0IGRhc2hib2FyZA0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgew0KICAgICAgICAgICAqICAgICBhbGVydChkYXNoYm9hcmQubmFtZSk7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5zZXREZWZhdWx0RGFzaGJvYXJkKHsNCiAgICAgICAgICAgKiAgICAgZGFzaGJvYXJkSWQ6JzkxN2I0Y2QwLWVjYmQtNDEwYi1hZmQ5LTQyZDE1MGMyNjQyNicsDQogICAgICAgICAgICogICAgIGlzRGVmYXVsdDp0cnVlLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgc2V0RGVmYXVsdERhc2hib2FyZCA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvZGFzaGJvYXJkLyIgKyBjZmcuZGFzaGJvYXJkSWQgKyAiP2lzZGVmYXVsdD0iICsgY2ZnLmlzRGVmYXVsdDsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQVVQnOw0KICAgICAgICAgICAgICBzZXRWYWx1ZShjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gU2F2ZXMgY2hhbmdlcyB0byBhIG5ldyBvciBleGlzdGluZyBkYXNoYm9hcmQNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5qc29uIFRoZSBlbmNvZGVkIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoZSBkYXNoYm9hcmQgb2JqZWN0IGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXQ6IGxheW91dCBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge051bWJlcn0gY29sdW1uQ291bnQ6IG51bWJlciBvZiBjb2x1bW5zIGlmIGRhc2hib2FyZCBpcyBhIHBvcnRhbCB0eXBlPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7TGlzdH0gRURhc2hib2FyZExheW91dExpc3Q6IGxpc3Qgb2YgZGFzaGJvYXJkIHR5cGVzPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IGRhc2hib2FyZCB0eXBlPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNmZy5zYXZlQXNOZXcgQSBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW50aXR5IGJlaW5nIHNhdmVkIGlzIG5ldy4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLmFzeW5jXSBBc3luYyB0cnVlIG9yIGZhbHNlIGRlZmF1bHRzIHRvIHRydWUNCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgew0KICAgICAgICAgICAqICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIGRhc2hib2FyZCA9IHsNCiAgICAgICAgICAgKiAgIGFsdGVyZWRCeUFkbWluOiAnZmFsc2UnLA0KICAgICAgICAgICAqICAgY3JlYXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsDQogICAgICAgICAgICogICBpc0dyb3VwRGFzaGJvYXJkOiBmYWxzZSwNCiAgICAgICAgICAgKiAgIGlzZGVmYXVsdDogZmFsc2UsDQogICAgICAgICAgICogICBsb2NrZWQ6IGZhbHNlLA0KICAgICAgICAgICAqICAgbmFtZTogJ015IERhc2hib2FyZCcsDQogICAgICAgICAgICogICB1c2VyOiB7DQogICAgICAgICAgICogICAgIHVzZXJJZDogJ3Rlc3RBZG1pbjEnLA0KICAgICAgICAgICAqICAgfSwNCiAgICAgICAgICAgKiAgIGNyZWF0ZWRCeTogew0KICAgICAgICAgICAqICAgICB1c2VySWQ6ICd0ZXN0QWRtaW4xJywNCiAgICAgICAgICAgKiAgICAgdXNlclJlYWxOYW1lOiAnVGVzdCBBZG1pbiAxJw0KICAgICAgICAgICAqICAgfSwNCiAgICAgICAgICAgKiAgIGVkaXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsDQogICAgICAgICAgICogICBncm91cHM6IFtdLA0KICAgICAgICAgICAqICAgZGVzY3JpcHRpb246ICdUaGlzIGlzIG15IGRhc2hib2FyZCcsDQogICAgICAgICAgICogICBndWlkOiBndWlkLnV0aWwuZ3VpZCgpLA0KICAgICAgICAgICAqICAgbGF5b3V0Q29uZmlnOiB7DQogICAgICAgICAgICogICAgICAgeHR5cGU6ICJkZXNrdG9wcGFuZSIsIA0KICAgICAgICAgICAqICAgICAgIGZsZXg6IDEsIA0KICAgICAgICAgICAqICAgICAgIGhlaWdodDogIjEwMCUiLCANCiAgICAgICAgICAgKiAgICAgICBpdGVtczogWw0KICAgICAgICAgICAqICAgICAgIF0sIA0KICAgICAgICAgICAqICAgICAgIHBhbmVUeXBlOiAiZGVza3RvcHBhbmUiLCANCiAgICAgICAgICAgKiAgICAgICB3aWRnZXRzOiBbew0KICAgICAgICAgICAqICAgICAgICAgICAgICAgd2lkZ2V0R3VpZDogImVjNTQzNWNmLTQwMjEtNGYyYS1iYTY5LWRkZTQ1MWQxMjU1MSIsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgdW5pcXVlSWQ6IGd1aWQudXRpbC5ndWlkKCksIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgZGFzaGJvYXJkR3VpZDogIjZkNzIxOWNiLWI0ODUtYWNlNS05NDZiLTBhZmZhMWYyMjdhMyIsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgcGFuZUd1aWQ6IGd1aWQudXRpbC5ndWlkKCksIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgbmFtZTogIkNoYW5uZWwgTGlzdGVuZXIiLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGFjdGl2ZTogZmFsc2UsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgeDogNTAsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgeTogNjYsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgbWluaW1pemVkOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBtYXhpbWl6ZWQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHBpbm5lZDogZmFsc2UsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgY29sbGFwc2VkOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBjb2x1bW5Qb3M6IDAsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgYnV0dG9uSWQ6IG51bGwsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgYnV0dG9uT3BlbmVkOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICByZWdpb246ICJub25lIiwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBzdGF0ZVBvc2l0aW9uOiAxLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGludGVudENvbmZpZzogbnVsbCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBzaW5nbGV0b246IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGZsb2F0aW5nV2lkZ2V0OiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICB6SW5kZXg6IDE5MDUwLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGhlaWdodDogNDQwLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHdpZHRoOiA1NDANCiAgICAgICAgICAgKiAgICAgICAgICAgfQ0KICAgICAgICAgICAqICAgICAgIF0sIA0KICAgICAgICAgICAqICAgICAgIGRlZmF1bHRTZXR0aW5nczogew0KICAgICAgICAgICAqICAgICAgICAgICB3aWRnZXRTdGF0ZXM6IHsNCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICJlYzU0MzVjZi00MDIxLTRmMmEtYmE2OS1kZGU0NTFkMTI1NTEiOiB7DQogICAgICAgICAgICogICAgICAgICAgICAgICAgICAgeDogNTAsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgICAgIHk6IDY2LCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQ0MCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICAgICAgd2lkdGg6IDU0MCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiAxMzQ5ODA5NzQ3MzM2DQogICAgICAgICAgICogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAqICAgICAgICAgICB9DQogICAgICAgICAgICogICAgICAgfQ0KICAgICAgICAgICAqICAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuY3JlYXRlT3JVcGRhdGVEYXNoYm9hcmQoew0KICAgICAgICAgICAqICAganNvbjogZGFzaGJvYXJkLA0KICAgICAgICAgICAqICAgc2F2ZUFzTmV3OiB0cnVlLA0KICAgICAgICAgICAqICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MsDQogICAgICAgICAgICogICBvbkZhaWx1cmU6IG9uRmFpbHVyZSwNCiAgICAgICAgICAgKiAgIGFzeW5jOiB0cnVlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgY3JlYXRlT3JVcGRhdGVEYXNoYm9hcmQgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiLyIgKyAnZGFzaGJvYXJkJyArICIvIiArIGNmZy5qc29uLmd1aWQ7DQogICAgICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gZ2VuZXJhdGVEYXNoYm9hcmRQb3N0UGFyYW1zSlNPTihjZmcuanNvbik7DQogICAgICAgICAgICAgIHBvc3RQYXJhbXMuYnlwYXNzTGF5b3V0UmVhcnJhbmdlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9IGNmZy5zYXZlQXNOZXcgPyAnUE9TVCcgOiAnUFVUJzsNCiAgICAgICAgICAgICAgY2ZnLmpzb25PYmplY3QgPSBwb3N0UGFyYW1zOw0KICAgICAgICAgICAgICBzZXRWYWx1ZXNWaWFKU09OT2JqZWN0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDb3BpZXMgYW4gZXhpc3RpbmcgZGFzaGJvYXJkIGFuZCBzYXZlcyBpdCBhcyBuZXcNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5qc29uIFRoZSBlbmNvZGVkIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoZSBkYXNoYm9hcmQgb2JqZWN0IGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgew0KICAgICAgICAgICAqICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIGRhc2hib2FyZCA9IHsNCiAgICAgICAgICAgKiAgIGFsdGVyZWRCeUFkbWluOiAnZmFsc2UnLA0KICAgICAgICAgICAqICAgY3JlYXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsDQogICAgICAgICAgICogICBpc0dyb3VwRGFzaGJvYXJkOiBmYWxzZSwNCiAgICAgICAgICAgKiAgIGlzZGVmYXVsdDogZmFsc2UsDQogICAgICAgICAgICogICBuYW1lOiAnTXkgRGFzaGJvYXJkJywNCiAgICAgICAgICAgKiAgIHVzZXI6IHsNCiAgICAgICAgICAgKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsDQogICAgICAgICAgICogICB9LA0KICAgICAgICAgICAqICAgY3JlYXRlZEJ5OiB7DQogICAgICAgICAgICogICAgIHVzZXJJZDogJ3Rlc3RBZG1pbjEnLA0KICAgICAgICAgICAqICAgICB1c2VyUmVhbE5hbWU6ICdUZXN0IEFkbWluIDEnDQogICAgICAgICAgICogICB9LA0KICAgICAgICAgICAqICAgZWRpdGVkRGF0ZTogJzA0LzE4LzIwMTIgMTE6MjkgQU0gRURUJywNCiAgICAgICAgICAgKiAgIGdyb3VwczogW10sDQogICAgICAgICAgICogICBkZXNjcmlwdGlvbjogJ1RoaXMgaXMgbXkgZGFzaGJvYXJkJywNCiAgICAgICAgICAgKiAgIGd1aWQ6IGd1aWQudXRpbC5ndWlkKCksDQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5jbG9uZURhc2hib2FyZCh7DQogICAgICAgICAgICogICBqc29uOiBkYXNoYm9hcmQsDQogICAgICAgICAgICogICBvblN1Y2Nlc3M6IG9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgIG9uRmFpbHVyZTogb25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgY2xvbmVEYXNoYm9hcmQgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiLyIgKyAnZGFzaGJvYXJkJyArICIvIiArIGNmZy5qc29uLmd1aWQ7DQogICAgICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gZ2VuZXJhdGVEYXNoYm9hcmRQb3N0UGFyYW1zSlNPTihjZmcuanNvbik7DQogICAgICAgICAgICAgIHBvc3RQYXJhbXMuY2xvbmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgY2ZnLmpzb25PYmplY3QgPSBwb3N0UGFyYW1zOw0KICAgICAgICAgICAgICBzZXRWYWx1ZXNWaWFKU09OT2JqZWN0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTYXZlcyBjaGFuZ2VzIHRvIGV4aXN0aW5nIGRhc2hib2FyZHMNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gY2ZnLnZpZXdzVG9VcGRhdGUgYXJyYXkgb2YgSlNPTiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIHZpZXcgZ3VpZCBhbmQgZGF0YSB0byBiZSB1cGRhdGVkDQogICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gY2ZnLnZpZXdHdWlkc1RvRGVsZXRlIGFycmF5IG9mIGd1aWRzIG9mIHZpZXdzIHRvIGJlIGRlbGV0ZWQNCiAgICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNmZy51cGRhdGVPcmRlciBmbGFnIHRvIHVwZGF0ZSBvcmRlcg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkNCiAgICAgICAgICAgKi8NCiAgICAgICAgICB1cGRhdGVBbmREZWxldGVEYXNoYm9hcmRzIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9kYXNoYm9hcmQiOw0KICAgICAgICAgICAgICB2YXIgcG9zdFBhcmFtcyA9IHsNCiAgICAgICAgICAgICAgICAgICdfbWV0aG9kJzogJ1BVVCcsDQogICAgICAgICAgICAgICAgICAndmlld3NUb1VwZGF0ZSc6IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLnZpZXdzVG9VcGRhdGUpLA0KICAgICAgICAgICAgICAgICAgJ3ZpZXdHdWlkc1RvRGVsZXRlJzogT3pvbmUudXRpbC50b1N0cmluZyhjZmcudmlld0d1aWRzVG9EZWxldGUpLA0KICAgICAgICAgICAgICAgICAgJ3VwZGF0ZU9yZGVyJzogY2ZnLnVwZGF0ZU9yZGVyDQogICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgY2ZnLmNvbnRlbnQgPSBwb3N0UGFyYW1zOw0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBEZWxldGVzIHRoZSBkYXNoYm9hcmQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuZGFzaGJvYXJkSWQgVW5pZ3VlIGRhc2hiYXJkIGlkZW50aWZpZXINCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmRlbGV0ZURhc2hib2FyZCh7DQogICAgICAgICAgICogICAgIGRhc2hib2FyZElkOic5MTdiNGNkMC1lY2JkLTQxMGItYWZkOS00MmQxNTBjMjY0MjYnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZGVsZXRlRGFzaGJvYXJkIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9kYXNoYm9hcmQvIiArIGNmZy5kYXNoYm9hcmRJZDsNCiAgICAgICAgICAgICAgZGVsZXRlQmFzZShjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gUmV0dXJucyBhbGwgZGFzaGJvYXJkcyBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLg0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0Lg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiBkYXNoYm9hcmRzIGZvdW5kPGJyPg0KICAgICAgICAgICAqICAgICB7TnVtYmVyfSByZXN1bHRzOiBudW1iZXIgb2YgZGFzaGJvYXJkcyBmb3VuZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBkYXRhOiBhcnJheSBvZiBkYXNoYm9hcmRzIG9iamVjdHMgZm91bmQuICBEYXNoYm9hcmQgb2JqZWN0IGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBhbGVydChvYmoucmVzdWx0cyk7DQogICAgICAgICAgICogICAgIGlmIChvYmoucmVzdWx0cyA+IDApIHsNCiAgICAgICAgICAgKiAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLnJlc3VsdHM7IGkrKykgew0KICAgICAgICAgICAqICAgICAgICAgICAgIGFsZXJ0KG9iai5kYXRhW2ldLm5hbWUpOw0KICAgICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5maW5kRGFzaGJvYXJkcyh7DQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBmaW5kRGFzaGJvYXJkcyA6IGZ1bmN0aW9uICAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9ICJkYXNoYm9hcmQiOw0KICAgICAgICAgICAgICBsaXN0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXByZWNhdGVkIERlcHJlY2F0ZWQgc3RhcnRpbmcgd2l0aCBPV0YgNy4gRGFzaGJvYXJkcyBubyBsb25nZXIgaGF2ZSBhIHNwZWNpZmljIHR5cGUuIFRoaXMgZnVuY3Rpb24gaXMgc3R1YmJlZCANCiAgICAgICAgICAgKiB0byByZXR1cm4gc3VjY2VzcyB3aXRoIDAgcmVzdWx0cyB1bnRpbCByZW1vdmFsLg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIGFsbCBkYXNoYm9hcmRzIGZvciB0aGUgbG9nZ2VkIGluIHVzZXIgZmlsdGVyZWQgYnkgdGhlIHR5cGUgb2YgZGFzaGJvYXJkLg0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLnR5cGUgQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB0eXBlIG9mIGRhc2hib2FyZC4gSWYgdXNpbmcgYnVpbHQgaW4gZGFzaGJvYXJkIHR5cGVzLCB0aGlzIHdvdWxkIGluY2x1ZGUgZGVza3RvcCwgdGFiYmVkLCBwb3J0YWwsIGFuZCBhY2NvcmRpb24uDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IHN1Y2Nlc3M6IHRydWUgaWYgZGFzaGJvYXJkcyBmb3VuZDxicj4NCiAgICAgICAgICAgKiAgICAge051bWJlcn0gcmVzdWx0czogbnVtYmVyIG9mIGRhc2hib2FyZHMgZm91bmQ8YnI+DQogICAgICAgICAgICogICAgIHtBcnJheX0gZGF0YTogYW4gZW1wdHkgYXJyYXk8YnI+DQogICAgICAgICAgICogICAgIA0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQob2JqLnJlc3VsdHMpOw0KICAgICAgICAgICAqICAgICBpZiAob2JqLnJlc3VsdHMgPiAwKSB7DQogICAgICAgICAgICogICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5yZXN1bHRzOyBpKyspIHsNCiAgICAgICAgICAgKiAgICAgICAgICAgICBhbGVydChvYmouZGF0YVtpXS5uYW1lKTsNCiAgICAgICAgICAgKiAgICAgICAgIH0NCiAgICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZmluZERhc2hib2FyZHNCeVR5cGUoew0KICAgICAgICAgICAqICAgICB0eXBlOidkZXNrdG9wJywNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGZpbmREYXNoYm9hcmRzQnlUeXBlIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY2ZnLm9uU3VjY2VzcyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9IHsgDQogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlDQogICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgIGNmZy5vblN1Y2Nlc3MocmV0VmFsKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgd2lkZ2V0IHdpdGggdGhlIHNwZWNpZmllZCBpZA0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLndpZGdldElkIFRoZSBndWlkIG9mIHRoZSB3aWRnZXQuDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy51bml2ZXJzYWxOYW1lIFRoZSB1bml2ZXJzYWwgbmFtZSBmb3IgdGhlIHdpZGdldC4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBpcyBwYXNzZWQgdGhlIGZvbGxvd2luZyBvYmplY3QgYXMgYSBwYXJhbWV0ZXI6IHtpZDpOdW1iZXIsIG5hbWVzcGFjZTpTdHJpbmcsIHZhbHVlOk9iamVjdCwgcGF0aDpTdHJpbmd9DQogICAgICAgICAgICogVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtOdW1iZXJ9IGlkOiBkYXRhYmFzZSBwayBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lc3BhY2U6ICJ3aWRnZXQiPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB2YWx1ZTogd2lkZ2V0IG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZWRpdGFibGU6IHRydWUgaWYgd2lkZ2V0IGNhbiBiZSBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSB2aXNpYmxlOiB0cnVlIGlmIHdpZGdldCBpcyB2aXNpYmxlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBwb3NpdGlvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB3aWRnZXQgb3duZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB3aWRnZXQgb3duZXIgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbmFtZXNwYWNlOiB3aWRnZXQgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXJsOiB1cmwgb2Ygd2lkZ2V0IGFwcGxpY2F0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBoZWFkZXJJY29uOiB1cmwgb2Ygd2lkZ2V0IGhlYWRlciBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBpbWFnZTogdXJsIG9mIHdpZGdldCBpbWFnZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gc21hbGxJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3Mgc21hbGwgaWNvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbGFyZ2VJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3MgbGFyZ2UgaWNvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB0aGUgd2lkZ2V0IGluIHBpeGVsczxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB3aWRnZXRWZXJzaW9uOiB3aWRnZXQgdmVyc2lvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB0YWdzOiBhcnJheSBvZiB0YWcgc3RyaW5nczxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGRlZmluaXRpb25WaXNpYmxlOiB0cnVlIGlmIGRlZmluaXRpb24gaXMgdmlzaWJsZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHNpbmdsZXRvbjogdHJ1ZSBpZiB3aWRnZXQgaXMgYSBzaW5nbGV0b248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBiYWNrZ3JvdW5kOiB0cnVlIGlmIHdpZGdldCBydW5zIGluIHRoZSBiYWNrZ3JvdW5kPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGFsbFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBkaXJlY3RSZXF1aXJlZDogYXJyYXkgb2YgYWxsIHdpZGdldHMgZGlyZWN0bHkgcmVxdWlyZWQgYnkgdGhpcyB3aWRnZXQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gd2lkZ2V0VHlwZXM6IGFycmF5IG9mIHdpZGdldCB0eXBlcyB0aGlzIHdpZGdldCBiZWxvbmdzIHRvPGJyPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IHBhdGg6IFRoZSBndWlkIG9mIHRoZSB3aWRnZXQuPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgICAgKiAgICAgaWYgKG9iai52YWx1ZSkgew0KICAgICAgICAgICAqICAgICAgICAgYWxlcnQob2JqLnZhbHVlLm5hbWVzcGFjZSk7DQogICAgICAgICAgICogICAgIH0NCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmdldFdpZGdldCh7DQogICAgICAgICAgICogICAgIHdpZGdldElkOidlYTU0MzVjZi00MDIxLTRmMmEtYmE2OS1kZGU0NTFkMTI1NTEnLA0KICAgICAgICAgICAqICAgICB3aWRnZXRVdWlkOiAnY29tLmNvbXBhbnkud2lkZ2V0Lm5hbWUnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0V2lkZ2V0IDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi8iICsgJ3dpZGdldCcgKyAiLyIgKyBjZmcud2lkZ2V0SWQ7DQogICAgICAgICAgICAgIGlmKGNmZy51bml2ZXJzYWxOYW1lKSB7DQogICAgICAgICAgICAgICAgICBjZmcudXJsICs9ICc/dW5pdmVyc2FsTmFtZT0nICsgY2ZnLnVuaXZlcnNhbE5hbWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZ2V0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXRzIGFsbCB3aWRnZXRzIGZvciBhIGdpdmVuIHVzZXIuDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NmZy51c2VyT25seV0gYm9vbGVhbiBmbGFnIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIHRvIG9ubHkgcmV0dXJuIHdpZGdldHMgYXNzaWduZWQgdG8gdGhlIHVzZXIgKGV4Y2x1ZGluZyB3aWRnZXRzIHRvIHdoaWNoIHRoZSB1c2VyIG9ubHkgaGFzIGFjY2VzcyB2aWEgdGhlaXIgYXNzaWduZWQgZ3JvdXBzKQ0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnLnNlYXJjaFBhcmFtc10gb2JqZWN0IGNvbnRhaW5pbmcgc2VhcmNoIHBhcmFtZXRlcnMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZV0gbmFtZSBvZiB3aWRnZXQgJyUnIGFyZSB3aWxkY2FyZHMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZUV4YWN0TWF0Y2hdIHRydWUgb3IgZmFsc2UgdG8gbWF0Y2ggdGhlIG5hbWUgZXhhY3RseS4gZGVmYXVsdHMgdG8gZmFsc2UNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0VmVyc2lvbl0gdmVyc2lvbiBvZiB3aWRnZXQgJyUnIGFyZSB3aWxkY2FyZHMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0R3VpZF0gR3VpZCBvZiB3aWRnZXQgJyUnIGFyZSB3aWxkY2FyZHMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMudW5pdmVyc2FsTmFtZV0gVW5pdmVyc2FsIG5hbWUgb2Ygd2lkZ2V0ICclJyBhcmUgd2lsZGNhcmRzDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gYXJyYXkgb2Ygb2JqZWN0cyBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtOdW1iZXJ9IGlkOiBkYXRhYmFzZSBwayBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lc3BhY2U6ICJ3aWRnZXQiPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB2YWx1ZTogd2lkZ2V0IG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZWRpdGFibGU6IHRydWUgaWYgd2lkZ2V0IGNhbiBiZSBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSB2aXNpYmxlOiB0cnVlIGlmIHdpZGdldCBpcyB2aXNpYmxlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBwb3NpdGlvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB3aWRnZXQgb3duZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB3aWRnZXQgb3duZXIgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbmFtZXNwYWNlOiB3aWRnZXQgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXJsOiB1cmwgb2Ygd2lkZ2V0IGFwcGxpY2F0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBoZWFkZXJJY29uOiB1cmwgb2Ygd2lkZ2V0IGhlYWRlciBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBpbWFnZTogdXJsIG9mIHdpZGdldCBpbWFnZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gc21hbGxJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3Mgc21hbGwgaWNvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbGFyZ2VJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3MgbGFyZ2UgaWNvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB0aGUgd2lkZ2V0IGluIHBpeGVsczxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB3aWRnZXRWZXJzaW9uOiB3aWRnZXQgdmVyc2lvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB0YWdzOiBhcnJheSBvZiB0YWcgc3RyaW5nczxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGRlZmluaXRpb25WaXNpYmxlOiB0cnVlIGlmIGRlZmluaXRpb24gaXMgdmlzaWJsZTxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHNpbmdsZXRvbjogdHJ1ZSBpZiB3aWRnZXQgaXMgYSBzaW5nbGV0b248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBiYWNrZ3JvdW5kOiB0cnVlIGlmIHdpZGdldCBydW5zIGluIHRoZSBiYWNrZ3JvdW5kPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGFsbFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBkaXJlY3RSZXF1aXJlZDogYXJyYXkgb2YgYWxsIHdpZGdldHMgZGlyZWN0bHkgcmVxdWlyZWQgYnkgdGhpcyB3aWRnZXQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gd2lkZ2V0VHlwZXM6IGFycmF5IG9mIHdpZGdldCB0eXBlcyB0aGlzIHdpZGdldCBiZWxvbmdzIHRvPGJyPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IHBhdGg6IFRoZSBndWlkIG9mIHRoZSB3aWRnZXQuPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuICBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHR3byBwYXJhbWV0ZXJzOiBhIGVycm9yIG1lc3NhZ2Ugc3RyaW5nLCBhbmQgb3B0aW9uYWxseSBhIHN0YXR1cyBjb2RlDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbih3aWRnZXRzKSB7DQogICAgICAgICAgICogICAgIGlmICh3aWRnZXRzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgKiAgICAgICAgIGFsZXJ0KHdpZGdldHNbMF0udmFsdWUubmFtZXNwYWNlKTsNCiAgICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IsIHN0YXR1cykgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5maW5kV2lkZ2V0cyh7DQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBmaW5kV2lkZ2V0cyA6IGZ1bmN0aW9uIChjZmcpew0KDQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi93aWRnZXQiOw0KICAgICAgICAgICAgICBpZiAoIWNmZy51c2VyT25seSkgew0KICAgICAgICAgICAgICAgICAgY2ZnLnVybCArPSAiL2xpc3RVc2VyQW5kR3JvdXBXaWRnZXRzIjsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIC8vIEFkZCBzZWFyY2ggcGFyYW1zDQogICAgICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gew0KICAgICAgICAgICAgICAgICAgJ19tZXRob2QnOiAnR0VUJw0KICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgIGlmIChjZmcuc2VhcmNoUGFyYW1zKSB7DQogICAgICAgICAgICAgICAgICBpZiAoY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXROYW1lICYmIGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaFRlcm0gPSBjZmcuc2VhcmNoUGFyYW1zLndpZGdldE5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKCFjZmcuc2VhcmNoUGFyYW1zLndpZGdldE5hbWVFeGFjdE1hdGNoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFRlcm0gPSAnJScrc2VhcmNoVGVybSsnJSc7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIHBvc3RQYXJhbXNbJ3dpZGdldE5hbWUnXSA9IHNlYXJjaFRlcm07DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRWZXJzaW9uICYmIGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0VmVyc2lvbi5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgcG9zdFBhcmFtc1snd2lkZ2V0VmVyc2lvbiddID0gY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRWZXJzaW9uOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0R3VpZCAmJiBjZmcuc2VhcmNoUGFyYW1zLndpZGdldEd1aWQubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIHBvc3RQYXJhbXNbJ3dpZGdldEd1aWQnXSA9IGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0R3VpZDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChjZmcuc2VhcmNoUGFyYW1zLnVuaXZlcnNhbE5hbWUgJiYgY2ZnLnNlYXJjaFBhcmFtcy51bml2ZXJzYWxOYW1lLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICBwb3N0UGFyYW1zWyd1bml2ZXJzYWxOYW1lJ10gPSBjZmcuc2VhcmNoUGFyYW1zLnVuaXZlcnNhbE5hbWU7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoY2ZnLnNlYXJjaFBhcmFtcy5ncm91cF9pZCkgew0KICAgICAgICAgICAgICAgICAgICAgIHBvc3RQYXJhbXNbJ2dyb3VwX2lkJ10gPSBjZmcuc2VhcmNoUGFyYW1zLmdyb3VwX2lkOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgY2ZnLmNvbnRlbnQgPSBwb3N0UGFyYW1zOw0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTYXZlcyBjaGFuZ2VzIHRvIGV4aXN0aW5nIHdpZGdldHMNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gY2ZnLndpZGdldHNUb1VwZGF0ZSBhcnJheSBvZiBKU09OIG9iamVjdHMgY29udGFpbmluZyB0aGUgd2lkZ2V0IGd1aWQgYW5kIGRhdGEgdG8gYmUgdXBkYXRlZA0KICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGNmZy53aWRnZXRHdWlkc1RvRGVsZXRlIGFycmF5IG9mIGd1aWRzIG9mIHdpZGdldHMgdG8gYmUgZGVsZXRlZA0KICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2ZnLnVwZGF0ZU9yZGVyIGZsYWcgdG8gdXBkYXRlIG9yZGVyDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdA0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKQ0KICAgICAgICAgICAqLw0KICAgICAgICAgIHVwZGF0ZUFuZERlbGV0ZVdpZGdldHMgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL3dpZGdldCI7DQogICAgICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gew0KICAgICAgICAgICAgICAgICAgJ19tZXRob2QnOiAnUFVUJywNCiAgICAgICAgICAgICAgICAgICd3aWRnZXRzVG9VcGRhdGUnOiBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy53aWRnZXRzVG9VcGRhdGUpLA0KICAgICAgICAgICAgICAgICAgJ3dpZGdldEd1aWRzVG9EZWxldGUnOiBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy53aWRnZXRHdWlkc1RvRGVsZXRlKSwNCiAgICAgICAgICAgICAgICAgICd1cGRhdGVPcmRlcic6IGNmZy51cGRhdGVPcmRlcg0KICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnUE9TVCc7DQogICAgICAgICAgICAgIGNmZy5jb250ZW50ID0gcG9zdFBhcmFtczsNCiAgICAgICAgICAgICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZChjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gUmV0cmlldmVzIHRoZSB1c2VyIHByZWZlcmVuY2UgZm9yIHRoZSBwcm92aWRlZCBuYW1lIGFuZCBuYW1lc3BhY2UNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lc3BhY2UgVGhlIG5hbWVzcGFjZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXIgcHJlZmVyZW5jZQ0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXIgcHJlZmVyZW5jZQ0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpZiB0aGUgdXNlciBwcmVmZXJlbmNlIGlzIHN1Y2Nlc3NmdWxseSByZXRyaWV2ZWQgZnJvbQ0KICAgICAgICAgICAqIHRoZSBkYXRhYmFzZS4gIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBzaW5nbGUgYXJndW1lbnQsIHdoaWNoIGlzIGEgSlNPTiBvYmplY3QuICBJZiBhIHByZWZlcmVuY2UgaXMgZm91bmQsIHRoZQ0KICAgICAgICAgICAqIGNvbXBsZXRlIEpTT04gc3RydWN0dXJlIGFzIHNob3duIGJlbG93IHdpbGwgYmUgcmV0dXJuZWQuICBJZiBpdCBpcyBub3QgZm91bmQgdGhpcyBmdW5jdGlvbiBiZSBwYXNzZWQgYW4gZW1wdHkgSlNPTiBvYmplY3QuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKiBUaGUgZm9sbG93aW5nIGlzIGFuIGV4YW1wbGUgb2YgYSBjb21wbGV0ZSBwcmVmZXJlbmNlIG9iamVjdCBwYXNzZWQgdG8gdGhlIG9uU3VjY2Vzcw0KICAgICAgICAgICAqIGZ1bmN0aW9uOg0KICAgICAgICAgICAqIHsNCiAgICAgICAgICAgKiAgICAgInZhbHVlIjoidHJ1ZSIsDQogICAgICAgICAgICogICAgICJwYXRoIjoibWlsaXRhcnlUaW1lIiwNCiAgICAgICAgICAgKiAgICAgInVzZXIiOg0KICAgICAgICAgICAqICAgICB7DQogICAgICAgICAgICogICAgICAgICAidXNlcklkIjoidGVzdEFkbWluMSINCiAgICAgICAgICAgKiAgICAgfSwNCiAgICAgICAgICAgKiAgICAgIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIg0KICAgICAgICAgICAqIH0NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhpcyBwYXJhbWV0ZXIgaXMgb3B0aW9uYWwuIElmIHRoaXMgZnVuY3Rpb24gaXMgbm90IHNwZWNpZmllZCBhIGRlZmF1bHQgZXJyb3INCiAgICAgICAgICAgKiBtZXNzYWdlIHdpbGwgYmUgZGlzcGxheWVkLlRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGlmIGFuIGVycm9yIG9jY3VycyBvbiBwcmVmZXJlbmNlIHJldHJpZXZhbC4gIEl0IGlzIG5vdA0KICAgICAgICAgICAqIGNhbGxlZCBpZiB0aGUgcHJlZmVyZW5jZSBpcyBzaW1wbHkgbWlzc2luZy4NCiAgICAgICAgICAgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBhY2NlcHQgdHdvIGFyZ3VtZW50czo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIGVycm9yOiBTdHJpbmc8YnI+DQogICAgICAgICAgICogVGhlIGVycm9yIG1lc3NhZ2U8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIFN0YXR1czogVGhlIG51bWVyaWMgSFRUUCBTdGF0dXMgY29kZSAoaWYgYXBwbGljYWJsZSk8YnI+DQogICAgICAgICAgICogNDAxOiBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIGVudGl0eS48YnI+DQogICAgICAgICAgICogNTAwOiBBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLjxicj4NCiAgICAgICAgICAgKiA0MDQ6IFRoZSB1c2VyIHByZWZlcmVuY2Ugd2FzIG5vdCBmb3VuZC48YnI+DQogICAgICAgICAgICogNDAwOiBUaGUgcmVxdWVzdGVkIGVudGl0eSBmYWlsZWQgdG8gcGFzcyB2YWxpZGF0aW9uLjxicj4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgc2hvd3MgaG93IHRvIG1ha2UgYSBjYWxsIHRvIGdldFVzZXJQcmVmZXJlbmNlOg0KICAgICAgICAgICAqIGZ1bmN0aW9uIG9uU3VjY2VzcyhwcmVmKXsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoT3pvbmUudXRpbC50b1N0cmluZyhwcmVmLnZhbHVlKSk7DQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogZnVuY3Rpb24gb25GYWlsdXJlKGVycm9yLHN0YXR1cyl7DQogICAgICAgICAgICogICAgIGFsZXJ0KCdFcnJvciAnICsgZXJyb3IpOw0KICAgICAgICAgICAqICAgICBhbGVydChzdGF0dXMpOw0KICAgICAgICAgICAqIH0NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIC8vIFRoZSBmb2xsb3dpbmcgY29kZSBjYWxscyBnZXRVc2VyUHJlZmVyZW5jZSB3aXRoIHRoZSBhYm92ZSBkZWZpbmVkIG9uU3VjY2VzcyBhbmQNCiAgICAgICAgICAgKiAvLyBvbkZhaWx1cmUgY2FsbGJhY2tzLg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5nZXRVc2VyUHJlZmVyZW5jZSh7DQogICAgICAgICAgICogICAgIG5hbWVzcGFjZTonY29tLmNvbXBhbnkud2lkZ2V0JywNCiAgICAgICAgICAgKiAgICAgbmFtZTonRmlyc3QgUHJlc2lkZW50JywNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGdldFVzZXJQcmVmZXJlbmNlIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9wcmVmZXJlbmNlLyIgKyBjZmcubmFtZXNwYWNlICsgIi8iICsgY2ZnLm5hbWU7DQoNCiAgICAgICAgICAgICAgLy9pZ29ub3JlIDQwNCBlcnJvciBjb2RlLCBvblN1Y2Nlc3Mgd2lsbCBiZSBjYWxsZWQgd2l0aCBlbXRweSBvYmplY3QgcGF5bG9hZA0KICAgICAgICAgICAgICBjZmcuaWdub3JlZEVycm9yQ29kZXMgPSBbNDA0XTsNCiAgICAgICAgICAgICAgZ2V0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDaGVja3MgZm9yIHRoZSBleGlzdGVuY2Ugb2YgYSB1c2VyIHByZWZlcmVuY2UgZm9yIGEgZ2l2ZW4gbmFtZXNwYWNlIGFuZCBuYW1lDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugb2YgdGhlIHJlcXVlc3RlZCB1c2VyDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSByZXF1ZXN0ZWQgdXNlcg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGlmIGEgcHJlZmVyZW5jZSBzdWNjZXNzZnVsbHkgcmV0dXJuIGZyb20gdGhlIGRhdGFiYXNlLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7TnVtYmVyfSBzdGF0dXNDb2RlOiBzdGF0dXMgY29kZTxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IHByZWZlcmVuY2VFeGlzdDogdHJ1ZSBpZiBwcmVmZXJlbmNlIGV4aXN0czxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBpZiB0aGVyZSB3YXMNCiAgICAgICAgICAgKiBhbiBlcnJvciBsb29raW5nIHVwIHRoZSBwcmVmZXJlbmNlLiAgVGhpcyBmdW5jdGlvbiBpcyA8ZW0+bm90PC9lbT4gY2FsbGVkDQogICAgICAgICAgICogaWYgdGhlIHByZWZlcmVuY2Ugc2ltcGx5IGRvZXMgbm90IGV4aXN0DQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgICAgKiAgICAgaWYgKG9iai5zdGF0dXNDb2RlID0gMjAwKSB7DQogICAgICAgICAgICogICAgICAgICBhbGVydChvYmoucHJlZmVyZW5jZUV4aXN0KTsNCiAgICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZG9lc1VzZXJQcmVmZXJlbmNlRXhpc3Qoew0KICAgICAgICAgICAqICAgICBuYW1lc3BhY2U6J2Zvby5iYXIuMCcsDQogICAgICAgICAgICogICAgIG5hbWU6J3Rlc3QgcGF0aCBlbnRyeSAwJywNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGRvZXNVc2VyUHJlZmVyZW5jZUV4aXN0OiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL2hhc1ByZWZlcmVuY2UvIiArIGNmZy5uYW1lc3BhY2UgKyAiLyIgKyBjZmcubmFtZTsNCiAgICAgICAgICAgICAgZ2V0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiByZXRyaWV2ZXMgdGhlIGN1cnJlbnQgdXNlciBsb2dnZWQgaW50byB0aGUgc3lzdGVtDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGZvciBhIHN1Y2Nlc3NmdWwgcmV0cmlldmFsIG9mIHRoZSB1c2VyIGxvZ2dlZCBpbi4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gY3VycmVudFVzZXJOYW1lOiB1c2VyIG5hbWU8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGN1cnJlbnRVc2VyOiB1c2VyIHJlYWwgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGN1cnJlbnRVc2VyUHJldkxvZ2luOiBwcmV2aW91cyBsb2dpbiBkYXRlPGJyPg0KICAgICAgICAgICAqICAgICB7TnVtYmVyfSBjdXJyZW50SWQ6IGRhdGFiYXNlIHBrIGluZGV4PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuW29uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN5c3RlbSBpcyB1bmFibGUgdG8gcmV0cmlldmUgdGhlIGN1cnJlbnQgdXNlciBsb2dnZWQgaW4uIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgICAgKiAgICAgaWYgKG9iaikgew0KICAgICAgICAgICAqICAgICAgICAgYWxlcnQob2JqLmN1cnJlbnRVc2VyKTsNCiAgICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZ2V0Q3VycmVudFVzZXIoew0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0Q3VycmVudFVzZXI6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvcGVyc29uL3dob2FtaSI7DQogICAgICAgICAgICAgIGdldChjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gRm9yIHJldHJpZXZpbmcgdGhlIE9XRiBzeXN0ZW0gc2VydmVyIHZlcnNpb24NCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZm9yIHN1Y2Nlc3NmdWxseSByZXRyaWV2aW5nIHRoZSBzZXJ2ZXIgdmVyc2lvbiBvZiB0aGUgT1dGIHN5c3RlbS4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30ge3NlcnZlclZlcnNpb246IHNlcnZlciB2ZXJzaW9uPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN5c3RlbSBmYWlscyB0byByZXRyaWV2ZSB0aGUgc2VydmVyIHZlcnNpb24gb2YgdGhlIE9XRiBzeXN0ZW0uIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgICAgKiAgICAgaWYgKG9iaikgew0KICAgICAgICAgICAqICAgICAgICAgYWxlcnQob2JqLnNlcnZlclZlcnNpb24pOw0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5nZXRTZXJ2ZXJWZXJzaW9uKHsNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGdldFNlcnZlclZlcnNpb246IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvc2VydmVyL3Jlc291cmNlcyI7DQogICAgICAgICAgICAgIGdldChjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlcyBvciB1cGRhdGVzIGEgdXNlciBwcmVmZXJlbmNlIGZvciB0aGUgcHJvdmlkZWQgbmFtZXNwYWNlIGFuZCBuYW1lLg0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWVzcGFjZSAgVGhlIG5hbWVzcGFjZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLnZhbHVlICBUaGUgdmFsdWUgb2YgdGhlIHVzZXIgcHJlZmVyZW5jZS4gVGhlIHZhbHVlIGNhbiBiZSBhbnkgc3RyaW5nIGluY2x1ZGluZyBKU09OLg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpZiB0aGUgdXNlciBwcmVmZXJlbmNlIGlzIHN1Y2Nlc3NmdWxseSB1cGRhdGVkIGluDQogICAgICAgICAgICogdGhlIGRhdGFiYXNlLg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqIFRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzDQogICAgICAgICAgICogZnVuY3Rpb246DQogICAgICAgKiB7DQogICAgICAgKiAgICAgInZhbHVlIjoidHJ1ZSIsDQogICAgICAgKiAgICAgInBhdGgiOiJtaWxpdGFyeVRpbWUiLA0KICAgICAgICogICAgICJ1c2VyIjoNCiAgICAgICAqICAgICB7DQogICAgICAgKiAgICAgICAgICJ1c2VySWQiOiJ0ZXN0QWRtaW4xIg0KICAgICAgICogICAgIH0sDQogICAgICAgKiAgICAgIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIg0KICAgICAgICogfQ0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgY2Fubm90IGJlIHN0b3JlZCBpbiB0aGUgZGF0YWJhc2UuDQogICAgICAgICAgICogSWYgdGhpcyBmdW5jdGlvbiBpcyBub3Qgc3BlY2lmaWVkIGEgZGVmYXVsdCBlcnJvciBtZXNzYWdlIHdpbGwgYmUgZGlzcGxheWVkLiBUaGlzIGZ1bmN0aW9uIGlzIHBhc3NlZA0KICAgICAgICAgICAqIGJhY2sgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogZXJyb3I6IFN0cmluZzxicj4NCiAgICAgICAgICAgKiBUaGUgZXJyb3IgbWVzc2FnZTxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogU3RhdHVzOiBUaGUgSFRUUCBTdGF0dXMgY29kZTxicj4NCiAgICAgICAgICAgKiA0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4NCiAgICAgICAgICAgKiA1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPg0KICAgICAgICAgICAqIDQwNDogVGhlIHJlcXVlc3RlZCBlbnRpdHkgd2FzIG5vdCBmb3VuZC48YnI+DQogICAgICAgICAgICogNDAwOiBUaGUgcmVxdWVzdGVkIGVudGl0eSBmYWlsZWQgdG8gcGFzcyB2YWxpZGF0aW9uLjxicj4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogZnVuY3Rpb24gb25TdWNjZXNzKHByZWYpew0KICAgICAgICAgICAqICAgICBhbGVydChwcmVmLnZhbHVlKTsNCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBmdW5jdGlvbiBvbkZhaWx1cmUoZXJyb3Isc3RhdHVzKXsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoJ0Vycm9yICcgKyBlcnJvcik7DQogICAgICAgICAgICogICAgIGFsZXJ0KHN0YXR1cyk7DQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIHRleHQgPSAnR2VvcmdlIFdhc2hpbmd0b24nOw0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5zZXRVc2VyUHJlZmVyZW5jZSh7DQogICAgICAgICAgICogICAgIG5hbWVzcGFjZTonY29tLmNvbXBhbnkud2lkZ2V0JywNCiAgICAgICAgICAgKiAgICAgbmFtZTonRmlyc3QgUHJlc2lkZW50JywNCiAgICAgICAgICAgKiAgICAgdmFsdWU6dGV4dCwNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIHNldFVzZXJQcmVmZXJlbmNlIDogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvcHJlZmVyZW5jZS8iICsgY2ZnLm5hbWVzcGFjZSArICIvIiArIGNmZy5uYW1lOw0KICAgICAgICAgICAgICBpZiAoY2ZnLm1ldGhvZCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BVVCc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY2ZnLmNvbnRlbnQgPSB7DQogICAgICAgICAgICAgICAgICAnX21ldGhvZCc6IGNmZy5tZXRob2QsDQogICAgICAgICAgICAgICAgICAndmFsdWUnOiBjZmcudmFsdWUNCiAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICBpZiAoY2ZnLm9uU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgaWYgKCFjZmcub25GYWlsdXJlKSB7ICAvL211c3QgZW5zdXJlIHRoZXJlIGlzIGFuIG9uZmFpbHVyZSBtZXRob2QsIGFzIHdlIHVzaW5nIGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgICBjZmcub25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KE96b25lLnV0aWwuRXJyb3JNZXNzYWdlU3RyaW5nLnNhdmVVc2VyUHJlZmVyZW5jZXMgKyAiIDogIiArIGVycik7DQogICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmRBbmRGb3JnZXQoY2ZnKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gRGVsZXRlcyBhIHVzZXIgcHJlZmVyZW5jZSB3aXRoIHRoZSBwcm92aWRlZCBuYW1lc3BhY2UgYW5kIG5hbWUuDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugb2YgdGhlIHVzZXIgcHJlZmVyZW5jZQ0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZSBUaGUgbmFtZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgaXMgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgZnJvbSB0aGUgZGF0YWJhc2UuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKiBUaGUgZm9sbG93aW5nIGlzIGFuIGV4YW1wbGUgb2YgYSBjb21wbGV0ZSBwcmVmZXJlbmNlIG9iamVjdCBwYXNzZWQgdG8gdGhlIG9uU3VjY2Vzcw0KICAgICAgICAgICAqIGZ1bmN0aW9uOg0KICAgICAgICAgICAqDQogICAgICAgICAgICogew0KICAgICAgICAgICAqICAgICAidmFsdWUiOiJ0cnVlIiwNCiAgICAgICAgICAgKiAgICAgInBhdGgiOiJtaWxpdGFyeVRpbWUiLA0KICAgICAgICAgICAqICAgICAidXNlciI6DQogICAgICAgICAgICogICAgIHsNCiAgICAgICAgICAgKiAgICAgICAgICJ1c2VySWQiOiJ0ZXN0QWRtaW4xIg0KICAgICAgICAgICAqICAgICB9LA0KICAgICAgICAgICAqICAgICAibmFtZXNwYWNlIjoiY29tLm15Y29tcGFueS5Bbm5vdW5jaW5nQ2xvY2siDQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgY2Fubm90IGJlIGRlbGV0ZWQgZnJvbSB0aGUNCiAgICAgICAgICAgKiBkYXRhYmFzZSBvciBpZiB0aGUgcHJlZmVyZW5jZSBkb2VzIG5vdCBleGlzdC4gSWYgdGhpcyBmdW5jdGlvbiBpcyBub3Qgc3BlY2lmaWVkIGEgZGVmYXVsdCBlcnJvciBtZXNzYWdlIHdpbGwgYmUNCiAgICAgICAgICAgKiBkaXNwbGF5ZWQuIFRoaXMgZnVuY3Rpb24gaXMgcGFzc2VkIGJhY2sgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOiA8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIGVycm9yOiBTdHJpbmcgPGJyPg0KICAgICAgICAgICAqIFRoZSBlcnJvciBtZXNzYWdlIDxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogU3RhdHVzOiBUaGUgSFRUUCBTdGF0dXMgY29kZTxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogNDAxOiBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIGVudGl0eS48YnI+DQogICAgICAgICAgICogNTAwOiBBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLjxicj4NCiAgICAgICAgICAgKiA0MDQ6IFRoZSB1c2VyIHByZWZlcmVuY2Ugd2FzIG5vdCBmb3VuZC48YnI+DQogICAgICAgICAgICogNDAwOiBUaGUgcmVxdWVzdGVkIGVudGl0eSBmYWlsZWQgdG8gcGFzcyB2YWxpZGF0aW9uLiA8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICogZnVuY3Rpb24gb25TdWNjZXNzKHByZWYpew0KICAgICAgICAgICAqICAgICBhbGVydChwcmVmLnZhbHVlKTsNCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBmdW5jdGlvbiBvbkZhaWx1cmUoZXJyb3Isc3RhdHVzKXsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoJ0Vycm9yICcgKyBlcnJvcik7DQogICAgICAgICAgICogICAgIGFsZXJ0KHN0YXR1cyk7DQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmRlbGV0ZVVzZXJQcmVmZXJlbmNlKHsNCiAgICAgICAgICAgKiAgICAgbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLA0KICAgICAgICAgICAqICAgICBuYW1lOidGaXJzdCBQcmVzaWRlbnQnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZGVsZXRlVXNlclByZWZlcmVuY2UgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICJERUxFVEUiOw0KICAgICAgICAgICAgICAvL2lnb25vcmUgNDA0IGVycm9yIGNvZGUsIG9uU3VjY2VzcyB3aWxsIGJlIGNhbGxlZCB3aXRoIG51bGwgcGF5bG9hZA0KICAgICAgICAgICAgICBjZmcuaWdub3JlZEVycm9yQ29kZXMgPSBbNDA0XTsNCiAgICAgICAgICAgICAgY2ZnLnBhdGggPSBjZmcubmFtZTsNCiAgICAgICAgICAgICAgT3pvbmUucHJlZi5QcmVmU2VydmVyLnNldFVzZXJQcmVmZXJlbmNlKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0RGVwZW5kZW50V2lkZ2V0cyA6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAnL3dpZGdldERlZmluaXRpb24vZGVwZW5kZW50cyc7DQogICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnUE9TVCc7DQogICAgICAgICAgICAgIGlmICghY2ZnLmNvbnRlbnQpIHsgY2ZnLmNvbnRlbnQgPSB7fTsgfQ0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0RGVwZW5kZW50UGVyc29uV2lkZ2V0cyA6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAnL3BlcnNvbldpZGdldERlZmluaXRpb24vZGVwZW5kZW50cyc7DQogICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnUE9TVCc7DQogICAgICAgICAgICAgIGlmICghY2ZnLmNvbnRlbnQpIHsgY2ZnLmNvbnRlbnQgPSB7fTsgfQ0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAgICovDQogICAgICAgICAgZGVsZXRlV2lkZ2V0RGVmcyA6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAnL3dpZGdldERlZmluaXRpb24nOw0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ0RFTEVURSc7DQogICAgICAgICAgICAgIGlmICghY2ZnLmNvbnRlbnQpIHsgY2ZnLmNvbnRlbnQgPSB7fTsgfQ0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfQ0KDQogICAgICB9Ow0KICB9Ow0KDQogIHZhciBjb25maWdQYXJhbXMgPSBPem9uZS51dGlsLnBhcnNlV2luZG93TmFtZURhdGEoKTsNCiAgdmFyIHVybCA9IG51bGw7DQogIGlmIChjb25maWdQYXJhbXMgIT0gbnVsbCAmJiBjb25maWdQYXJhbXMucHJlZmVyZW5jZUxvY2F0aW9uICE9IG51bGwpIHsNCiAgIHVybCA9IGNvbmZpZ1BhcmFtcy5wcmVmZXJlbmNlTG9jYXRpb247DQogIH0NCiAgZWxzZSB7DQogICAgdXJsID0gT3pvbmUuY29uZmlnLnByZWZzTG9jYXRpb247DQogIH0NCg0KICBPem9uZS5wcmVmLlByZWZTZXJ2ZXIgPSBPem9uZS5wcmVmLlByZWZTZXJ2ZXIodXJsKTsNCiAgaWYodXJsID09IG51bGwpIHsNCiAgICBmb3IgKHZhciBmbmFtZSBpbiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIpICB7DQogICAgICBpZiAodHlwZW9mIE96b25lLnByZWYuUHJlZlNlcnZlcltmbmFtZV0gPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAvL2R1bW15ZnkNCiAgICAgICAgT3pvbmUucHJlZi5QcmVmU2VydmVyW2ZuYW1lXSA9IGZ1bmN0aW9uKCl7fTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn0od2luZG93LCBkb2N1bWVudCkpOw0KCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307DQoNCi8qKg0KICogQGlnbm9yZQ0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5ldmVudGluZyA9IE96b25lLmV2ZW50aW5nID8gT3pvbmUuZXZlbnRpbmcgOiB7fTsNCg0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy9Pem9uZSBFdmVudGluZyBXaWRnZXQgT2JqZWN0DQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovKioNCiAqIEBkZXByZWNhdGVkIFNpbmNlIE9XRiAzLjcuMCAgWW91IHNob3VsZCB1c2UgPGEgaHJlZj0iIy5nZXRJbnN0YW5jZSI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlPC9hPg0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge1N0cmluZ30gd2lkZ2V0UmVsYXkgVGhlIFVSTCBmb3IgdGhlIHdpZGdldCByZWxheSBmaWxlLiBUaGUgcmVsYXkgZmlsZSBtdXN0IGJlIHNwZWNpZmllZCB3aXRoIGZ1bGwgbG9jYXRpb24gZGV0YWlscywgYnV0IHdpdGhvdXQgYSBmdWxseQ0KICogcXVhbGlmaWVkIHBhdGguIEluIHRoZSBjYXNlIHdoZXJlIHRoZSByZWxheSBpcyByZXNpZGluZyBAIGh0dHA6Ly9zZXJ2ZXIvcGF0aC9yZWxheS5odG1sLCB0aGUgcGF0aCB1c2VkIG11c3QgYmUgZnJvbSB0aGUgY29udGV4dCByb290IG9mIHRoZSBsb2NhbA0KICogd2lkZ2V0LiBJbiB0aGlzIGNhc2UsIGl0IHdvdWxkIGJlIC9wYXRoL3JlbGF5Lmh0bWwuICBEbyBub3QgaW5jbHVkZSB0aGUgcHJvdG9jb2wuDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBhZnRlckluaXQgLSBjYWxsYmFjayB0byBiZSBleGVjdXRlZCBhZnRlciB0aGUgd2lkZ2V0IGlzIGZpbmlzaGVkIGluaXRpYWxpemluZy4NCiAqIEBkZXNjcmlwdGlvbiBUaGUgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0IG9iamVjdCBtYW5hZ2VzIHRoZSBldmVudGluZyBmb3IgYW4gaW5kaXZpZHVhbCB3aWRnZXQgKERlcHJlY2F0ZWQpLiAgVGhpcyBjb25zdHJ1Y3RvciBpcyBkZXByZWNhdGVkLg0KICogIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZTwvYT4NCiAqIEBleGFtcGxlDQogKiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IG5ldyBPem9uZS5ldmVudGluZy5XaWRnZXQoDQogKiAnb3dmLXNhbXBsZS1odG1sL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbCcsIGZ1bmN0aW9uKCkgew0KICogDQogKiAgLy9wdXQgY29kZSBoZXJlIHRvIGV4ZWN1dGUgYWZ0ZXIgd2lkZ2V0IGluaXQgLSBwZXJoYXBzIGltbWVkaWF0ZWx5IHB1Ymxpc2ggdG8gYSBjaGFubmVsDQogKiANCiAqIH0pOw0KICogQHRocm93cyB7RXJyb3J9IHRocm93cyBhbiBlcnJvciB3aXRoIGEgbWVzc2FnZSBpZiB3aWRnZXQgaW5pdGlhbGl6YXRpb24gZmFpbHMNCiAqLw0KT3pvbmUuZXZlbnRpbmcuV2lkZ2V0ID0gZnVuY3Rpb24od2lkZ2V0UmVsYXksIGFmdGVySW5pdCkgew0KICBpZiAoT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlID09IG51bGwpIHsNCiAgICBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UgPSB0aGlzOw0KICAgIHRoaXMuaXNBZnRlckluaXQgPSBmYWxzZTsNCiAgICAvL2Nvbm5lY3QgcGFzc2VkIGluIGZ1bmN0aW9uIHRvIHRoZSBpbnRlcm5hbCBjYWxsYmFjayBmdW5jdGlvbg0KICAgIGlmIChhZnRlckluaXQgIT0gbnVsbCkgew0KICAgICAgb3dmZG9qby5jb25uZWN0KA0KICAgICAgICAgICAgICB0aGlzLCdhZnRlckluaXRDYWxsQmFjaycsDQogICAgICAgICAgICAgIHRoaXMsYWZ0ZXJJbml0KTsNCiAgICB9DQogICAgdGhpcy5zZXRXaWRnZXRSZWxheSh3aWRnZXRSZWxheSk7DQogICAgdHJ5IHsNCiAgICAgICAgdGhpcy53aWRnZXRJbml0KCk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgdGhyb3cgJ1dpZGdldCByZWxheSBpbml0IGZhaWxlZC4gUmVsYXlpbmcgd2lsbCBub3Qgd29yay4gSW5uZXIgRXhjZXB0aW9uOiAnICsgZXJyb3IubmFtZSArICI6ICIgKyBlcnJvci5tZXNzYWdlOw0KICAgIH0NCiAgfQ0KICBlbHNlIHsNCiAgICBpZiAoYWZ0ZXJJbml0ICE9IG51bGwpIHsNCiAgICAgIGlmICh0aGlzLmlzQWZ0ZXJJbml0ID09PSBmYWxzZSkgew0KICAgICAgICAvL2Nvbm5lY3QgcGFzc2VkIGluIGZ1bmN0aW9uIHRvIHRoZSBpbnRlcm5hbCBjYWxsYmFjayBmdW5jdGlvbg0KICAgICAgICBvd2Zkb2pvLmNvbm5lY3QoDQogICAgICAgICAgICAgICAgdGhpcywnYWZ0ZXJJbml0Q2FsbEJhY2snLA0KICAgICAgICAgICAgICAgIHRoaXMsYWZ0ZXJJbml0KTsNCiAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgLy9hbHJlYWR5IGluaXRpYWxpemVkIGp1c3QgZXhlY3V0ZSB0aGUgc3VwcGxpZWQgY2FsbGJhY2sNCiAgICAgICAgc2V0VGltZW91dChhZnRlckluaXQsNTApOw0KICB9DQogICAgfQ0KICB9DQogIHJldHVybiBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2U7DQp9Ow0KDQovKioNCiAqIEBkZXNjcmlwdGlvbiBUaGUgbG9jYXRpb24gb2YgdGhlIHdpZGdldCByZWxheSBmaWxlLiAgVGhlIHJlbGF5IGZpbGUgc2hvdWxkIGJlIGRlZmluZWQNCiAqICAgZ2xvYmFsbHkgZm9yIHRoZSBlbnRpcmUgd2lkZ2V0IGJ5IHNldHRpbmcgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMIHRvIHRoZSByZWxheSBmaWxlIHVybCwgaW1tZWRpYXRlbHkgYWZ0ZXINCiAqICAgaW5jbHVkaW5nIHRoZSB3aWRnZXQgYnVuZGxlIGphdmFzY3JpcHQuICBJZiB0aGUgcmVsYXkgaXMgbm90IGRlZmluZWQgYXQgYWxsIGl0IGlzIGFzc3VtZWQgdG8gYmUgYXQNCiAqICAgL1tjb250ZXh0XS9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwuIFRoZSByZWxheSBmaWxlIG11c3QgYmUgc3BlY2lmaWVkIHdpdGggZnVsbCBsb2NhdGlvbiBkZXRhaWxzLCBidXQgd2l0aG91dCBhIGZ1bGx5DQogKiAgIHF1YWxpZmllZCBwYXRoLiBJbiB0aGUgY2FzZSB3aGVyZSB0aGUgcmVsYXkgaXMgcmVzaWRpbmcgQCBodHRwOi8vc2VydmVyL3BhdGgvcmVsYXkuaHRtbCwgdGhlIHBhdGggdXNlZCBtdXN0IGJlIGZyb20gdGhlIGNvbnRleHQgcm9vdCBvZiB0aGUgbG9jYWwNCiAqICAgd2lkZ2V0LiBJbiB0aGlzIGNhc2UsIGl0IHdvdWxkIGJlIC9wYXRoL3JlbGF5Lmh0bWwuICBEbyBub3QgaW5jbHVkZSB0aGUgcHJvdG9jb2wuDQogKiBAc2luY2UgT1dGIDMuNy4wDQogKiBAZXhhbXBsZQ0KICogJmx0O3NjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iLi4vLi4vanMtbWluL293Zi13aWRnZXQtbWluLmpzIiZndDsmbHQ7L3NjcmlwdCZndDsNCiAqICZsdDtzY3JpcHQmZ3Q7DQogKiAgICAgICAvL1RoZSBsb2NhdGlvbiBpcyBhc3N1bWVkIHRvIGJlIGF0IC9bY29udGV4dF0vanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sIGlmIGl0IGlzIG5vdA0KICogICAgICAgLy9zZXQgdGhlIHBhdGggY29ycmVjdGx5IGJlbG93DQogKiAgICAgICBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgPSAnL293Zi9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwnOw0KICogICAgICAgLy8uLi4NCiAqICZsdDsvc2NyaXB0Jmd0Ow0KICoNCiAqLw0KT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMID0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMID8gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMIDogbnVsbDsNCg0KT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LnByb3RvdHlwZSA9IHsNCg0KICAgIHZlcnNpb246IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24uZXZlbnRpbmcsDQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogQHJldHVybnMgVGhlIFVSTCBmb3IgdGhlIHdpZGdldFJlbGF5DQogICAgICogQGRlc2NyaXB0aW9uIFRoaXMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyY29kZS4NCiAgICAgKi8NCiAgICBnZXRXaWRnZXRSZWxheSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy53aWRnZXRSZWxheTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBAcGFyYW0gVGhlIHJlbGF5cGF0aCB0byBzZXQuDQogICAgICogQGRlc2NyaXB0aW9uIFRoaXMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyY29kZS4NCiAgICAgKi8NCiAgICBzZXRXaWRnZXRSZWxheSA6IGZ1bmN0aW9uKHJlbGF5cGF0aCkgew0KICAgICAgLy9pZiBudWxsIGZpZ3VyZSBvdXQgcGF0aA0KICAgICAgaWYgKHJlbGF5cGF0aCA9PSBudWxsKSB7DQogICAgICAgIC8vY2hlY2sgaWYgZ2xvYmFsIHBhdGggdmFyaWFibGUgd2FzIHNldA0KICAgICAgICBpZiAoT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMICE9IG51bGwpIHsNCiAgICAgICAgICByZWxheXBhdGggPSBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkw7DQogICAgICAgIH0NCiAgICAgICAgLy9lbHNlIGNhbGN1bGF0ZSBhIHN0YW5kYXJkIHJlbGF0aXZlIHBhdGgNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgLy9maW5kIHJvb3QgY29udGV4dCAtIGFzc3VtZSByZWxheSBmaWxlIGlzIGF0IC88Y29udGV4dC9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwNCiAgICAgICAgICB2YXIgYmFzZUNvbnRleHRQYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICAgICAgICAgIHZhciBiYXNlQ29udGV4dFBhdGhSZWdleCA9IC9eKFwvW15cL10rXC8pLiokL2k7DQogICAgICAgICAgdmFyIG1hdGNoZXMgPSBiYXNlQ29udGV4dFBhdGgubWF0Y2goYmFzZUNvbnRleHRQYXRoUmVnZXgpOw0KICAgICAgICAgIGlmIChtYXRjaGVzICE9IG51bGwgJiYgbWF0Y2hlc1sxXSAhPSBudWxsICYmIG1hdGNoZXNbMV0ubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgYmFzZUNvbnRleHRQYXRoID0gbWF0Y2hlc1sxXTsNCiAgICAgICAgICAgIC8vcmVtb3ZlIGZpbmFsIC8NCiAgICAgICAgICAgIGJhc2VDb250ZXh0UGF0aCA9IGJhc2VDb250ZXh0UGF0aC5zdWJzdHJpbmcoMCxiYXNlQ29udGV4dFBhdGgubGVuZ3RoLTEpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGJhc2VDb250ZXh0UGF0aCA9ICcnOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZWxheXBhdGggPSBiYXNlQ29udGV4dFBhdGggKyAnL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbCc7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMud2lkZ2V0UmVsYXkgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAocmVsYXlwYXRoLmNoYXJBdCgwKSAhPSAnLyc/ICgnLycrcmVsYXlwYXRoKSA6IHJlbGF5cGF0aCk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgV2lkZ2V0IElkDQogICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHdpZGdldElkIGlzIGEgY29tcGxleCBKU09OIGVuY29kZWQgc3RyaW5nIHdoaWNoIGlkZW50aWZpZXMgYSB3aWRnZXQgZm9yIEV2ZW50aW5nLg0KICAgICAqICAgRW1iZWRkZWQgaW4gdGhpcyBzdHJpbmcgaXMgdGhlIHdpZGdldCdzIHVuaXF1ZUlkIGFzIHRoZSAnaWQnIGF0dHJpYnV0ZS4gIFRoZXJlIGlzIG90aGVyIGRhdGEgaXMgaW4gdGhlIHN0cmluZw0KICAgICAqICAgd2hpY2ggaXMgbmVlZGVkIGZvciBFdmVudGluZyBhbmQgb3RoZXIgQVBJcyB0byBmdW5jdGlvbiBwcm9wZXJseS4gVGhpcyBjb21wbGV4IHdpZGdldElkIHN0cmluZyBtYXkgYmUgdXNlZCBpbg0KICAgICAqICAgdGhlIDxhIGhyZWY9IiNwdWJsaXNoIj5Pem9uZS5ldmVudGluZy5XaWRnZXQucHVibGlzaDwvYT4gZnVuY3Rpb24gdG8gZGVzaWduYXRlIGEgc3BlY2lmaWMgcmVjaXBpZW50IGZvciBhIG1lc3NhZ2UuDQogICAgICogICBBZGRpdGlvbmFsbHksIG9uY2Ugc3Vic2NyaWJlZCB0byBhIGNoYW5uZWwgdmlhIDxhIGhyZWY9IiNzdWJzY3JpYmUiPk96b25lLmV2ZW50aW5nLldpZGdldC5zdWJzY3JpYmU8L2E+IGR1cmluZyB0aGUNCiAgICAgKiAgIHJlY2VpcHQgb2YgYSBtZXNzYWdlLCB0aGUgc2VuZGVyJ3Mgd2lkZ2V0SWQgaXMgbWFkZSBhdmFpbGFibGUgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICogLy9kZWNvZGUgYW5kIHJldHJpZXZlIHRoZSB3aWRnZXQncyB1bmlxdWUgaWQNCiAgICAgKiB2YXIgY29tcGxleElkU3RyaW5nID0gdGhpcy5ldmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKTsNCiAgICAgKiB2YXIgY29tcGxleElkT2JqID0gb3dmZG9qby50b0pzb24oY29tcGxleElkU3RyaW5nKTsNCiAgICAgKg0KICAgICAqIC8vY29tcGxleElkT2JqIHdpbGwgbG9vayBsaWtlDQogICAgICogLy8gew0KICAgICAqIC8vICAvL3dpZGdldCdzIHVuaXF1ZUlkDQogICAgICogLy8gIGlkOiI0OWNkMjFmMC0zMTEwLTgxMjEtZDkwNS0xOGZmYTgxYjQ0MmUiDQogICAgICogLy8gfQ0KICAgICAqDQogICAgICogLy9nZXQgV2lkZ2V0J3MgdW5pcXVlSWQNCiAgICAgKiBhbGVydCgnd2lkZ2V0IGlkID0gJyArIGNvbXBsZXhJZE9iai5pZCk7DQogICAgICovDQogICAgZ2V0V2lkZ2V0SWQgOiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMud2lkZ2V0SWQ7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogQHJldHVybnMgVGhlIGNvbnRhaW5lclJlbGF5DQogICAgICogQGRlc2NyaXB0aW9uIFRoaXMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyY29kZS4NCiAgICAgKi8NCiAgICBnZXRDb250YWluZXJSZWxheSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXJSZWxheTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgaXMgY2FsbGVkIGJ5IHRoZSBXaWRnZXQncyBjb25zdHJ1Y3Rvci4gSXQgc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZS4NCiAgICAgKi8NCiAgICB3aWRnZXRJbml0IDogZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBxdWVyeUhhc2ggPSB7fTsNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBudWxsOw0KDQogICAgICAgIC8vY2hlY2sgZm9yIGRhdGEgaW4gd2luZG93Lm5hbWUNCiAgICAgICAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOw0KICAgICAgICBpZiAoY29uZmlnUGFyYW1zICE9IG51bGwpIHsNCg0KICAgICAgICAgIC8vdGhlIGlkIGlzIHRoZSB3aG9sZSBjb250ZW50cyBvZiB0aGUgd2luZG93Lm5hbWUNCiAgICAgICAgICB0aGlzLndpZGdldElkID0gJ3tcImlkXCI6XCInICsgY29uZmlnUGFyYW1zLmlkICsgJ1wifSc7DQogICAgICAgICAgdGhpcy5sb2NrZWQgPSBjb25maWdQYXJhbXMubG9ja2VkOw0KDQogICAgICAgICAgLy9lbWJlZGRlZCBpbiB0aGUgaWQgaXMgdGhlIHJlbGF5DQogICAgICAgICAgdGhpcy5jb250YWluZXJSZWxheSA9IGNvbmZpZ1BhcmFtcy5yZWxheVVybDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICB0aHJvdyB7DQogICAgICAgICAgICBuYW1lIDonV2lkZ2V0SW5pdEV4Y2VwdGlvbicsDQogICAgICAgICAgICBtZXNzYWdlIDonVGhlIGNhbGwgdG8gY29udGFpbmVyX2luaXQgZmFpbGVkLiBJbm5lciBFeGNlcHRpb246ICcNCiAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgZ2FkZ2V0cy5ycGMuc2V0UmVsYXlVcmwoIi4uIiwgdGhpcy5jb250YWluZXJSZWxheSwgZmFsc2UsIHRydWUpOw0KDQogICAgICAgIA0KICAgICAgICB2YXIgb25DbGlja0hhbmRsZXIsDQogICAgICAgICAgICBvbktleURvd25IYW5kbGVyOw0KDQogICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlV2lkZ2V0KCkgew0KDQogICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICAgZm46ICJhY3RpdmF0ZVdpZGdldCIsDQogICAgICAgICAgICAgICAgIHBhcmFtczogew0KICAgICAgICAgICAgICAgICAgICBndWlkOiBjb25maWdQYXJhbXMuaWQsDQogICAgICAgICAgICAgICAgICAgIGZvY3VzSWZyYW1lOiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBkb2N1bWVudC5ib2R5DQogICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgdmFyIHN0YXRlQ2hhbm5lbCA9ICdfV0lER0VUX1NUQVRFX0NIQU5ORUxfJyArIGNvbmZpZ1BhcmFtcy5pZDsNCiAgICAgICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZUFjdGl2YXRlV2lkZ2V0KSB7DQogICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHN0YXRlQ2hhbm5lbCwgbnVsbCwgdGhpcy53aWRnZXRJZCwgY29uZmlnKTsNCiAgICAgICAgICAgICB9DQogICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICB0aGlzLmRpc2FibGVBY3RpdmF0ZVdpZGdldCA9IGZhbHNlOw0KICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vcmVnaXN0ZXIgZm9yIGFmdGVyX2NvbnRhaW5lcl9pbml0DQogICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJhZnRlcl9jb250YWluZXJfaW5pdCIsIG93ZmRvam8uaGl0Y2godGhpcyxmdW5jdGlvbigpIHsNCg0KICAgICAgICAgICAgZ2FkZ2V0cy5ycGMudW5yZWdpc3RlcigiYWZ0ZXJfY29udGFpbmVyX2luaXQiKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy9hdHRhY2ggbW91c2UgY2xpY2sgYW5kIGtleWRvd24gbGlzdGVuZXIgdG8gc2VuZCBhY3RpdmF0ZSBjYWxscyBmb3IgdGhlIHdpZGdldA0KICAgICAgICAgICAgaWYoIW9uQ2xpY2tIYW5kbGVyKSB7DQogICAgICAgICAgICAgICAgb25DbGlja0hhbmRsZXIgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdjbGljaycsIG93ZmRvam8uaGl0Y2godGhpcywgYWN0aXZhdGVXaWRnZXQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9uS2V5RG93bkhhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICBvbktleURvd25IYW5kbGVyID0gb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb25rZXl1cCcsIG93ZmRvam8uaGl0Y2godGhpcywgYWN0aXZhdGVXaWRnZXQpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9leGVjdXRlIGNhbGxiYWNrDQogICAgICAgICAgICB0aGlzLmFmdGVyQ29udGFpbmVySW5pdCgpOw0KDQogICAgICAgIH0pKTsNCg0KICAgICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcigiX3dpZGdldF9hY3RpdmF0ZWQiLCBvd2Zkb2pvLmhpdGNoKHRoaXMsZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJfd2lkZ2V0X2FjdGl2YXRlZCA9PiAiICsgY29uZmlnUGFyYW1zLmlkKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYob25DbGlja0hhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICBvd2Zkb2pvLmRpc2Nvbm5lY3Qob25DbGlja0hhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYob25DbGlja0hhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICBvd2Zkb2pvLmRpc2Nvbm5lY3Qob25LZXlEb3duSGFuZGxlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIG9uQ2xpY2tIYW5kbGVyID0gbnVsbDsNCiAgICAgICAgICAgIG9uS2V5RG93bkhhbmRsZXIgPSBudWxsOw0KDQogICAgICAgIH0pKTsNCg0KICAgICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcigiX3dpZGdldF9kZWFjdGl2YXRlZCIsIG93ZmRvam8uaGl0Y2godGhpcyxmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIC8vY29uc29sZS5sb2coIl93aWRnZXRfZGVhY3RpdmF0ZWQgPT4gIiArIGNvbmZpZ1BhcmFtcy5pZCk7DQoNCiAgICAgICAgICAgIGlmKCFvbkNsaWNrSGFuZGxlcikgew0KICAgICAgICAgICAgICAgIG9uQ2xpY2tIYW5kbGVyID0gb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnY2xpY2snLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIGFjdGl2YXRlV2lkZ2V0KSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZighb25LZXlEb3duSGFuZGxlcikgew0KICAgICAgICAgICAgICAgIG9uS2V5RG93bkhhbmRsZXIgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbmtleXVwJywgb3dmZG9qby5oaXRjaCh0aGlzLCBhY3RpdmF0ZVdpZGdldCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSk7DQoNCiAgICAgICAgLy9yZWdpc3RlciB3aXRoIGNvbnRhaW5lcg0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdmFyIGlkU3RyaW5nID0gJ3tcImlkXCI6XCInICsgY29uZmlnUGFyYW1zLmlkICsgJ1wifSc7DQogICAgICAgICAgICB2YXIgZGF0YSA9IHsNCiAgICAgICAgICAgICAgaWQ6IGlkU3RyaW5nLA0KICAgICAgICAgICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb24sDQogICAgICAgICAgICAgIHVzZU11bHRpUGFydE1lc3NhZ2VzRm9ySUZQQzogdHJ1ZSwNCiAgICAgICAgICAgICAgcmVsYXlVcmw6IHRoaXMud2lkZ2V0UmVsYXkNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGlmIChPem9uZS51dGlsLnBhZ2VMb2FkLmxvYWRUaW1lICE9IG51bGwgJiYgT3pvbmUudXRpbC5wYWdlTG9hZC5hdXRvU2VuZCkgew0KICAgICAgICAgICAgICBkYXRhLmxvYWRUaW1lID0gT3pvbmUudXRpbC5wYWdlTG9hZC5sb2FkVGltZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9qc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgICAgIGpzb25TdHJpbmcgPSBPem9uZS51dGlsLnRvU3RyaW5nKGRhdGEpOw0KICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCAnY29udGFpbmVyX2luaXQnLCBudWxsLCBpZFN0cmluZywganNvblN0cmluZyk7DQoNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIHRocm93IHsNCiAgICAgICAgICAgICAgICBuYW1lIDonV2lkZ2V0SW5pdEV4Y2VwdGlvbicsDQogICAgICAgICAgICAgICAgbWVzc2FnZSA6J1RoZSBjYWxsIHRvIGNvbnRhaW5lcl9pbml0IGZhaWxlZC4gSW5uZXIgRXhjZXB0aW9uOiAnICsgZXJyb3INCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICB9LA0KDQogICAgaXNJbml0aWFsaXplZDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gdGhpcy5pc0FmdGVySW5pdDsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIGRlZmF1bHQgbm9vcCBjYWxsYmFjaw0KICAgICAqLw0KICAgIGFmdGVySW5pdENhbGxCYWNrOiBmdW5jdGlvbih3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpIHsNCg0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBieSB0aGUgV2lkZ2V0J3MgY29uc3RydWN0b3IuIEl0IHNob3VsZCBuZXZlciBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUuDQogICAgICovDQogICAgIGFmdGVyQ29udGFpbmVySW5pdDogZnVuY3Rpb24oKSB7DQogICAgICAgdGhpcy5pc0FmdGVySW5pdCA9IHRydWU7DQogICAgICAgaWYgKHRoaXMuYWZ0ZXJJbml0Q2FsbEJhY2sgIT0gbnVsbCkgew0KICAgICAgICAgdGhpcy5hZnRlckluaXRDYWxsQmFjayh0aGlzKTsNCiAgICAgICB9DQogICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICovDQogICAgcmVnaXN0ZXJIYW5kbGVyIDogZnVuY3Rpb24oaGFuZGxlck5hbWUsIGhhbmRsZXJPYmplY3QpIHsNCiAgICAgIC8vU2ltcGxlIHdyYXBwZXIgZm9yIG1hbmFnZXIgb2JqZWN0cyB0byByZWdpc3RlciBoYW5kbGVyIGZ1bmN0aW9ucw0KICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoaGFuZGxlck5hbWUsIGhhbmRsZXJPYmplY3QpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogV3JhcHMgZ2FkZ2V0cy5ycGMuY2FsbC4NCiAgICAgKi8NCiAgICBzZW5kOmZ1bmN0aW9uICgpIHsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbC5hcHBseShnYWRnZXRzLnJwYywgYXJndW1lbnRzKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogQGRlc2NyaXB0aW9uIFN1YnNjcmliZSB0byBhIG5hbWVkIGNoYW5uZWwgZm9yIGEgZ2l2ZW4gZnVuY3Rpb24uDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBjaGFubmVsIHRvIHN1YnNjcmliZSB0by4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBmdW5jdGlvbiB5b3Ugd2lzaCB0byBzdWJzY3JpYmUuICBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhyZWUNCiAgICAgKiAgIGFyZ3VtZW50czogc2VuZGVyLCBtc2csIGNoYW5uZWwuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtoYW5kbGVyLnNlbmRlcl0gVGhlIGZpcnN0IGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaWQgb2YgdGhlIHNlbmRlcg0KICAgICAqICAgb2YgdGhlIG1lc3NhZ2UuICBTZWUgPGEgaHJlZj0iI2dldFdpZGdldElkIj5Pem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0V2lkZ2V0SWQ8L2E+DQogICAgICogICBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGlzIGlkLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbaGFuZGxlci5tc2ddIFRoZSBzZWNvbmQgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBtZXNzYWdlIGl0c2VsZi4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2hhbmRsZXIuY2hhbm5lbF0gVGhlIHRoaXJkIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgY2hhbm5lbCB0aGUgbWVzc2FnZSB3YXMNCiAgICAgKiAgIHB1Ymxpc2hlZCBvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyID0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlKCk7DQogICAgICogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuc3Vic2NyaWJlKCJDbG9ja0NoYW5uZWwiLCB0aGlzLnVwZGF0ZSk7DQogICAgICoNCiAgICAgKiB2YXIgdXBkYXRlID0gZnVuY3Rpb24oc2VuZGVyLCBtc2csIGNoYW5uZWwpIHsNCiAgICAgKiAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnRUaW1lJykuaW5uZXJIVE1MID0gbXNnOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqLw0KICAgIHN1YnNjcmliZSA6IGZ1bmN0aW9uKGNoYW5uZWxOYW1lLCBoYW5kbGVyKSB7DQogICAgICAgIGdhZGdldHMucHVic3ViLnN1YnNjcmliZShjaGFubmVsTmFtZSwgaGFuZGxlcik7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQGRlc2NyaXB0aW9uIFVuc3Vic2NyaWJlIHRvIGEgbmFtZWQgY2hhbm5lbA0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjaGFubmVsTmFtZSBUaGUgY2hhbm5lbCB0byB1bnN1YnNjcmliZSB0by4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnVuc3Vic2NyaWJlKCJDbG9ja0NoYW5uZWwiKTsNCiAgICAgKi8NCiAgICB1bnN1YnNjcmliZSA6IGZ1bmN0aW9uKGNoYW5uZWxOYW1lKSB7DQogICAgICAgIGdhZGdldHMucHVic3ViLnVuc3Vic2NyaWJlKGNoYW5uZWxOYW1lKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gUHVibGlzaCBhIG1lc3NhZ2UgdG8gYSBnaXZlbiBjaGFubmVsDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBuYW1lIG9mIHRoZSBjaGFubmVsIHRvIHB1Ymxpc2ggdG8NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBwdWJsaXNoIHRvIHRoZSBjaGFubmVsLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGVzdF0gVGhlIGlkIG9mIGEgcGFydGljdWxhciBkZXN0aW5hdGlvbi4gIERlZmF1bHRzIHRvIG51bGwgd2hpY2ggc2VuZHMgdG8gYWxsDQogICAgICogICAgICAgICAgICAgICAgIHN1YnNjcmliZXJzIG9uIHRoZSBjaGFubmVsLiAgU2VlIDxhIGhyZWY9IiNnZXRXaWRnZXRJZCI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldFdpZGdldElkPC9hPg0KICAgICAqICAgICAgICAgICAgICAgICBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgaWQuDQogICAgICogQGV4YW1wbGUNCiAgICAgKiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IE96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZSgpOw0KICAgICAqIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnB1Ymxpc2goIkNsb2NrQ2hhbm5lbCIsIGN1cnJlbnRUaW1lU3RyaW5nKTsNCiAgICAgKi8NCiAgICBwdWJsaXNoIDogZnVuY3Rpb24oY2hhbm5lbE5hbWUsIG1lc3NhZ2UsIGRlc3QpIHsNCiAgICAgICAgZ2FkZ2V0cy5wdWJzdWIucHVibGlzaChjaGFubmVsTmFtZSwgbWVzc2FnZSwgZGVzdCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCn07DQoNCi8qKg0KICogQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5ldmVudGluZy5XaWRnZXQgU2luZ2xldG9uIGluc3RhbmNlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbYWZ0ZXJJbml0XSBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciB0aGUgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0IHNpbmdsZXRvbiBpcyBpbml0aWFsaXplZA0KICogQHBhcmFtIHtTdHJpbmd9IFt3aWRnZXRSZWxheV0gT3B0aW9uYWxseSByZWRlZmluZSB0aGUgbG9jYXRpb24gb2YgdGhlIHJlbGF5IGZpbGUuICBUaGUgcmVsYXkgZmlsZSBzaG91bGQgYmUgZGVmaW5lZA0KICogICBnbG9iYWxseSBmb3IgdGhlIGVudGlyZSB3aWRnZXQgYnkgc2V0dGluZyBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgdG8gdGhlIHJlbGF5IGZpbGUgdXJsLCBpbW1lZGlhdGVseSBhZnRlcg0KICogICBpbmNsdWRpbmcgdGhlIHdpZGdldCBidW5kbGUgamF2YXNjcmlwdC4gIElmIHRoZSByZWxheSBpcyBub3QgZGVmaW5lZCBhdCBhbGwgaXQgaXMgYXNzdW1lZCB0byBiZSBhdA0KICogICAvW2NvbnRleHRdL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbC4gIFRoZSByZWxheSBmaWxlIG11c3QgYmUgc3BlY2lmaWVkIHdpdGggZnVsbCBsb2NhdGlvbiBkZXRhaWxzLCBidXQgd2l0aG91dCBhIGZ1bGx5DQogKiAgIHF1YWxpZmllZCBwYXRoLiBJbiB0aGUgY2FzZSB3aGVyZSB0aGUgcmVsYXkgaXMgcmVzaWRpbmcgQCBodHRwOi8vc2VydmVyL3BhdGgvcmVsYXkuaHRtbCwgdGhlIHBhdGggdXNlZCBtdXN0IGJlIGZyb20gdGhlIGNvbnRleHQgcm9vdCBvZiB0aGUgbG9jYWwNCiAqICAgd2lkZ2V0LiBJbiB0aGlzIGNhc2UsIGl0IHdvdWxkIGJlIC9wYXRoL3JlbGF5Lmh0bWwuICBEbyBub3QgaW5jbHVkZSB0aGUgcHJvdG9jb2wuDQogKiBAc2luY2UgT1dGIDMuNy4wDQogKiBAdGhyb3dzIHtFcnJvcn0gdGhyb3dzIGFuIGVycm9yIHdpdGggYSBtZXNzYWdlIGlmIHdpZGdldCBpbml0aWFsaXphdGlvbiBmYWlscw0KICogQGV4YW1wbGUNCiAqICZsdDtzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii4uLy4uL2pzLW1pbi9vd2Ytd2lkZ2V0LW1pbi5qcyImZ3Q7Jmx0Oy9zY3JpcHQmZ3Q7DQogKiAmbHQ7c2NyaXB0Jmd0Ow0KICogICAgICAgLy9UaGUgbG9jYXRpb24gaXMgYXNzdW1lZCB0byBiZSBhdCAvW2NvbnRleHRdL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbCBpZiBpdCBpcyBub3QNCiAqICAgICAgIC8vc2V0IHRoZSBwYXRoIGNvcnJlY3RseSBiZWxvdw0KICogICAgICAgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMID0gJy9vd2YvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJzsNCiAqDQogKiAgICAgICBvd2Zkb2pvLmFkZE9uTG9hZChmdW5jdGlvbigpIHsNCiAqICAgICAgICAgLy9nZXQgd2lkZ2V0IGluc3RhbmNlDQogKiAgICAgICAgIHZhciB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBPem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0SW5zdGFuY2UoKTsNCiAqICAgICAgICAgLy9kbyBzb21ldGhpbmcNCiAqICAgICAgICAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnB1Ymxpc2goIkZvb0NoYW5uZWwiLCAnbWVzc2FnZSBnb2VzIGhlcmUnKTsNCiAqICAgICAgIH0pOw0KICogJmx0Oy9zY3JpcHQmZ3Q7DQogKi8NCk96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGFmdGVySW5pdCwgd2lkZ2V0UmVsYXkpIHsNCiAgaWYgKE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlID0gbmV3IE96b25lLmV2ZW50aW5nLldpZGdldCh3aWRnZXRSZWxheSwgYWZ0ZXJJbml0KTsNCiAgfQ0KICBlbHNlIHsNCiAgICBpZiAoYWZ0ZXJJbml0ICE9IG51bGwpIHsNCiAgICAgIGlmICghT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlLmlzQWZ0ZXJJbml0KSB7DQogICAgICAgIC8vY29ubmVjdCBwYXNzZWQgaW4gZnVuY3Rpb24gdG8gdGhlIGludGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uDQogICAgICAgIG93ZmRvam8uY29ubmVjdCgNCiAgICAgICAgICAgICAgICBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UsJ2FmdGVySW5pdENhbGxCYWNrJywNCiAgICAgICAgICAgICAgICBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UsYWZ0ZXJJbml0KTsNCiAgICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICAvL2FscmVhZHkgaW5pdGlhbGl6ZWQganVzdCBleGVjdXRlIHRoZSBzdXBwbGllZCBjYWxsYmFjaw0KICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgYWZ0ZXJJbml0KE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZSkNCiAgICAgIH0sNTApOw0KICAgIH0NCiAgfQ0KICB9DQogIHJldHVybiBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2U7DQp9Ow0KCi8qKgogKiBAaWdub3JlCiAqIEBuYW1lc3BhY2UKICogQHNpbmNlIE9XRiA1LjAKICovCk9XRiA9IHdpbmRvdy5PV0YgPyB3aW5kb3cuT1dGIDoge307CgooZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoKICAgIC8qKgogICAgICogQG5hbWVzcGFjZQogICAgICovCiAgICBPV0YuSW50ZW50cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgSU5URU5UU19TRVJWSUNFX05BTUUgPSAnX2ludGVudHMnLAogICAgICAgICAgICBJTlRFTlRTX1NFUlZJQ0VfUkVDRUlWRV9OQU1FID0gJ19pbnRlbnRzX3JlY2VpdmUnLAogICAgICAgICAgICBpbnRlbnRSZWNlaXZlck1hcCA9IHt9OwoKICAgICAgICByZXR1cm4gLyoqIEBsZW5kcyBPV0YuSW50ZW50cyAqLyB7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogU3RhcnRzIGFuIEludGVudC4gIFRoaXMgd2lsbCBzZW5kIHRoZSBpbnRlbnQgYW5kIGRhdGEgdG8gb25lIG9yIG1vcmUgd2lkZ2V0cy4gIElmIHRoaXMgbGF1bmNoZXMgYSB3aWRnZXQsIGl0IHNldHMgdGhlIGxhdW5jaCBkYXRhIHRvIHRoZSBKU09OIHN0cmluZyB7IGludGVudHM6IHRydWUgfS4KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGludGVudCBPYmplY3QgcmVwcmVzZW50aW5nIHRoZSBJbnRlbnQKICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGludGVudC5hY3Rpb24gTmFtZSBvZiB0aGUgSW50ZW50CiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpbnRlbnQuZGF0YVR5cGUgRGVzY3JpYmVzIHRoZSBkYXRhIHRoYXQgd2lsbCBiZSBzZW50IHdpdGggdGhlIGludGVudC4gIEl0IGlzIHJlY29tbWVuZGVkCiAgICAgICAgICAgICAqICAgdGhhdCB0aGlzIGJlIGEgTUlNRSB0eXBlLgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBEYXRhIHRvIGJlIHNlbnQgd2l0aCB0aGUgaW50ZW50CiAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgRnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgb25jZSB0aGUgSW50ZW50IGhhcyBiZWVuIHNlbnQgdG8gYSBkZXN0aW5hdGlvbiB3aWRnZXQKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gW2hhbmRsZXIuZGVzdF0gVGhlIGZpcnN0IGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaWQocykgb2YgdGhlIHJlY2lwaWVudChzKQogICAgICAgICAgICAgKiAgIG9mIHRoZSBtZXNzYWdlLiBTZWUgPGEgaHJlZj0iLi9PV0YuaHRtbCMuZ2V0SWZyYW1lSWQiPk9XRi5nZXRJZnJhbWVJZDwvYT4KICAgICAgICAgICAgICogICBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGlzIGlkLgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBbZGVzdF0gRXhwbGljaXRseSBkZWZpbmUgd2hpY2ggd2lkZ2V0cyB3aWxsIGdldCB0aGlzIGludGVudCB1c2luZyBXaWRnZXQgUHJveGllcwogICAgICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAgICAgKiBPV0YuSW50ZW50cy5zdGFydEFjdGl2aXR5KAogICAgICAgICAgICAgKiAgIHsKICAgICAgICAgICAgICogICAgYWN0aW9uOiAnUGxvdCcsCiAgICAgICAgICAgICAqICAgIGRhdGFUeXBlOiAnYXBwbGljYXRpb24vdm5kLm93Zi5sYXRsb24nCiAgICAgICAgICAgICAqICAgfSwKICAgICAgICAgICAgICogICB7CiAgICAgICAgICAgICAqICAgICBsYXQ6IDAsCiAgICAgICAgICAgICAqICAgICBsb246IDAKICAgICAgICAgICAgICogICB9LAogICAgICAgICAgICAgKiAgIGZ1bmN0aW9uKGRlc3QpIHsKICAgICAgICAgICAgICogICAgIC8vZGVzdCBpcyBhbiBhcnJheSBvZiBkZXN0aW5hdGlvbiB3aWRnZXQgcHJveGllcwogICAgICAgICAgICAgKiAgIH0KICAgICAgICAgICAgICogKTsKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHk6ZnVuY3Rpb24gKGludGVudCwgZGF0YSwgaGFuZGxlciwgZGVzdCkgewogICAgICAgICAgICAgICAgdmFyIGRlc3RJZHMgPSBbXTsKCiAgICAgICAgICAgICAgICAvL3B1bGwgZGVzdElkcyBmcm9tIGFueSBwcm94aWVzIHBhc3NlZCBpbgogICAgICAgICAgICAgICAgaWYgKGRlc3QgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBkZXN0SWRzLnB1c2goZGVzdFtpXS5pZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgSU5URU5UU19TRVJWSUNFX05BTUUsCiAgICAgICAgICAgICAgICAgICAgLy9jYWxsYmFjayBmb3Igd2hlbiBhbiBpbnRlbnQgaGFzIHJlYWNoZWQgdGhlIGRlc3RpbmF0aW9uIHdpZGdldChzKQogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChpZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9leGVjIGhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpZGdldHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXN0V2lkZ2V0SWRzID0gW10uY29uY2F0KGlkcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXN0V2lkZ2V0SWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0IGRlc3Qgd2lkZ2V0IHByb3h5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXQgPSBPem9uZS5ldmVudGluZy5nZXRXaWRnZXRQcm94eU1hcCgpW2Rlc3RXaWRnZXRJZHNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldHMucHVzaCh3aWRnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldHMubGVuZ3RoID09IGRlc3RXaWRnZXRJZHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcih3aWRnZXRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIG51bGwgY3JlYXRlIG5ldyB3aWRnZXQgcHJveHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPem9uZS5ldmVudGluZy5pbXBvcnRXaWRnZXQoZGVzdFdpZGdldElkc1tpXSwgZnVuY3Rpb24gKHdwcm94eSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldHMucHVzaCh3cHJveHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRzLmxlbmd0aCA9PSBkZXN0V2lkZ2V0SWRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKHdpZGdldHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVzdFdpZGdldElkcy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gZGVzdCBpZHMgd2VyZSBzZW50IHNlbmQgYmFjayBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKHdpZGdldHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gZGVzdCBpZHMgd2VyZSBzZW50IHNlbmQgYmFjayBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIod2lkZ2V0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBPV0YuZ2V0SWZyYW1lSWQoKSwgaW50ZW50LCBkYXRhLCBkZXN0SWRzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBSZWdpc3RlciB0byByZWNlaXZlIGFuIEludGVudAogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaW50ZW50IE9iamVjdCByZXByZXNlbnRpbmcgdGhlIEludGVudAogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW50ZW50LmFjdGlvbiBOYW1lIG9mIHRoZSBJbnRlbnQKICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGludGVudC5kYXRhVHlwZSBEZXNjcmliZXMgdGhlIGRhdGEgdGhhdCB3aWxsIGJlIHNlbnQgd2l0aCB0aGUgaW50ZW50LiAgSXQgaXMgcmVjb21tZW5kZWQKICAgICAgICAgICAgICogICB0aGF0IHRoaXMgYmUgYSBNSU1FIHR5cGUuCiAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgRnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgb25jZSBhbiBJbnRlbnQgaGFzIGJlZW4gcmVjZWl2ZWQKICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtoYW5kbGVyLnNlbmRlcl0gVGhlIGZpcnN0IGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaWQgb2YgdGhlIHNlbmRlcgogICAgICAgICAgICAgKiAgIG9mIHRoZSBtZXNzYWdlLiBTZWUgPGEgaHJlZj0iLi9PV0YuaHRtbCMuZ2V0SWZyYW1lSWQiPk9XRi5nZXRJZnJhbWVJZDwvYT4KICAgICAgICAgICAgICogICBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGlzIGlkLgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW2hhbmRsZXIuaW50ZW50XSBUaGUgc2Vjb25kIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaW50ZW50IGl0c2VsZi4KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtoYW5kbGVyLmRhdGFdIFRoZSB0aGlyZCBhcmd1bWVudCBwYXNzZWQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24gaXMgdGhlIGludGVudCBkYXRhLgogICAgICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAgICAgKiBPV0YuSW50ZW50cy5yZWNlaXZlKAogICAgICAgICAgICAgKiAgIHsKICAgICAgICAgICAgICogICAgIGFjdGlvbjogJ1Bsb3QnLAogICAgICAgICAgICAgKiAgICBkYXRhVHlwZTogJ2FwcGxpY2F0aW9uL3ZuZC5vd2YubGF0bG9uJwogICAgICAgICAgICAgKiAgIH0sCiAgICAgICAgICAgICAqICAgZnVuY3Rpb24oc2VuZGVyLGludGVudCwgZGF0YSkgewogICAgICAgICAgICAgKiAgICAgLy9kbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQogICAgICAgICAgICAgKiAgIH0KICAgICAgICAgICAgICogKTsKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJlY2VpdmU6ZnVuY3Rpb24gKGludGVudCwgaGFuZGxlcikgewogICAgICAgICAgICAgICAgdmFyIGludGVudEtleSA9IG93ZmRvam8udG9Kc29uKGludGVudCk7CgogICAgICAgICAgICAgICAgLy9zYXZlIGEgbGlzdCBvZiBoYW5kbGVycyBwZXIgaW50ZW50CiAgICAgICAgICAgICAgICBpbnRlbnRSZWNlaXZlck1hcFtpbnRlbnRLZXldID0gaGFuZGxlcjsKCiAgICAgICAgICAgICAgICAvL3JlZ2lzdGVyIHdpdGggc2hpbmRpZyBmb3Igd2hlbiB0aGUgaW50ZW50IG1lc3NhZ2UgaXMgc2VudAogICAgICAgICAgICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoSU5URU5UU19TRVJWSUNFX05BTUUsIGZ1bmN0aW9uKHNlbmRlciwgaW50ZW50LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlbnRLZXkgPSBvd2Zkb2pvLnRvSnNvbihpbnRlbnQpOwoKICAgICAgICAgICAgICAgICAgICAvL2V4ZWN1dGUgdGhlIGhhbmRsZXIgdGhhdCBtYXRjaGVzIHRoZSBpbnRlbnQKICAgICAgICAgICAgICAgICAgICB2YXIgcmVjZWl2ZXJIYW5kbGVyID0gaW50ZW50UmVjZWl2ZXJNYXBbaW50ZW50S2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZW50UmVjZWl2ZXJNYXBbaW50ZW50S2V5XSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVySGFuZGxlci5jYWxsKHRoaXMsIHNlbmRlciwgaW50ZW50LCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIElOVEVOVFNfU0VSVklDRV9SRUNFSVZFX05BTUUsIG51bGwsIGludGVudCwgT1dGLmdldElmcmFtZUlkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICB9KCk7CgoKfSh3aW5kb3csIGRvY3VtZW50KSk7Ci8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307DQoNCi8qKg0KICogQGlnbm9yZQ0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5jaHJvbWUgPSBPem9uZS5jaHJvbWUgPyBPem9uZS5jaHJvbWUgOiB7fTsNCg0KLyoqDQogKiAgQGRlcHJlY2F0ZWQgU2luY2UgT1dGIDMuNy4wICBZb3Ugc2hvdWxkIHVzZSA8YSBocmVmPSIjLmdldEluc3RhbmNlIj5Pem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmdldEluc3RhbmNlPC9hPg0KICogIEBjb25zdHJ1Y3RvciAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIC0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0IG9iamVjdA0KICogIEBwYXJhbSAge09iamVjdH0gY29uZmlnIC0gY29uZmlnIG9iamVjdCB3aXRoIHBhcmFtZXRlcnMNCiAqICBAcGFyYW0gIHtPem9uZS5ldmVudGluZy5XaWRnZXR9IGNvbmZpZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgLSB3aWRnZXQgZXZlbnRpbmcgb2JqZWN0IHdoaWNoIGhhbmRsZXMgZXZlbnRpbmcgZm9yIHRoZSB3aWRnZXQNCiAqICBAZGVzY3JpcHRpb24gVGhpcyBvYmplY3QgYWxsb3dzIGEgd2lkZ2V0IHRvIG1vZGlmeSB0aGUgYnV0dG9uIGNvbnRhaW5lZCBpbiB0aGUgd2lkZ2V0IGhlYWRlciAodGhlIGNocm9tZSkuICANCiAqICBUbyBkbyBzbyBpdCByZXF1aXJlcyBhIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogIEBleGFtcGxlDQogKiAgICB0aGlzLndjID0gbmV3IE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUoew0KICogICAgICAgIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcjogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqICAgIH0pOw0KICoNCiAqIEB0aHJvd3Mge0Vycm9yfSB0aHJvd3MgYW4gZXJyb3Igd2l0aCBhIG1lc3NhZ2UgaWYgd2lkZ2V0IGluaXRpYWxpemF0aW9uIGZhaWxzDQogKi8NCk96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUgPSBmdW5jdGlvbihjb25maWcpIHsNCiAgaWYgKE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgIHZhciBzY29wZSA9IHRoaXM7DQogICAgc2NvcGUuY2hhbm5lbE5hbWUgPSAiT3pvbmUuX1dpZGdldENocm9tZUNoYW5uZWwiOw0KICAgIHNjb3BlLnZlcnNpb24gPSBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLndpZGdldENocm9tZTsNCiAgICBzY29wZS5pdGVtcyA9IHt9Ow0KICAgIHNjb3BlLnJlZ2lzdGVyQ2hyb21lTWVudSA9IGZ1bmN0aW9uKG1lbnVDb25maWcpIHsNCiAgCQkvLyBSZWd1bGFyIG1lbnUgaXRlbQ0KICAgICAgIAlzY29wZS5pdGVtc1ttZW51Q29uZmlnLml0ZW1JZCAhPSBudWxsID8gbWVudUNvbmZpZy5pdGVtSWQgOiBtZW51Q29uZmlnLmlkXSA9IG1lbnVDb25maWc7DQogICAgICAgCQ0KICAJICAJaWYgKG1lbnVDb25maWcubWVudSkgew0KICAJICAgIAlmb3IgKHZhciBqID0gMCA7IGogPCBtZW51Q29uZmlnLm1lbnUuaXRlbXMubGVuZ3RoIDsgaisrKSB7DQogIAkgICAgCQl2YXIgbWVudUl0ZW0gPSBtZW51Q29uZmlnLm1lbnUuaXRlbXNbal07DQogICAgCQkJLy8gU3ViLW1lbnUNCiAgICAJCQlzY29wZS5yZWdpc3RlckNocm9tZU1lbnUobWVudUl0ZW0pOw0KICAJICAgIAl9DQoJICAJfQ0KICAgIH07DQoNCiAgICB2YXIgcHViID0gLyoqIEBsZW5kcyBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLnByb3RvdHlwZSAqLyB7DQoNCiAgICAgIGluaXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KICAgICAgICBjb25maWcgPSBjb25maWcgfHwge307DQoNCiAgICAgICAgICBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBjb25maWcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIHx8IE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZTsNCiAgICAgICAgICBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucmVnaXN0ZXJIYW5kbGVyKHNjb3BlLmNoYW5uZWxOYW1lLCBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KICAgICAgICAgICAgdmFyIHJldHVyblZhbHVlID0gdHJ1ZTsNCg0KICAgICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZw0KICAgICAgICAgICAgdmFyIGRhdGEgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOw0KDQogICAgICAgICAgICB2YXIgaWQgPSBkYXRhLml0ZW1JZCAhPSBudWxsID8gZGF0YS5pdGVtSWQgOiBkYXRhLmlkOw0KICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBzY29wZS5pdGVtc1tpZF0uaGFuZGxlcjsNCiAgICAgICAgICAgIGlmIChoYW5kbGVyICE9IG51bGwgJiYgb3dmZG9qby5pc0Z1bmN0aW9uKGhhbmRsZXIpKSB7DQogICAgICAgICAgICAgIHJldHVyblZhbHVlID0gaGFuZGxlci5hcHBseShkYXRhLnNjb3BlICE9IG51bGwgPyBkYXRhLnNjb3BlIDogd2luZG93LCBkYXRhLmFyZ3MgIT0gbnVsbCA/IGRhdGEuYXJncyA6IFtdKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlOw0KICAgICAgICAgIH0pOw0KICAgICAgfSwNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gQ2hlY2tzIHRvIHNlZSBpZiB0aGUgV2lkZ2V0IENocm9tZSBoYXMgYWxyZWFkeSBiZWVuIG1vZGlmaWVkLiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIHdpZGdldCBpZnJhbWUgaXMgcmVsb2FkZWQNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuDQogICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCBhbiBvYmplY3Qgd2hpY2ggaGFzIGZvbGxvd2luZyBwcm9wZXJ0aWVzLiA8YnI+DQogICAgICAgKiA8YnI+DQogICAgICAgKiAgICAge0Jvb2xlYW59IHN1Y2Nlc3M6IHRydWUgaWYgdGhlIHdpZGdldCBpcyBjdXJyZW50bHkgb3BlbmVkIG9uIHRoZSBkYXNoYm9hcmQsIG9yIGVsc2UgZmFsc2UuIDxicj4NCiAgICAgICAqICAgICB7Qm9vbGVhbn0gbW9kaWZpZWQ6IHRydWUgaWYgdGhlIHdpZGdldCBjaHJvbWUoaGVhZGVyKSBpcyBtb2RpZmllZCwgb3IgZWxzZSBmYWxzZS4gPGJyPg0KICAgICAgICoNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgdGhpcy53Yy5pc01vZGlmaWVkKHsNCiAgICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7DQogICAgICAgKiAgICAgICAgIC8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcNCiAgICAgICAqICAgICAgICAgdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7DQogICAgICAgKiAgICAgICAgIGlmIChyZXMuc3VjY2Vzcykgew0KICAgICAgICoNCiAgICAgICAqICAgICAgICAgICAgIC8vaWYgdGhlIGNocm9tZSB3YXMgbmV2ZXIgbW9kaWZpZWQNCiAgICAgICAqICAgICAgICAgICAgIGlmICghcmVzLm1vZGlmaWVkKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAvL2RvIHNvbWV0aGluZywgcGVyaGFwcyBhZGQgYnV0dG9ucw0KICAgICAgICogICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgLy9pZiB3ZSBhbHJlYWR5IG1vZGlmaWVkIHRoZSBjaHJvbWUNCiAgICAgICAqICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICogICAgICAgICAgICAgICAvL2RvIHNvbWV0aGluZyBvciBwZXJoYXBzIG5vdGhpbmcgaWYgdGhlIGJ1dHRvbnMgYXJlIGFscmVhZHkgYWRkZWQNCiAgICAgICAqICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgfQ0KICAgICAgICogICAgIH0NCiAgICAgICAqICAgfSk7DQogICAgICAgKi8NCiAgICAgIGlzTW9kaWZpZWQ6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHsNCiAgICAgICAgICBhY3Rpb246ICdpc01vZGlmaWVkJw0KICAgICAgICB9Ow0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgfSwNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gQWRkcyBidXR0b25zIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgQnV0dG9ucyBhcmUgYWRkZWQgYWZ0ZXIgZXhpc3RpbmcgYnV0dG9ucy4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBidXR0b25zIGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIGJ1dHRvbiBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyBFeHRKUy1saWtlIHByb3BlcnR5IHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBjb21wb25lbnQgdG8gY3JlYXRlLiAgQ3VycmVudGx5IHRoZSBXaWRnZXQgQ2hyb21lIEFQSSBvbmx5IHN1cHBvcnRzIHR3byB4dHlwZSB2YWx1ZXM6IOKAmGJ1dHRvbuKAmSBhbmQg4oCYd2lkZ2V0dG9vbOKAmS4gIHh0eXBlIGlzIGFuIG9wdGlvbmFsIGZpZWxkLCBpZiBpdCBpcyBvbWl0dGVkIOKAmHdpZGdldHRvb2zigJkgaXMgdXNlZC4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udHlwZSBVc2VkIG9ubHkgZm9yIOKAmHdpZGdldHRvb2zigJkgYnV0dG9ucy4gIEl0IGRldGVybWluZXMgdGhlIHN0YW5kYXJkIGljb24gdG8gYmUgdXNlZC4gIEZvciBhIGNvbXBsZXRlIGxpc3Qgb2YgdHlwZXMgcGxlYXNlIHNlZSB0aGUgRXh0SlMgNC54IEFQSSBkb2N1bWVudGF0aW9uLCA8YSBocmVmPSdodHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGUnPmh0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZTwvYT4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIGJ1dHRvbi4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIGJ1dHRvbi4gIFRoaXMgcHJvcGVydHkgaXMgb25seSB1c2VkIGlmIHRoZSB4dHlwZSBpcyDigJhidXR0b24u4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0udG9vbHRpcCBUaGlzIHByb3BlcnR5IGRlZmluZXMgYSB0b29sdGlwLiAgSXQgaGFzIHR3byBpbXBvcnRhbnQgc3ViIHByb3BlcnRpZXMsIHRpdGxlIGFuZCB0ZXh0LiAgdG9vbHRpcCBpcyBvbmx5IHVzZWQgd2hlbiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9u4oCZDQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGJ1dHRvbiBpcyBwcmVzc2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbuKAmXMgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MuYWRkSGVhZGVyQnV0dG9ucyh7DQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICB0b29sdGlwOiAgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0IScNCiAgICAgICAqICAgICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRTdGF0ZSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgICB3aWRnZXRTdGF0ZS5nZXRXaWRnZXRTdGF0ZSh7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAqDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUuY29sbGFwc2VkICYmICFzdGF0ZS5taW5pbWl6ZWQgJiYgc3RhdGUuYWN0aXZlKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vbmx5IHJlbmRlciB2aXN1YWwgY29udGVudCwgcGVyaGFwcyBwb3B1cCBhIG1lc3NhZ2UgYm94IGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIGl0IG1heSBub3QgcmVuZGVyIGNvcnJlY3RseQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICogICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIHh0eXBlOiAnd2lkZ2V0dG9vbCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidoZWxwJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBYm91dCBCdXR0b24gUHJlc3NlZCcpOw0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIC8vZ2VhciBpcyBhIHN0YW5kYXJkIGV4dCB0b29sIHR5cGUNCiAgICAgICAqICAgICAgICAgICAgICAgICB0eXBlOiAnZ2VhcicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidnZWFyJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdVdGlsaXR5IEJ1dHRvbiBQcmVzc2VkJyk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICBdDQogICAgICAgKiAgICAgfSk7DQogICAgICAgKi8NCiAgICAgIGFkZEhlYWRlckJ1dHRvbnMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ2FkZEhlYWRlckJ1dHRvbnMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnYnV0dG9uJzsNCiAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgc2NvcGUuaXRlbXNbaXRlbXNbaV0uaXRlbUlkICE9IG51bGwgPyBpdGVtc1tpXS5pdGVtSWQgOiBpdGVtc1tpXS5pZF0gPSBpdGVtc1tpXTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQoNCiAgICAgIH0sDQoNCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIFVwZGF0ZXMgYW55IGV4aXN0aW5nIGJ1dHRvbnMgaW4gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gdGhlIGl0ZW1JZC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBidXR0b25zIGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyBFeHRKUy1saWtlIHByb3BlcnR5IHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBjb21wb25lbnQgdG8gY3JlYXRlLiAgQ3VycmVudGx5IHRoZSBXaWRnZXQgQ2hyb21lIEFQSSBvbmx5IHN1cHBvcnRzIHR3byB4dHlwZSB2YWx1ZXM6IOKAmGJ1dHRvbuKAmSBhbmQg4oCYd2lkZ2V0dG9vbOKAmS4gIHh0eXBlIGlzIGFuIG9wdGlvbmFsIGZpZWxkLCBpZiBpdCBpcyBvbWl0dGVkIOKAmHdpZGdldHRvb2zigJkgaXMgdXNlZC4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udHlwZSBVc2VkIG9ubHkgZm9yIOKAmHdpZGdldHRvb2zigJkgYnV0dG9ucy4gIEl0IGRldGVybWluZXMgdGhlIHN0YW5kYXJkIGljb24gdG8gYmUgdXNlZC4gIEZvciBhIGNvbXBsZXRlIGxpc3Qgb2YgdHlwZXMgcGxlYXNlIHNlZSB0aGUgRXh0SlMgNC54IEFQSSBkb2N1bWVudGF0aW9uLCA8YSBocmVmPSdodHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGUnPmh0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZTwvYT4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIGJ1dHRvbi4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIGJ1dHRvbi4gIFRoaXMgcHJvcGVydHkgaXMgb25seSB1c2VkIGlmIHRoZSB4dHlwZSBpcyDigJhidXR0b24u4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0udG9vbHRpcCBUaGlzIHByb3BlcnR5IGRlZmluZXMgYSB0b29sdGlwLiAgSXQgaGFzIHR3byBpbXBvcnRhbnQgc3ViIHByb3BlcnRpZXMsIHRpdGxlIGFuZCB0ZXh0LiAgdG9vbHRpcCBpcyBvbmx5IHVzZWQgd2hlbiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9u4oCZDQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGJ1dHRvbiBpcyBwcmVzc2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbuKAmXMgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MudXBkYXRlSGVhZGVyQnV0dG9ucyh7DQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICB0b29sdGlwOiAgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0IScNCiAgICAgICAqICAgICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRTdGF0ZSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgICB3aWRnZXRTdGF0ZS5nZXRXaWRnZXRTdGF0ZSh7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAqDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUuY29sbGFwc2VkICYmICFzdGF0ZS5taW5pbWl6ZWQgJiYgc3RhdGUuYWN0aXZlKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vbmx5IHJlbmRlciB2aXN1YWwgY29udGVudCwgcGVyaGFwcyBwb3B1cCBhIG1lc3NhZ2UgYm94IGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIGl0IG1heSBub3QgcmVuZGVyIGNvcnJlY3RseQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICogICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIHh0eXBlOiAnd2lkZ2V0dG9vbCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidoZWxwJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBYm91dCBCdXR0b24gUHJlc3NlZCcpOw0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIC8vZ2VhciBpcyBhIHN0YW5kYXJkIGV4dCB0b29sIHR5cGUNCiAgICAgICAqICAgICAgICAgICAgICAgICB0eXBlOiAnZ2VhcicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidnZWFyJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdVdGlsaXR5IEJ1dHRvbiBQcmVzc2VkJyk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICBdDQogICAgICAgKiAgICAgfSk7DQogICAgICAgKi8NCiAgICAgIHVwZGF0ZUhlYWRlckJ1dHRvbnMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ3VwZGF0ZUhlYWRlckJ1dHRvbnMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnYnV0dG9uJzsNCiAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgLy9zYXZlIGRhdGENCiAgICAgICAgICB2YXIgaWQgPSBpdGVtc1tpXS5pdGVtSWQgIT0gbnVsbCA/IGl0ZW1zW2ldLml0ZW1JZCA6IGl0ZW1zW2ldLmlkOw0KICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tpZF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgb3dmZG9qby5taXhpbihzY29wZS5pdGVtc1tpZF0sIGl0ZW1zW2ldKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzY29wZS5pdGVtc1tpZF0gPSBpdGVtc1tpXTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KDQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBJbnNlcnRzIG5ldyBidXR0b25zIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgQnV0dG9ucyBhcmUgYWRkZWQgdG8gdGhlIHNhbWUgYXJlYSBhcyBleGlzdGluZyBidXR0b25zLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtjZmcucG9zPTBdIDAtYmFzZWQgaW5kZXggb2Ygd2hlcmUgYnV0dG9ucyB3aWxsIGJlIGFkZGVkLCBhbW9uZyBhbnkgcHJlLWV4aXN0aW5nIGJ1dHRvbnMuDQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgYnV0dG9ucyBjb25maWd1cmF0aW9ucyB0byBpbnNlcnQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGJlbG93IGZvciBidXR0b24gY29uZmlncw0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBidXR0b25zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgYnV0dG9ucyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgRXh0SlMtbGlrZSBwcm9wZXJ0eSB1c2VkIHRvIGRldGVybWluZSB0aGUgY29tcG9uZW50IHRvIGNyZWF0ZS4gIEN1cnJlbnRseSB0aGUgV2lkZ2V0IENocm9tZSBBUEkgb25seSBzdXBwb3J0cyB0d28geHR5cGUgdmFsdWVzOiDigJhidXR0b27igJkgYW5kIOKAmHdpZGdldHRvb2zigJkuICB4dHlwZSBpcyBhbiBvcHRpb25hbCBmaWVsZCwgaWYgaXQgaXMgb21pdHRlZCDigJh3aWRnZXR0b29s4oCZIGlzIHVzZWQuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnR5cGUgVXNlZCBvbmx5IGZvciDigJh3aWRnZXR0b29s4oCZIGJ1dHRvbnMuICBJdCBkZXRlcm1pbmVzIHRoZSBzdGFuZGFyZCBpY29uIHRvIGJlIHVzZWQuICBGb3IgYSBjb21wbGV0ZSBsaXN0IG9mIHR5cGVzIHBsZWFzZSBzZWUgdGhlIEV4dEpTIDQueCBBUEkgZG9jdW1lbnRhdGlvbiwgPGEgaHJlZj0naHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlJz5odHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGU8L2E+DQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBidXR0b24uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBidXR0b24uICBUaGlzIHByb3BlcnR5IGlzIG9ubHkgdXNlZCBpZiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9uLuKAmSAg4oCYd2lkZ2V0dG9vbOKAmSB3aWxsIG5vdCBzaG93IHRleHQuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLnRvb2x0aXAgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIGEgdG9vbHRpcC4gIEl0IGhhcyB0d28gaW1wb3J0YW50IHN1YiBwcm9wZXJ0aWVzLCB0aXRsZSBhbmQgdGV4dC4gIHRvb2x0aXAgaXMgb25seSB1c2VkIHdoZW4gdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbuKAmQ0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBidXR0b24gaXMgcHJlc3NlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb27igJlzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4NCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiAgICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAqICAgICB0aGlzLndjLmluc2VydEhlYWRlckJ1dHRvbnMoew0KICAgICAgICogICAgICAgICAgICAgcG9zOiAwLA0KICAgICAgICogICAgICAgICAgICAgaXRlbXM6DQogICAgICAgKiAgICAgICAgICAgICAgWw0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nLA0KICAgICAgICogICAgICAgICAgICAgICAgIC8vcGF0aCB0byBhbiBpbWFnZSB0byB1c2UuIHRoaXMgcGF0aCBzaG91bGQgZWl0aGVyIGJlIGZ1bGx5IHF1YWxpZmllZCBvciByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0DQogICAgICAgKiAgICAgICAgICAgICAgICAgaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICogICAgICAgICAgICAgICAgIHRleHQ6ICdBbGVydCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidhbGVydCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgdG9vbHRpcDogIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIHRleHQ6ICdBbGVydCEnDQogICAgICAgKiAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIC8vd2lkZ2V0U3RhdGUgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0U3RhdGUgT2JqDQogICAgICAgKiAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0U3RhdGUpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0U3RhdGUuZ2V0V2lkZ2V0U3RhdGUoew0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN0YXRlKSB7DQogICAgICAgKg0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmNvbGxhcHNlZCAmJiAhc3RhdGUubWluaW1pemVkICYmIHN0YXRlLmFjdGl2ZSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb25seSByZW5kZXIgdmlzdWFsIGNvbnRlbnQsIHBlcmhhcHMgcG9wdXAgYSBtZXNzYWdlIGJveCBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL290aGVyd2lzZSBpdCBtYXkgbm90IHJlbmRlciBjb3JyZWN0bHkNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICB4dHlwZTogJ3dpZGdldHRvb2wnLA0KICAgICAgICogICAgICAgICAgICAgICAgIC8vcGF0aCB0byBhbiBpbWFnZSB0byB1c2UuIHRoaXMgcGF0aCBzaG91bGQgZWl0aGVyIGJlIGZ1bGx5IHF1YWxpZmllZCBvciByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0DQogICAgICAgKiAgICAgICAgICAgICAgICAgaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9pbmZvcm1hdGlvbi5wbmcnLA0KICAgICAgICogICAgICAgICAgICAgICAgIGl0ZW1JZDonaGVscCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICBhbGVydCgnQWJvdXQgQnV0dG9uIFByZXNzZWQnKTsNCiAgICAgICAqICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAvL2dlYXIgaXMgYSBzdGFuZGFyZCBleHQgdG9vbCB0eXBlDQogICAgICAgKiAgICAgICAgICAgICAgICAgdHlwZTogJ2dlYXInLA0KICAgICAgICogICAgICAgICAgICAgICAgIGl0ZW1JZDonZ2VhcicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICBhbGVydCgnVXRpbGl0eSBCdXR0b24gUHJlc3NlZCcpOw0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgXQ0KICAgICAgICogICAgIH0pOw0KICAgICAgICovDQogICAgICBpbnNlcnRIZWFkZXJCdXR0b25zIDogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgIHZhciBkYXRhID0ge307DQogICAgICAgIHZhciBpdGVtcyA9IG51bGw7DQoNCiAgICAgICAgaWYgKCFvd2Zkb2pvLmlzQXJyYXkoY2ZnLml0ZW1zKSkgew0KICAgICAgICAgIGl0ZW1zID0gW2NmZy5pdGVtc107DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgaXRlbXMgPSBjZmcuaXRlbXM7DQogICAgICAgIH0NCg0KICAgICAgICBkYXRhLmFjdGlvbiA9ICdpbnNlcnRIZWFkZXJCdXR0b25zJzsNCiAgICAgICAgZGF0YS50eXBlID0gJ2J1dHRvbic7DQogICAgICAgIGlmIChjZmcucG9zICE9IG51bGwpIHsNCiAgICAgICAgICBkYXRhLnBvcyA9IGNmZy5wb3M7DQogICAgICAgIH0NCiAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgc2NvcGUuaXRlbXNbaXRlbXNbaV0uaXRlbUlkICE9IG51bGwgPyBpdGVtc1tpXS5pdGVtSWQgOiBpdGVtc1tpXS5pZF0gPSBpdGVtc1tpXTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGV4aXN0aW5nIGJ1dHRvbnMgb24gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gaXRlbUlkLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gcmVtb3ZlIHRvIHRoZSBjaHJvbWUuICBPbmx5IGl0ZW1JZCBpcyByZXF1aXJlZC4NCiAgICAgICAqICAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MucmVtb3ZlSGVhZGVyQnV0dG9ucyh7DQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2FsZXJ0Jw0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidoZWxwJw0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidnZWFyJw0KICAgICAgICogICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICBdDQogICAgICAgKiAgICAgfSk7DQogICAgICAgKi8NCiAgICAgIHJlbW92ZUhlYWRlckJ1dHRvbnMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ3JlbW92ZUhlYWRlckJ1dHRvbnMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnYnV0dG9uJzsNCiAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgdmFyIGlkID0gaXRlbXNbaV0uaXRlbUlkICE9IG51bGwgPyBpdGVtc1tpXS5pdGVtSWQgOiBpdGVtc1tpXS5pZDsNCiAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaWRdICE9IG51bGwpIHsNCiAgICAgICAgICAgIC8vZGVsZXRlIHNhdmVkIGRhdGENCiAgICAgICAgICAgIGRlbGV0ZSBzY29wZS5pdGVtc1tpZF07DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCiAgICAgIH0sDQogICAgIA0KICAgIA0KICAgICAgLyoqDQogICAgICogQGRlc2NyaXB0aW9uIExpc3RzIGFsbCBidXR0b25zIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSB3aWRnZXQgY2hyb21lLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLg0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKiAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAqICAgIHRoaXMud2MubGlzdEhlYWRlckJ1dHRvbnMoew0KICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7DQogICAgICogICAgICAgICAvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nDQogICAgICogICAgICAgICB2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsNCiAgICAgKiAgICAgICAgIGlmIChyZXMuc3VjY2Vzcykgew0KICAgICAqICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzLml0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICogICAgICAgICAgICAgCS8vIGRvIHNvbWV0aGluZyB3aXRoIHRoZSBidXR0b25zDQogICAgICogICAgICAgICAgICAgfQ0KICAgICAqICAgICAgICAgfQ0KICAgICAqICAgICB9DQogICAgICogICB9KTsNCiAgICAgKi8NCiAgICAgIGxpc3RIZWFkZXJCdXR0b25zOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgIHZhciBkYXRhID0gew0KICAgICAgICBhY3Rpb246ICdsaXN0SGVhZGVyTWVudXMnLA0KICAgICAgICB0eXBlOiAnYnV0dG9uJw0KICAgICAgfTsNCiAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgIH0sDQogICAgDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBBZGRzIG1lbnVzIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgTWVudXMgYXJlIGFkZGVkIGFmdGVyIGV4aXN0aW5nIG1lbnVzLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnBhcmVudElkIGl0ZW1JZCBpcyB0aGUgaXRlbUlkIG9mIHRoZSBtZW51IHRvIHdoaWNoIHRoaXMgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgYWRkZWQgYXMgYSBzdWItbWVudS4gIElmIG9taXR0ZWQsIHRoZSBjb25maWd1cmF0aW9uIHdpbGwgYmUgYWRkZWQgYXMgYSBtYWluIG1lbnUgb24gdGhlIG1lbnUgdG9vbGJhci4gIA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51cyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIG1lbnVzIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIG1lbnUuICANCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudSBtZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0DQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGl0ZW0gY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBpdGVtIGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51IGl0ZW1zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHR5cGUgb2YgbWVudSBpdGVtIHRvIGFkZC4gIFRoaXMgYXR0cmlidXRlIHNob3VsZCBiZSBvbWl0dGVkIHVubGVzcyBzcGVjaWZ5aW5nIGEgbWVudXNlcGFyYXRvci4gU2V0dGluZyB0aGlzIHZhbHVlIHRvICJtZW51c2VwYXJhdG9yIiBhZGRzIGEgc2VwYXJhdG9yIGJhciB0byBhIG1lbnUsIHVzZWQgdG8gZGl2aWRlIGxvZ2ljYWwgZ3JvdXBzIG9mIG1lbnUgaXRlbXMuIElmIHNwZWNpZmllZCwgb25seSB4dHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiAgR2VuZXJhbGx5IHlvdSB3aWxsIGFkZCBvbmUgb2YgdGhlc2UgYnkgdXNpbmcgIi0iIGluIHlvdXIgaXRlbXMgY29uZmlnIHJhdGhlciB0aGFuIGNyZWF0aW5nIG9uZSBkaXJlY3RseSB1c2luZyB4dHlwZS4gIFNlZSBleGFtcGxlIGJlbG93IGZvciB1c2FnZS4gDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUgaXRlbS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGZvciB0aGUgbWVudSBpdGVtLiANCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBtZW51IGl0ZW0gaXMgY2xpY2tlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ubWVudSBzdWItbWVudSBjb25maWd1cmF0aW9uIG9iamVjdC4gIFNlZSBleGFtcGxlIGZvciBzdWItbWVudSBjb25maWcuDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy5hZGRIZWFkZXJNZW51cyh7DQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKgkJCQl7DQogICAgICAgKgkJCQkJaXRlbUlkOidyZWd1bGFyTWVudScsDQogICAgICAgKgkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCXRleHQ6ICdSZWd1bGFyIE1lbnUnLA0KICAgICAgICoJCQkJCW1lbnU6IHsNCiAgICAgICAqCQkJCQkJaXRlbXM6IFsNCiAgICAgICAqCQkJCQkJICAgIHsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J3JlZ3VsYXJNZW51SXRlbTEnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnUmVndWxhciBNZW51IEl0ZW0gMScsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgUmVndWxhciBNZW51IG1lbnUgaXRlbS4nKTsNCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9DQogICAgICAgKgkJCQkJCV0NCiAgICAgICAqCQkJCQl9DQogICAgICAgKgkJCQl9LA0KICAgICAgICoJCQkJew0KICAgICAgICoJCQkJCWl0ZW1JZDonc25hY2tzJywNCiAgICAgICAqCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJdGV4dDogJ01lbnUgd2l0aCBTdWItTWVudScsDQogICAgICAgKgkJCQkJbWVudTogew0KICAgICAgICoJCQkJCQlpdGVtczogWw0KICAgICAgICoJCQkJCQkgICAgew0KICAgICAgICoJCQkJCQkgICAgCWl0ZW1JZDonZnJ1aXRzJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ0ZydWl0cycsDQogICAgICAgKgkJCQkJCSAgICAJbWVudTogew0KICAgICAgICoJCQkJCQkJICAgIAlpdGVtczogWw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonYXBwbGUnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAl0ZXh0OiAnQXBwbGUnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGFuIEFwcGxlLicpOw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCX0NCiAgICAgICAqCQkJCQkJCSAgICAJICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdtZW51c2VwYXJhdG9yJw0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpdGVtSWQ6J2JhbmFuYScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdCYW5hbmEnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQmFuYW5hLicpOw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCX0NCiAgICAgICAqCQkJCQkJCSAgICAJICAgIH0sIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpdGVtSWQ6J2NoZXJyeScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdDaGVycmllcycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgQ2hlcnJpZXMuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfQ0KICAgICAgICoJCQkJCQkJICAgIAldDQogICAgICAgKgkJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCQkgICAgfSwNCiAgICAgICAqCQkJCQkJCSctJywgLy8gYW5vdGhlciB3YXkgdG8gYWRkIGEgbWVudSBzZXBhcmF0b3IgDQogICAgICAgKgkJCQkJCQl7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidjdXBjYWtlJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ0N1cGNha2UnLA0KICAgICAgICoJCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQ3VwY2FrZS4nKTsNCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9LCB7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidjaGlwcycsDQogICAgICAgKgkJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkgICAgCXRleHQ6ICdQb3RhdG8gQ2hpcHMnLA0KICAgICAgICoJCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgUG90YXRvIENoaXBzLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0NCiAgICAgICAqCQkJCQkJXQ0KICAgICAgICoJCQkJCX0NCiAgICAgICAqCQkJCX0NCiAgICAgICAqICAgICAgICAgICAgIF0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgYWRkSGVhZGVyTWVudXMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ2FkZEhlYWRlck1lbnVzJzsNCiAgICAgICAgZGF0YS50eXBlID0gJ21lbnUnOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgCXZhciBpdGVtID0gaXRlbXNbaV07DQogICAgICAgIAlzY29wZS5yZWdpc3RlckNocm9tZU1lbnUoaXRlbSk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KDQogICAgICB9LA0KICAgICAgDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBVcGRhdGVzIGFueSBleGlzdGluZyBtZW51cyBpbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiB0aGUgaXRlbUlkLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnVzIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgbWVudXMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51LiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgbWVudS4gIA0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51IG1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgaXRlbSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGl0ZW0gY29uZmlncw0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnUgaXRlbXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIHVzZWQgdG8gc3BlY2lmeSB0aGUgdHlwZSBvZiBtZW51IGl0ZW0gdG8gYWRkLiAgVGhpcyBhdHRyaWJ1dGUgc2hvdWxkIGJlIG9taXR0ZWQgdW5sZXNzIHNwZWNpZnlpbmcgYSBtZW51c2VwYXJhdG9yLiBTZXR0aW5nIHRoaXMgdmFsdWUgdG8gIm1lbnVzZXBhcmF0b3IiIGFkZHMgYSBzZXBhcmF0b3IgYmFyIHRvIGEgbWVudSwgdXNlZCB0byBkaXZpZGUgbG9naWNhbCBncm91cHMgb2YgbWVudSBpdGVtcy4gSWYgc3BlY2lmaWVkLCBvbmx5IHh0eXBlIHNob3VsZCBiZSBzcGVjaWZpZWQuICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgdXNhZ2UuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUgaXRlbS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGZvciB0aGUgbWVudSBpdGVtLiANCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBtZW51IGl0ZW0gaXMgY2xpY2tlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ubWVudSBzdWItbWVudSBjb25maWd1cmF0aW9uIG9iamVjdC4gIFNlZSBleGFtcGxlIGZvciBzdWItbWVudSBjb25maWcuDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy51cGRhdGVIZWFkZXJNZW51cyh7DQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKgkJCQl7DQogICAgICAgKgkJCQkJaXRlbUlkOidyZWd1bGFyTWVudScsDQogICAgICAgKgkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCXRleHQ6ICdSZWd1bGFyIE1lbnUnLA0KICAgICAgICoJCQkJCW1lbnU6IHsNCiAgICAgICAqCQkJCQkJaXRlbXM6IFsNCiAgICAgICAqCQkJCQkJICAgIHsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J3JlZ3VsYXJNZW51SXRlbTEnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnUmVndWxhciBNZW51IEl0ZW0gMScsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgUmVndWxhciBNZW51IG1lbnUgaXRlbS4nKTsNCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9DQogICAgICAgKgkJCQkJCV0NCiAgICAgICAqCQkJCQl9DQogICAgICAgKgkJCQl9LA0KICAgICAgICoJCQkJew0KICAgICAgICoJCQkJCWl0ZW1JZDonc25hY2tzJywNCiAgICAgICAqCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJdGV4dDogJ01lbnUgd2l0aCBTdWItTWVudScsDQogICAgICAgKgkJCQkJbWVudTogew0KICAgICAgICoJCQkJCQlpdGVtczogWw0KICAgICAgICoJCQkJCQkgICAgew0KICAgICAgICoJCQkJCQkgICAgCWl0ZW1JZDonZnJ1aXRzJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ0ZydWl0cycsDQogICAgICAgKgkJCQkJCSAgICAJbWVudTogew0KICAgICAgICoJCQkJCQkJICAgIAlpdGVtczogWw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonYXBwbGUnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAl0ZXh0OiAnQXBwbGUnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGFuIEFwcGxlLicpOw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCX0NCiAgICAgICAqCQkJCQkJCSAgICAJICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdtZW51c2VwYXJhdG9yJw0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpdGVtSWQ6J2JhbmFuYScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdCYW5hbmEnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQmFuYW5hLicpOw0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCX0NCiAgICAgICAqCQkJCQkJCSAgICAJICAgIH0sIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpdGVtSWQ6J2NoZXJyeScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdDaGVycmllcycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgQ2hlcnJpZXMuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfQ0KICAgICAgICoJCQkJCQkJICAgIAldDQogICAgICAgKgkJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCQkgICAgfSwNCiAgICAgICAqCQkJCQkJCSctJywgLy8gYW5vdGhlciB3YXkgdG8gYWRkIGEgbWVudSBzZXBhcmF0b3IgDQogICAgICAgKgkJCQkJCQl7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidjdXBjYWtlJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ0N1cGNha2UnLA0KICAgICAgICoJCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQ3VwY2FrZS4nKTsNCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9LCB7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidjaGlwcycsDQogICAgICAgKgkJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkgICAgCXRleHQ6ICdQb3RhdG8gQ2hpcHMnLA0KICAgICAgICoJCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCQkgICAgCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgUG90YXRvIENoaXBzLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0NCiAgICAgICAqCQkJCQkJXQ0KICAgICAgICoJCQkJCX0NCiAgICAgICAqCQkJCX0NCiAgICAgICAqICAgICAgICAgICAgIF0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgdXBkYXRlSGVhZGVyTWVudXMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ3VwZGF0ZUhlYWRlck1lbnVzJzsNCiAgICAgICAgZGF0YS50eXBlID0gJ21lbnUnOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIA0KICAgICAgICB2YXIgbWVyZ2UgPSBmdW5jdGlvbihzb3VyY2UsIGtleSwgdmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2Vba2V5XSAmJiBzb3VyY2Vba2V5XS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtZXJnZShzb3VyY2Vba2V5XSwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlW2tleV0gPSBFeHQuY2xvbmUodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzb3VyY2Vba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBzb3VyY2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBpID0gMSwNCiAgICAgICAgICAgICAgICBsbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICAgICAgICAgICAgb2JqZWN0LCBwcm9wZXJ0eTsNCg0KICAgICAgICAgICAgZm9yICg7IGkgPCBsbjsgaSsrKSB7DQogICAgICAgICAgICAgICAgb2JqZWN0ID0gYXJndW1lbnRzW2ldOw0KDQogICAgICAgICAgICAgICAgZm9yIChwcm9wZXJ0eSBpbiBvYmplY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlKHNvdXJjZSwgcHJvcGVydHksIG9iamVjdFtwcm9wZXJ0eV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gc291cmNlOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAJdmFyIGl0ZW0gPSBpdGVtc1tpXTsNCiAgICAgICAgCS8vIGRvbid0IHJlLXJlZ2lzdGVyIG1lbnUgaWYgc3VibWVudSBvciBoYW5kbGVyIGFyZSB1bmNoYW5nZWQNCiAgICAgICAgCWlmIChpdGVtLm1lbnUgfHwgaXRlbS5oYW5kbGVyKSB7DQogICAgICAgIAkJc2NvcGUucmVnaXN0ZXJDaHJvbWVNZW51KGl0ZW0pOw0KICAgICAgICAJfQ0KICAgICAgICAJaWYgKGl0ZW0ubWVudSkgew0KCSAgICAgICAgCWZvciAodmFyIGogPSAwIDsgaiA8IGl0ZW0ubWVudS5pdGVtcy5sZW5ndGggOyBqKyspIHsNCgkgICAgICAgIAkJdmFyIG1lbnVJdGVtID0gaXRlbS5tZW51Lml0ZW1zW2pdOw0KCSAgICAgICAgCQlpZiAoIW1lbnVJdGVtLm1lbnUpIHsNCgkgICAgICAgIAkJCS8vIFJlZ3VsYXIgbWVudSBpdGVtDQoJICAgICAgICAJCQkvLyBNZXJnZSB3aXRoIGN1cnJlbnQgbWVudSBpdGVtDQoJICAgICAgICAJCQl2YXIga2V5ID0gbWVudUl0ZW0uaXRlbUlkICE9IG51bGwgPyBtZW51SXRlbS5pdGVtSWQgOiBtZW51SXRlbS5pZDsNCgkgICAgICAgIAkJCXNjb3BlLml0ZW1zW2tleV0gPSBzY29wZS5pdGVtc1trZXldID8gc2NvcGUuaXRlbXNba2V5XSA6IHt9Ow0KCSAgICAgICAgICAgICAgICAJc2NvcGUuaXRlbXNba2V5XSA9IG1lcmdlKHNjb3BlLml0ZW1zW2tleV0sIG1lbnVJdGVtKTsNCgkgICAgICAgIAkJfSBlbHNlIHsNCgkgICAgICAgIAkJCS8vIFN1Yi1tZW51IA0KCSAgICAgICAgCQkJZm9yICh2YXIgayA9IDAgOyBrIDwgbWVudUl0ZW0ubWVudS5pdGVtcy5sZW5ndGggOyBrKyspIHsNCgkgICAgICAgIAkJCQl2YXIgc3ViTWVudUl0ZW0gPSBtZW51SXRlbS5tZW51Lml0ZW1zW2tdOw0KCQkgICAgICAgIAkJCS8vIE1lcmdlIHdpdGggY3VycmVudCBzdWItbWVudSBpdGVtDQoJCSAgICAgICAgCQkJdmFyIGtleSA9IHN1Yk1lbnVJdGVtLml0ZW1JZCAhPSBudWxsID8gc3ViTWVudUl0ZW0uaXRlbUlkIDogc3ViTWVudUl0ZW0uaWQ7DQoJCSAgICAgICAgCQkJc2NvcGUuaXRlbXNba2V5XSA9IHNjb3BlLml0ZW1zW2tleV0gPyBzY29wZS5pdGVtc1trZXldIDoge307DQoJCSAgICAgICAgICAgICAgICAJc2NvcGUuaXRlbXNba2V5XSA9IG1lcmdlKHNjb3BlLml0ZW1zW2tleV0sIHN1Yk1lbnVJdGVtKTsNCgkgICAgICAgIAkJCX0NCgkgICAgICAgIAkJfQ0KCSAgICAgICAgCX0NCiAgICAgICAgCX0gZWxzZSB7DQogICAgCQkJLy8gUmVndWxhciBtZW51IGl0ZW0NCiAgICAJCQkvLyBNZXJnZSB3aXRoIGN1cnJlbnQgbWVudSBpdGVtDQogICAgCQkJdmFyIGtleSA9IGl0ZW0uaXRlbUlkICE9IG51bGwgPyBpdGVtLml0ZW1JZCA6IGl0ZW0uaWQ7DQogICAgCQkJc2NvcGUuaXRlbXNba2V5XSA9IHNjb3BlLml0ZW1zW2tleV0gPyBzY29wZS5pdGVtc1trZXldIDoge307DQogICAgICAgICAgICAJc2NvcGUuaXRlbXNba2V5XSA9IG1lcmdlKHNjb3BlLml0ZW1zW2tleV0sIGl0ZW0pOw0KICAgICAgICAJfQ0KICAgICAgICAJDQogICAgICAgIAkvLyBVcGRhdGUgZGF0YSB3aXRoIG1lcmdlZCBpdGVtDQogICAgICAgIAlkYXRhLml0ZW1zW2ldID0gc2NvcGUuaXRlbXNbZGF0YS5pdGVtc1tpXS5pdGVtSWRdOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCg0KICAgICAgfSwNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gSW5zZXJ0cyBuZXcgbWVudXMgaW50byB0aGUgV2lkZ2V0IENocm9tZS4gIE1lbnVzIGFyZSBhZGRlZCB0byB0aGUgc2FtZSBhcmVhIGFzIGV4aXN0aW5nIG1lbnVzLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtjZmcucG9zPTBdIDAtYmFzZWQgaW5kZXggb2Ygd2hlcmUgbWVudXMgd2lsbCBiZSBhZGRlZCwgYW1vbmcgYW55IHByZS1leGlzdGluZyBtZW51cy4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgY29uZmlncw0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5wYXJlbnRJZCBpdGVtSWQgaXMgdGhlIGl0ZW1JZCBvZiB0aGUgbWVudSB0byB3aGljaCB0aGlzIGNvbmZpZ3VyYXRpb24gc2hvdWxkIGJlIGFkZGVkIGFzIGEgc3ViLW1lbnUuICBJZiBvbWl0dGVkLCB0aGUgY29uZmlndXJhdGlvbiB3aWxsIGJlIGFkZGVkIGFzIGEgbWFpbiBtZW51IG9uIHRoZSBtZW51IHRvb2xiYXIuICANCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBtZW51cyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUuICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBtZW51LiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmG1lbnUu4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudSBtZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0DQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGl0ZW0gY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBpdGVtIGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51IGl0ZW1zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHR5cGUgb2YgbWVudSBpdGVtIHRvIGFkZC4gIFRoaXMgYXR0cmlidXRlIHNob3VsZCBiZSBvbWl0dGVkIHVubGVzcyBzcGVjaWZ5aW5nIGEgbWVudXNlcGFyYXRvci4gU2V0dGluZyB0aGlzIHZhbHVlIHRvICJtZW51c2VwYXJhdG9yIiBhZGRzIGEgc2VwYXJhdG9yIGJhciB0byBhIG1lbnUsIHVzZWQgdG8gZGl2aWRlIGxvZ2ljYWwgZ3JvdXBzIG9mIG1lbnUgaXRlbXMuIElmIHNwZWNpZmllZCwgb25seSB4dHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIHVzYWdlLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51IGl0ZW0uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBmb3IgdGhlIG1lbnUgaXRlbS4gDQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgbWVudSBpdGVtIGlzIGNsaWNrZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9uJ3MgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLm1lbnUgc3ViLW1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QuICBTZWUgZXhhbXBsZSBmb3Igc3ViLW1lbnUgY29uZmlnLg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MuaW5zZXJ0SGVhZGVyTWVudXMoew0KICAgICAgICogICAgICAgICAgICAgcG9zOiAwLA0KICAgICAgICogICAgICAgICAgICAgaXRlbXM6IFt7DQogICAgICAgKgkJCSBpdGVtSWQ6J2luc2VydGVkTWVudScsDQogICAgICAgKgkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQl0ZXh0OiAnSW5zZXJ0ZWQgTWVudScsDQogICAgICAgKgkJCQltZW51OiB7DQogICAgICAgKgkJCQkJaXRlbXM6IFsNCiAgICAgICAqCQkJCQkgICAgew0KICAgICAgICoJCQkJCSAgICAJaXRlbUlkOidpbnNlcnRlZE1lbnVJdGVtMScsDQogICAgICAgKgkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJICAgIAl0ZXh0OiAnSW5zZXJ0ZWQgTWVudSBJdGVtIDEnLA0KICAgICAgICoJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJICAgIAkJYWxlcnQoJ1lvdSBjbGlja2VkIHRoZSBJbnNlcnRlZCBNZW51IG1lbnUgaXRlbS4nKTsNCiAgICAgICAqCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkgICAgfSwNCiAgICAgICAqCQkJCQkgICAgew0KICAgICAgICoJCQkJCSAgICAJeHR5cGU6ICdtZW51c2VwYXJhdG9yJw0KICAgICAgICoJCQkJCSAgICB9LA0KICAgICAgICoJCQkJCSAgICB7DQogICAgICAgKgkJCQkJICAgIAlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0yJywNCiAgICAgICAqCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkgICAgCXRleHQ6ICdJbnNlcnRlZCBNZW51IEl0ZW0gMicsDQogICAgICAgKgkJCQkJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkgICAgCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOw0KICAgICAgICoJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCQl9LA0KICAgICAgICoJCQkJCQknLScsIC8vIGFub3RoZXIgd2F5IHRvIGFkZCBhIG1lbnUgc2VwYXJhdG9yIA0KICAgICAgICoJCQkJCQl7DQogICAgICAgKgkJCQkJICAgIAlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0zJywNCiAgICAgICAqCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkgICAgCXRleHQ6ICdJbnNlcnRlZCBNZW51IEl0ZW0gMycsDQogICAgICAgKgkJCQkJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkgICAgCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOw0KICAgICAgICoJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCSAgICB9DQogICAgICAgKgkJCQkJXQ0KICAgICAgICoJCQkJfQ0KICAgICAgICoJCQl9XQ0KICAgICAgICogICAgIH0pOw0KICAgICAgICovDQogICAgICBpbnNlcnRIZWFkZXJNZW51cyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAnaW5zZXJ0SGVhZGVyTWVudXMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnbWVudSc7DQogICAgICAgIGlmIChjZmcucG9zICE9IG51bGwpIHsNCiAgICAgICAgICBkYXRhLnBvcyA9IGNmZy5wb3M7DQogICAgICAgIH0NCiAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIAl2YXIgaXRlbSA9IGl0ZW1zW2ldOw0KICAgICAgICAJaWYgKGl0ZW0ubWVudSkgew0KCSAgICAgICAgCWZvciAodmFyIGogPSAwIDsgaiA8IGl0ZW0ubWVudS5pdGVtcy5sZW5ndGggOyBqKyspIHsNCgkgICAgICAgIAkJdmFyIG1lbnVJdGVtID0gaXRlbS5tZW51Lml0ZW1zW2pdOw0KCSAgICAgICAgCQlpZiAoIW1lbnVJdGVtLm1lbnUpIHsNCgkgICAgICAgIAkJCS8vIFJlZ3VsYXIgbWVudSBpdGVtDQoJICAgICAgICAgICAgICAgIAlzY29wZS5pdGVtc1ttZW51SXRlbS5pdGVtSWQgIT0gbnVsbCA/IG1lbnVJdGVtLml0ZW1JZCA6IG1lbnVJdGVtLmlkXSA9IG1lbnVJdGVtOw0KCSAgICAgICAgCQl9IGVsc2Ugew0KCSAgICAgICAgCQkJLy8gU3ViLW1lbnUgDQoJICAgICAgICAJCQlmb3IgKHZhciBrID0gMCA7IGsgPCBtZW51SXRlbS5tZW51Lml0ZW1zLmxlbmd0aCA7IGsrKykgew0KCSAgICAgICAgCQkJCXZhciBzdWJNZW51SXRlbSA9IG1lbnVJdGVtLm1lbnUuaXRlbXNba107DQoJICAgICAgICAgICAgICAgICAgICAJc2NvcGUuaXRlbXNbc3ViTWVudUl0ZW0uaXRlbUlkICE9IG51bGwgPyBzdWJNZW51SXRlbS5pdGVtSWQgOiBzdWJNZW51SXRlbS5pZF0gPSBzdWJNZW51SXRlbTsNCgkgICAgICAgIAkJCX0NCgkgICAgICAgIAkJfQ0KCSAgICAgICAgCX0NCiAgICAgICAgCX0gZWxzZSB7DQogICAgCQkJLy8gUmVndWxhciBtZW51IGl0ZW0NCiAgICAgICAgICAgIAlzY29wZS5pdGVtc1tpdGVtLml0ZW1JZCAhPSBudWxsID8gaXRlbS5pdGVtSWQgOiBpdGVtLmlkXSA9IGl0ZW07DQogICAgICAgIAl9DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgfSwNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gUmVtb3ZlcyBleGlzdGluZyBtZW51cyBvbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiBpdGVtSWQuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBjb250YWluaW5nIGl0ZW1JZHMgZm9yIHRoZSBtZW51cyB0byByZW1vdmUgZnJvbSB0aGUgY2hyb21lLg0KICAgICAgICogICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiAgICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAqICAgICB0aGlzLndjLnJlbW92ZUhlYWRlck1lbnVzKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOiBbew0KICAgICAgICogICAgICAgICAgICAJIGl0ZW1JZDogJ3JlZ3VsYXJNZW51Jw0KICAgICAgICogICAgICAgICAgICAgfV0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgcmVtb3ZlSGVhZGVyTWVudXMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ3JlbW92ZUhlYWRlck1lbnVzJzsNCiAgICAgICAgZGF0YS50eXBlID0gJ21lbnUnOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgaWQgPSBpdGVtc1tpXTsNCiAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaWRdICE9IG51bGwpIHsNCiAgICAgICAgICAgIC8vZGVsZXRlIHNhdmVkIGRhdGENCiAgICAgICAgICAgIGRlbGV0ZSBzY29wZS5pdGVtc1tpZF07DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCiAgICAgIH0sDQogICAgICANCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIExpc3RzIGFsbCBtZW51cyB0aGF0IGhhdmUgYmVlbiBhZGRlZCB0byB0aGUgd2lkZ2V0IGNocm9tZS4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuDQogICAgICAgKg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICB0aGlzLndjLmxpc3RIZWFkZXJNZW51cyh7DQogICAgICAgKiAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKG1zZykgew0KICAgICAgICogICAgICAgICAvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nDQogICAgICAgKiAgICAgICAgIHZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOw0KICAgICAgICogICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAqICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzLml0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgKiAgICAgICAgICAgICAJLy8gZG8gc29tZXRoaW5nIHdpdGggdGhlIG1lbnVzDQogICAgICAgKiAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgIH0NCiAgICAgICAqICAgICB9DQogICAgICAgKiAgIH0pOw0KICAgICAgICovDQogICAgICBsaXN0SGVhZGVyTWVudXM6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHsNCiAgICAgICAgICBhY3Rpb246ICdsaXN0SGVhZGVyTWVudXMnLA0KICAgICAgICAgIHR5cGU6ICdtZW51Jw0KICAgICAgICB9Ow0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgfSwNCg0KICAgICAgIC8qKg0KICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgV2lkZ2V0J3MgVGl0bGUgZnJvbSB0aGUgQ2hyb21lDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICogICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAgICogICAgdGhpcy53Yy5nZXRUaXRsZSh7DQogICAgICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7DQogICAgICAgICAqICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZw0KICAgICAgICAgKiAgICAgICAgIHZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOw0KICAgICAgICAgKiAgICAgICAgIGlmIChyZXMuc3VjY2Vzcykgew0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgICAgICAgLy9kbyBzb21ldGhpbmcgd2l0aCB0aXRsZQ0KICAgICAgICAgKiAgICAgICAgICAgLy8gcmVzLnRpdGxlDQogICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgKiAgIH0pOw0KICAgICAgICAgKi8NCiAgICAgICBnZXRUaXRsZTogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgICB2YXIgZGF0YSA9IHsNCiAgICAgICAgICAgIGFjdGlvbjogJ2dldFRpdGxlJw0KICAgICAgICAgIH07DQogICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCiAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNldHMgdGhlIFdpZGdldCdzIFRpdGxlIGluIHRoZSBDaHJvbWUNCiAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcudGl0bGUgVGhlIHN0cmluZyB3aGljaCB3aWxsIHJlcGxhY2UgdGhlIHdpZGdldCB0aXRsZQ0KICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4NCiAgICAgICAgICAqDQogICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICogICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAgICAqICAgIHRoaXMud2Muc2V0VGl0bGUoew0KICAgICAgICAgICogICAgIHRpdGxlOiAnbmV3IHRpdGxlJywNCiAgICAgICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7DQogICAgICAgICAgKiAgICAgICAgIC8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcNCiAgICAgICAgICAqICAgICAgICAgdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7DQogICAgICAgICAgKiAgICAgICAgIGlmIChyZXMuc3VjY2Vzcykgew0KICAgICAgICAgICogICAgICAgICAgIC8vZ2V0IHRpdGxlIGJhY2sgZm9yIGNvbmZpcm1hdGlvbg0KICAgICAgICAgICogICAgICAgICAgIC8vIHJlcy50aXRsZQ0KICAgICAgICAgICoNCiAgICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgICogICAgIH0NCiAgICAgICAgICAqICAgfSk7DQogICAgICAgICAgKi8NCiAgICAgICAgc2V0VGl0bGU6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgICAgIGFjdGlvbjogJ3NldFRpdGxlJywNCiAgICAgICAgICAgICB0aXRsZTogY2ZnLnRpdGxlDQogICAgICAgICAgIH07DQogICAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgICB9DQoNCiAgICB9Ow0KDQogICAgcHViLmluaXQoY29uZmlnKTsNCiAgICBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmluc3RhbmNlID0gcHViOw0KICB9DQogIHJldHVybiBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmluc3RhbmNlOw0KfTsNCg0KLyoqDQogKiAgQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lIFNpbmdsZXRvbiBpbnN0YW5jZS4gIFRvIGRvIHNvIGl0IHJlcXVpcmVzIGEgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiAgQHBhcmFtICB7T2JqZWN0fSBjb25maWcgLSBjb25maWcgb2JqZWN0IHdpdGggcGFyYW1ldGVycw0KICogIEBwYXJhbSAge096b25lLmV2ZW50aW5nLldpZGdldH0gY29uZmlnLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciAtIHdpZGdldCBldmVudGluZyBvYmplY3Qgd2hpY2ggaGFuZGxlcyBldmVudGluZyBmb3IgdGhlIHdpZGdldA0KICogIEBleGFtcGxlDQogKiAgICB0aGlzLndjID0gT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5nZXRJbnN0YW5jZSh7DQogKiAgICAgICAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogICAgfSk7DQogKg0KICogQHRocm93cyB7RXJyb3J9IHRocm93cyBhbiBlcnJvciB3aXRoIGEgbWVzc2FnZSBpZiB3aWRnZXQgaW5pdGlhbGl6YXRpb24gZmFpbHMNCiAqLw0KT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGNmZykgew0KICBpZiAoT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5pbnN0YW5jZSA9IG5ldyBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lKGNmZyk7DQogIH0NCiAgcmV0dXJuIE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUuaW5zdGFuY2U7DQp9Ow0KDQoNCgovKioNCiAqIEBpZ25vcmUNCiAqLw0KdmFyIE96b25lID0gT3pvbmUgPyBPem9uZSA6IHt9Ow0KDQovKioNCiAqIEBpZ25vcmUNCiAqIEBuYW1lc3BhY2UNCiAqLw0KT3pvbmUuZHJhZ0FuZERyb3AgPSBPem9uZS5kcmFnQW5kRHJvcCA/IE96b25lLmRyYWdBbmREcm9wIDoge307DQoNCi8qKg0KICogQGRlcHJlY2F0ZWQgU2luY2UgT1dGIDMuNy4wICBZb3Ugc2hvdWxkIHVzZSA8YSBocmVmPSIjLmdldEluc3RhbmNlIj5Pem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5nZXRJbnN0YW5jZTwvYT4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICogQHBhcmFtIHtPYmplY3R9IFtjZmcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyXSAgVGhlIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlci4NCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NmZy5hdXRvSW5pdF0gIFRydWUgdG8gYXV0b21hdGljYWxseSBjYWxsIGluaXQoKSwgRmFsc2Ugb3RoZXJ3aXNlLiAgVGhlIGRlZmF1bHQgaXMgVHJ1ZSBpZiBsZWZ0IHVuZGVmaW5lZA0KICogQHBhcmFtIHtPYmplY3R9IFtjZmcuY2FsbGJhY2tzXSAgT2JqZWN0IHdpdGggY2FsbGJhY2tzIHdobydzIG5hbWVzIG1hdGNoIGRyYWcgYW5kIGRyb3AgZXZlbnRzLiAgQWx0ZXJuYXRpdmVseSBvbmUgY291bGQNCiAqIHVzZSB0aGUgPGEgaHJlZj0iI2FkZENhbGxiYWNrIj5hZGRDYWxsYmFjazwvYT4gZnVuY3Rpb24NCiAqIEBkZXNjcmlwdGlvbiBUaGUgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0IG1hbmFnZXMgdGhlIGRyYWcgYW5kIGRyb3AgZm9yIGFuIGluZGl2aWR1YWwgd2lkZ2V0Lg0KICogQHJlcXVpcmVzIG93ZmRvam8gd2hpY2ggaXMgYSBjdXN0b20gdmVyc2lvbiBvZiBkb2pvIGZvciBPV0YNCiAqIEByZXF1aXJlcyA8YSBocmVmPSJPem9uZS5ldmVudGluZy5XaWRnZXQuaHRtbCI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0PC9hPiBmb3IgZXZlbnRpbmcNCiAqIEBzZWUgPGEgaHJlZj0iI2FkZENhbGxiYWNrIj5hZGRDYWxsYmFjazwvYT4NCiAqIEBleGFtcGxlDQogKg0KICogdmFyIHdkZCA9IG5ldyBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcCh7DQogKiAgICAgICAgICAgICAgICAgICB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXI6IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiAgICAgICAgICAgICAgIH0pOw0KICoNCiAqLw0KT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AgPSBmdW5jdGlvbihjZmcpIHsNCg0KICAgIHRoaXMubGlzdGVuZXJzID0ge307DQogICAgdGhpcy5jYWxsYmFja3MgPSB7fTsNCiAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7DQogICAgdGhpcy5kcm9wRW5hYmxlZEZsYWcgPSBmYWxzZTsNCiAgICB0aGlzLmRyb3Bab25lSGFuZGxlcnMgPSBbXTsNCg0KICAgIGNmZyA9IGNmZyB8fCB7fTsNCg0KICAgIC8vc2V0IGluaXRpYWwgZHJhZyB0ZXh0DQogICAgdGhpcy5kcmFnSW5kaWNhdG9yVGV4dCA9IGNmZy5kcmFnSW5kaWNhdG9yVGV4dCA/IGNmZy5kcmFnSW5kaWNhdG9yVGV4dCA6ICdEcmFnZ2luZyBEYXRhJzsNCg0KICAgIGlmIChjZmcuY2FsbGJhY2tzICE9IG51bGwgJiYgb3dmZG9qby5pc09iamVjdChjZmcuY2FsbGJhY2tzKSkgew0KICAgICAgb3dmZG9qby5taXhpbih0aGlzLmNhbGxiYWNrcywgY2ZnLmNhbGxiYWNrcykNCiAgICB9DQoNCiAgICAvL2NyZWF0ZSBkcmFnIGluZGljYXRvcg0KICAgIHRoaXMuZHJhZ0luZGljYXRvciA9IHRoaXMuY3JlYXRlRHJhZ0luZGljYXRvcigpOw0KICAgIHRoaXMuZHJhZ0luZGljYXRvclRleHROb2RlID0gb3dmZG9qby5xdWVyeSgnc3Bhbi5kZFRleHQnLCB0aGlzLmRyYWdJbmRpY2F0b3IpWzBdOw0KDQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBjZmcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIHx8IE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZTsNCg0KICAgIGlmIChjZmcua2VlcE1vdXNlTGlzdGVuZXJzQXR0YWNoZWQgPT09IHVuZGVmaW5lZCAmJiBvd2Zkb2pvLmlzSUUpIHsNCiAgICAgICAgY2ZnLmtlZXBNb3VzZUxpc3RlbmVyc0F0dGFjaGVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICBpZiAoY2ZnLmF1dG9Jbml0IHx8IGNmZy5hdXRvSW5pdCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHRoaXMuaW5pdChjZmcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGZpcmVNb3VzZUV2ZW50KGVsLCB0eXBlLCBtc2cpIHsNCiAgICAgICAgdmFyIGV2dDsNCiAgICAgICAgaWYoZG9jdW1lbnQuY3JlYXRlRXZlbnQpIHsNCiAgICAgICAgICAgIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpOw0KICAgICAgICAgICAgZXZ0LmluaXRNb3VzZUV2ZW50KHR5cGUsIHRydWUsIHRydWUsIHdpbmRvdywgMSwgDQogICAgICAgICAgICAgICAgbXNnLnNjcmVlblgsIG1zZy5zY3JlZW5ZLCBtc2cucGFnZVgsIG1zZy5wYWdlWSwgDQogICAgICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIG51bGwsIG51bGwNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBlbC5kaXNwYXRjaEV2ZW50KGV2dCk7DQogICAgICAgIH0gZWxzZSBpZiggZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QgKSB7DQogICAgICAgICAgICBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCgpOw0KICAgICAgICAgICAgZWwuZmlyZUV2ZW50KCdvbicgKyB0eXBlLCBldnQpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoJ19maXJlX21vdXNlX21vdmUnLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIGZ1bmN0aW9uKG1zZykgew0KDQogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQobXNnLnBhZ2VYLCBtc2cucGFnZVkpOw0KDQogICAgICAgIGlmKHRoaXMuZ2V0Rmxhc2hXaWRnZXRJZCgpKSB7DQogICAgICAgICAgICBpZihtc2cuc2VuZGVyICE9PSB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpKSB7DQogICAgICAgICAgICAgICAgT3pvbmUudXRpbC5nZXRGbGFzaEFwcCgpLmRpc3BhdGNoRXh0ZXJuYWxNb3VzZUV2ZW50KG1zZy5wYWdlWCwgbXNnLnBhZ2VZKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMubW91c2VNb3ZlKG1zZywgdHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZighYXJndW1lbnRzLmNhbGxlZS5sYXN0RWwpIHsNCiAgICAgICAgICAgICAgICBhcmd1bWVudHMuY2FsbGVlLmxhc3RFbCA9IGVsOw0KICAgICAgICAgICAgICAgIGZpcmVNb3VzZUV2ZW50KGVsLCAnbW91c2VvdmVyJywgbXNnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYoYXJndW1lbnRzLmNhbGxlZS5sYXN0RWwgIT09IGVsKSB7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnbGFzdEVsICcsIGFyZ3VtZW50cy5jYWxsZWUubGFzdEVsKTsNCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdlbCAnLCBlbCk7DQogICAgICAgICAgICAgICAgZmlyZU1vdXNlRXZlbnQoYXJndW1lbnRzLmNhbGxlZS5sYXN0RWwsICdtb3VzZW91dCcsIG1zZyk7DQogICAgICAgICAgICAgICAgZmlyZU1vdXNlRXZlbnQoZWwsICdtb3VzZW92ZXInLCBtc2cpOw0KICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUubGFzdEVsID0gZWw7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZpcmVNb3VzZUV2ZW50KGVsLCAnbW91c2Vtb3ZlJywgbXNnKTsNCiAgICAgICAgfQ0KDQogICAgfSkpOw0KDQogICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoJ19maXJlX21vdXNlX3VwJywgb3dmZG9qby5oaXRjaCh0aGlzLCBmdW5jdGlvbihtc2cpIHsNCiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChtc2cucGFnZVgsIG1zZy5wYWdlWSk7DQogICAgICAgIGlmKGVsICYmIGVsLm5vZGVOYW1lID09PSAnT0JKRUNUJykgew0KICAgICAgICAgICAgdGhpcy5tb3VzZVVwKG1zZywgdHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBmaXJlTW91c2VFdmVudChlbCwgJ21vdXNldXAnLCBtc2cpOw0KICAgICAgICB9DQogICAgfSkpOw0KDQogICAgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuaW5zdGFuY2UgPSB0aGlzOw0KICAgIHJldHVybiB0aGlzOw0KfTsNCg0KT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AucHJvdG90eXBlID0gew0KDQogIC8vcHVibGljIGV2ZW50cw0KICAvKioNCiAgICogQGZpZWxkDQogICAqIEBkZXNjcmlwdGlvbiBkcmFnU3RhcnQgaXMgdGhlIG5hbWUgb2YgdGhlIGV2ZW50IHdoZW4gYSBkcmFnIGlzIHN0YXJ0ZWQuICBVc2UgJ2RyYWdTdGFydCcgd2l0aCB0aGUgYWRkQ2FsbGJhY2sgZnVuY3Rpb24NCiAgICogdG8gYWRkIGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBhIGRyYWdTdGFydCBldmVudCBvY2N1cnMNCiAgICogQHNlZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPg0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAgLy90aGlzLndkZCBpcyBhIGluaXRpYWxpemVkIFdpZGdldERyYWdBbmREcm9wIG9iamVjdA0KICAgKiAgdGhpcy53ZGQuYWRkQ2FsbGJhY2soJ2RyYWdTdGFydCcsZnVuY3Rpb24oKSB7DQogICAqICAgIC8vdXNlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHN0eWxlcyBvciBjaGFuZ2Ugc3RhdGUgd2hlbiBhIGRyYWcgaXMgaW5pdGlhdGVkDQogICAqICAgIGNtcC5kcmFnZ2luZyA9IHRydWU7DQogICAqICAgIGNtcC5nZXRWaWV3KCkuc2Nyb2xsZXIuYWRkQ2xzKCdkZE92ZXInKTsNCiAgICogIH0pOw0KICAgKg0KICAgKi8NCiAgZHJhZ1N0YXJ0OiAnZHJhZ1N0YXJ0JywNCg0KICAvKioNCiAgICogQGZpZWxkDQogICAqIEBkZXNjcmlwdGlvbiBkcmFnU3RvcCBpcyB0aGUgbmFtZSBvZiB0aGUgZXZlbnQgd2hlbiBhIGRyYWcgaXMgc3RvcHBlZC4gIFVzZSAnZHJhZ1N0b3AnIHdpdGggdGhlIGFkZENhbGxiYWNrIGZ1bmN0aW9uDQogICAqIHRvIGFkZCBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gYSBkcmFnU3RvcCBldmVudCBvY2N1cnMNCiAgICogQHNlZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPg0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAgLy90aGlzLndkZCBpcyBhIGluaXRpYWxpemVkIFdpZGdldERyYWdBbmREcm9wIG9iamVjdA0KICAgKiAgdGhpcy53ZGQuYWRkQ2FsbGJhY2soJ2RyYWdTdG9wJyxmdW5jdGlvbigpIHsNCiAgICogICAgLy91c2UgdGhpcyBmdW5jdGlvbiB0byBjaGFuZ2Ugc3R5bGVzIG9yIGNoYW5nZSBzdGF0ZSB3aGVuIGEgZHJhZyBpcyBzdG9wcGVkDQogICAqICAgIGNtcC5kcmFnZ2luZyA9IGZhbHNlOw0KICAgKiAgICBjbXAuZ2V0VmlldygpLnNjcm9sbGVyLnJlbW92ZUNscygnZGRPdmVyJyk7DQogICAqICB9KTsNCiAgICoNCiAgICovDQogIGRyYWdTdG9wOiAnZHJhZ1N0b3AnLA0KDQogIC8qKg0KICAgKiBAZmllbGQNCiAgICogQGRlc2NyaXB0aW9uIGRyb3BSZWNlaXZlIGlzIHRoZSBuYW1lIG9mIHRoZSBldmVudCB3aGVuIGEgZHJvcCBvY2N1cnMgb24gdGhpcyB3aWRnZXQuICBUaGlzIGV2ZW50IGluZGljYXRlcyBhIHN1Y2Nlc3NmdWwNCiAgICogZHJhZyBhbmQgZHJvcCBhbmQgZGF0YSB3aWxsIGJlIHBhc3NlZCB0byB0aGUgY2FsbGJhY2sgZnVuY3Rpb24uICBVc2UgJ2Ryb3BSZWNlaXZlJyB3aXRoIHRoZSBhZGRDYWxsYmFjayBmdW5jdGlvbg0KICAgKiB0byBhZGQgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGEgZHJvcFJlY2VpdmUgZXZlbnQgb2NjdXJzLiAgVGhpcyBjYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhpcyBldmVudCB3aWxsIGJlIGNhbGxlZCBmb3INCiAgICogYWxsIHN1Y2Nlc3NmdWwgZHJvcHMuICBUbyBzdXBwb3J0IG11bHRpcGxlIGRyb3Agem9uZXMgdXNlIDxhIGhyZWY9IiNhZGREcm9wWm9uZUhhbmRsZXIiPmFkZERyb3Bab25lSGFuZGxlcjwvYT4NCiAgICogQHNlZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPg0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAgLy90aGlzLndkZCBpcyBhIGluaXRpYWxpemVkIFdpZGdldERyYWdBbmREcm9wIG9iamVjdA0KICAgKiAgIHRoaXMud2RkLmFkZENhbGxiYWNrKCdkcm9wUmVjZWl2ZScsZnVuY3Rpb24obXNnKSB7DQogICAqICAgICAgLy9tc2cuZHJhZ0Ryb3BEYXRhIGNvbnRhaW5zIHRoZSBkYXRhIC0gdGhpcyBleGFtcGxlIHRoZSBkYXRhIGlzIGEgY2hhbm5lbCBuYW1lIHRoYXQgd2lsbCBiZSBzdWJzY3JpYmVkIHRvDQogICAqICAgICAgdGhpcy5zdWJzY3JpYmVUb0NoYW5uZWwobXNnLmRyYWdEcm9wRGF0YSk7DQogICAqICAgfS5iaW5kKHRoaXMpKTsNCiAgICovDQogIGRyb3BSZWNlaXZlOiAnZHJvcFJlY2VpdmUnLA0KDQogIC8vcHJpdmF0ZSBldmVudHMNCiAgZHJhZ1N0YXJ0TmFtZTogJ19kcmFnU3RhcnQnLA0KICBkcmFnT3ZlcldpZGdldE5hbWU6ICdfZHJhZ092ZXJXaWRnZXQnLA0KICBkcmFnT3V0TmFtZTogJ19kcmFnT3V0TmFtZScsDQogIGRyYWdTdG9wSW5Db250YWluZXJOYW1lOiAnX2RyYWdTdG9wSW5Db250YWluZXInLA0KICBkcmFnU3RvcEluV2lkZ2V0TmFtZTogJ19kcmFnU3RvcEluV2lkZ2V0JywNCiAgZHJhZ1NlbmREYXRhTmFtZTogIl9kcmFnU2VuZERhdGEiLA0KICBkcm9wUmVjZWl2ZURhdGFOYW1lOiAiX2Ryb3BSZWNlaXZlRGF0YSIsDQoNCiAgLyoqDQogICAqIEBmaWVsZA0KICAgKiBAZGVzY3JpcHRpb24gdmVyc2lvbiBudW1iZXINCiAgICovDQogIHZlcnNpb246IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24uZHJhZ0FuZERyb3AsDQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBJbml0aWFsaXplcyB0aGUgV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0LiAgVXNpbmcgdGhpcyBmdW5jdGlvbiBpcyBvbmx5IHJlcXVpcmVkIGlmIGF1dG9Jbml0IGNvbmZpZyBpcyBmYWxzZQ0KICAgKiBpbiB0aGUgY29uc3RydWN0b3IuICBUaGlzIGZ1bmN0aW9uIGlzIHNvbWV0aW1lcyB1c2VmdWwgd2hlbiBpdCBpcyBuZWNlc3NhcnkgdG8gZGVmZXIgZHJhZyBhbmQgZHJvcCBldmVudCBoYW5kbGluZyBhZnRlcg0KICAgKiBjcmVhdGluZyB0aGUgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0DQogICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBjb25maWcgb2JqZWN0DQogICAqIEBzZWUgPGEgaHJlZj0iI2NvbnN0cnVjdG9yIj5jb25zdHJ1Y3RvcjwvYT4NCiAgICovDQogIGluaXQgOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgY2ZnID0gY2ZnIHx8IHt9Ow0KDQogICAgLy9zdWJzY3JpYmUgdG8gY2hhbm5lbHMNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUodGhpcy5kcmFnU3RhcnROYW1lLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIHRoaXMub25TdGFydERyYWcpKTsNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUodGhpcy5kcmFnT3V0TmFtZSwgb3dmZG9qby5oaXRjaCh0aGlzLCB0aGlzLm9uRHJhZ091dCkpOw0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnN1YnNjcmliZSh0aGlzLmRyYWdTdG9wSW5Db250YWluZXJOYW1lLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIHRoaXMub25EcmFnU3RvcEluQ29udGFpbmVyKSk7DQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuc3Vic2NyaWJlKHRoaXMuZHJvcFJlY2VpdmVEYXRhTmFtZSwgb3dmZG9qby5oaXRjaCh0aGlzLCB0aGlzLmRyb3BSZWNlaXZlRGF0YSkpOw0KDQogICAgaWYgKGNmZy5rZWVwTW91c2VMaXN0ZW5lcnNBdHRhY2hlZCA9PT0gdHJ1ZSkgew0KICAgICAgdGhpcy5rZWVwTW91c2VMaXN0ZW5lcnNBdHRhY2hlZCA9IHRydWU7DQoNCiAgICAgIC8vaG9vayBtb3VzZSBtb3ZlIGFuZCBtb3VzZSB1cA0KICAgICAgaWYgKHRoaXMubGlzdGVuZXJzLm9ubW91c2Vtb3ZlID09IG51bGwpIHsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnMub25tb3VzZW1vdmUgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbm1vdXNlbW92ZScsIHRoaXMsIHRoaXMubW91c2VNb3ZlKTsNCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLmxpc3RlbmVycy5vbm1vdXNldXAgPT0gbnVsbCkgew0KICAgICAgICB0aGlzLmxpc3RlbmVycy5vbm1vdXNldXAgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbm1vdXNldXAnLCB0aGlzLCB0aGlzLm1vdXNlVXApOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQHByaXZhdGUNCiAgICovDQogIGNyZWF0ZURyYWdJbmRpY2F0b3I6IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gb3dmZG9qby5jcmVhdGUoJ3NwYW4nLCB7DQogICAgICBjbGFzc05hbWU6ICdkZEJveCBkZEJveENhbm5vdERyb3AnLA0KICAgICAgc3R5bGU6IHtkaXNwbGF5OiAnbm9uZSd9LA0KICAgICAgaW5uZXJIVE1MOiAnPHNwYW4gY2xhc3M9ImRkVGV4dCI+JyArIHRoaXMuZHJhZ0luZGljYXRvclRleHQgKyAnPC9zcGFuPicNCiAgICB9LA0KICAgIG93ZmRvam8uYm9keSgpDQogICAgKTsNCiAgfSwNCg0KICAvKioNCiAgICogQGRlc2NyaXB0aW9uIFN0YXJ0cyBhIGRyYWcuICBUaGUgY29uZmlnIG9iamVjdCBwYXNzZWQgaW4gZGVzY3JpYmVzIHRoZSBkcmFnIGFuZCBjb250YWlucyB0aGUgZGF0YSB0byBiZSBwYXNzZWQgdG8gdGhlIGRyb3AuDQogICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cNCiAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kcmFnRHJvcExhYmVsIE5hbWUgdG8gYmUgdXNlZCBhcyB0ZXh0IGZvciB0aGUgZHJhZ0Ryb3AgaW5kaWNhdG9yDQogICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuZHJhZ0Ryb3BEYXRhIERhdGEgdG8gYmUgc2VudCBvbiBhIHN1Y2Nlc3NmdWwgZHJhZyBhbmQgZHJvcC4gIFRoaXMgcHJvcGVydHkgaXMgb25seSBzZW50IHRvIHRoZQ0KICAgKiBzdWNjZXNzZnVsIHJlY2lwaWVudCBvZiB0aGUgZHJhZyAodGhlIGRyb3BSZWNlaXZlIGV2ZW50KS4gIEl0IHdpbGwgbm90IGJlIHNlbnQgZm9yIG90aGVyIGV2ZW50cy4NCiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5kcmFnWm9uZSBkb20gbm9kZSB3aGljaCBwcmVzZW50cyBhIGRyYWdab25lIHdoaWNoIGlzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRyYWcuICBUaGlzIHByb3BlcnR5IGlzDQogICAqIG9ubHkgc2F2ZWQgYW5kIHVzZWQgbG9jYWxseSB0byB0aGUgd2lkZ2V0IHRvIGlkZW50aWZ5IHdoZXRoZXIgYSBkcmFnWm9uZSBpcyBpbiBmYWN0IHRoZSBub2RlIGFzIGEgZHJvcFpvbmUuICBJdCB3aWxsIG5vdCBiZQ0KICAgKiBzZW50IHRvIG90aGVyIGV2ZW50cyBjYWxsYmFja3MuDQogICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuKiBvdGhlciBjdXN0b20gcHJvcGVydGllcyBtYXkgYmUgc3BlY2lmaWVkLCB0aGVzZSB3aWxsIGJlIHBhc3NlZCBhbG9uZyB0byBldmVudCBoYW5kbGVycw0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAgLy9hZGQgaGFuZGxlciB0byB0ZXh0IGZpZWxkIGZvciBkcmFnZ2luZw0KICAgKiAgb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcmFnU291cmNlJyksJ29ubW91c2Vkb3duJyx0aGlzLGZ1bmN0aW9uKGUpIHsNCiAgICogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAqICAgICAgdmFyIGRhdGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnSW5wdXRDaGFubmVsJykudmFsdWU7DQogICAqICAgICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBkYXRhICE9ICcnKSB7DQogICAqICAgICAgICB0aGlzLndkZC5kb1N0YXJ0RHJhZyh7DQogICAqICAgICAgICAgICAgZHJhZ0Ryb3BMYWJlbDogZGF0YSwNCiAgICogICAgICAgICAgICBkcmFnWm9uZTogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcmFnWm9uZScpLA0KICAgKiAgICAgICAgICAgIGRyYWdEcm9wR3JvdXA6ICdsb2NhdGlvbicsICAvL2V4dHJhIHByb3BlcnR5IHRvIHBhc3MgYWxvbmcNCiAgICogICAgICAgICAgICBkcmFnRHJvcERhdGE6IGRhdGENCiAgICogICAgICAgIH0pOw0KICAgKiAgICAgIH0NCiAgICogIH0pOw0KICAgKi8NCiAgZG9TdGFydERyYWcgOiBmdW5jdGlvbiAoY2ZnKSB7DQoNCiAgICB2YXIgZHJhZ1N0YXJ0Q2ZnID0gew0KICAgICAgZHJhZ1NvdXJjZUlkOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpDQogICAgfTsNCg0KICAgIHRoaXMuZHJhZ1pvbmUgPSBjZmcuZHJhZ1pvbmU7DQoNCiAgICAvL2FsbG93IGNhbGxlciB0byBwYXNzIGV4dHJhIHByb3BlcnRpZXMgdG8gZHJhZ1N0YXJ0DQogICAgLy9iZSBzdXJlIHRvIG5vdCBzZW5kIHRoZSBkcmFnRHJvcERhdGENCiAgICBvd2Zkb2pvLm1peGluKGRyYWdTdGFydENmZyxjZmcpOw0KICAgIGRlbGV0ZSBkcmFnU3RhcnRDZmcuZHJhZ0Ryb3BEYXRhOw0KICAgIGRlbGV0ZSBkcmFnU3RhcnRDZmcuZHJhZ1pvbmU7DQoNCiAgICAvL3N0YXJ0IGRyYWcNCiAgICB0aGlzLm9uU3RhcnREcmFnKHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksZHJhZ1N0YXJ0Q2ZnKTsNCg0KICAgIC8vc2VuZCBtZXNzYWdlIHRvIHN0YXJ0IGRyYWdnaW5nIGZvciBvdGhlciB3aWRnZXRzIC0gdW5zdWJzY3JpYmUgc28gd2UgZG9uJ3QgcmVwZWF0IG9uc3RhcnRkcmFnDQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIudW5zdWJzY3JpYmUodGhpcy5kcmFnU3RhcnROYW1lKTsNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5wdWJsaXNoKHRoaXMuZHJhZ1N0YXJ0TmFtZSwgZHJhZ1N0YXJ0Q2ZnKTsNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUodGhpcy5kcmFnU3RhcnROYW1lLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIHRoaXMub25TdGFydERyYWcpKTsNCg0KICAgIC8vc2VuZCBkYXRhIHRvIGNvbnRhaW5lcg0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnB1Ymxpc2godGhpcy5kcmFnU2VuZERhdGFOYW1lLCBvd2Zkb2pvLm1peGluKHsNCiAgICAgIGRyYWdTb3VyY2VJZDogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKQ0KICAgIH0sY2ZnKSwnLi4nKTsNCg0KICB9LA0KDQogIC8qKg0KICAgKiBAcHJpdmF0ZQ0KICAgKi8NCiAgb25TdGFydERyYWcgOiBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KDQogICAgdGhpcy5kcmFnZ2luZyA9IHRydWU7DQoNCiAgICB0aGlzLmRyYWdTdGFydERhdGEgPSBtc2c7DQoNCiAgICBpZiAob3dmZG9qby5pc0Z1bmN0aW9uKHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJhZ1N0YXJ0XSkpIHsNCiAgICAgIC8vZXhlY3V0ZSBjYWxsYmFjayBpZiBmYWxzZSBpcyByZXR1cm5lZCBkb24ndCBjb250aW51ZQ0KICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJhZ1N0YXJ0XShzZW5kZXIsbXNnKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgdGhpcy5kcmFnZ2luZyA9IGZhbHNlOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgfQ0KDQogICAgLy9wcmV2ZW50IElFIGJ1ZyB3aGVyZSB0ZXh0IGlzIGRyYWdnZWQgaW5zdGVhZCBvZiB0aGUgbm9kZQ0KICAgIGlmIChvd2Zkb2pvLmlzSUUpIHsNCiAgICAgIGRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfTsNCiAgICAgIGRvY3VtZW50Lm9uZHJhZ3N0YXJ0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIHRoaXMuZHJhZ0luZGljYXRvclRleHQgPSBtc2cuZHJhZ0Ryb3BMYWJlbDsNCiAgICB0aGlzLmRyYWdJbmRpY2F0b3JUZXh0Tm9kZS5pbm5lckhUTUwgPSB0aGlzLmRyYWdJbmRpY2F0b3JUZXh0Ow0KDQogICAgLy9ob29rIG1vdXNlIG1vdmUgYW5kIG1vdXNlIHVwDQogICAgaWYgKHRoaXMubGlzdGVuZXJzLm9ubW91c2Vtb3ZlID09IG51bGwpIHsNCiAgICAgIHRoaXMubGlzdGVuZXJzLm9ubW91c2Vtb3ZlID0gb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb25tb3VzZW1vdmUnLCB0aGlzLCB0aGlzLm1vdXNlTW92ZSk7DQogICAgfQ0KICAgIGlmICh0aGlzLmxpc3RlbmVycy5vbm1vdXNldXAgPT0gbnVsbCkgew0KICAgICAgdGhpcy5saXN0ZW5lcnMub25tb3VzZXVwID0gb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb25tb3VzZXVwJywgdGhpcywgdGhpcy5tb3VzZVVwKTsNCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEBwcml2YXRlDQogICAqLw0KICBvbkRyYWdPdXQgOiBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KICAgIG93ZmRvam8uc3R5bGUodGhpcy5kcmFnSW5kaWNhdG9yLCB7DQogICAgICBkaXNwbGF5OiAnbm9uZScNCiAgICB9KTsNCiAgfSwNCg0KICAvKioNCiAgICogQHByaXZhdGUNCiAgICovDQogIGdldE1vdXNlQ29vcmRpbmF0ZXM6IGZ1bmN0aW9uIChlKSB7DQogICAgdmFyIHJldHVyblZhbHVlID0gbnVsbDsNCiAgICBpZiAoZS5wYWdlWCB8fCBlLnBhZ2VZKSB7DQogICAgICByZXR1cm5WYWx1ZSA9IHsNCiAgICAgICAgeCA6IGUucGFnZVgsDQogICAgICAgIHkgOiBlLnBhZ2VZDQogICAgICB9Ow0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIHJldHVyblZhbHVlID0gew0KICAgICAgICB4IDogZS5jbGllbnRYICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0IC0gZG9jdW1lbnQuYm9keS5jbGllbnRMZWZ0LA0KICAgICAgICB5IDogZS5jbGllbnRZICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgLSBkb2N1bWVudC5ib2R5LmNsaWVudFRvcA0KICAgICAgfTsNCiAgICB9DQogICAgcmV0dXJuIHJldHVyblZhbHVlOw0KICB9LA0KDQogICAgLyoqDQogICAgKiBAcHJpdmF0ZQ0KICAgICovDQogICAgbW91c2VNb3ZlIDogZnVuY3Rpb24gKGUsIGZha2UpIHsNCiAgICAgICAgLy9vbmx5IHNob3cgdGhlIGluZGljYXRvciBpZiB3ZSBhcmUgY3VycmVubHR5IGRyYWdnaW5nDQogICAgICAgIGlmICh0aGlzLmRyYWdnaW5nID09PSB0cnVlKSB7DQoNCiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBmbGV4IHdpZGdldCwgZXZlbnQgaXMgbm90IGZha2VkIGFuZCBjdXJyZW50IGRhc2hib2FyZCBsYXlvdXQgaXMgdGFiYmVkLCBmYWtlIA0KICAgICAgICAgICAgLy8gbW91c2UgZXZlbnRzIGFzIHNvb24gYXMgdGhlIGRyYWcgc3RhcnRzDQogICAgICAgICAgICBpZih0aGlzLmdldEZsYXNoV2lkZ2V0SWQoKSAmJiBmYWtlICE9PSB0cnVlICYmIE96b25lLldpZGdldC5nZXREYXNoYm9hcmRMYXlvdXQoKSA9PT0gJ3RhYmJlZCcpIHsNCiAgICAgICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCAnX2Zha2VfbW91c2VfbW92ZScsIG51bGwsIHsNCiAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLA0KICAgICAgICAgICAgICAgICAgICBwYWdlWDogZS5wYWdlWCwNCiAgICAgICAgICAgICAgICAgICAgcGFnZVk6IGUucGFnZVksDQogICAgICAgICAgICAgICAgICAgIHNjcmVlblg6IGUuc2NyZWVuWCwNCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuWTogZS5zY3JlZW5ZDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgY2xpZW50V2lkdGggPSBudWxsOw0KICAgICAgICAgICAgdmFyIGNsaWVudEhlaWdodCA9IG51bGw7DQogICAgICAgICAgICB2YXIgbW91c2VQb3NpdGlvbiA9IHRoaXMuZ2V0TW91c2VDb29yZGluYXRlcyhlKTsNCiAgICAgICAgICAgIHZhciBsZWZ0V2lkdGggPSBtb3VzZVBvc2l0aW9uLng7DQogICAgICAgICAgICB2YXIgdG9wSGVpZ2h0ID0gbW91c2VQb3NpdGlvbi55Ow0KDQogICAgICAgICAgICAvLyBIaWRlIHRoZSBkcmFnIGluZGljYXRvciBib3ggd2hpbGUgd2UgbW92ZSBpdA0KICAgICAgICAgICAgb3dmZG9qby5zdHlsZSh0aGlzLmRyYWdJbmRpY2F0b3IsIHsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBpZiAoZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgZSA9IHdpbmRvdy5ldmVudDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKG93ZmRvam8uaXNJRSkgew0KICAgICAgICAgICAgICAgIGNsaWVudFdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsNCiAgICAgICAgICAgICAgICBjbGllbnRIZWlnaHQgPSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNsaWVudFdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7DQogICAgICAgICAgICAgICAgY2xpZW50SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZigob3dmZG9qby5pc0ZGICYmIG93ZmRvam8uaXNGRiA+PSA0KSB8fCB0aGlzLmdldEZsYXNoV2lkZ2V0SWQoKSkgew0KDQogICAgICAgICAgICAgICAgaWYoZS5jbGllbnRYIDwgMCB8fCBlLmNsaWVudFggPiBjbGllbnRXaWR0aCB8fCANCiAgICAgICAgICAgICAgICAgICAgZS5jbGllbnRZIDwgMCB8fCBlLmNsaWVudFkgPiBjbGllbnRIZWlnaHQpIHsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdmFyaWFibGUgb24gZnVuY3Rpb24gdG8ga2VlcCB0cmFjayBpZiB3ZSBmYWtlZCBhbiBldmVudA0KICAgICAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBmYWtlIG1vdXNlb3V0IGxhdGVyIHdoZW4gbW91c2VvdmVyIHRoZSBjdXJyZW50IHdpZGdldA0KICAgICAgICAgICAgICAgICAgICBpZighYXJndW1lbnRzLmNhbGxlZS5fZmFrZUV2ZW50Q291bnRlcikNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUuX2Zha2VFdmVudENvdW50ZXIgPSAxOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHMuY2FsbGVlLl9mYWtlRXZlbnRDb3VudGVyICs9IDE7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdfZmFrZV9tb3VzZV9tb3ZlJywgbnVsbCwgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVg6IGUucGFnZVgsDQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlWTogZS5wYWdlWSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlblg6IGUuc2NyZWVuWCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlblk6IGUuc2NyZWVuWQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmKCBhcmd1bWVudHMuY2FsbGVlLl9mYWtlRXZlbnRDb3VudGVyICkgew0KICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYWQgZmFrZWQgYSBtb3VzZW1vdmUgZXZlbnQgYmVmb3JlDQogICAgICAgICAgICAgICAgICAgIC8vIG5vdyBmYWtlIG1vdXNlb3V0IGV2ZW50IG9uIHRoZSBjb250YWluZXINCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZS5fZmFrZUV2ZW50Q291bnRlciA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ19mYWtlX21vdXNlX291dCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gZmxpcHBpbmcgbWVjaGFuaXNtIHdoZW4gdGhlIGN1cnNvciByZWFjaGVzIHRoZSByaWdodCBvciBib3R0b20gZWRnZSBvZiB0aGUgd2lkZ2V0DQogICAgICAgICAgICB0aGlzLmRyYWdJbmRpY2F0b3Iuc3R5bGUudG9wID0gdG9wSGVpZ2h0ICsgMTkgKyAicHgiOw0KDQogICAgICAgICAgICB2YXIgcmlnaHRMaW1pdCA9IGNsaWVudFdpZHRoIC0gMTAwOw0KICAgICAgICAgICAgaWYgKChsZWZ0V2lkdGggPCBjbGllbnRXaWR0aCkgJiYgKGxlZnRXaWR0aCA+IHJpZ2h0TGltaXQpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5kcmFnSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSBsZWZ0V2lkdGggLSA4OCArICJweCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmRyYWdJbmRpY2F0b3Iuc3R5bGUubGVmdCA9IGxlZnRXaWR0aCArIDEyICsgInB4IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBib3R0b21MaW1pdCA9IGNsaWVudEhlaWdodCAtIDQwOw0KICAgICAgICAgICAgaWYgKCh0b3BIZWlnaHQgPiBib3R0b21MaW1pdCkgJiYgKHRvcEhlaWdodCA8IGNsaWVudEhlaWdodCkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmRyYWdJbmRpY2F0b3Iuc3R5bGUudG9wID0gdG9wSGVpZ2h0IC0gMzAgKyAicHgiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBzZXQgdGV4dCBvbiBpbmRpY2F0b3INCiAgICAgICAgICAgIHRoaXMuZHJhZ0luZGljYXRvclRleHROb2RlLmlubmVySFRNTCA9IHRoaXMuZHJhZ0luZGljYXRvclRleHQ7DQogICAgICAgICAgICBvd2Zkb2pvLnN0eWxlKHRoaXMuZHJhZ0luZGljYXRvciwgew0KICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIH0NCiAgICB9LA0KDQogIC8qKg0KICAgKiBAcHJpdmF0ZQ0KICAgKi8NCiAgb25EcmFnU3RvcEluQ29udGFpbmVyIDogZnVuY3Rpb24oc2VuZGVyLCBtc2cpIHsNCiAgICBvd2Zkb2pvLnN0eWxlKHRoaXMuZHJhZ0luZGljYXRvciwgew0KICAgICAgZGlzcGxheTogJ25vbmUnDQogICAgfSk7DQogICAgLy9kaXNjb25uZWN0IGxpc3RlbmVycw0KICAgIGlmICghdGhpcy5rZWVwTW91c2VMaXN0ZW5lcnNBdHRhY2hlZCkgew0KICAgICAgZm9yIChsIGluIHRoaXMubGlzdGVuZXJzKSB7DQogICAgICAgIG93ZmRvam8uZGlzY29ubmVjdCh0aGlzLmxpc3RlbmVyc1tsXSk7DQogICAgICAgIHRoaXMubGlzdGVuZXJzW2xdID0gbnVsbDsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7DQogICAgdGhpcy5kcmFnU3RhcnREYXRhID0gbnVsbDsNCiAgICB0aGlzLmRyYWdab25lID0gbnVsbDsNCiAgICB0aGlzLnNldERyb3BFbmFibGVkKGZhbHNlKTsNCg0KICAgIGlmIChvd2Zkb2pvLmlzRnVuY3Rpb24odGhpcy5jYWxsYmFja3NbdGhpcy5kcmFnU3RvcF0pKSB7DQogICAgICB0aGlzLmNhbGxiYWNrc1t0aGlzLmRyYWdTdG9wXSh0aGlzLmRyb3BUYXJnZXQpOw0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQHByaXZhdGUNCiAgICovDQogIG1vdXNlVXAgOiBmdW5jdGlvbiAoZSwgZmFrZSkgew0KICAgIGlmICh0aGlzLmRyYWdnaW5nID09PSB0cnVlKSB7DQogICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7DQoNCiAgICAgIC8vcHJldmVudCBJRSBidWcgd2hlcmUgdGV4dCBpcyBkcmFnZ2VkIGluc3RlYWQgb2YgdGhlIG5vZGUNCiAgICAgIGlmIChvd2Zkb2pvLmlzSUUpIHsNCiAgICAgICAgZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9Ow0KICAgICAgICBkb2N1bWVudC5vbmRyYWdzdGFydCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgb3dmZG9qby5zdHlsZSh0aGlzLmRyYWdJbmRpY2F0b3IsIHsNCiAgICAgICAgZGlzcGxheTogJ25vbmUnDQogICAgICB9KTsNCg0KICAgICAgaWYodGhpcy5nZXRGbGFzaFdpZGdldElkKCkpIHsNCg0KICAgICAgICAgIHZhciBjbGllbnRXaWR0aCA9IG51bGw7DQogICAgICAgICAgdmFyIGNsaWVudEhlaWdodCA9IG51bGw7DQogICAgICAgICAgaWYgKG93ZmRvam8uaXNJRSkgew0KICAgICAgICAgICAgICBjbGllbnRXaWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7DQogICAgICAgICAgICAgIGNsaWVudEhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0Ow0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgY2xpZW50V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsNCiAgICAgICAgICAgICAgY2xpZW50SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmKChlLmNsaWVudFggPCAwIHx8IGUuY2xpZW50WCA+IGNsaWVudFdpZHRoIHx8IA0KICAgICAgICAgICAgICAgIGUuY2xpZW50WSA8IDAgfHwgZS5jbGllbnRZID4gY2xpZW50SGVpZ2h0DQogICAgICAgICAgICAgICAgfHwgT3pvbmUuV2lkZ2V0LmdldERhc2hib2FyZExheW91dCgpID09PSAndGFiYmVkJykNCiAgICAgICAgICAgICAgICAmJiBmYWtlICE9PSB0cnVlKSB7DQogICAgICAgICAgICAgIA0KICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdfZmFrZV9tb3VzZV91cCcsIG51bGwsIHsNCiAgICAgICAgICAgICAgICAgIHNlbmRlcjogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwNCiAgICAgICAgICAgICAgICAgIHBhZ2VYOiBlLnBhZ2VYLA0KICAgICAgICAgICAgICAgICAgcGFnZVk6IGUucGFnZVksDQogICAgICAgICAgICAgICAgICBzY3JlZW5YOiBlLnNjcmVlblgsDQogICAgICAgICAgICAgICAgICBzY3JlZW5ZOiBlLnNjcmVlblkNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vZGlzY29ubmVjdCBsaXN0ZW5lcnMNCiAgICAgIGZvciAobCBpbiB0aGlzLmxpc3RlbmVycykgew0KICAgICAgICBvd2Zkb2pvLmRpc2Nvbm5lY3QodGhpcy5saXN0ZW5lcnNbbF0pOw0KICAgICAgICB0aGlzLmxpc3RlbmVyc1tsXSA9IG51bGw7DQogICAgICB9DQoNCiAgICAgIC8vc2F2ZSBkcm9wem9uZSBpbmZvDQogICAgICB0aGlzLmRyb3BUYXJnZXQgPSBlLnRhcmdldDsNCg0KICAgICAgLy9zZW5kIG1lc3NhZ2UNCiAgICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnB1Ymxpc2godGhpcy5kcmFnU3RvcEluV2lkZ2V0TmFtZSwgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSk7DQoNCiAgLy8gICAgaWYgKG93ZmRvam8uaXNGdW5jdGlvbih0aGlzLmNhbGxiYWNrc1t0aGlzLmRyYWdTdG9wXSkpIHsNCiAgLy8gICAgICB0aGlzLmNhbGxiYWNrc1t0aGlzLmRyYWdTdG9wXSh0aGlzLmRyb3BUYXJnZXQpOw0KICAvLyAgICB9DQogICAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEBwcml2YXRlDQogICAqLw0KICBkcm9wUmVjZWl2ZURhdGEgOiBmdW5jdGlvbiAoc2VuZGVyLCBtc2csIGNoYW5uZWwpIHsNCg0KICAgIC8vb25seSBpZiB0aGUgbW91c2UgaXMgb3ZlciBhIGRyb3Agem9uZQ0KICAgIGlmICh0aGlzLmRyb3BFbmFibGVkRmxhZykgew0KICAgICAgaWYgKHRoaXMuZHJvcFRhcmdldCkgew0KICAgICAgICBtc2cuZHJvcFRhcmdldCA9IHRoaXMuZHJvcFRhcmdldDsNCg0KICAgICAgICAvL2ZpbmQgaWYgd2UgaGF2ZSBhbnkgZHJvcHpvbmUgaGFuZGxlcnMgZm9yIHRoZSBkcm9wem9uZSB1c2VkIGFuZCBleGVjdXRlDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kcm9wWm9uZUhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgLy9tYXRjaCBlaXRoZXIgb24gaWQgb3IgY2xhc3Mgb3IgaXMgdGFyZ2V0IG5vZGUgYSBjaGlsZCBvZiB0aGUgZHJvcFpvbmUNCiAgICAgICAgICAvL2Fsc28gbWFrZSBzdXJlIHRoZSBkcm9wWm9uZSBpcyBub3QgdGhlIHNhbWUgYXMgdGhlIGRyYWdab25lDQogICAgICAgICAgaWYgKCgodGhpcy5kcm9wVGFyZ2V0LmlkID09IHRoaXMuZHJvcFpvbmVIYW5kbGVyc1tpXS5pZCAmJiB0aGlzLmRyb3BUYXJnZXQuaWQgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgIHx8IChvd2Zkb2pvLmhhc0NsYXNzKHRoaXMuZHJvcFRhcmdldCwgdGhpcy5kcm9wWm9uZUhhbmRsZXJzW2ldLmNsYXNzTmFtZSkpDQogICAgICAgICAgICAgICAgICB8fCAob3dmZG9qby5pc0Rlc2NlbmRhbnQodGhpcy5kcm9wVGFyZ2V0LCB0aGlzLmRyb3Bab25lSGFuZGxlcnNbaV0uZHJvcFpvbmUpKSkNCiAgICAgICAgICAgICAgICAgICYmIHRoaXMuZHJhZ1pvbmUgIT0gdGhpcy5kcm9wWm9uZUhhbmRsZXJzW2ldLmRyb3Bab25lDQogICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgIHRoaXMuZHJvcFpvbmVIYW5kbGVyc1tpXS5oYW5kbGVyKG1zZyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9jbGVhciBkcm9wVGFyZ2V0IGJlY2F1c2UgdGhlIGRyb3AgaXMgb3Zlcg0KICAgICAgICB0aGlzLmRyb3BUYXJnZXQgPSBudWxsOw0KICAgICAgfQ0KDQogICAgICAvL25vdGlmeSB0aGF0IGEgZHJvcCBoYXMgaGFwcGVuZWQgYW5kIHNlbmQgdGhlIGRhdGENCiAgICAgIGlmIChvd2Zkb2pvLmlzRnVuY3Rpb24odGhpcy5jYWxsYmFja3NbdGhpcy5kcm9wUmVjZWl2ZV0pKSB7DQogICAgICAgIHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJvcFJlY2VpdmVdKG1zZyk7DQogICAgICB9DQogICAgfQ0KICB9LA0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gQWRkcyBhIGZ1bmN0aW9uIGFzIGEgY2FsbGJhY2sgdG8gRHJhZyBhbmQgRHJvcCBldmVudHMuICBUaGlzIGZ1bmN0aW9uIHN1cHBvcnRzIG11bHRpcGxlIGNhbGxiYWNrcyBmb3INCiAgICogdGhlIHNhbWUgZXZlbnQgYnkgYWxsb3dpbmcgdGhlIHVzZXIgY2FsbCBpdCBtb3JlIHRoYW4gb25jZSB3aXRoIGRpZmZlcmVudCBjYWxsYmFjayBmdW5jdGlvbnMNCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZSBUaGUgZXZlbnQgbmFtZS4NCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IgVGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgYXMgYSBjYWxsYmFjay4NCiAgICogQHNlZSA8YSBocmVmPSIjZHJhZ1N0YXJ0Ij5kcmFnU3RhcnQgRXZlbnQ8L2E+IC0NCiAgICogdGhlIGNhbGxiYWNrIGZvciB0aGUgZHJhZ1N0YXJ0IGV2ZW50IGlzIGNhbGxlZCB3aXRoIHRoZSBzYW1lIGNvbmZpZyBvYmplY3QgdXNlZCBpbiB0aGUgPGEgaHJlZj0iI2RvU3RhcnREcmFnIj5kb1N0YXJ0RHJhZzwvYT4gZnVuY3Rpb24NCiAgICogd2l0aCB0aGUgZXhjZXB0aW9uIG9mIHRoZSBkcmFnRHJvcERhdGEgYW5kIHRoZSBkcmFnWm9uZSBwcm9wZXJ0aWVzLg0KICAgKiBAc2VlIDxhIGhyZWY9IiNkcmFnU3RvcCI+ZHJhZ1N0b3AgRXZlbnQ8L2E+IC0NCiAgICogSWYgdGhlIGRyYWcgc3RvcHBlZCBpbiB0aGUgc2FtZSB3aWRnZXQgdGhhdCBzdGFydGVkIHRoZSBkcmFnIHRoZSBjYWxsYmFjayBmb3IgZHJhZ1N0b3Agd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgZHJvcFRhcmdldA0KICAgKiBIVE1MIG5vZGUgb3RoZXJ3aXNlIHRoZSBmaXJzdCBhcmd1bWVudCB3aWxsIGJlIG51bGwuDQogICAqIEBzZWUgPGEgaHJlZj0iI2Ryb3BSZWNlaXZlIj5kcm9wUmVjZWl2ZSBFdmVudDwvYT4gLQ0KICAgKiB0aGUgY2FsbGJhY2sgZm9yIHRoZSBkcm9wUmVjZWl2ZSBldmVudCBpcyBjYWxsZWQgZm9yIGFueSBkcm9wIHRoYXQgb2NjdXJzIG9uIGEgd2lkZ2V0LiAgSWYgb25lIGhhcyBtdWx0aXBsZSBkcm9wWm9uZXMNCiAgICogaW4gYSB3aWRnZXQgaXQgaXMgZWFzaWVyIHRvIHVzZSA8YSBocmVmPSIjYWRkRHJvcFpvbmVIYW5kbGVyIj5hZGREcm9wWm9uZUhhbmRsZXI8L2E+DQogICAqIEBleGFtcGxlDQogICAqIC8vZXhhbXBsZSBkcmFnU3RhcnQgaGFuZGxlciB3aGljaCBoaWdobGlnaHRzIGFuIEV4dCBHcmlkIHdoZW4gYSBkcmFnIG9jY3Vycw0KICAgKiB0aGlzLndkZC5hZGRDYWxsYmFjaygnZHJhZ1N0YXJ0JywgKGZ1bmN0aW9uKHNlbmRlciwgbXNnKXsNCiAgICogICAgICAvL2dldCB0aGUgRXh0IEdyaWQNCiAgICogICAgICB2YXIgZ3JpZCA9IHRoaXMuZ2V0Q29tcG9uZW50KHRoaXMuZ3JpZElkKTsNCiAgICoNCiAgICogICAgICAvL2NoZWNrIGN1c3RvbSBkcmFnRHJvcEdyb3VwIHByb3BlcnR5IHRvIHNlZSBpZiB0aGUgZHJhZyBpcyBtZWFudCBmb3IgdGhpcyBncmlkDQogICAqICAgICAgLy9pZiBzbyBoaWdobGlnaHQgdGhlIGdyaWQgYnkgYWRkaW5nIHRoZSBkZE92ZXIgY2xhc3MNCiAgICogICAgICBpZiAoZ3JpZCAmJiBtc2cgIT0gbnVsbCAmJiBtc2cuZHJhZ0Ryb3BHcm91cCA9PSAndXNlcnMnKSB7DQogICAqICAgICAgICAgIGdyaWQuZ2V0VmlldygpLnNjcm9sbGVyLmFkZENsYXNzKCdkZE92ZXInKTsNCiAgICogICAgICB9DQogICAqICB9KS5jcmVhdGVEZWxlZ2F0ZSh0aGlzKSk7ICAvL2NyZWF0ZURlbGVnYXRlIGlzIGFuIEV4dCBmdW5jdGlvbiB3aGljaCBzZXRzIHRoZSBzY29wZQ0KICAgKg0KICAgKiAgLy90aGlzLndkZCBpcyBhIGluaXRpYWxpemVkIFdpZGdldERyYWdBbmREcm9wIG9iamVjdA0KICAgKiAgIHRoaXMud2RkLmFkZENhbGxiYWNrKCdkcm9wUmVjZWl2ZScsb3dmZG9qby5oaXRjaCh0aGlzLGZ1bmN0aW9uKG1zZykgew0KICAgKiAgICAgIC8vbXNnLmRyYWdEcm9wRGF0YSBjb250YWlucyB0aGUgZGF0YQ0KICAgKiAgICAgIC8vdGhpcyBleGFtcGxlIHRoZSBkYXRhIGlzIGEgY2hhbm5lbCBuYW1lIHRoYXQgd2lsbCBiZSBzdWJzY3JpYmVkIHRvDQogICAqICAgICAgdGhpcy5zdWJzY3JpYmVUb0NoYW5uZWwobXNnLmRyYWdEcm9wRGF0YSk7DQogICAqICAgfSkpOw0KICAgKi8NCiAgYWRkQ2FsbGJhY2sgOiBmdW5jdGlvbihldmVudE5hbWUsIGNiKSB7DQoNCiAgICBpZiAodGhpcy5jYWxsYmFja3NbZXZlbnROYW1lXSA9PSBudWxsKSB7DQogICAgICAvL3B1dCBkdW1teSBmdW5jdGlvbiBpbg0KICAgICAgdGhpcy5jYWxsYmFja3NbZXZlbnROYW1lXSA9IGNiOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIC8vY2FsbGJhY2sgYWxyZWFkeSBleGlzdHMgY2hhaW4gdGhlIHN1YnNlcXVlbnQgY2FsbGJhY2tzIHRvIHRoZSBmaXJzdA0KICAgICAgb3dmZG9qby5jb25uZWN0KHRoaXMuY2FsbGJhY2tzLGV2ZW50TmFtZSxjYik7DQogICAgfQ0KICB9LA0KICAvKioNCiAgICogQGRlc2NyaXB0aW9uIEFkZHMgYSBuZXcgZHJvcCB6b25lIHRvIGJlIG1hbmFnZWQuICBUaGUgaGFuZGxlciBmdW5jdGlvbiBkZWZpbmVkIGluIHRoZSBjZmcgb2JqZWN0IHdpbGwgYmUgY2FsbGVkIHdoZW4NCiAgICogYSBkcm9wIG9jY3VycyBvdmVyIGEgZG9tIG5vZGUgd2hpY2ggbWF0Y2hlcyB0aGUgaWQgb3IgdGhlIGNsYXNzTmFtZSBvciBpcyBlcXVhbCB0byBvciBhIGNoaWxkIG9mIHRoZSBkcm9wVGFyZ2V0IG5vZGUNCiAgICogQHNlZSBkb1N0YXJ0RHJhZw0KICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93DQogICAqIEBwYXJhbSB7Y2xhc3NOYW1lfSBjZmcuY2xhc3MgY2xhc3Mgb2YgdGhlIGRyb3Bab25lDQogICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaWQgSWQgb2YgdGhlIGRyb3Bab25lDQogICAqIEBwYXJhbSB7Tm9kZX0gY2ZnLmRyb3Bab25lIEhUTUwgbm9kZSB3aGljaCByZXByZXNlbnRzIHRoZSBkcm9wWm9uZQ0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaGFuZGxlciBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiBhIGRyb3Agb2NjdXJzIG92ZXIgdGhlIGRyb3Bab25lLiAgQSBtc2cgb2JqZWN0IHdpbGwgYmUgcGFzc2VkIGluDQogICAqDQogICAqIEBleGFtcGxlDQogICAqIC8vRXhhbXBsZSBjZmcgT2JqZWN0DQogICAqIHsNCiAgICogIGlkOiAnbXlncmlkLTEnLA0KICAgKiAgY2xhc3NOYW1lOiAnbXlncmlkQ2xhc3MnLA0KICAgKiAgZHJvcFpvbmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wWm9uZScpLA0KICAgKiAgaGFuZGxlcjogZnVuY3Rpb24obXNnKSB7DQogICAqICAgIC8vc29tZSBjb2RlIGhlcmUgdG8gaGFuZGxlIHRoZSBtc2cgYW5kIHJlc3BvbmQNCiAgICogIH0NCiAgICogfQ0KICAgKg0KICAgKiAvL0V4YW1wbGUgdXNhZ2Ugb2YgYWRkRHJvcFpvbmVIYW5kbGVyIHdoaWNoIGhhbmRsZXMgYSBkcm9wIHRoYXQgb2NjdXJzIG92ZXIgYW4gRXh0IEdyaWQgYW5kIGluc2VydHMgbmV3IGRhdGEgaW50bw0KICAgKiAvL3RoYXQgZ3JpZCBiYXNlZCBvbiB0aGUgZHJhZ2dlZCBkYXRhDQogICAqIC8vdGhpcy53ZGQgaXMgdGhlIFdpZGdldERyYWdBbmREcm9wIE9iamVjdA0KICAgKiB0aGlzLndkZC5hZGREcm9wWm9uZUhhbmRsZXIoew0KICAgKiAgIC8vZG9tIG5vZGUgb2YgYW4gRXh0IGdyaWQNCiAgICogICBkcm9wWm9uZTpncmlkLmdldFZpZXcoKS5zY3JvbGxlci5kb20sDQogICAqDQogICAqICAgLy90aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbmx5IHdoZW4gYSBkcm9wIG9jY3VycyBvdmVyIHRoZSBncmlkIChpLmUuIHRoZSBtb3VzZSB3YXMgcmVsZWFzZWQgb3ZlciB0aGUgZ3JpZCkNCiAgICogICBoYW5kbGVyOiAoZnVuY3Rpb24obXNnKXsNCiAgICoNCiAgICogICAgIHZhciBzdG9yZSA9IGdyaWQuZ2V0U3RvcmUoKTsNCiAgICogICAgIHZhciBwcm9jZXNzZWRTZWxlY3Rpb25zID0gW107DQogICAqICAgICB2YXIgZXJyb3JNc2cgPSBudWxsOw0KICAgKg0KICAgKiAgICAgLy9sb29wIHRocm91Z2ggbXNnLmRyYWdEcm9wRGF0YSB3aGljaCBpcyBhbiBhcnJheSBhbmQgY2hlY2sgZm9yIGR1cGVzIHZlcnN1cyB0aGUgZGVzdGluYXRpb24gc3RvcmUNCiAgICogICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXNnLmRyYWdEcm9wRGF0YS5sZW5ndGg7IGkrKykgew0KICAgKiAgICAgICAvL2dldCBkYXRhIGZvciBvbmUgcG9zc2libGUgbmV3IHJlY29yZCBpbiB0aGUgZHJhZ0Ryb3BEYXRhDQogICAqICAgICAgIHZhciByZWNEYXRhID0gbXNnLmRyYWdEcm9wRGF0YVtpXTsNCiAgICoNCiAgICogICAgICAgLy9pcyBpdCBhbHJlYWR5IGluIHRoZSBkZXN0IEV4dCBTdG9yZT8NCiAgICogICAgICAgaWYgKHN0b3JlLmZpbmRFeGFjdCgnaWQnLHJlY0RhdGEuaWQpID49IDApIHsNCiAgICogICAgICAgICAvL2ZvdW5kIHRoZSByZWNvcmQgYWxyZWFkeSBpbiB0aGUgc3RvcmUNCiAgICogICAgICAgfQ0KICAgKiAgICAgICBlbHNlIHsNCiAgICogICAgICAgICAvL2FkZCBuZXcgcmVjb3JkIGJhc2VkIG9uIHRoZSBkcmFnRHJvcERhdGENCiAgICogICAgICAgICB2YXIgbmV3UmVjID0gbmV3IHN0b3JlLnJlY29yZFR5cGUocmVjRGF0YSk7DQogICAqICAgICAgICAgLy9jYWxsaW5nIGFuIGV4dGVybmFsIGZ1bmN0aW9uIHRvIGRlY2lkZSB3aGV0aGVyIHRvIGFkZCB0aGUgbmV3IHJlYw0KICAgKiAgICAgICAgIHZhciBycyA9IGRpc3BsYXlQYW5lbC52YWxpZGF0ZVJlY29yZE9uQWRkKG5ld1JlYyk7DQogICAqICAgICAgICAgaWYgKHJzLnN1Y2Nlc3MpIHsNCiAgICogICAgICAgICAgIHByb2Nlc3NlZFNlbGVjdGlvbnMucHVzaChuZXdSZWMpOw0KICAgKiAgICAgICAgIH0NCiAgICogICAgICAgICBlbHNlIHsNCiAgICogICAgICAgICAgIGVycm9yTXNnID0gcnMubXNnOw0KICAgKiAgICAgICAgIH0NCiAgICogICAgICAgfQ0KICAgKiAgICAgfQ0KICAgKg0KICAgKiAgICAgaWYgKGVycm9yTXNnKSB7DQogICAqICAgICAgIEV4dC5Nc2cuYWxlcnQoJ0Vycm9yJywgZXJyb3JNc2cpOw0KICAgKiAgICAgfQ0KICAgKg0KICAgKiAgICAgLy9hY3R1YWxseSBpbnNlcnQgaW50byB0aGUgc3RvcmUgd2hpY2ggYWRkcyBpdCB0aGUgbmV3IHJlY3MgdG8gdGhlIGdyaWQNCiAgICogICAgIGlmIChwcm9jZXNzZWRTZWxlY3Rpb25zLmxlbmd0aCA+IDApIHsNCiAgICogICAgICAgc3RvcmUuaW5zZXJ0KDAsIHByb2Nlc3NlZFNlbGVjdGlvbnMpOw0KICAgKiAgICAgfQ0KICAgKg0KICAgKiB9KS5jcmVhdGVEZWxlZ2F0ZShncmlkKX0pOyAgIC8vY3JlYXRlRGVsZWdhdGUgaXMgYW4gRXh0IGZ1bmN0aW9uIHdoaWNoIHNldHMgdGhlIHNjb3BlIG9mIHRoZSBjYWxsYmFjaw0KICAgKg0KICAgKg0KICAgKi8NCiAgYWRkRHJvcFpvbmVIYW5kbGVyOiBmdW5jdGlvbihjZmcpIHsNCiAgICB0aGlzLmRyb3Bab25lSGFuZGxlcnMucHVzaChjZmcpDQogIH0sDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gcmV0dXJucyB3aGV0aGVyIHRoZSBhIGRyb3AgaXMgZW5hYmxlZCAodGhpcyBpcyBvbmx5IHRydWUgd2hlbiB0aGUgbW91c2UgaXMgb3ZlciBhIGRyb3Agem9uZSkNCiAgICovDQogIGdldERyb3BFbmFibGVkIDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuZHJvcEVuYWJsZWRGbGFnOw0KICB9LA0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gcmV0dXJucyB3aGV0aGVyIGEgZHJhZyBpcyBpbiBwcm9ncmVzcw0KICAgKi8NCiAgaXNEcmFnZ2luZyA6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLmRyYWdnaW5nOw0KICB9LA0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gcmV0dXJucyBkYXRhIHNlbnQgd2hlbiBhIGRyYWcgd2FzIHN0YXJ0ZWQNCiAgICovDQogIGdldERyYWdTdGFydERhdGEgOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gb3dmZG9qby5taXhpbih0aGlzLmRyYWdTdGFydERhdGEse2RyYWdab25lOnRoaXMuZHJhZ1pvbmV9KTsNCiAgfSwNCg0KICAvKioNCiAgICogQGRlc2NyaXB0aW9uIHRvZ2dsZXMgdGhlIGRyYWdJbmRpY2F0b3IgdG8gaW5kaWNhdGUgc3VjY2Vzc2Z1bCBvciB1bnN1Y2Nlc3NmdWwgZHJvcA0KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRyb3BFbmFibGVkIHRydWUgdG8gZW5hYmxlIGEgZHJvcCwgZmFsc2UgdG8gaW5kaWNhdGUgYSB1bnN1Y2Nlc3NmdWwgZHJvcA0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAgLy9hdHRhY2ggbW91c2VvdmVyIGNhbGxiYWNrIHRvIGEgcGFydGljdWxhciBhcmVhLiBJZiB0aGUgbW91c2UgaXMgaGVyZSBhbGxvdyBhIGRyb3ANCiAgICogIGNtcC5nZXRWaWV3KCkuc2Nyb2xsZXIub24oJ21vdXNlb3ZlcicsZnVuY3Rpb24oZSx0LG8pIHsNCiAgICogICAgaWYgKGNtcC5kcmFnZ2luZykgew0KICAgKiAgICAgIHRoaXMud2RkLnNldERyb3BFbmFibGVkKHRydWUpOw0KICAgKiAgICB9DQogICAqICB9LHRoaXMpOw0KICAgKg0KICAgKiAgLy9hdHRhY2ggYSBtb3VzZSBvdXQgY2FsbGJhY2sgdG8gYSBwYXJ0aWN1bGFyIGFyZWEuIElmIHRoZSBtb3VzZSBsZWF2ZXMgZGlzYWJsZSBkcm9wDQogICAqICBjbXAuZ2V0VmlldygpLnNjcm9sbGVyLm9uKCdtb3VzZW91dCcsZnVuY3Rpb24oZSx0LG8pIHsNCiAgICogICAgaWYgKGNtcC5kcmFnZ2luZykgew0KICAgKiAgICAgIHRoaXMud2RkLnNldERyb3BFbmFibGVkKGZhbHNlKTsNCiAgICogICAgfQ0KICAgKiAgfSx0aGlzKTsNCiAgICovDQogIHNldERyb3BFbmFibGVkIDogZnVuY3Rpb24oZHJvcEVuYWJsZWQpIHsNCiAgICBpZiAoZHJvcEVuYWJsZWQpIHsNCiAgICAgIHRoaXMuZHJvcEVuYWJsZWRGbGFnID0gdHJ1ZTsNCiAgICAgIG93ZmRvam8ucmVtb3ZlQ2xhc3ModGhpcy5kcmFnSW5kaWNhdG9yLCAnZGRCb3hDYW5ub3REcm9wJyk7DQogICAgICBvd2Zkb2pvLmFkZENsYXNzKHRoaXMuZHJhZ0luZGljYXRvciwgJ2RkQm94Q2FuRHJvcCcpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIHRoaXMuZHJvcEVuYWJsZWRGbGFnID0gZmFsc2U7DQogICAgICBvd2Zkb2pvLnJlbW92ZUNsYXNzKHRoaXMuZHJhZ0luZGljYXRvciwgJ2RkQm94Q2FuRHJvcCcpOw0KICAgICAgb3dmZG9qby5hZGRDbGFzcyh0aGlzLmRyYWdJbmRpY2F0b3IsICdkZEJveENhbm5vdERyb3AnKTsNCiAgICB9DQogIH0sDQoNCiAgc2V0Rmxhc2hXaWRnZXRJZDogZnVuY3Rpb24oaWQpIHsNCiAgICB0aGlzLmZsYXNoV2lkZ2V0SWQgPSBpZDsNCiAgfSwNCg0KICBnZXRGbGFzaFdpZGdldElkOiBmdW5jdGlvbihpZCkgew0KICAgIHJldHVybiB0aGlzLmZsYXNoV2lkZ2V0SWQ7DQogIH0NCn07DQoNCi8qKg0KICogQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcCBTaW5nbGV0b24gaW5zdGFuY2UuIE1hbmFnZXMgdGhlIGRyYWcgYW5kIGRyb3AgZm9yIGFuIGluZGl2aWR1YWwgd2lkZ2V0Lg0KICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICogQHBhcmFtIHtPYmplY3R9IFtjZmcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyXSAgVGhlIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLmF1dG9Jbml0XSAgVHJ1ZSB0byBhdXRvbWF0aWNhbGx5IGNhbGwgaW5pdCgpLCBGYWxzZSBvdGhlcndpc2UuICBUaGUgZGVmYXVsdCBpcyBUcnVlIGlmIGxlZnQgdW5kZWZpbmVkDQogKiBAcGFyYW0ge09iamVjdH0gW2NmZy5jYWxsYmFja3NdICBPYmplY3Qgd2l0aCBjYWxsYmFja3Mgd2hvJ3MgbmFtZXMgbWF0Y2ggZHJhZyBhbmQgZHJvcCBldmVudHMuICBBbHRlcm5hdGl2ZWx5IG9uZSBjb3VsZA0KICogdXNlIHRoZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPiBmdW5jdGlvbg0KICogQHJlcXVpcmVzIG93ZmRvam8gd2hpY2ggaXMgYSBjdXN0b20gdmVyc2lvbiBvZiBkb2pvIGZvciBPV0YNCiAqIEByZXF1aXJlcyA8YSBocmVmPSJPem9uZS5ldmVudGluZy5XaWRnZXQuaHRtbCI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0PC9hPiBmb3IgZXZlbnRpbmcNCiAqIEBzZWUgPGEgaHJlZj0iI2FkZENhbGxiYWNrIj5hZGRDYWxsYmFjazwvYT4NCiAqIEBleGFtcGxlDQogKg0KICogdmFyIHdkZCA9IE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wLmdldEluc3RhbmNlKHsNCiAqICAgICAgICAgICAgICAgICAgIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcjogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqICAgICAgICAgICAgICAgfSk7DQogKg0KICovDQpPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGNmZykgew0KICBpZiAoT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgIE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wLmluc3RhbmNlID0gbmV3IE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wKGNmZyk7DQogIH0NCiAgcmV0dXJuIG93ZmRvam8ubWl4aW4oT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuaW5zdGFuY2UsIGNmZyk7DQp9Ow0KDQoKLyoqDQogKiBAbmFtZXNwYWNlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLmxhdW5jaGVyID0gT3pvbmUubGF1bmNoZXIgPyBPem9uZS5sYXVuY2hlciA6IHt9Ow0KDQooZnVuY3Rpb24oKSB7DQoNCiAgICB2YXIgbGF1bmNoQ2hhbm5lbE5hbWUgPSAiX1dJREdFVF9MQVVOQ0hFUl9DSEFOTkVMIjsNCg0KICAgIC8qKg0KICAgICAqICBAZGVwcmVjYXRlZCBTaW5jZSBPV0YgMy43LjAgIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmdldEluc3RhbmNlPC9hPg0KICAgICAqICBAY29uc3RydWN0b3IgIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciAtIE96b25lLmV2ZW50aW5nLldpZGdldCBvYmplY3QNCiAgICAgKiAgQHBhcmFtICB7T3pvbmUuZXZlbnRpbmcuV2lkZ2V0fSBbd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyXSAtIHdpZGdldCBldmVudGluZyBvYmplY3Qgd2hpY2ggaGFuZGxlcyBldmVudGluZyBmb3IgdGhlIHdpZGdldA0KICAgICAqICBAZGVzY3JpcHRpb24gVGhpcyBvYmplY3QgaXMgdXNlZCBsYXVuY2ggb3RoZXIgd2lkZ2V0cy4gIFRvIGRvIHNvIGl0IHJlcXVpcmVzIGEgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogICAgICoNCiAgICAgKi8NCiAgICBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAoT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi53aWRnZXRMYXVuY2hlcg0KDQogICAgICAgICAgICBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZSA9IHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuaW5zdGFuY2U7DQogICAgfTsNCg0KICAgIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLnByb3RvdHlwZSA9IHsNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gbGF1bmNoZXMgYSBXaWRnZXQgYmFzZWQgb24gdGhlIGNvbmZpZw0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBvYmplY3Qgc2VlIGV4YW1wbGUgZm9yIHN0cnVjdHVyZQ0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgbGF1bmNoV2lkZ2V0IGlzIGV4ZWN1dGVkDQogICAgICAgKg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqDQogICAgICAgKiAvL0V4YW1wbGUgZm9yIGxhdW5jaGluZyBhIHdpZGdldA0KICAgICAgICogdmFyIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IE96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZSgpOw0KICAgICAgICogdmFyIHdpZGdldExhdW5jaGVyID0gT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuZ2V0SW5zdGFuY2UodGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpOw0KICAgICAgICogdmFyIGRhdGEgPSB7DQogICAgICAgKiAgIGNoYW5uZWw6IGNoYW5uZWwsDQogICAgICAgKiAgIG1lc3NhZ2U6IG1lc3NhZ2UNCiAgICAgICAqIH07DQogICAgICAgKiB2YXIgZGF0YVN0cmluZyA9IE96b25lLnV0aWwudG9TdHJpbmcoZGF0YSk7DQogICAgICAgKiB3aWRnZXRMYXVuY2hlci5sYXVuY2hXaWRnZXQoew0KICAgICAgICogICAgIHVuaXZlcnNhbE5hbWU6ICd1bml2ZXJzYWwgbmFtZSBvZiB3aWRnZXQgdG8gbGF1bmNoJywgIC8vdW5pdmVyc2FsTmFtZSBvciBndWlkIG1heWJlIGlkZW50aWZ5IHRoZSB3aWRnZXQgdG8gYmUgbGF1bmNoZWQNCiAgICAgICAqICAgICBndWlkOiAnZ3VpZCBvZiB3aWRnZXQgdG8gbGF1bmNoJywNCiAgICAgICAqICAgICB0aXRsZTogJ3RpdGxlIHRvIHJlcGxhY2UgdGhlIHdpZGdldHMgdGl0bGUnIHRoZSB0aXRsZSB3aWxsIG9ubHkgYmUgY2hhbmdlZCBpZiB0aGUgd2lkZ2V0IGlzIG9wZW5lZC4NCiAgICAgICAqICAgICB0aXRsZVJlZ2V4OiBvcHRpb25hbCByZWdleCB1c2VkIHRvIHJlcGxhY2UgdGhlIHByZXZpb3VzIHRpdGxlIHdpdGggdGhlIG5ldyB2YWx1ZSBvZiB0aXRsZQ0KICAgICAgICogICAgIGxhdW5jaE9ubHlJZkNsb3NlZDogdHJ1ZSwgLy9pZiB0cnVlIHdpbGwgb25seSBsYXVuY2ggdGhlIHdpZGdldCBpZiBpdCBpcyBub3QgYWxyZWFkeSBvcGVuZWQuDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGl0IGlzIG9wZW5lZCB0aGVuIHRoZSB3aWRnZXQgd2lsbCBiZSByZXN0b3JlZA0KICAgICAgICogICAgIGRhdGE6IGRhdGFTdHJpbmcgIC8vaW5pdGlhbCBsYXVuY2ggY29uZmlnIGRhdGEgdG8gYmUgcGFzc2VkIHRvIGEgd2lkZ2V0IG9ubHkgaWYgdGhlIHdpZGdldCBpcyBvcGVuZWQuICB0aGlzIG11c3QgYmUgYSBzdHJpbmcNCiAgICAgICAqIH0pOw0KICAgICAgICoNCiAgICAgICAqLw0KICAgICAgICBsYXVuY2hXaWRnZXQ6IGZ1bmN0aW9uKGNvbmZpZyxjYWxsYmFjaykgew0KICAgICAgICAgICAgLy9zZW5kIG1lc3NhZ2UgdG8gbGF1bmNoIGEgd2lkZ2V0DQoNCiAgICAgICAgICAgIGlmIChjb25maWcudGl0bGVSZWdleCAhPSBudWxsICYmIGNvbmZpZy50aXRsZVJlZ2V4IGluc3RhbmNlb2YgUmVnRXhwKSB7DQogICAgICAgICAgICAgICAgY29uZmlnLnRpdGxlUmVnZXggPSBjb25maWcudGl0bGVSZWdleC50b1N0cmluZygpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoY29uZmlnKTsNCiAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgbGF1bmNoQ2hhbm5lbE5hbWUsIGNhbGxiYWNrLCBPV0YuZ2V0SWZyYW1lSWQoKSwganNvblN0cmluZyk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIEBjb25zdHJ1Y3RvciBub25lDQogICAgICogIEBkZXNjcmlwdGlvbiBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgYSB3aWRnZXQgdGhhdCBoYXMgYmVlbiBsYXVuY2hlZA0KICAgICAqDQogICAgICovDQogICAgT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXJVdGlscyA9IHsNCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIGdldHMgaW5pdGlhbCBsYXVuY2ggY29uZmlnIGRhdGEgZm9yIHRoaXMgd2lkZ2V0IGlmIGl0IHdhcyBqdXN0IGxhdW5jaGVkDQogICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBkYXRhIG9iamVjdCB3aGljaCBjb250YWlucyBpbml0aWFsIGluZm9ybWF0aW9uIGZvciB0aGUgd2lkZ2V0IA0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqDQogICAgICAgKiB2YXIgbGF1bmNoQ29uZmlnID0gT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXJVdGlscy5nZXRMYXVuY2hDb25maWdEYXRhKCk7DQogICAgICAgKiBpZiAobGF1bmNoQ29uZmlnICE9IG51bGwpIHsNCiAgICAgICAqICAgdmFyIGRhdGEgPSBPem9uZS51dGlsLnBhcnNlSnNvbihsYXVuY2hDb25maWcpOyAgLy9pbiB0aGlzIGV4YW1wbGUgdGhlIGRhdGEgb2JqZWN0IGhhcyB0d28gZmllbGRzOiBjaGFubmVsIGFuZCBtZXNzYWdlDQogICAgICAgKiAgIGlmIChkYXRhICE9IG51bGwpIHsNCiAgICAgICAqICAgICAgIC8vZG8gc29tZXRoaW5nIHdpdGggdGhlIGRhdGENCiAgICAgICAqICAgICAgIHNjb3BlLnN1YnNjcmliZVRvQ2hhbm5lbChkYXRhLmNoYW5uZWwpOw0KICAgICAgICogICAgICAgc2NvcGUuYWRkVG9HcmlkKG51bGwsZGF0YS5tZXNzYWdlLGRhdGEuY2hhbm5lbCk7DQogICAgICAgKiAgIH0NCiAgICAgICAqIH0NCiAgICAgICAqDQogICAgICAgKi8NCiAgICAgICAgZ2V0TGF1bmNoQ29uZmlnRGF0YTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgbGF1bmNoQ29uZmlnID0gbnVsbDsNCg0KICAgICAgICAgICAgLy9jaGVjayBmb3IgZGF0YSBpbiB3aW5kb3cubmFtZQ0KICAgICAgICAgICAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOw0KICAgICAgICAgICAgaWYgKGNvbmZpZ1BhcmFtcyAhPSBudWxsKSB7DQoNCiAgICAgICAgICAgICAgICAvL2dldCBsYXVuY2hDb25maWcNCiAgICAgICAgICAgICAgICBsYXVuY2hDb25maWcgPSBjb25maWdQYXJhbXMuZGF0YTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGxhdW5jaENvbmZpZzsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5ldmVudGluZy5XaWRnZXQgU2luZ2xldG9uIGluc3RhbmNlLiBUaGlzIG9iamVjdCBpcyB1c2VkIGxhdW5jaCBvdGhlciB3aWRnZXRzLg0KICAgICAqICBAZXhhbXBsZQ0KICAgICAqICB0aGlzLndpZGdldExhdW5jaGVyID0gT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuZ2V0SW5zdGFuY2UodGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpOw0KICAgICAqLw0KICAgIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmdldEluc3RhbmNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGlmIChPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgICAgICAgICBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZSA9IG5ldyBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlcigpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZTsNCiAgICB9Ow0KDQp9KCkpOw0KCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307DQoNCi8qKg0KICogQGlnbm9yZQ0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5zdGF0ZSA9IE96b25lLnN0YXRlID8gT3pvbmUuc3RhdGUgOiB7fTsNCg0KLyoqDQogKiAgQGRlcHJlY2F0ZWQgU2luY2UgT1dGIDMuNy4wICBZb3Ugc2hvdWxkIHVzZSA8YSBocmVmPSIjLmdldEluc3RhbmNlIj5Pem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuZ2V0SW5zdGFuY2U8L2E+DQogKiAgQGNvbnN0cnVjdG9yICBXaWRnZXRTdGF0ZUhhbmRsZXIgLSBIYW5kbGVzIGV2ZW50aW5nIGZyb20gT1dGIHdpZGdldCB0byBPV0YgY29udGFpbmVyDQogKiAgQHBhcmFtICB7T3pvbmUuZXZlbnRpbmcuV2lkZ2V0fSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgLSB3aWRnZXQgZXZlbnRpbmcgb2JqZWN0IHdoaWNoIGhhbmRsZXMgZXZlbnRpbmcgZm9yIHRoZSB3aWRnZXQNCiAqICBAZGVzY3JpcHRpb24gVGhpcyBvYmplY3QgaXMgdXNlZCBoYW5kbGUgd2lkZ2V0IHJlcXVlc3RzLiAgVG8gZG8gc28gaXQgcmVxdWlyZXMgYSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqDQogKi8NCk96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlciA9IGZ1bmN0aW9uKHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcikgew0KICBpZiAoT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmluc3RhbmNlID09IG51bGwpIHsNCiAgICB0aGlzLnN0YXRlQ2hhbm5lbE5hbWUgPSAiX1dJREdFVF9TVEFURV9DSEFOTkVMXyI7DQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgfHwgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlOw0KICAgIHRoaXMud2lkZ2V0SWRKU09OID0gT3pvbmUudXRpbC5wYXJzZUpzb24odGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSk7DQogICAgdGhpcy52ZXJzaW9uID0gT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi53aWRnZXRTdGF0ZUhhbmRsZXINCg0KICAgIE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5pbnN0YW5jZSA9IHRoaXM7DQogIH0NCg0KICByZXR1cm4gT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmluc3RhbmNlOw0KfTsNCg0KT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLnByb3RvdHlwZSA9IHsNCg0KICAvKioNCiAgICogQGRlc2NyaXB0aW9uIGhhbmRsZXMgYSB3aWRnZXQgc3RhdGUgcmVxdWVzdCBiYXNlZCBvbiB0aGUgY29uZmlnDQogICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgb2JqZWN0IHNlZSBleGFtcGxlIGZvciBzdHJ1Y3R1cmUNCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgc3RhdGVXaWRnZXQgaXMgZXhlY3V0ZWQNCiAgICoNCiAgICogQGV4YW1wbGUNCiAgICoNCiAgICogLy9FeGFtcGxlIGZvciBjbG9zaW5nIGEgd2lkZ2V0DQogICAqIHZhciB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBuZXcgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0KE96b25lLnV0aWwuY29udGV4dFBhdGgoKSArICcvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJyk7DQogICAqIHZhciB3aWRnZXRTdGF0ZUhhbmRsZXIgPSBuZXcgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyKHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyKTsNCiAgICogd2lkZ2V0U3RhdGVIYW5kbGVyLmhhbmRsZVN0YXRlUmVxdWVzdCh7DQogICAqICAgICBmbjogJ2Nsb3NlV2lkZ2V0JywNCiAgICogICAgIHBhcmFtczogew0KICAgKiAgICAgCWd1aWQ6IDx3aWRnZXRHdWlkPg0KICAgKiAgICAgfQ0KICAgKiB9KTsNCiAgICoNCiAgICovDQoJaGFuZGxlV2lkZ2V0UmVxdWVzdDogZnVuY3Rpb24oY29uZmlnLCBjYWxsYmFjaykgew0KDQoJCS8vc2VuZCBzdGF0ZSByZXF1ZXN0IHRvIGEgd2lkZ2V0DQoJCXZhciBzdGF0ZUNoYW5uZWwgPSB0aGlzLnN0YXRlQ2hhbm5lbE5hbWUgKyB0aGlzLndpZGdldElkSlNPTi5pZDsNCgkgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzdGF0ZUNoYW5uZWwsIGNhbGxiYWNrLCB0aGlzLndpZGdldElkSlNPTiwgY29uZmlnKTsJDQoJfQ0KfTsNCg0KLyoqDQogKiAgQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5ldmVudGluZy5XaWRnZXQgU2luZ2xldG9uIGluc3RhbmNlLg0KICogICAgVGhpcyBvYmplY3QgaXMgdXNlZCBoYW5kbGUgd2lkZ2V0IHJlcXVlc3RzLiAgVG8gZG8gc28gaXQgcmVxdWlyZXMgYSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqICBAcGFyYW0gIHtPem9uZS5ldmVudGluZy5XaWRnZXR9IHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciAtIHdpZGdldCBldmVudGluZyBvYmplY3Qgd2hpY2ggaGFuZGxlcyBldmVudGluZyBmb3IgdGhlIHdpZGdldA0KICogIEBleGFtcGxlDQogKiAgdGhpcy53aWRnZXRTdGF0ZUhhbmRsZXIgPSBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuZ2V0SW5zdGFuY2UodGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpOw0KICovDQpPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbih3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpIHsNCiAgaWYgKE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmluc3RhbmNlID0gbmV3IE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlcih3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpOw0KICB9DQogIHJldHVybiBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuaW5zdGFuY2U7DQp9Ow0KCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307DQoNCi8qKg0KICogQGlnbm9yZQ0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5zdGF0ZSA9IE96b25lLnN0YXRlID8gT3pvbmUuc3RhdGUgOiB7fTsNCg0KLyoqDQogKiBAZGVwcmVjYXRlZCBTaW5jZSBPV0YgMy43LjAgIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLnN0YXRlLldpZGdldFN0YXRlLmdldEluc3RhbmNlPC9hPg0KDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICogQHBhcmFtIHtTdHJpbmd9IFtjZmcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyXSAgVGhlIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLmF1dG9Jbml0XSBXaGV0aGVyIG9yIG5vdCB0byBhdXRvbWF0aWNhbGx5IHN0YXJ0IGxpc3RlbmluZyB0byB0aGUgc3RhdGUgY2hhbm5lbC4gIERlZmF1bHQgaXMgdHJ1ZS4NCiAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLndpZGdldEd1aWRdICBUaGUgZ3VpZCBvZiB0aGUgd2lkZ2V0IHRvIG1vbml0b3IuIERlZmF1bHQgaXMgaXRzZWxmLg0KICogQHBhcmFtIHtTdHJpbmd9IFtjZmcub25TdGF0ZUV2ZW50UmVjZWl2ZWRdICBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBhbiBldmVudCBpcyByZWNlaXZlZC4NCiAqIEBkZXNjcmlwdGlvbiBUaGUgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUgb2JqZWN0IG1hbmFnZXMgdGhlIHR3by13YXkgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIGFuIE9XRiB3aWRnZXQgYW5kIGl0cyBPV0YgQ29udGFpbmVyLg0KICogQHJlcXVpcmVzIDxhIGhyZWY9Ik96b25lLmV2ZW50aW5nLldpZGdldC5odG1sIj5Pem9uZS5ldmVudGluZy5XaWRnZXQ8L2E+IGZvciBldmVudGluZw0KICogQGV4YW1wbGUNCiAqDQogKiB2YXIgd2lkZ2V0U3RhdGUgPSBuZXcgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUoew0KICogICAgIG9uU3RhdGVFdmVudFJlY2VpdmVkOiBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KICogICAgIAkJLy8gZG8gc29tZXRoaW5nDQogKiAgICAgfQ0KICogfSk7DQogKg0KICovDQpPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZSA9IGZ1bmN0aW9uKGNmZykgew0KDQogIGlmIChPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5pbnN0YW5jZSA9PSBudWxsKSB7DQoNCgl2YXIgU1RBVEVfRVZFTlRfQ0hBTk5FTF9OQU1FX3ByZWZpeCA9ICJfV0lER0VUX1NUQVRFX0NIQU5ORUxfIjsNCg0KICAgIGNmZyA9IGNmZyB8fCB7fTsNCg0KCS8vIGluaXRpYWxpemUgdGhlIHN0YXRlIGhhbmRsaW5nDQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBjZmcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIHx8IE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZTsNCgl0aGlzLndpZGdldFN0YXRlSGFuZGxlciA9IE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5nZXRJbnN0YW5jZSh0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcik7DQoJdGhpcy53aWRnZXRJZEpTT04gPSBPem9uZS51dGlsLnBhcnNlSnNvbih0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpKTsNCgl0aGlzLndpZGdldEd1aWQgPSBjZmcud2lkZ2V0R3VpZCA/IGNmZy53aWRnZXRHdWlkIDogdGhpcy53aWRnZXRJZEpTT04uaWQ7DQogICAgdGhpcy5zdGF0ZUNoYW5uZWwgPSBTVEFURV9FVkVOVF9DSEFOTkVMX05BTUVfcHJlZml4ICsgdGhpcy53aWRnZXRHdWlkOw0KCXRoaXMub25TdGF0ZUV2ZW50UmVjZWl2ZWQgPSBjZmcub25TdGF0ZUV2ZW50UmVjZWl2ZWQgPyBjZmcub25TdGF0ZUV2ZW50UmVjZWl2ZWQgOiB0aGlzLm9uU3RhdGVFdmVudFJlY2VpdmVkOw0KCQ0KCWlmIChjZmcuYXV0b0luaXQgIT09IGZhbHNlKSB7DQoJCXRoaXMuaW5pdCgpOw0KCX0NCg0KICAgICBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5pbnN0YW5jZSA9IHRoaXM7DQogIH0NCg0KICByZXR1cm4gT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUuaW5zdGFuY2U7DQp9Ow0KDQpPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5wcm90b3R5cGUgPSB7DQoJLyoqDQoJICogQGZpZWxkDQoJICogQGRlc2NyaXB0aW9uIHZlcnNpb24gbnVtYmVyDQoJICovDQoJdmVyc2lvbjogT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi5zdGF0ZSwNCg0KCS8qKg0KICAgICAqIEBkZXNjcmlwdGlvbiBJbml0aWFsaXplcyB0aGUgV2lkZ2V0U3RhdGUgb2JqZWN0LiAgVXNpbmcgdGhpcyBmdW5jdGlvbiBpcyBvbmx5IHJlcXVpcmVkIGlmIGF1dG9Jbml0IGNvbmZpZyBpcyBmYWxzZQ0KICAgICAqIGluIHRoZSBjb25zdHJ1Y3Rvci4gIFRoaXMgZnVuY3Rpb24gaXMgc29tZXRpbWVzIHVzZWZ1bCB3aGVuIGl0IGlzIG5lY2Vzc2FyeSB0byBkZWZlciBldmVudCBoYW5kbGluZyBhZnRlcg0KICAgICAqIGNyZWF0aW5nIHRoZSBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZSBvYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gY29uZmlnIG9iamVjdA0KICAgICAqIEBzZWUgPGEgaHJlZj0iI2NvbnN0cnVjdG9yIj5jb25zdHJ1Y3RvcjwvYT4NCiAgICAgKi8NCglpbml0IDogZnVuY3Rpb24gKCkgew0KCQl0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUodGhpcy5zdGF0ZUNoYW5uZWwsIHRoaXMub25TdGF0ZUV2ZW50UmVjZWl2ZWQpOw0KLy8JCXRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnJlZ2lzdGVySGFuZGxlcih0aGlzLnN0YXRlQ2hhbm5lbCwgdGhpcy5vblN0YXRlRXZlbnRSZWNlaXZlZCk7DQoJfSwNCgkNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gVGhlIGRlZmF1bHQgY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBhbiBldmVudCBpcyByZWNlaXZlZC4gDQoJICovDQoJb25TdGF0ZUV2ZW50UmVjZWl2ZWQ6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHRydWU7DQoJfSwNCgkNCglnZXRTdGF0ZUNoYW5uZWw6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHRoaXMuc3RhdGVDaGFubmVsOw0KCX0sDQoNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gR2V0cyBjdXJyZW50IHdpZGdldCBzdGF0ZS4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIHN0YXRlIHNob3VsZCBiZSByZXRyaWV2ZWQuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0IGd1aWQuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIHN0YXRlIGlzIHJldHJpZXZlZC4NCiAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgc3RhdGUgb2JqZWN0IHdoaWNoIGhhcyBmb2xsb3dpbmcgcHJvcGVydGllcy4gPGJyPg0KICAgICAqIDxicj4NCiAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiB0aGUgd2lkZ2V0IDxicj4NCiAgICAgKiAgICAge051bWJlcn0geDogeC1jb29yZGluYXRlIHZhbHVlIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHdpZGdldDxicj4NCiAgICAgKiAgICAge051bWJlcn0geTogeS1jb29yZGluYXRlIHZhbHVlIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHdpZGdldDxicj4NCiAgICAgKiAgICAge051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHRoZSB3aWRnZXQgPGJyPg0KICAgICAqICAgICB7TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB0aGUgd2lkZ2V0IDxicj4NCiAgICAgKiAgICAge0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGFjdGl2ZSwgb3IgZWxzZSBmYWxzZS4gVGhpcyBwcm9wZXJ0eSBpcyBhcHBsaWNhYmxlIGZvciBkZXNrdG9wIGxheW91dCBvbmx5LiA8YnI+DQogICAgICogICAgIHtCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgdGhlIHdpZGdldCBpcyBtYXhpbWl6ZWQsIG9yIGVsc2UgZmFsc2UgPGJyPg0KICAgICAqICAgICB7Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgbWluaW1pemVkLCBvciBlbHNlIGZhbHNlIDxicj4NCiAgICAgKiAgICAge0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGNvbGxhcHNlZCwgb3IgZWxzZSBmYWxzZSA8YnI+DQogICAgICogICAgIHtCb29sZWFufSBzaW5nbGV0b246IHRydWUgaWYgdGhlIHdpZGdldCBpcyBzaW5nbGV0b24sIG9yIGVsc2UgZmFsc2UgPGJyPg0KICAgICAqICAgICB7Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgcGlubmVkLCBvciBlbHNlIGZhbHNlIDxicj4NCiAgICAgKiAgICAge1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSBpZCBvZiB0aGUgd2lkZ2V0IDxicj4NCiAgICAgKiAgICAge1N0cmluZ30gd2lkZ2V0R3VpZDogZ3VpZCBvZiB0aGUgd2lkZ2V0IDxicj4NCiAgICAgKiAgICAge1N0cmluZ30gcGFuZUd1aWQ6IGd1aWQgb2YgdGhlIHBhbmUgPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSBkYXNoYm9hcmRHdWlkOiBndWlkIG9mIHRoZSBkYXNoYm9hcmQgdGhlIHdpZGdldCBpcyBvcGVuZWQgb24gPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSByZWdpb246IHJlZ2lvbiBvZiB0aGUgd2lkZ2V0LiBUaGlzIHByb3BlcnR5IGlzIGFwcGxpY2FibGUgZm9yIGFjY29yZGlvbiBsYXlvdXQgb25seS4gUG9zc2libGUgdmFsdWVzIGZvciBhY2NvcmRpb24gbGF5b3V0IGFyZSAiYWNjb3JkaW9uIiwgImNlbnRlciIgYW5kICJzb3V0aCIuIEluIG90aGVyIGxheW91dHMsIGl0cyB2YWx1ZSBpcyAibm9uZSIuIDxicj4NCiAgICAgKiAgICAge051bWJlcn0gY29sdW1uUG9zOiBjb2x1bW4gdGhlIHdpZGdldCBpcyBvcGVuZWQgaW4uIFRoaXMgcHJvcGVydHkgaXMgYXBwbGljYWJsZSBmb3IgcG9ydGFsIGxheW91dCBvbmx5LiBQb3NzaWJsZSB2YWx1ZXMgZm9yIHBvcnRhbCBsYXlvdXQgYXJlIDAsIDEgYW5kIDIuIEluIG90aGVyIGxheW91dHMsIGl0cyB2YWx1ZSBpcyAwLiA8YnI+DQogICAgICogICAgIHtOdW1iZXJ9IHpJbmRleDogei1pbmRleCBvZiB0aGUgd2lkZ2V0LiA8YnI+DQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqDQoJICogd2lkZ2V0U3RhdGUuZ2V0V2lkZ2V0U3RhdGUoew0KICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsNCgkgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgfQ0KCSAqIH0pOw0KCSAqDQoJICovDQoJZ2V0V2lkZ2V0U3RhdGU6IGZ1bmN0aW9uKGNmZykgew0KCQljZmcgPSBjZmcgPyBjZmcgOiB7fTsNCgkJDQoJCXZhciBjb25maWcgPSB7DQoJCQlmbjogImdldFdpZGdldFN0YXRlIiwNCgkJCXBhcmFtczogew0KCQkJCWd1aWQ6IGNmZy5ndWlkID8gY2ZnLmd1aWQgOiB0aGlzLndpZGdldEd1aWQNCgkJCX0NCgkJfTsNCgkJdGhpcy53aWRnZXRTdGF0ZUhhbmRsZXIuaGFuZGxlV2lkZ2V0UmVxdWVzdChjb25maWcsIGNmZy5jYWxsYmFjayk7DQoJfSwNCgkNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gR2V0cyByZWdpc3RlcmVkIHdpZGdldCBzdGF0ZSBldmVudHMNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIGV2ZW50cyBzaG91bGQgYmUgcmV0cmlldmVkLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCBndWlkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcuY2FsbGJhY2tdIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIGFmdGVyIHRoZSBzdGF0ZVdpZGdldCBpcyBleGVjdXRlZC4NCgkgKg0KCSAqIEBleGFtcGxlDQoJICoNCgkgKiB3aWRnZXRTdGF0ZS5nZXRSZWdpc3RlcmVkU3RhdGVFdmVudHMoew0KCSAqICAgICBjYWxsYmFjazogZnVuY3Rpb24oZXZlbnRzKSB7DQoJICogICAgIAkJZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHsNCgkgKiAgICAgCQkJLy8gRG8gc29tZXRoaW5nDQoJICogICAgIAkJfQ0KCSAqICAgICB9DQoJICogfSk7DQoJICoNCgkgKi8NCglnZXRSZWdpc3RlcmVkU3RhdGVFdmVudHM6IGZ1bmN0aW9uKGNmZykgew0KCQljZmcgPSBjZmcgPyBjZmcgOiB7fTsNCgkJDQoJCXZhciBjb25maWcgPSB7DQoJCQlmbjogImdldFdpZGdldFN0YXRlRXZlbnRzIiwNCgkJCXBhcmFtczogew0KCQkJCWd1aWQ6IGNmZy5ndWlkID8gY2ZnLmd1aWQgOiB0aGlzLndpZGdldEd1aWQNCgkJCX0NCgkJfTsNCgkJdGhpcy53aWRnZXRTdGF0ZUhhbmRsZXIuaGFuZGxlV2lkZ2V0UmVxdWVzdChjb25maWcsIGNmZy5jYWxsYmFjayk7DQoJfSwNCgkNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gQWN0aXZhdGVzIGEgd2lkZ2V0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgdG8gYWN0aXZhdGUuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0J3MgZ3VpZC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgd2lkZ2V0IGhhcyBiZWVuIGFjdGl2YXRlZC4NCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHBhc3NlZCBiYWNrIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycy4gPGJyPg0KICAgICAqIDxicj4NCiAgICAgKiAgICAgICAgICB7Qm9vbGVhbn0gcmVzdWx0OiB0cnVlIGlmIHRoZSB3aWRnZXQgaGFzIGJlZW4gYWN0aXZhdGVkLCBvciBlbHNlIGZhbHNlLg0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHdpZGdldFN0YXRlLmFjdGl2YXRlV2lkZ2V0KHsNCiAgICAgKiAgICAgZ3VpZDogIkdVSURfT0ZfQV9XSURHRVQiLA0KICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24ocmVzdWx0KSB7DQogICAgICogICAgIAkJLy8gRG8gc29tZXRoaW5nDQogICAgICogICAgIH0NCiAgICAgKiB9KTsNCiAgICAgKg0KICAgICAqLw0KICAgIGFjdGl2YXRlV2lkZ2V0OiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgY2ZnID0gY2ZnID8gY2ZnIDoge307DQoNCiAgICAgICAgdmFyIGNvbmZpZyA9IHsNCiAgICAgICAgICAgIGZuOiAiYWN0aXZhdGVXaWRnZXQiLA0KICAgICAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgICAgICAgZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZA0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCiAgICB9LA0KDQoJLyoqDQoJICogQGRlc2NyaXB0aW9uIENsb3NlcyBhIHdpZGdldC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHRvIGNsb3NlLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCdzIGd1aWQuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIHdpZGdldCBpcyBjbG9zZWQuIE9ubHkgdXNlIHRoaXMgaWYgdGhlIHdpZGdldCBpcyBub3QgY2xvc2luZyBpdHNlbGYuDQogICAgICogVGhpcyBmdW5jdGlvbiBpcyBwYXNzZWQgYmFjayB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMuIDxicj4NCiAgICAgKiA8YnI+DQogICAgICogICAgICAgICAge0Jvb2xlYW59IHJlc3VsdDogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGhhcyBiZWVuIGNsb3NlZCwgb3IgZWxzZSBmYWxzZS4NCgkgKg0KCSAqIEBleGFtcGxlDQoJICoNCgkgKiB3aWRnZXRTdGF0ZS5jbG9zZVdpZGdldCh7DQogICAgICogICAgIGd1aWQ6ICJHVUlEX09GX0FfV0lER0VUIiwNCiAgICAgKiAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHJlc3VsdCkgew0KCSAqICAgICAJCS8vIERvIHNvbWV0aGluZw0KCSAqICAgICB9DQoJICogfSk7DQoJICoNCgkgKi8NCgljbG9zZVdpZGdldDogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAiY2xvc2VXaWRnZXQiLA0KCQkJcGFyYW1zOiB7DQoJCQkJZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZA0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBBZGRzIGN1c3RvbSBzdGF0ZSBldmVudCBoYW5kbGVycyB0byBsaXN0ZW4gdG8gd2lkZ2V0IGV2ZW50cy4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIGV2ZW50cyBzaG91bGQgYmUgbW9uaXRvcmVkLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCBndWlkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtjZmcuZXZlbnRzXSBBcnJheSBvZiBldmVudHMuIElmIG5vIGV2ZW50IGlzIHByb3ZpZGVkIHRoaXMgbWV0aG9kIHdpbGwgYWRkIGxpc3RlbmVycyB0byBhbGwgcmVnaXN0ZXJlZCBldmVudHMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIGxpc3RlbmVyIGlzIGFkZGVkLg0KCSAqDQoJICogQGV4YW1wbGUNCgkgKg0KCSAqIHdpZGdldFN0YXRlLmFkZFN0YXRlRXZlbnRMaXN0ZW5lcnMoew0KCSAqIAkgICBldmVudHM6IFsnYmVmb3JlY2xvc2UnLCdtYXhpbWl6ZSddLA0KCSAqICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7DQoJICogICAgIAkJLy8gRG8gc29tZXRoaW5nDQoJICogICAgIH0NCgkgKiB9KTsNCgkgKg0KCSAqLw0KCWFkZFN0YXRlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKGNmZykgew0KCQljZmcgPSBjZmcgPyBjZmcgOiB7fTsNCgkJDQoJCXZhciBjb25maWcgPSB7DQoJCQlmbjogImFkZFN0YXRlRXZlbnRMaXN0ZW5lcnMiLA0KCQkJcGFyYW1zOiB7DQoJCQkJZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZCwNCgkJCQlldmVudHM6IGNmZy5ldmVudHMNCgkJCX0NCgkJfTsNCgkJdGhpcy53aWRnZXRTdGF0ZUhhbmRsZXIuaGFuZGxlV2lkZ2V0UmVxdWVzdChjb25maWcsIGNmZy5jYWxsYmFjayk7DQoJfSwNCgkNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gUmVtb3ZlcyBjdXN0b20gc3RhdGUgZXZlbnQgbGlzdGVuZXJzIGZyb20gYSB3aWRnZXQuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtjZmddIENvbmZpZyBvYmplY3QuIFNlZSBiZWxvdyBmb3IgcHJvcGVydGllcy4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5ndWlkXSAgSWQgb2YgdGhlIHdpZGdldCB3aG9zZSBldmVudHMgc2hvdWxkIGJlIG1vbml0b3JlZC4gRGVmYXVsdHMgdG8gY3VycmVudCB3aWRnZXQgZ3VpZC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbY2ZnLmV2ZW50c10gQXJyYXkgb2YgZXZlbnRzLiBJZiBubyBldmVudCBpcyBwcm92aWRlZCB0aGlzIG1ldGhvZCB3aWxsIHJlbW92ZSBvbmx5IGN1c3RvbSBsaXN0ZW5lcnMgZnJvbSBhbGwgcmVnaXN0ZXJlZCBldmVudHMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQuDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqDQoJICogd2lkZ2V0U3RhdGUucmVtb3ZlU3RhdGVFdmVudExpc3RlbmVycyh7DQoJICogCSAgIGV2ZW50czogWydiZWZvcmVjbG9zZScsJ21heGltaXplJ10sDQoJICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHsNCgkgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgfQ0KCSAqIH0pOw0KCSAqDQoJICovDQoJcmVtb3ZlU3RhdGVFdmVudExpc3RlbmVyczogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAicmVtb3ZlU3RhdGVFdmVudExpc3RlbmVycyIsDQoJCQlwYXJhbXM6IHsNCgkJCQlndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkLA0KCQkJCWV2ZW50czogY2ZnLmV2ZW50cw0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBBZGRzIGN1c3RvbSBzdGF0ZSBldmVudCBoYW5kbGVycyB0byBvdmVycmlkZSBhIHdpZGdldCBldmVudC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIGV2ZW50cyBzaG91bGQgYmUgbW9uaXRvcmVkLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCBndWlkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtjZmcuZXZlbnRzXSBBcnJheSBvZiBldmVudHMuIElmIG5vIGV2ZW50IGlzIHByb3ZpZGVkIHRoaXMgbWV0aG9kIHdpbGwgYWRkIGxpc3RlbmVycyB0byBhbGwgcmVnaXN0ZXJlZCBldmVudHMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIGxpc3RlbmVyIGlzIGFkZGVkLg0KCSAqDQoJICogQGV4YW1wbGUNCgkgKg0KCSAqIHdpZGdldFN0YXRlLmFkZFN0YXRlRXZlbnRPdmVycmlkZXMoew0KCSAqIAkgICBldmVudHM6IFsnYmVmb3JlY2xvc2UnLCdtYXhpbWl6ZSddLA0KCSAqICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7DQoJICogICAgIAkJLy8gRG8gc29tZXRoaW5nDQoJICogICAgIH0NCgkgKiB9KTsNCgkgKg0KCSAqLw0KCWFkZFN0YXRlRXZlbnRPdmVycmlkZXM6IGZ1bmN0aW9uKGNmZykgew0KCQljZmcgPSBjZmcgPyBjZmcgOiB7fTsNCgkJDQoJCXZhciBjb25maWcgPSB7DQoJCQlmbjogImFkZFN0YXRlRXZlbnRPdmVycmlkZXMiLA0KCQkJcGFyYW1zOiB7DQoJCQkJZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZCwNCgkJCQlldmVudHM6IGNmZy5ldmVudHMNCgkJCX0NCgkJfTsNCgkJdGhpcy53aWRnZXRTdGF0ZUhhbmRsZXIuaGFuZGxlV2lkZ2V0UmVxdWVzdChjb25maWcsIGNmZy5jYWxsYmFjayk7DQoJfSwNCgkNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gUmVtb3ZlcyBjdXN0b20gc3RhdGUgZXZlbnQgbGlzdGVuZXJzIGZyb20gYSB3aWRnZXQuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtjZmddIENvbmZpZyBvYmplY3QuIFNlZSBiZWxvdyBmb3IgcHJvcGVydGllcy4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5ndWlkXSAgSWQgb2YgdGhlIHdpZGdldCB3aG9zZSBldmVudHMgc2hvdWxkIGJlIG1vbml0b3JlZC4gRGVmYXVsdHMgdG8gY3VycmVudCB3aWRnZXQgZ3VpZC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbY2ZnLmV2ZW50c10gQXJyYXkgb2YgZXZlbnRzLiBJZiBubyBldmVudCBpcyBwcm92aWRlZCB0aGlzIG1ldGhvZCB3aWxsIHJlbW92ZSBvbmx5IGN1c3RvbSBsaXN0ZW5lcnMgZnJvbSBhbGwgcmVnaXN0ZXJlZCBldmVudHMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQuDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqDQoJICogd2lkZ2V0U3RhdGUucmVtb3ZlU3RhdGVFdmVudE92ZXJyaWRlcyh7DQoJICogCSAgIGV2ZW50czogWydiZWZvcmVjbG9zZScsJ21heGltaXplJ10sDQoJICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHsNCgkgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgfQ0KCSAqIH0pOw0KCSAqDQoJICovDQoJcmVtb3ZlU3RhdGVFdmVudE92ZXJyaWRlczogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAicmVtb3ZlU3RhdGVFdmVudE92ZXJyaWRlcyIsDQoJCQlwYXJhbXM6IHsNCgkJCQlndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkLA0KCQkJCWV2ZW50czogY2ZnLmV2ZW50cw0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9DQoNCn07DQoNCi8qKg0KICogQHBhcmFtIHtPYmplY3R9IFtjZmddIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogKiBAcGFyYW0ge1N0cmluZ30gW2NmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXJdICBUaGUgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiBAcGFyYW0ge0Jvb2xlYW59IFtjZmcuYXV0b0luaXRdIFdoZXRoZXIgb3Igbm90IHRvIGF1dG9tYXRpY2FsbHkgc3RhcnQgbGlzdGVuaW5nIHRvIHRoZSBzdGF0ZSBjaGFubmVsLiAgRGVmYXVsdCBpcyB0cnVlLg0KICogQHBhcmFtIHtTdHJpbmd9IFtjZmcud2lkZ2V0R3VpZF0gIFRoZSBndWlkIG9mIHRoZSB3aWRnZXQgdG8gbW9uaXRvci4gRGVmYXVsdCBpcyBpdHNlbGYuDQogKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5vblN0YXRlRXZlbnRSZWNlaXZlZF0gIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGFuIGV2ZW50IGlzIHJlY2VpdmVkLg0KICogQGRlc2NyaXB0aW9uIFJldHJpZXZlcyBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZSBTaW5nbGV0b24gaW5zdGFuY2UuIE1hbmFnZXMgdGhlIHR3by13YXkgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIGFuIE9XRiB3aWRnZXQgYW5kIGl0cyBPV0YgQ29udGFpbmVyLg0KICogQHJlcXVpcmVzIDxhIGhyZWY9Ik96b25lLmV2ZW50aW5nLldpZGdldC5odG1sIj5Pem9uZS5ldmVudGluZy5XaWRnZXQ8L2E+IGZvciBldmVudGluZw0KICogQHNpbmNlIE9XRiAzLjcuMA0KICogQGV4YW1wbGUNCiAqIHZhciB3aWRnZXRTdGF0ZSA9IE96b25lLnN0YXRlLldpZGdldFN0YXRlLmdldEluc3RhbmNlKHsNCiAqICAgICBvblN0YXRlRXZlbnRSZWNlaXZlZDogZnVuY3Rpb24oc2VuZGVyLCBtc2cpIHsNCiAqICAgICAgICAgIC8vIGRvIHNvbWV0aGluZw0KICogICAgIH0NCiAqIH0pOw0KICoNCiAqLw0KT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbihjZmcpIHsNCiAgaWYgKE96b25lLnN0YXRlLldpZGdldFN0YXRlLmluc3RhbmNlID09IG51bGwpIHsNCiAgICBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5pbnN0YW5jZSA9IG5ldyBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZShjZmcpOw0KICB9DQogIHJldHVybiBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5pbnN0YW5jZTsNCn07DQoKLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLmV2ZW50aW5nID0gT3pvbmUuZXZlbnRpbmcgPyBPem9uZS5ldmVudGluZyA6IHt9Ow0KDQooZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgew0KDQogICAgZnVuY3Rpb24gcnBjQ2FsbCh3aWRnZXRJZCwgd2lkZ2V0SWRDYWxsZXIsIGZ1bmN0aW9uTmFtZSwgdmFyX2FyZ3MpIHsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAiRlVOQ1RJT05fQ0FMTCIsIG51bGwsIHdpZGdldElkLCB3aWRnZXRJZENhbGxlciwgZnVuY3Rpb25OYW1lLCB2YXJfYXJncyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciB1cGRhdGVzIGEgcHJveHkgLSBUaGlzIGlzIGEgcHJpdmF0ZSBjb25zdHJ1Y3RvciAtIERvIG5vdCBjYWxsIHRoaXMgZGlyZWN0bHkuICBUaGUgb3RoZXINCiAgICAgKiBXaWRnZXQgQVBJcyBzdWNoIGFzIFdpZGdldCBJbnRlbnRzIG1heSByZXR1cm4gYSBwcm94eS4gIEEgcHJveHkgbWF5IGNvbnRhaW4gZHluYW1pYyBmdW5jdGlvbnMgdGhhdCB3ZXJlDQogICAgICogcmVnaXN0ZXJlZCBieSB0aGUgb3JpZ2luIHdpZGdldC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB3aWQgSWQgb2YgdGhlIFdpZGdldCB0aGlzIHByb3h5IHJlcHJlc2VudHMNCiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBmdW5jdGlvbnMgQXJyYXkgb2Ygb2JqZWN0cyByZXByZXNlbnRpbmcgcHJveHkgZnVuY3Rpb25zDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNyY0lkIElkIG9mIHRoZSBzb3VyY2UgV2lkZ2V0IHdobyBpcyB1c2luZyB0aGUgcHJveHkNCiAgICAgKiBAcGFyYW0ge096b25lLmV2ZW50aW5nLldpZGdldFByb3h5fSBbcHJveHldIEEgZXhpc3RpbmcgcHJveHkgb2JqZWN0IHRvIGJlIHVzZWQsIGluc3RlYWQgb2YgY3JlYXRpbmcgYSBuZXcgaW5zdGFuY2UNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBPem9uZS5ldmVudGluZy5XaWRnZXRQcm94eSA9IGZ1bmN0aW9uICh3aWQsIGZ1bmN0aW9ucywgc3JjSWQsIHByb3h5KSB7DQogICAgICAgIHZhciB3aWRnZXRJZCA9IHdpZCwNCiAgICAgICAgICAgIHdpZGdldElmcmFtZUlkLA0KICAgICAgICAgICAgcmVhZHlMaXN0ID0gW10sDQogICAgICAgICAgICBwdWIgPSBwcm94eTsNCg0KICAgICAgICAvLyBhc3N1bWUgSlNPTg0KICAgICAgICBpZih3aWRnZXRJZC5jaGFyQXQoMCkgPT09ICd7Jykgew0KICAgICAgICAgICAgd2lkZ2V0SWZyYW1lSWQgPSB3aWRnZXRJZDsNCiAgICAgICAgICAgIHdpZGdldElkID0gT1dGLlV0aWwucGFyc2VKc29uKHdpZGdldElmcmFtZUlkKS5pZDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHdpZGdldElmcmFtZUlkID0gJ3tcImlkXCI6XCInICsgd2lkZ2V0SWQgKyAnXCJ9JzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKHB1YiA9PSBudWxsKSB7DQogICAgICAgICAgICBwdWIgPSAvKiogQGxlbmRzIE96b25lLmV2ZW50aW5nLldpZGdldFByb3h5LnByb3RvdHlwZSAqLyB7DQoNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBJZCBvZiB0aGUgV2lkZ2V0IHRoYXQgdGhpcyBwcm94eSByZXByZXNlbnRzDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgaWQ6d2lkZ2V0SWZyYW1lSWQsDQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogRmxhZyB3aGljaCByZXByZXNlbnRzIGlmIHRoZSBXaWRnZXQgdGhpcyBwcm94eSByZXByZXNlbnRzDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgaXNSZWFkeTpmYWxzZSwNCiAgICAgICAgICAgICAgICBjYWxsYmFja3M6e30sDQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogU2VuZHMgYSBkaXJlY3QgbWVzc2FnZSB0byB0aGUgV2lkZ2V0IHRoaXMgcHJveHkgcmVwcmVzZW50cw0KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhVG9TZW5kDQogICAgICAgICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgICAgICAgKiB2YXIgd2lkZ2V0UHJveHkgPSBPV0YuUlBDLmdldFdpZGdldFByb3h5KGlkKTsNCiAgICAgICAgICAgICAgICAgKiB3aWRnZXRQcm94eS5zZW5kTWVzc2FnZSh7ZGF0YTonZm9vJ30pOw0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlOmZ1bmN0aW9uIChkYXRhVG9TZW5kKSB7DQogICAgICAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgJ0RJUkVDVF9NRVNTQUdFJywgbnVsbCwgd2lkZ2V0SWQsIGRhdGFUb1NlbmQpOw0KICAgICAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBSZWdpc3RlcnMgYSBsaXN0ZW5lciBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBXaWRnZXQgaGFzIGNhbGxlZCBub3RpZnlSZWFkeQ0KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHJlYWR5TGlzdGVuZXIgZnVuY3Rpb24gdG8gZXhlY3V0ZQ0KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWFkeUxpc3RlbmVyU2NvcGUgc2NvcGUgZm9yIHRoZSBmdW5jdGlvbiB0byBleGVjdXRlIHdpdGgNCiAgICAgICAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAgICAgICAqIHZhciB3aWRnZXRQcm94eSA9IE9XRi5SUEMuZ2V0V2lkZ2V0UHJveHkoaWQpOw0KICAgICAgICAgICAgICAgICAqIHdpZGdldFByb3h5Lm9uUmVhZHkoZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKCJPdGhlciB3aWRnZXQgaXMgcmVhZHkhIik7IH0pOw0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIG9uUmVhZHk6ZnVuY3Rpb24gKHJlYWR5TGlzdGVuZXIsIHJlYWR5TGlzdGVuZXJTY29wZSkgew0KDQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUmVhZHkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vanVzdCBleGVjdXRlIGJlY2F1c2UgdGhlIHdpZGdldCBpcyBhbHJlYWR5IHJlYWR5DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkeUxpc3RlbmVyLmNhbGwocmVhZHlMaXN0ZW5lclNjb3BlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2F2ZSByZWFkeSBsaXN0ZW5lcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWR5TGlzdC5wdXNoKHtmbjpyZWFkeUxpc3RlbmVyLCBzY29wZTpyZWFkeUxpc3RlbmVyU2NvcGV9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZmlyZVJlYWR5OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1JlYWR5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHJlYWR5TGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZHlMaXN0W2ldLmZuLmNhbGwocmVhZHlMaXN0W2ldLnNjb3BlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZnVuY3Rpb25zICE9IG51bGwpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCBmdW5jdGlvbnMubGVuZ3RoOyBpaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIGZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uc1tpaV07DQoNCiAgICAgICAgICAgICAgICBwdWJbZnVuY3Rpb25OYW1lXSA9IGZ1bmN0aW9uIChuYW1lKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrRXhpc3RzID0gdHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbic7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCwgY2FsbGJhY2tFeGlzdHMgPyBhcmd1bWVudHMubGVuZ3RoIC0gMSA6IGFyZ3VtZW50cy5sZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrRXhpc3RzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHViLmNhbGxiYWNrc1tuYW1lXSA9IGNhbGxiYWNrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcnBjQ2FsbC5jYWxsKHRoaXMsIHdpZGdldElkLCBzcmNJZCwgbmFtZSwgYXJncyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KGZ1bmN0aW9uTmFtZSk7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBwdWI7DQogICAgfTsNCg0KfSh3aW5kb3csIGRvY3VtZW50KSk7Ci8vVG9wIGxldmVsIG5hbWVzcGFjZSBkZWZzCnZhciBPem9uZSA9IE96b25lIHx8IHt9OwpPem9uZS5ldmVudGluZyA9IE96b25lLmV2ZW50aW5nIHx8IHt9OwpPem9uZS5ldmVudGluZy5wcml2ID0gT3pvbmUuZXZlbnRpbmcucHJpdiB8fCB7fTsKCi8vIGlmICh0eXBlb2YgSlNPTiA9PT0gJ3VuZGVmaW5lZCcpIHsKLy8gICAgIEpTT04gPSBnYWRnZXRzLmpzb247Ci8vIH0KCihmdW5jdGlvbiAob3pvbmVFdmVudGluZykgewoKICAgIGlmICh0eXBlb2YgSlNPTiA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB2YXIgSlNPTiA9IGdhZGdldHMuanNvbjsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gcHJpdmF0ZSBvYmplY3RzIGFuZCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgdmFyIFdJREdFVF9SRUFEWV9TRVJWSUNFX05BTUUgPSAnX3dpZGdldFJlYWR5JywKICAgICAgICBHRVRfV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSA9ICdfZ2V0V2lkZ2V0UmVhZHknLAogICAgICAgIGNvbmZpZyA9IG51bGwsCiAgICAgICAgZm5NYXAgPSB7fSwKICAgICAgICB3aWRnZXRQcm94eU1hcCA9IHt9OwoKICAgIGZ1bmN0aW9uIGdldENvbmZpZygpIHsKICAgICAgICBpZiAoY29uZmlnID09IG51bGwpIHsKICAgICAgICAgICAgY29uZmlnID0ge307CiAgICAgICAgICAgIGlmICh3aW5kb3cubmFtZS5jaGFyQXQoMCkgIT0gJ3snKSB7CiAgICAgICAgICAgICAgICBjb25maWcucnBjSWQgPSB3aW5kb3cubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbmZpZyA9IEpTT04ucGFyc2Uod2luZG93Lm5hbWUpOwogICAgICAgICAgICAgICAgY29uZmlnLnJwY0lkID0gY29uZmlnLmlkOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0V2lkZ2V0UHJveHlNYXAoKSB7CiAgICAgICAgcmV0dXJuIHdpZGdldFByb3h5TWFwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldElkRnJvbVdpbmRvd05hbWUoKSB7CiAgICAgICAgcmV0dXJuIGdldENvbmZpZygpLnJwY0lkOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZURpcmVjdE1lc3NhZ2VXcmFwcGVyKG1lc3NhZ2UpIHsKICAgICAgICBpZiAob3pvbmVFdmVudGluZy5oYW5kbGVEaXJlY3RNZXNzYWdlKSBvem9uZUV2ZW50aW5nLmhhbmRsZURpcmVjdE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGUubG9nKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQ2hpbGRXaWRnZXQ6IEtlcm5lbDogRGVmYXVsdCBkaXJlY3QgbWVzc2FnZSBoYW5kbGVyLCBkb2luZyBub3RoaW5nLiAgT3ZlcnJpZGUgYnkgZGVmaW5pbmcgT3pvbmUuZXZlbnRpbmcuaGFuZGxlRGlyZWN0TWVzc2FnZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUZ1bmN0aW9uQ2FsbCgpIHsKICAgICAgICB2YXIgdmFyX2FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgIHZhciBmbl9hcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAzKTsKICAgICAgICB2YXIgd2lkZ2V0SWQgPSB2YXJfYXJnc1swXTsKICAgICAgICB2YXIgd2lkZ2V0SWRDYWxsZXIgPSB2YXJfYXJnc1sxXTsKCiAgICAgICAgdmFyIGZuTmFtZSA9IHZhcl9hcmdzWzJdOwogICAgICAgIHZhciBmbk9iaiA9IGZuTWFwW2ZuTmFtZV07CgogICAgICAgIC8vaWQgb2YgdGhlIGNhbGxpbmcgd2lkZ2V0CiAgICAgICAgZm5PYmouZm4ud2lkZ2V0SWRDYWxsZXIgPSB3aWRnZXRJZENhbGxlcjsKCiAgICAgICAgdmFyIHJlc3VsdCA9IGZuT2JqLmZuLmFwcGx5KGZuT2JqLnNjb3BlLCBmbl9hcmdzWzBdKTsKCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAnRlVOQ1RJT05fQ0FMTF9SRVNVTFQnLCBudWxsLCB3aWRnZXRJZCwgd2lkZ2V0SWRDYWxsZXIsIGZuTmFtZSwgcmVzdWx0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVGdW5jdGlvbkNhbGxSZXN1bHQod2lkZ2V0SWQsIGZ1bmN0aW9uTmFtZSwgcmVzdWx0KSB7CiAgICAgICAgdmFyIHdwcm94eSA9IHdpZGdldFByb3h5TWFwW3dpZGdldElkXTsKICAgICAgICBpZiAod3Byb3h5ICE9IG51bGwpIHsKICAgICAgICAgICAgdmFyIGNiID0gd3Byb3h5LmNhbGxiYWNrc1tmdW5jdGlvbk5hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGNiID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBjYi5jYWxsKHdpbmRvdywgcmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVFdmVudENhbGwoZXZlbnROYW1lKSB7CiAgICAgICAgdmFyIGZuID0gb3pvbmVFdmVudGluZy5wcml2LmNsaWVudEV2ZW50TmFtZVRvSGFuZGxlcltldmVudE5hbWVdOwogICAgICAgIHZhciB2YXJfYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgZm4uYXBwbHkod2luZG93LCB2YXJfYXJncyk7CiAgICB9CgogICAgb3pvbmVFdmVudGluZy5wcml2LmNsaWVudEV2ZW50TmFtZVRvSGFuZGxlciA9IHt9OwoKICAgIG96b25lRXZlbnRpbmcuYWZ0ZXJfY29udGFpbmVyX2luaXQgPSBmdW5jdGlvbiAoKSB7CiAgICB9OwoKICAgIC8vUmVjb3JkIGFsbCBwdWJsaWMgZnVuY3Rpb25zIGZyb20gYSB3aWRnZXQKICAgIGZ1bmN0aW9uIGdldEZ1bmN0aW9uTmFtZXMoZnVuY3Rpb25zKSB7CiAgICAgICAgaWYgKGZ1bmN0aW9ucykgewogICAgICAgICAgICB2YXIgZnVuY05hbWVzID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCBmdW5jdGlvbnMubGVuZ3RoOyBpaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZm5OYW1lID0gZnVuY3Rpb25zW2lpXS5uYW1lOwogICAgICAgICAgICAgICAgZnVuY05hbWVzLnB1c2goZm5OYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZnVuY05hbWVzOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDbGllbnRTaWRlRnVuY3Rpb25TaGltcyh3aWRnZXRJZCwgZnVuY3Rpb25zLCBpbml0aWFsUHJveHkpIHsKICAgICAgICB3aWRnZXRQcm94eU1hcFt3aWRnZXRJZF0gPSBuZXcgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0UHJveHkod2lkZ2V0SWQsIGZ1bmN0aW9ucywgZ2V0SWRGcm9tV2luZG93TmFtZSgpLCBpbml0aWFsUHJveHkpOwogICAgICAgIHJldHVybiB3aWRnZXRQcm94eU1hcFt3aWRnZXRJZF07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVsYXlVcmwodXJsKSB7CiAgICAgICAgdmFyIHByb3RvY29sSWR4ID0gdXJsLmluZGV4T2YoIi8vIik7CiAgICAgICAgdmFyIHByb3RvY29sRW5kSWR4ID0gdXJsLmluZGV4T2YoIi8iLCBwcm90b2NvbElkeCArIDIpOwogICAgICAgIHZhciBhcHBFbmRJZHggPSB1cmwuaW5kZXhPZigiLyIsIHByb3RvY29sRW5kSWR4ICsgMSk7CiAgICAgICAgdmFyIHJlbGF5ID0gdXJsLnN1YnN0cmluZygwLCBhcHBFbmRJZHggKyAxKSArICJycGNfcmVsYXkuaHRtbCI7CiAgICAgICAgcmV0dXJuIHJlbGF5OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhY2hlRnVuY3Rpb25zKGZ1bmN0aW9ucykgewogICAgICAgIHZhciBmbk9iajsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGZ1bmN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBmbk9iaiA9IGZ1bmN0aW9uc1tpXTsKCiAgICAgICAgICAgIGlmICghZm5PYmoubmFtZSkKICAgICAgICAgICAgICAgIHRocm93ICdFcnJvcjogbmFtZSBpcyBub3Qgc2V0JwogICAgICAgICAgICBpZiAoIWZuT2JqLmZuKQogICAgICAgICAgICAgICAgdGhyb3cgJ0Vycm9yOiBmbiBpcyBub3Qgc2V0JwoKICAgICAgICAgICAgZm5NYXBbZm5PYmoubmFtZV0gPSBmbk9iajsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIHB1YmxpYyBvYmplY3RzIGFuZCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8qKgogICAgICogY2xpZW50SW5pdGlhbGl6ZSAtIEluaXRpYWxpemUgYSB3aWRnZXQKICAgICAqCiAgICAgKiBAcGFyYW1zICAgICAgICBwdWJsaWNGdWNuY3Rpb25zIC0gb3B0aW9uYWwgYXJyYXkgb2YgZnVuY3Rpb25zIHRvIGV4cG9zZSB0byBvdGhlciB3aWRnZXRzCiAgICAgKgogICAgICogICAgRm9yIGV4YW1wbGUKICAgICAqICAgICAgICBmdW5jdGlvbiBwbG90KGxhdCwgbG9uKSB7IC8vZG8gc29tZSBwbG90dGluZyB9CiAgICAgKiAgICAgICAgZnVuY3Rpb24gY2VudGVyKGxhdCwgbG9uKSB7IC8vZG8gc29tZSBjZW50ZXJpbmcgfQogICAgICovCiAgICBmdW5jdGlvbiBjbGllbnRJbml0aWFsaXplKHB1YmxpY0Z1bmN0aW9ucywgcmVsYXlVcmwpIHsKICAgICAgICBnYWRnZXRzLnJwYy5zZXRSZWxheVVybCgiLi4iLCBnZXRDb25maWcoKS5yZWxheVVybCwgZmFsc2UsIHRydWUpOwogICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJhZnRlcl9jb250YWluZXJfaW5pdCIsIG96b25lRXZlbnRpbmcuYWZ0ZXJfY29udGFpbmVyX2luaXQpOwoKICAgICAgICBwdWJsaWNGdW5jdGlvbnMgPSBbXS5jb25jYXQocHVibGljRnVuY3Rpb25zKTsKICAgICAgICBjYWNoZUZ1bmN0aW9ucyhwdWJsaWNGdW5jdGlvbnMpOwoKICAgICAgICB2YXIgZm5OYW1lcyA9IGdldEZ1bmN0aW9uTmFtZXMocHVibGljRnVuY3Rpb25zKTsKICAgICAgICB2YXIgaWQgPSBnZXRJZEZyb21XaW5kb3dOYW1lKCk7CgogICAgICAgIGlmIChyZWxheVVybCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJlbGF5VXJsID0gZ2V0UmVsYXlVcmwoZG9jdW1lbnQubG9jYXRpb24uaHJlZik7CiAgICAgICAgfQoKLy8gICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgIlRFTExfRlVOQ1RJT05TIiwgbnVsbCwgaWQsIGZuTmFtZXMsIHJlbGF5VXJsKTsKCiAgICAgICAgLy90aGlzIHJwYyBjYWxsIG11c3QgYmUgY29uc2lzdGVudCB3aXRoIE9XRiBjb250YWluZXJfaW5pdAogICAgICAgIHZhciBpZFN0cmluZyA9ICd7XCJpZFwiOlwiJyArIGlkICsgJ1wifSc7CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgIGlkOmlkU3RyaW5nLAogICAgICAgICAgICB2ZXJzaW9uOicxLjAnLAogICAgICAgICAgICB1c2VNdWx0aVBhcnRNZXNzYWdlc0ZvcklGUEM6dHJ1ZSwKICAgICAgICAgICAgcmVsYXlVcmw6cmVsYXlVcmwKICAgICAgICB9OwogICAgICAgIHZhciBkYXRhU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAiY29udGFpbmVyX2luaXQiLCBudWxsLCBpZFN0cmluZywgZGF0YVN0cmluZywgZm5OYW1lcyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJGdW5jdGlvbnMoZnVuY3Rpb25zKSB7CiAgICAgICAgZnVuY3Rpb25zID0gW10uY29uY2F0KGZ1bmN0aW9ucyk7CgogICAgICAgIGNhY2hlRnVuY3Rpb25zKGZ1bmN0aW9ucyk7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAicmVnaXN0ZXJfZnVuY3Rpb25zIiwgbnVsbCwgd2luZG93Lm5hbWUsIGdldEZ1bmN0aW9uTmFtZXMoZnVuY3Rpb25zKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBpbXBvcnRXaWRnZXQgLSBHZXQgYSBwcm94eSB0byBhbm90aGVyIHdpZGdldCBpbiB0aGUgY29udGFpbmVyCiAgICAgKgogICAgICogQHJldHVybnMgICAgICAgYSBwcm94eSBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzZW5kIGRpcmVjdCBtZXNzYWdlcywgaGFuZGxlIGV2ZW50cywKICAgICAqICAgICAgICAgICAgICAgIG9yIGNhbGwgZnVuY3Rpb25zIFwKICAgICAqCiAgICAgKiAgTm90ZSB0aGF0IG9uY2UgY3JlYXRlZCwgdGhlIHByb3h5IHdpbGwgYmUgYXZhaWxhYmxlIGluIHRoZSBnbG9iYWwgT3pvbmUuZXZlbnRpbmcKICAgICAqICBjb2xsZWN0aW9uCiAgICAgKiAgICBGb3IgZXhhbXBsZQogICAgICogICAgICAgIGNyZWF0ZVdpZGdldCgiaHR0cDovL21hcHMuY29tL3dpZGdldE1hcCIsICJNeU1hcFdpZGdldCIsICJkaXYxIiwgIjEwMCUiLCAiMTAwJSIsIG9rKTsKICAgICAqICAgICAgICBmdW5jdGlvbiBvaygpIHsKICAgICAqICAgICAgICAgICBPem9uZS5ldmVudGluZy5NeU1hcFdpZGdldC5wbG90KDEuMSwyLjIpOwogICAgICogICAgICAgIH0KICAgICAqLwogICAgZnVuY3Rpb24gaW1wb3J0V2lkZ2V0KHdpZGdldElkLCByZWFkeSkgewogICAgICAgIC8vIGFzc3VtZSBKU09OCiAgICAgICAgaWYod2lkZ2V0SWQuY2hhckF0KDApID09PSAneycpIHsKICAgICAgICAgICAgd2lkZ2V0SWQgPSBPV0YuVXRpbC5wYXJzZUpzb24od2lkZ2V0SWQpLmlkOwogICAgICAgIH0KCiAgICAgICAgdmFyIHByb3h5ID0gY3JlYXRlQ2xpZW50U2lkZUZ1bmN0aW9uU2hpbXMod2lkZ2V0SWQpOwoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRnVuY3Rpb25zRnJvbUNvbnRhaW5lcihmdW5jdGlvbnMpIHsKICAgICAgICAgICAgcHJveHkgPSBjcmVhdGVDbGllbnRTaWRlRnVuY3Rpb25TaGltcyh3aWRnZXRJZCwgZnVuY3Rpb25zLCBwcm94eSk7CiAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgR0VUX1dJREdFVF9SRUFEWV9TRVJWSUNFX05BTUUsIGZ1bmN0aW9uKGlzUmVhZHkpIHsKICAgICAgICAgICAgICAgIGlmIChpc1JlYWR5KSB7CiAgICAgICAgICAgICAgICAgIHByb3h5LmZpcmVSZWFkeSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZWFkeSA9PSAnZnVuY3Rpb24nKSByZWFkeS5jYWxsKHRoaXMsIHByb3h5KTsKICAgICAgICAgICAgfSwgd2lkZ2V0SWQsIHNyY1dpZGdldElmcmFtZUlkKTsKICAgICAgICB9CgogICAgICAgIHZhciBpZCA9IGdldElkRnJvbVdpbmRvd05hbWUoKTsKICAgICAgICB2YXIgc3JjV2lkZ2V0SWZyYW1lSWQgPSAne1wiaWRcIjpcIicgKyBpZCArICdcIn0nOwogICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgJ0dFVF9GVU5DVElPTlMnLCBwcm9jZXNzRnVuY3Rpb25zRnJvbUNvbnRhaW5lciwgd2lkZ2V0SWQsIHNyY1dpZGdldElmcmFtZUlkKTsKICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMaXN0ZW4gZm9yIGV2ZW50cyBvZiBhIGdpdmVuIG5hbWUgdXNpbmcgdGhlIHNwZWNpZmllZCBoYW5kbGVyIGZ1bmN0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEV2ZW50SGFuZGxlcihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgICBvem9uZUV2ZW50aW5nLnByaXYuY2xpZW50RXZlbnROYW1lVG9IYW5kbGVyW2V2ZW50TmFtZV0gPSBoYW5kbGVyOwogICAgICAgIHZhciB3aWRnZXRJZCA9IGdldElkRnJvbVdpbmRvd05hbWUoKTsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICdBRERfRVZFTlQnLCBudWxsLCB3aWRnZXRJZCwgZXZlbnROYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJhaXNlIGFuZCBldmVudCB3aXRoIGEganNvbiBwYXlsb2FkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJhaXNlRXZlbnQoZXZlbnROYW1lLCBwYXlsb2FkKSB7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAnQ0FMTF9FVkVOVCcsIG51bGwsIGV2ZW50TmFtZSwgcGF5bG9hZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBjbG9zZURpYWxvZyAtIENsb3NlIGN1cnJlbnQgZGlhbG9nIHdpZGdldCwgcmV0dXJuaW5nIGEganNvbiBwYXlsb2FkIHRvIHRoZSBjb250YWluZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlRGlhbG9nKHBheWxvYWQpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAnQ0xPU0VfRVZFTlQnLCBudWxsLCBnZXRJZEZyb21XaW5kb3dOYW1lKCksIHBheWxvYWQpOwogICAgfQoKICAgIC8qKgogICAgICogZ2V0QWxsV2lkZ2V0cyAtIEdldCBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIHVybCBhbmQgaWQgb2YgYWxsIGN1cnJlbnRseQogICAgICogICAgICAgICAgICAgICAgIG9wZW4gd2lkZ2V0cy4KICAgICAqCiAgICAgKiAgIGVnIFsgeyB1cmw6ICJodHRwOi8vd3d3LmV4YW1wbGUuY29tIiwgaWQ6ICJmb28iIH0sIC4uLiBdCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEFsbFdpZGdldHMoaGFuZGxlckZuKSB7CiAgICAgICAgZnVuY3Rpb24gbGlzdFJlc3VsdEhhbmRsZXIod2lkZ2V0TGlzdCkgewogICAgICAgICAgICBoYW5kbGVyRm4od2lkZ2V0TGlzdCk7CiAgICAgICAgfQoKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICdMSVNUX1dJREdFVFMnLCBsaXN0UmVzdWx0SGFuZGxlcik7CiAgICB9CgogICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoJ0RJUkVDVF9NRVNTQUdFTF9DTElFTlQnLCBoYW5kbGVEaXJlY3RNZXNzYWdlV3JhcHBlcik7CiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcigiRlVOQ1RJT05fQ0FMTF9DTElFTlQiLCBoYW5kbGVGdW5jdGlvbkNhbGwpOwogICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoIkZVTkNUSU9OX0NBTExfUkVTVUxUX0NMSUVOVCIsIGhhbmRsZUZ1bmN0aW9uQ2FsbFJlc3VsdCk7CiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcigiRVZFTlRfQ0xJRU5UIiwgaGFuZGxlRXZlbnRDYWxsKTsKICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFdJREdFVF9SRUFEWV9TRVJWSUNFX05BTUUsIGZ1bmN0aW9uICh3aWRnZXRJZCkgewogICAgICAgIHZhciB3cHJveHkgPSB3aWRnZXRQcm94eU1hcFt3aWRnZXRJZF07CiAgICAgICAgaWYgKHdwcm94eSAhPSBudWxsKSB7CiAgICAgICAgICAgIHdwcm94eS5maXJlUmVhZHkoKTsKICAgICAgICB9CiAgICB9KTsKCgoKICAgIG96b25lRXZlbnRpbmcuY2xpZW50SW5pdGlhbGl6ZSA9IGNsaWVudEluaXRpYWxpemU7CiAgICBvem9uZUV2ZW50aW5nLnJlZ2lzdGVyRnVuY3Rpb25zID0gcmVnaXN0ZXJGdW5jdGlvbnM7CiAgICBvem9uZUV2ZW50aW5nLmltcG9ydFdpZGdldCA9IGltcG9ydFdpZGdldDsKICAgIG96b25lRXZlbnRpbmcuYWRkRXZlbnRIYW5kbGVyID0gYWRkRXZlbnRIYW5kbGVyOwogICAgb3pvbmVFdmVudGluZy5yYWlzZUV2ZW50ID0gcmFpc2VFdmVudDsKICAgIG96b25lRXZlbnRpbmcuY2xvc2VEaWFsb2cgPSBjbG9zZURpYWxvZzsKICAgIG96b25lRXZlbnRpbmcuZ2V0QWxsV2lkZ2V0cyA9IGdldEFsbFdpZGdldHM7CiAgICBvem9uZUV2ZW50aW5nLmdldFdpZGdldFByb3h5TWFwID0gZ2V0V2lkZ2V0UHJveHlNYXA7Cgp9KShPem9uZS5ldmVudGluZyk7CgovKioNCiAqIEBmaWxlb3ZlcnZpZXcgQmFzaWMgbWV0cmljcyBjYXBhYmlsaXR5LiAgRXhwZWN0YXRpb24gaXMgdGhhdCBuZXcgbWV0cmljcyB3aWxsIA0KICogIGxpa2VseSBiZSBzZXQgdXAgYXMgc2VwYXJhdGUgZmlsZXMgLyBzZXBhcmF0ZSBzZXRzLiAgICANCiAqLw0KDQovKioNCiAqIEBuYW1lc3BhY2UNCiAqLw0KdmFyIE96b25lID0gT3pvbmUgfHwge307DQoNCi8qKg0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5tZXRyaWNzID0gT3pvbmUubWV0cmljcyB8fCB7fTsNCg0KLyoqDQogKiBAZGVzY3JpcHRpb24gQmFzaWMgbG9nZ2luZyBjYXBhYmlsaXR5IC0gbWVhbnQgdG8gYmUgY2FsbGVkIGJ5IG90aGVyIG1ldGhvZHMNCiAqICAgIHdoaWNoIHRyYW5zZm9ybSBvciB2YWxpZGF0ZSBkYXRhICANCiAqIEBzaW5jZSBPV0YgMy44LjANCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gdXNlcklkDQogKiBAcGFyYW0ge1N0cmluZ30gdXNlck5hbWUNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNTaXRlIElkZW50aWZpZXIsIHBvdGVudGlhbGx5IFVSTCwgZm9yIHNvdXJjZSBvZiBtZXRyaWMgLSB0eXBpY2FsbHkgT1dGIGluc3RhbmNlDQogKiBAcGFyYW0ge1N0cmluZ30gY29tcG9uZW50TmFtZSAgICANCiAqIEBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnRJZCANCiAqIEBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnRJbnN0YW5jZUlkDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljVHlwZUlkIFN0cmluZyBkZXNjcmliaW5nIG1ldHJpYyAtIHJlY29tbWVuZCBwYWNrYWdlIG5hbWUgY29uc3RydWN0DQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljRGF0YSBBbnkgYWRkaXRpb25hbCBkYXRhIGZvciBtZXRyaWMgLSBkbyBhbnkgbmVjZXNzYXJ5IHZhbGlkYXRpb24gYXBwcm9wcmlhdGUgdG8gbWV0cmljVHlwZUlkIGJlZm9yZSBzZW5kaW5nIHRocm91Z2ggDQogKi8NCk96b25lLm1ldHJpY3MubG9nTWV0cmljID0gZnVuY3Rpb24odXNlcklkLCB1c2VyTmFtZSwgbWV0cmljU2l0ZSwgY29tcG9uZW50TmFtZSwgY29tcG9uZW50SWQsIGNvbXBvbmVudEluc3RhbmNlSWQsIG1ldHJpY1R5cGVJZCwgbWV0cmljRGF0YSkgew0KCXZhciBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7DQoJDQogICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZCh7DQogICAgICAgIHVybDogT1dGLmdldENvbnRhaW5lclVybCgpICsgJy9tZXRyaWMnLA0KICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgb25TdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkgew0KICAgICAgICB9LA0KICAgICAgICBhdXRvU2VuZFZlcnNpb24gOiBmYWxzZSwNCiAgICAgICAgY29udGVudCA6IHsNCiAgICAgICAgICBtZXRyaWNUaW1lOiBjdXJyZW50RGF0ZS5nZXRUaW1lKCksDQogICAgICAgICAgdXNlcklkOiB1c2VySWQsDQogICAgICAgICAgdXNlck5hbWU6IHVzZXJOYW1lLA0KICAgICAgICAgIHNpdGU6IG1ldHJpY1NpdGUsDQogICAgICAgICAgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LA0KICAgICAgICAgIGNvbXBvbmVudDogY29tcG9uZW50TmFtZSwNCiAgICAgICAgICBjb21wb25lbnRJZDogY29tcG9uZW50SWQsDQogICAgICAgICAgaW5zdGFuY2VJZDogY29tcG9uZW50SW5zdGFuY2VJZCwNCiAgICAgICAgICBtZXRyaWNUeXBlSWQ6IG1ldHJpY1R5cGVJZCwNCiAgICAgICAgICB3aWRnZXREYXRhOiBtZXRyaWNEYXRhDQogICAgICAgIH0NCiAgICB9KTsNCn07DQoNCi8qKg0KICogQGRlc2NyaXB0aW9uIExvZ3MgYSBzZXQgb2YgbWV0cmljcyB0byB0aGUgc2VydmVyIGFsbCBhdCBvbmNlLiAgQWxsDQogKiBtZXRyaWNzIHBhc3NlZCBpbnRvIGEgY2FsbCB0byB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgbG9nZ2VkIGluIGEgc2luZ2xlDQogKiBIVFRQIHJlcXVlc3QsIGluc3RlYWQgb2Ygb25lIHJlcXVlc3QgcGVyIG1ldHJpYw0KICogQHNpbmNlIE9XRiA2LjANCiAqDQogKiBAcGFyYW0ge0FycmF5fSBtZXRyaWNzIA0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0udXNlcklkDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS51c2VyTmFtZQ0KICogQHBhcmFtIHtOdW1iZXJ9IG1ldHJpY3NbKl0ubWV0cmljVGltZSBUaGUgdGltZSBhdCB3aGljaCBpcyBtZXRyaWMgd2FzIGNvbGxlY3RlZCAoaW4gVU5JWCB0aW1lKQ0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uc2l0ZSBJZGVudGlmaWVyLCBwb3RlbnRpYWxseSBVUkwsIGZvciBzb3VyY2Ugb2YgbWV0cmljIC0gdHlwaWNhbGx5IE9XRiBpbnN0YW5jZQ0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uY29tcG9uZW50DQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS5jb21wb25lbnRJZCANCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLmluc3RhbmNlSWQNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLm1ldHJpY1R5cGVJZCBTdHJpbmcgZGVzY3JpYmluZyBtZXRyaWMgLSByZWNvbW1lbmQgcGFja2FnZSBuYW1lIGNvbnN0cnVjdA0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0ud2lkZ2V0RGF0YSBBbnkgYWRkaXRpb25hbCBkYXRhIGZvciBtZXRyaWMgLSBkbyBhbnkgbmVjZXNzYXJ5IHZhbGlkYXRpb24gYXBwcm9wcmlhdGUgdG8gbWV0cmljVHlwZUlkIGJlZm9yZSBzZW5kaW5nIHRocm91Z2ggDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS51c2VyQWdlbnQgU2hvdWxkIGJlIHNldCB0byB0aGUgdXNlci1hZ2VudCBzdHJpbmcgb2YgdGhlIGJyb3dzZXINCiAqLw0KT3pvbmUubWV0cmljcy5sb2dCYXRjaE1ldHJpY3MgPSBmdW5jdGlvbihtZXRyaWNzKSB7DQoJdmFyIGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTsNCgkNCiAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKHsNCiAgICAgICAgdXJsOiBPV0YuZ2V0Q29udGFpbmVyVXJsKCkgKyAnL21ldHJpYycsDQogICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7DQogICAgICAgIH0sDQogICAgICAgIGF1dG9TZW5kVmVyc2lvbiA6IGZhbHNlLA0KICAgICAgICBjb250ZW50IDogew0KICAgICAgICAJZGF0YTogbWV0cmljcw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KDQovKioNCiAqIEBkZXNjcmlwdGlvbiBMb2cgdmlldyBvZiB3aWRnZXQgLSBzZWUgY2FsbHMgaW4gZGFzaGJvYXJkcw0KICogQHNpbmNlIE9XRiAzLjguMA0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgICAgIC0gc2VlIE96b25lLm1ldHJpY3MubG9nTWV0cmljIHVzZXJJZA0KICogQHBhcmFtIHtTdHJpbmd9IHVzZXJOYW1lICAgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgdXNlck5hbWUNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNTaXRlIC0gc2VlIE96b25lLm1ldHJpY3MubG9nTWV0cmljIG1ldHJpY1NpdGUNCiAqIEBwYXJhbSB7T2JqZWN0fSB3aWRnZXQgICANCiAqLyANCk96b25lLm1ldHJpY3MubG9nV2lkZ2V0UmVuZGVyID0gZnVuY3Rpb24odXNlcklkLCB1c2VyTmFtZSwgbWV0cmljU2l0ZSwgd2lkZ2V0KSB7DQoNCiAgLy8gY2hlY2tpbmcgaGVyZSwgb24gdGhlIGFzc3VtcHRpb24gd2UgbWF5IHNhdmUgb3Vyc2VsdmVzIHNvbWUgdmFsaWRhdGlvbiB0aW1lDQogIC8vICAgb24gYW55IHdpZGdldCBkYXRhIHZhbGlkYXRpb24gKGxhc3QgcGFyYW0pDQogIGlmIChPem9uZS5jb25maWcubWV0cmljLmVuYWJsZWQgPT09IHRydWUpIHsNCiAgICAgIE96b25lLm1ldHJpY3MubG9nTWV0cmljKHVzZXJJZCwgdXNlck5hbWUsIG1ldHJpY1NpdGUsIHdpZGdldC5uYW1lLCB3aWRnZXQud2lkZ2V0R3VpZCwgd2lkZ2V0LmlkLCAib3pvbmUud2lkZ2V0LnZpZXciLCAiIik7DQogICAgICB9DQp9Ow0KCi8qKgogKiBAaWdub3JlCiAqLwp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307CgovKioKICogQG5hbWVzcGFjZQogKiBAc2luY2UgT1dGIDUuMAogKi8KT1dGID0gd2luZG93Lk9XRiA/IHdpbmRvdy5PV0YgOiB7fTsKCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKCgl2YXIgV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSA9ICdfd2lkZ2V0UmVhZHknLAoKICAgICAgICBpc1JlYWR5ID0gZmFsc2UsCgkJcmVhZHlMaXN0ID0gW10sCgkJd2lkZ2V0ID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCksCgkJZXZlbnRpbmdDb250cm9sbGVyLAoJCWRyYWdBbmREcm9wQ29udHJvbGxlciwKCQlsYXVuY2hpbmdDb250cm9sbGVyLAoJCWNocm9tZUNvbnRyb2xsZXI7CgoJb3dmZG9qby5taXhpbihPV0YsIC8qKiBAbGVuZHMgT1dGICovIHsKCgkJLyoqCgkJICogVGhlIE9XRi5FdmVudGluZyBvYmplY3QgbWFuYWdlcyB0aGUgZXZlbnRpbmcgZm9yIGFuIGluZGl2aWR1YWwgd2lkZ2V0CgkJICogCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5FdmVudGluZwoJCSAqLwoJCUV2ZW50aW5nOiB7fSwKCgkJLyoqCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5SUEMKCQkgKi8KCQlSUEM6IHt9LAoKCQkvKioKCQkgKiBUaGlzIG9iamVjdCBpcyB1c2VkIHRvIGNyZWF0ZSwgcmV0cmlldmUsIHVwZGF0ZSBhbmQgZGVsZXRlIHVzZXIgcHJlZmVyZW5jZXMuCgkJICogCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5QcmVmZXJlbmNlcwoJCSAqLwoJCVByZWZlcmVuY2VzOiB7fSwKCgkJLyoqCgkJICogVGhpcyBvYmplY3QgaXMgdXNlZCBsYXVuY2ggb3RoZXIgd2lkZ2V0cy4gCgkJICoKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLkxhdW5jaGVyCgkJICovCgkJTGF1bmNoZXI6IHt9LAoKCQkvKioKCQkgKiBUaGUgT1dGLkRyYWdBbmREcm9wIG9iamVjdCBtYW5hZ2VzIHRoZSBkcmFnIGFuZCBkcm9wIGZvciBhbiBpbmRpdmlkdWFsIHdpZGdldC4KCQkgKiAKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLkRyYWdBbmREcm9wCgkJICovCgkJRHJhZ0FuZERyb3A6IHt9LAoKCQkvKioKCQkgKiBUaGlzIG9iamVjdCBhbGxvd3MgYSB3aWRnZXQgdG8gbW9kaWZ5IHRoZSBidXR0b24gY29udGFpbmVkIGluIHRoZSB3aWRnZXQgaGVhZGVyICh0aGUgY2hyb21lKS4gCgkJICoKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLkNocm9tZQoJCSAqLwoJCUNocm9tZToge30sCgoJCS8qKgoJCSAqIFByb3ZpZGVzIE9XRiB1dGlsaXR5IG1ldGhvZHMgZm9yIHRoZSB3aWRnZXQgZGV2ZWxvcGVyIAoJCSAqCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5VdGlsCgkJICovCgkJVXRpbDogT3pvbmUudXRpbCwKCgkJLyoqCgkJICogCgkJICoKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLk1ldHJpY3MKCQkgKi8KCQlNZXRyaWNzOiBPem9uZS5tZXRyaWNzLAoKCQkvKioKCQkgKiBQcm92aWRlcyBmdW5jdGlvbnMgdG8gbG9nIG1lc3NhZ2VzIGFuZCBvYmplY3RzCgkJICogCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5Mb2cKCQkgKi8KCQlMb2c6IE96b25lLmxvZywKCgkJLyoqCgkJICogUHJvdmlkZXMgdXRpbGl0eSBtZXRob2RzIGZvciBsb2NhbGl6YXRpb24KCQkgKgoJCSAqIEBuYW1lc3BhY2UKCQkgKiBAbmFtZSBPV0YuTGFuZwoJCSAqLwoJCUxhbmc6IE96b25lLmxhbmcsCgkJCgkJVmVyc2lvbjogT3pvbmUudmVyc2lvbiwKCgkJLyoqCgkJCUFjY2VwdHMgYSBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIHdoZW4gT3pvbmUgQVBJcyBhcmUgcmVhZHkgZm9yIHVzZQoJCQlAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiBPV0YgQVBJcyBhcmUgcmVhZHkKCQkJQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBzY29wZSAodGhpcyByZWZlcmVuY2UpIGluIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBleGVjdXRlZC4gSWYgb21pdHRlZCwgZGVmYXVsdHMgdG8gdGhlIGJyb3dzZXIgd2luZG93LgoJCSovCgkJcmVhZHk6IGZ1bmN0aW9uKGhhbmRsZXIsIHNjb3BlKSB7CgoJCQlpZihoYW5kbGVyID09PSB1bmRlZmluZWQpIHsKCQkJCXRocm93ICdFcnJvcjogbm8gYXJndW1lbnRzIHBhc3NlZCc7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCWlmKHR5cGVvZiBoYW5kbGVyICE9PSAnZnVuY3Rpb24nKSB7CgkJCQl0aHJvdyAnRXJyb3I6IGhhbmRsZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJzsKCQkJCXJldHVybjsKCQkJfQoKCQkJaXNSZWFkeSA9PT0gdHJ1ZSA/IGhhbmRsZXIuY2FsbChzY29wZSkgOiByZWFkeUxpc3QucHVzaCgge2ZuOiBoYW5kbGVyLCBzY29wZTogc2NvcGV9ICk7CgoJCX0sCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgY2FsbGVkIG9uY2UgdGhlIHdpZGdldCBpcyByZWFkeSBhbmQgYWxsIGluaXRpYWxpemF0aW9uIGlzIGNvbXBsZXRlZC4gIFRoaXMgd2lsbCBzZW5kIGEKICAgICAgICogbWVzc2FnZSB0byB0aGUgY29udGFpbmVyIHdoaWNoIGluIHR1cm4gbWF5IG5vdGlmeSBvdGhlciB3aWRnZXRzCiAgICAgICAqLwogICAgICAgIG5vdGlmeVdpZGdldFJlYWR5OiBmdW5jdGlvbigpIHsKICAgICAgICAgIC8vc2VuZCBhIG1lc3NhZ2UgdG8gY29udGFpbmVyIHRoYXQgdGhpcyB3aWRnZXQgaXMgcmVhZHkKICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSwgbnVsbCwgT1dGLmdldEluc3RhbmNlSWQoKSk7CiAgICAgICAgfSwKCgkJLyoqCgkJCVJldHVybnMgZGVmaW5pdGlvbiBHVUlEIG9mIHRoZSB3aWRnZXQuIFRoaXMgaXMgYXV0byBnZW5lcmF0ZWQgYnkgT1dGIHdoZW4gdGhlIHdpZGdldCB3YXMgYnJvdWdodCBpbiBhbiBPV0YgaW5zdGFuY2UuCgkJKi8KCQlnZXRXaWRnZXRHdWlkIDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQuZ3VpZDsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyBpbnN0YW5jZSBHVUlEIG9mIHRoZSB3aWRnZXQuCgkJKi8KCQlnZXRJbnN0YW5jZUlkIDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQuaWQ7CgkJfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIFdpZGdldCBJZAogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSB3aWRnZXRJZCBpcyBhIGNvbXBsZXggSlNPTiBlbmNvZGVkIHN0cmluZyB3aGljaCBpZGVudGlmaWVzIGEgd2lkZ2V0IGZvciBFdmVudGluZy4KICAgICAgICAgKiAgIEVtYmVkZGVkIGluIHRoaXMgc3RyaW5nIGlzIHRoZSB3aWRnZXQncyB1bmlxdWVJZCBhcyB0aGUgJ2lkJyBhdHRyaWJ1dGUuICBUaGVyZSBpcyBvdGhlciBkYXRhIGlzIGluIHRoZSBzdHJpbmcKICAgICAgICAgKiAgIHdoaWNoIGlzIG5lZWRlZCBmb3IgRXZlbnRpbmcgYW5kIG90aGVyIEFQSXMgdG8gZnVuY3Rpb24gcHJvcGVybHkuIFRoaXMgY29tcGxleCB3aWRnZXRJZCBzdHJpbmcgbWF5IGJlIHVzZWQgaW4KICAgICAgICAgKiAgIHRoZSA8YSBocmVmPSIuL09XRi5FdmVudGluZy5odG1sIy5wdWJsaXNoIj5PV0YuRXZlbnRpbmcucHVibGlzaDwvYT4gZnVuY3Rpb24gdG8gZGVzaWduYXRlIGEgc3BlY2lmaWMgcmVjaXBpZW50IGZvciBhIG1lc3NhZ2UuCiAgICAgICAgICogICBBZGRpdGlvbmFsbHksIG9uY2Ugc3Vic2NyaWJlZCB0byBhIGNoYW5uZWwgdmlhIDxhIGhyZWY9Ii4vT1dGLkV2ZW50aW5nLmh0bWwjLnN1YnNjcmliZSI+T1dGLkV2ZW50aW5nLnN1YnNjcmliZTwvYT4gZHVyaW5nIHRoZQogICAgICAgICAqICAgcmVjZWlwdCBvZiBhIG1lc3NhZ2UsIHRoZSBzZW5kZXIncyB3aWRnZXRJZCBpcyBtYWRlIGF2YWlsYWJsZSBhcyB0aGUgZmlyc3QgYXJndW1lbnQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24uCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiAvL2RlY29kZSBhbmQgcmV0cmlldmUgdGhlIHdpZGdldCdzIHVuaXF1ZSBpZAogICAgICAgICAqIHZhciBjb21wbGV4SWRTdHJpbmcgPSBPV0YuZ2V0SWZyYW1lSWQoKTsKICAgICAgICAgKiB2YXIgY29tcGxleElkT2JqID0gb3dmZG9qby50b0pzb24oY29tcGxleElkU3RyaW5nKTsKICAgICAgICAgKgogICAgICAgICAqIC8vY29tcGxleElkT2JqIHdpbGwgbG9vayBsaWtlCiAgICAgICAgICogLy8gewogICAgICAgICAqIC8vICAvL3dpZGdldCdzIHVuaXF1ZUlkCiAgICAgICAgICogLy8gIGlkOiI0OWNkMjFmMC0zMTEwLTgxMjEtZDkwNS0xOGZmYTgxYjQ0MmUiCiAgICAgICAgICogLy8gfQogICAgICAgICAqCiAgICAgICAgICogLy9nZXQgV2lkZ2V0J3MgdW5pcXVlSWQKICAgICAgICAgKiBhbGVydCgnd2lkZ2V0IGlkID0gJyArIGNvbXBsZXhJZE9iai5pZCk7CiAgICAgICAgICovCgkJZ2V0SWZyYW1lSWQgOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuICd7XCJpZFwiOlwiJyArIHdpZGdldC5pZCArICdcIn0nOwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIHR5cGUgb2YgZGFzaGJvYXJkIGluIHdoaWNoIHRoZSB3aWRnZXQgaXMgb3BlbmVkLiBbcG9ydGFsLCBkZXNrdG9wLCBhY2NvcmRpb24sIHRhYmJlZF0KCQkqLwoJCWdldERhc2hib2FyZExheW91dCA6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LmxheW91dDsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyB2ZXJzaW9uIG9mIHRoZSB3aWRnZXQuCgkJKi8KCQlnZXRWZXJzaW9uIDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQudmVyc2lvbjsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyBVUkwgb2YgdGhlIHdpZGdldC4KCQkqLwoJCWdldFVybCA6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LnVybDsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBvbiB0aGUgY3VycmVudCBPV0YgdGhlbWUKCQkJQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgYmVsb3c6IDxicj4KCQkJeyA8YnI+CgkJCQkvL25hbWUgb2YgdGhlIHRoZW1lIDxicj4KCQkJCXRoZW1lTmFtZTogJ3RoZW1lLW5hbWUnLCA8YnI+CgkJCQk8YnI+CgkJCQkvL2Rlc2NyaWJlcyBjb2xvciBjb250cmFzdCBvZiB0aGUgdGhlbWUuICBUaGlzIG1heSBiZSBvbmUgb2YgMyB2YWx1ZXM6IDxicj4KCQkJCS8vICdzdGFuZGFyZCcgKGNvbG9ycyBwcm92aWRlIG5vIHNwZWNpYWwgY29udHJhc3QpIDxicj4KCQkJCS8vICdibGFjay1vbi13aGl0ZScgKGJsYWNrIG9uIHdoaXRlIGNvbG9yIGNvbnRyYXN0KSA8YnI+CgkJCQkvLyAnd2hpdGUtb24tYmxhY2snICh3aGl0ZSBvbiBibGFjayBjb2xvciBjb250cmFzdCkgPGJyPgoJCQkJdGhlbWVDb250cmFzdDogJ2JsYWNrLW9uLXdoaXRlJywgPGJyPgoJCQkJPGJyPgoJCQkJLy90aGlzIGZpZWxkIGlzIGEgbnVtYmVyIG9mIHRoZSBmb250U2l6ZSBpbiBwaXhlbHMgPGJyPgoJCQkJdGhlbWVGb250U2l6ZTogMTIgPGJyPgoJCQl9CgkJCUBleGFtcGxlCgkJCXZhciB0aGVtZU9iaiA9IE9XRi5nZXRDdXJyZW50VGhlbWUoKTsKCQkqLwoJCWdldEN1cnJlbnRUaGVtZSA6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LmN1cnJlbnRUaGVtZTsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgQ29udGFpbmVyIHRoZSBXaWRnZXQgaXMgaW4KCQkqLwoJCWdldENvbnRhaW5lck5hbWU6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LmNvbnRhaW5lck5hbWU7CgkJfSwKCQkKCQkvKioKCQkJUmV0dXJucyB0aGUgdmVyc2lvbiBvZiB0aGUgQ29udGFpbmVyIHRoZSBXaWRnZXQgaXMgaW4KCQkqLwoJCWdldENvbnRhaW5lclZlcnNpb246IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LmNvbnRhaW5lclZlcnNpb247CgkJfSwKCgkJLyoqCgkJCVJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGRhc2hib2FyZCBpbiB3aGljaCB0aGUgd2lkZ2V0IGlzIG9wZW5lZCBpcyBsb2NrZWQuIAoJCSovCgkJaXNEYXNoYm9hcmRMb2NrZWQgOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHdpZGdldC5sb2NrZWQ7CgkJfSwKCgkJLyoqCgkJUmV0dXJucyB0aGUgVVJMIG9mIHRoZSBDb250YWluZXIgdGhlIFdpZGdldCBpcyBpbgoJCSovCgkJZ2V0Q29udGFpbmVyVXJsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9maWd1cmUgb3V0IGZyb20gcHJlZmVyZW5jZSBsb2NhdGlvbgoJCQl2YXIgcHJlZiA9IHdpZGdldC5wcmVmZXJlbmNlTG9jYXRpb247CiAgICAgICAgICAgIHJldHVybiBwcmVmLnN1YnN0cmluZygwLCBwcmVmLmxlbmd0aCAtIDYpOwoJCX0sCgoJCS8qKgoJCQlHZXRzIGFsbCBvcGVuZWQgd2lkZ2V0cyBvbiB0aGUgY3VycmVudCBkYXNoYm9hcmQuCgoJCQlAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIHdoZW4gb3BlbmVkIHdpZGdldHMgYXJlIHJldHJpZXZlZCBmcm9tIE9XRi4gRnVuY3Rpb24gaXMgcGFzc2VkIGFuIGFycmF5IG9mIG9iamVjdHMgd2l0aCB0aGUgc3RydWN0dXJlIGJlbG93OiA8YnI+CgkJCXs8YnI+CgkJCQlpZDogJ2luc3RhbmNlIGd1aWQgb2Ygd2lkZ2V0Jyw8YnI+CgkJCQlmcmFtZUlkOiAnaWZyYW1lIGlkIG9mIHdpZGdldCcsPGJyPgoJCQkJd2lkZ2V0R3VpZDogJ3dpZGdldCBndWlkIG9mIHRoZSB3aWRnZXQnLDxicj4KCQkJCXVybDogJ3VybCBvZiB0aGUgd2lkZ2V0Jyw8YnI+CgkJCQluYW1lOiAnbmFtZSBvZiB0aGUgd2lkZ2V0Jzxicj4KICAgICAgICAgICAgICAgIHVuaXZlcnNhbE5hbWU6ICd1bml2ZXJzYWwgbmFtZSBvZiB0aGUgd2lkZ2V0Jzxicj4KCQkJfTxicj4KCQkJQGV4YW1wbGUKCQkJT1dGLmdldE9wZW5lZFdpZGdldHMoZnVuY3Rpb24ob3BlbmVkV2lkZ2V0cykgewoJCQkJCgkJCX0pOwoJCSovCgkJZ2V0T3BlbmVkV2lkZ2V0czogZnVuY3Rpb24oZm4pIHsKCQkJCgkJCWlmKGZuID09PSB1bmRlZmluZWQpIHsKCQkJCXRocm93ICdFcnJvcjogbm8gYXJndW1lbnRzIHBhc3NlZCc7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykgewoJCQkJdGhyb3cgJ0Vycm9yOiBmbiBtdXN0IGJlIGEgZnVuY3Rpb24nOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlPem9uZS5ldmVudGluZy5nZXRBbGxXaWRnZXRzKGZuKTsKCQl9Cgl9KTsKCgkvLyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCU96b25lLldpZGdldCA9IE9XRjsKCglPV0YuX2luaXQgPSBmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKCiAgICAgICAgaWYgKE9XRi5yZWxheUZpbGUgIT0gbnVsbCkgewogICAgICAgICAgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LndpZGdldFJlbGF5VVJMID0gT1dGLnJlbGF5RmlsZTsKICAgICAgICB9CgoJCS8vIEV2ZW50aW5nIEFQSQoJCWZ1bmN0aW9uIGluaXRFdmVudGluZygpIHsKCQkJZm9yKHZhciBpID0gMCwgbWV0aG9kcyA9IFsncHVibGlzaCcsICdzdWJzY3JpYmUnLCAndW5zdWJzY3JpYmUnXSA7IGkgPCBtZXRob2RzLmxlbmd0aCA7IGkrKykgewoJCQkJT1dGLkV2ZW50aW5nWyBtZXRob2RzW2ldIF0gPSB0aGlzWyBtZXRob2RzW2ldIF07CgkJCX0KCQl9CgoJCS8vIFJQQy9EaXJlY3RlZCBFdmVudGluZyBBUEkKCQlmdW5jdGlvbiBpbml0UlBDKCkgewoJCQlPV0YuUlBDLnJlZ2lzdGVyRnVuY3Rpb25zID0gT3pvbmUuZXZlbnRpbmcucmVnaXN0ZXJGdW5jdGlvbnM7CgkJCU9XRi5SUEMuZ2V0V2lkZ2V0UHJveHkgPSBPem9uZS5ldmVudGluZy5pbXBvcnRXaWRnZXQ7CgkJCU9XRi5SUEMuaGFuZGxlRGlyZWN0TWVzc2FnZSA9IGZ1bmN0aW9uKGZuKSB7CgkJCQlpZih0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHsKCQkJCQl0aHJvdyAnRXJyb3I6IGZuIG11c3QgYmUgYSBmdW5jdGlvbic7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJT3pvbmUuZXZlbnRpbmcuaGFuZGxlRGlyZWN0TWVzc2FnZSA9IGZuOwoJCQl9OwoJCX0KCgkJLy8gUHJlZmVyZW5jZXMgQVBJCgkJZnVuY3Rpb24gaW5pdFByZWZlcmVuY2VzKCkgewoJCQlmb3IodmFyIGkgaW4gT3pvbmUucHJlZi5QcmVmU2VydmVyKSB7CgkJCQlpZih0eXBlb2YgT3pvbmUucHJlZi5QcmVmU2VydmVyWyBpIF0gPT09ICdmdW5jdGlvbicpCgkJCQkJT1dGLlByZWZlcmVuY2VzWyBpIF0gPSBPem9uZS5wcmVmLlByZWZTZXJ2ZXJbIGkgXTsKCQkJfQoJCX0KCgkJLy8gTGF1bmNoaW5nIEFQSQoJCWZ1bmN0aW9uIGluaXRMYXVuY2hlcigpIHsKCQkJT1dGLkxhdW5jaGVyLmxhdW5jaCA9IGxhdW5jaGluZ0NvbnRyb2xsZXIubGF1bmNoV2lkZ2V0OwoJCQlPV0YuTGF1bmNoZXIuZ2V0TGF1bmNoRGF0YSA9IE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyVXRpbHMuZ2V0TGF1bmNoQ29uZmlnRGF0YTsKCQl9CgoJCS8vIERyYWcgYW5kIERyb3AgQVBJCgkJZnVuY3Rpb24gaW5pdERyYWdBbmREcm9wKCkgewoJCQlPV0YuRHJhZ0FuZERyb3AgPSB7CgkJCQlvbkRyYWdTdGFydDogZnVuY3Rpb24oY2FsbGJhY2ssIHNjb3BlKSB7CgkJCQkJZHJhZ0FuZERyb3BDb250cm9sbGVyLmFkZENhbGxiYWNrKCdkcmFnU3RhcnQnLCBvd2Zkb2pvLmhpdGNoKHNjb3BlLCBjYWxsYmFjaykpOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQlvbkRyYWdTdG9wOiBmdW5jdGlvbihjYWxsYmFjaywgc2NvcGUpIHsKCQkJCQlkcmFnQW5kRHJvcENvbnRyb2xsZXIuYWRkQ2FsbGJhY2soJ2RyYWdTdG9wJywgb3dmZG9qby5oaXRjaChzY29wZSwgY2FsbGJhY2spKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJb25Ecm9wOiBmdW5jdGlvbihjYWxsYmFjaywgc2NvcGUpIHsKCQkJCQlkcmFnQW5kRHJvcENvbnRyb2xsZXIuYWRkQ2FsbGJhY2soJ2Ryb3BSZWNlaXZlJywgb3dmZG9qby5oaXRjaChzY29wZSwgY2FsbGJhY2spKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJc3RhcnREcmFnOiBmdW5jdGlvbihjZmcpIHsKCQkJCQlkcmFnQW5kRHJvcENvbnRyb2xsZXIuZG9TdGFydERyYWcoY2ZnKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCQkJfTsKCgkJCWZvcih2YXIgaSA9IDAsIG1ldGhvZHMgPSBbJ2FkZERyb3Bab25lSGFuZGxlcicsICdnZXREcmFnU3RhcnREYXRhJywgJ2dldERyb3BFbmFibGVkJywgJ3NldERyb3BFbmFibGVkJywgJ2lzRHJhZ2dpbmcnLCAnZ2V0Rmxhc2hXaWRnZXRJZCcsICdzZXRGbGFzaFdpZGdldElkJ10gOyBpIDwgbWV0aG9kcy5sZW5ndGggOyBpKyspIHsKCQkJCQoJCQkJT1dGLkRyYWdBbmREcm9wWyBtZXRob2RzW2ldIF0gPSBmdW5jdGlvbiggbWV0aG9kTmFtZSApIHsKCQkJCQkKCQkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBkcmFnQW5kRHJvcENvbnRyb2xsZXJbbWV0aG9kTmFtZV0uYXBwbHkoZHJhZ0FuZERyb3BDb250cm9sbGVyLCBhcmd1bWVudHMpOwoJCQkJCX07CgoJCQkJfSggbWV0aG9kc1tpXSApOwoJCQkKCQkJfQoJCX0KCgkJLy8gQ2hyb21lIEFQSQoJCWZ1bmN0aW9uIGluaXRDaHJvbWUoKSB7CgkJCWZvcih2YXIgaSA9IDAsIAoJCQkJbWV0aG9kcyA9IFsnYWRkSGVhZGVyQnV0dG9ucycsICdhZGRIZWFkZXJNZW51cycsICdpbnNlcnRIZWFkZXJCdXR0b25zJywgJ2luc2VydEhlYWRlck1lbnVzJywKICAgICAgICAgICAgICAgICAgICAnaXNNb2RpZmllZCcsICdsaXN0SGVhZGVyQnV0dG9ucycsICdsaXN0SGVhZGVyTWVudXMnLCAncmVtb3ZlSGVhZGVyQnV0dG9ucycsICdyZW1vdmVIZWFkZXJNZW51cycsCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZUhlYWRlckJ1dHRvbnMnLCAndXBkYXRlSGVhZGVyTWVudXMnLCAnZ2V0VGl0bGUnLCAnc2V0VGl0bGUnXSA7IGkgPCBtZXRob2RzLmxlbmd0aCA7IGkrKykgewoJCQkJT1dGLkNocm9tZVsgbWV0aG9kc1tpXSBdID0gY2hyb21lQ29udHJvbGxlclsgbWV0aG9kc1tpXSBdOwoJCQl9CgkJfQoKCQlldmVudGluZ0NvbnRyb2xsZXIgPSBPem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0SW5zdGFuY2UoZnVuY3Rpb24oKSB7CgoJCQlkcmFnQW5kRHJvcENvbnRyb2xsZXIgPSBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5nZXRJbnN0YW5jZSh7CgkJCQl3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXI6IHRoaXMKCQkJfSk7CgkJCWxhdW5jaGluZ0NvbnRyb2xsZXIgPSBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5nZXRJbnN0YW5jZSgpOwoJCQljaHJvbWVDb250cm9sbGVyID0gT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5nZXRJbnN0YW5jZSh7CgkJCQl3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXI6IHRoaXMKCQkJfSk7CgoJCQlpbml0RXZlbnRpbmcuY2FsbCh0aGlzKTsKCQkJaW5pdFJQQygpOwoJCQlpbml0UHJlZmVyZW5jZXMoKTsKCQkJaW5pdExhdW5jaGVyKCk7CgkJCWluaXREcmFnQW5kRHJvcCgpOwoJCQlpbml0Q2hyb21lKCk7CgoJCQlPem9uZS5jb21wb25lbnRzLmtleXMuY3JlYXRlS2V5RXZlbnRTZW5kZXIodGhpcyk7CgoJCQkvLyBleGVjdXRlIHJlYWR5IGxpc3RlbmVycwoJCQlpc1JlYWR5ID0gdHJ1ZTsKCQkJZm9yKHZhciBpID0gMCwgbGVuID0gcmVhZHlMaXN0Lmxlbmd0aCA7IGkgPCBsZW4gOyBpKyspIHsKCQkJCXJlYWR5TGlzdFtpXS5mbi5jYWxsKHJlYWR5TGlzdFtpXS5zY29wZSk7CgkJCX0KCgkJfSk7CgoJfTsKCn0od2luZG93LCBkb2N1bWVudCkpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLSBFdmVudGluZyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyoqCiAqIEBuYW1lIHJlbGF5RmlsZQogKiBAbWVtYmVyT2YgT1dGCiAqIEBkZXNjcmlwdGlvbiBUaGUgbG9jYXRpb24gb2YgdGhlIHdpZGdldCByZWxheSBmaWxlLiAgVGhlIHJlbGF5IGZpbGUgc2hvdWxkIGJlIGRlZmluZWQKICogICBnbG9iYWxseSBmb3IgdGhlIGVudGlyZSB3aWRnZXQgYnkgc2V0dGluZyBPV0YucmVsYXlGaWxlIHRvIHRoZSByZWxheSBmaWxlIHVybCwgaW1tZWRpYXRlbHkgYWZ0ZXIKICogICBpbmNsdWRpbmcgdGhlIHdpZGdldCBidW5kbGUgamF2YXNjcmlwdC4gIElmIHRoZSByZWxheSBpcyBub3QgZGVmaW5lZCBhdCBhbGwgaXQgaXMgYXNzdW1lZCB0byBiZSBhdAogKiAgIC9bY29udGV4dF0vanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sLiBUaGUgcmVsYXkgZmlsZSBtdXN0IGJlIHNwZWNpZmllZCB3aXRoIGZ1bGwgbG9jYXRpb24gZGV0YWlscywgYnV0IHdpdGhvdXQgYSBmdWxseQogKiAgIHF1YWxpZmllZCBwYXRoLiBJbiB0aGUgY2FzZSB3aGVyZSB0aGUgcmVsYXkgaXMgcmVzaWRpbmcgQCBodHRwOi8vc2VydmVyL3BhdGgvcmVsYXkuaHRtbCwgdGhlIHBhdGggdXNlZCBtdXN0IGJlIGZyb20gdGhlIGNvbnRleHQgcm9vdCBvZiB0aGUgbG9jYWwKICogICB3aWRnZXQuIEluIHRoaXMgY2FzZSwgaXQgd291bGQgYmUgL3BhdGgvcmVsYXkuaHRtbC4gIERvIG5vdCBpbmNsdWRlIHRoZSBwcm90b2NvbC4KICogQHNpbmNlIE9XRiA1LjAuMAogKiBAZXhhbXBsZQogKiAmbHQ7c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSIuLi8uLi9qcy1taW4vb3dmLXdpZGdldC1taW4uanMiJmd0OyZsdDsvc2NyaXB0Jmd0OwogKiAmbHQ7c2NyaXB0Jmd0OwogKiAgICAgICAvL1RoZSBsb2NhdGlvbiBpcyBhc3N1bWVkIHRvIGJlIGF0IC9bY29udGV4dF0vanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sIGlmIGl0IGlzIG5vdAogKiAgICAgICAvL3NldCB0aGUgcGF0aCBjb3JyZWN0bHkgYmVsb3cKICogICAgICAgT1dGLnJlbGF5RmlsZSA9ICcvb3dmL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbCc7CiAqICAgICAgIC8vLi4uCiAqICZsdDsvc2NyaXB0Jmd0OwogKgogKi8KCi8qKgoJU3Vic2NyaWJlIHRvIGEgbmFtZWQgY2hhbm5lbCBmb3IgYSBnaXZlbiBmdW5jdGlvbi4KCUBuYW1lIHN1YnNjcmliZQoJQG1ldGhvZE9mIE9XRi5FdmVudGluZwoKCUBwYXJhbSB7U3RyaW5nfSBjaGFubmVsTmFtZSBUaGUgY2hhbm5lbCB0byBzdWJzY3JpYmUgdG8uCglAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBmdW5jdGlvbiB5b3Ugd2lzaCB0byBzdWJzY3JpYmUuICBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhyZWUKCQlhcmd1bWVudHM6IHNlbmRlciwgbXNnLCBjaGFubmVsLgoJQHBhcmFtIHtTdHJpbmd9IFtoYW5kbGVyLnNlbmRlcl0gVGhlIGZpcnN0IGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaWQgb2YgdGhlIHNlbmRlciBvZiB0aGUgbWVzc2FnZS4gU2VlIDxhIGhyZWY9Ik9XRi5odG1sIy5nZXRJZnJhbWVJZCI+T1dGLmdldElmcmFtZUlkPC9hPiBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGlzIGlkLgoJQHBhcmFtIHtPYmplY3R9IFtoYW5kbGVyLm1zZ10gVGhlIHNlY29uZCBhcmd1bWVudCBwYXNzZWQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24gaXMgdGhlIG1lc3NhZ2UgaXRzZWxmLgoJQHBhcmFtIHtTdHJpbmd9IFtoYW5kbGVyLmNoYW5uZWxdIFRoZSB0aGlyZCBhcmd1bWVudCBwYXNzZWQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24gaXMgdGhlIGNoYW5uZWwgdGhlIG1lc3NhZ2Ugd2FzIHB1Ymxpc2hlZCBvbi4KCQkKCUBleGFtcGxlCk9XRi5FdmVudGluZy5zdWJzY3JpYmUoIkNsb2NrQ2hhbm5lbCIsIHRoaXMudXBkYXRlKTsKdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKHNlbmRlciwgbXNnLCBjaGFubmVsKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudFRpbWUnKS5pbm5lckhUTUwgPSBtc2c7Cn0KICovCgovKioKCVVuc3Vic2NyaWJlIHRvIGEgbmFtZWQgY2hhbm5lbC4KCUBuYW1lIHVuc3Vic2NyaWJlCglAbWV0aG9kT2YgT1dGLkV2ZW50aW5nCgoJQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBjaGFubmVsIHRvIHVuc3Vic2NyaWJlIHRvLgoJCglAZXhhbXBsZQpPV0YuRXZlbnRpbmcudW5zdWJzY3JpYmUoIkNsb2NrQ2hhbm5lbCIpOwogKi8KCi8qKgoJUHVibGlzaGVzIGEgbWVzc2FnZSB0byBhIGdpdmVuIGNoYW5uZWwuCglAbmFtZSBwdWJsaXNoCglAbWV0aG9kT2YgT1dGLkV2ZW50aW5nCgoJQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBuYW1lIG9mIHRoZSBjaGFubmVsIHRvIHB1Ymxpc2ggdG8KCUBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHB1Ymxpc2ggdG8gdGhlIGNoYW5uZWwuCglAcGFyYW0ge1N0cmluZ30gW2Rlc3RdIFRoZSBpZCBvZiBhIHBhcnRpY3VsYXIgZGVzdGluYXRpb24uICBEZWZhdWx0cyB0byBudWxsIHdoaWNoIHNlbmRzIHRvIGFsbAoJCXN1YnNjcmliZXJzIG9uIHRoZSBjaGFubmVsLiAgU2VlIDxhIGhyZWY9Ik9XRi5odG1sIy5nZXRJZnJhbWVJZCI+T1dGLmdldElmcmFtZUlkPC9hPgoJCWZvciBhIGRlc2NyaXB0aW9uIG9mIHRoZSBpZC4KCQoJQGV4YW1wbGUKT1dGLkV2ZW50aW5nLnB1Ymxpc2goIkNsb2NrQ2hhbm5lbCIsIGN1cnJlbnRUaW1lU3RyaW5nKTsKKi8KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0gUlBDIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovKioKCVJlZ2lzdGVyIG9uZSBvciBtb3JlIGZ1bmN0aW9ucyB0byBPV0YgdG8gZXhwb3NlIHRvIG90aGVyIHdpZGdldHMuCglAbmFtZSByZWdpc3RlckZ1bmN0aW9ucwoJQG1ldGhvZE9mIE9XRi5SUEMKCglAcGFyYW0ge09iamVjdC9BcnJheX0gb2JqcyBPYmplY3Qgb3IgYW4gYXJyYXkgb2Ygb2JqZWN0cyBvZiBmb2xsb3dpbmcgc3RydWN0dXJlLjxiciAvPgoJCXs8YnIgLz4KCQkJbmFtZTogJ25hbWUgb2YgdGhlIGZ1bmN0aW9uJywgPGJyIC8+CgkJCWZuOiBmdW5jdGlvbigpIHt9LCA8YnIgLz4KCQkJc2NvcGU6IHdpbmRvdyAvL1RoZSBzY29wZSAodGhpcyByZWZlcmVuY2UpIGluIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBleGVjdXRlZC4gSWYgb21pdHRlZCwgZGVmYXVsdHMgdG8gdGhlIGJyb3dzZXIgd2luZG93LjxiciAvPgoJCX08YnIgLz4KCglAZXhhbXBsZQpDYWxjdWxhdG9yID0gewoJYWRkOiBmdW5jdGlvbigpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cywKCQkJdmFsID0gMDsKCQlmb3IodmFyIGkgPSAwLCBsZW4gPSBhcmdzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXZhbCArPSBwYXJzZUZsb2F0KGFyZ3NbaV0pOwoJCX0KCQlyZXR1cm4gdmFsOwoJfSwKCW11bHRpcGx5OiBmdW5jdGlvbigpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cywKCQkJdmFsID0gMTsKCQlmb3IodmFyIGkgPSAwLCBsZW4gPSBhcmdzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXZhbCAqPSBwYXJzZUZsb2F0KGFyZ3NbaV0pOwoJCX0KCQlyZXR1cm4gdmFsOwoJfQp9OwpPV0YuUlBDLnJlZ2lzdGVyRnVuY3Rpb25zKFsKCXsKCQluYW1lOiAnYWRkJwoJCWZuOiBDYWxjdWxhdG9yLmFkZCwKCQlzY29wZTogQ2FsY3VsYXRvcgoJfSwKCXsKCQluYW1lOiAnbXVsdGlwbHknCgkJZm46IENhbGN1bGF0b3IubXVsdGlwbHksCgkJc2NvcGU6IENhbGN1bGF0b3IKCX0KXSk7CiovCgovKioKCUdldHMgYSBwcm94eSBvYmplY3QgdGhhdCBjb250YWlucyBtZXRob2RzIGV4cG9zZWQgYnkgb3RoZXIgd2lkZ2V0LgoJQG5hbWUgZ2V0V2lkZ2V0UHJveHkKCUBtZXRob2RPZiBPV0YuUlBDCgoJQHBhcmFtIHtTdHJpbmd9IGluc3RhbmNlR3VpZCBpbnN0YW5jZSBndWlkIG9mIHRoZSB3aWRnZXQgdG8gaW1wb3J0CglAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgaWYgdGhlIHdpZGdldCBpcyBmb3VuZCBvcGVuZWQgb24gdGhlIGN1cnJlbnQgZGFzaGJvYXJkLiBUaGUgZnVuY3Rpb24gaXMgcGFzc2VkIGEgcHJveHkgb2JqZWN0IGFzIHRoZSBmaXJzdCBhcmd1bWVudCB3aGljaCB3aWxsIGNvbnRhaW4gbWV0aG9kcyB0aGF0IHdlcmUgZXhwb3NlZCBieSB0aGUgd2lkZ2V0LiBJbiBhZGRpdGlvbiwgdGhlIHByb3h5IGFiamVjdCBhbHNvIGhhcyBzZW5kTWVzc2FnZSBtZXRob2QgdG8gc2VuZCBhIGRpcmVjdCBtZXNzYWdlIHRvIHRoZSB3aWRnZXQuCgoJQGV4YW1wbGUKT1dGLlJQQy5nZXRXaWRnZXRQcm94eSgnaW5zdGFuY2VHdWlkIG9mIHdpZGdldEEnLCBmdW5jdGlvbih3aWRnZXRBKSB7CgoJd2lkZ2V0QS5hZGQoMSwyLDMsIGZ1bmN0aW9uKHJlc3VsdCkgewoJCWNvbnNvbGUubG9nKHJlc3VsdCk7IC8vIGxvZyB0aGUgcmVzdWx0Cgl9KQoKCXdpZGdldEEuc2VuZE1lc3NhZ2UoJ3NvbWUgc2VjcmV0IG1lc3NhZ2UnKTsKCn0pOwoqLwoKLyoqCglSZWdpc3RlciBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gYSBkaXJlY3QgbWVzc2FnZSBpcyByZWNlaXZlZCBmcm9tIGFub3RoZXIgd2lkZ2V0LgoJQG5hbWUgaGFuZGxlRGlyZWN0TWVzc2FnZQoJQG1ldGhvZE9mIE9XRi5SUEMKCglAcGFyYW0ge0Z1bmN0aW9ufSBmbiBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgd2hlbiBhIGRpcmVjdCBtZXNzYWdlIGlzIHJlY2VpdmVkIGZyb20gYW5vdGhlciB3aWRnZXQuCgoJQGV4YW1wbGUKT1dGLlJQQy5oYW5kbGVEaXJlY3RNZXNzYWdlKGZ1bmN0aW9uKG1zZykgewoJLy8gZG8gc29tZXRoaW5nIHdpdGggdGhlIG1lc3NhZ2UKfSk7CiovCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tIERyYWcgYW5kIERyb3AgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKioKCVVzZSB0aGlzIG1ldGhvZCB0byBzZXQgZmxleCBkb20gZWxlbWVudCBpZCwgc28gdGhhdCBkcmFnIGFuZCBkcm9wIGNhbiBiZSBlbmFibGVkIGluIGZsZXggd2lkZ2V0cy4KCUBuYW1lIHNldEZsYXNoV2lkZ2V0SWQKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKCglAcGFyYW0ge1N0cmluZ30gaWQgZG9tIGVsZW1lbnQgaWQgb2YgZmxleCB3aWRnZXQKKi8KCi8qKgoJU3RhcnRzIGEgZHJhZy4gIFRoZSBjb25maWcgb2JqZWN0IHBhc3NlZCBpbiBkZXNjcmliZXMgdGhlIGRyYWcgYW5kIGNvbnRhaW5zIHRoZSBkYXRhIHRvIGJlIHBhc3NlZCB0byB0aGUgZHJvcC4KCUBuYW1lIHN0YXJ0RHJhZwoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cKCUBwYXJhbSB7U3RyaW5nfSBjZmcuZHJhZ0Ryb3BMYWJlbCBOYW1lIHRvIGJlIHVzZWQgYXMgdGV4dCBmb3IgdGhlIGRyYWdEcm9wIGluZGljYXRvcgoJQHBhcmFtIHtPYmplY3R9IGNmZy5kcmFnRHJvcERhdGEgRGF0YSB0byBiZSBzZW50IG9uIGEgc3VjY2Vzc2Z1bCBkcmFnIGFuZCBkcm9wLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHNlbnQgdG8gdGhlCglzdWNjZXNzZnVsIHJlY2lwaWVudCBvZiB0aGUgZHJhZyAodGhlIGRyb3BSZWNlaXZlIGV2ZW50KS4gIEl0IHdpbGwgbm90IGJlIHNlbnQgZm9yIG90aGVyIGV2ZW50cy4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuZHJhZ1pvbmUgZG9tIG5vZGUgd2hpY2ggcHJlc2VudHMgYSBkcmFnWm9uZSB3aGljaCBpcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBkcmFnLiAgVGhpcyBwcm9wZXJ0eSBpcwoJb25seSBzYXZlZCBhbmQgdXNlZCBsb2NhbGx5IHRvIHRoZSB3aWRnZXQgdG8gaWRlbnRpZnkgd2hldGhlciBhIGRyYWdab25lIGlzIGluIGZhY3QgdGhlIG5vZGUgYXMgYSBkcm9wWm9uZS4gIEl0IHdpbGwgbm90IGJlCglzZW50IHRvIG90aGVyIGV2ZW50cyBjYWxsYmFja3MuCglAcGFyYW0ge09iamVjdH0gY2ZnLiogb3RoZXIgY3VzdG9tIHByb3BlcnRpZXMgbWF5IGJlIHNwZWNpZmllZCwgdGhlc2Ugd2lsbCBiZSBwYXNzZWQgYWxvbmcgdG8gZXZlbnQgaGFuZGxlcnMKCQoJQGV4YW1wbGUKLy9hZGQgaGFuZGxlciB0byB0ZXh0IGZpZWxkIGZvciBkcmFnZ2luZwpvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyYWdTb3VyY2UnKSwgJ29ubW91c2Vkb3duJywgdGhpcywgZnVuY3Rpb24oZSkgewoJZS5wcmV2ZW50RGVmYXVsdCgpOwoJdmFyIGRhdGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnSW5wdXRDaGFubmVsJykudmFsdWU7CglpZiAoZGF0YSkgewoJCU9XRi5EcmFnQW5kRHJvcC5zdGFydERyYWcoewoJCQlkcmFnRHJvcExhYmVsOiBkYXRhLAoJCQlkcmFnRHJvcERhdGE6IGRhdGEsCgkJCWRyYWdab25lOiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyYWdab25lJyksCgkJCWRyYWdEcm9wR3JvdXA6ICdsb2NhdGlvbicgIC8vZXh0cmEgcHJvcGVydHkgdG8gcGFzcyBhbG9uZwoJCX0pOwoJfQp9KTsKKi8KCgovKioKCUFkZHMgYSBuZXcgZHJvcCB6b25lIHRvIGJlIG1hbmFnZWQuICBUaGUgaGFuZGxlciBmdW5jdGlvbiBkZWZpbmVkIGluIHRoZSBjZmcgb2JqZWN0IHdpbGwgYmUgY2FsbGVkIHdoZW4KCWEgZHJvcCBvY2N1cnMgb3ZlciBhIGRvbSBub2RlIHdoaWNoIG1hdGNoZXMgdGhlIGlkIG9yIHRoZSBjbGFzc05hbWUgb3IgaXMgZXF1YWwgdG8gb3IgYSBjaGlsZCBvZiB0aGUgZHJvcFRhcmdldCBub2RlCglAbmFtZSBhZGREcm9wWm9uZUhhbmRsZXIKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93CglAcGFyYW0ge2NsYXNzTmFtZX0gY2ZnLmNsYXNzIGNsYXNzIG9mIHRoZSBkcm9wWm9uZQoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pZCBJZCBvZiB0aGUgZHJvcFpvbmUKCUBwYXJhbSB7Tm9kZX0gY2ZnLmRyb3Bab25lIEhUTUwgbm9kZSB3aGljaCByZXByZXNlbnRzIHRoZSBkcm9wWm9uZQoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmhhbmRsZXIgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gYSBkcm9wIG9jY3VycyBvdmVyIHRoZSBkcm9wWm9uZS4gIEEgbXNnIG9iamVjdCB3aWxsIGJlIHBhc3NlZCBpbgoKCUBleGFtcGxlCi8vRXhhbXBsZSBjZmcgT2JqZWN0CnsKCWlkOiAnbXlncmlkLTEnLAoJY2xhc3NOYW1lOiAnbXlncmlkQ2xhc3MnLAoJZHJvcFpvbmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wWm9uZScpLAoJaGFuZGxlcjogZnVuY3Rpb24obXNnKSB7CgkJLy9zb21lIGNvZGUgaGVyZSB0byBoYW5kbGUgdGhlIG1zZyBhbmQgcmVzcG9uZAoJfQp9CgovL0V4YW1wbGUgdXNhZ2Ugb2YgYWRkRHJvcFpvbmVIYW5kbGVyIHdoaWNoIGhhbmRsZXMgYSBkcm9wIHRoYXQgb2NjdXJzIG92ZXIgYW4gRXh0IEdyaWQgYW5kIGluc2VydHMgbmV3IGRhdGEgaW50bwovL3RoYXQgZ3JpZCBiYXNlZCBvbiB0aGUgZHJhZ2dlZCBkYXRhCk9XRi5EcmFnQW5kRHJvcC5hZGREcm9wWm9uZUhhbmRsZXIoewoJLy9kb20gbm9kZSBvZiBhbiBFeHQgZ3JpZAoJZHJvcFpvbmU6Z3JpZC5nZXRWaWV3KCkuc2Nyb2xsZXIuZG9tLAoKCS8vdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb25seSB3aGVuIGEgZHJvcCBvY2N1cnMgb3ZlciB0aGUgZ3JpZCAoaS5lLiB0aGUgbW91c2Ugd2FzIHJlbGVhc2VkIG92ZXIgdGhlIGdyaWQpCgloYW5kbGVyOiAoZnVuY3Rpb24obXNnKXsKCQoJCXZhciBzdG9yZSA9IGdyaWQuZ2V0U3RvcmUoKTsKCQl2YXIgcHJvY2Vzc2VkU2VsZWN0aW9ucyA9IFtdOwoJCXZhciBlcnJvck1zZyA9IG51bGw7CgoJCS8vbG9vcCB0aHJvdWdoIG1zZy5kcmFnRHJvcERhdGEgd2hpY2ggaXMgYW4gYXJyYXkgYW5kIGNoZWNrIGZvciBkdXBlcyB2ZXJzdXMgdGhlIGRlc3RpbmF0aW9uIHN0b3JlCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBtc2cuZHJhZ0Ryb3BEYXRhLmxlbmd0aDsgaSsrKSB7CgkJCS8vZ2V0IGRhdGEgZm9yIG9uZSBwb3NzaWJsZSBuZXcgcmVjb3JkIGluIHRoZSBkcmFnRHJvcERhdGEKCQkJdmFyIHJlY0RhdGEgPSBtc2cuZHJhZ0Ryb3BEYXRhW2ldOwoKCQkJLy9pcyBpdCBhbHJlYWR5IGluIHRoZSBkZXN0IEV4dCBTdG9yZT8KCQkJaWYgKHN0b3JlLmZpbmRFeGFjdCgnaWQnLHJlY0RhdGEuaWQpID49IDApIHsKCQkJCS8vZm91bmQgdGhlIHJlY29yZCBhbHJlYWR5IGluIHRoZSBzdG9yZQoJCQl9CgkJCWVsc2UgewoJCQkJLy9hZGQgbmV3IHJlY29yZCBiYXNlZCBvbiB0aGUgZHJhZ0Ryb3BEYXRhCgkJCQl2YXIgbmV3UmVjID0gbmV3IHN0b3JlLnJlY29yZFR5cGUocmVjRGF0YSk7CgkJCQkvL2NhbGxpbmcgYW4gZXh0ZXJuYWwgZnVuY3Rpb24gdG8gZGVjaWRlIHdoZXRoZXIgdG8gYWRkIHRoZSBuZXcgcmVjCgkJCQl2YXIgcnMgPSBkaXNwbGF5UGFuZWwudmFsaWRhdGVSZWNvcmRPbkFkZChuZXdSZWMpOwoJCQkJaWYgKHJzLnN1Y2Nlc3MpIHsKCQkJCQlwcm9jZXNzZWRTZWxlY3Rpb25zLnB1c2gobmV3UmVjKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWVycm9yTXNnID0gcnMubXNnOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoZXJyb3JNc2cpIHsKCQkJRXh0Lk1zZy5hbGVydCgnRXJyb3InLCBlcnJvck1zZyk7CgkJfQoKCQkvL2FjdHVhbGx5IGluc2VydCBpbnRvIHRoZSBzdG9yZSB3aGljaCBhZGRzIGl0IHRoZSBuZXcgcmVjcyB0byB0aGUgZ3JpZAoJCWlmIChwcm9jZXNzZWRTZWxlY3Rpb25zLmxlbmd0aCA+IDApIHsKCQkJc3RvcmUuaW5zZXJ0KDAsIHByb2Nlc3NlZFNlbGVjdGlvbnMpOwoJCX0KCn0pLmNyZWF0ZURlbGVnYXRlKGdyaWQpfSk7ICAgLy9jcmVhdGVEZWxlZ2F0ZSBpcyBhbiBFeHQgZnVuY3Rpb24gd2hpY2ggc2V0cyB0aGUgc2NvcGUgb2YgdGhlIGNhbGxiYWNrCgoqLwoKCi8qKgoJUmV0dXJucyB3aGV0aGVyIHRoZSBhIGRyb3AgaXMgZW5hYmxlZCAodGhpcyBpcyBvbmx5IHRydWUgd2hlbiB0aGUgbW91c2UgaXMgb3ZlciBhIGRyb3Agem9uZSkKCUBuYW1lIGdldERyb3BFbmFibGVkCglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCiovCgovKioKCVJldHVybnMgd2hldGhlciBhIGRyYWcgaXMgaW4gcHJvZ3Jlc3MKCUBuYW1lIGlzRHJhZ2dpbmcKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKKi8KCi8qKgoJUmV0dXJucyBkYXRhIHNlbnQgd2hlbiBhIGRyYWcgd2FzIHN0YXJ0ZWQKCUBuYW1lIGdldERyYWdTdGFydERhdGEKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKKi8KCi8qKgoJVG9nZ2xlcyB0aGUgZHJhZ0luZGljYXRvciB0byBpbmRpY2F0ZSBzdWNjZXNzZnVsIG9yIHVuc3VjY2Vzc2Z1bCBkcm9wCglAbmFtZSBzZXREcm9wRW5hYmxlZAoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoKCUBwYXJhbSB7Qm9vbGVhbn0gZHJvcEVuYWJsZWQgdHJ1ZSB0byBlbmFibGUgYSBkcm9wLCBmYWxzZSB0byBpbmRpY2F0ZSBhIHVuc3VjY2Vzc2Z1bCBkcm9wCgkKCUBleGFtcGxlCi8vYXR0YWNoIG1vdXNlb3ZlciBjYWxsYmFjayB0byBhIHBhcnRpY3VsYXIgYXJlYS4gSWYgdGhlIG1vdXNlIGlzIGhlcmUgYWxsb3cgYSBkcm9wCmNtcC5nZXRWaWV3KCkuc2Nyb2xsZXIub24oJ21vdXNlb3ZlcicsZnVuY3Rpb24oZSx0LG8pIHsKCWlmIChjbXAuZHJhZ2dpbmcpIHsKCQlPV0YuRHJhZ0FuZERyb3Auc2V0RHJvcEVuYWJsZWQodHJ1ZSk7Cgl9Cn0sdGhpcyk7CgovL2F0dGFjaCBhIG1vdXNlIG91dCBjYWxsYmFjayB0byBhIHBhcnRpY3VsYXIgYXJlYS4gSWYgdGhlIG1vdXNlIGxlYXZlcyBkaXNhYmxlIGRyb3AKY21wLmdldFZpZXcoKS5zY3JvbGxlci5vbignbW91c2VvdXQnLGZ1bmN0aW9uKGUsdCxvKSB7CglpZiAoY21wLmRyYWdnaW5nKSB7CgkJT1dGLkRyYWdBbmREcm9wLnNldERyb3BFbmFibGVkKGZhbHNlKTsKCX0KfSx0aGlzKTsKICAgKi8KCgovKioKCUV4ZWN1dGVzIHRoZSBjYWxsYmFjayBwYXNzZWQgd2hlbiBhIGRyYWcgc3RhcnRzIGluIGFueSB3aWRnZXQuCglAbmFtZSBvbkRyYWdTdGFydAoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoJCglAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBhcyBhIGNhbGxiYWNrLgoJQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBzY29wZSAodGhpcyByZWZlcmVuY2UpIGluIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBleGVjdXRlZC4gSWYgb21pdHRlZCwgZGVmYXVsdHMgdG8gdGhlIGJyb3dzZXIgd2luZG93LgoKCUBleGFtcGxlCi8vZXhhbXBsZSBjYWxsYmFjaywgaGlnaGxpZ2h0cyBhbiBFeHQgR3JpZCB3aGVuIGEgZHJhZyBvY2N1cnMKT1dGLkRyYWdBbmREcm9wLm9uRHJhZ1N0YXJ0KGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7CgkvL2dldCB0aGUgRXh0IEdyaWQKCXZhciBncmlkID0gdGhpcy5nZXRDb21wb25lbnQodGhpcy5ncmlkSWQpOwoKCS8vY2hlY2sgY3VzdG9tIGRyYWdEcm9wR3JvdXAgcHJvcGVydHkgdG8gc2VlIGlmIHRoZSBkcmFnIGlzIG1lYW50IGZvciB0aGlzIGdyaWQKCS8vaWYgc28gaGlnaGxpZ2h0IHRoZSBncmlkIGJ5IGFkZGluZyB0aGUgZGRPdmVyIGNsYXNzCglpZiAoZ3JpZCAmJiBtc2cgIT0gbnVsbCAmJiBtc2cuZHJhZ0Ryb3BHcm91cCA9PSAndXNlcnMnKSB7CgkJZ3JpZC5nZXRWaWV3KCkuc2Nyb2xsZXIuYWRkQ2xhc3MoJ2RkT3ZlcicpOwoJfQp9LCB0aGlzKTsKKi8KCi8qKgoJRXhlY3V0ZXMgdGhlIGNhbGxiYWNrIHBhc3NlZCB3aGVuIGEgZHJhZyBzdG9wcyBpbiBhbnkgd2lkZ2V0LgoJQG5hbWUgb25EcmFnU3RvcAoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoJCglAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBhcyBhIGNhbGxiYWNrLgoJQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBzY29wZSAodGhpcyByZWZlcmVuY2UpIGluIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBleGVjdXRlZC4gSWYgb21pdHRlZCwgZGVmYXVsdHMgdG8gdGhlIGJyb3dzZXIgd2luZG93LgoKCUBleGFtcGxlCgpPV0YuRHJhZ0FuZERyb3Aub25EcmFnU3RvcChmdW5jdGlvbihzZW5kZXIsIG1zZykgewoJLy8gZG8gc29tZXRoaW5nIGhlcmUKfSwgdGhpcyk7CiovCgovKioKCUV4ZWN1dGVzIHRoZSBjYWxsYmFjayBwYXNzZWQgd2hlbiBhIGRyb3Agb2NjdXJzIGluIHRoZSB3aWRnZXQuIElmIG9uZSBoYXMgbXVsdGlwbGUgZHJvcFpvbmVzIGluIGEgd2lkZ2V0IGl0IGlzIGVhc2llciB0byB1c2UgPGEgaHJlZj0iI2FkZERyb3Bab25lSGFuZGxlciI+YWRkRHJvcFpvbmVIYW5kbGVyPC9hPgoJQG5hbWUgb25Ecm9wCglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCgkKCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBleGVjdXRlIGFzIGEgY2FsbGJhY2suCglAcGFyYW0ge09iamVjdH0gc2NvcGUgVGhlIHNjb3BlICh0aGlzIHJlZmVyZW5jZSkgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLiBJZiBvbWl0dGVkLCBkZWZhdWx0cyB0byB0aGUgYnJvd3NlciB3aW5kb3cuCgoJQGV4YW1wbGUKCk9XRi5EcmFnQW5kRHJvcC5vbkRyb3AoZnVuY3Rpb24oc2VuZGVyLCBtc2cpIHsKCXZhciBkYXRhID0gbXNnLmRyYWdEcm9wRGF0YTsKCgkvLyBkbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YSBoZXJlCn0sIHRoaXMpOwoJKi8KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0gTGF1bmNoZXIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovKioKCUxhdW5jaGVzIGEgV2lkZ2V0IGJhc2VkIG9uIHRoZSBjb25maWcuCglAbmFtZSBsYXVuY2gKCUBtZXRob2RPZiBPV0YuTGF1bmNoZXIKCglAcGFyYW0ge09iamVjdH0gY29uZmlnIG9iamVjdCBzZWUgZXhhbXBsZSBmb3Igc3RydWN0dXJlCglAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIGFmdGVyIHRoZSBsYXVuY2hXaWRnZXQgaXMgZXhlY3V0ZWQKCglAZXhhbXBsZQpPV0YuTGF1bmNoZXIubGF1bmNoKHsKICAgIHVuaXZlcnNhbE5hbWU6ICd1bml2ZXJzYWwgbmFtZSBvZiB3aWRnZXQgdG8gbGF1bmNoJywgIC8vdW5pdmVyc2FsTmFtZSBvciBndWlkIG1heWJlIGlkZW50aWZ5IHRoZSB3aWRnZXQgdG8gYmUgbGF1bmNoZWQKICAgIGd1aWQ6ICdndWlkX29mX3dpZGdldF90b19sYXVuY2gnLAogICAgdGl0bGU6ICd0aXRsZSB0byByZXBsYWNlIHRoZSB3aWRnZXQgdGl0bGUnIHRoZSB0aXRsZSB3aWxsIG9ubHkgYmUgY2hhbmdlZCBpZiB0aGUgd2lkZ2V0IGlzIG9wZW5lZC4KICAgIHRpdGxlUmVnZXg6IG9wdGlvbmFsIHJlZ2V4IHVzZWQgdG8gcmVwbGFjZSB0aGUgcHJldmlvdXMgdGl0bGUgd2l0aCB0aGUgbmV3IHZhbHVlIG9mIHRpdGxlCiAgICBsYXVuY2hPbmx5SWZDbG9zZWQ6IHRydWUsICAgLy9pZiB0cnVlIHdpbGwgb25seSBsYXVuY2ggdGhlIHdpZGdldCBpZiBpdCBpcyBub3QgYWxyZWFkeSBvcGVuZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiBpdCBpcyBvcGVuZWQgdGhlbiB0aGUgd2lkZ2V0IHdpbGwgYmUgYnJvdWdodCB0byBmb2N1cwogICAgZGF0YTogZGF0YVN0cmluZyAgICAgICAgICAgIC8vaW5pdGlhbCBsYXVuY2ggZGF0YSB0byBiZSBwYXNzZWQgdG8gYSB3aWRnZXQgb25seSBpZiB0aGUgd2lkZ2V0IGlzIG9wZW5lZC4gVGhpcyBtdXN0IGJlIGEgc3RyaW5nLgp9LCBjYWxsYmFjayk7CiAqLwoKLyoqCglSZXRyaWV2ZXMgaW5pdGlhbCBsYXVuY2ggZGF0YSBmb3IgdGhpcyB3aWRnZXQgaWYgaXQgaXMgb3BlbmVkIGJ5IGFub3RoZXIgd2lkZ2V0LiAgSWYgbGF1bmNoZWQgdmlhIGFuIGludGVudCwgaXQgd2lsbCByZXR1cm4gdGhlIEpTT04gc3RyaW5nIHsgaW50ZW50czogdHJ1ZSB9LgoJQG5hbWUgZ2V0TGF1bmNoRGF0YQoJQG1ldGhvZE9mIE9XRi5MYXVuY2hlcgoKCUByZXR1cm5zIHtPYmplY3R9IGRhdGEgb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGluaXRpYWwgbGF1bmNoIGRhdGEgZm9yIHRoZSB3aWRnZXQgCgoJQGV4YW1wbGUKdmFyIGxhdW5jaERhdGEgPSBPV0YuTGF1bmNoZXIuZ2V0TGF1bmNoRGF0YSgpOwppZiAobGF1bmNoRGF0YSAhPSBudWxsKSB7Cgl2YXIgZGF0YSA9IE96b25lLnV0aWwucGFyc2VKc29uKGxhdW5jaERhdGEpOyAgLy9pbiB0aGlzIGV4YW1wbGUgdGhlIGRhdGEgb2JqZWN0IGhhcyB0d28gZmllbGRzOiBjaGFubmVsIGFuZCBtZXNzYWdlCglpZiAoZGF0YSAhPSBudWxsKSB7CgkJLy9kbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQoJCU9XRi5FdmVudGluZy5zdWJzY3JpYmUoZGF0YS5jaGFubmVsLCBmdW5jdGlvbigpIHt9KTsKCX0KfQoqLwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLSBDaHJvbWUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8qKgoJQ2hlY2tzIHRvIHNlZSBpZiB0aGUgV2lkZ2V0IENocm9tZSBoYXMgYWxyZWFkeSBiZWVuIG1vZGlmaWVkLiAgVGhpcyBpcyB1c2VmdWwgd2hlbiB0aGUgd2lkZ2V0IGlmcmFtZSBpcyByZWxvYWRlZC4KCUBuYW1lIGlzTW9kaWZpZWQKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4KCVRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIGFuIG9iamVjdCB3aGljaCBoYXMgZm9sbG93aW5nIHByb3BlcnRpZXMuIDxicj4KCTxicj4KCQl7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGN1cnJlbnRseSBvcGVuZWQgb24gdGhlIGRhc2hib2FyZCwgb3IgZWxzZSBmYWxzZS4gPGJyPgoJCXtCb29sZWFufSBtb2RpZmllZDogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGNocm9tZShoZWFkZXIpIGlzIG1vZGlmaWVkLCBvciBlbHNlIGZhbHNlLiA8YnI+CgkqCglAZXhhbXBsZQpPV0YuQ2hyb21lLmlzTW9kaWZpZWQoewoJY2FsbGJhY2s6IGZ1bmN0aW9uKG1zZykgewoJCS8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcKCQl2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsKCQlpZiAocmVzLnN1Y2Nlc3MpIHsKCQkJLy9pZiB0aGUgY2hyb21lIHdhcyBuZXZlciBtb2RpZmllZAoJCQlpZiAoIXJlcy5tb2RpZmllZCkgewoJCQkgICAvL2RvIHNvbWV0aGluZywgcGVyaGFwcyBhZGQgYnV0dG9ucwoJCQl9CgkJCS8vaWYgd2UgYWxyZWFkeSBtb2RpZmllZCB0aGUgY2hyb21lCgkJCWVsc2UgewoJCQkgIC8vZG8gc29tZXRoaW5nIG9yIHBlcmhhcHMgbm90aGluZyBpZiB0aGUgYnV0dG9ucyBhcmUgYWxyZWFkeSBhZGRlZAoJCQl9CgkJfQoJfQp9KTsKKi8KCgovKioKCUFkZHMgYnV0dG9ucyB0byB0aGUgV2lkZ2V0IENocm9tZS4gQnV0dG9ucyBhcmUgYWRkZWQgYWZ0ZXIgZXhpc3RpbmcgYnV0dG9ucy4KCUBuYW1lIGFkZEhlYWRlckJ1dHRvbnMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgYnV0dG9uIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIEV4dEpTLWxpa2UgcHJvcGVydHkgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGNvbXBvbmVudCB0byBjcmVhdGUuICBDdXJyZW50bHkgdGhlIFdpZGdldCBDaHJvbWUgQVBJIG9ubHkgc3VwcG9ydHMgdHdvIHh0eXBlIHZhbHVlczog4oCYYnV0dG9u4oCZIGFuZCDigJh3aWRnZXR0b29s4oCZLiAgeHR5cGUgaXMgYW4gb3B0aW9uYWwgZmllbGQsIGlmIGl0IGlzIG9taXR0ZWQg4oCYd2lkZ2V0dG9vbOKAmSBpcyB1c2VkLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50eXBlIFVzZWQgb25seSBmb3Ig4oCYd2lkZ2V0dG9vbOKAmSBidXR0b25zLiAgSXQgZGV0ZXJtaW5lcyB0aGUgc3RhbmRhcmQgaWNvbiB0byBiZSB1c2VkLiAgRm9yIGEgY29tcGxldGUgbGlzdCBvZiB0eXBlcyBwbGVhc2Ugc2VlIHRoZSBFeHRKUyA0LnggQVBJIGRvY3VtZW50YXRpb24sIDxhIGhyZWY9J2h0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZSc+aHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlPC9hPgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgYnV0dG9uLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgYnV0dG9uLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbi7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0LgoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS50b29sdGlwIFRoaXMgcHJvcGVydHkgZGVmaW5lcyBhIHRvb2x0aXAuICBJdCBoYXMgdHdvIGltcG9ydGFudCBzdWIgcHJvcGVydGllcywgdGl0bGUgYW5kIHRleHQuICB0b29sdGlwIGlzIG9ubHkgdXNlZCB3aGVuIHRoZSB4dHlwZSBpcyDigJhidXR0b27igJkKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9u4oCZcyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUuYWRkSGVhZGVyQnV0dG9ucyh7CglpdGVtczogWwoJCXsKCQkJeHR5cGU6ICdidXR0b24nLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdBbGVydCcsCgkJCWl0ZW1JZDonYWxlcnQnLAoJCQl0b29sdGlwOiAgewoJCQkgIHRleHQ6ICdBbGVydCEnCgkJCX0sCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoKCQkJCWlmICh3aWRnZXRTdGF0ZSkgewoJCQkJCXdpZGdldFN0YXRlLmdldFdpZGdldFN0YXRlKHsKCQkJCQkJY2FsbGJhY2s6IGZ1bmN0aW9uKHN0YXRlKSB7CgkJCQkJCQkvL2NoZWNrIGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQoJCQkJCQkJaWYgKCFzdGF0ZS5jb2xsYXBzZWQgJiYgIXN0YXRlLm1pbmltaXplZCAmJiBzdGF0ZS5hY3RpdmUpIHsKCQkJCQkJCQkvL29ubHkgcmVuZGVyIHZpc3VhbCBjb250ZW50LCBwZXJoYXBzIHBvcHVwIGEgbWVzc2FnZSBib3ggaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlCgkJCQkJCQkJLy9vdGhlcndpc2UgaXQgbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJfQoJCX0sCgkJewoJCQl4dHlwZTogJ3dpZGdldHRvb2wnLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsCgkJCWl0ZW1JZDonaGVscCcsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ0Fib3V0IEJ1dHRvbiBQcmVzc2VkJyk7CgkJCX0KCQl9LAoJCXsKCQkJLy9nZWFyIGlzIGEgc3RhbmRhcmQgZXh0IHRvb2wgdHlwZQoJCQl0eXBlOiAnZ2VhcicsCgkJCWl0ZW1JZDonZ2VhcicsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ1V0aWxpdHkgQnV0dG9uIFByZXNzZWQnKTsKCQkJfQoJCX0KCV0KfSk7CiAgICovCgovKioKCVVwZGF0ZXMgYW55IGV4aXN0aW5nIGJ1dHRvbnMgaW4gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gdGhlIGl0ZW1JZC4KCUBuYW1lIHVwZGF0ZUhlYWRlckJ1dHRvbnMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIEV4dEpTLWxpa2UgcHJvcGVydHkgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGNvbXBvbmVudCB0byBjcmVhdGUuICBDdXJyZW50bHkgdGhlIFdpZGdldCBDaHJvbWUgQVBJIG9ubHkgc3VwcG9ydHMgdHdvIHh0eXBlIHZhbHVlczog4oCYYnV0dG9u4oCZIGFuZCDigJh3aWRnZXR0b29s4oCZLiAgeHR5cGUgaXMgYW4gb3B0aW9uYWwgZmllbGQsIGlmIGl0IGlzIG9taXR0ZWQg4oCYd2lkZ2V0dG9vbOKAmSBpcyB1c2VkLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50eXBlIFVzZWQgb25seSBmb3Ig4oCYd2lkZ2V0dG9vbOKAmSBidXR0b25zLiAgSXQgZGV0ZXJtaW5lcyB0aGUgc3RhbmRhcmQgaWNvbiB0byBiZSB1c2VkLiAgRm9yIGEgY29tcGxldGUgbGlzdCBvZiB0eXBlcyBwbGVhc2Ugc2VlIHRoZSBFeHRKUyA0LnggQVBJIGRvY3VtZW50YXRpb24sIDxhIGhyZWY9J2h0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZSc+aHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlPC9hPgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgYnV0dG9uLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgYnV0dG9uLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbi7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0LgoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS50b29sdGlwIFRoaXMgcHJvcGVydHkgZGVmaW5lcyBhIHRvb2x0aXAuICBJdCBoYXMgdHdvIGltcG9ydGFudCBzdWIgcHJvcGVydGllcywgdGl0bGUgYW5kIHRleHQuICB0b29sdGlwIGlzIG9ubHkgdXNlZCB3aGVuIHRoZSB4dHlwZSBpcyDigJhidXR0b27igJkKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9u4oCZcyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uCgkJCglAZXhhbXBsZQpPV0YuQ2hyb21lLnVwZGF0ZUhlYWRlckJ1dHRvbnMoewoJaXRlbXM6IFsKCQl7CgkJCXh0eXBlOiAnYnV0dG9uJywKCQkJLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnQWxlcnQnLAoJCQlpdGVtSWQ6J2FsZXJ0JywKCQkJdG9vbHRpcDogIHsKCQkJICB0ZXh0OiAnQWxlcnQhJwoJCQl9LAoJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCS8vd2lkZ2V0U3RhdGUgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0U3RhdGUgT2JqCgkJCQlpZiAod2lkZ2V0U3RhdGUpIHsKCQkJCQl3aWRnZXRTdGF0ZS5nZXRXaWRnZXRTdGF0ZSh7CgkJCQkJCWNhbGxiYWNrOiBmdW5jdGlvbihzdGF0ZSkgewoJCQkJCQkJLy9jaGVjayBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUKCQkJCQkJCWlmICghc3RhdGUuY29sbGFwc2VkICYmICFzdGF0ZS5taW5pbWl6ZWQgJiYgc3RhdGUuYWN0aXZlKSB7CgkJCQkJCQkJLy9vbmx5IHJlbmRlciB2aXN1YWwgY29udGVudCwgcGVyaGFwcyBwb3B1cCBhIG1lc3NhZ2UgYm94IGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQoJCQkJCQkJCS8vb3RoZXJ3aXNlIGl0IG1heSBub3QgcmVuZGVyIGNvcnJlY3RseQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9CgkJCX0KCQl9LAoJCXsKCQkJeHR5cGU6ICd3aWRnZXR0b29sJywKCQkJLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9pbmZvcm1hdGlvbi5wbmcnLAoJCQlpdGVtSWQ6J2hlbHAnLAoJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCWFsZXJ0KCdBYm91dCBCdXR0b24gUHJlc3NlZCcpOwoJCQl9CgkJfSwKCQl7CgkJCS8vZ2VhciBpcyBhIHN0YW5kYXJkIGV4dCB0b29sIHR5cGUKCQkJdHlwZTogJ2dlYXInLAoJCQlpdGVtSWQ6J2dlYXInLAoJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCWFsZXJ0KCdVdGlsaXR5IEJ1dHRvbiBQcmVzc2VkJyk7CgkJCX0KCQl9CgldCn0pOwoqLwoKLyoqCglJbnNlcnRzIG5ldyBidXR0b25zIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgQnV0dG9ucyBhcmUgYWRkZWQgdG8gdGhlIHNhbWUgYXJlYSBhcyBleGlzdGluZyBidXR0b25zLgoJQG5hbWUgaW5zZXJ0SGVhZGVyQnV0dG9ucwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge051bWJlcn0gW2NmZy5wb3M9MF0gMC1iYXNlZCBpbmRleCBvZiB3aGVyZSBidXR0b25zIHdpbGwgYmUgYWRkZWQsIGFtb25nIGFueSBwcmUtZXhpc3RpbmcgYnV0dG9ucy4KCUBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBidXR0b25zIGNvbmZpZ3VyYXRpb25zIHRvIGluc2VydCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5LgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyBFeHRKUy1saWtlIHByb3BlcnR5IHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBjb21wb25lbnQgdG8gY3JlYXRlLiAgQ3VycmVudGx5IHRoZSBXaWRnZXQgQ2hyb21lIEFQSSBvbmx5IHN1cHBvcnRzIHR3byB4dHlwZSB2YWx1ZXM6IOKAmGJ1dHRvbuKAmSBhbmQg4oCYd2lkZ2V0dG9vbOKAmS4gIHh0eXBlIGlzIGFuIG9wdGlvbmFsIGZpZWxkLCBpZiBpdCBpcyBvbWl0dGVkIOKAmHdpZGdldHRvb2zigJkgaXMgdXNlZC4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udHlwZSBVc2VkIG9ubHkgZm9yIOKAmHdpZGdldHRvb2zigJkgYnV0dG9ucy4gIEl0IGRldGVybWluZXMgdGhlIHN0YW5kYXJkIGljb24gdG8gYmUgdXNlZC4gIEZvciBhIGNvbXBsZXRlIGxpc3Qgb2YgdHlwZXMgcGxlYXNlIHNlZSB0aGUgRXh0SlMgNC54IEFQSSBkb2N1bWVudGF0aW9uLCA8YSBocmVmPSdodHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGUnPmh0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZTwvYT4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIGJ1dHRvbi4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbAoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIGJ1dHRvbi4gIFRoaXMgcHJvcGVydHkgaXMgb25seSB1c2VkIGlmIHRoZSB4dHlwZSBpcyDigJhidXR0b24u4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0udG9vbHRpcCBUaGlzIHByb3BlcnR5IGRlZmluZXMgYSB0b29sdGlwLiAgSXQgaGFzIHR3byBpbXBvcnRhbnQgc3ViIHByb3BlcnRpZXMsIHRpdGxlIGFuZCB0ZXh0LiAgdG9vbHRpcCBpcyBvbmx5IHVzZWQgd2hlbiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9u4oCZCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGJ1dHRvbiBpcyBwcmVzc2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbuKAmXMgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLgoJCglAZXhhbXBsZQpPV0YuQ2hyb21lLmluc2VydEhlYWRlckJ1dHRvbnMoewoJcG9zOiAwLAoJaXRlbXM6IFsKCQl7CgkJCXh0eXBlOiAnYnV0dG9uJywKCQkJLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnQWxlcnQnLAoJCQlpdGVtSWQ6J2FsZXJ0JywKCQkJdG9vbHRpcDogIHsKCQkJCXRleHQ6ICdBbGVydCEnCgkJCX0sCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoKCQkJCWlmICh3aWRnZXRTdGF0ZSkgewoJCQkJCXdpZGdldFN0YXRlLmdldFdpZGdldFN0YXRlKHsKCQkJCQkJY2FsbGJhY2s6IGZ1bmN0aW9uKHN0YXRlKSB7CgkJCQkJCQkvL2NoZWNrIGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQoJCQkJCQkJaWYgKCFzdGF0ZS5jb2xsYXBzZWQgJiYgIXN0YXRlLm1pbmltaXplZCAmJiBzdGF0ZS5hY3RpdmUpIHsKCQkJCQkJCQkvL29ubHkgcmVuZGVyIHZpc3VhbCBjb250ZW50LCBwZXJoYXBzIHBvcHVwIGEgbWVzc2FnZSBib3ggaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlCgkJCQkJCQkJLy9vdGhlcndpc2UgaXQgbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJfQoJCX0sCgkJewoJCQl4dHlwZTogJ3dpZGdldHRvb2wnLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsCgkJCWl0ZW1JZDonaGVscCcsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ0Fib3V0IEJ1dHRvbiBQcmVzc2VkJyk7CgkJCX0KCQl9LAoJCQl7CgkJCS8vZ2VhciBpcyBhIHN0YW5kYXJkIGV4dCB0b29sIHR5cGUKCQkJdHlwZTogJ2dlYXInLAoJCQlpdGVtSWQ6J2dlYXInLAoJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCWFsZXJ0KCdVdGlsaXR5IEJ1dHRvbiBQcmVzc2VkJyk7CgkJCX0KCQl9CgldCn0pOwoqLwoKLyoqCglSZW1vdmVzIGV4aXN0aW5nIGJ1dHRvbnMgb24gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gaXRlbUlkLgoJQG5hbWUgcmVtb3ZlSGVhZGVyQnV0dG9ucwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgYnV0dG9ucyBjb25maWd1cmF0aW9ucyB0byByZW1vdmUgdG8gdGhlIGNocm9tZS4gIE9ubHkgaXRlbUlkIGlzIHJlcXVpcmVkLgoJU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5LgoJCglAZXhhbXBsZQpPV0YuQ2hyb21lLnJlbW92ZUhlYWRlckJ1dHRvbnMoewoJCWl0ZW1zOlsKCQkJewoJCQkJaXRlbUlkOidhbGVydCcKCQkJfSwKCQkJewoJCQkJaXRlbUlkOidoZWxwJwoJCQl9LAoJCQl7CgkJCQlpdGVtSWQ6J2dlYXInCgkJCX0KCQldCn0pOwoqLwoKLyoqCglMaXN0cyBhbGwgYnV0dG9ucyB0aGF0IGhhdmUgYmVlbiBhZGRlZCB0byB0aGUgd2lkZ2V0IGNocm9tZS4KCUBuYW1lIGxpc3RIZWFkZXJCdXR0b25zCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUubGlzdEhlYWRlckJ1dHRvbnMoewoJY2FsbGJhY2s6IGZ1bmN0aW9uKG1zZykgewoJCS8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcKCQl2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsKCQlpZiAocmVzLnN1Y2Nlc3MpIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZXMuaXRlbXMubGVuZ3RoOyBpKyspIHsKCQkJCS8vIGRvIHNvbWV0aGluZyB3aXRoIHRoZSBidXR0b25zCgkJCX0KCQl9Cgl9Cn0pOwoqLwoKLyoqCglBZGRzIG1lbnVzIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgTWVudXMgYXJlIGFkZGVkIGFmdGVyIGV4aXN0aW5nIG1lbnVzLgoJQG5hbWUgYWRkSGVhZGVyTWVudXMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBjb25maWdzCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnBhcmVudElkIGl0ZW1JZCBpcyB0aGUgaXRlbUlkIG9mIHRoZSBtZW51IHRvIHdoaWNoIHRoaXMgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgYWRkZWQgYXMgYSBzdWItbWVudS4gIElmIG9taXR0ZWQsIHRoZSBjb25maWd1cmF0aW9uIHdpbGwgYmUgYWRkZWQgYXMgYSBtYWluIG1lbnUgb24gdGhlIG1lbnUgdG9vbGJhci4gIAoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51cyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIG1lbnVzIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5LgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbAoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIG1lbnUuICAKCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudSBtZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0CglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGl0ZW0gY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBpdGVtIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51IGl0ZW1zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHR5cGUgb2YgbWVudSBpdGVtIHRvIGFkZC4gIFRoaXMgYXR0cmlidXRlIHNob3VsZCBiZSBvbWl0dGVkIHVubGVzcyBzcGVjaWZ5aW5nIGEgbWVudXNlcGFyYXRvci4gU2V0dGluZyB0aGlzIHZhbHVlIHRvICJtZW51c2VwYXJhdG9yIiBhZGRzIGEgc2VwYXJhdG9yIGJhciB0byBhIG1lbnUsIHVzZWQgdG8gZGl2aWRlIGxvZ2ljYWwgZ3JvdXBzIG9mIG1lbnUgaXRlbXMuIElmIHNwZWNpZmllZCwgb25seSB4dHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiAgR2VuZXJhbGx5IHlvdSB3aWxsIGFkZCBvbmUgb2YgdGhlc2UgYnkgdXNpbmcgIi0iIGluIHlvdXIgaXRlbXMgY29uZmlnIHJhdGhlciB0aGFuIGNyZWF0aW5nIG9uZSBkaXJlY3RseSB1c2luZyB4dHlwZS4gIFNlZSBleGFtcGxlIGJlbG93IGZvciB1c2FnZS4gCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUgaXRlbS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbAoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGZvciB0aGUgbWVudSBpdGVtLiAKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBtZW51IGl0ZW0gaXMgY2xpY2tlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uCglAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ubWVudSBzdWItbWVudSBjb25maWd1cmF0aW9uIG9iamVjdC4gIFNlZSBleGFtcGxlIGZvciBzdWItbWVudSBjb25maWcuCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUuYWRkSGVhZGVyTWVudXMoewoJaXRlbXM6IFsKCQl7CgkJCWl0ZW1JZDoncmVndWxhck1lbnUnLAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdSZWd1bGFyIE1lbnUnLAoJCQltZW51OiB7CgkJCQlpdGVtczogWwoJCQkJCXsKCQkJCQkJaXRlbUlkOidyZWd1bGFyTWVudUl0ZW0xJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnUmVndWxhciBNZW51IEl0ZW0gMScsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdSBjbGlja2VkIHRoZSBSZWd1bGFyIE1lbnUgbWVudSBpdGVtLicpOwoJCQkJCQl9CgkJCQkJfQoJCQkJXQoJCQl9CgkJfSwKCQl7CgkJCWl0ZW1JZDonc25hY2tzJywKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnTWVudSB3aXRoIFN1Yi1NZW51JywKCQkJbWVudTogewoJCQkJaXRlbXM6IFsKCQkJCQl7CgkJCQkJCWl0ZW1JZDonZnJ1aXRzJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnRnJ1aXRzJywKCQkJCQkJbWVudTogewoJCQkJCQkJaXRlbXM6IFsKCQkJCQkJCQl7CgkJCQkJCQkJCWl0ZW1JZDonYXBwbGUnLAoJCQkJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCQkJCXRleHQ6ICdBcHBsZScsCgkJCQkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhbiBBcHBsZS4nKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0sCgkJCQkJCQkgICB7CgkJCQkJCQkJICAgeHR5cGU6ICdtZW51c2VwYXJhdG9yJwoJCQkJCQkJICAgfSwKCQkJCQkJCQl7CgkJCQkJCQkJCWl0ZW1JZDonYmFuYW5hJywKCQkJCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQkJCQl0ZXh0OiAnQmFuYW5hJywKCQkJCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQmFuYW5hLicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSwgewoJCQkJCQkJCQlpdGVtSWQ6J2NoZXJyeScsCgkJCQkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJCQkJdGV4dDogJ0NoZXJyaWVzJywKCQkJCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIENoZXJyaWVzLicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJXQoJCQkJCQl9CgkJCQkJfSwKCQkJCQknLScsIC8vIGFub3RoZXIgd2F5IHRvIGFkZCBhIG1lbnUgc2VwYXJhdG9yIAoJCQkJCXsKCQkJCQkJaXRlbUlkOidjdXBjYWtlJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnQ3VwY2FrZScsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhIEN1cGNha2UuJyk7CgkJCQkJCX0KCQkJCQl9LAoJCQkJCXsKCQkJCQkJaXRlbUlkOidjaGlwcycsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ1BvdGF0byBDaGlwcycsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhIFBvdGF0byBDaGlwcy4nKTsKCQkJCQkJfQoJCQkJCX0KCQkJCV0KCQkJfQoJCX0KCV0KfSk7CiovCgovKioKCVVwZGF0ZXMgYW55IGV4aXN0aW5nIG1lbnVzIGluIHRoZSBXaWRnZXQgQ2hyb21lIGJhc2VkIG9uIHRoZSBpdGVtSWQuCglAbmFtZSB1cGRhdGVIZWFkZXJNZW51cwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBtZW51cyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUuICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBtZW51LiAgCglAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUgbWVudSBjb25maWd1cmF0aW9uIG9iamVjdAoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBpdGVtIGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgaXRlbSBjb25maWdzCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudSBpdGVtcyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgdXNlZCB0byBzcGVjaWZ5IHRoZSB0eXBlIG9mIG1lbnUgaXRlbSB0byBhZGQuICBUaGlzIGF0dHJpYnV0ZSBzaG91bGQgYmUgb21pdHRlZCB1bmxlc3Mgc3BlY2lmeWluZyBhIG1lbnVzZXBhcmF0b3IuIFNldHRpbmcgdGhpcyB2YWx1ZSB0byAibWVudXNlcGFyYXRvciIgYWRkcyBhIHNlcGFyYXRvciBiYXIgdG8gYSBtZW51LCB1c2VkIHRvIGRpdmlkZSBsb2dpY2FsIGdyb3VwcyBvZiBtZW51IGl0ZW1zLiBJZiBzcGVjaWZpZWQsIG9ubHkgeHR5cGUgc2hvdWxkIGJlIHNwZWNpZmllZC4gIFNlZSBleGFtcGxlIGJlbG93IGZvciB1c2FnZS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudSBpdGVtLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgZm9yIHRoZSBtZW51IGl0ZW0uIAoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBjbGlja2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbidzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5tZW51IHN1Yi1tZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0LiAgU2VlIGV4YW1wbGUgZm9yIHN1Yi1tZW51IGNvbmZpZy4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS51cGRhdGVIZWFkZXJNZW51cyh7CglpdGVtczpbCgkJewoJCQlpdGVtSWQ6J3JlZ3VsYXJNZW51JywKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnUmVndWxhciBNZW51JywKCQkJbWVudTogewoJCQkJaXRlbXM6IFsKCQkJCQl7CgkJCQkJCWl0ZW1JZDoncmVndWxhck1lbnVJdGVtMScsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ1JlZ3VsYXIgTWVudSBJdGVtIDEnLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgUmVndWxhciBNZW51IG1lbnUgaXRlbS4nKTsKCQkJCQkJfQoJCQkJCX0KCQkJCV0KCQkJfQoJCX0sCgkJewoJCQlpdGVtSWQ6J3NuYWNrcycsCgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJdGV4dDogJ01lbnUgd2l0aCBTdWItTWVudScsCgkJCW1lbnU6IHsKCQkJCWl0ZW1zOiBbCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2ZydWl0cycsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ0ZydWl0cycsCgkJCQkJCW1lbnU6IHsKCQkJCQkJCWl0ZW1zOiBbCgkJCQkJCQkJewoJCQkJCQkJCQlpdGVtSWQ6J2FwcGxlJywKCQkJCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQkJCQl0ZXh0OiAnQXBwbGUnLAoJCQkJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCQkJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYW4gQXBwbGUuJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9LAoJCQkJCQkJICAgewoJCQkJCQkJCSAgIHh0eXBlOiAnbWVudXNlcGFyYXRvcicKCQkJCQkJCSAgIH0sCgkJCQkJCQkJewoJCQkJCQkJCQlpdGVtSWQ6J2JhbmFuYScsCgkJCQkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJCQkJdGV4dDogJ0JhbmFuYScsCgkJCQkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhIEJhbmFuYS4nKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0sIHsKCQkJCQkJCQkJaXRlbUlkOidjaGVycnknLAoJCQkJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCQkJCXRleHQ6ICdDaGVycmllcycsCgkJCQkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBDaGVycmllcy4nKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCV0KCQkJCQkJfQoJCQkJCX0sCgkJCQkJJy0nLCAvLyBhbm90aGVyIHdheSB0byBhZGQgYSBtZW51IHNlcGFyYXRvciAKCQkJCQl7CgkJCQkJCWl0ZW1JZDonY3VwY2FrZScsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ0N1cGNha2UnLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBDdXBjYWtlLicpOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQl7CgkJCQkJCWl0ZW1JZDonY2hpcHMnLAoJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCXRleHQ6ICdQb3RhdG8gQ2hpcHMnLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBQb3RhdG8gQ2hpcHMuJyk7CgkJCQkJCX0KCQkJCQl9CgkJCQldCgkJCX0KCQl9CgldCn0pOwoqLwoKLyoqCglJbnNlcnRzIG5ldyBtZW51cyBpbnRvIHRoZSBXaWRnZXQgQ2hyb21lLiBNZW51cyBhcmUgYWRkZWQgdG8gdGhlIHNhbWUgYXJlYSBhcyBleGlzdGluZyBtZW51cy4KCUBuYW1lIGluc2VydEhlYWRlck1lbnVzCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7TnVtYmVyfSBbY2ZnLnBvcz0wXSAwLWJhc2VkIGluZGV4IG9mIHdoZXJlIG1lbnVzIHdpbGwgYmUgYWRkZWQsIGFtb25nIGFueSBwcmUtZXhpc3RpbmcgbWVudXMuCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ucGFyZW50SWQgaXRlbUlkIGlzIHRoZSBpdGVtSWQgb2YgdGhlIG1lbnUgdG8gd2hpY2ggdGhpcyBjb25maWd1cmF0aW9uIHNob3VsZCBiZSBhZGRlZCBhcyBhIHN1Yi1tZW51LiAgSWYgb21pdHRlZCwgdGhlIGNvbmZpZ3VyYXRpb24gd2lsbCBiZSBhZGRlZCBhcyBhIG1haW4gbWVudSBvbiB0aGUgbWVudSB0b29sYmFyLiAgCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnVzIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgbWVudXMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51LiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgbWVudS4gIFRoaXMgcHJvcGVydHkgaXMgb25seSB1c2VkIGlmIHRoZSB4dHlwZSBpcyDigJhtZW51LuKAmSAg4oCYd2lkZ2V0dG9vbOKAmSB3aWxsIG5vdCBzaG93IHRleHQuCglAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUgbWVudSBjb25maWd1cmF0aW9uIG9iamVjdAoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBpdGVtIGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgaXRlbSBjb25maWdzCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudSBpdGVtcyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgdXNlZCB0byBzcGVjaWZ5IHRoZSB0eXBlIG9mIG1lbnUgaXRlbSB0byBhZGQuICBUaGlzIGF0dHJpYnV0ZSBzaG91bGQgYmUgb21pdHRlZCB1bmxlc3Mgc3BlY2lmeWluZyBhIG1lbnVzZXBhcmF0b3IuIFNldHRpbmcgdGhpcyB2YWx1ZSB0byAibWVudXNlcGFyYXRvciIgYWRkcyBhIHNlcGFyYXRvciBiYXIgdG8gYSBtZW51LCB1c2VkIHRvIGRpdmlkZSBsb2dpY2FsIGdyb3VwcyBvZiBtZW51IGl0ZW1zLiBJZiBzcGVjaWZpZWQsIG9ubHkgeHR5cGUgc2hvdWxkIGJlIHNwZWNpZmllZC4gIFNlZSBleGFtcGxlIGJlbG93IGZvciB1c2FnZS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudSBpdGVtLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgZm9yIHRoZSBtZW51IGl0ZW0uIAoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBjbGlja2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbidzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5tZW51IHN1Yi1tZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0LiAgU2VlIGV4YW1wbGUgZm9yIHN1Yi1tZW51IGNvbmZpZy4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5pbnNlcnRIZWFkZXJNZW51cyh7CgkJcG9zOiAwLAoJCWl0ZW1zOiBbewoJCSBpdGVtSWQ6J2luc2VydGVkTWVudScsCgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJdGV4dDogJ0luc2VydGVkIE1lbnUnLAoJCQltZW51OiB7CgkJCQlpdGVtczogWwoJCQkJCXsKCQkJCQkJaXRlbUlkOidpbnNlcnRlZE1lbnVJdGVtMScsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ0luc2VydGVkIE1lbnUgSXRlbSAxJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQl7CgkJCQkJCXh0eXBlOiAnbWVudXNlcGFyYXRvcicKCQkJCQl9LAoJCQkJCXsKCQkJCQkJaXRlbUlkOidpbnNlcnRlZE1lbnVJdGVtMicsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ0luc2VydGVkIE1lbnUgSXRlbSAyJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQknLScsIC8vIGFub3RoZXIgd2F5IHRvIGFkZCBhIG1lbnUgc2VwYXJhdG9yIAoJCQkJCXsKCQkJCQkJaXRlbUlkOidpbnNlcnRlZE1lbnVJdGVtMycsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ0luc2VydGVkIE1lbnUgSXRlbSAzJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOwoJCQkJCQl9CgkJCQkJfQoJCQkJXQoJCQl9CgkJfV0KfSk7CiovCgovKioKCVJlbW92ZXMgZXhpc3RpbmcgbWVudXMgb24gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gaXRlbUlkLgoJQG5hbWUgcmVtb3ZlSGVhZGVyTWVudXMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyBpdGVtSWRzIGZvciB0aGUgbWVudXMgdG8gcmVtb3ZlIGZyb20gdGhlIGNocm9tZS4KCSAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUucmVtb3ZlSGVhZGVyTWVudXMoewoJaXRlbXM6IFt7CgkJaXRlbUlkOiAncmVndWxhck1lbnUnCgl9XQp9KTsKKi8KCi8qKgoJTGlzdHMgYWxsIG1lbnVzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSB3aWRnZXQgY2hyb21lLgoJQG5hbWUgbGlzdEhlYWRlck1lbnVzCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUubGlzdEhlYWRlck1lbnVzKHsKCWNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsKCQkvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nCgkJdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7CgkJaWYgKHJlcy5zdWNjZXNzKSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzLml0ZW1zLmxlbmd0aDsgaSsrKSB7CgkJCQkvLyBkbyBzb21ldGhpbmcgd2l0aCB0aGUgbWVudXMKCQkJfQoJCX0KCX0KfSk7CgkqLwoKLyoqCiAgKgogICoJQG5hbWUgZ2V0VGl0bGUKICAqIEBtZXRob2RPZiBPV0YuQ2hyb21lCiAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgV2lkZ2V0J3MgVGl0bGUgZnJvbSB0aGUgQ2hyb21lCiAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLgogICoKICAqIEBleGFtcGxlCiAgKiAgICBPV0YuQ2hyb21lLmdldFRpdGxlKHsKICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7CiAgKiAgICAgICAgIC8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcKICAqICAgICAgICAgdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7CiAgKiAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICoKICAqICAgICAgICAgICAvL2RvIHNvbWV0aGluZyB3aXRoIHRpdGxlCiAgKiAgICAgICAgICAgLy8gcmVzLnRpdGxlCiAgKiAgICAgICAgIH0KICAqICAgICB9CiAgKiAgIH0pOwogICovCgovKioKICAqCUBuYW1lIHNldFRpdGxlCiAgKiBAbWV0aG9kT2YgT1dGLkNocm9tZQogICogQGRlc2NyaXB0aW9uIFNldHMgdGhlIFdpZGdldCdzIFRpdGxlIGluIHRoZSBDaHJvbWUKICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcudGl0bGUgVGhlIHN0cmluZyB3aGljaCB3aWxsIHJlcGxhY2UgdGhlIHdpZGdldCB0aXRsZQogICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4KICAqCiAgKiBAZXhhbXBsZQogICogICAgT1dGLkNocm9tZS5zZXRUaXRsZSh7CiAgKiAgICAgdGl0bGU6ICduZXcgdGl0bGUnLAogICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsKICAqICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZwogICogICAgICAgICB2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsKICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgKiAgICAgICAgICAgLy9nZXQgdGl0bGUgYmFjayBmb3IgY29uZmlybWF0aW9uCiAgKiAgICAgICAgICAgLy8gcmVzLnRpdGxlCiAgKgogICogICAgICAgICB9CiAgKiAgICAgfQogICogICB9KTsKICAqLwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLSBQcmVmZXJlbmNlcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8qKgoJR2V0IHRoZSB1cmwgZm9yIHRoZSBQcmVmZXJlbmNlIFNlcnZlcgoJQG5hbWUgZ2V0VXJsCglAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCgoJQHJldHVybnMge1N0cmluZ30gdXJsCiAqLwoKLyoqCglTZXRzIHRoZSB1cmwgZm9yIHRoZSBQcmVmZXJlbmNlIFNlcnZlcgoJQG5hbWUgc2V0VXJsCglAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCgoJQHBhcmFtIHtTdHJpbmd9IHVybAoJQHJldHVybnMgdm9pZAogKi8KCi8qKgogKiBAbmFtZSBnZXREYXNoYm9hcmQKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgZGFzaGJvYXJkIHdpdGggdGhlIHNwZWNpZmllZCBpZAogKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCiAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuZGFzaGJvYXJkSWQgVW5pZ3VlIGRhc2hiYXJkIGlkZW50aWZpZXIKICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBkYXNoYm9hcmQuCiAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7CiAqICAgICBhbGVydChkYXNoYm9hcmQubmFtZSk7CiAqIH07CiAqCiAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewogICAgICogICAgIGFsZXJ0KGVycm9yKTsKICogfTsKICoKICogT3pvbmUuUHJlZmVyZW5jZXMuZ2V0RGFzaGJvYXJkKHsKICogICAgIGRhc2hib2FyZElkOic5MTdiNGNkMC1lY2JkLTQxMGItYWZkOS00MmQxNTBjMjY0MjYnLAogKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywKICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUKICogfSk7CiAqLwoKCiAvKioKICAgKiBAbmFtZSBnZXREZWZhdWx0RGFzaGJvYXJkCiAgICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSB1c2VyJ3MgZGVmYXVsdCBkYXNoYm9hcmQKICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuCiAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAgICogPGJyPgogICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPgogICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4KICAgKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICAgKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAgICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAgICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4KICAgKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICAgKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICAgKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLgogICAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogICAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAgICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+CiAgICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogICAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICAgKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+CiAgICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAgICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICAgKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+CiAgICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAgICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAgICogICAgICAgIDwvdWw+CiAgICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4KICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPgogICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPgogICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogICAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAgICogICAgICAgIDwvdWw+CiAgICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICAgKiAgICAgPC91bD4KICAgKiA8YnI+CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7CiAgICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICAgKiB9OwogICAqCiAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAqICAgICBhbGVydChlcnJvcik7CiAgICogfTsKICAgKgogICAqIE96b25lLlByZWZlcmVuY2VzLmdldERhc2hib2FyZCh7CiAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsCiAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUKICAgKiB9KTsKICAgKi8KLyoqCiAqIEBuYW1lIHNldERlZmF1bHREYXNoYm9hcmQKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVzY3JpcHRpb24gU2V0cyB0aGUgdXNlcidzIGRlZmF1bHQgZGFzaGJvYXJkCiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kYXNoYm9hcmRJZCBVbmlndWUgZGFzaGJhcmQgaWRlbnRpZmllcgogKiBAcGFyYW0ge0Jvb2xlYW59IGNmZy5pc0RlZmF1bHQgdHJ1ZSB0byBzZXQgYXMgZGVmYXVsdCBkYXNoYm9hcmQKICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuCiAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7CiAqICAgICBhbGVydChkYXNoYm9hcmQubmFtZSk7CiAqIH07CiAqCiAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewogKiAgICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiBPV0YuUHJlZmVyZW5jZXMuc2V0RGVmYXVsdERhc2hib2FyZCh7CiAqICAgICBkYXNoYm9hcmRJZDonOTE3YjRjZDAtZWNiZC00MTBiLWFmZDktNDJkMTUwYzI2NDI2JywKICogICAgIGlzRGVmYXVsdDp0cnVlLAogKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywKICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUKICogfSk7CiAqLwoKLyoqCiAqIEBuYW1lIGNyZWF0ZU9yVXBkYXRlRGFzaGJvYXJkCiAqIEBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKICogQGRlc2NyaXB0aW9uIFNhdmVzIGNoYW5nZXMgdG8gYSBuZXcgb3IgZXhpc3RpbmcgZGFzaGJvYXJkCiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtPYmplY3R9IGNmZy5qc29uIFRoZSBlbmNvZGVkIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGFzaGJvYXJkLgogKiBUaGUgZGFzaGJvYXJkIG9iamVjdCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4KICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXQ6IGxheW91dCBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge051bWJlcn0gY29sdW1uQ291bnQ6IG51bWJlciBvZiBjb2x1bW5zIGlmIGRhc2hib2FyZCBpcyBhIHBvcnRhbCB0eXBlPGJyPgogKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICB7TGlzdH0gRURhc2hib2FyZExheW91dExpc3Q6IGxpc3Qgb2YgZGFzaGJvYXJkIHR5cGVzPGJyPgogKiAgICAge1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBkYXNoYm9hcmQgdHlwZTxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtCb29sZWFufSBjZmcuc2F2ZUFzTmV3IEEgQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGVudGl0eSBiZWluZyBzYXZlZCBpcyBuZXcuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLgogKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4KICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPgogKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4KICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4KICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPgogKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLgogKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gKICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4KICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+CiAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPgogKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+CiAqICAgICA8L3VsPgogKiA8YnI+CiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLmFzeW5jXSBBc3luYyB0cnVlIG9yIGZhbHNlIGRlZmF1bHRzIHRvIHRydWUKICogQGV4YW1wbGUKICoKICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgewogKiAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAqICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiB2YXIgZGFzaGJvYXJkID0gewogKiAgIGFsdGVyZWRCeUFkbWluOiAnZmFsc2UnLAogKiAgIGNyZWF0ZWREYXRlOiAnMDQvMTgvMjAxMiAxMToyOSBBTSBFRFQnLAogKiAgIGlzR3JvdXBEYXNoYm9hcmQ6IGZhbHNlLAogKiAgIGlzZGVmYXVsdDogZmFsc2UsCiAqICAgbG9ja2VkOiBmYWxzZSwKICogICBuYW1lOiAnTXkgRGFzaGJvYXJkJywKICogICB1c2VyOiB7CiAqICAgICB1c2VySWQ6ICd0ZXN0QWRtaW4xJywKICogICB9LAogKiAgIGNyZWF0ZWRCeTogewogKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsCiAqICAgICB1c2VyUmVhbE5hbWU6ICdUZXN0IEFkbWluIDEnCiAqICAgfSwKICogICBlZGl0ZWREYXRlOiAnMDQvMTgvMjAxMiAxMToyOSBBTSBFRFQnLAogKiAgIGdyb3VwczogW10sCiAqICAgZGVzY3JpcHRpb246ICdUaGlzIGlzIG15IGRhc2hib2FyZCcsCiAqICAgZ3VpZDogZ3VpZC51dGlsLmd1aWQoKSwKICogICBsYXlvdXRDb25maWc6IHsKICogICAgICAgeHR5cGU6ICJkZXNrdG9wcGFuZSIsIAogKiAgICAgICBmbGV4OiAxLCAKICogICAgICAgaGVpZ2h0OiAiMTAwJSIsIAogKiAgICAgICBpdGVtczogWwogKiAgICAgICBdLCAKICogICAgICAgcGFuZVR5cGU6ICJkZXNrdG9wcGFuZSIsIAogKiAgICAgICB3aWRnZXRzOiBbewogKiAgICAgICAgICAgICAgIHdpZGdldEd1aWQ6ICJlYzU0MzVjZi00MDIxLTRmMmEtYmE2OS1kZGU0NTFkMTI1NTEiLCAKICogICAgICAgICAgICAgICB1bmlxdWVJZDogZ3VpZC51dGlsLmd1aWQoKSwgCiAqICAgICAgICAgICAgICAgZGFzaGJvYXJkR3VpZDogIjZkNzIxOWNiLWI0ODUtYWNlNS05NDZiLTBhZmZhMWYyMjdhMyIsIAogKiAgICAgICAgICAgICAgIHBhbmVHdWlkOiBndWlkLnV0aWwuZ3VpZCgpLCAKICogICAgICAgICAgICAgICBuYW1lOiAiQ2hhbm5lbCBMaXN0ZW5lciIsIAogKiAgICAgICAgICAgICAgIGFjdGl2ZTogZmFsc2UsIAogKiAgICAgICAgICAgICAgIHg6IDUwLCAKICogICAgICAgICAgICAgICB5OiA2NiwgCiAqICAgICAgICAgICAgICAgbWluaW1pemVkOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgbWF4aW1pemVkOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgcGlubmVkOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgY29sbGFwc2VkOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgY29sdW1uUG9zOiAwLCAKICogICAgICAgICAgICAgICBidXR0b25JZDogbnVsbCwgCiAqICAgICAgICAgICAgICAgYnV0dG9uT3BlbmVkOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgcmVnaW9uOiAibm9uZSIsIAogKiAgICAgICAgICAgICAgIHN0YXRlUG9zaXRpb246IDEsIAogKiAgICAgICAgICAgICAgIGludGVudENvbmZpZzogbnVsbCwgCiAqICAgICAgICAgICAgICAgc2luZ2xldG9uOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgZmxvYXRpbmdXaWRnZXQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgekluZGV4OiAxOTA1MCwgCiAqICAgICAgICAgICAgICAgaGVpZ2h0OiA0NDAsIAogKiAgICAgICAgICAgICAgIHdpZHRoOiA1NDAKICogICAgICAgICAgIH0KICogICAgICAgXSwgCiAqICAgICAgIGRlZmF1bHRTZXR0aW5nczogewogKiAgICAgICAgICAgd2lkZ2V0U3RhdGVzOiB7CiAqICAgICAgICAgICAgICAgImVjNTQzNWNmLTQwMjEtNGYyYS1iYTY5LWRkZTQ1MWQxMjU1MSI6IHsKICogICAgICAgICAgICAgICAgICAgeDogNTAsIAogKiAgICAgICAgICAgICAgICAgICB5OiA2NiwgCiAqICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDQwLCAKICogICAgICAgICAgICAgICAgICAgd2lkdGg6IDU0MCwgCiAqICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogMTM0OTgwOTc0NzMzNgogKiAgICAgICAgICAgICAgICB9CiAqICAgICAgICAgICB9CiAqICAgICAgIH0KICogICAgICB9CiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5jcmVhdGVPclVwZGF0ZURhc2hib2FyZCh7CiAqICAganNvbjogZGFzaGJvYXJkLAogKiAgIHNhdmVBc05ldzogdHJ1ZSwKICogICBvblN1Y2Nlc3M6IG9uU3VjY2VzcywKICogICBvbkZhaWx1cmU6IG9uRmFpbHVyZSwKICogICBhc3luYzogdHJ1ZQogKiB9KTsKICovCgovKioKICogQG5hbWUgY2xvbmVEYXNoYm9hcmQKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVzY3JpcHRpb24gQ29waWVzIGFuIGV4aXN0aW5nIGRhc2hib2FyZCBhbmQgc2F2ZXMgaXQgYXMgbmV3CiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtPYmplY3R9IGNmZy5qc29uIFRoZSBlbmNvZGVkIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGFzaGJvYXJkLgogKiBUaGUgZGFzaGJvYXJkIG9iamVjdCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4KICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPgogKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4KICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4KICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPgogKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLgogKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gKICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4KICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+CiAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPgogKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+CiAqICAgICA8L3VsPgogKiA8YnI+CiAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLgogKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4KICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPgogKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4KICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4KICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPgogKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLgogKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gKICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4KICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+CiAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPgogKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+CiAqICAgICA8L3VsPgogKiA8YnI+CiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KICogQGV4YW1wbGUKICoKICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgewogKiAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAqICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiB2YXIgZGFzaGJvYXJkID0gewogKiAgIGFsdGVyZWRCeUFkbWluOiAnZmFsc2UnLAogKiAgIGNyZWF0ZWREYXRlOiAnMDQvMTgvMjAxMiAxMToyOSBBTSBFRFQnLAogKiAgIGlzR3JvdXBEYXNoYm9hcmQ6IGZhbHNlLAogKiAgIGlzZGVmYXVsdDogZmFsc2UsCiAqICAgbmFtZTogJ015IERhc2hib2FyZCcsCiAqICAgdXNlcjogewogKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsCiAqICAgfSwKICogICBjcmVhdGVkQnk6IHsKICogICAgIHVzZXJJZDogJ3Rlc3RBZG1pbjEnLAogKiAgICAgdXNlclJlYWxOYW1lOiAnVGVzdCBBZG1pbiAxJwogKiAgIH0sCiAqICAgZWRpdGVkRGF0ZTogJzA0LzE4LzIwMTIgMTE6MjkgQU0gRURUJywKICogICBncm91cHM6IFtdLAogKiAgIGRlc2NyaXB0aW9uOiAnVGhpcyBpcyBteSBkYXNoYm9hcmQnLAogKiAgIGd1aWQ6IGd1aWQudXRpbC5ndWlkKCksCiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5jbG9uZURhc2hib2FyZCh7CiAqICAganNvbjogZGFzaGJvYXJkLAogKiAgIG9uU3VjY2Vzczogb25TdWNjZXNzLAogKiAgIG9uRmFpbHVyZTogb25GYWlsdXJlCiAqIH0pOwogKi8KCgovKioKCUBkZXNjcmlwdGlvbiBTYXZlcyBjaGFuZ2VzIHRvIGV4aXN0aW5nIGRhc2hib2FyZHMKCUBuYW1lIHVwZGF0ZUFuZERlbGV0ZURhc2hib2FyZHMKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge0FycmF5fSBjZmcudmlld3NUb1VwZGF0ZSBhcnJheSBvZiBKU09OIG9iamVjdHMgY29udGFpbmluZyB0aGUgdmlldyBndWlkIGFuZCBkYXRhIHRvIGJlIHVwZGF0ZWQKCUBwYXJhbSB7QXJyYXl9IGNmZy52aWV3R3VpZHNUb0RlbGV0ZSBhcnJheSBvZiBndWlkcyBvZiB2aWV3cyB0byBiZSBkZWxldGVkCglAcGFyYW0ge0Jvb2xlYW59IGNmZy51cGRhdGVPcmRlciBmbGFnIHRvIHVwZGF0ZSBvcmRlcgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdAoJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpCiAqLwoKLyoqCiAqIEBuYW1lIGRlbGV0ZURhc2hib2FyZAogKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAqIEBkZXNjcmlwdGlvbiBEZWxldGVzIHRoZSBkYXNoYm9hcmQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkCiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kYXNoYm9hcmRJZCBVbmlndWUgZGFzaGJhcmQgaWRlbnRpZmllcgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4KICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqIDxicj4KICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+CiAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+CiAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4KICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgogKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogKiAgICAgPC91bD4KICogPGJyPgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCiAqIEBleGFtcGxlCiAqCiAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsKICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgKiAgICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiBPV0YuUHJlZmVyZW5jZXMuZGVsZXRlRGFzaGJvYXJkKHsKICogICAgIGRhc2hib2FyZElkOic5MTdiNGNkMC1lY2JkLTQxMGItYWZkOS00MmQxNTBjMjY0MjYnLAogKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywKICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUKICogfSk7CiAqLwoKLyoqCiAqIEBuYW1lIGZpbmREYXNoYm9hcmRzCiAqIEBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKICogQGRlc2NyaXB0aW9uIFJldHVybnMgYWxsIGRhc2hib2FyZHMgZm9yIHRoZSBsb2dnZWQgaW4gdXNlci4KICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LgogKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiBkYXNoYm9hcmRzIGZvdW5kPGJyPgogKiAgICAge051bWJlcn0gcmVzdWx0czogbnVtYmVyIG9mIGRhc2hib2FyZHMgZm91bmQ8YnI+CiAqICAgICB7QXJyYXl9IGRhdGE6IGFycmF5IG9mIGRhc2hib2FyZHMgb2JqZWN0cyBmb3VuZC4gIERhc2hib2FyZCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICA8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqICAgICA8YnI+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ob2JqKSB7CiAqICAgICBhbGVydChvYmoucmVzdWx0cyk7CiAqICAgICBpZiAob2JqLnJlc3VsdHMgPiAwKSB7CiAqICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoucmVzdWx0czsgaSsrKSB7CiAqICAgICAgICAgICAgIGFsZXJ0KG9iai5kYXRhW2ldLm5hbWUpOwogKiAgICAgICAgIH0KICogICAgIH0KICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAqICAgICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5maW5kRGFzaGJvYXJkcyh7CiAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLAogKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogKiB9KTsKICovCgovKioKICogQG5hbWUgZmluZERhc2hib2FyZHNCeVR5cGUKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVwcmVjYXRlZCBEZXByZWNhdGVkIHN0YXJ0aW5nIHdpdGggT1dGIDcuIERhc2hib2FyZHMgbm8gbG9uZ2VyIGhhdmUgYSBzcGVjaWZpYyB0eXBlLiBUaGlzIGZ1bmN0aW9uIGlzIHN0dWJiZWQgCiAqIHRvIHJldHVybiBzdWNjZXNzIHdpdGggMCByZXN1bHRzIHVudGlsIHJlbW92YWwuCiAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIGFsbCBkYXNoYm9hcmRzIGZvciB0aGUgbG9nZ2VkIGluIHVzZXIgZmlsdGVyZWQgYnkgdGhlIHR5cGUgb2YgZGFzaGJvYXJkLgogKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCiAqIEBwYXJhbSB7U3RyaW5nfSBjZmcudHlwZSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHR5cGUgb2YgZGFzaGJvYXJkLiBJZiB1c2luZyBidWlsdCBpbiBkYXNoYm9hcmQgdHlwZXMsIHRoaXMgd291bGQgaW5jbHVkZSBkZXNrdG9wLCB0YWJiZWQsIHBvcnRhbCwgYW5kIGFjY29yZGlvbi4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4KICogVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IHN1Y2Nlc3M6IHRydWUgaWYgZGFzaGJvYXJkcyBmb3VuZDxicj4KICogICAgIHtOdW1iZXJ9IHJlc3VsdHM6IG51bWJlciBvZiBkYXNoYm9hcmRzIGZvdW5kPGJyPgogKiAgICAge0FycmF5fSBkYXRhOiBhbiBlbXB0eSBhcnJheTxicj4KICogICAgIAogKiA8YnI+CiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KICogQGV4YW1wbGUKICoKICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgewogKiAgICAgYWxlcnQob2JqLnJlc3VsdHMpOwogKiAgICAgaWYgKG9iai5yZXN1bHRzID4gMCkgewogKiAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLnJlc3VsdHM7IGkrKykgewogKiAgICAgICAgICAgICBhbGVydChvYmouZGF0YVtpXS5uYW1lKTsKICogICAgICAgICB9CiAqICAgICB9CiAqIH07CiAqCiAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewogKiAgICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiBPV0YuUHJlZmVyZW5jZXMuZmluZERhc2hib2FyZHNCeVR5cGUoewogKiAgICAgdHlwZTonZGVza3RvcCcsCiAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLAogKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogKiB9KTsKICovCgovKioKCUBkZXNjcmlwdGlvbiBHZXRzIHRoZSB3aWRnZXQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkCglAbmFtZSBnZXRXaWRnZXQKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge1N0cmluZ30gY2ZnLndpZGdldElkIFRoZSB1bmlxdWUgaWRlbnRpZmllciAobm9ybWFsbHkgYSBndWlkKSBmb3IgdGhlIHdpZGdldC4KCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIGlzIHBhc3NlZCB0aGUgZm9sbG93aW5nIG9iamVjdCBhcyBhIHBhcmFtZXRlcjoge2lkOk51bWJlciwgbmFtZXNwYWNlOlN0cmluZywgdmFsdWU6T2JqZWN0LCBwYXRoOlN0cmluZ30KCVRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+Cgk8YnI+CgkJe051bWJlcn0gaWQ6IGRhdGFiYXNlIHBrIGlkZW50aWZpZXI8YnI+CgkJe1N0cmluZ30gbmFtZXNwYWNlOiAid2lkZ2V0Ijxicj4KCQl7T2JqZWN0fSB2YWx1ZTogd2lkZ2V0IG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KCQk8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGVkaXRhYmxlOiB0cnVlIGlmIHdpZGdldCBjYW4gYmUgZWRpdGVkPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSB2aXNpYmxlOiB0cnVlIGlmIHdpZGdldCBpcyB2aXNpYmxlPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHBvc2l0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogd2lkZ2V0IG93bmVyIGlkZW50aWZpZXI8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB3aWRnZXQgb3duZXIgbmFtZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBuYW1lc3BhY2U6IHdpZGdldCBuYW1lPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVybDogdXJsIG9mIHdpZGdldCBhcHBsaWNhdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBoZWFkZXJJY29uOiB1cmwgb2Ygd2lkZ2V0IGhlYWRlciBpY29uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGltYWdlOiB1cmwgb2Ygd2lkZ2V0IGltYWdlPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHNtYWxsSWNvblVybDogdXJsIG9mIHdpZGdldCdzIHNtYWxsIGljb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbGFyZ2VJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3MgbGFyZ2UgaWNvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB3aWR0aDogd2lkdGggb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHdpZGdldFZlcnNpb246IHdpZGdldCB2ZXJzaW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gdGFnczogYXJyYXkgb2YgdGFnIHN0cmluZ3M8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGRlZmluaXRpb25WaXNpYmxlOiB0cnVlIGlmIGRlZmluaXRpb24gaXMgdmlzaWJsZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gc2luZ2xldG9uOiB0cnVlIGlmIHdpZGdldCBpcyBhIHNpbmdsZXRvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gYmFja2dyb3VuZDogdHJ1ZSBpZiB3aWRnZXQgcnVucyBpbiB0aGUgYmFja2dyb3VuZDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGFsbFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGRpcmVjdFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyBkaXJlY3RseSByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IHdpZGdldFR5cGVzOiBhcnJheSBvZiB3aWRnZXQgdHlwZXMgdGhpcyB3aWRnZXQgYmVsb25ncyB0bzxicj4KCQk8YnI+CgkJe1N0cmluZ30gcGF0aDogdW5uaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjxicj4KCTxicj4KCUBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KCQoJQGV4YW1wbGUJCnZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsKCWlmIChvYmoudmFsdWUpIHsKCQlhbGVydChvYmoudmFsdWUubmFtZXNwYWNlKTsKCX0KfTsKCnZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewoJYWxlcnQoZXJyb3IpOwp9OwoKT1dGLlByZWZlcmVuY2VzLmdldFdpZGdldCh7Cgl3aWRnZXRJZDonZWE1NDM1Y2YtNDAyMS00ZjJhLWJhNjktZGRlNDUxZDEyNTUxJywKCW9uU3VjY2VzczpvblN1Y2Nlc3MsCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwoqLwoKLyoqCglAZGVzY3JpcHRpb24gR2V0cyBhbGwgd2lkZ2V0cyBmb3IgYSBnaXZlbiB1c2VyLgoJQG5hbWUgZmluZFdpZGdldHMKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge0Jvb2xlYW59IFtjZmcudXNlck9ubHldIGJvb2xlYW4gZmxhZyB0aGF0IGRldGVybWluZXMgd2hldGhlciB0byBvbmx5IHJldHVybiB3aWRnZXRzIGFzc2lnbmVkIHRvIHRoZSB1c2VyIChleGNsdWRpbmcgd2lkZ2V0cyB0byB3aGljaCB0aGUgdXNlciBvbmx5IGhhcyBhY2Nlc3MgdmlhIHRoZWlyIGFzc2lnbmVkIGdyb3VwcykKCUBwYXJhbSB7T2JqZWN0fSBbY2ZnLnNlYXJjaFBhcmFtc10gb2JqZWN0IGNvbnRhaW5pbmcgc2VhcmNoIHBhcmFtZXRlcnMKCUBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXROYW1lXSBuYW1lIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcwoJQHBhcmFtIHtTdHJpbmd9IFtjZmcuc2VhcmNoUGFyYW1zLndpZGdldE5hbWVFeGFjdE1hdGNoXSB0cnVlIG9yIGZhbHNlIHRvIG1hdGNoIHRoZSBuYW1lIGV4YWN0bHkuIGRlZmF1bHRzIHRvIGZhbHNlCglAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0VmVyc2lvbl0gdmVyc2lvbiBvZiB3aWRnZXQgJyUnIGFyZSB3aWxkY2FyZHMKCUBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRHdWlkXSBndWlkIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcwoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4KCVRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBhcnJheSBvZiBvYmplY3RzIGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgoJPGJyPgoJCXtOdW1iZXJ9IGlkOiBkYXRhYmFzZSBwayBpZGVudGlmaWVyPGJyPgoJCXtTdHJpbmd9IG5hbWVzcGFjZTogIndpZGdldCI8YnI+CgkJe09iamVjdH0gdmFsdWU6IHdpZGdldCBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CgkJPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBlZGl0YWJsZTogdHJ1ZSBpZiB3aWRnZXQgY2FuIGJlIGVkaXRlZDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gdmlzaWJsZTogdHJ1ZSBpZiB3aWRnZXQgaXMgdmlzaWJsZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBwb3NpdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHdpZGdldCBvd25lciBpZGVudGlmaWVyPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogd2lkZ2V0IG93bmVyIG5hbWU8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbmFtZXNwYWNlOiB3aWRnZXQgbmFtZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1cmw6IHVybCBvZiB3aWRnZXQgYXBwbGljYXRpb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gaGVhZGVySWNvbjogdXJsIG9mIHdpZGdldCBoZWFkZXIgaWNvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBpbWFnZTogdXJsIG9mIHdpZGdldCBpbWFnZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBzbWFsbEljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBzbWFsbCBpY29uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGxhcmdlSWNvblVybDogdXJsIG9mIHdpZGdldCdzIGxhcmdlIGljb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB3aWRnZXRWZXJzaW9uOiB3aWRnZXQgdmVyc2lvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IHRhZ3M6IGFycmF5IG9mIHRhZyBzdHJpbmdzPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBkZWZpbml0aW9uVmlzaWJsZTogdHJ1ZSBpZiBkZWZpbml0aW9uIGlzIHZpc2libGU8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHNpbmdsZXRvbjogdHJ1ZSBpZiB3aWRnZXQgaXMgYSBzaW5nbGV0b248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGJhY2tncm91bmQ6IHRydWUgaWYgd2lkZ2V0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBhbGxSZXF1aXJlZDogYXJyYXkgb2YgYWxsIHdpZGdldHMgcmVxdWlyZWQgYnkgdGhpcyB3aWRnZXQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSBkaXJlY3RSZXF1aXJlZDogYXJyYXkgb2YgYWxsIHdpZGdldHMgZGlyZWN0bHkgcmVxdWlyZWQgYnkgdGhpcyB3aWRnZXQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB3aWRnZXRUeXBlczogYXJyYXkgb2Ygd2lkZ2V0IHR5cGVzIHRoaXMgd2lkZ2V0IGJlbG9uZ3MgdG88YnI+CgkJPGJyPgoJCXtTdHJpbmd9IHBhdGg6IHVubmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8YnI+Cgk8YnI+CglAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuICBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHR3byBwYXJhbWV0ZXJzOiBhIGVycm9yIG1lc3NhZ2Ugc3RyaW5nLCBhbmQgb3B0aW9uYWxseSBhIHN0YXR1cyBjb2RlCgkKCUBleGFtcGxlCnZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbih3aWRnZXRzKSB7CglpZiAod2lkZ2V0cy5sZW5ndGggPiAwKSB7CgkJYWxlcnQod2lkZ2V0c1swXS52YWx1ZS5uYW1lc3BhY2UpOwoJfQp9OwoKdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yLCBzdGF0dXMpIHsKCWFsZXJ0KGVycm9yKTsKfTsKCk9XRi5QcmVmZXJlbmNlcy5maW5kV2lkZ2V0cyh7CglvblN1Y2Nlc3M6b25TdWNjZXNzLAoJb25GYWlsdXJlOm9uRmFpbHVyZQp9KTsKKi8KCi8qKgoJQGRlc2NyaXB0aW9uIFNhdmVzIGNoYW5nZXMgdG8gZXhpc3Rpbmcgd2lkZ2V0cwoJQG5hbWUgdXBkYXRlQW5kRGVsZXRlV2lkZ2V0cwoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7QXJyYXl9IGNmZy53aWRnZXRzVG9VcGRhdGUgYXJyYXkgb2YgSlNPTiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIHdpZGdldCBndWlkIGFuZCBkYXRhIHRvIGJlIHVwZGF0ZWQKCUBwYXJhbSB7QXJyYXl9IGNmZy53aWRnZXRHdWlkc1RvRGVsZXRlIGFycmF5IG9mIGd1aWRzIG9mIHdpZGdldHMgdG8gYmUgZGVsZXRlZAoJQHBhcmFtIHtCb29sZWFufSBjZmcudXBkYXRlT3JkZXIgZmxhZyB0byB1cGRhdGUgb3JkZXIKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQKCUBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKQogKi8KCi8qKgoJQGRlc2NyaXB0aW9uIFJldHJpZXZlcyB0aGUgdXNlciBwcmVmZXJlbmNlIGZvciB0aGUgcHJvdmlkZWQgbmFtZSBhbmQgbmFtZXNwYWNlCglAbmFtZSBnZXRVc2VyUHJlZmVyZW5jZQoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugb2YgdGhlIHJlcXVlc3RlZCB1c2VyIHByZWZlcmVuY2UKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXIgcHJlZmVyZW5jZQoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgaXMgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tCgl0aGUgZGF0YWJhc2UuICBUaGlzIGZ1bmN0aW9uIHRha2VzIGEgc2luZ2xlIGFyZ3VtZW50LCB3aGljaCBpcyBhIEpTT04gb2JqZWN0LiAgSWYgYSBwcmVmZXJlbmNlIGlzIGZvdW5kLCB0aGUKCWNvbXBsZXRlIEpTT04gc3RydWN0dXJlIGFzIHNob3duIGJlbG93IHdpbGwgYmUgcmV0dXJuZWQuICBJZiBpdCBpcyBub3QgZm91bmQgdGhpcyBmdW5jdGlvbiBiZSBwYXNzZWQgYW4gZW1wdHkgSlNPTiBvYmplY3QuCglAZXhhbXBsZQpUaGUgZm9sbG93aW5nIGlzIGFuIGV4YW1wbGUgb2YgYSBjb21wbGV0ZSBwcmVmZXJlbmNlIG9iamVjdCBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcwpmdW5jdGlvbjoKewoJInZhbHVlIjoidHJ1ZSIsCgkicGF0aCI6Im1pbGl0YXJ5VGltZSIsCgkidXNlciI6Cgl7CgkJInVzZXJJZCI6InRlc3RBZG1pbjEiCgl9LAoJIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIgp9CgkJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoaXMgcGFyYW1ldGVyIGlzIG9wdGlvbmFsLiBJZiB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBzcGVjaWZpZWQgYSBkZWZhdWx0IGVycm9yIAoJCW1lc3NhZ2Ugd2lsbCBiZSBkaXNwbGF5ZWQuVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgaWYgYW4gZXJyb3Igb2NjdXJzIG9uIHByZWZlcmVuY2UgcmV0cmlldmFsLiAgSXQgaXMgbm90CgkJY2FsbGVkIGlmIHRoZSBwcmVmZXJlbmNlIGlzIHNpbXBseSBtaXNzaW5nLgoJCVRoaXMgZnVuY3Rpb24gc2hvdWxkIGFjY2VwdCB0d28gYXJndW1lbnRzOjxicj4KCQk8YnI+CgkJZXJyb3I6IFN0cmluZzxicj4KCQlUaGUgZXJyb3IgbWVzc2FnZTxicj4KCQk8YnI+CgkJU3RhdHVzOiBUaGUgbnVtZXJpYyBIVFRQIFN0YXR1cyBjb2RlIChpZiBhcHBsaWNhYmxlKTxicj4KCQk0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4KCQk1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPgoJCTQwNDogVGhlIHVzZXIgcHJlZmVyZW5jZSB3YXMgbm90IGZvdW5kLjxicj4KCQk0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uPGJyPgoJCQoJCUBleGFtcGxlClRoZSBmb2xsb3dpbmcgc2hvd3MgaG93IHRvIG1ha2UgYSBjYWxsIHRvIGdldFVzZXJQcmVmZXJlbmNlOgpmdW5jdGlvbiBvblN1Y2Nlc3MocHJlZil7CglhbGVydChPem9uZS51dGlsLnRvU3RyaW5nKHByZWYudmFsdWUpKTsKfQoKZnVuY3Rpb24gb25GYWlsdXJlKGVycm9yLHN0YXR1cyl7CglhbGVydCgnRXJyb3IgJyArIGVycm9yKTsKCWFsZXJ0KHN0YXR1cyk7Cn0KCi8vIFRoZSBmb2xsb3dpbmcgY29kZSBjYWxscyBnZXRVc2VyUHJlZmVyZW5jZSB3aXRoIHRoZSBhYm92ZSBkZWZpbmVkIG9uU3VjY2VzcyBhbmQKLy8gb25GYWlsdXJlIGNhbGxiYWNrcy4KT1dGLlByZWZlcmVuY2VzLmdldFVzZXJQcmVmZXJlbmNlKHsKCW5hbWVzcGFjZTonY29tLmNvbXBhbnkud2lkZ2V0JywgCgluYW1lOidGaXJzdCBQcmVzaWRlbnQnLAoJb25TdWNjZXNzOm9uU3VjY2VzcywgCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwoqLwoKLyoqCglAZGVzY3JpcHRpb24gQ2hlY2tzIGZvciB0aGUgZXhpc3RlbmNlIG9mIGEgdXNlciBwcmVmZXJlbmNlIGZvciBhIGdpdmVuIG5hbWVzcGFjZSBhbmQgbmFtZQoJQG5hbWUgZG9lc1VzZXJQcmVmZXJlbmNlRXhpc3QKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWVzcGFjZSBUaGUgbmFtZXNwYWNlIG9mIHRoZSByZXF1ZXN0ZWQgdXNlcgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSByZXF1ZXN0ZWQgdXNlcgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgaWYgYSBwcmVmZXJlbmNlIHN1Y2Nlc3NmdWxseSByZXR1cm4gZnJvbSB0aGUgZGF0YWJhc2UuCglUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgoJPGJyPgoJCXtOdW1iZXJ9IHN0YXR1c0NvZGU6IHN0YXR1cyBjb2RlPGJyPgoJCXtCb29sZWFufSBwcmVmZXJlbmNlRXhpc3Q6IHRydWUgaWYgcHJlZmVyZW5jZSBleGlzdHM8YnI+Cgk8YnI+CiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGlmIHRoZXJlIHdhcwogICAgYW4gZXJyb3IgbG9va2luZyB1cCB0aGUgcHJlZmVyZW5jZS4gIFRoaXMgZnVuY3Rpb24gaXMgPGVtPm5vdDwvZW0+IGNhbGxlZAogICAgaWYgdGhlIHByZWZlcmVuY2Ugc2ltcGx5IGRvZXMgbm90IGV4aXN0CgkKCUBleGFtcGxlCnZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsKCWlmIChvYmouc3RhdHVzQ29kZSA9IDIwMCkgewoJCWFsZXJ0KG9iai5wcmVmZXJlbmNlRXhpc3QpOwoJfQp9OwoKdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CglhbGVydChlcnJvcik7Cn07CgpPV0YuUHJlZmVyZW5jZXMuZG9lc1VzZXJQcmVmZXJlbmNlRXhpc3QoewoJbmFtZXNwYWNlOidmb28uYmFyLjAnLAoJbmFtZTondGVzdCBwYXRoIGVudHJ5IDAnLAoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCUBkZXNjcmlwdGlvbiByZXRyaWV2ZXMgdGhlIGN1cnJlbnQgdXNlciBsb2dnZWQgaW50byB0aGUgc3lzdGVtCglAbmFtZSBnZXRDdXJyZW50VXNlcgoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGZvciBhIHN1Y2Nlc3NmdWwgcmV0cmlldmFsIG9mIHRoZSB1c2VyIGxvZ2dlZCBpbi4KCVRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+Cgk8YnI+CgkJe1N0cmluZ30gY3VycmVudFVzZXJOYW1lOiB1c2VyIG5hbWU8YnI+CgkJe1N0cmluZ30gY3VycmVudFVzZXI6IHVzZXIgcmVhbCBuYW1lPGJyPgoJCXtEYXRlfSBjdXJyZW50VXNlclByZXZMb2dpbjogcHJldmlvdXMgbG9naW4gZGF0ZTxicj4KCQl7TnVtYmVyfSBjdXJyZW50SWQ6IGRhdGFiYXNlIHBrIGluZGV4PGJyPgoJPGJyPgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLltvbkZhaWx1cmVdIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRoZSBzeXN0ZW0gaXMgdW5hYmxlIHRvIHJldHJpZXZlIHRoZSBjdXJyZW50IHVzZXIgbG9nZ2VkIGluLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgoJCglAZXhhbXBsZQp2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ob2JqKSB7CglpZiAob2JqKSB7CgkJYWxlcnQob2JqLmN1cnJlbnRVc2VyKTsKCX0KfTsKCnZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewoJYWxlcnQoZXJyb3IpOwp9OwoKT1dGLlByZWZlcmVuY2VzLmdldEN1cnJlbnRVc2VyKHsKCW9uU3VjY2VzczpvblN1Y2Nlc3MsCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwoqLwoKLyoqCglAZGVzY3JpcHRpb24gRm9yIHJldHJpZXZpbmcgdGhlIE9XRiBzeXN0ZW0gc2VydmVyIHZlcnNpb24KCUBuYW1lIGdldFNlcnZlclZlcnNpb24KCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBmb3Igc3VjY2Vzc2Z1bGx5IHJldHJpZXZpbmcgdGhlIHNlcnZlciB2ZXJzaW9uIG9mIHRoZSBPV0Ygc3lzdGVtLgoJVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KCTxicj4KCQl7U3RyaW5nfSB7c2VydmVyVmVyc2lvbjogc2VydmVyIHZlcnNpb248YnI+Cgk8YnI+CglAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN5c3RlbSBmYWlscyB0byByZXRyaWV2ZSB0aGUgc2VydmVyIHZlcnNpb24gb2YgdGhlIE9XRiBzeXN0ZW0uIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCglAZXhhbXBsZQoJCnZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsKCWlmIChvYmopIHsKCQlhbGVydChvYmouc2VydmVyVmVyc2lvbik7Cgl9Cn07Cgp2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKCWFsZXJ0KGVycm9yKTsKfTsKCk9XRi5QcmVmZXJlbmNlcy5nZXRTZXJ2ZXJWZXJzaW9uKHsKCW9uU3VjY2VzczpvblN1Y2Nlc3MsCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwoqLwoKLyoqCglAZGVzY3JpcHRpb24gQ3JlYXRlcyBvciB1cGRhdGVzIGEgdXNlciBwcmVmZXJlbmNlIGZvciB0aGUgcHJvdmlkZWQgbmFtZXNwYWNlIGFuZCBuYW1lLgoJQG5hbWUgc2V0VXNlclByZWZlcmVuY2UKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWVzcGFjZSAgVGhlIG5hbWVzcGFjZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlCglAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWUgVGhlIG5hbWUgb2YgdGhlIHVzZXIgcHJlZmVyZW5jZQoJQHBhcmFtIHtTdHJpbmd9IGNmZy52YWx1ZSAgVGhlIHZhbHVlIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UuIFRoZSB2YWx1ZSBjYW4gYmUgYW55IHN0cmluZyBpbmNsdWRpbmcgSlNPTi4KCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpZiB0aGUgdXNlciBwcmVmZXJlbmNlIGlzIHN1Y2Nlc3NmdWxseSB1cGRhdGVkIGluCgl0aGUgZGF0YWJhc2UuCgkKCUBleGFtcGxlClRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzIGZ1bmN0aW9uOgp7CgkidmFsdWUiOiJ0cnVlIiwKCSJwYXRoIjoibWlsaXRhcnlUaW1lIiwKCSJ1c2VyIjogewoJCSJ1c2VySWQiOiJ0ZXN0QWRtaW4xIgoJfSwKCSJuYW1lc3BhY2UiOiJjb20ubXljb21wYW55LkFubm91bmNpbmdDbG9jayIKfQoJCUBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgY2Fubm90IGJlIHN0b3JlZCBpbiB0aGUgZGF0YWJhc2UuCgkJSWYgdGhpcyBmdW5jdGlvbiBpcyBub3Qgc3BlY2lmaWVkIGEgZGVmYXVsdCBlcnJvciBtZXNzYWdlIHdpbGwgYmUgZGlzcGxheWVkLiBUaGlzIGZ1bmN0aW9uIGlzIHBhc3NlZAoJCWJhY2sgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KCQk8YnI+CgkJZXJyb3I6IFN0cmluZzxicj4KCQlUaGUgZXJyb3IgbWVzc2FnZTxicj4KCQk8YnI+CgkJU3RhdHVzOiBUaGUgSFRUUCBTdGF0dXMgY29kZTxicj4KCQk0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4KCQk1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPgoJCTQwNDogVGhlIHJlcXVlc3RlZCBlbnRpdHkgd2FzIG5vdCBmb3VuZC48YnI+CgkJNDAwOiBUaGUgcmVxdWVzdGVkIGVudGl0eSBmYWlsZWQgdG8gcGFzcyB2YWxpZGF0aW9uLjxicj4KCQkKCQlAZXhhbXBsZQpmdW5jdGlvbiBvblN1Y2Nlc3MocHJlZil7CglhbGVydChwcmVmLnZhbHVlKTsKfQoKZnVuY3Rpb24gb25GYWlsdXJlKGVycm9yLHN0YXR1cyl7CglhbGVydCgnRXJyb3IgJyArIGVycm9yKTsKCWFsZXJ0KHN0YXR1cyk7Cn0KCnZhciB0ZXh0ID0gJ0dlb3JnZSBXYXNoaW5ndG9uJzsKT1dGLlByZWZlcmVuY2VzLnNldFVzZXJQcmVmZXJlbmNlKHsKCW5hbWVzcGFjZTonY29tLmNvbXBhbnkud2lkZ2V0JywKCW5hbWU6J0ZpcnN0IFByZXNpZGVudCcsCgl2YWx1ZTp0ZXh0LAoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCURlbGV0ZXMgYSB1c2VyIHByZWZlcmVuY2Ugd2l0aCB0aGUgcHJvdmlkZWQgbmFtZXNwYWNlIGFuZCBuYW1lLgoJQG5hbWUgZGVsZXRlVXNlclByZWZlcmVuY2UKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWVzcGFjZSBUaGUgbmFtZXNwYWNlIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZSBUaGUgbmFtZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBpcyBzdWNjZXNzZnVsbHkgZGVsZXRlZCBmcm9tIHRoZSBkYXRhYmFzZS4KCUBleGFtcGxlClRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzCmZ1bmN0aW9uOgoKewoJInZhbHVlIjoidHJ1ZSIsCgkicGF0aCI6Im1pbGl0YXJ5VGltZSIsCgkidXNlciI6Cgl7CgkJInVzZXJJZCI6InRlc3RBZG1pbjEiCgl9LAoJIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIgp9CgkJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBjYW5ub3QgYmUgZGVsZXRlZCBmcm9tIHRoZQoJCWRhdGFiYXNlIG9yIGlmIHRoZSBwcmVmZXJlbmNlIGRvZXMgbm90IGV4aXN0LiBJZiB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBzcGVjaWZpZWQgYSBkZWZhdWx0IGVycm9yIG1lc3NhZ2Ugd2lsbCBiZQoJCWRpc3BsYXllZC4gVGhpcyBmdW5jdGlvbiBpcyBwYXNzZWQgYmFjayB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6IDxicj4KCQk8YnI+CgkJZXJyb3I6IFN0cmluZyA8YnI+CgkJVGhlIGVycm9yIG1lc3NhZ2UgPGJyPgoJCTxicj4KCQlTdGF0dXM6IFRoZSBIVFRQIFN0YXR1cyBjb2RlPGJyPgoJCTxicj4KCQk0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4KCQk1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPgoJCTQwNDogVGhlIHVzZXIgcHJlZmVyZW5jZSB3YXMgbm90IGZvdW5kLjxicj4KCQk0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uIDxicj4KCQk8YnI+CgkJQGV4YW1wbGUKZnVuY3Rpb24gb25TdWNjZXNzKHByZWYpewoJYWxlcnQocHJlZi52YWx1ZSk7Cn0KCmZ1bmN0aW9uIG9uRmFpbHVyZShlcnJvcixzdGF0dXMpewoJYWxlcnQoJ0Vycm9yICcgKyBlcnJvcik7CglhbGVydChzdGF0dXMpOwp9CgpPV0YuUHJlZmVyZW5jZXMuZGVsZXRlVXNlclByZWZlcmVuY2UoewoJbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLAoJbmFtZTonRmlyc3QgUHJlc2lkZW50JywKCW9uU3VjY2VzczpvblN1Y2Nlc3MsCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwogKi8KCi8qKgoJVGhpcyBtZXRob2QgaW5mb3JtcyBhIHdpZGdldCBkZXZlbG9wZXIgaWYgdGhlaXIgd2lkZ2V0IGlzIHJ1bm5pbmcgZnJvbSB0aGUgT1dGIG9yIGZyb20gYSBkaXJlY3QgVVJMIGNhbGwuCglAbmFtZSBpc1J1bm5pbmdJbk9XRgoJQG1ldGhvZE9mIE9XRi5VdGlsCgoJQHJldHVybnMgIGJvb2xlYW4gdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGluc2lkZSBPV0YsIGZhbHNlIG90aGVyd2lzZS4KICovCgovKioKIEBuYW1lIGlzSW5Db250YWluZXIKIEBtZXRob2RPZiBPV0YuVXRpbAogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgaW5mb3JtcyBhIHdpZGdldCBkZXZlbG9wZXIgaWYgdGhlaXIgd2lkZ2V0IGlzIHJ1bm5pbmcKICogaW4gYSBDb250YWluZXIsIGxpa2UgT1dGCiAqCiAqIEByZXR1cm5zICBib29sZWFuIHRydWUgaWYgdGhlIHdpZGdldCBpcyBpbnNpZGUgYSBjb250YWluZXIsIGZhbHNlIG90aGVyd2lzZS4KICoKICovCgovKioKCVJldHVybnMgYSBnbG9iYWxseSB1bmlxdWUgaWRlbnRpZmllciAoZ3VpZCkuCglAbmFtZSBndWlkCglAbWV0aG9kT2YgT1dGLlV0aWwKCglAcmV0dXJucyAgYm9vbGVhbiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgaW5zaWRlIE9XRiwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KCi8qKgoJVGhpcyBtZXRob2QgcmV0dXJucyBmbGFzaC9mbGV4IGRvbSBlbGVtZW50IGZyb20gZG9tLgoJQG5hbWUgZ2V0Rmxhc2hBcHAKCUBtZXRob2RPZiBPV0YuVXRpbAoJCglAcGFyYW0ge1N0cmluZ30gaWQgaWQgb2YgdGhlIGZsZXggZG9tIGVsZW1lbnQKCglAcmV0dXJucyAgZmxhc2gvZmxleCBvYmplY3QgZnJvbSBkb20KICovCgogLyoqCglCYXNpYyBsb2dnaW5nIGNhcGFiaWxpdHkgLSBtZWFudCB0byBiZSBjYWxsZWQgYnkgb3RoZXIgbWV0aG9kcyB3aGljaCB0cmFuc2Zvcm0gb3IgdmFsaWRhdGUgZGF0YS4KCUBuYW1lIGxvZ01ldHJpYwoJQG1ldGhvZE9mIE9XRi5NZXRyaWNzCglAc2luY2UgT1dGIDMuOC4wCgoJQHBhcmFtIHtTdHJpbmd9IHVzZXJJZAoJQHBhcmFtIHtTdHJpbmd9IHVzZXJOYW1lCglAcGFyYW0ge1N0cmluZ30gbWV0cmljU2l0ZSBJZGVudGlmaWVyLCBwb3RlbnRpYWxseSBVUkwsIGZvciBzb3VyY2Ugb2YgbWV0cmljIC0gdHlwaWNhbGx5IE9XRiBpbnN0YW5jZQoJQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudE5hbWUgICAgCglAcGFyYW0ge1N0cmluZ30gY29tcG9uZW50SWQgCglAcGFyYW0ge1N0cmluZ30gY29tcG9uZW50SW5zdGFuY2VJZAoJQHBhcmFtIHtTdHJpbmd9IG1ldHJpY1R5cGVJZCBTdHJpbmcgZGVzY3JpYmluZyBtZXRyaWMgLSByZWNvbW1lbmQgcGFja2FnZSBuYW1lIGNvbnN0cnVjdAoJQHBhcmFtIHtTdHJpbmd9IG1ldHJpY0RhdGEgQW55IGFkZGl0aW9uYWwgZGF0YSBmb3IgbWV0cmljIC0gZG8gYW55IG5lY2Vzc2FyeSB2YWxpZGF0aW9uIGFwcHJvcHJpYXRlIHRvIG1ldHJpY1R5cGVJZCBiZWZvcmUgc2VuZGluZyB0aHJvdWdoIAogKi8KCi8qKgogKiBAZGVzY3JpcHRpb24gTG9ncyBhIHNldCBvZiBtZXRyaWNzIHRvIHRoZSBzZXJ2ZXIgYWxsIGF0IG9uY2UuICBBbGwKICogbWV0cmljcyBwYXNzZWQgaW50byBhIGNhbGwgdG8gdGhpcyBmdW5jdGlvbiB3aWxsIGJlIGxvZ2dlZCBpbiBhIHNpbmdsZQogKiBIVFRQIHJlcXVlc3QsIGluc3RlYWQgb2Ygb25lIHJlcXVlc3QgcGVyIG1ldHJpYwogKiBAbmFtZSBsb2dCYXRjaE1ldHJpY3MKICogQG1ldGhvZE9mIE9XRi5NZXRyaWNzCiAqIEBzaW5jZSBPV0YgNi4wCiAqCiAqIEBwYXJhbSB7QXJyYXl9IG1ldHJpY3MgCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLnVzZXJJZAogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS51c2VyTmFtZQogKiBAcGFyYW0ge051bWJlcn0gbWV0cmljc1sqXS5tZXRyaWNUaW1lIFRoZSB0aW1lIGF0IHdoaWNoIGlzIG1ldHJpYyB3YXMgY29sbGVjdGVkIChpbiBVTklYIHRpbWUpCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLnNpdGUgSWRlbnRpZmllciwgcG90ZW50aWFsbHkgVVJMLCBmb3Igc291cmNlIG9mIG1ldHJpYyAtIHR5cGljYWxseSBPV0YgaW5zdGFuY2UKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uY29tcG9uZW50CiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLmNvbXBvbmVudElkIAogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS5pbnN0YW5jZUlkCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLm1ldHJpY1R5cGVJZCBTdHJpbmcgZGVzY3JpYmluZyBtZXRyaWMgLSByZWNvbW1lbmQgcGFja2FnZSBuYW1lIGNvbnN0cnVjdAogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS53aWRnZXREYXRhIEFueSBhZGRpdGlvbmFsIGRhdGEgZm9yIG1ldHJpYyAtIGRvIGFueSBuZWNlc3NhcnkgdmFsaWRhdGlvbiBhcHByb3ByaWF0ZSB0byBtZXRyaWNUeXBlSWQgYmVmb3JlIHNlbmRpbmcgdGhyb3VnaCAKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0udXNlckFnZW50IFNob3VsZCBiZSBzZXQgdG8gdGhlIHVzZXItYWdlbnQgc3RyaW5nIG9mIHRoZSBicm93c2VyCiAqLwoKLyoqCglMb2cgdmlldyBvZiB3aWRnZXQgLSBzZWUgY2FsbHMgaW4gZGFzaGJvYXJkcy4KCUBuYW1lIGxvZ1dpZGdldFJlbmRlcgoJQG1ldGhvZE9mIE9XRi5NZXRyaWNzCglAc2luY2UgT1dGIDMuOC4wCgkKCUBwYXJhbSB7U3RyaW5nfSB1c2VySWQgICAgIC0gc2VlIE96b25lLm1ldHJpY3MubG9nTWV0cmljIHVzZXJJZAoJQHBhcmFtIHtTdHJpbmd9IHVzZXJOYW1lICAgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgdXNlck5hbWUKCUBwYXJhbSB7U3RyaW5nfSBtZXRyaWNTaXRlIC0gc2VlIE96b25lLm1ldHJpY3MubG9nTWV0cmljIG1ldHJpY1NpdGUKCUBwYXJhbSB7T2JqZWN0fSB3aWRnZXQgICAKICovCgovKioKCUdldCBhIGxvZ2dlciBieSBuYW1lLCBpZiB0aGUgbG9nZ2VyIGhhcyBub3QgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgaXQgd2lsbCBiZSBjcmVhdGVkLgoJQG5hbWUgZ2V0TG9nZ2VyCglAbWV0aG9kT2YgT1dGLkxvZwoJQHNpbmNlIE9XRiAzLjguMAoJQHBhcmFtIHtTdHJpbmd9IGxvZ2dlck5hbWUKICovCgovKioKCUVuYWJsZS9EaXNhYmxlIGxvZ2dpbmcgZm9yIHRoZSBPV0YgYXBwbGljYXRpb24uCglAbmFtZSBzZXRFbmFibGVkCglAbWV0aG9kT2YgT1dGLkxvZwoJQHNpbmNlIE9XRiAzLjguMAoJQHBhcmFtIHtCb29sZWFufSBlbmFibGVkIHRydWUgd2lsbCBlbmFibGUgbG9nZ2luZyBmYWxzZSB3aWxsIGRpc2FibGUKICovCgovKioKCUdldCBPV0YncyBkZWZhdWx0IGxvZ2dlcgoJQG5hbWUgZ2V0RGVmYXVsdExvZ2dlcgoJQG1ldGhvZE9mIE9XRi5Mb2cKCUBzaW5jZSBPV0YgMy44LjAKICovCgovKioKCUxhdW5jaCB0aGUgbG9nIHdpbmRvdyBwb3AtdXAsIHRoaXMgd2lsbCByZS1sYXVuY2ggdGhlIHdpbmRvdyBpbiB0aGUgZXZlbnQgaXQgaGFzIGJlZW4gY2xvc2VkLgoJQG5hbWUgbGF1bmNoUG9wdXBBcHBlbmRlcgoJQG1ldGhvZE9mIE9XRi5Mb2cKCUBzaW5jZSBPV0YgMy44LjAKICovCgovKioKCUdldHMgdGhlIGxhbmd1YWdlIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIHVzZWQgYnkgT1dGLgoJQG5hbWUgZ2V0TGFuZ3VhZ2UKCUBtZXRob2RPZiBPV0YuTGFuZwoKCUByZXR1cm5zIHtTdHJpbmd9IFJldHVybnMgdGhlIElTTyA2MzktMSBsYW5ndWFnZSBjb2RlIGZvciB0aGUgbGFuZ3VhZ2UgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgdXNlZCBieSBPV0YuCiAqLwoKaWYgKCFPem9uZS5kaXNhYmxlV2lkZ2V0SW5pdCkgew0KDQoNCiAgICBvd2Zkb2pvLmFkZE9uTG9hZChmdW5jdGlvbigpIHsNCg0KICAgICAgICAvL2NhbGMgcGFnZWxvYWQgdGltZQ0KICAgICAgICBPem9uZS51dGlsLnBhZ2VMb2FkLmFmdGVyTG9hZCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7DQogICAgICAgIE96b25lLnV0aWwucGFnZUxvYWQuY2FsY0xvYWRUaW1lKCk7DQoNCiAgICAgICAgaWYoT3pvbmUudXRpbC5pc0luQ29udGFpbmVyKCkpIHsNCiAgICAgICAgICAgIE9XRi5faW5pdCh3aW5kb3csIGRvY3VtZW50KTsNCiAgICAgICAgfQ0KDQogICAgfSk7DQp9Cg==",
                "body": "LyoNCglDb3B5cmlnaHQgKGMpIDIwMDQtMjAxMCwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLg0KCUF2YWlsYWJsZSB2aWEgQWNhZGVtaWMgRnJlZSBMaWNlbnNlID49IDIuMSBPUiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UuDQoJc2VlOiBodHRwOi8vZG9qb3Rvb2xraXQub3JnL2xpY2Vuc2UgZm9yIGRldGFpbHMNCiovDQoNCi8qDQoJVGhpcyBpcyBhbiBvcHRpbWl6ZWQgdmVyc2lvbiBvZiBEb2pvLCBidWlsdCBmb3IgZGVwbG95bWVudCBhbmQgbm90IGZvcg0KCWRldmVsb3BtZW50LiBUbyBnZXQgc291cmNlcyBhbmQgZG9jdW1lbnRhdGlvbiwgcGxlYXNlIHZpc2l0Og0KDQoJCWh0dHA6Ly9kb2pvdG9vbGtpdC5vcmcNCiovDQoNCjsoZnVuY3Rpb24oKXsNCg0KCS8qDQoJZG9qbywgZGlqaXQsIGFuZCBkb2pveCBtdXN0IGFsd2F5cyBiZSB0aGUgZmlyc3QgdGhyZWUsIGFuZCBpbiB0aGF0IG9yZGVyLg0KCWRqQ29uZmlnLnNjb3BlTWFwID0gWw0KCQlbImRvam8iLCAiZm9qbyJdLA0KCQlbImRpaml0IiwgImZpaml0Il0sDQoJCVsiZG9qb3giLCAiZm9qb3giXQ0KCQ0KCV0NCgkqLw0KDQoJZXZhbCgidmFyIGRqQ29uZmlnID0ge3Njb3BlTWFwOltbXCJkb2pvXCIsXCJvd2Zkb2pvXCJdLFtcImRpaml0XCIsXCJvd2ZkaWppdFwiXSxbXCJkb2pveFwiLFwib3dmZG9qb3hcIl1dfTsiKTsNCg0KCS8vVGhlIG51bGwgYmVsb3cgY2FuIGJlIHJlbGFjZWQgYnkgYSBidWlsZC10aW1lIHZhbHVlIHVzZWQgaW5zdGVhZCBvZiBkakNvbmZpZy5zY29wZU1hcC4NCgl2YXIgc01hcCA9IG51bGw7DQoNCgkvL1NlZSBpZiBuZXcgc2NvcGVzIG5lZWQgdG8gYmUgZGVmaW5lZC4NCglpZigoc01hcCB8fCAodHlwZW9mIGRqQ29uZmlnICE9ICJ1bmRlZmluZWQiICYmIGRqQ29uZmlnLnNjb3BlTWFwKSkgJiYgKHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIpKXsNCgkJdmFyIHNjb3BlRGVmID0gIiIsIHNjb3BlUHJlZml4ID0gIiIsIHNjb3BlU3VmZml4ID0gIiIsIHNjb3BlTWFwID0ge30sIHNjb3BlTWFwUmV2ID0ge307DQoJCXNNYXAgPSBzTWFwIHx8IGRqQ29uZmlnLnNjb3BlTWFwOw0KCQlmb3IodmFyIGkgPSAwOyBpIDwgc01hcC5sZW5ndGg7IGkrKyl7DQoJCQkvL01ha2UgbG9jYWwgdmFyaWFibGVzLCB0aGVuIGdsb2JhbCB2YXJpYWJsZXMgdGhhdCB1c2UgdGhlIGxvY2Fscy4NCgkJCXZhciBuZXdTY29wZSA9IHNNYXBbaV07DQoJCQlzY29wZURlZiArPSAidmFyICIgKyBuZXdTY29wZVswXSArICIgPSB7fTsgIiArIG5ld1Njb3BlWzFdICsgIiA9ICIgKyBuZXdTY29wZVswXSArICI7IiArIG5ld1Njb3BlWzFdICsgIi5fc2NvcGVOYW1lID0gJyIgKyBuZXdTY29wZVsxXSArICInOyI7DQoJCQlzY29wZVByZWZpeCArPSAoaSA9PSAwID8gIiIgOiAiLCIpICsgbmV3U2NvcGVbMF07DQoJCQlzY29wZVN1ZmZpeCArPSAoaSA9PSAwID8gIiIgOiAiLCIpICsgbmV3U2NvcGVbMV07DQoJCQlzY29wZU1hcFtuZXdTY29wZVswXV0gPSBuZXdTY29wZVsxXTsNCgkJCXNjb3BlTWFwUmV2W25ld1Njb3BlWzFdXSA9IG5ld1Njb3BlWzBdOw0KCQl9DQoNCgkJZXZhbChzY29wZURlZiArICJkb2pvLl9zY29wZUFyZ3MgPSBbIiArIHNjb3BlU3VmZml4ICsgIl07Iik7DQoNCgkJZG9qby5fc2NvcGVQcmVmaXhBcmdzID0gc2NvcGVQcmVmaXg7DQoJCWRvam8uX3Njb3BlUHJlZml4ID0gIihmdW5jdGlvbigiICsgc2NvcGVQcmVmaXggKyAiKXsiOw0KCQlkb2pvLl9zY29wZVN1ZmZpeCA9ICJ9KSgiICsgc2NvcGVTdWZmaXggKyAiKSI7DQoJCWRvam8uX3Njb3BlTWFwID0gc2NvcGVNYXA7DQoJCWRvam8uX3Njb3BlTWFwUmV2ID0gc2NvcGVNYXBSZXY7DQoJfQ0KDQovKj09PT09DQovLyBub3RlOg0KLy8JCSdkakNvbmZpZycgZG9lcyBub3QgZXhpc3QgdW5kZXIgJ2Rvam8uKicgc28gdGhhdCBpdCBjYW4gYmUgc2V0IGJlZm9yZSB0aGUNCi8vCQknZG9qbycgdmFyaWFibGUgZXhpc3RzLg0KLy8gbm90ZToNCi8vCQlTZXR0aW5nIGFueSBvZiB0aGVzZSB2YXJpYWJsZXMgKmFmdGVyKiB0aGUgbGlicmFyeSBoYXMgbG9hZGVkIGRvZXMNCi8vCQlub3RoaW5nIGF0IGFsbC4NCg0KZGpDb25maWcgPSB7DQoJLy8gc3VtbWFyeToNCgkvLwkJQXBwbGljYXRpb24gY29kZSBjYW4gc2V0IHRoZSBnbG9iYWwgJ2RqQ29uZmlnJyBwcmlvciB0byBsb2FkaW5nDQoJLy8JCXRoZSBsaWJyYXJ5IHRvIG92ZXJyaWRlIGNlcnRhaW4gZ2xvYmFsIHNldHRpbmdzIGZvciBob3cgZG9qbyB3b3Jrcy4NCgkvLw0KCS8vIGlzRGVidWc6IEJvb2xlYW4NCgkvLwkJRGVmYXVsdHMgdG8gYGZhbHNlYC4gSWYgc2V0IHRvIGB0cnVlYCwgZW5zdXJlcyB0aGF0IERvam8gcHJvdmlkZXMNCgkvLwkJZXh0ZW5kZWQgZGVidWdnaW5nIGZlZWRiYWNrIHZpYSBGaXJlYnVnLiBJZiBGaXJlYnVnIGlzIG5vdCBhdmFpbGFibGUNCgkvLwkJb24geW91ciBwbGF0Zm9ybSwgc2V0dGluZyBgaXNEZWJ1Z2AgdG8gYHRydWVgIHdpbGwgZm9yY2UgRG9qbyB0bw0KCS8vCQlwdWxsIGluIChhbmQgZGlzcGxheSkgdGhlIHZlcnNpb24gb2YgRmlyZWJ1ZyBMaXRlIHdoaWNoIGlzDQoJLy8JCWludGVncmF0ZWQgaW50byB0aGUgRG9qbyBkaXN0cmlidXRpb24sIHRoZXJlYnkgYWx3YXlzIHByb3ZpZGluZyBhDQoJLy8JCWRlYnVnZ2luZy9sb2dnaW5nIGNvbnNvbGUgd2hlbiBgaXNEZWJ1Z2AgaXMgZW5hYmxlZC4gTm90ZSB0aGF0DQoJLy8JCUZpcmVidWcncyBgY29uc29sZS4qYCBtZXRob2RzIGFyZSBBTFdBWVMgZGVmaW5lZCBieSBEb2pvLiBJZg0KCS8vCQlgaXNEZWJ1Z2AgaXMgZmFsc2UgYW5kIHlvdSBhcmUgb24gYSBwbGF0Zm9ybSB3aXRob3V0IEZpcmVidWcsIHRoZXNlDQoJLy8JCW1ldGhvZHMgd2lsbCBiZSBkZWZpbmVkIGFzIG5vLW9wcy4NCglpc0RlYnVnOiBmYWxzZSwNCgkvLyBkZWJ1Z0F0QWxsQ29zdHM6IEJvb2xlYW4NCgkvLwkJRGVmYXVsdHMgdG8gYGZhbHNlYC4gSWYgc2V0IHRvIGB0cnVlYCwgdGhpcyB0cmlnZ2VycyBhbiBhbHRlcm5hdGUNCgkvLwkJbW9kZSBvZiB0aGUgcGFja2FnZSBzeXN0ZW0gaW4gd2hpY2ggZGVwZW5kZW5jaWVzIGFyZSBkZXRlY3RlZCBhbmQNCgkvLwkJb25seSB0aGVuIGFyZSByZXNvdXJjZXMgZXZhbHVhdGVkIGluIGRlcGVuZGVuY3kgb3JkZXIgdmlhDQoJLy8JCWA8c2NyaXB0PmAgdGFnIGluY2x1c2lvbi4gVGhpcyBtYXkgZG91YmxlLXJlcXVlc3QgcmVzb3VyY2VzIGFuZA0KCS8vCQljYXVzZSBwcm9ibGVtcyB3aXRoIHNjcmlwdHMgd2hpY2ggZXhwZWN0IGBkb2pvLnJlcXVpcmUoKWAgdG8NCgkvLwkJcHJlZm9ybSBzeW5jaHJvbm91c2x5LiBgZGVidWdBdEFsbENvc3RzYCBjYW4gYmUgYW4gaW52YWx1YWJsZQ0KCS8vCQlkZWJ1Z2dpbmcgYWlkLCBidXQgd2hlbiB1c2luZyBpdCwgZW5zdXJlIHRoYXQgYWxsIGNvZGUgd2hpY2gNCgkvLwkJZGVwZW5kcyBvbiBEb2pvIG1vZHVsZXMgaXMgd3JhcHBlZCBpbiBgZG9qby5hZGRPbkxvYWQoKWAgaGFuZGxlcnMuDQoJLy8JCUR1ZSB0byB0aGUgc29tZXdoYXQgdW5wcmVkaWN0YWJsZSBzaWRlLWVmZmVjdHMgb2YgdXNpbmcNCgkvLwkJYGRlYnVnQXRBbGxDb3N0c2AsIGl0IGlzIHN0cm9uZ2x5IHJlY29tbWVuZGVkIHRoYXQgeW91IGVuYWJsZSB0aGlzDQoJLy8JCWZsYWcgYXMgYSBsYXN0IHJlc29ydC4gYGRlYnVnQXRBbGxDb3N0c2AgaGFzIG5vIGVmZmVjdCB3aGVuIGxvYWRpbmcNCgkvLwkJcmVzb3VyY2VzIGFjcm9zcyBkb21haW5zLiBGb3IgdXNhZ2UgaW5mb3JtYXRpb24sIHNlZSB0aGUNCgkvLwkJW0Rvam8gQm9va10oaHR0cDovL2Rvam90b29sa2l0Lm9yZy9ib29rL2Jvb2stZG9qby9wYXJ0LTQtbWV0YS1kb2pvLW1ha2luZy15b3VyLWRvam8tY29kZS1ydW4tZmFzdGVyLWFuZC1iZXR0ZXIvZGVidWdnaW5nLWZhY2lsaXRpZXMvZGViKQ0KCWRlYnVnQXRBbGxDb3N0czogZmFsc2UsDQoJLy8gbG9jYWxlOiBTdHJpbmcNCgkvLwkJVGhlIGxvY2FsZSB0byBhc3N1bWUgZm9yIGxvYWRpbmcgbG9jYWxpemVkIHJlc291cmNlcyBpbiB0aGlzIHBhZ2UsDQoJLy8JCXNwZWNpZmllZCBhY2NvcmRpbmcgdG8gW1JGQyAzMDY2XShodHRwOi8vd3d3LmlldGYub3JnL3JmYy9yZmMzMDY2LnR4dCkuDQoJLy8JCU11c3QgYmUgc3BlY2lmaWVkIGVudGlyZWx5IGluIGxvd2VyY2FzZSwgZS5nLiBgZW4tdXNgIGFuZCBgemgtY25gLg0KCS8vCQlTZWUgdGhlIGRvY3VtZW50YXRpb24gZm9yIGBkb2pvLmkxOG5gIGFuZCBgZG9qby5yZXF1aXJlTG9jYWxpemF0aW9uYA0KCS8vCQlmb3IgZGV0YWlscyBvbiBsb2FkaW5nIGxvY2FsaXplZCByZXNvdXJjZXMuIElmIG5vIGxvY2FsZSBpcyBzcGVjaWZpZWQsDQoJLy8JCURvam8gYXNzdW1lcyB0aGUgbG9jYWxlIG9mIHRoZSB1c2VyIGFnZW50LCBhY2NvcmRpbmcgdG8gYG5hdmlnYXRvci51c2VyTGFuZ3VhZ2VgDQoJLy8JCW9yIGBuYXZpZ2F0b3IubGFuZ3VhZ2VgIHByb3BlcnRpZXMuDQoJbG9jYWxlOiB1bmRlZmluZWQsDQoJLy8gZXh0cmFMb2NhbGU6IEFycmF5DQoJLy8JCU5vIGRlZmF1bHQgdmFsdWUuIFNwZWNpZmllcyBhZGRpdGlvbmFsIGxvY2FsZXMgd2hvc2UNCgkvLwkJcmVzb3VyY2VzIHNob3VsZCBhbHNvIGJlIGxvYWRlZCBhbG9uZ3NpZGUgdGhlIGRlZmF1bHQgbG9jYWxlIHdoZW4NCgkvLwkJY2FsbHMgdG8gYGRvam8ucmVxdWlyZUxvY2FsaXphdGlvbigpYCBhcmUgcHJvY2Vzc2VkLg0KCWV4dHJhTG9jYWxlOiB1bmRlZmluZWQsDQoJLy8gYmFzZVVybDogU3RyaW5nDQoJLy8JCVRoZSBkaXJlY3RvcnkgaW4gd2hpY2ggYGRvam8uanNgIGlzIGxvY2F0ZWQuIFVuZGVyIG5vcm1hbA0KCS8vCQljb25kaXRpb25zLCBEb2pvIGF1dG8tZGV0ZWN0cyB0aGUgY29ycmVjdCBsb2NhdGlvbiBmcm9tIHdoaWNoIGl0DQoJLy8JCXdhcyBsb2FkZWQuIFlvdSBtYXkgbmVlZCB0byBtYW51YWxseSBjb25maWd1cmUgYGJhc2VVcmxgIGluIGNhc2VzDQoJLy8JCXdoZXJlIHlvdSBoYXZlIHJlbmFtZWQgYGRvam8uanNgIG9yIGluIHdoaWNoIGA8YmFzZT5gIHRhZ3MgY29uZnVzZQ0KCS8vCQlzb21lIGJyb3dzZXJzIChlLmcuIElFIDYpLiBUaGUgdmFyaWFibGUgYGRvam8uYmFzZVVybGAgaXMgYXNzaWduZWQNCgkvLwkJZWl0aGVyIHRoZSB2YWx1ZSBvZiBgZGpDb25maWcuYmFzZVVybGAgaWYgb25lIGlzIHByb3ZpZGVkIG9yIHRoZQ0KCS8vCQlhdXRvLWRldGVjdGVkIHJvb3QgaWYgbm90LiBPdGhlciBtb2R1bGVzIGFyZSBsb2NhdGVkIHJlbGF0aXZlIHRvDQoJLy8JCXRoaXMgcGF0aC4gVGhlIHBhdGggc2hvdWxkIGVuZCBpbiBhIHNsYXNoLg0KCWJhc2VVcmw6IHVuZGVmaW5lZCwNCgkvLyBtb2R1bGVQYXRoczogT2JqZWN0DQoJLy8JCUEgbWFwIG9mIG1vZHVsZSBuYW1lcyB0byBwYXRocyByZWxhdGl2ZSB0byBgZG9qby5iYXNlVXJsYC4gVGhlDQoJLy8JCWtleS92YWx1ZSBwYWlycyBjb3JyZXNwb25kIGRpcmVjdGx5IHRvIHRoZSBhcmd1bWVudHMgd2hpY2gNCgkvLwkJYGRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoYCBhY2NlcHRzLiBTcGVjaWZpeWluZw0KCS8vCQlgZGpDb25maWcubW9kdWxlUGF0aHMgPSB7ICJmb28iOiAiLi4vLi4vYmFyIiB9YCBpcyB0aGUgZXF1aXZhbGVudA0KCS8vCQlvZiBjYWxsaW5nIGBkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgiZm9vIiwgIi4uLy4uL2JhciIpO2AuIE11bHRpcGxlDQoJLy8JCW1vZHVsZXMgbWF5IGJlIGNvbmZpZ3VyZWQgdmlhIGBkakNvbmZpZy5tb2R1bGVQYXRoc2AuDQoJbW9kdWxlUGF0aHM6IHt9LA0KCS8vIGFmdGVyT25Mb2FkOiBCb29sZWFuIA0KCS8vCQlJbmRpY2F0ZXMgRG9qbyB3YXMgYWRkZWQgdG8gdGhlIHBhZ2UgYWZ0ZXIgdGhlIHBhZ2UgbG9hZC4gSW4gdGhpcyBjYXNlDQoJLy8JCURvam8gd2lsbCBub3Qgd2FpdCBmb3IgdGhlIHBhZ2UgRE9NQ29udGVudExvYWQvbG9hZCBldmVudHMgYW5kIGZpcmUNCgkvLwkJaXRzIGRvam8uYWRkT25Mb2FkIGNhbGxiYWNrcyBhZnRlciBtYWtpbmcgc3VyZSBhbGwgb3V0c3RhbmRpbmcNCgkvLwkJZG9qby5yZXF1aXJlZCBtb2R1bGVzIGhhdmUgbG9hZGVkLiBPbmx5IHdvcmtzIHdpdGggYSBidWlsdCBkb2pvLmpzLA0KCS8vCQlpdCBkb2VzIG5vdCB3b3JrIHRoZSBkb2pvLmpzIGRpcmVjdGx5IGZyb20gc291cmNlIGNvbnRyb2wuDQoJYWZ0ZXJPbkxvYWQ6IGZhbHNlLA0KCS8vIGFkZE9uTG9hZDogRnVuY3Rpb24gb3IgQXJyYXkNCgkvLwkJQWRkcyBhIGNhbGxiYWNrIHZpYSBkb2pvLmFkZE9uTG9hZC4gVXNlZnVsIHdoZW4gRG9qbyBpcyBhZGRlZCBhZnRlcg0KCS8vCQl0aGUgcGFnZSBsb2FkcyBhbmQgZGpDb25maWcuYWZ0ZXJPbkxvYWQgaXMgdHJ1ZS4gU3VwcG9ydHMgdGhlIHNhbWUNCgkvLwkJYXJndW1lbnRzIGFzIGRvam8uYWRkT25Mb2FkLiBXaGVuIHVzaW5nIGEgZnVuY3Rpb24gcmVmZXJlbmNlLCB1c2UNCgkvLwkJYGRqQ29uZmlnLmFkZE9uTG9hZCA9IGZ1bmN0aW9uKCl7fTtgLiBGb3Igb2JqZWN0IHdpdGggZnVuY3Rpb24gbmFtZSB1c2UNCgkvLwkJYGRqQ29uZmlnLmFkZE9uTG9hZCA9IFtteU9iamVjdCwgImZ1bmN0aW9uTmFtZSJdO2AgYW5kIGZvciBvYmplY3Qgd2l0aA0KCS8vCQlmdW5jdGlvbiByZWZlcmVuY2UgdXNlDQoJLy8JCWBkakNvbmZpZy5hZGRPbkxvYWQgPSBbbXlPYmplY3QsIGZ1bmN0aW9uKCl7fV07YA0KCWFkZE9uTG9hZDogbnVsbCwNCgkvLyByZXF1aXJlOiBBcnJheQ0KCS8vCQlBbiBhcnJheSBvZiBtb2R1bGUgbmFtZXMgdG8gYmUgbG9hZGVkIGltbWVkaWF0ZWx5IGFmdGVyIGRvam8uanMgaGFzIGJlZW4gaW5jbHVkZWQNCgkvLwkJaW4gYSBwYWdlLg0KCXJlcXVpcmU6IFtdLA0KCS8vIGRlZmF1bHREdXJhdGlvbjogQXJyYXkNCgkvLwkJRGVmYXVsdCBkdXJhdGlvbiwgaW4gbWlsbGlzZWNvbmRzLCBmb3Igd2lwZSBhbmQgZmFkZSBhbmltYXRpb25zIHdpdGhpbiBkaWppdHMuDQoJLy8JCUFzc2lnbmVkIHRvIGRpaml0LmRlZmF1bHREdXJhdGlvbi4NCglkZWZhdWx0RHVyYXRpb246IDIwMCwNCgkvLyBkb2pvQmxhbmtIdG1sVXJsOiBTdHJpbmcNCgkvLwkJVXNlZCBieSBzb21lIG1vZHVsZXMgdG8gY29uZmlndXJlIGFuIGVtcHR5IGlmcmFtZS4gVXNlZCBieSBkb2pvLmlvLmlmcmFtZSBhbmQNCgkvLwkJZG9qby5iYWNrLCBhbmQgZGlqaXQgcG9wdXAgc3VwcG9ydCBpbiBJRSB3aGVyZSBhbiBpZnJhbWUgaXMgbmVlZGVkIHRvIG1ha2Ugc3VyZSBuYXRpdmUNCgkvLwkJY29udHJvbHMgZG8gbm90IGJsZWVkIHRocm91Z2ggdGhlIHBvcHVwcy4gTm9ybWFsbHkgdGhpcyBjb25maWd1cmF0aW9uIHZhcmlhYmxlIA0KCS8vCQlkb2VzIG5vdCBuZWVkIHRvIGJlIHNldCwgZXhjZXB0IHdoZW4gdXNpbmcgY3Jvc3MtZG9tYWluL0NETiBEb2pvIGJ1aWxkcy4NCgkvLwkJU2F2ZSBkb2pvL3Jlc291cmNlcy9ibGFuay5odG1sIHRvIHlvdXIgZG9tYWluIGFuZCBzZXQgYGRqQ29uZmlnLmRvam9CbGFua0h0bWxVcmxgDQoJLy8JCXRvIHRoZSBwYXRoIG9uIHlvdXIgZG9tYWluIHlvdXIgY29weSBvZiBibGFuay5odG1sLg0KCWRvam9CbGFua0h0bWxVcmw6IHVuZGVmaW5lZCwNCgkvLwlpb1B1Ymxpc2g6IEJvb2xlYW4/DQoJLy8JCVNldCB0aGlzIHRvIHRydWUgdG8gZW5hYmxlIHB1Ymxpc2hpbmcgb2YgdG9waWNzIGZvciB0aGUgZGlmZmVyZW50IHBoYXNlcyBvZg0KCS8vIAkJSU8gb3BlcmF0aW9ucy4gUHVibGlzaGluZyBpcyBkb25lIHZpYSBkb2pvLnB1Ymxpc2guIFNlZSBkb2pvLl9fSW9QdWJsaXNoIGZvciBhIGxpc3QNCgkvLyAJCW9mIHRvcGljcyB0aGF0IGFyZSBwdWJsaXNoZWQuDQoJaW9QdWJsaXNoOiBmYWxzZSwNCgkvLyAgdXNlQ3VzdG9tTG9nZ2VyOiBBbnl0aGluZz8NCgkvLwkJSWYgc2V0IHRvIGEgdmFsdWUgdGhhdCBldmFsdWF0ZXMgdG8gdHJ1ZSBzdWNoIGFzIGEgc3RyaW5nIG9yIGFycmF5IGFuZA0KCS8vCQlpc0RlYnVnIGlzIHRydWUgYW5kIEZpcmVidWcgaXMgbm90IGF2YWlsYWJsZSBvciBydW5uaW5nLCB0aGVuIGl0IGJ5cGFzc2VzDQoJLy8JCXRoZSBjcmVhdGlvbiBvZiBGaXJlYnVnIExpdGUgYWxsb3dpbmcgeW91IHRvIGRlZmluZSB5b3VyIG93biBjb25zb2xlIG9iamVjdC4NCgl1c2VDdXN0b21Mb2dnZXI6IHVuZGVmaW5lZCwNCgkvLyB0cmFuc3BhcmVudENvbG9yOiBBcnJheQ0KCS8vCQlBcnJheSBjb250YWluaW5nIHRoZSByLCBnLCBiIGNvbXBvbmVudHMgdXNlZCBhcyB0cmFuc3BhcmVudCBjb2xvciBpbiBkb2pvLkNvbG9yOw0KCS8vCQlpZiB1bmRlZmluZWQsIFsyNTUsMjU1LDI1NV0gKHdoaXRlKSB3aWxsIGJlIHVzZWQuDQoJdHJhbnNwYXJlbnRDb2xvcjogdW5kZWZpbmVkLA0KCS8vIHNraXBJZURvbUxvYWRlZDogQm9vbGVhbg0KCS8vCQlGb3IgSUUgb25seSwgc2tpcCB0aGUgRE9NQ29udGVudExvYWRlZCBoYWNrIHVzZWQuIFNvbWV0aW1lcyBpdCBjYW4gY2F1c2UgYW4gT3BlcmF0aW9uDQoJLy8JCUFib3J0ZWQgZXJyb3IgaWYgdGhlIHJlc3Qgb2YgdGhlIHBhZ2UgdHJpZ2dlcnMgc2NyaXB0IGRlZmVycyBiZWZvcmUgdGhlIERPTSBpcyByZWFkeS4NCgkvLwkJSWYgdGhpcyBpcyBjb25maWcgdmFsdWUgaXMgc2V0IHRvIHRydWUsIHRoZW4gZG9qby5hZGRPbkxvYWQgY2FsbGJhY2tzIHdpbGwgbm90IGJlDQoJLy8JCXRyaWdnZXJlZCB1bnRpbCB0aGUgcGFnZSBsb2FkIGV2ZW50LCB3aGljaCBpcyBhZnRlciBpbWFnZXMgYW5kIGlmcmFtZXMgbG9hZC4gSWYgeW91DQoJLy8JCXdhbnQgdG8gdHJpZ2dlciB0aGUgY2FsbGJhY2tzIHNvb25lciwgeW91IGNhbiBwdXQgYSBzY3JpcHQgYmxvY2sgaW4gdGhlIGJvdHRvbSBvZg0KCS8vCQl5b3VyIEhUTUwgdGhhdCBjYWxscyBkb2pvLl9sb2FkSW5pdCgpOy4gSWYgeW91IGFyZSB1c2luZyBtdWx0aXZlcnNpb24gc3VwcG9ydCwgY2hhbmdlDQoJLy8JCSJkb2pvLiIgdG8gdGhlIGFwcHJvcHJpYXRlIHNjb3BlIG5hbWUgZm9yIGRvam8uDQoJc2tpcEllRG9tTG9hZGVkOiBmYWxzZQ0KfQ0KPT09PT0qLw0KDQooZnVuY3Rpb24oKXsNCgkvLyBmaXJlYnVnIHN0dWJzDQoNCglpZih0eXBlb2YgdGhpc1sibG9hZEZpcmVidWdDb25zb2xlIl0gPT0gImZ1bmN0aW9uIil7DQoJCS8vIGZvciBGaXJlYnVnIDEuMg0KCQl0aGlzWyJsb2FkRmlyZWJ1Z0NvbnNvbGUiXSgpOw0KCX1lbHNlew0KCQl0aGlzLmNvbnNvbGUgPSB0aGlzLmNvbnNvbGUgfHwge307DQoNCgkJLy8JQmUgY2FyZWZ1bCB0byBsZWF2ZSAnbG9nJyBhbHdheXMgYXQgdGhlIGVuZA0KCQl2YXIgY24gPSBbDQoJCQkiYXNzZXJ0IiwgImNvdW50IiwgImRlYnVnIiwgImRpciIsICJkaXJ4bWwiLCAiZXJyb3IiLCAiZ3JvdXAiLA0KCQkJImdyb3VwRW5kIiwgImluZm8iLCAicHJvZmlsZSIsICJwcm9maWxlRW5kIiwgInRpbWUiLCAidGltZUVuZCIsDQoJCQkidHJhY2UiLCAid2FybiIsICJsb2ciDQoJCV07DQoJCXZhciBpPTAsIHRuOw0KCQl3aGlsZSgodG49Y25baSsrXSkpew0KCQkJaWYoIWNvbnNvbGVbdG5dKXsNCgkJCQkoZnVuY3Rpb24oKXsNCgkJCQkJdmFyIHRjbiA9IHRuKyIiOw0KCQkJCQljb25zb2xlW3Rjbl0gPSAoJ2xvZycgaW4gY29uc29sZSkgPyBmdW5jdGlvbigpew0KCQkJCQkJdmFyIGEgPSBBcnJheS5hcHBseSh7fSwgYXJndW1lbnRzKTsNCgkJCQkJCWEudW5zaGlmdCh0Y24rIjoiKTsNCgkJCQkJCWNvbnNvbGVbImxvZyJdKGEuam9pbigiICIpKTsNCgkJCQkJfSA6IGZ1bmN0aW9uKCl7fQ0KCQkJCQljb25zb2xlW3Rjbl0uX2Zha2UgPSB0cnVlOw0KCQkJCX0pKCk7DQoJCQl9DQoJCX0NCgl9DQoNCgkvL1RPRE9DOiAgSE9XIFRPIERPQyBUSElTPw0KCS8vIGRvam8gaXMgdGhlIHJvb3QgdmFyaWFibGUgb2YgKGFsbW9zdCBhbGwpIG91ciBwdWJsaWMgc3ltYm9scyAtLSBtYWtlIHN1cmUgaXQgaXMgZGVmaW5lZC4NCglpZih0eXBlb2YgZG9qbyA9PSAidW5kZWZpbmVkIil7DQoJCWRvam8gPSB7DQoJCQlfc2NvcGVOYW1lOiAiZG9qbyIsDQoJCQlfc2NvcGVQcmVmaXg6ICIiLA0KCQkJX3Njb3BlUHJlZml4QXJnczogIiIsDQoJCQlfc2NvcGVTdWZmaXg6ICIiLA0KCQkJX3Njb3BlTWFwOiB7fSwNCgkJCV9zY29wZU1hcFJldjoge30NCgkJfTsNCgl9DQoNCgl2YXIgZCA9IGRvam87DQoNCgkvL05lZWQgcGxhY2Vob2xkZXJzIGZvciBkaWppdCBhbmQgZG9qb3ggZm9yIHNjb3BpbmcgY29kZS4NCglpZih0eXBlb2YgZGlqaXQgPT0gInVuZGVmaW5lZCIpew0KCQlkaWppdCA9IHtfc2NvcGVOYW1lOiAiZGlqaXQifTsNCgl9DQoJaWYodHlwZW9mIGRvam94ID09ICJ1bmRlZmluZWQiKXsNCgkJZG9qb3ggPSB7X3Njb3BlTmFtZTogImRvam94In07DQoJfQ0KDQoJaWYoIWQuX3Njb3BlQXJncyl7DQoJCWQuX3Njb3BlQXJncyA9IFtkb2pvLCBkaWppdCwgZG9qb3hdOw0KCX0NCg0KLyo9PT09PQ0KZG9qby5nbG9iYWwgPSB7DQoJLy8Jc3VtbWFyeToNCgkvLwkJQWxpYXMgZm9yIHRoZSBnbG9iYWwgc2NvcGUNCgkvLwkJKGUuZy4gdGhlIHdpbmRvdyBvYmplY3QgaW4gYSBicm93c2VyKS4NCgkvLwlkZXNjcmlwdGlvbjoNCgkvLwkJUmVmZXIgdG8gJ2Rvam8uZ2xvYmFsJyByYXRoZXIgdGhhbiByZWZlcnJpbmcgdG8gd2luZG93IHRvIGVuc3VyZSB5b3VyDQoJLy8JCWNvZGUgcnVucyBjb3JyZWN0bHkgaW4gY29udGV4dHMgb3RoZXIgdGhhbiB3ZWIgYnJvd3NlcnMgKGUuZy4gUmhpbm8gb24gYSBzZXJ2ZXIpLg0KfQ0KPT09PT0qLw0KCWQuZ2xvYmFsID0gdGhpczsNCg0KCWQuY29uZmlnID0vKj09PT09IGRqQ29uZmlnID0gPT09PT0qL3sNCgkJaXNEZWJ1ZzogZmFsc2UsDQoJCWRlYnVnQXRBbGxDb3N0czogZmFsc2UNCgl9Ow0KDQoJaWYodHlwZW9mIGRqQ29uZmlnICE9ICJ1bmRlZmluZWQiKXsNCgkJZm9yKHZhciBvcHQgaW4gZGpDb25maWcpew0KCQkJZC5jb25maWdbb3B0XSA9IGRqQ29uZmlnW29wdF07DQoJCX0NCgl9DQoNCi8qPT09PT0NCgkvLyBPdmVycmlkZSBsb2NhbGUgc2V0dGluZywgaWYgc3BlY2lmaWVkDQoJZG9qby5sb2NhbGUgPSB7DQoJCS8vIHN1bW1hcnk6IHRoZSBsb2NhbGUgYXMgZGVmaW5lZCBieSBEb2pvIChyZWFkLW9ubHkpDQoJfTsNCj09PT09Ki8NCglkb2pvLmxvY2FsZSA9IGQuY29uZmlnLmxvY2FsZTsNCg0KCXZhciByZXYgPSAiJFJldjogMjI0ODcgJCIubWF0Y2goL1xkKy8pOw0KDQovKj09PT09DQoJZG9qby52ZXJzaW9uID0gZnVuY3Rpb24oKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVZlcnNpb24gbnVtYmVyIG9mIHRoZSBEb2pvIFRvb2xraXQNCgkJLy8gbWFqb3I6IEludGVnZXINCgkJLy8JCU1ham9yIHZlcnNpb24uIElmIHRvdGFsIHZlcnNpb24gaXMgIjEuMi4wYmV0YTEiLCB3aWxsIGJlIDENCgkJLy8gbWlub3I6IEludGVnZXINCgkJLy8JCU1pbm9yIHZlcnNpb24uIElmIHRvdGFsIHZlcnNpb24gaXMgIjEuMi4wYmV0YTEiLCB3aWxsIGJlIDINCgkJLy8gcGF0Y2g6IEludGVnZXINCgkJLy8JCVBhdGNoIHZlcnNpb24uIElmIHRvdGFsIHZlcnNpb24gaXMgIjEuMi4wYmV0YTEiLCB3aWxsIGJlIDANCgkJLy8gZmxhZzogU3RyaW5nDQoJCS8vCQlEZXNjcmlwdG9yIGZsYWcuIElmIHRvdGFsIHZlcnNpb24gaXMgIjEuMi4wYmV0YTEiLCB3aWxsIGJlICJiZXRhMSINCgkJLy8gcmV2aXNpb246IE51bWJlcg0KCQkvLwkJVGhlIFNWTiByZXYgZnJvbSB3aGljaCBkb2pvIHdhcyBwdWxsZWQNCgkJdGhpcy5tYWpvciA9IDA7DQoJCXRoaXMubWlub3IgPSAwOw0KCQl0aGlzLnBhdGNoID0gMDsNCgkJdGhpcy5mbGFnID0gIiI7DQoJCXRoaXMucmV2aXNpb24gPSAwOw0KCX0NCj09PT09Ki8NCglkb2pvLnZlcnNpb24gPSB7DQoJCW1ham9yOiAxLCBtaW5vcjogMCwgcGF0Y2g6IDAsIGZsYWc6ICIiLA0KCQlyZXZpc2lvbjogcmV2ID8gK3JldlswXSA6IE5hTiwNCgkJdG9TdHJpbmc6IGZ1bmN0aW9uKCl7DQoJCQl3aXRoKGQudmVyc2lvbil7DQoJCQkJcmV0dXJuIG1ham9yICsgIi4iICsgbWlub3IgKyAiLiIgKyBwYXRjaCArIGZsYWcgKyAiICgiICsgcmV2aXNpb24gKyAiKSI7CS8vIFN0cmluZw0KCQkJfQ0KCQl9DQoJfQ0KDQoJCS8vIFJlZ2lzdGVyIHdpdGggdGhlIE9wZW5BamF4IGh1Yg0KCWlmKHR5cGVvZiBPcGVuQWpheCAhPSAidW5kZWZpbmVkIil7DQoJCU9wZW5BamF4Lmh1Yi5yZWdpc3RlckxpYnJhcnkoZG9qby5fc2NvcGVOYW1lLCAiaHR0cDovL2Rvam90b29sa2l0Lm9yZyIsIGQudmVyc2lvbi50b1N0cmluZygpKTsNCgl9DQoJDQoJdmFyIGV4dHJhTmFtZXMsIGV4dHJhTGVuLCBlbXB0eSA9IHt9Ow0KCWZvcih2YXIgaSBpbiB7dG9TdHJpbmc6IDF9KXsgZXh0cmFOYW1lcyA9IFtdOyBicmVhazsgfQ0KCWRvam8uX2V4dHJhTmFtZXMgPSBleHRyYU5hbWVzID0gZXh0cmFOYW1lcyB8fCBbImhhc093blByb3BlcnR5IiwgInZhbHVlT2YiLCAiaXNQcm90b3R5cGVPZiIsDQoJCSJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsICJ0b0xvY2FsZVN0cmluZyIsICJ0b1N0cmluZyIsICJjb25zdHJ1Y3RvciJdOw0KCWV4dHJhTGVuID0gZXh0cmFOYW1lcy5sZW5ndGg7DQoNCglkb2pvLl9taXhpbiA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gdGFyZ2V0LCAvKk9iamVjdCovIHNvdXJjZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlBZGRzIGFsbCBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9mIHNvdXJjZSB0byB0YXJnZXQuIFRoaXMgYWRkaXRpb24NCgkJLy8JCWlzICJwcm90b3R5cGUgZXh0ZW5zaW9uIHNhZmUiLCBzbyB0aGF0IGluc3RhbmNlcyBvZiBvYmplY3RzDQoJCS8vCQl3aWxsIG5vdCBwYXNzIGFsb25nIHByb3RvdHlwZSBkZWZhdWx0cy4NCgkJdmFyIG5hbWUsIHMsIGk7DQoJCWZvcihuYW1lIGluIHNvdXJjZSl7DQoJCQkvLyB0aGUgInRvYmoiIGNvbmRpdGlvbiBhdm9pZCBjb3B5aW5nIHByb3BlcnRpZXMgaW4gInNvdXJjZSINCgkJCS8vIGluaGVyaXRlZCBmcm9tIE9iamVjdC5wcm90b3R5cGUuICBGb3IgZXhhbXBsZSwgaWYgdGFyZ2V0IGhhcyBhIGN1c3RvbQ0KCQkJLy8gdG9TdHJpbmcoKSBtZXRob2QsIGRvbid0IG92ZXJ3cml0ZSBpdCB3aXRoIHRoZSB0b1N0cmluZygpIG1ldGhvZA0KCQkJLy8gdGhhdCBzb3VyY2UgaW5oZXJpdGVkIGZyb20gT2JqZWN0LnByb3RvdHlwZQ0KCQkJcyA9IHNvdXJjZVtuYW1lXTsNCgkJCWlmKCEobmFtZSBpbiB0YXJnZXQpIHx8ICh0YXJnZXRbbmFtZV0gIT09IHMgJiYgKCEobmFtZSBpbiBlbXB0eSkgfHwgZW1wdHlbbmFtZV0gIT09IHMpKSl7DQoJCQkJdGFyZ2V0W25hbWVdID0gczsNCgkJCX0NCgkJfQ0KCQkJCS8vIElFIGRvZXNuJ3QgcmVjb2duaXplIHNvbWUgY3VzdG9tIGZ1bmN0aW9ucyBpbiBmb3IuLmluDQoJCWlmKGV4dHJhTGVuICYmIHNvdXJjZSl7DQoJCQlmb3IoaSA9IDA7IGkgPCBleHRyYUxlbjsgKytpKXsNCgkJCQluYW1lID0gZXh0cmFOYW1lc1tpXTsNCgkJCQlzID0gc291cmNlW25hbWVdOw0KCQkJCWlmKCEobmFtZSBpbiB0YXJnZXQpIHx8ICh0YXJnZXRbbmFtZV0gIT09IHMgJiYgKCEobmFtZSBpbiBlbXB0eSkgfHwgZW1wdHlbbmFtZV0gIT09IHMpKSl7DQoJCQkJCXRhcmdldFtuYW1lXSA9IHM7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCQkJcmV0dXJuIHRhcmdldDsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5taXhpbiA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki9vYmosIC8qT2JqZWN0Li4uKi9wcm9wcyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlBZGRzIGFsbCBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9mIHByb3BzIHRvIG9iaiBhbmQgcmV0dXJucyB0aGUNCgkJLy8JCShub3cgbW9kaWZpZWQpIG9iai4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlgZG9qby5taXhpbmAgY2FuIG1peCBtdWx0aXBsZSBzb3VyY2Ugb2JqZWN0cyBpbnRvIGENCgkJLy8JCWRlc3RpbmF0aW9uIG9iamVjdCB3aGljaCBpcyB0aGVuIHJldHVybmVkLiBVbmxpa2UgcmVndWxhcg0KCQkvLwkJYGZvci4uLmluYCBpdGVyYXRpb24sIGBkb2pvLm1peGluYCBpcyBhbHNvIHNtYXJ0IGFib3V0IGF2b2lkaW5nDQoJCS8vCQlleHRlbnNpb25zIHdoaWNoIG90aGVyIHRvb2xraXRzIG1heSB1bndpc2VseSBhZGQgdG8gdGhlIHJvb3QNCgkJLy8JCW9iamVjdCBwcm90b3R5cGUNCgkJLy8Jb2JqOg0KCQkvLwkJVGhlIG9iamVjdCB0byBtaXggcHJvcGVydGllcyBpbnRvLiBBbHNvIHRoZSByZXR1cm4gdmFsdWUuDQoJCS8vCXByb3BzOg0KCQkvLwkJT25lIG9yIG1vcmUgb2JqZWN0cyB3aG9zZSB2YWx1ZXMgYXJlIHN1Y2Nlc3NpdmVseSBjb3BpZWQgaW50bw0KCQkvLwkJb2JqLiBJZiBtb3JlIHRoYW4gb25lIG9mIHRoZXNlIG9iamVjdHMgY29udGFpbiB0aGUgc2FtZSB2YWx1ZSwNCgkJLy8JCXRoZSBvbmUgc3BlY2lmaWVkIGxhc3QgaW4gdGhlIGZ1bmN0aW9uIGNhbGwgd2lsbCAid2luIi4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCW1ha2UgYSBzaGFsbG93IGNvcHkgb2YgYW4gb2JqZWN0DQoJCS8vCXwJdmFyIGNvcHkgPSBkb2pvLm1peGluKHt9LCBzb3VyY2UpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJbWFueSBjbGFzcyBjb25zdHJ1Y3RvcnMgb2Z0ZW4gdGFrZSBhbiBvYmplY3Qgd2hpY2ggc3BlY2lmaWVzDQoJCS8vCQl2YWx1ZXMgdG8gYmUgY29uZmlndXJlZCBvbiB0aGUgb2JqZWN0LiBJbiB0aGlzIGNhc2UsIGl0IGlzDQoJCS8vCQlvZnRlbiBzaW1wbGVzdCB0byBjYWxsIGBkb2pvLm1peGluYCBvbiB0aGUgYHRoaXNgIG9iamVjdDoNCgkJLy8JfAlkb2pvLmRlY2xhcmUoImFjbWUuQmFzZSIsIG51bGwsIHsNCgkJLy8JfAkJY29uc3RydWN0b3I6IGZ1bmN0aW9uKHByb3BlcnRpZXMpew0KCQkvLwl8CQkJLy8gcHJvcGVydHkgY29uZmlndXJhdGlvbjoNCgkJLy8JfAkJCWRvam8ubWl4aW4odGhpcywgcHJvcGVydGllcyk7DQoJCS8vCXwJDQoJCS8vCXwJCQljb25zb2xlLmxvZyh0aGlzLnF1aXApOw0KCQkvLwl8CQkJLy8gIC4uLg0KCQkvLwl8CQl9LA0KCQkvLwl8CQlxdWlwOiAiSSB3YXNuJ3QgYm9ybiB5ZXN0ZXJkYXksIHlvdSBrbm93IC0gSSd2ZSBzZWVuIG1vdmllcy4iLA0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfA0KCQkvLwl8CS8vIGNyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgY2xhc3MgYW5kIGNvbmZpZ3VyZSBpdA0KCQkvLwl8CXZhciBiID0gbmV3IGFjbWUuQmFzZSh7cXVpcDogIlRoYXQncyB3aGF0IGl0IGRvZXMhIiB9KTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCWNvcHkgaW4gcHJvcGVydGllcyBmcm9tIG11bHRpcGxlIG9iamVjdHMNCgkJLy8JfAl2YXIgZmxhdHRlbmVkID0gZG9qby5taXhpbigNCgkJLy8JfAkJew0KCQkvLwl8CQkJbmFtZTogIkZyeWxvY2siLA0KCQkvLwl8CQkJYnJhY2VzOiB0cnVlDQoJCS8vCXwJCX0sDQoJCS8vCXwJCXsNCgkJLy8JfAkJCW5hbWU6ICJDYXJsIEJydXRhbmFuYW5hZGlsZXdza2kiDQoJCS8vCXwJCX0NCgkJLy8JfAkpOw0KCQkvLwl8CQ0KCQkvLwl8CS8vIHdpbGwgcHJpbnQgIkNhcmwgQnJ1dGFuYW5hbmFkaWxld3NraSINCgkJLy8JfAljb25zb2xlLmxvZyhmbGF0dGVuZWQubmFtZSk7DQoJCS8vCXwJLy8gd2lsbCBwcmludCAidHJ1ZSINCgkJLy8JfAljb25zb2xlLmxvZyhmbGF0dGVuZWQuYnJhY2VzKTsNCgkJaWYoIW9iail7IG9iaiA9IHt9OyB9DQoJCWZvcih2YXIgaT0xLCBsPWFyZ3VtZW50cy5sZW5ndGg7IGk8bDsgaSsrKXsNCgkJCWQuX21peGluKG9iaiwgYXJndW1lbnRzW2ldKTsNCgkJfQ0KCQlyZXR1cm4gb2JqOyAvLyBPYmplY3QNCgl9DQoNCglkb2pvLl9nZXRQcm9wID0gZnVuY3Rpb24oLypBcnJheSovcGFydHMsIC8qQm9vbGVhbiovY3JlYXRlLCAvKk9iamVjdCovY29udGV4dCl7DQoJCXZhciBvYmo9Y29udGV4dCB8fCBkLmdsb2JhbDsNCgkJZm9yKHZhciBpPTAsIHA7IG9iaiAmJiAocD1wYXJ0c1tpXSk7IGkrKyl7DQoJCQlpZihpID09IDAgJiYgZC5fc2NvcGVNYXBbcF0pew0KCQkJCXAgPSBkLl9zY29wZU1hcFtwXTsNCgkJCX0NCgkJCW9iaiA9IChwIGluIG9iaiA/IG9ialtwXSA6IChjcmVhdGUgPyBvYmpbcF09e30gOiB1bmRlZmluZWQpKTsNCgkJfQ0KCQlyZXR1cm4gb2JqOyAvLyBtaXhlZA0KCX0NCg0KCWRvam8uc2V0T2JqZWN0ID0gZnVuY3Rpb24oLypTdHJpbmcqL25hbWUsIC8qT2JqZWN0Ki92YWx1ZSwgLypPYmplY3Q/Ki9jb250ZXh0KXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVNldCBhIHByb3BlcnR5IGZyb20gYSBkb3Qtc2VwYXJhdGVkIHN0cmluZywgc3VjaCBhcyAiQS5CLkMiDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJVXNlZnVsIGZvciBsb25nZXIgYXBpIGNoYWlucyB3aGVyZSB5b3UgaGF2ZSB0byB0ZXN0IGVhY2ggb2JqZWN0IGluDQoJCS8vCQl0aGUgY2hhaW4sIG9yIHdoZW4geW91IGhhdmUgYW4gb2JqZWN0IHJlZmVyZW5jZSBpbiBzdHJpbmcgZm9ybWF0Lg0KCQkvLwkJT2JqZWN0cyBhcmUgY3JlYXRlZCBhcyBuZWVkZWQgYWxvbmcgYHBhdGhgLiBSZXR1cm5zIHRoZSBwYXNzZWQNCgkJLy8JCXZhbHVlIGlmIHNldHRpbmcgaXMgc3VjY2Vzc2Z1bCBvciBgdW5kZWZpbmVkYCBpZiBub3QuDQoJCS8vCW5hbWU6DQoJCS8vCQlQYXRoIHRvIGEgcHJvcGVydHksIGluIHRoZSBmb3JtICJBLkIuQyIuDQoJCS8vCWNvbnRleHQ6DQoJCS8vCQlPcHRpb25hbC4gT2JqZWN0IHRvIHVzZSBhcyByb290IG9mIHBhdGguIERlZmF1bHRzIHRvDQoJCS8vCQlgZG9qby5nbG9iYWxgLg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJc2V0IHRoZSB2YWx1ZSBvZiBgZm9vLmJhci5iYXpgLCByZWdhcmRsZXNzIG9mIHdoZXRoZXINCgkJLy8JCWludGVybWVkaWF0ZSBvYmplY3RzIGFscmVhZHkgZXhpc3Q6DQoJCS8vCXwJZG9qby5zZXRPYmplY3QoImZvby5iYXIuYmF6IiwgdmFsdWUpOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJd2l0aG91dCBgZG9qby5zZXRPYmplY3RgLCB3ZSBvZnRlbiBzZWUgY29kZSBsaWtlIHRoaXM6DQoJCS8vCXwJLy8gZW5zdXJlIHRoYXQgaW50ZXJtZWRpYXRlIG9iamVjdHMgYXJlIGF2YWlsYWJsZQ0KCQkvLwl8CWlmKCFvYmpbInBhcmVudCJdKXsgb2JqLnBhcmVudCA9IHt9OyB9DQoJCS8vCXwJaWYoIW9iai5wYXJlbnRbImNoaWxkIl0peyBvYmoucGFyZW50LmNoaWxkPSB7fTsgfQ0KCQkvLwl8CS8vIG5vdyB3ZSBjYW4gc2FmZWx5IHNldCB0aGUgcHJvcGVydHkNCgkJLy8JfAlvYmoucGFyZW50LmNoaWxkLnByb3AgPSAic29tZSB2YWx1ZSI7DQoJCS8vCQl3aGVyYXMgd2l0aCBgZG9qby5zZXRPYmplY3RgLCB3ZSBjYW4gc2hvcnRlbiB0aGF0IHRvOg0KCQkvLwl8CWRvam8uc2V0T2JqZWN0KCJwYXJlbnQuY2hpbGQucHJvcCIsICJzb21lIHZhbHVlIiwgb2JqKTsNCgkJdmFyIHBhcnRzPW5hbWUuc3BsaXQoIi4iKSwgcD1wYXJ0cy5wb3AoKSwgb2JqPWQuX2dldFByb3AocGFydHMsIHRydWUsIGNvbnRleHQpOw0KCQlyZXR1cm4gb2JqICYmIHAgPyAob2JqW3BdPXZhbHVlKSA6IHVuZGVmaW5lZDsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5nZXRPYmplY3QgPSBmdW5jdGlvbigvKlN0cmluZyovbmFtZSwgLypCb29sZWFuPyovY3JlYXRlLCAvKk9iamVjdD8qL2NvbnRleHQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJR2V0IGEgcHJvcGVydHkgZnJvbSBhIGRvdC1zZXBhcmF0ZWQgc3RyaW5nLCBzdWNoIGFzICJBLkIuQyINCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlVc2VmdWwgZm9yIGxvbmdlciBhcGkgY2hhaW5zIHdoZXJlIHlvdSBoYXZlIHRvIHRlc3QgZWFjaCBvYmplY3QgaW4NCgkJLy8JCXRoZSBjaGFpbiwgb3Igd2hlbiB5b3UgaGF2ZSBhbiBvYmplY3QgcmVmZXJlbmNlIGluIHN0cmluZyBmb3JtYXQuDQoJCS8vCW5hbWU6DQoJCS8vCQlQYXRoIHRvIGFuIHByb3BlcnR5LCBpbiB0aGUgZm9ybSAiQS5CLkMiLg0KCQkvLwljcmVhdGU6DQoJCS8vCQlPcHRpb25hbC4gRGVmYXVsdHMgdG8gYGZhbHNlYC4gSWYgYHRydWVgLCBPYmplY3RzIHdpbGwgYmUNCgkJLy8JCWNyZWF0ZWQgYXQgYW55IHBvaW50IGFsb25nIHRoZSAncGF0aCcgdGhhdCBpcyB1bmRlZmluZWQuDQoJCS8vCWNvbnRleHQ6DQoJCS8vCQlPcHRpb25hbC4gT2JqZWN0IHRvIHVzZSBhcyByb290IG9mIHBhdGguIERlZmF1bHRzIHRvDQoJCS8vCQknZG9qby5nbG9iYWwnLiBOdWxsIG1heSBiZSBwYXNzZWQuDQoJCXJldHVybiBkLl9nZXRQcm9wKG5hbWUuc3BsaXQoIi4iKSwgY3JlYXRlLCBjb250ZXh0KTsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5leGlzdHMgPSBmdW5jdGlvbigvKlN0cmluZyovbmFtZSwgLypPYmplY3Q/Ki9vYmopew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJZGV0ZXJtaW5lIGlmIGFuIG9iamVjdCBzdXBwb3J0cyBhIGdpdmVuIG1ldGhvZA0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCXVzZWZ1bCBmb3IgbG9uZ2VyIGFwaSBjaGFpbnMgd2hlcmUgeW91IGhhdmUgdG8gdGVzdCBlYWNoIG9iamVjdCBpbg0KCQkvLwkJdGhlIGNoYWluLiBVc2VmdWwgb25seSBmb3Igb2JqZWN0IGFuZCBtZXRob2QgZGV0ZWN0aW9uLg0KCQkvLwkJTm90IHVzZWZ1bCBmb3IgdGVzdGluZyBnZW5lcmljIHByb3BlcnRpZXMgb24gYW4gb2JqZWN0Lg0KCQkvLwkJSW4gcGFydGljdWxhciwgZG9qby5leGlzdHMoImZvby5iYXIiKSB3aGVuIGZvby5iYXIgPSAiIg0KCQkvLwkJd2lsbCByZXR1cm4gZmFsc2UuIFVzZSAoImJhciIgaW4gZm9vKSB0byB0ZXN0IGZvciB0aG9zZSBjYXNlcy4NCgkJLy8JbmFtZToNCgkJLy8JCVBhdGggdG8gYW4gb2JqZWN0LCBpbiB0aGUgZm9ybSAiQS5CLkMiLg0KCQkvLwlvYmo6DQoJCS8vCQlPYmplY3QgdG8gdXNlIGFzIHJvb3Qgb2YgcGF0aC4gRGVmYXVsdHMgdG8NCgkJLy8JCSdkb2pvLmdsb2JhbCcuIE51bGwgbWF5IGJlIHBhc3NlZC4NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAkvLyBkZWZpbmUgYW4gb2JqZWN0DQoJCS8vCXwJdmFyIGZvbyA9IHsNCgkJLy8JfAkJYmFyOiB7IH0NCgkJLy8JfAl9Ow0KCQkvLwl8DQoJCS8vCXwJLy8gc2VhcmNoIHRoZSBnbG9iYWwgc2NvcGUNCgkJLy8JfAlkb2pvLmV4aXN0cygiZm9vLmJhciIpOyAvLyB0cnVlDQoJCS8vCXwJZG9qby5leGlzdHMoImZvby5iYXIuYmF6Iik7IC8vIGZhbHNlDQoJCS8vCXwNCgkJLy8JfAkvLyBzZWFyY2ggZnJvbSBhIHBhcnRpY3VsYXIgc2NvcGUNCgkJLy8JfAlkb2pvLmV4aXN0cygiYmFyIiwgZm9vKTsgLy8gdHJ1ZQ0KCQkvLwl8CWRvam8uZXhpc3RzKCJiYXIuYmF6IiwgZm9vKTsgLy8gZmFsc2UNCgkJcmV0dXJuICEhZC5nZXRPYmplY3QobmFtZSwgZmFsc2UsIG9iaik7IC8vIEJvb2xlYW4NCgl9DQoNCglkb2pvWyJldmFsIl0gPSBmdW5jdGlvbigvKlN0cmluZyovIHNjcmlwdEZyYWdtZW50KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUEgbGVnYWN5IG1ldGhvZCBjcmVhdGVkIGZvciB1c2UgZXhjbHVzaXZlbHkgYnkgaW50ZXJuYWwgRG9qbyBtZXRob2RzLiBEbyBub3QgdXNlDQoJCS8vCQl0aGlzIG1ldGhvZCBkaXJlY3RseSwgdGhlIGJlaGF2aW9yIG9mIHRoaXMgZXZhbCB3aWxsIGRpZmZlciBmcm9tIHRoZSBub3JtYWwNCgkJLy8JCWJyb3dzZXIgZXZhbC4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlQbGFjZWQgaW4gYSBzZXBhcmF0ZSBmdW5jdGlvbiB0byBtaW5pbWl6ZSBzaXplIG9mIHRyYXBwZWQNCgkJLy8JCWV4Y2VwdGlvbnMuIENhbGxpbmcgZXZhbCgpIGRpcmVjdGx5IGZyb20gc29tZSBvdGhlciBzY29wZSBtYXkNCgkJLy8JCWNvbXBsaWNhdGUgdHJhY2ViYWNrcyBvbiBzb21lIHBsYXRmb3Jtcy4NCgkJLy8JcmV0dXJuczoNCgkJLy8JCVRoZSByZXN1bHQgb2YgdGhlIGV2YWx1YXRpb24uIE9mdGVuIGB1bmRlZmluZWRgDQoJCXJldHVybiBkLmdsb2JhbC5ldmFsID8gZC5nbG9iYWwuZXZhbChzY3JpcHRGcmFnbWVudCkgOiBldmFsKHNjcmlwdEZyYWdtZW50KTsgCS8vIE9iamVjdA0KCX0NCg0KCS8qPT09PT0NCgkJZG9qby5kZXByZWNhdGVkID0gZnVuY3Rpb24oYmVoYXZpb3VyLCBleHRyYSwgcmVtb3ZhbCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCUxvZyBhIGRlYnVnIG1lc3NhZ2UgdG8gaW5kaWNhdGUgdGhhdCBhIGJlaGF2aW9yIGhhcyBiZWVuDQoJCQkvLwkJZGVwcmVjYXRlZC4NCgkJCS8vCWJlaGF2aW91cjogU3RyaW5nDQoJCQkvLwkJVGhlIEFQSSBvciBiZWhhdmlvciBiZWluZyBkZXByZWNhdGVkLiBVc3VhbGx5IGluIHRoZSBmb3JtDQoJCQkvLwkJb2YgIm15QXBwLnNvbWVGdW5jdGlvbigpIi4NCgkJCS8vCWV4dHJhOiBTdHJpbmc/DQoJCQkvLwkJVGV4dCB0byBhcHBlbmQgdG8gdGhlIG1lc3NhZ2UuIE9mdGVuIHByb3ZpZGVzIGFkdmljZSBvbiBhDQoJCQkvLwkJbmV3IGZ1bmN0aW9uIG9yIGZhY2lsaXR5IHRvIGFjaGlldmUgdGhlIHNhbWUgZ29hbCBkdXJpbmcNCgkJCS8vCQl0aGUgZGVwcmVjYXRpb24gcGVyaW9kLg0KCQkJLy8JcmVtb3ZhbDogU3RyaW5nPw0KCQkJLy8JCVRleHQgdG8gaW5kaWNhdGUgd2hlbiBpbiB0aGUgZnV0dXJlIHRoZSBiZWhhdmlvciB3aWxsIGJlDQoJCQkvLwkJcmVtb3ZlZC4gVXN1YWxseSBhIHZlcnNpb24gbnVtYmVyLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJZG9qby5kZXByZWNhdGVkKCJteUFwcC5nZXRUZW1wKCkiLCAidXNlIG15QXBwLmdldExvY2FsZVRlbXAoKSBpbnN0ZWFkIiwgIjEuMCIpOw0KCQl9DQoNCgkJZG9qby5leHBlcmltZW50YWwgPSBmdW5jdGlvbihtb2R1bGVOYW1lLCBleHRyYSl7DQoJCQkvLwlzdW1tYXJ5OiBNYXJrcyBjb2RlIGFzIGV4cGVyaW1lbnRhbC4NCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JIAlUaGlzIGNhbiBiZSB1c2VkIHRvIG1hcmsgYSBmdW5jdGlvbiwgZmlsZSwgb3IgbW9kdWxlIGFzDQoJCQkvLwkgCWV4cGVyaW1lbnRhbC4gIEV4cGVyaW1lbnRhbCBjb2RlIGlzIG5vdCByZWFkeSB0byBiZSB1c2VkLCBhbmQgdGhlDQoJCQkvLwkgCUFQSXMgYXJlIHN1YmplY3QgdG8gY2hhbmdlIHdpdGhvdXQgbm90aWNlLiAgRXhwZXJpbWVudGFsIGNvZGUgbWF5IGJlDQoJCQkvLwkgCWNvbXBsZXRlZCBkZWxldGVkIHdpdGhvdXQgZ29pbmcgdGhyb3VnaCB0aGUgbm9ybWFsIGRlcHJlY2F0aW9uDQoJCQkvLwkgCXByb2Nlc3MuDQoJCQkvLwltb2R1bGVOYW1lOiBTdHJpbmcNCgkJCS8vCSAJVGhlIG5hbWUgb2YgYSBtb2R1bGUsIG9yIHRoZSBuYW1lIG9mIGEgbW9kdWxlIGZpbGUgb3IgYSBzcGVjaWZpYw0KCQkJLy8JIAlmdW5jdGlvbg0KCQkJLy8JZXh0cmE6IFN0cmluZz8NCgkJCS8vCSAJc29tZSBhZGRpdGlvbmFsIG1lc3NhZ2UgZm9yIHRoZSB1c2VyDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JfAlkb2pvLmV4cGVyaW1lbnRhbCgiZG9qby5kYXRhLlJlc3VsdCIpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJZG9qby5leHBlcmltZW50YWwoImRvam8ud2VhdGhlci50b0tlbHZpbigpIiwgIlBFTkRJTkcgYXBwcm92YWwgZnJvbSBOT0FBIik7DQoJCX0NCgk9PT09PSovDQoNCgkvL1JlYWwgZnVuY3Rpb25zIGRlY2xhcmVkIGluIGRvam8uX2ZpcmVidWcuZmlyZWJ1Zy4NCglkLmRlcHJlY2F0ZWQgPSBkLmV4cGVyaW1lbnRhbCA9IGZ1bmN0aW9uKCl7fTsNCg0KfSkoKTsNCi8vIHZpbTphaTp0cz00Om5vZXQNCg0KLyoNCiAqIGxvYWRlci5qcyAtIEEgYm9vdHN0cmFwIG1vZHVsZS4gIFJ1bnMgYmVmb3JlIHRoZSBob3N0ZW52XyouanMgZmlsZS4gQ29udGFpbnMNCiAqIGFsbCBvZiB0aGUgcGFja2FnZSBsb2FkaW5nIG1ldGhvZHMuDQogKi8NCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIGQgPSBkb2pvOw0KDQoJZC5taXhpbihkLCB7DQoJCV9sb2FkZWRNb2R1bGVzOiB7fSwNCgkJX2luRmxpZ2h0Q291bnQ6IDAsDQoJCV9oYXNSZXNvdXJjZToge30sDQoNCgkJX21vZHVsZVByZWZpeGVzOiB7DQoJCQlkb2pvOiAJewluYW1lOiAiZG9qbyIsIHZhbHVlOiAiLiIgfSwNCgkJCS8vIGRvam94OiAJewluYW1lOiAiZG9qb3giLCB2YWx1ZTogIi4uL2Rvam94IiB9LA0KCQkJLy8gZGlqaXQ6IAl7CW5hbWU6ICJkaWppdCIsIHZhbHVlOiAiLi4vZGlqaXQiIH0sDQoJCQlkb2g6IAl7CW5hbWU6ICJkb2giLCB2YWx1ZTogIi4uL3V0aWwvZG9oIiB9LA0KCQkJdGVzdHM6IAl7CW5hbWU6ICJ0ZXN0cyIsIHZhbHVlOiAidGVzdHMiIH0NCgkJfSwNCg0KCQlfbW9kdWxlSGFzUHJlZml4OiBmdW5jdGlvbigvKlN0cmluZyovbW9kdWxlKXsNCgkJCS8vIHN1bW1hcnk6IGNoZWNrcyB0byBzZWUgaWYgbW9kdWxlIGhhcyBiZWVuIGVzdGFibGlzaGVkDQoJCQl2YXIgbXAgPSBkLl9tb2R1bGVQcmVmaXhlczsNCgkJCXJldHVybiAhIShtcFttb2R1bGVdICYmIG1wW21vZHVsZV0udmFsdWUpOyAvLyBCb29sZWFuDQoJCX0sDQoNCgkJX2dldE1vZHVsZVByZWZpeDogZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZSl7DQoJCQkvLyBzdW1tYXJ5OiBnZXRzIHRoZSBwcmVmaXggYXNzb2NpYXRlZCB3aXRoIG1vZHVsZQ0KCQkJdmFyIG1wID0gZC5fbW9kdWxlUHJlZml4ZXM7DQoJCQlpZihkLl9tb2R1bGVIYXNQcmVmaXgobW9kdWxlKSl7DQoJCQkJcmV0dXJuIG1wW21vZHVsZV0udmFsdWU7IC8vIFN0cmluZw0KCQkJfQ0KCQkJcmV0dXJuIG1vZHVsZTsgLy8gU3RyaW5nDQoJCX0sDQoNCgkJX2xvYWRlZFVybHM6IFtdLA0KDQoJCS8vV0FSTklORzogDQoJCS8vCQlUaGlzIHZhcmlhYmxlIGlzIHJlZmVyZW5jZWQgYnkgcGFja2FnZXMgb3V0c2lkZSBvZiBib290c3RyYXA6DQoJCS8vCQlGbG9hdGluZ1BhbmUuanMgYW5kIHVuZG8vYnJvd3Nlci5qcw0KCQlfcG9zdExvYWQ6IGZhbHNlLA0KCQkNCgkJLy9FZ2FkISBMb3RzIG9mIHRlc3QgZmlsZXMgcHVzaCBvbiB0aGlzIGRpcmVjdGx5IGluc3RlYWQgb2YgdXNpbmcgZG9qby5hZGRPbkxvYWQuDQoJCV9sb2FkZXJzOiBbXSwNCgkJX3VubG9hZGVyczogW10sDQoJCV9sb2FkTm90aWZ5aW5nOiBmYWxzZQ0KCX0pOw0KDQoNCgkJZG9qby5fbG9hZFBhdGggPSBmdW5jdGlvbigvKlN0cmluZyovcmVscGF0aCwgLypTdHJpbmc/Ki9tb2R1bGUsIC8qRnVuY3Rpb24/Ki9jYil7DQoJCS8vIAlzdW1tYXJ5Og0KCQkvLwkJTG9hZCBhIEphdmFzY3JpcHQgbW9kdWxlIGdpdmVuIGEgcmVsYXRpdmUgcGF0aA0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUxvYWRzIGFuZCBpbnRlcnByZXRzIHRoZSBzY3JpcHQgbG9jYXRlZCBhdCByZWxwYXRoLCB3aGljaCBpcw0KCQkvLwkJcmVsYXRpdmUgdG8gdGhlIHNjcmlwdCByb290IGRpcmVjdG9yeS4gIElmIHRoZSBzY3JpcHQgaXMgZm91bmQgYnV0DQoJCS8vCQlpdHMgaW50ZXJwcmV0YXRpb24gY2F1c2VzIGEgcnVudGltZSBleGNlcHRpb24sIHRoYXQgZXhjZXB0aW9uIGlzDQoJCS8vCQlub3QgY2F1Z2h0IGJ5IHVzLCBzbyB0aGUgY2FsbGVyIHdpbGwgc2VlIGl0LiAgV2UgcmV0dXJuIGEgdHJ1ZQ0KCQkvLwkJdmFsdWUgaWYgYW5kIG9ubHkgaWYgdGhlIHNjcmlwdCBpcyBmb3VuZC4NCgkJLy8NCgkJLy8gcmVscGF0aDogDQoJCS8vCQlBIHJlbGF0aXZlIHBhdGggdG8gYSBzY3JpcHQgKG5vIGxlYWRpbmcgJy8nLCBhbmQgdHlwaWNhbGx5IGVuZGluZw0KCQkvLwkJaW4gJy5qcycpLg0KCQkvLyBtb2R1bGU6IA0KCQkvLwkJQSBtb2R1bGUgd2hvc2UgZXhpc3RhbmNlIHRvIGNoZWNrIGZvciBhZnRlciBsb2FkaW5nIGEgcGF0aC4gIENhbiBiZQ0KCQkvLwkJdXNlZCB0byBkZXRlcm1pbmUgc3VjY2VzcyBvciBmYWlsdXJlIG9mIHRoZSBsb2FkLg0KCQkvLyBjYjogDQoJCS8vCQlhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHBhc3MgdGhlIHJlc3VsdCBvZiBldmFsdWF0aW5nIHRoZSBzY3JpcHQNCg0KCQl2YXIgdXJpID0gKChyZWxwYXRoLmNoYXJBdCgwKSA9PSAnLycgfHwgcmVscGF0aC5tYXRjaCgvXlx3KzovKSkgPyAiIiA6IGQuYmFzZVVybCkgKyByZWxwYXRoOw0KCQl0cnl7DQoJCQlyZXR1cm4gIW1vZHVsZSA/IGQuX2xvYWRVcmkodXJpLCBjYikgOiBkLl9sb2FkVXJpQW5kQ2hlY2sodXJpLCBtb2R1bGUsIGNiKTsgLy8gQm9vbGVhbg0KCQl9Y2F0Y2goZSl7DQoJCQljb25zb2xlLmVycm9yKGUpOw0KCQkJcmV0dXJuIGZhbHNlOyAvLyBCb29sZWFuDQoJCX0NCgl9DQoNCglkb2pvLl9sb2FkVXJpID0gZnVuY3Rpb24oLypTdHJpbmcqL3VyaSwgLypGdW5jdGlvbj8qL2NiKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUxvYWRzIEphdmFTY3JpcHQgZnJvbSBhIFVSSQ0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVJlYWRzIHRoZSBjb250ZW50cyBvZiB0aGUgVVJJLCBhbmQgZXZhbHVhdGVzIHRoZSBjb250ZW50cy4gIFRoaXMgaXMNCgkJLy8JCXVzZWQgdG8gbG9hZCBtb2R1bGVzIGFzIHdlbGwgYXMgcmVzb3VyY2UgYnVuZGxlcy4gUmV0dXJucyB0cnVlIGlmDQoJCS8vCQlpdCBzdWNjZWVkZWQuIFJldHVybnMgZmFsc2UgaWYgdGhlIFVSSSByZWFkaW5nIGZhaWxlZC4gIFRocm93cyBpZg0KCQkvLwkJdGhlIGV2YWx1YXRpb24gdGhyb3dzLg0KCQkvLwl1cmk6IGEgdXJpIHdoaWNoIHBvaW50cyBhdCB0aGUgc2NyaXB0IHRvIGJlIGxvYWRlZA0KCQkvLwljYjogDQoJCS8vCQlhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHByb2Nlc3MgdGhlIHJlc3VsdCBvZiBldmFsdWF0aW5nIHRoZSBzY3JpcHQNCgkJLy8JCWFzIGFuIGV4cHJlc3Npb24sIHR5cGljYWxseSB1c2VkIGJ5IHRoZSByZXNvdXJjZSBidW5kbGUgbG9hZGVyIHRvDQoJCS8vCQlsb2FkIEpTT04tc3R5bGUgcmVzb3VyY2VzDQoNCgkJaWYoZC5fbG9hZGVkVXJsc1t1cmldKXsNCgkJCXJldHVybiB0cnVlOyAvLyBCb29sZWFuDQoJCX0NCgkJZC5faW5GbGlnaHRDb3VudCsrOyAvLyBibG9jayBhZGRPbkxvYWQgY2FsbHMgdGhhdCBhcnJpdmUgd2hpbGUgd2UncmUgYnVzeSBkb3dubG9hZGluZw0KCQl2YXIgY29udGVudHMgPSBkLl9nZXRUZXh0KHVyaSwgdHJ1ZSk7DQoJCWlmKGNvbnRlbnRzKXsgLy8gbm90IDQwNCwgZXQgYWwNCgkJCWQuX2xvYWRlZFVybHNbdXJpXSA9IHRydWU7DQoJCQlkLl9sb2FkZWRVcmxzLnB1c2godXJpKTsNCgkJCWlmKGNiKXsNCgkJCQljb250ZW50cyA9ICcoJytjb250ZW50cysnKSc7DQoJCQl9ZWxzZXsNCgkJCQkvL09ubHkgZG8gdGhlIHNjb3BpbmcgaWYgbm8gY2FsbGJhY2suIElmIGEgY2FsbGJhY2sgaXMgc3BlY2lmaWVkLA0KCQkJCS8vaXQgaXMgbW9zdCBsaWtlbHkgdGhlIGkxOG4gYnVuZGxlIHN0dWZmLg0KCQkJCWNvbnRlbnRzID0gZC5fc2NvcGVQcmVmaXggKyBjb250ZW50cyArIGQuX3Njb3BlU3VmZml4Ow0KCQkJfQ0KCQkJaWYoIWQuaXNJRSl7IGNvbnRlbnRzICs9ICJcclxuLy9AIHNvdXJjZVVSTD0iICsgdXJpOyB9IC8vIGRlYnVnZ2luZyBhc3Npc3QgZm9yIEZpcmVidWcNCgkJCXZhciB2YWx1ZSA9IGRbImV2YWwiXShjb250ZW50cyk7DQoJCQlpZihjYil7IGNiKHZhbHVlKTsgfQ0KCQl9DQoJCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBuZWVkIHRvIGNhbGwgX2NhbGxMb2FkZWQoKSBkdWUgdG8gYW4gYWRkT25Mb2FkKCkgdGhhdCBhcnJpdmVkIHdoaWxlIHdlIHdlcmUgYnVzeSBkb3dubG9hZGluZw0KCQlpZigtLWQuX2luRmxpZ2h0Q291bnQgPT0gMCAmJiBkLl9wb3N0TG9hZCAmJiBkLl9sb2FkZXJzLmxlbmd0aCl7DQoJCQkvLyBXZSBzaG91bGRuJ3QgYmUgYWxsb3dlZCB0byBnZXQgaGVyZSBidXQgRmlyZWZveCBhbGxvd3MgYW4gZXZlbnQgDQoJCQkvLyAobW91c2UsIGtleWJkLCBhc3luYyB4aHJHZXQpIHRvIGludGVycnVwdCBhIHN5bmNocm9ub3VzIHhockdldC4gDQoJCQkvLyBJZiB0aGUgY3VycmVudCBzY3JpcHQgYmxvY2sgY29udGFpbnMgbXVsdGlwbGUgcmVxdWlyZSgpIHN0YXRlbWVudHMsIHRoZW4gYWZ0ZXIgZWFjaA0KCQkJLy8gcmVxdWlyZSgpIHJldHVybnMsIGluRmxpZ2h0Q291bnQgPT0gMCwgYnV0IHdlIHdhbnQgdG8gaG9sZCB0aGUgX2NhbGxMb2FkZWQoKSB1bnRpbA0KCQkJLy8gYWxsIHJlcXVpcmUoKXMgYXJlIGRvbmUgc2luY2UgdGhlIG91dC1vZi1zZXF1ZW5jZSBhZGRPbkxvYWQoKSBwcmVzdW1hYmx5IG5lZWRzIHRoZW0gYWxsLg0KCQkJLy8gc2V0VGltZW91dCBhbGxvd3MgdGhlIG5leHQgcmVxdWlyZSgpIHRvIHN0YXJ0IChpZiBuZWVkZWQpLCBhbmQgdGhlbiB3ZSBjaGVjayB0aGlzIGFnYWluLg0KCQkJc2V0VGltZW91dChmdW5jdGlvbigpeyANCgkJCQkvLyBJZiBpbkZsaWdodENvdW50ID4gMCwgdGhlbiBtdWx0aXBsZSByZXF1aXJlKClzIGFyZSBydW5uaW5nIHNlcXVlbnRpYWxseSBhbmQgDQoJCQkJLy8gdGhlIG5leHQgcmVxdWlyZSgpIHN0YXJ0ZWQgYWZ0ZXIgc2V0VGltZW91dCgpIHdhcyBleGVjdXRlZCBidXQgYmVmb3JlIHdlIGdvdCBoZXJlLg0KCQkJCWlmKGQuX2luRmxpZ2h0Q291bnQgPT0gMCl7IA0KCQkJCQlkLl9jYWxsTG9hZGVkKCk7DQoJCQkJfQ0KCQkJfSwgMCk7DQoJCX0NCgkJcmV0dXJuICEhY29udGVudHM7IC8vIEJvb2xlYW46IGNvbnRlbnRzPyB0cnVlIDogZmFsc2UNCgl9DQoJDQoJLy8gRklYTUU6IHByb2JhYmx5IG5lZWQgdG8gYWRkIGxvZ2dpbmcgdG8gdGhpcyBtZXRob2QNCglkb2pvLl9sb2FkVXJpQW5kQ2hlY2sgPSBmdW5jdGlvbigvKlN0cmluZyovdXJpLCAvKlN0cmluZyovbW9kdWxlTmFtZSwgLypGdW5jdGlvbj8qL2NiKXsNCgkJLy8gc3VtbWFyeTogY2FsbHMgbG9hZFVyaSB0aGVuIGZpbmRNb2R1bGUgYW5kIHJldHVybnMgdHJ1ZSBpZiBib3RoIHN1Y2NlZWQNCgkJdmFyIG9rID0gZmFsc2U7DQoJCXRyeXsNCgkJCW9rID0gZC5fbG9hZFVyaSh1cmksIGNiKTsNCgkJfWNhdGNoKGUpew0KCQkJY29uc29sZS5lcnJvcigiZmFpbGVkIGxvYWRpbmcgIiArIHVyaSArICIgd2l0aCBlcnJvcjogIiArIGUpOw0KCQl9DQoJCXJldHVybiAhIShvayAmJiBkLl9sb2FkZWRNb2R1bGVzW21vZHVsZU5hbWVdKTsgLy8gQm9vbGVhbg0KCX0NCg0KCWRvam8ubG9hZGVkID0gZnVuY3Rpb24oKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCXNpZ25hbCBmaXJlZCB3aGVuIGluaXRpYWwgZW52aXJvbm1lbnQgYW5kIHBhY2thZ2UgbG9hZGluZyBpcw0KCQkvLwkJY29tcGxldGUuIFlvdSBzaG91bGQgdXNlIGRvam8uYWRkT25Mb2FkKCkgaW5zdGVhZCBvZiBkb2luZyBhIA0KCQkvLwkJZGlyZWN0IGRvam8uY29ubmVjdCgpIHRvIHRoaXMgbWV0aG9kIGluIG9yZGVyIHRvIGhhbmRsZQ0KCQkvLwkJaW5pdGlhbGl6YXRpb24gdGFza3MgdGhhdCByZXF1aXJlIHRoZSBlbnZpcm9ubWVudCB0byBiZQ0KCQkvLwkJaW5pdGlhbGl6ZWQuIEluIGEgYnJvd3NlciBob3N0LAlkZWNsYXJhdGl2ZSB3aWRnZXRzIHdpbGwgDQoJCS8vCQliZSBjb25zdHJ1Y3RlZCB3aGVuIHRoaXMgZnVuY3Rpb24gZmluaXNoZXMgcnVuaW5nLg0KCQlkLl9sb2FkTm90aWZ5aW5nID0gdHJ1ZTsNCgkJZC5fcG9zdExvYWQgPSB0cnVlOw0KCQl2YXIgbWxsID0gZC5fbG9hZGVyczsNCg0KCQkvL0NsZWFyIGxpc3RlbmVycyBzbyBuZXcgb25lcyBjYW4gYmUgYWRkZWQNCgkJLy9Gb3Igb3RoZXIgeGRvbWFpbiBwYWNrYWdlIGxvYWRzIGFmdGVyIHRoZSBpbml0aWFsIGxvYWQuDQoJCWQuX2xvYWRlcnMgPSBbXTsNCg0KCQlmb3IodmFyIHggPSAwOyB4IDwgbWxsLmxlbmd0aDsgeCsrKXsNCgkJCW1sbFt4XSgpOw0KCQl9DQoNCgkJZC5fbG9hZE5vdGlmeWluZyA9IGZhbHNlOw0KCQkNCgkJLy9NYWtlIHN1cmUgbm90aGluZyBlbHNlIGdvdCBhZGRlZCB0byB0aGUgb25sb2FkIHF1ZXVlDQoJCS8vYWZ0ZXIgdGhpcyBmaXJzdCBydW4uIElmIHNvbWV0aGluZyBkaWQsIGFuZCB3ZSBhcmUgbm90IHdhaXRpbmcgZm9yIGFueQ0KCQkvL21vcmUgaW5mbGlnaHQgcmVzb3VyY2VzLCBydW4gYWdhaW4uDQoJCWlmKGQuX3Bvc3RMb2FkICYmIGQuX2luRmxpZ2h0Q291bnQgPT0gMCAmJiBtbGwubGVuZ3RoKXsNCgkJCWQuX2NhbGxMb2FkZWQoKTsNCgkJfQ0KCX0NCg0KCWRvam8udW5sb2FkZWQgPSBmdW5jdGlvbigpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJc2lnbmFsIGZpcmVkIGJ5IGltcGVuZGluZyBlbnZpcm9ubWVudCBkZXN0cnVjdGlvbi4gWW91IHNob3VsZCB1c2UNCgkJLy8JCWRvam8uYWRkT25VbmxvYWQoKSBpbnN0ZWFkIG9mIGRvaW5nIGEgZGlyZWN0IGRvam8uY29ubmVjdCgpIHRvIHRoaXMgDQoJCS8vCQltZXRob2QgdG8gcGVyZm9ybSBwYWdlL2FwcGxpY2F0aW9uIGNsZWFudXAgbWV0aG9kcy4gU2VlIA0KCQkvLwkJZG9qby5hZGRPblVubG9hZCBmb3IgbW9yZSBpbmZvLg0KCQl2YXIgbWxsID0gZC5fdW5sb2FkZXJzOw0KCQl3aGlsZShtbGwubGVuZ3RoKXsNCgkJCShtbGwucG9wKCkpKCk7DQoJCX0NCgl9DQoNCglkLl9vbnRvID0gZnVuY3Rpb24oYXJyLCBvYmosIGZuKXsNCgkJaWYoIWZuKXsNCgkJCWFyci5wdXNoKG9iaik7DQoJCX1lbHNlIGlmKGZuKXsNCgkJCXZhciBmdW5jID0gKHR5cGVvZiBmbiA9PSAic3RyaW5nIikgPyBvYmpbZm5dIDogZm47DQoJCQlhcnIucHVzaChmdW5jdGlvbigpeyBmdW5jLmNhbGwob2JqKTsgfSk7DQoJCX0NCgl9DQoNCglkb2pvLnJlYWR5ID0gZG9qby5hZGRPbkxvYWQgPSBmdW5jdGlvbigvKk9iamVjdCovb2JqLCAvKlN0cmluZ3xGdW5jdGlvbj8qL2Z1bmN0aW9uTmFtZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZWdpc3RlcnMgYSBmdW5jdGlvbiB0byBiZSB0cmlnZ2VyZWQgYWZ0ZXIgdGhlIERPTSBhbmQgZG9qby5yZXF1aXJlKCkgY2FsbHMgDQoJCS8vCQloYXZlIGZpbmlzaGVkIGxvYWRpbmcuDQoJCS8vDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLwkJUmVnaXN0ZXJzIGEgZnVuY3Rpb24gdG8gYmUgdHJpZ2dlcmVkIGFmdGVyIHRoZSBET00gaGFzIGZpbmlzaGVkDQoJCS8vCQlsb2FkaW5nIGFuZCBgZG9qby5yZXF1aXJlYCBtb2R1bGVzIGhhdmUgbG9hZGVkLiBXaWRnZXRzIGRlY2xhcmVkIGluIG1hcmt1cCANCgkJLy8JCWhhdmUgYmVlbiBpbnN0YW50aWF0ZWQgaWYgYGRqQ29uZmlnLnBhcnNlT25Mb2FkYCBpcyB0cnVlIHdoZW4gdGhpcyBmaXJlcy4gDQoJCS8vDQoJCS8vCQlJbWFnZXMgYW5kIENTUyBmaWxlcyBtYXkgb3IgbWF5IG5vdCBoYXZlIGZpbmlzaGVkIGRvd25sb2FkaW5nIHdoZW4NCgkJLy8JCXRoZSBzcGVjaWZpZWQgZnVuY3Rpb24gaXMgY2FsbGVkLiAgKE5vdGUgdGhhdCB3aWRnZXRzJyBDU1MgYW5kIEhUTUwNCgkJLy8JCWNvZGUgaXMgZ3VhcmFudGVlZCB0byBiZSBkb3dubG9hZGVkIGJlZm9yZSBzYWlkIHdpZGdldHMgYXJlDQoJCS8vCQlpbnN0YW50aWF0ZWQsIHRob3VnaCBpbmNsdWRpbmcgY3NzIHJlc291Y2VzIEJFRk9SRSBhbnkgc2NyaXB0IGVsZW1lbnRzDQoJCS8vCQlpcyBoaWdobHkgcmVjb21tZW5kZWQpLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZWdpc3RlciBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gdG8gcnVuIHdoZW4gZXZlcnl0aGluZyBpcyByZWFkeQ0KCQkvLwl8CWRvam8uYWRkT25Mb2FkKGZ1bmN0aW9uKCl7IGRvU3R1ZmYoKTsgfSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCVJlZ2lzdGVyIGEgZnVuY3Rpb24gdG8gcnVuIHdoZW4gZXZlcnl0aGluZyBpcyByZWFkeSBieSBwb2ludGVyOg0KCQkvLwl8CXZhciBpbml0ID0gZnVuY3Rpb24oKXsgZG9TdHVmZigpOyB9DQoJCS8vCXwJZG9qby5hZGRPbkxvYWQoaW5pdCk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCVJlZ2lzdGVyIGEgZnVuY3Rpb24gdG8gcnVuIHNjb3BlZCB0byBgb2JqZWN0YCwgZWl0aGVyIGJ5IG5hbWUgb3IgYW5vbnltb3VzbHk6DQoJCS8vCXwJZG9qby5hZGRPbkxvYWQob2JqZWN0LCAiZnVuY3Rpb25OYW1lIik7DQoJCS8vCXwJZG9qby5hZGRPbkxvYWQob2JqZWN0LCBmdW5jdGlvbigpeyBkb1N0dWZmKCk7IH0pOw0KDQoJCWQuX29udG8oZC5fbG9hZGVycywgb2JqLCBmdW5jdGlvbk5hbWUpOw0KDQoJCS8vQWRkZWQgZm9yIHhkb21haW4gbG9hZGluZy4gZG9qby5hZGRPbkxvYWQgaXMgdXNlZCB0bw0KCQkvL2luZGljYXRlIGNhbGxiYWNrcyBhZnRlciBkb2luZyBzb21lIGRvam8ucmVxdWlyZSgpIHN0YXRlbWVudHMuDQoJCS8vSW4gdGhlIHhkb21haW4gY2FzZSwgaWYgYWxsIHRoZSByZXF1aXJlcyBhcmUgbG9hZGVkIChhZnRlciBpbml0aWFsDQoJCS8vcGFnZSBsb2FkKSwgdGhlbiBpbW1lZGlhdGVseSBjYWxsIGFueSBsaXN0ZW5lcnMuDQoJCWlmKGQuX3Bvc3RMb2FkICYmIGQuX2luRmxpZ2h0Q291bnQgPT0gMCAmJiAhZC5fbG9hZE5vdGlmeWluZyl7DQoJCQlkLl9jYWxsTG9hZGVkKCk7DQoJCX0NCgl9DQoNCgkvL1N1cHBvcnQgY2FsbGluZyBkb2pvLmFkZE9uTG9hZCB2aWEgZGpDb25maWcuYWRkT25Mb2FkLiBTdXBwb3J0IGFsbCB0aGUNCgkvL2NhbGwgcGVybXV0YXRpb25zIG9mIGRvam8uYWRkT25Mb2FkLiBNYWlubHkgdXNlZnVsIHdoZW4gZG9qbyBpcyBhZGRlZA0KCS8vdG8gdGhlIHBhZ2UgYWZ0ZXIgdGhlIHBhZ2UgaGFzIGxvYWRlZC4NCgl2YXIgZGNhID0gZC5jb25maWcuYWRkT25Mb2FkOw0KCWlmKGRjYSl7DQoJCWQuYWRkT25Mb2FkWyhkY2EgaW5zdGFuY2VvZiBBcnJheSA/ICJhcHBseSIgOiAiY2FsbCIpXShkLCBkY2EpOw0KCX0NCg0KCWRvam8uX21vZHVsZXNMb2FkZWQgPSBmdW5jdGlvbigpew0KCQlpZihkLl9wb3N0TG9hZCl7IHJldHVybjsgfQ0KCQlpZihkLl9pbkZsaWdodENvdW50ID4gMCl7IA0KCQkJY29uc29sZS53YXJuKCJmaWxlcyBzdGlsbCBpbiBmbGlnaHQhIik7DQoJCQlyZXR1cm47DQoJCX0NCgkJZC5fY2FsbExvYWRlZCgpOw0KCX0NCg0KCWRvam8uX2NhbGxMb2FkZWQgPSBmdW5jdGlvbigpew0KDQoJCS8vIFRoZSAib2JqZWN0IiBjaGVjayBpcyBmb3IgSUUsIGFuZCB0aGUgb3RoZXIgb3BlcmEgY2hlY2sgZml4ZXMgYW4NCgkJLy8gaXNzdWUgaW4gT3BlcmEgd2hlcmUgaXQgY291bGQgbm90IGZpbmQgdGhlIGJvZHkgZWxlbWVudCBpbiBzb21lDQoJCS8vIHdpZGdldCB0ZXN0IGNhc2VzLiAgRm9yIDAuOSwgbWF5YmUgcm91dGUgYWxsIGJyb3dzZXJzIHRocm91Z2ggdGhlDQoJCS8vIHNldFRpbWVvdXQgKG5lZWQgcHJvdGVjdGlvbiBzdGlsbCBmb3Igbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzDQoJCS8vIHRob3VnaCkuIFRoaXMgbWlnaHQgYWxzbyBoZWxwIHRoZSBpc3N1ZSB3aXRoIEZGIDIuMCBhbmQgZnJlZXppbmcNCgkJLy8gaXNzdWVzIHdoZXJlIHdlIHRyeSB0byBkbyBzeW5jIHhociB3aGlsZSBiYWNrZ3JvdW5kIGNzcyBpbWFnZXMgYXJlDQoJCS8vIGJlaW5nIGxvYWRlZCAodHJhYyAjMjU3Mik/IENvbnNpZGVyIGZvciAwLjkuDQoJCWlmKHR5cGVvZiBzZXRUaW1lb3V0ID09ICJvYmplY3QiIHx8IChkLmNvbmZpZy51c2VYRG9tYWluICYmIGQuaXNPcGVyYSkpew0KCQkJc2V0VGltZW91dCgNCgkJCQlkLmlzQUlSID8gZnVuY3Rpb24oKXsgZC5sb2FkZWQoKTsgfSA6IGQuX3Njb3BlTmFtZSArICIubG9hZGVkKCk7IiwNCgkJCQkwKTsNCgkJfWVsc2V7DQoJCQlkLmxvYWRlZCgpOw0KCQl9DQoJfQ0KDQoJZG9qby5fZ2V0TW9kdWxlU3ltYm9scyA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9tb2R1bGVuYW1lKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUNvbnZlcnRzIGEgbW9kdWxlIG5hbWUgaW4gZG90dGVkIEpTIG5vdGF0aW9uIHRvIGFuIGFycmF5DQoJCS8vCQlyZXByZXNlbnRpbmcgdGhlIHBhdGggaW4gdGhlIHNvdXJjZSB0cmVlDQoJCXZhciBzeW1zID0gbW9kdWxlbmFtZS5zcGxpdCgiLiIpOw0KCQlmb3IodmFyIGkgPSBzeW1zLmxlbmd0aDsgaT4wOyBpLS0pew0KCQkJdmFyIHBhcmVudE1vZHVsZSA9IHN5bXMuc2xpY2UoMCwgaSkuam9pbigiLiIpOw0KCQkJaWYoaSA9PSAxICYmICFkLl9tb2R1bGVIYXNQcmVmaXgocGFyZW50TW9kdWxlKSl7CQkNCgkJCQkvLyBTdXBwb3J0IGRlZmF1bHQgbW9kdWxlIGRpcmVjdG9yeSAoc2libGluZyBvZiBkb2pvKSBmb3IgdG9wLWxldmVsIG1vZHVsZXMgDQoJCQkJc3ltc1swXSA9ICIuLi8iICsgc3ltc1swXTsNCgkJCX1lbHNlew0KCQkJCXZhciBwYXJlbnRNb2R1bGVQYXRoID0gZC5fZ2V0TW9kdWxlUHJlZml4KHBhcmVudE1vZHVsZSk7DQoJCQkJaWYocGFyZW50TW9kdWxlUGF0aCAhPSBwYXJlbnRNb2R1bGUpew0KCQkJCQlzeW1zLnNwbGljZSgwLCBpLCBwYXJlbnRNb2R1bGVQYXRoKTsNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCXJldHVybiBzeW1zOyAvLyBBcnJheQ0KCX0NCg0KCWRvam8uX2dsb2JhbF9vbWl0X21vZHVsZV9jaGVjayA9IGZhbHNlOw0KDQoJZG9qby5sb2FkSW5pdCA9IGZ1bmN0aW9uKC8qRnVuY3Rpb24qL2luaXQpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJRXhlY3V0ZXMgYSBmdW5jdGlvbiB0aGF0IG5lZWRzIHRvIGJlIGV4ZWN1dGVkIGZvciB0aGUgbG9hZGVyJ3MgZG9qby5yZXF1aXJlSWYNCgkJLy8JCXJlc29sdXRpb25zIHRvIHdvcmsuIFRoaXMgaXMgbmVlZGVkIG1vc3RseSBmb3IgdGhlIHhkb21haW4gbG9hZGVyIGNhc2Ugd2hlcmUNCgkJLy8JCWEgZnVuY3Rpb24gbmVlZHMgdG8gYmUgZXhlY3V0ZWQgdG8gc2V0IHVwIHRoZSBwb3NzaWJsZSB2YWx1ZXMgZm9yIGEgZG9qby5yZXF1aXJlSWYNCgkJLy8JCWNhbGwuDQoJCS8vCWluaXQ6DQoJCS8vCQlhIGZ1bmN0aW9uIHJlZmVyZW5jZS4gRXhlY3V0ZWQgaW1tZWRpYXRlbHkuDQoJCS8vCWRlc2NyaXB0aW9uOiBUaGlzIGZ1bmN0aW9uIGlzIG1haW5seSBhIG1hcmtlciBmb3IgdGhlIHhkb21haW4gbG9hZGVyIHRvIGtub3cgcGFydHMgb2YNCgkJLy8JCWNvZGUgdGhhdCBuZWVkcyBiZSBleGVjdXRlZCBvdXRzaWRlIHRoZSBmdW5jdGlvbiB3cmFwcHBlciB0aGF0IGlzIHBsYWNlZCBhcm91bmQgbW9kdWxlcy4NCgkJLy8JCVRoZSBpbml0IGZ1bmN0aW9uIGNvdWxkIGJlIGV4ZWN1dGVkIG1vcmUgdGhhbiBvbmNlLCBhbmQgaXQgc2hvdWxkIG1ha2Ugbm8gYXNzdW1wdGlvbnMNCgkJLy8JCW9uIHdoYXQgaXMgbG9hZGVkLCBvciB3aGF0IG1vZHVsZXMgYXJlIGF2YWlsYWJsZS4gT25seSB0aGUgZnVuY3Rpb25hbGl0eSBpbiBEb2pvIEJhc2UNCgkJLy8JCWlzIGFsbG93ZWQgdG8gYmUgdXNlZC4gQXZvaWQgdXNpbmcgdGhpcyBtZXRob2QuIEZvciBhIHZhbGlkIHVzZSBjYXNlLA0KCQkvLwkJc2VlIHRoZSBzb3VyY2UgZm9yIGRvam94LmdmeC4NCgkJaW5pdCgpOw0KCX0NCg0KCWRvam8uX2xvYWRNb2R1bGUgPSBkb2pvLnJlcXVpcmUgPSBmdW5jdGlvbigvKlN0cmluZyovbW9kdWxlTmFtZSwgLypCb29sZWFuPyovb21pdE1vZHVsZUNoZWNrKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWxvYWRzIGEgSmF2YXNjcmlwdCBtb2R1bGUgZnJvbSB0aGUgYXBwcm9wcmlhdGUgVVJJDQoJCS8vCW1vZHVsZU5hbWU6DQoJCS8vCQltb2R1bGUgbmFtZSB0byBsb2FkLCB1c2luZyBwZXJpb2RzIGZvciBzZXBhcmF0b3JzLA0KCQkvLwkJIGUuZy4gImRvam8uZGF0ZS5sb2NhbGUiLiAgTW9kdWxlIHBhdGhzIGFyZSBkZS1yZWZlcmVuY2VkIGJ5IGRvam8ncw0KCQkvLwkJaW50ZXJuYWwgbWFwcGluZyBvZiBsb2NhdGlvbnMgdG8gbmFtZXMgYW5kIGFyZSBkaXNhbWJpZ3VhdGVkIGJ5DQoJCS8vCQlsb25nZXN0IHByZWZpeC4gU2VlIGBkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgpYCBmb3IgZGV0YWlscyBvbg0KCQkvLwkJcmVnaXN0ZXJpbmcgbmV3IG1vZHVsZXMuDQoJCS8vCW9taXRNb2R1bGVDaGVjazoNCgkJLy8JCWlmIGB0cnVlYCwgb21pdE1vZHVsZUNoZWNrIHNraXBzIHRoZSBzdGVwIG9mIGVuc3VyaW5nIHRoYXQgdGhlDQoJCS8vCQlsb2FkZWQgZmlsZSBhY3R1YWxseSBkZWZpbmVzIHRoZSBzeW1ib2wgaXQgaXMgcmVmZXJlbmNlZCBieS4NCgkJLy8JCUZvciBleGFtcGxlIGlmIGl0IGNhbGxlZCBhcyBgZG9qby5yZXF1aXJlKCJhLmIuYyIpYCBhbmQgdGhlDQoJCS8vCQlmaWxlIGxvY2F0ZWQgYXQgYGEvYi9jLmpzYCBkb2VzIG5vdCBkZWZpbmUgYW4gb2JqZWN0IGBhLmIuY2AsDQoJCS8vCQlhbmQgZXhjZXB0aW9uIHdpbGwgYmUgdGhyb3dzIHdoZXJlYXMgbm8gZXhjZXB0aW9uIGlzIHJhaXNlZA0KCQkvLwkJd2hlbiBjYWxsZWQgYXMgYGRvam8ucmVxdWlyZSgiYS5iLmMiLCB0cnVlKWANCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vIAkJTW9kdWxlcyBhcmUgbG9hZGVkIHZpYSBkb2pvLnJlcXVpcmUgYnkgdXNpbmcgb25lIG9mIHR3byBsb2FkZXJzOiB0aGUgbm9ybWFsIGxvYWRlcg0KCQkvLyAJCWFuZCB0aGUgeGRvbWFpbiBsb2FkZXIuIFRoZSB4ZG9tYWluIGxvYWRlciBpcyB1c2VkIHdoZW4gZG9qbyB3YXMgYnVpbHQgd2l0aCBhDQoJCS8vIAkJY3VzdG9tIGJ1aWxkIHRoYXQgc3BlY2lmaWVkIGxvYWRlcj14ZG9tYWluIGFuZCB0aGUgbW9kdWxlIGxpdmVzIG9uIGEgbW9kdWxlUGF0aA0KCQkvLyAJCXRoYXQgaXMgYSB3aG9sZSBVUkwsIHdpdGggcHJvdG9jb2wgYW5kIGEgZG9tYWluLiBUaGUgdmVyc2lvbnMgb2YgRG9qbyB0aGF0IGFyZSBvbg0KCQkvLyAJCXRoZSBHb29nbGUgYW5kIEFPTCBDRE5zIHVzZSB0aGUgeGRvbWFpbiBsb2FkZXIuDQoJCS8vIA0KCQkvLyAJCUlmIHRoZSBtb2R1bGUgaXMgbG9hZGVkIHZpYSB0aGUgeGRvbWFpbiBsb2FkZXIsIGl0IGlzIGFuIGFzeW5jaHJvbm91cyBsb2FkLCBzaW5jZQ0KCQkvLyAJCXRoZSBtb2R1bGUgaXMgYWRkZWQgdmlhIGEgZHluYW1pY2FsbHkgY3JlYXRlZCBzY3JpcHQgdGFnLiBUaGlzDQoJCS8vIAkJbWVhbnMgdGhhdCBkb2pvLnJlcXVpcmUoKSBjYW4gcmV0dXJuIGJlZm9yZSB0aGUgbW9kdWxlIGhhcyBsb2FkZWQuIEhvd2V2ZXIsIHRoaXMgDQoJCS8vIAkJc2hvdWxkIG9ubHkgaGFwcGVuIGluIHRoZSBjYXNlIHdoZXJlIHlvdSBkbyBkb2pvLnJlcXVpcmUgY2FsbHMgaW4gdGhlIHRvcC1sZXZlbA0KCQkvLyAJCUhUTUwgcGFnZSwgb3IgaWYgeW91IHB1cnBvc2VseSBhdm9pZCB0aGUgbG9hZGVyIGNoZWNraW5nIGZvciBkb2pvLnJlcXVpcmUNCgkJLy8gCQlkZXBlbmRlbmNpZXMgaW4geW91ciBtb2R1bGUgYnkgdXNpbmcgYSBzeW50YXggbGlrZSBkb2pvWyJyZXF1aXJlIl0gdG8gbG9hZCB0aGUgbW9kdWxlLg0KCQkvLyANCgkJLy8gCQlTb21ldGltZXMgaXQgaXMgdXNlZnVsIHRvIG5vdCBoYXZlIHRoZSBsb2FkZXIgZGV0ZWN0IHRoZSBkb2pvLnJlcXVpcmUgY2FsbHMgaW4gdGhlDQoJCS8vIAkJbW9kdWxlIHNvIHRoYXQgeW91IGNhbiBkeW5hbWljYWxseSBsb2FkIHRoZSBtb2R1bGVzIGFzIGEgcmVzdWx0IG9mIGFuIGFjdGlvbiBvbiB0aGUNCgkJLy8gCQlwYWdlLCBpbnN0ZWFkIG9mIHJpZ2h0IGF0IG1vZHVsZSBsb2FkIHRpbWUuDQoJCS8vIA0KCQkvLyAJCUFsc28sIGZvciBzY3JpcHQgYmxvY2tzIGluIGFuIEhUTUwgcGFnZSwgdGhlIGxvYWRlciBkb2VzIG5vdCBwcmUtcHJvY2VzcyB0aGVtLCBzbw0KCQkvLyAJCWl0IGRvZXMgbm90IGtub3cgdG8gZG93bmxvYWQgdGhlIG1vZHVsZXMgYmVmb3JlIHRoZSBkb2pvLnJlcXVpcmUgY2FsbHMgb2NjdXIuDQoJCS8vIA0KCQkvLyAJCVNvLCBpbiB0aG9zZSB0d28gY2FzZXMsIHdoZW4geW91IHdhbnQgb24tdGhlLWZseSBtb2R1bGUgbG9hZGluZyBvciBmb3Igc2NyaXB0IGJsb2Nrcw0KCQkvLyAJCWluIHRoZSBIVE1MIHBhZ2UsIHNwZWNpYWwgY2FyZSBtdXN0IGJlIHRha2VuIGlmIHRoZSBkb2pvLnJlcXVpcmVkIGNvZGUgaXMgbG9hZGVkDQoJCS8vIAkJYXN5bmNocm9ub3VzbHkuIFRvIG1ha2Ugc3VyZSB5b3UgY2FuIGV4ZWN1dGUgY29kZSB0aGF0IGRlcGVuZHMgb24gdGhlIGRvam8ucmVxdWlyZWQNCgkJLy8gCQltb2R1bGVzLCBiZSBzdXJlIHRvIGFkZCB0aGUgY29kZSB0aGF0IGRlcGVuZHMgb24gdGhlIG1vZHVsZXMgaW4gYSBkb2pvLmFkZE9uTG9hZCgpDQoJCS8vIAkJY2FsbGJhY2suIGRvam8uYWRkT25Mb2FkIHdhaXRzIGZvciBhbGwgb3V0c3RhbmRpbmcgbW9kdWxlcyB0byBmaW5pc2ggbG9hZGluZyBiZWZvcmUNCgkJLy8gCQlleGVjdXRpbmcuIEV4YW1wbGU6DQoJCS8vIA0KCQkvLwkgICAJfAk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCS8vCQl8CWRvam8ucmVxdWlyZSgiZm9vIik7DQoJCS8vCQl8CWRvam8ucmVxdWlyZSgiYmFyIik7DQoJCS8vCSAgIAl8CWRvam8uYWRkT25Mb2FkKGZ1bmN0aW9uKCl7DQoJCS8vCSAgIAl8CQkvL3lvdSBjYW4gbm93IHNhZmVseSBkbyBzb21ldGhpbmcgd2l0aCBmb28gYW5kIGJhcg0KCQkvLwkgICAJfAl9KTsNCgkJLy8JICAgCXwJPC9zY3JpcHQ+DQoJCS8vIA0KCQkvLyAJCVRoaXMgdHlwZSBvZiBzeW50YXggd29ya3Mgd2l0aCBib3RoIHhkb21haW4gYW5kIG5vcm1hbCBsb2FkZXJzLCBzbyBpdCBpcyBnb29kDQoJCS8vIAkJcHJhY3RpY2UgdG8gYWx3YXlzIHVzZSB0aGlzIGlkaW9tIGZvciBvbi10aGUtZmx5IGNvZGUgbG9hZGluZyBhbmQgaW4gSFRNTCBzY3JpcHQNCgkJLy8gCQlibG9ja3MuIElmIGF0IHNvbWUgcG9pbnQgeW91IGNoYW5nZSBsb2FkZXJzIGFuZCB3aGVyZSB0aGUgY29kZSBpcyBsb2FkZWQgZnJvbSwNCgkJLy8gCQlpdCB3aWxsIGFsbCBzdGlsbCB3b3JrLg0KCQkvLyANCgkJLy8gCQlNb3JlIG9uIGhvdyBkb2pvLnJlcXVpcmUNCgkJLy8JCWBkb2pvLnJlcXVpcmUoIkEuQiIpYCBmaXJzdCBjaGVja3MgdG8gc2VlIGlmIHN5bWJvbCBBLkIgaXMNCgkJLy8JCWRlZmluZWQuIElmIGl0IGlzLCBpdCBpcyBzaW1wbHkgcmV0dXJuZWQgKG5vdGhpbmcgdG8gZG8pLg0KCQkvLwkNCgkJLy8JCUlmIGl0IGlzIG5vdCBkZWZpbmVkLCBpdCB3aWxsIGxvb2sgZm9yIGBBL0IuanNgIGluIHRoZSBzY3JpcHQgcm9vdA0KCQkvLwkJZGlyZWN0b3J5Lg0KCQkvLwkNCgkJLy8JCWBkb2pvLnJlcXVpcmVgIHRocm93cyBhbiBleGNwZXRpb24gaWYgaXQgY2Fubm90IGZpbmQgYSBmaWxlDQoJCS8vCQl0byBsb2FkLCBvciBpZiB0aGUgc3ltYm9sIGBBLkJgIGlzIG5vdCBkZWZpbmVkIGFmdGVyIGxvYWRpbmcuDQoJCS8vCQ0KCQkvLwkJSXQgcmV0dXJucyB0aGUgb2JqZWN0IGBBLkJgLCBidXQgbm90ZSB0aGUgY2F2ZWF0cyBhYm92ZSBhYm91dCBvbi10aGUtZmx5IGxvYWRpbmcgYW5kDQoJCS8vIAkJSFRNTCBzY3JpcHQgYmxvY2tzIHdoZW4gdGhlIHhkb21haW4gbG9hZGVyIGlzIGxvYWRpbmcgYSBtb2R1bGUuDQoJCS8vCQ0KCQkvLwkJYGRvam8ucmVxdWlyZSgpYCBkb2VzIG5vdGhpbmcgYWJvdXQgaW1wb3J0aW5nIHN5bWJvbHMgaW50bw0KCQkvLwkJdGhlIGN1cnJlbnQgbmFtZXNwYWNlLiAgSXQgaXMgcHJlc3VtZWQgdGhhdCB0aGUgY2FsbGVyIHdpbGwNCgkJLy8JCXRha2UgY2FyZSBvZiB0aGF0LiBGb3IgZXhhbXBsZSwgdG8gaW1wb3J0IGFsbCBzeW1ib2xzIGludG8gYQ0KCQkvLwkJbG9jYWwgYmxvY2ssIHlvdSBtaWdodCB3cml0ZToNCgkJLy8JDQoJCS8vCQl8CXdpdGggKGRvam8ucmVxdWlyZSgiQS5CIikpIHsNCgkJLy8JCXwJCS4uLg0KCQkvLwkJfAl9DQoJCS8vCQ0KCQkvLwkJQW5kIHRvIGltcG9ydCBqdXN0IHRoZSBsZWFmIHN5bWJvbCB0byBhIGxvY2FsIHZhcmlhYmxlOg0KCQkvLwkNCgkJLy8JCXwJdmFyIEIgPSBkb2pvLnJlcXVpcmUoIkEuQiIpOw0KCQkvLwkgICAJfAkuLi4NCgkJLy8JcmV0dXJuczogdGhlIHJlcXVpcmVkIG5hbWVzcGFjZSBvYmplY3QNCgkJb21pdE1vZHVsZUNoZWNrID0gZC5fZ2xvYmFsX29taXRfbW9kdWxlX2NoZWNrIHx8IG9taXRNb2R1bGVDaGVjazsNCg0KCQkvL0NoZWNrIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLg0KCQl2YXIgbW9kdWxlID0gZC5fbG9hZGVkTW9kdWxlc1ttb2R1bGVOYW1lXTsNCgkJaWYobW9kdWxlKXsNCgkJCXJldHVybiBtb2R1bGU7DQoJCX0NCg0KCQkvLyBjb252ZXJ0IHBlcmlvZHMgdG8gc2xhc2hlcw0KCQl2YXIgcmVscGF0aCA9IGQuX2dldE1vZHVsZVN5bWJvbHMobW9kdWxlTmFtZSkuam9pbigiLyIpICsgJy5qcyc7DQoNCgkJdmFyIG1vZEFyZyA9ICFvbWl0TW9kdWxlQ2hlY2sgPyBtb2R1bGVOYW1lIDogbnVsbDsNCgkJdmFyIG9rID0gZC5fbG9hZFBhdGgocmVscGF0aCwgbW9kQXJnKTsNCg0KCQlpZighb2sgJiYgIW9taXRNb2R1bGVDaGVjayl7DQoJCQl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCBsb2FkICciICsgbW9kdWxlTmFtZSArICInOyBsYXN0IHRyaWVkICciICsgcmVscGF0aCArICInIik7DQoJCX0NCg0KCQkvLyBjaGVjayB0aGF0IHRoZSBzeW1ib2wgd2FzIGRlZmluZWQNCgkJLy8gRG9uJ3QgYm90aGVyIGlmIHdlJ3JlIGRvaW5nIHhkb21haW4gKGFzeW5jaHJvbm91cykgbG9hZGluZy4NCgkJaWYoIW9taXRNb2R1bGVDaGVjayAmJiAhZC5faXNYRG9tYWluKXsNCgkJCS8vIHBhc3MgaW4gZmFsc2Ugc28gd2UgY2FuIGdpdmUgYmV0dGVyIGVycm9yDQoJCQltb2R1bGUgPSBkLl9sb2FkZWRNb2R1bGVzW21vZHVsZU5hbWVdOw0KCQkJaWYoIW1vZHVsZSl7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJzeW1ib2wgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgbm90IGRlZmluZWQgYWZ0ZXIgbG9hZGluZyAnIiArIHJlbHBhdGggKyAiJyIpOyANCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBtb2R1bGU7DQoJfQ0KDQoJZG9qby5wcm92aWRlID0gZnVuY3Rpb24oLypTdHJpbmcqLyByZXNvdXJjZU5hbWUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmVnaXN0ZXIgYSByZXNvdXJjZSB3aXRoIHRoZSBwYWNrYWdlIHN5c3RlbS4gV29ya3MgaW4gY29uanVuY3Rpb24gd2l0aCBgZG9qby5yZXF1aXJlYA0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUVhY2ggamF2YXNjcmlwdCBzb3VyY2UgZmlsZSBpcyBjYWxsZWQgYSByZXNvdXJjZS4gIFdoZW4gYQ0KCQkvLwkJcmVzb3VyY2UgaXMgbG9hZGVkIGJ5IHRoZSBicm93c2VyLCBgZG9qby5wcm92aWRlKClgIHJlZ2lzdGVycw0KCQkvLwkJdGhhdCBpdCBoYXMgYmVlbiBsb2FkZWQuDQoJCS8vDQoJCS8vCQlFYWNoIGphdmFzY3JpcHQgc291cmNlIGZpbGUgbXVzdCBoYXZlIGF0IGxlYXN0IG9uZQ0KCQkvLwkJYGRvam8ucHJvdmlkZSgpYCBjYWxsIGF0IHRoZSB0b3Agb2YgdGhlIGZpbGUsIGNvcnJlc3BvbmRpbmcgdG8NCgkJLy8JCXRoZSBmaWxlIG5hbWUuICBGb3IgZXhhbXBsZSwgYGpzL2Rvam8vZm9vLmpzYCBtdXN0IGhhdmUNCgkJLy8JCWBkb2pvLnByb3ZpZGUoImRvam8uZm9vIik7YCBiZWZvcmUgYW55IGNhbGxzIHRvDQoJCS8vCQlgZG9qby5yZXF1aXJlKClgIGFyZSBtYWRlLg0KCQkvLwkNCgkJLy8JCUZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSByZWFzb25zLCBpbiBhZGRpdGlvbiB0byByZWdpc3RlcmluZw0KCQkvLwkJdGhlIHJlc291cmNlLCBgZG9qby5wcm92aWRlKClgIGFsc28gZW5zdXJlcyB0aGF0IHRoZSBqYXZhc2NyaXB0DQoJCS8vCQlvYmplY3QgZm9yIHRoZSBtb2R1bGUgZXhpc3RzLiAgRm9yIGV4YW1wbGUsDQoJCS8vCQlgZG9qby5wcm92aWRlKCJkb2pveC5kYXRhLkZsaWNrclN0b3JlIilgLCBpbiBhZGRpdGlvbiB0bw0KCQkvLwkJcmVnaXN0ZXJpbmcgdGhhdCBgRmxpY2tyU3RvcmUuanNgIGlzIGEgcmVzb3VyY2UgZm9yIHRoZQ0KCQkvLwkJYGRvam94LmRhdGFgIG1vZHVsZSwgd2lsbCBlbnN1cmUgdGhhdCB0aGUgYGRvam94LmRhdGFgDQoJCS8vCQlqYXZhc2NyaXB0IG9iamVjdCBleGlzdHMsIHNvIHRoYXQgY2FsbHMgbGlrZSANCgkJLy8JCWBkb2pvLmRhdGEuZm9vID0gZnVuY3Rpb24oKXsgLi4uIH1gIGRvbid0IGZhaWwuDQoJCS8vDQoJCS8vCQlJbiB0aGUgY2FzZSBvZiBhIGJ1aWxkIHdoZXJlIG11bHRpcGxlIGphdmFzY3JpcHQgc291cmNlIGZpbGVzDQoJCS8vCQlhcmUgY29tYmluZWQgaW50byBvbmUgYmlnZ2VyIGZpbGUgKHNpbWlsYXIgdG8gYSAubGliIG9yIC5qYXINCgkJLy8JCWZpbGUpLCB0aGF0IGZpbGUgbWF5IGNvbnRhaW4gbXVsdGlwbGUgZG9qby5wcm92aWRlKCkgY2FsbHMsIHRvDQoJCS8vCQlub3RlIHRoYXQgaXQgaW5jbHVkZXMgbXVsdGlwbGUgcmVzb3VyY2VzLg0KCQkvLw0KCQkvLyByZXNvdXJjZU5hbWU6IFN0cmluZw0KCQkvLwkJQSBkb3Qtc3BlcmF0ZWQgc3RyaW5nIGlkZW50aWZ5aW5nIGEgcmVzb3VyY2UuIA0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlTYWZlbHkgY3JlYXRlIGEgYG15YCBvYmplY3QsIGFuZCBtYWtlIGRvam8ucmVxdWlyZSgibXkuQ3VzdG9tTW9kdWxlIikgd29yaw0KCQkvLwl8CWRvam8ucHJvdmlkZSgibXkuQ3VzdG9tTW9kdWxlIik7IA0KDQoJCS8vTWFrZSBzdXJlIHdlIGhhdmUgYSBzdHJpbmcuDQoJCXJlc291cmNlTmFtZSA9IHJlc291cmNlTmFtZSArICIiOw0KCQlyZXR1cm4gKGQuX2xvYWRlZE1vZHVsZXNbcmVzb3VyY2VOYW1lXSA9IGQuZ2V0T2JqZWN0KHJlc291cmNlTmFtZSwgdHJ1ZSkpOyAvLyBPYmplY3QNCgl9DQoNCgkvL1N0YXJ0IG9mIG9sZCBib290c3RyYXAyOg0KDQoJZG9qby5wbGF0Zm9ybVJlcXVpcmUgPSBmdW5jdGlvbigvKk9iamVjdCovbW9kTWFwKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXJlcXVpcmUgb25lIG9yIG1vcmUgbW9kdWxlcyBiYXNlZCBvbiB3aGljaCBob3N0IGVudmlyb25tZW50DQoJCS8vCQlEb2pvIGlzIGN1cnJlbnRseSBvcGVyYXRpbmcgaW4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlUaGlzIG1ldGhvZCB0YWtlcyBhICJtYXAiIG9mIGFycmF5cyB3aGljaCBvbmUgY2FuIHVzZSB0bw0KCQkvLwkJb3B0aW9uYWxseSBsb2FkIGRvam8gbW9kdWxlcy4gVGhlIG1hcCBpcyBpbmRleGVkIGJ5IHRoZQ0KCQkvLwkJcG9zc2libGUgZG9qby5uYW1lXyB2YWx1ZXMsIHdpdGggdHdvIGFkZGl0aW9uYWwgdmFsdWVzOg0KCQkvLwkJImRlZmF1bHQiIGFuZCAiY29tbW9uIi4gVGhlIGl0ZW1zIGluIHRoZSAiZGVmYXVsdCIgYXJyYXkgd2lsbA0KCQkvLwkJYmUgbG9hZGVkIGlmIG5vbmUgb2YgdGhlIG90aGVyIGl0ZW1zIGhhdmUgYmVlbiBjaG9vc2VuIGJhc2VkIG9uDQoJCS8vCQlkb2pvLm5hbWVfLCBzZXQgYnkgeW91ciBob3N0IGVudmlyb25tZW50LiBUaGUgaXRlbXMgaW4gdGhlDQoJCS8vCQkiY29tbW9uIiBhcnJheSB3aWxsICphbHdheXMqIGJlIGxvYWRlZCwgcmVnYXJkbGVzcyBvZiB3aGljaA0KCQkvLwkJbGlzdCBpcyBjaG9zZW4uDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQl8CWRvam8ucGxhdGZvcm1SZXF1aXJlKHsNCgkJLy8JCXwJCWJyb3dzZXI6IFsNCgkJLy8JCXwJCQkiZm9vLnNhbXBsZSIsIC8vIHNpbXBsZSBtb2R1bGUNCgkJLy8JCXwJCQkiZm9vLnRlc3QiLA0KCQkvLwkJfAkJCVsiZm9vLmJhci5iYXoiLCB0cnVlXSAvLyBza2lwIG9iamVjdCBjaGVjayBpbiBfbG9hZE1vZHVsZSAoZG9qby5yZXF1aXJlKQ0KCQkvLwkJfAkJXSwNCgkJLy8JCXwJCWRlZmF1bHQ6IFsgImZvby5zYW1wbGUuX2Jhc2UiIF0sDQoJCS8vCQl8CQljb21tb246IFsgImltcG9ydGFudC5tb2R1bGUuY29tbW9uIiBdDQoJCS8vCQl8CX0pOw0KDQoJCXZhciBjb21tb24gPSBtb2RNYXAuY29tbW9uIHx8IFtdOw0KCQl2YXIgcmVzdWx0ID0gY29tbW9uLmNvbmNhdChtb2RNYXBbZC5fbmFtZV0gfHwgbW9kTWFwWyJkZWZhdWx0Il0gfHwgW10pOw0KDQoJCWZvcih2YXIgeD0wOyB4PHJlc3VsdC5sZW5ndGg7IHgrKyl7DQoJCQl2YXIgY3VyciA9IHJlc3VsdFt4XTsNCgkJCWlmKGN1cnIuY29uc3RydWN0b3IgPT0gQXJyYXkpew0KCQkJCWQuX2xvYWRNb2R1bGUuYXBwbHkoZCwgY3Vycik7DQoJCQl9ZWxzZXsNCgkJCQlkLl9sb2FkTW9kdWxlKGN1cnIpOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJZG9qby5yZXF1aXJlSWYgPSBmdW5jdGlvbigvKkJvb2xlYW4qLyBjb25kaXRpb24sIC8qU3RyaW5nKi8gcmVzb3VyY2VOYW1lKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUlmIHRoZSBjb25kaXRpb24gaXMgdHJ1ZSB0aGVuIGNhbGwgYGRvam8ucmVxdWlyZSgpYCBmb3IgdGhlIHNwZWNpZmllZA0KCQkvLwkJcmVzb3VyY2UNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JfAlkb2pvLnJlcXVpcmVJZihkb2pvLmlzQnJvd3NlciwgIm15LnNwZWNpYWwuTW9kdWxlIik7DQoJCQ0KCQlpZihjb25kaXRpb24gPT09IHRydWUpew0KCQkJLy8gRklYTUU6IHdoeSBkbyB3ZSBzdXBwb3J0IGNoYWluZWQgcmVxdWlyZSgpJ3MgaGVyZT8gZG9lcyB0aGUgYnVpbGQgc3lzdGVtPw0KCQkJdmFyIGFyZ3MgPSBbXTsNCgkJCWZvcih2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspeyANCgkJCQlhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsNCgkJCX0NCgkJCWQucmVxdWlyZS5hcHBseShkLCBhcmdzKTsNCgkJfQ0KCX0NCg0KCWRvam8ucmVxdWlyZUFmdGVySWYgPSBkLnJlcXVpcmVJZjsNCg0KCWRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoID0gZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZSwgLypTdHJpbmcqL3ByZWZpeCl7DQoJCS8vCXN1bW1hcnk6IA0KCQkvLwkJTWFwcyBhIG1vZHVsZSBuYW1lIHRvIGEgcGF0aA0KCQkvLwlkZXNjcmlwdGlvbjogDQoJCS8vCQlBbiB1bnJlZ2lzdGVyZWQgbW9kdWxlIGlzIGdpdmVuIHRoZSBkZWZhdWx0IHBhdGggb2YgLi4vW21vZHVsZV0sDQoJCS8vCQlyZWxhdGl2ZSB0byBEb2pvIHJvb3QuIEZvciBleGFtcGxlLCBtb2R1bGUgYWNtZSBpcyBtYXBwZWQgdG8NCgkJLy8JCS4uL2FjbWUuICBJZiB5b3Ugd2FudCB0byB1c2UgYSBkaWZmZXJlbnQgbW9kdWxlIG5hbWUsIHVzZQ0KCQkvLwkJZG9qby5yZWdpc3Rlck1vZHVsZVBhdGguIA0KCQkvLwlleGFtcGxlOg0KCQkvLwkJSWYgeW91ciBkb2pvLmpzIGlzIGxvY2F0ZWQgYXQgdGhpcyBsb2NhdGlvbiBpbiB0aGUgd2ViIHJvb3Q6DQoJCS8vCXwJL215YXBwL2pzL2Rvam8vZG9qby9kb2pvLmpzDQoJCS8vCQlhbmQgeW91ciBtb2R1bGVzIGFyZSBsb2NhdGVkIGF0Og0KCQkvLwl8CS9teWFwcC9qcy9mb28vYmFyLmpzDQoJCS8vCXwJL215YXBwL2pzL2Zvby9iYXouanMNCgkJLy8JfAkvbXlhcHAvanMvZm9vL3RodWQveHl6enkuanMNCgkJLy8JCVlvdXIgYXBwbGljYXRpb24gY2FuIHRlbGwgRG9qbyB0byBsb2NhdGUgdGhlICJmb28iIG5hbWVzcGFjZSBieSBjYWxsaW5nOg0KCQkvLwl8CWRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoKCJmb28iLCAiLi4vLi4vZm9vIik7DQoJCS8vCQlBdCB3aGljaCBwb2ludCB5b3UgY2FuIHRoZW4gdXNlIGRvam8ucmVxdWlyZSgpIHRvIGxvYWQgdGhlDQoJCS8vCQltb2R1bGVzIChhc3N1bWluZyB0aGV5IHByb3ZpZGUoKSB0aGUgc2FtZSB0aGluZ3Mgd2hpY2ggYXJlDQoJCS8vCQlyZXF1aXJlZCkuIFRoZSBmdWxsIGNvZGUgbWlnaHQgYmU6DQoJCS8vCXwJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIA0KCQkvLwl8CQlzcmM9Ii9teWFwcC9qcy9kb2pvL2Rvam8vZG9qby5qcyI+PC9zY3JpcHQ+DQoJCS8vCXwJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KCQkvLwl8CQlkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgiZm9vIiwgIi4uLy4uL2ZvbyIpOw0KCQkvLwl8CQlkb2pvLnJlcXVpcmUoImZvby5iYXIiKTsNCgkJLy8JfAkJZG9qby5yZXF1aXJlKCJmb28uYmF6Iik7DQoJCS8vCXwJCWRvam8ucmVxdWlyZSgiZm9vLnRodWQueHl6enkiKTsNCgkJLy8JfAk8L3NjcmlwdD4NCgkJZC5fbW9kdWxlUHJlZml4ZXNbbW9kdWxlXSA9IHsgbmFtZTogbW9kdWxlLCB2YWx1ZTogcHJlZml4IH07DQoJfQ0KDQoJZG9qby5yZXF1aXJlTG9jYWxpemF0aW9uID0gZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZU5hbWUsIC8qU3RyaW5nKi9idW5kbGVOYW1lLCAvKlN0cmluZz8qL2xvY2FsZSwgLypTdHJpbmc/Ki9hdmFpbGFibGVGbGF0TG9jYWxlcyl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlEZWNsYXJlcyB0cmFuc2xhdGVkIHJlc291cmNlcyBhbmQgbG9hZHMgdGhlbSBpZiBuZWNlc3NhcnksIGluIHRoZQ0KCQkvLwkJc2FtZSBzdHlsZSBhcyBkb2pvLnJlcXVpcmUuICBDb250ZW50cyBvZiB0aGUgcmVzb3VyY2UgYnVuZGxlIGFyZQ0KCQkvLwkJdHlwaWNhbGx5IHN0cmluZ3MsIGJ1dCBtYXkgYmUgYW55IG5hbWUvdmFsdWUgcGFpciwgcmVwcmVzZW50ZWQgaW4NCgkJLy8JCUpTT04gZm9ybWF0LiAgU2VlIGFsc28gYGRvam8uaTE4bi5nZXRMb2NhbGl6YXRpb25gLg0KCQkvLw0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCUxvYWQgdHJhbnNsYXRlZCByZXNvdXJjZSBidW5kbGVzIHByb3ZpZGVkIHVuZGVybmVhdGggdGhlICJubHMiDQoJCS8vCQlkaXJlY3Rvcnkgd2l0aGluIGEgcGFja2FnZS4gIFRyYW5zbGF0ZWQgcmVzb3VyY2VzIG1heSBiZSBsb2NhdGVkIGluDQoJCS8vCQlkaWZmZXJlbnQgcGFja2FnZXMgdGhyb3VnaG91dCB0aGUgc291cmNlIHRyZWUuICANCgkJLy8NCgkJLy8JCUVhY2ggZGlyZWN0b3J5IGlzIG5hbWVkIGZvciBhIGxvY2FsZSBhcyBzcGVjaWZpZWQgYnkgUkZDIDMwNjYsDQoJCS8vCQkoaHR0cDovL3d3dy5pZXRmLm9yZy9yZmMvcmZjMzA2Ni50eHQpLCBub3JtYWxpemVkIGluIGxvd2VyY2FzZS4NCgkJLy8JCU5vdGUgdGhhdCB0aGUgdHdvIGJ1bmRsZXMgaW4gdGhlIGV4YW1wbGUgZG8gbm90IGRlZmluZSBhbGwgdGhlDQoJCS8vCQlzYW1lIHZhcmlhbnRzLiAgRm9yIGEgZ2l2ZW4gbG9jYWxlLCBidW5kbGVzIHdpbGwgYmUgbG9hZGVkIGZvcg0KCQkvLwkJdGhhdCBsb2NhbGUgYW5kIGFsbCBtb3JlIGdlbmVyYWwgbG9jYWxlcyBhYm92ZSBpdCwgaW5jbHVkaW5nIGENCgkJLy8JCWZhbGxiYWNrIGF0IHRoZSByb290IGRpcmVjdG9yeS4gIEZvciBleGFtcGxlLCBhIGRlY2xhcmF0aW9uIGZvcg0KCQkvLwkJdGhlICJkZS1hdCIgbG9jYWxlIHdpbGwgZmlyc3QgbG9hZCBgbmxzL2RlLWF0L2J1bmRsZW9uZS5qc2AsDQoJCS8vCQl0aGVuIGBubHMvZGUvYnVuZGxlb25lLmpzYCBhbmQgZmluYWxseSBgbmxzL2J1bmRsZW9uZS5qc2AuICBUaGUNCgkJLy8JCWRhdGEgd2lsbCBiZSBmbGF0dGVuZWQgaW50byBhIHNpbmdsZSBPYmplY3Qgc28gdGhhdCBsb29rdXBzDQoJCS8vCQl3aWxsIGZvbGxvdyB0aGlzIGNhc2NhZGluZyBwYXR0ZXJuLiAgQW4gb3B0aW9uYWwgYnVpbGQgc3RlcCBjYW4NCgkJLy8JCXByZWxvYWQgdGhlIGJ1bmRsZXMgdG8gYXZvaWQgZGF0YSByZWR1bmRhbmN5IGFuZCB0aGUgbXVsdGlwbGUNCgkJLy8JCW5ldHdvcmsgaGl0cyBub3JtYWxseSByZXF1aXJlZCB0byBsb2FkIHRoZXNlIHJlc291cmNlcy4NCgkJLy8NCgkJLy8gbW9kdWxlTmFtZTogDQoJCS8vCQluYW1lIG9mIHRoZSBwYWNrYWdlIGNvbnRhaW5pbmcgdGhlICJubHMiIGRpcmVjdG9yeSBpbiB3aGljaCB0aGUNCgkJLy8JCWJ1bmRsZSBpcyBmb3VuZA0KCQkvLw0KCQkvLyBidW5kbGVOYW1lOiANCgkJLy8JCWJ1bmRsZSBuYW1lLCBpLmUuIHRoZSBmaWxlbmFtZSB3aXRob3V0IHRoZSAnLmpzJyBzdWZmaXguIFVzaW5nICJubHMiIGFzIGENCgkJLy8JCWEgYnVuZGxlIG5hbWUgaXMgbm90IHN1cHBvcnRlZCwgc2luY2UgIm5scyIgaXMgdGhlIG5hbWUgb2YgdGhlIGZvbGRlcg0KCQkvLwkJdGhhdCBob2xkcyBidW5kbGVzLiBVc2luZyAibmxzIiBhcyB0aGUgYnVuZGxlIG5hbWUgd2lsbCBjYXVzZSBwcm9ibGVtcw0KCQkvLwkJd2l0aCB0aGUgY3VzdG9tIGJ1aWxkLg0KCQkvLw0KCQkvLyBsb2NhbGU6IA0KCQkvLwkJdGhlIGxvY2FsZSB0byBsb2FkIChvcHRpb25hbCkgIEJ5IGRlZmF1bHQsIHRoZSBicm93c2VyJ3MgdXNlcg0KCQkvLwkJbG9jYWxlIGFzIGRlZmluZWQgYnkgZG9qby5sb2NhbGUNCgkJLy8NCgkJLy8gYXZhaWxhYmxlRmxhdExvY2FsZXM6IA0KCQkvLwkJQSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiB0aGUgYXZhaWxhYmxlLCBmbGF0dGVuZWQgbG9jYWxlcyBmb3IgdGhpcw0KCQkvLwkJYnVuZGxlLiBUaGlzIGFyZ3VtZW50IHNob3VsZCBvbmx5IGJlIHNldCBieSB0aGUgYnVpbGQgcHJvY2Vzcy4NCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JCUEgcGFydGljdWxhciB3aWRnZXQgbWF5IGRlZmluZSBvbmUgb3IgbW9yZSByZXNvdXJjZSBidW5kbGVzLA0KCQkvLwkJc3RydWN0dXJlZCBpbiBhIHByb2dyYW0gYXMgZm9sbG93cywgd2hlcmUgbW9kdWxlTmFtZSBpcw0KCQkvLwkJbXljb2RlLm15d2lkZ2V0IGFuZCBidW5kbGVOYW1lcyBhdmFpbGFibGUgaW5jbHVkZSBidW5kbGVvbmUgYW5kDQoJCS8vCQlidW5kbGV0d286DQoJCS8vCXwJCS4uLg0KCQkvLwl8CW15Y29kZS8NCgkJLy8JfAkJbXl3aWRnZXQvDQoJCS8vCXwJCQlubHMvDQoJCS8vCXwJCQkJYnVuZGxlb25lLmpzICh0aGUgZmFsbGJhY2sgdHJhbnNsYXRpb24sIEVuZ2xpc2ggaW4gdGhpcyBleGFtcGxlKQ0KCQkvLwl8CQkJCWJ1bmRsZXR3by5qcyAoYWxzbyBhIGZhbGxiYWNrIHRyYW5zbGF0aW9uKQ0KCQkvLwl8CQkJCWRlLw0KCQkvLwl8CQkJCQlidW5kbGVvbmUuanMNCgkJLy8JfAkJCQkJYnVuZGxldHdvLmpzDQoJCS8vCXwJCQkJZGUtYXQvDQoJCS8vCXwJCQkJCWJ1bmRsZW9uZS5qcw0KCQkvLwl8CQkJCWVuLw0KCQkvLwl8CQkJCQkoZW1wdHk7IHVzZSB0aGUgZmFsbGJhY2sgdHJhbnNsYXRpb24pDQoJCS8vCXwJCQkJZW4tdXMvDQoJCS8vCXwJCQkJCWJ1bmRsZW9uZS5qcw0KCQkvLwl8CQkJCWVuLWdiLw0KCQkvLwl8CQkJCQlidW5kbGVvbmUuanMNCgkJLy8JfAkJCQllcy8NCgkJLy8JfAkJCQkJYnVuZGxlb25lLmpzDQoJCS8vCXwJCQkJCWJ1bmRsZXR3by5qcw0KCQkvLwl8CQkJCSAgLi4uZXRjDQoJCS8vCXwJCQkJLi4uDQoJCS8vDQoNCgkJZC5yZXF1aXJlKCJkb2pvLmkxOG4iKTsNCgkJZC5pMThuLl9yZXF1aXJlTG9jYWxpemF0aW9uLmFwcGx5KGQuaG9zdGVudiwgYXJndW1lbnRzKTsNCgl9Ow0KDQoNCgl2YXIgb3JlID0gbmV3IFJlZ0V4cCgiXigoW146Lz8jXSspOik/KC8vKFteLz8jXSopKT8oW14/I10qKShcXD8oW14jXSopKT8oIyguKikpPyQiKSwNCgkJaXJlID0gbmV3IFJlZ0V4cCgiXigoKFteXFxbOl0rKTopPyhbXkBdKylAKT8oXFxbKFteXFxdXSspXFxdfChbXlxcWzpdKikpKDooWzAtOV0rKSk/JCIpOw0KDQoJZG9qby5fVXJsID0gZnVuY3Rpb24oLypkb2pvLl9Vcmx8U3RyaW5nLi4uKi8pew0KCQkvLyBzdW1tYXJ5OiANCgkJLy8JCUNvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhbiBvYmplY3QgcmVwcmVzZW50aW5nIGEgVVJMLg0KCQkvLwkJSXQgaXMgbWFya2VkIGFzIHByaXZhdGUsIHNpbmNlIHdlIG1pZ2h0IGNvbnNpZGVyIHJlbW92aW5nDQoJCS8vCQlvciBzaW1wbGlmeWluZyBpdC4NCgkJLy8gZGVzY3JpcHRpb246IA0KCQkvLwkJRWFjaCBhcmd1bWVudCBpcyBldmFsdWF0ZWQgaW4gb3JkZXIgcmVsYXRpdmUgdG8gdGhlIG5leHQgdW50aWwNCgkJLy8JCWEgY2Fub25pY2FsIHVyaSBpcyBwcm9kdWNlZC4gVG8gZ2V0IGFuIGFic29sdXRlIFVyaSByZWxhdGl2ZSB0bw0KCQkvLwkJdGhlIGN1cnJlbnQgZG9jdW1lbnQgdXNlOg0KCQkvLyAgICAgIAluZXcgZG9qby5fVXJsKGRvY3VtZW50LmJhc2VVUkksIHVybCkNCg0KCQl2YXIgbiA9IG51bGwsDQoJCQlfYSA9IGFyZ3VtZW50cywNCgkJCXVyaSA9IFtfYVswXV07DQoJCS8vIHJlc29sdmUgdXJpIGNvbXBvbmVudHMgcmVsYXRpdmUgdG8gZWFjaCBvdGhlcg0KCQlmb3IodmFyIGkgPSAxOyBpPF9hLmxlbmd0aDsgaSsrKXsNCgkJCWlmKCFfYVtpXSl7IGNvbnRpbnVlOyB9DQoNCgkJCS8vIFNhZmFyaSBkb2Vzbid0IHN1cHBvcnQgdGhpcy5jb25zdHJ1Y3RvciBzbyB3ZSBoYXZlIHRvIGJlIGV4cGxpY2l0DQoJCQkvLyBGSVhNRTogVHJhY2tlZCAoYW5kIGZpeGVkKSBpbiBXZWJraXQgYnVnIDM1MzcuDQoJCQkvLwkJaHR0cDovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MzUzNw0KCQkJdmFyIHJlbG9iaiA9IG5ldyBkLl9VcmwoX2FbaV0rIiIpLA0KCQkJCXVyaW9iaiA9IG5ldyBkLl9VcmwodXJpWzBdKyIiKTsNCg0KCQkJaWYoDQoJCQkJcmVsb2JqLnBhdGggPT0gIiIgJiYNCgkJCQkhcmVsb2JqLnNjaGVtZSAmJg0KCQkJCSFyZWxvYmouYXV0aG9yaXR5ICYmDQoJCQkJIXJlbG9iai5xdWVyeQ0KCQkJKXsNCgkJCQlpZihyZWxvYmouZnJhZ21lbnQgIT0gbil7DQoJCQkJCXVyaW9iai5mcmFnbWVudCA9IHJlbG9iai5mcmFnbWVudDsNCgkJCQl9DQoJCQkJcmVsb2JqID0gdXJpb2JqOw0KCQkJfWVsc2UgaWYoIXJlbG9iai5zY2hlbWUpew0KCQkJCXJlbG9iai5zY2hlbWUgPSB1cmlvYmouc2NoZW1lOw0KDQoJCQkJaWYoIXJlbG9iai5hdXRob3JpdHkpew0KCQkJCQlyZWxvYmouYXV0aG9yaXR5ID0gdXJpb2JqLmF1dGhvcml0eTsNCg0KCQkJCQlpZihyZWxvYmoucGF0aC5jaGFyQXQoMCkgIT0gIi8iKXsNCgkJCQkJCXZhciBwYXRoID0gdXJpb2JqLnBhdGguc3Vic3RyaW5nKDAsDQoJCQkJCQkJdXJpb2JqLnBhdGgubGFzdEluZGV4T2YoIi8iKSArIDEpICsgcmVsb2JqLnBhdGg7DQoNCgkJCQkJCXZhciBzZWdzID0gcGF0aC5zcGxpdCgiLyIpOw0KCQkJCQkJZm9yKHZhciBqID0gMDsgaiA8IHNlZ3MubGVuZ3RoOyBqKyspew0KCQkJCQkJCWlmKHNlZ3Nbal0gPT0gIi4iKXsNCgkJCQkJCQkJLy8gZmxhdHRlbiAiLi8iIHJlZmVyZW5jZXMNCgkJCQkJCQkJaWYoaiA9PSBzZWdzLmxlbmd0aCAtIDEpew0KCQkJCQkJCQkJc2Vnc1tqXSA9ICIiOw0KCQkJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJCXNlZ3Muc3BsaWNlKGosIDEpOw0KCQkJCQkJCQkJai0tOw0KCQkJCQkJCQl9DQoJCQkJCQkJfWVsc2UgaWYoaiA+IDAgJiYgIShqID09IDEgJiYgc2Vnc1swXSA9PSAiIikgJiYNCgkJCQkJCQkJc2Vnc1tqXSA9PSAiLi4iICYmIHNlZ3Nbai0xXSAhPSAiLi4iKXsNCgkJCQkJCQkJLy8gZmxhdHRlbiAiLi4vIiByZWZlcmVuY2VzDQoJCQkJCQkJCWlmKGogPT0gKHNlZ3MubGVuZ3RoIC0gMSkpew0KCQkJCQkJCQkJc2Vncy5zcGxpY2UoaiwgMSk7DQoJCQkJCQkJCQlzZWdzW2ogLSAxXSA9ICIiOw0KCQkJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJCXNlZ3Muc3BsaWNlKGogLSAxLCAyKTsNCgkJCQkJCQkJCWogLT0gMjsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCXJlbG9iai5wYXRoID0gc2Vncy5qb2luKCIvIik7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCXVyaSA9IFtdOw0KCQkJaWYocmVsb2JqLnNjaGVtZSl7IA0KCQkJCXVyaS5wdXNoKHJlbG9iai5zY2hlbWUsICI6Iik7DQoJCQl9DQoJCQlpZihyZWxvYmouYXV0aG9yaXR5KXsNCgkJCQl1cmkucHVzaCgiLy8iLCByZWxvYmouYXV0aG9yaXR5KTsNCgkJCX0NCgkJCXVyaS5wdXNoKHJlbG9iai5wYXRoKTsNCgkJCWlmKHJlbG9iai5xdWVyeSl7DQoJCQkJdXJpLnB1c2goIj8iLCByZWxvYmoucXVlcnkpOw0KCQkJfQ0KCQkJaWYocmVsb2JqLmZyYWdtZW50KXsNCgkJCQl1cmkucHVzaCgiIyIsIHJlbG9iai5mcmFnbWVudCk7DQoJCQl9DQoJCX0NCg0KCQl0aGlzLnVyaSA9IHVyaS5qb2luKCIiKTsNCg0KCQkvLyBicmVhayB0aGUgdXJpIGludG8gaXRzIG1haW4gY29tcG9uZW50cw0KCQl2YXIgciA9IHRoaXMudXJpLm1hdGNoKG9yZSk7DQoNCgkJdGhpcy5zY2hlbWUgPSByWzJdIHx8IChyWzFdID8gIiIgOiBuKTsNCgkJdGhpcy5hdXRob3JpdHkgPSByWzRdIHx8IChyWzNdID8gIiIgOiBuKTsNCgkJdGhpcy5wYXRoID0gcls1XTsgLy8gY2FuIG5ldmVyIGJlIHVuZGVmaW5lZA0KCQl0aGlzLnF1ZXJ5ID0gcls3XSB8fCAocls2XSA/ICIiIDogbik7DQoJCXRoaXMuZnJhZ21lbnQgID0gcls5XSB8fCAocls4XSA/ICIiIDogbik7DQoNCgkJaWYodGhpcy5hdXRob3JpdHkgIT0gbil7DQoJCQkvLyBzZXJ2ZXIgYmFzZWQgbmFtaW5nIGF1dGhvcml0eQ0KCQkJciA9IHRoaXMuYXV0aG9yaXR5Lm1hdGNoKGlyZSk7DQoNCgkJCXRoaXMudXNlciA9IHJbM10gfHwgbjsNCgkJCXRoaXMucGFzc3dvcmQgPSByWzRdIHx8IG47DQoJCQl0aGlzLmhvc3QgPSByWzZdIHx8IHJbN107IC8vIGlwdjYgfHwgaXB2NA0KCQkJdGhpcy5wb3J0ID0gcls5XSB8fCBuOw0KCQl9DQoJfQ0KDQoJZG9qby5fVXJsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzLnVyaTsgfTsNCg0KCWRvam8ubW9kdWxlVXJsID0gZnVuY3Rpb24oLypTdHJpbmcqL21vZHVsZSwgLypkb2pvLl9Vcmx8fFN0cmluZyovdXJsKXsNCgkJLy8Jc3VtbWFyeTogDQoJCS8vCQlSZXR1cm5zIGEgYGRvam8uX1VybGAgb2JqZWN0IHJlbGF0aXZlIHRvIGEgbW9kdWxlLg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBwbmdQYXRoID0gZG9qby5tb2R1bGVVcmwoImFjbWUiLCJpbWFnZXMvc21hbGwucG5nIik7DQoJCS8vCXwJY29uc29sZS5kaXIocG5nUGF0aCk7IC8vIGxpc3QgdGhlIG9iamVjdCBwcm9wZXJ0aWVzDQoJCS8vCXwJLy8gY3JlYXRlIGFuIGltYWdlIGFuZCBzZXQgaXQncyBzb3VyY2UgdG8gcG5nUGF0aCdzIHZhbHVlOg0KCQkvLwl8CXZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCgkJLy8gCXwJLy8gTk9URTogd2UgYXNzaWduIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHVybCBvYmplY3QNCgkJLy8JfAlpbWcuc3JjID0gcG5nUGF0aC50b1N0cmluZygpOyANCgkJLy8JfAkvLyBhZGQgb3VyIGltYWdlIHRvIHRoZSBkb2N1bWVudA0KCQkvLwl8CWRvam8uYm9keSgpLmFwcGVuZENoaWxkKGltZyk7DQoJCS8vCWV4YW1wbGU6IA0KCQkvLwkJeW91IG1heSBkZS1yZWZlcmVuY2UgYXMgZmFyIGFzIHlvdSBsaWtlIGRvd24gdGhlIHBhY2thZ2UNCgkJLy8JCWhpZXJhcmNoeS4gIFRoaXMgaXMgc29tZXRpbWVzIGhhbmR5IHRvIGF2b2lkIGxlbmdodHkgcmVsYXRpdmUNCgkJLy8JCXVybHMgb3IgZm9yIGJ1aWxkaW5nIHBvcnRhYmxlIHN1Yi1wYWNrYWdlcy4gSW4gdGhpcyBleGFtcGxlLA0KCQkvLwkJdGhlIGBhY21lLndpZGdldGAgYW5kIGBhY21lLnV0aWxgIGRpcmVjdG9yaWVzIG1heSBiZSBsb2NhdGVkDQoJCS8vCQl1bmRlciBkaWZmZXJlbnQgcm9vdHMgKHNlZSBgZG9qby5yZWdpc3Rlck1vZHVsZVBhdGhgKSBidXQgdGhlDQoJCS8vCQl0aGUgbW9kdWxlcyB3aGljaCByZWZlcmVuY2UgdGhlbSBjYW4gYmUgdW5hd2FyZSBvZiB0aGVpcg0KCQkvLwkJcmVsYXRpdmUgbG9jYXRpb25zIG9uIHRoZSBmaWxlc3lzdGVtOg0KCQkvLwl8CS8vIHNvbWV3aGVyZSBpbiBhIGNvbmZpZ3VyYXRpb24gYmxvY2sNCgkJLy8JfAlkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgiYWNtZS53aWRnZXQiLCAiLi4vLi4vYWNtZS93aWRnZXQiKTsNCgkJLy8JfAlkb2pvLnJlZ2lzdGVyTW9kdWxlUGF0aCgiYWNtZS51dGlsIiwgIi4uLy4uL3V0aWwiKTsNCgkJLy8JfAkNCgkJLy8JfAkvLyAuLi4NCgkJLy8JfAkNCgkJLy8JfAkvLyBjb2RlIGluIGEgbW9kdWxlIHVzaW5nIGFjbWUgcmVzb3VyY2VzDQoJCS8vCXwJdmFyIHRtcGx0UGF0aCA9IGRvam8ubW9kdWxlVXJsKCJhY21lLndpZGdldCIsInRlbXBsYXRlcy90ZW1wbGF0ZS5odG1sIik7DQoJCS8vCXwJdmFyIGRhdGFQYXRoID0gZG9qby5tb2R1bGVVcmwoImFjbWUudXRpbCIsInJlc291cmNlcy9kYXRhLmpzb24iKTsNCg0KCQl2YXIgbG9jID0gZC5fZ2V0TW9kdWxlU3ltYm9scyhtb2R1bGUpLmpvaW4oJy8nKTsNCgkJaWYoIWxvYyl7IHJldHVybiBudWxsOyB9DQoJCWlmKGxvYy5sYXN0SW5kZXhPZigiLyIpICE9IGxvYy5sZW5ndGgtMSl7DQoJCQlsb2MgKz0gIi8iOw0KCQl9DQoJCQ0KCQkvL0lmIHRoZSBwYXRoIGlzIGFuIGFic29sdXRlIHBhdGggKHN0YXJ0cyB3aXRoIGEgLyBvciBpcyBvbiBhbm90aGVyDQoJCS8vZG9tYWluL3hkb21haW4pIHRoZW4gZG9uJ3QgYWRkIHRoZSBiYXNlVXJsLg0KCQl2YXIgY29sb25JbmRleCA9IGxvYy5pbmRleE9mKCI6Iik7DQoJCWlmKGxvYy5jaGFyQXQoMCkgIT0gIi8iICYmIChjb2xvbkluZGV4ID09IC0xIHx8IGNvbG9uSW5kZXggPiBsb2MuaW5kZXhPZigiLyIpKSl7DQoJCQlsb2MgPSBkLmJhc2VVcmwgKyBsb2M7DQoJCX0NCg0KCQlyZXR1cm4gbmV3IGQuX1VybChsb2MsIHVybCk7IC8vIGRvam8uX1VybA0KCX0NCn0pKCk7DQoNCi8qPT09PT0NCmRvam8uaXNCcm93c2VyID0gew0KCS8vCWV4YW1wbGU6DQoJLy8JfAlpZihkb2pvLmlzQnJvd3Nlcil7IC4uLiB9DQp9Ow0KDQpkb2pvLmlzRkYgPSB7DQoJLy8JZXhhbXBsZToNCgkvLwl8CWlmKGRvam8uaXNGRiA+IDEpeyAuLi4gfQ0KfTsNCg0KZG9qby5pc0lFID0gew0KCS8vIGV4YW1wbGU6DQoJLy8JfAlpZihkb2pvLmlzSUUgPiA2KXsNCgkvLwl8CQkvLyB3ZSBhcmUgSUU3DQoJLy8gCXwJfQ0KfTsNCg0KZG9qby5pc1NhZmFyaSA9IHsNCgkvLwlleGFtcGxlOg0KCS8vCXwJaWYoZG9qby5pc1NhZmFyaSl7IC4uLiB9DQoJLy8JZXhhbXBsZTogDQoJLy8JCURldGVjdCBpUGhvbmU6DQoJLy8JfAlpZihkb2pvLmlzU2FmYXJpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiaVBob25lIikgIT0gLTEpeyANCgkvLwl8CQkvLyB3ZSBhcmUgaVBob25lLiBOb3RlLCBpUG9kIHRvdWNoIHJlcG9ydHMgImlQb2QiIGFib3ZlIGFuZCBmYWlscyB0aGlzIHRlc3QuDQoJLy8JfAl9DQp9Ow0KDQpkb2pvID0gew0KCS8vIGlzQnJvd3NlcjogQm9vbGVhbg0KCS8vCQlUcnVlIGlmIHRoZSBjbGllbnQgaXMgYSB3ZWItYnJvd3Nlcg0KCWlzQnJvd3NlcjogdHJ1ZSwNCgkvLwlpc0ZGOiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgRmlyZUZveC4gdW5kZWZpbmVkIG90aGVyd2lzZS4gQ29ycmVzcG9uZHMgdG8NCgkvLwkJbWFqb3IgZGV0ZWN0ZWQgRmlyZUZveCB2ZXJzaW9uICgxLjUsIDIsIDMsIGV0Yy4pDQoJaXNGRjogMiwNCgkvLwlpc0lFOiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgTVNJRShQQykuIHVuZGVmaW5lZCBvdGhlcndpc2UuIENvcnJlc3BvbmRzIHRvDQoJLy8JCW1ham9yIGRldGVjdGVkIElFIHZlcnNpb24gKDYsIDcsIDgsIGV0Yy4pDQoJaXNJRTogNiwNCgkvLwlpc0todG1sOiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgYSBLSFRNTCBicm93c2VyLiB1bmRlZmluZWQgb3RoZXJ3aXNlLiBDb3JyZXNwb25kcyB0byBtYWpvcg0KCS8vCQlkZXRlY3RlZCB2ZXJzaW9uLg0KCWlzS2h0bWw6IDAsDQoJLy8JaXNXZWJLaXQ6IE51bWJlciB8IHVuZGVmaW5lZA0KCS8vCQlWZXJzaW9uIGFzIGEgTnVtYmVyIGlmIGNsaWVudCBpcyBhIFdlYktpdC1kZXJpdmVkIGJyb3dzZXIgKEtvbnF1ZXJvciwNCgkvLwkJU2FmYXJpLCBDaHJvbWUsIGV0Yy4pLiB1bmRlZmluZWQgb3RoZXJ3aXNlLg0KCWlzV2ViS2l0OiAwLA0KCS8vCWlzTW96aWxsYTogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIGEgTW96aWxsYS1iYXNlZCBicm93c2VyIChGaXJlZm94LA0KCS8vCQlTZWFNb25rZXkpLiB1bmRlZmluZWQgb3RoZXJ3aXNlLiBDb3JyZXNwb25kcyB0byBtYWpvciBkZXRlY3RlZCB2ZXJzaW9uLg0KCWlzTW96aWxsYTogMCwNCgkvLwlpc09wZXJhOiBOdW1iZXIgfCB1bmRlZmluZWQNCgkvLwkJVmVyc2lvbiBhcyBhIE51bWJlciBpZiBjbGllbnQgaXMgT3BlcmEuIHVuZGVmaW5lZCBvdGhlcndpc2UuIENvcnJlc3BvbmRzIHRvDQoJLy8JCW1ham9yIGRldGVjdGVkIHZlcnNpb24uDQoJaXNPcGVyYTogMCwNCgkvLwlpc1NhZmFyaTogTnVtYmVyIHwgdW5kZWZpbmVkDQoJLy8JCVZlcnNpb24gYXMgYSBOdW1iZXIgaWYgY2xpZW50IGlzIFNhZmFyaSBvciBpUGhvbmUuIHVuZGVmaW5lZCBvdGhlcndpc2UuDQoJaXNTYWZhcmk6IDAsDQoJLy8JaXNDaHJvbWU6IE51bWJlciB8IHVuZGVmaW5lZA0KCS8vCQlWZXJzaW9uIGFzIGEgTnVtYmVyIGlmIGNsaWVudCBpcyBDaHJvbWUgYnJvd3Nlci4gdW5kZWZpbmVkIG90aGVyd2lzZS4NCglpc0Nocm9tZTogMA0KCS8vCWlzTWFjOiBCb29sZWFuDQoJLy8JCVRydWUgaWYgdGhlIGNsaWVudCBydW5zIG9uIE1hYw0KfQ0KPT09PT0qLw0KDQppZih0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnKXsNCglkb2pvLmlzQnJvd3NlciA9IHRydWU7DQoJZG9qby5fbmFtZSA9ICJicm93c2VyIjsNCg0KDQoJLy8gYXR0ZW1wdCB0byBmaWd1cmUgb3V0IHRoZSBwYXRoIHRvIGRvam8gaWYgaXQgaXNuJ3Qgc2V0IGluIHRoZSBjb25maWcNCgkoZnVuY3Rpb24oKXsNCgkJdmFyIGQgPSBkb2pvOw0KDQoJCS8vIHRoaXMgaXMgYSBzY29wZSBwcm90ZWN0aW9uIGNsb3N1cmUuIFdlIHNldCBicm93c2VyIHZlcnNpb25zIGFuZCBncmFiDQoJCS8vIHRoZSBVUkwgd2Ugd2VyZSBsb2FkZWQgZnJvbSBoZXJlLg0KDQoJCS8vIGdyYWIgdGhlIG5vZGUgd2Ugd2VyZSBsb2FkZWQgZnJvbQ0KCQlpZihkb2N1bWVudCAmJiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSl7DQoJCQl2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKTsNCgkJCXZhciByZVBrZyA9IC9kb2pvKFwueGQpP1wuanMoXFd8JCkvaTsNCgkJCWZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKXsNCgkJCQl2YXIgc3JjID0gc2NyaXB0c1tpXS5nZXRBdHRyaWJ1dGUoInNyYyIpOw0KCQkJCWlmKCFzcmMpeyBjb250aW51ZTsgfQ0KCQkJCXZhciBtID0gc3JjLm1hdGNoKHJlUGtnKTsNCgkJCQlpZihtKXsNCgkJCQkJLy8gZmluZCBvdXQgd2hlcmUgd2UgY2FtZSBmcm9tDQoJCQkJCWlmKCFkLmNvbmZpZy5iYXNlVXJsKXsNCgkJCQkJCWQuY29uZmlnLmJhc2VVcmwgPSBzcmMuc3Vic3RyaW5nKDAsIG0uaW5kZXgpOw0KCQkJCQl9DQoJCQkJCS8vIGFuZCBmaW5kIG91dCBpZiB3ZSBuZWVkIHRvIG1vZGlmeSBvdXIgYmVoYXZpb3INCgkJCQkJdmFyIGNmZyA9IHNjcmlwdHNbaV0uZ2V0QXR0cmlidXRlKCJkakNvbmZpZyIpOw0KCQkJCQlpZihjZmcpew0KCQkJCQkJdmFyIGNmZ28gPSBldmFsKCIoeyAiK2NmZysiIH0pIik7DQoJCQkJCQlmb3IodmFyIHggaW4gY2Znbyl7DQoJCQkJCQkJZG9qby5jb25maWdbeF0gPSBjZmdvW3hdOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCWJyZWFrOyAvLyAiZmlyc3QgRG9qbyB3aW5zIg0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlkLmJhc2VVcmwgPSBkLmNvbmZpZy5iYXNlVXJsOw0KDQoJCS8vIGZpbGwgaW4gdGhlIHJlbmRlcmluZyBzdXBwb3J0IGluZm9ybWF0aW9uIGluIGRvam8ucmVuZGVyLioNCgkJdmFyIG4gPSBuYXZpZ2F0b3I7DQoJCXZhciBkdWEgPSBuLnVzZXJBZ2VudCwNCgkJCWRhdiA9IG4uYXBwVmVyc2lvbiwNCgkJCXR2ID0gcGFyc2VGbG9hdChkYXYpOw0KDQoJCWlmKGR1YS5pbmRleE9mKCJPcGVyYSIpID49IDApeyBkLmlzT3BlcmEgPSB0djsgfQ0KCQlpZihkdWEuaW5kZXhPZigiQWRvYmVBSVIiKSA+PSAwKXsgZC5pc0FJUiA9IDE7IH0NCgkJZC5pc0todG1sID0gKGRhdi5pbmRleE9mKCJLb25xdWVyb3IiKSA+PSAwKSA/IHR2IDogMDsNCgkJZC5pc1dlYktpdCA9IHBhcnNlRmxvYXQoZHVhLnNwbGl0KCJXZWJLaXQvIilbMV0pIHx8IHVuZGVmaW5lZDsNCgkJZC5pc0Nocm9tZSA9IHBhcnNlRmxvYXQoZHVhLnNwbGl0KCJDaHJvbWUvIilbMV0pIHx8IHVuZGVmaW5lZDsNCgkJZC5pc01hYyA9IGRhdi5pbmRleE9mKCJNYWNpbnRvc2giKSA+PSAwOw0KDQoJCS8vIHNhZmFyaSBkZXRlY3Rpb24gZGVyaXZlZCBmcm9tOg0KCQkvLwkJaHR0cDovL2RldmVsb3Blci5hcHBsZS5jb20vaW50ZXJuZXQvc2FmYXJpL2ZhcS5odG1sI2FuY2hvcjINCgkJLy8JCWh0dHA6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2ludGVybmV0L3NhZmFyaS91YW1hdHJpeC5odG1sDQoJCXZhciBpbmRleCA9IE1hdGgubWF4KGRhdi5pbmRleE9mKCJXZWJLaXQiKSwgZGF2LmluZGV4T2YoIlNhZmFyaSIpLCAwKTsNCgkJaWYoaW5kZXggJiYgIWRvam8uaXNDaHJvbWUpew0KCQkJLy8gdHJ5IHRvIGdyYWIgdGhlIGV4cGxpY2l0IFNhZmFyaSB2ZXJzaW9uIGZpcnN0LiBJZiB3ZSBkb24ndCBnZXQNCgkJCS8vIG9uZSwgbG9vayBmb3IgbGVzcyB0aGFuIDQxOS4zIGFzIHRoZSBpbmRpY2F0aW9uIHRoYXQgd2UncmUgb24gc29tZXRoaW5nDQoJCQkvLyAiU2FmYXJpIDItaXNoIi4NCgkJCWQuaXNTYWZhcmkgPSBwYXJzZUZsb2F0KGRhdi5zcGxpdCgiVmVyc2lvbi8iKVsxXSk7DQoJCQlpZighZC5pc1NhZmFyaSB8fCBwYXJzZUZsb2F0KGRhdi5zdWJzdHIoaW5kZXggKyA3KSkgPD0gNDE5LjMpew0KCQkJCWQuaXNTYWZhcmkgPSAyOw0KCQkJfQ0KCQl9DQoNCgkJCQlpZihkdWEuaW5kZXhPZigiR2Vja28iKSA+PSAwICYmICFkLmlzS2h0bWwgJiYgIWQuaXNXZWJLaXQpeyBkLmlzTW96aWxsYSA9IGQuaXNNb3ogPSB0djsgfQ0KCQlpZihkLmlzTW96KXsNCgkJCS8vV2UgcmVhbGx5IG5lZWQgdG8gZ2V0IGF3YXkgZnJvbSB0aGlzLiBDb25zaWRlciBhIHNhbmUgaXNHZWNrbyBhcHByb2FjaCBmb3IgdGhlIGZ1dHVyZS4NCgkJCWQuaXNGRiA9IHBhcnNlRmxvYXQoZHVhLnNwbGl0KCJGaXJlZm94LyIpWzFdIHx8IGR1YS5zcGxpdCgiTWluZWZpZWxkLyIpWzFdKSB8fCB1bmRlZmluZWQ7DQoJCX0NCgkJaWYoZG9jdW1lbnQuYWxsICYmICFkLmlzT3BlcmEpew0KCQkJZC5pc0lFID0gcGFyc2VGbG9hdChkYXYuc3BsaXQoIk1TSUUgIilbMV0pIHx8IHVuZGVmaW5lZDsNCgkJCS8vSW4gY2FzZXMgd2hlcmUgdGhlIHBhZ2UgaGFzIGFuIEhUVFAgaGVhZGVyIG9yIE1FVEEgdGFnIHdpdGgNCgkJCS8vWC1VQS1Db21wYXRpYmxlLCB0aGVuIGl0IGlzIGluIGVtdWxhdGlvbiBtb2RlLg0KCQkJLy9NYWtlIHN1cmUgaXNJRSByZWZsZWN0cyB0aGUgZGVzaXJlZCB2ZXJzaW9uLg0KCQkJLy9kb2N1bWVudC5kb2N1bWVudE1vZGUgb2YgNSBtZWFucyBxdWlya3MgbW9kZS4NCgkJCS8vT25seSBzd2l0Y2ggdGhlIHZhbHVlIGlmIGRvY3VtZW50TW9kZSdzIG1ham9yIHZlcnNpb24NCgkJCS8vaXMgZGlmZmVyZW50IGZyb20gaXNJRSdzIG1ham9yIHZlcnNpb24uDQoJCQl2YXIgbW9kZSA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsNCgkJCWlmKG1vZGUgJiYgbW9kZSAhPSA1ICYmIE1hdGguZmxvb3IoZC5pc0lFKSAhPSBtb2RlKXsNCgkJCQlkLmlzSUUgPSBtb2RlOw0KCQkJfQ0KCQl9DQoNCgkJLy9Xb3JrYXJvdW5kIHRvIGdldCBsb2NhbCBmaWxlIGxvYWRzIG9mIGRvam8gdG8gd29yayBvbiBJRSA3DQoJCS8vYnkgZm9yY2luZyB0byBub3QgdXNlIG5hdGl2ZSB4aHIuDQoJCWlmKGRvam8uaXNJRSAmJiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICJmaWxlOiIpew0KCQkJZG9qby5jb25maWcuaWVGb3JjZUFjdGl2ZVhYaHI9dHJ1ZTsNCgkJfQ0KCQkNCgkJZC5pc1F1aXJrcyA9IGRvY3VtZW50LmNvbXBhdE1vZGUgPT0gIkJhY2tDb21wYXQiOw0KDQoJCS8vIFRPRE86IGlzIHRoZSBIVE1MIExBTkcgYXR0cmlidXRlIHJlbGV2YW50Pw0KCQlkLmxvY2FsZSA9IGRvam8uY29uZmlnLmxvY2FsZSB8fCAoZC5pc0lFID8gbi51c2VyTGFuZ3VhZ2UgOiBuLmxhbmd1YWdlKS50b0xvd2VyQ2FzZSgpOw0KDQoJCS8vIFRoZXNlIGFyZSBpbiBvcmRlciBvZiBkZWNyZWFzaW5nIGxpa2VsaWhvb2Q7IHRoaXMgd2lsbCBjaGFuZ2UgaW4gdGltZS4NCgkJCQlkLl9YTUxIVFRQX1BST0dJRFMgPSBbJ01zeG1sMi5YTUxIVFRQJywgJ01pY3Jvc29mdC5YTUxIVFRQJywgJ01zeG1sMi5YTUxIVFRQLjQuMCddOw0KCQkNCgkJZC5feGhyT2JqID0gZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6IA0KCQkJLy8JCWRvZXMgdGhlIHdvcmsgb2YgcG9ydGFibHkgZ2VuZXJhdGluZyBhIG5ldyBYTUxIVFRQUmVxdWVzdCBvYmplY3QuDQoJCQl2YXIgaHR0cCwgbGFzdF9lOw0KCQkJCQkJaWYoIWRvam8uaXNJRSB8fCAhZG9qby5jb25maWcuaWVGb3JjZUFjdGl2ZVhYaHIpew0KCQkJCQkJCXRyeXsgaHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyB9Y2F0Y2goZSl7fQ0KCQkJCQkJfQ0KCQkJaWYoIWh0dHApew0KCQkJCWZvcih2YXIgaT0wOyBpPDM7ICsraSl7DQoJCQkJCXZhciBwcm9naWQgPSBkLl9YTUxIVFRQX1BST0dJRFNbaV07DQoJCQkJCXRyeXsNCgkJCQkJCWh0dHAgPSBuZXcgQWN0aXZlWE9iamVjdChwcm9naWQpOw0KCQkJCQl9Y2F0Y2goZSl7DQoJCQkJCQlsYXN0X2UgPSBlOw0KCQkJCQl9DQoNCgkJCQkJaWYoaHR0cCl7DQoJCQkJCQlkLl9YTUxIVFRQX1BST0dJRFMgPSBbcHJvZ2lkXTsgIC8vIHNvIGZhc3RlciBuZXh0IHRpbWUNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJDQoJCQlpZighaHR0cCl7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJYTUxIVFRQIG5vdCBhdmFpbGFibGU6ICIrbGFzdF9lKTsNCgkJCX0NCg0KCQkJcmV0dXJuIGh0dHA7IC8vIFhNTEhUVFBSZXF1ZXN0IGluc3RhbmNlDQoJCX0NCg0KCQlkLl9pc0RvY3VtZW50T2sgPSBmdW5jdGlvbihodHRwKXsNCgkJCXZhciBzdGF0ID0gaHR0cC5zdGF0dXMgfHwgMCwNCgkJCQlscCA9IGxvY2F0aW9uLnByb3RvY29sOw0KCQkJcmV0dXJuIChzdGF0ID49IDIwMCAmJiBzdGF0IDwgMzAwKSB8fCAJLy8gQm9vbGVhbg0KCQkJCXN0YXQgPT0gMzA0IHx8IAkJCQkJCS8vIGFsbG93IGFueSAyWFggcmVzcG9uc2UgY29kZQ0KCQkJCXN0YXQgPT0gMTIyMyB8fCAJCQkJCQkvLyBnZXQgaXQgb3V0IG9mIHRoZSBjYWNoZQ0KCQkJCS8vIEludGVybmV0IEV4cGxvcmVyIG1hbmdsZWQgdGhlIHN0YXR1cyBjb2RlIE9SIHdlJ3JlIFRpdGFuaXVtL2Jyb3dzZXIgY2hyb21lL2Nocm9tZSBleHRlbnNpb24gcmVxdWVzdGluZyBhIGxvY2FsIGZpbGUNCgkJCQkoIXN0YXQgJiYgKGxwID09ICJmaWxlOiIgfHwgbHAgPT0gImNocm9tZToiIHx8IGxwID09ICJjaHJvbWUtZXh0ZW5zaW9uOiIgfHwgbHAgPT0gImFwcDoiKSApOw0KCQl9DQoNCgkJLy9TZWUgaWYgYmFzZSB0YWcgaXMgaW4gdXNlLg0KCQkvL1RoaXMgaXMgdG8gZml4IGh0dHA6Ly90cmFjLmRvam90b29sa2l0Lm9yZy90aWNrZXQvMzk3MywNCgkJLy9idXQgcmVhbGx5LCB3ZSBuZWVkIHRvIGZpbmQgb3V0IGhvdyB0byBnZXQgcmlkIG9mIHRoZSBkb2pvLl9VcmwgcmVmZXJlbmNlDQoJCS8vYmVsb3cgYW5kIHN0aWxsIGhhdmUgRE9IIHdvcmsgd2l0aCB0aGUgZG9qby5pMThuIHRlc3QgZm9sbG93aW5nIHNvbWUgb3RoZXINCgkJLy90ZXN0IHRoYXQgdXNlcyB0aGUgdGVzdCBmcmFtZSB0byBsb2FkIGEgZG9jdW1lbnQgKHRyYWMgIzI3NTcpLg0KCQkvL09wZXJhIHN0aWxsIGhhcyBwcm9ibGVtcywgYnV0IHBlcmhhcHMgYSBsYXJnZXIgaXNzdWUgb2YgYmFzZSB0YWcgc3VwcG9ydA0KCQkvL3dpdGggWEhSIHJlcXVlc3RzIChoYXNCYXNlIGlzIHRydWUsIGJ1dCB0aGUgcmVxdWVzdCBpcyBzdGlsbCBtYWRlIHRvIGRvY3VtZW50DQoJCS8vcGF0aCwgbm90IGJhc2UgcGF0aCkuDQoJCXZhciBvd2xvYyA9IHdpbmRvdy5sb2NhdGlvbisiIjsNCgkJdmFyIGJhc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYmFzZSIpOw0KCQl2YXIgaGFzQmFzZSA9IChiYXNlICYmIGJhc2UubGVuZ3RoID4gMCk7DQoNCgkJZC5fZ2V0VGV4dCA9IGZ1bmN0aW9uKC8qVVJJKi8gdXJpLCAvKkJvb2xlYW4qLyBmYWlsX29rKXsNCgkJCS8vIHN1bW1hcnk6IFJlYWQgdGhlIGNvbnRlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdXJpIGFuZCByZXR1cm4gdGhvc2UgY29udGVudHMuDQoJCQkvLyB1cmk6DQoJCQkvLwkJQSByZWxhdGl2ZSBvciBhYnNvbHV0ZSB1cmkuIElmIGFic29sdXRlLCBpdCBzdGlsbCBtdXN0IGJlIGluDQoJCQkvLwkJdGhlIHNhbWUgImRvbWFpbiIgYXMgd2UgYXJlLg0KCQkJLy8gZmFpbF9vazoNCgkJCS8vCQlEZWZhdWx0IGZhbHNlLiBJZiBmYWlsX29rIGFuZCBsb2FkaW5nIGZhaWxzLCByZXR1cm4gbnVsbA0KCQkJLy8JCWluc3RlYWQgb2YgdGhyb3dpbmcuDQoJCQkvLyByZXR1cm5zOiBUaGUgcmVzcG9uc2UgdGV4dC4gbnVsbCBpcyByZXR1cm5lZCB3aGVuIHRoZXJlIGlzIGENCgkJCS8vCQlmYWlsdXJlIGFuZCBmYWlsdXJlIGlzIG9rYXkgKGFuIGV4Y2VwdGlvbiBvdGhlcndpc2UpDQoNCgkJCS8vIE5PVEU6IG11c3QgYmUgZGVjbGFyZWQgYmVmb3JlIHNjb3BlIHN3aXRjaGVzIGllLiB0aGlzLl94aHJPYmooKQ0KCQkJdmFyIGh0dHAgPSBkLl94aHJPYmooKTsNCg0KCQkJaWYoIWhhc0Jhc2UgJiYgZG9qby5fVXJsKXsNCgkJCQl1cmkgPSAobmV3IGRvam8uX1VybChvd2xvYywgdXJpKSkudG9TdHJpbmcoKTsNCgkJCX0NCg0KCQkJaWYoZC5jb25maWcuY2FjaGVCdXN0KXsNCgkJCQkvL01ha2Ugc3VyZSB3ZSBoYXZlIGEgc3RyaW5nIGJlZm9yZSBzdHJpbmcgbWV0aG9kcyBhcmUgdXNlZCBvbiB1cmkNCgkJCQl1cmkgKz0gIiI7DQoJCQkJdXJpICs9ICh1cmkuaW5kZXhPZigiPyIpID09IC0xID8gIj8iIDogIiYiKSArIFN0cmluZyhkLmNvbmZpZy5jYWNoZUJ1c3QpLnJlcGxhY2UoL1xXKy9nLCIiKTsNCgkJCX0NCg0KCQkJaHR0cC5vcGVuKCdHRVQnLCB1cmksIGZhbHNlKTsNCgkJCXRyeXsNCgkJCQlodHRwLnNlbmQobnVsbCk7DQoJCQkJaWYoIWQuX2lzRG9jdW1lbnRPayhodHRwKSl7DQoJCQkJCXZhciBlcnIgPSBFcnJvcigiVW5hYmxlIHRvIGxvYWQgIit1cmkrIiBzdGF0dXM6IisgaHR0cC5zdGF0dXMpOw0KCQkJCQllcnIuc3RhdHVzID0gaHR0cC5zdGF0dXM7DQoJCQkJCWVyci5yZXNwb25zZVRleHQgPSBodHRwLnJlc3BvbnNlVGV4dDsNCgkJCQkJdGhyb3cgZXJyOw0KCQkJCX0NCgkJCX1jYXRjaChlKXsNCgkJCQlpZihmYWlsX29rKXsgcmV0dXJuIG51bGw7IH0gLy8gbnVsbA0KCQkJCS8vIHJldGhyb3cgdGhlIGV4Y2VwdGlvbg0KCQkJCXRocm93IGU7DQoJCQl9DQoJCQlyZXR1cm4gaHR0cC5yZXNwb25zZVRleHQ7IC8vIFN0cmluZw0KCQl9DQoJCQ0KDQoJCXZhciBfdyA9IHdpbmRvdzsNCgkJdmFyIF9oYW5kbGVOb2RlRXZlbnQgPSBmdW5jdGlvbigvKlN0cmluZyovZXZ0TmFtZSwgLypGdW5jdGlvbiovZnApew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlub24tZGVzdHJ1Y3RpdmVseSBhZGRzIHRoZSBzcGVjaWZpZWQgZnVuY3Rpb24gdG8gdGhlIG5vZGUncw0KCQkJLy8JCWV2dE5hbWUgaGFuZGxlci4NCgkJCS8vIGV2dE5hbWU6IHNob3VsZCBiZSBpbiB0aGUgZm9ybSAib25jbGljayIgZm9yICJvbmNsaWNrIiBoYW5kbGVycy4NCgkJCS8vIE1ha2Ugc3VyZSB5b3UgcGFzcyBpbiB0aGUgIm9uIiBwYXJ0Lg0KCQkJdmFyIF9hID0gX3cuYXR0YWNoRXZlbnQgfHwgX3cuYWRkRXZlbnRMaXN0ZW5lcjsNCgkJCWV2dE5hbWUgPSBfdy5hdHRhY2hFdmVudCA/IGV2dE5hbWUgOiBldnROYW1lLnN1YnN0cmluZygyKTsNCgkJCV9hKGV2dE5hbWUsIGZ1bmN0aW9uKCl7DQoJCQkJZnAuYXBwbHkoX3csIGFyZ3VtZW50cyk7DQoJCQl9LCBmYWxzZSk7DQoJCX07DQoNCg0KCQlkLl93aW5kb3dVbmxvYWRlcnMgPSBbXTsNCgkJDQoJCWQud2luZG93VW5sb2FkZWQgPSBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlzaWduYWwgZmlyZWQgYnkgaW1wZW5kaW5nIHdpbmRvdyBkZXN0cnVjdGlvbi4gWW91IG1heSB1c2UNCgkJCS8vCQlkb2pvLmFkZE9uV2luZG93VW5sb2FkKCkgdG8gcmVnaXN0ZXIgYSBsaXN0ZW5lciBmb3IgdGhpcw0KCQkJLy8JCWV2ZW50LiBOT1RFOiBpZiB5b3Ugd2lzaCB0byBkb2pvLmNvbm5lY3QoKSB0byB0aGlzIG1ldGhvZA0KCQkJLy8JCXRvIHBlcmZvcm0gcGFnZS9hcHBsaWNhdGlvbiBjbGVhbnVwLCBiZSBhd2FyZSB0aGF0IHRoaXMNCgkJCS8vCQlldmVudCBXSUxMIE5PVCBmaXJlIGlmIG5vIGhhbmRsZXIgaGFzIGJlZW4gcmVnaXN0ZXJlZCB3aXRoDQoJCQkvLwkJZG9qby5hZGRPbldpbmRvd1VubG9hZC4gVGhpcyBiZWhhdmlvciBzdGFydGVkIGluIERvam8gMS4zLg0KCQkJLy8JCVByZXZpb3VzIHZlcnNpb25zIGFsd2F5cyB0cmlnZ2VyZWQgZG9qby53aW5kb3dVbmxvYWRlZC4gU2VlDQoJCQkvLwkJZG9qby5hZGRPbldpbmRvd1VubG9hZCBmb3IgbW9yZSBpbmZvLg0KCQkJdmFyIG1sbCA9IGQuX3dpbmRvd1VubG9hZGVyczsNCgkJCXdoaWxlKG1sbC5sZW5ndGgpew0KCQkJCShtbGwucG9wKCkpKCk7DQoJCQl9DQoJCQlkID0gbnVsbDsNCgkJfTsNCg0KCQl2YXIgX29uV2luZG93VW5sb2FkQXR0YWNoZWQgPSAwOw0KCQlkLmFkZE9uV2luZG93VW5sb2FkID0gZnVuY3Rpb24oLypPYmplY3Q/fEZ1bmN0aW9uPyovb2JqLCAvKlN0cmluZ3xGdW5jdGlvbj8qL2Z1bmN0aW9uTmFtZSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCXJlZ2lzdGVycyBhIGZ1bmN0aW9uIHRvIGJlIHRyaWdnZXJlZCB3aGVuIHdpbmRvdy5vbnVubG9hZA0KCQkJLy8JCWZpcmVzLiANCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoZSBmaXJzdCB0aW1lIHRoYXQgYWRkT25XaW5kb3dVbmxvYWQgaXMgY2FsbGVkIERvam8NCgkJCS8vCQl3aWxsIHJlZ2lzdGVyIGEgcGFnZSBsaXN0ZW5lciB0byB0cmlnZ2VyIHlvdXIgdW5sb2FkDQoJCQkvLwkJaGFuZGxlciB3aXRoLiBOb3RlIHRoYXQgcmVnaXN0ZXJpbmcgdGhlc2UgaGFuZGxlcnMgbWF5DQoJCQkvLwkJZGVzdG9yeSAiZmFzdGJhY2siIHBhZ2UgY2FjaGluZyBpbiBicm93c2VycyB0aGF0IHN1cHBvcnQNCgkJCS8vCQlpdC4gQmUgY2FyZWZ1bCB0cnlpbmcgdG8gbW9kaWZ5IHRoZSBET00gb3IgYWNjZXNzDQoJCQkvLwkJSmF2YVNjcmlwdCBwcm9wZXJ0aWVzIGR1cmluZyB0aGlzIHBoYXNlIG9mIHBhZ2UgdW5sb2FkaW5nOg0KCQkJLy8JCXRoZXkgbWF5IG5vdCBhbHdheXMgYmUgYXZhaWxhYmxlLiBDb25zaWRlcg0KCQkJLy8JCWRvam8uYWRkT25VbmxvYWQoKSBpZiB5b3UgbmVlZCB0byBtb2RpZnkgdGhlIERPTSBvciBkbw0KCQkJLy8JCWhlYXZ5IEphdmFTY3JpcHQgd29yayBzaW5jZSBpdCBmaXJlcyBhdCB0aGUgZXFpdmFsZW50IG9mDQoJCQkvLwkJdGhlIHBhZ2UncyAib25iZWZvcmV1bmxvYWQiIGV2ZW50Lg0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJZG9qby5hZGRPbldpbmRvd1VubG9hZChmdW5jdGlvblBvaW50ZXIpDQoJCQkvLwl8CWRvam8uYWRkT25XaW5kb3dVbmxvYWQob2JqZWN0LCAiZnVuY3Rpb25OYW1lIik7DQoJCQkvLwl8CWRvam8uYWRkT25XaW5kb3dVbmxvYWQob2JqZWN0LCBmdW5jdGlvbigpeyAvKiAuLi4gKi99KTsNCg0KCQkJZC5fb250byhkLl93aW5kb3dVbmxvYWRlcnMsIG9iaiwgZnVuY3Rpb25OYW1lKTsNCgkJCWlmKCFfb25XaW5kb3dVbmxvYWRBdHRhY2hlZCl7DQoJCQkJX29uV2luZG93VW5sb2FkQXR0YWNoZWQgPSAxOw0KCQkJCV9oYW5kbGVOb2RlRXZlbnQoIm9udW5sb2FkIiwgZC53aW5kb3dVbmxvYWRlZCk7DQoJCQl9DQoJCX07DQoNCgkJdmFyIF9vblVubG9hZEF0dGFjaGVkID0gMDsNCgkJZC5hZGRPblVubG9hZCA9IGZ1bmN0aW9uKC8qT2JqZWN0P3xGdW5jdGlvbj8qL29iaiwgLypTdHJpbmd8RnVuY3Rpb24/Ki9mdW5jdGlvbk5hbWUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlyZWdpc3RlcnMgYSBmdW5jdGlvbiB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGUgcGFnZSB1bmxvYWRzLg0KCQkJLy8JZGVzY3JpcHRpb246DQoJCQkvLwkJVGhlIGZpcnN0IHRpbWUgdGhhdCBhZGRPblVubG9hZCBpcyBjYWxsZWQgRG9qbyB3aWxsDQoJCQkvLwkJcmVnaXN0ZXIgYSBwYWdlIGxpc3RlbmVyIHRvIHRyaWdnZXIgeW91ciB1bmxvYWQgaGFuZGxlcg0KCQkJLy8JCXdpdGguIA0KCQkJLy8NCgkJCS8vCQlJbiBhIGJyb3dzZXIgZW52aXJvbWVudCwgdGhlIGZ1bmN0aW9ucyB3aWxsIGJlIHRyaWdnZXJlZA0KCQkJLy8JCWR1cmluZyB0aGUgd2luZG93Lm9uYmVmb3JldW5sb2FkIGV2ZW50LiBCZSBjYXJlZnVsIG9mIGRvaW5nDQoJCQkvLwkJdG9vIG11Y2ggd29yayBpbiBhbiB1bmxvYWQgaGFuZGxlci4gb25iZWZvcmV1bmxvYWQgY2FuIGJlDQoJCQkvLwkJdHJpZ2dlcmVkIGlmIGEgbGluayB0byBkb3dubG9hZCBhIGZpbGUgaXMgY2xpY2tlZCwgb3IgaWYNCgkJCS8vCQl0aGUgbGluayBpcyBhIGphdmFzY3JpcHQ6IGxpbmsuIEluIHRoZXNlIGNhc2VzLCB0aGUNCgkJCS8vCQlvbmJlZm9yZXVubG9hZCBldmVudCBmaXJlcywgYnV0IHRoZSBkb2N1bWVudCBpcyBub3QNCgkJCS8vCQlhY3R1YWxseSBkZXN0cm95ZWQuIFNvIGJlIGNhcmVmdWwgYWJvdXQgZG9pbmcgZGVzdHJ1Y3RpdmUNCgkJCS8vCQlvcGVyYXRpb25zIGluIGEgZG9qby5hZGRPblVubG9hZCBjYWxsYmFjay4NCgkJCS8vDQoJCQkvLwkJRnVydGhlciBub3RlIHRoYXQgY2FsbGluZyBkb2pvLmFkZE9uVW5sb2FkIHdpbGwgcHJldmVudA0KCQkJLy8JCWJyb3dzZXJzIGZyb20gdXNpbmcgYSAiZmFzdCBiYWNrIiBjYWNoZSB0byBtYWtlIHBhZ2UNCgkJCS8vCQlsb2FkaW5nIHZpYSBiYWNrIGJ1dHRvbiBpbnN0YW50YW5lb3VzLiANCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CWRvam8uYWRkT25VbmxvYWQoZnVuY3Rpb25Qb2ludGVyKQ0KCQkJLy8JfAlkb2pvLmFkZE9uVW5sb2FkKG9iamVjdCwgImZ1bmN0aW9uTmFtZSIpDQoJCQkvLwl8CWRvam8uYWRkT25VbmxvYWQob2JqZWN0LCBmdW5jdGlvbigpeyAvKiAuLi4gKi99KTsNCg0KCQkJZC5fb250byhkLl91bmxvYWRlcnMsIG9iaiwgZnVuY3Rpb25OYW1lKTsNCgkJCWlmKCFfb25VbmxvYWRBdHRhY2hlZCl7DQoJCQkJX29uVW5sb2FkQXR0YWNoZWQgPSAxOw0KCQkJCV9oYW5kbGVOb2RlRXZlbnQoIm9uYmVmb3JldW5sb2FkIiwgZG9qby51bmxvYWRlZCk7DQoJCQl9DQoJCX07DQoNCgl9KSgpOw0KDQoJLy9TVEFSVCBET01Db250ZW50TG9hZGVkDQoJZG9qby5faW5pdEZpcmVkID0gZmFsc2U7DQoJZG9qby5fbG9hZEluaXQgPSBmdW5jdGlvbihlKXsNCgkJaWYoZG9qby5fc2Nyb2xsSW50ZXJ2YWxJZCl7DQoJCQljbGVhckludGVydmFsKGRvam8uX3Njcm9sbEludGVydmFsSWQpOw0KCQkJZG9qby5fc2Nyb2xsSW50ZXJ2YWxJZCA9IDA7DQoJCX0NCg0KCQlpZighZG9qby5faW5pdEZpcmVkKXsNCgkJCWRvam8uX2luaXRGaXJlZCA9IHRydWU7DQoNCgkJCS8vSGVscCBvdXQgSUUgdG8gYXZvaWQgbWVtb3J5IGxlYWsuDQoJCQlpZighZG9qby5jb25maWcuYWZ0ZXJPbkxvYWQgJiYgd2luZG93LmRldGFjaEV2ZW50KXsNCgkJCQl3aW5kb3cuZGV0YWNoRXZlbnQoIm9ubG9hZCIsIGRvam8uX2xvYWRJbml0KTsNCgkJCX0NCg0KCQkJaWYoZG9qby5faW5GbGlnaHRDb3VudCA9PSAwKXsNCgkJCQlkb2pvLl9tb2R1bGVzTG9hZGVkKCk7DQoJCQl9DQoJCX0NCgl9DQoNCglpZighZG9qby5jb25maWcuYWZ0ZXJPbkxvYWQpewkJDQoJCWlmKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpew0KCQkJLy9TdGFuZGFyZHMuIEhvb3JheSEgQXNzdW1wdGlvbiBoZXJlIHRoYXQgaWYgc3RhbmRhcmRzIGJhc2VkLA0KCQkJLy9pdCBrbm93cyBhYm91dCBET01Db250ZW50TG9hZGVkLiBJdCBpcyBPSyBpZiBpdCBkb2VzIG5vdCwgdGhlIGZhbGwgdGhyb3VnaA0KCQkJLy90byB3aW5kb3cgb25sb2FkIHNob3VsZCBiZSBnb29kIGVub3VnaC4NCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBkb2pvLl9sb2FkSW5pdCwgZmFsc2UpOw0KCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBkb2pvLl9sb2FkSW5pdCwgZmFsc2UpOw0KCQl9ZWxzZSBpZih3aW5kb3cuYXR0YWNoRXZlbnQpew0KCQkJd2luZG93LmF0dGFjaEV2ZW50KCJvbmxvYWQiLCBkb2pvLl9sb2FkSW5pdCk7DQoNCgkJCS8vRE9NQ29udGVudExvYWRlZCBhcHByb3hpbWF0aW9uLiBEaWVnbyBQZXJpbmkgZm91bmQgdGhpcyBNU0ROIGFydGljbGUNCgkJCS8vdGhhdCBpbmRpY2F0ZXMgZG9TY3JvbGwgaXMgYXZhaWxhYmxlIGFmdGVyIERPTSByZWFkeSwgc28gZG8gYSBzZXRUaW1lb3V0DQoJCQkvL3RvIGNoZWNrIHdoZW4gaXQgaXMgYXZhaWxhYmxlLg0KCQkJLy9odHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzE0MjYuYXNweA0KCQkJaWYoIWRvam8uY29uZmlnLnNraXBJZURvbUxvYWRlZCAmJiBzZWxmID09PSBzZWxmLnRvcCl7DQoJCQkJZG9qby5fc2Nyb2xsSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpew0KCQkJCQl0cnl7DQoJCQkJCQkvL1doZW4gZG9qbyBpcyBsb2FkZWQgaW50byBhbiBpZnJhbWUgaW4gYW4gSUUgSFRNTCBBcHBsaWNhdGlvbiANCgkJCQkJCS8vKEhUQSksIHN1Y2ggYXMgaW4gYSBzZWxlbml1bSB0ZXN0LCBqYXZhc2NyaXB0IGluIHRoZSBpZnJhbWUNCgkJCQkJCS8vY2FuJ3Qgc2VlIGFueXRoaW5nIG91dHNpZGUgb2YgaXQsIHNvIHNlbGY9PT1zZWxmLnRvcCBpcyB0cnVlLA0KCQkJCQkJLy9idXQgdGhlIGlmcmFtZSBpcyBub3QgdGhlIHRvcCB3aW5kb3cgYW5kIGRvU2Nyb2xsIHdpbGwgYmUgDQoJCQkJCQkvL2F2YWlsYWJsZSBiZWZvcmUgZG9jdW1lbnQuYm9keSBpcyBzZXQuIFRlc3QgZG9jdW1lbnQuYm9keQ0KCQkJCQkJLy9iZWZvcmUgdHJ5aW5nIHRoZSBkb1Njcm9sbCB0cmljaw0KCQkJCQkJaWYoZG9jdW1lbnQuYm9keSl7DQoJCQkJCQkJZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iik7DQoJCQkJCQkJZG9qby5fbG9hZEluaXQoKTsNCgkJCQkJCX0NCgkJCQkJfWNhdGNoIChlKXt9DQoJCQkJfSwgMzApOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJCWlmKGRvam8uaXNJRSl7DQoJCXRyeXsNCgkJCShmdW5jdGlvbigpew0KCQkJCWRvY3VtZW50Lm5hbWVzcGFjZXMuYWRkKCJ2IiwgInVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sIik7DQoJCQkJdmFyIHZtbEVsZW1zID0gWyIqIiwgImdyb3VwIiwgInJvdW5kcmVjdCIsICJvdmFsIiwgInNoYXBlIiwgInJlY3QiLCAiaW1hZ2VkYXRhIiwgInBhdGgiLCAidGV4dHBhdGgiLCAidGV4dCJdLA0KCQkJCQlpID0gMCwgbCA9IDEsIHMgPSBkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KCk7DQoJCQkJaWYoZG9qby5pc0lFID49IDgpew0KCQkJCQlpID0gMTsNCgkJCQkJbCA9IHZtbEVsZW1zLmxlbmd0aDsNCgkJCQl9DQoJCQkJZm9yKDsgaSA8IGw7ICsraSl7DQoJCQkJCXMuYWRkUnVsZSgidlxcOiIgKyB2bWxFbGVtc1tpXSwgImJlaGF2aW9yOnVybCgjZGVmYXVsdCNWTUwpOyBkaXNwbGF5OmlubGluZS1ibG9jayIpOw0KCQkJCX0NCgkJCX0pKCk7DQoJCX1jYXRjaChlKXt9DQoJfQ0KCQkvL0VORCBET01Db250ZW50TG9hZGVkDQoNCg0KCS8qDQoJT3BlbkFqYXguc3Vic2NyaWJlKCJPcGVuQWpheCIsICJvbmxvYWQiLCBmdW5jdGlvbigpew0KCQlpZihkb2pvLl9pbkZsaWdodENvdW50ID09IDApew0KCQkJZG9qby5fbW9kdWxlc0xvYWRlZCgpOw0KCQl9DQoJfSk7DQoNCglPcGVuQWpheC5zdWJzY3JpYmUoIk9wZW5BamF4IiwgIm9udW5sb2FkIiwgZnVuY3Rpb24oKXsNCgkJZG9qby51bmxvYWRlZCgpOw0KCX0pOw0KCSovDQp9IC8vaWYgKHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcpDQoNCi8vUmVnaXN0ZXIgYW55IG1vZHVsZSBwYXRocyBzZXQgdXAgaW4gZGpDb25maWcuIE5lZWQgdG8gZG8gdGhpcw0KLy9pbiB0aGUgaG9zdGVudnMgc2luY2UgaG9zdGVudl9icm93c2VyIGNhbiByZWFkIGRqQ29uZmlnIGZyb20gYQ0KLy9zY3JpcHQgdGFnJ3MgYXR0cmlidXRlLg0KKGZ1bmN0aW9uKCl7DQoJdmFyIG1wID0gZG9qby5jb25maWdbIm1vZHVsZVBhdGhzIl07DQoJaWYobXApew0KCQlmb3IodmFyIHBhcmFtIGluIG1wKXsNCgkJCWRvam8ucmVnaXN0ZXJNb2R1bGVQYXRoKHBhcmFtLCBtcFtwYXJhbV0pOw0KCQl9DQoJfQ0KfSkoKTsNCg0KLy9Mb2FkIGRlYnVnIGNvZGUgaWYgbmVjZXNzYXJ5Lg0KaWYoZG9qby5jb25maWcuaXNEZWJ1Zyl7DQoJZG9qby5yZXF1aXJlKCJkb2pvLl9maXJlYnVnLmZpcmVidWciKTsNCn0NCg0KaWYoZG9qby5jb25maWcuZGVidWdBdEFsbENvc3RzKXsNCglkb2pvLmNvbmZpZy51c2VYRG9tYWluID0gdHJ1ZTsNCglkb2pvLnJlcXVpcmUoImRvam8uX2Jhc2UuX2xvYWRlci5sb2FkZXJfeGQiKTsNCglkb2pvLnJlcXVpcmUoImRvam8uX2Jhc2UuX2xvYWRlci5sb2FkZXJfZGVidWciKTsNCglkb2pvLnJlcXVpcmUoImRvam8uaTE4biIpOw0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UubGFuZyJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5sYW5nIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmxhbmciKTsNCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIGQgPSBkb2pvLCBvcHRzID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KCS8vIENyb2NrZm9yZCAoaXNoKSBmdW5jdGlvbnMNCg0KCWRvam8uaXNTdHJpbmcgPSBmdW5jdGlvbigvKmFueXRoaW5nKi8gaXQpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJuIHRydWUgaWYgaXQgaXMgYSBTdHJpbmcNCgkJcmV0dXJuICh0eXBlb2YgaXQgPT0gInN0cmluZyIgfHwgaXQgaW5zdGFuY2VvZiBTdHJpbmcpOyAvLyBCb29sZWFuDQoJfQ0KDQoJZG9qby5pc0FycmF5ID0gZnVuY3Rpb24oLyphbnl0aGluZyovIGl0KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybiB0cnVlIGlmIGl0IGlzIGFuIEFycmF5Lg0KCQkvLwkJRG9lcyBub3Qgd29yayBvbiBBcnJheXMgY3JlYXRlZCBpbiBvdGhlciB3aW5kb3dzLg0KCQlyZXR1cm4gaXQgJiYgKGl0IGluc3RhbmNlb2YgQXJyYXkgfHwgdHlwZW9mIGl0ID09ICJhcnJheSIpOyAvLyBCb29sZWFuDQoJfQ0KDQoJZG9qby5pc0Z1bmN0aW9uID0gZnVuY3Rpb24oLyphbnl0aGluZyovIGl0KXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybiB0cnVlIGlmIGl0IGlzIGEgRnVuY3Rpb24NCgkJcmV0dXJuIG9wdHMuY2FsbChpdCkgPT09ICJbb2JqZWN0IEZ1bmN0aW9uXSI7DQoJfTsNCg0KCWRvam8uaXNPYmplY3QgPSBmdW5jdGlvbigvKmFueXRoaW5nKi8gaXQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyB0cnVlIGlmIGl0IGlzIGEgSmF2YVNjcmlwdCBvYmplY3QgKG9yIGFuIEFycmF5LCBhIEZ1bmN0aW9uDQoJCS8vCQlvciBudWxsKQ0KCQlyZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJg0KCQkJKGl0ID09PSBudWxsIHx8IHR5cGVvZiBpdCA9PSAib2JqZWN0IiB8fCBkLmlzQXJyYXkoaXQpIHx8IGQuaXNGdW5jdGlvbihpdCkpOyAvLyBCb29sZWFuDQoJfQ0KDQoJZG9qby5pc0FycmF5TGlrZSA9IGZ1bmN0aW9uKC8qYW55dGhpbmcqLyBpdCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlzaW1pbGFyIHRvIGRvam8uaXNBcnJheSgpIGJ1dCBtb3JlIHBlcm1pc3NpdmUNCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlEb2Vzbid0IHN0cm9uZ2x5IHRlc3QgZm9yICJhcnJheW5lc3MiLiAgSW5zdGVhZCwgc2V0dGxlcyBmb3IgImlzbid0DQoJCS8vCQlhIHN0cmluZyBvciBudW1iZXIgYW5kIGhhcyBhIGxlbmd0aCBwcm9wZXJ0eSIuIEFyZ3VtZW50cyBvYmplY3RzDQoJCS8vCQlhbmQgRE9NIGNvbGxlY3Rpb25zIHdpbGwgcmV0dXJuIHRydWUgd2hlbiBwYXNzZWQgdG8NCgkJLy8JCWRvam8uaXNBcnJheUxpa2UoKSwgYnV0IHdpbGwgcmV0dXJuIGZhbHNlIHdoZW4gcGFzc2VkIHRvDQoJCS8vCQlkb2pvLmlzQXJyYXkoKS4NCgkJLy8JcmV0dXJuczoNCgkJLy8JCUlmIGl0IHdhbGtzIGxpa2UgYSBkdWNrIGFuZCBxdWFja3MgbGlrZSBhIGR1Y2ssIHJldHVybiBgdHJ1ZWANCgkJcmV0dXJuIGl0ICYmIGl0ICE9PSB1bmRlZmluZWQgJiYgLy8gQm9vbGVhbg0KCQkJLy8ga2VlcCBvdXQgYnVpbHQtaW4gY29uc3RydWN0b3JzIChOdW1iZXIsIFN0cmluZywgLi4uKSB3aGljaCBoYXZlIGxlbmd0aA0KCQkJLy8gcHJvcGVydGllcw0KCQkJIWQuaXNTdHJpbmcoaXQpICYmICFkLmlzRnVuY3Rpb24oaXQpICYmDQoJCQkhKGl0LnRhZ05hbWUgJiYgaXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdmb3JtJykgJiYNCgkJCShkLmlzQXJyYXkoaXQpIHx8IGlzRmluaXRlKGl0Lmxlbmd0aCkpOw0KCX0NCg0KCWRvam8uaXNBbGllbiA9IGZ1bmN0aW9uKC8qYW55dGhpbmcqLyBpdCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIHRydWUgaWYgaXQgaXMgYSBidWlsdC1pbiBmdW5jdGlvbiBvciBzb21lIG90aGVyIGtpbmQgb2YNCgkJLy8JCW9kZGJhbGwgdGhhdCAqc2hvdWxkKiByZXBvcnQgYXMgYSBmdW5jdGlvbiBidXQgZG9lc24ndA0KCQlyZXR1cm4gaXQgJiYgIWQuaXNGdW5jdGlvbihpdCkgJiYgL1x7XHMqXFtuYXRpdmUgY29kZVxdXHMqXH0vLnRlc3QoU3RyaW5nKGl0KSk7IC8vIEJvb2xlYW4NCgl9DQoNCglkb2pvLmV4dGVuZCA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gY29uc3RydWN0b3IsIC8qT2JqZWN0Li4uKi8gcHJvcHMpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQWRkcyBhbGwgcHJvcGVydGllcyBhbmQgbWV0aG9kcyBvZiBwcm9wcyB0byBjb25zdHJ1Y3RvcidzDQoJCS8vCQlwcm90b3R5cGUsIG1ha2luZyB0aGVtIGF2YWlsYWJsZSB0byBhbGwgaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aA0KCQkvLwkJY29uc3RydWN0b3IuDQoJCWZvcih2YXIgaT0xLCBsPWFyZ3VtZW50cy5sZW5ndGg7IGk8bDsgaSsrKXsNCgkJCWQuX21peGluKGNvbnN0cnVjdG9yLnByb3RvdHlwZSwgYXJndW1lbnRzW2ldKTsNCgkJfQ0KCQlyZXR1cm4gY29uc3RydWN0b3I7IC8vIE9iamVjdA0KCX0NCg0KCWRvam8uX2hpdGNoQXJncyA9IGZ1bmN0aW9uKHNjb3BlLCBtZXRob2QgLyosLi4uKi8pew0KCQl2YXIgcHJlID0gZC5fdG9BcnJheShhcmd1bWVudHMsIDIpOw0KCQl2YXIgbmFtZWQgPSBkLmlzU3RyaW5nKG1ldGhvZCk7DQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJLy8gYXJyYXlpZnkgYXJndW1lbnRzDQoJCQl2YXIgYXJncyA9IGQuX3RvQXJyYXkoYXJndW1lbnRzKTsNCgkJCS8vIGxvY2F0ZSBvdXIgbWV0aG9kDQoJCQl2YXIgZiA9IG5hbWVkID8gKHNjb3BlfHxkLmdsb2JhbClbbWV0aG9kXSA6IG1ldGhvZDsNCgkJCS8vIGludm9rZSB3aXRoIGNvbGxlY3RlZCBhcmdzDQoJCQlyZXR1cm4gZiAmJiBmLmFwcGx5KHNjb3BlIHx8IHRoaXMsIHByZS5jb25jYXQoYXJncykpOyAvLyBtaXhlZA0KCQl9IC8vIEZ1bmN0aW9uDQoJfQ0KDQoJZG9qby5oaXRjaCA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki9zY29wZSwgLypGdW5jdGlvbnxTdHJpbmcqL21ldGhvZCAvKiwuLi4qLyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgZXZlciBleGVjdXRlIGluIHRoZSBhIGdpdmVuIHNjb3BlLg0KCQkvLwkJVGhpcyBhbGxvd3MgZm9yIGVhc3kgdXNlIG9mIG9iamVjdCBtZW1iZXIgZnVuY3Rpb25zDQoJCS8vCQlpbiBjYWxsYmFja3MgYW5kIG90aGVyIHBsYWNlcyBpbiB3aGljaCB0aGUgInRoaXMiIGtleXdvcmQgbWF5DQoJCS8vCQlvdGhlcndpc2Ugbm90IHJlZmVyZW5jZSB0aGUgZXhwZWN0ZWQgc2NvcGUuDQoJCS8vCQlBbnkgbnVtYmVyIG9mIGRlZmF1bHQgcG9zaXRpb25hbCBhcmd1bWVudHMgbWF5IGJlIHBhc3NlZCBhcyBwYXJhbWV0ZXJzIA0KCQkvLwkJYmV5b25kICJtZXRob2QiLg0KCQkvLwkJRWFjaCBvZiB0aGVzZSB2YWx1ZXMgd2lsbCBiZSB1c2VkIHRvICJwbGFjZWhvbGQiIChzaW1pbGFyIHRvIGN1cnJ5KQ0KCQkvLwkJZm9yIHRoZSBoaXRjaGVkIGZ1bmN0aW9uLg0KCQkvLwlzY29wZToNCgkJLy8JCVRoZSBzY29wZSB0byB1c2Ugd2hlbiBtZXRob2QgZXhlY3V0ZXMuIElmIG1ldGhvZCBpcyBhIHN0cmluZywNCgkJLy8JCXNjb3BlIGlzIGFsc28gdGhlIG9iamVjdCBjb250YWluaW5nIG1ldGhvZC4NCgkJLy8JbWV0aG9kOg0KCQkvLwkJQSBmdW5jdGlvbiB0byBiZSBoaXRjaGVkIHRvIHNjb3BlLCBvciB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIGluDQoJCS8vCQlzY29wZSB0byBiZSBoaXRjaGVkLg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CWRvam8uaGl0Y2goZm9vLCAiYmFyIikoKTsNCgkJLy8JCXJ1bnMgZm9vLmJhcigpIGluIHRoZSBzY29wZSBvZiBmb28NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAlkb2pvLmhpdGNoKGZvbywgbXlGdW5jdGlvbik7DQoJCS8vCQlyZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBydW5zIG15RnVuY3Rpb24gaW4gdGhlIHNjb3BlIG9mIGZvbw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJRXhwYW5zaW9uIG9uIHRoZSBkZWZhdWx0IHBvc2l0aW9uYWwgYXJndW1lbnRzIHBhc3NlZCBhbG9uZyBmcm9tDQoJCS8vCQloaXRjaC4gUGFzc2VkIGFyZ3MgYXJlIG1peGVkIGZpcnN0LCBhZGRpdGlvbmFsIGFyZ3MgYWZ0ZXIuDQoJCS8vCXwJdmFyIGZvbyA9IHsgYmFyOiBmdW5jdGlvbihhLCBiLCBjKXsgY29uc29sZS5sb2coYSwgYiwgYyk7IH0gfTsNCgkJLy8JfAl2YXIgZm4gPSBkb2pvLmhpdGNoKGZvbywgImJhciIsIDEsIDIpOw0KCQkvLwl8CWZuKDMpOyAvLyBsb2dzICIxLCAyLCAzIg0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBmb28gPSB7IGJhcjogMiB9Ow0KCQkvLwl8CWRvam8uaGl0Y2goZm9vLCBmdW5jdGlvbigpeyB0aGlzLmJhciA9IDEwOyB9KSgpOw0KCQkvLwkJZXhlY3V0ZSBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gaW4gc2NvcGUgb2YgZm9vDQoJCQ0KCQlpZihhcmd1bWVudHMubGVuZ3RoID4gMil7DQoJCQlyZXR1cm4gZC5faGl0Y2hBcmdzLmFwcGx5KGQsIGFyZ3VtZW50cyk7IC8vIEZ1bmN0aW9uDQoJCX0NCgkJaWYoIW1ldGhvZCl7DQoJCQltZXRob2QgPSBzY29wZTsNCgkJCXNjb3BlID0gbnVsbDsNCgkJfQ0KCQlpZihkLmlzU3RyaW5nKG1ldGhvZCkpew0KCQkJc2NvcGUgPSBzY29wZSB8fCBkLmdsb2JhbDsNCgkJCWlmKCFzY29wZVttZXRob2RdKXsgdGhyb3coWydkb2pvLmhpdGNoOiBzY29wZVsiJywgbWV0aG9kLCAnIl0gaXMgbnVsbCAoc2NvcGU9IicsIHNjb3BlLCAnIiknXS5qb2luKCcnKSk7IH0NCgkJCXJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gc2NvcGVbbWV0aG9kXS5hcHBseShzY29wZSwgYXJndW1lbnRzIHx8IFtdKTsgfTsgLy8gRnVuY3Rpb24NCgkJfQ0KCQlyZXR1cm4gIXNjb3BlID8gbWV0aG9kIDogZnVuY3Rpb24oKXsgcmV0dXJuIG1ldGhvZC5hcHBseShzY29wZSwgYXJndW1lbnRzIHx8IFtdKTsgfTsgLy8gRnVuY3Rpb24NCgl9DQoNCgkvKj09PT09DQoJZG9qby5kZWxlZ2F0ZSA9IGZ1bmN0aW9uKG9iaiwgcHJvcHMpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhIG5ldyBvYmplY3Qgd2hpY2ggImxvb2tzIiB0byBvYmogZm9yIHByb3BlcnRpZXMgd2hpY2ggaXQNCgkJLy8JCWRvZXMgbm90IGhhdmUgYSB2YWx1ZSBmb3IuIE9wdGlvbmFsbHkgdGFrZXMgYSBiYWcgb2YgcHJvcGVydGllcyB0bw0KCQkvLwkJc2VlZCB0aGUgcmV0dXJuZWQgb2JqZWN0IHdpdGggaW5pdGlhbGx5Lg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgaXMgYSBzbWFsbCBpbXBsZW1lbnRhdG9uIG9mIHRoZSBCb29kbWFuL0Nyb2NrZm9yZCBkZWxlZ2F0aW9uDQoJCS8vCQlwYXR0ZXJuIGluIEphdmFTY3JpcHQuIEFuIGludGVybWVkaWF0ZSBvYmplY3QgY29uc3RydWN0b3IgbWVkaWF0ZXMNCgkJLy8JCXRoZSBwcm90b3R5cGUgY2hhaW4gZm9yIHRoZSByZXR1cm5lZCBvYmplY3QsIHVzaW5nIGl0IHRvIGRlbGVnYXRlDQoJCS8vCQlkb3duIHRvIG9iaiBmb3IgcHJvcGVydHkgbG9va3VwIHdoZW4gb2JqZWN0LWxvY2FsIGxvb2t1cCBmYWlscy4NCgkJLy8JCVRoaXMgY2FuIGJlIHRob3VnaHQgb2Ygc2ltaWxhcmx5IHRvIEVTNCdzICJ3cmFwIiwgc2F2ZSB0aGF0IGl0IGRvZXMNCgkJLy8JCW5vdCBhY3Qgb24gdHlwZXMgYnV0IHJhdGhlciBvbiBwdXJlIG9iamVjdHMuDQoJCS8vCW9iajoNCgkJLy8JCVRoZSBvYmplY3QgdG8gZGVsZWdhdGUgdG8gZm9yIHByb3BlcnRpZXMgbm90IGZvdW5kIGRpcmVjdGx5IG9uIHRoZQ0KCQkvLwkJcmV0dXJuIG9iamVjdCBvciBpbiBwcm9wcy4NCgkJLy8JcHJvcHM6DQoJCS8vCQlhbiBvYmplY3QgY29udGFpbmluZyBwcm9wZXJ0aWVzIHRvIGFzc2lnbiB0byB0aGUgcmV0dXJuZWQgb2JqZWN0DQoJCS8vCXJldHVybnM6DQoJCS8vCQlhbiBPYmplY3Qgb2YgYW5vbnltb3VzIHR5cGUNCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgZm9vID0geyBiYXI6ICJiYXoiIH07DQoJCS8vCXwJdmFyIHRoaW5nZXIgPSBkb2pvLmRlbGVnYXRlKGZvbywgeyB0aHVkOiAieHl6enkifSk7DQoJCS8vCXwJdGhpbmdlci5iYXIgPT0gImJheiI7IC8vIGRlbGVnYXRlZCB0byBmb28NCgkJLy8JfAlmb28udGh1ZCA9PSB1bmRlZmluZWQ7IC8vIGJ5IGRlZmluaXRpb24NCgkJLy8JfAl0aGluZ2VyLnRodWQgPT0gInh5enp5IjsgLy8gbWl4ZWQgaW4gZnJvbSBwcm9wcw0KCQkvLwl8CWZvby5iYXIgPSAidGhvbmsiOw0KCQkvLwl8CXRoaW5nZXIuYmFyID09ICJ0aG9uayI7IC8vIHN0aWxsIGRlbGVnYXRlZCB0byBmb28ncyBiYXINCgl9DQoJPT09PT0qLw0KDQoJZG9qby5kZWxlZ2F0ZSA9IGRvam8uX2RlbGVnYXRlID0gKGZ1bmN0aW9uKCl7DQoJCS8vIGJvb2RtYW4vY3JvY2tmb3JkIGRlbGVnYXRpb24gdy8gY29ybmZvcmQgb3B0aW1pemF0aW9uDQoJCWZ1bmN0aW9uIFRNUCgpe30NCgkJcmV0dXJuIGZ1bmN0aW9uKG9iaiwgcHJvcHMpew0KCQkJVE1QLnByb3RvdHlwZSA9IG9iajsNCgkJCXZhciB0bXAgPSBuZXcgVE1QKCk7DQoJCQlUTVAucHJvdG90eXBlID0gbnVsbDsNCgkJCWlmKHByb3BzKXsNCgkJCQlkLl9taXhpbih0bXAsIHByb3BzKTsNCgkJCX0NCgkJCXJldHVybiB0bXA7IC8vIE9iamVjdA0KCQl9DQoJfSkoKTsNCg0KCS8qPT09PT0NCglkb2pvLl90b0FycmF5ID0gZnVuY3Rpb24ob2JqLCBvZmZzZXQsIHN0YXJ0V2l0aCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlDb252ZXJ0cyBhbiBhcnJheS1saWtlIG9iamVjdCAoaS5lLiBhcmd1bWVudHMsIERPTUNvbGxlY3Rpb24pIHRvIGFuDQoJCS8vCQlhcnJheS4gUmV0dXJucyBhIG5ldyBBcnJheSB3aXRoIHRoZSBlbGVtZW50cyBvZiBvYmouDQoJCS8vCW9iajogT2JqZWN0DQoJCS8vCQl0aGUgb2JqZWN0IHRvICJhcnJheWlmeSIuIFdlIGV4cGVjdCB0aGUgb2JqZWN0IHRvIGhhdmUsIGF0IGENCgkJLy8JCW1pbmltdW0sIGEgbGVuZ3RoIHByb3BlcnR5IHdoaWNoIGNvcnJlc3BvbmRzIHRvIGludGVnZXItaW5kZXhlZA0KCQkvLwkJcHJvcGVydGllcy4NCgkJLy8Jb2Zmc2V0OiBOdW1iZXI/DQoJCS8vCQl0aGUgbG9jYXRpb24gaW4gb2JqIHRvIHN0YXJ0IGl0ZXJhdGluZyBmcm9tLiBEZWZhdWx0cyB0byAwLg0KCQkvLwkJT3B0aW9uYWwuDQoJCS8vCXN0YXJ0V2l0aDogQXJyYXk/DQoJCS8vCQlBbiBhcnJheSB0byBwYWNrIHdpdGggdGhlIHByb3BlcnRpZXMgb2Ygb2JqLiBJZiBwcm92aWRlZCwNCgkJLy8JCXByb3BlcnRpZXMgaW4gb2JqIGFyZSBhcHBlbmRlZCBhdCB0aGUgZW5kIG9mIHN0YXJ0V2l0aCBhbmQNCgkJLy8JCXN0YXJ0V2l0aCBpcyB0aGUgcmV0dXJuZWQgYXJyYXkuDQoJfQ0KCT09PT09Ki8NCg0KCXZhciBlZmZpY2llbnQgPSBmdW5jdGlvbihvYmosIG9mZnNldCwgc3RhcnRXaXRoKXsNCgkJcmV0dXJuIChzdGFydFdpdGh8fFtdKS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwob2JqLCBvZmZzZXR8fDApKTsNCgl9Ow0KDQoJCXZhciBzbG93ID0gZnVuY3Rpb24ob2JqLCBvZmZzZXQsIHN0YXJ0V2l0aCl7DQoJCXZhciBhcnIgPSBzdGFydFdpdGh8fFtdOw0KCQlmb3IodmFyIHggPSBvZmZzZXQgfHwgMDsgeCA8IG9iai5sZW5ndGg7IHgrKyl7DQoJCQlhcnIucHVzaChvYmpbeF0pOw0KCQl9DQoJCXJldHVybiBhcnI7DQoJfTsNCgkNCglkb2pvLl90b0FycmF5ID0NCgkJCQlkLmlzSUUgPyAgZnVuY3Rpb24ob2JqKXsNCgkJCXJldHVybiAoKG9iai5pdGVtKSA/IHNsb3cgOiBlZmZpY2llbnQpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCX0gOg0KCQkJCWVmZmljaWVudDsNCg0KCWRvam8ucGFydGlhbCA9IGZ1bmN0aW9uKC8qRnVuY3Rpb258U3RyaW5nKi9tZXRob2QgLyosIC4uLiovKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXNpbWlsYXIgdG8gaGl0Y2goKSBleGNlcHQgdGhhdCB0aGUgc2NvcGUgb2JqZWN0IGlzIGxlZnQgdG8gYmUNCgkJLy8JCXdoYXRldmVyIHRoZSBleGVjdXRpb24gY29udGV4dCBldmVudHVhbGx5IGJlY29tZXMuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJQ2FsbGluZyBkb2pvLnBhcnRpYWwgaXMgdGhlIGZ1bmN0aW9uYWwgZXF1aXZhbGVudCBvZiBjYWxsaW5nOg0KCQkvLwkJfAlkb2pvLmhpdGNoKG51bGwsIGZ1bmNOYW1lLCAuLi4pOw0KCQl2YXIgYXJyID0gWyBudWxsIF07DQoJCXJldHVybiBkLmhpdGNoLmFwcGx5KGQsIGFyci5jb25jYXQoZC5fdG9BcnJheShhcmd1bWVudHMpKSk7IC8vIEZ1bmN0aW9uDQoJfQ0KDQoJdmFyIGV4dHJhTmFtZXMgPSBkLl9leHRyYU5hbWVzLCBleHRyYUxlbiA9IGV4dHJhTmFtZXMubGVuZ3RoLCBlbXB0eSA9IHt9Ow0KDQoJZG9qby5jbG9uZSA9IGZ1bmN0aW9uKC8qYW55dGhpbmcqLyBvKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUNsb25lcyBvYmplY3RzIChpbmNsdWRpbmcgRE9NIG5vZGVzKSBhbmQgYWxsIGNoaWxkcmVuLg0KCQkvLwkJV2FybmluZzogZG8gbm90IGNsb25lIGN5Y2xpYyBzdHJ1Y3R1cmVzLg0KCQlpZighbyB8fCB0eXBlb2YgbyAhPSAib2JqZWN0IiB8fCBkLmlzRnVuY3Rpb24obykpew0KCQkJLy8gbnVsbCwgdW5kZWZpbmVkLCBhbnkgbm9uLW9iamVjdCwgb3IgZnVuY3Rpb24NCgkJCXJldHVybiBvOwkvLyBhbnl0aGluZw0KCQl9DQoJCWlmKG8ubm9kZVR5cGUgJiYgImNsb25lTm9kZSIgaW4gbyl7DQoJCQkvLyBET00gTm9kZQ0KCQkJcmV0dXJuIG8uY2xvbmVOb2RlKHRydWUpOyAvLyBOb2RlDQoJCX0NCgkJaWYobyBpbnN0YW5jZW9mIERhdGUpew0KCQkJLy8gRGF0ZQ0KCQkJcmV0dXJuIG5ldyBEYXRlKG8uZ2V0VGltZSgpKTsJLy8gRGF0ZQ0KCQl9DQoJCXZhciByLCBpLCBsLCBzLCBuYW1lOw0KCQlpZihkLmlzQXJyYXkobykpew0KCQkJLy8gYXJyYXkNCgkJCXIgPSBbXTsNCgkJCWZvcihpID0gMCwgbCA9IG8ubGVuZ3RoOyBpIDwgbDsgKytpKXsNCgkJCQlpZihpIGluIG8pew0KCQkJCQlyLnB1c2goZC5jbG9uZShvW2ldKSk7DQoJCQkJfQ0KCQkJfQ0KLy8gd2UgZG9uJ3QgY2xvbmUgZnVuY3Rpb25zIGZvciBwZXJmb3JtYW5jZSByZWFzb25zDQovLwkJfWVsc2UgaWYoZC5pc0Z1bmN0aW9uKG8pKXsNCi8vCQkJLy8gZnVuY3Rpb24NCi8vCQkJciA9IGZ1bmN0aW9uKCl7IHJldHVybiBvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07DQoJCX1lbHNlew0KCQkJLy8gZ2VuZXJpYyBvYmplY3RzDQoJCQlyID0gby5jb25zdHJ1Y3RvciA/IG5ldyBvLmNvbnN0cnVjdG9yKCkgOiB7fTsNCgkJfQ0KCQlmb3IobmFtZSBpbiBvKXsNCgkJCS8vIHRoZSAidG9iaiIgY29uZGl0aW9uIGF2b2lkIGNvcHlpbmcgcHJvcGVydGllcyBpbiAic291cmNlIg0KCQkJLy8gaW5oZXJpdGVkIGZyb20gT2JqZWN0LnByb3RvdHlwZS4gIEZvciBleGFtcGxlLCBpZiB0YXJnZXQgaGFzIGEgY3VzdG9tDQoJCQkvLyB0b1N0cmluZygpIG1ldGhvZCwgZG9uJ3Qgb3ZlcndyaXRlIGl0IHdpdGggdGhlIHRvU3RyaW5nKCkgbWV0aG9kDQoJCQkvLyB0aGF0IHNvdXJjZSBpbmhlcml0ZWQgZnJvbSBPYmplY3QucHJvdG90eXBlDQoJCQlzID0gb1tuYW1lXTsNCgkJCWlmKCEobmFtZSBpbiByKSB8fCAocltuYW1lXSAhPT0gcyAmJiAoIShuYW1lIGluIGVtcHR5KSB8fCBlbXB0eVtuYW1lXSAhPT0gcykpKXsNCgkJCQlyW25hbWVdID0gZC5jbG9uZShzKTsNCgkJCX0NCgkJfQ0KCQkJCS8vIElFIGRvZXNuJ3QgcmVjb2duaXplIHNvbWUgY3VzdG9tIGZ1bmN0aW9ucyBpbiBmb3IuLmluDQoJCWlmKGV4dHJhTGVuKXsNCgkJCWZvcihpID0gMDsgaSA8IGV4dHJhTGVuOyArK2kpew0KCQkJCW5hbWUgPSBleHRyYU5hbWVzW2ldOw0KCQkJCXMgPSBvW25hbWVdOw0KCQkJCWlmKCEobmFtZSBpbiByKSB8fCAocltuYW1lXSAhPT0gcyAmJiAoIShuYW1lIGluIGVtcHR5KSB8fCBlbXB0eVtuYW1lXSAhPT0gcykpKXsNCgkJCQkJcltuYW1lXSA9IHM7IC8vIGZ1bmN0aW9ucyBvbmx5LCB3ZSBkb24ndCBjbG9uZSB0aGVtDQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCQkJcmV0dXJuIHI7IC8vIE9iamVjdA0KCX0NCg0KCS8qPT09PT0NCglkb2pvLnRyaW0gPSBmdW5jdGlvbihzdHIpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJVHJpbXMgd2hpdGVzcGFjZSBmcm9tIGJvdGggc2lkZXMgb2YgdGhlIHN0cmluZw0KCQkvLwlzdHI6IFN0cmluZw0KCQkvLwkJU3RyaW5nIHRvIGJlIHRyaW1tZWQNCgkJLy8JcmV0dXJuczogU3RyaW5nDQoJCS8vCQlSZXR1cm5zIHRoZSB0cmltbWVkIHN0cmluZw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgdmVyc2lvbiBvZiB0cmltKCkgd2FzIHNlbGVjdGVkIGZvciBpbmNsdXNpb24gaW50byB0aGUgYmFzZSBkdWUNCgkJLy8JCXRvIGl0cyBjb21wYWN0IHNpemUgYW5kIHJlbGF0aXZlbHkgZ29vZCBwZXJmb3JtYW5jZQ0KCQkvLwkJKHNlZSBbU3RldmVuIExldml0aGFuJ3MgYmxvZ10oaHR0cDovL2Jsb2cuc3RldmVubGV2aXRoYW4uY29tL2FyY2hpdmVzL2Zhc3Rlci10cmltLWphdmFzY3JpcHQpDQoJCS8vCQlVc2VzIFN0cmluZy5wcm90b3R5cGUudHJpbSBpbnN0ZWFkLCBpZiBhdmFpbGFibGUuDQoJCS8vCQlUaGUgZmFzdGVzdCBidXQgbG9uZ2VzdCB2ZXJzaW9uIG9mIHRoaXMgZnVuY3Rpb24gaXMgbG9jYXRlZCBhdA0KCQkvLwkJZG9qby5zdHJpbmcudHJpbSgpDQoJCXJldHVybiAiIjsJLy8gU3RyaW5nDQoJfQ0KCT09PT09Ki8NCg0KCWRvam8udHJpbSA9IFN0cmluZy5wcm90b3R5cGUudHJpbSA/DQoJCWZ1bmN0aW9uKHN0cil7IHJldHVybiBzdHIudHJpbSgpOyB9IDoNCgkJZnVuY3Rpb24oc3RyKXsgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHNccyovLCAnJykucmVwbGFjZSgvXHNccyokLywgJycpOyB9Ow0KDQoJLyo9PT09PQ0KCWRvam8ucmVwbGFjZSA9IGZ1bmN0aW9uKHRtcGwsIG1hcCwgcGF0dGVybil7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlQZXJmb3JtcyBwYXJhbWV0ZXJpemVkIHN1YnN0aXR1dGlvbnMgb24gYSBzdHJpbmcuIFRocm93cyBhbg0KCQkvLwkJZXhjZXB0aW9uIGlmIGFueSBwYXJhbWV0ZXIgaXMgdW5tYXRjaGVkLiANCgkJLy8JdG1wbDogU3RyaW5nDQoJCS8vCQlTdHJpbmcgdG8gYmUgdXNlZCBhcyBhIHRlbXBsYXRlLg0KCQkvLwltYXA6IE9iamVjdHxGdW5jdGlvbg0KCQkvLwkJSWYgYW4gb2JqZWN0LCBpdCBpcyB1c2VkIGFzIGEgZGljdGlvbmFyeSB0byBsb29rIHVwIHN1YnN0aXR1dGlvbnMuDQoJCS8vCQlJZiBhIGZ1bmN0aW9uLCBpdCBpcyBjYWxsZWQgZm9yIGV2ZXJ5IHN1YnN0aXR1dGlvbiB3aXRoIGZvbGxvd2luZw0KCQkvLwkJcGFyYW1ldGVyczogYSB3aG9sZSBtYXRjaCwgYSBuYW1lLCBhbiBvZmZzZXQsIGFuZCB0aGUgd2hvbGUgdGVtcGxhdGUNCgkJLy8JCXN0cmluZyAoc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL1N0cmluZy9yZXBsYWNlDQoJCS8vCQlmb3IgbW9yZSBkZXRhaWxzKS4NCgkJLy8JcGF0dGVybjogUmVnRXg/DQoJCS8vCQlPcHRpb25hbCByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0cyB0aGF0IG92ZXJyaWRlcyB0aGUgZGVmYXVsdCBwYXR0ZXJuLg0KCQkvLwkJTXVzdCBiZSBnbG9iYWwgYW5kIG1hdGNoIG9uZSBpdGVtLiBUaGUgZGVmYXVsdCBpczogL1x7KFteXH1dKylcfS9nLA0KCQkvLwkJd2hpY2ggbWF0Y2hlcyBwYXR0ZXJucyBsaWtlIHRoYXQ6ICJ7eHh4fSIsIHdoZXJlICJ4eHgiIGlzIGFueSBzZXF1ZW5jZQ0KCQkvLwkJb2YgY2hhcmFjdGVycywgd2hpY2ggZG9lc24ndCBpbmNsdWRlICJ9Ii4NCgkJLy8JcmV0dXJuczogU3RyaW5nDQoJCS8vCQlSZXR1cm5zIHRoZSBzdWJzdGl0dXRlZCBzdHJpbmcuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gdXNlcyBhIGRpY3Rpb25hcnkgZm9yIHN1YnN0aXR1dGlvbnM6DQoJCS8vCXwJZG9qby5yZXBsYWNlKCJIZWxsbywge25hbWUuZmlyc3R9IHtuYW1lLmxhc3R9IEFLQSB7bmlja30hIiwNCgkJLy8JfAkgIHsNCgkJLy8JfAkgICAgbmljazogIkJvYiIsDQoJCS8vCXwJICAgIG5hbWU6IHsNCgkJLy8JfAkgICAgICBmaXJzdDogICJSb2JlcnQiLA0KCQkvLwl8CSAgICAgIG1pZGRsZTogIlgiLA0KCQkvLwl8CSAgICAgIGxhc3Q6ICAgIkNyaW5nZWx5Ig0KCQkvLwl8CSAgICB9DQoJCS8vCXwJICB9KTsNCgkJLy8JfAkvLyByZXR1cm5zOiBIZWxsbywgUm9iZXJ0IENyaW5nZWx5IEFLQSBCb2IhDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gdXNlcyBhbiBhcnJheSBmb3Igc3Vic3RpdHV0aW9uczoNCgkJLy8JfAlkb2pvLnJlcGxhY2UoIkhlbGxvLCB7MH0gezJ9ISIsDQoJCS8vCXwJICBbIlJvYmVydCIsICJYIiwgIkNyaW5nZWx5Il0pOw0KCQkvLwl8CS8vIHJldHVybnM6IEhlbGxvLCBSb2JlcnQgQ3JpbmdlbHkhDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gdXNlcyBhIGZ1bmN0aW9uIGZvciBzdWJzdGl0dXRpb25zOg0KCQkvLwl8CWZ1bmN0aW9uIHN1bShhKXsNCgkJLy8JfAkgIHZhciB0ID0gMDsNCgkJLy8JfAkgIGRvam8uZm9yRWFjaChhLCBmdW5jdGlvbih4KXsgdCArPSB4OyB9KTsNCgkJLy8JfAkgIHJldHVybiB0Ow0KCQkvLwl8CX0NCgkJLy8JfAlkb2pvLnJlcGxhY2UoDQoJCS8vCXwJICAie2NvdW50fSBwYXltZW50cyBhdmVyYWdpbmcge2F2Z30gVVNEIHBlciBwYXltZW50LiIsDQoJCS8vCXwJICBkb2pvLmhpdGNoKA0KCQkvLwl8CSAgICB7IHBheW1lbnRzOiBbMTEsIDE2LCAxMl0gfSwNCgkJLy8JfAkgICAgZnVuY3Rpb24oXywga2V5KXsNCgkJLy8JfAkgICAgICBzd2l0Y2goa2V5KXsNCgkJLy8JfAkgICAgICAgIGNhc2UgImNvdW50IjogcmV0dXJuIHRoaXMucGF5bWVudHMubGVuZ3RoOw0KCQkvLwl8CSAgICAgICAgY2FzZSAibWluIjogICByZXR1cm4gTWF0aC5taW4uYXBwbHkoTWF0aCwgdGhpcy5wYXltZW50cyk7DQoJCS8vCXwJICAgICAgICBjYXNlICJtYXgiOiAgIHJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLCB0aGlzLnBheW1lbnRzKTsNCgkJLy8JfAkgICAgICAgIGNhc2UgInN1bSI6ICAgcmV0dXJuIHN1bSh0aGlzLnBheW1lbnRzKTsNCgkJLy8JfAkgICAgICAgIGNhc2UgImF2ZyI6ICAgcmV0dXJuIHN1bSh0aGlzLnBheW1lbnRzKSAvIHRoaXMucGF5bWVudHMubGVuZ3RoOw0KCQkvLwl8CSAgICAgIH0NCgkJLy8JfAkgICAgfQ0KCQkvLwl8CSAgKQ0KCQkvLwl8CSk7DQoJCS8vCXwJLy8gcHJpbnRzOiAzIHBheW1lbnRzIGF2ZXJhZ2luZyAxMyBVU0QgcGVyIHBheW1lbnQuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gdXNlcyBhbiBhbHRlcm5hdGl2ZSBQSFAtbGlrZSBwYXR0ZXJuIGZvciBzdWJzdGl0dXRpb25zOg0KCQkvLwl8CWRvam8ucmVwbGFjZSgiSGVsbG8sICR7MH0gJHsyfSEiLA0KCQkvLwl8CSAgWyJSb2JlcnQiLCAiWCIsICJDcmluZ2VseSJdLCAvXCRceyhbXlx9XSspXH0vZyk7DQoJCS8vCXwJLy8gcmV0dXJuczogSGVsbG8sIFJvYmVydCBDcmluZ2VseSENCgkJcmV0dXJuICIiOwkvLyBTdHJpbmcNCgl9DQoJPT09PT0qLw0KDQoJdmFyIF9wYXR0ZXJuID0gL1x7KFteXH1dKylcfS9nOw0KCWRvam8ucmVwbGFjZSA9IGZ1bmN0aW9uKHRtcGwsIG1hcCwgcGF0dGVybil7DQoJCXJldHVybiB0bXBsLnJlcGxhY2UocGF0dGVybiB8fCBfcGF0dGVybiwgZC5pc0Z1bmN0aW9uKG1hcCkgPw0KCQkJbWFwIDogZnVuY3Rpb24oXywgayl7IHJldHVybiBkLmdldE9iamVjdChrLCBmYWxzZSwgbWFwKTsgfSk7DQoJfTsNCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmFycmF5Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmFycmF5Il0gPSB0cnVlOw0KDQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UuYXJyYXkiKTsNCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIF9nZXRQYXJ0cyA9IGZ1bmN0aW9uKGFyciwgb2JqLCBjYil7DQoJCXJldHVybiBbIA0KCQkJKHR5cGVvZiBhcnIgPT0gInN0cmluZyIpID8gYXJyLnNwbGl0KCIiKSA6IGFyciwgDQoJCQlvYmogfHwgZG9qby5nbG9iYWwsDQoJCQkvLyBGSVhNRTogY2FjaGUgdGhlIGFub255bW91cyBmdW5jdGlvbnMgd2UgY3JlYXRlIGhlcmU/DQoJCQkodHlwZW9mIGNiID09ICJzdHJpbmciKSA/IG5ldyBGdW5jdGlvbigiaXRlbSIsICJpbmRleCIsICJhcnJheSIsIGNiKSA6IGNiDQoJCV07DQoJfTsNCg0KCXZhciBldmVyeU9yU29tZSA9IGZ1bmN0aW9uKC8qQm9vbGVhbiovZXZlcnksIC8qQXJyYXl8U3RyaW5nKi9hcnIsIC8qRnVuY3Rpb258U3RyaW5nKi9jYWxsYmFjaywgLypPYmplY3Q/Ki90aGlzT2JqZWN0KXsNCgkJdmFyIF9wID0gX2dldFBhcnRzKGFyciwgdGhpc09iamVjdCwgY2FsbGJhY2spOyBhcnIgPSBfcFswXTsNCgkJZm9yKHZhciBpPTAsbD1hcnIubGVuZ3RoOyBpPGw7ICsraSl7DQoJCQl2YXIgcmVzdWx0ID0gISFfcFsyXS5jYWxsKF9wWzFdLCBhcnJbaV0sIGksIGFycik7DQoJCQlpZihldmVyeSBeIHJlc3VsdCl7DQoJCQkJcmV0dXJuIHJlc3VsdDsgLy8gQm9vbGVhbg0KCQkJfQ0KCQl9DQoJCXJldHVybiBldmVyeTsgLy8gQm9vbGVhbg0KCX07DQoNCglkb2pvLm1peGluKGRvam8sIHsNCgkJaW5kZXhPZjogZnVuY3Rpb24oCS8qQXJyYXkqLwkJYXJyYXksIA0KCQkJCQkJCS8qT2JqZWN0Ki8JCXZhbHVlLA0KCQkJCQkJCS8qSW50ZWdlcj8qLwlmcm9tSW5kZXgsDQoJCQkJCQkJLypCb29sZWFuPyovCWZpbmRMYXN0KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJbG9jYXRlcyB0aGUgZmlyc3QgaW5kZXggb2YgdGhlIHByb3ZpZGVkIHZhbHVlIGluIHRoZQ0KCQkJLy8JCXBhc3NlZCBhcnJheS4gSWYgdGhlIHZhbHVlIGlzIG5vdCBmb3VuZCwgLTEgaXMgcmV0dXJuZWQuDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGlzIG1ldGhvZCBjb3JyZXNwb25kcyB0byB0aGUgSmF2YVNjcmlwdCAxLjYgQXJyYXkuaW5kZXhPZiBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4NCgkJCS8vCQlydW4gb3ZlciBzcGFyc2UgYXJyYXlzLCB0aGUgRG9qbyBmdW5jdGlvbiBpbnZva2VzIHRoZSBjYWxsYmFjayBmb3IgZXZlcnkgaW5kZXggd2hlcmVhcyBKYXZhU2NyaXB0IA0KCQkJLy8JCTEuNidzIGluZGV4T2Ygc2tpcHMgdGhlIGhvbGVzIGluIHRoZSBzcGFyc2UgYXJyYXkuDQoJCQkvLwkJRm9yIGRldGFpbHMgb24gdGhpcyBtZXRob2QsIHNlZToNCgkJCS8vCQkJaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2UvT2JqZWN0cy9BcnJheS9pbmRleE9mDQoNCgkJCXZhciBzdGVwID0gMSwgZW5kID0gYXJyYXkubGVuZ3RoIHx8IDAsIGkgPSAwOw0KCQkJaWYoZmluZExhc3Qpew0KCQkJCWkgPSBlbmQgLSAxOw0KCQkJCXN0ZXAgPSBlbmQgPSAtMTsNCgkJCX0NCgkJCWlmKGZyb21JbmRleCAhPSB1bmRlZmluZWQpeyBpID0gZnJvbUluZGV4OyB9DQoJCQlpZigoZmluZExhc3QgJiYgaSA+IGVuZCkgfHwgaSA8IGVuZCl7DQoJCQkJZm9yKDsgaSAhPSBlbmQ7IGkgKz0gc3RlcCl7DQoJCQkJCWlmKGFycmF5W2ldID09IHZhbHVlKXsgcmV0dXJuIGk7IH0NCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gLTE7CS8vIE51bWJlcg0KCQl9LA0KDQoJCWxhc3RJbmRleE9mOiBmdW5jdGlvbigvKkFycmF5Ki9hcnJheSwgLypPYmplY3QqL3ZhbHVlLCAvKkludGVnZXI/Ki9mcm9tSW5kZXgpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlsb2NhdGVzIHRoZSBsYXN0IGluZGV4IG9mIHRoZSBwcm92aWRlZCB2YWx1ZSBpbiB0aGUgcGFzc2VkDQoJCQkvLwkJYXJyYXkuIElmIHRoZSB2YWx1ZSBpcyBub3QgZm91bmQsIC0xIGlzIHJldHVybmVkLg0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBtZXRob2QgY29ycmVzcG9uZHMgdG8gdGhlIEphdmFTY3JpcHQgMS42IEFycmF5Lmxhc3RJbmRleE9mIG1ldGhvZCwgd2l0aCBvbmUgZGlmZmVyZW5jZTogd2hlbg0KCQkJLy8JCXJ1biBvdmVyIHNwYXJzZSBhcnJheXMsIHRoZSBEb2pvIGZ1bmN0aW9uIGludm9rZXMgdGhlIGNhbGxiYWNrIGZvciBldmVyeSBpbmRleCB3aGVyZWFzIEphdmFTY3JpcHQgDQoJCQkvLwkJMS42J3MgbGFzdEluZGV4T2Ygc2tpcHMgdGhlIGhvbGVzIGluIHRoZSBzcGFyc2UgYXJyYXkuDQoJCQkvLwkJRm9yIGRldGFpbHMgb24gdGhpcyBtZXRob2QsIHNlZToNCgkJCS8vIAkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvbGFzdEluZGV4T2YNCgkJCXJldHVybiBkb2pvLmluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgsIHRydWUpOyAvLyBOdW1iZXINCgkJfSwNCg0KCQlmb3JFYWNoOiBmdW5jdGlvbigvKkFycmF5fFN0cmluZyovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qT2JqZWN0PyovdGhpc09iamVjdCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWZvciBldmVyeSBpdGVtIGluIGFyciwgY2FsbGJhY2sgaXMgaW52b2tlZC4gUmV0dXJuIHZhbHVlcyBhcmUgaWdub3JlZC4NCgkJCS8vCQlJZiB5b3Ugd2FudCB0byBicmVhayBvdXQgb2YgdGhlIGxvb3AsIGNvbnNpZGVyIHVzaW5nIGRvam8uZXZlcnkoKSBvciBkb2pvLnNvbWUoKS4NCgkJCS8vCQlmb3JFYWNoIGRvZXMgbm90IGFsbG93IGJyZWFraW5nIG91dCBvZiB0aGUgbG9vcCBvdmVyIHRoZSBpdGVtcyBpbiBhcnIuDQoJCQkvLwlhcnI6DQoJCQkvLwkJdGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4gSWYgYSBzdHJpbmcsIG9wZXJhdGVzIG9uIGluZGl2aWR1YWwgY2hhcmFjdGVycy4NCgkJCS8vCWNhbGxiYWNrOg0KCQkJLy8JCWEgZnVuY3Rpb24gaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogaXRlbSwgaW5kZXgsIGFuZCBhcnJheQ0KCQkJLy8JdGhpc09iamVjdDoNCgkJCS8vCQltYXkgYmUgdXNlZCB0byBzY29wZSB0aGUgY2FsbCB0byBjYWxsYmFjaw0KCQkJLy8JZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBmdW5jdGlvbiBjb3JyZXNwb25kcyB0byB0aGUgSmF2YVNjcmlwdCAxLjYgQXJyYXkuZm9yRWFjaCgpIG1ldGhvZCwgd2l0aCBvbmUgZGlmZmVyZW5jZTogd2hlbiANCgkJCS8vCQlydW4gb3ZlciBzcGFyc2UgYXJyYXlzLCB0aGlzIGltcGxlbWVuYXRpb24gcGFzc2VzIHRoZSAiaG9sZXMiIGluIHRoZSBzcGFyc2UgYXJyYXkgdG8NCgkJCS8vCQl0aGUgY2FsbGJhY2sgZnVuY3Rpb24gd2l0aCBhIHZhbHVlIG9mIHVuZGVmaW5lZC4gSmF2YVNjcmlwdCAxLjYncyBmb3JFYWNoIHNraXBzIHRoZSBob2xlcyBpbiB0aGUgc3BhcnNlIGFycmF5Lg0KCQkJLy8JCUZvciBtb3JlIGRldGFpbHMsIHNlZToNCgkJCS8vCQkJaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2UvT2JqZWN0cy9BcnJheS9mb3JFYWNoDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JfAkvLyBsb2cgb3V0IGFsbCBtZW1iZXJzIG9mIHRoZSBhcnJheToNCgkJCS8vCXwJZG9qby5mb3JFYWNoKA0KCQkJLy8JfAkJWyAidGhpbmdlciIsICJibGFoIiwgImhvd2R5IiwgMTAgXSwNCgkJCS8vCXwJCWZ1bmN0aW9uKGl0ZW0pew0KCQkJLy8JfAkJCWNvbnNvbGUubG9nKGl0ZW0pOw0KCQkJLy8JfAkJfQ0KCQkJLy8JfAkpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJLy8gbG9nIG91dCB0aGUgbWVtYmVycyBhbmQgdGhlaXIgaW5kZXhlcw0KCQkJLy8JfAlkb2pvLmZvckVhY2goDQoJCQkvLwl8CQlbICJ0aGluZ2VyIiwgImJsYWgiLCAiaG93ZHkiLCAxMCBdLA0KCQkJLy8JfAkJZnVuY3Rpb24oaXRlbSwgaWR4LCBhcnIpew0KCQkJLy8JfAkJCWNvbnNvbGUubG9nKGl0ZW0sICJhdCBpbmRleDoiLCBpZHgpOw0KCQkJLy8JfAkJfQ0KCQkJLy8JfAkpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCXwJLy8gdXNlIGEgc2NvcGVkIG9iamVjdCBtZW1iZXIgYXMgdGhlIGNhbGxiYWNrDQoJCQkvLwl8CQ0KCQkJLy8JfAl2YXIgb2JqID0gew0KCQkJLy8JfAkJcHJlZml4OiAibG9nZ2VkIHZpYSBvYmouY2FsbGJhY2s6IiwgDQoJCQkvLwl8CQljYWxsYmFjazogZnVuY3Rpb24oaXRlbSl7DQoJCQkvLwl8CQkJY29uc29sZS5sb2codGhpcy5wcmVmaXgsIGl0ZW0pOw0KCQkJLy8JfAkJfQ0KCQkJLy8JfAl9Ow0KCQkJLy8JfAkNCgkJCS8vCXwJLy8gc3BlY2lmeWluZyB0aGUgc2NvcGUgZnVuY3Rpb24gZXhlY3V0ZXMgdGhlIGNhbGxiYWNrIGluIHRoYXQgc2NvcGUNCgkJCS8vCXwJZG9qby5mb3JFYWNoKA0KCQkJLy8JfAkJWyAidGhpbmdlciIsICJibGFoIiwgImhvd2R5IiwgMTAgXSwNCgkJCS8vCXwJCW9iai5jYWxsYmFjaywNCgkJCS8vCXwJCW9iag0KCQkJLy8JfAkpOw0KCQkJLy8JfAkNCgkJCS8vCXwJLy8gYWx0ZXJuYXRlbHksIHdlIGNhbiBhY2NvbXBsaXNoIHRoZSBzYW1lIHRoaW5nIHdpdGggZG9qby5oaXRjaCgpDQoJCQkvLwl8CWRvam8uZm9yRWFjaCgNCgkJCS8vCXwJCVsgInRoaW5nZXIiLCAiYmxhaCIsICJob3dkeSIsIDEwIF0sDQoJCQkvLwl8CQlkb2pvLmhpdGNoKG9iaiwgImNhbGxiYWNrIikNCgkJCS8vCXwJKTsNCg0KCQkJLy8gbWF0Y2ggdGhlIGJlaGF2aW9yIG9mIHRoZSBidWlsdC1pbiBmb3JFYWNoIFdSVCBlbXB0eSBhcnJzDQoJCQlpZighYXJyIHx8ICFhcnIubGVuZ3RoKXsgcmV0dXJuOyB9DQoNCgkJCS8vIEZJWE1FOiB0aGVyZSBhcmUgc2V2ZXJhbCB3YXlzIG9mIGhhbmRpbG5nIHRoaXNPYmplY3QuIElzDQoJCQkvLyBkb2pvLmdsb2JhbCBhbHdheXMgdGhlIGRlZmF1bHQgY29udGV4dD8NCgkJCXZhciBfcCA9IF9nZXRQYXJ0cyhhcnIsIHRoaXNPYmplY3QsIGNhbGxiYWNrKTsgYXJyID0gX3BbMF07DQoJCQlmb3IodmFyIGk9MCxsPWFyci5sZW5ndGg7IGk8bDsgKytpKXsgDQoJCQkJX3BbMl0uY2FsbChfcFsxXSwgYXJyW2ldLCBpLCBhcnIpOw0KCQkJfQ0KCQl9LA0KDQoJCWV2ZXJ5OiBmdW5jdGlvbigvKkFycmF5fFN0cmluZyovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qT2JqZWN0PyovdGhpc09iamVjdCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCURldGVybWluZXMgd2hldGhlciBvciBub3QgZXZlcnkgaXRlbSBpbiBhcnIgc2F0aXNmaWVzIHRoZQ0KCQkJLy8JCWNvbmRpdGlvbiBpbXBsZW1lbnRlZCBieSBjYWxsYmFjay4NCgkJCS8vIGFycjoNCgkJCS8vCQl0aGUgYXJyYXkgdG8gaXRlcmF0ZSBvbi4gSWYgYSBzdHJpbmcsIG9wZXJhdGVzIG9uIGluZGl2aWR1YWwgY2hhcmFjdGVycy4NCgkJCS8vIGNhbGxiYWNrOg0KCQkJLy8JCWEgZnVuY3Rpb24gaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogaXRlbSwgaW5kZXgsDQoJCQkvLwkJYW5kIGFycmF5IGFuZCByZXR1cm5zIHRydWUgaWYgdGhlIGNvbmRpdGlvbiBpcyBtZXQuDQoJCQkvLyB0aGlzT2JqZWN0Og0KCQkJLy8JCW1heSBiZSB1c2VkIHRvIHNjb3BlIHRoZSBjYWxsIHRvIGNhbGxiYWNrDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGlzIGZ1bmN0aW9uIGNvcnJlc3BvbmRzIHRvIHRoZSBKYXZhU2NyaXB0IDEuNiBBcnJheS5ldmVyeSgpIG1ldGhvZCwgd2l0aCBvbmUgZGlmZmVyZW5jZTogd2hlbiANCgkJCS8vCQlydW4gb3ZlciBzcGFyc2UgYXJyYXlzLCB0aGlzIGltcGxlbWVuYXRpb24gcGFzc2VzIHRoZSAiaG9sZXMiIGluIHRoZSBzcGFyc2UgYXJyYXkgdG8NCgkJCS8vCQl0aGUgY2FsbGJhY2sgZnVuY3Rpb24gd2l0aCBhIHZhbHVlIG9mIHVuZGVmaW5lZC4gSmF2YVNjcmlwdCAxLjYncyBldmVyeSBza2lwcyB0aGUgaG9sZXMgaW4gdGhlIHNwYXJzZSBhcnJheS4NCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzLCBzZWU6DQoJCQkvLwkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvZXZlcnkNCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CS8vIHJldHVybnMgZmFsc2UNCgkJCS8vCXwJZG9qby5ldmVyeShbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbT4xOyB9KTsNCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CS8vIHJldHVybnMgdHJ1ZSANCgkJCS8vCXwJZG9qby5ldmVyeShbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbT4wOyB9KTsNCgkJCXJldHVybiBldmVyeU9yU29tZSh0cnVlLCBhcnIsIGNhbGxiYWNrLCB0aGlzT2JqZWN0KTsgLy8gQm9vbGVhbg0KCQl9LA0KDQoJCXNvbWU6IGZ1bmN0aW9uKC8qQXJyYXl8U3RyaW5nKi9hcnIsIC8qRnVuY3Rpb258U3RyaW5nKi9jYWxsYmFjaywgLypPYmplY3Q/Ki90aGlzT2JqZWN0KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJRGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCBhbnkgaXRlbSBpbiBhcnIgc2F0aXNmaWVzIHRoZQ0KCQkJLy8JCWNvbmRpdGlvbiBpbXBsZW1lbnRlZCBieSBjYWxsYmFjay4NCgkJCS8vIGFycjoNCgkJCS8vCQl0aGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLiBJZiBhIHN0cmluZywgb3BlcmF0ZXMgb24gaW5kaXZpZHVhbCBjaGFyYWN0ZXJzLg0KCQkJLy8gY2FsbGJhY2s6DQoJCQkvLwkJYSBmdW5jdGlvbiBpcyBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiBpdGVtLCBpbmRleCwNCgkJCS8vCQlhbmQgYXJyYXkgYW5kIHJldHVybnMgdHJ1ZSBpZiB0aGUgY29uZGl0aW9uIGlzIG1ldC4NCgkJCS8vIHRoaXNPYmplY3Q6DQoJCQkvLwkJbWF5IGJlIHVzZWQgdG8gc2NvcGUgdGhlIGNhbGwgdG8gY2FsbGJhY2sNCgkJCS8vIGRlc2NyaXB0aW9uOg0KCQkJLy8JCVRoaXMgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gdGhlIEphdmFTY3JpcHQgMS42IEFycmF5LnNvbWUoKSBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4gDQoJCQkvLwkJcnVuIG92ZXIgc3BhcnNlIGFycmF5cywgdGhpcyBpbXBsZW1lbmF0aW9uIHBhc3NlcyB0aGUgImhvbGVzIiBpbiB0aGUgc3BhcnNlIGFycmF5IHRvDQoJCQkvLwkJdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpdGggYSB2YWx1ZSBvZiB1bmRlZmluZWQuIEphdmFTY3JpcHQgMS42J3Mgc29tZSBza2lwcyB0aGUgaG9sZXMgaW4gdGhlIHNwYXJzZSBhcnJheS4NCgkJCS8vCQlGb3IgbW9yZSBkZXRhaWxzLCBzZWU6DQoJCQkvLwkJCWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlL09iamVjdHMvQXJyYXkvc29tZQ0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJLy8gaXMgdHJ1ZQ0KCQkJLy8JfAlkb2pvLnNvbWUoWzEsIDIsIDMsIDRdLCBmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0+MTsgfSk7DQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAkvLyBpcyBmYWxzZQ0KCQkJLy8JfAlkb2pvLnNvbWUoWzEsIDIsIDMsIDRdLCBmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW08MTsgfSk7DQoJCQlyZXR1cm4gZXZlcnlPclNvbWUoZmFsc2UsIGFyciwgY2FsbGJhY2ssIHRoaXNPYmplY3QpOyAvLyBCb29sZWFuDQoJCX0sDQoNCgkJbWFwOiBmdW5jdGlvbigvKkFycmF5fFN0cmluZyovYXJyLCAvKkZ1bmN0aW9ufFN0cmluZyovY2FsbGJhY2ssIC8qRnVuY3Rpb24/Ki90aGlzT2JqZWN0KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJYXBwbGllcyBjYWxsYmFjayB0byBlYWNoIGVsZW1lbnQgb2YgYXJyIGFuZCByZXR1cm5zDQoJCQkvLwkJYW4gQXJyYXkgd2l0aCB0aGUgcmVzdWx0cw0KCQkJLy8gYXJyOg0KCQkJLy8JCXRoZSBhcnJheSB0byBpdGVyYXRlIG9uLiBJZiBhIHN0cmluZywgb3BlcmF0ZXMgb24NCgkJCS8vCQlpbmRpdmlkdWFsIGNoYXJhY3RlcnMuDQoJCQkvLyBjYWxsYmFjazoNCgkJCS8vCQlhIGZ1bmN0aW9uIGlzIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHMsIChpdGVtLCBpbmRleCwNCgkJCS8vCQlhcnJheSksICBhbmQgcmV0dXJucyBhIHZhbHVlDQoJCQkvLyB0aGlzT2JqZWN0Og0KCQkJLy8JCW1heSBiZSB1c2VkIHRvIHNjb3BlIHRoZSBjYWxsIHRvIGNhbGxiYWNrDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGlzIGZ1bmN0aW9uIGNvcnJlc3BvbmRzIHRvIHRoZSBKYXZhU2NyaXB0IDEuNiBBcnJheS5tYXAoKSBtZXRob2QsIHdpdGggb25lIGRpZmZlcmVuY2U6IHdoZW4gDQoJCQkvLwkJcnVuIG92ZXIgc3BhcnNlIGFycmF5cywgdGhpcyBpbXBsZW1lbmF0aW9uIHBhc3NlcyB0aGUgImhvbGVzIiBpbiB0aGUgc3BhcnNlIGFycmF5IHRvDQoJCQkvLwkJdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpdGggYSB2YWx1ZSBvZiB1bmRlZmluZWQuIEphdmFTY3JpcHQgMS42J3MgbWFwIHNraXBzIHRoZSBob2xlcyBpbiB0aGUgc3BhcnNlIGFycmF5Lg0KCQkJLy8JCUZvciBtb3JlIGRldGFpbHMsIHNlZToNCgkJCS8vCQkJaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2UvT2JqZWN0cy9BcnJheS9tYXANCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CS8vIHJldHVybnMgWzIsIDMsIDQsIDVdDQoJCQkvLwl8CWRvam8ubWFwKFsxLCAyLCAzLCA0XSwgZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtKzEgfSk7DQoNCgkJCXZhciBfcCA9IF9nZXRQYXJ0cyhhcnIsIHRoaXNPYmplY3QsIGNhbGxiYWNrKTsgYXJyID0gX3BbMF07DQoJCQl2YXIgb3V0QXJyID0gKGFyZ3VtZW50c1szXSA/IChuZXcgYXJndW1lbnRzWzNdKCkpIDogW10pOw0KCQkJZm9yKHZhciBpPTAsbD1hcnIubGVuZ3RoOyBpPGw7ICsraSl7DQoJCQkJb3V0QXJyLnB1c2goX3BbMl0uY2FsbChfcFsxXSwgYXJyW2ldLCBpLCBhcnIpKTsNCgkJCX0NCgkJCXJldHVybiBvdXRBcnI7IC8vIEFycmF5DQoJCX0sDQoNCgkJZmlsdGVyOiBmdW5jdGlvbigvKkFycmF5Ki9hcnIsIC8qRnVuY3Rpb258U3RyaW5nKi9jYWxsYmFjaywgLypPYmplY3Q/Ki90aGlzT2JqZWN0KXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIG5ldyBBcnJheSB3aXRoIHRob3NlIGl0ZW1zIGZyb20gYXJyIHRoYXQgbWF0Y2ggdGhlDQoJCQkvLwkJY29uZGl0aW9uIGltcGxlbWVudGVkIGJ5IGNhbGxiYWNrLg0KCQkJLy8gYXJyOg0KCQkJLy8JCXRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuDQoJCQkvLyBjYWxsYmFjazoNCgkJCS8vCQlhIGZ1bmN0aW9uIHRoYXQgaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50cyAoaXRlbSwNCgkJCS8vCQlpbmRleCwgYXJyYXkpLiBUaGUgcmV0dXJuIG9mIHRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8NCgkJCS8vCQliZSBhIGJvb2xlYW4gd2hpY2ggZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwYXNzZWQtaW4gaXRlbQ0KCQkJLy8JCXdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHJldHVybmVkIGFycmF5Lg0KCQkJLy8gdGhpc09iamVjdDoNCgkJCS8vCQltYXkgYmUgdXNlZCB0byBzY29wZSB0aGUgY2FsbCB0byBjYWxsYmFjaw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBmdW5jdGlvbiBjb3JyZXNwb25kcyB0byB0aGUgSmF2YVNjcmlwdCAxLjYgQXJyYXkuZmlsdGVyKCkgbWV0aG9kLCB3aXRoIG9uZSBkaWZmZXJlbmNlOiB3aGVuIA0KCQkJLy8JCXJ1biBvdmVyIHNwYXJzZSBhcnJheXMsIHRoaXMgaW1wbGVtZW5hdGlvbiBwYXNzZXMgdGhlICJob2xlcyIgaW4gdGhlIHNwYXJzZSBhcnJheSB0bw0KCQkJLy8JCXRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIGEgdmFsdWUgb2YgdW5kZWZpbmVkLiBKYXZhU2NyaXB0IDEuNidzIGZpbHRlciBza2lwcyB0aGUgaG9sZXMgaW4gdGhlIHNwYXJzZSBhcnJheS4gDQoJCQkvLwkJRm9yIG1vcmUgZGV0YWlscywgc2VlOg0KCQkJLy8JCQlodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZS9PYmplY3RzL0FycmF5L2ZpbHRlcg0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJLy8gcmV0dXJucyBbMiwgMywgNF0NCgkJCS8vCXwJZG9qby5maWx0ZXIoWzEsIDIsIDMsIDRdLCBmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0+MTsgfSk7DQoNCgkJCXZhciBfcCA9IF9nZXRQYXJ0cyhhcnIsIHRoaXNPYmplY3QsIGNhbGxiYWNrKTsgYXJyID0gX3BbMF07DQoJCQl2YXIgb3V0QXJyID0gW107DQoJCQlmb3IodmFyIGk9MCxsPWFyci5sZW5ndGg7IGk8bDsgKytpKXsNCgkJCQlpZihfcFsyXS5jYWxsKF9wWzFdLCBhcnJbaV0sIGksIGFycikpew0KCQkJCQlvdXRBcnIucHVzaChhcnJbaV0pOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBvdXRBcnI7IC8vIEFycmF5DQoJCX0NCgl9KTsNCn0pKCk7DQovKg0KKi8NCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuZGVjbGFyZSJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5kZWNsYXJlIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmRlY2xhcmUiKTsNCg0KDQoNCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIGQgPSBkb2pvLCBtaXggPSBkLl9taXhpbiwgb3AgPSBPYmplY3QucHJvdG90eXBlLCBvcHRzID0gb3AudG9TdHJpbmcsDQoJCXh0b3IgPSBuZXcgRnVuY3Rpb24sIGNvdW50ZXIgPSAwLCBjbmFtZSA9ICJjb25zdHJ1Y3RvciI7DQoNCglmdW5jdGlvbiBlcnIobXNnKXsgdGhyb3cgbmV3IEVycm9yKCJkZWNsYXJlOiAiICsgbXNnKTsgfQ0KDQoJLy8gQzMgTWV0aG9kIFJlc29sdXRpb24gT3JkZXIgKHNlZSBodHRwOi8vd3d3LnB5dGhvbi5vcmcvZG93bmxvYWQvcmVsZWFzZXMvMi4zL21yby8pDQoJZnVuY3Rpb24gYzNtcm8oYmFzZXMpew0KCQl2YXIgcmVzdWx0ID0gW10sIHJvb3RzID0gW3tjbHM6IDAsIHJlZnM6IFtdfV0sIG5hbWVNYXAgPSB7fSwgY2xzQ291bnQgPSAxLA0KCQkJbCA9IGJhc2VzLmxlbmd0aCwgaSA9IDAsIGosIGxpbiwgYmFzZSwgdG9wLCBwcm90bywgcmVjLCBuYW1lLCByZWZzOw0KDQoJCS8vIGJ1aWxkIGEgbGlzdCBvZiBiYXNlcyBuYW1pbmcgdGhlbSBpZiBuZWVkZWQNCgkJZm9yKDsgaSA8IGw7ICsraSl7DQoJCQliYXNlID0gYmFzZXNbaV07DQoJCQlpZighYmFzZSl7DQoJCQkJZXJyKCJtaXhpbiAjIiArIGkgKyAiIGlzIHVua25vd24uIERpZCB5b3UgdXNlIGRvam8ucmVxdWlyZSB0byBwdWxsIGl0IGluPyIpOw0KCQkJfWVsc2UgaWYob3B0cy5jYWxsKGJhc2UpICE9ICJbb2JqZWN0IEZ1bmN0aW9uXSIpew0KCQkJCWVycigibWl4aW4gIyIgKyBpICsgIiBpcyBub3QgYSBjYWxsYWJsZSBjb25zdHJ1Y3Rvci4iKTsNCgkJCX0NCgkJCWxpbiA9IGJhc2UuX21ldGEgPyBiYXNlLl9tZXRhLmJhc2VzIDogW2Jhc2VdOw0KCQkJdG9wID0gMDsNCgkJCS8vIGFkZCBiYXNlcyB0byB0aGUgbmFtZSBtYXANCgkJCWZvcihqID0gbGluLmxlbmd0aCAtIDE7IGogPj0gMDsgLS1qKXsNCgkJCQlwcm90byA9IGxpbltqXS5wcm90b3R5cGU7DQoJCQkJaWYoIXByb3RvLmhhc093blByb3BlcnR5KCJkZWNsYXJlZENsYXNzIikpew0KCQkJCQlwcm90by5kZWNsYXJlZENsYXNzID0gInVuaXFOYW1lXyIgKyAoY291bnRlcisrKTsNCgkJCQl9DQoJCQkJbmFtZSA9IHByb3RvLmRlY2xhcmVkQ2xhc3M7DQoJCQkJaWYoIW5hbWVNYXAuaGFzT3duUHJvcGVydHkobmFtZSkpew0KCQkJCQluYW1lTWFwW25hbWVdID0ge2NvdW50OiAwLCByZWZzOiBbXSwgY2xzOiBsaW5bal19Ow0KCQkJCQkrK2Nsc0NvdW50Ow0KCQkJCX0NCgkJCQlyZWMgPSBuYW1lTWFwW25hbWVdOw0KCQkJCWlmKHRvcCAmJiB0b3AgIT09IHJlYyl7DQoJCQkJCXJlYy5yZWZzLnB1c2godG9wKTsNCgkJCQkJKyt0b3AuY291bnQ7DQoJCQkJfQ0KCQkJCXRvcCA9IHJlYzsNCgkJCX0NCgkJCSsrdG9wLmNvdW50Ow0KCQkJcm9vdHNbMF0ucmVmcy5wdXNoKHRvcCk7DQoJCX0NCg0KCQkvLyByZW1vdmUgY2xhc3NlcyB3aXRob3V0IGV4dGVybmFsIHJlZmVyZW5jZXMgcmVjdXJzaXZlbHkNCgkJd2hpbGUocm9vdHMubGVuZ3RoKXsNCgkJCXRvcCA9IHJvb3RzLnBvcCgpOw0KCQkJcmVzdWx0LnB1c2godG9wLmNscyk7DQoJCQktLWNsc0NvdW50Ow0KCQkJLy8gb3B0aW1pemF0aW9uOiBmb2xsb3cgYSBzaW5nbGUtbGlua2VkIGNoYWluDQoJCQl3aGlsZShyZWZzID0gdG9wLnJlZnMsIHJlZnMubGVuZ3RoID09IDEpew0KCQkJCXRvcCA9IHJlZnNbMF07DQoJCQkJaWYoIXRvcCB8fCAtLXRvcC5jb3VudCl7DQoJCQkJCS8vIGJyYW5jaCBvciBlbmQgb2YgY2hhaW4gPT4gZG8gbm90IGVuZCB0byByb290cw0KCQkJCQl0b3AgPSAwOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJcmVzdWx0LnB1c2godG9wLmNscyk7DQoJCQkJLS1jbHNDb3VudDsNCgkJCX0NCgkJCWlmKHRvcCl7DQoJCQkJLy8gYnJhbmNoDQoJCQkJZm9yKGkgPSAwLCBsID0gcmVmcy5sZW5ndGg7IGkgPCBsOyArK2kpew0KCQkJCQl0b3AgPSByZWZzW2ldOw0KCQkJCQlpZighLS10b3AuY291bnQpew0KCQkJCQkJcm9vdHMucHVzaCh0b3ApOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCWlmKGNsc0NvdW50KXsNCgkJCWVycigiY2FuJ3QgYnVpbGQgY29uc2lzdGVudCBsaW5lYXJpemF0aW9uIik7DQoJCX0NCg0KCQkvLyBjYWxjdWxhdGUgdGhlIHN1cGVyY2xhc3Mgb2Zmc2V0DQoJCWJhc2UgPSBiYXNlc1swXTsNCgkJcmVzdWx0WzBdID0gYmFzZSA/DQoJCQliYXNlLl9tZXRhICYmIGJhc2UgPT09IHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gYmFzZS5fbWV0YS5iYXNlcy5sZW5ndGhdID8NCgkJCQliYXNlLl9tZXRhLmJhc2VzLmxlbmd0aCA6IDEgOiAwOw0KDQoJCXJldHVybiByZXN1bHQ7DQoJfQ0KDQoJZnVuY3Rpb24gaW5oZXJpdGVkKGFyZ3MsIGEsIGYpew0KCQl2YXIgbmFtZSwgY2hhaW5zLCBiYXNlcywgY2FsbGVyLCBtZXRhLCBiYXNlLCBwcm90bywgb3BmLCBwb3MsDQoJCQljYWNoZSA9IHRoaXMuX2luaGVyaXRlZCA9IHRoaXMuX2luaGVyaXRlZCB8fCB7fTsNCg0KCQkvLyBjcmFjayBhcmd1bWVudHMNCgkJaWYodHlwZW9mIGFyZ3MgPT0gInN0cmluZyIpew0KCQkJbmFtZSA9IGFyZ3M7DQoJCQlhcmdzID0gYTsNCgkJCWEgPSBmOw0KCQl9DQoJCWYgPSAwOw0KDQoJCWNhbGxlciA9IGFyZ3MuY2FsbGVlOw0KCQluYW1lID0gbmFtZSB8fCBjYWxsZXIubm9tOw0KCQlpZighbmFtZSl7DQoJCQllcnIoImNhbid0IGRlZHVjZSBhIG5hbWUgdG8gY2FsbCBpbmhlcml0ZWQoKSIpOw0KCQl9DQoNCgkJbWV0YSA9IHRoaXMuY29uc3RydWN0b3IuX21ldGE7DQoJCWJhc2VzID0gbWV0YS5iYXNlczsNCg0KCQlwb3MgPSBjYWNoZS5wOw0KCQlpZihuYW1lICE9IGNuYW1lKXsNCgkJCS8vIG1ldGhvZA0KCQkJaWYoY2FjaGUuYyAhPT0gY2FsbGVyKXsNCgkJCQkvLyBjYWNoZSBidXN0DQoJCQkJcG9zID0gMDsNCgkJCQliYXNlID0gYmFzZXNbMF07DQoJCQkJbWV0YSA9IGJhc2UuX21ldGE7DQoJCQkJaWYobWV0YS5oaWRkZW5bbmFtZV0gIT09IGNhbGxlcil7DQoJCQkJCS8vIGVycm9yIGRldGVjdGlvbg0KCQkJCQljaGFpbnMgPSBtZXRhLmNoYWluczsNCgkJCQkJaWYoY2hhaW5zICYmIHR5cGVvZiBjaGFpbnNbbmFtZV0gPT0gInN0cmluZyIpew0KCQkJCQkJZXJyKCJjYWxsaW5nIGNoYWluZWQgbWV0aG9kIHdpdGggaW5oZXJpdGVkOiAiICsgbmFtZSk7DQoJCQkJCX0NCgkJCQkJLy8gZmluZCBjYWxsZXINCgkJCQkJZG97DQoJCQkJCQltZXRhID0gYmFzZS5fbWV0YTsNCgkJCQkJCXByb3RvID0gYmFzZS5wcm90b3R5cGU7DQoJCQkJCQlpZihtZXRhICYmIChwcm90b1tuYW1lXSA9PT0gY2FsbGVyICYmIHByb3RvLmhhc093blByb3BlcnR5KG5hbWUpIHx8IG1ldGEuaGlkZGVuW25hbWVdID09PSBjYWxsZXIpKXsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJfXdoaWxlKGJhc2UgPSBiYXNlc1srK3Bvc10pOyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJCXBvcyA9IGJhc2UgPyBwb3MgOiAtMTsNCgkJCQl9DQoJCQl9DQoJCQkvLyBmaW5kIG5leHQNCgkJCWJhc2UgPSBiYXNlc1srK3Bvc107DQoJCQlpZihiYXNlKXsNCgkJCQlwcm90byA9IGJhc2UucHJvdG90eXBlOw0KCQkJCWlmKGJhc2UuX21ldGEgJiYgcHJvdG8uaGFzT3duUHJvcGVydHkobmFtZSkpew0KCQkJCQlmID0gcHJvdG9bbmFtZV07DQoJCQkJfWVsc2V7DQoJCQkJCW9wZiA9IG9wW25hbWVdOw0KCQkJCQlkb3sNCgkJCQkJCXByb3RvID0gYmFzZS5wcm90b3R5cGU7DQoJCQkJCQlmID0gcHJvdG9bbmFtZV07DQoJCQkJCQlpZihmICYmIChiYXNlLl9tZXRhID8gcHJvdG8uaGFzT3duUHJvcGVydHkobmFtZSkgOiBmICE9PSBvcGYpKXsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJfXdoaWxlKGJhc2UgPSBiYXNlc1srK3Bvc10pOyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQkJfQ0KCQkJfQ0KCQkJZiA9IGJhc2UgJiYgZiB8fCBvcFtuYW1lXTsNCgkJfWVsc2V7DQoJCQkvLyBjb25zdHJ1Y3Rvcg0KCQkJaWYoY2FjaGUuYyAhPT0gY2FsbGVyKXsNCgkJCQkvLyBjYWNoZSBidXN0DQoJCQkJcG9zID0gMDsNCgkJCQltZXRhID0gYmFzZXNbMF0uX21ldGE7DQoJCQkJaWYobWV0YSAmJiBtZXRhLmN0b3IgIT09IGNhbGxlcil7DQoJCQkJCS8vIGVycm9yIGRldGVjdGlvbg0KCQkJCQljaGFpbnMgPSBtZXRhLmNoYWluczsNCgkJCQkJaWYoIWNoYWlucyB8fCBjaGFpbnMuY29uc3RydWN0b3IgIT09ICJtYW51YWwiKXsNCgkJCQkJCWVycigiY2FsbGluZyBjaGFpbmVkIGNvbnN0cnVjdG9yIHdpdGggaW5oZXJpdGVkIik7DQoJCQkJCX0NCgkJCQkJLy8gZmluZCBjYWxsZXINCgkJCQkJd2hpbGUoYmFzZSA9IGJhc2VzWysrcG9zXSl7IC8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCQkJCW1ldGEgPSBiYXNlLl9tZXRhOw0KCQkJCQkJaWYobWV0YSAmJiBtZXRhLmN0b3IgPT09IGNhbGxlcil7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcG9zID0gYmFzZSA/IHBvcyA6IC0xOw0KCQkJCX0NCgkJCX0NCgkJCS8vIGZpbmQgbmV4dA0KCQkJd2hpbGUoYmFzZSA9IGJhc2VzWysrcG9zXSl7CS8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCQltZXRhID0gYmFzZS5fbWV0YTsNCgkJCQlmID0gbWV0YSA/IG1ldGEuY3RvciA6IGJhc2U7DQoJCQkJaWYoZil7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCgkJCWYgPSBiYXNlICYmIGY7DQoJCX0NCg0KCQkvLyBjYWNoZSB0aGUgZm91bmQgc3VwZXIgbWV0aG9kDQoJCWNhY2hlLmMgPSBmOw0KCQljYWNoZS5wID0gcG9zOw0KDQoJCS8vIG5vdyB3ZSBoYXZlIHRoZSByZXN1bHQNCgkJaWYoZil7DQoJCQlyZXR1cm4gYSA9PT0gdHJ1ZSA/IGYgOiBmLmFwcGx5KHRoaXMsIGEgfHwgYXJncyk7DQoJCX0NCgkJLy8gaW50ZW50aW9uYWxseSBpZiBhIHN1cGVyIG1ldGhvZCB3YXMgbm90IGZvdW5kDQoJfQ0KDQoJZnVuY3Rpb24gZ2V0SW5oZXJpdGVkKG5hbWUsIGFyZ3Mpew0KCQlpZih0eXBlb2YgbmFtZSA9PSAic3RyaW5nIil7DQoJCQlyZXR1cm4gdGhpcy5pbmhlcml0ZWQobmFtZSwgYXJncywgdHJ1ZSk7DQoJCX0NCgkJcmV0dXJuIHRoaXMuaW5oZXJpdGVkKG5hbWUsIHRydWUpOw0KCX0NCg0KCS8vIGVtdWxhdGlvbiBvZiAiaW5zdGFuY2VvZiINCglmdW5jdGlvbiBpc0luc3RhbmNlT2YoY2xzKXsNCgkJdmFyIGJhc2VzID0gdGhpcy5jb25zdHJ1Y3Rvci5fbWV0YS5iYXNlczsNCgkJZm9yKHZhciBpID0gMCwgbCA9IGJhc2VzLmxlbmd0aDsgaSA8IGw7ICsraSl7DQoJCQlpZihiYXNlc1tpXSA9PT0gY2xzKXsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gdGhpcyBpbnN0YW5jZW9mIGNsczsNCgl9DQoNCglmdW5jdGlvbiBtaXhPd24odGFyZ2V0LCBzb3VyY2Upew0KCQl2YXIgbmFtZSwgaSA9IDAsIGwgPSBkLl9leHRyYU5hbWVzLmxlbmd0aDsNCgkJLy8gYWRkIHByb3BzIGFkZGluZyBtZXRhZGF0YSBmb3IgaW5jb21pbmcgZnVuY3Rpb25zIHNraXBwaW5nIGEgY29uc3RydWN0b3INCgkJZm9yKG5hbWUgaW4gc291cmNlKXsNCgkJCWlmKG5hbWUgIT0gY25hbWUgJiYgc291cmNlLmhhc093blByb3BlcnR5KG5hbWUpKXsNCgkJCQl0YXJnZXRbbmFtZV0gPSBzb3VyY2VbbmFtZV07DQoJCQl9DQoJCX0NCgkJLy8gcHJvY2VzcyB1bmVudW1lcmFibGUgbWV0aG9kcyBvbiBJRQ0KCQlmb3IoOyBpIDwgbDsgKytpKXsNCgkJCW5hbWUgPSBkLl9leHRyYU5hbWVzW2ldOw0KCQkJaWYobmFtZSAhPSBjbmFtZSAmJiBzb3VyY2UuaGFzT3duUHJvcGVydHkobmFtZSkpew0KCQkJCXRhcmdldFtuYW1lXSA9IHNvdXJjZVtuYW1lXTsNCgkJCX0NCgkJfQ0KCX0NCg0KCS8vIGltcGxlbWVudGF0aW9uIG9mIHNhZmUgbWl4aW4gZnVuY3Rpb24NCglmdW5jdGlvbiBzYWZlTWl4aW4odGFyZ2V0LCBzb3VyY2Upew0KCQl2YXIgbmFtZSwgdCwgaSA9IDAsIGwgPSBkLl9leHRyYU5hbWVzLmxlbmd0aDsNCgkJLy8gYWRkIHByb3BzIGFkZGluZyBtZXRhZGF0YSBmb3IgaW5jb21pbmcgZnVuY3Rpb25zIHNraXBwaW5nIGEgY29uc3RydWN0b3INCgkJZm9yKG5hbWUgaW4gc291cmNlKXsNCgkJCXQgPSBzb3VyY2VbbmFtZV07DQoJCQlpZigodCAhPT0gb3BbbmFtZV0gfHwgIShuYW1lIGluIG9wKSkgJiYgbmFtZSAhPSBjbmFtZSl7DQoJCQkJaWYob3B0cy5jYWxsKHQpID09ICJbb2JqZWN0IEZ1bmN0aW9uXSIpew0KCQkJCQkvLyBub24tdHJpdmlhbCBmdW5jdGlvbiBtZXRob2QgPT4gYXR0YWNoIGl0cyBuYW1lDQoJCQkJCXQubm9tID0gbmFtZTsNCgkJCQl9DQoJCQkJdGFyZ2V0W25hbWVdID0gdDsNCgkJCX0NCgkJfQ0KCQkvLyBwcm9jZXNzIHVuZW51bWVyYWJsZSBtZXRob2RzIG9uIElFDQoJCWZvcig7IGkgPCBsOyArK2kpew0KCQkJbmFtZSA9IGQuX2V4dHJhTmFtZXNbaV07DQoJCQl0ID0gc291cmNlW25hbWVdOw0KCQkJaWYoKHQgIT09IG9wW25hbWVdIHx8ICEobmFtZSBpbiBvcCkpICYmIG5hbWUgIT0gY25hbWUpew0KCQkJCWlmKG9wdHMuY2FsbCh0KSA9PSAiW29iamVjdCBGdW5jdGlvbl0iKXsNCgkJCQkJLy8gbm9uLXRyaXZpYWwgZnVuY3Rpb24gbWV0aG9kID0+IGF0dGFjaCBpdHMgbmFtZQ0KCQkJCQl0Lm5vbSA9IG5hbWU7DQoJCQkJfQ0KCQkJCXRhcmdldFtuYW1lXSA9IHQ7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHRhcmdldDsNCgl9DQoNCglmdW5jdGlvbiBleHRlbmQoc291cmNlKXsNCgkJc2FmZU1peGluKHRoaXMucHJvdG90eXBlLCBzb3VyY2UpOw0KCQlyZXR1cm4gdGhpczsNCgl9DQoNCgkvLyBjaGFpbmVkIGNvbnN0cnVjdG9yIGNvbXBhdGlibGUgd2l0aCB0aGUgbGVnYWN5IGRvam8uZGVjbGFyZSgpDQoJZnVuY3Rpb24gY2hhaW5lZENvbnN0cnVjdG9yKGJhc2VzLCBjdG9yU3BlY2lhbCl7DQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdmFyIGEgPSBhcmd1bWVudHMsIGFyZ3MgPSBhLCBhMCA9IGFbMF0sIGYsIGksIG0sDQoJCQkJbCA9IGJhc2VzLmxlbmd0aCwgcHJlQXJnczsNCg0KCQkJaWYoISh0aGlzIGluc3RhbmNlb2YgYS5jYWxsZWUpKXsNCgkJCQkvLyBub3QgY2FsbGVkIHZpYSBuZXcsIHNvIGZvcmNlIGl0DQoJCQkJcmV0dXJuIGFwcGx5TmV3KGEpOw0KCQkJfQ0KDQoJCQkvL3RoaXMuX2luaGVyaXRlZCA9IHt9Ow0KCQkJLy8gcGVyZm9ybSB0aGUgc2hhbWFuJ3Mgcml0dWFscyBvZiB0aGUgb3JpZ2luYWwgZG9qby5kZWNsYXJlKCkNCgkJCS8vIDEpIGNhbGwgdHdvIHR5cGVzIG9mIHRoZSBwcmVhbWJsZQ0KCQkJaWYoY3RvclNwZWNpYWwgJiYgKGEwICYmIGEwLnByZWFtYmxlIHx8IHRoaXMucHJlYW1ibGUpKXsNCgkJCQkvLyBmdWxsIGJsb3duIHJpdHVhbA0KCQkJCXByZUFyZ3MgPSBuZXcgQXJyYXkoYmFzZXMubGVuZ3RoKTsNCgkJCQkvLyBwcmVwYXJlIHBhcmFtZXRlcnMNCgkJCQlwcmVBcmdzWzBdID0gYTsNCgkJCQlmb3IoaSA9IDA7Oyl7DQoJCQkJCS8vIHByb2Nlc3MgdGhlIHByZWFtYmxlIG9mIHRoZSAxc3QgYXJndW1lbnQNCgkJCQkJYTAgPSBhWzBdOw0KCQkJCQlpZihhMCl7DQoJCQkJCQlmID0gYTAucHJlYW1ibGU7DQoJCQkJCQlpZihmKXsNCgkJCQkJCQlhID0gZi5hcHBseSh0aGlzLCBhKSB8fCBhOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCS8vIHByb2Nlc3MgdGhlIHByZWFtYmxlIG9mIHRoaXMgY2xhc3MNCgkJCQkJZiA9IGJhc2VzW2ldLnByb3RvdHlwZTsNCgkJCQkJZiA9IGYuaGFzT3duUHJvcGVydHkoInByZWFtYmxlIikgJiYgZi5wcmVhbWJsZTsNCgkJCQkJaWYoZil7DQoJCQkJCQlhID0gZi5hcHBseSh0aGlzLCBhKSB8fCBhOw0KCQkJCQl9DQoJCQkJCS8vIG9uZSBwZWN1bGlhcml0eSBvZiB0aGUgcHJlYW1ibGU6DQoJCQkJCS8vIGl0IGlzIGNhbGxlZCBpZiBpdCBpcyBub3QgbmVlZGVkLA0KCQkJCQkvLyBlLmcuLCB0aGVyZSBpcyBubyBjb25zdHJ1Y3RvciB0byBjYWxsDQoJCQkJCS8vIGxldCdzIHdhdGNoIGZvciB0aGUgbGFzdCBjb25zdHJ1Y3Rvcg0KCQkJCQkvLyAoc2VlIHRpY2tldCAjOTc5NSkNCgkJCQkJaWYoKytpID09IGwpew0KCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQkJcHJlQXJnc1tpXSA9IGE7DQoJCQkJfQ0KCQkJfQ0KCQkJLy8gMikgY2FsbCBhbGwgbm9uLXRyaXZpYWwgY29uc3RydWN0b3JzIHVzaW5nIHByZXBhcmVkIGFyZ3VtZW50cw0KCQkJZm9yKGkgPSBsIC0gMTsgaSA+PSAwOyAtLWkpew0KCQkJCWYgPSBiYXNlc1tpXTsNCgkJCQltID0gZi5fbWV0YTsNCgkJCQlmID0gbSA/IG0uY3RvciA6IGY7DQoJCQkJaWYoZil7DQoJCQkJCWYuYXBwbHkodGhpcywgcHJlQXJncyA/IHByZUFyZ3NbaV0gOiBhKTsNCgkJCQl9DQoJCQl9DQoJCQkvLyAzKSBjb250aW51ZSB0aGUgb3JpZ2luYWwgcml0dWFsOiBjYWxsIHRoZSBwb3N0c2NyaXB0DQoJCQlmID0gdGhpcy5wb3N0c2NyaXB0Ow0KCQkJaWYoZil7DQoJCQkJZi5hcHBseSh0aGlzLCBhcmdzKTsNCgkJCX0NCgkJfTsNCgl9DQoNCg0KCS8vIGNoYWluZWQgY29uc3RydWN0b3IgY29tcGF0aWJsZSB3aXRoIHRoZSBsZWdhY3kgZG9qby5kZWNsYXJlKCkNCglmdW5jdGlvbiBzaW5nbGVDb25zdHJ1Y3RvcihjdG9yLCBjdG9yU3BlY2lhbCl7DQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdmFyIGEgPSBhcmd1bWVudHMsIHQgPSBhLCBhMCA9IGFbMF0sIGY7DQoNCgkJCWlmKCEodGhpcyBpbnN0YW5jZW9mIGEuY2FsbGVlKSl7DQoJCQkJLy8gbm90IGNhbGxlZCB2aWEgbmV3LCBzbyBmb3JjZSBpdA0KCQkJCXJldHVybiBhcHBseU5ldyhhKTsNCgkJCX0NCg0KCQkJLy90aGlzLl9pbmhlcml0ZWQgPSB7fTsNCgkJCS8vIHBlcmZvcm0gdGhlIHNoYW1hbidzIHJpdHVhbHMgb2YgdGhlIG9yaWdpbmFsIGRvam8uZGVjbGFyZSgpDQoJCQkvLyAxKSBjYWxsIHR3byB0eXBlcyBvZiB0aGUgcHJlYW1ibGUNCgkJCWlmKGN0b3JTcGVjaWFsKXsNCgkJCQkvLyBmdWxsIGJsb3duIHJpdHVhbA0KCQkJCWlmKGEwKXsNCgkJCQkJLy8gcHJvY2VzcyB0aGUgcHJlYW1ibGUgb2YgdGhlIDFzdCBhcmd1bWVudA0KCQkJCQlmID0gYTAucHJlYW1ibGU7DQoJCQkJCWlmKGYpew0KCQkJCQkJdCA9IGYuYXBwbHkodGhpcywgdCkgfHwgdDsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlmID0gdGhpcy5wcmVhbWJsZTsNCgkJCQlpZihmKXsNCgkJCQkJLy8gcHJvY2VzcyB0aGUgcHJlYW1ibGUgb2YgdGhpcyBjbGFzcw0KCQkJCQlmLmFwcGx5KHRoaXMsIHQpOw0KCQkJCQkvLyBvbmUgcGVjdWxpYXJpdHkgb2YgdGhlIHByZWFtYmxlOg0KCQkJCQkvLyBpdCBpcyBjYWxsZWQgZXZlbiBpZiBpdCBpcyBub3QgbmVlZGVkLA0KCQkJCQkvLyBlLmcuLCB0aGVyZSBpcyBubyBjb25zdHJ1Y3RvciB0byBjYWxsDQoJCQkJCS8vIGxldCdzIHdhdGNoIGZvciB0aGUgbGFzdCBjb25zdHJ1Y3Rvcg0KCQkJCQkvLyAoc2VlIHRpY2tldCAjOTc5NSkNCgkJCQl9DQoJCQl9DQoJCQkvLyAyKSBjYWxsIGEgY29uc3RydWN0b3INCgkJCWlmKGN0b3Ipew0KCQkJCWN0b3IuYXBwbHkodGhpcywgYSk7DQoJCQl9DQoJCQkvLyAzKSBjb250aW51ZSB0aGUgb3JpZ2luYWwgcml0dWFsOiBjYWxsIHRoZSBwb3N0c2NyaXB0DQoJCQlmID0gdGhpcy5wb3N0c2NyaXB0Ow0KCQkJaWYoZil7DQoJCQkJZi5hcHBseSh0aGlzLCBhKTsNCgkJCX0NCgkJfTsNCgl9DQoNCgkvLyBwbGFpbiB2YW5pbGxhIGNvbnN0cnVjdG9yIChjYW4gdXNlIGluaGVyaXRlZCgpIHRvIGNhbGwgaXRzIGJhc2UgY29uc3RydWN0b3IpDQoJZnVuY3Rpb24gc2ltcGxlQ29uc3RydWN0b3IoYmFzZXMpew0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXZhciBhID0gYXJndW1lbnRzLCBpID0gMCwgZiwgbTsNCg0KCQkJaWYoISh0aGlzIGluc3RhbmNlb2YgYS5jYWxsZWUpKXsNCgkJCQkvLyBub3QgY2FsbGVkIHZpYSBuZXcsIHNvIGZvcmNlIGl0DQoJCQkJcmV0dXJuIGFwcGx5TmV3KGEpOw0KCQkJfQ0KDQoJCQkvL3RoaXMuX2luaGVyaXRlZCA9IHt9Ow0KCQkJLy8gcGVyZm9ybSB0aGUgc2hhbWFuJ3Mgcml0dWFscyBvZiB0aGUgb3JpZ2luYWwgZG9qby5kZWNsYXJlKCkNCgkJCS8vIDEpIGRvIG5vdCBjYWxsIHRoZSBwcmVhbWJsZQ0KCQkJLy8gMikgY2FsbCB0aGUgdG9wIGNvbnN0cnVjdG9yIChpdCBjYW4gdXNlIHRoaXMuaW5oZXJpdGVkKCkpDQoJCQlmb3IoOyBmID0gYmFzZXNbaV07ICsraSl7IC8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCQltID0gZi5fbWV0YTsNCgkJCQlmID0gbSA/IG0uY3RvciA6IGY7DQoJCQkJaWYoZil7DQoJCQkJCWYuYXBwbHkodGhpcywgYSk7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCgkJCS8vIDMpIGNhbGwgdGhlIHBvc3RzY3JpcHQNCgkJCWYgPSB0aGlzLnBvc3RzY3JpcHQ7DQoJCQlpZihmKXsNCgkJCQlmLmFwcGx5KHRoaXMsIGEpOw0KCQkJfQ0KCQl9Ow0KCX0NCg0KCWZ1bmN0aW9uIGNoYWluKG5hbWUsIGJhc2VzLCByZXZlcnNlZCl7DQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdmFyIGIsIG0sIGYsIGkgPSAwLCBzdGVwID0gMTsNCgkJCWlmKHJldmVyc2VkKXsNCgkJCQlpID0gYmFzZXMubGVuZ3RoIC0gMTsNCgkJCQlzdGVwID0gLTE7DQoJCQl9DQoJCQlmb3IoOyBiID0gYmFzZXNbaV07IGkgKz0gc3RlcCl7IC8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCQltID0gYi5fbWV0YTsNCgkJCQlmID0gKG0gPyBtLmhpZGRlbiA6IGIucHJvdG90eXBlKVtuYW1lXTsNCgkJCQlpZihmKXsNCgkJCQkJZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJCX0NCgkJCX0NCgkJfTsNCgl9DQoNCgkvLyBmb3JjZU5ldyhjdG9yKQ0KCS8vIHJldHVybiBhIG5ldyBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIGN0b3IucHJvdG90eXBlIGJ1dA0KCS8vIHdpdGhvdXQgYWN0dWFsbHkgcnVubmluZyBjdG9yIG9uIHRoZSBvYmplY3QuDQoJZnVuY3Rpb24gZm9yY2VOZXcoY3Rvcil7DQoJCS8vIGNyZWF0ZSBvYmplY3Qgd2l0aCBjb3JyZWN0IHByb3RvdHlwZSB1c2luZyBhIGRvLW5vdGhpbmcNCgkJLy8gY29uc3RydWN0b3INCgkJeHRvci5wcm90b3R5cGUgPSBjdG9yLnByb3RvdHlwZTsNCgkJdmFyIHQgPSBuZXcgeHRvcjsNCgkJeHRvci5wcm90b3R5cGUgPSBudWxsOwkvLyBjbGVhbiB1cA0KCQlyZXR1cm4gdDsNCgl9DQoNCgkvLyBhcHBseU5ldyhhcmdzKQ0KCS8vIGp1c3QgbGlrZSAnbmV3IGN0b3IoKScgZXhjZXB0IHRoYXQgdGhlIGNvbnN0cnVjdG9yIGFuZCBpdHMgYXJndW1lbnRzIGNvbWUNCgkvLyBmcm9tIGFyZ3MsIHdoaWNoIG11c3QgYmUgYW4gYXJyYXkgb3IgYW4gYXJndW1lbnRzIG9iamVjdA0KCWZ1bmN0aW9uIGFwcGx5TmV3KGFyZ3Mpew0KCQkvLyBjcmVhdGUgYW4gb2JqZWN0IHdpdGggY3RvcidzIHByb3RvdHlwZSBidXQgd2l0aG91dA0KCQkvLyBjYWxsaW5nIGN0b3Igb24gaXQuDQoJCXZhciBjdG9yID0gYXJncy5jYWxsZWUsIHQgPSBmb3JjZU5ldyhjdG9yKTsNCgkJLy8gZXhlY3V0ZSB0aGUgcmVhbCBjb25zdHJ1Y3RvciBvbiB0aGUgbmV3IG9iamVjdA0KCQljdG9yLmFwcGx5KHQsIGFyZ3MpOw0KCQlyZXR1cm4gdDsNCgl9DQoNCglkLmRlY2xhcmUgPSBmdW5jdGlvbihjbGFzc05hbWUsIHN1cGVyY2xhc3MsIHByb3BzKXsNCgkJLy8gY3JhY2sgcGFyYW1ldGVycw0KCQlpZih0eXBlb2YgY2xhc3NOYW1lICE9ICJzdHJpbmciKXsNCgkJCXByb3BzID0gc3VwZXJjbGFzczsNCgkJCXN1cGVyY2xhc3MgPSBjbGFzc05hbWU7DQoJCQljbGFzc05hbWUgPSAiIjsNCgkJfQ0KCQlwcm9wcyA9IHByb3BzIHx8IHt9Ow0KDQoJCXZhciBwcm90bywgaSwgdCwgY3RvciwgbmFtZSwgYmFzZXMsIGNoYWlucywgbWl4aW5zID0gMSwgcGFyZW50cyA9IHN1cGVyY2xhc3M7DQoNCgkJLy8gYnVpbGQgYSBwcm90b3R5cGUNCgkJaWYob3B0cy5jYWxsKHN1cGVyY2xhc3MpID09ICJbb2JqZWN0IEFycmF5XSIpew0KCQkJLy8gQzMgTVJPDQoJCQliYXNlcyA9IGMzbXJvKHN1cGVyY2xhc3MpOw0KCQkJdCA9IGJhc2VzWzBdOw0KCQkJbWl4aW5zID0gYmFzZXMubGVuZ3RoIC0gdDsNCgkJCXN1cGVyY2xhc3MgPSBiYXNlc1ttaXhpbnNdOw0KCQl9ZWxzZXsNCgkJCWJhc2VzID0gWzBdOw0KCQkJaWYoc3VwZXJjbGFzcyl7DQoJCQkJaWYob3B0cy5jYWxsKHN1cGVyY2xhc3MpID09ICJbb2JqZWN0IEZ1bmN0aW9uXSIpew0KCQkJCQl0ID0gc3VwZXJjbGFzcy5fbWV0YTsNCgkJCQkJYmFzZXMgPSBiYXNlcy5jb25jYXQodCA/IHQuYmFzZXMgOiBzdXBlcmNsYXNzKTsNCgkJCQl9ZWxzZXsNCgkJCQkJZXJyKCJiYXNlIGNsYXNzIGlzIG5vdCBhIGNhbGxhYmxlIGNvbnN0cnVjdG9yLiIpOw0KCQkJCX0NCgkJCX1lbHNlIGlmKHN1cGVyY2xhc3MgIT09IG51bGwpew0KCQkJCWVycigidW5rbm93biBiYXNlIGNsYXNzLiBEaWQgeW91IHVzZSBkb2pvLnJlcXVpcmUgdG8gcHVsbCBpdCBpbj8iKQ0KCQkJfQ0KCQl9DQoJCWlmKHN1cGVyY2xhc3Mpew0KCQkJZm9yKGkgPSBtaXhpbnMgLSAxOzsgLS1pKXsNCgkJCQlwcm90byA9IGZvcmNlTmV3KHN1cGVyY2xhc3MpOw0KCQkJCWlmKCFpKXsNCgkJCQkJLy8gc3RvcCBpZiBub3RoaW5nIHRvIGFkZCAodGhlIGxhc3QgYmFzZSkNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJCS8vIG1peCBpbiBwcm9wZXJ0aWVzDQoJCQkJdCA9IGJhc2VzW2ldOw0KCQkJCSh0Ll9tZXRhID8gbWl4T3duIDogbWl4KShwcm90bywgdC5wcm90b3R5cGUpOw0KCQkJCS8vIGNoYWluIGluIG5ldyBjb25zdHJ1Y3Rvcg0KCQkJCWN0b3IgPSBuZXcgRnVuY3Rpb247DQoJCQkJY3Rvci5zdXBlcmNsYXNzID0gc3VwZXJjbGFzczsNCgkJCQljdG9yLnByb3RvdHlwZSA9IHByb3RvOw0KCQkJCXN1cGVyY2xhc3MgPSBwcm90by5jb25zdHJ1Y3RvciA9IGN0b3I7DQoJCQl9DQoJCX1lbHNlew0KCQkJcHJvdG8gPSB7fTsNCgkJfQ0KCQkvLyBhZGQgYWxsIHByb3BlcnRpZXMNCgkJc2FmZU1peGluKHByb3RvLCBwcm9wcyk7DQoJCS8vIGFkZCBjb25zdHJ1Y3Rvcg0KCQl0ID0gcHJvcHMuY29uc3RydWN0b3I7DQoJCWlmKHQgIT09IG9wLmNvbnN0cnVjdG9yKXsNCgkJCXQubm9tID0gY25hbWU7DQoJCQlwcm90by5jb25zdHJ1Y3RvciA9IHQ7DQoJCX0NCg0KCQkvLyBjb2xsZWN0IGNoYWlucyBhbmQgZmxhZ3MNCgkJZm9yKGkgPSBtaXhpbnMgLSAxOyBpOyAtLWkpeyAvLyBpbnRlbnRpb25hbCBhc3NpZ25tZW50DQoJCQl0ID0gYmFzZXNbaV0uX21ldGE7DQoJCQlpZih0ICYmIHQuY2hhaW5zKXsNCgkJCQljaGFpbnMgPSBtaXgoY2hhaW5zIHx8IHt9LCB0LmNoYWlucyk7DQoJCQl9DQoJCX0NCgkJaWYocHJvdG9bIi1jaGFpbnMtIl0pew0KCQkJY2hhaW5zID0gbWl4KGNoYWlucyB8fCB7fSwgcHJvdG9bIi1jaGFpbnMtIl0pOw0KCQl9DQoNCgkJLy8gYnVpbGQgY3Rvcg0KCQl0ID0gIWNoYWlucyB8fCAhY2hhaW5zLmhhc093blByb3BlcnR5KGNuYW1lKTsNCgkJYmFzZXNbMF0gPSBjdG9yID0gKGNoYWlucyAmJiBjaGFpbnMuY29uc3RydWN0b3IgPT09ICJtYW51YWwiKSA/IHNpbXBsZUNvbnN0cnVjdG9yKGJhc2VzKSA6DQoJCQkoYmFzZXMubGVuZ3RoID09IDEgPyBzaW5nbGVDb25zdHJ1Y3Rvcihwcm9wcy5jb25zdHJ1Y3RvciwgdCkgOiBjaGFpbmVkQ29uc3RydWN0b3IoYmFzZXMsIHQpKTsNCg0KCQkvLyBhZGQgbWV0YSBpbmZvcm1hdGlvbiB0byB0aGUgY29uc3RydWN0b3INCgkJY3Rvci5fbWV0YSAgPSB7YmFzZXM6IGJhc2VzLCBoaWRkZW46IHByb3BzLCBjaGFpbnM6IGNoYWlucywNCgkJCXBhcmVudHM6IHBhcmVudHMsIGN0b3I6IHByb3BzLmNvbnN0cnVjdG9yfTsNCgkJY3Rvci5zdXBlcmNsYXNzID0gc3VwZXJjbGFzcyAmJiBzdXBlcmNsYXNzLnByb3RvdHlwZTsNCgkJY3Rvci5leHRlbmQgPSBleHRlbmQ7DQoJCWN0b3IucHJvdG90eXBlID0gcHJvdG87DQoJCXByb3RvLmNvbnN0cnVjdG9yID0gY3RvcjsNCg0KCQkvLyBhZGQgInN0YW5kYXJkIiBtZXRob2RzIHRvIHRoZSBwcm90b3R5cGUNCgkJcHJvdG8uZ2V0SW5oZXJpdGVkID0gZ2V0SW5oZXJpdGVkOw0KCQlwcm90by5pbmhlcml0ZWQgPSBpbmhlcml0ZWQ7DQoJCXByb3RvLmlzSW5zdGFuY2VPZiA9IGlzSW5zdGFuY2VPZjsNCg0KCQkvLyBhZGQgbmFtZSBpZiBzcGVjaWZpZWQNCgkJaWYoY2xhc3NOYW1lKXsNCgkJCXByb3RvLmRlY2xhcmVkQ2xhc3MgPSBjbGFzc05hbWU7DQoJCQlkLnNldE9iamVjdChjbGFzc05hbWUsIGN0b3IpOw0KCQl9DQoNCgkJLy8gYnVpbGQgY2hhaW5zIGFuZCBhZGQgdGhlbSB0byB0aGUgcHJvdG90eXBlDQoJCWlmKGNoYWlucyl7DQoJCQlmb3IobmFtZSBpbiBjaGFpbnMpew0KCQkJCWlmKHByb3RvW25hbWVdICYmIHR5cGVvZiBjaGFpbnNbbmFtZV0gPT0gInN0cmluZyIgJiYgbmFtZSAhPSBjbmFtZSl7DQoJCQkJCXQgPSBwcm90b1tuYW1lXSA9IGNoYWluKG5hbWUsIGJhc2VzLCBjaGFpbnNbbmFtZV0gPT09ICJhZnRlciIpOw0KCQkJCQl0Lm5vbSA9IG5hbWU7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCS8vIGNoYWluZWQgbWV0aG9kcyBkbyBub3QgcmV0dXJuIHZhbHVlcw0KCQkvLyBubyBuZWVkIHRvIGNoYWluICJpbnZpc2libGUiIGZ1bmN0aW9ucw0KDQoJCXJldHVybiBjdG9yOwkvLyBGdW5jdGlvbg0KCX07DQoNCglkLnNhZmVNaXhpbiA9IHNhZmVNaXhpbjsNCg0KCS8qPT09PT0NCglkb2pvLmRlY2xhcmUgPSBmdW5jdGlvbihjbGFzc05hbWUsIHN1cGVyY2xhc3MsIHByb3BzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUNyZWF0ZSBhIGZlYXR1cmUtcmljaCBjb25zdHJ1Y3RvciBmcm9tIGNvbXBhY3Qgbm90YXRpb24uDQoJCS8vCWNsYXNzTmFtZTogU3RyaW5nPzoNCgkJLy8JCVRoZSBvcHRpb25hbCBuYW1lIG9mIHRoZSBjb25zdHJ1Y3RvciAobG9vc2VseSwgYSAiY2xhc3MiKQ0KCQkvLwkJc3RvcmVkIGluIHRoZSAiZGVjbGFyZWRDbGFzcyIgcHJvcGVydHkgaW4gdGhlIGNyZWF0ZWQgcHJvdG90eXBlLg0KCQkvLwkJSXQgd2lsbCBiZSB1c2VkIGFzIGEgZ2xvYmFsIG5hbWUgZm9yIGEgY3JlYXRlZCBjb25zdHJ1Y3Rvci4NCgkJLy8Jc3VwZXJjbGFzczogRnVuY3Rpb258RnVuY3Rpb25bXToNCgkJLy8JCU1heSBiZSBudWxsLCBhIEZ1bmN0aW9uLCBvciBhbiBBcnJheSBvZiBGdW5jdGlvbnMuIFRoaXMgYXJndW1lbnQNCgkJLy8JCXNwZWNpZmllcyBhIGxpc3Qgb2YgYmFzZXMgKHRoZSBsZWZ0LW1vc3Qgb25lIGlzIHRoZSBtb3N0IGRlZXBlc3QNCgkJLy8JCWJhc2UpLg0KCQkvLwlwcm9wczogT2JqZWN0Og0KCQkvLwkJQW4gb2JqZWN0IHdob3NlIHByb3BlcnRpZXMgYXJlIGNvcGllZCB0byB0aGUgY3JlYXRlZCBwcm90b3R5cGUuDQoJCS8vCQlBZGQgYW4gaW5zdGFuY2UtaW5pdGlhbGl6YXRpb24gZnVuY3Rpb24gYnkgbWFraW5nIGl0IGEgcHJvcGVydHkNCgkJLy8JCW5hbWVkICJjb25zdHJ1Y3RvciIuDQoJCS8vCXJldHVybnM6DQoJCS8vCQlOZXcgY29uc3RydWN0b3IgZnVuY3Rpb24uDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJQ3JlYXRlIGEgY29uc3RydWN0b3IgdXNpbmcgYSBjb21wYWN0IG5vdGF0aW9uIGZvciBpbmhlcml0YW5jZSBhbmQNCgkJLy8JCXByb3RvdHlwZSBleHRlbnNpb24uDQoJCS8vDQoJCS8vCQlNaXhpbiBhbmNlc3RvcnMgcHJvdmlkZSBhIHR5cGUgb2YgbXVsdGlwbGUgaW5oZXJpdGFuY2UuDQoJCS8vCQlQcm90b3R5cGVzIG9mIG1peGluIGFuY2VzdG9ycyBhcmUgY29waWVkIHRvIHRoZSBuZXcgY2xhc3M6DQoJCS8vCQljaGFuZ2VzIHRvIG1peGluIHByb3RvdHlwZXMgd2lsbCBub3QgYWZmZWN0IGNsYXNzZXMgdG8gd2hpY2gNCgkJLy8JCXRoZXkgaGF2ZSBiZWVuIG1peGVkIGluLg0KCQkvLw0KCQkvLwkJQW5jZXN0b3JzIGNhbiBiZSBjb21wb3VuZCBjbGFzc2VzIGNyZWF0ZWQgYnkgdGhpcyB2ZXJzaW9uIG9mDQoJCS8vCQlkb2pvLmRlY2xhcmUuIEluIGNvbXBsZXggY2FzZXMgYWxsIGJhc2UgY2xhc3NlcyBhcmUgZ29pbmcgdG8gYmUNCgkJLy8JCWxpbmVhcml6ZWQgYWNjb3JkaW5nIHRvIEMzIE1STyBhbGdvcml0aG0NCgkJLy8JCShzZWUgaHR0cDovL3d3dy5weXRob24ub3JnL2Rvd25sb2FkL3JlbGVhc2VzLzIuMy9tcm8vIGZvciBtb3JlDQoJCS8vCQlkZXRhaWxzKS4NCgkJLy8NCgkJLy8JCSJjbGFzc05hbWUiIGlzIGNhY2hlZCBpbiAiZGVjbGFyZWRDbGFzcyIgcHJvcGVydHkgb2YgdGhlIG5ldyBjbGFzcywNCgkJLy8JCWlmIGl0IHdhcyBzdXBwbGllZC4gVGhlIGltbWVkaWF0ZSBzdXBlciBjbGFzcyB3aWxsIGJlIGNhY2hlZCBpbg0KCQkvLwkJInN1cGVyY2xhc3MiIHByb3BlcnR5IG9mIHRoZSBuZXcgY2xhc3MuDQoJCS8vDQoJCS8vCQlNZXRob2RzIGluICJwcm9wcyIgd2lsbCBiZSBjb3BpZWQgYW5kIG1vZGlmaWVkOiAibm9tIiBwcm9wZXJ0eQ0KCQkvLwkJKHRoZSBkZWNsYXJlZCBuYW1lIG9mIHRoZSBtZXRob2QpIHdpbGwgYmUgYWRkZWQgdG8gYWxsIGNvcGllZA0KCQkvLwkJZnVuY3Rpb25zIHRvIGhlbHAgaWRlbnRpZnkgdGhlbSBmb3IgdGhlIGludGVybmFsIG1hY2hpbmVyeS4gQmUNCgkJLy8JCXZlcnkgY2FyZWZ1bCwgd2hpbGUgcmV1c2luZyBtZXRob2RzOiBpZiB5b3UgdXNlIHRoZSBzYW1lDQoJCS8vCQlmdW5jdGlvbiB1bmRlciBkaWZmZXJlbnQgbmFtZXMsIGl0IGNhbiBwcm9kdWNlIGVycm9ycyBpbiBzb21lDQoJCS8vCQljYXNlcy4NCgkJLy8NCgkJLy8JCUl0IGlzIHBvc3NpYmxlIHRvIHVzZSBjb25zdHJ1Y3RvcnMgY3JlYXRlZCAibWFudWFsbHkiICh3aXRob3V0DQoJCS8vCQlkb2pvLmRlY2xhcmUpIGFzIGJhc2VzLiBUaGV5IHdpbGwgYmUgY2FsbGVkIGFzIHVzdWFsIGR1cmluZyB0aGUNCgkJLy8JCWNyZWF0aW9uIG9mIGFuIGluc3RhbmNlLCB0aGVpciBtZXRob2RzIHdpbGwgYmUgY2hhaW5lZCwgYW5kIGV2ZW4NCgkJLy8JCWNhbGxlZCBieSAidGhpcy5pbmhlcml0ZWQoKSIuDQoJCS8vDQoJCS8vCQlTcGVjaWFsIHByb3BlcnR5ICItY2hhaW5zLSIgZ292ZXJucyBob3cgdG8gY2hhaW4gbWV0aG9kcy4gSXQgaXMNCgkJLy8JCWEgZGljdGlvbmFyeSwgd2hpY2ggdXNlcyBtZXRob2QgbmFtZXMgYXMga2V5cywgYW5kIGhpbnQgc3RyaW5ncw0KCQkvLwkJYXMgdmFsdWVzLiBJZiBhIGhpbnQgc3RyaW5nIGlzICJhZnRlciIsIHRoaXMgbWV0aG9kIHdpbGwgYmUNCgkJLy8JCWNhbGxlZCBhZnRlciBtZXRob2RzIG9mIGl0cyBiYXNlIGNsYXNzZXMuIElmIGEgaGludCBzdHJpbmcgaXMNCgkJLy8JCSJiZWZvcmUiLCB0aGlzIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBiZWZvcmUgbWV0aG9kcyBvZiBpdHMgYmFzZQ0KCQkvLwkJY2xhc3Nlcy4NCgkJLy8NCgkJLy8JCUlmICJjb25zdHJ1Y3RvciIgaXMgbm90IG1lbnRpb25lZCBpbiAiLWNoYWlucy0iIHByb3BlcnR5LCBpdCB3aWxsDQoJCS8vCQliZSBjaGFpbmVkIHVzaW5nIHRoZSBsZWdhY3kgbW9kZTogdXNpbmcgImFmdGVyIiBjaGFpbmluZywNCgkJLy8JCWNhbGxpbmcgcHJlYW1ibGUoKSBtZXRob2QgYmVmb3JlIGVhY2ggY29uc3RydWN0b3IsIGlmIGF2YWlsYWJsZSwNCgkJLy8JCWFuZCBjYWxsaW5nIHBvc3RzY3JpcHQoKSBhZnRlciBhbGwgY29uc3RydWN0b3JzIHdlcmUgZXhlY3V0ZWQuDQoJCS8vCQlJZiB0aGUgaGludCBpcyAiYWZ0ZXIiLCBpdCBpcyBjaGFpbmVkIGFzIGEgcmVndWxhciBtZXRob2QsIGJ1dA0KCQkvLwkJcG9zdHNjcmlwdCgpIHdpbGwgYmUgY2FsbGVkIGFmdGVyIHRoZSBjaGFpbiBvZiBjb25zdHJ1Y3RvcnMuDQoJCS8vCQkiY29uc3RydWN0b3IiIGNhbm5vdCBiZSBjaGFpbmVkICJiZWZvcmUiLCBidXQgaXQgYWxsb3dzDQoJCS8vCQlhIHNwZWNpYWwgaGludCBzdHJpbmc6ICJtYW51YWwiLCB3aGljaCBtZWFucyB0aGF0IGNvbnN0cnVjdG9ycw0KCQkvLwkJYXJlIG5vdCBnb2luZyB0byBiZSBjaGFpbmVkIGluIGFueSB3YXksIGFuZCBwcm9ncmFtbWVyIHdpbGwgY2FsbA0KCQkvLwkJdGhlbSBtYW51YWxseSB1c2luZyB0aGlzLmluaGVyaXRlZCgpLiBJbiB0aGUgbGF0dGVyIGNhc2UNCgkJLy8JCXBvc3RzY3JpcHQoKSB3aWxsIGJlIGNhbGxlZCBhZnRlciB0aGUgY29uc3RydWN0aW9uLg0KCQkvLw0KCQkvLwkJQWxsIGNoYWluaW5nIGhpbnRzIGFyZSAiaW5oZXJpdGVkIiBmcm9tIGJhc2UgY2xhc3NlcyBhbmQNCgkJLy8JCXBvdGVudGlhbGx5IGNhbiBiZSBvdmVycmlkZGVuLiBCZSB2ZXJ5IGNhcmVmdWwgd2hlbiBvdmVycmlkaW5nDQoJCS8vCQloaW50cyEgTWFrZSBzdXJlIHRoYXQgYWxsIGNoYWluZWQgbWV0aG9kcyBjYW4gd29yayBpbiBhIHByb3Bvc2VkDQoJCS8vCQltYW5uZXIgb2YgY2hhaW5pbmcuDQoJCS8vDQoJCS8vCQlPbmNlIGEgbWV0aG9kIHdhcyBjaGFpbmVkLCBpdCBpcyBpbXBvc3NpYmxlIHRvIHVuY2hhaW4gaXQuIFRoZQ0KCQkvLwkJb25seSBleGNlcHRpb24gaXMgImNvbnN0cnVjdG9yIi4gWW91IGRvbid0IG5lZWQgdG8gZGVmaW5lIGENCgkJLy8JCW1ldGhvZCBpbiBvcmRlciB0byBzdXBwbHkgYSBjaGFpbmluZyBoaW50Lg0KCQkvLw0KCQkvLwkJSWYgYSBtZXRob2QgaXMgY2hhaW5lZCwgaXQgY2Fubm90IHVzZSB0aGlzLmluaGVyaXRlZCgpIGJlY2F1c2UNCgkJLy8JCWFsbCBvdGhlciBtZXRob2RzIGluIHRoZSBoaWVyYXJjaHkgd2lsbCBiZSBjYWxsZWQgYXV0b21hdGljYWxseS4NCgkJLy8NCgkJLy8JCVVzdWFsbHkgY29uc3RydWN0b3JzIGFuZCBpbml0aWFsaXplcnMgb2YgYW55IGtpbmQgYXJlIGNoYWluZWQNCgkJLy8JCXVzaW5nICJhZnRlciIgYW5kIGRlc3RydWN0b3JzIG9mIGFueSBraW5kIGFyZSBjaGFpbmVkIGFzDQoJCS8vCQkiYmVmb3JlIi4gTm90ZSB0aGF0IGNoYWluaW5nIGFzc3VtZXMgdGhhdCBjaGFpbmVkIG1ldGhvZHMgZG8gbm90DQoJCS8vCQlyZXR1cm4gYW55IHZhbHVlOiBhbnkgcmV0dXJuZWQgdmFsdWUgd2lsbCBiZSBkaXNjYXJkZWQuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJZG9qby5kZWNsYXJlKCJteS5jbGFzc2VzLmJhciIsIG15LmNsYXNzZXMuZm9vLCB7DQoJCS8vCXwJCS8vIHByb3BlcnRpZXMgdG8gYmUgYWRkZWQgdG8gdGhlIGNsYXNzIHByb3RvdHlwZQ0KCQkvLwl8CQlzb21lVmFsdWU6IDIsDQoJCS8vCXwJCS8vIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uDQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJdGhpcy5teUNvbXBsaWNhdGVkT2JqZWN0ID0gbmV3IFJlYWxseUNvbXBsaWNhdGVkT2JqZWN0KCk7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCS8vIG90aGVyIGZ1bmN0aW9ucw0KCQkvLwl8CQlzb21lTWV0aG9kOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJZG9TdHVmZigpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIE15QmFzZSA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCS8vIGNvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzLCBhbmQgbWV0aG9kcyBnbyBoZXJlDQoJCS8vCXwJCS8vIC4uLg0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBNeUNsYXNzMSA9IGRvam8uZGVjbGFyZShNeUJhc2UsIHsNCgkJLy8JfAkJLy8gY29uc3RydWN0b3IsIHByb3BlcnRpZXMsIGFuZCBtZXRob2RzIGdvIGhlcmUNCgkJLy8JfAkJLy8gLi4uDQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIE15Q2xhc3MyID0gZG9qby5kZWNsYXJlKE15QmFzZSwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgTXlEaWFtb25kID0gZG9qby5kZWNsYXJlKFtNeUNsYXNzMSwgTXlDbGFzczJdLCB7DQoJCS8vCXwJCS8vIGNvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzLCBhbmQgbWV0aG9kcyBnbyBoZXJlDQoJCS8vCXwJCS8vIC4uLg0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBGID0gZnVuY3Rpb24oKXsgY29uc29sZS5sb2coInJhdyBjb25zdHJ1Y3RvciIpOyB9Ow0KCQkvLwl8CUYucHJvdG90eXBlLm1ldGhvZCA9IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCWNvbnNvbGUubG9nKCJyYXcgbWV0aG9kIik7DQoJCS8vCXwJfTsNCgkJLy8JfAl2YXIgQSA9IGRvam8uZGVjbGFyZShGLCB7DQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkEuY29uc3RydWN0b3IiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJbWV0aG9kOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coImJlZm9yZSBjYWxsaW5nIEYubWV0aG9kLi4uIik7DQoJCS8vCXwJCQl0aGlzLmluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJY29uc29sZS5sb2coIi4uLmJhY2sgaW4gQSIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJbmV3IEEoKS5tZXRob2QoKTsNCgkJLy8JfAkvLyB3aWxsIHByaW50Og0KCQkvLwl8CS8vIHJhdyBjb25zdHJ1Y3Rvcg0KCQkvLwl8CS8vIEEuY29uc3RydWN0b3INCgkJLy8JfAkvLyBiZWZvcmUgY2FsbGluZyBGLm1ldGhvZC4uLg0KCQkvLwl8CS8vIHJhdyBtZXRob2QNCgkJLy8JfAkvLyAuLi5iYWNrIGluIEENCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQSA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCSItY2hhaW5zLSI6IHsNCgkJLy8JfAkJCWRlc3Ryb3k6ICJiZWZvcmUiDQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCWNvbnN0cnVjdG9yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkIuY29uc3RydWN0b3IiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJZGVzdHJveTogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJCLmRlc3Ryb3kiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBDID0gZG9qby5kZWNsYXJlKEIsIHsNCgkJLy8JfAkJY29uc3RydWN0b3I6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQy5jb25zdHJ1Y3RvciIpOw0KCQkvLwl8CQl9LA0KCQkvLwl8CQlkZXN0cm95OiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkMuZGVzdHJveSIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJbmV3IEMoKS5kZXN0cm95KCk7DQoJCS8vCXwJLy8gcHJpbnRzOg0KCQkvLwl8CS8vIEIuY29uc3RydWN0b3INCgkJLy8JfAkvLyBDLmNvbnN0cnVjdG9yDQoJCS8vCXwJLy8gQy5kZXN0cm95DQoJCS8vCXwJLy8gQi5kZXN0cm95DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkiLWNoYWlucy0iOiB7DQoJCS8vCXwJCQljb25zdHJ1Y3RvcjogIm1hbnVhbCINCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBCID0gZG9qby5kZWNsYXJlKEEsIHsNCgkJLy8JfAkJY29uc3RydWN0b3I6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQkvLyAuLi4NCgkJLy8JfAkJCS8vIGNhbGwgdGhlIGJhc2UgY29uc3RydWN0b3Igd2l0aCBuZXcgcGFyYW1ldGVycw0KCQkvLwl8CQkJdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzLCBbMSwgMiwgM10pOw0KCQkvLwl8CQkJLy8gLi4uDQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQSA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCSItY2hhaW5zLSI6IHsNCgkJLy8JfAkJCW0xOiAiYmVmb3JlIg0KCQkvLwl8CQl9LA0KCQkvLwl8CQltMTogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJBLm0xIik7DQoJCS8vCXwJCX0sDQoJCS8vCXwJCW0yOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkEubTIiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBCID0gZG9qby5kZWNsYXJlKEEsIHsNCgkJLy8JfAkJIi1jaGFpbnMtIjogew0KCQkvLwl8CQkJbTI6ICJhZnRlciINCgkJLy8JfAkJfSwNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQi5tMSIpOw0KCQkvLwl8CQl9LA0KCQkvLwl8CQltMjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCWNvbnNvbGUubG9nKCJCLm0yIik7DQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgeCA9IG5ldyBCKCk7DQoJCS8vCXwJeC5tMSgpOw0KCQkvLwl8CS8vIHByaW50czoNCgkJLy8JfAkvLyBCLm0xDQoJCS8vCXwJLy8gQS5tMQ0KCQkvLwl8CXgubTIoKTsNCgkJLy8JfAkvLyBwcmludHM6DQoJCS8vCXwJLy8gQS5tMg0KCQkvLwl8CS8vIEIubTINCgkJcmV0dXJuIG5ldyBGdW5jdGlvbigpOyAvLyBGdW5jdGlvbg0KCX07DQoJPT09PT0qLw0KDQoJLyo9PT09PQ0KCWRvam8uc2FmZU1peGluID0gZnVuY3Rpb24odGFyZ2V0LCBzb3VyY2Upew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJTWl4IGluIHByb3BlcnRpZXMgc2tpcHBpbmcgYSBjb25zdHJ1Y3RvciBhbmQgZGVjb3JhdGluZyBmdW5jdGlvbnMNCgkJLy8JCWxpa2UgaXQgaXMgZG9uZSBieSBkb2pvLmRlY2xhcmUuDQoJCS8vCXRhcmdldDogT2JqZWN0DQoJCS8vCQlUYXJnZXQgb2JqZWN0IHRvIGFjY2VwdCBuZXcgcHJvcGVydGllcy4NCgkJLy8Jc291cmNlOiBPYmplY3QNCgkJLy8JCVNvdXJjZSBvYmplY3QgZm9yIG5ldyBwcm9wZXJ0aWVzLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBtaXggaW4gcHJvcGVydGllcyBsaWtlIGRvam8uX21peGluIGRvZXMsDQoJCS8vCQlidXQgaXQgc2tpcHMgYSBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBhbmQgZGVjb3JhdGVzIGZ1bmN0aW9ucyBsaWtlDQoJCS8vCQlkb2pvLmRlY2xhcmUgZG9lcy4NCgkJLy8NCgkJLy8JCUl0IGlzIG1lYW50IHRvIGJlIHVzZWQgd2l0aCBjbGFzc2VzIGFuZCBvYmplY3RzIHByb2R1Y2VkIHdpdGgNCgkJLy8JCWRvam8uZGVjbGFyZS4gRnVuY3Rpb25zIG1peGVkIGluIHdpdGggZG9qby5zYWZlTWl4aW4gY2FuIHVzZQ0KCQkvLwkJdGhpcy5pbmhlcml0ZWQoKSBsaWtlIG5vcm1hbCBtZXRob2RzLg0KCQkvLw0KCQkvLwkJVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGltcGxlbWVudCBleHRlbmQoKSBtZXRob2Qgb2YgYSBjb25zdHJ1Y3Rvcg0KCQkvLwkJcHJvZHVjZWQgd2l0aCBkb2pvLmRlY2xhcmUoKS4NCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQSA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCW0xOiBmdW5jdGlvbigpew0KCQkvLwl8CQkJY29uc29sZS5sb2coIkEubTEiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJbTI6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQS5tMiIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQltMTogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCXRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cyk7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQi5tMSIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJQi5leHRlbmQoew0KCQkvLwl8CQltMjogZnVuY3Rpb24oKXsNCgkJLy8JfAkJCXRoaXMuaW5oZXJpdGVkKGFyZ3VtZW50cyk7DQoJCS8vCXwJCQljb25zb2xlLmxvZygiQi5tMiIpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCS8vCXwJdmFyIHggPSBuZXcgQigpOw0KCQkvLwl8CWRvam8uc2FmZU1peGluKHgsIHsNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQl0aGlzLmluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJY29uc29sZS5sb2coIlgubTEiKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJbTI6IGZ1bmN0aW9uKCl7DQoJCS8vCXwJCQl0aGlzLmluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJY29uc29sZS5sb2coIlgubTIiKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CXgubTIoKTsNCgkJLy8JfAkvLyBwcmludHM6DQoJCS8vCXwJLy8gQS5tMQ0KCQkvLwl8CS8vIEIubTENCgkJLy8JfAkvLyBYLm0xDQoJfTsNCgk9PT09PSovDQoNCgkvKj09PT09DQoJT2JqZWN0LmluaGVyaXRlZCA9IGZ1bmN0aW9uKG5hbWUsIGFyZ3MsIG5ld0FyZ3Mpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQ2FsbHMgYSBzdXBlciBtZXRob2QuDQoJCS8vCW5hbWU6IFN0cmluZz8NCgkJLy8JCVRoZSBvcHRpb25hbCBtZXRob2QgbmFtZS4gU2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBjYWxsZXIncw0KCQkvLwkJbmFtZS4gVXN1YWxseSAibmFtZSIgaXMgc3BlY2lmaWVkIGluIGNvbXBsZXggZHluYW1pYyBjYXNlcywgd2hlbg0KCQkvLwkJdGhlIGNhbGxpbmcgbWV0aG9kIHdhcyBkeW5hbWljYWxseSBhZGRlZCwgdW5kZWNvcmF0ZWQgYnkNCgkJLy8JCWRvam8uZGVjbGFyZSwgYW5kIGl0IGNhbm5vdCBiZSBkZXRlcm1pbmVkLg0KCQkvLwlhcmdzOiBBcmd1bWVudHMNCgkJLy8JCVRoZSBjYWxsZXIgc3VwcGx5IHRoaXMgYXJndW1lbnQsIHdoaWNoIHNob3VsZCBiZSB0aGUgb3JpZ2luYWwNCgkJLy8JCSJhcmd1bWVudHMiLg0KCQkvLwluZXdBcmdzOiBPYmplY3Q/DQoJCS8vCQlJZiAidHJ1ZSIsIHRoZSBmb3VuZCBmdW5jdGlvbiB3aWxsIGJlIHJldHVybmVkIHdpdGhvdXQNCgkJLy8JCWV4ZWN1dGluZyBpdC4NCgkJLy8JCUlmIEFycmF5LCBpdCB3aWxsIGJlIHVzZWQgdG8gY2FsbCBhIHN1cGVyIG1ldGhvZC4gT3RoZXJ3aXNlDQoJCS8vCQkiYXJncyIgd2lsbCBiZSB1c2VkLg0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJV2hhdGV2ZXIgaXMgcmV0dXJuZWQgYnkgYSBzdXBlciBtZXRob2QsIG9yIGEgc3VwZXIgbWV0aG9kIGl0c2VsZiwNCgkJLy8JCWlmICJ0cnVlIiB3YXMgc3BlY2lmaWVkIGFzIG5ld0FyZ3MuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJVGhpcyBtZXRob2QgaXMgdXNlZCBpbnNpZGUgbWV0aG9kIG9mIGNsYXNzZXMgcHJvZHVjZWQgd2l0aA0KCQkvLwkJZG9qby5kZWNsYXJlIHRvIGNhbGwgYSBzdXBlciBtZXRob2QgKG5leHQgaW4gdGhlIGNoYWluKS4gSXQgaXMNCgkJLy8JCXVzZWQgZm9yIG1hbnVhbGx5IGNvbnRyb2xsZWQgY2hhaW5pbmcuIENvbnNpZGVyIHVzaW5nIHRoZSByZWd1bGFyDQoJCS8vCQljaGFpbmluZywgYmVjYXVzZSBpdCBpcyBmYXN0ZXIuIFVzZSAidGhpcy5pbmhlcml0ZWQoKSIgb25seSBpbg0KCQkvLwkJY29tcGxleCBjYXNlcy4NCgkJLy8NCgkJLy8JCVRoaXMgbWV0aG9kIGNhbm5vdCBtZSBjYWxsZWQgZnJvbSBhdXRvbWF0aWNhbGx5IGNoYWluZWQNCgkJLy8JCWNvbnN0cnVjdG9ycyBpbmNsdWRpbmcgdGhlIGNhc2Ugb2YgYSBzcGVjaWFsIChsZWdhY3kpDQoJCS8vCQljb25zdHJ1Y3RvciBjaGFpbmluZy4gSXQgY2Fubm90IGJlIGNhbGxlZCBmcm9tIGNoYWluZWQgbWV0aG9kcy4NCgkJLy8NCgkJLy8JCUlmICJ0aGlzLmluaGVyaXRlZCgpIiBjYW5ub3QgZmluZCB0aGUgbmV4dC1pbi1jaGFpbiBtZXRob2QsIGl0DQoJCS8vCQlkb2VzIG5vdGhpbmcgYW5kIHJldHVybnMgInVuZGVmaW5lZCIuIFRoZSBsYXN0IG1ldGhvZCBpbiBjaGFpbg0KCQkvLwkJY2FuIGJlIGEgZGVmYXVsdCBtZXRob2QgaW1wbGVtZW50ZWQgaW4gT2JqZWN0LCB3aGljaCB3aWxsIGJlDQoJCS8vCQljYWxsZWQgbGFzdC4NCgkJLy8NCgkJLy8JCUlmICJuYW1lIiBpcyBzcGVjaWZpZWQsIGl0IGlzIGFzc3VtZWQgdGhhdCB0aGUgbWV0aG9kIHRoYXQNCgkJLy8JCXJlY2VpdmVkICJhcmdzIiBpcyB0aGUgcGFyZW50IG1ldGhvZCBmb3IgdGhpcyBjYWxsLiBJdCBpcyBsb29rZWQNCgkJLy8JCXVwIGluIHRoZSBjaGFpbiBsaXN0IGFuZCBpZiBpdCBpcyBmb3VuZCB0aGUgbmV4dC1pbi1jaGFpbiBtZXRob2QNCgkJLy8JCWlzIGNhbGxlZC4gSWYgaXQgaXMgbm90IGZvdW5kLCB0aGUgZmlyc3QtaW4tY2hhaW4gbWV0aG9kIGlzDQoJCS8vCQljYWxsZWQuDQoJCS8vDQoJCS8vCQlJZiAibmFtZSIgaXMgbm90IHNwZWNpZmllZCwgaXQgd2lsbCBiZSBkZXJpdmVkIGZyb20gdGhlIGNhbGxpbmcNCgkJLy8JCW1ldGhvZCAodXNpbmcgYSBtZXRob2lkIHByb3BlcnR5ICJub20iKS4NCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCW1ldGhvZDE6IGZ1bmN0aW9uKGEsIGIsIGMpew0KCQkvLwl8CQkJdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJbWV0aG9kMjogZnVuY3Rpb24oYSwgYil7DQoJCS8vCXwJCQlyZXR1cm4gdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzLCBbYSArIGJdKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CS8vIG5leHQgbWV0aG9kIGlzIG5vdCBpbiB0aGUgY2hhaW4gbGlzdCBiZWNhdXNlIGl0IGlzIGFkZGVkDQoJCS8vCXwJLy8gbWFudWFsbHkgYWZ0ZXIgdGhlIGNsYXNzIHdhcyBjcmVhdGVkLg0KCQkvLwl8CUIucHJvdG90eXBlLm1ldGhvZDMgPSBmdW5jdGlvbigpew0KCQkvLwl8CQljb25zb2xlLmxvZygiVGhpcyBpcyBhIGR5bmFtaWNhbGx5LWFkZGVkIG1ldGhvZC4iKTsNCgkJLy8JfAkJdGhpcy5pbmhlcml0ZWQoIm1ldGhvZDMiLCBhcmd1bWVudHMpOw0KCQkvLwl8CX07DQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEIgPSBkb2pvLmRlY2xhcmUoQSwgew0KCQkvLwl8CQltZXRob2Q6IGZ1bmN0aW9uKGEsIGIpew0KCQkvLwl8CQkJdmFyIHN1cGVyID0gdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzLCB0cnVlKTsNCgkJLy8JfAkJCS8vIC4uLg0KCQkvLwl8CQkJaWYoIXN1cGVyKXsNCgkJLy8JfAkJCQljb25zb2xlLmxvZygidGhlcmUgaXMgbm8gc3VwZXIgbWV0aG9kIik7DQoJCS8vCXwJCQkJcmV0dXJuIDA7DQoJCS8vCXwJCQl9DQoJCS8vCXwJCQlyZXR1cm4gc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQlyZXR1cm4Je307CS8vIE9iamVjdA0KCX0NCgk9PT09PSovDQoNCgkvKj09PT09DQoJT2JqZWN0LmdldEluaGVyaXRlZCA9IGZ1bmN0aW9uKG5hbWUsIGFyZ3Mpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhIHN1cGVyIG1ldGhvZC4NCgkJLy8JbmFtZTogU3RyaW5nPw0KCQkvLwkJVGhlIG9wdGlvbmFsIG1ldGhvZCBuYW1lLiBTaG91bGQgYmUgdGhlIHNhbWUgYXMgdGhlIGNhbGxlcidzDQoJCS8vCQluYW1lLiBVc3VhbGx5ICJuYW1lIiBpcyBzcGVjaWZpZWQgaW4gY29tcGxleCBkeW5hbWljIGNhc2VzLCB3aGVuDQoJCS8vCQl0aGUgY2FsbGluZyBtZXRob2Qgd2FzIGR5bmFtaWNhbGx5IGFkZGVkLCB1bmRlY29yYXRlZCBieQ0KCQkvLwkJZG9qby5kZWNsYXJlLCBhbmQgaXQgY2Fubm90IGJlIGRldGVybWluZWQuDQoJCS8vCWFyZ3M6IEFyZ3VtZW50cw0KCQkvLwkJVGhlIGNhbGxlciBzdXBwbHkgdGhpcyBhcmd1bWVudCwgd2hpY2ggc2hvdWxkIGJlIHRoZSBvcmlnaW5hbA0KCQkvLwkJImFyZ3VtZW50cyIuDQoJCS8vCXJldHVybnM6DQoJCS8vCQlSZXR1cm5zIGEgc3VwZXIgbWV0aG9kIChGdW5jdGlvbikgb3IgInVuZGVmaW5lZCIuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJVGhpcyBtZXRob2QgaXMgYSBjb252ZW5pZW5jZSBtZXRob2QgZm9yICJ0aGlzLmluaGVyaXRlZCgpIi4NCgkJLy8JCUl0IHVzZXMgdGhlIHNhbWUgYWxnb3JpdGhtIGJ1dCBpbnN0ZWFkIG9mIGV4ZWN1dGluZyBhIHN1cGVyDQoJCS8vCQltZXRob2QsIGl0IHJldHVybnMgaXQsIG9yICJ1bmRlZmluZWQiIGlmIG5vdCBmb3VuZC4NCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCW1ldGhvZDogZnVuY3Rpb24oYSwgYil7DQoJCS8vCXwJCQl2YXIgc3VwZXIgPSB0aGlzLmdldEluaGVyaXRlZChhcmd1bWVudHMpOw0KCQkvLwl8CQkJLy8gLi4uDQoJCS8vCXwJCQlpZighc3VwZXIpew0KCQkvLwl8CQkJCWNvbnNvbGUubG9nKCJ0aGVyZSBpcyBubyBzdXBlciBtZXRob2QiKTsNCgkJLy8JfAkJCQlyZXR1cm4gMDsNCgkJLy8JfAkJCX0NCgkJLy8JfAkJCXJldHVybiBzdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkvLwl8CQl9DQoJCS8vCXwJfSk7DQoJCXJldHVybgl7fTsJLy8gT2JqZWN0DQoJfQ0KCT09PT09Ki8NCg0KCS8qPT09PT0NCglPYmplY3QuaXNJbnN0YW5jZU9mID0gZnVuY3Rpb24oY2xzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUNoZWNrcyB0aGUgaW5oZXJpdGFuY2UgY2hhaW4gdG8gc2VlIGlmIGl0IGlzIGluaGVyaXRlZCBmcm9tIHRoaXMNCgkJLy8JCWNsYXNzLg0KCQkvLwljbHM6IEZ1bmN0aW9uDQoJCS8vCQlDbGFzcyBjb25zdHJ1Y3Rvci4NCgkJLy8JcmV0dXJuczoNCgkJLy8JCSJ0cnVlIiwgaWYgdGhpcyBvYmplY3QgaXMgaW5oZXJpdGVkIGZyb20gdGhpcyBjbGFzcywgImZhbHNlIg0KCQkvLwkJb3RoZXJ3aXNlLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVRoaXMgbWV0aG9kIGlzIHVzZWQgd2l0aCBpbnN0YW5jZXMgb2YgY2xhc3NlcyBwcm9kdWNlZCB3aXRoDQoJCS8vCQlkb2pvLmRlY2xhcmUgdG8gZGV0ZXJtaW5lIG9mIHRoZXkgc3VwcG9ydCBhIGNlcnRhaW4gaW50ZXJmYWNlIG9yDQoJCS8vCQlub3QuIEl0IG1vZGVscyAiaW5zdGFuY2VvZiIgb3BlcmF0b3IuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJdmFyIEEgPSBkb2pvLmRlY2xhcmUobnVsbCwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgQiA9IGRvam8uZGVjbGFyZShudWxsLCB7DQoJCS8vCXwJCS8vIGNvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzLCBhbmQgbWV0aG9kcyBnbyBoZXJlDQoJCS8vCXwJCS8vIC4uLg0KCQkvLwl8CX0pOw0KCQkvLwl8CXZhciBDID0gZG9qby5kZWNsYXJlKFtBLCBCXSwgew0KCQkvLwl8CQkvLyBjb25zdHJ1Y3RvciwgcHJvcGVydGllcywgYW5kIG1ldGhvZHMgZ28gaGVyZQ0KCQkvLwl8CQkvLyAuLi4NCgkJLy8JfAl9KTsNCgkJLy8JfAl2YXIgRCA9IGRvam8uZGVjbGFyZShBLCB7DQoJCS8vCXwJCS8vIGNvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzLCBhbmQgbWV0aG9kcyBnbyBoZXJlDQoJCS8vCXwJCS8vIC4uLg0KCQkvLwl8CX0pOw0KCQkvLwl8DQoJCS8vCXwJdmFyIGEgPSBuZXcgQSgpLCBiID0gbmV3IEIoKSwgYyA9IG5ldyBDKCksIGQgPSBuZXcgRCgpOw0KCQkvLwl8DQoJCS8vCXwJY29uc29sZS5sb2coYS5pc0luc3RhbmNlT2YoQSkpOyAvLyB0cnVlDQoJCS8vCXwJY29uc29sZS5sb2coYi5pc0luc3RhbmNlT2YoQSkpOyAvLyBmYWxzZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGMuaXNJbnN0YW5jZU9mKEEpKTsgLy8gdHJ1ZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGQuaXNJbnN0YW5jZU9mKEEpKTsgLy8gdHJ1ZQ0KCQkvLwl8DQoJCS8vCXwJY29uc29sZS5sb2coYS5pc0luc3RhbmNlT2YoQikpOyAvLyBmYWxzZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGIuaXNJbnN0YW5jZU9mKEIpKTsgLy8gdHJ1ZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGMuaXNJbnN0YW5jZU9mKEIpKTsgLy8gdHJ1ZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGQuaXNJbnN0YW5jZU9mKEIpKTsgLy8gZmFsc2UNCgkJLy8JfA0KCQkvLwl8CWNvbnNvbGUubG9nKGEuaXNJbnN0YW5jZU9mKEMpKTsgLy8gZmFsc2UNCgkJLy8JfAljb25zb2xlLmxvZyhiLmlzSW5zdGFuY2VPZihDKSk7IC8vIGZhbHNlDQoJCS8vCXwJY29uc29sZS5sb2coYy5pc0luc3RhbmNlT2YoQykpOyAvLyB0cnVlDQoJCS8vCXwJY29uc29sZS5sb2coZC5pc0luc3RhbmNlT2YoQykpOyAvLyBmYWxzZQ0KCQkvLwl8DQoJCS8vCXwJY29uc29sZS5sb2coYS5pc0luc3RhbmNlT2YoRCkpOyAvLyBmYWxzZQ0KCQkvLwl8CWNvbnNvbGUubG9nKGIuaXNJbnN0YW5jZU9mKEQpKTsgLy8gZmFsc2UNCgkJLy8JfAljb25zb2xlLmxvZyhjLmlzSW5zdGFuY2VPZihEKSk7IC8vIGZhbHNlDQoJCS8vCXwJY29uc29sZS5sb2coZC5pc0luc3RhbmNlT2YoRCkpOyAvLyB0cnVlDQoJCXJldHVybgl7fTsJLy8gT2JqZWN0DQoJfQ0KCT09PT09Ki8NCg0KCS8qPT09PT0NCglPYmplY3QuZXh0ZW5kID0gZnVuY3Rpb24oc291cmNlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUFkZHMgYWxsIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMgb2Ygc291cmNlIHRvIGNvbnN0cnVjdG9yJ3MNCgkJLy8JCXByb3RvdHlwZSwgbWFraW5nIHRoZW0gYXZhaWxhYmxlIHRvIGFsbCBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoDQoJCS8vCQljb25zdHJ1Y3Rvci4gVGhpcyBtZXRob2QgaXMgc3BlY2lmaWMgdG8gY29uc3RydWN0b3JzIGNyZWF0ZWQgd2l0aA0KCQkvLwkJZG9qby5kZWNsYXJlLg0KCQkvLwlzb3VyY2U6IE9iamVjdA0KCQkvLwkJU291cmNlIG9iamVjdCB3aGljaCBwcm9wZXJ0aWVzIGFyZSBnb2luZyB0byBiZSBjb3BpZWQgdG8gdGhlDQoJCS8vCQljb25zdHJ1Y3RvcidzIHByb3RvdHlwZS4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlBZGRzIHNvdXJjZSBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvcidzIHByb3RvdHlwZS4gSXQgY2FuDQoJCS8vCQlvdmVycmlkZSBleGlzdGluZyBwcm9wZXJ0aWVzLg0KCQkvLw0KCQkvLwkJVGhpcyBtZXRob2QgaXMgc2ltaWxhciB0byBkb2pvLmV4dGVuZCBmdW5jdGlvbiwgYnV0IGl0IGlzIHNwZWNpZmljDQoJCS8vCQl0byBjb25zdHJ1Y3RvcnMgcHJvZHVjZWQgYnkgZG9qby5kZWNsYXJlLiBJdCBpcyBpbXBsZW1lbnRlZA0KCQkvLwkJdXNpbmcgZG9qby5zYWZlTWl4aW4sIGFuZCBpdCBza2lwcyBhIGNvbnN0cnVjdG9yIHByb3BlcnR5LA0KCQkvLwkJYW5kIHByb3Blcmx5IGRlY29yYXRlcyBjb3BpZWQgZnVuY3Rpb25zLg0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwl8CXZhciBBID0gZG9qby5kZWNsYXJlKG51bGwsIHsNCgkJLy8JfAkJbTE6IGZ1bmN0aW9uKCl7fSwNCgkJLy8JfAkJczE6ICJQb3Bva2F0ZXBldGwiDQoJCS8vCXwJfSk7DQoJCS8vCXwJQS5leHRlbmQoew0KCQkvLwl8CQltMTogZnVuY3Rpb24oKXt9LA0KCQkvLwl8CQltMjogZnVuY3Rpb24oKXt9LA0KCQkvLwl8CQlmMTogdHJ1ZSwNCgkJLy8JfAkJZDE6IDQyDQoJCS8vCXwJfSk7DQoJfTsNCgk9PT09PSovDQp9KSgpOw0KDQp9DQoNCmlmKCFkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5jb25uZWN0Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmNvbm5lY3QiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UuY29ubmVjdCIpOw0KDQoNCi8vIHRoaXMgZmlsZSBjb3VydGVzeSBvZiB0aGUgVHVyYm9BamF4IEdyb3VwLCBsaWNlbnNlZCB1bmRlciBhIERvam8gQ0xBDQoNCi8vIGxvdy1sZXZlbCBkZWxlZ2F0aW9uIG1hY2hpbmVyeQ0KZG9qby5fbGlzdGVuZXIgPSB7DQoJLy8gY3JlYXRlIGEgZGlzcGF0Y2hlciBmdW5jdGlvbg0KCWdldERpc3BhdGNoZXI6IGZ1bmN0aW9uKCl7DQoJCS8vIGZvbGxvd2luZyBjb21tZW50cyBwdWxsZWQgb3V0LW9mLWxpbmUgdG8gcHJldmVudCBjbG9uaW5nIHRoZW0gDQoJCS8vIGluIHRoZSByZXR1cm5lZCBmdW5jdGlvbi4NCgkJLy8gLSBpbmRpY2VzIChpKSB0aGF0IGFyZSByZWFsbHkgaW4gdGhlIGFycmF5IG9mIGxpc3RlbmVycyAobHMpIHdpbGwgDQoJCS8vICAgbm90IGJlIGluIEFycmF5LnByb3RvdHlwZS4gVGhpcyBpcyB0aGUgJ3NwYXJzZSBhcnJheScgdHJpY2sNCgkJLy8gICB0aGF0IGtlZXBzIHVzIHNhZmUgZnJvbSBsaWJzIHRoYXQgdGFrZSBsaWJlcnRpZXMgd2l0aCBidWlsdC1pbiANCgkJLy8gICBvYmplY3RzDQoJCS8vIC0gbGlzdGVuZXIgaXMgaW52b2tlZCB3aXRoIGN1cnJlbnQgc2NvcGUgKHRoaXMpDQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdmFyIGFwPUFycmF5LnByb3RvdHlwZSwgYz1hcmd1bWVudHMuY2FsbGVlLCBscz1jLl9saXN0ZW5lcnMsIHQ9Yy50YXJnZXQ7DQoJCQkvLyByZXR1cm4gdmFsdWUgY29tZXMgZnJvbSBvcmlnaW5hbCB0YXJnZXQgZnVuY3Rpb24NCgkJCXZhciByID0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQkvLyBtYWtlIGxvY2FsIGNvcHkgb2YgbGlzdGVuZXIgYXJyYXkgc28gaXQgaXMgaW1tdXRhYmxlIGR1cmluZyBwcm9jZXNzaW5nDQoJCQl2YXIgaSwgbGxzOw0KCQkJCQkJCQkJCQlsbHMgPSBbXS5jb25jYXQobHMpOw0KCQkJCQkJCQ0KCQkJLy8gaW52b2tlIGxpc3RlbmVycyBhZnRlciB0YXJnZXQgZnVuY3Rpb24NCgkJCWZvcihpIGluIGxscyl7DQoJCQkJaWYoIShpIGluIGFwKSl7DQoJCQkJCWxsc1tpXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJCX0NCgkJCX0NCgkJCS8vIHJldHVybiB2YWx1ZSBjb21lcyBmcm9tIG9yaWdpbmFsIHRhcmdldCBmdW5jdGlvbg0KCQkJcmV0dXJuIHI7DQoJCX07DQoJfSwNCgkvLyBhZGQgYSBsaXN0ZW5lciB0byBhbiBvYmplY3QNCglhZGQ6IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gc291cmNlLCAvKlN0cmluZyovIG1ldGhvZCwgLypGdW5jdGlvbiovIGxpc3RlbmVyKXsNCgkJLy8gV2hlbmV2ZXIgJ21ldGhvZCcgaXMgaW52b2tlZCwgJ2xpc3RlbmVyJyB3aWxsIGhhdmUgdGhlIHNhbWUgc2NvcGUuDQoJCS8vIFRyeWluZyB0byBzdXBwb3J0aW5nIGEgY29udGV4dCBvYmplY3QgZm9yIHRoZSBsaXN0ZW5lciBsZWQgdG8gDQoJCS8vIGNvbXBsZXhpdHkuIA0KCQkvLyBOb24gdHJpdmlhbCB0byBwcm92aWRlICdvbmNlJyBmdW5jdGlvbmFsaXR5IGhlcmUNCgkJLy8gYmVjYXVzZSBsaXN0ZW5lciBjb3VsZCBiZSB0aGUgcmVzdWx0IG9mIGEgZG9qby5oaXRjaCBjYWxsLA0KCQkvLyBpbiB3aGljaCBjYXNlIHR3byByZWZlcmVuY2VzIHRvIHRoZSBzYW1lIGhpdGNoIHRhcmdldCB3b3VsZCBub3QNCgkJLy8gYmUgZXF1aXZhbGVudC4gDQoJCXNvdXJjZSA9IHNvdXJjZSB8fCBkb2pvLmdsb2JhbDsNCgkJLy8gVGhlIHNvdXJjZSBtZXRob2QgaXMgZWl0aGVyIG51bGwsIGEgZGlzcGF0Y2hlciwgb3Igc29tZSBvdGhlciBmdW5jdGlvbg0KCQl2YXIgZiA9IHNvdXJjZVttZXRob2RdOw0KCQkvLyBFbnN1cmUgYSBkaXNwYXRjaGVyDQoJCWlmKCFmIHx8ICFmLl9saXN0ZW5lcnMpew0KCQkJdmFyIGQgPSBkb2pvLl9saXN0ZW5lci5nZXREaXNwYXRjaGVyKCk7DQoJCQkvLyBvcmlnaW5hbCB0YXJnZXQgZnVuY3Rpb24gaXMgc3BlY2lhbA0KCQkJZC50YXJnZXQgPSBmOw0KCQkJLy8gZGlzcGF0Y2hlciBob2xkcyBhIGxpc3Qgb2YgbGlzdGVuZXJzDQoJCQlkLl9saXN0ZW5lcnMgPSBbXTsgDQoJCQkvLyByZWRpcmVjdCBzb3VyY2UgdG8gZGlzcGF0Y2hlcg0KCQkJZiA9IHNvdXJjZVttZXRob2RdID0gZDsNCgkJfQ0KCQkvLyBUaGUgY29udHJhY3QgaXMgdGhhdCBhIGhhbmRsZSBpcyByZXR1cm5lZCB0aGF0IGNhbiANCgkJLy8gaWRlbnRpZnkgdGhpcyBsaXN0ZW5lciBmb3IgZGlzY29ubmVjdC4gDQoJCS8vDQoJCS8vIFRoZSB0eXBlIG9mIHRoZSBoYW5kbGUgaXMgcHJpdmF0ZS4gSGVyZSBpcyBpdCBpbXBsZW1lbnRlZCBhcyBJbnRlZ2VyLiANCgkJLy8gRE9NIGV2ZW50IGNvZGUgaGFzIHRoaXMgc2FtZSBjb250cmFjdCBidXQgaGFuZGxlIGlzIEZ1bmN0aW9uIA0KCQkvLyBpbiBub24tSUUgYnJvd3NlcnMuDQoJCS8vDQoJCS8vIFdlIGNvdWxkIGhhdmUgc2VwYXJhdGUgbGlzdHMgb2YgYmVmb3JlIGFuZCBhZnRlciBsaXN0ZW5lcnMuDQoJCXJldHVybiBmLl9saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7IC8qSGFuZGxlKi8NCgl9LA0KCS8vIHJlbW92ZSBhIGxpc3RlbmVyIGZyb20gYW4gb2JqZWN0DQoJcmVtb3ZlOiBmdW5jdGlvbigvKk9iamVjdCovIHNvdXJjZSwgLypTdHJpbmcqLyBtZXRob2QsIC8qSGFuZGxlKi8gaGFuZGxlKXsNCgkJdmFyIGYgPSAoc291cmNlIHx8IGRvam8uZ2xvYmFsKVttZXRob2RdOw0KCQkvLyByZW1lbWJlciB0aGF0IGhhbmRsZSBpcyB0aGUgaW5kZXgrMSAoMCBpcyBub3QgYSB2YWxpZCBoYW5kbGUpDQoJCWlmKGYgJiYgZi5fbGlzdGVuZXJzICYmIGhhbmRsZS0tKXsNCgkJCWRlbGV0ZSBmLl9saXN0ZW5lcnNbaGFuZGxlXTsNCgkJfQ0KCX0NCn07DQoNCi8vIE11bHRpcGxlIGRlbGVnYXRpb24gZm9yIGFyYml0cmFyeSBtZXRob2RzLg0KDQovLyBUaGlzIHVuaXQga25vd3Mgbm90aGluZyBhYm91dCBET00sIGJ1dCB3ZSBpbmNsdWRlIERPTSBhd2FyZSBkb2N1bWVudGF0aW9uDQovLyBhbmQgZG9udEZpeCBhcmd1bWVudCBoZXJlIHRvIGhlbHAgdGhlIGF1dG9kb2NzLiBBY3R1YWwgRE9NIGF3YXJlIGNvZGUgaXMgaW4NCi8vIGV2ZW50LmpzLg0KDQpkb2pvLmNvbm5lY3QgPSBmdW5jdGlvbigvKk9iamVjdHxudWxsKi8gb2JqLCANCgkJCQkJCS8qU3RyaW5nKi8gZXZlbnQsIA0KCQkJCQkJLypPYmplY3R8bnVsbCovIGNvbnRleHQsIA0KCQkJCQkJLypTdHJpbmd8RnVuY3Rpb24qLyBtZXRob2QsDQoJCQkJCQkvKkJvb2xlYW4/Ki8gZG9udEZpeCl7DQoJLy8gc3VtbWFyeToNCgkvLwkJYGRvam8uY29ubmVjdGAgaXMgdGhlIGNvcmUgZXZlbnQgaGFuZGxpbmcgYW5kIGRlbGVnYXRpb24gbWV0aG9kIGluDQoJLy8JCURvam8uIEl0IGFsbG93cyBvbmUgZnVuY3Rpb24gdG8gImxpc3RlbiBpbiIgb24gdGhlIGV4ZWN1dGlvbiBvZg0KCS8vCQlhbnkgb3RoZXIsIHRyaWdnZXJpbmcgdGhlIHNlY29uZCB3aGVuZXZlciB0aGUgZmlyc3QgaXMgY2FsbGVkLiBNYW55DQoJLy8JCWxpc3RlbmVycyBtYXkgYmUgYXR0YWNoZWQgdG8gYSBmdW5jdGlvbiwgYW5kIHNvdXJjZSBmdW5jdGlvbnMgbWF5DQoJLy8JCWJlIGVpdGhlciByZWd1bGFyIGZ1bmN0aW9uIGNhbGxzIG9yIERPTSBldmVudHMuDQoJLy8NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLwkJQ29ubmVjdHMgbGlzdGVuZXJzIHRvIGFjdGlvbnMsIHNvIHRoYXQgYWZ0ZXIgZXZlbnQgZmlyZXMsIGENCgkvLwkJbGlzdGVuZXIgaXMgY2FsbGVkIHdpdGggdGhlIHNhbWUgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgb3JpZ2luYWwNCgkvLwkJZnVuY3Rpb24uDQoJLy8NCgkvLwkJU2luY2UgYGRvam8uY29ubmVjdGAgYWxsb3dzIHRoZSBzb3VyY2Ugb2YgZXZlbnRzIHRvIGJlIGVpdGhlciBhDQoJLy8JCSJyZWd1bGFyIiBKYXZhU2NyaXB0IGZ1bmN0aW9uIG9yIGEgRE9NIGV2ZW50LCBpdCBwcm92aWRlcyBhIHVuaWZvcm0NCgkvLwkJaW50ZXJmYWNlIGZvciBsaXN0ZW5pbmcgdG8gYWxsIHRoZSB0eXBlcyBvZiBldmVudHMgdGhhdCBhbg0KCS8vCQlhcHBsaWNhdGlvbiBpcyBsaWtlbHkgdG8gZGVhbCB3aXRoIHRob3VnaCBhIHNpbmdsZSwgdW5pZmllZA0KCS8vCQlpbnRlcmZhY2UuIERPTSBwcm9ncmFtbWVycyBtYXkgd2FudCB0byB0aGluayBvZiBpdCBhcw0KCS8vCQkiYWRkRXZlbnRMaXN0ZW5lciBmb3IgZXZlcnl0aGluZyBhbmQgYW55dGhpbmciLg0KCS8vDQoJLy8JCVdoZW4gc2V0dGluZyB1cCBhIGNvbm5lY3Rpb24sIHRoZSBgZXZlbnRgIHBhcmFtZXRlciBtdXN0IGJlIGENCgkvLwkJc3RyaW5nIHRoYXQgaXMgdGhlIG5hbWUgb2YgdGhlIG1ldGhvZC9ldmVudCB0byBiZSBsaXN0ZW5lZCBmb3IuIElmDQoJLy8JCWBvYmpgIGlzIG51bGwsIGBkb2pvLmdsb2JhbGAgaXMgYXNzdW1lZCwgbWVhbmluZyB0aGF0IGNvbm5lY3Rpb25zDQoJLy8JCXRvIGdsb2JhbCBtZXRob2RzIGFyZSBzdXBwb3J0ZWQgYnV0IGFsc28gdGhhdCB5b3UgbWF5IGluYWR2ZXJ0ZW50bHkNCgkvLwkJY29ubmVjdCB0byBhIGdsb2JhbCBieSBwYXNzaW5nIGFuIGluY29ycmVjdCBvYmplY3QgbmFtZSBvciBpbnZhbGlkDQoJLy8JCXJlZmVyZW5jZS4NCgkvLw0KCS8vCQlgZG9qby5jb25uZWN0YCBnZW5lcmFsbHkgaXMgZm9yZ2l2aW5nLiBJZiB5b3UgcGFzcyB0aGUgbmFtZSBvZiBhDQoJLy8JCWZ1bmN0aW9uIG9yIG1ldGhvZCB0aGF0IGRvZXMgbm90IHlldCBleGlzdCBvbiBgb2JqYCwgY29ubmVjdCB3aWxsDQoJLy8JCW5vdCBmYWlsLCBidXQgd2lsbCBpbnN0ZWFkIHNldCB1cCBhIHN0dWIgbWV0aG9kLiBTaW1pbGFybHksIG51bGwNCgkvLwkJYXJndW1lbnRzIG1heSBzaW1wbHkgYmUgb21pdHRlZCBzdWNoIHRoYXQgZmV3ZXIgdGhhbiA0IGFyZ3VtZW50cw0KCS8vCQltYXkgYmUgcmVxdWlyZWQgdG8gc2V0IHVwIGEgY29ubmVjdGlvbiBTZWUgdGhlIGV4YW1wbGVzIGZvciBkZXRhaWxzLg0KCS8vDQoJLy8JCVRoZSByZXR1cm4gdmFsdWUgaXMgYSBoYW5kbGUgdGhhdCBpcyBuZWVkZWQgdG8gDQoJLy8JCXJlbW92ZSB0aGlzIGNvbm5lY3Rpb24gd2l0aCBgZG9qby5kaXNjb25uZWN0YC4NCgkvLw0KCS8vIG9iajogDQoJLy8JCVRoZSBzb3VyY2Ugb2JqZWN0IGZvciB0aGUgZXZlbnQgZnVuY3Rpb24uIA0KCS8vCQlEZWZhdWx0cyB0byBgZG9qby5nbG9iYWxgIGlmIG51bGwuDQoJLy8JCUlmIG9iaiBpcyBhIERPTSBub2RlLCB0aGUgY29ubmVjdGlvbiBpcyBkZWxlZ2F0ZWQgDQoJLy8JCXRvIHRoZSBET00gZXZlbnQgbWFuYWdlciAodW5sZXNzIGRvbnRGaXggaXMgdHJ1ZSkuDQoJLy8NCgkvLyBldmVudDoNCgkvLwkJU3RyaW5nIG5hbWUgb2YgdGhlIGV2ZW50IGZ1bmN0aW9uIGluIG9iai4gDQoJLy8JCUkuZS4gaWRlbnRpZmllcyBhIHByb3BlcnR5IGBvYmpbZXZlbnRdYC4NCgkvLw0KCS8vIGNvbnRleHQ6IA0KCS8vCQlUaGUgb2JqZWN0IHRoYXQgbWV0aG9kIHdpbGwgcmVjZWl2ZSBhcyAidGhpcyIuDQoJLy8NCgkvLwkJSWYgY29udGV4dCBpcyBudWxsIGFuZCBtZXRob2QgaXMgYSBmdW5jdGlvbiwgdGhlbiBtZXRob2QNCgkvLwkJaW5oZXJpdHMgdGhlIGNvbnRleHQgb2YgZXZlbnQuDQoJLy8JDQoJLy8JCUlmIG1ldGhvZCBpcyBhIHN0cmluZyB0aGVuIGNvbnRleHQgbXVzdCBiZSB0aGUgc291cmNlIA0KCS8vCQlvYmplY3Qgb2JqZWN0IGZvciBtZXRob2QgKGNvbnRleHRbbWV0aG9kXSkuIElmIGNvbnRleHQgaXMgbnVsbCwNCgkvLwkJZG9qby5nbG9iYWwgaXMgdXNlZC4NCgkvLw0KCS8vIG1ldGhvZDoNCgkvLwkJQSBmdW5jdGlvbiByZWZlcmVuY2UsIG9yIG5hbWUgb2YgYSBmdW5jdGlvbiBpbiBjb250ZXh0LiANCgkvLwkJVGhlIGZ1bmN0aW9uIGlkZW50aWZpZWQgYnkgbWV0aG9kIGZpcmVzIGFmdGVyIGV2ZW50IGRvZXMuIA0KCS8vCQltZXRob2QgcmVjZWl2ZXMgdGhlIHNhbWUgYXJndW1lbnRzIGFzIHRoZSBldmVudC4NCgkvLwkJU2VlIGNvbnRleHQgYXJndW1lbnQgY29tbWVudHMgZm9yIGluZm9ybWF0aW9uIG9uIG1ldGhvZCdzIHNjb3BlLg0KCS8vDQoJLy8gZG9udEZpeDoNCgkvLwkJSWYgb2JqIGlzIGEgRE9NIG5vZGUsIHNldCBkb250Rml4IHRvIHRydWUgdG8gcHJldmVudCBkZWxlZ2F0aW9uIA0KCS8vCQlvZiB0aGlzIGNvbm5lY3Rpb24gdG8gdGhlIERPTSBldmVudCBtYW5hZ2VyLg0KCS8vDQoJLy8gZXhhbXBsZToNCgkvLwkJV2hlbiBvYmoub25jaGFuZ2UoKSwgZG8gdWkudXBkYXRlKCk6DQoJLy8JfAlkb2pvLmNvbm5lY3Qob2JqLCAib25jaGFuZ2UiLCB1aSwgInVwZGF0ZSIpOw0KCS8vCXwJZG9qby5jb25uZWN0KG9iaiwgIm9uY2hhbmdlIiwgdWksIHVpLnVwZGF0ZSk7IC8vIHNhbWUNCgkvLw0KCS8vIGV4YW1wbGU6DQoJLy8JCVVzaW5nIHJldHVybiB2YWx1ZSBmb3IgZGlzY29ubmVjdDoNCgkvLwl8CXZhciBsaW5rID0gZG9qby5jb25uZWN0KG9iaiwgIm9uY2hhbmdlIiwgdWksICJ1cGRhdGUiKTsNCgkvLwl8CS4uLg0KCS8vCXwJZG9qby5kaXNjb25uZWN0KGxpbmspOw0KCS8vDQoJLy8gZXhhbXBsZToNCgkvLwkJV2hlbiBvbmdsb2JhbGV2ZW50IGV4ZWN1dGVzLCB3YXRjaGVyLmhhbmRsZXIgaXMgaW52b2tlZDoNCgkvLwl8CWRvam8uY29ubmVjdChudWxsLCAib25nbG9iYWxldmVudCIsIHdhdGNoZXIsICJoYW5kbGVyIik7DQoJLy8NCgkvLyBleGFtcGxlOg0KCS8vCQlXaGVuIG9iLm9uQ3VzdG9tRXZlbnQgZXhlY3V0ZXMsIGN1c3RvbUV2ZW50SGFuZGxlciBpcyBpbnZva2VkOg0KCS8vCXwJZG9qby5jb25uZWN0KG9iLCAib25DdXN0b21FdmVudCIsIG51bGwsICJjdXN0b21FdmVudEhhbmRsZXIiKTsNCgkvLwl8CWRvam8uY29ubmVjdChvYiwgIm9uQ3VzdG9tRXZlbnQiLCAiY3VzdG9tRXZlbnRIYW5kbGVyIik7IC8vIHNhbWUNCgkvLw0KCS8vIGV4YW1wbGU6DQoJLy8JCVdoZW4gb2Iub25DdXN0b21FdmVudCBleGVjdXRlcywgY3VzdG9tRXZlbnRIYW5kbGVyIGlzIGludm9rZWQNCgkvLwkJd2l0aCB0aGUgc2FtZSBzY29wZSAodGhpcyk6DQoJLy8JfAlkb2pvLmNvbm5lY3Qob2IsICJvbkN1c3RvbUV2ZW50IiwgbnVsbCwgY3VzdG9tRXZlbnRIYW5kbGVyKTsNCgkvLwl8CWRvam8uY29ubmVjdChvYiwgIm9uQ3VzdG9tRXZlbnQiLCBjdXN0b21FdmVudEhhbmRsZXIpOyAvLyBzYW1lDQoJLy8NCgkvLyBleGFtcGxlOg0KCS8vCQlXaGVuIGdsb2JhbEV2ZW50IGV4ZWN1dGVzLCBnbG9iYWxIYW5kbGVyIGlzIGludm9rZWQNCgkvLwkJd2l0aCB0aGUgc2FtZSBzY29wZSAodGhpcyk6DQoJLy8JfAlkb2pvLmNvbm5lY3QobnVsbCwgImdsb2JhbEV2ZW50IiwgbnVsbCwgZ2xvYmFsSGFuZGxlcik7DQoJLy8JfAlkb2pvLmNvbm5lY3QoImdsb2JhbEV2ZW50IiwgZ2xvYmFsSGFuZGxlcik7IC8vIHNhbWUNCg0KCS8vIG5vcm1hbGl6ZSBhcmd1bWVudHMNCgl2YXIgYT1hcmd1bWVudHMsIGFyZ3M9W10sIGk9MDsNCgkvLyBpZiBhWzBdIGlzIGEgU3RyaW5nLCBvYmogd2FzIG9taXR0ZWQNCglhcmdzLnB1c2goZG9qby5pc1N0cmluZyhhWzBdKSA/IG51bGwgOiBhW2krK10sIGFbaSsrXSk7DQoJLy8gaWYgdGhlIGFyZy1hZnRlci1uZXh0IGlzIGEgU3RyaW5nIG9yIEZ1bmN0aW9uLCBjb250ZXh0IHdhcyBOT1Qgb21pdHRlZA0KCXZhciBhMSA9IGFbaSsxXTsNCglhcmdzLnB1c2goZG9qby5pc1N0cmluZyhhMSl8fGRvam8uaXNGdW5jdGlvbihhMSkgPyBhW2krK10gOiBudWxsLCBhW2krK10pOw0KCS8vIGFic29yYiBhbnkgYWRkaXRpb25hbCBhcmd1bWVudHMNCglmb3IodmFyIGw9YS5sZW5ndGg7IGk8bDsgaSsrKXsJYXJncy5wdXNoKGFbaV0pOyB9DQoJLy8gZG8gdGhlIGFjdHVhbCB3b3JrDQoJcmV0dXJuIGRvam8uX2Nvbm5lY3QuYXBwbHkodGhpcywgYXJncyk7IC8qSGFuZGxlKi8NCn0NCg0KLy8gdXNlZCBieSBub24tYnJvd3NlciBob3N0ZW52cy4gYWx3YXlzIG92ZXJyaWRlbiBieSBldmVudC5qcw0KZG9qby5fY29ubmVjdCA9IGZ1bmN0aW9uKG9iaiwgZXZlbnQsIGNvbnRleHQsIG1ldGhvZCl7DQoJdmFyIGw9ZG9qby5fbGlzdGVuZXIsIGg9bC5hZGQob2JqLCBldmVudCwgZG9qby5oaXRjaChjb250ZXh0LCBtZXRob2QpKTsgDQoJcmV0dXJuIFtvYmosIGV2ZW50LCBoLCBsXTsgLy8gSGFuZGxlDQp9DQoNCmRvam8uZGlzY29ubmVjdCA9IGZ1bmN0aW9uKC8qSGFuZGxlKi8gaGFuZGxlKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlSZW1vdmUgYSBsaW5rIGNyZWF0ZWQgYnkgZG9qby5jb25uZWN0Lg0KCS8vIGRlc2NyaXB0aW9uOg0KCS8vCQlSZW1vdmVzIHRoZSBjb25uZWN0aW9uIGJldHdlZW4gZXZlbnQgYW5kIHRoZSBtZXRob2QgcmVmZXJlbmNlZCBieSBoYW5kbGUuDQoJLy8gaGFuZGxlOg0KCS8vCQl0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBkb2pvLmNvbm5lY3QgY2FsbCB0aGF0IGNyZWF0ZWQgdGhlIGNvbm5lY3Rpb24uDQoJaWYoaGFuZGxlICYmIGhhbmRsZVswXSAhPT0gdW5kZWZpbmVkKXsNCgkJZG9qby5fZGlzY29ubmVjdC5hcHBseSh0aGlzLCBoYW5kbGUpOw0KCQkvLyBsZXQncyBub3Qga2VlcCB0aGlzIHJlZmVyZW5jZQ0KCQlkZWxldGUgaGFuZGxlWzBdOw0KCX0NCn0NCg0KZG9qby5fZGlzY29ubmVjdCA9IGZ1bmN0aW9uKG9iaiwgZXZlbnQsIGhhbmRsZSwgbGlzdGVuZXIpew0KCWxpc3RlbmVyLnJlbW92ZShvYmosIGV2ZW50LCBoYW5kbGUpOw0KfQ0KDQovLyB0b3BpYyBwdWJsaXNoL3N1YnNjcmliZQ0KDQpkb2pvLl90b3BpY3MgPSB7fTsNCg0KZG9qby5zdWJzY3JpYmUgPSBmdW5jdGlvbigvKlN0cmluZyovIHRvcGljLCAvKk9iamVjdHxudWxsKi8gY29udGV4dCwgLypTdHJpbmd8RnVuY3Rpb24qLyBtZXRob2Qpew0KCS8vCXN1bW1hcnk6DQoJLy8JCUF0dGFjaCBhIGxpc3RlbmVyIHRvIGEgbmFtZWQgdG9waWMuIFRoZSBsaXN0ZW5lciBmdW5jdGlvbiBpcyBpbnZva2VkIHdoZW5ldmVyIHRoZQ0KCS8vCQluYW1lZCB0b3BpYyBpcyBwdWJsaXNoZWQgKHNlZTogZG9qby5wdWJsaXNoKS4NCgkvLwkJUmV0dXJucyBhIGhhbmRsZSB3aGljaCBpcyBuZWVkZWQgdG8gdW5zdWJzY3JpYmUgdGhpcyBsaXN0ZW5lci4NCgkvLwljb250ZXh0Og0KCS8vCQlTY29wZSBpbiB3aGljaCBtZXRob2Qgd2lsbCBiZSBpbnZva2VkLCBvciBudWxsIGZvciBkZWZhdWx0IHNjb3BlLg0KCS8vCW1ldGhvZDoNCgkvLwkJVGhlIG5hbWUgb2YgYSBmdW5jdGlvbiBpbiBjb250ZXh0LCBvciBhIGZ1bmN0aW9uIHJlZmVyZW5jZS4gVGhpcyBpcyB0aGUgZnVuY3Rpb24gdGhhdA0KCS8vCQlpcyBpbnZva2VkIHdoZW4gdG9waWMgaXMgcHVibGlzaGVkLg0KCS8vCWV4YW1wbGU6DQoJLy8JfAlkb2pvLnN1YnNjcmliZSgiYWxlcnRzIiwgbnVsbCwgZnVuY3Rpb24oY2FwdGlvbiwgbWVzc2FnZSl7IGFsZXJ0KGNhcHRpb24gKyAiXG4iICsgbWVzc2FnZSk7IH0pOw0KCS8vCXwJZG9qby5wdWJsaXNoKCJhbGVydHMiLCBbICJyZWFkIHRoaXMiLCAiaGVsbG8gd29ybGQiIF0pOwkJCQkJCQkJCQkJCQkJCQkJDQoNCgkvLyBzdXBwb3J0IGZvciAyIGFyZ3VtZW50IGludm9jYXRpb24gKG9taXR0aW5nIGNvbnRleHQpIGRlcGVuZHMgb24gaGl0Y2gNCglyZXR1cm4gW3RvcGljLCBkb2pvLl9saXN0ZW5lci5hZGQoZG9qby5fdG9waWNzLCB0b3BpYywgZG9qby5oaXRjaChjb250ZXh0LCBtZXRob2QpKV07IC8qSGFuZGxlKi8NCn0NCg0KZG9qby51bnN1YnNjcmliZSA9IGZ1bmN0aW9uKC8qSGFuZGxlKi8gaGFuZGxlKXsNCgkvLwlzdW1tYXJ5Og0KCS8vCSAJUmVtb3ZlIGEgdG9waWMgbGlzdGVuZXIuIA0KCS8vCWhhbmRsZToNCgkvLwkgCVRoZSBoYW5kbGUgcmV0dXJuZWQgZnJvbSBhIGNhbGwgdG8gc3Vic2NyaWJlLg0KCS8vCWV4YW1wbGU6DQoJLy8JfAl2YXIgYWxlcnRlciA9IGRvam8uc3Vic2NyaWJlKCJhbGVydHMiLCBudWxsLCBmdW5jdGlvbihjYXB0aW9uLCBtZXNzYWdlKXsgYWxlcnQoY2FwdGlvbiArICJcbiIgKyBtZXNzYWdlKTsgfTsNCgkvLwl8CS4uLg0KCS8vCXwJZG9qby51bnN1YnNjcmliZShhbGVydGVyKTsNCglpZihoYW5kbGUpew0KCQlkb2pvLl9saXN0ZW5lci5yZW1vdmUoZG9qby5fdG9waWNzLCBoYW5kbGVbMF0sIGhhbmRsZVsxXSk7DQoJfQ0KfQ0KDQpkb2pvLnB1Ymxpc2ggPSBmdW5jdGlvbigvKlN0cmluZyovIHRvcGljLCAvKkFycmF5Ki8gYXJncyl7DQoJLy8Jc3VtbWFyeToNCgkvLwkgCUludm9rZSBhbGwgbGlzdGVuZXIgbWV0aG9kIHN1YnNjcmliZWQgdG8gdG9waWMuDQoJLy8JdG9waWM6DQoJLy8JIAlUaGUgbmFtZSBvZiB0aGUgdG9waWMgdG8gcHVibGlzaC4NCgkvLwlhcmdzOg0KCS8vCSAJQW4gYXJyYXkgb2YgYXJndW1lbnRzLiBUaGUgYXJndW1lbnRzIHdpbGwgYmUgYXBwbGllZCANCgkvLwkgCXRvIGVhY2ggdG9waWMgc3Vic2NyaWJlciAoYXMgZmlyc3QgY2xhc3MgcGFyYW1ldGVycywgdmlhIGFwcGx5KS4NCgkvLwlleGFtcGxlOg0KCS8vCXwJZG9qby5zdWJzY3JpYmUoImFsZXJ0cyIsIG51bGwsIGZ1bmN0aW9uKGNhcHRpb24sIG1lc3NhZ2UpeyBhbGVydChjYXB0aW9uICsgIlxuIiArIG1lc3NhZ2UpOyB9Ow0KCS8vCXwJZG9qby5wdWJsaXNoKCJhbGVydHMiLCBbICJyZWFkIHRoaXMiLCAiaGVsbG8gd29ybGQiIF0pOwkNCg0KCS8vIE5vdGUgdGhhdCBhcmdzIGlzIGFuIGFycmF5LCB3aGljaCBpcyBtb3JlIGVmZmljaWVudCB2cyB2YXJpYWJsZSBsZW5ndGgNCgkvLyBhcmd1bWVudCBsaXN0LiAgSWRlYWxseSwgdmFyIGFyZ3Mgd291bGQgYmUgaW1wbGVtZW50ZWQgdmlhIEFycmF5DQoJLy8gdGhyb3VnaG91dCB0aGUgQVBJcy4NCgl2YXIgZiA9IGRvam8uX3RvcGljc1t0b3BpY107DQoJaWYoZil7DQoJCWYuYXBwbHkodGhpcywgYXJnc3x8W10pOw0KCX0NCn0NCg0KZG9qby5jb25uZWN0UHVibGlzaGVyID0gZnVuY3Rpb24oCS8qU3RyaW5nKi8gdG9waWMsIA0KCQkJCQkJCQkJLypPYmplY3R8bnVsbCovIG9iaiwgDQoJCQkJCQkJCQkvKlN0cmluZyovIGV2ZW50KXsNCgkvLwlzdW1tYXJ5Og0KCS8vCSAJRW5zdXJlIHRoYXQgZXZlcnkgdGltZSBvYmouZXZlbnQoKSBpcyBjYWxsZWQsIGEgbWVzc2FnZSBpcyBwdWJsaXNoZWQNCgkvLwkgCW9uIHRoZSB0b3BpYy4gUmV0dXJucyBhIGhhbmRsZSB3aGljaCBjYW4gYmUgcGFzc2VkIHRvDQoJLy8JIAlkb2pvLmRpc2Nvbm5lY3QoKSB0byBkaXNhYmxlIHN1YnNlcXVlbnQgYXV0b21hdGljIHB1YmxpY2F0aW9uIG9uDQoJLy8JIAl0aGUgdG9waWMuDQoJLy8JdG9waWM6DQoJLy8JIAlUaGUgbmFtZSBvZiB0aGUgdG9waWMgdG8gcHVibGlzaC4NCgkvLwlvYmo6IA0KCS8vCSAJVGhlIHNvdXJjZSBvYmplY3QgZm9yIHRoZSBldmVudCBmdW5jdGlvbi4gRGVmYXVsdHMgdG8gZG9qby5nbG9iYWwNCgkvLwkgCWlmIG51bGwuDQoJLy8JZXZlbnQ6DQoJLy8JIAlUaGUgbmFtZSBvZiB0aGUgZXZlbnQgZnVuY3Rpb24gaW4gb2JqLiANCgkvLwkgCUkuZS4gaWRlbnRpZmllcyBhIHByb3BlcnR5IG9ialtldmVudF0uDQoJLy8JZXhhbXBsZToNCgkvLwl8CWRvam8uY29ubmVjdFB1Ymxpc2hlcigiL2FqYXgvc3RhcnQiLCBkb2pvLCAieGhyR2V0Iik7DQoJdmFyIHBmID0gZnVuY3Rpb24oKXsgZG9qby5wdWJsaXNoKHRvcGljLCBhcmd1bWVudHMpOyB9DQoJcmV0dXJuIGV2ZW50ID8gZG9qby5jb25uZWN0KG9iaiwgZXZlbnQsIHBmKSA6IGRvam8uY29ubmVjdChvYmosIHBmKTsgLy9IYW5kbGUNCn07DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLkRlZmVycmVkIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLkRlZmVycmVkIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLkRlZmVycmVkIik7DQoNCg0KKGZ1bmN0aW9uKCl7DQoJdmFyIG11dGF0b3IgPSBmdW5jdGlvbigpe307CQkNCgl2YXIgZnJlZXplID0gT2JqZWN0LmZyZWV6ZSB8fCBmdW5jdGlvbigpe307DQoJLy8gQSBkZWZlcnJlZCBwcm92aWRlcyBhbiBBUEkgZm9yIGNyZWF0aW5nIGFuZCByZXNvbHZpbmcgYSBwcm9taXNlLg0KCWRvam8uRGVmZXJyZWQgPSBmdW5jdGlvbigvKkZ1bmN0aW9uPyovY2FuY2VsbGVyKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlEZWZlcnJlZHMgcHJvdmlkZSBhIGdlbmVyaWMgbWVhbnMgZm9yIGVuY2Fwc3VsYXRpbmcgYW4gYXN5bmNocm9ub3VzDQoJLy8gCQlvcGVyYXRpb24gYW5kIG5vdGlmeWluZyB1c2VycyBvZiB0aGUgY29tcGxldGlvbiBhbmQgcmVzdWx0IG9mIHRoZSBvcGVyYXRpb24uIA0KCS8vIGRlc2NyaXB0aW9uOg0KCS8vCQlUaGUgZG9qby5EZWZlcnJlZCBBUEkgaXMgYmFzZWQgb24gdGhlIGNvbmNlcHQgb2YgcHJvbWlzZXMgdGhhdCBwcm92aWRlIGENCgkvLwkJZ2VuZXJpYyBpbnRlcmZhY2UgaW50byB0aGUgZXZlbnR1YWwgY29tcGxldGlvbiBvZiBhbiBhc3luY2hyb25vdXMgYWN0aW9uLg0KCS8vCQlUaGUgbW90aXZhdGlvbiBmb3IgcHJvbWlzZXMgZnVuZGFtZW50YWxseSBpcyBhYm91dCBjcmVhdGluZyBhIA0KCS8vCQlzZXBhcmF0aW9uIG9mIGNvbmNlcm5zIHRoYXQgYWxsb3dzIG9uZSB0byBhY2hpZXZlIHRoZSBzYW1lIHR5cGUgb2YgDQoJLy8JCWNhbGwgcGF0dGVybnMgYW5kIGxvZ2ljYWwgZGF0YSBmbG93IGluIGFzeW5jaHJvbm91cyBjb2RlIGFzIGNhbiBiZSANCgkvLwkJYWNoaWV2ZWQgaW4gc3luY2hyb25vdXMgY29kZS4gUHJvbWlzZXMgYWxsb3dzIG9uZSANCgkvLwkJdG8gYmUgYWJsZSB0byBjYWxsIGEgZnVuY3Rpb24gcHVyZWx5IHdpdGggYXJndW1lbnRzIG5lZWRlZCBmb3IgDQoJLy8JCWV4ZWN1dGlvbiwgd2l0aG91dCBjb25mbGF0aW5nIHRoZSBjYWxsIHdpdGggY29uY2VybnMgb2Ygd2hldGhlciBpdCBpcyANCgkvLwkJc3luYyBvciBhc3luYy4gT25lIHNob3VsZG4ndCBuZWVkIHRvIGFsdGVyIGEgY2FsbCdzIGFyZ3VtZW50cyBpZiB0aGUgDQoJLy8JCWltcGxlbWVudGF0aW9uIHN3aXRjaGVzIGZyb20gc3luYyB0byBhc3luYyAob3IgdmljZSB2ZXJzYSkuIEJ5IGhhdmluZyANCgkvLwkJYXN5bmMgZnVuY3Rpb25zIHJldHVybiBwcm9taXNlcywgdGhlIGNvbmNlcm5zIG9mIG1ha2luZyB0aGUgY2FsbCBhcmUgDQoJLy8JCXNlcGFyYXRlZCBmcm9tIHRoZSBjb25jZXJucyBvZiBhc3luY2hyb25vdXMgaW50ZXJhY3Rpb24gKHdoaWNoIGFyZSANCgkvLwkJaGFuZGxlZCBieSB0aGUgcHJvbWlzZSkuDQoJLy8gDQoJLy8gIAlUaGUgZG9qby5EZWZlcnJlZCBpcyBhIHR5cGUgb2YgcHJvbWlzZSB0aGF0IHByb3ZpZGVzIG1ldGhvZHMgZm9yIGZ1bGZpbGxpbmcgdGhlIA0KCS8vIAkJcHJvbWlzZSB3aXRoIGEgc3VjY2Vzc2Z1bCByZXN1bHQgb3IgYW4gZXJyb3IuIFRoZSBtb3N0IGltcG9ydGFudCBtZXRob2QgZm9yIA0KCS8vIAkJd29ya2luZyB3aXRoIERvam8ncyBwcm9taXNlcyBpcyB0aGUgdGhlbigpIG1ldGhvZCwgd2hpY2ggZm9sbG93cyB0aGUgDQoJLy8gCQlDb21tb25KUyBwcm9wb3NlZCBwcm9taXNlIEFQSS4gQW4gZXhhbXBsZSBvZiB1c2luZyBhIERvam8gcHJvbWlzZToNCgkvLwkJDQoJLy8JCXwgCXZhciByZXN1bHRpbmdQcm9taXNlID0gc29tZUFzeW5jT3BlcmF0aW9uLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXsNCgkvLwkJfAkJLi4uIGhhbmRsZSByZXN1bHQgLi4uDQoJLy8JCXwJfSwNCgkvLwkJfAlmdW5jdGlvbihlcnJvcil7DQoJLy8JCXwJCS4uLiBoYW5kbGUgZXJyb3IgLi4uDQoJLy8JCXwJfSk7DQoJLy8JDQoJLy8JCVRoZSAudGhlbigpIGNhbGwgcmV0dXJucyBhIG5ldyBwcm9taXNlIHRoYXQgcmVwcmVzZW50cyB0aGUgcmVzdWx0IG9mIHRoZSANCgkvLyAJCWV4ZWN1dGlvbiBvZiB0aGUgY2FsbGJhY2suIFRoZSBjYWxsYmFja3Mgd2lsbCBuZXZlciBhZmZlY3QgdGhlIG9yaWdpbmFsIHByb21pc2VzIHZhbHVlLg0KCS8vDQoJLy8JCVRoZSBkb2pvLkRlZmVycmVkIGluc3RhbmNlcyBhbHNvIHByb3ZpZGUgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5Og0KCS8vDQoJLy8JCQkqIGFkZENhbGxiYWNrKGhhbmRsZXIpDQoJLy8JCQkqIGFkZEVycmJhY2soaGFuZGxlcikNCgkvLwkJCSogY2FsbGJhY2socmVzdWx0KQ0KCS8vCQkJKiBlcnJiYWNrKHJlc3VsdCkNCgkvLw0KCS8vCQlDYWxsYmFja3MgYXJlIGFsbG93ZWQgdG8gcmV0dXJuIHByb21pc2VzdGhlbXNlbHZlcywgc28NCgkvLwkJeW91IGNhbiBidWlsZCBjb21wbGljYXRlZCBzZXF1ZW5jZXMgb2YgZXZlbnRzIHdpdGggZWFzZS4NCgkvLw0KCS8vCQlUaGUgY3JlYXRvciBvZiB0aGUgRGVmZXJyZWQgbWF5IHNwZWNpZnkgYSBjYW5jZWxsZXIuICBUaGUgY2FuY2VsbGVyDQoJLy8JCWlzIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBpZiBEZWZlcnJlZC5jYW5jZWwgaXMgY2FsbGVkDQoJLy8JCWJlZm9yZSB0aGUgRGVmZXJyZWQgZmlyZXMuIFlvdSBjYW4gdXNlIHRoaXMgdG8gaW1wbGVtZW50IGNsZWFuDQoJLy8JCWFib3J0aW5nIG9mIGFuIFhNTEh0dHBSZXF1ZXN0LCBldGMuIE5vdGUgdGhhdCBjYW5jZWwgd2lsbCBmaXJlIHRoZQ0KCS8vCQlkZWZlcnJlZCB3aXRoIGEgQ2FuY2VsbGVkRXJyb3IgKHVubGVzcyB5b3VyIGNhbmNlbGxlciByZXR1cm5zDQoJLy8JCWFub3RoZXIga2luZCBvZiBlcnJvciksIHNvIHRoZSBlcnJiYWNrcyBzaG91bGQgYmUgcHJlcGFyZWQgdG8NCgkvLwkJaGFuZGxlIHRoYXQgZXJyb3IgZm9yIGNhbmNlbGxhYmxlIERlZmVycmVkcy4NCgkvLyBleGFtcGxlOg0KCS8vCXwJdmFyIGRlZmVycmVkID0gbmV3IGRvam8uRGVmZXJyZWQoKTsNCgkvLwl8CXNldFRpbWVvdXQoZnVuY3Rpb24oKXsgZGVmZXJyZWQuY2FsbGJhY2soe3N1Y2Nlc3M6IHRydWV9KTsgfSwgMTAwMCk7DQoJLy8JfAlyZXR1cm4gZGVmZXJyZWQ7DQoJLy8gZXhhbXBsZToNCgkvLwkJRGVmZXJyZWQgb2JqZWN0cyBhcmUgb2Z0ZW4gdXNlZCB3aGVuIG1ha2luZyBjb2RlIGFzeW5jaHJvbm91cy4gSXQNCgkvLwkJbWF5IGJlIGVhc2llc3QgdG8gd3JpdGUgZnVuY3Rpb25zIGluIGEgc3luY2hyb25vdXMgbWFubmVyIGFuZCB0aGVuDQoJLy8JCXNwbGl0IGNvZGUgdXNpbmcgYSBkZWZlcnJlZCB0byB0cmlnZ2VyIGEgcmVzcG9uc2UgdG8gYSBsb25nLWxpdmVkDQoJLy8JCW9wZXJhdGlvbi4gRm9yIGV4YW1wbGUsIGluc3RlYWQgb2YgcmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbiB0bw0KCS8vCQlkZW5vdGUgd2hlbiBhIHJlbmRlcmluZyBvcGVyYXRpb24gY29tcGxldGVzLCB0aGUgZnVuY3Rpb24gY2FuDQoJLy8JCXNpbXBseSByZXR1cm4gYSBkZWZlcnJlZDoNCgkvLw0KCS8vCQl8CS8vIGNhbGxiYWNrIHN0eWxlOg0KCS8vCQl8CWZ1bmN0aW9uIHJlbmRlckxvdHNPZkRhdGEoZGF0YSwgY2FsbGJhY2spew0KCS8vCQl8CQl2YXIgc3VjY2VzcyA9IGZhbHNlDQoJLy8JCXwJCXRyeXsNCgkvLwkJfAkJCWZvcih2YXIgeCBpbiBkYXRhKXsNCgkvLwkJfAkJCQlyZW5kZXJEYXRhaXRlbShkYXRhW3hdKTsNCgkvLwkJfAkJCX0NCgkvLwkJfAkJCXN1Y2Nlc3MgPSB0cnVlOw0KCS8vCQl8CQl9Y2F0Y2goZSl7IH0NCgkvLwkJfAkJaWYoY2FsbGJhY2spew0KCS8vCQl8CQkJY2FsbGJhY2soc3VjY2Vzcyk7DQoJLy8JCXwJCX0NCgkvLwkJfAl9DQoJLy8NCgkvLwkJfAkvLyB1c2luZyBjYWxsYmFjayBzdHlsZQ0KCS8vCQl8CXJlbmRlckxvdHNPZkRhdGEoc29tZURhdGFPYmosIGZ1bmN0aW9uKHN1Y2Nlc3Mpew0KCS8vCQl8CQkvLyBoYW5kbGVzIHN1Y2Nlc3Mgb3IgZmFpbHVyZQ0KCS8vCQl8CQlpZighc3VjY2Vzcyl7DQoJLy8JCXwJCQlwcm9tcHRVc2VyVG9SZWNvdmVyKCk7DQoJLy8JCXwJCX0NCgkvLwkJfAl9KTsNCgkvLwkJfAkvLyBOT1RFOiBubyB3YXkgdG8gYWRkIGFub3RoZXIgY2FsbGJhY2sgaGVyZSEhDQoJLy8gZXhhbXBsZToNCgkvLwkJVXNpbmcgYSBEZWZlcnJlZCBkb2Vzbid0IHNpbXBsaWZ5IHRoZSBzZW5kaW5nIGNvZGUgYW55LCBidXQgaXQNCgkvLwkJcHJvdmlkZXMgYSBzdGFuZGFyZCBpbnRlcmZhY2UgZm9yIGNhbGxlcnMgYW5kIHNlbmRlcnMgYWxpa2UsDQoJLy8JCXByb3ZpZGluZyBib3RoIHdpdGggYSBzaW1wbGUgd2F5IHRvIHNlcnZpY2UgbXVsdGlwbGUgY2FsbGJhY2tzIGZvcg0KCS8vCQlhbiBvcGVyYXRpb24gYW5kIGZyZWVpbmcgYm90aCBzaWRlcyBmcm9tIHdvcnJ5aW5nIGFib3V0IGRldGFpbHMNCgkvLwkJc3VjaCBhcyAiZGlkIHRoaXMgZ2V0IGNhbGxlZCBhbHJlYWR5PyIuIFdpdGggRGVmZXJyZWRzLCBuZXcNCgkvLwkJY2FsbGJhY2tzIGNhbiBiZSBhZGRlZCBhdCBhbnkgdGltZS4NCgkvLw0KCS8vCQl8CS8vIERlZmVycmVkIHN0eWxlOg0KCS8vCQl8CWZ1bmN0aW9uIHJlbmRlckxvdHNPZkRhdGEoZGF0YSl7DQoJLy8JCXwJCXZhciBkID0gbmV3IGRvam8uRGVmZXJyZWQoKTsNCgkvLwkJfAkJdHJ5ew0KCS8vCQl8CQkJZm9yKHZhciB4IGluIGRhdGEpew0KCS8vCQl8CQkJCXJlbmRlckRhdGFpdGVtKGRhdGFbeF0pOw0KCS8vCQl8CQkJfQ0KCS8vCQl8CQkJZC5jYWxsYmFjayh0cnVlKTsNCgkvLwkJfAkJfWNhdGNoKGUpeyANCgkvLwkJfAkJCWQuZXJyYmFjayhuZXcgRXJyb3IoInJlbmRlcmluZyBmYWlsZWQiKSk7DQoJLy8JCXwJCX0NCgkvLwkJfAkJcmV0dXJuIGQ7DQoJLy8JCXwJfQ0KCS8vDQoJLy8JCXwJLy8gdXNpbmcgRGVmZXJyZWQgc3R5bGUNCgkvLwkJfAlyZW5kZXJMb3RzT2ZEYXRhKHNvbWVEYXRhT2JqKS50aGVuKG51bGwsIGZ1bmN0aW9uKCl7DQoJLy8JCXwJCXByb21wdFVzZXJUb1JlY292ZXIoKTsNCgkvLwkJfAl9KTsNCgkvLwkJfAkvLyBOT1RFOiBhZGRFcnJiYWNrIGFuZCBhZGRDYWxsYmFjayBib3RoIHJldHVybiB0aGUgRGVmZXJyZWQNCgkvLwkJfAkvLyBhZ2Fpbiwgc28gd2UgY291bGQgY2hhaW4gYWRkaW5nIGNhbGxiYWNrcyBvciBzYXZlIHRoZQ0KCS8vCQl8CS8vIGRlZmVycmVkIGZvciBsYXRlciBzaG91bGQgd2UgbmVlZCB0byBiZSBub3RpZmllZCBhZ2Fpbi4NCgkvLyBleGFtcGxlOg0KCS8vCQlJbiB0aGlzIGV4YW1wbGUsIHJlbmRlckxvdHNPZkRhdGEgaXMgc3luY3Job25vdXMgYW5kIHNvIGJvdGgNCgkvLwkJdmVyc2lvbnMgYXJlIHByZXR0eSBhcnRpZmljaWFsLiBQdXR0aW5nIHRoZSBkYXRhIGRpc3BsYXkgb24gYQ0KCS8vCQl0aW1lb3V0IGhlbHBzIHNob3cgd2h5IERlZmVycmVkcyByb2NrOg0KCS8vDQoJLy8JCXwJLy8gRGVmZXJyZWQgc3R5bGUgYW5kIGFzeW5jIGZ1bmMNCgkvLwkJfAlmdW5jdGlvbiByZW5kZXJMb3RzT2ZEYXRhKGRhdGEpew0KCS8vCQl8CQl2YXIgZCA9IG5ldyBkb2pvLkRlZmVycmVkKCk7DQoJLy8JCXwJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkvLwkJfAkJCXRyeXsNCgkvLwkJfAkJCQlmb3IodmFyIHggaW4gZGF0YSl7DQoJLy8JCXwJCQkJCXJlbmRlckRhdGFpdGVtKGRhdGFbeF0pOw0KCS8vCQl8CQkJCX0NCgkvLwkJfAkJCQlkLmNhbGxiYWNrKHRydWUpOw0KCS8vCQl8CQkJfWNhdGNoKGUpeyANCgkvLwkJfAkJCQlkLmVycmJhY2sobmV3IEVycm9yKCJyZW5kZXJpbmcgZmFpbGVkIikpOw0KCS8vCQl8CQkJfQ0KCS8vCQl8CQl9LCAxMDApOw0KCS8vCQl8CQlyZXR1cm4gZDsNCgkvLwkJfAl9DQoJLy8NCgkvLwkJfAkvLyB1c2luZyBEZWZlcnJlZCBzdHlsZQ0KCS8vCQl8CXJlbmRlckxvdHNPZkRhdGEoc29tZURhdGFPYmopLnRoZW4obnVsbCwgZnVuY3Rpb24oKXsNCgkvLwkJfAkJcHJvbXB0VXNlclRvUmVjb3ZlcigpOw0KCS8vCQl8CX0pOw0KCS8vDQoJLy8JCU5vdGUgdGhhdCB0aGUgY2FsbGVyIGRvZXNuJ3QgaGF2ZSB0byBjaGFuZ2UgaGlzIGNvZGUgYXQgYWxsIHRvDQoJLy8JCWhhbmRsZSB0aGUgYXN5bmNocm9ub3VzIGNhc2UuDQoJCXZhciByZXN1bHQsIGZpbmlzaGVkLCBpc0Vycm9yLCBoZWFkLCBuZXh0TGlzdGVuZXI7DQoJCXZhciBwcm9taXNlID0gdGhpcy5wcm9taXNlID0ge307DQoJCQ0KCQlmdW5jdGlvbiBjb21wbGV0ZSh2YWx1ZSl7DQoJCQlpZihmaW5pc2hlZCl7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJUaGlzIGRlZmVycmVkIGhhcyBhbHJlYWR5IGJlZW4gcmVzb2x2ZWQiKTsJCQkJDQoJCQl9DQoJCQlyZXN1bHQgPSB2YWx1ZTsNCgkJCWZpbmlzaGVkID0gdHJ1ZTsNCgkJCW5vdGlmeSgpOw0KCQl9DQoJCWZ1bmN0aW9uIG5vdGlmeSgpew0KCQkJdmFyIG11dGF0ZWQ7DQoJCQl3aGlsZSghbXV0YXRlZCAmJiBuZXh0TGlzdGVuZXIpew0KCQkJCXZhciBsaXN0ZW5lciA9IG5leHRMaXN0ZW5lcjsNCgkJCQluZXh0TGlzdGVuZXIgPSBuZXh0TGlzdGVuZXIubmV4dDsNCgkJCQlpZihtdXRhdGVkID0gKGxpc3RlbmVyLnByb2dyZXNzID09IG11dGF0b3IpKXsgLy8gYXNzaWdubWVudCBhbmQgY2hlY2sNCgkJCQkJZmluaXNoZWQgPSBmYWxzZTsNCgkJCQl9DQoJCQkJdmFyIGZ1bmMgPSAoaXNFcnJvciA/IGxpc3RlbmVyLmVycm9yIDogbGlzdGVuZXIucmVzb2x2ZWQpOw0KCQkJCWlmIChmdW5jKSB7DQoJCQkJCXRyeSB7DQoJCQkJCQl2YXIgbmV3UmVzdWx0ID0gZnVuYyhyZXN1bHQpOw0KCQkJCQkJaWYgKG5ld1Jlc3VsdCAmJiB0eXBlb2YgbmV3UmVzdWx0LnRoZW4gPT09ICJmdW5jdGlvbiIpIHsNCgkJCQkJCQluZXdSZXN1bHQudGhlbihkb2pvLmhpdGNoKGxpc3RlbmVyLmRlZmVycmVkLCAicmVzb2x2ZSIpLCBkb2pvLmhpdGNoKGxpc3RlbmVyLmRlZmVycmVkLCAicmVqZWN0IikpOw0KCQkJCQkJCWNvbnRpbnVlOw0KCQkJCQkJfQ0KCQkJCQkJdmFyIHVuY2hhbmdlZCA9IG11dGF0ZWQgJiYgbmV3UmVzdWx0ID09PSB1bmRlZmluZWQ7DQoJCQkJCQlsaXN0ZW5lci5kZWZlcnJlZFt1bmNoYW5nZWQgJiYgaXNFcnJvciA/ICJyZWplY3QiIDogInJlc29sdmUiXSh1bmNoYW5nZWQgPyByZXN1bHQgOiBuZXdSZXN1bHQpOw0KCQkJCQl9DQoJCQkJCWNhdGNoIChlKSB7DQoJCQkJCQlsaXN0ZW5lci5kZWZlcnJlZC5yZWplY3QoZSk7DQoJCQkJCX0NCgkJCQl9ZWxzZSB7DQoJCQkJCWlmKGlzRXJyb3Ipew0KCQkJCQkJbGlzdGVuZXIuZGVmZXJyZWQucmVqZWN0KHJlc3VsdCk7DQoJCQkJCX1lbHNlew0KCQkJCQkJbGlzdGVuZXIuZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQkNCgkJfQ0KCQkvLyBjYWxsaW5nIHJlc29sdmUgd2lsbCByZXNvbHZlIHRoZSBwcm9taXNlDQoJCXRoaXMucmVzb2x2ZSA9IHRoaXMuY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUZ1bGZpbGxzIHRoZSBEZWZlcnJlZCBpbnN0YW5jZSBzdWNjZXNzZnVsbHkgd2l0aCB0aGUgcHJvdmlkZSB2YWx1ZQ0KCQkJdGhpcy5maXJlZCA9IDA7DQoJCQl0aGlzLnJlc3VsdHMgPSBbdmFsdWUsIG51bGxdOw0KCQkJY29tcGxldGUodmFsdWUpOw0KCQl9Ow0KCQkNCgkJDQoJCS8vIGNhbGxpbmcgZXJyb3Igd2lsbCBpbmRpY2F0ZSB0aGF0IHRoZSBwcm9taXNlIGZhaWxlZA0KCQl0aGlzLnJlamVjdCA9IHRoaXMuZXJyYmFjayA9IGZ1bmN0aW9uKGVycm9yKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJRnVsZmlsbHMgdGhlIERlZmVycmVkIGluc3RhbmNlIGFzIGFuIGVycm9yIHdpdGggdGhlIHByb3ZpZGVkIGVycm9yIA0KCQkJaXNFcnJvciA9IHRydWU7DQoJCQl0aGlzLmZpcmVkID0gMTsNCgkJCWNvbXBsZXRlKGVycm9yKTsNCgkJCXRoaXMucmVzdWx0cyA9IFtudWxsLCBlcnJvcl07DQoJCQlpZighZXJyb3IgfHwgZXJyb3IubG9nICE9PSBmYWxzZSl7DQoJCQkJKGRvam8uY29uZmlnLmRlZmVycmVkT25FcnJvciB8fCBmdW5jdGlvbih4KXsgY29uc29sZS5lcnJvcih4KTsgfSkoZXJyb3IpOw0KCQkJfQ0KCQl9Ow0KCQkvLyBjYWxsIHByb2dyZXNzIHRvIHByb3ZpZGUgdXBkYXRlcyBvbiB0aGUgcHJvZ3Jlc3Mgb24gdGhlIGNvbXBsZXRpb24gb2YgdGhlIHByb21pc2UNCgkJdGhpcy5wcm9ncmVzcyA9IGZ1bmN0aW9uKHVwZGF0ZSl7DQoJCQkvLyBzdW1tYXJ5DQoJCQkvLwkJU2VuZCBwcm9ncmVzcyBldmVudHMgdG8gYWxsIGxpc3RlbmVycw0KCQkJdmFyIGxpc3RlbmVyID0gbmV4dExpc3RlbmVyOw0KCQkJd2hpbGUobGlzdGVuZXIpew0KCQkJCXZhciBwcm9ncmVzcyA9IGxpc3RlbmVyLnByb2dyZXNzOw0KCQkJCXByb2dyZXNzICYmIHByb2dyZXNzKHVwZGF0ZSk7DQoJCQkJbGlzdGVuZXIgPSBsaXN0ZW5lci5uZXh0OwkNCgkJCX0NCgkJfTsNCgkJdGhpcy5hZGRDYWxsYmFja3MgPSBmdW5jdGlvbigvKkZ1bmN0aW9uPyovY2FsbGJhY2ssIC8qRnVuY3Rpb24/Ki9lcnJiYWNrKXsNCgkJCXRoaXMudGhlbihjYWxsYmFjaywgZXJyYmFjaywgbXV0YXRvcik7DQoJCQlyZXR1cm4gdGhpczsNCgkJfTsNCgkJLy8gcHJvdmlkZSB0aGUgaW1wbGVtZW50YXRpb24gb2YgdGhlIHByb21pc2UNCgkJdGhpcy50aGVuID0gcHJvbWlzZS50aGVuID0gZnVuY3Rpb24oLypGdW5jdGlvbj8qL3Jlc29sdmVkQ2FsbGJhY2ssIC8qRnVuY3Rpb24/Ki9lcnJvckNhbGxiYWNrLCAvKkZ1bmN0aW9uPyovcHJvZ3Jlc3NDYWxsYmFjayl7DQoJCQkvLyBzdW1tYXJ5DQoJCQkvLyAJCUFkZHMgYSBmdWxmaWxsZWRIYW5kbGVyLCBlcnJvckhhbmRsZXIsIGFuZCBwcm9ncmVzc0hhbmRsZXIgdG8gYmUgY2FsbGVkIGZvciANCgkJCS8vIAkJY29tcGxldGlvbiBvZiBhIHByb21pc2UuIFRoZSBmdWxmaWxsZWRIYW5kbGVyIGlzIGNhbGxlZCB3aGVuIHRoZSBwcm9taXNlIA0KCQkJLy8gCQlpcyBmdWxmaWxsZWQuIFRoZSBlcnJvckhhbmRsZXIgaXMgY2FsbGVkIHdoZW4gYSBwcm9taXNlIGZhaWxzLiBUaGUgDQoJCQkvLyAJCXByb2dyZXNzSGFuZGxlciBpcyBjYWxsZWQgZm9yIHByb2dyZXNzIGV2ZW50cy4gQWxsIGFyZ3VtZW50cyBhcmUgb3B0aW9uYWwgDQoJCQkvLyAJCWFuZCBub24tZnVuY3Rpb24gdmFsdWVzIGFyZSBpZ25vcmVkLiBUaGUgcHJvZ3Jlc3NIYW5kbGVyIGlzIG5vdCBvbmx5IGFuIA0KCQkJLy8gCQlvcHRpb25hbCBhcmd1bWVudCwgYnV0IHByb2dyZXNzIGV2ZW50cyBhcmUgcHVyZWx5IG9wdGlvbmFsLiBQcm9taXNlIA0KCQkJLy8gCQlwcm92aWRlcnMgYXJlIG5vdCByZXF1aXJlZCB0byBldmVyIGNyZWF0ZSBwcm9ncmVzcyBldmVudHMuDQoJCQkvLyANCgkJCS8vIAkJVGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiBhIG5ldyBwcm9taXNlIHRoYXQgaXMgZnVsZmlsbGVkIHdoZW4gdGhlIGdpdmVuIA0KCQkJLy8gCQlmdWxmaWxsZWRIYW5kbGVyIG9yIGVycm9ySGFuZGxlciBjYWxsYmFjayBpcyBmaW5pc2hlZC4gVGhpcyBhbGxvd3MgcHJvbWlzZSANCgkJCS8vIAkJb3BlcmF0aW9ucyB0byBiZSBjaGFpbmVkIHRvZ2V0aGVyLiBUaGUgdmFsdWUgcmV0dXJuZWQgZnJvbSB0aGUgY2FsbGJhY2sgDQoJCQkvLyAJCWhhbmRsZXIgaXMgdGhlIGZ1bGZpbGxtZW50IHZhbHVlIGZvciB0aGUgcmV0dXJuZWQgcHJvbWlzZS4gSWYgdGhlIGNhbGxiYWNrIA0KCQkJLy8gCQl0aHJvd3MgYW4gZXJyb3IsIHRoZSByZXR1cm5lZCBwcm9taXNlIHdpbGwgYmUgbW92ZWQgdG8gZmFpbGVkIHN0YXRlLg0KCQkJLy8JDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8gCQlBbiBleGFtcGxlIG9mIHVzaW5nIGEgQ29tbW9uSlMgY29tcGxpYW50IHByb21pc2U6DQogIAkJCS8vCQl8CWFzeW5jQ29tcHV0ZVRoZUFuc3dlclRvRXZlcnl0aGluZygpLg0KCQkJLy8JCXwJCXRoZW4oYWRkVHdvKS4NCgkJCS8vCQl8CQl0aGVuKHByaW50UmVzdWx0LCBvbkVycm9yKTsNCiAgCQkJLy8JCXwJPjQ0IA0KCQkJLy8gCQkNCgkJCXZhciByZXR1cm5EZWZlcnJlZCA9IHByb2dyZXNzQ2FsbGJhY2sgPT0gbXV0YXRvciA/IHRoaXMgOiBuZXcgZG9qby5EZWZlcnJlZChwcm9taXNlLmNhbmNlbCk7DQoJCQl2YXIgbGlzdGVuZXIgPSB7DQoJCQkJcmVzb2x2ZWQ6IHJlc29sdmVkQ2FsbGJhY2ssIA0KCQkJCWVycm9yOiBlcnJvckNhbGxiYWNrLCANCgkJCQlwcm9ncmVzczogcHJvZ3Jlc3NDYWxsYmFjaywgDQoJCQkJZGVmZXJyZWQ6IHJldHVybkRlZmVycmVkDQoJCQl9OyANCgkJCWlmKG5leHRMaXN0ZW5lcil7DQoJCQkJaGVhZCA9IGhlYWQubmV4dCA9IGxpc3RlbmVyOw0KCQkJfQ0KCQkJZWxzZXsNCgkJCQluZXh0TGlzdGVuZXIgPSBoZWFkID0gbGlzdGVuZXI7DQoJCQl9DQoJCQlpZihmaW5pc2hlZCl7DQoJCQkJbm90aWZ5KCk7DQoJCQl9DQoJCQlyZXR1cm4gcmV0dXJuRGVmZXJyZWQucHJvbWlzZTsNCgkJfTsNCgkJdmFyIGRlZmVycmVkID0gdGhpczsNCgkJdGhpcy5jYW5jZWwgPSBwcm9taXNlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJQ2FuY2VscyB0aGUgYXN5bmNocm9ub3VzIG9wZXJhdGlvbg0KCQkJaWYoIWZpbmlzaGVkKXsNCgkJCQl2YXIgZXJyb3IgPSBjYW5jZWxsZXIgJiYgY2FuY2VsbGVyKGRlZmVycmVkKTsNCgkJCQlpZighZmluaXNoZWQpew0KCQkJCQlpZiAoIShlcnJvciBpbnN0YW5jZW9mIEVycm9yKSkgew0KCQkJCQkJZXJyb3IgPSBuZXcgRXJyb3IoZXJyb3IpOw0KCQkJCQl9DQoJCQkJCWVycm9yLmxvZyA9IGZhbHNlOw0KCQkJCQlkZWZlcnJlZC5yZWplY3QoZXJyb3IpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlmcmVlemUocHJvbWlzZSk7DQoJfTsNCglkb2pvLmV4dGVuZChkb2pvLkRlZmVycmVkLCB7DQoJCWFkZENhbGxiYWNrOiBmdW5jdGlvbiAoLypGdW5jdGlvbiovY2FsbGJhY2spIHsNCgkJCXJldHVybiB0aGlzLmFkZENhbGxiYWNrcyhkb2pvLmhpdGNoLmFwcGx5KGRvam8sIGFyZ3VtZW50cykpOw0KCQl9LA0KCQ0KCQlhZGRFcnJiYWNrOiBmdW5jdGlvbiAoLypGdW5jdGlvbiovZXJyYmFjaykgew0KCQkJcmV0dXJuIHRoaXMuYWRkQ2FsbGJhY2tzKG51bGwsIGRvam8uaGl0Y2guYXBwbHkoZG9qbywgYXJndW1lbnRzKSk7DQoJCX0sDQoJDQoJCWFkZEJvdGg6IGZ1bmN0aW9uICgvKkZ1bmN0aW9uKi9jYWxsYmFjaykgew0KCQkJdmFyIGVuY2xvc2VkID0gZG9qby5oaXRjaC5hcHBseShkb2pvLCBhcmd1bWVudHMpOw0KCQkJcmV0dXJuIHRoaXMuYWRkQ2FsbGJhY2tzKGVuY2xvc2VkLCBlbmNsb3NlZCk7DQoJCX0sDQoJCWZpcmVkOiAtMQ0KCX0pOw0KfSkoKTsNCmRvam8ud2hlbiA9IGZ1bmN0aW9uKHByb21pc2VPclZhbHVlLCAvKkZ1bmN0aW9uPyovY2FsbGJhY2ssIC8qRnVuY3Rpb24/Ki9lcnJiYWNrLCAvKkZ1bmN0aW9uPyovcHJvZ3Jlc3NIYW5kbGVyKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlUaGlzIHByb3ZpZGVzIG5vcm1hbGl6YXRpb24gYmV0d2VlbiBub3JtYWwgc3luY2hyb25vdXMgdmFsdWVzIGFuZCANCgkvLwkJYXN5bmNocm9ub3VzIHByb21pc2VzLCBzbyB5b3UgY2FuIGludGVyYWN0IHdpdGggdGhlbSBpbiBhIGNvbW1vbiB3YXkNCgkvLwlleGFtcGxlOg0KCS8vCQl8CWZ1bmN0aW9uIHByaW50Rmlyc3RBbmRMaXN0KGl0ZW1zKXsNCgkvLwkJfAkJZG9qby53aGVuKGZpbmRGaXJzdChpdGVtcyksIGNvbnNvbGUubG9nKTsNCgkvLwkJfAkJZG9qby53aGVuKGZpbmRMYXN0KGl0ZW1zKSwgY29uc29sZS5sb2cpOw0KCS8vCQl8CX0NCgkvLwkJfAlmdW5jdGlvbiBmaW5kRmlyc3QoaXRlbXMpew0KCS8vCQl8CQlyZXR1cm4gZG9qby53aGVuKGl0ZW1zLCBmdW5jdGlvbihpdGVtcyl7DQoJLy8JCXwJCQlyZXR1cm4gaXRlbXNbMF07DQoJLy8JCXwJCX0pOw0KCS8vCQl8CX0NCgkvLwkJfAlmdW5jdGlvbiBmaW5kTGFzdChpdGVtcyl7DQoJLy8JCXwJCXJldHVybiBkb2pvLndoZW4oaXRlbXMsIGZ1bmN0aW9uKGl0ZW1zKXsNCgkvLwkJfAkJCXJldHVybiBpdGVtc1tpdGVtcy5sZW5ndGhdOw0KCS8vCQl8CQl9KTsNCgkvLwkJfAl9DQoJLy8JCUFuZCBub3cgYWxsIHRocmVlIG9mIGhpcyBmdW5jdGlvbnMgY2FuIGJlIHVzZWQgc3luYyBvciBhc3luYy4NCgkvLwkJfAlwcmludEZpcnN0QW5kTGFzdChbMSwyLDMsNF0pIHdpbGwgd29yayBqdXN0IGFzIHdlbGwgYXMNCgkvLwkJfAlwcmludEZpcnN0QW5kTGFzdChkb2pvLnhockdldCguLi4pKTsNCgkNCglpZihwcm9taXNlT3JWYWx1ZSAmJiB0eXBlb2YgcHJvbWlzZU9yVmFsdWUudGhlbiA9PT0gImZ1bmN0aW9uIil7DQoJCXJldHVybiBwcm9taXNlT3JWYWx1ZS50aGVuKGNhbGxiYWNrLCBlcnJiYWNrLCBwcm9ncmVzc0hhbmRsZXIpOw0KCX0NCglyZXR1cm4gY2FsbGJhY2socHJvbWlzZU9yVmFsdWUpOw0KfTsNCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuanNvbiJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5qc29uIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmpzb24iKTsNCg0KZG9qby5mcm9tSnNvbiA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8ganNvbil7DQoJLy8gc3VtbWFyeToNCgkvLyAJCVBhcnNlcyBhIFtKU09OXShodHRwOi8vanNvbi5vcmcpIHN0cmluZyB0byByZXR1cm4gYSBKYXZhU2NyaXB0IG9iamVjdC4NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLyAJCVRocm93cyBmb3IgaW52YWxpZCBKU09OIHN0cmluZ3MsIGJ1dCBpdCBkb2VzIG5vdCB1c2UgYSBzdHJpY3QgSlNPTiBwYXJzZXIuIEl0DQoJLy8gCQlkZWxlZ2F0ZXMgdG8gZXZhbCgpLiAgVGhlIGNvbnRlbnQgcGFzc2VkIHRvIHRoaXMgbWV0aG9kIG11c3QgdGhlcmVmb3JlIGNvbWUNCgkvLwkJZnJvbSBhIHRydXN0ZWQgc291cmNlLg0KCS8vIGpzb246IA0KCS8vCQlhIHN0cmluZyBsaXRlcmFsIG9mIGEgSlNPTiBpdGVtLCBmb3IgaW5zdGFuY2U6DQoJLy8JCQlgJ3sgImZvbyI6IFsgImJhciIsIDEsIHsgImJheiI6ICJ0aHVkIiB9IF0gfSdgDQoNCglyZXR1cm4gZXZhbCgiKCIgKyBqc29uICsgIikiKTsgLy8gT2JqZWN0DQp9DQoNCmRvam8uX2VzY2FwZVN0cmluZyA9IGZ1bmN0aW9uKC8qU3RyaW5nKi9zdHIpew0KCS8vc3VtbWFyeToNCgkvLwkJQWRkcyBlc2NhcGUgc2VxdWVuY2VzIGZvciBub24tdmlzdWFsIGNoYXJhY3RlcnMsIGRvdWJsZSBxdW90ZSBhbmQNCgkvLwkJYmFja3NsYXNoIGFuZCBzdXJyb3VuZHMgd2l0aCBkb3VibGUgcXVvdGVzIHRvIGZvcm0gYSB2YWxpZCBzdHJpbmcNCgkvLwkJbGl0ZXJhbC4NCglyZXR1cm4gKCciJyArIHN0ci5yZXBsYWNlKC8oWyJcXF0pL2csICdcXCQxJykgKyAnIicpLg0KCQlyZXBsYWNlKC9bXGZdL2csICJcXGYiKS5yZXBsYWNlKC9bXGJdL2csICJcXGIiKS5yZXBsYWNlKC9bXG5dL2csICJcXG4iKS4NCgkJcmVwbGFjZSgvW1x0XS9nLCAiXFx0IikucmVwbGFjZSgvW1xyXS9nLCAiXFxyIik7IC8vIHN0cmluZw0KfQ0KDQpkb2pvLnRvSnNvbkluZGVudFN0ciA9ICJcdCI7DQpkb2pvLnRvSnNvbiA9IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gaXQsIC8qQm9vbGVhbj8qLyBwcmV0dHlQcmludCwgLypTdHJpbmc/Ki8gX2luZGVudFN0cil7DQoJLy8Jc3VtbWFyeToNCgkvLwkJUmV0dXJucyBhIFtKU09OXShodHRwOi8vanNvbi5vcmcpIHNlcmlhbGl6YXRpb24gb2YgYW4gb2JqZWN0Lg0KCS8vCWRlc2NyaXB0aW9uOg0KCS8vCQlSZXR1cm5zIGEgW0pTT05dKGh0dHA6Ly9qc29uLm9yZykgc2VyaWFsaXphdGlvbiBvZiBhbiBvYmplY3QuDQoJLy8JCU5vdGUgdGhhdCB0aGlzIGRvZXNuJ3QgY2hlY2sgZm9yIGluZmluaXRlIHJlY3Vyc2lvbiwgc28gZG9uJ3QgZG8gdGhhdCENCgkvLwlpdDoNCgkvLwkJYW4gb2JqZWN0IHRvIGJlIHNlcmlhbGl6ZWQuIE9iamVjdHMgbWF5IGRlZmluZSB0aGVpciBvd24NCgkvLwkJc2VyaWFsaXphdGlvbiB2aWEgYSBzcGVjaWFsICJfX2pzb25fXyIgb3IgImpzb24iIGZ1bmN0aW9uDQoJLy8JCXByb3BlcnR5LiBJZiBhIHNwZWNpYWxpemVkIHNlcmlhbGl6ZXIgaGFzIGJlZW4gZGVmaW5lZCwgaXQgd2lsbA0KCS8vCQliZSB1c2VkIGFzIGEgZmFsbGJhY2suDQoJLy8JcHJldHR5UHJpbnQ6DQoJLy8JCWlmIHRydWUsIHdlIGluZGVudCBvYmplY3RzIGFuZCBhcnJheXMgdG8gbWFrZSB0aGUgb3V0cHV0IHByZXR0aWVyLg0KCS8vCQlUaGUgdmFyaWFibGUgYGRvam8udG9Kc29uSW5kZW50U3RyYCBpcyB1c2VkIGFzIHRoZSBpbmRlbnQgc3RyaW5nIC0tDQoJLy8JCXRvIHVzZSBzb21ldGhpbmcgb3RoZXIgdGhhbiB0aGUgZGVmYXVsdCAodGFiKSwgY2hhbmdlIHRoYXQgdmFyaWFibGUNCgkvLwkJYmVmb3JlIGNhbGxpbmcgZG9qby50b0pzb24oKS4NCgkvLwlfaW5kZW50U3RyOg0KCS8vCQlwcml2YXRlIHZhcmlhYmxlIGZvciByZWN1cnNpdmUgY2FsbHMgd2hlbiBwcmV0dHkgcHJpbnRpbmcsIGRvIG5vdCB1c2UuDQoJLy8JZXhhbXBsZToNCgkvLwkJc2ltcGxlIHNlcmlhbGl6YXRpb24gb2YgYSB0cml2aWFsIG9iamVjdA0KCS8vCQl8CXZhciBqc29uU3RyID0gZG9qby50b0pzb24oeyBob3dkeTogInN0cmFuZ2VyISIsIGlzU3RyYW5nZTogdHJ1ZSB9KTsNCgkvLwkJfAlkb2guaXMoJ3siaG93ZHkiOiJzdHJhbmdlciEiLCJpc1N0cmFuZ2UiOnRydWV9JywganNvblN0cik7DQoJLy8JZXhhbXBsZToNCgkvLwkJYSBjdXN0b20gc2VyaWFsaXplciBmb3IgYW4gb2JqZWN0cyBvZiBhIHBhcnRpY3VsYXIgY2xhc3M6DQoJLy8JCXwJZG9qby5kZWNsYXJlKCJGdXJieSIsIG51bGwsIHsNCgkvLwkJfAkJZnVyYmllczogImFyZSBzdHJhbmdlIiwNCgkvLwkJfAkJZnVyYnlDb3VudDogMTAsDQoJLy8JCXwJCV9fanNvbl9fOiBmdW5jdGlvbigpew0KCS8vCQl8CQl9LA0KCS8vCQl8CX0pOw0KDQoJaWYoaXQgPT09IHVuZGVmaW5lZCl7DQoJCXJldHVybiAidW5kZWZpbmVkIjsNCgl9DQoJdmFyIG9ianR5cGUgPSB0eXBlb2YgaXQ7DQoJaWYob2JqdHlwZSA9PSAibnVtYmVyIiB8fCBvYmp0eXBlID09ICJib29sZWFuIil7DQoJCXJldHVybiBpdCArICIiOw0KCX0NCglpZihpdCA9PT0gbnVsbCl7DQoJCXJldHVybiAibnVsbCI7DQoJfQ0KCWlmKGRvam8uaXNTdHJpbmcoaXQpKXsgDQoJCXJldHVybiBkb2pvLl9lc2NhcGVTdHJpbmcoaXQpOyANCgl9DQoJLy8gcmVjdXJzZQ0KCXZhciByZWN1cnNlID0gYXJndW1lbnRzLmNhbGxlZTsNCgkvLyBzaG9ydC1jaXJjdWl0IGZvciBvYmplY3RzIHRoYXQgc3VwcG9ydCAianNvbiIgc2VyaWFsaXphdGlvbg0KCS8vIGlmIHRoZXkgcmV0dXJuICJzZWxmIiB0aGVuIGp1c3QgcGFzcy10aHJvdWdoLi4uDQoJdmFyIG5ld09iajsNCglfaW5kZW50U3RyID0gX2luZGVudFN0ciB8fCAiIjsNCgl2YXIgbmV4dEluZGVudCA9IHByZXR0eVByaW50ID8gX2luZGVudFN0ciArIGRvam8udG9Kc29uSW5kZW50U3RyIDogIiI7DQoJdmFyIHRmID0gaXQuX19qc29uX198fGl0Lmpzb247DQoJaWYoZG9qby5pc0Z1bmN0aW9uKHRmKSl7DQoJCW5ld09iaiA9IHRmLmNhbGwoaXQpOw0KCQlpZihpdCAhPT0gbmV3T2JqKXsNCgkJCXJldHVybiByZWN1cnNlKG5ld09iaiwgcHJldHR5UHJpbnQsIG5leHRJbmRlbnQpOw0KCQl9DQoJfQ0KCWlmKGl0Lm5vZGVUeXBlICYmIGl0LmNsb25lTm9kZSl7IC8vIGlzTm9kZQ0KCQkvLyB3ZSBjYW4ndCBzZXJpYWlsaXplIERPTSBub2RlcyBhcyByZWd1bGFyIG9iamVjdHMgYmVjYXVzZSB0aGV5IGhhdmUgY3ljbGVzDQoJCS8vIERPTSBub2RlcyBjb3VsZCBiZSBzZXJpYWxpemVkIHdpdGggc29tZXRoaW5nIGxpa2Ugb3V0ZXJIVE1MLCBidXQNCgkJLy8gdGhhdCBjYW4gYmUgcHJvdmlkZWQgYnkgdXNlcnMgaW4gdGhlIGZvcm0gb2YgLmpzb24gb3IgLl9fanNvbl9fIGZ1bmN0aW9uLg0KCQl0aHJvdyBuZXcgRXJyb3IoIkNhbid0IHNlcmlhbGl6ZSBET00gbm9kZXMiKTsNCgl9DQoNCgl2YXIgc2VwID0gcHJldHR5UHJpbnQgPyAiICIgOiAiIjsNCgl2YXIgbmV3TGluZSA9IHByZXR0eVByaW50ID8gIlxuIiA6ICIiOw0KDQoJLy8gYXJyYXkNCglpZihkb2pvLmlzQXJyYXkoaXQpKXsNCgkJdmFyIHJlcyA9IGRvam8ubWFwKGl0LCBmdW5jdGlvbihvYmopew0KCQkJdmFyIHZhbCA9IHJlY3Vyc2Uob2JqLCBwcmV0dHlQcmludCwgbmV4dEluZGVudCk7DQoJCQlpZih0eXBlb2YgdmFsICE9ICJzdHJpbmciKXsNCgkJCQl2YWwgPSAidW5kZWZpbmVkIjsNCgkJCX0NCgkJCXJldHVybiBuZXdMaW5lICsgbmV4dEluZGVudCArIHZhbDsNCgkJfSk7DQoJCXJldHVybiAiWyIgKyByZXMuam9pbigiLCIgKyBzZXApICsgbmV3TGluZSArIF9pbmRlbnRTdHIgKyAiXSI7DQoJfQ0KCS8qDQoJLy8gbG9vayBpbiB0aGUgcmVnaXN0cnkNCgl0cnkgew0KCQl3aW5kb3cubyA9IGl0Ow0KCQluZXdPYmogPSBkb2pvLmpzb24uanNvblJlZ2lzdHJ5Lm1hdGNoKGl0KTsNCgkJcmV0dXJuIHJlY3Vyc2UobmV3T2JqLCBwcmV0dHlQcmludCwgbmV4dEluZGVudCk7DQoJfWNhdGNoKGUpew0KCQkvLyBjb25zb2xlLmxvZyhlKTsNCgl9DQoJLy8gaXQncyBhIGZ1bmN0aW9uIHdpdGggbm8gYWRhcHRlciwgc2tpcCBpdA0KCSovDQoJaWYob2JqdHlwZSA9PSAiZnVuY3Rpb24iKXsNCgkJcmV0dXJuIG51bGw7IC8vIG51bGwNCgl9DQoJLy8gZ2VuZXJpYyBvYmplY3QgY29kZSBwYXRoDQoJdmFyIG91dHB1dCA9IFtdLCBrZXk7DQoJZm9yKGtleSBpbiBpdCl7DQoJCXZhciBrZXlTdHIsIHZhbDsNCgkJaWYodHlwZW9mIGtleSA9PSAibnVtYmVyIil7DQoJCQlrZXlTdHIgPSAnIicgKyBrZXkgKyAnIic7DQoJCX1lbHNlIGlmKHR5cGVvZiBrZXkgPT0gInN0cmluZyIpew0KCQkJa2V5U3RyID0gZG9qby5fZXNjYXBlU3RyaW5nKGtleSk7DQoJCX1lbHNlew0KCQkJLy8gc2tpcCBub24tc3RyaW5nIG9yIG51bWJlciBrZXlzDQoJCQljb250aW51ZTsNCgkJfQ0KCQl2YWwgPSByZWN1cnNlKGl0W2tleV0sIHByZXR0eVByaW50LCBuZXh0SW5kZW50KTsNCgkJaWYodHlwZW9mIHZhbCAhPSAic3RyaW5nIil7DQoJCQkvLyBza2lwIG5vbi1zZXJpYWxpemFibGUgdmFsdWVzDQoJCQljb250aW51ZTsNCgkJfQ0KCQkvLyBGSVhNRTogdXNlICs9IG9uIE1veiEhDQoJCS8vCSBNT1cgTk9URTogdXNpbmcgKz0gaXMgYSBwYWluIGJlY2F1c2UgeW91IGhhdmUgdG8gYWNjb3VudCBmb3IgdGhlIGRhbmdsaW5nIGNvbW1hLi4uDQoJCW91dHB1dC5wdXNoKG5ld0xpbmUgKyBuZXh0SW5kZW50ICsga2V5U3RyICsgIjoiICsgc2VwICsgdmFsKTsNCgl9DQoJcmV0dXJuICJ7IiArIG91dHB1dC5qb2luKCIsIiArIHNlcCkgKyBuZXdMaW5lICsgX2luZGVudFN0ciArICJ9IjsgLy8gU3RyaW5nDQp9DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLkNvbG9yIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLkNvbG9yIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLkNvbG9yIik7DQoNCg0KDQooZnVuY3Rpb24oKXsNCg0KCXZhciBkID0gZG9qbzsNCg0KCWRvam8uQ29sb3IgPSBmdW5jdGlvbigvKkFycmF5fFN0cmluZ3xPYmplY3QqLyBjb2xvcil7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCSAJVGFrZXMgYSBuYW1lZCBzdHJpbmcsIGhleCBzdHJpbmcsIGFycmF5IG9mIHJnYiBvciByZ2JhIHZhbHVlcywNCgkJLy8JIAlhbiBvYmplY3Qgd2l0aCByLCBnLCBiLCBhbmQgYSBwcm9wZXJ0aWVzLCBvciBhbm90aGVyIGBkb2pvLkNvbG9yYCBvYmplY3QNCgkJLy8JIAlhbmQgY3JlYXRlcyBhIG5ldyBDb2xvciBpbnN0YW5jZSB0byB3b3JrIGZyb20uDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlXb3JrIHdpdGggYSBDb2xvciBpbnN0YW5jZToNCgkJLy8JIHwgdmFyIGMgPSBuZXcgZG9qby5Db2xvcigpOw0KCQkvLwkgfCBjLnNldENvbG9yKFswLDAsMF0pOyAvLyBibGFjaw0KCQkvLwkgfCB2YXIgaGV4ID0gYy50b0hleCgpOyAvLyAjMDAwMDAwDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlXb3JrIHdpdGggYSBub2RlJ3MgY29sb3I6DQoJCS8vCSB8IHZhciBjb2xvciA9IGRvam8uc3R5bGUoInNvbWVOb2RlIiwgImJhY2tncm91bmRDb2xvciIpOw0KCQkvLwkgfCB2YXIgbiA9IG5ldyBkb2pvLkNvbG9yKGNvbG9yKTsNCgkJLy8JIHwgLy8gYWRqdXN0IHRoZSBjb2xvciBzb21lDQoJCS8vCSB8IG4uciAqPSAuNTsNCgkJLy8JIHwgY29uc29sZS5sb2cobi50b1N0cmluZygpKTsgLy8gcmdiKDEyOCwgMjU1LCAyNTUpOw0KCQlpZihjb2xvcil7IHRoaXMuc2V0Q29sb3IoY29sb3IpOyB9DQoJfTsNCg0KCS8vIEZJWE1FOg0KCS8vIAl0aGVyZSdzIGdvdCB0byBiZSBhIG1vcmUgc3BhY2UtZWZmaWNpZW50IHdheSB0byBlbmNvZGUgb3IgZGlzY292ZXINCgkvLyAJdGhlc2UhISAgVXNlIGhleD8NCglkb2pvLkNvbG9yLm5hbWVkID0gew0KCQlibGFjazogICAgICBbMCwwLDBdLA0KCQlzaWx2ZXI6ICAgICBbMTkyLDE5MiwxOTJdLA0KCQlncmF5OiAgICAgICBbMTI4LDEyOCwxMjhdLA0KCQl3aGl0ZTogICAgICBbMjU1LDI1NSwyNTVdLA0KCQltYXJvb246CQlbMTI4LDAsMF0sDQoJCXJlZDogICAgICAgIFsyNTUsMCwwXSwNCgkJcHVycGxlOgkJWzEyOCwwLDEyOF0sDQoJCWZ1Y2hzaWE6CVsyNTUsMCwyNTVdLA0KCQlncmVlbjoJICAgIFswLDEyOCwwXSwNCgkJbGltZToJICAgIFswLDI1NSwwXSwNCgkJb2xpdmU6CQlbMTI4LDEyOCwwXSwNCgkJeWVsbG93OgkJWzI1NSwyNTUsMF0sDQoJCW5hdnk6ICAgICAgIFswLDAsMTI4XSwNCgkJYmx1ZTogICAgICAgWzAsMCwyNTVdLA0KCQl0ZWFsOgkJWzAsMTI4LDEyOF0sDQoJCWFxdWE6CQlbMCwyNTUsMjU1XSwNCgkJdHJhbnNwYXJlbnQ6IGQuY29uZmlnLnRyYW5zcGFyZW50Q29sb3IgfHwgWzI1NSwyNTUsMjU1XQ0KCX07DQoNCglkb2pvLmV4dGVuZChkb2pvLkNvbG9yLCB7DQoJCXI6IDI1NSwgZzogMjU1LCBiOiAyNTUsIGE6IDEsDQoJCV9zZXQ6IGZ1bmN0aW9uKHIsIGcsIGIsIGEpew0KCQkJdmFyIHQgPSB0aGlzOyB0LnIgPSByOyB0LmcgPSBnOyB0LmIgPSBiOyB0LmEgPSBhOw0KCQl9LA0KCQlzZXRDb2xvcjogZnVuY3Rpb24oLypBcnJheXxTdHJpbmd8T2JqZWN0Ki8gY29sb3Ipew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlUYWtlcyBhIG5hbWVkIHN0cmluZywgaGV4IHN0cmluZywgYXJyYXkgb2YgcmdiIG9yIHJnYmEgdmFsdWVzLA0KCQkJLy8JCWFuIG9iamVjdCB3aXRoIHIsIGcsIGIsIGFuZCBhIHByb3BlcnRpZXMsIG9yIGFub3RoZXIgYGRvam8uQ29sb3JgIG9iamVjdA0KCQkJLy8JCWFuZCBzZXRzIHRoaXMgY29sb3IgaW5zdGFuY2UgdG8gdGhhdCB2YWx1ZS4NCgkJCS8vDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAl2YXIgYyA9IG5ldyBkb2pvLkNvbG9yKCk7IC8vIG5vIGNvbG9yDQoJCQkvLwl8CWMuc2V0Q29sb3IoIiNlZGVkZWQiKTsgLy8gZ3JleWlzaA0KCQkJaWYoZC5pc1N0cmluZyhjb2xvcikpew0KCQkJCWQuY29sb3JGcm9tU3RyaW5nKGNvbG9yLCB0aGlzKTsNCgkJCX1lbHNlIGlmKGQuaXNBcnJheShjb2xvcikpew0KCQkJCWQuY29sb3JGcm9tQXJyYXkoY29sb3IsIHRoaXMpOw0KCQkJfWVsc2V7DQoJCQkJdGhpcy5fc2V0KGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIsIGNvbG9yLmEpOw0KCQkJCWlmKCEoY29sb3IgaW5zdGFuY2VvZiBkLkNvbG9yKSl7IHRoaXMuc2FuaXRpemUoKTsgfQ0KCQkJfQ0KCQkJcmV0dXJuIHRoaXM7CS8vIGRvam8uQ29sb3INCgkJfSwNCgkJc2FuaXRpemU6IGZ1bmN0aW9uKCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUVuc3VyZXMgdGhlIG9iamVjdCBoYXMgY29ycmVjdCBhdHRyaWJ1dGVzDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQl0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdGhpbmcsIGluY2x1ZGUgZG9qby5jb2xvcnMgdG8NCgkJCS8vCQlhdWdtZW50IGl0IHdpdGggcmVhbCBjaGVja3MNCgkJCXJldHVybiB0aGlzOwkvLyBkb2pvLkNvbG9yDQoJCX0sDQoJCXRvUmdiOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIDMgY29tcG9uZW50IGFycmF5IG9mIHJnYiB2YWx1ZXMNCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwl8CXZhciBjID0gbmV3IGRvam8uQ29sb3IoIiMwMDAwMDAiKTsNCgkJCS8vCXwgCWNvbnNvbGUubG9nKGMudG9SZ2IoKSk7IC8vIFswLDAsMF0NCgkJCXZhciB0ID0gdGhpczsNCgkJCXJldHVybiBbdC5yLCB0LmcsIHQuYl07CS8vIEFycmF5DQoJCX0sDQoJCXRvUmdiYTogZnVuY3Rpb24oKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIDQgY29tcG9uZW50IGFycmF5IG9mIHJnYmEgdmFsdWVzIGZyb20gdGhlIGNvbG9yDQoJCQkvLwkJcmVwcmVzZW50ZWQgYnkgdGhpcyBvYmplY3QuDQoJCQl2YXIgdCA9IHRoaXM7DQoJCQlyZXR1cm4gW3QuciwgdC5nLCB0LmIsIHQuYV07CS8vIEFycmF5DQoJCX0sDQoJCXRvSGV4OiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgQ1NTIGNvbG9yIHN0cmluZyBpbiBoZXhhZGVjaW1hbCByZXByZXNlbnRhdGlvbg0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwgCWNvbnNvbGUubG9nKG5ldyBkb2pvLkNvbG9yKFswLDAsMF0pLnRvSGV4KCkpOyAvLyAjMDAwMDAwDQoJCQl2YXIgYXJyID0gZC5tYXAoWyJyIiwgImciLCAiYiJdLCBmdW5jdGlvbih4KXsNCgkJCQl2YXIgcyA9IHRoaXNbeF0udG9TdHJpbmcoMTYpOw0KCQkJCXJldHVybiBzLmxlbmd0aCA8IDIgPyAiMCIgKyBzIDogczsNCgkJCX0sIHRoaXMpOw0KCQkJcmV0dXJuICIjIiArIGFyci5qb2luKCIiKTsJLy8gU3RyaW5nDQoJCX0sDQoJCXRvQ3NzOiBmdW5jdGlvbigvKkJvb2xlYW4/Ki8gaW5jbHVkZUFscGhhKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIGNzcyBjb2xvciBzdHJpbmcgaW4gcmdiKGEpIHJlcHJlc2VudGF0aW9uDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JfAl2YXIgYyA9IG5ldyBkb2pvLkNvbG9yKCIjRkZGIikudG9Dc3MoKTsNCgkJCS8vCXwJY29uc29sZS5sb2coYyk7IC8vIHJnYignMjU1JywnMjU1JywnMjU1JykNCgkJCXZhciB0ID0gdGhpcywgcmdiID0gdC5yICsgIiwgIiArIHQuZyArICIsICIgKyB0LmI7DQoJCQlyZXR1cm4gKGluY2x1ZGVBbHBoYSA/ICJyZ2JhKCIgKyByZ2IgKyAiLCAiICsgdC5hIDogInJnYigiICsgcmdiKSArICIpIjsJLy8gU3RyaW5nDQoJCX0sDQoJCXRvU3RyaW5nOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgdmlzdWFsIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvcg0KCQkJcmV0dXJuIHRoaXMudG9Dc3ModHJ1ZSk7IC8vIFN0cmluZw0KCQl9DQoJfSk7DQoNCglkb2pvLmJsZW5kQ29sb3JzID0gZnVuY3Rpb24oDQoJCS8qZG9qby5Db2xvciovIHN0YXJ0LA0KCQkvKmRvam8uQ29sb3IqLyBlbmQsDQoJCS8qTnVtYmVyKi8gd2VpZ2h0LA0KCQkvKmRvam8uQ29sb3I/Ki8gb2JqDQoJKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUJsZW5kIGNvbG9ycyBlbmQgYW5kIHN0YXJ0IHdpdGggd2VpZ2h0IGZyb20gMCB0byAxLCAwLjUgYmVpbmcgYSA1MC81MCBibGVuZCwNCgkJLy8JCWNhbiByZXVzZSBhIHByZXZpb3VzbHkgYWxsb2NhdGVkIGRvam8uQ29sb3Igb2JqZWN0IGZvciB0aGUgcmVzdWx0DQoJCXZhciB0ID0gb2JqIHx8IG5ldyBkLkNvbG9yKCk7DQoJCWQuZm9yRWFjaChbInIiLCAiZyIsICJiIiwgImEiXSwgZnVuY3Rpb24oeCl7DQoJCQl0W3hdID0gc3RhcnRbeF0gKyAoZW5kW3hdIC0gc3RhcnRbeF0pICogd2VpZ2h0Ow0KCQkJaWYoeCAhPSAiYSIpeyB0W3hdID0gTWF0aC5yb3VuZCh0W3hdKTsgfQ0KCQl9KTsNCgkJcmV0dXJuIHQuc2FuaXRpemUoKTsJLy8gZG9qby5Db2xvcg0KCX07DQoNCglkb2pvLmNvbG9yRnJvbVJnYiA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gY29sb3IsIC8qZG9qby5Db2xvcj8qLyBvYmopew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhIGBkb2pvLkNvbG9yYCBpbnN0YW5jZSBmcm9tIGEgc3RyaW5nIG9mIHRoZSBmb3JtDQoJCS8vCQkicmdiKC4uLikiIG9yICJyZ2JhKC4uLikiLiBPcHRpb25hbGx5IGFjY2VwdHMgYSBgZG9qby5Db2xvcmANCgkJLy8JCW9iamVjdCB0byB1cGRhdGUgd2l0aCB0aGUgcGFyc2VkIHZhbHVlIGFuZCByZXR1cm4gaW5zdGVhZCBvZg0KCQkvLwkJY3JlYXRpbmcgYSBuZXcgb2JqZWN0Lg0KCQkvLyByZXR1cm5zOg0KCQkvLwkJQSBkb2pvLkNvbG9yIG9iamVjdC4gSWYgb2JqIGlzIHBhc3NlZCwgaXQgd2lsbCBiZSB0aGUgcmV0dXJuIHZhbHVlLg0KCQl2YXIgbSA9IGNvbG9yLnRvTG93ZXJDYXNlKCkubWF0Y2goL15yZ2JhP1woKFtcc1wuLDAtOV0rKVwpLyk7DQoJCXJldHVybiBtICYmIGRvam8uY29sb3JGcm9tQXJyYXkobVsxXS5zcGxpdCgvXHMqLFxzKi8pLCBvYmopOwkvLyBkb2pvLkNvbG9yDQoJfTsNCg0KCWRvam8uY29sb3JGcm9tSGV4ID0gZnVuY3Rpb24oLypTdHJpbmcqLyBjb2xvciwgLypkb2pvLkNvbG9yPyovIG9iail7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlDb252ZXJ0cyBhIGhleCBzdHJpbmcgd2l0aCBhICcjJyBwcmVmaXggdG8gYSBjb2xvciBvYmplY3QuDQoJCS8vCQlTdXBwb3J0cyAxMi1iaXQgI3JnYiBzaG9ydGhhbmQuIE9wdGlvbmFsbHkgYWNjZXB0cyBhDQoJCS8vCQlgZG9qby5Db2xvcmAgb2JqZWN0IHRvIHVwZGF0ZSB3aXRoIHRoZSBwYXJzZWQgdmFsdWUuDQoJCS8vDQoJCS8vIHJldHVybnM6DQoJCS8vCQlBIGRvam8uQ29sb3Igb2JqZWN0LiBJZiBvYmogaXMgcGFzc2VkLCBpdCB3aWxsIGJlIHRoZSByZXR1cm4gdmFsdWUuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCSB8IHZhciB0aGluZyA9IGRvam8uY29sb3JGcm9tSGV4KCIjZWRlZGVkIik7IC8vIGdyZXksIGxvbmdoYW5kDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCXwgdmFyIHRoaW5nID0gZG9qby5jb2xvckZyb21IZXgoIiMwMDAiKTsgLy8gYmxhY2ssIHNob3J0aGFuZA0KCQl2YXIgdCA9IG9iaiB8fCBuZXcgZC5Db2xvcigpLA0KCQkJYml0cyA9IChjb2xvci5sZW5ndGggPT0gNCkgPyA0IDogOCwNCgkJCW1hc2sgPSAoMSA8PCBiaXRzKSAtIDE7DQoJCWNvbG9yID0gTnVtYmVyKCIweCIgKyBjb2xvci5zdWJzdHIoMSkpOw0KCQlpZihpc05hTihjb2xvcikpew0KCQkJcmV0dXJuIG51bGw7IC8vIGRvam8uQ29sb3INCgkJfQ0KCQlkLmZvckVhY2goWyJiIiwgImciLCAiciJdLCBmdW5jdGlvbih4KXsNCgkJCXZhciBjID0gY29sb3IgJiBtYXNrOw0KCQkJY29sb3IgPj49IGJpdHM7DQoJCQl0W3hdID0gYml0cyA9PSA0ID8gMTcgKiBjIDogYzsNCgkJfSk7DQoJCXQuYSA9IDE7DQoJCXJldHVybiB0OwkvLyBkb2pvLkNvbG9yDQoJfTsNCg0KCWRvam8uY29sb3JGcm9tQXJyYXkgPSBmdW5jdGlvbigvKkFycmF5Ki8gYSwgLypkb2pvLkNvbG9yPyovIG9iail7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlCdWlsZHMgYSBgZG9qby5Db2xvcmAgZnJvbSBhIDMgb3IgNCBlbGVtZW50IGFycmF5LCBtYXBwaW5nIGVhY2gNCgkJLy8JCWVsZW1lbnQgaW4gc2VxdWVuY2UgdG8gdGhlIHJnYihhKSB2YWx1ZXMgb2YgdGhlIGNvbG9yLg0KCQkvLyBleGFtcGxlOg0KCQkvLwkJfCB2YXIgbXlDb2xvciA9IGRvam8uY29sb3JGcm9tQXJyYXkoWzIzNywyMzcsMjM3LDAuNV0pOyAvLyBncmV5LCA1MCUgYWxwaGEgDQoJCS8vIHJldHVybnM6DQoJCS8vCQlBIGRvam8uQ29sb3Igb2JqZWN0LiBJZiBvYmogaXMgcGFzc2VkLCBpdCB3aWxsIGJlIHRoZSByZXR1cm4gdmFsdWUuDQoJCXZhciB0ID0gb2JqIHx8IG5ldyBkLkNvbG9yKCk7DQoJCXQuX3NldChOdW1iZXIoYVswXSksIE51bWJlcihhWzFdKSwgTnVtYmVyKGFbMl0pLCBOdW1iZXIoYVszXSkpOw0KCQlpZihpc05hTih0LmEpKXsgdC5hID0gMTsgfQ0KCQlyZXR1cm4gdC5zYW5pdGl6ZSgpOwkvLyBkb2pvLkNvbG9yDQoJfTsNCg0KCWRvam8uY29sb3JGcm9tU3RyaW5nID0gZnVuY3Rpb24oLypTdHJpbmcqLyBzdHIsIC8qZG9qby5Db2xvcj8qLyBvYmopew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUGFyc2VzIGBzdHJgIGZvciBhIGNvbG9yIHZhbHVlLiBBY2NlcHRzIGhleCwgcmdiLCBhbmQgcmdiYQ0KCQkvLwkJc3R5bGUgY29sb3IgdmFsdWVzLg0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCUFjY2VwdGFibGUgaW5wdXQgdmFsdWVzIGZvciBzdHIgbWF5IGluY2x1ZGUgYXJyYXlzIG9mIGFueSBmb3JtDQoJCS8vCQlhY2NlcHRlZCBieSBkb2pvLmNvbG9yRnJvbUFycmF5LCBoZXggc3RyaW5ncyBzdWNoIGFzICIjYWFhYWFhIiwgb3INCgkJLy8JCXJnYiBvciByZ2JhIHN0cmluZ3Mgc3VjaCBhcyAicmdiKDEzMywgMjAwLCAxNikiIG9yICJyZ2JhKDEwLCAxMCwNCgkJLy8JCTEwLCA1MCkiDQoJCS8vIHJldHVybnM6DQoJCS8vCQlBIGRvam8uQ29sb3Igb2JqZWN0LiBJZiBvYmogaXMgcGFzc2VkLCBpdCB3aWxsIGJlIHRoZSByZXR1cm4gdmFsdWUuDQoJCXZhciBhID0gZC5Db2xvci5uYW1lZFtzdHJdOw0KCQlyZXR1cm4gYSAmJiBkLmNvbG9yRnJvbUFycmF5KGEsIG9iaikgfHwgZC5jb2xvckZyb21SZ2Ioc3RyLCBvYmopIHx8IGQuY29sb3JGcm9tSGV4KHN0ciwgb2JqKTsNCgl9Ow0KfSkoKTsNCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UiXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UiKTsNCg0KDQoNCg0KDQoNCg0KDQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLndpbmRvdyJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS53aW5kb3ciXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2Uud2luZG93Iik7DQoNCi8qPT09PT0NCmRvam8uZG9jID0gew0KCS8vIHN1bW1hcnk6DQoJLy8JCUFsaWFzIGZvciB0aGUgY3VycmVudCBkb2N1bWVudC4gJ2Rvam8uZG9jJyBjYW4gYmUgbW9kaWZpZWQNCgkvLwkJZm9yIHRlbXBvcmFyeSBjb250ZXh0IHNoaWZ0aW5nLiBBbHNvIHNlZSBkb2pvLndpdGhEb2MoKS4NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLyAgICBSZWZlciB0byBkb2pvLmRvYyByYXRoZXINCgkvLyAgICB0aGFuIHJlZmVycmluZyB0byAnd2luZG93LmRvY3VtZW50JyB0byBlbnN1cmUgeW91ciBjb2RlIHJ1bnMNCgkvLyAgICBjb3JyZWN0bHkgaW4gbWFuYWdlZCBjb250ZXh0cy4NCgkvLyBleGFtcGxlOg0KCS8vIAl8CW4uYXBwZW5kQ2hpbGQoZG9qby5kb2MuY3JlYXRlRWxlbWVudCgnZGl2JykpOw0KfQ0KPT09PT0qLw0KZG9qby5kb2MgPSB3aW5kb3dbImRvY3VtZW50Il0gfHwgbnVsbDsNCg0KZG9qby5ib2R5ID0gZnVuY3Rpb24oKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlSZXR1cm4gdGhlIGJvZHkgZWxlbWVudCBvZiB0aGUgZG9jdW1lbnQNCgkvLwkJcmV0dXJuIHRoZSBib2R5IG9iamVjdCBhc3NvY2lhdGVkIHdpdGggZG9qby5kb2MNCgkvLyBleGFtcGxlOg0KCS8vIAl8CWRvam8uYm9keSgpLmFwcGVuZENoaWxkKGRvam8uZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsNCg0KCS8vIE5vdGU6IGRvY3VtZW50LmJvZHkgaXMgbm90IGRlZmluZWQgZm9yIGEgc3RyaWN0IHhodG1sIGRvY3VtZW50DQoJLy8gV291bGQgbGlrZSB0byBtZW1vaXplIHRoaXMsIGJ1dCBkb2pvLmRvYyBjYW4gY2hhbmdlIHZpIGRvam8ud2l0aERvYygpLg0KCXJldHVybiBkb2pvLmRvYy5ib2R5IHx8IGRvam8uZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF07IC8vIE5vZGUNCn0NCg0KZG9qby5zZXRDb250ZXh0ID0gZnVuY3Rpb24oLypPYmplY3QqL2dsb2JhbE9iamVjdCwgLypEb2N1bWVudEVsZW1lbnQqL2dsb2JhbERvY3VtZW50KXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQljaGFuZ2VzIHRoZSBiZWhhdmlvciBvZiBtYW55IGNvcmUgRG9qbyBmdW5jdGlvbnMgdGhhdCBkZWFsIHdpdGgNCgkvLwkJbmFtZXNwYWNlIGFuZCBET00gbG9va3VwLCBjaGFuZ2luZyB0aGVtIHRvIHdvcmsgaW4gYSBuZXcgZ2xvYmFsDQoJLy8JCWNvbnRleHQgKGUuZy4sIGFuIGlmcmFtZSkuIFRoZSB2YXJpYmxlcyBkb2pvLmdsb2JhbCBhbmQgZG9qby5kb2MNCgkvLwkJYXJlIG1vZGlmaWVkIGFzIGEgcmVzdWx0IG9mIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiBhbmQgdGhlIHJlc3VsdCBvZg0KCS8vCQlgZG9qby5ib2R5KClgIGxpa2V3aXNlIGRpZmZlcnMuDQoJZG9qby5nbG9iYWwgPSBnbG9iYWxPYmplY3Q7DQoJZG9qby5kb2MgPSBnbG9iYWxEb2N1bWVudDsNCn07DQoNCmRvam8ud2l0aEdsb2JhbCA9IGZ1bmN0aW9uKAkvKk9iamVjdCovZ2xvYmFsT2JqZWN0LCANCgkJCQkJCQkvKkZ1bmN0aW9uKi9jYWxsYmFjaywgDQoJCQkJCQkJLypPYmplY3Q/Ki90aGlzT2JqZWN0LCANCgkJCQkJCQkvKkFycmF5PyovY2JBcmd1bWVudHMpew0KCS8vIHN1bW1hcnk6DQoJLy8JCUludm9rZSBjYWxsYmFjayB3aXRoIGdsb2JhbE9iamVjdCBhcyBkb2pvLmdsb2JhbCBhbmQNCgkvLwkJZ2xvYmFsT2JqZWN0LmRvY3VtZW50IGFzIGRvam8uZG9jLg0KCS8vIGRlc2NyaXB0aW9uOg0KCS8vCQlJbnZva2UgY2FsbGJhY2sgd2l0aCBnbG9iYWxPYmplY3QgYXMgZG9qby5nbG9iYWwgYW5kDQoJLy8JCWdsb2JhbE9iamVjdC5kb2N1bWVudCBhcyBkb2pvLmRvYy4gSWYgcHJvdmlkZWQsIGdsb2JhbE9iamVjdA0KCS8vCQl3aWxsIGJlIGV4ZWN1dGVkIGluIHRoZSBjb250ZXh0IG9mIG9iamVjdCB0aGlzT2JqZWN0DQoJLy8JCVdoZW4gY2FsbGJhY2soKSByZXR1cm5zIG9yIHRocm93cyBhbiBlcnJvciwgdGhlIGRvam8uZ2xvYmFsDQoJLy8JCWFuZCBkb2pvLmRvYyB3aWxsIGJlIHJlc3RvcmVkIHRvIGl0cyBwcmV2aW91cyBzdGF0ZS4NCg0KCXZhciBvbGRHbG9iID0gZG9qby5nbG9iYWw7DQoJdHJ5ew0KCQlkb2pvLmdsb2JhbCA9IGdsb2JhbE9iamVjdDsNCgkJcmV0dXJuIGRvam8ud2l0aERvYy5jYWxsKG51bGwsIGdsb2JhbE9iamVjdC5kb2N1bWVudCwgY2FsbGJhY2ssIHRoaXNPYmplY3QsIGNiQXJndW1lbnRzKTsNCgl9ZmluYWxseXsNCgkJZG9qby5nbG9iYWwgPSBvbGRHbG9iOw0KCX0NCn0NCg0KZG9qby53aXRoRG9jID0gZnVuY3Rpb24oCS8qRG9jdW1lbnRFbGVtZW50Ki9kb2N1bWVudE9iamVjdCwgDQoJCQkJCQkJLypGdW5jdGlvbiovY2FsbGJhY2ssIA0KCQkJCQkJCS8qT2JqZWN0PyovdGhpc09iamVjdCwgDQoJCQkJCQkJLypBcnJheT8qL2NiQXJndW1lbnRzKXsNCgkvLyBzdW1tYXJ5Og0KCS8vCQlJbnZva2UgY2FsbGJhY2sgd2l0aCBkb2N1bWVudE9iamVjdCBhcyBkb2pvLmRvYy4NCgkvLyBkZXNjcmlwdGlvbjoNCgkvLwkJSW52b2tlIGNhbGxiYWNrIHdpdGggZG9jdW1lbnRPYmplY3QgYXMgZG9qby5kb2MuIElmIHByb3ZpZGVkLA0KCS8vCQljYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGluIHRoZSBjb250ZXh0IG9mIG9iamVjdCB0aGlzT2JqZWN0DQoJLy8JCVdoZW4gY2FsbGJhY2soKSByZXR1cm5zIG9yIHRocm93cyBhbiBlcnJvciwgdGhlIGRvam8uZG9jIHdpbGwNCgkvLwkJYmUgcmVzdG9yZWQgdG8gaXRzIHByZXZpb3VzIHN0YXRlLg0KDQoJdmFyIG9sZERvYyA9IGRvam8uZG9jLA0KCQlvbGRMdHIgPSBkb2pvLl9ib2R5THRyLA0KCQlvbGRRID0gZG9qby5pc1F1aXJrczsNCg0KCXRyeXsNCgkJZG9qby5kb2MgPSBkb2N1bWVudE9iamVjdDsNCgkJZGVsZXRlIGRvam8uX2JvZHlMdHI7IC8vIHVuY2FjaGUNCgkJZG9qby5pc1F1aXJrcyA9IGRvam8uZG9jLmNvbXBhdE1vZGUgPT0gIkJhY2tDb21wYXQiOyAvLyBubyBuZWVkIHRvIGNoZWNrIGZvciBRdWlya3NNb2RlIHdoaWNoIHdhcyBPcGVyYSA3IG9ubHkNCg0KCQlpZih0aGlzT2JqZWN0ICYmIHR5cGVvZiBjYWxsYmFjayA9PSAic3RyaW5nIil7DQoJCQljYWxsYmFjayA9IHRoaXNPYmplY3RbY2FsbGJhY2tdOw0KCQl9DQoNCgkJcmV0dXJuIGNhbGxiYWNrLmFwcGx5KHRoaXNPYmplY3QsIGNiQXJndW1lbnRzIHx8IFtdKTsNCgl9ZmluYWxseXsNCgkJZG9qby5kb2MgPSBvbGREb2M7DQoJCWRlbGV0ZSBkb2pvLl9ib2R5THRyOyAvLyBpbiBjYXNlIGl0IHdhcyB1bmRlZmluZWQgb3JpZ2luYWxseSwgYW5kIHNldCB0byB0cnVlL2ZhbHNlIGJ5IHRoZSBhbHRlcm5hdGUgZG9jdW1lbnQNCgkJaWYob2xkTHRyICE9PSB1bmRlZmluZWQpeyBkb2pvLl9ib2R5THRyID0gb2xkTHRyOyB9DQoJCWRvam8uaXNRdWlya3MgPSBvbGRROw0KCX0NCn07DQoJDQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmV2ZW50Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmV2ZW50Il0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmV2ZW50Iik7DQoNCg0KLy8gdGhpcyBmaWxlIGNvdXJ0ZXN5IG9mIHRoZSBUdXJib0FqYXggR3JvdXAsIGxpY2Vuc2VkIHVuZGVyIGEgRG9qbyBDTEENCg0KKGZ1bmN0aW9uKCl7DQoJLy8gRE9NIGV2ZW50IGxpc3RlbmVyIG1hY2hpbmVyeQ0KCXZhciBkZWwgPSAoZG9qby5fZXZlbnRfbGlzdGVuZXIgPSB7DQoJCWFkZDogZnVuY3Rpb24oLypET01Ob2RlKi8gbm9kZSwgLypTdHJpbmcqLyBuYW1lLCAvKkZ1bmN0aW9uKi8gZnApew0KCQkJaWYoIW5vZGUpe3JldHVybjt9IA0KCQkJbmFtZSA9IGRlbC5fbm9ybWFsaXplRXZlbnROYW1lKG5hbWUpOw0KCQkJZnAgPSBkZWwuX2ZpeENhbGxiYWNrKG5hbWUsIGZwKTsNCgkJCXZhciBvbmFtZSA9IG5hbWU7DQoJCQlpZigNCgkJCQkJCQkJIWRvam8uaXNJRSAmJiANCgkJCQkJCQkJKG5hbWUgPT0gIm1vdXNlZW50ZXIiIHx8IG5hbWUgPT0gIm1vdXNlbGVhdmUiKQ0KCQkJKXsNCgkJCQl2YXIgb2ZwID0gZnA7DQoJCQkJLy9vbmFtZSA9IG5hbWU7DQoJCQkJbmFtZSA9IChuYW1lID09ICJtb3VzZWVudGVyIikgPyAibW91c2VvdmVyIiA6ICJtb3VzZW91dCI7DQoJCQkJZnAgPSBmdW5jdGlvbihlKXsNCgkJCQkJaWYoIWRvam8uaXNEZXNjZW5kYW50KGUucmVsYXRlZFRhcmdldCwgbm9kZSkpew0KCQkJCQkJLy8gZS50eXBlID0gb25hbWU7IC8vIEZJWE1FOiBkb2Vzbid0IHRha2U/IFNKTTogZXZlbnQudHlwZSBpcyBnZW5lcmFsbHkgaW1tdXRhYmxlLg0KCQkJCQkJcmV0dXJuIG9mcC5jYWxsKHRoaXMsIGUpOyANCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCW5vZGUuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBmcCwgZmFsc2UpOw0KCQkJcmV0dXJuIGZwOyAvKkhhbmRsZSovDQoJCX0sDQoJCXJlbW92ZTogZnVuY3Rpb24oLypET01Ob2RlKi8gbm9kZSwgLypTdHJpbmcqLyBldmVudCwgLypIYW5kbGUqLyBoYW5kbGUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQljbG9iYmVycyB0aGUgbGlzdGVuZXIgZnJvbSB0aGUgbm9kZQ0KCQkJLy8gbm9kZToNCgkJCS8vCQlET00gbm9kZSB0byBhdHRhY2ggdGhlIGV2ZW50IHRvDQoJCQkvLyBldmVudDoNCgkJCS8vCQl0aGUgbmFtZSBvZiB0aGUgaGFuZGxlciB0byByZW1vdmUgdGhlIGZ1bmN0aW9uIGZyb20NCgkJCS8vIGhhbmRsZToNCgkJCS8vCQl0aGUgaGFuZGxlIHJldHVybmVkIGZyb20gYWRkDQoJCQlpZihub2RlKXsNCgkJCQlldmVudCA9IGRlbC5fbm9ybWFsaXplRXZlbnROYW1lKGV2ZW50KTsNCgkJCQlpZighZG9qby5pc0lFICYmIChldmVudCA9PSAibW91c2VlbnRlciIgfHwgZXZlbnQgPT0gIm1vdXNlbGVhdmUiKSl7DQoJCQkJCWV2ZW50ID0gKGV2ZW50ID09ICJtb3VzZWVudGVyIikgPyAibW91c2VvdmVyIiA6ICJtb3VzZW91dCI7DQoJCQkJfQ0KDQoJCQkJbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGUsIGZhbHNlKTsNCgkJCX0NCgkJfSwNCgkJX25vcm1hbGl6ZUV2ZW50TmFtZTogZnVuY3Rpb24oLypTdHJpbmcqLyBuYW1lKXsNCgkJCS8vIEdlbmVyYWxseSwgbmFtZSBzaG91bGQgYmUgbG93ZXIgY2FzZSwgdW5sZXNzIGl0IGlzIHNwZWNpYWwNCgkJCS8vIHNvbWVob3cgKGUuZy4gYSBNb3ppbGxhIERPTSBldmVudCkuDQoJCQkvLyBSZW1vdmUgJ29uJy4NCgkJCXJldHVybiBuYW1lLnNsaWNlKDAsMikgPT0ib24iID8gbmFtZS5zbGljZSgyKSA6IG5hbWU7DQoJCX0sDQoJCV9maXhDYWxsYmFjazogZnVuY3Rpb24oLypTdHJpbmcqLyBuYW1lLCBmcCl7DQoJCQkvLyBCeSBkZWZhdWx0LCB3ZSBvbmx5IGludm9rZSBfZml4RXZlbnQgZm9yICdrZXlwcmVzcycNCgkJCS8vIElmIGNvZGUgaXMgYWRkZWQgdG8gX2ZpeEV2ZW50IGZvciBvdGhlciBldmVudHMsIHdlIGhhdmUNCgkJCS8vIHRvIHJldmlzaXQgdGhpcyBvcHRpbWl6YXRpb24uDQoJCQkvLyBUaGlzIGFsc28gYXBwbGllcyB0byBfZml4RXZlbnQgb3ZlcnJpZGVzIGZvciBTYWZhcmkgYW5kIE9wZXJhDQoJCQkvLyBiZWxvdy4NCgkJCXJldHVybiBuYW1lICE9ICJrZXlwcmVzcyIgPyBmcCA6IGZ1bmN0aW9uKGUpeyByZXR1cm4gZnAuY2FsbCh0aGlzLCBkZWwuX2ZpeEV2ZW50KGUsIHRoaXMpKTsgfTsNCgkJfSwNCgkJX2ZpeEV2ZW50OiBmdW5jdGlvbihldnQsIHNlbmRlcil7DQoJCQkvLyBfZml4Q2FsbGJhY2sgb25seSBhdHRhY2hlcyB1cyB0byBrZXlwcmVzcy4NCgkJCS8vIFN3aXRjaCBvbiBldnQudHlwZSBhbnl3YXkgYmVjYXVzZSB3ZSBtaWdodCANCgkJCS8vIGJlIGNhbGxlZCBkaXJlY3RseSBmcm9tIGRvam8uZml4RXZlbnQuDQoJCQlzd2l0Y2goZXZ0LnR5cGUpew0KCQkJCWNhc2UgImtleXByZXNzIjoNCgkJCQkJZGVsLl9zZXRLZXlDaGFyKGV2dCk7DQoJCQkJCWJyZWFrOw0KCQkJfQ0KCQkJcmV0dXJuIGV2dDsNCgkJfSwNCgkJX3NldEtleUNoYXI6IGZ1bmN0aW9uKGV2dCl7DQoJCQlldnQua2V5Q2hhciA9IGV2dC5jaGFyQ29kZSA/IFN0cmluZy5mcm9tQ2hhckNvZGUoZXZ0LmNoYXJDb2RlKSA6ICcnOw0KCQkJZXZ0LmNoYXJPckNvZGUgPSBldnQua2V5Q2hhciB8fCBldnQua2V5Q29kZTsNCgkJfSwNCgkJLy8gRm9yIElFIGFuZCBTYWZhcmk6IHNvbWUgY3RybC1rZXkgY29tYmluYXRpb25zIChtb3N0bHkgdy9wdW5jdHVhdGlvbikgZG8gbm90IGVtaXQgYSBjaGFyIGNvZGUgaW4gSUUNCgkJLy8gd2UgbWFwIHRob3NlIHZpcnR1YWwga2V5IGNvZGVzIHRvIGFzY2lpIGhlcmUNCgkJLy8gbm90IHZhbGlkIGZvciBhbGwgKG5vbi1VUykga2V5Ym9hcmRzLCBzbyBtYXliZSB3ZSBzaG91bGRuJ3QgYm90aGVyDQoJCV9wdW5jdE1hcDogeyANCgkJCTEwNjo0MiwgDQoJCQkxMTE6NDcsIA0KCQkJMTg2OjU5LCANCgkJCTE4Nzo0MywgDQoJCQkxODg6NDQsIA0KCQkJMTg5OjQ1LCANCgkJCTE5MDo0NiwgDQoJCQkxOTE6NDcsIA0KCQkJMTkyOjk2LCANCgkJCTIxOTo5MSwgDQoJCQkyMjA6OTIsIA0KCQkJMjIxOjkzLCANCgkJCTIyMjozOSANCgkJfQ0KCX0pOw0KDQoJLy8gRE9NIGV2ZW50cw0KCQ0KCWRvam8uZml4RXZlbnQgPSBmdW5jdGlvbigvKkV2ZW50Ki8gZXZ0LCAvKkRPTU5vZGUqLyBzZW5kZXIpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJbm9ybWFsaXplcyBwcm9wZXJ0aWVzIG9uIHRoZSBldmVudCBvYmplY3QgaW5jbHVkaW5nIGV2ZW50DQoJCS8vCQlidWJibGluZyBtZXRob2RzLCBrZXlzdHJva2Ugbm9ybWFsaXphdGlvbiwgYW5kIHgveSBwb3NpdGlvbnMNCgkJLy8gZXZ0OiBFdmVudA0KCQkvLwkJbmF0aXZlIGV2ZW50IG9iamVjdA0KCQkvLyBzZW5kZXI6IERPTU5vZGUNCgkJLy8JCW5vZGUgdG8gdHJlYXQgYXMgImN1cnJlbnRUYXJnZXQiDQoJCXJldHVybiBkZWwuX2ZpeEV2ZW50KGV2dCwgc2VuZGVyKTsNCgl9DQoNCglkb2pvLnN0b3BFdmVudCA9IGZ1bmN0aW9uKC8qRXZlbnQqLyBldnQpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJcHJldmVudHMgcHJvcGFnYXRpb24gYW5kIGNsb2JiZXJzIHRoZSBkZWZhdWx0IGFjdGlvbiBvZiB0aGUNCgkJLy8JCXBhc3NlZCBldmVudA0KCQkvLyBldnQ6IEV2ZW50DQoJCS8vCQlUaGUgZXZlbnQgb2JqZWN0LiBJZiBvbWl0dGVkLCB3aW5kb3cuZXZlbnQgaXMgdXNlZCBvbiBJRS4NCgkJZXZ0LnByZXZlbnREZWZhdWx0KCk7DQoJCWV2dC5zdG9wUHJvcGFnYXRpb24oKTsNCgkJLy8gTk9URTogYmVsb3csIHRoaXMgbWV0aG9kIGlzIG92ZXJyaWRkZW4gZm9yIElFDQoJfQ0KDQoJLy8gdGhlIGRlZmF1bHQgbGlzdGVuZXIgdG8gdXNlIG9uIGRvbnRGaXggbm9kZXMsIG92ZXJyaWRlbiBmb3IgSUUNCgl2YXIgbm9kZV9saXN0ZW5lciA9IGRvam8uX2xpc3RlbmVyOw0KCQ0KCS8vIFVuaWZ5IGNvbm5lY3QgYW5kIGV2ZW50IGxpc3RlbmVycw0KCWRvam8uX2Nvbm5lY3QgPSBmdW5jdGlvbihvYmosIGV2ZW50LCBjb250ZXh0LCBtZXRob2QsIGRvbnRGaXgpew0KCQkvLyBGSVhNRTogbmVlZCBhIG1vcmUgc3RyaWN0IHRlc3QNCgkJdmFyIGlzTm9kZSA9IG9iaiAmJiAob2JqLm5vZGVUeXBlfHxvYmouYXR0YWNoRXZlbnR8fG9iai5hZGRFdmVudExpc3RlbmVyKTsNCgkJLy8gY2hvb3NlIG9uZSBvZiB0aHJlZSBsaXN0ZW5lciBvcHRpb25zOiByYXcgKGNvbm5lY3QuanMpLCBET00gZXZlbnQgb24gYSBOb2RlLCBjdXN0b20gZXZlbnQgb24gYSBOb2RlDQoJCS8vIHdlIG5lZWQgdGhlIHRoaXJkIG9wdGlvbiB0byBwcm92aWRlIGxlYWsgcHJldmVudGlvbiBvbiBicm9rZW4gYnJvd3NlcnMgKElFKQ0KCQl2YXIgbGlkID0gaXNOb2RlID8gKGRvbnRGaXggPyAyIDogMSkgOiAwLCBsID0gW2Rvam8uX2xpc3RlbmVyLCBkZWwsIG5vZGVfbGlzdGVuZXJdW2xpZF07DQoJCS8vIGNyZWF0ZSBhIGxpc3RlbmVyDQoJCXZhciBoID0gbC5hZGQob2JqLCBldmVudCwgZG9qby5oaXRjaChjb250ZXh0LCBtZXRob2QpKTsNCgkJLy8gZm9ybWVybHksIHRoZSBkaXNjb25uZWN0IHBhY2thZ2UgY29udGFpbmVkICJsIiBkaXJlY3RseSwgYnV0IGlmIGNsaWVudCBjb2RlDQoJCS8vIGxlYWtzIHRoZSBkaXNjb25uZWN0IHBhY2thZ2UgKGJ5IGNvbm5lY3RpbmcgaXQgdG8gYSBub2RlKSwgcmVmZXJlbmNpbmcgImwiIA0KCQkvLyBjb21wb3VuZHMgdGhlIHByb2JsZW0uDQoJCS8vIGluc3RlYWQgd2UgcmV0dXJuIGEgbGlzdGVuZXIgaWQsIHdoaWNoIHJlcXVpcmVzIGN1c3RvbSBfZGlzY29ubmVjdCBiZWxvdy4NCgkJLy8gcmV0dXJuIGRpc2Nvbm5lY3QgcGFja2FnZQ0KCQlyZXR1cm4gWyBvYmosIGV2ZW50LCBoLCBsaWQgXTsNCgl9DQoNCglkb2pvLl9kaXNjb25uZWN0ID0gZnVuY3Rpb24ob2JqLCBldmVudCwgaGFuZGxlLCBsaXN0ZW5lcil7DQoJCShbZG9qby5fbGlzdGVuZXIsIGRlbCwgbm9kZV9saXN0ZW5lcl1bbGlzdGVuZXJdKS5yZW1vdmUob2JqLCBldmVudCwgaGFuZGxlKTsNCgl9DQoNCgkvLyBDb25zdGFudHMNCg0KCS8vIFB1YmxpYzogY2xpZW50IGNvZGUgc2hvdWxkIHRlc3QNCgkvLyBrZXlDb2RlIGFnYWluc3QgdGhlc2UgbmFtZWQgY29uc3RhbnRzLCBhcyB0aGUNCgkvLyBhY3R1YWwgY29kZXMgY2FuIHZhcnkgYnkgYnJvd3Nlci4NCglkb2pvLmtleXMgPSB7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlEZWZpbml0aW9ucyBmb3IgY29tbW9uIGtleSB2YWx1ZXMNCgkJQkFDS1NQQUNFOiA4LA0KCQlUQUI6IDksDQoJCUNMRUFSOiAxMiwNCgkJRU5URVI6IDEzLA0KCQlTSElGVDogMTYsDQoJCUNUUkw6IDE3LA0KCQlBTFQ6IDE4LA0KCQlNRVRBOiBkb2pvLmlzU2FmYXJpID8gOTEgOiAyMjQsCQkvLyB0aGUgYXBwbGUga2V5IG9uIG1hY3MNCgkJUEFVU0U6IDE5LA0KCQlDQVBTX0xPQ0s6IDIwLA0KCQlFU0NBUEU6IDI3LA0KCQlTUEFDRTogMzIsDQoJCVBBR0VfVVA6IDMzLA0KCQlQQUdFX0RPV046IDM0LA0KCQlFTkQ6IDM1LA0KCQlIT01FOiAzNiwNCgkJTEVGVF9BUlJPVzogMzcsDQoJCVVQX0FSUk9XOiAzOCwNCgkJUklHSFRfQVJST1c6IDM5LA0KCQlET1dOX0FSUk9XOiA0MCwNCgkJSU5TRVJUOiA0NSwNCgkJREVMRVRFOiA0NiwNCgkJSEVMUDogNDcsDQoJCUxFRlRfV0lORE9XOiA5MSwNCgkJUklHSFRfV0lORE9XOiA5MiwNCgkJU0VMRUNUOiA5MywNCgkJTlVNUEFEXzA6IDk2LA0KCQlOVU1QQURfMTogOTcsDQoJCU5VTVBBRF8yOiA5OCwNCgkJTlVNUEFEXzM6IDk5LA0KCQlOVU1QQURfNDogMTAwLA0KCQlOVU1QQURfNTogMTAxLA0KCQlOVU1QQURfNjogMTAyLA0KCQlOVU1QQURfNzogMTAzLA0KCQlOVU1QQURfODogMTA0LA0KCQlOVU1QQURfOTogMTA1LA0KCQlOVU1QQURfTVVMVElQTFk6IDEwNiwNCgkJTlVNUEFEX1BMVVM6IDEwNywNCgkJTlVNUEFEX0VOVEVSOiAxMDgsDQoJCU5VTVBBRF9NSU5VUzogMTA5LA0KCQlOVU1QQURfUEVSSU9EOiAxMTAsDQoJCU5VTVBBRF9ESVZJREU6IDExMSwNCgkJRjE6IDExMiwNCgkJRjI6IDExMywNCgkJRjM6IDExNCwNCgkJRjQ6IDExNSwNCgkJRjU6IDExNiwNCgkJRjY6IDExNywNCgkJRjc6IDExOCwNCgkJRjg6IDExOSwNCgkJRjk6IDEyMCwNCgkJRjEwOiAxMjEsDQoJCUYxMTogMTIyLA0KCQlGMTI6IDEyMywNCgkJRjEzOiAxMjQsDQoJCUYxNDogMTI1LA0KCQlGMTU6IDEyNiwNCgkJTlVNX0xPQ0s6IDE0NCwNCgkJU0NST0xMX0xPQ0s6IDE0NSwNCgkJLy8gdmlydHVhbCBrZXkgbWFwcGluZw0KCQljb3B5S2V5OiBkb2pvLmlzTWFjICYmICFkb2pvLmlzQUlSID8gKGRvam8uaXNTYWZhcmkgPyA5MSA6IDIyNCApIDogMTcNCgl9Ow0KCQ0KCXZhciBldnRDb3B5S2V5ID0gZG9qby5pc01hYyA/ICJtZXRhS2V5IiA6ICJjdHJsS2V5IjsNCgkNCglkb2pvLmlzQ29weUtleSA9IGZ1bmN0aW9uKGUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJQ2hlY2tzIGFuIGV2ZW50IGZvciB0aGUgY29weSBrZXkgKG1ldGEgb24gTWFjLCBhbmQgY3RybCBhbnl3aGVyZSBlbHNlKQ0KCQkvLyBlOiBFdmVudA0KCQkvLwkJRXZlbnQgb2JqZWN0IHRvIGV4YW1pbmUNCgkJcmV0dXJuIGVbZXZ0Q29weUtleV07CS8vIEJvb2xlYW4NCgl9Ow0KDQoJLy8gUHVibGljOiBkZWNvZGluZyBtb3VzZSBidXR0b25zIGZyb20gZXZlbnRzDQoNCi8qPT09PT0NCglkb2pvLm1vdXNlQnV0dG9ucyA9IHsNCgkJLy8gTEVGVDogTnVtYmVyDQoJCS8vCQlOdW1lcmljIHZhbHVlIG9mIHRoZSBsZWZ0IG1vdXNlIGJ1dHRvbiBmb3IgdGhlIHBsYXRmb3JtLg0KCQlMRUZUOiAgIDAsDQoJCS8vIE1JRERMRTogTnVtYmVyDQoJCS8vCQlOdW1lcmljIHZhbHVlIG9mIHRoZSBtaWRkbGUgbW91c2UgYnV0dG9uIGZvciB0aGUgcGxhdGZvcm0uDQoJCU1JRERMRTogMSwNCgkJLy8gUklHSFQ6IE51bWJlcg0KCQkvLwkJTnVtZXJpYyB2YWx1ZSBvZiB0aGUgcmlnaHQgbW91c2UgYnV0dG9uIGZvciB0aGUgcGxhdGZvcm0uDQoJCVJJR0hUOiAgMiwNCgkNCgkJaXNCdXR0b246IGZ1bmN0aW9uKGUsIGJ1dHRvbil7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCUNoZWNrcyBhbiBldmVudCBvYmplY3QgZm9yIGEgcHJlc3NlZCBidXR0b24NCgkJCS8vIGU6IEV2ZW50DQoJCQkvLwkJRXZlbnQgb2JqZWN0IHRvIGV4YW1pbmUNCgkJCS8vIGJ1dHRvbjogTnVtYmVyDQoJCQkvLwkJVGhlIGJ1dHRvbiB2YWx1ZSAoZXhhbXBsZTogZG9qby5tb3VzZUJ1dHRvbi5MRUZUKQ0KCQkJcmV0dXJuIGUuYnV0dG9uID09IGJ1dHRvbjsgLy8gQm9vbGVhbg0KCQl9LA0KCQlpc0xlZnQ6IGZ1bmN0aW9uKGUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlDaGVja3MgYW4gZXZlbnQgb2JqZWN0IGZvciB0aGUgcHJlc3NlZCBsZWZ0IGJ1dHRvbg0KCQkJLy8gZTogRXZlbnQNCgkJCS8vCQlFdmVudCBvYmplY3QgdG8gZXhhbWluZQ0KCQkJcmV0dXJuIGUuYnV0dG9uID09IDA7IC8vIEJvb2xlYW4NCgkJfSwNCgkJaXNNaWRkbGU6IGZ1bmN0aW9uKGUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlDaGVja3MgYW4gZXZlbnQgb2JqZWN0IGZvciB0aGUgcHJlc3NlZCBtaWRkbGUgYnV0dG9uDQoJCQkvLyBlOiBFdmVudA0KCQkJLy8JCUV2ZW50IG9iamVjdCB0byBleGFtaW5lDQoJCQlyZXR1cm4gZS5idXR0b24gPT0gMTsgLy8gQm9vbGVhbg0KCQl9LA0KCQlpc1JpZ2h0OiBmdW5jdGlvbihlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLwkJQ2hlY2tzIGFuIGV2ZW50IG9iamVjdCBmb3IgdGhlIHByZXNzZWQgcmlnaHQgYnV0dG9uDQoJCQkvLyBlOiBFdmVudA0KCQkJLy8JCUV2ZW50IG9iamVjdCB0byBleGFtaW5lDQoJCQlyZXR1cm4gZS5idXR0b24gPT0gMjsgLy8gQm9vbGVhbg0KCQl9DQoJfTsNCj09PT09Ki8NCg0KCQlpZihkb2pvLmlzSUUpew0KCQlkb2pvLm1vdXNlQnV0dG9ucyA9IHsNCgkJCUxFRlQ6ICAgMSwNCgkJCU1JRERMRTogNCwNCgkJCVJJR0hUOiAgMiwNCgkJCS8vIGhlbHBlciBmdW5jdGlvbnMNCgkJCWlzQnV0dG9uOiBmdW5jdGlvbihlLCBidXR0b24peyByZXR1cm4gZS5idXR0b24gJiBidXR0b247IH0sDQoJCQlpc0xlZnQ6ICAgZnVuY3Rpb24oZSl7IHJldHVybiBlLmJ1dHRvbiAmIDE7IH0sDQoJCQlpc01pZGRsZTogZnVuY3Rpb24oZSl7IHJldHVybiBlLmJ1dHRvbiAmIDQ7IH0sDQoJCQlpc1JpZ2h0OiAgZnVuY3Rpb24oZSl7IHJldHVybiBlLmJ1dHRvbiAmIDI7IH0NCgkJfTsNCgl9ZWxzZXsNCgkJCWRvam8ubW91c2VCdXR0b25zID0gew0KCQkJTEVGVDogICAwLA0KCQkJTUlERExFOiAxLA0KCQkJUklHSFQ6ICAyLA0KCQkJLy8gaGVscGVyIGZ1bmN0aW9ucw0KCQkJaXNCdXR0b246IGZ1bmN0aW9uKGUsIGJ1dHRvbil7IHJldHVybiBlLmJ1dHRvbiA9PSBidXR0b247IH0sDQoJCQlpc0xlZnQ6ICAgZnVuY3Rpb24oZSl7IHJldHVybiBlLmJ1dHRvbiA9PSAwOyB9LA0KCQkJaXNNaWRkbGU6IGZ1bmN0aW9uKGUpeyByZXR1cm4gZS5idXR0b24gPT0gMTsgfSwNCgkJCWlzUmlnaHQ6ICBmdW5jdGlvbihlKXsgcmV0dXJuIGUuYnV0dG9uID09IDI7IH0NCgkJfTsNCgkJfQ0KCQ0KCQkvLyBJRSBldmVudCBub3JtYWxpemF0aW9uDQoJaWYoZG9qby5pc0lFKXsgDQoJCXZhciBfdHJ5U2V0S2V5Q29kZSA9IGZ1bmN0aW9uKGUsIGNvZGUpew0KCQkJdHJ5ew0KCQkJCS8vIHNxdWVsY2ggZXJyb3JzIHdoZW4ga2V5Q29kZSBpcyByZWFkLW9ubHkNCgkJCQkvLyAoZS5nLiBpZiBrZXlDb2RlIGlzIGN0cmwgb3Igc2hpZnQpDQoJCQkJcmV0dXJuIChlLmtleUNvZGUgPSBjb2RlKTsNCgkJCX1jYXRjaChlKXsNCgkJCQlyZXR1cm4gMDsNCgkJCX0NCgkJfQ0KDQoJCS8vIGJ5IGRlZmF1bHQsIHVzZSB0aGUgc3RhbmRhcmQgbGlzdGVuZXINCgkJdmFyIGllbCA9IGRvam8uX2xpc3RlbmVyOw0KCQl2YXIgbGlzdGVuZXJzTmFtZSA9IChkb2pvLl9pZUxpc3RlbmVyc05hbWUgPSAiXyIgKyBkb2pvLl9zY29wZU5hbWUgKyAiX2xpc3RlbmVycyIpOw0KCQkvLyBkaXNwYXRjaGVyIHRyYWNraW5nIHByb3BlcnR5DQoJCWlmKCFkb2pvLmNvbmZpZy5fYWxsb3dfbGVha3Mpew0KCQkJLy8gY3VzdG9tIGxpc3RlbmVyIHRoYXQgaGFuZGxlcyBsZWFrIHByb3RlY3Rpb24gZm9yIERPTSBldmVudHMNCgkJCW5vZGVfbGlzdGVuZXIgPSBpZWwgPSBkb2pvLl9pZV9saXN0ZW5lciA9IHsNCgkJCQkvLyBzdXBwb3J0IGhhbmRsZXIgaW5kaXJlY3Rpb246IGV2ZW50IGhhbmRsZXIgZnVuY3Rpb25zIGFyZSANCgkJCQkvLyByZWZlcmVuY2VkIGhlcmUuIEV2ZW50IGRpc3BhdGNoZXJzIGhvbGQgb25seSBpbmRpY2VzLg0KCQkJCWhhbmRsZXJzOiBbXSwNCgkJCQkvLyBhZGQgYSBsaXN0ZW5lciB0byBhbiBvYmplY3QNCgkJCQlhZGQ6IGZ1bmN0aW9uKC8qT2JqZWN0Ki8gc291cmNlLCAvKlN0cmluZyovIG1ldGhvZCwgLypGdW5jdGlvbiovIGxpc3RlbmVyKXsNCgkJCQkJc291cmNlID0gc291cmNlIHx8IGRvam8uZ2xvYmFsOw0KCQkJCQl2YXIgZiA9IHNvdXJjZVttZXRob2RdOw0KCQkJCQlpZighZnx8IWZbbGlzdGVuZXJzTmFtZV0pew0KCQkJCQkJdmFyIGQgPSBkb2pvLl9nZXRJZURpc3BhdGNoZXIoKTsNCgkJCQkJCS8vIG9yaWdpbmFsIHRhcmdldCBmdW5jdGlvbiBpcyBzcGVjaWFsDQoJCQkJCQlkLnRhcmdldCA9IGYgJiYgKGllaC5wdXNoKGYpIC0gMSk7DQoJCQkJCQkvLyBkaXNwYXRjaGVyIGhvbGRzIGEgbGlzdCBvZiBpbmRpY2VzIGludG8gaGFuZGxlcnMgdGFibGUNCgkJCQkJCWRbbGlzdGVuZXJzTmFtZV0gPSBbXTsNCgkJCQkJCS8vIHJlZGlyZWN0IHNvdXJjZSB0byBkaXNwYXRjaGVyDQoJCQkJCQlmID0gc291cmNlW21ldGhvZF0gPSBkOw0KCQkJCQl9DQoJCQkJCXJldHVybiBmW2xpc3RlbmVyc05hbWVdLnB1c2goaWVoLnB1c2gobGlzdGVuZXIpIC0gMSkgOyAvKkhhbmRsZSovDQoJCQkJfSwNCgkJCQkvLyByZW1vdmUgYSBsaXN0ZW5lciBmcm9tIGFuIG9iamVjdA0KCQkJCXJlbW92ZTogZnVuY3Rpb24oLypPYmplY3QqLyBzb3VyY2UsIC8qU3RyaW5nKi8gbWV0aG9kLCAvKkhhbmRsZSovIGhhbmRsZSl7DQoJCQkJCXZhciBmID0gKHNvdXJjZXx8ZG9qby5nbG9iYWwpW21ldGhvZF0sIGwgPSBmICYmIGZbbGlzdGVuZXJzTmFtZV07DQoJCQkJCWlmKGYgJiYgbCAmJiBoYW5kbGUtLSl7DQoJCQkJCQlkZWxldGUgaWVoW2xbaGFuZGxlXV07DQoJCQkJCQlkZWxldGUgbFtoYW5kbGVdOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCgkJCS8vIGFsaWFzIHVzZWQgYWJvdmUNCgkJCXZhciBpZWggPSBpZWwuaGFuZGxlcnM7DQoJCX0NCg0KCQlkb2pvLm1peGluKGRlbCwgew0KCQkJYWRkOiBmdW5jdGlvbigvKkRPTU5vZGUqLyBub2RlLCAvKlN0cmluZyovIGV2ZW50LCAvKkZ1bmN0aW9uKi8gZnApew0KCQkJCWlmKCFub2RlKXtyZXR1cm47fSAvLyB1bmRlZmluZWQNCgkJCQlldmVudCA9IGRlbC5fbm9ybWFsaXplRXZlbnROYW1lKGV2ZW50KTsNCgkJCQlpZihldmVudD09Im9ua2V5cHJlc3MiKXsNCgkJCQkJLy8gd2UgbmVlZCB0byBsaXN0ZW4gdG8gb25rZXlkb3duIHRvIHN5bnRoZXNpemUNCgkJCQkJLy8ga2V5cHJlc3MgZXZlbnRzIHRoYXQgb3RoZXJ3aXNlIHdvbid0IGZpcmUNCgkJCQkJLy8gb24gSUUNCgkJCQkJdmFyIGtkID0gbm9kZS5vbmtleWRvd247DQoJCQkJCWlmKCFrZCB8fCAha2RbbGlzdGVuZXJzTmFtZV0gfHwgIWtkLl9zdGVhbHRoS2V5ZG93bkhhbmRsZSl7DQoJCQkJCQl2YXIgaCA9IGRlbC5hZGQobm9kZSwgIm9ua2V5ZG93biIsIGRlbC5fc3RlYWx0aEtleURvd24pOw0KCQkJCQkJa2QgPSBub2RlLm9ua2V5ZG93bjsNCgkJCQkJCWtkLl9zdGVhbHRoS2V5ZG93bkhhbmRsZSA9IGg7DQoJCQkJCQlrZC5fc3RlYWx0aEtleWRvd25SZWZzID0gMTsNCgkJCQkJfWVsc2V7DQoJCQkJCQlrZC5fc3RlYWx0aEtleWRvd25SZWZzKys7DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIGllbC5hZGQobm9kZSwgZXZlbnQsIGRlbC5fZml4Q2FsbGJhY2soZnApKTsNCgkJCX0sDQoJCQlyZW1vdmU6IGZ1bmN0aW9uKC8qRE9NTm9kZSovIG5vZGUsIC8qU3RyaW5nKi8gZXZlbnQsIC8qSGFuZGxlKi8gaGFuZGxlKXsNCgkJCQlldmVudCA9IGRlbC5fbm9ybWFsaXplRXZlbnROYW1lKGV2ZW50KTsNCgkJCQlpZWwucmVtb3ZlKG5vZGUsIGV2ZW50LCBoYW5kbGUpOyANCgkJCQlpZihldmVudD09Im9ua2V5cHJlc3MiKXsNCgkJCQkJdmFyIGtkID0gbm9kZS5vbmtleWRvd247DQoJCQkJCWlmKC0ta2QuX3N0ZWFsdGhLZXlkb3duUmVmcyA8PSAwKXsNCgkJCQkJCWllbC5yZW1vdmUobm9kZSwgIm9ua2V5ZG93biIsIGtkLl9zdGVhbHRoS2V5ZG93bkhhbmRsZSk7DQoJCQkJCQlkZWxldGUga2QuX3N0ZWFsdGhLZXlkb3duSGFuZGxlOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSwNCgkJCV9ub3JtYWxpemVFdmVudE5hbWU6IGZ1bmN0aW9uKC8qU3RyaW5nKi8gZXZlbnROYW1lKXsNCgkJCQkvLyBHZW5lcmFsbHksIGV2ZW50TmFtZSBzaG91bGQgYmUgbG93ZXIgY2FzZSwgdW5sZXNzIGl0IGlzDQoJCQkJLy8gc3BlY2lhbCBzb21laG93IChlLmcuIGEgTW96aWxsYSBldmVudCkNCgkJCQkvLyBlbnN1cmUgJ29uJw0KCQkJCXJldHVybiBldmVudE5hbWUuc2xpY2UoMCwyKSAhPSAib24iID8gIm9uIiArIGV2ZW50TmFtZSA6IGV2ZW50TmFtZTsNCgkJCX0sDQoJCQlfbm9wOiBmdW5jdGlvbigpe30sDQoJCQlfZml4RXZlbnQ6IGZ1bmN0aW9uKC8qRXZlbnQqLyBldnQsIC8qRE9NTm9kZSovIHNlbmRlcil7DQoJCQkJLy8gc3VtbWFyeToNCgkJCQkvLwkJbm9ybWFsaXplcyBwcm9wZXJ0aWVzIG9uIHRoZSBldmVudCBvYmplY3QgaW5jbHVkaW5nIGV2ZW50DQoJCQkJLy8JCWJ1YmJsaW5nIG1ldGhvZHMsIGtleXN0cm9rZSBub3JtYWxpemF0aW9uLCBhbmQgeC95IHBvc2l0aW9ucw0KCQkJCS8vIGV2dDoNCgkJCQkvLwkJbmF0aXZlIGV2ZW50IG9iamVjdA0KCQkJCS8vIHNlbmRlcjoNCgkJCQkvLwkJbm9kZSB0byB0cmVhdCBhcyAiY3VycmVudFRhcmdldCINCgkJCQlpZighZXZ0KXsNCgkJCQkJdmFyIHcgPSBzZW5kZXIgJiYgKHNlbmRlci5vd25lckRvY3VtZW50IHx8IHNlbmRlci5kb2N1bWVudCB8fCBzZW5kZXIpLnBhcmVudFdpbmRvdyB8fCB3aW5kb3c7DQoJCQkJCWV2dCA9IHcuZXZlbnQ7IA0KCQkJCX0NCgkJCQlpZighZXZ0KXtyZXR1cm4oZXZ0KTt9DQoJCQkJZXZ0LnRhcmdldCA9IGV2dC5zcmNFbGVtZW50OyANCgkJCQlldnQuY3VycmVudFRhcmdldCA9IChzZW5kZXIgfHwgZXZ0LnNyY0VsZW1lbnQpOyANCgkJCQlldnQubGF5ZXJYID0gZXZ0Lm9mZnNldFg7DQoJCQkJZXZ0LmxheWVyWSA9IGV2dC5vZmZzZXRZOw0KCQkJCS8vIEZJWE1FOiBzY3JvbGwgcG9zaXRpb24gcXVlcnkgaXMgZHVwZWQgZnJvbSBkb2pvLmh0bWwgdG8NCgkJCQkvLyBhdm9pZCBkZXBlbmRlbmN5IG9uIHRoYXQgZW50aXJlIG1vZHVsZS4gTm93IHRoYXQgSFRNTCBpcyBpbg0KCQkJCS8vIEJhc2UsIHdlIHNob3VsZCBjb252ZXJ0IGJhY2sgdG8gc29tZXRoaW5nIHNpbWlsYXIgdGhlcmUuDQoJCQkJdmFyIHNlID0gZXZ0LnNyY0VsZW1lbnQsIGRvYyA9IChzZSAmJiBzZS5vd25lckRvY3VtZW50KSB8fCBkb2N1bWVudDsNCgkJCQkvLyBETyBOT1QgcmVwbGFjZSB0aGUgZm9sbG93aW5nIHRvIHVzZSBkb2pvLmJvZHkoKSwgaW4gSUUsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCBzaG91bGQgYmUgdXNlZA0KCQkJCS8vIGhlcmUgcmF0aGVyIHRoYW4gZG9jdW1lbnQuYm9keQ0KCQkJCXZhciBkb2NCb2R5ID0gKChkb2pvLmlzSUUgPCA2KSB8fCAoZG9jWyJjb21wYXRNb2RlIl0gPT0gIkJhY2tDb21wYXQiKSkgPyBkb2MuYm9keSA6IGRvYy5kb2N1bWVudEVsZW1lbnQ7DQoJCQkJdmFyIG9mZnNldCA9IGRvam8uX2dldEllRG9jdW1lbnRFbGVtZW50T2Zmc2V0KCk7DQoJCQkJZXZ0LnBhZ2VYID0gZXZ0LmNsaWVudFggKyBkb2pvLl9maXhJZUJpRGlTY3JvbGxMZWZ0KGRvY0JvZHkuc2Nyb2xsTGVmdCB8fCAwKSAtIG9mZnNldC54Ow0KCQkJCWV2dC5wYWdlWSA9IGV2dC5jbGllbnRZICsgKGRvY0JvZHkuc2Nyb2xsVG9wIHx8IDApIC0gb2Zmc2V0Lnk7DQoJCQkJaWYoZXZ0LnR5cGUgPT0gIm1vdXNlb3ZlciIpeyANCgkJCQkJZXZ0LnJlbGF0ZWRUYXJnZXQgPSBldnQuZnJvbUVsZW1lbnQ7DQoJCQkJfQ0KCQkJCWlmKGV2dC50eXBlID09ICJtb3VzZW91dCIpeyANCgkJCQkJZXZ0LnJlbGF0ZWRUYXJnZXQgPSBldnQudG9FbGVtZW50Ow0KCQkJCX0NCgkJCQlldnQuc3RvcFByb3BhZ2F0aW9uID0gZGVsLl9zdG9wUHJvcGFnYXRpb247DQoJCQkJZXZ0LnByZXZlbnREZWZhdWx0ID0gZGVsLl9wcmV2ZW50RGVmYXVsdDsNCgkJCQlyZXR1cm4gZGVsLl9maXhLZXlzKGV2dCk7DQoJCQl9LA0KCQkJX2ZpeEtleXM6IGZ1bmN0aW9uKGV2dCl7DQoJCQkJc3dpdGNoKGV2dC50eXBlKXsNCgkJCQkJY2FzZSAia2V5cHJlc3MiOg0KCQkJCQkJdmFyIGMgPSAoImNoYXJDb2RlIiBpbiBldnQgPyBldnQuY2hhckNvZGUgOiBldnQua2V5Q29kZSk7DQoJCQkJCQlpZiAoYz09MTApew0KCQkJCQkJCS8vIENUUkwtRU5URVIgaXMgQ1RSTC1BU0NJSSgxMCkgb24gSUUsIGJ1dCBDVFJMLUVOVEVSIG9uIE1vemlsbGENCgkJCQkJCQljPTA7DQoJCQkJCQkJZXZ0LmtleUNvZGUgPSAxMzsNCgkJCQkJCX1lbHNlIGlmKGM9PTEzfHxjPT0yNyl7DQoJCQkJCQkJYz0wOyAvLyBNb3ppbGxhIGNvbnNpZGVycyBFTlRFUiBhbmQgRVNDIG5vbi1wcmludGFibGUNCgkJCQkJCX1lbHNlIGlmKGM9PTMpew0KCQkJCQkJCWM9OTk7IC8vIE1vemlsbGEgbWFwcyBDVFJMLUJSRUFLIHRvIENUUkwtYw0KCQkJCQkJfQ0KCQkJCQkJLy8gTW96aWxsYSBzZXRzIGtleUNvZGUgdG8gMCB3aGVuIHRoZXJlIGlzIGEgY2hhckNvZGUNCgkJCQkJCS8vIGJ1dCB0aGF0IHN0b3BzIHRoZSBldmVudCBvbiBJRS4NCgkJCQkJCWV2dC5jaGFyQ29kZSA9IGM7DQoJCQkJCQlkZWwuX3NldEtleUNoYXIoZXZ0KTsNCgkJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQlyZXR1cm4gZXZ0Ow0KCQkJfSwNCgkJCV9zdGVhbHRoS2V5RG93bjogZnVuY3Rpb24oZXZ0KXsNCgkJCQkvLyBJRSBkb2Vzbid0IGZpcmUga2V5cHJlc3MgZm9yIG1vc3Qgbm9uLXByaW50YWJsZSBjaGFyYWN0ZXJzLg0KCQkJCS8vIG90aGVyIGJyb3dzZXJzIGRvLCB3ZSBzaW11bGF0ZSBpdCBoZXJlLg0KCQkJCXZhciBrcCA9IGV2dC5jdXJyZW50VGFyZ2V0Lm9ua2V5cHJlc3M7DQoJCQkJLy8gb25seSB3b3JrcyBpZiBrcCBleGlzdHMgYW5kIGlzIGEgZGlzcGF0Y2hlcg0KCQkJCWlmKCFrcCB8fCAha3BbbGlzdGVuZXJzTmFtZV0peyByZXR1cm47IH0NCgkJCQkvLyBtdW5nZSBrZXkvY2hhckNvZGUNCgkJCQl2YXIgaz1ldnQua2V5Q29kZTsNCgkJCQkvLyBUaGVzZSBhcmUgV2luZG93cyBWaXJ0dWFsIEtleSBDb2Rlcw0KCQkJCS8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vbGlicmFyeS9kZWZhdWx0LmFzcD91cmw9L2xpYnJhcnkvZW4tdXMvd2ludWkvV2luVUkvV2luZG93c1VzZXJJbnRlcmZhY2UvVXNlcklucHV0L1ZpcnR1YWxLZXlDb2Rlcy5hc3ANCgkJCQl2YXIgdW5wcmludGFibGUgPSBrIT0xMyAmJiBrIT0zMiAmJiBrIT0yNyAmJiAoazw0OHx8az45MCkgJiYgKGs8OTZ8fGs+MTExKSAmJiAoazwxODZ8fGs+MTkyKSAmJiAoazwyMTl8fGs+MjIyKTsNCgkJCQkvLyBzeW50aGVzaXplIGtleXByZXNzIGZvciBtb3N0IHVucHJpbnRhYmxlcyBhbmQgQ1RSTC1rZXlzDQoJCQkJaWYodW5wcmludGFibGV8fGV2dC5jdHJsS2V5KXsNCgkJCQkJdmFyIGMgPSB1bnByaW50YWJsZSA/IDAgOiBrOw0KCQkJCQlpZihldnQuY3RybEtleSl7DQoJCQkJCQlpZihrPT0zIHx8IGs9PTEzKXsNCgkJCQkJCQlyZXR1cm47IC8vIElFIHdpbGwgcG9zdCBDVFJMLUJSRUFLLCBDVFJMLUVOVEVSIGFzIGtleXByZXNzIG5hdGl2ZWx5IA0KCQkJCQkJfWVsc2UgaWYoYz45NSAmJiBjPDEwNil7IA0KCQkJCQkJCWMgLT0gNDg7IC8vIG1hcCBDVFJMLVtudW1wYWQgMC05XSB0byBBU0NJSQ0KCQkJCQkJfWVsc2UgaWYoKCFldnQuc2hpZnRLZXkpJiYoYz49NjUmJmM8PTkwKSl7IA0KCQkJCQkJCWMgKz0gMzI7IC8vIG1hcCBDVFJMLVtBLVpdIHRvIGxvd2VyY2FzZQ0KCQkJCQkJfWVsc2V7IA0KCQkJCQkJCWMgPSBkZWwuX3B1bmN0TWFwW2NdIHx8IGM7IC8vIG1hcCBvdGhlciBwcm9ibGVtYXRpYyBDVFJMIGNvbWJpbmF0aW9ucyB0byBBU0NJSQ0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCS8vIHNpbXVsYXRlIGEga2V5cHJlc3MgZXZlbnQNCgkJCQkJdmFyIGZhdXggPSBkZWwuX3N5bnRoZXNpemVFdmVudChldnQsIHt0eXBlOiAna2V5cHJlc3MnLCBmYXV4OiB0cnVlLCBjaGFyQ29kZTogY30pOw0KCQkJCQlrcC5jYWxsKGV2dC5jdXJyZW50VGFyZ2V0LCBmYXV4KTsNCgkJCQkJZXZ0LmNhbmNlbEJ1YmJsZSA9IGZhdXguY2FuY2VsQnViYmxlOw0KCQkJCQlldnQucmV0dXJuVmFsdWUgPSBmYXV4LnJldHVyblZhbHVlOw0KCQkJCQlfdHJ5U2V0S2V5Q29kZShldnQsIGZhdXgua2V5Q29kZSk7DQoJCQkJfQ0KCQkJfSwNCgkJCS8vIENhbGxlZCBpbiBFdmVudCBzY29wZQ0KCQkJX3N0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKXsNCgkJCQl0aGlzLmNhbmNlbEJ1YmJsZSA9IHRydWU7IA0KCQkJfSwNCgkJCV9wcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKXsNCgkJCQkvLyBTZXR0aW5nIGtleUNvZGUgdG8gMCBpcyB0aGUgb25seSB3YXkgdG8gcHJldmVudCBjZXJ0YWluIGtleXByZXNzZXMgKG5hbWVseQ0KCQkJCS8vIGN0cmwtY29tYmluYXRpb25zIHRoYXQgY29ycmVzcG9uZCB0byBtZW51IGFjY2VsZXJhdG9yIGtleXMpLg0KCQkJCS8vIE90b2gsIGl0IHByZXZlbnRzIHVwc3RyZWFtIGxpc3RlbmVycyBmcm9tIGdldHRpbmcgdGhpcyBpbmZvcm1hdGlvbg0KCQkJCS8vIFRyeSB0byBzcGxpdCB0aGUgZGlmZmVyZW5jZSBoZXJlIGJ5IGNsb2JiZXJpbmcga2V5Q29kZSBvbmx5IGZvciBjdHJsIA0KCQkJCS8vIGNvbWJpbmF0aW9ucy4gSWYgeW91IHN0aWxsIG5lZWQgdG8gYWNjZXNzIHRoZSBrZXkgdXBzdHJlYW0sIGJ1YmJsZWRLZXlDb2RlIGlzDQoJCQkJLy8gcHJvdmlkZWQgYXMgYSB3b3JrYXJvdW5kLg0KCQkJCXRoaXMuYnViYmxlZEtleUNvZGUgPSB0aGlzLmtleUNvZGU7DQoJCQkJaWYodGhpcy5jdHJsS2V5KXtfdHJ5U2V0S2V5Q29kZSh0aGlzLCAwKTt9DQoJCQkJdGhpcy5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQkJfQ0KCQl9KTsNCgkJCQkNCgkJLy8gb3ZlcnJpZGUgc3RvcEV2ZW50IGZvciBJRQ0KCQlkb2pvLnN0b3BFdmVudCA9IGZ1bmN0aW9uKGV2dCl7DQoJCQlldnQgPSBldnQgfHwgd2luZG93LmV2ZW50Ow0KCQkJZGVsLl9zdG9wUHJvcGFnYXRpb24uY2FsbChldnQpOw0KCQkJZGVsLl9wcmV2ZW50RGVmYXVsdC5jYWxsKGV2dCk7DQoJCX0NCgl9DQoJDQoJZGVsLl9zeW50aGVzaXplRXZlbnQgPSBmdW5jdGlvbihldnQsIHByb3BzKXsNCgkJCXZhciBmYXV4ID0gZG9qby5taXhpbih7fSwgZXZ0LCBwcm9wcyk7DQoJCQlkZWwuX3NldEtleUNoYXIoZmF1eCk7DQoJCQkvLyBGSVhNRTogd291bGQgcHJlZmVyIHRvIHVzZSBkb2pvLmhpdGNoOiBkb2pvLmhpdGNoKGV2dCwgZXZ0LnByZXZlbnREZWZhdWx0KTsgDQoJCQkvLyBidXQgaXQgdGhyb3dzIGFuIGVycm9yIHdoZW4gcHJldmVudERlZmF1bHQgaXMgaW52b2tlZCBvbiBTYWZhcmkNCgkJCS8vIGRvZXMgRXZlbnQucHJldmVudERlZmF1bHQgbm90IHN1cHBvcnQgImFwcGx5IiBvbiBTYWZhcmk/DQoJCQlmYXV4LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKXsgZXZ0LnByZXZlbnREZWZhdWx0KCk7IH07IA0KCQkJZmF1eC5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpeyBldnQuc3RvcFByb3BhZ2F0aW9uKCk7IH07IA0KCQkJcmV0dXJuIGZhdXg7DQoJfQ0KCQ0KCQkvLyBPcGVyYSBldmVudCBub3JtYWxpemF0aW9uDQoJaWYoZG9qby5pc09wZXJhKXsNCgkJZG9qby5taXhpbihkZWwsIHsNCgkJCV9maXhFdmVudDogZnVuY3Rpb24oZXZ0LCBzZW5kZXIpew0KCQkJCXN3aXRjaChldnQudHlwZSl7DQoJCQkJCWNhc2UgImtleXByZXNzIjoNCgkJCQkJCXZhciBjID0gZXZ0LndoaWNoOw0KCQkJCQkJaWYoYz09Myl7DQoJCQkJCQkJYz05OTsgLy8gTW96aWxsYSBtYXBzIENUUkwtQlJFQUsgdG8gQ1RSTC1jDQoJCQkJCQl9DQoJCQkJCQkvLyBjYW4ndCB0cmFwIHNvbWUga2V5cyBhdCBhbGwsIGxpa2UgSU5TRVJUIGFuZCBERUxFVEUNCgkJCQkJCS8vIHRoZXJlIGlzIG5vIGRpZmZlcmVudGlhdGluZyBpbmZvIGJldHdlZW4gREVMRVRFIGFuZCAiLiIsIG9yIElOU0VSVCBhbmQgIi0iDQoJCQkJCQljID0gYzw0MSAmJiAhZXZ0LnNoaWZ0S2V5ID8gMCA6IGM7DQoJCQkJCQlpZihldnQuY3RybEtleSAmJiAhZXZ0LnNoaWZ0S2V5ICYmIGM+PTY1ICYmIGM8PTkwKXsNCgkJCQkJCQkvLyBsb3dlcmNhc2UgQ1RSTC1bQS1aXSBrZXlzDQoJCQkJCQkJYyArPSAzMjsNCgkJCQkJCX0NCgkJCQkJCXJldHVybiBkZWwuX3N5bnRoZXNpemVFdmVudChldnQsIHsgY2hhckNvZGU6IGMgfSk7DQoJCQkJfQ0KCQkJCXJldHVybiBldnQ7DQoJCQl9DQoJCX0pOw0KCX0NCgkNCgkJLy8gV2Via2l0IGV2ZW50IG5vcm1hbGl6YXRpb24NCglpZihkb2pvLmlzV2ViS2l0KXsNCgkJCQlkZWwuX2FkZCA9IGRlbC5hZGQ7DQoJCWRlbC5fcmVtb3ZlID0gZGVsLnJlbW92ZTsNCg0KCQlkb2pvLm1peGluKGRlbCwgew0KCQkJYWRkOiBmdW5jdGlvbigvKkRPTU5vZGUqLyBub2RlLCAvKlN0cmluZyovIGV2ZW50LCAvKkZ1bmN0aW9uKi8gZnApew0KCQkJCWlmKCFub2RlKXtyZXR1cm47fSAvLyB1bmRlZmluZWQNCgkJCQl2YXIgaGFuZGxlID0gZGVsLl9hZGQobm9kZSwgZXZlbnQsIGZwKTsNCgkJCQlpZihkZWwuX25vcm1hbGl6ZUV2ZW50TmFtZShldmVudCkgPT0gImtleXByZXNzIil7DQoJCQkJCS8vIHdlIG5lZWQgdG8gbGlzdGVuIHRvIG9ua2V5ZG93biB0byBzeW50aGVzaXplDQoJCQkJCS8vIGtleXByZXNzIGV2ZW50cyB0aGF0IG90aGVyd2lzZSB3b24ndCBmaXJlDQoJCQkJCS8vIGluIFNhZmFyaSAzLjErOiBodHRwczovL2xpc3RzLndlYmtpdC5vcmcvcGlwZXJtYWlsL3dlYmtpdC1kZXYvMjAwNy1EZWNlbWJlci8wMDI5OTIuaHRtbA0KCQkJCQloYW5kbGUuX3N0ZWFsdGhLZXlEb3duSGFuZGxlID0gZGVsLl9hZGQobm9kZSwgImtleWRvd24iLCBmdW5jdGlvbihldnQpew0KCQkJCQkJLy9BIHZhcmlhdGlvbiBvbiB0aGUgSUUgX3N0ZWFsdGhLZXlkb3duIGZ1bmN0aW9uDQoJCQkJCQkvL1N5bnRoZXNpemUgYW4gb25rZXlwcmVzcyBldmVudCwgYnV0IG9ubHkgZm9yIHVucHJpbnRhYmxlIGNoYXJhY3RlcnMuDQoJCQkJCQl2YXIgaz1ldnQua2V5Q29kZTsNCgkJCQkJCS8vIFRoZXNlIGFyZSBXaW5kb3dzIFZpcnR1YWwgS2V5IENvZGVzDQoJCQkJCQkvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2xpYnJhcnkvZGVmYXVsdC5hc3A/dXJsPS9saWJyYXJ5L2VuLXVzL3dpbnVpL1dpblVJL1dpbmRvd3NVc2VySW50ZXJmYWNlL1VzZXJJbnB1dC9WaXJ0dWFsS2V5Q29kZXMuYXNwDQoJCQkJCQl2YXIgdW5wcmludGFibGUgPSBrIT0xMyAmJiBrIT0zMiAmJiAoazw0OCB8fCBrPjkwKSAmJiAoazw5NiB8fCBrPjExMSkgJiYgKGs8MTg2IHx8IGs+MTkyKSAmJiAoazwyMTkgfHwgaz4yMjIpOw0KCQkJCQkJLy8gc3ludGhlc2l6ZSBrZXlwcmVzcyBmb3IgbW9zdCB1bnByaW50YWJsZXMgYW5kIENUUkwta2V5cw0KCQkJCQkJaWYodW5wcmludGFibGUgfHwgZXZ0LmN0cmxLZXkpew0KCQkJCQkJCXZhciBjID0gdW5wcmludGFibGUgPyAwIDogazsNCgkJCQkJCQlpZihldnQuY3RybEtleSl7DQoJCQkJCQkJCWlmKGs9PTMgfHwgaz09MTMpew0KCQkJCQkJCQkJcmV0dXJuOyAvLyBJRSB3aWxsIHBvc3QgQ1RSTC1CUkVBSywgQ1RSTC1FTlRFUiBhcyBrZXlwcmVzcyBuYXRpdmVseSANCgkJCQkJCQkJfWVsc2UgaWYoYz45NSAmJiBjPDEwNil7IA0KCQkJCQkJCQkJYyAtPSA0ODsgLy8gbWFwIENUUkwtW251bXBhZCAwLTldIHRvIEFTQ0lJDQoJCQkJCQkJCX1lbHNlIGlmKCFldnQuc2hpZnRLZXkgJiYgYz49NjUgJiYgYzw9OTApeyANCgkJCQkJCQkJCWMgKz0gMzI7IC8vIG1hcCBDVFJMLVtBLVpdIHRvIGxvd2VyY2FzZQ0KCQkJCQkJCQl9ZWxzZXsgDQoJCQkJCQkJCQljID0gZGVsLl9wdW5jdE1hcFtjXSB8fCBjOyAvLyBtYXAgb3RoZXIgcHJvYmxlbWF0aWMgQ1RSTCBjb21iaW5hdGlvbnMgdG8gQVNDSUkNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCQkvLyBzaW11bGF0ZSBhIGtleXByZXNzIGV2ZW50DQoJCQkJCQkJdmFyIGZhdXggPSBkZWwuX3N5bnRoZXNpemVFdmVudChldnQsIHt0eXBlOiAna2V5cHJlc3MnLCBmYXV4OiB0cnVlLCBjaGFyQ29kZTogY30pOw0KCQkJCQkJCWZwLmNhbGwoZXZ0LmN1cnJlbnRUYXJnZXQsIGZhdXgpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQkJcmV0dXJuIGhhbmRsZTsgLypIYW5kbGUqLw0KCQkJfSwNCg0KCQkJcmVtb3ZlOiBmdW5jdGlvbigvKkRPTU5vZGUqLyBub2RlLCAvKlN0cmluZyovIGV2ZW50LCAvKkhhbmRsZSovIGhhbmRsZSl7DQoJCQkJaWYobm9kZSl7DQoJCQkJCWlmKGhhbmRsZS5fc3RlYWx0aEtleURvd25IYW5kbGUpew0KCQkJCQkJZGVsLl9yZW1vdmUobm9kZSwgImtleWRvd24iLCBoYW5kbGUuX3N0ZWFsdGhLZXlEb3duSGFuZGxlKTsNCgkJCQkJfQ0KCQkJCQlkZWwuX3JlbW92ZShub2RlLCBldmVudCwgaGFuZGxlKTsNCgkJCQl9DQoJCQl9LA0KCQkJX2ZpeEV2ZW50OiBmdW5jdGlvbihldnQsIHNlbmRlcil7DQoJCQkJc3dpdGNoKGV2dC50eXBlKXsNCgkJCQkJY2FzZSAia2V5cHJlc3MiOg0KCQkJCQkJaWYoZXZ0LmZhdXgpeyByZXR1cm4gZXZ0OyB9DQoJCQkJCQl2YXIgYyA9IGV2dC5jaGFyQ29kZTsNCgkJCQkJCWMgPSBjPj0zMiA/IGMgOiAwOw0KCQkJCQkJcmV0dXJuIGRlbC5fc3ludGhlc2l6ZUV2ZW50KGV2dCwge2NoYXJDb2RlOiBjLCBmYXV4OiB0cnVlfSk7DQoJCQkJfQ0KCQkJCXJldHVybiBldnQ7DQoJCQl9DQoJCX0pOw0KCQl9DQoJfSkoKTsNCg0KaWYoZG9qby5pc0lFKXsNCgkvLyBrZWVwIHRoaXMgb3V0IG9mIHRoZSBjbG9zdXJlDQoJLy8gY2xvc2luZyBvdmVyICdpZWwnIG9yICdpZWgnIGIwcmtzIGxlYWsgcHJldmVudGlvbg0KCS8vIGxzW2ldIGlzIGFuIGluZGV4IGludG8gdGhlIG1hc3RlciBoYW5kbGVyIGFycmF5DQoJZG9qby5faWVEaXNwYXRjaGVyID0gZnVuY3Rpb24oYXJncywgc2VuZGVyKXsNCgkJdmFyIGFwID0gQXJyYXkucHJvdG90eXBlLA0KCQkJaCA9IGRvam8uX2llX2xpc3RlbmVyLmhhbmRsZXJzLA0KCQkJYyA9IGFyZ3MuY2FsbGVlLA0KCQkJbHMgPSBjW2Rvam8uX2llTGlzdGVuZXJzTmFtZV0sDQoJCQl0ID0gaFtjLnRhcmdldF07DQoJCS8vIHJldHVybiB2YWx1ZSBjb21lcyBmcm9tIG9yaWdpbmFsIHRhcmdldCBmdW5jdGlvbg0KCQl2YXIgciA9IHQgJiYgdC5hcHBseShzZW5kZXIsIGFyZ3MpOw0KCQkvLyBtYWtlIGxvY2FsIGNvcHkgb2YgbGlzdGVuZXIgYXJyYXkgc28gaXQncyBpbW11dGFibGUgZHVyaW5nIHByb2Nlc3NpbmcNCgkJdmFyIGxscyA9IFtdLmNvbmNhdChscyk7DQoJCS8vIGludm9rZSBsaXN0ZW5lcnMgYWZ0ZXIgdGFyZ2V0IGZ1bmN0aW9uDQoJCWZvcih2YXIgaSBpbiBsbHMpew0KCQkJdmFyIGYgPSBoW2xsc1tpXV07DQoJCQlpZighKGkgaW4gYXApICYmIGYpew0KCQkJCWYuYXBwbHkoc2VuZGVyLCBhcmdzKTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcjsNCgl9DQoJZG9qby5fZ2V0SWVEaXNwYXRjaGVyID0gZnVuY3Rpb24oKXsNCgkJLy8gZW5zdXJlIHRoZSByZXR1cm5lZCBmdW5jdGlvbiBjbG9zZXMgb3ZlciBub3RoaW5nICgibmV3IEZ1bmN0aW9uIiBhcHBhcmVudGx5IGRvZXNuJ3QgY2xvc2UpDQoJCXJldHVybiBuZXcgRnVuY3Rpb24oZG9qby5fc2NvcGVOYW1lICsgIi5faWVEaXNwYXRjaGVyKGFyZ3VtZW50cywgdGhpcykiKTsgLy8gZnVuY3Rpb24NCgl9DQoJLy8ga2VlcCB0aGlzIG91dCBvZiB0aGUgY2xvc3VyZSB0byByZWR1Y2UgUkFNIGFsbG9jYXRpb24NCglkb2pvLl9ldmVudF9saXN0ZW5lci5fZml4Q2FsbGJhY2sgPSBmdW5jdGlvbihmcCl7DQoJCXZhciBmID0gZG9qby5fZXZlbnRfbGlzdGVuZXIuX2ZpeEV2ZW50Ow0KCQlyZXR1cm4gZnVuY3Rpb24oZSl7IHJldHVybiBmcC5jYWxsKHRoaXMsIGYoZSwgdGhpcykpOyB9Ow0KCX0NCn0NCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuaHRtbCJdKXsgLy9faGFzUmVzb3VyY2UgY2hlY2tzIGFkZGVkIGJ5IGJ1aWxkLiBEbyBub3QgdXNlIF9oYXNSZXNvdXJjZSBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQpkb2pvLl9oYXNSZXNvdXJjZVsiZG9qby5fYmFzZS5odG1sIl0gPSB0cnVlOw0KDQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UuaHRtbCIpOw0KDQovLyBGSVhNRTogbmVlZCB0byBhZGQgdW5pdCB0ZXN0cyBmb3IgYWxsIHRoZSBzZW1pLXB1YmxpYyBtZXRob2RzDQoNCnRyeXsNCglkb2N1bWVudC5leGVjQ29tbWFuZCgiQmFja2dyb3VuZEltYWdlQ2FjaGUiLCBmYWxzZSwgdHJ1ZSk7DQp9Y2F0Y2goZSl7DQoJLy8gc2FuZSBicm93c2VycyBkb24ndCBoYXZlIGNhY2hlICJpc3N1ZXMiDQp9DQoNCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQovLyBET00gRnVuY3Rpb25zDQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KDQovKj09PT09DQpkb2pvLmJ5SWQgPSBmdW5jdGlvbihpZCwgZG9jKXsNCgkvLwlzdW1tYXJ5Og0KCS8vCQlSZXR1cm5zIERPTSBub2RlIHdpdGggbWF0Y2hpbmcgYGlkYCBhdHRyaWJ1dGUgb3IgYG51bGxgDQoJLy8JCWlmIG5vdCBmb3VuZC4gSWYgYGlkYCBpcyBhIERvbU5vZGUsIHRoaXMgZnVuY3Rpb24gaXMgYSBuby1vcC4NCgkvLw0KCS8vCWlkOiBTdHJpbmd8RE9NTm9kZQ0KCS8vCSAJQSBzdHJpbmcgdG8gbWF0Y2ggYW4gSFRNTCBpZCBhdHRyaWJ1dGUgb3IgYSByZWZlcmVuY2UgdG8gYSBET00gTm9kZQ0KCS8vDQoJLy8JZG9jOiBEb2N1bWVudD8NCgkvLwkJRG9jdW1lbnQgdG8gd29yayBpbi4gRGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgdmFsdWUgb2YNCgkvLwkJZG9qby5kb2MuICBDYW4gYmUgdXNlZCB0byByZXRyaWV2ZQ0KCS8vCQlub2RlIHJlZmVyZW5jZXMgZnJvbSBvdGhlciBkb2N1bWVudHMuDQoJLy8NCgkvLwlleGFtcGxlOg0KCS8vCUxvb2sgdXAgYSBub2RlIGJ5IElEOg0KCS8vCXwJdmFyIG4gPSBkb2pvLmJ5SWQoImZvbyIpOw0KCS8vDQoJLy8JZXhhbXBsZToNCgkvLwlDaGVjayBpZiBhIG5vZGUgZXhpc3RzLCBhbmQgdXNlIGl0Lg0KCS8vCXwJdmFyIG4gPSBkb2pvLmJ5SWQoImJhciIpOw0KCS8vCXwJaWYobil7IGRvU3R1ZmYoKSAuLi4gfQ0KCS8vDQoJLy8JZXhhbXBsZToNCgkvLwlBbGxvdyBzdHJpbmcgb3IgRG9tTm9kZSByZWZlcmVuY2VzIHRvIGJlIHBhc3NlZCB0byBhIGN1c3RvbSBmdW5jdGlvbjoNCgkvLwl8CXZhciBmb28gPSBmdW5jdGlvbihub2RlT3JJZCl7DQoJLy8JfAkJbm9kZU9ySWQgPSBkb2pvLmJ5SWQobm9kZU9ySWQpOw0KCS8vCXwJCS8vIC4uLiBtb3JlIHN0dWZmDQoJLy8JfAl9DQo9PT09PSovDQoNCmlmKGRvam8uaXNJRSB8fCBkb2pvLmlzT3BlcmEpew0KCWRvam8uYnlJZCA9IGZ1bmN0aW9uKGlkLCBkb2Mpew0KCQlpZih0eXBlb2YgaWQgIT0gInN0cmluZyIpew0KCQkJcmV0dXJuIGlkOw0KCQl9DQoJCXZhciBfZCA9IGRvYyB8fCBkb2pvLmRvYywgdGUgPSBfZC5nZXRFbGVtZW50QnlJZChpZCk7DQoJCS8vIGF0dHJpYnV0ZXMuaWQudmFsdWUgaXMgYmV0dGVyIHRoYW4ganVzdCBpZCBpbiBjYXNlIHRoZSANCgkJLy8gdXNlciBoYXMgYSBuYW1lPWlkIGluc2lkZSBhIGZvcm0NCgkJaWYodGUgJiYgKHRlLmF0dHJpYnV0ZXMuaWQudmFsdWUgPT0gaWQgfHwgdGUuaWQgPT0gaWQpKXsNCgkJCXJldHVybiB0ZTsNCgkJfWVsc2V7DQoJCQl2YXIgZWxlcyA9IF9kLmFsbFtpZF07DQoJCQlpZighZWxlcyB8fCBlbGVzLm5vZGVOYW1lKXsNCgkJCQllbGVzID0gW2VsZXNdOw0KCQkJfQ0KCQkJLy8gaWYgbW9yZSB0aGFuIDEsIGNob29zZSBmaXJzdCB3aXRoIHRoZSBjb3JyZWN0IGlkDQoJCQl2YXIgaT0wOw0KCQkJd2hpbGUoKHRlPWVsZXNbaSsrXSkpew0KCQkJCWlmKCh0ZS5hdHRyaWJ1dGVzICYmIHRlLmF0dHJpYnV0ZXMuaWQgJiYgdGUuYXR0cmlidXRlcy5pZC52YWx1ZSA9PSBpZCkNCgkJCQkJfHwgdGUuaWQgPT0gaWQpew0KCQkJCQlyZXR1cm4gdGU7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCn1lbHNlew0KCWRvam8uYnlJZCA9IGZ1bmN0aW9uKGlkLCBkb2Mpew0KCQkvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCXJldHVybiAodHlwZW9mIGlkID09ICJzdHJpbmciKSA/IChkb2MgfHwgZG9qby5kb2MpLmdldEVsZW1lbnRCeUlkKGlkKSA6IGlkOyAvLyBEb21Ob2RlDQoJfTsNCn0NCi8qPT09PT0NCn07DQo9PT09PSovDQoNCihmdW5jdGlvbigpew0KCXZhciBkID0gZG9qbzsNCgl2YXIgYnlJZCA9IGQuYnlJZDsNCg0KCXZhciBfZGVzdHJveUNvbnRhaW5lciA9IG51bGwsDQoJCV9kZXN0cm95RG9jOw0KCQlkLmFkZE9uV2luZG93VW5sb2FkKGZ1bmN0aW9uKCl7DQoJCV9kZXN0cm95Q29udGFpbmVyID0gbnVsbDsgLy9wcmV2ZW50IElFIGxlYWsNCgl9KTsNCgkNCi8qPT09PT0NCglkb2pvLl9kZXN0cm95RWxlbWVudCA9IGZ1bmN0aW9uKG5vZGUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLyAJCUV4aXN0aW5nIGFsaWFzIGZvciBgZG9qby5kZXN0cm95YC4gRGVwcmVjYXRlZCwgd2lsbCBiZSByZW1vdmVkDQoJCS8vIAkJaW4gMi4wDQoJfQ0KPT09PT0qLw0KCWRvam8uX2Rlc3Ryb3lFbGVtZW50ID0gZG9qby5kZXN0cm95ID0gZnVuY3Rpb24oLypTdHJpbmd8RG9tTm9kZSovbm9kZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZW1vdmVzIGEgbm9kZSBmcm9tIGl0cyBwYXJlbnQsIGNsb2JiZXJpbmcgaXQgYW5kIGFsbCBvZiBpdHMNCgkJLy8JCWNoaWxkcmVuLg0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVJlbW92ZXMgYSBub2RlIGZyb20gaXRzIHBhcmVudCwgY2xvYmJlcmluZyBpdCBhbmQgYWxsIG9mIGl0cw0KCQkvLwkJY2hpbGRyZW4uIEZ1bmN0aW9uIG9ubHkgd29ya3Mgd2l0aCBEb21Ob2RlcywgYW5kIHJldHVybnMgbm90aGluZy4NCgkJLy8NCgkJLy8Jbm9kZToNCgkJLy8JCUEgU3RyaW5nIElEIG9yIERvbU5vZGUgcmVmZXJlbmNlIG9mIHRoZSBlbGVtZW50IHRvIGJlIGRlc3Ryb3llZA0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlEZXN0cm95IGEgbm9kZSBieUlkOg0KCQkvLwl8CWRvam8uZGVzdHJveSgic29tZUlkIik7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCURlc3Ryb3kgYWxsIG5vZGVzIGluIGEgbGlzdCBieSByZWZlcmVuY2U6DQoJCS8vCXwJZG9qby5xdWVyeSgiLnNvbWVOb2RlIikuZm9yRWFjaChkb2pvLmRlc3Ryb3kpOw0KDQoJCW5vZGUgPSBieUlkKG5vZGUpOw0KCQl0cnl7DQoJCQl2YXIgZG9jID0gbm9kZS5vd25lckRvY3VtZW50Ow0KCQkJLy8gY2Fubm90IHVzZSBfZGVzdHJveUNvbnRhaW5lci5vd25lckRvY3VtZW50IHNpbmNlIHRoaXMgY2FuIHRocm93IGFuIGV4Y2VwdGlvbiBvbiBJRQ0KCQkJaWYoIV9kZXN0cm95Q29udGFpbmVyIHx8IF9kZXN0cm95RG9jICE9IGRvYyl7DQoJCQkJX2Rlc3Ryb3lDb250YWluZXIgPSBkb2MuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQkJX2Rlc3Ryb3lEb2MgPSBkb2M7DQoJCQl9DQoJCQlfZGVzdHJveUNvbnRhaW5lci5hcHBlbmRDaGlsZChub2RlLnBhcmVudE5vZGUgPyBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSkgOiBub2RlKTsNCgkJCS8vIE5PVEU6IHNlZSBodHRwOi8vdHJhYy5kb2pvdG9vbGtpdC5vcmcvdGlja2V0LzI5MzEuIFRoaXMgbWF5IGJlIGEgYnVnIGFuZCBub3QgYSBmZWF0dXJlDQoJCQlfZGVzdHJveUNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsNCgkJfWNhdGNoKGUpew0KCQkJLyogc3F1ZWxjaCAqLw0KCQl9DQoJfTsNCg0KCWRvam8uaXNEZXNjZW5kYW50ID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypEb21Ob2RlfFN0cmluZyovYW5jZXN0b3Ipew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyB0cnVlIGlmIG5vZGUgaXMgYSBkZXNjZW5kYW50IG9mIGFuY2VzdG9yDQoJCS8vCW5vZGU6IHN0cmluZyBpZCBvciBub2RlIHJlZmVyZW5jZSB0byB0ZXN0DQoJCS8vCWFuY2VzdG9yOiBzdHJpbmcgaWQgb3Igbm9kZSByZWZlcmVuY2Ugb2YgcG90ZW50aWFsIHBhcmVudCB0byB0ZXN0IGFnYWluc3QNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JVGVzdCBpcyBub2RlIGlkPSJiYXIiIGlzIGEgZGVzY2VuZGFudCBvZiBub2RlIGlkPSJmb28iDQoJCS8vCXwJaWYoZG9qby5pc0Rlc2NlbmRhbnQoImJhciIsICJmb28iKSl7IC4uLiB9DQoJCXRyeXsNCgkJCW5vZGUgPSBieUlkKG5vZGUpOw0KCQkJYW5jZXN0b3IgPSBieUlkKGFuY2VzdG9yKTsNCgkJCXdoaWxlKG5vZGUpew0KCQkJCWlmKG5vZGUgPT0gYW5jZXN0b3Ipew0KCQkJCQlyZXR1cm4gdHJ1ZTsgLy8gQm9vbGVhbg0KCQkJCX0NCgkJCQlub2RlID0gbm9kZS5wYXJlbnROb2RlOw0KCQkJfQ0KCQl9Y2F0Y2goZSl7IC8qIHNxdWVsY2gsIHJldHVybiBmYWxzZSAqLyB9DQoJCXJldHVybiBmYWxzZTsgLy8gQm9vbGVhbg0KCX07DQoNCglkb2pvLnNldFNlbGVjdGFibGUgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKkJvb2xlYW4qL3NlbGVjdGFibGUpew0KCQkvLwlzdW1tYXJ5OiANCgkJLy8JCUVuYWJsZSBvciBkaXNhYmxlIHNlbGVjdGlvbiBvbiBhIG5vZGUNCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byBub2RlDQoJCS8vCXNlbGVjdGFibGU6DQoJCS8vCQlzdGF0ZSB0byBwdXQgdGhlIG5vZGUgaW4uIGZhbHNlIGluZGljYXRlcyB1bnNlbGVjdGFibGUsIHRydWUgDQoJCS8vCQlhbGxvd3Mgc2VsZWN0aW9uLg0KCQkvLwlleGFtcGxlOg0KCQkvLwlNYWtlIHRoZSBub2RlIGlkPSJiYXIiIHVuc2VsZWN0YWJsZQ0KCQkvLwl8CWRvam8uc2V0U2VsZWN0YWJsZSgiYmFyIik7IA0KCQkvLwlleGFtcGxlOg0KCQkvLwlNYWtlIHRoZSBub2RlIGlkPSJiYXIiIHNlbGVjdGFibGUNCgkJLy8JfAlkb2pvLnNldFNlbGVjdGFibGUoImJhciIsIHRydWUpOw0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJCQlpZihkLmlzTW96aWxsYSl7DQoJCQlub2RlLnN0eWxlLk1velVzZXJTZWxlY3QgPSBzZWxlY3RhYmxlID8gIiIgOiAibm9uZSI7DQoJCX1lbHNlIGlmKGQuaXNLaHRtbCB8fCBkLmlzV2ViS2l0KXsNCgkJCQkJbm9kZS5zdHlsZS5LaHRtbFVzZXJTZWxlY3QgPSBzZWxlY3RhYmxlID8gImF1dG8iIDogIm5vbmUiOw0KCQkJCX1lbHNlIGlmKGQuaXNJRSl7DQoJCQl2YXIgdiA9IChub2RlLnVuc2VsZWN0YWJsZSA9IHNlbGVjdGFibGUgPyAiIiA6ICJvbiIpOw0KCQkJZC5xdWVyeSgiKiIsIG5vZGUpLmZvckVhY2goIml0ZW0udW5zZWxlY3RhYmxlID0gJyIrdisiJyIpOw0KCQl9DQoJCQkJLy9GSVhNRTogZWxzZT8gIE9wZXJhPw0KCX07DQoNCgl2YXIgX2luc2VydEJlZm9yZSA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypEb21Ob2RlKi9yZWYpew0KCQl2YXIgcGFyZW50ID0gcmVmLnBhcmVudE5vZGU7DQoJCWlmKHBhcmVudCl7DQoJCQlwYXJlbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHJlZik7DQoJCX0NCgl9Ow0KDQoJdmFyIF9pbnNlcnRBZnRlciA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypEb21Ob2RlKi9yZWYpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJVHJ5IHRvIGluc2VydCBub2RlIGFmdGVyIHJlZg0KCQl2YXIgcGFyZW50ID0gcmVmLnBhcmVudE5vZGU7DQoJCWlmKHBhcmVudCl7DQoJCQlpZihwYXJlbnQubGFzdENoaWxkID09IHJlZil7DQoJCQkJcGFyZW50LmFwcGVuZENoaWxkKG5vZGUpOw0KCQkJfWVsc2V7DQoJCQkJcGFyZW50Lmluc2VydEJlZm9yZShub2RlLCByZWYubmV4dFNpYmxpbmcpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCWRvam8ucGxhY2UgPSBmdW5jdGlvbihub2RlLCByZWZOb2RlLCBwb3NpdGlvbil7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlBdHRlbXB0IHRvIGluc2VydCBub2RlIGludG8gdGhlIERPTSwgY2hvb3NpbmcgZnJvbSB2YXJpb3VzIHBvc2l0aW9uaW5nIG9wdGlvbnMuDQoJCS8vCQlSZXR1cm5zIHRoZSBmaXJzdCBhcmd1bWVudCByZXNvbHZlZCB0byBhIERPTSBub2RlLg0KCQkvLw0KCQkvLwlub2RlOiBTdHJpbmd8RG9tTm9kZQ0KCQkvLwkJaWQgb3Igbm9kZSByZWZlcmVuY2UsIG9yIEhUTUwgZnJhZ21lbnQgc3RhcnRpbmcgd2l0aCAiPCIgdG8gcGxhY2UgcmVsYXRpdmUgdG8gcmVmTm9kZQ0KCQkvLw0KCQkvLwlyZWZOb2RlOiBTdHJpbmd8RG9tTm9kZQ0KCQkvLwkJaWQgb3Igbm9kZSByZWZlcmVuY2UgdG8gdXNlIGFzIGJhc2lzIGZvciBwbGFjZW1lbnQNCgkJLy8NCgkJLy8JcG9zaXRpb246IFN0cmluZ3xOdW1iZXI/DQoJCS8vCQlzdHJpbmcgbm90aW5nIHRoZSBwb3NpdGlvbiBvZiBub2RlIHJlbGF0aXZlIHRvIHJlZk5vZGUgb3IgYQ0KCQkvLwkJbnVtYmVyIGluZGljYXRpbmcgdGhlIGxvY2F0aW9uIGluIHRoZSBjaGlsZE5vZGVzIGNvbGxlY3Rpb24gb2YgcmVmTm9kZS4NCgkJLy8JCUFjY2VwdGVkIHN0cmluZyB2YWx1ZXMgYXJlOg0KCQkvLwl8CSogYmVmb3JlDQoJCS8vCXwJKiBhZnRlcg0KCQkvLwl8CSogcmVwbGFjZQ0KCQkvLwl8CSogb25seQ0KCQkvLwl8CSogZmlyc3QNCgkJLy8JfAkqIGxhc3QNCgkJLy8JCSJmaXJzdCIgYW5kICJsYXN0IiBpbmRpY2F0ZSBwb3NpdGlvbnMgYXMgY2hpbGRyZW4gb2YgcmVmTm9kZSwgInJlcGxhY2UiIHJlcGxhY2VzIHJlZk5vZGUsDQoJCS8vCQkib25seSIgcmVwbGFjZXMgYWxsIGNoaWxkcmVuLiAgcG9zaXRpb24gZGVmYXVsdHMgdG8gImxhc3QiIGlmIG5vdCBzcGVjaWZpZWQNCgkJLy8NCgkJLy8JcmV0dXJuczogRG9tTm9kZQ0KCQkvLwkJUmV0dXJuZWQgdmFsdWVzIGlzIHRoZSBmaXJzdCBhcmd1bWVudCByZXNvbHZlZCB0byBhIERPTSBub2RlLg0KCQkvLw0KCQkvLwkJLnBsYWNlKCkgaXMgYWxzbyBhIG1ldGhvZCBvZiBgZG9qby5Ob2RlTGlzdGAsIGFsbG93aW5nIGBkb2pvLnF1ZXJ5YCBub2RlIGxvb2t1cHMuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlQbGFjZSBhIG5vZGUgYnkgc3RyaW5nIGlkIGFzIHRoZSBsYXN0IGNoaWxkIG9mIGFub3RoZXIgbm9kZSBieSBzdHJpbmcgaWQ6DQoJCS8vCXwJZG9qby5wbGFjZSgic29tZU5vZGUiLCAiYW5vdGhlck5vZGUiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCVBsYWNlIGEgbm9kZSBieSBzdHJpbmcgaWQgYmVmb3JlIGFub3RoZXIgbm9kZSBieSBzdHJpbmcgaWQNCgkJLy8JfAlkb2pvLnBsYWNlKCJzb21lTm9kZSIsICJhbm90aGVyTm9kZSIsICJiZWZvcmUiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCUNyZWF0ZSBhIE5vZGUsIGFuZCBwbGFjZSBpdCBpbiB0aGUgYm9keSBlbGVtZW50IChsYXN0IGNoaWxkKToNCgkJLy8JfAlkb2pvLnBsYWNlKCI8ZGl2PjwvZGl2PiIsIGRvam8uYm9keSgpKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCVB1dCBhIG5ldyBMSSBhcyB0aGUgZmlyc3QgY2hpbGQgb2YgYSBsaXN0IGJ5IGlkOg0KCQkvLwl8CWRvam8ucGxhY2UoIjxsaT48L2xpPiIsICJzb21lVWwiLCAiZmlyc3QiKTsNCg0KCQlyZWZOb2RlID0gYnlJZChyZWZOb2RlKTsNCgkJaWYodHlwZW9mIG5vZGUgPT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQlub2RlID0gbm9kZS5jaGFyQXQoMCkgPT0gIjwiID8gZC5fdG9Eb20obm9kZSwgcmVmTm9kZS5vd25lckRvY3VtZW50KSA6IGJ5SWQobm9kZSk7DQoJCX0NCgkJaWYodHlwZW9mIHBvc2l0aW9uID09ICJudW1iZXIiKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJdmFyIGNuID0gcmVmTm9kZS5jaGlsZE5vZGVzOw0KCQkJaWYoIWNuLmxlbmd0aCB8fCBjbi5sZW5ndGggPD0gcG9zaXRpb24pew0KCQkJCXJlZk5vZGUuYXBwZW5kQ2hpbGQobm9kZSk7DQoJCQl9ZWxzZXsNCgkJCQlfaW5zZXJ0QmVmb3JlKG5vZGUsIGNuW3Bvc2l0aW9uIDwgMCA/IDAgOiBwb3NpdGlvbl0pOw0KCQkJfQ0KCQl9ZWxzZXsNCgkJCXN3aXRjaChwb3NpdGlvbil7DQoJCQkJY2FzZSAiYmVmb3JlIjoNCgkJCQkJX2luc2VydEJlZm9yZShub2RlLCByZWZOb2RlKTsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAiYWZ0ZXIiOg0KCQkJCQlfaW5zZXJ0QWZ0ZXIobm9kZSwgcmVmTm9kZSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgInJlcGxhY2UiOg0KCQkJCQlyZWZOb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5vZGUsIHJlZk5vZGUpOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICJvbmx5IjoNCgkJCQkJZC5lbXB0eShyZWZOb2RlKTsNCgkJCQkJcmVmTm9kZS5hcHBlbmRDaGlsZChub2RlKTsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAiZmlyc3QiOg0KCQkJCQlpZihyZWZOb2RlLmZpcnN0Q2hpbGQpew0KCQkJCQkJX2luc2VydEJlZm9yZShub2RlLCByZWZOb2RlLmZpcnN0Q2hpbGQpOw0KCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQkJLy8gZWxzZSBmYWxsdGhyb3VnaC4uLg0KCQkJCWRlZmF1bHQ6IC8vIGFrYTogbGFzdA0KCQkJCQlyZWZOb2RlLmFwcGVuZENoaWxkKG5vZGUpOw0KCQkJfQ0KCQl9DQoJCXJldHVybiBub2RlOyAvLyBEb21Ob2RlDQoJfQ0KDQoJLy8gQm94IGZ1bmN0aW9ucyB3aWxsIGFzc3VtZSB0aGlzIG1vZGVsLg0KCS8vIE9uIElFL09wZXJhLCBCT1JERVJfQk9YIHdpbGwgYmUgc2V0IGlmIHRoZSBwcmltYXJ5IGRvY3VtZW50IGlzIGluIHF1aXJrcyBtb2RlLg0KCS8vIENhbiBiZSBzZXQgdG8gY2hhbmdlIGJlaGF2aW9yIG9mIGJveCBzZXR0ZXJzLg0KDQoJLy8gY2FuIGJlIGVpdGhlcjoNCgkvLwkiYm9yZGVyLWJveCINCgkvLwkiY29udGVudC1ib3giIChkZWZhdWx0KQ0KCWRvam8uYm94TW9kZWwgPSAiY29udGVudC1ib3giOw0KDQoJLy8gV2UgcHVudCBwZXItbm9kZSBib3ggbW9kZSB0ZXN0aW5nIGNvbXBsZXRlbHkuDQoJLy8gSWYgYW55Ym9keSBjYXJlcywgd2UgY2FuIHByb3ZpZGUgYW4gYWRkaXRpb25hbCAob3B0aW9uYWwpIHVuaXQgDQoJLy8gdGhhdCBvdmVycmlkZXMgZXhpc3RpbmcgY29kZSB0byBpbmNsdWRlIHBlci1ub2RlIGJveCBzZW5zaXRpdml0eS4NCg0KCS8vIE9wZXJhIGRvY3VtZW50YXRpb24gY2xhaW1zIHRoYXQgT3BlcmEgOSB1c2VzIGJvcmRlci1ib3ggaW4gQmFja0NvbXBhdCBtb2RlLg0KCS8vIGJ1dCBleHBlcmltZW50cyAoT3BlcmEgOS4xMC44Njc5IG9uIFdpbmRvd3MgVmlzdGEpIGluZGljYXRlIHRoYXQgaXQgYWN0dWFsbHkgY29udGludWVzIHRvIHVzZSBjb250ZW50LWJveC4NCgkvLyBJSVJDLCBlYXJsaWVyIHZlcnNpb25zIG9mIE9wZXJhIGRpZCBpbiBmYWN0IHVzZSBib3JkZXItYm94Lg0KCS8vIE9wZXJhIGd1eXMsIHRoaXMgaXMgcmVhbGx5IGNvbmZ1c2luZy4gT3BlcmEgYmVpbmcgYnJva2VuIGluIHF1aXJrcyBtb2RlIGlzIG5vdCBvdXIgZmF1bHQuDQoNCgkJaWYoZC5pc0lFIC8qfHwgZG9qby5pc09wZXJhKi8pew0KCQkvLyBjbGllbnQgY29kZSBtYXkgaGF2ZSB0byBhZGp1c3QgaWYgY29tcGF0TW9kZSB2YXJpZXMgYWNyb3NzIGlmcmFtZXMNCgkJZC5ib3hNb2RlbCA9IGRvY3VtZW50LmNvbXBhdE1vZGUgPT0gIkJhY2tDb21wYXQiID8gImJvcmRlci1ib3giIDogImNvbnRlbnQtYm94IjsNCgl9DQoJDQoJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCgkvLyBTdHlsZSBGdW5jdGlvbnMNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KDQoJLy8gZ2V0Q29tcHV0ZWRTdHlsZSBkcml2ZXMgbW9zdCBvZiB0aGUgc3R5bGUgY29kZS4NCgkvLyBXaGVyZXZlciBwb3NzaWJsZSwgcmV1c2UgdGhlIHJldHVybmVkIG9iamVjdC4NCgkvLw0KCS8vIEFQSSBmdW5jdGlvbnMgYmVsb3cgdGhhdCBuZWVkIHRvIGFjY2VzcyBjb21wdXRlZCBzdHlsZXMgYWNjZXB0IGFuIA0KCS8vIG9wdGlvbmFsIGNvbXB1dGVkU3R5bGUgcGFyYW1ldGVyLg0KCS8vIElmIHRoaXMgcGFyYW1ldGVyIGlzIG9taXR0ZWQsIHRoZSBmdW5jdGlvbnMgd2lsbCBjYWxsIGdldENvbXB1dGVkU3R5bGUgdGhlbXNlbHZlcy4NCgkvLyBUaGlzIHdheSwgY2FsbGluZyBjb2RlIGNhbiBhY2Nlc3MgY29tcHV0ZWRTdHlsZSBvbmNlLCBhbmQgdGhlbiBwYXNzIHRoZSByZWZlcmVuY2UgdG8gDQoJLy8gbXVsdGlwbGUgQVBJIGZ1bmN0aW9ucy4NCg0KLyo9PT09PQ0KCWRvam8uZ2V0Q29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uKG5vZGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhICJjb21wdXRlZCBzdHlsZSIgb2JqZWN0Lg0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUdldHMgYSAiY29tcHV0ZWQgc3R5bGUiIG9iamVjdCB3aGljaCBjYW4gYmUgdXNlZCB0byBnYXRoZXINCgkJLy8JCWluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSByZW5kZXJlZCBub2RlLg0KCQkvLw0KCQkvLwkJTm90ZSB0aGF0IHRoaXMgbWF5IGJlaGF2ZSBkaWZmZXJlbnRseSBvbiBkaWZmZXJlbnQgYnJvd3NlcnMuDQoJCS8vCQlWYWx1ZXMgbWF5IGhhdmUgZGlmZmVyZW50IGZvcm1hdHMgYW5kIHZhbHVlIGVuY29kaW5ncyBhY3Jvc3MNCgkJLy8JCWJyb3dzZXJzLg0KCQkvLw0KCQkvLwkJTm90ZSBhbHNvIHRoYXQgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlLiAgV2hlcmV2ZXIgcG9zc2libGUsDQoJCS8vCQlyZXVzZSB0aGUgcmV0dXJuZWQgb2JqZWN0Lg0KCQkvLw0KCQkvLwkJVXNlIHRoZSBkb2pvLnN0eWxlKCkgbWV0aG9kIGZvciBtb3JlIGNvbnNpc3RlbnQgKHBpeGVsaXplZCkNCgkJLy8JCXJldHVybiB2YWx1ZXMuDQoJCS8vDQoJCS8vCW5vZGU6IERPTU5vZGUNCgkJLy8JCUEgcmVmZXJlbmNlIHRvIGEgRE9NIG5vZGUuIERvZXMgTk9UIHN1cHBvcnQgdGFraW5nIGFuDQoJCS8vCQlJRCBzdHJpbmcgZm9yIHNwZWVkIHJlYXNvbnMuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJZG9qby5nZXRDb21wdXRlZFN0eWxlKGRvam8uYnlJZCgnZm9vJykpLmJvcmRlcldpZHRoOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlSZXVzaW5nIHRoZSByZXR1cm5lZCBvYmplY3QsIGF2b2lkaW5nIG11bHRpcGxlIGxvb2t1cHM6DQoJCS8vCXwJdmFyIGNzID0gZG9qby5nZXRDb21wdXRlZFN0eWxlKGRvam8uYnlJZCgic29tZU5vZGUiKSk7DQoJCS8vCXwJdmFyIHcgPSBjcy53aWR0aCwgaCA9IGNzLmhlaWdodDsNCgkJcmV0dXJuOyAvLyBDU1MyUHJvcGVydGllcw0KCX0NCj09PT09Ki8NCg0KCS8vIEFsdGhvdWdoIHdlIG5vcm1hbGx5IGVzY2hldyBhcmd1bWVudCB2YWxpZGF0aW9uIGF0IHRoaXMNCgkvLyBsZXZlbCwgaGVyZSB3ZSB0ZXN0IGFyZ3VtZW50ICdub2RlJyBmb3IgKGR1Y2spdHlwZSwNCgkvLyBieSB0ZXN0aW5nIG5vZGVUeXBlLCBlY2F1c2UgJ2RvY3VtZW50JyBpcyB0aGUgJ3BhcmVudE5vZGUnIG9mICdib2R5Jw0KCS8vIGl0IGlzIGZyZXF1ZW50bHkgc2VudCB0byB0aGlzIGZ1bmN0aW9uIGV2ZW4gDQoJLy8gdGhvdWdoIGl0IGlzIG5vdCBFbGVtZW50Lg0KCXZhciBnY3M7DQoJCWlmKGQuaXNXZWJLaXQpew0KCQkJZ2NzID0gZnVuY3Rpb24oLypEb21Ob2RlKi9ub2RlKXsNCgkJCXZhciBzOw0KCQkJaWYobm9kZS5ub2RlVHlwZSA9PSAxKXsNCgkJCQl2YXIgZHYgPSBub2RlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7DQoJCQkJcyA9IGR2LmdldENvbXB1dGVkU3R5bGUobm9kZSwgbnVsbCk7DQoJCQkJaWYoIXMgJiYgbm9kZS5zdHlsZSl7DQoJCQkJCW5vZGUuc3R5bGUuZGlzcGxheSA9ICIiOw0KCQkJCQlzID0gZHYuZ2V0Q29tcHV0ZWRTdHlsZShub2RlLCBudWxsKTsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gcyB8fCB7fTsNCgkJfTsNCgkJfWVsc2UgaWYoZC5pc0lFKXsNCgkJZ2NzID0gZnVuY3Rpb24obm9kZSl7DQoJCQkvLyBJRSAoYXMgb2YgNykgZG9lc24ndCBleHBvc2UgRWxlbWVudCBsaWtlIHNhbmUgYnJvd3NlcnMNCgkJCXJldHVybiBub2RlLm5vZGVUeXBlID09IDEgLyogRUxFTUVOVF9OT0RFKi8gPyBub2RlLmN1cnJlbnRTdHlsZSA6IHt9Ow0KCQl9Ow0KCX1lbHNlew0KCQlnY3MgPSBmdW5jdGlvbihub2RlKXsNCgkJCXJldHVybiBub2RlLm5vZGVUeXBlID09IDEgPw0KCQkJCW5vZGUub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpIDoge307DQoJCX07DQoJfQ0KCQlkb2pvLmdldENvbXB1dGVkU3R5bGUgPSBnY3M7DQoNCgkJaWYoIWQuaXNJRSl7DQoJCQlkLl90b1BpeGVsVmFsdWUgPSBmdW5jdGlvbihlbGVtZW50LCB2YWx1ZSl7DQoJCQkvLyBzdHlsZSB2YWx1ZXMgY2FuIGJlIGZsb2F0cywgY2xpZW50IGNvZGUgbWF5IHdhbnQNCgkJCS8vIHRvIHJvdW5kIGZvciBpbnRlZ2VyIHBpeGVscy4NCgkJCXJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSB8fCAwOw0KCQl9Ow0KCQl9ZWxzZXsNCgkJZC5fdG9QaXhlbFZhbHVlID0gZnVuY3Rpb24oZWxlbWVudCwgYXZhbHVlKXsNCgkJCWlmKCFhdmFsdWUpeyByZXR1cm4gMDsgfQ0KCQkJLy8gb24gSUU3LCBtZWRpdW0gaXMgdXN1YWxseSA0IHBpeGVscw0KCQkJaWYoYXZhbHVlID09ICJtZWRpdW0iKXsgcmV0dXJuIDQ7IH0NCgkJCS8vIHN0eWxlIHZhbHVlcyBjYW4gYmUgZmxvYXRzLCBjbGllbnQgY29kZSBtYXkNCgkJCS8vIHdhbnQgdG8gcm91bmQgdGhpcyB2YWx1ZSBmb3IgaW50ZWdlciBwaXhlbHMuDQoJCQlpZihhdmFsdWUuc2xpY2UgJiYgYXZhbHVlLnNsaWNlKC0yKSA9PSAncHgnKXsgcmV0dXJuIHBhcnNlRmxvYXQoYXZhbHVlKTsgfQ0KCQkJd2l0aChlbGVtZW50KXsNCgkJCQl2YXIgc0xlZnQgPSBzdHlsZS5sZWZ0Ow0KCQkJCXZhciByc0xlZnQgPSBydW50aW1lU3R5bGUubGVmdDsNCgkJCQlydW50aW1lU3R5bGUubGVmdCA9IGN1cnJlbnRTdHlsZS5sZWZ0Ow0KCQkJCXRyeXsNCgkJCQkJLy8gJ2F2YWx1ZScgbWF5IGJlIGluY29tcGF0aWJsZSB3aXRoIHN0eWxlLmxlZnQsIHdoaWNoIGNhbiBjYXVzZSBJRSB0byB0aHJvdw0KCQkJCQkvLyB0aGlzIGhhcyBiZWVuIG9ic2VydmVkIGZvciBib3JkZXIgd2lkdGhzIHVzaW5nICJ0aGluIiwgIm1lZGl1bSIsICJ0aGljayIgY29uc3RhbnRzDQoJCQkJCS8vIHRob3NlIHBhcnRpY3VsYXIgY29uc3RhbnRzIGNvdWxkIGJlIHRyYXBwZWQgYnkgYSBsb29rdXANCgkJCQkJLy8gYnV0IHBlcmhhcHMgdGhlcmUgYXJlIG1vcmUNCgkJCQkJc3R5bGUubGVmdCA9IGF2YWx1ZTsNCgkJCQkJYXZhbHVlID0gc3R5bGUucGl4ZWxMZWZ0Ow0KCQkJCX1jYXRjaChlKXsNCgkJCQkJYXZhbHVlID0gMDsNCgkJCQl9DQoJCQkJc3R5bGUubGVmdCA9IHNMZWZ0Ow0KCQkJCXJ1bnRpbWVTdHlsZS5sZWZ0ID0gcnNMZWZ0Ow0KCQkJfQ0KCQkJcmV0dXJuIGF2YWx1ZTsNCgkJfQ0KCX0NCgkJdmFyIHB4ID0gZC5fdG9QaXhlbFZhbHVlOw0KDQoJLy8gRklYTUU6IHRoZXJlIG9wYWNpdHkgcXVpcmtzIG9uIEZGIHRoYXQgd2UgaGF2ZW4ndCBwb3J0ZWQgb3Zlci4gSHJtLg0KCS8qPT09PT0NCglkb2pvLl9nZXRPcGFjaXR5ID0gZnVuY3Rpb24obm9kZSl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgdGhlIGN1cnJlbnQgb3BhY2l0eSBvZiB0aGUgcGFzc2VkIG5vZGUgYXMgYQ0KCQkJLy8JCWZsb2F0aW5nLXBvaW50IHZhbHVlIGJldHdlZW4gMCBhbmQgMS4NCgkJCS8vCW5vZGU6IERvbU5vZGUNCgkJCS8vCQlhIHJlZmVyZW5jZSB0byBhIERPTSBub2RlLiBEb2VzIE5PVCBzdXBwb3J0IHRha2luZyBhbg0KCQkJLy8JCUlEIHN0cmluZyBmb3Igc3BlZWQgcmVhc29ucy4NCgkJCS8vCXJldHVybnM6IE51bWJlciBiZXR3ZWVuIDAgYW5kIDENCgkJCXJldHVybjsgLy8gTnVtYmVyDQoJfQ0KCT09PT09Ki8NCg0KCQl2YXIgYXN0ciA9ICJEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYSI7DQoJdmFyIGFmID0gZnVuY3Rpb24obiwgZil7DQoJCXRyeXsNCgkJCXJldHVybiBuLmZpbHRlcnMuaXRlbShhc3RyKTsNCgkJfWNhdGNoKGUpew0KCQkJcmV0dXJuIGYgPyB7fSA6IG51bGw7DQoJCX0NCgl9Ow0KDQoJCWRvam8uX2dldE9wYWNpdHkgPQ0KCQkJZC5pc0lFID8gZnVuY3Rpb24obm9kZSl7DQoJCQl0cnl7DQoJCQkJcmV0dXJuIGFmKG5vZGUpLk9wYWNpdHkgLyAxMDA7IC8vIE51bWJlcg0KCQkJfWNhdGNoKGUpew0KCQkJCXJldHVybiAxOyAvLyBOdW1iZXINCgkJCX0NCgkJfSA6DQoJCQlmdW5jdGlvbihub2RlKXsNCgkJCXJldHVybiBnY3Mobm9kZSkub3BhY2l0eTsNCgkJfTsNCg0KCS8qPT09PT0NCglkb2pvLl9zZXRPcGFjaXR5ID0gZnVuY3Rpb24obm9kZSwgb3BhY2l0eSl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXNldCB0aGUgb3BhY2l0eSBvZiB0aGUgcGFzc2VkIG5vZGUgcG9ydGFibHkuIFJldHVybnMgdGhlDQoJCQkvLwkJbmV3IG9wYWNpdHkgb2YgdGhlIG5vZGUuDQoJCQkvLwlub2RlOiBET01Ob2RlDQoJCQkvLwkJYSByZWZlcmVuY2UgdG8gYSBET00gbm9kZS4gRG9lcyBOT1Qgc3VwcG9ydCB0YWtpbmcgYW4NCgkJCS8vCQlJRCBzdHJpbmcgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuDQoJCQkvLwlvcGFjaXR5OiBOdW1iZXINCgkJCS8vCQlBIE51bWJlciBiZXR3ZWVuIDAgYW5kIDEuIDAgc3BlY2lmaWVzIHRyYW5zcGFyZW50Lg0KCQkJLy8JcmV0dXJuczogTnVtYmVyIGJldHdlZW4gMCBhbmQgMQ0KCQkJcmV0dXJuOyAvLyBOdW1iZXINCgl9DQoJPT09PT0qLw0KDQoJZG9qby5fc2V0T3BhY2l0eSA9DQoJCQkJZC5pc0lFID8gZnVuY3Rpb24oLypEb21Ob2RlKi9ub2RlLCAvKk51bWJlciovb3BhY2l0eSl7DQoJCQl2YXIgb3YgPSBvcGFjaXR5ICogMTAwLCBvcGFxdWUgPSBvcGFjaXR5ID09IDE7DQoJCQlub2RlLnN0eWxlLnpvb20gPSBvcGFxdWUgPyAiIiA6IDE7DQoNCgkJCWlmKCFhZihub2RlKSl7DQoJCQkJaWYob3BhcXVlKXsNCgkJCQkJcmV0dXJuIG9wYWNpdHk7DQoJCQkJfQ0KCQkJCW5vZGUuc3R5bGUuZmlsdGVyICs9ICIgcHJvZ2lkOiIgKyBhc3RyICsgIihPcGFjaXR5PSIgKyBvdiArICIpIjsNCgkJCX1lbHNlew0KCQkJCWFmKG5vZGUsIDEpLk9wYWNpdHkgPSBvdjsNCgkJCX0NCg0KCQkJLy8gb24gSUU3IEFscGhhKEZpbHRlciBvcGFjaXR5PTEwMCkgbWFrZXMgdGV4dCBsb29rIGZ1enp5IHNvIGRpc2FibGUgaXQgYWx0b2dldGhlciAoYnVnICMyNjYxKSwNCgkJCS8vYnV0IHN0aWxsIHVwZGF0ZSB0aGUgb3BhY2l0eSB2YWx1ZSBzbyB3ZSBjYW4gZ2V0IGEgY29ycmVjdCByZWFkaW5nIGlmIGl0IGlzIHJlYWQgbGF0ZXIuDQoJCQlhZihub2RlLCAxKS5FbmFibGVkID0gIW9wYXF1ZTsNCg0KCQkJaWYobm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICJ0ciIpew0KCQkJCWQucXVlcnkoIj4gdGQiLCBub2RlKS5mb3JFYWNoKGZ1bmN0aW9uKGkpew0KCQkJCQlkLl9zZXRPcGFjaXR5KGksIG9wYWNpdHkpOw0KCQkJCX0pOw0KCQkJfQ0KCQkJcmV0dXJuIG9wYWNpdHk7DQoJCX0gOg0KCQkJCWZ1bmN0aW9uKG5vZGUsIG9wYWNpdHkpew0KCQkJcmV0dXJuIG5vZGUuc3R5bGUub3BhY2l0eSA9IG9wYWNpdHk7DQoJCX07DQoNCgl2YXIgX3BpeGVsTmFtZXNDYWNoZSA9IHsNCgkJbGVmdDogdHJ1ZSwgdG9wOiB0cnVlDQoJfTsNCgl2YXIgX3BpeGVsUmVnRXhwID0gL21hcmdpbnxwYWRkaW5nfHdpZHRofGhlaWdodHxtYXh8bWlufG9mZnNldC87ICAvLyB8Ym9yZGVyDQoJdmFyIF90b1N0eWxlVmFsdWUgPSBmdW5jdGlvbihub2RlLCB0eXBlLCB2YWx1ZSl7DQoJCXR5cGUgPSB0eXBlLnRvTG93ZXJDYXNlKCk7IC8vIEZJWE1FOiBzaG91bGQgd2UgcmVhbGx5IGJlIGRvaW5nIHN0cmluZyBjYXNlIGNvbnZlcnNpb24gaGVyZT8gU2hvdWxkIHdlIGNhY2hlIGl0PyBOZWVkIHRvIHByb2ZpbGUhDQoJCQkJaWYoZC5pc0lFKXsNCgkJCWlmKHZhbHVlID09ICJhdXRvIil7DQoJCQkJaWYodHlwZSA9PSAiaGVpZ2h0Iil7IHJldHVybiBub2RlLm9mZnNldEhlaWdodDsgfQ0KCQkJCWlmKHR5cGUgPT0gIndpZHRoIil7IHJldHVybiBub2RlLm9mZnNldFdpZHRoOyB9DQoJCQl9DQoJCQlpZih0eXBlID09ICJmb250d2VpZ2h0Iil7DQoJCQkJc3dpdGNoKHZhbHVlKXsNCgkJCQkJY2FzZSA3MDA6IHJldHVybiAiYm9sZCI7DQoJCQkJCWNhc2UgNDAwOg0KCQkJCQlkZWZhdWx0OiByZXR1cm4gIm5vcm1hbCI7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCQkJaWYoISh0eXBlIGluIF9waXhlbE5hbWVzQ2FjaGUpKXsNCgkJCV9waXhlbE5hbWVzQ2FjaGVbdHlwZV0gPSBfcGl4ZWxSZWdFeHAudGVzdCh0eXBlKTsNCgkJfQ0KCQlyZXR1cm4gX3BpeGVsTmFtZXNDYWNoZVt0eXBlXSA/IHB4KG5vZGUsIHZhbHVlKSA6IHZhbHVlOw0KCX07DQoNCgl2YXIgX2Zsb2F0U3R5bGUgPSBkLmlzSUUgPyAic3R5bGVGbG9hdCIgOiAiY3NzRmxvYXQiLA0KCQlfZmxvYXRBbGlhc2VzID0geyAiY3NzRmxvYXQiOiBfZmxvYXRTdHlsZSwgInN0eWxlRmxvYXQiOiBfZmxvYXRTdHlsZSwgImZsb2F0IjogX2Zsb2F0U3R5bGUgfQ0KCTsNCg0KCS8vIHB1YmxpYyBBUEkNCg0KCWRvam8uc3R5bGUgPSBmdW5jdGlvbigJLypEb21Ob2RlfFN0cmluZyovIG5vZGUsDQoJCQkJCQkJLypTdHJpbmc/fE9iamVjdD8qLyBzdHlsZSwNCgkJCQkJCQkvKlN0cmluZz8qLyB2YWx1ZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlBY2Nlc3NlcyBzdHlsZXMgb24gYSBub2RlLiBJZiAyIGFyZ3VtZW50cyBhcmUNCgkJLy8JCXBhc3NlZCwgYWN0cyBhcyBhIGdldHRlci4gSWYgMyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgYWN0cw0KCQkvLwkJYXMgYSBzZXR0ZXIuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJR2V0dGluZyB0aGUgc3R5bGUgdmFsdWUgdXNlcyB0aGUgY29tcHV0ZWQgc3R5bGUgZm9yIHRoZSBub2RlLCBzbyB0aGUgdmFsdWUNCgkJLy8JCXdpbGwgYmUgYSBjYWxjdWxhdGVkIHZhbHVlLCBub3QganVzdCB0aGUgaW1tZWRpYXRlIG5vZGUuc3R5bGUgdmFsdWUuDQoJCS8vCQlBbHNvIHdoZW4gZ2V0dGluZyB2YWx1ZXMsIHVzZSBzcGVjaWZpYyBzdHlsZSBuYW1lcywNCgkJLy8JCWxpa2UgImJvcmRlckJvdHRvbVdpZHRoIiBpbnN0ZWFkIG9mICJib3JkZXIiIHNpbmNlIGNvbXBvdW5kIHZhbHVlcyBsaWtlDQoJCS8vCQkiYm9yZGVyIiBhcmUgbm90IG5lY2Vzc2FyaWx5IHJlZmxlY3RlZCBhcyBleHBlY3RlZC4NCgkJLy8JCUlmIHlvdSB3YW50IHRvIGdldCBub2RlIGRpbWVuc2lvbnMsIHVzZSBgZG9qby5tYXJnaW5Cb3goKWAsIA0KCQkvLwkJYGRvam8uY29udGVudEJveCgpYCBvciBgZG9qby5wb3NpdGlvbigpYC4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byBub2RlIHRvIGdldC9zZXQgc3R5bGUgZm9yDQoJCS8vCXN0eWxlOg0KCQkvLwkJdGhlIHN0eWxlIHByb3BlcnR5IHRvIHNldCBpbiBET00tYWNjZXNzb3IgZm9ybWF0DQoJCS8vCQkoImJvcmRlcldpZHRoIiwgbm90ICJib3JkZXItd2lkdGgiKSBvciBhbiBvYmplY3Qgd2l0aCBrZXkvdmFsdWUNCgkJLy8JCXBhaXJzIHN1aXRhYmxlIGZvciBzZXR0aW5nIGVhY2ggcHJvcGVydHkuDQoJCS8vCXZhbHVlOg0KCQkvLwkJSWYgcGFzc2VkLCBzZXRzIHZhbHVlIG9uIHRoZSBub2RlIGZvciBzdHlsZSwgaGFuZGxpbmcNCgkJLy8JCWNyb3NzLWJyb3dzZXIgY29uY2VybnMuICBXaGVuIHNldHRpbmcgYSBwaXhlbCB2YWx1ZSwNCgkJLy8JCWJlIHN1cmUgdG8gaW5jbHVkZSAicHgiIGluIHRoZSB2YWx1ZS4gRm9yIGluc3RhbmNlLCB0b3A6ICIyMDBweCIuDQoJCS8vCQlPdGhlcndpc2UsIGluIHNvbWUgY2FzZXMsIHNvbWUgYnJvd3NlcnMgd2lsbCBub3QgYXBwbHkgdGhlIHN0eWxlLg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJUGFzc2luZyBvbmx5IGFuIElEIG9yIG5vZGUgcmV0dXJucyB0aGUgY29tcHV0ZWQgc3R5bGUgb2JqZWN0IG9mDQoJCS8vCQl0aGUgbm9kZToNCgkJLy8JfAlkb2pvLnN0eWxlKCJ0aGluZ2VyIik7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlQYXNzaW5nIGEgbm9kZSBhbmQgYSBzdHlsZSBwcm9wZXJ0eSByZXR1cm5zIHRoZSBjdXJyZW50DQoJCS8vCQlub3JtYWxpemVkLCBjb21wdXRlZCB2YWx1ZSBmb3IgdGhhdCBwcm9wZXJ0eToNCgkJLy8JfAlkb2pvLnN0eWxlKCJ0aGluZ2VyIiwgIm9wYWNpdHkiKTsgLy8gMSBieSBkZWZhdWx0DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlQYXNzaW5nIGEgbm9kZSwgYSBzdHlsZSBwcm9wZXJ0eSwgYW5kIGEgdmFsdWUgY2hhbmdlcyB0aGUNCgkJLy8JCWN1cnJlbnQgZGlzcGxheSBvZiB0aGUgbm9kZSBhbmQgcmV0dXJucyB0aGUgbmV3IGNvbXB1dGVkIHZhbHVlDQoJCS8vCXwJZG9qby5zdHlsZSgidGhpbmdlciIsICJvcGFjaXR5IiwgMC41KTsgLy8gPT0gMC41DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlQYXNzaW5nIGEgbm9kZSwgYW4gb2JqZWN0LXN0eWxlIHN0eWxlIHByb3BlcnR5IHNldHMgZWFjaCBvZiB0aGUgdmFsdWVzIGluIHR1cm4gYW5kIHJldHVybnMgdGhlIGNvbXB1dGVkIHN0eWxlIG9iamVjdCBvZiB0aGUgbm9kZToNCgkJLy8JfAlkb2pvLnN0eWxlKCJ0aGluZ2VyIiwgew0KCQkvLwl8CQkib3BhY2l0eSI6IDAuNSwNCgkJLy8JfAkJImJvcmRlciI6ICIzcHggc29saWQgYmxhY2siLA0KCQkvLwl8CQkiaGVpZ2h0IjogIjMwMHB4Ig0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLyAJZXhhbXBsZToNCgkJLy8JCVdoZW4gdGhlIENTUyBzdHlsZSBwcm9wZXJ0eSBpcyBoeXBoZW5hdGVkLCB0aGUgSmF2YVNjcmlwdCBwcm9wZXJ0eSBpcyBjYW1lbENhc2VkLg0KCQkvLwkJZm9udC1zaXplIGJlY29tZXMgZm9udFNpemUsIGFuZCBzbyBvbi4NCgkJLy8JfAlkb2pvLnN0eWxlKCJ0aGluZ2VyIix7DQoJCS8vCXwJCWZvbnRTaXplOiIxNHB0IiwNCgkJLy8JfAkJbGV0dGVyU3BhY2luZzoiMS4yZW0iDQoJCS8vCXwJfSk7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlkb2pvLk5vZGVMaXN0IGltcGxlbWVudHMgLnN0eWxlKCkgdXNpbmcgdGhlIHNhbWUgc3ludGF4LCBvbWl0dGluZyB0aGUgIm5vZGUiIHBhcmFtZXRlciwgY2FsbGluZw0KCQkvLwkJZG9qby5zdHlsZSgpIG9uIGV2ZXJ5IGVsZW1lbnQgb2YgdGhlIGxpc3QuIFNlZTogYGRvam8ucXVlcnkoKWAgYW5kIGBkb2pvLk5vZGVMaXN0KClgDQoJCS8vCXwJZG9qby5xdWVyeSgiLnNvbWVDbGFzc05hbWUiKS5zdHlsZSgidmlzaWJpbGl0eSIsImhpZGRlbiIpOw0KCQkvLwl8CS8vIG9yDQoJCS8vCXwJZG9qby5xdWVyeSgiI2JheiA+IGRpdiIpLnN0eWxlKHsNCgkJLy8JfAkJb3BhY2l0eTowLjc1LA0KCQkvLwl8CQlmb250U2l6ZToiMTNwdCINCgkJLy8JfAl9KTsNCg0KCQl2YXIgbiA9IGJ5SWQobm9kZSksIGFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoLCBvcCA9IChzdHlsZSA9PSAib3BhY2l0eSIpOw0KCQlzdHlsZSA9IF9mbG9hdEFsaWFzZXNbc3R5bGVdIHx8IHN0eWxlOw0KCQlpZihhcmdzID09IDMpew0KCQkJcmV0dXJuIG9wID8gZC5fc2V0T3BhY2l0eShuLCB2YWx1ZSkgOiBuLnN0eWxlW3N0eWxlXSA9IHZhbHVlOyAvKk51bWJlciovDQoJCX0NCgkJaWYoYXJncyA9PSAyICYmIG9wKXsNCgkJCXJldHVybiBkLl9nZXRPcGFjaXR5KG4pOw0KCQl9DQoJCXZhciBzID0gZ2NzKG4pOw0KCQlpZihhcmdzID09IDIgJiYgdHlwZW9mIHN0eWxlICE9ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJZm9yKHZhciB4IGluIHN0eWxlKXsNCgkJCQlkLnN0eWxlKG5vZGUsIHgsIHN0eWxlW3hdKTsNCgkJCX0NCgkJCXJldHVybiBzOw0KCQl9DQoJCXJldHVybiAoYXJncyA9PSAxKSA/IHMgOiBfdG9TdHlsZVZhbHVlKG4sIHN0eWxlLCBzW3N0eWxlXSB8fCBuLnN0eWxlW3N0eWxlXSk7IC8qIENTUzJQcm9wZXJ0aWVzfHxTdHJpbmd8fE51bWJlciAqLw0KCX0NCg0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoJLy8gQm94IEZ1bmN0aW9ucw0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCglkb2pvLl9nZXRQYWRFeHRlbnRzID0gZnVuY3Rpb24oLypEb21Ob2RlKi9uLCAvKk9iamVjdCovY29tcHV0ZWRTdHlsZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vIAkJUmV0dXJucyBvYmplY3Qgd2l0aCBzcGVjaWFsIHZhbHVlcyBzcGVjaWZpY2FsbHkgdXNlZnVsIGZvciBub2RlDQoJCS8vIAkJZml0dGluZy4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlSZXR1cm5zIGFuIG9iamVjdCB3aXRoIGB3YCwgYGhgLCBgbGAsIGB0YCBwcm9wZXJ0aWVzOg0KCQkvLwl8CQlsL3QgPSBsZWZ0L3RvcCBwYWRkaW5nIChyZXNwZWN0aXZlbHkpDQoJCS8vCXwJCXcgPSB0aGUgdG90YWwgb2YgdGhlIGxlZnQgYW5kIHJpZ2h0IHBhZGRpbmcgDQoJCS8vCXwJCWggPSB0aGUgdG90YWwgb2YgdGhlIHRvcCBhbmQgYm90dG9tIHBhZGRpbmcNCgkJLy8JCUlmICdub2RlJyBoYXMgcG9zaXRpb24sIGwvdCBmb3JtcyB0aGUgb3JpZ2luIGZvciBjaGlsZCBub2Rlcy4NCgkJLy8JCVRoZSB3L2ggYXJlIHVzZWQgZm9yIGNhbGN1bGF0aW5nIGJveGVzLg0KCQkvLwkJTm9ybWFsbHkgYXBwbGljYXRpb24gY29kZSB3aWxsIG5vdCBuZWVkIHRvIGludm9rZSB0aGlzDQoJCS8vCQlkaXJlY3RseSwgYW5kIHdpbGwgdXNlIHRoZSAuLi5ib3guLi4gZnVuY3Rpb25zIGluc3RlYWQuDQoJCXZhciANCgkJCXMgPSBjb21wdXRlZFN0eWxlfHxnY3MobiksDQoJCQlsID0gcHgobiwgcy5wYWRkaW5nTGVmdCksDQoJCQl0ID0gcHgobiwgcy5wYWRkaW5nVG9wKTsNCgkJcmV0dXJuIHsNCgkJCWw6IGwsDQoJCQl0OiB0LA0KCQkJdzogbCtweChuLCBzLnBhZGRpbmdSaWdodCksDQoJCQloOiB0K3B4KG4sIHMucGFkZGluZ0JvdHRvbSkNCgkJfTsNCgl9DQoNCglkb2pvLl9nZXRCb3JkZXJFeHRlbnRzID0gZnVuY3Rpb24oLypEb21Ob2RlKi9uLCAvKk9iamVjdCovY29tcHV0ZWRTdHlsZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlyZXR1cm5zIGFuIG9iamVjdCB3aXRoIHByb3BlcnRpZXMgdXNlZnVsIGZvciBub3RpbmcgdGhlIGJvcmRlcg0KCQkvLwkJZGltZW5zaW9ucy4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vIAkJKiBsL3QgPSB0aGUgc3VtIG9mIGxlZnQvdG9wIGJvcmRlciAocmVzcGVjdGl2ZWx5KQ0KCQkvLwkJKiB3ID0gdGhlIHN1bSBvZiB0aGUgbGVmdCBhbmQgcmlnaHQgYm9yZGVyDQoJCS8vCQkqIGggPSB0aGUgc3VtIG9mIHRoZSB0b3AgYW5kIGJvdHRvbSBib3JkZXINCgkJLy8NCgkJLy8JCVRoZSB3L2ggYXJlIHVzZWQgZm9yIGNhbGN1bGF0aW5nIGJveGVzLg0KCQkvLwkJTm9ybWFsbHkgYXBwbGljYXRpb24gY29kZSB3aWxsIG5vdCBuZWVkIHRvIGludm9rZSB0aGlzDQoJCS8vCQlkaXJlY3RseSwgYW5kIHdpbGwgdXNlIHRoZSAuLi5ib3guLi4gZnVuY3Rpb25zIGluc3RlYWQuDQoJCXZhciANCgkJCW5lID0gIm5vbmUiLA0KCQkJcyA9IGNvbXB1dGVkU3R5bGV8fGdjcyhuKSwNCgkJCWJsID0gKHMuYm9yZGVyTGVmdFN0eWxlICE9IG5lID8gcHgobiwgcy5ib3JkZXJMZWZ0V2lkdGgpIDogMCksDQoJCQlidCA9IChzLmJvcmRlclRvcFN0eWxlICE9IG5lID8gcHgobiwgcy5ib3JkZXJUb3BXaWR0aCkgOiAwKTsNCgkJcmV0dXJuIHsNCgkJCWw6IGJsLA0KCQkJdDogYnQsDQoJCQl3OiBibCArIChzLmJvcmRlclJpZ2h0U3R5bGUhPW5lID8gcHgobiwgcy5ib3JkZXJSaWdodFdpZHRoKSA6IDApLA0KCQkJaDogYnQgKyAocy5ib3JkZXJCb3R0b21TdHlsZSE9bmUgPyBweChuLCBzLmJvcmRlckJvdHRvbVdpZHRoKSA6IDApDQoJCX07DQoJfQ0KDQoJZG9qby5fZ2V0UGFkQm9yZGVyRXh0ZW50cyA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbiwgLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBvYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIHVzZWZ1bCBmb3IgYm94IGZpdHRpbmcgd2l0aA0KCQkvLwkJcmVnYXJkcyB0byBwYWRkaW5nLg0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCSogbC90ID0gdGhlIHN1bSBvZiBsZWZ0L3RvcCBwYWRkaW5nIGFuZCBsZWZ0L3RvcCBib3JkZXIgKHJlc3BlY3RpdmVseSkNCgkJLy8JCSogdyA9IHRoZSBzdW0gb2YgdGhlIGxlZnQgYW5kIHJpZ2h0IHBhZGRpbmcgYW5kIGJvcmRlcg0KCQkvLwkJKiBoID0gdGhlIHN1bSBvZiB0aGUgdG9wIGFuZCBib3R0b20gcGFkZGluZyBhbmQgYm9yZGVyDQoJCS8vDQoJCS8vCQlUaGUgdy9oIGFyZSB1c2VkIGZvciBjYWxjdWxhdGluZyBib3hlcy4NCgkJLy8JCU5vcm1hbGx5IGFwcGxpY2F0aW9uIGNvZGUgd2lsbCBub3QgbmVlZCB0byBpbnZva2UgdGhpcw0KCQkvLwkJZGlyZWN0bHksIGFuZCB3aWxsIHVzZSB0aGUgLi4uYm94Li4uIGZ1bmN0aW9ucyBpbnN0ZWFkLg0KCQl2YXIgDQoJCQlzID0gY29tcHV0ZWRTdHlsZXx8Z2NzKG4pLA0KCQkJcCA9IGQuX2dldFBhZEV4dGVudHMobiwgcyksDQoJCQliID0gZC5fZ2V0Qm9yZGVyRXh0ZW50cyhuLCBzKTsNCgkJcmV0dXJuIHsNCgkJCWw6IHAubCArIGIubCwNCgkJCXQ6IHAudCArIGIudCwNCgkJCXc6IHAudyArIGIudywNCgkJCWg6IHAuaCArIGIuaA0KCQl9Ow0KCX0NCg0KCWRvam8uX2dldE1hcmdpbkV4dGVudHMgPSBmdW5jdGlvbihuLCBjb21wdXRlZFN0eWxlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXJldHVybnMgb2JqZWN0IHdpdGggcHJvcGVydGllcyB1c2VmdWwgZm9yIGJveCBmaXR0aW5nIHdpdGgNCgkJLy8JCXJlZ2FyZHMgdG8gYm94IG1hcmdpbnMgKGkuZS4sIHRoZSBvdXRlci1ib3gpLg0KCQkvLw0KCQkvLwkJKiBsL3QgPSBtYXJnaW5MZWZ0LCBtYXJnaW5Ub3AsIHJlc3BlY3RpdmVseQ0KCQkvLwkJKiB3ID0gdG90YWwgd2lkdGgsIG1hcmdpbiBpbmNsdXNpdmUNCgkJLy8JCSogaCA9IHRvdGFsIGhlaWdodCwgbWFyZ2luIGluY2x1c2l2ZQ0KCQkvLw0KCQkvLwkJVGhlIHcvaCBhcmUgdXNlZCBmb3IgY2FsY3VsYXRpbmcgYm94ZXMuDQoJCS8vCQlOb3JtYWxseSBhcHBsaWNhdGlvbiBjb2RlIHdpbGwgbm90IG5lZWQgdG8gaW52b2tlIHRoaXMNCgkJLy8JCWRpcmVjdGx5LCBhbmQgd2lsbCB1c2UgdGhlIC4uLmJveC4uLiBmdW5jdGlvbnMgaW5zdGVhZC4NCgkJdmFyIA0KCQkJcyA9IGNvbXB1dGVkU3R5bGV8fGdjcyhuKSwNCgkJCWwgPSBweChuLCBzLm1hcmdpbkxlZnQpLA0KCQkJdCA9IHB4KG4sIHMubWFyZ2luVG9wKSwNCgkJCXIgPSBweChuLCBzLm1hcmdpblJpZ2h0KSwNCgkJCWIgPSBweChuLCBzLm1hcmdpbkJvdHRvbSk7DQoJCWlmKGQuaXNXZWJLaXQgJiYgKHMucG9zaXRpb24gIT0gImFic29sdXRlIikpew0KCQkJLy8gRklYTUU6IFNhZmFyaSdzIHZlcnNpb24gb2YgdGhlIGNvbXB1dGVkIHJpZ2h0IG1hcmdpbg0KCQkJLy8gaXMgdGhlIHNwYWNlIGJldHdlZW4gb3VyIHJpZ2h0IGVkZ2UgYW5kIHRoZSByaWdodCBlZGdlIA0KCQkJLy8gb2Ygb3VyIG9mZnNldFBhcmVudC4NCgkJCS8vIFdoYXQgd2UgYXJlIGxvb2tpbmcgZm9yIGlzIHRoZSBhY3R1YWwgbWFyZ2luIHZhbHVlIGFzIA0KCQkJLy8gZGV0ZXJtaW5lZCBieSBDU1MuDQoJCQkvLyBIYWNrIHNvbHV0aW9uIGlzIHRvIGFzc3VtZSBsZWZ0L3JpZ2h0IG1hcmdpbnMgYXJlIHRoZSBzYW1lLg0KCQkJciA9IGw7DQoJCX0NCgkJcmV0dXJuIHsNCgkJCWw6IGwsDQoJCQl0OiB0LA0KCQkJdzogbCtyLA0KCQkJaDogdCtiDQoJCX07DQoJfQ0KDQoJLy8gQm94IGdldHRlcnMgd29yayBpbiBhbnkgYm94IGNvbnRleHQgYmVjYXVzZSBvZmZzZXRXaWR0aC9jbGllbnRXaWR0aA0KCS8vIGFyZSBpbnZhcmlhbnQgd3J0IGJveCBjb250ZXh0DQoJLy8NCgkvLyBUaGV5IGRvICpub3QqIHdvcmsgZm9yIGRpc3BsYXk6IGlubGluZSBvYmplY3RzIHRoYXQgaGF2ZSBwYWRkaW5nIHN0eWxlcw0KCS8vIGJlY2F1c2UgdGhlIHVzZXIgYWdlbnQgaWdub3JlcyBwYWRkaW5nIChpdCdzIGJvZ3VzIHN0eWxpbmcgaW4gYW55IGNhc2UpDQoJLy8NCgkvLyBCZSBjYXJlZnVsIHdpdGggSU1HcyBiZWNhdXNlIHRoZXkgYXJlIGlubGluZSBvciBibG9jayBkZXBlbmRpbmcgb24gDQoJLy8gYnJvd3NlciBhbmQgYnJvd3NlciBtb2RlLg0KDQoJLy8gQWx0aG91Z2ggaXQgd291bGQgYmUgZWFzaWVyIHRvIHJlYWQsIHRoZXJlIGFyZSBub3Qgc2VwYXJhdGUgdmVyc2lvbnMgb2YgDQoJLy8gX2dldE1hcmdpbkJveCBmb3IgZWFjaCBicm93c2VyIGJlY2F1c2U6DQoJLy8gMS4gdGhlIGJyYW5jaGluZyBpcyBub3QgZXhwZW5zaXZlDQoJLy8gMi4gZmFjdG9yaW5nIHRoZSBzaGFyZWQgY29kZSB3YXN0ZXMgY3ljbGVzIChmdW5jdGlvbiBjYWxsIG92ZXJoZWFkKQ0KCS8vIDMuIGR1cGxpY2F0aW5nIHRoZSBzaGFyZWQgY29kZSB3YXN0ZXMgYnl0ZXMNCg0KCWRvam8uX2dldE1hcmdpbkJveCA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypPYmplY3QqL2NvbXB1dGVkU3R5bGUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJcmV0dXJucyBhbiBvYmplY3QgdGhhdCBlbmNvZGVzIHRoZSB3aWR0aCwgaGVpZ2h0LCBsZWZ0IGFuZCB0b3ANCgkJLy8JCXBvc2l0aW9ucyBvZiB0aGUgbm9kZSdzIG1hcmdpbiBib3guDQoJCXZhciBzID0gY29tcHV0ZWRTdHlsZSB8fCBnY3Mobm9kZSksIG1lID0gZC5fZ2V0TWFyZ2luRXh0ZW50cyhub2RlLCBzKTsNCgkJdmFyIGwgPSBub2RlLm9mZnNldExlZnQgLSBtZS5sLCB0ID0gbm9kZS5vZmZzZXRUb3AgLSBtZS50LCBwID0gbm9kZS5wYXJlbnROb2RlOw0KCQkJCWlmKGQuaXNNb3opew0KCQkJLy8gTW96aWxsYToNCgkJCS8vIElmIG9mZnNldFBhcmVudCBoYXMgYSBjb21wdXRlZCBvdmVyZmxvdyAhPSB2aXNpYmxlLCB0aGUgb2Zmc2V0TGVmdCBpcyBkZWNyZWFzZWQNCgkJCS8vIGJ5IHRoZSBwYXJlbnQncyBib3JkZXIuDQoJCQkvLyBXZSBkb24ndCB3YW50IHRvIGNvbXB1dGUgdGhlIHBhcmVudCdzIHN0eWxlLCBzbyBpbnN0ZWFkIHdlIGV4YW1pbmUgbm9kZSdzDQoJCQkvLyBjb21wdXRlZCBsZWZ0L3RvcCB3aGljaCBpcyBtb3JlIHN0YWJsZS4NCgkJCXZhciBzbCA9IHBhcnNlRmxvYXQocy5sZWZ0KSwgc3QgPSBwYXJzZUZsb2F0KHMudG9wKTsNCgkJCWlmKCFpc05hTihzbCkgJiYgIWlzTmFOKHN0KSl7DQoJCQkJbCA9IHNsLCB0ID0gc3Q7DQoJCQl9ZWxzZXsNCgkJCQkvLyBJZiBjaGlsZCdzIGNvbXB1dGVkIGxlZnQvdG9wIGFyZSBub3QgcGFyc2VhYmxlIGFzIGEgbnVtYmVyIChlLmcuICJhdXRvIiksIHdlDQoJCQkJLy8gaGF2ZSBubyBjaG9pY2UgYnV0IHRvIGV4YW1pbmUgdGhlIHBhcmVudCdzIGNvbXB1dGVkIHN0eWxlLg0KCQkJCWlmKHAgJiYgcC5zdHlsZSl7DQoJCQkJCXZhciBwY3MgPSBnY3MocCk7DQoJCQkJCWlmKHBjcy5vdmVyZmxvdyAhPSAidmlzaWJsZSIpew0KCQkJCQkJdmFyIGJlID0gZC5fZ2V0Qm9yZGVyRXh0ZW50cyhwLCBwY3MpOw0KCQkJCQkJbCArPSBiZS5sLCB0ICs9IGJlLnQ7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX1lbHNlIGlmKGQuaXNPcGVyYSB8fCAoZC5pc0lFID4gNyAmJiAhZC5pc1F1aXJrcykpew0KCQkJLy8gT24gT3BlcmEgYW5kIElFIDgsIG9mZnNldExlZnQvVG9wIGluY2x1ZGVzIHRoZSBwYXJlbnQncyBib3JkZXINCgkJCWlmKHApew0KCQkJCWJlID0gZC5fZ2V0Qm9yZGVyRXh0ZW50cyhwKTsNCgkJCQlsIC09IGJlLmw7DQoJCQkJdCAtPSBiZS50Ow0KCQkJfQ0KCQl9DQoJCQkJcmV0dXJuIHsNCgkJCWw6IGwsDQoJCQl0OiB0LA0KCQkJdzogbm9kZS5vZmZzZXRXaWR0aCArIG1lLncsDQoJCQloOiBub2RlLm9mZnNldEhlaWdodCArIG1lLmggDQoJCX07DQoJfQ0KDQoJZG9qby5fZ2V0Q29udGVudEJveCA9IGZ1bmN0aW9uKG5vZGUsIGNvbXB1dGVkU3R5bGUpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3QgdGhhdCBlbmNvZGVzIHRoZSB3aWR0aCwgaGVpZ2h0LCBsZWZ0IGFuZCB0b3ANCgkJLy8JCXBvc2l0aW9ucyBvZiB0aGUgbm9kZSdzIGNvbnRlbnQgYm94LCBpcnJlc3BlY3RpdmUgb2YgdGhlDQoJCS8vCQljdXJyZW50IGJveCBtb2RlbC4NCg0KCQkvLyBjbGllbnRXaWR0aC9IZWlnaHQgYXJlIGltcG9ydGFudCBzaW5jZSB0aGUgYXV0b21hdGljYWxseSBhY2NvdW50IGZvciBzY3JvbGxiYXJzDQoJCS8vIGZhbGxiYWNrIHRvIG9mZnNldFdpZHRoL0hlaWdodCBmb3Igc3BlY2lhbCBjYXNlcyAoc2VlICMzMzc4KQ0KCQl2YXIgcyA9IGNvbXB1dGVkU3R5bGUgfHwgZ2NzKG5vZGUpLA0KCQkJcGUgPSBkLl9nZXRQYWRFeHRlbnRzKG5vZGUsIHMpLA0KCQkJYmUgPSBkLl9nZXRCb3JkZXJFeHRlbnRzKG5vZGUsIHMpLA0KCQkJdyA9IG5vZGUuY2xpZW50V2lkdGgsDQoJCQloDQoJCTsNCgkJaWYoIXcpew0KCQkJdyA9IG5vZGUub2Zmc2V0V2lkdGgsIGggPSBub2RlLm9mZnNldEhlaWdodDsNCgkJfWVsc2V7DQoJCQloID0gbm9kZS5jbGllbnRIZWlnaHQsIGJlLncgPSBiZS5oID0gMDsNCgkJfQ0KCQkvLyBPbiBPcGVyYSwgb2Zmc2V0TGVmdCBpbmNsdWRlcyB0aGUgcGFyZW50J3MgYm9yZGVyDQoJCQkJaWYoZC5pc09wZXJhKXsgcGUubCArPSBiZS5sOyBwZS50ICs9IGJlLnQ7IH07DQoJCQkJcmV0dXJuIHsNCgkJCWw6IHBlLmwsDQoJCQl0OiBwZS50LA0KCQkJdzogdyAtIHBlLncgLSBiZS53LA0KCQkJaDogaCAtIHBlLmggLSBiZS5oDQoJCX07DQoJfQ0KDQoJZG9qby5fZ2V0Qm9yZGVyQm94ID0gZnVuY3Rpb24obm9kZSwgY29tcHV0ZWRTdHlsZSl7DQoJCXZhciBzID0gY29tcHV0ZWRTdHlsZSB8fCBnY3Mobm9kZSksDQoJCQlwZSA9IGQuX2dldFBhZEV4dGVudHMobm9kZSwgcyksDQoJCQljYiA9IGQuX2dldENvbnRlbnRCb3gobm9kZSwgcykNCgkJOw0KCQlyZXR1cm4gew0KCQkJbDogY2IubCAtIHBlLmwsDQoJCQl0OiBjYi50IC0gcGUudCwNCgkJCXc6IGNiLncgKyBwZS53LA0KCQkJaDogY2IuaCArIHBlLmgNCgkJfTsNCgl9DQoNCgkvLyBCb3ggc2V0dGVycyBkZXBlbmQgb24gYm94IGNvbnRleHQgYmVjYXVzZSBpbnRlcnByZXRhdGlvbiBvZiB3aWR0aC9oZWlnaHQgc3R5bGVzDQoJLy8gdmFyeSB3cnQgYm94IGNvbnRleHQuDQoJLy8NCgkvLyBUaGUgdmFsdWUgb2YgZG9qby5ib3hNb2RlbCBpcyB1c2VkIHRvIGRldGVybWluZSBib3ggY29udGV4dC4NCgkvLyBkb2pvLmJveE1vZGVsIGNhbiBiZSBzZXQgZGlyZWN0bHkgdG8gY2hhbmdlIGJlaGF2aW9yLg0KCS8vDQoJLy8gQmV3YXJlIG9mIGRpc3BsYXk6IGlubGluZSBvYmplY3RzIHRoYXQgaGF2ZSBwYWRkaW5nIHN0eWxlcw0KCS8vIGJlY2F1c2UgdGhlIHVzZXIgYWdlbnQgaWdub3JlcyBwYWRkaW5nIChpdCdzIGEgYm9ndXMgc2V0dXAgYW55d2F5KQ0KCS8vDQoJLy8gQmUgY2FyZWZ1bCB3aXRoIElNR3MgYmVjYXVzZSB0aGV5IGFyZSBpbmxpbmUgb3IgYmxvY2sgZGVwZW5kaW5nIG9uIA0KCS8vIGJyb3dzZXIgYW5kIGJyb3dzZXIgbW9kZS4NCgkvLw0KCS8vIEVsZW1lbnRzIG90aGVyIHRoYW4gRElWIG1heSBoYXZlIHNwZWNpYWwgcXVpcmtzLCBsaWtlIGJ1aWx0LWluDQoJLy8gbWFyZ2lucyBvciBwYWRkaW5nLCBvciB2YWx1ZXMgbm90IGRldGVjdGFibGUgdmlhIGNvbXB1dGVkU3R5bGUuDQoJLy8gSW4gcGFydGljdWxhciwgbWFyZ2lucyBvbiBUQUJMRSBkbyBub3Qgc2VlbXMgdG8gYXBwZWFyIA0KCS8vIGF0IGFsbCBpbiBjb21wdXRlZFN0eWxlIG9uIE1vemlsbGEuDQoNCglkb2pvLl9zZXRCb3ggPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUsIC8qTnVtYmVyPyovbCwgLypOdW1iZXI/Ki90LCAvKk51bWJlcj8qL3csIC8qTnVtYmVyPyovaCwgLypTdHJpbmc/Ki91KXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXNldHMgd2lkdGgvaGVpZ2h0L2xlZnQvdG9wIGluIHRoZSBjdXJyZW50IChuYXRpdmUpIGJveC1tb2RlbA0KCQkvLwkJZGltZW50aW9ucy4gVXNlcyB0aGUgdW5pdCBwYXNzZWQgaW4gdS4NCgkJLy8Jbm9kZToNCgkJLy8JCURPTSBOb2RlIHJlZmVyZW5jZS4gSWQgc3RyaW5nIG5vdCBzdXBwb3J0ZWQgZm9yIHBlcmZvcm1hbmNlDQoJCS8vCQlyZWFzb25zLg0KCQkvLwlsOg0KCQkvLwkJbGVmdCBvZmZzZXQgZnJvbSBwYXJlbnQuDQoJCS8vCXQ6DQoJCS8vCQl0b3Agb2Zmc2V0IGZyb20gcGFyZW50Lg0KCQkvLwl3Og0KCQkvLwkJd2lkdGggaW4gY3VycmVudCBib3ggbW9kZWwuDQoJCS8vCWg6DQoJCS8vCQl3aWR0aCBpbiBjdXJyZW50IGJveCBtb2RlbC4NCgkJLy8JdToNCgkJLy8JCXVuaXQgbWVhc3VyZSB0byB1c2UgZm9yIG90aGVyIG1lYXN1cmVzLiBEZWZhdWx0cyB0byAicHgiLg0KCQl1ID0gdSB8fCAicHgiOw0KCQl2YXIgcyA9IG5vZGUuc3R5bGU7DQoJCWlmKCFpc05hTihsKSl7IHMubGVmdCA9IGwgKyB1OyB9DQoJCWlmKCFpc05hTih0KSl7IHMudG9wID0gdCArIHU7IH0NCgkJaWYodyA+PSAwKXsgcy53aWR0aCA9IHcgKyB1OyB9DQoJCWlmKGggPj0gMCl7IHMuaGVpZ2h0ID0gaCArIHU7IH0NCgl9DQoNCglkb2pvLl9pc0J1dHRvblRhZyA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSkgew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJVHJ1ZSBpZiB0aGUgbm9kZSBpcyBCVVRUT04gb3IgSU5QVVQudHlwZT0iYnV0dG9uIi4NCgkJcmV0dXJuIG5vZGUudGFnTmFtZSA9PSAiQlVUVE9OIg0KCQkJfHwgbm9kZS50YWdOYW1lPT0iSU5QVVQiICYmIChub2RlLmdldEF0dHJpYnV0ZSgidHlwZSIpfHwnJykudG9VcHBlckNhc2UoKSA9PSAiQlVUVE9OIjsgLy8gYm9vbGVhbg0KCX0NCg0KCWRvam8uX3VzZXNCb3JkZXJCb3ggPSBmdW5jdGlvbigvKkRvbU5vZGUqL25vZGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJVHJ1ZSBpZiB0aGUgbm9kZSB1c2VzIGJvcmRlci1ib3ggbGF5b3V0Lg0KDQoJCS8vIFdlIGNvdWxkIHRlc3QgdGhlIGNvbXB1dGVkIHN0eWxlIG9mIG5vZGUgdG8gc2VlIGlmIGEgcGFydGljdWxhciBib3gNCgkJLy8gaGFzIGJlZW4gc3BlY2lmaWVkLCBidXQgdGhlcmUgYXJlIGRldGFpbHMgYW5kIHdlIGNob29zZSBub3QgdG8gYm90aGVyLg0KDQoJCS8vIFRBQkxFIGFuZCBCVVRUT04gKGFuZCBJTlBVVCB0eXBlPWJ1dHRvbikgYXJlIGFsd2F5cyBib3JkZXItYm94IGJ5IGRlZmF1bHQuDQoJCS8vIElmIHlvdSBoYXZlIGFzc2lnbmVkIGEgZGlmZmVyZW50IGJveCB0byBlaXRoZXIgb25lIHZpYSBDU1MgdGhlbg0KCQkvLyBib3ggZnVuY3Rpb25zIHdpbGwgYnJlYWsuDQoNCgkJdmFyIG4gPSBub2RlLnRhZ05hbWU7DQoJCXJldHVybiBkLmJveE1vZGVsPT0iYm9yZGVyLWJveCIgfHwgbj09IlRBQkxFIiB8fCBkLl9pc0J1dHRvblRhZyhub2RlKTsgLy8gYm9vbGVhbg0KCX0NCg0KCWRvam8uX3NldENvbnRlbnRTaXplID0gZnVuY3Rpb24oLypEb21Ob2RlKi9ub2RlLCAvKk51bWJlciovd2lkdGhQeCwgLypOdW1iZXIqL2hlaWdodFB4LCAvKk9iamVjdCovY29tcHV0ZWRTdHlsZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlTZXRzIHRoZSBzaXplIG9mIHRoZSBub2RlJ3MgY29udGVudHMsIGlycmVzcGVjdGl2ZSBvZiBtYXJnaW5zLA0KCQkvLwkJcGFkZGluZywgb3IgYm9yZGVycy4NCgkJaWYoZC5fdXNlc0JvcmRlckJveChub2RlKSl7DQoJCQl2YXIgcGIgPSBkLl9nZXRQYWRCb3JkZXJFeHRlbnRzKG5vZGUsIGNvbXB1dGVkU3R5bGUpOw0KCQkJaWYod2lkdGhQeCA+PSAwKXsgd2lkdGhQeCArPSBwYi53OyB9DQoJCQlpZihoZWlnaHRQeCA+PSAwKXsgaGVpZ2h0UHggKz0gcGIuaDsgfQ0KCQl9DQoJCWQuX3NldEJveChub2RlLCBOYU4sIE5hTiwgd2lkdGhQeCwgaGVpZ2h0UHgpOw0KCX0NCg0KCWRvam8uX3NldE1hcmdpbkJveCA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgCS8qTnVtYmVyPyovbGVmdFB4LCAvKk51bWJlcj8qL3RvcFB4LA0KCQkJCQkJCQkJCQkJCS8qTnVtYmVyPyovd2lkdGhQeCwgLypOdW1iZXI/Ki9oZWlnaHRQeCwNCgkJCQkJCQkJCQkJCQkvKk9iamVjdCovY29tcHV0ZWRTdHlsZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlzZXRzIHRoZSBzaXplIG9mIHRoZSBub2RlJ3MgbWFyZ2luIGJveCBhbmQgcGxhY2VtZW50DQoJCS8vCQkobGVmdC90b3ApLCBpcnJlc3BlY3RpdmUgb2YgYm94IG1vZGVsLiBUaGluayBvZiBpdCBhcyBhDQoJCS8vCQlwYXNzdGhyb3VnaCB0byBkb2pvLl9zZXRCb3ggdGhhdCBoYW5kbGVzIGJveC1tb2RlbCB2YWdhcmllcyBmb3INCgkJLy8JCXlvdS4NCg0KCQl2YXIgcyA9IGNvbXB1dGVkU3R5bGUgfHwgZ2NzKG5vZGUpLA0KCQkvLyBTb21lIGVsZW1lbnRzIGhhdmUgc3BlY2lhbCBwYWRkaW5nLCBtYXJnaW4sIGFuZCBib3gtbW9kZWwgc2V0dGluZ3MuDQoJCS8vIFRvIHVzZSBib3ggZnVuY3Rpb25zIHlvdSBtYXkgbmVlZCB0byBzZXQgcGFkZGluZywgbWFyZ2luIGV4cGxpY2l0bHkuDQoJCS8vIENvbnRyb2xsaW5nIGJveC1tb2RlbCBpcyBoYXJkZXIsIGluIGEgcGluY2ggeW91IG1pZ2h0IHNldCBkb2pvLmJveE1vZGVsLg0KCQkJYmIgPSBkLl91c2VzQm9yZGVyQm94KG5vZGUpLA0KCQkJcGIgPSBiYiA/IF9uaWxFeHRlbnRzIDogZC5fZ2V0UGFkQm9yZGVyRXh0ZW50cyhub2RlLCBzKQ0KCQk7DQoJCWlmKGQuaXNXZWJLaXQpew0KCQkJLy8gb24gU2FmYXJpICgzLjEuMiksIGJ1dHRvbiBub2RlcyB3aXRoIG5vIGV4cGxpY2l0IHNpemUgaGF2ZSBhIGRlZmF1bHQgbWFyZ2luDQoJCQkvLyBzZXR0aW5nIGFuIGV4cGxpY2l0IHNpemUgZWxpbWluYXRlcyB0aGUgbWFyZ2luLg0KCQkJLy8gV2UgaGF2ZSB0byBzd2l6emxlIHRoZSB3aWR0aCB0byBnZXQgY29ycmVjdCBtYXJnaW4gcmVhZGluZy4NCgkJCWlmKGQuX2lzQnV0dG9uVGFnKG5vZGUpKXsNCgkJCQl2YXIgbnMgPSBub2RlLnN0eWxlOw0KCQkJCWlmKHdpZHRoUHggPj0gMCAmJiAhbnMud2lkdGgpIHsgbnMud2lkdGggPSAiNHB4IjsgfQ0KCQkJCWlmKGhlaWdodFB4ID49IDAgJiYgIW5zLmhlaWdodCkgeyBucy5oZWlnaHQgPSAiNHB4IjsgfQ0KCQkJfQ0KCQl9DQoJCXZhciBtYiA9IGQuX2dldE1hcmdpbkV4dGVudHMobm9kZSwgcyk7DQoJCWlmKHdpZHRoUHggPj0gMCl7IHdpZHRoUHggPSBNYXRoLm1heCh3aWR0aFB4IC0gcGIudyAtIG1iLncsIDApOyB9DQoJCWlmKGhlaWdodFB4ID49IDApeyBoZWlnaHRQeCA9IE1hdGgubWF4KGhlaWdodFB4IC0gcGIuaCAtIG1iLmgsIDApOyB9DQoJCWQuX3NldEJveChub2RlLCBsZWZ0UHgsIHRvcFB4LCB3aWR0aFB4LCBoZWlnaHRQeCk7DQoJfQ0KDQoJdmFyIF9uaWxFeHRlbnRzID0geyBsOjAsIHQ6MCwgdzowLCBoOjAgfTsNCg0KCS8vIHB1YmxpYyBBUEkNCg0KCWRvam8ubWFyZ2luQm94ID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypPYmplY3Q/Ki9ib3gpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJR2V0dGVyL3NldHRlciBmb3IgdGhlIG1hcmdpbi1ib3ggb2Ygbm9kZS4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlHZXR0ZXIvc2V0dGVyIGZvciB0aGUgbWFyZ2luLWJveCBvZiBub2RlLg0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3QgaW4gdGhlIGV4cGVjdGVkIGZvcm1hdCBvZiBib3ggKHJlZ2FyZGxlc3MNCgkJLy8JCWlmIGJveCBpcyBwYXNzZWQpLiBUaGUgb2JqZWN0IG1pZ2h0IGxvb2sgbGlrZToNCgkJLy8JCQlgeyBsOiA1MCwgdDogMjAwLCB3OiAzMDA6IGg6IDE1MCB9YA0KCQkvLwkJZm9yIGEgbm9kZSBvZmZzZXQgZnJvbSBpdHMgcGFyZW50IDUwcHggdG8gdGhlIGxlZnQsIDIwMHB4IGZyb20NCgkJLy8JCXRoZSB0b3Agd2l0aCBhIG1hcmdpbiB3aWR0aCBvZiAzMDBweCBhbmQgYSBtYXJnaW4taGVpZ2h0IG9mDQoJCS8vCQkxNTBweC4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byBET00gTm9kZSB0byBnZXQvc2V0IGJveCBmb3INCgkJLy8JYm94Og0KCQkvLwkJSWYgcGFzc2VkLCBkZW5vdGVzIHRoYXQgZG9qby5tYXJnaW5Cb3goKSBzaG91bGQNCgkJLy8JCXVwZGF0ZS9zZXQgdGhlIG1hcmdpbiBib3ggZm9yIG5vZGUuIEJveCBpcyBhbiBvYmplY3QgaW4gdGhlDQoJCS8vCQlhYm92ZSBmb3JtYXQuIEFsbCBwcm9wZXJ0aWVzIGFyZSBvcHRpb25hbCBpZiBwYXNzZWQuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCVJldHJpZXZlIHRoZSBtYXJnaW5ib3ggb2YgYSBwYXNzZWQgbm9kZQ0KCQkvLwl8CXZhciBib3ggPSBkb2pvLm1hcmdpbkJveCgic29tZU5vZGVJZCIpOw0KCQkvLwl8CWNvbnNvbGUuZGlyKGJveCk7DQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCVNldCBhIG5vZGUncyBtYXJnaW5ib3ggdG8gdGhlIHNpemUgb2YgYW5vdGhlciBub2RlDQoJCS8vCXwJdmFyIGJveCA9IGRvam8ubWFyZ2luQm94KCJzb21lTm9kZUlkIik7DQoJCS8vCXwJZG9qby5tYXJnaW5Cb3goInNvbWVPdGhlck5vZGUiLCBib3gpOw0KCQkNCgkJdmFyIG4gPSBieUlkKG5vZGUpLCBzID0gZ2NzKG4pLCBiID0gYm94Ow0KCQlyZXR1cm4gIWIgPyBkLl9nZXRNYXJnaW5Cb3gobiwgcykgOiBkLl9zZXRNYXJnaW5Cb3gobiwgYi5sLCBiLnQsIGIudywgYi5oLCBzKTsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5jb250ZW50Qm94ID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypPYmplY3Q/Ki9ib3gpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJR2V0dGVyL3NldHRlciBmb3IgdGhlIGNvbnRlbnQtYm94IG9mIG5vZGUuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3QgaW4gdGhlIGV4cGVjdGVkIGZvcm1hdCBvZiBib3ggKHJlZ2FyZGxlc3MgaWYgYm94IGlzIHBhc3NlZCkuDQoJCS8vCQlUaGUgb2JqZWN0IG1pZ2h0IGxvb2sgbGlrZToNCgkJLy8JCQlgeyBsOiA1MCwgdDogMjAwLCB3OiAzMDA6IGg6IDE1MCB9YA0KCQkvLwkJZm9yIGEgbm9kZSBvZmZzZXQgZnJvbSBpdHMgcGFyZW50IDUwcHggdG8gdGhlIGxlZnQsIDIwMHB4IGZyb20NCgkJLy8JCXRoZSB0b3Agd2l0aCBhIGNvbnRlbnQgd2lkdGggb2YgMzAwcHggYW5kIGEgY29udGVudC1oZWlnaHQgb2YNCgkJLy8JCTE1MHB4LiBOb3RlIHRoYXQgdGhlIGNvbnRlbnQgYm94IG1heSBoYXZlIGEgbXVjaCBsYXJnZXIgYm9yZGVyDQoJCS8vCQlvciBtYXJnaW4gYm94LCBkZXBlbmRpbmcgb24gdGhlIGJveCBtb2RlbCBjdXJyZW50bHkgaW4gdXNlIGFuZA0KCQkvLwkJQ1NTIHZhbHVlcyBzZXQvaW5oZXJpdGVkIGZvciBub2RlLg0KCQkvLwkJV2hpbGUgdGhlIGdldHRlciB3aWxsIHJldHVybiB0b3AgYW5kIGxlZnQgdmFsdWVzLCB0aGUNCgkJLy8JCXNldHRlciBvbmx5IGFjY2VwdHMgc2V0dGluZyB0aGUgd2lkdGggYW5kIGhlaWdodC4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byBET00gTm9kZSB0byBnZXQvc2V0IGJveCBmb3INCgkJLy8JYm94Og0KCQkvLwkJSWYgcGFzc2VkLCBkZW5vdGVzIHRoYXQgZG9qby5jb250ZW50Qm94KCkgc2hvdWxkDQoJCS8vCQl1cGRhdGUvc2V0IHRoZSBjb250ZW50IGJveCBmb3Igbm9kZS4gQm94IGlzIGFuIG9iamVjdCBpbiB0aGUNCgkJLy8JCWFib3ZlIGZvcm1hdCwgYnV0IG9ubHkgdyAod2lkdGgpIGFuZCBoIChoZWlnaHQpIGFyZSBzdXBwb3J0ZWQuDQoJCS8vCQlBbGwgcHJvcGVydGllcyBhcmUgb3B0aW9uYWwgaWYgcGFzc2VkLg0KCQl2YXIgbiA9IGJ5SWQobm9kZSksIHMgPSBnY3MobiksIGIgPSBib3g7DQoJCXJldHVybiAhYiA/IGQuX2dldENvbnRlbnRCb3gobiwgcykgOiBkLl9zZXRDb250ZW50U2l6ZShuLCBiLncsIGIuaCwgcyk7IC8vIE9iamVjdA0KCX0NCg0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoJLy8gUG9zaXRpb25pbmcgDQoJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KCXZhciBfc3VtQW5jZXN0b3JQcm9wZXJ0aWVzID0gZnVuY3Rpb24obm9kZSwgcHJvcCl7DQoJCWlmKCEobm9kZSA9IChub2RlfHwwKS5wYXJlbnROb2RlKSl7cmV0dXJuIDB9DQoJCXZhciB2YWwsIHJldFZhbCA9IDAsIF9iID0gZC5ib2R5KCk7DQoJCXdoaWxlKG5vZGUgJiYgbm9kZS5zdHlsZSl7DQoJCQlpZihnY3Mobm9kZSkucG9zaXRpb24gPT0gImZpeGVkIil7DQoJCQkJcmV0dXJuIDA7DQoJCQl9DQoJCQl2YWwgPSBub2RlW3Byb3BdOw0KCQkJaWYodmFsKXsNCgkJCQlyZXRWYWwgKz0gdmFsIC0gMDsNCgkJCQkvLyBvcGVyYSBhbmQga2h0bWwgI2JvZHkgJiAjaHRtbCBoYXMgdGhlIHNhbWUgdmFsdWVzLCB3ZSBvbmx5DQoJCQkJLy8gbmVlZCBvbmUgdmFsdWUNCgkJCQlpZihub2RlID09IF9iKXsgYnJlYWs7IH0NCgkJCX0NCgkJCW5vZGUgPSBub2RlLnBhcmVudE5vZGU7DQoJCX0NCgkJcmV0dXJuIHJldFZhbDsJLy8JaW50ZWdlcg0KCX0NCg0KCWRvam8uX2RvY1Njcm9sbCA9IGZ1bmN0aW9uKCl7DQoJCXZhciBuID0gZC5nbG9iYWw7DQoJCXJldHVybiAicGFnZVhPZmZzZXQiIGluIG4/IHsgeDpuLnBhZ2VYT2Zmc2V0LCB5Om4ucGFnZVlPZmZzZXQgfSA6DQoJCQkobj1kLmRvYy5kb2N1bWVudEVsZW1lbnQsIG4uY2xpZW50SGVpZ2h0PyB7IHg6ZC5fZml4SWVCaURpU2Nyb2xsTGVmdChuLnNjcm9sbExlZnQpLCB5Om4uc2Nyb2xsVG9wIH0gOg0KCQkJKG49ZC5ib2R5KCksIHsgeDpuLnNjcm9sbExlZnR8fDAsIHk6bi5zY3JvbGxUb3B8fDAgfSkpOw0KCX07DQoNCglkb2pvLl9pc0JvZHlMdHIgPSBmdW5jdGlvbigpew0KCQlyZXR1cm4gIl9ib2R5THRyIiBpbiBkPyBkLl9ib2R5THRyIDoNCgkJCWQuX2JvZHlMdHIgPSAoZC5ib2R5KCkuZGlyIHx8IGQuZG9jLmRvY3VtZW50RWxlbWVudC5kaXIgfHwgImx0ciIpLnRvTG93ZXJDYXNlKCkgPT0gImx0ciI7IC8vIEJvb2xlYW4gDQoJfQ0KDQoJCWRvam8uX2dldEllRG9jdW1lbnRFbGVtZW50T2Zmc2V0ID0gZnVuY3Rpb24oKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCXJldHVybnMgdGhlIG9mZnNldCBpbiB4IGFuZCB5IGZyb20gdGhlIGRvY3VtZW50IGJvZHkgdG8gdGhlDQoJCS8vCQl2aXN1YWwgZWRnZSBvZiB0aGUgcGFnZQ0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8gVGhlIGZvbGxvd2luZyB2YWx1ZXMgaW4gSUUgY29udGFpbiBhbiBvZmZzZXQ6DQoJCS8vCXwJCWV2ZW50LmNsaWVudFgNCgkJLy8JfAkJZXZlbnQuY2xpZW50WQ0KCQkvLwl8CQlub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQNCgkJLy8JfAkJbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3ANCgkJLy8JIAlCdXQgb3RoZXIgcG9zaXRpb24gcmVsYXRlZCB2YWx1ZXMgZG8gbm90IGNvbnRhaW4gdGhpcyBvZmZzZXQsDQoJCS8vCSAJc3VjaCBhcyBub2RlLm9mZnNldExlZnQsIG5vZGUub2Zmc2V0VG9wLCBub2RlLnN0eWxlLmxlZnQgYW5kDQoJCS8vCSAJbm9kZS5zdHlsZS50b3AuIFRoZSBvZmZzZXQgaXMgYWx3YXlzICgyLCAyKSBpbiBMVFIgZGlyZWN0aW9uLg0KCQkvLwkgCVdoZW4gdGhlIGJvZHkgaXMgaW4gUlRMIGRpcmVjdGlvbiwgdGhlIG9mZnNldCBjb3VudHMgdGhlIHdpZHRoDQoJCS8vCSAJb2YgbGVmdCBzY3JvbGwgYmFyJ3Mgd2lkdGguICBUaGlzIGZ1bmN0aW9uIGNvbXB1dGVzIHRoZSBhY3R1YWwNCgkJLy8JIAlvZmZzZXQuDQoNCgkJLy9OT1RFOiBhc3N1bWVzIHdlJ3JlIGJlaW5nIGNhbGxlZCBpbiBhbiBJRSBicm93c2VyDQoNCgkJdmFyIGRlID0gZC5kb2MuZG9jdW1lbnRFbGVtZW50OyAvLyBvbmx5IGRlYWwgd2l0aCBIVE1MIGVsZW1lbnQgaGVyZSwgX2FicyBoYW5kbGVzIGJvZHkvcXVpcmtzIA0KDQoJCWlmKGQuaXNJRSA8IDgpew0KCQkJdmFyIHIgPSBkZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgLy8gd29ya3Mgd2VsbCBmb3IgSUU2Kw0KCQkJLy9jb25zb2xlLmRlYnVnKCdyZWN0IGxlZnQsdG9wID0gJyArIHIubGVmdCsnLCcrci50b3AgKyAnLCBodG1sIGNsaWVudCBsZWZ0L3RvcCA9ICcgKyBkZS5jbGllbnRMZWZ0KycsJytkZS5jbGllbnRUb3AgKyAnLCBydGwgPSAnICsgKCFkLl9pc0JvZHlMdHIoKSkgKyAnLCBxdWlya3MgPSAnICsgZC5pc1F1aXJrcyk7DQoJCQl2YXIgbCA9IHIubGVmdCwNCgkJCSAgICB0ID0gci50b3A7DQoJCQlpZihkLmlzSUUgPCA3KXsNCgkJCQlsICs9IGRlLmNsaWVudExlZnQ7CS8vIHNjcm9sbGJhciBzaXplIGluIHN0cmljdC9SVEwsIG9yLA0KCQkJCXQgKz0gZGUuY2xpZW50VG9wOwkvLyBIVE1MIGJvcmRlciBzaXplIGluIHN0cmljdA0KCQkJfQ0KCQkJcmV0dXJuIHsNCgkJCQl4OiBsIDwgMD8gMCA6IGwsIC8vIEZSQU1FIGVsZW1lbnQgYm9yZGVyIHNpemUgY2FuIGxlYWQgdG8gaW5hY2N1cmF0ZSBuZWdhdGl2ZSB2YWx1ZXMNCgkJCQl5OiB0IDwgMD8gMCA6IHQNCgkJCX07DQoJCX1lbHNlew0KCQkJcmV0dXJuIHsNCgkJCQl4OiAwLA0KCQkJCXk6IDANCgkJCX07DQoJCX0NCg0KCX07DQoJDQoJZG9qby5fZml4SWVCaURpU2Nyb2xsTGVmdCA9IGZ1bmN0aW9uKC8qSW50ZWdlciovIHNjcm9sbExlZnQpew0KCQkvLyBJbiBSVEwgZGlyZWN0aW9uLCBzY3JvbGxMZWZ0IHNob3VsZCBiZSBhIG5lZ2F0aXZlIHZhbHVlLCBidXQgSUUgPCA4DQoJCS8vIHJldHVybnMgYSBwb3NpdGl2ZSBvbmUuIEFsbCBjb2RlcyB1c2luZyBkb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdA0KCQkvLyBtdXN0IGNhbGwgdGhpcyBmdW5jdGlvbiB0byBmaXggdGhpcyBlcnJvciwgb3RoZXJ3aXNlIHRoZSBwb3NpdGlvbg0KCQkvLyB3aWxsIG9mZnNldCB0byByaWdodCB3aGVuIHRoZXJlIGlzIGEgaG9yaXpvbnRhbCBzY3JvbGxiYXIuDQoNCgkJCQl2YXIgZGQgPSBkLmRvYzsNCgkJaWYoZC5pc0lFIDwgOCAmJiAhZC5faXNCb2R5THRyKCkpew0KCQkJdmFyIGRlID0gZC5pc1F1aXJrcyA/IGRkLmJvZHkgOiBkZC5kb2N1bWVudEVsZW1lbnQ7DQoJCQlyZXR1cm4gc2Nyb2xsTGVmdCArIGRlLmNsaWVudFdpZHRoIC0gZGUuc2Nyb2xsV2lkdGg7IC8vIEludGVnZXINCgkJfQ0KCQkJCXJldHVybiBzY3JvbGxMZWZ0OyAvLyBJbnRlZ2VyDQoJfQ0KDQoJLy8gRklYTUU6IG5lZWQgYSBzZXR0ZXIgZm9yIGNvb3JkcyBvciBhIG1vdmVUbyEhDQoJZG9qby5fYWJzID0gZG9qby5wb3NpdGlvbiA9IGZ1bmN0aW9uKC8qRG9tTm9kZSovbm9kZSwgLypCb29sZWFuPyovaW5jbHVkZVNjcm9sbCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlHZXRzIHRoZSBwb3NpdGlvbiBhbmQgc2l6ZSBvZiB0aGUgcGFzc2VkIGVsZW1lbnQgcmVsYXRpdmUgdG8NCgkJLy8JCXRoZSB2aWV3cG9ydCAoaWYgaW5jbHVkZVNjcm9sbD09ZmFsc2UpLCBvciByZWxhdGl2ZSB0byB0aGUNCgkJLy8JCWRvY3VtZW50IHJvb3QgKGlmIGluY2x1ZGVTY3JvbGw9PXRydWUpLg0KCQkvLw0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCVJldHVybnMgYW4gb2JqZWN0IG9mIHRoZSBmb3JtOg0KCQkvLwkJCXsgeDogMTAwLCB5OiAzMDAsIHc6IDIwLCBoOiAxNSB9DQoJCS8vCQlJZiBpbmNsdWRlU2Nyb2xsPT10cnVlLCB0aGUgeCBhbmQgeSB2YWx1ZXMgd2lsbCBpbmNsdWRlIGFueQ0KCQkvLwkJZG9jdW1lbnQgb2Zmc2V0cyB0aGF0IG1heSBhZmZlY3QgdGhlIHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZQ0KCQkvLwkJdmlld3BvcnQuDQoJCS8vCQlVc2VzIHRoZSBib3JkZXItYm94IG1vZGVsIChpbmNsdXNpdmUgb2YgYm9yZGVyIGFuZCBwYWRkaW5nIGJ1dA0KCQkvLwkJbm90IG1hcmdpbikuICBEb2VzIG5vdCBhY3QgYXMgYSBzZXR0ZXIuDQoNCgkJdmFyIGRiID0gZC5ib2R5KCksIGRoID0gZGIucGFyZW50Tm9kZSwgcmV0Ow0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJaWYobm9kZVsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Il0pew0KCQkJLy8gSUU2KywgRkYzKywgc3VwZXItbW9kZXJuIFdlYktpdCwgYW5kIE9wZXJhIDkuNisgYWxsIHRha2UgdGhpcyBicmFuY2gNCgkJCXJldCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQoJCQlyZXQgPSB7IHg6IHJldC5sZWZ0LCB5OiByZXQudG9wLCB3OiByZXQucmlnaHQgLSByZXQubGVmdCwgaDogcmV0LmJvdHRvbSAtIHJldC50b3AgfTsNCgkJCQkJaWYoZC5pc0lFKXsNCgkJCQkvLyBPbiBJRSB0aGVyZSdzIGEgMnB4IG9mZnNldCB0aGF0IHdlIG5lZWQgdG8gYWRqdXN0IGZvciwgc2VlIF9nZXRJZURvY3VtZW50RWxlbWVudE9mZnNldCgpDQoJCQkJdmFyIG9mZnNldCA9IGQuX2dldEllRG9jdW1lbnRFbGVtZW50T2Zmc2V0KCk7DQoNCgkJCQkvLyBmaXhlcyB0aGUgcG9zaXRpb24gaW4gSUUsIHF1aXJrcyBtb2RlDQoJCQkJcmV0LnggLT0gb2Zmc2V0LnggKyAoZC5pc1F1aXJrcyA/IGRiLmNsaWVudExlZnQrZGIub2Zmc2V0TGVmdCA6IDApOw0KCQkJCXJldC55IC09IG9mZnNldC55ICsgKGQuaXNRdWlya3MgPyBkYi5jbGllbnRUb3ArZGIub2Zmc2V0VG9wIDogMCk7DQoJCQl9ZWxzZSBpZihkLmlzRkYgPT0gMyl7DQoJCQkJLy8gSW4gRkYzIHlvdSBoYXZlIHRvIHN1YnRyYWN0IHRoZSBkb2N1bWVudCBlbGVtZW50IG1hcmdpbnMuDQoJCQkJLy8gRml4ZWQgaW4gRkYzLjUgdGhvdWdoLg0KCQkJCXZhciBjcyA9IGdjcyhkaCk7DQoJCQkJcmV0LnggLT0gcHgoZGgsIGNzLm1hcmdpbkxlZnQpICsgcHgoZGgsIGNzLmJvcmRlckxlZnRXaWR0aCk7DQoJCQkJcmV0LnkgLT0gcHgoZGgsIGNzLm1hcmdpblRvcCkgKyBweChkaCwgY3MuYm9yZGVyVG9wV2lkdGgpOw0KCQkJfQ0KCQkJCX1lbHNlew0KCQkJLy8gRkYyIGFuZCBvbGRlciBXZWJLaXQNCgkJCXJldCA9IHsNCgkJCQl4OiAwLA0KCQkJCXk6IDAsDQoJCQkJdzogbm9kZS5vZmZzZXRXaWR0aCwNCgkJCQloOiBub2RlLm9mZnNldEhlaWdodA0KCQkJfTsNCgkJCWlmKG5vZGVbIm9mZnNldFBhcmVudCJdKXsNCgkJCQlyZXQueCAtPSBfc3VtQW5jZXN0b3JQcm9wZXJ0aWVzKG5vZGUsICJzY3JvbGxMZWZ0Iik7DQoJCQkJcmV0LnkgLT0gX3N1bUFuY2VzdG9yUHJvcGVydGllcyhub2RlLCAic2Nyb2xsVG9wIik7DQoNCgkJCQl2YXIgY3Vybm9kZSA9IG5vZGU7DQoJCQkJZG97DQoJCQkJCXZhciBuID0gY3Vybm9kZS5vZmZzZXRMZWZ0LA0KCQkJCQkJdCA9IGN1cm5vZGUub2Zmc2V0VG9wOw0KCQkJCQlyZXQueCArPSBpc05hTihuKSA/IDAgOiBuOw0KCQkJCQlyZXQueSArPSBpc05hTih0KSA/IDAgOiB0Ow0KDQoJCQkJCWNzID0gZ2NzKGN1cm5vZGUpOw0KCQkJCQlpZihjdXJub2RlICE9IG5vZGUpew0KCQkJCQkJCQlpZihkLmlzTW96KXsNCgkJCQkJCQkvLyB0cmllZCBsZWZ0K3JpZ2h0IHdpdGggZGlmZmVyZW50bHkgc2l6ZWQgbGVmdC9yaWdodCBib3JkZXJzDQoJCQkJCQkJLy8gaXQgcmVhbGx5IGlzIDJ4bGVmdCBib3JkZXIgaW4gRkYsIG5vdCBsZWZ0K3JpZ2h0LCBldmVuIGluIFJUTCENCgkJCQkJCQlyZXQueCArPSAyICogcHgoY3Vybm9kZSxjcy5ib3JkZXJMZWZ0V2lkdGgpOw0KCQkJCQkJCXJldC55ICs9IDIgKiBweChjdXJub2RlLGNzLmJvcmRlclRvcFdpZHRoKTsNCgkJCQkJCX1lbHNlew0KCQkJCQkJCQkJcmV0LnggKz0gcHgoY3Vybm9kZSwgY3MuYm9yZGVyTGVmdFdpZHRoKTsNCgkJCQkJCQlyZXQueSArPSBweChjdXJub2RlLCBjcy5ib3JkZXJUb3BXaWR0aCk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCS8vIHN0YXRpYyBjaGlsZHJlbiBpbiBhIHN0YXRpYyBkaXYgaW4gRkYyIGFyZSBhZmZlY3RlZCBieSB0aGUgZGl2J3MgYm9yZGVyIGFzIHdlbGwNCgkJCQkJLy8gYnV0IG9mZnNldFBhcmVudCB3aWxsIHNraXAgdGhpcyBkaXYhDQoJCQkJCQkJaWYoZC5pc01veiAmJiBjcy5wb3NpdGlvbj09InN0YXRpYyIpew0KCQkJCQkJdmFyIHBhcmVudD1jdXJub2RlLnBhcmVudE5vZGU7DQoJCQkJCQl3aGlsZShwYXJlbnQhPWN1cm5vZGUub2Zmc2V0UGFyZW50KXsNCgkJCQkJCQl2YXIgcGNzPWdjcyhwYXJlbnQpOw0KCQkJCQkJCWlmKHBjcy5wb3NpdGlvbj09InN0YXRpYyIpew0KCQkJCQkJCQlyZXQueCArPSBweChjdXJub2RlLHBjcy5ib3JkZXJMZWZ0V2lkdGgpOw0KCQkJCQkJCQlyZXQueSArPSBweChjdXJub2RlLHBjcy5ib3JkZXJUb3BXaWR0aCk7DQoJCQkJCQkJfQ0KCQkJCQkJCXBhcmVudD1wYXJlbnQucGFyZW50Tm9kZTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkJCWN1cm5vZGUgPSBjdXJub2RlLm9mZnNldFBhcmVudDsNCgkJCQl9d2hpbGUoKGN1cm5vZGUgIT0gZGgpICYmIGN1cm5vZGUpOw0KCQkJfWVsc2UgaWYobm9kZS54ICYmIG5vZGUueSl7DQoJCQkJcmV0LnggKz0gaXNOYU4obm9kZS54KSA/IDAgOiBub2RlLng7DQoJCQkJcmV0LnkgKz0gaXNOYU4obm9kZS55KSA/IDAgOiBub2RlLnk7DQoJCQl9DQoJCX0NCgkJLy8gYWNjb3VudCBmb3IgZG9jdW1lbnQgc2Nyb2xsaW5nDQoJCS8vIGlmIG9mZnNldFBhcmVudCBpcyB1c2VkLCByZXQgdmFsdWUgYWxyZWFkeSBpbmNsdWRlcyBzY3JvbGwgcG9zaXRpb24NCgkJLy8gc28gd2UgbWF5IGhhdmUgdG8gYWN0dWFsbHkgcmVtb3ZlIHRoYXQgdmFsdWUgaWYgIWluY2x1ZGVTY3JvbGwNCgkJaWYoaW5jbHVkZVNjcm9sbCl7DQoJCQl2YXIgc2Nyb2xsID0gZC5fZG9jU2Nyb2xsKCk7DQoJCQlyZXQueCArPSBzY3JvbGwueDsNCgkJCXJldC55ICs9IHNjcm9sbC55Ow0KCQl9DQoNCgkJcmV0dXJuIHJldDsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5jb29yZHMgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKkJvb2xlYW4/Ki9pbmNsdWRlU2Nyb2xsKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCURlcHJlY2F0ZWQ6IFVzZSBwb3NpdGlvbigpIGZvciBib3JkZXItYm94IHgveS93L2gNCgkJLy8JCW9yIG1hcmdpbkJveCgpIGZvciBtYXJnaW4tYm94IHcvaC9sL3QuDQoJCS8vCQlSZXR1cm5zIGFuIG9iamVjdCByZXByZXNlbnRpbmcgYSBub2RlJ3Mgc2l6ZSBhbmQgcG9zaXRpb24uDQoJCS8vDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJUmV0dXJucyBhbiBvYmplY3QgdGhhdCBtZWFzdXJlcyBtYXJnaW4tYm94ICh3KWlkdGgvKGgpZWlnaHQNCgkJLy8JCWFuZCBhYnNvbHV0ZSBwb3NpdGlvbiB4L3kgb2YgdGhlIGJvcmRlci1ib3guIEFsc28gcmV0dXJuZWQNCgkJLy8JCWlzIGNvbXB1dGVkIChsKWVmdCBhbmQgKHQpb3AgdmFsdWVzIGluIHBpeGVscyBmcm9tIHRoZQ0KCQkvLwkJbm9kZSdzIG9mZnNldFBhcmVudCBhcyByZXR1cm5lZCBmcm9tIG1hcmdpbkJveCgpLg0KCQkvLwkJUmV0dXJuIHZhbHVlIHdpbGwgYmUgaW4gdGhlIGZvcm06DQoJCS8vfAkJCXsgbDogNTAsIHQ6IDIwMCwgdzogMzAwOiBoOiAxNTAsIHg6IDEwMCwgeTogMzAwIH0NCgkJLy8JCURvZXMgbm90IGFjdCBhcyBhIHNldHRlci4gSWYgaW5jbHVkZVNjcm9sbCBpcyBwYXNzZWQsIHRoZSB4IGFuZA0KCQkvLwkJeSBwYXJhbXMgYXJlIGFmZmVjdGVkIGFzIG9uZSB3b3VsZCBleHBlY3QgaW4gZG9qby5wb3NpdGlvbigpLg0KCQl2YXIgbiA9IGJ5SWQobm9kZSksIHMgPSBnY3MobiksIG1iID0gZC5fZ2V0TWFyZ2luQm94KG4sIHMpOw0KCQl2YXIgYWJzID0gZC5wb3NpdGlvbihuLCBpbmNsdWRlU2Nyb2xsKTsNCgkJbWIueCA9IGFicy54Ow0KCQltYi55ID0gYWJzLnk7DQoJCXJldHVybiBtYjsNCgl9DQoNCgkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KCS8vIEVsZW1lbnQgYXR0cmlidXRlIEZ1bmN0aW9ucw0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCgkvLyBkb2pvLmF0dHIoKSBzaG91bGQgY29uZm9ybSB0byBodHRwOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1Db3JlLw0KDQoJdmFyIF9wcm9wTmFtZXMgPSB7DQoJCQkvLyBwcm9wZXJ0aWVzIHJlbmFtZWQgdG8gYXZvaWQgY2xhc2hlcyB3aXRoIHJlc2VydmVkIHdvcmRzDQoJCQkiY2xhc3MiOiAgICJjbGFzc05hbWUiLA0KCQkJImZvciI6ICAgICAiaHRtbEZvciIsDQoJCQkvLyBwcm9wZXJ0aWVzIHdyaXR0ZW4gYXMgY2FtZWxDYXNlDQoJCQl0YWJpbmRleDogICJ0YWJJbmRleCIsDQoJCQlyZWFkb25seTogICJyZWFkT25seSIsDQoJCQljb2xzcGFuOiAgICJjb2xTcGFuIiwNCgkJCWZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLA0KCQkJcm93c3BhbjogICAicm93U3BhbiIsDQoJCQl2YWx1ZXR5cGU6ICJ2YWx1ZVR5cGUiDQoJCX0sDQoJCV9hdHRyTmFtZXMgPSB7DQoJCQkvLyBvcmlnaW5hbCBhdHRyaWJ1dGUgbmFtZXMNCgkJCWNsYXNzbmFtZTogImNsYXNzIiwNCgkJCWh0bWxmb3I6ICAgImZvciIsDQoJCQkvLyBmb3IgSUUNCgkJCXRhYmluZGV4OiAgInRhYkluZGV4IiwNCgkJCXJlYWRvbmx5OiAgInJlYWRPbmx5Ig0KCQl9LA0KCQlfZm9yY2VQcm9wTmFtZXMgPSB7DQoJCQlpbm5lckhUTUw6IDEsDQoJCQljbGFzc05hbWU6IDEsDQoJCQlodG1sRm9yOiAgIGQuaXNJRSwNCgkJCXZhbHVlOiAgICAgMQ0KCQl9Ow0KDQoJdmFyIF9maXhBdHRyTmFtZSA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gbmFtZSl7DQoJCXJldHVybiBfYXR0ck5hbWVzW25hbWUudG9Mb3dlckNhc2UoKV0gfHwgbmFtZTsNCgl9Ow0KDQoJdmFyIF9oYXNBdHRyID0gZnVuY3Rpb24obm9kZSwgbmFtZSl7DQoJCXZhciBhdHRyID0gbm9kZS5nZXRBdHRyaWJ1dGVOb2RlICYmIG5vZGUuZ2V0QXR0cmlidXRlTm9kZShuYW1lKTsNCgkJcmV0dXJuIGF0dHIgJiYgYXR0ci5zcGVjaWZpZWQ7IC8vIEJvb2xlYW4NCgl9Ow0KDQoJLy8gVGhlcmUgaXMgYSBkaWZmZXJlbmNlIGluIHRoZSBwcmVzZW5jZSBvZiBjZXJ0YWluIHByb3BlcnRpZXMgYW5kIHRoZWlyIGRlZmF1bHQgdmFsdWVzDQoJLy8gYmV0d2VlbiBicm93c2Vycy4gRm9yIGV4YW1wbGUsIG9uIElFICJkaXNhYmxlZCIgaXMgcHJlc2VudCBvbiBhbGwgZWxlbWVudHMsDQoJLy8gYnV0IGl0IGlzIHZhbHVlIGlzICJmYWxzZSI7ICJ0YWJJbmRleCIgb2YgPGRpdj4gcmV0dXJucyAwIGJ5IGRlZmF1bHQgb24gSUUsIHlldCBvdGhlciBicm93c2Vycw0KCS8vIGNhbiByZXR1cm4gLTEuDQoNCglkb2pvLmhhc0F0dHIgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKlN0cmluZyovbmFtZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIHRydWUgaWYgdGhlIHJlcXVlc3RlZCBhdHRyaWJ1dGUgaXMgc3BlY2lmaWVkIG9uIHRoZQ0KCQkvLwkJZ2l2ZW4gZWxlbWVudCwgYW5kIGZhbHNlIG90aGVyd2lzZS4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byB0aGUgZWxlbWVudCB0byBjaGVjaw0KCQkvLwluYW1lOg0KCQkvLwkJdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZQ0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJdHJ1ZSBpZiB0aGUgcmVxdWVzdGVkIGF0dHJpYnV0ZSBpcyBzcGVjaWZpZWQgb24gdGhlDQoJCS8vCQlnaXZlbiBlbGVtZW50LCBhbmQgZmFsc2Ugb3RoZXJ3aXNlDQoJCXZhciBsYyA9IG5hbWUudG9Mb3dlckNhc2UoKTsNCgkJcmV0dXJuIF9mb3JjZVByb3BOYW1lc1tfcHJvcE5hbWVzW2xjXSB8fCBuYW1lXSB8fCBfaGFzQXR0cihieUlkKG5vZGUpLCBfYXR0ck5hbWVzW2xjXSB8fCBuYW1lKTsJLy8gQm9vbGVhbg0KCX0NCg0KCXZhciBfZXZ0SGRsck1hcCA9IHt9LCBfY3RyID0gMCwNCgkJX2F0dHJJZCA9IGRvam8uX3Njb3BlTmFtZSArICJhdHRyaWQiLA0KCQkvLyB0aGUgbmV4dCBkaWN0aW9uYXJ5IGxpc3RzIGVsZW1lbnRzIHdpdGggcmVhZC1vbmx5IGlubmVySFRNTCBvbiBJRQ0KCQlfcm9Jbm5lckh0bWwgPSB7Y29sOiAxLCBjb2xncm91cDogMSwNCgkJCS8vIGZyYW1lc2V0OiAxLCBoZWFkOiAxLCBodG1sOiAxLCBzdHlsZTogMSwNCgkJCXRhYmxlOiAxLCB0Ym9keTogMSwgdGZvb3Q6IDEsIHRoZWFkOiAxLCB0cjogMSwgdGl0bGU6IDF9Ow0KDQoJZG9qby5hdHRyID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypTdHJpbmd8T2JqZWN0Ki9uYW1lLCAvKlN0cmluZz8qL3ZhbHVlKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUdldHMgb3Igc2V0cyBhbiBhdHRyaWJ1dGUgb24gYW4gSFRNTCBlbGVtZW50Lg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUhhbmRsZXMgbm9ybWFsaXplZCBnZXR0aW5nIGFuZCBzZXR0aW5nIG9mIGF0dHJpYnV0ZXMgb24gRE9NDQoJCS8vCQlOb2Rlcy4gSWYgMiBhcmd1bWVudHMgYXJlIHBhc3NlZCwgYW5kIGEgdGhlIHNlY29uZCBhcmd1bW50IGlzIGENCgkJLy8JCXN0cmluZywgYWN0cyBhcyBhIGdldHRlci4NCgkJLy8NCgkJLy8JCUlmIGEgdGhpcmQgYXJndW1lbnQgaXMgcGFzc2VkLCBvciBpZiB0aGUgc2Vjb25kIGFyZ3VtZW50IGlzIGENCgkJLy8JCW1hcCBvZiBhdHRyaWJ1dGVzLCBhY3RzIGFzIGEgc2V0dGVyLg0KCQkvLw0KCQkvLwkJV2hlbiBwYXNzaW5nIGZ1bmN0aW9ucyBhcyB2YWx1ZXMsIG5vdGUgdGhhdCB0aGV5IHdpbGwgbm90IGJlDQoJCS8vCQlkaXJlY3RseSBhc3NpZ25lZCB0byBzbG90cyBvbiB0aGUgbm9kZSwgYnV0IHJhdGhlciB0aGUgZGVmYXVsdA0KCQkvLwkJYmVoYXZpb3Igd2lsbCBiZSByZW1vdmVkIGFuZCB0aGUgbmV3IGJlaGF2aW9yIHdpbGwgYmUgYWRkZWQNCgkJLy8JCXVzaW5nIGBkb2pvLmNvbm5lY3QoKWAsIG1lYW5pbmcgdGhhdCBldmVudCBoYW5kbGVyIHByb3BlcnRpZXMNCgkJLy8JCXdpbGwgYmUgbm9ybWFsaXplZCBhbmQgdGhhdCBzb21lIGNhdmVhdHMgd2l0aCByZWdhcmRzIHRvDQoJCS8vCQlub24tc3RhbmRhcmQgYmVoYXZpb3JzIGZvciBvbnN1Ym1pdCBhcHBseS4gTmFtZWx5IHRoYXQgeW91DQoJCS8vCQlzaG91bGQgY2FuY2VsIGZvcm0gc3VibWlzc2lvbiB1c2luZyBgZG9qby5zdG9wRXZlbnQoKWAgb24gdGhlDQoJCS8vCQlwYXNzZWQgZXZlbnQgb2JqZWN0IGluc3RlYWQgb2YgcmV0dXJuaW5nIGEgYm9vbGVhbiB2YWx1ZSBmcm9tDQoJCS8vCQl0aGUgaGFuZGxlciBpdHNlbGYuDQoJCS8vCW5vZGU6DQoJCS8vCQlpZCBvciByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gZ2V0IG9yIHNldCB0aGUgYXR0cmlidXRlIG9uDQoJCS8vCW5hbWU6DQoJCS8vCQl0aGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIGdldCBvciBzZXQuDQoJCS8vCXZhbHVlOg0KCQkvLwkJVGhlIHZhbHVlIHRvIHNldCBmb3IgdGhlIGF0dHJpYnV0ZQ0KCQkvLwlyZXR1cm5zOg0KCQkvLwkJd2hlbiB1c2VkIGFzIGEgZ2V0dGVyLCB0aGUgdmFsdWUgb2YgdGhlIHJlcXVlc3RlZCBhdHRyaWJ1dGUNCgkJLy8JCW9yIG51bGwgaWYgdGhhdCBhdHRyaWJ1dGUgZG9lcyBub3QgaGF2ZSBhIHNwZWNpZmllZCBvcg0KCQkvLwkJZGVmYXVsdCB2YWx1ZTsNCgkJLy8NCgkJLy8JCXdoZW4gdXNlZCBhcyBhIHNldHRlciwgdGhlIERPTSBub2RlDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCXwJLy8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSAiZm9vIiBhdHRyaWJ1dGUgb24gYSBub2RlDQoJCS8vCXwJZG9qby5hdHRyKGRvam8uYnlJZCgibm9kZUlkIiksICJmb28iKTsNCgkJLy8JfAkvLyBvciB3ZSBjYW4ganVzdCBwYXNzIHRoZSBpZDoNCgkJLy8JfAlkb2pvLmF0dHIoIm5vZGVJZCIsICJmb28iKTsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JfAkvLyB1c2UgYXR0cigpIHRvIHNldCB0aGUgdGFiIGluZGV4DQoJCS8vCXwJZG9qby5hdHRyKCJub2RlSWQiLCAidGFiSW5kZXgiLCAzKTsNCgkJLy8JfA0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlTZXQgbXVsdGlwbGUgdmFsdWVzIGF0IG9uY2UsIGluY2x1ZGluZyBldmVudCBoYW5kbGVyczoNCgkJLy8JfAlkb2pvLmF0dHIoImZvcm1JZCIsIHsNCgkJLy8JfAkJImZvbyI6ICJiYXIiLA0KCQkvLwl8CQkidGFiSW5kZXgiOiAtMSwNCgkJLy8JfAkJIm1ldGhvZCI6ICJQT1NUIiwNCgkJLy8JfAkJIm9uc3VibWl0IjogZnVuY3Rpb24oZSl7DQoJCS8vCXwJCQkvLyBzdG9wIHN1Ym1pdHRpbmcgdGhlIGZvcm0uIE5vdGUgdGhhdCB0aGUgSUUgYmVoYXZpb3INCgkJLy8JfAkJCS8vIG9mIHJldHVybmluZyB0cnVlIG9yIGZhbHNlIHdpbGwgaGF2ZSBubyBlZmZlY3QgaGVyZQ0KCQkvLwl8CQkJLy8gc2luY2Ugb3VyIGhhbmRsZXIgaXMgY29ubmVjdCgpZWQgdG8gdGhlIGJ1aWx0LWluDQoJCS8vCXwJCQkvLyBvbnN1Ym1pdCBiZWhhdmlvciBhbmQgc28gd2UgbmVlZCB0byB1c2UNCgkJLy8JfAkJCS8vIGRvam8uc3RvcEV2ZW50KCkgdG8gZW5zdXJlIHRoYXQgdGhlIHN1Ym1pc3Npb24NCgkJLy8JfAkJCS8vIGRvZXNuJ3QgcHJvY2VlZC4NCgkJLy8JfAkJCWRvam8uc3RvcEV2ZW50KGUpOw0KCQkvLwl8DQoJCS8vCXwJCQkvLyBzdWJtaXQgdGhlIGZvcm0gd2l0aCBBamF4DQoJCS8vCXwJCQlkb2pvLnhoclBvc3QoeyBmb3JtOiAiZm9ybUlkIiB9KTsNCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLw0KCQkvLwlleGFtcGxlOg0KCQkvLwlTdHlsZSBpcyBzIHNwZWNpYWwgY2FzZTogT25seSBzZXQgd2l0aCBhbiBvYmplY3QgaGFzaCBvZiBzdHlsZXMNCgkJLy8JfAlkb2pvLmF0dHIoInNvbWVOb2RlIix7DQoJCS8vCXwJCWlkOiJiYXIiLA0KCQkvLwl8CQlzdHlsZTp7DQoJCS8vCXwJCQl3aWR0aDoiMjAwcHgiLCBoZWlnaHQ6IjEwMHB4IiwgY29sb3I6IiMwMDAiDQoJCS8vCXwJCX0NCgkJLy8JfAl9KTsNCgkJLy8NCgkJLy8JZXhhbXBsZToNCgkJLy8JQWdhaW4sIG9ubHkgc2V0IHN0eWxlIGFzIGFuIG9iamVjdCBoYXNoIG9mIHN0eWxlczoNCgkJLy8JfAl2YXIgb2JqID0geyBjb2xvcjoiI2ZmZiIsIGJhY2tncm91bmRDb2xvcjoiIzAwMCIgfTsNCgkJLy8JfAlkb2pvLmF0dHIoInNvbWVOb2RlIiwgInN0eWxlIiwgb2JqKTsNCgkJLy8JfA0KCQkvLwl8CS8vIHRob3VnaCBzaG9ydGVyIHRvIHVzZSBgZG9qby5zdHlsZSgpYCBpbiB0aGlzIGNhc2U6DQoJCS8vCXwJZG9qby5zdHlsZSgic29tZU5vZGUiLCBvYmopOw0KDQoJCW5vZGUgPSBieUlkKG5vZGUpOw0KCQl2YXIgYXJncyA9IGFyZ3VtZW50cy5sZW5ndGgsIHByb3A7DQoJCWlmKGFyZ3MgPT0gMiAmJiB0eXBlb2YgbmFtZSAhPSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCS8vIHRoZSBvYmplY3QgZm9ybSBvZiBzZXR0ZXI6IHRoZSAybmQgYXJndW1lbnQgaXMgYSBkaWN0aW9uYXJ5DQoJCQlmb3IodmFyIHggaW4gbmFtZSl7DQoJCQkJZC5hdHRyKG5vZGUsIHgsIG5hbWVbeF0pOw0KCQkJfQ0KCQkJcmV0dXJuIG5vZGU7IC8vIERvbU5vZGUNCgkJfQ0KCQl2YXIgbGMgPSBuYW1lLnRvTG93ZXJDYXNlKCksDQoJCQlwcm9wTmFtZSA9IF9wcm9wTmFtZXNbbGNdIHx8IG5hbWUsDQoJCQlmb3JjZVByb3AgPSBfZm9yY2VQcm9wTmFtZXNbcHJvcE5hbWVdLA0KCQkJYXR0ck5hbWUgPSBfYXR0ck5hbWVzW2xjXSB8fCBuYW1lOw0KCQlpZihhcmdzID09IDMpew0KCQkJLy8gc2V0dGVyDQoJCQlkb3sNCgkJCQlpZihwcm9wTmFtZSA9PSAic3R5bGUiICYmIHR5cGVvZiB2YWx1ZSAhPSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCQkJLy8gc3BlY2lhbCBjYXNlOiBzZXR0aW5nIGEgc3R5bGUNCgkJCQkJZC5zdHlsZShub2RlLCB2YWx1ZSk7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQlpZihwcm9wTmFtZSA9PSAiaW5uZXJIVE1MIil7DQoJCQkJCS8vIHNwZWNpYWwgY2FzZTogYXNzaWduaW5nIEhUTUwNCgkJCQkJCQkJCQlpZihkLmlzSUUgJiYgbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgaW4gX3JvSW5uZXJIdG1sKXsNCgkJCQkJCWQuZW1wdHkobm9kZSk7DQoJCQkJCQlub2RlLmFwcGVuZENoaWxkKGQuX3RvRG9tKHZhbHVlLCBub2RlLm93bmVyRG9jdW1lbnQpKTsNCgkJCQkJfWVsc2V7DQoJCQkJCQkJCQkJCW5vZGVbcHJvcE5hbWVdID0gdmFsdWU7DQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQlpZihkLmlzRnVuY3Rpb24odmFsdWUpKXsNCgkJCQkJLy8gc3BlY2lhbCBjYXNlOiBhc3NpZ25pbmcgYW4gZXZlbnQgaGFuZGxlcg0KCQkJCQkvLyBjbG9iYmVyIGlmIHdlIGNhbg0KCQkJCQl2YXIgYXR0cklkID0gZC5hdHRyKG5vZGUsIF9hdHRySWQpOw0KCQkJCQlpZighYXR0cklkKXsNCgkJCQkJCWF0dHJJZCA9IF9jdHIrKzsNCgkJCQkJCWQuYXR0cihub2RlLCBfYXR0cklkLCBhdHRySWQpOw0KCQkJCQl9DQoJCQkJCWlmKCFfZXZ0SGRsck1hcFthdHRySWRdKXsNCgkJCQkJCV9ldnRIZGxyTWFwW2F0dHJJZF0gPSB7fTsNCgkJCQkJfQ0KCQkJCQl2YXIgaCA9IF9ldnRIZGxyTWFwW2F0dHJJZF1bcHJvcE5hbWVdOw0KCQkJCQlpZihoKXsNCgkJCQkJCWQuZGlzY29ubmVjdChoKTsNCgkJCQkJfWVsc2V7DQoJCQkJCQl0cnl7DQoJCQkJCQkJZGVsZXRlIG5vZGVbcHJvcE5hbWVdOw0KCQkJCQkJfWNhdGNoKGUpe30NCgkJCQkJfQ0KCQkJCQkvLyBlbnN1cmUgdGhhdCBldmVudCBvYmplY3RzIGFyZSBub3JtYWxpemVkLCBldGMuDQoJCQkJCV9ldnRIZGxyTWFwW2F0dHJJZF1bcHJvcE5hbWVdID0gZC5jb25uZWN0KG5vZGUsIHByb3BOYW1lLCB2YWx1ZSk7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQlpZihmb3JjZVByb3AgfHwgdHlwZW9mIHZhbHVlID09ICJib29sZWFuIil7DQoJCQkJCS8vIHNwZWNpYWwgY2FzZTogZm9yY2luZyBhc3NpZ25tZW50IHRvIHRoZSBwcm9wZXJ0eQ0KCQkJCQkvLyBzcGVjaWFsIGNhc2U6IHNldHRpbmcgYm9vbGVhbiB0byBhIHByb3BlcnR5IGluc3RlYWQgb2YgYXR0cmlidXRlDQoJCQkJCW5vZGVbcHJvcE5hbWVdID0gdmFsdWU7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQkvLyBub2RlJ3MgYXR0cmlidXRlDQoJCQkJbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbHVlKTsNCgkJCX13aGlsZShmYWxzZSk7DQoJCQlyZXR1cm4gbm9kZTsgLy8gRG9tTm9kZQ0KCQl9DQoJCS8vIGdldHRlcg0KCQkvLyBzaG91bGQgd2UgYWNjZXNzIHRoaXMgYXR0cmlidXRlIHZpYSBhIHByb3BlcnR5IG9yDQoJCS8vIHZpYSBnZXRBdHRyaWJ1dGUoKT8NCgkJdmFsdWUgPSBub2RlW3Byb3BOYW1lXTsNCgkJaWYoZm9yY2VQcm9wICYmIHR5cGVvZiB2YWx1ZSAhPSAidW5kZWZpbmVkIil7DQoJCQkvLyBub2RlJ3MgcHJvcGVydHkNCgkJCXJldHVybiB2YWx1ZTsJLy8gQW55dGhpbmcNCgkJfQ0KCQlpZihwcm9wTmFtZSAhPSAiaHJlZiIgJiYgKHR5cGVvZiB2YWx1ZSA9PSAiYm9vbGVhbiIgfHwgZC5pc0Z1bmN0aW9uKHZhbHVlKSkpew0KCQkJLy8gbm9kZSdzIHByb3BlcnR5DQoJCQlyZXR1cm4gdmFsdWU7CS8vIEFueXRoaW5nDQoJCX0NCgkJLy8gbm9kZSdzIGF0dHJpYnV0ZQ0KCQkvLyB3ZSBuZWVkIF9oYXNBdHRyKCkgaGVyZSB0byBndWFyZCBhZ2FpbnN0IElFIHJldHVybmluZyBhIGRlZmF1bHQgdmFsdWUNCgkJcmV0dXJuIF9oYXNBdHRyKG5vZGUsIGF0dHJOYW1lKSA/IG5vZGUuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSA6IG51bGw7IC8vIEFueXRoaW5nDQoJfQ0KDQoJZG9qby5yZW1vdmVBdHRyID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovIG5vZGUsIC8qU3RyaW5nKi8gbmFtZSl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZW1vdmVzIGFuIGF0dHJpYnV0ZSBmcm9tIGFuIEhUTUwgZWxlbWVudC4NCgkJLy8Jbm9kZToNCgkJLy8JCWlkIG9yIHJlZmVyZW5jZSB0byB0aGUgZWxlbWVudCB0byByZW1vdmUgdGhlIGF0dHJpYnV0ZSBmcm9tDQoJCS8vCW5hbWU6DQoJCS8vCQl0aGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIHJlbW92ZQ0KCQlieUlkKG5vZGUpLnJlbW92ZUF0dHJpYnV0ZShfZml4QXR0ck5hbWUobmFtZSkpOw0KCX0NCg0KCWRvam8uZ2V0Tm9kZVByb3AgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi8gbm9kZSwgLypTdHJpbmcqLyBuYW1lKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gZWZmZWN0aXZlIHZhbHVlIG9mIGEgcHJvcGVydHkgb3IgYW4gYXR0cmlidXRlLg0KCQkvLwlub2RlOg0KCQkvLwkJaWQgb3IgcmVmZXJlbmNlIHRvIHRoZSBlbGVtZW50IHRvIHJlbW92ZSB0aGUgYXR0cmlidXRlIGZyb20NCgkJLy8JbmFtZToNCgkJLy8JCXRoZSBuYW1lIG9mIHRoZSBhdHRyaWJ1dGUNCgkJbm9kZSA9IGJ5SWQobm9kZSk7DQoJCXZhciBsYyA9IG5hbWUudG9Mb3dlckNhc2UoKSwNCgkJCXByb3BOYW1lID0gX3Byb3BOYW1lc1tsY10gfHwgbmFtZTsNCgkJaWYoKHByb3BOYW1lIGluIG5vZGUpICYmIHByb3BOYW1lICE9ICJocmVmIil7DQoJCQkvLyBub2RlJ3MgcHJvcGVydHkNCgkJCXJldHVybiBub2RlW3Byb3BOYW1lXTsJLy8gQW55dGhpbmcNCgkJfQ0KCQkvLyBub2RlJ3MgYXR0cmlidXRlDQoJCXZhciBhdHRyTmFtZSA9IF9hdHRyTmFtZXNbbGNdIHx8IG5hbWU7DQoJCXJldHVybiBfaGFzQXR0cihub2RlLCBhdHRyTmFtZSkgPyBub2RlLmdldEF0dHJpYnV0ZShhdHRyTmFtZSkgOiBudWxsOyAvLyBBbnl0aGluZw0KCX0NCg0KCWRvam8uY3JlYXRlID0gZnVuY3Rpb24odGFnLCBhdHRycywgcmVmTm9kZSwgcG9zKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCUNyZWF0ZSBhbiBlbGVtZW50LCBhbGxvd2luZyBmb3Igb3B0aW9uYWwgYXR0cmlidXRlIGRlY29yYXRpb24NCgkJLy8JCWFuZCBwbGFjZW1lbnQuDQoJCS8vDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLwkJQSBET00gRWxlbWVudCBjcmVhdGlvbiBmdW5jdGlvbi4gQSBzaG9ydGhhbmQgbWV0aG9kIGZvciBjcmVhdGluZyBhIG5vZGUgb3INCgkJLy8JCWEgZnJhZ21lbnQsIGFuZCBhbGxvd2luZyBmb3IgYSBjb252ZW5pZW50IG9wdGlvbmFsIGF0dHJpYnV0ZSBzZXR0aW5nIHN0ZXAsDQoJCS8vCQlhcyB3ZWxsIGFzIGFuIG9wdGlvbmFsIERPTSBwbGFjZW1lbnQgcmVmZXJlbmNlLg0KCQkvL3wNCgkJLy8JCUF0dHJpYnV0ZXMgYXJlIHNldCBieSBwYXNzaW5nIHRoZSBvcHRpb25hbCBvYmplY3QgdGhyb3VnaCBgZG9qby5hdHRyYC4NCgkJLy8JCVNlZSBgZG9qby5hdHRyYCBmb3Igbm90ZWQgY2F2ZWF0cyBhbmQgbnVhbmNlcywgYW5kIEFQSSBpZiBhcHBsaWNhYmxlLg0KCQkvL3wNCgkJLy8JCVBsYWNlbWVudCBpcyBkb25lIHZpYSBgZG9qby5wbGFjZWAsIGFzc3VtaW5nIHRoZSBuZXcgbm9kZSB0byBiZSB0aGUgYWN0aW9uIA0KCQkvLwkJbm9kZSwgcGFzc2luZyBhbG9uZyB0aGUgb3B0aW9uYWwgcmVmZXJlbmNlIG5vZGUgYW5kIHBvc2l0aW9uLg0KCQkvLw0KCQkvLyB0YWc6IFN0cmluZ3xEb21Ob2RlDQoJCS8vCQlBIHN0cmluZyBvZiB0aGUgZWxlbWVudCB0byBjcmVhdGUgKGVnOiAiZGl2IiwgImEiLCAicCIsICJsaSIsICJzY3JpcHQiLCAiYnIiKSwNCgkJLy8JCW9yIGFuIGV4aXN0aW5nIERPTSBub2RlIHRvIHByb2Nlc3MuDQoJCS8vDQoJCS8vIGF0dHJzOiBPYmplY3QNCgkJLy8JCUFuIG9iamVjdC1oYXNoIG9mIGF0dHJpYnV0ZXMgdG8gc2V0IG9uIHRoZSBuZXdseSBjcmVhdGVkIG5vZGUuDQoJCS8vCQlDYW4gYmUgbnVsbCwgaWYgeW91IGRvbid0IHdhbnQgdG8gc2V0IGFueSBhdHRyaWJ1dGVzL3N0eWxlcy4NCgkJLy8JCVNlZTogYGRvam8uYXR0cmAgZm9yIGEgZGVzY3JpcHRpb24gb2YgYXZhaWxhYmxlIGF0dHJpYnV0ZXMuDQoJCS8vDQoJCS8vIHJlZk5vZGU6IFN0cmluZz98RG9tTm9kZT8NCgkJLy8JCU9wdGlvbmFsIHJlZmVyZW5jZSBub2RlLiBVc2VkIGJ5IGBkb2pvLnBsYWNlYCB0byBwbGFjZSB0aGUgbmV3bHkgY3JlYXRlZA0KCQkvLwkJbm9kZSBzb21ld2hlcmUgaW4gdGhlIGRvbSByZWxhdGl2ZSB0byByZWZOb2RlLiBDYW4gYmUgYSBEb21Ob2RlIHJlZmVyZW5jZQ0KCQkvLwkJb3IgU3RyaW5nIElEIG9mIGEgbm9kZS4NCgkJLy8NCgkJLy8gcG9zOiBTdHJpbmc/DQoJCS8vCQlPcHRpb25hbCBwb3NpdGlvbmFsIHJlZmVyZW5jZS4gRGVmYXVsdHMgdG8gImxhc3QiIGJ5IHdheSBvZiBgZG9qby5wbGFjZWAsDQoJCS8vCQl0aG91Z2ggY2FuIGJlIHNldCB0byAiZmlyc3QiLCJhZnRlciIsImJlZm9yZSIsImxhc3QiLCAicmVwbGFjZSIgb3IgIm9ubHkiDQoJCS8vCQl0byBmdXJ0aGVyIGNvbnRyb2wgdGhlIHBsYWNlbWVudCBvZiB0aGUgbmV3IG5vZGUgcmVsYXRpdmUgdG8gdGhlIHJlZk5vZGUuDQoJCS8vCQkncmVmTm9kZScgaXMgcmVxdWlyZWQgaWYgYSAncG9zJyBpcyBzcGVjaWZpZWQuDQoJCS8vDQoJCS8vIHJldHVybnM6IERvbU5vZGUNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQ3JlYXRlIGEgRElWOg0KCQkvLwl8CXZhciBuID0gZG9qby5jcmVhdGUoImRpdiIpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlDcmVhdGUgYSBESVYgd2l0aCBjb250ZW50Og0KCQkvLwl8CXZhciBuID0gZG9qby5jcmVhdGUoImRpdiIsIHsgaW5uZXJIVE1MOiI8cD5oaTwvcD4iIH0pOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlQbGFjZSBhIG5ldyBESVYgaW4gdGhlIEJPRFksIHdpdGggbm8gYXR0cmlidXRlcyBzZXQNCgkJLy8JfAl2YXIgbiA9IGRvam8uY3JlYXRlKCJkaXYiLCBudWxsLCBkb2pvLmJvZHkoKSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUNyZWF0ZSBhbiBVTCwgYW5kIHBvcHVsYXRlIGl0IHdpdGggTEkncy4gUGxhY2UgdGhlIGxpc3QgYXMgdGhlIGZpcnN0LWNoaWxkIG9mIGEgDQoJCS8vCW5vZGUgd2l0aCBpZD0ic29tZUlkIjoNCgkJLy8JfAl2YXIgdWwgPSBkb2pvLmNyZWF0ZSgidWwiLCBudWxsLCAic29tZUlkIiwgImZpcnN0Iik7DQoJCS8vCXwJdmFyIGl0ZW1zID0gWyJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiXTsNCgkJLy8JfAlkb2pvLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKGRhdGEpew0KCQkvLwl8CQlkb2pvLmNyZWF0ZSgibGkiLCB7IGlubmVySFRNTDogZGF0YSB9LCB1bCk7DQoJCS8vCXwJfSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUNyZWF0ZSBhbiBhbmNob3IsIHdpdGggYW4gaHJlZi4gUGxhY2UgaW4gQk9EWToNCgkJLy8JfAlkb2pvLmNyZWF0ZSgiYSIsIHsgaHJlZjoiZm9vLmh0bWwiLCB0aXRsZToiR290byBGT08hIiB9LCBkb2pvLmJvZHkoKSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUNyZWF0ZSBhIGBkb2pvLk5vZGVMaXN0KClgIGZyb20gYSBuZXcgZWxlbWVudCAoZm9yIHN5bnRhdGljIHN1Z2FyKToNCgkJLy8JfAlkb2pvLnF1ZXJ5KGRvam8uY3JlYXRlKCdkaXYnKSkNCgkJLy8JfAkJLmFkZENsYXNzKCJuZXdEaXYiKQ0KCQkvLwl8CQkub25jbGljayhmdW5jdGlvbihlKXsgY29uc29sZS5sb2coJ2NsaWNrZWQnLCBlLnRhcmdldCkgfSkNCgkJLy8JfAkJLnBsYWNlKCIjc29tZU5vZGUiKTsgLy8gcmVkdW5kYW50LCBidXQgY2xlYW5lci4NCg0KCQl2YXIgZG9jID0gZC5kb2M7DQoJCWlmKHJlZk5vZGUpew0KCQkJcmVmTm9kZSA9IGJ5SWQocmVmTm9kZSk7DQoJCQlkb2MgPSByZWZOb2RlLm93bmVyRG9jdW1lbnQ7DQoJCX0NCgkJaWYodHlwZW9mIHRhZyA9PSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCXRhZyA9IGRvYy5jcmVhdGVFbGVtZW50KHRhZyk7DQoJCX0NCgkJaWYoYXR0cnMpeyBkLmF0dHIodGFnLCBhdHRycyk7IH0NCgkJaWYocmVmTm9kZSl7IGQucGxhY2UodGFnLCByZWZOb2RlLCBwb3MpOyB9DQoJCXJldHVybiB0YWc7IC8vIERvbU5vZGUNCgl9DQoNCgkvKj09PT09DQoJZG9qby5lbXB0eSA9IGZ1bmN0aW9uKG5vZGUpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlzYWZlbHkgcmVtb3ZlcyBhbGwgY2hpbGRyZW4gb2YgdGhlIG5vZGUuDQoJCQkvLwlub2RlOiBET01Ob2RlfFN0cmluZw0KCQkJLy8JCWEgcmVmZXJlbmNlIHRvIGEgRE9NIG5vZGUgb3IgYW4gaWQuDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JRGVzdHJveSBub2RlJ3MgY2hpbGRyZW4gYnlJZDoNCgkJCS8vCXwJZG9qby5lbXB0eSgic29tZUlkIik7DQoJCQkvLw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCURlc3Ryb3kgYWxsIG5vZGVzJyBjaGlsZHJlbiBpbiBhIGxpc3QgYnkgcmVmZXJlbmNlOg0KCQkJLy8JfAlkb2pvLnF1ZXJ5KCIuc29tZU5vZGUiKS5mb3JFYWNoKGRvam8uZW1wdHkpOw0KCX0NCgk9PT09PSovDQoNCglkLmVtcHR5ID0NCgkJCQlkLmlzSUUgPyAgZnVuY3Rpb24obm9kZSl7DQoJCQlub2RlID0gYnlJZChub2RlKTsNCgkJCWZvcih2YXIgYzsgYyA9IG5vZGUubGFzdENoaWxkOyl7IC8vIGludGVudGlvbmFsIGFzc2lnbm1lbnQNCgkJCQlkLmRlc3Ryb3koYyk7DQoJCQl9DQoJCX0gOg0KCQkJCWZ1bmN0aW9uKG5vZGUpew0KCQkJYnlJZChub2RlKS5pbm5lckhUTUwgPSAiIjsNCgkJfTsNCg0KCS8qPT09PT0NCglkb2pvLl90b0RvbSA9IGZ1bmN0aW9uKGZyYWcsIGRvYyl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWluc3RhbnRpYXRlcyBhbiBIVE1MIGZyYWdtZW50IHJldHVybmluZyB0aGUgY29ycmVzcG9uZGluZyBET00uDQoJCQkvLwlmcmFnOiBTdHJpbmcNCgkJCS8vCQl0aGUgSFRNTCBmcmFnbWVudA0KCQkJLy8JZG9jOiBEb2N1bWVudE5vZGU/DQoJCQkvLwkJb3B0aW9uYWwgZG9jdW1lbnQgdG8gdXNlIHdoZW4gY3JlYXRpbmcgRE9NIG5vZGVzLCBkZWZhdWx0cyB0bw0KCQkJLy8JCWRvam8uZG9jIGlmIG5vdCBzcGVjaWZpZWQuDQoJCQkvLwlyZXR1cm5zOiBEb2N1bWVudEZyYWdtZW50DQoJCQkvLw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCUNyZWF0ZSBhIHRhYmxlIHJvdzoNCgkJCS8vCXwJdmFyIHRyID0gZG9qby5fdG9Eb20oIjx0cj48dGQ+Rmlyc3QhPC90ZD48L3RyPiIpOw0KCX0NCgk9PT09PSovDQoNCgkvLyBzdXBwb3J0IHN0dWZmIGZvciBkb2pvLl90b0RvbQ0KCXZhciB0YWdXcmFwID0gew0KCQkJb3B0aW9uOiBbInNlbGVjdCJdLA0KCQkJdGJvZHk6IFsidGFibGUiXSwNCgkJCXRoZWFkOiBbInRhYmxlIl0sDQoJCQl0Zm9vdDogWyJ0YWJsZSJdLA0KCQkJdHI6IFsidGFibGUiLCAidGJvZHkiXSwNCgkJCXRkOiBbInRhYmxlIiwgInRib2R5IiwgInRyIl0sDQoJCQl0aDogWyJ0YWJsZSIsICJ0aGVhZCIsICJ0ciJdLA0KCQkJbGVnZW5kOiBbImZpZWxkc2V0Il0sDQoJCQljYXB0aW9uOiBbInRhYmxlIl0sDQoJCQljb2xncm91cDogWyJ0YWJsZSJdLA0KCQkJY29sOiBbInRhYmxlIiwgImNvbGdyb3VwIl0sDQoJCQlsaTogWyJ1bCJdDQoJCX0sDQoJCXJlVGFnID0gLzxccyooW1x3XDpdKykvLA0KCQltYXN0ZXJOb2RlID0ge30sIG1hc3Rlck51bSA9IDAsDQoJCW1hc3Rlck5hbWUgPSAiX18iICsgZC5fc2NvcGVOYW1lICsgIlRvRG9tSWQiOw0KDQoJLy8gZ2VuZXJhdGUgc3RhcnQvZW5kIHRhZyBzdHJpbmdzIHRvIHVzZQ0KCS8vIGZvciB0aGUgaW5qZWN0aW9uIGZvciBlYWNoIHNwZWNpYWwgdGFnIHdyYXAgY2FzZS4NCglmb3IodmFyIHBhcmFtIGluIHRhZ1dyYXApew0KCQl2YXIgdHcgPSB0YWdXcmFwW3BhcmFtXTsNCgkJdHcucHJlICA9IHBhcmFtID09ICJvcHRpb24iID8gJzxzZWxlY3QgbXVsdGlwbGU9Im11bHRpcGxlIj4nIDogIjwiICsgdHcuam9pbigiPjwiKSArICI+IjsNCgkJdHcucG9zdCA9ICI8LyIgKyB0dy5yZXZlcnNlKCkuam9pbigiPjwvIikgKyAiPiI7DQoJCS8vIHRoZSBsYXN0IGxpbmUgaXMgZGVzdHJ1Y3RpdmU6IGl0IHJldmVyc2VzIHRoZSBhcnJheSwNCgkJLy8gYnV0IHdlIGRvbid0IGNhcmUgYXQgdGhpcyBwb2ludA0KCX0NCg0KCWQuX3RvRG9tID0gZnVuY3Rpb24oZnJhZywgZG9jKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8gCQljb252ZXJ0cyBIVE1MIHN0cmluZyBpbnRvIERPTSBub2Rlcy4NCg0KCQlkb2MgPSBkb2MgfHwgZC5kb2M7DQoJCXZhciBtYXN0ZXJJZCA9IGRvY1ttYXN0ZXJOYW1lXTsNCgkJaWYoIW1hc3RlcklkKXsNCgkJCWRvY1ttYXN0ZXJOYW1lXSA9IG1hc3RlcklkID0gKyttYXN0ZXJOdW0gKyAiIjsNCgkJCW1hc3Rlck5vZGVbbWFzdGVySWRdID0gZG9jLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQl9DQoNCgkJLy8gbWFrZSBzdXJlIHRoZSBmcmFnIGlzIGEgc3RyaW5nLg0KCQlmcmFnICs9ICIiOw0KDQoJCS8vIGZpbmQgdGhlIHN0YXJ0aW5nIHRhZywgYW5kIGdldCBub2RlIHdyYXBwZXINCgkJdmFyIG1hdGNoID0gZnJhZy5tYXRjaChyZVRhZyksDQoJCQl0YWcgPSBtYXRjaCA/IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgOiAiIiwNCgkJCW1hc3RlciA9IG1hc3Rlck5vZGVbbWFzdGVySWRdLA0KCQkJd3JhcCwgaSwgZmMsIGRmOw0KCQlpZihtYXRjaCAmJiB0YWdXcmFwW3RhZ10pew0KCQkJd3JhcCA9IHRhZ1dyYXBbdGFnXTsNCgkJCW1hc3Rlci5pbm5lckhUTUwgPSB3cmFwLnByZSArIGZyYWcgKyB3cmFwLnBvc3Q7DQoJCQlmb3IoaSA9IHdyYXAubGVuZ3RoOyBpOyAtLWkpew0KCQkJCW1hc3RlciA9IG1hc3Rlci5maXJzdENoaWxkOw0KCQkJfQ0KCQl9ZWxzZXsNCgkJCW1hc3Rlci5pbm5lckhUTUwgPSBmcmFnOw0KCQl9DQoNCgkJLy8gb25lIG5vZGUgc2hvcnRjdXQgPT4gcmV0dXJuIHRoZSBub2RlIGl0c2VsZg0KCQlpZihtYXN0ZXIuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSl7DQoJCQlyZXR1cm4gbWFzdGVyLnJlbW92ZUNoaWxkKG1hc3Rlci5maXJzdENoaWxkKTsgLy8gRE9NTm9kZQ0KCQl9DQoNCgkJLy8gcmV0dXJuIG11bHRpcGxlIG5vZGVzIGFzIGEgZG9jdW1lbnQgZnJhZ21lbnQNCgkJZGYgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KCQl3aGlsZShmYyA9IG1hc3Rlci5maXJzdENoaWxkKXsgLy8gaW50ZW50aW9uYWwgYXNzaWdubWVudA0KCQkJZGYuYXBwZW5kQ2hpbGQoZmMpOw0KCQl9DQoJCXJldHVybiBkZjsgLy8gRE9NTm9kZQ0KCX0NCg0KCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoJLy8gKENTUykgQ2xhc3MgRnVuY3Rpb25zDQoJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCgl2YXIgX2NsYXNzTmFtZSA9ICJjbGFzc05hbWUiOw0KDQoJZG9qby5oYXNDbGFzcyA9IGZ1bmN0aW9uKC8qRG9tTm9kZXxTdHJpbmcqL25vZGUsIC8qU3RyaW5nKi9jbGFzc1N0cil7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgY2xhc3NlcyBhcmUgYSBwb3J0aW9uIG9mIHRoZQ0KCQkvLwkJY2xhc3MgbGlzdCBjdXJyZW50bHkgYXBwbGllZCB0byB0aGUgbm9kZS4NCgkJLy8NCgkJLy8Jbm9kZToNCgkJLy8JCVN0cmluZyBJRCBvciBEb21Ob2RlIHJlZmVyZW5jZSB0byBjaGVjayB0aGUgY2xhc3MgZm9yLg0KCQkvLw0KCQkvLwljbGFzc1N0cjoNCgkJLy8JCUEgc3RyaW5nIGNsYXNzIG5hbWUgdG8gbG9vayBmb3IuDQoJCS8vDQoJCS8vCWV4YW1wbGU6DQoJCS8vCURvIHNvbWV0aGluZyBpZiBhIG5vZGUgd2l0aCBpZD0ic29tZU5vZGUiIGhhcyBjbGFzcz0iYVNpbGx5Q2xhc3NOYW1lIiBwcmVzZW50DQoJCS8vCXwJaWYoZG9qby5oYXNDbGFzcygic29tZU5vZGUiLCJhU2lsbHlDbGFzc05hbWUiKSl7IC4uLiB9DQoNCgkJcmV0dXJuICgoIiAiKyBieUlkKG5vZGUpW19jbGFzc05hbWVdICsiICIpLmluZGV4T2YoIiAiICsgY2xhc3NTdHIgKyAiICIpID49IDApOyAgLy8gQm9vbGVhbg0KCX07DQoNCgl2YXIgc3BhY2VzID0gL1xzKy8sIGExID0gWyIiXSwNCgkJc3RyMmFycmF5ID0gZnVuY3Rpb24ocyl7DQoJCQlpZih0eXBlb2YgcyA9PSAic3RyaW5nIiB8fCBzIGluc3RhbmNlb2YgU3RyaW5nKXsNCgkJCQlpZihzLmluZGV4T2YoIiAiKSA8IDApew0KCQkJCQlhMVswXSA9IHM7DQoJCQkJCXJldHVybiBhMTsNCgkJCQl9ZWxzZXsNCgkJCQkJcmV0dXJuIHMuc3BsaXQoc3BhY2VzKTsNCgkJCQl9DQoJCQl9DQoJCQkvLyBhc3N1bWVkIHRvIGJlIGFuIGFycmF5DQoJCQlyZXR1cm4gcyB8fCAiIjsNCgkJfTsNCg0KCWRvam8uYWRkQ2xhc3MgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKlN0cmluZ3xBcnJheSovY2xhc3NTdHIpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQWRkcyB0aGUgc3BlY2lmaWVkIGNsYXNzZXMgdG8gdGhlIGVuZCBvZiB0aGUgY2xhc3MgbGlzdCBvbiB0aGUNCgkJLy8JCXBhc3NlZCBub2RlLiBXaWxsIG5vdCByZS1hcHBseSBkdXBsaWNhdGUgY2xhc3Nlcy4NCgkJLy8NCgkJLy8Jbm9kZToNCgkJLy8JCVN0cmluZyBJRCBvciBEb21Ob2RlIHJlZmVyZW5jZSB0byBhZGQgYSBjbGFzcyBzdHJpbmcgdG9vDQoJCS8vDQoJCS8vCWNsYXNzU3RyOg0KCQkvLwkJQSBTdHJpbmcgY2xhc3MgbmFtZSB0byBhZGQsIG9yIHNldmVyYWwgc3BhY2Utc2VwYXJhdGVkIGNsYXNzIG5hbWVzLA0KCQkvLwkJb3IgYW4gYXJyYXkgb2YgY2xhc3MgbmFtZXMuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUFkZCBhIGNsYXNzIHRvIHNvbWUgbm9kZToNCgkJLy8JfAlkb2pvLmFkZENsYXNzKCJzb21lTm9kZSIsICJhbmV3Q2xhc3MiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQWRkIHR3byBjbGFzc2VzIGF0IG9uY2U6DQoJCS8vCXwJZG9qby5hZGRDbGFzcygic29tZU5vZGUiLCAiZmlyc3RDbGFzcyBzZWNvbmRDbGFzcyIpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlBZGQgdHdvIGNsYXNzZXMgYXQgb25jZSAodXNpbmcgYXJyYXkpOg0KCQkvLwl8CWRvam8uYWRkQ2xhc3MoInNvbWVOb2RlIiwgWyJmaXJzdENsYXNzIiwgInNlY29uZENsYXNzIl0pOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlBdmFpbGFibGUgaW4gYGRvam8uTm9kZUxpc3RgIGZvciBtdWx0aXBsZSBhZGRpdGlvbnMNCgkJLy8JfAlkb2pvLnF1ZXJ5KCJ1bCA+IGxpIikuYWRkQ2xhc3MoImZpcnN0TGV2ZWwiKTsNCg0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJY2xhc3NTdHIgPSBzdHIyYXJyYXkoY2xhc3NTdHIpOw0KCQl2YXIgY2xzID0gbm9kZVtfY2xhc3NOYW1lXSwgb2xkTGVuOw0KCQljbHMgPSBjbHMgPyAiICIgKyBjbHMgKyAiICIgOiAiICI7DQoJCW9sZExlbiA9IGNscy5sZW5ndGg7DQoJCWZvcih2YXIgaSA9IDAsIGxlbiA9IGNsYXNzU3RyLmxlbmd0aCwgYzsgaSA8IGxlbjsgKytpKXsNCgkJCWMgPSBjbGFzc1N0cltpXTsNCgkJCWlmKGMgJiYgY2xzLmluZGV4T2YoIiAiICsgYyArICIgIikgPCAwKXsNCgkJCQljbHMgKz0gYyArICIgIjsNCgkJCX0NCgkJfQ0KCQlpZihvbGRMZW4gPCBjbHMubGVuZ3RoKXsNCgkJCW5vZGVbX2NsYXNzTmFtZV0gPSBjbHMuc3Vic3RyKDEsIGNscy5sZW5ndGggLSAyKTsNCgkJfQ0KCX07DQoNCglkb2pvLnJlbW92ZUNsYXNzID0gZnVuY3Rpb24oLypEb21Ob2RlfFN0cmluZyovbm9kZSwgLypTdHJpbmd8QXJyYXk/Ki9jbGFzc1N0cil7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY2xhc3NlcyBmcm9tIG5vZGUuIE5vIGBkb2pvLmhhc0NsYXNzYA0KCQkvLwkJY2hlY2sgaXMgcmVxdWlyZWQuDQoJCS8vDQoJCS8vIG5vZGU6DQoJCS8vIAkJU3RyaW5nIElEIG9yIERvbU5vZGUgcmVmZXJlbmNlIHRvIHJlbW92ZSB0aGUgY2xhc3MgZnJvbS4NCgkJLy8NCgkJLy8gY2xhc3NTdHI6DQoJCS8vCQlBbiBvcHRpb25hbCBTdHJpbmcgY2xhc3MgbmFtZSB0byByZW1vdmUsIG9yIHNldmVyYWwgc3BhY2Utc2VwYXJhdGVkDQoJCS8vCQljbGFzcyBuYW1lcywgb3IgYW4gYXJyYXkgb2YgY2xhc3MgbmFtZXMuIElmIG9taXR0ZWQsIGFsbCBjbGFzcyBuYW1lcw0KCQkvLwkJd2lsbCBiZSBkZWxldGVkLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZW1vdmUgYSBjbGFzcyBmcm9tIHNvbWUgbm9kZToNCgkJLy8JfAlkb2pvLnJlbW92ZUNsYXNzKCJzb21lTm9kZSIsICJmaXJzdENsYXNzIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCVJlbW92ZSB0d28gY2xhc3NlcyBmcm9tIHNvbWUgbm9kZToNCgkJLy8JfAlkb2pvLnJlbW92ZUNsYXNzKCJzb21lTm9kZSIsICJmaXJzdENsYXNzIHNlY29uZENsYXNzIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCVJlbW92ZSB0d28gY2xhc3NlcyBmcm9tIHNvbWUgbm9kZSAodXNpbmcgYXJyYXkpOg0KCQkvLwl8CWRvam8ucmVtb3ZlQ2xhc3MoInNvbWVOb2RlIiwgWyJmaXJzdENsYXNzIiwgInNlY29uZENsYXNzIl0pOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwlSZW1vdmUgYWxsIGNsYXNzZXMgZnJvbSBzb21lIG5vZGU6DQoJCS8vCXwJZG9qby5yZW1vdmVDbGFzcygic29tZU5vZGUiKTsNCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JQXZhaWxhYmxlIGluIGBkb2pvLk5vZGVMaXN0KClgIGZvciBtdWx0aXBsZSByZW1vdmFsDQoJCS8vCXwJZG9qby5xdWVyeSgiLmZvbyIpLnJlbW92ZUNsYXNzKCJmb28iKTsNCg0KCQlub2RlID0gYnlJZChub2RlKTsNCgkJdmFyIGNsczsNCgkJaWYoY2xhc3NTdHIgIT09IHVuZGVmaW5lZCl7DQoJCQljbGFzc1N0ciA9IHN0cjJhcnJheShjbGFzc1N0cik7DQoJCQljbHMgPSAiICIgKyBub2RlW19jbGFzc05hbWVdICsgIiAiOw0KCQkJZm9yKHZhciBpID0gMCwgbGVuID0gY2xhc3NTdHIubGVuZ3RoOyBpIDwgbGVuOyArK2kpew0KCQkJCWNscyA9IGNscy5yZXBsYWNlKCIgIiArIGNsYXNzU3RyW2ldICsgIiAiLCAiICIpOw0KCQkJfQ0KCQkJY2xzID0gZC50cmltKGNscyk7DQoJCX1lbHNlew0KCQkJY2xzID0gIiI7DQoJCX0NCgkJaWYobm9kZVtfY2xhc3NOYW1lXSAhPSBjbHMpeyBub2RlW19jbGFzc05hbWVdID0gY2xzOyB9DQoJfTsNCg0KCWRvam8udG9nZ2xlQ2xhc3MgPSBmdW5jdGlvbigvKkRvbU5vZGV8U3RyaW5nKi9ub2RlLCAvKlN0cmluZ3xBcnJheSovY2xhc3NTdHIsIC8qQm9vbGVhbj8qL2NvbmRpdGlvbil7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlBZGRzIGEgY2xhc3MgdG8gbm9kZSBpZiBub3QgcHJlc2VudCwgb3IgcmVtb3ZlcyBpZiBwcmVzZW50Lg0KCQkvLwkJUGFzcyBhIGJvb2xlYW4gY29uZGl0aW9uIGlmIHlvdSB3YW50IHRvIGV4cGxpY2l0bHkgYWRkIG9yIHJlbW92ZS4NCgkJLy8JY29uZGl0aW9uOg0KCQkvLwkJSWYgcGFzc2VkLCB0cnVlIG1lYW5zIHRvIGFkZCB0aGUgY2xhc3MsIGZhbHNlIG1lYW5zIHRvIHJlbW92ZS4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JfAlkb2pvLnRvZ2dsZUNsYXNzKCJzb21lTm9kZSIsICJob3ZlcmVkIik7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUZvcmNlZnVsbHkgYWRkIGEgY2xhc3MNCgkJLy8JfAlkb2pvLnRvZ2dsZUNsYXNzKCJzb21lTm9kZSIsICJob3ZlcmVkIiwgdHJ1ZSk7DQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCUF2YWlsYWJsZSBpbiBgZG9qby5Ob2RlTGlzdCgpYCBmb3IgbXVsdGlwbGUgdG9nZ2xlcw0KCQkvLwl8CWRvam8ucXVlcnkoIi50b2dnbGVNZSIpLnRvZ2dsZUNsYXNzKCJ0b2dnbGVNZSIpOw0KDQoJCWlmKGNvbmRpdGlvbiA9PT0gdW5kZWZpbmVkKXsNCgkJCWNvbmRpdGlvbiA9ICFkLmhhc0NsYXNzKG5vZGUsIGNsYXNzU3RyKTsNCgkJfQ0KCQlkW2NvbmRpdGlvbiA/ICJhZGRDbGFzcyIgOiAicmVtb3ZlQ2xhc3MiXShub2RlLCBjbGFzc1N0cik7DQoJfTsNCg0KfSkoKTsNCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuTm9kZUxpc3QiXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuTm9kZUxpc3QiXSA9IHRydWU7DQpkb2pvLnByb3ZpZGUoImRvam8uX2Jhc2UuTm9kZUxpc3QiKTsNCg0KDQoNCihmdW5jdGlvbigpew0KDQoJdmFyIGQgPSBkb2pvOw0KDQoJdmFyIGFwID0gQXJyYXkucHJvdG90eXBlLCBhcHMgPSBhcC5zbGljZSwgYXBjID0gYXAuY29uY2F0Ow0KDQoJdmFyIHRubCA9IGZ1bmN0aW9uKC8qQXJyYXkqLyBhLCAvKmRvam8uTm9kZUxpc3Q/Ki8gcGFyZW50LCAvKkZ1bmN0aW9uPyovIE5vZGVMaXN0Q3Rvcil7DQoJCS8vIHN1bW1hcnk6DQoJCS8vIAkJZGVjb3JhdGUgYW4gYXJyYXkgdG8gbWFrZSBpdCBsb29rIGxpa2UgYSBgZG9qby5Ob2RlTGlzdGAuDQoJCS8vIGE6DQoJCS8vIAkJQXJyYXkgb2Ygbm9kZXMgdG8gZGVjb3JhdGUuDQoJCS8vIHBhcmVudDoNCgkJLy8gCQlBbiBvcHRpb25hbCBwYXJlbnQgTm9kZUxpc3QgdGhhdCBnZW5lcmF0ZWQgdGhlIGN1cnJlbnQNCgkJLy8gCQlsaXN0IG9mIG5vZGVzLiBVc2VkIHRvIGNhbGwgX3N0YXNoKCkgc28gdGhlIHBhcmVudCBOb2RlTGlzdA0KCQkvLyAJCWNhbiBiZSBhY2Nlc3NlZCB2aWEgZW5kKCkgbGF0ZXIuDQoJCS8vIE5vZGVMaXN0Q3RvcjoNCgkJLy8gCQlBbiBvcHRpb25hbCBjb25zdHJ1Y3RvciBmdW5jdGlvbiB0byB1c2UgZm9yIGFueQ0KCQkvLyAJCW5ldyBOb2RlTGlzdCBjYWxscy4gVGhpcyBhbGxvd3MgYSBjZXJ0YWluIGNoYWluIG9mDQoJCS8vIAkJTm9kZUxpc3QgY2FsbHMgdG8gdXNlIGEgZGlmZmVyZW50IG9iamVjdCB0aGFuIGRvam8uTm9kZUxpc3QuDQoJCWlmKCFhLnNvcnQpew0KCQkJLy8gbWFrZSBzdXJlIGl0J3MgYSByZWFsIGFycmF5IGJlZm9yZSB3ZSBwYXNzIGl0IG9uIHRvIGJlIHdyYXBwZWQNCgkJCWEgPSBhcHMuY2FsbChhLCAwKTsNCgkJfQ0KCQl2YXIgY3RvciA9IE5vZGVMaXN0Q3RvciB8fCB0aGlzLl9Ob2RlTGlzdEN0b3IgfHwgZC5fTm9kZUxpc3RDdG9yOw0KCQlhLmNvbnN0cnVjdG9yID0gY3RvcjsNCgkJZG9qby5fbWl4aW4oYSwgY3Rvci5wcm90b3R5cGUpOw0KCQlhLl9Ob2RlTGlzdEN0b3IgPSBjdG9yOw0KCQlyZXR1cm4gcGFyZW50ID8gYS5fc3Rhc2gocGFyZW50KSA6IGE7DQoJfTsNCg0KCXZhciBsb29wQm9keSA9IGZ1bmN0aW9uKGYsIGEsIG8pew0KCQlhID0gWzBdLmNvbmNhdChhcHMuY2FsbChhLCAwKSk7DQoJCW8gPSBvIHx8IGQuZ2xvYmFsOw0KCQlyZXR1cm4gZnVuY3Rpb24obm9kZSl7DQoJCQlhWzBdID0gbm9kZTsNCgkJCXJldHVybiBmLmFwcGx5KG8sIGEpOw0KCQl9Ow0KCX07DQoNCgkvLyBhZGFwdGVycw0KDQoJdmFyIGFkYXB0QXNGb3JFYWNoID0gZnVuY3Rpb24oZiwgbyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlhZGFwdHMgYSBzaW5nbGUgbm9kZSBmdW5jdGlvbiB0byBiZSB1c2VkIGluIHRoZSBmb3JFYWNoLXR5cGUNCgkJLy8JCWFjdGlvbnMuIFRoZSBpbml0aWFsIG9iamVjdCBpcyByZXR1cm5lZCBmcm9tIHRoZSBzcGVjaWFsaXplZA0KCQkvLwkJZnVuY3Rpb24uDQoJCS8vCWY6IEZ1bmN0aW9uDQoJCS8vCQlhIGZ1bmN0aW9uIHRvIGFkYXB0DQoJCS8vCW86IE9iamVjdD8NCgkJLy8JCWFuIG9wdGlvbmFsIGNvbnRleHQgZm9yIGYNCgkJcmV0dXJuIGZ1bmN0aW9uKCl7DQoJCQl0aGlzLmZvckVhY2gobG9vcEJvZHkoZiwgYXJndW1lbnRzLCBvKSk7DQoJCQlyZXR1cm4gdGhpczsJLy8gT2JqZWN0DQoJCX07DQoJfTsNCg0KCXZhciBhZGFwdEFzTWFwID0gZnVuY3Rpb24oZiwgbyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlhZGFwdHMgYSBzaW5nbGUgbm9kZSBmdW5jdGlvbiB0byBiZSB1c2VkIGluIHRoZSBtYXAtdHlwZQ0KCQkvLwkJYWN0aW9ucy4gVGhlIHJldHVybiBpcyBhIG5ldyBhcnJheSBvZiB2YWx1ZXMsIGFzIHZpYSBgZG9qby5tYXBgDQoJCS8vCWY6IEZ1bmN0aW9uDQoJCS8vCQlhIGZ1bmN0aW9uIHRvIGFkYXB0DQoJCS8vCW86IE9iamVjdD8NCgkJLy8JCWFuIG9wdGlvbmFsIGNvbnRleHQgZm9yIGYNCgkJcmV0dXJuIGZ1bmN0aW9uKCl7DQoJCQlyZXR1cm4gdGhpcy5tYXAobG9vcEJvZHkoZiwgYXJndW1lbnRzLCBvKSk7DQoJCX07DQoJfTsNCg0KCXZhciBhZGFwdEFzRmlsdGVyID0gZnVuY3Rpb24oZiwgbyl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlhZGFwdHMgYSBzaW5nbGUgbm9kZSBmdW5jdGlvbiB0byBiZSB1c2VkIGluIHRoZSBmaWx0ZXItdHlwZSBhY3Rpb25zDQoJCS8vCWY6IEZ1bmN0aW9uDQoJCS8vCQlhIGZ1bmN0aW9uIHRvIGFkYXB0DQoJCS8vCW86IE9iamVjdD8NCgkJLy8JCWFuIG9wdGlvbmFsIGNvbnRleHQgZm9yIGYNCgkJcmV0dXJuIGZ1bmN0aW9uKCl7DQoJCQlyZXR1cm4gdGhpcy5maWx0ZXIobG9vcEJvZHkoZiwgYXJndW1lbnRzLCBvKSk7DQoJCX07DQoJfTsNCg0KCXZhciBhZGFwdFdpdGhDb25kaXRpb24gPSBmdW5jdGlvbihmLCBnLCBvKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWFkYXB0cyBhIHNpbmdsZSBub2RlIGZ1bmN0aW9uIHRvIGJlIHVzZWQgaW4gdGhlIG1hcC10eXBlDQoJCS8vCQlhY3Rpb25zLCBiZWhhdmVzIGxpa2UgZm9yRWFjaCgpIG9yIG1hcCgpIGRlcGVuZGluZyBvbiBhcmd1bWVudHMNCgkJLy8JZjogRnVuY3Rpb24NCgkJLy8JCWEgZnVuY3Rpb24gdG8gYWRhcHQNCgkJLy8JZzogRnVuY3Rpb24NCgkJLy8JCWEgY29uZGl0aW9uIGZ1bmN0aW9uLCBpZiB0cnVlIHJ1bnMgYXMgbWFwKCksIG90aGVyd2lzZSBydW5zIGFzIGZvckVhY2goKQ0KCQkvLwlvOiBPYmplY3Q/DQoJCS8vCQlhbiBvcHRpb25hbCBjb250ZXh0IGZvciBmIGFuZCBnDQoJCXJldHVybiBmdW5jdGlvbigpew0KCQkJdmFyIGEgPSBhcmd1bWVudHMsIGJvZHkgPSBsb29wQm9keShmLCBhLCBvKTsNCgkJCWlmKGcuY2FsbChvIHx8IGQuZ2xvYmFsLCBhKSl7DQoJCQkJcmV0dXJuIHRoaXMubWFwKGJvZHkpOwkvLyBzZWxmDQoJCQl9DQoJCQl0aGlzLmZvckVhY2goYm9keSk7DQoJCQlyZXR1cm4gdGhpczsJLy8gc2VsZg0KCQl9Ow0KCX07DQoNCgl2YXIgbWFnaWNHdWFyZCA9IGZ1bmN0aW9uKGEpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJdGhlIGd1YXJkIGZ1bmN0aW9uIGZvciBkb2pvLmF0dHIoKSBhbmQgZG9qby5zdHlsZSgpDQoJCXJldHVybiBhLmxlbmd0aCA9PSAxICYmICh0eXBlb2YgYVswXSA9PSAic3RyaW5nIik7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgl9Ow0KDQoJdmFyIG9ycGhhbiA9IGZ1bmN0aW9uKG5vZGUpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJZnVuY3Rpb24gdG8gb3JwaGFuIG5vZGVzDQoJCXZhciBwID0gbm9kZS5wYXJlbnROb2RlOw0KCQlpZihwKXsNCgkJCXAucmVtb3ZlQ2hpbGQobm9kZSk7DQoJCX0NCgl9Ow0KCS8vIEZJWE1FOiBzaG91bGQgd2UgbW92ZSBvcnBoYW4oKSB0byBkb2pvLmh0bWw/DQoNCglkb2pvLk5vZGVMaXN0ID0gZnVuY3Rpb24oKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWRvam8uTm9kZUxpc3QgaXMgYW4gb2YgQXJyYXkgc3ViY2xhc3Mgd2hpY2ggYWRkcyBzeW50YWN0aWMNCgkJLy8JCXN1Z2FyIGZvciBjaGFpbmluZywgY29tbW9uIGl0ZXJhdGlvbiBvcGVyYXRpb25zLCBhbmltYXRpb24sIGFuZA0KCQkvLwkJbm9kZSBtYW5pcHVsYXRpb24uIE5vZGVMaXN0cyBhcmUgbW9zdCBvZnRlbiByZXR1cm5lZCBhcyB0aGUNCgkJLy8JCXJlc3VsdCBvZiBkb2pvLnF1ZXJ5KCkgY2FsbHMuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJZG9qby5Ob2RlTGlzdCBpbnN0YW5jZXMgcHJvdmlkZSBtYW55IHV0aWxpdGllcyB0aGF0IHJlZmxlY3QNCgkJLy8JCWNvcmUgRG9qbyBBUElzIGZvciBBcnJheSBpdGVyYXRpb24gYW5kIG1hbmlwdWxhdGlvbiwgRE9NDQoJCS8vCQltYW5pcHVsYXRpb24sIGFuZCBldmVudCBoYW5kbGluZy4gSW5zdGVhZCBvZiBuZWVkaW5nIHRvIGRpZyB1cA0KCQkvLwkJZnVuY3Rpb25zIGluIHRoZSBkb2pvLiogbmFtZXNwYWNlLCBOb2RlTGlzdHMgZ2VuZXJhbGx5IG1ha2UgdGhlDQoJCS8vCQlmdWxsIHBvd2VyIG9mIERvam8gYXZhaWxhYmxlIGZvciBET00gbWFuaXB1bGF0aW9uIHRhc2tzIGluIGENCgkJLy8JCXNpbXBsZSwgY2hhaW5hYmxlIHdheS4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCWNyZWF0ZSBhIG5vZGUgbGlzdCBmcm9tIGEgbm9kZQ0KCQkvLwkJfAluZXcgZG9qby5Ob2RlTGlzdChkb2pvLmJ5SWQoImZvbyIpKTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCWdldCBhIE5vZGVMaXN0IGZyb20gYSBDU1MgcXVlcnkgYW5kIGl0ZXJhdGUgb24gaXQNCgkJLy8JCXwJdmFyIGwgPSBkb2pvLnF1ZXJ5KCIudGhpbmdlciIpOw0KCQkvLwkJfAlsLmZvckVhY2goZnVuY3Rpb24obm9kZSwgaW5kZXgsIG5vZGVMaXN0KXsNCgkJLy8JCXwJCWNvbnNvbGUubG9nKGluZGV4LCBub2RlLmlubmVySFRNTCk7DQoJCS8vCQl8CX0pOw0KCQkvLwlleGFtcGxlOg0KCQkvLwkJdXNlIG5hdGl2ZSBhbmQgRG9qby1wcm92aWRlZCBhcnJheSBtZXRob2RzIHRvIG1hbmlwdWxhdGUgYQ0KCQkvLwkJTm9kZUxpc3Qgd2l0aG91dCBuZWVkaW5nIHRvIHVzZSBkb2pvLiogZnVuY3Rpb25zIGV4cGxpY2l0bHk6DQoJCS8vCQl8CXZhciBsID0gZG9qby5xdWVyeSgiLnRoaW5nZXIiKTsNCgkJLy8JCXwJLy8gc2luY2UgTm9kZUxpc3RzIGFyZSByZWFsIGFycmF5cywgdGhleSBoYXZlIGEgbGVuZ3RoDQoJCS8vCQl8CS8vIHByb3BlcnR5IHRoYXQgaXMgYm90aCByZWFkYWJsZSBhbmQgd3JpdGFibGUgYW5kDQoJCS8vCQl8CS8vIHB1c2gvcG9wL3NoaWZ0L3Vuc2hpZnQgbWV0aG9kcw0KCQkvLwkJfAljb25zb2xlLmxvZyhsLmxlbmd0aCk7DQoJCS8vCQl8CWwucHVzaChkb2pvLmNyZWF0ZSgic3BhbiIpKTsNCgkJLy8JCXwNCgkJLy8JCXwJLy8gZG9qbydzIG5vcm1hbGl6ZWQgYXJyYXkgbWV0aG9kcyB3b3JrIHRvbzoNCgkJLy8JCXwJY29uc29sZS5sb2coIGwuaW5kZXhPZihkb2pvLmJ5SWQoImZvbyIpKSApOw0KCQkvLwkJfAkvLyAuLi5pbmNsdWRpbmcgdGhlIHNwZWNpYWwgImZ1bmN0aW9uIGFzIHN0cmluZyIgc2hvcnRoYW5kDQoJCS8vCQl8CWNvbnNvbGUubG9nKCBsLmV2ZXJ5KCJpdGVtLm5vZGVUeXBlID09IDEiKSApOw0KCQkvLwkJfA0KCQkvLwkJfAkvLyBOb2RlTGlzdHMgY2FuIGJlIFsuLl0gaW5kZXhlZCwgb3IgeW91IGNhbiB1c2UgdGhlIGF0KCkNCgkJLy8JCXwJLy8gZnVuY3Rpb24gdG8gZ2V0IHNwZWNpZmljIGl0ZW1zIHdyYXBwZWQgaW4gYSBuZXcgTm9kZUxpc3Q6DQoJCS8vCQl8CXZhciBub2RlID0gbFszXTsgLy8gdGhlIDR0aCBlbGVtZW50DQoJCS8vCQl8CXZhciBuZXdMaXN0ID0gbC5hdCgxLCAzKTsgLy8gdGhlIDJuZCBhbmQgNHRoIGVsZW1lbnRzDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQl0aGUgc3R5bGUgZnVuY3Rpb25zIHlvdSBleHBlY3QgYXJlIGFsbCB0aGVyZSB0b286DQoJCS8vCQl8CS8vIHN0eWxlKCkgYXMgYSBnZXR0ZXIuLi4NCgkJLy8JCXwJdmFyIGJvcmRlcnMgPSBkb2pvLnF1ZXJ5KCIudGhpbmdlciIpLnN0eWxlKCJib3JkZXIiKTsNCgkJLy8JCXwJLy8gLi4uYW5kIGFzIGEgc2V0dGVyOg0KCQkvLwkJfAlkb2pvLnF1ZXJ5KCIudGhpbmdlciIpLnN0eWxlKCJib3JkZXIiLCAiMXB4IHNvbGlkIGJsYWNrIik7DQoJCS8vCQl8CS8vIGNsYXNzIG1hbmlwdWxhdGlvbg0KCQkvLwkJfAlkb2pvLnF1ZXJ5KCJsaTpudGgtY2hpbGQoZXZlbikiKS5hZGRDbGFzcygiZXZlbiIpOw0KCQkvLwkJfAkvLyBldmVuIGdldHRpbmcgdGhlIGNvb3JkaW5hdGVzIG9mIGFsbCB0aGUgaXRlbXMNCgkJLy8JCXwJdmFyIGNvb3JkcyA9IGRvam8ucXVlcnkoIi50aGluZ2VyIikuY29vcmRzKCk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlET00gbWFuaXB1bGF0aW9uIGZ1bmN0aW9ucyBmcm9tIHRoZSBkb2pvLiogbmFtZXNwYWNlIGFyZWEgYWxzbw0KCQkvLwkJYXZhaWxhYmxlOg0KCQkvLwkJfAkvLyByZW1vdmUgYWxsIG9mIHRoZSBlbGVtZW50cyBpbiB0aGUgbGlzdCBmcm9tIHRoZWlyDQoJCS8vCQl8CS8vIHBhcmVudHMgKGFraW4gdG8gImRlbGV0aW5nIiB0aGVtIGZyb20gdGhlIGRvY3VtZW50KQ0KCQkvLwkJfAlkb2pvLnF1ZXJ5KCIudGhpbmdlciIpLm9ycGhhbigpOw0KCQkvLwkJfAkvLyBwbGFjZSBhbGwgZWxlbWVudHMgaW4gdGhlIGxpc3QgYXQgdGhlIGZyb250IG9mICNmb28NCgkJLy8JCXwJZG9qby5xdWVyeSgiLnRoaW5nZXIiKS5wbGFjZSgiZm9vIiwgImZpcnN0Iik7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlFdmVudCBoYW5kbGluZyBjb3VsZG4ndCBiZSBlYXNpZXIuIGBkb2pvLmNvbm5lY3RgIGlzIG1hcHBlZCBpbiwNCgkJLy8JCWFuZCBzaG9ydGN1dCBoYW5kbGVycyBhcmUgcHJvdmlkZWQgZm9yIG1vc3QgRE9NIGV2ZW50czoNCgkJLy8JCXwJLy8gbGlrZSBkb2pvLmNvbm5lY3QoKSwgYnV0IHdpdGggaW1wbGljaXQgc2NvcGUNCgkJLy8JCXwJZG9qby5xdWVyeSgibGkiKS5jb25uZWN0KCJvbmNsaWNrIiwgY29uc29sZSwgImxvZyIpOw0KCQkvLwkJfA0KCQkvLwkJfAkvLyBtYW55IGNvbW1vbiBldmVudCBoYW5kbGVycyBhcmUgYWxyZWFkeSBhdmFpbGFibGUgZGlyZWN0bHk6DQoJCS8vCQl8CWRvam8ucXVlcnkoImxpIikub25jbGljayhjb25zb2xlLCAibG9nIik7DQoJCS8vCQl8CXZhciB0b2dnbGVIb3ZlcmVkID0gZG9qby5oaXRjaChkb2pvLCAidG9nZ2xlQ2xhc3MiLCAiaG92ZXJlZCIpOw0KCQkvLwkJfAlkb2pvLnF1ZXJ5KCJwIikNCgkJLy8JCXwJCS5vbm1vdXNlZW50ZXIodG9nZ2xlSG92ZXJlZCkNCgkJLy8JCXwJCS5vbm1vdXNlbGVhdmUodG9nZ2xlSG92ZXJlZCk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQljaGFpbmFiaWxpdHkgaXMgYSBrZXkgYWR2YW50YWdlIG9mIE5vZGVMaXN0czoNCgkJLy8JCXwJZG9qby5xdWVyeSgiLnRoaW5nZXIiKQ0KCQkvLwkJfAkJLm9uY2xpY2soZnVuY3Rpb24oZSl7IC8qIC4uLiAqLyB9KQ0KCQkvLwkJfAkJLmF0KDEsIDMsIDgpIC8vIGdldCBhIHN1YnNldA0KCQkvLwkJfAkJCS5zdHlsZSgicGFkZGluZyIsICI1cHgiKQ0KCQkvLwkJfAkJCS5mb3JFYWNoKGNvbnNvbGUubG9nKTsNCg0KCQlyZXR1cm4gdG5sKEFycmF5LmFwcGx5KG51bGwsIGFyZ3VtZW50cykpOw0KCX07DQoNCgkvL0FsbG93IHRoaW5ncyB0aGF0IG5ldyB1cCBhIE5vZGVMaXN0IHRvIHVzZSBhIGRlbGVnYXRlZCBvciBhbHRlcm5hdGUgTm9kZUxpc3QgaW1wbGVtZW50YXRpb24uDQoJZC5fTm9kZUxpc3RDdG9yID0gZC5Ob2RlTGlzdDsNCg0KCXZhciBubCA9IGQuTm9kZUxpc3QsIG5scCA9IG5sLnByb3RvdHlwZTsNCg0KCS8vIGV4cG9zZSBhZGFwdGVycyBhbmQgdGhlIHdyYXBwZXIgYXMgcHJpdmF0ZSBmdW5jdGlvbnMNCg0KCW5sLl93cmFwID0gbmxwLl93cmFwID0gdG5sOw0KCW5sLl9hZGFwdEFzTWFwID0gYWRhcHRBc01hcDsNCglubC5fYWRhcHRBc0ZvckVhY2ggPSBhZGFwdEFzRm9yRWFjaDsNCglubC5fYWRhcHRBc0ZpbHRlciAgPSBhZGFwdEFzRmlsdGVyOw0KCW5sLl9hZGFwdFdpdGhDb25kaXRpb24gPSBhZGFwdFdpdGhDb25kaXRpb247DQoNCgkvLyBtYXNzIGFzc2lnbm1lbnQNCg0KCS8vIGFkZCBhcnJheSByZWRpcmVjdG9ycw0KCWQuZm9yRWFjaChbInNsaWNlIiwgInNwbGljZSJdLCBmdW5jdGlvbihuYW1lKXsNCgkJdmFyIGYgPSBhcFtuYW1lXTsNCgkJLy9Vc2UgYSBjb3B5IG9mIHRoZSB0aGlzIGFycmF5IHZpYSB0aGlzLnNsaWNlKCkgdG8gYWxsb3cgLmVuZCgpIHRvIHdvcmsgcmlnaHQgaW4gdGhlIHNwbGljZSBjYXNlLg0KCQkvLyBDQU5OT1QgYXBwbHkgLl9zdGFzaCgpL2VuZCgpIHRvIHNwbGljZSBzaW5jZSBpdCBjdXJyZW50bHkgbW9kaWZpZXMNCgkJLy8gdGhlIGV4aXN0aW5nIHRoaXMgYXJyYXkgLS0gaXQgd291bGQgYnJlYWsgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBpZiB3ZSBjb3B5IHRoZSBhcnJheSBiZWZvcmUNCgkJLy8gdGhlIHNwbGljZSBzbyB0aGF0IHdlIGNhbiB1c2UgLmVuZCgpLiBTbyBvbmx5IGRvaW5nIHRoZSBzdGFzaCBvcHRpb24gdG8gdGhpcy5fd3JhcCBmb3Igc2xpY2UuDQoJCW5scFtuYW1lXSA9IGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzLl93cmFwKGYuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgbmFtZSA9PSAic2xpY2UiID8gdGhpcyA6IG51bGwpOyB9Ow0KCX0pOw0KCS8vIGNvbmNhdCBzaG91bGQgYmUgaGVyZSBidXQgc29tZSBicm93c2VycyB3aXRoIG5hdGl2ZSBOb2RlTGlzdCBoYXZlIHByb2JsZW1zIHdpdGggaXQNCg0KCS8vIGFkZCBhcnJheS5qcyByZWRpcmVjdG9ycw0KCWQuZm9yRWFjaChbImluZGV4T2YiLCAibGFzdEluZGV4T2YiLCAiZXZlcnkiLCAic29tZSJdLCBmdW5jdGlvbihuYW1lKXsNCgkJdmFyIGYgPSBkW25hbWVdOw0KCQlubHBbbmFtZV0gPSBmdW5jdGlvbigpeyByZXR1cm4gZi5hcHBseShkLCBbdGhpc10uY29uY2F0KGFwcy5jYWxsKGFyZ3VtZW50cywgMCkpKTsgfTsNCgl9KTsNCg0KCS8vIGFkZCBjb25kaXRpb25hbCBtZXRob2RzDQoJZC5mb3JFYWNoKFsiYXR0ciIsICJzdHlsZSJdLCBmdW5jdGlvbihuYW1lKXsNCgkJbmxwW25hbWVdID0gYWRhcHRXaXRoQ29uZGl0aW9uKGRbbmFtZV0sIG1hZ2ljR3VhcmQpOw0KCX0pOw0KDQoJLy8gYWRkIGZvckVhY2ggYWN0aW9ucw0KCWQuZm9yRWFjaChbImNvbm5lY3QiLCAiYWRkQ2xhc3MiLCAicmVtb3ZlQ2xhc3MiLCAidG9nZ2xlQ2xhc3MiLCAiZW1wdHkiLCAicmVtb3ZlQXR0ciJdLCBmdW5jdGlvbihuYW1lKXsNCgkJbmxwW25hbWVdID0gYWRhcHRBc0ZvckVhY2goZFtuYW1lXSk7DQoJfSk7DQoNCglkb2pvLmV4dGVuZChkb2pvLk5vZGVMaXN0LCB7DQoJCV9ub3JtYWxpemU6IGZ1bmN0aW9uKC8qU3RyaW5nfHxFbGVtZW50fHxPYmplY3R8fE5vZGVMaXN0Ki9jb250ZW50LCAvKkRPTU5vZGU/Ki9yZWZOb2RlKXsNCgkJCS8vIHN1bW1hcnk6DQoJCQkvLyAJCW5vcm1hbGl6ZXMgZGF0YSB0byBhbiBhcnJheSBvZiBpdGVtcyB0byBpbnNlcnQuDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vIAkJSWYgY29udGVudCBpcyBhbiBvYmplY3QsIGl0IGNhbiBoYXZlIHNwZWNpYWwgcHJvcGVydGllcyAidGVtcGxhdGUiIGFuZA0KCQkJLy8gCQkicGFyc2UiLiBJZiAidGVtcGxhdGUiIGlzIGRlZmluZWQsIHRoZW4gdGhlIHRlbXBsYXRlIHZhbHVlIGlzIHJ1biB0aHJvdWdoDQoJCQkvLyAJCWRvam8uc3RyaW5nLnN1YnN0aXR1dGUgKGlmIGRvam8uc3RyaW5nLnN1YnN0aXR1dGUgaGFzIGJlZW4gZG9qby5yZXF1aXJlZCBlbHNld2hlcmUpLA0KCQkJLy8gCQlvciBpZiB0ZW1wbGF0ZUZ1bmMgaXMgYSBmdW5jdGlvbiBvbiB0aGUgY29udGVudCwgdGhhdCBmdW5jdGlvbiB3aWxsIGJlIHVzZWQgdG8NCgkJCS8vIAkJdHJhbnNmb3JtIHRoZSB0ZW1wbGF0ZSBpbnRvIGEgZmluYWwgc3RyaW5nIHRvIGJlIHVzZWQgZm9yIGZvciBwYXNzaW5nIHRvIGRvam8uX3RvRG9tLg0KCQkJLy8gCQlJZiBjb250ZW50LnBhcnNlIGlzIHRydWUsIHRoZW4gaXQgaXMgcmVtZW1iZXJlZCBmb3IgbGF0ZXIsIGZvciB3aGVuIHRoZSBjb250ZW50DQoJCQkvLyAJCW5vZGVzIGFyZSBpbnNlcnRlZCBpbnRvIHRoZSBET00uIEF0IHRoYXQgcG9pbnQsIHRoZSBub2RlcyB3aWxsIGJlIHBhcnNlZCBmb3Igd2lkZ2V0cw0KCQkJLy8gCQkoaWYgZG9qby5wYXJzZXIgaGFzIGJlZW4gZG9qby5yZXF1aXJlZCBlbHNld2hlcmUpLg0KDQoJCQkvL1dhbnRlZCB0byBqdXN0IHVzZSBhIERvY3VtZW50RnJhZ21lbnQsIGJ1dCBmb3IgdGhlIGFycmF5L05vZGVMaXN0DQoJCQkvL2Nhc2UgdGhhdCBtZWFudCAgdXNpbmcgY2xvbmVOb2RlLCBidXQgd2UgbWF5IG5vdCB3YW50IHRoYXQuDQoJCQkvL0Nsb25pbmcgc2hvdWxkIG9ubHkgaGFwcGVuIGlmIHRoZSBub2RlIG9wZXJhdGlvbnMgc3Bhbg0KCQkJLy9tdWx0aXBsZSByZWZOb2Rlcy4gQWxzbywgbmVlZCBhIHJlYWwgYXJyYXksIG5vdCBhIE5vZGVMaXN0IGZyb20gdGhlDQoJCQkvL0RPTSBzaW5jZSB0aGUgbm9kZSBtb3ZlbWVudHMgY291bGQgY2hhbmdlIHRob3NlIE5vZGVMaXN0cy4NCg0KCQkJdmFyIHBhcnNlID0gY29udGVudC5wYXJzZSA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTsNCg0KCQkJLy9EbyB3ZSBoYXZlIGFuIG9iamVjdCB0aGF0IG5lZWRzIHRvIGJlIHJ1biB0aHJvdWdoIGEgdGVtcGxhdGU/DQoJCQlpZih0eXBlb2YgY29udGVudC50ZW1wbGF0ZSA9PSAic3RyaW5nIil7DQoJCQkJdmFyIHRlbXBsYXRlRnVuYyA9IGNvbnRlbnQudGVtcGxhdGVGdW5jIHx8IChkb2pvLnN0cmluZyAmJiBkb2pvLnN0cmluZy5zdWJzdGl0dXRlKTsNCgkJCQljb250ZW50ID0gdGVtcGxhdGVGdW5jID8gdGVtcGxhdGVGdW5jKGNvbnRlbnQudGVtcGxhdGUsIGNvbnRlbnQpIDogY29udGVudDsNCgkJCX0NCg0KCQkJdmFyIHR5cGUgPSAodHlwZW9mIGNvbnRlbnQpOw0KCQkJaWYodHlwZSA9PSAic3RyaW5nIiB8fCB0eXBlID09ICJudW1iZXIiKXsNCgkJCQljb250ZW50ID0gZG9qby5fdG9Eb20oY29udGVudCwgKHJlZk5vZGUgJiYgcmVmTm9kZS5vd25lckRvY3VtZW50KSk7DQoJCQkJaWYoY29udGVudC5ub2RlVHlwZSA9PSAxMSl7DQoJCQkJCS8vRG9jdW1lbnRGcmFnbWVudC4gSXQgY2Fubm90IGhhbmRsZSBjbG9uZU5vZGUgY2FsbHMsIHNvIHB1bGwgb3V0IHRoZSBjaGlsZHJlbi4NCgkJCQkJY29udGVudCA9IGRvam8uX3RvQXJyYXkoY29udGVudC5jaGlsZE5vZGVzKTsNCgkJCQl9ZWxzZXsNCgkJCQkJY29udGVudCA9IFtjb250ZW50XTsNCgkJCQl9DQoJCQl9ZWxzZSBpZighZG9qby5pc0FycmF5TGlrZShjb250ZW50KSl7DQoJCQkJY29udGVudCA9IFtjb250ZW50XTsNCgkJCX1lbHNlIGlmKCFkb2pvLmlzQXJyYXkoY29udGVudCkpew0KCQkJCS8vVG8gZ2V0IHRvIHRoaXMgcG9pbnQsIGNvbnRlbnQgaXMgYXJyYXktbGlrZSwgYnV0DQoJCQkJLy9ub3QgYW4gYXJyYXksIHdoaWNoIGxpa2VseSBtZWFucyBhIERPTSBOb2RlTGlzdC4gQ29udmVydCBpdCBub3cuDQoJCQkJY29udGVudCA9IGRvam8uX3RvQXJyYXkoY29udGVudCk7DQoJCQl9DQoNCgkJCS8vUGFzcyBhcm91bmQgdGhlIHBhcnNlIGluZm8NCgkJCWlmKHBhcnNlKXsNCgkJCQljb250ZW50Ll9ydW5QYXJzZSA9IHRydWU7DQoJCQl9DQoJCQlyZXR1cm4gY29udGVudDsgLy9BcnJheQ0KCQl9LA0KDQoJCV9jbG9uZU5vZGU6IGZ1bmN0aW9uKC8qRE9NTm9kZSovIG5vZGUpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vIAkJcHJpdmF0ZSB1dGlsdGl0eSB0byBjbG9uZSBhIG5vZGUuIE5vdCB2ZXJ5IGludGVyZXN0aW5nIGluIHRoZSB2YW5pbGxhDQoJCQkvLyAJCWRvam8uTm9kZUxpc3QgY2FzZSwgYnV0IGRlbGVnYXRlcyBjb3VsZCBkbyBpbnRlcmVzdGluZyB0aGluZ3MgbGlrZQ0KCQkJLy8gCQljbG9uZSBldmVudCBoYW5kbGVycyBpZiB0aGF0IGlzIGRlcml2YWJsZSBmcm9tIHRoZSBub2RlLg0KCQkJcmV0dXJuIG5vZGUuY2xvbmVOb2RlKHRydWUpOw0KCQl9LA0KDQoJCV9wbGFjZTogZnVuY3Rpb24oLypBcnJheSovYXJ5LCAvKkRPTU5vZGUqL3JlZk5vZGUsIC8qU3RyaW5nKi9wb3NpdGlvbiwgLypCb29sZWFuKi91c2VDbG9uZSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8gCQlwcml2YXRlIHV0aWxpdHkgdG8gaGFuZGxlIHBsYWNpbmcgYW4gYXJyYXkgb2Ygbm9kZXMgcmVsYXRpdmUgdG8gYW5vdGhlciBub2RlLg0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLyAJCUFsbG93cyBmb3IgY2xvbmluZyB0aGUgbm9kZXMgaW4gdGhlIGFycmF5LCBhbmQgZm9yDQoJCQkvLyAJCW9wdGlvbmFsbHkgcGFyc2luZyB3aWRnZXRzLCBpZiBhcnkuX3J1blBhcnNlIGlzIHRydWUuDQoNCgkJCS8vQXZvaWQgYSBkaXNhbGxvd2VkIG9wZXJhdGlvbiBpZiB0cnlpbmcgdG8gZG8gYW4gaW5uZXJIVE1MIG9uIGEgbm9uLWVsZW1lbnQgbm9kZS4NCgkJCWlmKHJlZk5vZGUubm9kZVR5cGUgIT0gMSAmJiBwb3NpdGlvbiA9PSAib25seSIpew0KCQkJCXJldHVybjsNCgkJCX0NCgkJCXZhciByTm9kZSA9IHJlZk5vZGUsIHRlbXBOb2RlOw0KDQoJCQkvL0Fsd2F5cyBjeWNsZSBiYWNrd2FyZHMgaW4gY2FzZSB0aGUgYXJyYXkgaXMgcmVhbGx5IGENCgkJCS8vRE9NIE5vZGVMaXN0IGFuZCB0aGUgRE9NIG9wZXJhdGlvbnMgdGFrZSBpdCBvdXQgb2YgdGhlIGxpdmUgY29sbGVjdGlvbi4NCgkJCXZhciBsZW5ndGggPSBhcnkubGVuZ3RoOw0KCQkJZm9yKHZhciBpID0gbGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pew0KCQkJCXZhciBub2RlID0gKHVzZUNsb25lID8gdGhpcy5fY2xvbmVOb2RlKGFyeVtpXSkgOiBhcnlbaV0pOw0KDQoJCQkJLy9JZiBuZWVkIHdpZGdldCBwYXJzaW5nLCB1c2UgYSB0ZW1wIG5vZGUsIGluc3RlYWQgb2Ygd2FpdGluZyBhZnRlciBpbnNlcnRpbmcgaW50bw0KCQkJCS8vcmVhbCBET00gYmVjYXVzZSB3ZSBuZWVkIHRvIHN0YXJ0IHdpZGdldCBwYXJzaW5nIGF0IG9uZSBub2RlIHVwIGZyb20gY3VycmVudCBub2RlLA0KCQkJCS8vd2hpY2ggY291bGQgY2F1c2Ugc29tZSBhbHJlYWR5IHBhcnNlZCB3aWRnZXRzIHRvIGJlIHBhcnNlZCBhZ2Fpbi4NCgkJCQlpZihhcnkuX3J1blBhcnNlICYmIGRvam8ucGFyc2VyICYmIGRvam8ucGFyc2VyLnBhcnNlKXsNCgkJCQkJaWYoIXRlbXBOb2RlKXsNCgkJCQkJCXRlbXBOb2RlID0gck5vZGUub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJCQkJfQ0KCQkJCQl0ZW1wTm9kZS5hcHBlbmRDaGlsZChub2RlKTsNCgkJCQkJZG9qby5wYXJzZXIucGFyc2UodGVtcE5vZGUpOw0KCQkJCQlub2RlID0gdGVtcE5vZGUuZmlyc3RDaGlsZDsNCgkJCQkJd2hpbGUodGVtcE5vZGUuZmlyc3RDaGlsZCl7DQoJCQkJCQl0ZW1wTm9kZS5yZW1vdmVDaGlsZCh0ZW1wTm9kZS5maXJzdENoaWxkKTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCWlmKGkgPT0gbGVuZ3RoIC0gMSl7DQoJCQkJCWRvam8ucGxhY2Uobm9kZSwgck5vZGUsIHBvc2l0aW9uKTsNCgkJCQl9ZWxzZXsNCgkJCQkJck5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgck5vZGUpOw0KCQkJCX0NCgkJCQlyTm9kZSA9IG5vZGU7DQoJCQl9DQoJCX0sDQoNCgkJX3N0YXNoOiBmdW5jdGlvbihwYXJlbnQpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vIAkJcHJpdmF0ZSBmdW5jdGlvbiB0byBob2xkIHRvIGEgcGFyZW50IE5vZGVMaXN0LiBlbmQoKSB0byByZXR1cm4gdGhlIHBhcmVudCBOb2RlTGlzdC4NCgkJCS8vDQoJCQkvLyBleGFtcGxlOg0KCQkJLy8gSG93IHRvIG1ha2UgYSBgZG9qby5Ob2RlTGlzdGAgbWV0aG9kIHRoYXQgb25seSByZXR1cm5zIHRoZSB0aGlyZCBub2RlIGluDQoJCQkvLyB0aGUgZG9qby5Ob2RlTGlzdCBidXQgYWxsb3dzIGFjY2VzcyB0byB0aGUgb3JpZ2luYWwgTm9kZUxpc3QgYnkgdXNpbmcgdGhpcy5fc3Rhc2g6DQoJCQkvLwl8CWRvam8uZXh0ZW5kKGRvam8uTm9kZUxpc3QsIHsNCgkJCS8vCXwJCXRoaXJkOiBmdW5jdGlvbigpew0KCQkJLy8gIHwJCQl2YXIgbmV3Tm9kZUxpc3QgPSBkb2pvLk5vZGVMaXN0KHRoaXNbMl0pOw0KCQkJLy8JfAkJCXJldHVybiBuZXdOb2RlTGlzdC5fc3Rhc2godGhpcyk7DQoJCQkvLwl8CQl9DQoJCQkvLwl8CX0pOw0KCQkJLy8JfAkvLyB0aGVuIHNlZSBob3cgX3N0YXNoIGFwcGxpZXMgYSBzdWItbGlzdCwgdG8gYmUgLmVuZCgpJ2VkIG91dCBvZg0KCQkJLy8JfAlkb2pvLnF1ZXJ5KCIuZm9vIikNCgkJCS8vCXwJCS50aGlyZCgpDQoJCQkvLwl8CQkJLmFkZENsYXNzKCJ0aGlyZEZvbyIpDQoJCQkvLwl8CQkuZW5kKCkNCgkJCS8vCXwJCS8vIGFjY2VzcyB0byB0aGUgb3JpZyAuZm9vIGxpc3QNCgkJCS8vCXwJCS5yZW1vdmVDbGFzcygiZm9vIikNCgkJCS8vCXwNCgkJCS8vDQoJCQl0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7DQoJCQlyZXR1cm4gdGhpczsgLy9kb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJZW5kOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vIAkJRW5kcyB1c2Ugb2YgdGhlIGN1cnJlbnQgYGRvam8uTm9kZUxpc3RgIGJ5IHJldHVybmluZyB0aGUgcHJldmlvdXMgZG9qby5Ob2RlTGlzdA0KCQkJLy8gCQl0aGF0IGdlbmVyYXRlZCB0aGUgY3VycmVudCBkb2pvLk5vZGVMaXN0Lg0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLyAJCVJldHVybnMgdGhlIGBkb2pvLk5vZGVMaXN0YCB0aGF0IGdlbmVyYXRlZCB0aGUgY3VycmVudCBgZG9qby5Ob2RlTGlzdGAuIElmIHRoZXJlDQoJCQkvLyAJCWlzIG5vIHBhcmVudCBkb2pvLk5vZGVMaXN0LCBhbiBlbXB0eSBkb2pvLk5vZGVMaXN0IGlzIHJldHVybmVkLg0KCQkJLy8gZXhhbXBsZToNCgkJCS8vCXwJZG9qby5xdWVyeSgiYSIpDQoJCQkvLwl8CQkuZmlsdGVyKCIuZGlzYWJsZWQiKQ0KCQkJLy8JfAkJCS8vIG9wZXJhdGUgb24gdGhlIGFuY2hvcnMgdGhhdCBvbmx5IGhhdmUgYSBkaXNhYmxlZCBjbGFzcw0KCQkJLy8JfAkJCS5zdHlsZSgiY29sb3IiLCAiZ3JleSIpDQoJCQkvLwl8CQkuZW5kKCkNCgkJCS8vCXwJCS8vIGp1bXAgYmFjayB0byB0aGUgbGlzdCBvZiBhbmNob3JzDQoJCQkvLwl8CQkuc3R5bGUoLi4uKQ0KCQkJLy8NCgkJCWlmKHRoaXMuX3BhcmVudCl7DQoJCQkJcmV0dXJuIHRoaXMuX3BhcmVudDsNCgkJCX1lbHNlew0KCQkJCS8vSnVzdCByZXR1cm4gZW1weSBsaXN0Lg0KCQkJCXJldHVybiBuZXcgdGhpcy5fTm9kZUxpc3RDdG9yKCk7DQoJCQl9DQoJCX0sDQoNCgkJLy8gaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlOkdsb2JhbF9PYmplY3RzOkFycmF5I01ldGhvZHMNCg0KCQkvLyBGSVhNRTogaGFuZGxlIHJldHVybiB2YWx1ZXMgZm9yICMzMjQ0DQoJCS8vCQlodHRwOi8vdHJhYy5kb2pvdG9vbGtpdC5vcmcvdGlja2V0LzMyNDQNCg0KCQkvLyBGSVhNRToNCgkJLy8JCW5lZWQgdG8gd3JhcCBvciBpbXBsZW1lbnQ6DQoJCS8vCQkJam9pbiAocGVyaGFwcyB3LyBpbm5lckhUTUwvb3V0ZXJIVE1MIG92ZXJsb2FkIGZvciB0b1N0cmluZygpIG9mIGl0ZW1zPykNCgkJLy8JCQlyZWR1Y2UNCgkJLy8JCQlyZWR1Y2VSaWdodA0KDQoJCS8qPT09PT0NCgkJc2xpY2U6IGZ1bmN0aW9uKGJlZ2luLCBlbmQpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgbmV3IE5vZGVMaXN0LCBtYWludGFpbmluZyB0aGlzIG9uZSBpbiBwbGFjZQ0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBtZXRob2QgYmVoYXZlcyBleGFjdGx5IGxpa2UgdGhlIEFycmF5LnNsaWNlIG1ldGhvZA0KCQkJLy8JCXdpdGggdGhlIGNhdmVhdCB0aGF0IGl0IHJldHVybnMgYSBkb2pvLk5vZGVMaXN0IGFuZCBub3QgYQ0KCQkJLy8JCXJhdyBBcnJheS4gRm9yIG1vcmUgZGV0YWlscywgc2VlIE1vemlsbGEncyAoc2xpY2UNCgkJCS8vCQlkb2N1bWVudGF0aW9uKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6c2xpY2VdDQoJCQkvLyBiZWdpbjogSW50ZWdlcg0KCQkJLy8JCUNhbiBiZSBhIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIGludGVnZXIsIHdpdGggcG9zaXRpdmUNCgkJCS8vCQlpbnRlZ2VycyBub3RpbmcgdGhlIG9mZnNldCB0byBiZWdpbiBhdCwgYW5kIG5lZ2F0aXZlDQoJCQkvLwkJaW50ZWdlcnMgZGVub3RpbmcgYW4gb2Zmc2V0IGZyb20gdGhlIGVuZCAoaS5lLiwgdG8gdGhlIGxlZnQNCgkJCS8vCQlvZiB0aGUgZW5kKQ0KCQkJLy8gZW5kOiBJbnRlZ2VyPw0KCQkJLy8JCU9wdGlvbmFsIHBhcmFtZXRlciB0byBkZXNjcmliZSB3aGF0IHBvc2l0aW9uIHJlbGF0aXZlIHRvDQoJCQkvLwkJdGhlIE5vZGVMaXN0J3MgemVybyBpbmRleCB0byBlbmQgdGhlIHNsaWNlIGF0LiBMaWtlIGJlZ2luLA0KCQkJLy8JCWNhbiBiZSBwb3NpdGl2ZSBvciBuZWdhdGl2ZS4NCgkJCXJldHVybiB0aGlzLl93cmFwKGEuc2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7DQoJCX0sDQoNCgkJc3BsaWNlOiBmdW5jdGlvbihpbmRleCwgaG93bWFueSwgaXRlbSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBuZXcgTm9kZUxpc3QsIG1hbmlwdWxhdGluZyB0aGlzIE5vZGVMaXN0IGJhc2VkIG9uDQoJCQkvLwkJdGhlIGFyZ3VtZW50cyBwYXNzZWQsIHBvdGVudGlhbGx5IHNwbGljaW5nIGluIG5ldyBlbGVtZW50cw0KCQkJLy8JCWF0IGFuIG9mZnNldCwgb3B0aW9uYWxseSBkZWxldGluZyBlbGVtZW50cw0KCQkJLy8gZGVzY3JpcHRpb246DQoJCQkvLwkJVGhpcyBtZXRob2QgYmVoYXZlcyBleGFjdGx5IGxpa2UgdGhlIEFycmF5LnNwbGljZSBtZXRob2QNCgkJCS8vCQl3aXRoIHRoZSBjYXZlYXQgdGhhdCBpdCByZXR1cm5zIGEgZG9qby5Ob2RlTGlzdCBhbmQgbm90IGENCgkJCS8vCQlyYXcgQXJyYXkuIEZvciBtb3JlIGRldGFpbHMsIHNlZSBNb3ppbGxhJ3MgKHNwbGljZQ0KCQkJLy8JCWRvY3VtZW50YXRpb24pW2h0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheTpzcGxpY2VdDQoJCQkvLyAJCUZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSwgY2FsbGluZyAuZW5kKCkgb24gdGhlIHNwbGljZWQgTm9kZUxpc3QNCgkJCS8vIAkJZG9lcyBub3QgcmV0dXJuIHRoZSBvcmlnaW5hbCBOb2RlTGlzdCAtLSBzcGxpY2UgYWx0ZXJzIHRoZSBOb2RlTGlzdCBpbiBwbGFjZS4NCgkJCS8vIGluZGV4OiBJbnRlZ2VyDQoJCQkvLwkJYmVnaW4gY2FuIGJlIGEgcG9zaXRpdmUgb3IgbmVnYXRpdmUgaW50ZWdlciwgd2l0aCBwb3NpdGl2ZQ0KCQkJLy8JCWludGVnZXJzIG5vdGluZyB0aGUgb2Zmc2V0IHRvIGJlZ2luIGF0LCBhbmQgbmVnYXRpdmUNCgkJCS8vCQlpbnRlZ2VycyBkZW5vdGluZyBhbiBvZmZzZXQgZnJvbSB0aGUgZW5kIChpLmUuLCB0byB0aGUgbGVmdA0KCQkJLy8JCW9mIHRoZSBlbmQpDQoJCQkvLyBob3dtYW55OiBJbnRlZ2VyPw0KCQkJLy8JCU9wdGlvbmFsIHBhcmFtZXRlciB0byBkZXNjcmliZSB3aGF0IHBvc2l0aW9uIHJlbGF0aXZlIHRvDQoJCQkvLwkJdGhlIE5vZGVMaXN0J3MgemVybyBpbmRleCB0byBlbmQgdGhlIHNsaWNlIGF0LiBMaWtlIGJlZ2luLA0KCQkJLy8JCWNhbiBiZSBwb3NpdGl2ZSBvciBuZWdhdGl2ZS4NCgkJCS8vIGl0ZW06IE9iamVjdC4uLj8NCgkJCS8vCQlBbnkgbnVtYmVyIG9mIG9wdGlvbmFsIHBhcmFtZXRlcnMgbWF5IGJlIHBhc3NlZCBpbiB0byBiZQ0KCQkJLy8JCXNwbGljZWQgaW50byB0aGUgTm9kZUxpc3QNCgkJCS8vIHJldHVybnM6DQoJCQkvLwkJZG9qby5Ob2RlTGlzdA0KCQkJcmV0dXJuIHRoaXMuX3dyYXAoYS5zcGxpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7DQoJCX0sDQoNCgkJaW5kZXhPZjogZnVuY3Rpb24odmFsdWUsIGZyb21JbmRleCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXNlZSBkb2pvLmluZGV4T2YoKS4gVGhlIHByaW1hcnkgZGlmZmVyZW5jZSBpcyB0aGF0IHRoZSBhY3RlZC1vbiANCgkJCS8vCQlhcnJheSBpcyBpbXBsaWNpdGx5IHRoaXMgTm9kZUxpc3QNCgkJCS8vIHZhbHVlOiBPYmplY3Q6DQoJCQkvLwkJVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuDQoJCQkvLyBmcm9tSW5kZXg6IEludGVnZXI/Og0KCQkJLy8JCVRoZSBsb2N0aW9uIHRvIHN0YXJ0IHNlYXJjaGluZyBmcm9tLiBPcHRpb25hbC4gRGVmYXVsdHMgdG8gMC4NCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCUZvciBtb3JlIGRldGFpbHMgb24gdGhlIGJlaGF2aW9yIG9mIGluZGV4T2YsIHNlZSBNb3ppbGxhJ3MNCgkJCS8vCQkoaW5kZXhPZg0KCQkJLy8JCWRvY3MpW2h0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheTppbmRleE9mXQ0KCQkJLy8JcmV0dXJuczoNCgkJCS8vCQlQb3NpdGl2ZSBJbnRlZ2VyIG9yIDAgZm9yIGEgbWF0Y2gsIC0xIG9mIG5vdCBmb3VuZC4NCgkJCXJldHVybiBkLmluZGV4T2YodGhpcywgdmFsdWUsIGZyb21JbmRleCk7IC8vIEludGVnZXINCgkJfSwNCg0KCQlsYXN0SW5kZXhPZjogZnVuY3Rpb24odmFsdWUsIGZyb21JbmRleCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCXNlZSBkb2pvLmxhc3RJbmRleE9mKCkuIFRoZSBwcmltYXJ5IGRpZmZlcmVuY2UgaXMgdGhhdCB0aGUNCgkJCS8vCQlhY3RlZC1vbiBhcnJheSBpcyBpbXBsaWNpdGx5IHRoaXMgTm9kZUxpc3QNCgkJCS8vCWRlc2NyaXB0aW9uOg0KCQkJLy8JCUZvciBtb3JlIGRldGFpbHMgb24gdGhlIGJlaGF2aW9yIG9mIGxhc3RJbmRleE9mLCBzZWUNCgkJCS8vCQlNb3ppbGxhJ3MgKGxhc3RJbmRleE9mDQoJCQkvLwkJZG9jcylbaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlOkdsb2JhbF9PYmplY3RzOkFycmF5Omxhc3RJbmRleE9mXQ0KCQkJLy8gdmFsdWU6IE9iamVjdA0KCQkJLy8JCVRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLg0KCQkJLy8gZnJvbUluZGV4OiBJbnRlZ2VyPw0KCQkJLy8JCVRoZSBsb2N0aW9uIHRvIHN0YXJ0IHNlYXJjaGluZyBmcm9tLiBPcHRpb25hbC4gRGVmYXVsdHMgdG8gMC4NCgkJCS8vIHJldHVybnM6DQoJCQkvLwkJUG9zaXRpdmUgSW50ZWdlciBvciAwIGZvciBhIG1hdGNoLCAtMSBvZiBub3QgZm91bmQuDQoJCQlyZXR1cm4gZC5sYXN0SW5kZXhPZih0aGlzLCB2YWx1ZSwgZnJvbUluZGV4KTsgLy8gSW50ZWdlcg0KCQl9LA0KDQoJCWV2ZXJ5OiBmdW5jdGlvbihjYWxsYmFjaywgdGhpc09iamVjdCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXNlZSBgZG9qby5ldmVyeSgpYCBhbmQgdGhlIChBcnJheS5ldmVyeQ0KCQkJLy8JCWRvY3MpW2h0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheTpldmVyeV0uDQoJCQkvLwkJVGFrZXMgdGhlIHNhbWUgc3RydWN0dXJlIG9mIGFyZ3VtZW50cyBhbmQgcmV0dXJucyBhcw0KCQkJLy8JCWRvam8uZXZlcnkoKSB3aXRoIHRoZSBjYXZlYXQgdGhhdCB0aGUgcGFzc2VkIGFycmF5IGlzDQoJCQkvLwkJaW1wbGljaXRseSB0aGlzIE5vZGVMaXN0DQoJCQkvLyBjYWxsYmFjazogRnVuY3Rpb246IHRoZSBjYWxsYmFjaw0KCQkJLy8gdGhpc09iamVjdDogT2JqZWN0PzogdGhlIGNvbnRleHQNCgkJCXJldHVybiBkLmV2ZXJ5KHRoaXMsIGNhbGxiYWNrLCB0aGlzT2JqZWN0KTsgLy8gQm9vbGVhbg0KCQl9LA0KDQoJCXNvbWU6IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzT2JqZWN0KXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJVGFrZXMgdGhlIHNhbWUgc3RydWN0dXJlIG9mIGFyZ3VtZW50cyBhbmQgcmV0dXJucyBhcw0KCQkJLy8JCWBkb2pvLnNvbWUoKWAgd2l0aCB0aGUgY2F2ZWF0IHRoYXQgdGhlIHBhc3NlZCBhcnJheSBpcw0KCQkJLy8JCWltcGxpY2l0bHkgdGhpcyBOb2RlTGlzdC4gIFNlZSBgZG9qby5zb21lKClgIGFuZCBNb3ppbGxhJ3MNCgkJCS8vCQkoQXJyYXkuc29tZQ0KCQkJLy8JCWRvY3VtZW50YXRpb24pW2h0dHA6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpHbG9iYWxfT2JqZWN0czpBcnJheTpzb21lXS4NCgkJCS8vIGNhbGxiYWNrOiBGdW5jdGlvbjogdGhlIGNhbGxiYWNrDQoJCQkvLyB0aGlzT2JqZWN0OiBPYmplY3Q/OiB0aGUgY29udGV4dA0KCQkJcmV0dXJuIGQuc29tZSh0aGlzLCBjYWxsYmFjaywgdGhpc09iamVjdCk7IC8vIEJvb2xlYW4NCgkJfSwNCgkJPT09PT0qLw0KDQoJCWNvbmNhdDogZnVuY3Rpb24oaXRlbSl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBuZXcgTm9kZUxpc3QgY29tcHJpc2VkIG9mIGl0ZW1zIGluIHRoaXMgTm9kZUxpc3QNCgkJCS8vCQlhcyB3ZWxsIGFzIGl0ZW1zIHBhc3NlZCBpbiBhcyBwYXJhbWV0ZXJzDQoJCQkvLyBkZXNjcmlwdGlvbjoNCgkJCS8vCQlUaGlzIG1ldGhvZCBiZWhhdmVzIGV4YWN0bHkgbGlrZSB0aGUgQXJyYXkuY29uY2F0IG1ldGhvZA0KCQkJLy8JCXdpdGggdGhlIGNhdmVhdCB0aGF0IGl0IHJldHVybnMgYSBgZG9qby5Ob2RlTGlzdGAgYW5kIG5vdCBhDQoJCQkvLwkJcmF3IEFycmF5LiBGb3IgbW9yZSBkZXRhaWxzLCBzZWUgdGhlIChBcnJheS5jb25jYXQNCgkJCS8vCQlkb2NzKVtodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvQ29yZV9KYXZhU2NyaXB0XzEuNV9SZWZlcmVuY2U6R2xvYmFsX09iamVjdHM6QXJyYXk6Y29uY2F0XQ0KCQkJLy8gaXRlbTogT2JqZWN0Pw0KCQkJLy8JCUFueSBudW1iZXIgb2Ygb3B0aW9uYWwgcGFyYW1ldGVycyBtYXkgYmUgcGFzc2VkIGluIHRvIGJlDQoJCQkvLwkJc3BsaWNlZCBpbnRvIHRoZSBOb2RlTGlzdA0KCQkJLy8gcmV0dXJuczoNCgkJCS8vCQlkb2pvLk5vZGVMaXN0DQoNCgkJCS8vcmV0dXJuIHRoaXMuX3dyYXAoYXBjLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOw0KCQkJLy8gdGhlIGxpbmUgYWJvdmUgd29uJ3Qgd29yayBmb3IgdGhlIG5hdGl2ZSBOb2RlTGlzdCA6LSgNCg0KCQkJLy8gaW1wbGVtZW50YXRpb24gbm90ZXM6DQoJCQkvLyAxKSBOYXRpdmUgTm9kZUxpc3QgaXMgbm90IGFuIGFycmF5LCBhbmQgY2Fubm90IGJlIHVzZWQgZGlyZWN0bHkNCgkJCS8vIGluIGNvbmNhdCgpIC0tLSB0aGUgbGF0dGVyIGRvZXNuJ3QgcmVjb2duaXplIGl0IGFzIGFuIGFycmF5LCBhbmQNCgkJCS8vIGRvZXMgbm90IGlubGluZSBpdCwgYnV0IGFwcGVuZCBhcyBhIHNpbmdsZSBlbnRpdHkuDQoJCQkvLyAyKSBPbiBzb21lIGJyb3dzZXJzIChlLmcuLCBTYWZhcmkpIHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGlzDQoJCQkvLyByZWFkLW9ubHkgYW5kIGNhbm5vdCBiZSBjaGFuZ2VkLiBTbyB3ZSBoYXZlIHRvIHRlc3QgZm9yIGJvdGgNCgkJCS8vIG5hdGl2ZSBOb2RlTGlzdCBhbmQgZG9qby5Ob2RlTGlzdCBpbiB0aGlzIHByb3BlcnR5IHRvIHJlY29nbml6ZQ0KCQkJLy8gdGhlIG5vZGUgbGlzdC4NCg0KCQkJdmFyIHQgPSBkLmlzQXJyYXkodGhpcykgPyB0aGlzIDogYXBzLmNhbGwodGhpcywgMCksDQoJCQkJbSA9IGQubWFwKGFyZ3VtZW50cywgZnVuY3Rpb24oYSl7DQoJCQkJCXJldHVybiBhICYmICFkLmlzQXJyYXkoYSkgJiYNCgkJCQkJCSh0eXBlb2YgTm9kZUxpc3QgIT0gInVuZGVmaW5lZCIgJiYgYS5jb25zdHJ1Y3RvciA9PT0gTm9kZUxpc3QgfHwgYS5jb25zdHJ1Y3RvciA9PT0gdGhpcy5fTm9kZUxpc3RDdG9yKSA/DQoJCQkJCQkJYXBzLmNhbGwoYSwgMCkgOiBhOw0KCQkJCX0pOw0KCQkJcmV0dXJuIHRoaXMuX3dyYXAoYXBjLmFwcGx5KHQsIG0pLCB0aGlzKTsJLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCW1hcDogZnVuY3Rpb24oLypGdW5jdGlvbiovIGZ1bmMsIC8qRnVuY3Rpb24/Ki8gb2JqKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJc2VlIGRvam8ubWFwKCkuIFRoZSBwcmltYXJ5IGRpZmZlcmVuY2UgaXMgdGhhdCB0aGUgYWN0ZWQtb24NCgkJCS8vCQlhcnJheSBpcyBpbXBsaWNpdGx5IHRoaXMgTm9kZUxpc3QgYW5kIHRoZSByZXR1cm4gaXMgYQ0KCQkJLy8JCWRvam8uTm9kZUxpc3QgKGEgc3ViY2xhc3Mgb2YgQXJyYXkpDQoJCQkvLy9yZXR1cm4gZC5tYXAodGhpcywgZnVuYywgb2JqLCBkLk5vZGVMaXN0KTsgLy8gZG9qby5Ob2RlTGlzdA0KCQkJcmV0dXJuIHRoaXMuX3dyYXAoZC5tYXAodGhpcywgZnVuYywgb2JqKSwgdGhpcyk7IC8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlmb3JFYWNoOiBmdW5jdGlvbihjYWxsYmFjaywgdGhpc09iail7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXNlZSBgZG9qby5mb3JFYWNoKClgLiBUaGUgcHJpbWFyeSBkaWZmZXJlbmNlIGlzIHRoYXQgdGhlIGFjdGVkLW9uIA0KCQkJLy8JCWFycmF5IGlzIGltcGxpY2l0bHkgdGhpcyBOb2RlTGlzdC4gSWYgeW91IHdhbnQgdGhlIG9wdGlvbiB0byBicmVhayBvdXQNCgkJCS8vCQlvZiB0aGUgZm9yRWFjaCBsb29wLCB1c2UgZXZlcnkoKSBvciBzb21lKCkgaW5zdGVhZC4NCgkJCWQuZm9yRWFjaCh0aGlzLCBjYWxsYmFjaywgdGhpc09iaik7DQoJCQkvLyBub24tc3RhbmRhcmQgcmV0dXJuIHRvIGFsbG93IGVhc2llciBjaGFpbmluZw0KCQkJcmV0dXJuIHRoaXM7IC8vIGRvam8uTm9kZUxpc3QgDQoJCX0sDQoNCgkJLyo9PT09PQ0KCQljb29yZHM6IGZ1bmN0aW9uKCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgdGhlIGJveCBvYmplY3RzIG9mIGFsbCBlbGVtZW50cyBpbiBhIG5vZGUgbGlzdCBhcw0KCQkJLy8JCWFuIEFycmF5ICgqbm90KiBhIE5vZGVMaXN0KS4gQWN0cyBsaWtlIGBkb2pvLmNvb3Jkc2AsIHRob3VnaCBhc3N1bWVzDQoJCQkvLwkJdGhlIG5vZGUgcGFzc2VkIGlzIGVhY2ggbm9kZSBpbiB0aGlzIGxpc3QuDQoNCgkJCXJldHVybiBkLm1hcCh0aGlzLCBkLmNvb3Jkcyk7IC8vIEFycmF5DQoJCX0sDQoNCgkJcG9zaXRpb246IGZ1bmN0aW9uKCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYm9yZGVyLWJveCBvYmplY3RzICh4L3kvdy9oKSBvZiBhbGwgZWxlbWVudHMgaW4gYSBub2RlIGxpc3QNCgkJCS8vCQlhcyBhbiBBcnJheSAoKm5vdCogYSBOb2RlTGlzdCkuIEFjdHMgbGlrZSBgZG9qby5wb3NpdGlvbmAsIHRob3VnaA0KCQkJLy8JCWFzc3VtZXMgdGhlIG5vZGUgcGFzc2VkIGlzIGVhY2ggbm9kZSBpbiB0aGlzIGxpc3QuIA0KDQoJCQlyZXR1cm4gZC5tYXAodGhpcywgZC5wb3NpdGlvbik7IC8vIEFycmF5DQoJCX0sDQoNCgkJYXR0cjogZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJZ2V0cyBvciBzZXRzIHRoZSBET00gYXR0cmlidXRlIGZvciBldmVyeSBlbGVtZW50IGluIHRoZQ0KCQkJLy8JCU5vZGVMaXN0LiBTZWUgYWxzbyBgZG9qby5hdHRyYA0KCQkJLy8JcHJvcGVydHk6IFN0cmluZw0KCQkJLy8JCXRoZSBhdHRyaWJ1dGUgdG8gZ2V0L3NldA0KCQkJLy8JdmFsdWU6IFN0cmluZz8NCgkJCS8vCQlvcHRpb25hbC4gVGhlIHZhbHVlIHRvIHNldCB0aGUgcHJvcGVydHkgdG8NCgkJCS8vCXJldHVybnM6DQoJCQkvLwkJaWYgbm8gdmFsdWUgaXMgcGFzc2VkLCB0aGUgcmVzdWx0IGlzIGFuIGFycmF5IG9mIGF0dHJpYnV0ZSB2YWx1ZXMNCgkJCS8vCQlJZiBhIHZhbHVlIGlzIHBhc3NlZCwgdGhlIHJldHVybiBpcyB0aGlzIE5vZGVMaXN0DQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCU1ha2UgYWxsIG5vZGVzIHdpdGggYSBwYXJ0aWN1bGFyIGNsYXNzIGZvY3VzYWJsZToNCgkJCS8vCXwJZG9qby5xdWVyeSgiLmZvY3VzYWJsZSIpLmF0dHIoInRhYkluZGV4IiwgLTEpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlEaXNhYmxlIGEgZ3JvdXAgb2YgYnV0dG9uczoNCgkJCS8vCXwJZG9qby5xdWVyeSgiYnV0dG9uLmdyb3VwIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsNCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwkJaW5uZXJIVE1MIGNhbiBiZSBhc3NpZ25lZCBvciByZXRyZWl2ZWQgYXMgd2VsbDoNCgkJCS8vCXwJLy8gZ2V0IHRoZSBpbm5lckhUTUwgKGFzIGFuIGFycmF5KSBmb3IgZWFjaCBsaXN0IGl0ZW0NCgkJCS8vCXwJdmFyIGloID0gZG9qby5xdWVyeSgibGkucmVwbGFjZWFibGUiKS5hdHRyKCJpbm5lckhUTUwiKTsNCgkJCXJldHVybjsgLy8gZG9qby5Ob2RlTGlzdA0KCQkJcmV0dXJuOyAvLyBBcnJheQ0KCQl9LA0KDQoJCXN0eWxlOiBmdW5jdGlvbihwcm9wZXJ0eSwgdmFsdWUpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlnZXRzIG9yIHNldHMgdGhlIENTUyBwcm9wZXJ0eSBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgTm9kZUxpc3QNCgkJCS8vCXByb3BlcnR5OiBTdHJpbmcNCgkJCS8vCQl0aGUgQ1NTIHByb3BlcnR5IHRvIGdldC9zZXQsIGluIEphdmFTY3JpcHQgbm90YXRpb24NCgkJCS8vCQkoImxpbmVIaWVnaHQiIGluc3RlYWQgb2YgImxpbmUtaGVpZ2h0IikNCgkJCS8vCXZhbHVlOiBTdHJpbmc/DQoJCQkvLwkJb3B0aW9uYWwuIFRoZSB2YWx1ZSB0byBzZXQgdGhlIHByb3BlcnR5IHRvDQoJCQkvLwlyZXR1cm5zOg0KCQkJLy8JCWlmIG5vIHZhbHVlIGlzIHBhc3NlZCwgdGhlIHJlc3VsdCBpcyBhbiBhcnJheSBvZiBzdHJpbmdzLg0KCQkJLy8JCUlmIGEgdmFsdWUgaXMgcGFzc2VkLCB0aGUgcmV0dXJuIGlzIHRoaXMgTm9kZUxpc3QNCgkJCXJldHVybjsgLy8gZG9qby5Ob2RlTGlzdA0KCQkJcmV0dXJuOyAvLyBBcnJheQ0KCQl9LA0KDQoJCWFkZENsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlhZGRzIHRoZSBzcGVjaWZpZWQgY2xhc3MgdG8gZXZlcnkgbm9kZSBpbiB0aGUgbGlzdA0KCQkJLy8JY2xhc3NOYW1lOiBTdHJpbmd8QXJyYXkNCgkJCS8vCQlBIFN0cmluZyBjbGFzcyBuYW1lIHRvIGFkZCwgb3Igc2V2ZXJhbCBzcGFjZS1zZXBhcmF0ZWQgY2xhc3MgbmFtZXMsDQoJCQkvLwkJb3IgYW4gYXJyYXkgb2YgY2xhc3MgbmFtZXMuDQoJCQlyZXR1cm47IC8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlyZW1vdmVDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJcmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNsYXNzIGZyb20gZXZlcnkgbm9kZSBpbiB0aGUgbGlzdA0KCQkJLy8JY2xhc3NOYW1lOiBTdHJpbmd8QXJyYXk/DQoJCQkvLwkJQW4gb3B0aW9uYWwgU3RyaW5nIGNsYXNzIG5hbWUgdG8gcmVtb3ZlLCBvciBzZXZlcmFsIHNwYWNlLXNlcGFyYXRlZA0KCQkJLy8JCWNsYXNzIG5hbWVzLCBvciBhbiBhcnJheSBvZiBjbGFzcyBuYW1lcy4gSWYgb21pdHRlZCwgYWxsIGNsYXNzIG5hbWVzDQoJCQkvLwkJd2lsbCBiZSBkZWxldGVkLg0KCQkJLy8JcmV0dXJuczoNCgkJCS8vCQlkb2pvLk5vZGVMaXN0LCB0aGlzIGxpc3QNCgkJCXJldHVybjsgLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUsIGNvbmRpdGlvbil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCUFkZHMgYSBjbGFzcyB0byBub2RlIGlmIG5vdCBwcmVzZW50LCBvciByZW1vdmVzIGlmIHByZXNlbnQuDQoJCQkvLwkJUGFzcyBhIGJvb2xlYW4gY29uZGl0aW9uIGlmIHlvdSB3YW50IHRvIGV4cGxpY2l0bHkgYWRkIG9yIHJlbW92ZS4NCgkJCS8vCWNvbmRpdGlvbjogQm9vbGVhbj8NCgkJCS8vCQlJZiBwYXNzZWQsIHRydWUgbWVhbnMgdG8gYWRkIHRoZSBjbGFzcywgZmFsc2UgbWVhbnMgdG8gcmVtb3ZlLg0KCQkJLy8JY2xhc3NOYW1lOiBTdHJpbmcNCgkJCS8vCQl0aGUgQ1NTIGNsYXNzIHRvIGFkZA0KCQkJcmV0dXJuOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0sDQoNCgkJY29ubmVjdDogZnVuY3Rpb24obWV0aG9kTmFtZSwgb2JqT3JGdW5jLCBmdW5jTmFtZSl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWF0dGFjaCBldmVudCBoYW5kbGVycyB0byBldmVyeSBpdGVtIG9mIHRoZSBOb2RlTGlzdC4gVXNlcyBkb2pvLmNvbm5lY3QoKQ0KCQkJLy8JCXNvIGV2ZW50IHByb3BlcnRpZXMgYXJlIG5vcm1hbGl6ZWQNCgkJCS8vCW1ldGhvZE5hbWU6IFN0cmluZw0KCQkJLy8JCXRoZSBuYW1lIG9mIHRoZSBtZXRob2QgdG8gYXR0YWNoIHRvLiBGb3IgRE9NIGV2ZW50cywgdGhpcyBzaG91bGQgYmUNCgkJCS8vCQl0aGUgbG93ZXItY2FzZSBuYW1lIG9mIHRoZSBldmVudA0KCQkJLy8Jb2JqT3JGdW5jOiBPYmplY3R8RnVuY3Rpb258U3RyaW5nDQoJCQkvLwkJaWYgMiBhcmd1bWVudHMgYXJlIHBhc3NlZCAobWV0aG9kTmFtZSwgb2JqT3JGdW5jKSwgb2JqT3JGdW5jIHNob3VsZA0KCQkJLy8JCXJlZmVyZW5jZSBhIGZ1bmN0aW9uIG9yIGJlIHRoZSBuYW1lIG9mIHRoZSBmdW5jdGlvbiBpbiB0aGUgZ2xvYmFsDQoJCQkvLwkJbmFtZXNwYWNlIHRvIGF0dGFjaC4gSWYgMyBhcmd1bWVudHMgYXJlIHByb3ZpZGVkDQoJCQkvLwkJKG1ldGhvZE5hbWUsIG9iak9yRnVuYywgZnVuY05hbWUpLCBvYmpPckZ1bmMgbXVzdCBiZSB0aGUgc2NvcGUgdG8gDQoJCQkvLwkJbG9jYXRlIHRoZSBib3VuZCBmdW5jdGlvbiBpbg0KCQkJLy8JZnVuY05hbWU6IFN0cmluZz8NCgkJCS8vCQlvcHRpb25hbC4gQSBzdHJpbmcgbmFtaW5nIHRoZSBmdW5jdGlvbiBpbiBvYmpPckZ1bmMgdG8gYmluZCB0byB0aGUNCgkJCS8vCQlldmVudC4gTWF5IGFsc28gYmUgYSBmdW5jdGlvbiByZWZlcmVuY2UuDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCWFkZCBhbiBvbmNsaWNrIGhhbmRsZXIgdG8gZXZlcnkgYnV0dG9uIG9uIHRoZSBwYWdlDQoJCQkvLwkJfAlkb2pvLnF1ZXJ5KCJkaXY6bnRoLWNoaWxkKG9kZCkiKS5jb25uZWN0KCJvbmNsaWNrIiwgZnVuY3Rpb24oZSl7DQoJCQkvLwkJfAkJY29uc29sZS5sb2coImNsaWNrZWQhIik7DQoJCQkvLwkJfAl9KTsNCgkJCS8vIGV4YW1wbGU6DQoJCQkvLwkJYXR0YWNoIGZvby5iYXIoKSB0byBldmVyeSBvZGQgZGl2J3Mgb25tb3VzZW92ZXINCgkJCS8vCQl8CWRvam8ucXVlcnkoImRpdjpudGgtY2hpbGQob2RkKSIpLmNvbm5lY3QoIm9ubW91c2VvdmVyIiwgZm9vLCAiYmFyIik7DQoJCX0sDQoNCgkJZW1wdHk6IGZ1bmN0aW9uKCl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCWNsZWFycyBhbGwgY29udGVudCBmcm9tIGVhY2ggbm9kZSBpbiB0aGUgbGlzdC4gRWZmZWN0aXZlbHkNCgkJCS8vCQllcXVpdmFsZW50IHRvIHJlbW92aW5nIGFsbCBjaGlsZCBub2RlcyBmcm9tIGV2ZXJ5IGl0ZW0gaW4NCgkJCS8vCQl0aGUgbGlzdC4NCgkJCXJldHVybiB0aGlzLmZvckVhY2goIml0ZW0uaW5uZXJIVE1MPScnOyIpOyAvLyBkb2pvLk5vZGVMaXN0DQoJCQkvLyBGSVhNRTogc2hvdWxkIHdlIGJlIGNoZWNraW5nIGZvciBhbmQvb3IgZGlzcG9zaW5nIG9mIHdpZGdldHMgYmVsb3cgdGhlc2Ugbm9kZXM/DQoJCX0sDQoJCT09PT09Ki8NCg0KCQkvLyB1c2VmdWwgaHRtbCBtZXRob2RzDQoJCWNvb3JkczoJYWRhcHRBc01hcChkLmNvb3JkcyksDQoJCXBvc2l0aW9uOiBhZGFwdEFzTWFwKGQucG9zaXRpb24pLA0KDQoJCS8vIEZJWE1FOiBjb25uZWN0UHVibGlzaGVyKCk/IGNvbm5lY3RSdW5PbmNlKCk/DQoNCgkJLyoNCgkJZGVzdHJveTogZnVuY3Rpb24oKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJZGVzdHJveXMgZXZlcnkgaXRlbSBpbiAJdGhlIGxpc3QuDQoJCQl0aGlzLmZvckVhY2goZC5kZXN0cm95KTsNCgkJCS8vIEZJWE1FOiBzaG91bGQgd2UgYmUgY2hlY2tpbmcgZm9yIGFuZC9vciBkaXNwb3Npbmcgb2Ygd2lkZ2V0cyBiZWxvdyB0aGVzZSBub2Rlcz8NCgkJfSwNCgkJKi8NCg0KCQlwbGFjZTogZnVuY3Rpb24oLypTdHJpbmd8fE5vZGUqLyBxdWVyeU9yTm9kZSwgLypTdHJpbmcqLyBwb3NpdGlvbil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCXBsYWNlcyBlbGVtZW50cyBvZiB0aGlzIG5vZGUgbGlzdCByZWxhdGl2ZSB0byB0aGUgZmlyc3QgZWxlbWVudCBtYXRjaGVkDQoJCQkvLwkJYnkgcXVlcnlPck5vZGUuIFJldHVybnMgdGhlIG9yaWdpbmFsIE5vZGVMaXN0LiBTZWU6IGBkb2pvLnBsYWNlYA0KCQkJLy8JcXVlcnlPck5vZGU6DQoJCQkvLwkJbWF5IGJlIGEgc3RyaW5nIHJlcHJlc2VudGluZyBhbnkgdmFsaWQgQ1NTMyBzZWxlY3RvciBvciBhIERPTSBub2RlLg0KCQkJLy8JCUluIHRoZSBzZWxlY3RvciBjYXNlLCBvbmx5IHRoZSBmaXJzdCBtYXRjaGluZyBlbGVtZW50IHdpbGwgYmUgdXNlZCANCgkJCS8vCQlmb3IgcmVsYXRpdmUgcG9zaXRpb25pbmcuDQoJCQkvLwlwb3NpdGlvbjoNCgkJCS8vCQljYW4gYmUgb25lIG9mOg0KCQkJLy8JCXwJImxhc3QiIChkZWZhdWx0KQ0KCQkJLy8JCXwJImZpcnN0Ig0KCQkJLy8JCXwJImJlZm9yZSINCgkJCS8vCQl8CSJhZnRlciINCgkJCS8vCQl8CSJvbmx5Ig0KCQkJLy8JCXwJInJlcGxhY2UiDQoJCQkvLyAJCW9yIGFuIG9mZnNldCBpbiB0aGUgY2hpbGROb2RlcyBwcm9wZXJ0eQ0KCQkJdmFyIGl0ZW0gPSBkLnF1ZXJ5KHF1ZXJ5T3JOb2RlKVswXTsNCgkJCXJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7IGQucGxhY2Uobm9kZSwgaXRlbSwgcG9zaXRpb24pOyB9KTsgLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCW9ycGhhbjogZnVuY3Rpb24oLypTdHJpbmc/Ki8gc2ltcGxlRmlsdGVyKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJcmVtb3ZlcyBlbGVtZW50cyBpbiB0aGlzIGxpc3QgdGhhdCBtYXRjaCB0aGUgc2ltcGxlIGZpbHRlcg0KCQkJLy8JCWZyb20gdGhlaXIgcGFyZW50cyBhbmQgcmV0dXJucyB0aGVtIGFzIGEgbmV3IE5vZGVMaXN0Lg0KCQkJLy8Jc2ltcGxlRmlsdGVyOg0KCQkJLy8JCXNpbmdsZS1leHByZXNzaW9uIENTUyBydWxlLiBGb3IgZXhhbXBsZSwgIi50aGluZ2VyIiBvcg0KCQkJLy8JCSIjc29tZUlkW2F0dHJOYW1lPSd2YWx1ZSddIiBidXQgbm90ICJkaXYgPiBzcGFuIi4gSW4gc2hvcnQsDQoJCQkvLwkJYW55dGhpbmcgd2hpY2ggZG9lcyBub3QgaW52b2tlIGEgZGVzY2VudCB0byBldmFsdWF0ZSBidXQNCgkJCS8vCQljYW4gaW5zdGVhZCBiZSB1c2VkIHRvIHRlc3QgYSBzaW5nbGUgbm9kZSBpcyBhY2NlcHRhYmxlLg0KCQkJLy8JcmV0dXJuczoNCgkJCS8vCQlgZG9qby5Ob2RlTGlzdGAgY29udGFpbmluZyB0aGUgb3JwYWhuZWQgZWxlbWVudHMgDQoJCQlyZXR1cm4gKHNpbXBsZUZpbHRlciA/IGQuX2ZpbHRlclF1ZXJ5UmVzdWx0KHRoaXMsIHNpbXBsZUZpbHRlcikgOiB0aGlzKS5mb3JFYWNoKG9ycGhhbik7IC8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlhZG9wdDogZnVuY3Rpb24oLypTdHJpbmd8fEFycmF5fHxEb21Ob2RlKi8gcXVlcnlPckxpc3RPck5vZGUsIC8qU3RyaW5nPyovIHBvc2l0aW9uKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJcGxhY2VzIGFueS9hbGwgZWxlbWVudHMgaW4gcXVlcnlPckxpc3RPck5vZGUgYXQgYQ0KCQkJLy8JCXBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoaXMgbGlzdC4NCgkJCS8vCQlSZXR1cm5zIGEgZG9qby5Ob2RlTGlzdCBvZiB0aGUgYWRvcHRlZCBlbGVtZW50cy4NCgkJCS8vCXF1ZXJ5T3JMaXN0T3JOb2RlOg0KCQkJLy8JCWEgRE9NIG5vZGUgb3IgYSBxdWVyeSBzdHJpbmcgb3IgYSBxdWVyeSByZXN1bHQuDQoJCQkvLwkJUmVwcmVzZW50cyB0aGUgbm9kZXMgdG8gYmUgYWRvcHRlZCByZWxhdGl2ZSB0byB0aGUNCgkJCS8vCQlmaXJzdCBlbGVtZW50IG9mIHRoaXMgTm9kZUxpc3QuDQoJCQkvLwlwb3NpdGlvbjoNCgkJCS8vCQljYW4gYmUgb25lIG9mOg0KCQkJLy8JCXwJImxhc3QiIChkZWZhdWx0KQ0KCQkJLy8JCXwJImZpcnN0Ig0KCQkJLy8JCXwJImJlZm9yZSINCgkJCS8vCQl8CSJhZnRlciINCgkJCS8vCQl8CSJvbmx5Ig0KCQkJLy8JCXwJInJlcGxhY2UiDQoJCQkvLyAJCW9yIGFuIG9mZnNldCBpbiB0aGUgY2hpbGROb2RlcyBwcm9wZXJ0eQ0KCQkJcmV0dXJuIGQucXVlcnkocXVlcnlPckxpc3RPck5vZGUpLnBsYWNlKHRoaXNbMF0sIHBvc2l0aW9uKS5fc3Rhc2godGhpcyk7CS8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQkvLyBGSVhNRTogZG8gd2UgbmVlZCB0aGlzPw0KCQlxdWVyeTogZnVuY3Rpb24oLypTdHJpbmcqLyBxdWVyeVN0cil7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCVJldHVybnMgYSBuZXcgbGlzdCB3aG9zZSBtZW1lYmVycyBtYXRjaCB0aGUgcGFzc2VkIHF1ZXJ5LA0KCQkJLy8JCWFzc3VtaW5nIGVsZW1lbnRzIG9mIHRoZSBjdXJyZW50IE5vZGVMaXN0IGFzIHRoZSByb290IGZvcg0KCQkJLy8JCWVhY2ggc2VhcmNoLg0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhc3N1bWUgYSBET00gY3JlYXRlZCBieSB0aGlzIG1hcmt1cDoNCgkJCS8vCXwJPGRpdiBpZD0iZm9vIj4NCgkJCS8vCXwJCTxwPg0KCQkJLy8JfAkJCWJhY29uIGlzIHRhc3R5LCA8c3Bhbj5kb250Y2hhIHRoaW5rPzwvc3Bhbj4NCgkJCS8vCXwJCTwvcD4NCgkJCS8vCXwJPC9kaXY+DQoJCQkvLwl8CTxkaXYgaWQ9ImJhciI+DQoJCQkvLwl8CQk8cD5ncmVhdCBjb21tZWRpYW5zIG1heSBub3QgYmUgZnVubnkgPHNwYW4+aW4gcGVyc29uPC9zcGFuPjwvcD4NCgkJCS8vCXwJPC9kaXY+DQoJCQkvLwkJSWYgd2UgYXJlIHByZXNlbnRlZCB3aXRoIHRoZSBmb2xsb3dpbmcgZGVmaW50aW9uIGZvciBhIE5vZGVMaXN0Og0KCQkJLy8JfAl2YXIgbCA9IG5ldyBkb2pvLk5vZGVMaXN0KGRvam8uYnlJZCgiZm9vIiksIGRvam8uYnlJZCgiYmFyIikpOw0KCQkJLy8JCWl0J3MgcG9zc2libGUgdG8gZmluZCBhbGwgc3BhbiBlbGVtZW50cyB1bmRlciBwYXJhZ3JhcGhzDQoJCQkvLwkJY29udGFpbmVkIGJ5IHRoZXNlIGVsZW1lbnRzIHdpdGggdGhpcyBzdWItcXVlcnk6DQoJCQkvLwl8IAl2YXIgc3BhbnMgPSBsLnF1ZXJ5KCJwIHNwYW4iKTsNCg0KCQkJLy8gRklYTUU6IHByb2JhYmx5IHNsb3cNCgkJCWlmKCFxdWVyeVN0cil7IHJldHVybiB0aGlzOyB9DQoJCQl2YXIgcmV0ID0gdGhpcy5tYXAoZnVuY3Rpb24obm9kZSl7DQoJCQkJLy8gRklYTUU6IHdoeSB3b3VsZCB3ZSBldmVyIGdldCB1bmRlZmluZWQgaGVyZT8NCgkJCQlyZXR1cm4gZC5xdWVyeShxdWVyeVN0ciwgbm9kZSkuZmlsdGVyKGZ1bmN0aW9uKHN1Yk5vZGUpeyByZXR1cm4gc3ViTm9kZSAhPT0gdW5kZWZpbmVkOyB9KTsNCgkJCX0pOw0KCQkJcmV0dXJuIHRoaXMuX3dyYXAoYXBjLmFwcGx5KFtdLCByZXQpLCB0aGlzKTsJLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCWZpbHRlcjogZnVuY3Rpb24oLypTdHJpbmd8RnVuY3Rpb24qLyBzaW1wbGVGaWx0ZXIpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vIAkJIm1hc2tzIiB0aGUgYnVpbHQtaW4gamF2YXNjcmlwdCBmaWx0ZXIoKSBtZXRob2QgKHN1cHBvcnRlZA0KCQkJLy8gCQlpbiBEb2pvIHZpYSBgZG9qby5maWx0ZXJgKSB0byBzdXBwb3J0IHBhc3NpbmcgYSBzaW1wbGUNCgkJCS8vIAkJc3RyaW5nIGZpbHRlciBpbiBhZGRpdGlvbiB0byBzdXBwb3J0aW5nIGZpbHRlcmluZyBmdW5jdGlvbg0KCQkJLy8gCQlvYmplY3RzLg0KCQkJLy8Jc2ltcGxlRmlsdGVyOg0KCQkJLy8JCUlmIGEgc3RyaW5nLCBhIHNpbmdsZS1leHByZXNzaW9uIENTUyBydWxlLiBGb3IgZXhhbXBsZSwNCgkJCS8vCQkiLnRoaW5nZXIiIG9yICIjc29tZUlkW2F0dHJOYW1lPSd2YWx1ZSddIiBidXQgbm90ICJkaXYgPg0KCQkJLy8JCXNwYW4iLiBJbiBzaG9ydCwgYW55dGhpbmcgd2hpY2ggZG9lcyBub3QgaW52b2tlIGEgZGVzY2VudA0KCQkJLy8JCXRvIGV2YWx1YXRlIGJ1dCBjYW4gaW5zdGVhZCBiZSB1c2VkIHRvIHRlc3QgYSBzaW5nbGUgbm9kZQ0KCQkJLy8JCWlzIGFjY2VwdGFibGUuDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCSJyZWd1bGFyIiBKUyBmaWx0ZXIgc3ludGF4IGFzIGV4cG9zZWQgaW4gZG9qby5maWx0ZXI6DQoJCQkvLwkJfAlkb2pvLnF1ZXJ5KCIqIikuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pew0KCQkJLy8JCXwJCS8vIGhpZ2hsaWdodCBldmVyeSBwYXJhZ3JhcGgNCgkJCS8vCQl8CQlyZXR1cm4gKGl0ZW0ubm9kZU5hbWUgPT0gInAiKTsNCgkJCS8vCQl8CX0pLnN0eWxlKCJiYWNrZ3JvdW5kQ29sb3IiLCAieWVsbG93Iik7DQoJCQkvLyBleGFtcGxlOg0KCQkJLy8JCXRoZSBzYW1lIGZpbHRlcmluZyB1c2luZyBhIENTUyBzZWxlY3Rvcg0KCQkJLy8JCXwJZG9qby5xdWVyeSgiKiIpLmZpbHRlcigicCIpLnN0eWxlcygiYmFja2dyb3VuZENvbG9yIiwgInllbGxvdyIpOw0KDQoJCQl2YXIgYSA9IGFyZ3VtZW50cywgaXRlbXMgPSB0aGlzLCBzdGFydCA9IDA7DQoJCQlpZih0eXBlb2Ygc2ltcGxlRmlsdGVyID09ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJCWl0ZW1zID0gZC5fZmlsdGVyUXVlcnlSZXN1bHQodGhpcywgYVswXSk7DQoJCQkJaWYoYS5sZW5ndGggPT0gMSl7DQoJCQkJCS8vIGlmIHdlIG9ubHkgZ290IGEgc3RyaW5nIHF1ZXJ5LCBwYXNzIGJhY2sgdGhlIGZpbHRlcmVkIHJlc3VsdHMNCgkJCQkJcmV0dXJuIGl0ZW1zLl9zdGFzaCh0aGlzKTsgLy8gZG9qby5Ob2RlTGlzdA0KCQkJCX0NCgkJCQkvLyBpZiB3ZSBnb3QgYSBjYWxsYmFjaywgcnVuIGl0IG92ZXIgdGhlIGZpbHRlcmVkIGl0ZW1zDQoJCQkJc3RhcnQgPSAxOw0KCQkJfQ0KCQkJcmV0dXJuIHRoaXMuX3dyYXAoZC5maWx0ZXIoaXRlbXMsIGFbc3RhcnRdLCBhW3N0YXJ0ICsgMV0pLCB0aGlzKTsJLy8gZG9qby5Ob2RlTGlzdA0KCQl9LA0KDQoJCS8qDQoJCS8vIEZJWE1FOiBzaG91bGQgdGhpcyBiZSAiY29weVRvIiBhbmQgaW5jbHVkZSBwYXJlbnRpbmcgaW5mbz8NCgkJY2xvbmU6IGZ1bmN0aW9uKCl7DQoJCQkvLyBzdW1tYXJ5Og0KCQkJLy8JCWNyZWF0ZXMgbm9kZSBjbG9uZXMgb2YgZWFjaCBlbGVtZW50IG9mIHRoaXMgbGlzdA0KCQkJLy8JCWFuZCByZXR1cm5zIGEgbmV3IGxpc3QgY29udGFpbmluZyB0aGUgY2xvbmVzDQoJCX0sDQoJCSovDQoNCgkJYWRkQ29udGVudDogZnVuY3Rpb24oLypTdHJpbmd8fERvbU5vZGV8fE9iamVjdHx8ZG9qby5Ob2RlTGlzdCovIGNvbnRlbnQsIC8qU3RyaW5nfHxJbnRlZ2VyPyovIHBvc2l0aW9uKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJYWRkIGEgbm9kZSwgTm9kZUxpc3Qgb3Igc29tZSBIVE1MIGFzIGEgc3RyaW5nIHRvIGV2ZXJ5IGl0ZW0gaW4gdGhlDQoJCQkvLwkJbGlzdC4gIFJldHVybnMgdGhlIG9yaWdpbmFsIGxpc3QuDQoJCQkvLwlkZXNjcmlwdGlvbjoNCgkJCS8vCQlhIGNvcHkgb2YgdGhlIEhUTUwgY29udGVudCBpcyBhZGRlZCB0byBlYWNoIGl0ZW0gaW4gdGhlDQoJCQkvLwkJbGlzdCwgd2l0aCBhbiBvcHRpb25hbCBwb3NpdGlvbiBhcmd1bWVudC4gSWYgbm8gcG9zaXRpb24NCgkJCS8vCQlhcmd1bWVudCBpcyBwcm92aWRlZCwgdGhlIGNvbnRlbnQgaXMgYXBwZW5kZWQgdG8gdGhlIGVuZCBvZg0KCQkJLy8JCWVhY2ggaXRlbS4NCgkJCS8vCWNvbnRlbnQ6DQoJCQkvLwkJRE9NIG5vZGUsIEhUTUwgaW4gc3RyaW5nIGZvcm1hdCwgYSBOb2RlTGlzdCBvciBhbiBPYmplY3QuIElmIGEgRE9NIG5vZGUgb3INCgkJCS8vIAkJTm9kZUxpc3QsIHRoZSBjb250ZW50IHdpbGwgYmUgY2xvbmVkIGlmIHRoZSBjdXJyZW50IE5vZGVMaXN0IGhhcyBtb3JlIHRoYW4gb25lDQoJCQkvLyAJCWVsZW1lbnQuIE9ubHkgdGhlIERPTSBub2RlcyBhcmUgY2xvbmVkLCBubyBldmVudCBoYW5kbGVycy4gSWYgaXQgaXMgYW4gT2JqZWN0LA0KCQkJLy8gCQlpdCBzaG91bGQgYmUgYW4gb2JqZWN0IHdpdGggYXQgInRlbXBsYXRlIiBTdHJpbmcgcHJvcGVydHkgdGhhdCBoYXMgdGhlIEhUTUwgc3RyaW5nDQoJCQkvLyAJCXRvIGluc2VydC4gSWYgZG9qby5zdHJpbmcgaGFzIGFscmVhZHkgYmVlbiBkb2pvLnJlcXVpcmVkLCB0aGVuIGRvam8uc3RyaW5nLnN1YnN0aXR1dGUNCgkJCS8vIAkJd2lsbCBiZSB1c2VkIG9uIHRoZSAidGVtcGxhdGUiIHRvIGdlbmVyYXRlIHRoZSBmaW5hbCBIVE1MIHN0cmluZy4gT3RoZXIgYWxsb3dlZA0KCQkJLy8gCQlwcm9wZXJ0aWVzIG9uIHRoZSBvYmplY3QgYXJlOiAicGFyc2UiIGlmIHRoZSBIVE1MDQoJCQkvLyAJCXN0cmluZyBzaG91bGQgYmUgcGFyc2VkIGZvciB3aWRnZXRzIChkb2pvLnJlcXVpcmUoImRvam8ucGFyc2VyIikgdG8gZ2V0IHRoYXQNCgkJCS8vIAkJb3B0aW9uIHRvIHdvcmspLCBhbmQgInRlbXBsYXRlRnVuYyIgaWYgYSB0ZW1wbGF0ZSBmdW5jdGlvbiBiZXNpZGVzIGRvam8uc3RyaW5nLnN1YnN0aXR1dGUNCgkJCS8vIAkJc2hvdWxkIGJlIHVzZWQgdG8gdHJhbnNmb3JtIHRoZSAidGVtcGxhdGUiLg0KCQkJLy8JcG9zaXRpb246DQoJCQkvLwkJY2FuIGJlIG9uZSBvZjoNCgkJCS8vCQl8CSJsYXN0Inx8ImVuZCIgKGRlZmF1bHQpDQoJCQkvLwkJfAkiZmlyc3R8fCJzdGFydCINCgkJCS8vCQl8CSJiZWZvcmUiDQoJCQkvLwkJfAkiYWZ0ZXIiDQoJCQkvLwkJfAkicmVwbGFjZSIgKHJlcGxhY2VzIG5vZGVzIGluIHRoaXMgTm9kZUxpc3Qgd2l0aCBuZXcgY29udGVudCkNCgkJCS8vCQl8CSJvbmx5IiAocmVtb3ZlcyBvdGhlciBjaGlsZHJlbiBvZiB0aGUgbm9kZXMgc28gbmV3IGNvbnRlbnQgaXMgaHRlIG9ubHkgY2hpbGQpDQoJCQkvLyAJCW9yIGFuIG9mZnNldCBpbiB0aGUgY2hpbGROb2RlcyBwcm9wZXJ0eQ0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhcHBlbmRzIGNvbnRlbnQgdG8gdGhlIGVuZCBpZiB0aGUgcG9zaXRpb24gaXMgb21taXR0ZWQNCgkJCS8vCXwJZG9qby5xdWVyeSgiaDMgPiBwIikuYWRkQ29udGVudCgiaGV5IHRoZXJlISIpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhZGQgc29tZXRoaW5nIHRvIHRoZSBmcm9udCBvZiBlYWNoIGVsZW1lbnQgdGhhdCBoYXMgYQ0KCQkJLy8JCSJ0aGluZ2VyIiBwcm9wZXJ0eToNCgkJCS8vCXwJZG9qby5xdWVyeSgiW3RoaW5nZXJdIikuYWRkQ29udGVudCgiLi4uIiwgImZpcnN0Iik7DQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCWFkZHMgYSBoZWFkZXIgYmVmb3JlIGVhY2ggZWxlbWVudCBvZiB0aGUgbGlzdA0KCQkJLy8JfAlkb2pvLnF1ZXJ5KCIubm90ZSIpLmFkZENvbnRlbnQoIjxoND5OT1RFOjwvaDQ+IiwgImJlZm9yZSIpOw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCQlhZGQgYSBjbG9uZSBvZiBhIERPTSBub2RlIHRvIHRoZSBlbmQgb2YgZXZlcnkgZWxlbWVudCBpbg0KCQkJLy8JCXRoZSBsaXN0LCByZW1vdmluZyBpdCBmcm9tIGl0cyBleGlzdGluZyBwYXJlbnQuDQoJCQkvLwl8CWRvam8ucXVlcnkoIi5ub3RlIikuYWRkQ29udGVudChkb2pvLmJ5SWQoImZvbyIpKTsNCgkJCS8vICBleGFtcGxlOg0KCQkJLy8gIAlBcHBlbmQgbm9kZXMgZnJvbSBhIHRlbXBsYXRpemVkIHN0cmluZy4NCgkJCS8vIAkJZG9qby5yZXF1aXJlKCJkb2pvLnN0cmluZyIpOw0KCQkJLy8gCQlkb2pvLnF1ZXJ5KCIubm90ZSIpLmFkZENvbnRlbnQoew0KCQkJLy8gIAkJdGVtcGxhdGU6ICc8Yj4ke2lkfTogPC9iPjxzcGFuPiR7bmFtZX08L3NwYW4+JywNCgkJCS8vIAkJCWlkOiAidXNlcjMzMiIsDQoJCQkvLyAgCQluYW1lOiAiTXIuIEFuZGVyc29uIg0KCQkJLy8gIAl9KTsNCgkJCS8vICBleGFtcGxlOg0KCQkJLy8gIAlBcHBlbmQgbm9kZXMgZnJvbSBhIHRlbXBsYXRpemVkIHN0cmluZyB0aGF0IGFsc28gaGFzIHdpZGdldHMgcGFyc2VkLg0KCQkJLy8gIAlkb2pvLnJlcXVpcmUoImRvam8uc3RyaW5nIik7DQoJCQkvLyAgCWRvam8ucmVxdWlyZSgiZG9qby5wYXJzZXIiKTsNCgkJCS8vICAJdmFyIG5vdGVzID0gZG9qby5xdWVyeSgiLm5vdGUiKS5hZGRDb250ZW50KHsNCgkJCS8vICAJCXRlbXBsYXRlOiAnPGJ1dHRvbiBkb2pvVHlwZT0iZGlqaXQuZm9ybS5CdXR0b24iPiR7dGV4dH08L2J1dHRvbj4nLA0KCQkJLy8gIAkJcGFyc2U6IHRydWUsDQoJCQkvLyAgCQl0ZXh0OiAiU2VuZCINCgkJCS8vICAJfSk7DQoJCQljb250ZW50ID0gdGhpcy5fbm9ybWFsaXplKGNvbnRlbnQsIHRoaXNbMF0pOw0KCQkJZm9yKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IHRoaXNbaV07IGkrKyl7DQoJCQkJdGhpcy5fcGxhY2UoY29udGVudCwgbm9kZSwgcG9zaXRpb24sIGkgPiAwKTsNCgkJCX0NCgkJCXJldHVybiB0aGlzOyAvL2Rvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlpbnN0YW50aWF0ZTogZnVuY3Rpb24oLypTdHJpbmd8T2JqZWN0Ki8gZGVjbGFyZWRDbGFzcywgLypPYmplY3Q/Ki8gcHJvcGVydGllcyl7DQoJCQkvLwlzdW1tYXJ5Og0KCQkJLy8JCUNyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBhIHNwZWNpZmllZCBjbGFzcywgdXNpbmcgdGhlDQoJCQkvLwkJc3BlY2lmaWVkIHByb3BlcnRpZXMgYW5kIGVhY2ggbm9kZSBpbiB0aGUgbm9kZUxpc3QgYXMgYQ0KCQkJLy8JCXNyY05vZGVSZWYuDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JCUdyYWJzIGFsbCBidXR0b25zIGluIHRoZSBwYWdlIGFuZCBjb252ZXJ0cyB0aGVtIHRvIGRpamkuZm9ybS5CdXR0b25zLg0KCQkJLy8JfAl2YXIgYnV0dG9ucyA9IGRvam8ucXVlcnkoImJ1dHRvbiIpLmluc3RhbnRpYXRlKCJkaWppdC5mb3JtLkJ1dHRvbiIsIHtzaG93TGFiZWw6IHRydWV9KTsNCgkJCXZhciBjID0gZC5pc0Z1bmN0aW9uKGRlY2xhcmVkQ2xhc3MpID8gZGVjbGFyZWRDbGFzcyA6IGQuZ2V0T2JqZWN0KGRlY2xhcmVkQ2xhc3MpOw0KCQkJcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwge307DQoJCQlyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpew0KCQkJCW5ldyBjKHByb3BlcnRpZXMsIG5vZGUpOw0KCQkJfSk7CS8vIGRvam8uTm9kZUxpc3QNCgkJfSwNCg0KCQlhdDogZnVuY3Rpb24oLyo9PT09PSBpbmRleCA9PT09PSovKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJUmV0dXJucyBhIG5ldyBOb2RlTGlzdCBjb21wcmlzZWQgb2YgaXRlbXMgaW4gdGhpcyBOb2RlTGlzdA0KCQkJLy8JCWF0IHRoZSBnaXZlbiBpbmRleCBvciBpbmRpY2VzLg0KCQkJLy8NCgkJCS8vCWluZGV4OiBJbnRlZ2VyLi4uDQoJCQkvLwkJT25lIG9yIG1vcmUgMC1iYXNlZCBpbmRpY2VzIG9mIGl0ZW1zIGluIHRoZSBjdXJyZW50DQoJCQkvLwkJTm9kZUxpc3QuIEEgbmVnYXRpdmUgaW5kZXggd2lsbCBzdGFydCBhdCB0aGUgZW5kIG9mIHRoZQ0KCQkJLy8JCWxpc3QgYW5kIGdvIGJhY2t3YXJkcy4gDQoJCQkvLw0KCQkJLy8JZXhhbXBsZToNCgkJCS8vCVNob3J0ZW4gdGhlIGxpc3QgdG8gdGhlIGZpcnN0LCBzZWNvbmQsIGFuZCB0aGlyZCBlbGVtZW50cw0KCQkJLy8JfAlkb2pvLnF1ZXJ5KCJhIikuYXQoMCwgMSwgMikuZm9yRWFjaChmbik7IA0KCQkJLy8NCgkJCS8vCWV4YW1wbGU6DQoJCQkvLwlSZXRyaWV2ZSB0aGUgZmlyc3QgYW5kIGxhc3QgZWxlbWVudHMgb2YgYSB1bm9yZGVyZWQgbGlzdDoNCgkJCS8vCXwJZG9qby5xdWVyeSgidWwgPiBsaSIpLmF0KDAsIC0xKS5mb3JFYWNoKGNiKTsNCgkJCS8vDQoJCQkvLwlleGFtcGxlOg0KCQkJLy8JRG8gc29tZXRoaW5nIGZvciB0aGUgZmlyc3QgZWxlbWVudCBvbmx5LCBidXQgZW5kKCkgb3V0IGJhY2sgdG8NCgkJCS8vCXRoZSBvcmlnaW5hbCBsaXN0IGFuZCBjb250aW51ZSBjaGFpbmluZzoNCgkJCS8vCXwJZG9qby5xdWVyeSgiYSIpLmF0KDApLm9uY2xpY2soZm4pLmVuZCgpLmZvckVhY2goZnVuY3Rpb24obil7DQoJCQkvLwl8CQljb25zb2xlLmxvZyhuKTsgLy8gYWxsIGFuY2hvcnMgb24gdGhlIHBhZ2UuIA0KCQkJLy8JfAl9KQkNCgkJCS8vDQoJCQkvLwlyZXR1cm5zOg0KCQkJLy8JCWRvam8uTm9kZUxpc3QNCgkJCXZhciB0ID0gbmV3IHRoaXMuX05vZGVMaXN0Q3RvcigpOw0KCQkJZC5mb3JFYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24oaSl7IA0KCQkJCWlmKGkgPCAwKXsgaSA9IHRoaXMubGVuZ3RoICsgaSB9DQoJCQkJaWYodGhpc1tpXSl7IHQucHVzaCh0aGlzW2ldKTsgfQ0KCQkJfSwgdGhpcyk7DQoJCQlyZXR1cm4gdC5fc3Rhc2godGhpcyk7IC8vIGRvam8uTm9kZUxpc3QNCgkJfQ0KDQoJfSk7DQoNCglubC5ldmVudHMgPSBbDQoJCS8vIHN1bW1hcnk6IGxpc3Qgb2YgYWxsIERPTSBldmVudHMgdXNlZCBpbiBOb2RlTGlzdA0KCQkiYmx1ciIsICJmb2N1cyIsICJjaGFuZ2UiLCAiY2xpY2siLCAiZXJyb3IiLCAia2V5ZG93biIsICJrZXlwcmVzcyIsDQoJCSJrZXl1cCIsICJsb2FkIiwgIm1vdXNlZG93biIsICJtb3VzZWVudGVyIiwgIm1vdXNlbGVhdmUiLCAibW91c2Vtb3ZlIiwNCgkJIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciIsICJtb3VzZXVwIiwgInN1Ym1pdCINCgldOw0KCQ0KCS8vIEZJWE1FOiBwc2V1ZG8tZG9jIHRoZSBhYm92ZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBvbi1ldmVudCBmdW5jdGlvbnMNCg0KCS8vIHN5bnRhY3RpYyBzdWdhciBmb3IgRE9NIGV2ZW50cw0KCWQuZm9yRWFjaChubC5ldmVudHMsIGZ1bmN0aW9uKGV2dCl7DQoJCQl2YXIgX29lID0gIm9uIiArIGV2dDsNCgkJCW5scFtfb2VdID0gZnVuY3Rpb24oYSwgYil7DQoJCQkJcmV0dXJuIHRoaXMuY29ubmVjdChfb2UsIGEsIGIpOw0KCQkJfQ0KCQkJCS8vIEZJWE1FOiBzaG91bGQgdGhlc2UgZXZlbnRzIHRyaWdnZXIgcHVibGlzaGVzPw0KCQkJCS8qDQoJCQkJcmV0dXJuIChhID8gdGhpcy5jb25uZWN0KF9vZSwgYSwgYikgOg0KCQkJCQkJCXRoaXMuZm9yRWFjaChmdW5jdGlvbihuKXsNCgkJCQkJCQkJLy8gRklYTUU6DQoJCQkJCQkJCS8vCQlsaXN0ZW5lcnMgZ2V0IGJ1cmllZCBieQ0KCQkJCQkJCQkvLwkJYWRkRXZlbnRMaXN0ZW5lciBhbmQgY2FuJ3QgYmUgZHVnIGJhY2sNCgkJCQkJCQkJLy8JCW91dCB0byBiZSB0cmlnZ2VyZWQgZXh0ZXJuYWxseS4NCgkJCQkJCQkJLy8gc2VlOg0KCQkJCQkJCQkvLwkJaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL0RPTTplbGVtZW50DQoNCgkJCQkJCQkJY29uc29sZS5sb2cobiwgZXZ0LCBfb2UpOw0KDQoJCQkJCQkJCS8vIEZJWE1FOiBuZWVkIHN5bnRoZXRpYyBldmVudCBzdXBwb3J0IQ0KCQkJCQkJCQl2YXIgX2UgPSB7IHRhcmdldDogbiwgZmF1eDogdHJ1ZSwgdHlwZTogZXZ0IH07DQoJCQkJCQkJCS8vIGRvam8uX2V2ZW50X2xpc3RlbmVyLl9zeW50aGVzaXplRXZlbnQoe30sIHsgdGFyZ2V0OiBuLCBmYXV4OiB0cnVlLCB0eXBlOiBldnQgfSk7DQoJCQkJCQkJCXRyeXsgbltldnRdKF9lKTsgfWNhdGNoKGUpeyBjb25zb2xlLmxvZyhlKTsgfQ0KCQkJCQkJCQl0cnl7IG5bX29lXShfZSk7IH1jYXRjaChlKXsgY29uc29sZS5sb2coZSk7IH0NCgkJCQkJCQl9KQ0KCQkJCSk7DQoJCQkJKi8NCgkJfQ0KCSk7DQoNCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLnF1ZXJ5Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLnF1ZXJ5Il0gPSB0cnVlOw0KaWYodHlwZW9mIGRvam8gIT0gInVuZGVmaW5lZCIpew0KCWRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5xdWVyeSIpOw0KCQ0KCQ0KDQp9DQoNCi8qDQoJZG9qby5xdWVyeSgpIGFyY2hpdGVjdHVyYWwgb3ZlcnZpZXc6DQoNCgkJZG9qby5xdWVyeSBpcyBhIHJlbGF0aXZlbHkgZnVsbC1mZWF0dXJlZCBDU1MzIHF1ZXJ5IGxpYnJhcnkuIEl0IGlzDQoJCWRlc2lnbmVkIHRvIHRha2UgYW55IHZhbGlkIENTUzMgc2VsZWN0b3IgYW5kIHJldHVybiB0aGUgbm9kZXMgbWF0Y2hpbmcNCgkJdGhlIHNlbGVjdG9yLiBUbyBkbyB0aGlzIHF1aWNrbHksIGl0IHByb2Nlc3NlcyBxdWVyaWVzIGluIHNldmVyYWwNCgkJc3RlcHMsIGFwcGx5aW5nIGNhY2hpbmcgd2hlcmUgcHJvZml0YWJsZS4NCgkJDQoJCVRoZSBzdGVwcyAocm91Z2hseSBpbiByZXZlcnNlIG9yZGVyIG9mIHRoZSB3YXkgdGhleSBhcHBlYXIgaW4gdGhlIGNvZGUpOg0KCQkJMS4pIGNoZWNrIHRvIHNlZSBpZiB3ZSBhbHJlYWR5IGhhdmUgYSAicXVlcnkgZGlzcGF0Y2hlciINCgkJCQktIGlmIHNvLCB1c2UgdGhhdCB3aXRoIHRoZSBnaXZlbiBwYXJhbWV0ZXJpemF0aW9uLiBTa2lwIHRvIHN0ZXAgNC4NCgkJCTIuKSBhdHRlbXB0IHRvIGRldGVybWluZSB3aGljaCBicmFuY2ggdG8gZGlzcGF0Y2ggdGhlIHF1ZXJ5IHRvOg0KCQkJCS0gSlMgKG9wdGltaXplZCBET00gaXRlcmF0aW9uKQ0KCQkJCS0gbmF0aXZlIChGRjMuMSssIFNhZmFyaSAzLjErLCBJRSA4KykNCgkJCTMuKSB0b2tlbml6ZSBhbmQgY29udmVydCB0byBleGVjdXRhYmxlICJxdWVyeSBkaXNwYXRjaGVyIg0KCQkJCS0gdGhpcyBpcyB3aGVyZSB0aGUgbGlvbidzIHNoYXJlIG9mIHRoZSBjb21wbGV4aXR5IGluIHRoZQ0KCQkJCSAgc3lzdGVtIGxpZXMuIEluIHRoZSBET00gdmVyc2lvbiwgdGhlIHF1ZXJ5IGRpc3BhdGNoZXIgaXMNCgkJCQkgIGFzc2VtYmxlZCBhcyBhIGNoYWluIG9mICJ5ZXMvbm8iIHRlc3QgZnVuY3Rpb25zIHBlcnRhaW5pbmcgdG8NCgkJCQkgIGEgc2VjdGlvbiBvZiBhIHNpbXBsZSBxdWVyeSBzdGF0ZW1lbnQgKCIuYmxhaDpudGgtY2hpbGQob2RkKSINCgkJCQkgIGJ1dCBub3QgImRpdiBkaXYiLCB3aGljaCBpcyAyIHNpbXBsZSBzdGF0ZW1lbnRzKS4gSW5kaXZpZHVhbA0KCQkJCSAgc3RhdGVtZW50IGRpc3BhdGNoZXJzIGFyZSBjYWNoZWQgKHRvIHByZXZlbnQgcmUtZGVmaW5pdGlvbikNCgkJCQkgIGFzIGFyZSBlbnRpcmUgZGlzcGF0Y2ggY2hhaW5zICh0byBtYWtlIHJlLWV4ZWN1dGlvbiBvZiB0aGUNCgkJCQkgIHNhbWUgcXVlcnkgZmFzdCkNCgkJCTQuKSB0aGUgcmVzdWx0aW5nIHF1ZXJ5IGRpc3BhdGNoZXIgaXMgY2FsbGVkIGluIHRoZSBwYXNzZWQgc2NvcGUNCgkJCSAgICAoYnkgZGVmYXVsdCB0aGUgdG9wLWxldmVsIGRvY3VtZW50KQ0KCQkJCS0gZm9yIERPTSBxdWVyaWVzLCB0aGlzIHJlc3VsdHMgaW4gYSByZWN1cnNpdmUsIHRvcC1kb3duDQoJCQkJICBldmFsdWF0aW9uIG9mIG5vZGVzIGJhc2VkIG9uIGVhY2ggc2ltcGxlIHF1ZXJ5IHNlY3Rpb24NCgkJCQktIGZvciBuYXRpdmUgaW1wbGVtZW50YXRpb25zLCB0aGlzIG1heSBtZWFuIHdvcmtpbmcgYXJvdW5kIHNwZWMNCgkJCQkgIGJ1Z3MuIFNvIGJlIGl0Lg0KCQkJNS4pIG1hdGNoZWQgbm9kZXMgYXJlIHBydW5lZCB0byBlbnN1cmUgdGhleSBhcmUgdW5pcXVlIChpZiBuZWNlc3NhcnkpDQoqLw0KDQo7KGZ1bmN0aW9uKGQpew0KCS8vIGRlZmluZSBldmVyeXRoaW5nIGluIGEgY2xvc3VyZSBmb3IgY29tcHJlc3NhYmlsaXR5IHJlYXNvbnMuICJkIiBpcyBhbg0KCS8vIGFsaWFzIHRvICJkb2pvIiAob3IgdGhlIHRvb2xraXQgYWxpYXMgb2JqZWN0LCBlLmcuLCAiYWNtZSIpLg0KDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJLy8gVG9vbGtpdCBhbGlhc2VzDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCgkvLyBpZiB5b3UgYXJlIGV4dHJhY2luZyBkb2pvLnF1ZXJ5IGZvciB1c2UgaW4geW91ciBvd24gc3lzdGVtLCB5b3Ugd2lsbA0KCS8vIG5lZWQgdG8gcHJvdmlkZSB0aGVzZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzLiBObyBvdGhlciBwb3J0aW5nIHNob3VsZCBiZQ0KCS8vIG5lY2Vzc2FyeSwgc2F2ZSBmb3IgY29uZmlndXJpbmcgdGhlIHN5c3RlbSB0byB1c2UgYSBjbGFzcyBvdGhlciB0aGFuDQoJLy8gZG9qby5Ob2RlTGlzdCBhcyB0aGUgcmV0dXJuIGluc3RhbmNlIGluc3RhbnRpYXRvcg0KCXZhciB0cmltID0gCQkJZC50cmltOw0KCXZhciBlYWNoID0gCQkJZC5mb3JFYWNoOw0KCS8vIAkJCQkJZC5pc0lFOyAvLyBmbG9hdA0KCS8vIAkJCQkJZC5pc1NhZmFyaTsgLy8gZmxvYXQNCgkvLyAJCQkJCWQuaXNPcGVyYTsgLy8gZmxvYXQNCgkvLyAJCQkJCWQuaXNXZWJLaXQ7IC8vIGZsb2F0DQoJLy8gCQkJCQlkLmRvYyA7IC8vIGRvY3VtZW50IGVsZW1lbnQNCgl2YXIgcWxjID0gZC5fTm9kZUxpc3RDdG9yID0gCQlkLk5vZGVMaXN0Ow0KDQoJdmFyIGdldERvYyA9IGZ1bmN0aW9uKCl7IHJldHVybiBkLmRvYzsgfTsNCgkvLyBOT1RFKGFsZXgpOiB0aGUgc3BlYyBpcyBpZGlvdGljLiBDU1MgcXVlcmllcyBzaG91bGQgQUxXQVlTIGJlIGNhc2Utc2Vuc2l0aXZlLCBidXQgbm9vb29vb28NCgl2YXIgY3NzQ2FzZUJ1ZyA9ICgoZC5pc1dlYktpdHx8ZC5pc01vemlsbGEpICYmICgoZ2V0RG9jKCkuY29tcGF0TW9kZSkgPT0gIkJhY2tDb21wYXQiKSk7DQoNCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCgkvLyBHbG9iYWwgdXRpbGl0aWVzDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCg0KCS8vIG9uIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCB0aGUgImNoaWxkcmVuIiBjb2xsZWN0aW9uIHdlIGNhbiBhdm9pZCBhIGxvdCBvZg0KCS8vIGl0ZXJhdGlvbiBvbiBjaGFmZiAobm9uLWVsZW1lbnQpIG5vZGVzLg0KCS8vIHdoeS4NCgl2YXIgY2hpbGROb2Rlc05hbWUgPSAhIWdldERvYygpLmZpcnN0Q2hpbGRbImNoaWxkcmVuIl0gPyAiY2hpbGRyZW4iIDogImNoaWxkTm9kZXMiOw0KDQoJdmFyIHNwZWNpYWxzID0gIj5+KyI7DQoNCgkvLyBnbG9iYWwgdGh1bmsgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgd2Ugc2hvdWxkIHRyZWF0IHRoZSBjdXJyZW50IHF1ZXJ5IGFzDQoJLy8gY2FzZSBzZW5zaXRpdmUgb3Igbm90LiBUaGlzIHN3aXRjaCBpcyBmbGlwcGVkIGJ5IHRoZSBxdWVyeSBldmFsdWF0b3INCgkvLyBiYXNlZCBvbiB0aGUgZG9jdW1lbnQgcGFzc2VkIGFzIHRoZSBjb250ZXh0IHRvIHNlYXJjaC4NCgl2YXIgY2FzZVNlbnNpdGl2ZSA9IGZhbHNlOw0KDQoJLy8gaG93IGhpZ2g/DQoJdmFyIHllc21hbiA9IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlOyB9Ow0KDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJLy8gVG9rZW5pemVyDQoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCgl2YXIgZ2V0UXVlcnlQYXJ0cyA9IGZ1bmN0aW9uKHF1ZXJ5KXsNCgkJLy8Jc3VtbWFyeTogDQoJCS8vCQlzdGF0ZSBtYWNoaW5lIGZvciBxdWVyeSB0b2tlbml6YXRpb24NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlpbnN0ZWFkIG9mIHVzaW5nIGEgYnJpdHRsZSBhbmQgc2xvdyByZWdleC1iYXNlZCBDU1MgcGFyc2VyLA0KCQkvLwkJZG9qby5xdWVyeSBpbXBsZW1lbnRzIGFuIEFTVC1zdHlsZSBxdWVyeSByZXByZXNlbnRhdGlvbi4gVGhpcw0KCQkvLwkJcmVwcmVzZW50YXRpb24gaXMgb25seSBnZW5lcmF0ZWQgb25jZSBwZXIgcXVlcnkuIEZvciBleGFtcGxlLA0KCQkvLwkJdGhlIHNhbWUgcXVlcnkgcnVuIG11bHRpcGxlIHRpbWVzIG9yIHVuZGVyIGRpZmZlcmVudCByb290IG5vZGVzDQoJCS8vCQlkb2VzIG5vdCByZS1wYXJzZSB0aGUgc2VsZWN0b3IgZXhwcmVzc2lvbiBidXQgaW5zdGVhZCB1c2VzIHRoZQ0KCQkvLwkJY2FjaGVkIGRhdGEgc3RydWN0dXJlLiBUaGUgc3RhdGUgbWFjaGluZSBpbXBsZW1lbnRlZCBoZXJlDQoJCS8vCQl0ZXJtaW5hdGVzIG9uIHRoZSBsYXN0ICIgIiAoc3BhY2UpIGNoYXJhY2h0ZXIgYW5kIHJldHVybnMgYW4NCgkJLy8JCW9yZGVyZWQgYXJyYXkgb2YgcXVlcnkgY29tcG9uZW50IHN0cnVjdHVyZXMgKG9yICJwYXJ0cyIpLiBFYWNoDQoJCS8vCQlwYXJ0IHJlcHJlc2VudHMgYW4gb3BlcmF0b3Igb3IgYSBzaW1wbGUgQ1NTIGZpbHRlcmluZw0KCQkvLwkJZXhwcmVzc2lvbi4gVGhlIHN0cnVjdHVyZSBmb3IgcGFydHMgaXMgZG9jdW1lbnRlZCBpbiB0aGUgY29kZQ0KCQkvLwkJYmVsb3cuDQoNCg0KCQkvLyBOT1RFOiANCgkJLy8JCXRoaXMgY29kZSBpcyBkZXNpZ25lZCB0byBydW4gZmFzdCBhbmQgY29tcHJlc3Mgd2VsbC4gU2FjcmlmaWNlcw0KCQkvLwkJdG8gcmVhZGliaWxpdHkgYW5kIG1haW50YWluYWJpbGl0eSBoYXZlIGJlZW4gbWFkZS4gIFlvdXIgYmVzdA0KCQkvLwkJYmV0IHdoZW4gaGFja2luZyB0aGUgdG9rZW5pemVyIGlzIHRvIHB1dCBUaGUgRG9ubmFzIG9uICpyZWFsbHkqDQoJCS8vCQlsb3VkIChtYXkgd2UgcmVjb21tZW5kIHRoZWlyICJTcGVuZCBUaGUgTmlnaHQiIHJlbGVhc2U/KSBhbmQNCgkJLy8JCWp1c3QgYXNzdW1lIHlvdSdyZSBnb25uYSBtYWtlIG1pc3Rha2VzLiBLZWVwIHRoZSB1bml0IHRlc3RzDQoJCS8vCQlvcGVuIGFuZCBydW4gdGhlbSBmcmVxdWVudGx5LiBLbm93aW5nIGlzIGhhbGYgdGhlIGJhdHRsZSA7LSkNCgkJaWYoc3BlY2lhbHMuaW5kZXhPZihxdWVyeS5zbGljZSgtMSkpID49IDApew0KCQkJLy8gaWYgd2UgZW5kIHdpdGggYSAiPiIsICIrIiwgb3IgIn4iLCB0aGF0IG1lYW5zIHdlJ3JlIGltcGxpY2l0bHkNCgkJCS8vIHNlYXJjaGluZyBhbGwgY2hpbGRyZW4sIHNvIG1ha2UgaXQgZXhwbGljaXQNCgkJCXF1ZXJ5ICs9ICIgKiAiDQoJCX1lbHNlew0KCQkJLy8gaWYgeW91IGhhdmUgbm90IHByb3ZpZGVkIGEgdGVybWluYXRvciwgb25lIHdpbGwgYmUgcHJvdmlkZWQgZm9yDQoJCQkvLyB5b3UuLi4NCgkJCXF1ZXJ5ICs9ICIgIjsNCgkJfQ0KDQoJCXZhciB0cyA9IGZ1bmN0aW9uKC8qSW50ZWdlciovIHMsIC8qSW50ZWdlciovIGUpew0KCQkJLy8gdHJpbSBhbmQgc2xpY2UuIA0KDQoJCQkvLyB0YWtlIGFuIGluZGV4IHRvIHN0YXJ0IGEgc3RyaW5nIHNsaWNlIGZyb20gYW5kIGFuIGVuZCBwb3NpdGlvbg0KCQkJLy8gYW5kIHJldHVybiBhIHRyaW1tZWQgY29weSBvZiB0aGF0IHN1Yi1zdHJpbmcNCgkJCXJldHVybiB0cmltKHF1ZXJ5LnNsaWNlKHMsIGUpKTsNCgkJfQ0KDQoJCS8vIHRoZSBvdmVyYWxsIGRhdGEgZ3JhcGggb2YgdGhlIGZ1bGwgcXVlcnksIGFzIHJlcHJlc2VudGVkIGJ5IHF1ZXJ5UGFydCBvYmplY3RzDQoJCXZhciBxdWVyeVBhcnRzID0gW107IA0KDQoNCgkJLy8gc3RhdGUga2VlcGluZyB2YXJzDQoJCXZhciBpbkJyYWNrZXRzID0gLTEsIGluUGFyZW5zID0gLTEsIGluTWF0Y2hGb3IgPSAtMSwgDQoJCQlpblBzZXVkbyA9IC0xLCBpbkNsYXNzID0gLTEsIGluSWQgPSAtMSwgaW5UYWcgPSAtMSwgDQoJCQlsYyA9ICIiLCBjYyA9ICIiLCBwU3RhcnQ7DQoNCgkJLy8gaXRlcmF0aW9uIHZhcnMNCgkJdmFyIHggPSAwLCAvLyBpbmRleCBpbiB0aGUgcXVlcnkNCgkJCXFsID0gcXVlcnkubGVuZ3RoLA0KCQkJY3VycmVudFBhcnQgPSBudWxsLCAvLyBkYXRhIHN0cnVjdHVyZSByZXByZXNlbnRpbmcgdGhlIGVudGlyZSBjbGF1c2UNCgkJCV9jcCA9IG51bGw7IC8vIHRoZSBjdXJyZW50IHBzZXVkbyBvciBhdHRyIG1hdGNoZXINCg0KCQkvLyBzZXZlcmFsIHRlbXBvcmFyeSB2YXJpYWJsZXMgYXJlIGFzc2lnbmVkIHRvIHRoaXMgc3RydWN0dXJlIGR1cnJpbmcgYQ0KCQkvLyBwb3RlbnRpYWwgc3ViLWV4cHJlc3Npb24gbWF0Y2g6DQoJCS8vCQlhdHRyOg0KCQkvLwkJCWEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBmdWxsIGF0dHJpYnV0ZSBtYXRjaCBpbiBhDQoJCS8vCQkJYnJhY2tldCBleHByZXNzaW9uDQoJCS8vCQl0eXBlOg0KCQkvLwkJCWlmIHRoZXJlJ3MgYW4gb3BlcmF0b3IgaW4gYSBicmFja2V0IGV4cHJlc3Npb24sIHRoaXMgaXMNCgkJLy8JCQl1c2VkIHRvIGtlZXAgdHJhY2sgb2YgaXQNCgkJLy8JCXZhbHVlOg0KCQkvLwkJCXRoZSBpbnRlcm5hbHMgb2YgcGFyZW50aGV0aWNhbCBleHByZXNzaW9uIGZvciBhIHBzZXVkby4gZm9yDQoJCS8vCQkJOm50aC1jaGlsZCgybisxKSwgdmFsdWUgbWlnaHQgYmUgIjJuKzEiDQoNCgkJdmFyIGVuZFRhZyA9IGZ1bmN0aW9uKCl7DQoJCQkvLyBjYWxsZWQgd2hlbiB0aGUgdG9rZW5pemVyIGhpdHMgdGhlIGVuZCBvZiBhIHBhcnRpY3VsYXIgdGFnIG5hbWUuDQoJCQkvLyBSZS1zZXRzIHN0YXRlIHZhcmlhYmxlcyBmb3IgdGFnIG1hdGNoaW5nIGFuZCBzZXRzIHVwIHRoZSBtYXRjaGVyDQoJCQkvLyB0byBoYW5kbGUgdGhlIG5leHQgdHlwZSBvZiB0b2tlbiAodGFnIG9yIG9wZXJhdG9yKS4NCgkJCWlmKGluVGFnID49IDApew0KCQkJCXZhciB0diA9IChpblRhZyA9PSB4KSA/IG51bGwgOiB0cyhpblRhZywgeCk7IC8vIC50b0xvd2VyQ2FzZSgpOw0KCQkJCWN1cnJlbnRQYXJ0WyAoc3BlY2lhbHMuaW5kZXhPZih0dikgPCAwKSA/ICJ0YWciIDogIm9wZXIiIF0gPSB0djsNCgkJCQlpblRhZyA9IC0xOw0KCQkJfQ0KCQl9DQoNCgkJdmFyIGVuZElkID0gZnVuY3Rpb24oKXsNCgkJCS8vIGNhbGxlZCB3aGVuIHRoZSB0b2tlbml6ZXIgbWlnaHQgYmUgYXQgdGhlIGVuZCBvZiBhbiBJRCBwb3J0aW9uIG9mIGEgbWF0Y2gNCgkJCWlmKGluSWQgPj0gMCl7DQoJCQkJY3VycmVudFBhcnQuaWQgPSB0cyhpbklkLCB4KS5yZXBsYWNlKC9cXC9nLCAiIik7DQoJCQkJaW5JZCA9IC0xOw0KCQkJfQ0KCQl9DQoNCgkJdmFyIGVuZENsYXNzID0gZnVuY3Rpb24oKXsNCgkJCS8vIGNhbGxlZCB3aGVuIHRoZSB0b2tlbml6ZXIgbWlnaHQgYmUgYXQgdGhlIGVuZCBvZiBhIGNsYXNzIG5hbWUNCgkJCS8vIG1hdGNoLiBDU1MgYWxsb3dzIGZvciBtdWx0aXBsZSBjbGFzc2VzLCBzbyB3ZSBhdWdtZW50IHRoZQ0KCQkJLy8gY3VycmVudCBpdGVtIHdpdGggYW5vdGhlciBjbGFzcyBpbiBpdHMgbGlzdA0KCQkJaWYoaW5DbGFzcyA+PSAwKXsNCgkJCQljdXJyZW50UGFydC5jbGFzc2VzLnB1c2godHMoaW5DbGFzcysxLCB4KS5yZXBsYWNlKC9cXC9nLCAiIikpOw0KCQkJCWluQ2xhc3MgPSAtMTsNCgkJCX0NCgkJfQ0KDQoJCXZhciBlbmRBbGwgPSBmdW5jdGlvbigpew0KCQkJLy8gYXQgdGhlIGVuZCBvZiBhIHNpbXBsZSBmcmFnbWVudCwgc28gd2FsbCBvZmYgdGhlIG1hdGNoZXMNCgkJCWVuZElkKCk7IGVuZFRhZygpOyBlbmRDbGFzcygpOw0KCQl9DQoNCgkJdmFyIGVuZFBhcnQgPSBmdW5jdGlvbigpew0KCQkJZW5kQWxsKCk7DQoJCQlpZihpblBzZXVkbyA+PSAwKXsNCgkJCQljdXJyZW50UGFydC5wc2V1ZG9zLnB1c2goeyBuYW1lOiB0cyhpblBzZXVkbysxLCB4KSB9KTsNCgkJCX0NCgkJCS8vIGhpbnQgdG8gdGhlIHNlbGVjdG9yIGVuZ2luZSB0byB0ZWxsIGl0IHdoZXRoZXIgb3Igbm90IGl0DQoJCQkvLyBuZWVkcyB0byBkbyBhbnkgaXRlcmF0aW9uLiBNYW55IHNpbXBsZSBzZWxlY3RvcnMgZG9uJ3QsIGFuZA0KCQkJLy8gd2UgY2FuIGF2b2lkIHNpZ25pZmljYW50IGNvbnN0cnVjdGlvbi10aW1lIHdvcmsgYnkgYWR2aXNpbmcNCgkJCS8vIHRoZSBzeXN0ZW0gdG8gc2tpcCB0aGVtDQoJCQljdXJyZW50UGFydC5sb29wcyA9ICgJDQoJCQkJCWN1cnJlbnRQYXJ0LnBzZXVkb3MubGVuZ3RoIHx8IA0KCQkJCQljdXJyZW50UGFydC5hdHRycy5sZW5ndGggfHwgDQoJCQkJCWN1cnJlbnRQYXJ0LmNsYXNzZXMubGVuZ3RoCSk7DQoNCgkJCWN1cnJlbnRQYXJ0Lm9xdWVyeSA9IGN1cnJlbnRQYXJ0LnF1ZXJ5ID0gdHMocFN0YXJ0LCB4KTsgLy8gc2F2ZSB0aGUgZnVsbCBleHByZXNzaW9uIGFzIGEgc3RyaW5nDQoNCg0KCQkJLy8gb3RhZy90YWcgYXJlIGhpbnRzIHRvIHN1Z2dlc3QgdG8gdGhlIHN5c3RlbSB3aGV0aGVyIG9yIG5vdA0KCQkJLy8gaXQncyBhbiBvcGVyYXRvciBvciBhIHRhZy4gV2Ugc2F2ZSBhIGNvcHkgb2Ygb3RhZyBzaW5jZSB0aGUNCgkJCS8vIHRhZyBuYW1lIGlzIGNhc3QgdG8gdXBwZXItY2FzZSBpbiByZWd1bGFyIEhUTUwgbWF0Y2hlcy4gVGhlDQoJCQkvLyBzeXN0ZW0gaGFzIGEgZ2xvYmFsIHN3aXRjaCB0byBmaWd1cmUgb3V0IGlmIHRoZSBjdXJyZW50DQoJCQkvLyBleHByZXNzaW9uIG5lZWRzIHRvIGJlIGNhc2Ugc2Vuc2l0aXZlIG9yIG5vdCBhbmQgaXQgd2lsbCB1c2UNCgkJCS8vIG90YWcgb3IgdGFnIGFjY29yZGluZ2x5DQoJCQljdXJyZW50UGFydC5vdGFnID0gY3VycmVudFBhcnQudGFnID0gKGN1cnJlbnRQYXJ0WyJvcGVyIl0pID8gbnVsbCA6IChjdXJyZW50UGFydC50YWcgfHwgIioiKTsNCg0KCQkJaWYoY3VycmVudFBhcnQudGFnKXsNCgkJCQkvLyBpZiB3ZSdyZSBpbiBhIGNhc2UtaW5zZW5zaXRpdmUgSFRNTCBkb2MsIHdlIGxpa2VseSB3YW50DQoJCQkJLy8gdGhlIHRvVXBwZXJDYXNlIHdoZW4gbWF0Y2hpbmcgb24gZWxlbWVudC50YWdOYW1lLiBJZiB3ZQ0KCQkJCS8vIGRvIGl0IGhlcmUsIHdlIGNhbiBza2lwIHRoZSBzdHJpbmcgb3AgcGVyIG5vZGUNCgkJCQkvLyBjb21wYXJpc29uDQoJCQkJY3VycmVudFBhcnQudGFnID0gY3VycmVudFBhcnQudGFnLnRvVXBwZXJDYXNlKCk7DQoJCQl9DQoNCgkJCS8vIGFkZCB0aGUgcGFydCB0byB0aGUgbGlzdA0KCQkJaWYocXVlcnlQYXJ0cy5sZW5ndGggJiYgKHF1ZXJ5UGFydHNbcXVlcnlQYXJ0cy5sZW5ndGgtMV0ub3Blcikpew0KCQkJCS8vIG9wZXJhdG9ycyBhcmUgYWx3YXlzIGluZml4LCBzbyB3ZSByZW1vdmUgdGhlbSBmcm9tIHRoZQ0KCQkJCS8vIGxpc3QgYW5kIGF0dGFjaCB0aGVtIHRvIHRoZSBuZXh0IG1hdGNoLiBUaGUgZXZhbHVhdG9yIGlzDQoJCQkJLy8gcmVzcG9uc2libGUgZm9yIHNvcnRpbmcgb3V0IGhvdyB0byBoYW5kbGUgdGhlbS4NCgkJCQljdXJyZW50UGFydC5pbmZpeE9wZXIgPSBxdWVyeVBhcnRzLnBvcCgpOw0KCQkJCWN1cnJlbnRQYXJ0LnF1ZXJ5ID0gY3VycmVudFBhcnQuaW5maXhPcGVyLnF1ZXJ5ICsgIiAiICsgY3VycmVudFBhcnQucXVlcnk7DQoJCQkJLyoNCgkJCQljb25zb2xlLmRlYnVnKAkic3dhcHBpbmcgb3V0IHRoZSBpbmZpeCIsIA0KCQkJCQkJCQljdXJyZW50UGFydC5pbmZpeE9wZXIsIA0KCQkJCQkJCQkiYW5kIGF0dGFjaGluZyBpdCB0byIsIA0KCQkJCQkJCQljdXJyZW50UGFydCk7DQoJCQkJKi8NCgkJCX0NCgkJCXF1ZXJ5UGFydHMucHVzaChjdXJyZW50UGFydCk7DQoNCgkJCWN1cnJlbnRQYXJ0ID0gbnVsbDsNCgkJfQ0KDQoJCS8vIGl0ZXJhdGUgb3ZlciB0aGUgcXVlcnksIGNoYXJhY2h0ZXIgYnkgY2hhcmFjaHRlciwgYnVpbGRpbmcgdXAgYSANCgkJLy8gbGlzdCBvZiBxdWVyeSBwYXJ0IG9iamVjdHMNCgkJZm9yKDsgbGM9Y2MsIGNjPXF1ZXJ5LmNoYXJBdCh4KSwgeCA8IHFsOyB4Kyspew0KCQkJLy8JCWNjOiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaW4gdGhlIG1hdGNoDQoJCQkvLwkJbGM6IHRoZSBsYXN0IGNoYXJhY2h0ZXIgKGlmIGFueSkNCg0KCQkJLy8gc29tZW9uZSBpcyB0cnlpbmcgdG8gZXNjYXBlIHNvbWV0aGluZywgc28gZG9uJ3QgdHJ5IHRvIG1hdGNoIGFueQ0KCQkJLy8gZnJhZ21lbnRzLiBXZSBhc3N1bWUgd2UncmUgaW5zaWRlIGEgbGl0ZXJhbC4NCgkJCWlmKGxjID09ICJcXCIpeyBjb250aW51ZTsgfSANCgkJCWlmKCFjdXJyZW50UGFydCl7IC8vIGEgcGFydCB3YXMganVzdCBlbmRlZCBvciBub25lIGhhcyB5ZXQgYmVlbiBjcmVhdGVkDQoJCQkJLy8gTk9URTogSSBoYXRlIGFsbCB0aGlzIGFsbG9jLCBidXQgaXQncyBzaG9ydGVyIHRoYW4gd3JpdGluZyB0b25zIG9mIGlmJ3MNCgkJCQlwU3RhcnQgPSB4Ow0KCQkJCS8vCXJ1bGVzIGRlc2NyaWJlIGZ1bGwgQ1NTIHN1Yi1leHByZXNzaW9ucywgbGlrZToNCgkJCQkvLwkJI3NvbWVJZA0KCQkJCS8vCQkuY2xhc3NOYW1lOmZpcnN0LWNoaWxkDQoJCQkJLy8JYnV0IG5vdDoNCgkJCQkvLwkJdGhpbmdlciA+IGRpdi5ob3dkeVt0eXBlPXRoaW5nZXJdDQoJCQkJLy8JdGhlIGluZGlkdWFsIGNvbXBvbmVudHMgb2YgdGhlIHByZXZpb3VzIHF1ZXJ5IHdvdWxkIGJlDQoJCQkJLy8Jc3BsaXQgaW50byAzIHBhcnRzIHRoYXQgd291bGQgYmUgcmVwcmVzZW50ZWQgYSBzdHJ1Y3R1cmUNCgkJCQkvLwlsaWtlOg0KCQkJCS8vCQlbDQoJCQkJLy8JCQl7DQoJCQkJLy8JCQkJcXVlcnk6ICJ0aGluZ2VyIiwNCgkJCQkvLwkJCQl0YWc6ICJ0aGluZ2VyIiwNCgkJCQkvLwkJCX0sDQoJCQkJLy8JCQl7DQoJCQkJLy8JCQkJcXVlcnk6ICJkaXYuaG93ZHlbdHlwZT10aGluZ2VyXSIsDQoJCQkJLy8JCQkJY2xhc3NlczogWyJob3dkeSJdLA0KCQkJCS8vCQkJCWluZml4T3Blcjogew0KCQkJCS8vCQkJCQlxdWVyeTogIj4iLA0KCQkJCS8vCQkJCQlvcGVyOiAiPiIsDQoJCQkJLy8JCQkJfQ0KCQkJCS8vCQkJfSwNCgkJCQkvLwkJXQ0KCQkJCWN1cnJlbnRQYXJ0ID0gew0KCQkJCQlxdWVyeTogbnVsbCwgLy8gdGhlIGZ1bGwgdGV4dCBvZiB0aGUgcGFydCdzIHJ1bGUNCgkJCQkJcHNldWRvczogW10sIC8vIENTUyBzdXBwb3J0cyBtdWx0aXBsZSBwc2V1ZC1jbGFzcyBtYXRjaGVzIGluIGEgc2luZ2xlIHJ1bGUNCgkJCQkJYXR0cnM6IFtdLCAJLy8gQ1NTIHN1cHBvcnRzIG11bHRpLWF0dHJpYnV0ZSBtYXRjaCwgc28gd2UgbmVlZCBhbiBhcnJheQ0KCQkJCQljbGFzc2VzOiBbXSwgLy8gY2xhc3MgbWF0Y2hlcyBtYXkgYmUgYWRkaXRpdmUsIGUuZy46IC50aGluZ2VyLmJsYWguaG93ZHkNCgkJCQkJdGFnOiBudWxsLCAJLy8gb25seSBvbmUgdGFnLi4uDQoJCQkJCW9wZXI6IG51bGwsIC8vIC4uLm9yIG9wZXJhdG9yIHBlciBjb21wb25lbnQuIE5vdGUgdGhhdCB0aGVzZSB3aW5kIHVwIGJlaW5nIGV4Y2x1c2l2ZS4NCgkJCQkJaWQ6IG51bGwsIAkvLyB0aGUgaWQgY29tcG9uZW50IG9mIGEgcnVsZQ0KCQkJCQlnZXRUYWc6IGZ1bmN0aW9uKCl7DQoJCQkJCQlyZXR1cm4gKGNhc2VTZW5zaXRpdmUpID8gdGhpcy5vdGFnIDogdGhpcy50YWc7DQoJCQkJCX0NCgkJCQl9Ow0KDQoJCQkJLy8gaWYgd2UgZG9uJ3QgaGF2ZSBhIHBhcnQsIHdlIGFzc3VtZSB3ZSdyZSBnb2luZyB0byBzdGFydCBhdA0KCQkJCS8vIHRoZSBiZWdpbm5pbmcgb2YgYSBtYXRjaCwgd2hpY2ggc2hvdWxkIGJlIGEgdGFnIG5hbWUuIFRoaXMNCgkJCQkvLyBtaWdodCBmYXVsdCBhIGxpdHRsZSBsYXRlciBvbiwgYnV0IHdlIGRldGVjdCB0aGF0IGFuZCB0aGlzDQoJCQkJLy8gaXRlcmF0aW9uIHdpbGwgc3RpbGwgYmUgZmluZS4NCgkJCQlpblRhZyA9IHg7IA0KCQkJfQ0KDQoJCQlpZihpbkJyYWNrZXRzID49IDApew0KCQkJCS8vIGxvb2sgZm9yIGEgdGhlIGNsb3NlIGZpcnN0DQoJCQkJaWYoY2MgPT0gIl0iKXsgLy8gaWYgd2UncmUgaW4gYSBbLi4uXSBjbGF1c2UgYW5kIHdlIGVuZCwgZG8gYXNzaWdubWVudA0KCQkJCQlpZighX2NwLmF0dHIpew0KCQkJCQkJLy8gbm8gYXR0cmlidXRlIG1hdGNoIHdhcyBwcmV2aW91c2x5IGJlZ3VuLCBzbyB3ZQ0KCQkJCQkJLy8gYXNzdW1lIHRoaXMgaXMgYW4gYXR0cmlidXRlIGV4aXN0YW5jZSBtYXRjaCBpbiB0aGUNCgkJCQkJCS8vIGZvcm0gb2YgW3NvbWVBdHRyaWJ1dGVOYW1lXQ0KCQkJCQkJX2NwLmF0dHIgPSB0cyhpbkJyYWNrZXRzKzEsIHgpOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCS8vIHdlIGhhZCBhbiBhdHRyaWJ1dGUgYWxyZWFkeSwgc28gd2Uga25vdyB0aGF0IHdlJ3JlDQoJCQkJCQkvLyBtYXRjaGluZyBzb21lIHNvcnQgb2YgdmFsdWUsIGFzIGluIFthdHRyTmFtZT1ob3dkeV0NCgkJCQkJCV9jcC5tYXRjaEZvciA9IHRzKChpbk1hdGNoRm9yfHxpbkJyYWNrZXRzKzEpLCB4KTsNCgkJCQkJfQ0KCQkJCQl2YXIgY21mID0gX2NwLm1hdGNoRm9yOw0KCQkJCQlpZihjbWYpew0KCQkJCQkJLy8gdHJ5IHRvIHN0cmlwIHF1b3RlcyBmcm9tIHRoZSBtYXRjaEZvciB2YWx1ZS4gV2Ugd2FudA0KCQkJCQkJLy8gW2F0dHJOYW1lPWhvd2R5XSB0byBtYXRjaCB0aGUgc2FtZSANCgkJCQkJCS8vCWFzIFthdHRyTmFtZSA9ICdob3dkeScgXQ0KCQkJCQkJaWYoCShjbWYuY2hhckF0KDApID09ICciJykgfHwgKGNtZi5jaGFyQXQoMCkgID09ICInIikgKXsNCgkJCQkJCQlfY3AubWF0Y2hGb3IgPSBjbWYuc2xpY2UoMSwgLTEpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCS8vIGVuZCB0aGUgYXR0cmlidXRlIGJ5IGFkZGluZyBpdCB0byB0aGUgbGlzdCBvZiBhdHRyaWJ1dGVzLiANCgkJCQkJY3VycmVudFBhcnQuYXR0cnMucHVzaChfY3ApOw0KCQkJCQlfY3AgPSBudWxsOyAvLyBuZWNlc3Nhcnk/DQoJCQkJCWluQnJhY2tldHMgPSBpbk1hdGNoRm9yID0gLTE7DQoJCQkJfWVsc2UgaWYoY2MgPT0gIj0iKXsNCgkJCQkJLy8gaWYgdGhlIGxhc3QgY2hhciB3YXMgYW4gb3BlcmF0b3IgcHJlZml4LCBtYWtlIHN1cmUgd2UNCgkJCQkJLy8gcmVjb3JkIGl0IGFsb25nIHdpdGggdGhlICI9IiBvcGVyYXRvci4gDQoJCQkJCXZhciBhZGRUb0NjID0gKCJ8fl4kKiIuaW5kZXhPZihsYykgPj0wICkgPyBsYyA6ICIiOw0KCQkJCQlfY3AudHlwZSA9IGFkZFRvQ2MrY2M7DQoJCQkJCV9jcC5hdHRyID0gdHMoaW5CcmFja2V0cysxLCB4LWFkZFRvQ2MubGVuZ3RoKTsNCgkJCQkJaW5NYXRjaEZvciA9IHgrMTsNCgkJCQl9DQoJCQkJLy8gbm93IGxvb2sgZm9yIG90aGVyIGNsYXVzZSBwYXJ0cw0KCQkJfWVsc2UgaWYoaW5QYXJlbnMgPj0gMCl7DQoJCQkJLy8gaWYgd2UncmUgaW4gYSBwYXJlbnRoZXRpY2FsIGV4cHJlc3Npb24sIHdlIG5lZWQgdG8gZmlndXJlDQoJCQkJLy8gb3V0IGlmIGl0J3MgYXR0YWNoZWQgdG8gYSBwc2VkdW8tc2VsZWN0b3IgcnVsZSBsaWtlDQoJCQkJLy8gOm50aC1jaGlsZCgxKQ0KCQkJCWlmKGNjID09ICIpIil7DQoJCQkJCWlmKGluUHNldWRvID49IDApew0KCQkJCQkJX2NwLnZhbHVlID0gdHMoaW5QYXJlbnMrMSwgeCk7DQoJCQkJCX0NCgkJCQkJaW5Qc2V1ZG8gPSBpblBhcmVucyA9IC0xOw0KCQkJCX0NCgkJCX1lbHNlIGlmKGNjID09ICIjIil7DQoJCQkJLy8gc3RhcnQgb2YgYW4gSUQgbWF0Y2gNCgkJCQllbmRBbGwoKTsNCgkJCQlpbklkID0geCsxOw0KCQkJfWVsc2UgaWYoY2MgPT0gIi4iKXsNCgkJCQkvLyBzdGFydCBvZiBhIGNsYXNzIG1hdGNoDQoJCQkJZW5kQWxsKCk7DQoJCQkJaW5DbGFzcyA9IHg7DQoJCQl9ZWxzZSBpZihjYyA9PSAiOiIpew0KCQkJCS8vIHN0YXJ0IG9mIGEgcHNldWRvLXNlbGVjdG9yIG1hdGNoDQoJCQkJZW5kQWxsKCk7DQoJCQkJaW5Qc2V1ZG8gPSB4Ow0KCQkJfWVsc2UgaWYoY2MgPT0gIlsiKXsNCgkJCQkvLyBzdGFydCBvZiBhbiBhdHRyaWJ1dGUgbWF0Y2guIA0KCQkJCWVuZEFsbCgpOw0KCQkJCWluQnJhY2tldHMgPSB4Ow0KCQkJCS8vIHByb3ZpZGUgYSBuZXcgc3RydWN0dXJlIGZvciB0aGUgYXR0cmlidXRlIG1hdGNoIHRvIGZpbGwtaW4NCgkJCQlfY3AgPSB7DQoJCQkJCS8qPT09PT0NCgkJCQkJYXR0cjogbnVsbCwgdHlwZTogbnVsbCwgbWF0Y2hGb3I6IG51bGwNCgkJCQkJPT09PT0qLw0KCQkJCX07DQoJCQl9ZWxzZSBpZihjYyA9PSAiKCIpew0KCQkJCS8vIHdlIHJlYWxseSBvbmx5IGNhcmUgaWYgd2UndmUgZW50ZXJlZCBhIHBhcmVudGhldGljYWwNCgkJCQkvLyBleHByZXNzaW9uIGlmIHdlJ3JlIGFscmVhZHkgaW5zaWRlIGEgcHNldWRvLXNlbGVjdG9yIG1hdGNoDQoJCQkJaWYoaW5Qc2V1ZG8gPj0gMCl7DQoJCQkJCS8vIHByb3ZpZGUgYSBuZXcgc3RydWN0dXJlIGZvciB0aGUgcHNldWRvIG1hdGNoIHRvIGZpbGwtaW4NCgkJCQkJX2NwID0geyANCgkJCQkJCW5hbWU6IHRzKGluUHNldWRvKzEsIHgpLCANCgkJCQkJCXZhbHVlOiBudWxsDQoJCQkJCX0NCgkJCQkJY3VycmVudFBhcnQucHNldWRvcy5wdXNoKF9jcCk7DQoJCQkJfQ0KCQkJCWluUGFyZW5zID0geDsNCgkJCX1lbHNlIGlmKA0KCQkJCShjYyA9PSAiICIpICYmIA0KCQkJCS8vIGlmIGl0J3MgYSBzcGFjZSBjaGFyIGFuZCB0aGUgbGFzdCBjaGFyIGlzIHRvbywgY29uc3VtZSB0aGUNCgkJCQkvLyBjdXJyZW50IG9uZSB3aXRob3V0IGRvaW5nIG1vcmUgd29yaw0KCQkJCShsYyAhPSBjYykNCgkJCSl7DQoJCQkJZW5kUGFydCgpOw0KCQkJfQ0KCQl9DQoJCXJldHVybiBxdWVyeVBhcnRzOw0KCX07DQoJDQoNCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCgkvLyBET00gcXVlcnkgaW5mcmFzdHJ1Y3R1cmUNCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KCXZhciBhZ3JlZSA9IGZ1bmN0aW9uKGZpcnN0LCBzZWNvbmQpew0KCQkvLyB0aGUgYmFzaWMgYnVpbGRpbmcgYmxvY2sgb2YgdGhlIHllcy9ubyBjaGFpbmluZyBzeXN0ZW0uIGFncmVlKGYxLA0KCQkvLyBmMikgZ2VuZXJhdGVzIGEgbmV3IGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdGhlIGJvb2xlYW4gcmVzdWx0cyBvZg0KCQkvLyBib3RoIG9mIHRoZSBwYXNzZWQgZnVuY3Rpb25zIHRvIGEgc2luZ2xlIGxvZ2ljYWwtYW5kZWQgcmVzdWx0LiBJZg0KCQkvLyBlaXRoZXIgYXJlIG5vdCBwb3NzZWQsIHRoZSBvdGhlciBpcyB1c2VkIGV4Y2x1c2l2ZWx5Lg0KCQlpZighZmlyc3QpeyByZXR1cm4gc2Vjb25kOyB9DQoJCWlmKCFzZWNvbmQpeyByZXR1cm4gZmlyc3Q7IH0NCg0KCQlyZXR1cm4gZnVuY3Rpb24oKXsNCgkJCXJldHVybiBmaXJzdC5hcHBseSh3aW5kb3csIGFyZ3VtZW50cykgJiYgc2Vjb25kLmFwcGx5KHdpbmRvdywgYXJndW1lbnRzKTsNCgkJfQ0KCX07DQoNCgl2YXIgZ2V0QXJyID0gZnVuY3Rpb24oaSwgYXJyKXsNCgkJLy8gaGVscHMgdXMgYXZvaWQgYXJyYXkgYWxsb2Mgd2hlbiB3ZSBkb24ndCBuZWVkIGl0DQoJCXZhciByID0gYXJyfHxbXTsgLy8gRklYTUU6IHNob3VsZCB0aGlzIGJlICduZXcgZC5fTm9kZUxpc3RDdG9yKCknID8NCgkJaWYoaSl7IHIucHVzaChpKTsgfQ0KCQlyZXR1cm4gcjsNCgl9Ow0KDQoJdmFyIF9pc0VsZW1lbnQgPSBmdW5jdGlvbihuKXsgcmV0dXJuICgxID09IG4ubm9kZVR5cGUpOyB9Ow0KDQoJLy8gRklYTUU6IG5lZWQgdG8gY29hbGVzY2UgX2dldEF0dHIgd2l0aCBkZWZhdWx0R2V0dGVyDQoJdmFyIGJsYW5rID0gIiI7DQoJdmFyIF9nZXRBdHRyID0gZnVuY3Rpb24oZWxlbSwgYXR0cil7DQoJCWlmKCFlbGVtKXsgcmV0dXJuIGJsYW5rOyB9DQoJCWlmKGF0dHIgPT0gImNsYXNzIil7DQoJCQlyZXR1cm4gZWxlbS5jbGFzc05hbWUgfHwgYmxhbms7DQoJCX0NCgkJaWYoYXR0ciA9PSAiZm9yIil7DQoJCQlyZXR1cm4gZWxlbS5odG1sRm9yIHx8IGJsYW5rOw0KCQl9DQoJCWlmKGF0dHIgPT0gInN0eWxlIil7DQoJCQlyZXR1cm4gZWxlbS5zdHlsZS5jc3NUZXh0IHx8IGJsYW5rOw0KCQl9DQoJCXJldHVybiAoY2FzZVNlbnNpdGl2ZSA/IGVsZW0uZ2V0QXR0cmlidXRlKGF0dHIpIDogZWxlbS5nZXRBdHRyaWJ1dGUoYXR0ciwgMikpIHx8IGJsYW5rOw0KCX07DQoNCgl2YXIgYXR0cnMgPSB7DQoJCSIqPSI6IGZ1bmN0aW9uKGF0dHIsIHZhbHVlKXsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQkvLyBFW2Zvbyo9ImJhciJdDQoJCQkJLy8JCWFuIEUgZWxlbWVudCB3aG9zZSAiZm9vIiBhdHRyaWJ1dGUgdmFsdWUgY29udGFpbnMNCgkJCQkvLwkJdGhlIHN1YnN0cmluZyAiYmFyIg0KCQkJCXJldHVybiAoX2dldEF0dHIoZWxlbSwgYXR0cikuaW5kZXhPZih2YWx1ZSk+PTApOw0KCQkJfQ0KCQl9LA0KCQkiXj0iOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7DQoJCQkvLyBFW2Zvb149ImJhciJdDQoJCQkvLwkJYW4gRSBlbGVtZW50IHdob3NlICJmb28iIGF0dHJpYnV0ZSB2YWx1ZSBiZWdpbnMgZXhhY3RseQ0KCQkJLy8JCXdpdGggdGhlIHN0cmluZyAiYmFyIg0KCQkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJCXJldHVybiAoX2dldEF0dHIoZWxlbSwgYXR0cikuaW5kZXhPZih2YWx1ZSk9PTApOw0KCQkJfQ0KCQl9LA0KCQkiJD0iOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7DQoJCQkvLyBFW2ZvbyQ9ImJhciJdCQ0KCQkJLy8JCWFuIEUgZWxlbWVudCB3aG9zZSAiZm9vIiBhdHRyaWJ1dGUgdmFsdWUgZW5kcyBleGFjdGx5DQoJCQkvLwkJd2l0aCB0aGUgc3RyaW5nICJiYXIiDQoJCQl2YXIgdHZhbCA9ICIgIit2YWx1ZTsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQl2YXIgZWEgPSAiICIrX2dldEF0dHIoZWxlbSwgYXR0cik7DQoJCQkJcmV0dXJuIChlYS5sYXN0SW5kZXhPZih2YWx1ZSk9PShlYS5sZW5ndGgtdmFsdWUubGVuZ3RoKSk7DQoJCQl9DQoJCX0sDQoJCSJ+PSI6IGZ1bmN0aW9uKGF0dHIsIHZhbHVlKXsNCgkJCS8vIEVbZm9vfj0iYmFyIl0JDQoJCQkvLwkJYW4gRSBlbGVtZW50IHdob3NlICJmb28iIGF0dHJpYnV0ZSB2YWx1ZSBpcyBhIGxpc3Qgb2YNCgkJCS8vCQlzcGFjZS1zZXBhcmF0ZWQgdmFsdWVzLCBvbmUgb2Ygd2hpY2ggaXMgZXhhY3RseSBlcXVhbA0KCQkJLy8JCXRvICJiYXIiDQoNCgkJCS8vIHJldHVybiAiW2NvbnRhaW5zKGNvbmNhdCgnICcsQCIrYXR0cisiLCcgJyksICcgIisgdmFsdWUgKyIgJyldIjsNCgkJCXZhciB0dmFsID0gIiAiK3ZhbHVlKyIgIjsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQl2YXIgZWEgPSAiICIrX2dldEF0dHIoZWxlbSwgYXR0cikrIiAiOw0KCQkJCXJldHVybiAoZWEuaW5kZXhPZih0dmFsKT49MCk7DQoJCQl9DQoJCX0sDQoJCSJ8PSI6IGZ1bmN0aW9uKGF0dHIsIHZhbHVlKXsNCgkJCS8vIEVbaHJlZmxhbmd8PSJlbiJdDQoJCQkvLwkJYW4gRSBlbGVtZW50IHdob3NlICJocmVmbGFuZyIgYXR0cmlidXRlIGhhcyBhDQoJCQkvLwkJaHlwaGVuLXNlcGFyYXRlZCBsaXN0IG9mIHZhbHVlcyBiZWdpbm5pbmcgKGZyb20gdGhlDQoJCQkvLwkJbGVmdCkgd2l0aCAiZW4iDQoJCQl2YXIgdmFsdWVEYXNoID0gIiAiK3ZhbHVlKyItIjsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQl2YXIgZWEgPSAiICIrX2dldEF0dHIoZWxlbSwgYXR0cik7DQoJCQkJcmV0dXJuICgNCgkJCQkJKGVhID09IHZhbHVlKSB8fA0KCQkJCQkoZWEuaW5kZXhPZih2YWx1ZURhc2gpPT0wKQ0KCQkJCSk7DQoJCQl9DQoJCX0sDQoJCSI9IjogZnVuY3Rpb24oYXR0ciwgdmFsdWUpew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJCXJldHVybiAoX2dldEF0dHIoZWxlbSwgYXR0cikgPT0gdmFsdWUpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCS8vIGF2b2lkIHRlc3RpbmcgZm9yIG5vZGUgdHlwZSBpZiB3ZSBjYW4uIERlZmluaW5nIHRoaXMgaW4gdGhlIG5lZ2F0aXZlDQoJLy8gaGVyZSB0byBhdm9pZCBuZWdhdGlvbiBpbiB0aGUgZmFzdCBwYXRoLg0KCXZhciBfbm9ORVMgPSAodHlwZW9mIGdldERvYygpLmZpcnN0Q2hpbGQubmV4dEVsZW1lbnRTaWJsaW5nID09ICJ1bmRlZmluZWQiKTsNCgl2YXIgX25zID0gIV9ub05FUyA/ICJuZXh0RWxlbWVudFNpYmxpbmciIDogIm5leHRTaWJsaW5nIjsNCgl2YXIgX3BzID0gIV9ub05FUyA/ICJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciOw0KCXZhciBfc2ltcGxlTm9kZVRlc3QgPSAoX25vTkVTID8gX2lzRWxlbWVudCA6IHllc21hbik7DQoNCgl2YXIgX2xvb2tMZWZ0ID0gZnVuY3Rpb24obm9kZSl7DQoJCS8vIGxvb2sgbGVmdA0KCQl3aGlsZShub2RlID0gbm9kZVtfcHNdKXsNCgkJCWlmKF9zaW1wbGVOb2RlVGVzdChub2RlKSl7IHJldHVybiBmYWxzZTsgfQ0KCQl9DQoJCXJldHVybiB0cnVlOw0KCX07DQoNCgl2YXIgX2xvb2tSaWdodCA9IGZ1bmN0aW9uKG5vZGUpew0KCQkvLyBsb29rIHJpZ2h0DQoJCXdoaWxlKG5vZGUgPSBub2RlW19uc10pew0KCQkJaWYoX3NpbXBsZU5vZGVUZXN0KG5vZGUpKXsgcmV0dXJuIGZhbHNlOyB9DQoJCX0NCgkJcmV0dXJuIHRydWU7DQoJfTsNCg0KCXZhciBnZXROb2RlSW5kZXggPSBmdW5jdGlvbihub2RlKXsNCgkJdmFyIHJvb3QgPSBub2RlLnBhcmVudE5vZGU7DQoJCXZhciBpID0gMCwNCgkJCXRyZXQgPSByb290W2NoaWxkTm9kZXNOYW1lXSwNCgkJCWNpID0gKG5vZGVbIl9pIl18fC0xKSwNCgkJCWNsID0gKHJvb3RbIl9sIl18fC0xKTsNCg0KCQlpZighdHJldCl7IHJldHVybiAtMTsgfQ0KCQl2YXIgbCA9IHRyZXQubGVuZ3RoOw0KDQoJCS8vIHdlIGNhbGN1YXRlIHRoZSBwYXJlbnQgbGVuZ3RoIGFzIGEgY2hlYXAgd2F5IHRvIGludmFsaWRhdGUgdGhlDQoJCS8vIGNhY2hlLiBJdCdzIG5vdCAxMDAlIGFjY3VyYXRlLCBidXQgaXQncyBtdWNoIG1vcmUgaG9uZXN0IHRoYW4gd2hhdA0KCQkvLyBvdGhlciBsaWJyYXJpZXMgZG8NCgkJaWYoIGNsID09IGwgJiYgY2kgPj0gMCAmJiBjbCA+PSAwICl7DQoJCQkvLyBpZiBpdCdzIGxlZ2l0LCB0YWcgYW5kIHJlbGVhc2UNCgkJCXJldHVybiBjaTsNCgkJfQ0KDQoJCS8vIGVsc2UgcmUta2V5IHRoaW5ncw0KCQlyb290WyJfbCJdID0gbDsNCgkJY2kgPSAtMTsNCgkJZm9yKHZhciB0ZSA9IHJvb3RbImZpcnN0RWxlbWVudENoaWxkIl18fHJvb3RbImZpcnN0Q2hpbGQiXTsgdGU7IHRlID0gdGVbX25zXSl7DQoJCQlpZihfc2ltcGxlTm9kZVRlc3QodGUpKXsgDQoJCQkJdGVbIl9pIl0gPSArK2k7DQoJCQkJaWYobm9kZSA9PT0gdGUpeyANCgkJCQkJLy8gTk9URToNCgkJCQkJLy8gCXNob3J0Y3V0aW5nIHRoZSByZXR1cm4gYXQgdGhpcyBzdGVwIGluIGluZGV4aW5nIHdvcmtzDQoJCQkJCS8vIAl2ZXJ5IHdlbGwgZm9yIGJlbmNobWFya2luZyBidXQgd2UgYXZvaWQgaXQgaGVyZSBzaW5jZQ0KCQkJCQkvLyAJaXQgbGVhZHMgdG8gcG90ZW50aWFsIE8obl4yKSBiZWhhdmlvciBpbiBzZXF1ZW50aWFsDQoJCQkJCS8vIAlnZXROb2RleEluZGV4IG9wZXJhdGlvbnMgb24gYSBwcmV2aW91c2x5IHVuLWluZGV4ZWQNCgkJCQkJLy8gCXBhcmVudC4gV2UgbWF5IHJldmlzaXQgdGhpcyBhdCBhIGxhdGVyIHRpbWUsIGJ1dCBmb3INCgkJCQkJLy8gCW5vdyB3ZSBqdXN0IHdhbnQgdG8gZ2V0IHRoZSByaWdodCBhbnN3ZXIgbW9yZSBvZnRlbg0KCQkJCQkvLyAJdGhhbiBub3QuDQoJCQkJCWNpID0gaTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJcmV0dXJuIGNpOw0KCX07DQoNCgl2YXIgaXNFdmVuID0gZnVuY3Rpb24oZWxlbSl7DQoJCXJldHVybiAhKChnZXROb2RlSW5kZXgoZWxlbSkpICUgMik7DQoJfTsNCg0KCXZhciBpc09kZCA9IGZ1bmN0aW9uKGVsZW0pew0KCQlyZXR1cm4gKChnZXROb2RlSW5kZXgoZWxlbSkpICUgMik7DQoJfTsNCg0KCXZhciBwc2V1ZG9zID0gew0KCQkiY2hlY2tlZCI6IGZ1bmN0aW9uKG5hbWUsIGNvbmRpdGlvbil7DQoJCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQkJcmV0dXJuICEhKCJjaGVja2VkIiBpbiBlbGVtID8gZWxlbS5jaGVja2VkIDogZWxlbS5zZWxlY3RlZCk7DQoJCQl9DQoJCX0sDQoJCSJmaXJzdC1jaGlsZCI6IGZ1bmN0aW9uKCl7IHJldHVybiBfbG9va0xlZnQ7IH0sDQoJCSJsYXN0LWNoaWxkIjogZnVuY3Rpb24oKXsgcmV0dXJuIF9sb29rUmlnaHQ7IH0sDQoJCSJvbmx5LWNoaWxkIjogZnVuY3Rpb24obmFtZSwgY29uZGl0aW9uKXsNCgkJCXJldHVybiBmdW5jdGlvbihub2RlKXsgDQoJCQkJaWYoIV9sb29rTGVmdChub2RlKSl7IHJldHVybiBmYWxzZTsgfQ0KCQkJCWlmKCFfbG9va1JpZ2h0KG5vZGUpKXsgcmV0dXJuIGZhbHNlOyB9DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9Ow0KCQl9LA0KCQkiZW1wdHkiOiBmdW5jdGlvbihuYW1lLCBjb25kaXRpb24pew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJCS8vIERvbVF1ZXJ5IGFuZCBqUXVlcnkgZ2V0IHRoaXMgd3JvbmcsIG9kZGx5IGVub3VnaC4NCgkJCQkvLyBUaGUgQ1NTIDMgc2VsZWN0b3JzIHNwZWMgaXMgcHJldHR5IGV4cGxpY2l0IGFib3V0IGl0LCB0b28uDQoJCQkJdmFyIGNuID0gZWxlbS5jaGlsZE5vZGVzOw0KCQkJCXZhciBjbmwgPSBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOw0KCQkJCS8vIGlmKCFjbmwpeyByZXR1cm4gdHJ1ZTsgfQ0KCQkJCWZvcih2YXIgeD1jbmwtMTsgeCA+PSAwOyB4LS0pew0KCQkJCQl2YXIgbnQgPSBjblt4XS5ub2RlVHlwZTsNCgkJCQkJaWYoKG50ID09PSAxKXx8KG50ID09IDMpKXsgcmV0dXJuIGZhbHNlOyB9DQoJCQkJfQ0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9LA0KCQkiY29udGFpbnMiOiBmdW5jdGlvbihuYW1lLCBjb25kaXRpb24pew0KCQkJdmFyIGN6ID0gY29uZGl0aW9uLmNoYXJBdCgwKTsNCgkJCWlmKCBjeiA9PSAnIicgfHwgY3ogPT0gIiciICl7IC8vcmVtb3ZlIHF1b3RlDQoJCQkJY29uZGl0aW9uID0gY29uZGl0aW9uLnNsaWNlKDEsIC0xKTsNCgkJCX0NCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQlyZXR1cm4gKGVsZW0uaW5uZXJIVE1MLmluZGV4T2YoY29uZGl0aW9uKSA+PSAwKTsNCgkJCX0NCgkJfSwNCgkJIm5vdCI6IGZ1bmN0aW9uKG5hbWUsIGNvbmRpdGlvbil7DQoJCQl2YXIgcCA9IGdldFF1ZXJ5UGFydHMoY29uZGl0aW9uKVswXTsNCgkJCXZhciBpZ25vcmVzID0geyBlbDogMSB9OyANCgkJCWlmKHAudGFnICE9ICIqIil7DQoJCQkJaWdub3Jlcy50YWcgPSAxOw0KCQkJfQ0KCQkJaWYoIXAuY2xhc3Nlcy5sZW5ndGgpew0KCQkJCWlnbm9yZXMuY2xhc3NlcyA9IDE7DQoJCQl9DQoJCQl2YXIgbnRmID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhwLCBpZ25vcmVzKTsNCgkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQlyZXR1cm4gKCFudGYoZWxlbSkpOw0KCQkJfQ0KCQl9LA0KCQkibnRoLWNoaWxkIjogZnVuY3Rpb24obmFtZSwgY29uZGl0aW9uKXsNCgkJCXZhciBwaSA9IHBhcnNlSW50Ow0KCQkJLy8gYXZvaWQgcmUtZGVmaW5pbmcgZnVuY3Rpb24gb2JqZWN0cyBpZiB3ZSBjYW4NCgkJCWlmKGNvbmRpdGlvbiA9PSAib2RkIil7DQoJCQkJcmV0dXJuIGlzT2RkOw0KCQkJfWVsc2UgaWYoY29uZGl0aW9uID09ICJldmVuIil7DQoJCQkJcmV0dXJuIGlzRXZlbjsNCgkJCX0NCgkJCS8vIEZJWE1FOiBjYW4gd2Ugc2hvcnRlbiB0aGlzPw0KCQkJaWYoY29uZGl0aW9uLmluZGV4T2YoIm4iKSAhPSAtMSl7DQoJCQkJdmFyIHRwYXJ0cyA9IGNvbmRpdGlvbi5zcGxpdCgibiIsIDIpOw0KCQkJCXZhciBwcmVkID0gdHBhcnRzWzBdID8gKCh0cGFydHNbMF0gPT0gJy0nKSA/IC0xIDogcGkodHBhcnRzWzBdKSkgOiAxOw0KCQkJCXZhciBpZHggPSB0cGFydHNbMV0gPyBwaSh0cGFydHNbMV0pIDogMDsNCgkJCQl2YXIgbGIgPSAwLCB1YiA9IC0xOw0KCQkJCWlmKHByZWQgPiAwKXsNCgkJCQkJaWYoaWR4IDwgMCl7DQoJCQkJCQlpZHggPSAoaWR4ICUgcHJlZCkgJiYgKHByZWQgKyAoaWR4ICUgcHJlZCkpOw0KCQkJCQl9ZWxzZSBpZihpZHg+MCl7DQoJCQkJCQlpZihpZHggPj0gcHJlZCl7DQoJCQkJCQkJbGIgPSBpZHggLSBpZHggJSBwcmVkOw0KCQkJCQkJfQ0KCQkJCQkJaWR4ID0gaWR4ICUgcHJlZDsNCgkJCQkJfQ0KCQkJCX1lbHNlIGlmKHByZWQ8MCl7DQoJCQkJCXByZWQgKj0gLTE7DQoJCQkJCS8vIGlkeCBoYXMgdG8gYmUgZ3JlYXRlciB0aGFuIDAgd2hlbiBwcmVkIGlzIG5lZ2F0aXZlOw0KCQkJCQkvLyBzaGFsbCB3ZSB0aHJvdyBhbiBlcnJvciBoZXJlPw0KCQkJCQlpZihpZHggPiAwKXsNCgkJCQkJCXViID0gaWR4Ow0KCQkJCQkJaWR4ID0gaWR4ICUgcHJlZDsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZihwcmVkID4gMCl7DQoJCQkJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCQkJCXZhciBpID0gZ2V0Tm9kZUluZGV4KGVsZW0pOw0KCQkJCQkJcmV0dXJuIChpPj1sYikgJiYgKHViPDAgfHwgaTw9dWIpICYmICgoaSAlIHByZWQpID09IGlkeCk7DQoJCQkJCX0NCgkJCQl9ZWxzZXsNCgkJCQkJY29uZGl0aW9uID0gaWR4Ow0KCQkJCX0NCgkJCX0NCgkJCXZhciBuY291bnQgPSBwaShjb25kaXRpb24pOw0KCQkJcmV0dXJuIGZ1bmN0aW9uKGVsZW0pew0KCQkJCXJldHVybiAoZ2V0Tm9kZUluZGV4KGVsZW0pID09IG5jb3VudCk7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdmFyIGRlZmF1bHRHZXR0ZXIgPSAoZC5pc0lFKSA/IGZ1bmN0aW9uKGNvbmQpew0KCQl2YXIgY2xjID0gY29uZC50b0xvd2VyQ2FzZSgpOw0KCQlpZihjbGMgPT0gImNsYXNzIil7IGNvbmQgPSAiY2xhc3NOYW1lIjsgfQ0KCQlyZXR1cm4gZnVuY3Rpb24oZWxlbSl7DQoJCQlyZXR1cm4gKGNhc2VTZW5zaXRpdmUgPyBlbGVtLmdldEF0dHJpYnV0ZShjb25kKSA6IGVsZW1bY29uZF18fGVsZW1bY2xjXSk7DQoJCX0NCgl9IDogZnVuY3Rpb24oY29uZCl7DQoJCXJldHVybiBmdW5jdGlvbihlbGVtKXsNCgkJCXJldHVybiAoZWxlbSAmJiBlbGVtLmdldEF0dHJpYnV0ZSAmJiBlbGVtLmhhc0F0dHJpYnV0ZShjb25kKSk7DQoJCX0NCgl9Ow0KDQoJdmFyIGdldFNpbXBsZUZpbHRlckZ1bmMgPSBmdW5jdGlvbihxdWVyeSwgaWdub3Jlcyl7DQoJCS8vIGdlbmVyYXRlcyBhIG5vZGUgdGVzdGVyIGZ1bmN0aW9uIGJhc2VkIG9uIHRoZSBwYXNzZWQgcXVlcnkgcGFydC4gVGhlDQoJCS8vIHF1ZXJ5IHBhcnQgaXMgb25lIG9mIHRoZSBzdHJ1Y3R1cmVzIGdlbmVyYXRkIGJ5IHRoZSBxdWVyeSBwYXJzZXINCgkJLy8gd2hlbiBpdCBjcmVhdGVzIHRoZSBxdWVyeSBBU1QuIFRoZSAiaWdub3JlcyIgb2JqZWN0IHNwZWNpZmllcyB3aGljaA0KCQkvLyAoaWYgYW55KSB0ZXN0cyB0byBza2lwLCBhbGxvd2luZyB0aGUgc3lzdGVtIHRvIGF2b2lkIGR1cGxpY2F0aW5nDQoJCS8vIHdvcmsgd2hlcmUgaXQgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIHRha2VuIGludG8gYWNjb3VudCBieSBvdGhlcg0KCQkvLyBmYWN0b3JzIHN1Y2ggYXMgaG93IHRoZSBub2RlcyB0byB0ZXN0IHdlcmUgZmV0Y2hlZCBpbiB0aGUgZmlyc3QNCgkJLy8gcGxhY2UNCgkJaWYoIXF1ZXJ5KXsgcmV0dXJuIHllc21hbjsgfQ0KCQlpZ25vcmVzID0gaWdub3Jlc3x8e307DQoNCgkJdmFyIGZmID0gbnVsbDsNCg0KCQlpZighKCJlbCIgaW4gaWdub3Jlcykpew0KCQkJZmYgPSBhZ3JlZShmZiwgX2lzRWxlbWVudCk7DQoJCX0NCg0KCQlpZighKCJ0YWciIGluIGlnbm9yZXMpKXsNCgkJCWlmKHF1ZXJ5LnRhZyAhPSAiKiIpew0KCQkJCWZmID0gYWdyZWUoZmYsIGZ1bmN0aW9uKGVsZW0pew0KCQkJCQlyZXR1cm4gKGVsZW0gJiYgKGVsZW0udGFnTmFtZSA9PSBxdWVyeS5nZXRUYWcoKSkpOw0KCQkJCX0pOw0KCQkJfQ0KCQl9DQoNCgkJaWYoISgiY2xhc3NlcyIgaW4gaWdub3Jlcykpew0KCQkJZWFjaChxdWVyeS5jbGFzc2VzLCBmdW5jdGlvbihjbmFtZSwgaWR4LCBhcnIpew0KCQkJCS8vIGdldCB0aGUgY2xhc3MgbmFtZQ0KCQkJCS8qDQoJCQkJdmFyIGlzV2lsZGNhcmQgPSBjbmFtZS5jaGFyQXQoY25hbWUubGVuZ3RoLTEpID09ICIqIjsNCgkJCQlpZihpc1dpbGRjYXJkKXsNCgkJCQkJY25hbWUgPSBjbmFtZS5zdWJzdHIoMCwgY25hbWUubGVuZ3RoLTEpOw0KCQkJCX0NCgkJCQkvLyBJIGRpc2xpa2UgdGhlIHJlZ2V4IHRoaW5nLCBldmVuIGlmIG1lbW96aWVkIGluIGEgY2FjaGUsIGJ1dCBpdCdzIFZFUlkgc2hvcnQNCgkJCQl2YXIgcmUgPSBuZXcgUmVnRXhwKCIoPzpefFxccykiICsgY25hbWUgKyAoaXNXaWxkY2FyZCA/ICIuKiIgOiAiIikgKyAiKD86XFxzfCQpIik7DQoJCQkJKi8NCgkJCQl2YXIgcmUgPSBuZXcgUmVnRXhwKCIoPzpefFxccykiICsgY25hbWUgKyAiKD86XFxzfCQpIik7DQoJCQkJZmYgPSBhZ3JlZShmZiwgZnVuY3Rpb24oZWxlbSl7DQoJCQkJCXJldHVybiByZS50ZXN0KGVsZW0uY2xhc3NOYW1lKTsNCgkJCQl9KTsNCgkJCQlmZi5jb3VudCA9IGlkeDsNCgkJCX0pOw0KCQl9DQoNCgkJaWYoISgicHNldWRvcyIgaW4gaWdub3Jlcykpew0KCQkJZWFjaChxdWVyeS5wc2V1ZG9zLCBmdW5jdGlvbihwc2V1ZG8pew0KCQkJCXZhciBwbiA9IHBzZXVkby5uYW1lOw0KCQkJCWlmKHBzZXVkb3NbcG5dKXsNCgkJCQkJZmYgPSBhZ3JlZShmZiwgcHNldWRvc1twbl0ocG4sIHBzZXVkby52YWx1ZSkpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoNCgkJaWYoISgiYXR0cnMiIGluIGlnbm9yZXMpKXsNCgkJCWVhY2gocXVlcnkuYXR0cnMsIGZ1bmN0aW9uKGF0dHIpew0KCQkJCXZhciBtYXRjaGVyOw0KCQkJCXZhciBhID0gYXR0ci5hdHRyOw0KCQkJCS8vIHR5cGUsIGF0dHIsIG1hdGNoRm9yDQoJCQkJaWYoYXR0ci50eXBlICYmIGF0dHJzW2F0dHIudHlwZV0pew0KCQkJCQltYXRjaGVyID0gYXR0cnNbYXR0ci50eXBlXShhLCBhdHRyLm1hdGNoRm9yKTsNCgkJCQl9ZWxzZSBpZihhLmxlbmd0aCl7DQoJCQkJCW1hdGNoZXIgPSBkZWZhdWx0R2V0dGVyKGEpOw0KCQkJCX0NCgkJCQlpZihtYXRjaGVyKXsNCgkJCQkJZmYgPSBhZ3JlZShmZiwgbWF0Y2hlcik7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCg0KCQlpZighKCJpZCIgaW4gaWdub3Jlcykpew0KCQkJaWYocXVlcnkuaWQpew0KCQkJCWZmID0gYWdyZWUoZmYsIGZ1bmN0aW9uKGVsZW0peyANCgkJCQkJcmV0dXJuICghIWVsZW0gJiYgKGVsZW0uaWQgPT0gcXVlcnkuaWQpKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KDQoJCWlmKCFmZil7DQoJCQlpZighKCJkZWZhdWx0IiBpbiBpZ25vcmVzKSl7DQoJCQkJZmYgPSB5ZXNtYW47IA0KCQkJfQ0KCQl9DQoJCXJldHVybiBmZjsNCgl9Ow0KDQoJdmFyIF9uZXh0U2libGluZyA9IGZ1bmN0aW9uKGZpbHRlckZ1bmMpew0KCQlyZXR1cm4gZnVuY3Rpb24obm9kZSwgcmV0LCBiYWcpew0KCQkJd2hpbGUobm9kZSA9IG5vZGVbX25zXSl7DQoJCQkJaWYoX25vTkVTICYmICghX2lzRWxlbWVudChub2RlKSkpeyBjb250aW51ZTsgfQ0KCQkJCWlmKA0KCQkJCQkoIWJhZyB8fCBfaXNVbmlxdWUobm9kZSwgYmFnKSkgJiYNCgkJCQkJZmlsdGVyRnVuYyhub2RlKQ0KCQkJCSl7DQoJCQkJCXJldC5wdXNoKG5vZGUpOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCX0NCgkJCXJldHVybiByZXQ7DQoJCX0NCgl9Ow0KDQoJdmFyIF9uZXh0U2libGluZ3MgPSBmdW5jdGlvbihmaWx0ZXJGdW5jKXsNCgkJcmV0dXJuIGZ1bmN0aW9uKHJvb3QsIHJldCwgYmFnKXsNCgkJCXZhciB0ZSA9IHJvb3RbX25zXTsNCgkJCXdoaWxlKHRlKXsNCgkJCQlpZihfc2ltcGxlTm9kZVRlc3QodGUpKXsNCgkJCQkJaWYoYmFnICYmICFfaXNVbmlxdWUodGUsIGJhZykpew0KCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQkJaWYoZmlsdGVyRnVuYyh0ZSkpew0KCQkJCQkJcmV0LnB1c2godGUpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCXRlID0gdGVbX25zXTsNCgkJCX0NCgkJCXJldHVybiByZXQ7DQoJCX0NCgl9Ow0KDQoJLy8gZ2V0IGFuIGFycmF5IG9mIGNoaWxkICplbGVtZW50cyosIHNraXBwaW5nIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMNCgl2YXIgX2NoaWxkRWxlbWVudHMgPSBmdW5jdGlvbihmaWx0ZXJGdW5jKXsNCgkJZmlsdGVyRnVuYyA9IGZpbHRlckZ1bmN8fHllc21hbjsNCgkJcmV0dXJuIGZ1bmN0aW9uKHJvb3QsIHJldCwgYmFnKXsNCgkJCS8vIGdldCBhbiBhcnJheSBvZiBjaGlsZCBlbGVtZW50cywgc2tpcHBpbmcgdGV4dCBhbmQgY29tbWVudCBub2Rlcw0KCQkJdmFyIHRlLCB4ID0gMCwgdHJldCA9IHJvb3RbY2hpbGROb2Rlc05hbWVdOw0KCQkJd2hpbGUodGUgPSB0cmV0W3grK10pew0KCQkJCWlmKA0KCQkJCQlfc2ltcGxlTm9kZVRlc3QodGUpICYmDQoJCQkJCSghYmFnIHx8IF9pc1VuaXF1ZSh0ZSwgYmFnKSkgJiYNCgkJCQkJKGZpbHRlckZ1bmModGUsIHgpKQ0KCQkJCSl7IA0KCQkJCQlyZXQucHVzaCh0ZSk7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIHJldDsNCgkJfTsNCgl9Ow0KCQ0KCS8qDQoJLy8gdGhhbmtzLCBEZWFuIQ0KCXZhciBpdGVtSXNBZnRlclJvb3QgPSBkLmlzSUUgPyBmdW5jdGlvbihpdGVtLCByb290KXsNCgkJcmV0dXJuIChpdGVtLnNvdXJjZUluZGV4ID4gcm9vdC5zb3VyY2VJbmRleCk7DQoJfSA6IGZ1bmN0aW9uKGl0ZW0sIHJvb3Qpew0KCQlyZXR1cm4gKGl0ZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24ocm9vdCkgPT0gMik7DQoJfTsNCgkqLw0KDQoJLy8gdGVzdCB0byBzZWUgaWYgbm9kZSBpcyBiZWxvdyByb290DQoJdmFyIF9pc0Rlc2NlbmRhbnQgPSBmdW5jdGlvbihub2RlLCByb290KXsNCgkJdmFyIHBuID0gbm9kZS5wYXJlbnROb2RlOw0KCQl3aGlsZShwbil7DQoJCQlpZihwbiA9PSByb290KXsNCgkJCQlicmVhazsNCgkJCX0NCgkJCXBuID0gcG4ucGFyZW50Tm9kZTsNCgkJfQ0KCQlyZXR1cm4gISFwbjsNCgl9Ow0KDQoJdmFyIF9nZXRFbGVtZW50c0Z1bmNDYWNoZSA9IHt9Ow0KDQoJdmFyIGdldEVsZW1lbnRzRnVuYyA9IGZ1bmN0aW9uKHF1ZXJ5KXsNCgkJdmFyIHJldEZ1bmMgPSBfZ2V0RWxlbWVudHNGdW5jQ2FjaGVbcXVlcnkucXVlcnldOw0KCQkvLyBpZiB3ZSd2ZSBnb3QgYSBjYWNoZWQgZGlzcGF0Y2hlciwganVzdCB1c2UgdGhhdA0KCQlpZihyZXRGdW5jKXsgcmV0dXJuIHJldEZ1bmM7IH0NCgkJLy8gZWxzZSwgZ2VuZXJhdGUgYSBuZXcgb24NCg0KCQkvLyBOT1RFOg0KCQkvLwkJdGhpcyBmdW5jdGlvbiByZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBzZWFyY2hlcyBmb3Igbm9kZXMgYW5kDQoJCS8vCQlmaWx0ZXJzIHRoZW0uICBUaGUgc2VhcmNoIG1heSBiZSBzcGVjaWFsaXplZCBieSBpbmZpeCBvcGVyYXRvcnMNCgkJLy8JCSgiPiIsICJ+Iiwgb3IgIisiKSBlbHNlIGl0IHdpbGwgZGVmYXVsdCB0byBzZWFyY2hpbmcgYWxsDQoJCS8vCQlkZXNjZW5kYW50cyAodGhlICIgIiBzZWxlY3RvcikuIE9uY2UgYSBncm91cCBvZiBjaGlsZHJlbiBpcw0KCQkvLwkJZm91bmRlLCBhIHRlc3QgZnVuY3Rpb24gaXMgYXBwbGllZCB0byB3ZWVkIG91dCB0aGUgb25lcyB3ZQ0KCQkvLwkJZG9uJ3Qgd2FudC4gTWFueSBjb21tb24gY2FzZXMgY2FuIGJlIGZhc3QtcGF0aGVkLiBXZSBzcGVuZCBhDQoJCS8vCQlsb3Qgb2YgY3ljbGVzIHRvIGNyZWF0ZSBhIGRpc3BhdGNoZXIgdGhhdCBkb2Vzbid0IGRvIG1vcmUgd29yaw0KCQkvLwkJdGhhbiBuZWNlc3NhcnkgYXQgYW55IHBvaW50IHNpbmNlLCB1bmxpa2UgdGhpcyBmdW5jdGlvbiwgdGhlDQoJCS8vCQlkaXNwYXRjaGVycyB3aWxsIGJlIGNhbGxlZCBldmVyeSB0aW1lLiBUaGUgbG9naWMgb2YgZ2VuZXJhdGluZw0KCQkvLwkJZWZmaWNpZW50IGRpc3BhdGNoZXJzIGxvb2tzIGxpa2UgdGhpcyBpbiBwc2V1ZG8gY29kZToNCgkJLy8NCgkJLy8JCSMgaWYgaXQncyBhIHB1cmVseSBkZXNjZW5kYW50IHF1ZXJ5IChubyAiPiIsICIrIiwgb3IgIn4iIG1vZGlmaWVycykNCgkJLy8JCWlmIGluZml4T3BlcmF0b3IgPT0gIiAiOg0KCQkvLwkJCWlmIG9ubHkoaWQpOg0KCQkvLwkJCQlyZXR1cm4gZGVmKHJvb3QpOg0KCQkvLwkJCQkJcmV0dXJuIGQuYnlJZChpZCwgcm9vdCk7DQoJCS8vDQoJCS8vCQkJZWxpZiBpZDoNCgkJLy8JCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJCXJldHVybiBmaWx0ZXIoZC5ieUlkKGlkLCByb290KSk7DQoJCS8vDQoJCS8vCQkJZWxpZiBjc3NDbGFzcyAmJiBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lOg0KCQkvLwkJCQlyZXR1cm4gZGVmKHJvb3QpOg0KCQkvLwkJCQkJcmV0dXJuIGZpbHRlcihyb290LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY3NzQ2xhc3MpKTsNCgkJLy8NCgkJLy8JCQllbGlmIG9ubHkodGFnKToNCgkJLy8JCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJCXJldHVybiByb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUpOw0KCQkvLw0KCQkvLwkJCWVsc2U6DQoJCS8vCQkJCSMgc2VhcmNoIGJ5IHRhZyBuYW1lLCB0aGVuIGZpbHRlcg0KCQkvLwkJCQlyZXR1cm4gZGVmKHJvb3QpOg0KCQkvLwkJCQkJcmV0dXJuIGZpbHRlcihyb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWV8fCIqIikpOw0KCQkvLw0KCQkvLwkJZWxpZiBpbmZpeE9wZXJhdG9yID09ICI+IjoNCgkJLy8JCQkjIHNlYXJjaCBkaXJlY3QgY2hpbGRyZW4NCgkJLy8JCQlyZXR1cm4gZGVmKHJvb3QpOg0KCQkvLwkJCQlyZXR1cm4gZmlsdGVyKHJvb3QuY2hpbGRyZW4pOw0KCQkvLw0KCQkvLwkJZWxpZiBpbmZpeE9wZXJhdG9yID09ICIrIjoNCgkJLy8JCQkjIHNlYXJjaCBuZXh0IHNpYmxpbmcNCgkJLy8JCQlyZXR1cm4gZGVmKHJvb3QpOg0KCQkvLwkJCQlyZXR1cm4gZmlsdGVyKHJvb3QubmV4dEVsZW1lbnRTaWJsaW5nKTsNCgkJLy8NCgkJLy8JCWVsaWYgaW5maXhPcGVyYXRvciA9PSAifiI6DQoJCS8vCQkJIyBzZWFyY2ggcmlnaHR3YXJkIHNpYmxpbmdzDQoJCS8vCQkJcmV0dXJuIGRlZihyb290KToNCgkJLy8JCQkJcmV0dXJuIGZpbHRlcihuZXh0U2libGluZ3Mocm9vdCkpOw0KDQoJCXZhciBpbyA9IHF1ZXJ5LmluZml4T3BlcjsNCgkJdmFyIG9wZXIgPSAoaW8gPyBpby5vcGVyIDogIiIpOw0KCQkvLyB0aGUgZGVmYXVsdCBmaWx0ZXIgZnVuYyB3aGljaCB0ZXN0cyBmb3IgYWxsIGNvbmRpdGlvbnMgaW4gdGhlIHF1ZXJ5DQoJCS8vIHBhcnQuIFRoaXMgaXMgcG90ZW50aWFsbHkgaW5lZmZpY2llbnQsIHNvIHNvbWUgb3B0aW1pemVkIHBhdGhzIG1heQ0KCQkvLyByZS1kZWZpbmUgaXQgdG8gdGVzdCBmZXdlciB0aGluZ3MuDQoJCXZhciBmaWx0ZXJGdW5jID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhxdWVyeSwgeyBlbDogMSB9KTsNCgkJdmFyIHF0ID0gcXVlcnkudGFnOw0KCQl2YXIgd2lsZGNhcmRUYWcgPSAoIioiID09IHF0KTsNCgkJdmFyIGVjcyA9IGdldERvYygpWyJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIl07IA0KDQoJCWlmKCFvcGVyKXsNCgkJCS8vIGlmIHRoZXJlJ3Mgbm8gaW5maXggb3BlcmF0b3IsIHRoZW4gaXQncyBhIGRlc2NlbmRhbnQgcXVlcnkuIElEDQoJCQkvLyBhbmQgImVsZW1lbnRzIGJ5IGNsYXNzIG5hbWUiIHZhcmlhbnRzIGNhbiBiZSBhY2NlbGVyYXRlZCBzbyB3ZQ0KCQkJLy8gY2FsbCB0aGVtIG91dCBleHBsaWNpdGx5Og0KCQkJaWYocXVlcnkuaWQpew0KCQkJCS8vIHRlc3Rpbmcgc2hvd3MgdGhhdCB0aGUgb3ZlcmhlYWQgb2YgeWVzbWFuKCkgaXMgYWNjZXB0YWJsZQ0KCQkJCS8vIGFuZCBjYW4gc2F2ZSB1cyBzb21lIGJ5dGVzIHZzLiByZS1kZWZpbmluZyB0aGUgZnVuY3Rpb24NCgkJCQkvLyBldmVyeXdoZXJlLg0KCQkJCWZpbHRlckZ1bmMgPSAoIXF1ZXJ5Lmxvb3BzICYmIHdpbGRjYXJkVGFnKSA/IA0KCQkJCQl5ZXNtYW4gOiANCgkJCQkJZ2V0U2ltcGxlRmlsdGVyRnVuYyhxdWVyeSwgeyBlbDogMSwgaWQ6IDEgfSk7DQoNCgkJCQlyZXRGdW5jID0gZnVuY3Rpb24ocm9vdCwgYXJyKXsNCgkJCQkJdmFyIHRlID0gZC5ieUlkKHF1ZXJ5LmlkLCAocm9vdC5vd25lckRvY3VtZW50fHxyb290KSk7DQoJCQkJCWlmKCF0ZSB8fCAhZmlsdGVyRnVuYyh0ZSkpeyByZXR1cm47IH0NCgkJCQkJaWYoOSA9PSByb290Lm5vZGVUeXBlKXsgLy8gaWYgcm9vdCdzIGEgZG9jLCB3ZSBqdXN0IHJldHVybiBkaXJlY3RseQ0KCQkJCQkJcmV0dXJuIGdldEFycih0ZSwgYXJyKTsNCgkJCQkJfWVsc2V7IC8vIG90aGVyd2lzZSBjaGVjayBhbmNlc3RyeQ0KCQkJCQkJaWYoX2lzRGVzY2VuZGFudCh0ZSwgcm9vdCkpew0KCQkJCQkJCXJldHVybiBnZXRBcnIodGUsIGFycik7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9ZWxzZSBpZigNCgkJCQllY3MgJiYgDQoJCQkJLy8gaXNBbGllbiBjaGVjay4gV29ya2Fyb3VuZCBmb3IgUHJvdG90eXBlLmpzIGJlaW5nIHRvdGFsbHkgZXZpbC9kdW1iLg0KCQkJCS9ce1xzKlxbbmF0aXZlIGNvZGVcXVxzKlx9Ly50ZXN0KFN0cmluZyhlY3MpKSAmJiANCgkJCQlxdWVyeS5jbGFzc2VzLmxlbmd0aCAmJg0KCQkJCSFjc3NDYXNlQnVnDQoJCQkpew0KCQkJCS8vIGl0J3MgYSBjbGFzcy1iYXNlZCBxdWVyeSBhbmQgd2UndmUgZ290IGEgZmFzdCB3YXkgdG8gcnVuIGl0Lg0KDQoJCQkJLy8gaWdub3JlIGNsYXNzIGFuZCBJRCBmaWx0ZXJzIHNpbmNlIHdlIHdpbGwgaGF2ZSBoYW5kbGVkIGJvdGgNCgkJCQlmaWx0ZXJGdW5jID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhxdWVyeSwgeyBlbDogMSwgY2xhc3NlczogMSwgaWQ6IDEgfSk7DQoJCQkJdmFyIGNsYXNzZXNTdHJpbmcgPSBxdWVyeS5jbGFzc2VzLmpvaW4oIiAiKTsNCgkJCQlyZXRGdW5jID0gZnVuY3Rpb24ocm9vdCwgYXJyLCBiYWcpew0KCQkJCQl2YXIgcmV0ID0gZ2V0QXJyKDAsIGFyciksIHRlLCB4PTA7DQoJCQkJCXZhciB0cmV0ID0gcm9vdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzZXNTdHJpbmcpOw0KCQkJCQl3aGlsZSgodGUgPSB0cmV0W3grK10pKXsNCgkJCQkJCWlmKGZpbHRlckZ1bmModGUsIHJvb3QpICYmIF9pc1VuaXF1ZSh0ZSwgYmFnKSl7DQoJCQkJCQkJcmV0LnB1c2godGUpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfTsNCg0KCQkJfWVsc2UgaWYoIXdpbGRjYXJkVGFnICYmICFxdWVyeS5sb29wcyl7DQoJCQkJLy8gaXQncyB0YWcgb25seS4gRmFzdC1wYXRoIGl0Lg0KCQkJCXJldEZ1bmMgPSBmdW5jdGlvbihyb290LCBhcnIsIGJhZyl7DQoJCQkJCXZhciByZXQgPSBnZXRBcnIoMCwgYXJyKSwgdGUsIHg9MDsNCgkJCQkJdmFyIHRyZXQgPSByb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKHF1ZXJ5LmdldFRhZygpKTsNCgkJCQkJd2hpbGUoKHRlID0gdHJldFt4KytdKSl7DQoJCQkJCQlpZihfaXNVbmlxdWUodGUsIGJhZykpew0KCQkJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gcmV0Ow0KCQkJCX07DQoJCQl9ZWxzZXsNCgkJCQkvLyB0aGUgY29tbW9uIGNhc2U6DQoJCQkJLy8JCWEgZGVzY2VuZGFudCBzZWxlY3RvciB3aXRob3V0IGEgZmFzdCBwYXRoLiBCeSBub3cgaXQncyBnb3QNCgkJCQkvLwkJdG8gaGF2ZSBhIHRhZyBzZWxlY3RvciwgZXZlbiBpZiBpdCdzIGp1c3QgIioiIHNvIHdlIHF1ZXJ5DQoJCQkJLy8JCWJ5IHRoYXQgYW5kIGZpbHRlcg0KCQkJCWZpbHRlckZ1bmMgPSBnZXRTaW1wbGVGaWx0ZXJGdW5jKHF1ZXJ5LCB7IGVsOiAxLCB0YWc6IDEsIGlkOiAxIH0pOw0KCQkJCXJldEZ1bmMgPSBmdW5jdGlvbihyb290LCBhcnIsIGJhZyl7DQoJCQkJCXZhciByZXQgPSBnZXRBcnIoMCwgYXJyKSwgdGUsIHg9MDsNCgkJCQkJLy8gd2UgdXNlIGdldFRhZygpIHRvIGF2b2lkIGNhc2Ugc2Vuc2l0aXZpdHkgaXNzdWVzDQoJCQkJCXZhciB0cmV0ID0gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZShxdWVyeS5nZXRUYWcoKSk7DQoJCQkJCXdoaWxlKCh0ZSA9IHRyZXRbeCsrXSkpew0KCQkJCQkJaWYoZmlsdGVyRnVuYyh0ZSwgcm9vdCkgJiYgX2lzVW5pcXVlKHRlLCBiYWcpKXsNCgkJCQkJCQlyZXQucHVzaCh0ZSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIHJldDsNCgkJCQl9Ow0KCQkJfQ0KCQl9ZWxzZXsNCgkJCS8vIHRoZSBxdWVyeSBpcyBzY29wZWQgaW4gc29tZSB3YXkuIEluc3RlYWQgb2YgcXVlcnlpbmcgYnkgdGFnIHdlDQoJCQkvLyB1c2Ugc29tZSBvdGhlciBjb2xsZWN0aW9uIHRvIGZpbmQgY2FuZGlkYXRlIG5vZGVzDQoJCQl2YXIgc2tpcEZpbHRlcnMgPSB7IGVsOiAxIH07DQoJCQlpZih3aWxkY2FyZFRhZyl7DQoJCQkJc2tpcEZpbHRlcnMudGFnID0gMTsNCgkJCX0NCgkJCWZpbHRlckZ1bmMgPSBnZXRTaW1wbGVGaWx0ZXJGdW5jKHF1ZXJ5LCBza2lwRmlsdGVycyk7DQoJCQlpZigiKyIgPT0gb3Blcil7DQoJCQkJcmV0RnVuYyA9IF9uZXh0U2libGluZyhmaWx0ZXJGdW5jKTsNCgkJCX1lbHNlIGlmKCJ+IiA9PSBvcGVyKXsNCgkJCQlyZXRGdW5jID0gX25leHRTaWJsaW5ncyhmaWx0ZXJGdW5jKTsNCgkJCX1lbHNlIGlmKCI+IiA9PSBvcGVyKXsNCgkJCQlyZXRGdW5jID0gX2NoaWxkRWxlbWVudHMoZmlsdGVyRnVuYyk7DQoJCQl9DQoJCX0NCgkJLy8gY2FjaGUgaXQgYW5kIHJldHVybg0KCQlyZXR1cm4gX2dldEVsZW1lbnRzRnVuY0NhY2hlW3F1ZXJ5LnF1ZXJ5XSA9IHJldEZ1bmM7DQoJfTsNCg0KCXZhciBmaWx0ZXJEb3duID0gZnVuY3Rpb24ocm9vdCwgcXVlcnlQYXJ0cyl7DQoJCS8vIE5PVEU6DQoJCS8vCQl0aGlzIGlzIHRoZSBndXRzIG9mIHRoZSBET00gcXVlcnkgc3lzdGVtLiBJdCB0YWtlcyBhIGxpc3Qgb2YNCgkJLy8JCXBhcnNlZCBxdWVyeSBwYXJ0cyBhbmQgYSByb290IGFuZCBmaW5kcyBjaGlsZHJlbiB3aGljaCBtYXRjaA0KCQkvLwkJdGhlIHNlbGVjdG9yIHJlcHJlc2VudGVkIGJ5IHRoZSBwYXJ0cw0KCQl2YXIgY2FuZGlkYXRlcyA9IGdldEFycihyb290KSwgcXAsIHgsIHRlLCBxcGwgPSBxdWVyeVBhcnRzLmxlbmd0aCwgYmFnLCByZXQ7DQoNCgkJZm9yKHZhciBpID0gMDsgaSA8IHFwbDsgaSsrKXsNCgkJCXJldCA9IFtdOw0KCQkJcXAgPSBxdWVyeVBhcnRzW2ldOw0KCQkJeCA9IGNhbmRpZGF0ZXMubGVuZ3RoIC0gMTsNCgkJCWlmKHggPiAwKXsNCgkJCQkvLyBpZiB3ZSBoYXZlIG1vcmUgdGhhbiBvbmUgcm9vdCBhdCB0aGlzIGxldmVsLCBwcm92aWRlIGEgbmV3DQoJCQkJLy8gaGFzaCB0byB1c2UgZm9yIGNoZWNraW5nIGdyb3VwIG1lbWJlcnNoaXAgYnV0IHRlbGwgdGhlDQoJCQkJLy8gc3lzdGVtIG5vdCB0byBwb3N0LWZpbHRlciB1cyBzaW5jZSB3ZSB3aWxsIGFscmVhZHkgaGF2ZSBiZWVuDQoJCQkJLy8gZ2F1cmFudGVlZCB0byBiZSB1bmlxdWUNCgkJCQliYWcgPSB7fTsNCgkJCQlyZXQubm96aXAgPSB0cnVlOw0KCQkJfQ0KCQkJdmFyIGdlZiA9IGdldEVsZW1lbnRzRnVuYyhxcCk7DQoJCQlmb3IodmFyIGogPSAwOyAodGUgPSBjYW5kaWRhdGVzW2pdKTsgaisrKXsNCgkJCQkvLyBmb3IgZXZlcnkgcm9vdCwgZ2V0IHRoZSBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBkZXNjZW5kYW50DQoJCQkJLy8gc2VsZWN0b3IsIGFkZGluZyB0aGVtIHRvIHRoZSAicmV0IiBhcnJheSBhbmQgZmlsdGVyaW5nIHRoZW0NCgkJCQkvLyB2aWEgbWVtYmVyc2hpcCBpbiB0aGlzIGxldmVsJ3MgYmFnLiBJZiB0aGVyZSBhcmUgbW9yZSBxdWVyeQ0KCQkJCS8vIHBhcnRzLCB0aGVuIHRoaXMgbGV2ZWwncyByZXR1cm4gd2lsbCBiZSB1c2VkIGFzIHRoZSBuZXh0DQoJCQkJLy8gbGV2ZWwncyBjYW5kaWRhdGVzDQoJCQkJZ2VmKHRlLCByZXQsIGJhZyk7DQoJCQl9DQoJCQlpZighcmV0Lmxlbmd0aCl7IGJyZWFrOyB9DQoJCQljYW5kaWRhdGVzID0gcmV0Ow0KCQl9DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KCS8vIHRoZSBxdWVyeSBydW5uZXINCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KCS8vIHRoZXNlIGFyZSB0aGUgcHJpbWFyeSBjYWNoZXMgZm9yIGZ1bGwtcXVlcnkgcmVzdWx0cy4gVGhlIHF1ZXJ5DQoJLy8gZGlzcGF0Y2hlciBmdW5jdGlvbnMgYXJlIGdlbmVyYXRlZCB0aGVuIHN0b3JlZCBoZXJlIGZvciBoYXNoIGxvb2t1cCBpbg0KCS8vIHRoZSBmdXR1cmUNCgl2YXIgX3F1ZXJ5RnVuY0NhY2hlRE9NID0ge30sDQoJCV9xdWVyeUZ1bmNDYWNoZVFTQSA9IHt9Ow0KDQoJLy8gdGhpcyBpcyB0aGUgc2Vjb25kIGxldmVsIG9mIHNwbGl0aW5nLCBmcm9tIGZ1bGwtbGVuZ3RoIHF1ZXJpZXMgKGUuZy4sDQoJLy8gImRpdi5mb28gLmJhciIpIGludG8gc2ltcGxlIHF1ZXJ5IGV4cHJlc3Npb25zIChlLmcuLCBbImRpdi5mb28iLA0KCS8vICIuYmFyIl0pDQoJdmFyIGdldFN0ZXBRdWVyeUZ1bmMgPSBmdW5jdGlvbihxdWVyeSl7DQoJCXZhciBxcGFydHMgPSBnZXRRdWVyeVBhcnRzKHRyaW0ocXVlcnkpKTsNCg0KCQkvLyBpZiBpdCdzIHRyaXZpYWwsIGF2b2lkIGl0ZXJhdGlvbiBhbmQgemlwcGluZyBjb3N0cw0KCQlpZihxcGFydHMubGVuZ3RoID09IDEpew0KCQkJLy8gd2Ugb3B0aW1pemUgdGhpcyBjYXNlIGhlcmUgdG8gcHJldmVudCBkaXNwYXRjaCBmdXJ0aGVyIGRvd24gdGhlDQoJCQkvLyBjaGFpbiwgcG90ZW50aWFsbHkgc2xvd2luZyB0aGluZ3MgZG93bi4gV2UgY291bGQgbW9yZSBlbGVnYW50bHkNCgkJCS8vIGhhbmRsZSB0aGlzIGluIGZpbHRlckRvd24oKSwgYnV0IGl0J3Mgc2xvd2VyIGZvciBzaW1wbGUgdGhpbmdzDQoJCQkvLyB0aGF0IG5lZWQgdG8gYmUgZmFzdCAoZS5nLiwgIiNzb21lSWQiKS4NCgkJCXZhciB0ZWYgPSBnZXRFbGVtZW50c0Z1bmMocXBhcnRzWzBdKTsNCgkJCXJldHVybiBmdW5jdGlvbihyb290KXsNCgkJCQl2YXIgciA9IHRlZihyb290LCBuZXcgcWxjKCkpOw0KCQkJCWlmKHIpeyByLm5vemlwID0gdHJ1ZTsgfQ0KCQkJCXJldHVybiByOw0KCQkJfQ0KCQl9DQoNCgkJLy8gb3RoZXJ3aXNlLCBicmVhayBpdCB1cCBhbmQgcmV0dXJuIGEgcnVubmVyIHRoYXQgaXRlcmF0ZXMgb3ZlciB0aGUgcGFydHMgcmVjdXJzaXZlbHkNCgkJcmV0dXJuIGZ1bmN0aW9uKHJvb3Qpew0KCQkJcmV0dXJuIGZpbHRlckRvd24ocm9vdCwgcXBhcnRzKTsNCgkJfQ0KCX07DQoNCgkvLyBOT1RFUzoNCgkvLwkqIHdlIGNhbid0IHRydXN0IFFTQSBmb3IgYW55dGhpbmcgYnV0IGRvY3VtZW50LXJvb3RlZCBxdWVyaWVzLCBzbw0KCS8vCSAgY2FjaGluZyBpcyBzcGxpdCBpbnRvIERPTSBxdWVyeSBldmFsdWF0b3JzIGFuZCBRU0EgcXVlcnkgZXZhbHVhdG9ycw0KCS8vCSogY2FjaGluZyBxdWVyeSByZXN1bHRzIGlzIGRpcnR5IGFuZCBsZWFrLXByb25lIChvciwgYXQgYSBtaW5pbXVtLA0KCS8vCSAgcHJvbmUgdG8gdW5ib3VuZGVkIGdyb3d0aCkuIE90aGVyIHRvb2xraXRzIG1heSBnbyB0aGlzIHJvdXRlLCBidXQNCgkvLwkgIHRoZXkgdG90YWxseSBkZXN0cm95IHRoZWlyIG93biBhYmlsaXR5IHRvIG1hbmFnZSB0aGVpciBtZW1vcnkNCgkvLwkgIGZvb3RwcmludC4gSWYgd2UgaW1wbGVtZW50IGl0LCBpdCBzaG91bGQgb25seSBldmVyIGJlIHdpdGggYSBmaXhlZA0KCS8vCSAgdG90YWwgZWxlbWVudCByZWZlcmVuY2UgIyBsaW1pdCBhbmQgYW4gTFJVLXN0eWxlIGFsZ29yaXRobSBzaW5jZSBKUw0KCS8vCSAgaGFzIG5vIHdlYWtyZWYgc3VwcG9ydC4gQ2FjaGluZyBjb21waWxlZCBxdWVyeSBldmFsdWF0b3JzIGlzIGFsc28NCgkvLwkgIHBvdGVudGlhbGx5IHByb2JsZW1hdGljLCBidXQgZXZlbiBvbiBsYXJnZSBkb2N1bWVudHMgdGhlIHNpemUgb2YgdGhlDQoJLy8JICBxdWVyeSBldmFsdWF0b3JzIGlzIG9mdGVuIDwgMTAwIGZ1bmN0aW9uIG9iamVjdHMgcGVyIGV2YWx1YXRvciAoYW5kDQoJLy8JICBMUlUgY2FuIGJlIGFwcGxpZWQgaWYgaXQncyBldmVyIHNob3duIHRvIGJlIGFuIGlzc3VlKS4NCgkvLwkqIHNpbmNlIElFJ3MgUVNBIHN1cHBvcnQgaXMgY3VycmVudGx5IG9ubHkgZm9yIEhUTUwgZG9jdW1lbnRzIGFuZCBldmVuDQoJLy8JICB0aGVuIG9ubHkgaW4gSUUgOCdzICJzdGFuZGFyZHMgbW9kZSIsIHdlIGhhdmUgdG8gZGV0ZWN0IG91ciBkaXNwYXRjaA0KCS8vCSAgcm91dGUgYXQgcXVlcnkgdGltZSBhbmQga2VlcCAyIHNlcGFyYXRlIGNhY2hlcy4gVWdnLg0KDQoJLy8gd2UgbmVlZCB0byBkZXRlcm1pbmUgaWYgd2UgdGhpbmsgd2UgY2FuIHJ1biBhIGdpdmVuIHF1ZXJ5IHZpYQ0KCS8vIHF1ZXJ5U2VsZWN0b3JBbGwgb3IgaWYgd2UnbGwgbmVlZCB0byBmYWxsIGJhY2sgb24gRE9NIHF1ZXJpZXMgdG8gZ2V0DQoJLy8gdGhlcmUuIFdlIG5lZWQgYSBsb3Qgb2YgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGVudmlyb25tZW50IGFuZCB0aGUgcXVlcnkNCgkvLyB0byBtYWtlIHRoZSBkZXRlcm1pbmlhdGlvbiAoZS5nLiBkb2VzIGl0IHN1cHBvcnQgUVNBLCBkb2VzIHRoZSBxdWVyeSBpbg0KCS8vIHF1ZXN0aW9uIHdvcmsgaW4gdGhlIG5hdGl2ZSBRU0EgaW1wbCwgZXRjLikuDQoJdmFyIG51YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQoJLy8gc29tZSB2ZXJzaW9ucyBvZiBTYWZhcmkgcHJvdmlkZWQgUVNBLCBidXQgaXQgd2FzIGJ1Z2d5IGFuZCBjcmFzaC1wcm9uZS4NCgkvLyBXZSBuZWVkIHRlIGRldGVjdCB0aGUgcmlnaHQgImludGVybmFsIiB3ZWJraXQgdmVyc2lvbiB0byBtYWtlIHRoaXMgd29yay4NCgl2YXIgd2sgPSAiV2ViS2l0LyI7DQoJdmFyIGlzNTI1ID0gKA0KCQlkLmlzV2ViS2l0ICYmIA0KCQkobnVhLmluZGV4T2Yod2spID4gMCkgJiYgDQoJCShwYXJzZUZsb2F0KG51YS5zcGxpdCh3aylbMV0pID4gNTI4KQ0KCSk7DQoNCgkvLyBJRSBRU0EgcXVlcmllcyBtYXkgaW5jb3JyZWN0bHkgaW5jbHVkZSBjb21tZW50IG5vZGVzLCBzbyB3ZSB0aHJvdyB0aGUNCgkvLyB6aXBwaW5nIGZ1bmN0aW9uIGludG8gInJlbW92ZSIgY29tbWVudHMgbW9kZSBpbnN0ZWFkIG9mIHRoZSBub3JtYWwgInNraXANCgkvLyBpdCIgd2hpY2ggZXZlcnkgb3RoZXIgUVNBLWNsdWVkIGJyb3dzZXIgZW5qb3lzDQoJdmFyIG5vWmlwID0gZC5pc0lFID8gImNvbW1lbnRTdHJpcCIgOiAibm96aXAiOw0KDQoJdmFyIHFzYSA9ICJxdWVyeVNlbGVjdG9yQWxsIjsNCgl2YXIgcXNhQXZhaWwgPSAoDQoJCSEhZ2V0RG9jKClbcXNhXSAmJiANCgkJLy8gc2VlICM1ODMyDQoJCSghZC5pc1NhZmFyaSB8fCAoZC5pc1NhZmFyaSA+IDMuMSkgfHwgaXM1MjUgKQ0KCSk7DQoNCgkvL0Rvbid0IGJvdGhlciB3aXRoIG4rMyB0eXBlIG9mIG1hdGNoZXMsIElFIGNvbXBsYWlucyBpZiB3ZSBtb2RpZnkgdGhvc2UuDQoJdmFyIGluZml4U3BhY2VSZSA9IC9uXCtcZHwoW14gXSk/KFs+fitdKShbXiA9XSk/L2c7DQoJdmFyIGluZml4U3BhY2VGdW5jID0gZnVuY3Rpb24obWF0Y2gsIHByZSwgY2gsIHBvc3QpIHsNCgkJcmV0dXJuIGNoID8gKHByZSA/IHByZSArICIgIiA6ICIiKSArIGNoICsgKHBvc3QgPyAiICIgKyBwb3N0IDogIiIpIDogLypuKzMqLyBtYXRjaDsNCgl9Ow0KDQoJdmFyIGdldFF1ZXJ5RnVuYyA9IGZ1bmN0aW9uKHF1ZXJ5LCBmb3JjZURPTSl7DQoJCS8vTm9ybWFsaXplIHF1ZXJ5LiBUaGUgQ1NTMyBzZWxlY3RvcnMgc3BlYyBhbGxvd3MgZm9yIG9taXR0aW5nIHNwYWNlcyBhcm91bmQNCgkJLy9pbmZpeCBvcGVyYXRvcnMsID4sIH4gYW5kICsNCgkJLy9EbyB0aGUgd29yayBoZXJlIHNpbmNlIGRldGVjdGlvbiBmb3Igc3BhY2VzIGlzIHVzZWQgYXMgYSBzaW1wbGUgIm5vdCB1c2UgUVNBIg0KCQkvL3Rlc3QgYmVsb3cuDQoJCXF1ZXJ5ID0gcXVlcnkucmVwbGFjZShpbmZpeFNwYWNlUmUsIGluZml4U3BhY2VGdW5jKTsNCg0KCQlpZihxc2FBdmFpbCl7DQoJCQkvLyBpZiB3ZSd2ZSBnb3QgYSBjYWNoZWQgdmFyaWFudCBhbmQgd2UgdGhpbmsgd2UgY2FuIGRvIGl0LCBydW4gaXQhDQoJCQl2YXIgcXNhQ2FjaGVkID0gX3F1ZXJ5RnVuY0NhY2hlUVNBW3F1ZXJ5XTsNCgkJCWlmKHFzYUNhY2hlZCAmJiAhZm9yY2VET00peyByZXR1cm4gcXNhQ2FjaGVkOyB9DQoJCX0NCg0KCQkvLyBlbHNlIGlmIHdlJ3ZlIGdvdCBhIERPTSBjYWNoZWQgdmFyaWFudCwgYXNzdW1lIHRoYXQgd2UgYWxyZWFkeSBrbm93DQoJCS8vIGFsbCB3ZSBuZWVkIHRvIGFuZCB1c2UgaXQNCgkJdmFyIGRvbUNhY2hlZCA9IF9xdWVyeUZ1bmNDYWNoZURPTVtxdWVyeV07DQoJCWlmKGRvbUNhY2hlZCl7IHJldHVybiBkb21DYWNoZWQ7IH0NCg0KCQkvLyBUT0RPOiANCgkJLy8JCXRvZGF5IHdlJ3JlIGNhY2hpbmcgRE9NIGFuZCBRU0EgYnJhbmNoZXMgc2VwYXJhdGVseSBzbyB3ZQ0KCQkvLwkJcmVjYWxjIHVzZVFTQSBldmVyeSB0aW1lLiBJZiB3ZSBoYWQgYSB3YXkgdG8gdGFnIHJvb3QrcXVlcnkNCgkJLy8JCWVmZmljaWVudGx5LCB3ZSdkIGJlIGluIGdvb2Qgc2hhcGUgdG8gZG8gYSBnbG9iYWwgY2FjaGUuDQoNCgkJdmFyIHFjeiA9IHF1ZXJ5LmNoYXJBdCgwKTsNCgkJdmFyIG5vc3BhY2UgPSAoLTEgPT0gcXVlcnkuaW5kZXhPZigiICIpKTsNCg0KCQkvLyBieUlkIHNlYXJjaGVzIGFyZSB3aWNrZWQgZmFzdCBjb21wYXJlZCB0byBRU0EsIGV2ZW4gd2hlbiBmaWx0ZXJpbmcNCgkJLy8gaXMgcmVxdWlyZWQNCgkJaWYoIChxdWVyeS5pbmRleE9mKCIjIikgPj0gMCkgJiYgKG5vc3BhY2UpICl7DQoJCQlmb3JjZURPTSA9IHRydWU7DQoJCX0NCg0KCQl2YXIgdXNlUVNBID0gKCANCgkJCXFzYUF2YWlsICYmICghZm9yY2VET00pICYmDQoJCQkvLyBhcyBwZXIgQ1NTIDMsIHdlIGNhbid0IGN1cnJlbnRseSBzdGFydCB3LyBjb21iaW5hdG9yOg0KCQkJLy8JCWh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyN3M2NzZWxncmFtbWFyDQoJCQkoc3BlY2lhbHMuaW5kZXhPZihxY3opID09IC0xKSAmJiANCgkJCS8vIElFJ3MgUVNBIGltcGwgc3Vja3Mgb24gcHNldWRvcw0KCQkJKCFkLmlzSUUgfHwgKHF1ZXJ5LmluZGV4T2YoIjoiKSA9PSAtMSkpICYmDQoNCgkJCSghKGNzc0Nhc2VCdWcgJiYgKHF1ZXJ5LmluZGV4T2YoIi4iKSA+PSAwKSkpICYmDQoNCgkJCS8vIEZJWE1FOg0KCQkJLy8JCW5lZWQgdG8gdGlnaHRlbiB1cCBicm93c2VyIHJ1bGVzIG9uICI6Y29udGFpbnMiIGFuZCAifD0iIHRvDQoJCQkvLwkJZmlndXJlIG91dCB3aGljaCBhcmVuJ3QgZ29vZA0KCQkJLy8JCUxhdGVzdCB3ZWJraXQgKGFyb3VuZCA1MzEuMjEuOCkgZG9lcyBub3Qgc2VlbSB0byBkbyB3ZWxsIHdpdGggOmNoZWNrZWQgb24gb3B0aW9uDQoJCQkvLwkJZWxlbWVudHMsIGV2ZW4gdGhvdWdoIGFjY29yZGluZyB0byBzcGVjLCBzZWxlY3RlZCBvcHRpb25zIHNob3VsZA0KCQkJLy8JCW1hdGNoIDpjaGVja2VkLiBTbyBnbyBub25RU0EgZm9yIGl0Og0KCQkJLy8JCWh0dHA6Ly9idWdzLmRvam90b29sa2l0Lm9yZy90aWNrZXQvNTE3OQ0KCQkJKHF1ZXJ5LmluZGV4T2YoIjpjb250YWlucyIpID09IC0xKSAmJiAocXVlcnkuaW5kZXhPZigiOmNoZWNrZWQiKSA9PSAtMSkgJiYgDQoJCQkocXVlcnkuaW5kZXhPZigifD0iKSA9PSAtMSkgLy8gc29tZSBicm93c2VycyBkb24ndCBncm9rIGl0DQoJCSk7DQoNCgkJLy8gVE9ETzogDQoJCS8vCQlpZiB3ZSd2ZSBnb3QgYSBkZXNjZW5kYW50IHF1ZXJ5IChlLmcuLCAiPiAudGhpbmdlciIgaW5zdGVhZCBvZg0KCQkvLwkJanVzdCAiLnRoaW5nZXIiKSBpbiBhIFFTQS1hYmxlIGRvYywgYnV0IGFyZSBwYXNzZWQgYSBjaGlsZCBhcyBhDQoJCS8vCQlyb290LCBpdCBzaG91bGQgYmUgcG9zc2libGUgdG8gZ2l2ZSB0aGUgaXRlbSBhIHN5bnRoZXRpYyBJRCBhbmQNCgkJLy8JCXRyaXZpYWxseSByZXdyaXRlIHRoZSBxdWVyeSB0byB0aGUgZm9ybSAiI3N5bmlkID4gLnRoaW5nZXIiIHRvDQoJCS8vCQl1c2UgdGhlIFFTQSBicmFuY2gNCg0KDQoJCWlmKHVzZVFTQSl7DQoJCQl2YXIgdHEgPSAoc3BlY2lhbHMuaW5kZXhPZihxdWVyeS5jaGFyQXQocXVlcnkubGVuZ3RoLTEpKSA+PSAwKSA/IA0KCQkJCQkJKHF1ZXJ5ICsgIiAqIikgOiBxdWVyeTsNCgkJCXJldHVybiBfcXVlcnlGdW5jQ2FjaGVRU0FbcXVlcnldID0gZnVuY3Rpb24ocm9vdCl7DQoJCQkJdHJ5ew0KCQkJCQkvLyB0aGUgUVNBIHN5c3RlbSBjb250YWlucyBhbiBlZ3JlZ2lvdXMgc3BlYyBidWcgd2hpY2gNCgkJCQkJLy8gbGltaXRzIHVzLCBlZmZlY3RpdmVseSwgdG8gb25seSBydW5uaW5nIFFTQSBxdWVyaWVzIG92ZXINCgkJCQkJLy8gZW50aXJlIGRvY3VtZW50cy4gIFNlZToNCgkJCQkJLy8JCWh0dHA6Ly9lam9obi5vcmcvYmxvZy90aG91Z2h0cy1vbi1xdWVyeXNlbGVjdG9yYWxsLw0KCQkJCQkvLwlkZXNwaXRlIHRoaXMsIHdlIGNhbiBhbHNvIGhhbmRsZSBRU0EgcnVucyBvbiBzaW1wbGUNCgkJCQkJLy8Jc2VsZWN0b3JzLCBidXQgd2UgZG9uJ3Qgd2FudCBkZXRlY3Rpb24gdG8gYmUgZXhwZW5zaXZlDQoJCQkJCS8vCXNvIHdlJ3JlIGp1c3QgY2hlY2tpbmcgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIHNwYWNlIGNoYXINCgkJCQkJLy8JcmlnaHQgbm93LiBOb3QgZWxlZ2FudCwgYnV0IGl0J3MgY2hlYXBlciB0aGFuIHJ1bm5pbmcNCgkJCQkJLy8JdGhlIHF1ZXJ5IHBhcnNlciB3aGVuIHdlIG1pZ2h0IG5vdCBuZWVkIHRvDQoJCQkJCWlmKCEoKDkgPT0gcm9vdC5ub2RlVHlwZSkgfHwgbm9zcGFjZSkpeyB0aHJvdyAiIjsgfQ0KCQkJCQl2YXIgciA9IHJvb3RbcXNhXSh0cSk7DQoJCQkJCS8vIHNraXAgZXhwZW5zaXZlIGR1cGxpY2F0aW9uIGNoZWNrcyBhbmQganVzdCB3cmFwIGluIGEgTm9kZUxpc3QNCgkJCQkJcltub1ppcF0gPSB0cnVlOw0KCQkJCQlyZXR1cm4gcjsNCgkJCQl9Y2F0Y2goZSl7DQoJCQkJCS8vIGVsc2UgcnVuIHRoZSBET00gYnJhbmNoIG9uIHRoaXMgcXVlcnksIGVuc3VyaW5nIHRoYXQgd2UNCgkJCQkJLy8gZGVmYXVsdCB0aGF0IHdheSBpbiB0aGUgZnV0dXJlDQoJCQkJCXJldHVybiBnZXRRdWVyeUZ1bmMocXVlcnksIHRydWUpKHJvb3QpOw0KCQkJCX0NCgkJCX0NCgkJfWVsc2V7DQoJCQkvLyBET00gYnJhbmNoDQoJCQl2YXIgcGFydHMgPSBxdWVyeS5zcGxpdCgvXHMqLFxzKi8pOw0KCQkJcmV0dXJuIF9xdWVyeUZ1bmNDYWNoZURPTVtxdWVyeV0gPSAoKHBhcnRzLmxlbmd0aCA8IDIpID8gDQoJCQkJLy8gaWYgbm90IGEgY29tcG91bmQgcXVlcnkgKGUuZy4sICIuZm9vLCAuYmFyIiksIGNhY2hlIGFuZCByZXR1cm4gYSBkaXNwYXRjaGVyDQoJCQkJZ2V0U3RlcFF1ZXJ5RnVuYyhxdWVyeSkgOiANCgkJCQkvLyBpZiBpdCAqaXMqIGEgY29tcGxleCBxdWVyeSwgYnJlYWsgaXQgdXAgaW50byBpdHMNCgkJCQkvLyBjb25zdGl0dWVudCBwYXJ0cyBhbmQgcmV0dXJuIGEgZGlzcGF0Y2hlciB0aGF0IHdpbGwNCgkJCQkvLyBtZXJnZSB0aGUgcGFydHMgd2hlbiBydW4NCgkJCQlmdW5jdGlvbihyb290KXsNCgkJCQkJdmFyIHBpbmRleCA9IDAsIC8vIGF2b2lkIGFycmF5IGFsbG9jIGZvciBldmVyeSBpbnZvY2F0aW9uDQoJCQkJCQlyZXQgPSBbXSwNCgkJCQkJCXRwOw0KCQkJCQl3aGlsZSgodHAgPSBwYXJ0c1twaW5kZXgrK10pKXsNCgkJCQkJCXJldCA9IHJldC5jb25jYXQoZ2V0U3RlcFF1ZXJ5RnVuYyh0cCkocm9vdCkpOw0KCQkJCQl9DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfQ0KCQkJKTsNCgkJfQ0KCX07DQoNCgl2YXIgX3ppcElkeCA9IDA7DQoNCgkvLyBOT1RFOg0KCS8vCQl0aGlzIGZ1bmN0aW9uIGlzIE1vbyBpbnNwaXJlZCwgYnV0IG91ciBvd24gaW1wbCB0byBkZWFsIGNvcnJlY3RseQ0KCS8vCQl3aXRoIFhNTCBpbiBJRQ0KCXZhciBfbm9kZVVJRCA9IGQuaXNJRSA/IGZ1bmN0aW9uKG5vZGUpew0KCQlpZihjYXNlU2Vuc2l0aXZlKXsNCgkJCS8vIFhNTCBkb2NzIGRvbid0IGhhdmUgdW5pcXVlSUQgb24gdGhlaXIgbm9kZXMNCgkJCXJldHVybiAobm9kZS5nZXRBdHRyaWJ1dGUoIl91aWQiKSB8fCBub2RlLnNldEF0dHJpYnV0ZSgiX3VpZCIsICsrX3ppcElkeCkgfHwgX3ppcElkeCk7DQoNCgkJfWVsc2V7DQoJCQlyZXR1cm4gbm9kZS51bmlxdWVJRDsNCgkJfQ0KCX0gOiANCglmdW5jdGlvbihub2RlKXsNCgkJcmV0dXJuIChub2RlLl91aWQgfHwgKG5vZGUuX3VpZCA9ICsrX3ppcElkeCkpOw0KCX07DQoNCgkvLyBkZXRlcm1pbmUgaWYgYSBub2RlIGluIGlzIHVuaXF1ZSBpbiBhICJiYWciLiBJbiB0aGlzIGNhc2Ugd2UgZG9uJ3Qgd2FudA0KCS8vIHRvIGZsYXR0ZW4gYSBsaXN0IG9mIHVuaXF1ZSBpdGVtcywgYnV0IHJhdGhlciBqdXN0IHRlbGwgaWYgdGhlIGl0ZW0gaW4NCgkvLyBxdWVzdGlvbiBpcyBhbHJlYWR5IGluIHRoZSBiYWcuIE5vcm1hbGx5IHdlJ2QganVzdCB1c2UgaGFzaCBsb29rdXAgdG8gZG8NCgkvLyB0aGlzIGZvciB1cyBidXQgSUUncyBET00gaXMgYnVzdGVkIHNvIHdlIGNhbid0IHJlYWxseSBjb3VudCBvbiB0aGF0LiBPbg0KCS8vIHRoZSB1cHNpZGUsIGl0IGdpdmVzIHVzIGEgYnVpbHQgaW4gdW5pcXVlIElEIGZ1bmN0aW9uLiANCgl2YXIgX2lzVW5pcXVlID0gZnVuY3Rpb24obm9kZSwgYmFnKXsNCgkJaWYoIWJhZyl7IHJldHVybiAxOyB9DQoJCXZhciBpZCA9IF9ub2RlVUlEKG5vZGUpOw0KCQlpZighYmFnW2lkXSl7IHJldHVybiBiYWdbaWRdID0gMTsgfQ0KCQlyZXR1cm4gMDsNCgl9Ow0KDQoJLy8gYXR0ZW1wdCB0byBlZmZpY2llbnRseSBkZXRlcm1pbmUgaWYgYW4gaXRlbSBpbiBhIGxpc3QgaXMgYSBkdXBlLA0KCS8vIHJldHVybmluZyBhIGxpc3Qgb2YgInVuaXF1ZXMiLCBob3BlZnVsbHkgaW4gZG91Y21lbnQgb3JkZXINCgl2YXIgX3ppcElkeE5hbWUgPSAiX3ppcElkeCI7DQoJdmFyIF96aXAgPSBmdW5jdGlvbihhcnIpew0KCQlpZihhcnIgJiYgYXJyLm5vemlwKXsgDQoJCQlyZXR1cm4gKHFsYy5fd3JhcCkgPyBxbGMuX3dyYXAoYXJyKSA6IGFycjsNCgkJfQ0KCQkvLyB2YXIgcmV0ID0gbmV3IGQuX05vZGVMaXN0Q3RvcigpOw0KCQl2YXIgcmV0ID0gbmV3IHFsYygpOw0KCQlpZighYXJyIHx8ICFhcnIubGVuZ3RoKXsgcmV0dXJuIHJldDsgfQ0KCQlpZihhcnJbMF0pew0KCQkJcmV0LnB1c2goYXJyWzBdKTsNCgkJfQ0KCQlpZihhcnIubGVuZ3RoIDwgMil7IHJldHVybiByZXQ7IH0NCg0KCQlfemlwSWR4Kys7DQoJCQ0KCQkvLyB3ZSBoYXZlIHRvIGZvcmsgaGVyZSBmb3IgSUUgYW5kIFhNTCBkb2NzIGJlY2F1c2Ugd2UgY2FuJ3Qgc2V0DQoJCS8vIGV4cGFuZG9zIG9uIHRoZWlyIG5vZGVzIChhcHBhcmVudGx5KS4gKnNpZ2gqDQoJCWlmKGQuaXNJRSAmJiBjYXNlU2Vuc2l0aXZlKXsNCgkJCXZhciBzemlkeCA9IF96aXBJZHgrIiI7DQoJCQlhcnJbMF0uc2V0QXR0cmlidXRlKF96aXBJZHhOYW1lLCBzemlkeCk7DQoJCQlmb3IodmFyIHggPSAxLCB0ZTsgdGUgPSBhcnJbeF07IHgrKyl7DQoJCQkJaWYoYXJyW3hdLmdldEF0dHJpYnV0ZShfemlwSWR4TmFtZSkgIT0gc3ppZHgpeyANCgkJCQkJcmV0LnB1c2godGUpOw0KCQkJCX0NCgkJCQl0ZS5zZXRBdHRyaWJ1dGUoX3ppcElkeE5hbWUsIHN6aWR4KTsNCgkJCX0NCgkJfWVsc2UgaWYoZC5pc0lFICYmIGFyci5jb21tZW50U3RyaXApew0KCQkJdHJ5ew0KCQkJCWZvcih2YXIgeCA9IDEsIHRlOyB0ZSA9IGFyclt4XTsgeCsrKXsNCgkJCQkJaWYoX2lzRWxlbWVudCh0ZSkpeyANCgkJCQkJCXJldC5wdXNoKHRlKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX1jYXRjaChlKXsgLyogc3F1ZWxjaCAqLyB9DQoJCX1lbHNlew0KCQkJaWYoYXJyWzBdKXsgYXJyWzBdW196aXBJZHhOYW1lXSA9IF96aXBJZHg7IH0NCgkJCWZvcih2YXIgeCA9IDEsIHRlOyB0ZSA9IGFyclt4XTsgeCsrKXsNCgkJCQlpZihhcnJbeF1bX3ppcElkeE5hbWVdICE9IF96aXBJZHgpeyANCgkJCQkJcmV0LnB1c2godGUpOw0KCQkJCX0NCgkJCQl0ZVtfemlwSWR4TmFtZV0gPSBfemlwSWR4Ow0KCQkJfQ0KCQl9DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCS8vIHRoZSBtYWluIGV4ZWN1dG9yDQoJZC5xdWVyeSA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gcXVlcnksIC8qU3RyaW5nfERPTU5vZGU/Ki8gcm9vdCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQlSZXR1cm5zIG5vZGVzIHdoaWNoIG1hdGNoIHRoZSBnaXZlbiBDU1MzIHNlbGVjdG9yLCBzZWFyY2hpbmcgdGhlDQoJCS8vCQllbnRpcmUgZG9jdW1lbnQgYnkgZGVmYXVsdCBidXQgb3B0aW9uYWxseSB0YWtpbmcgYSBub2RlIHRvIHNjb3BlDQoJCS8vCQl0aGUgc2VhcmNoIGJ5LiBSZXR1cm5zIGFuIGluc3RhbmNlIG9mIGRvam8uTm9kZUxpc3QuDQoJCS8vCWRlc2NyaXB0aW9uOg0KCQkvLwkJZG9qby5xdWVyeSgpIGlzIHRoZSBzd2lzcyBhcm15IGtuaWZlIG9mIERPTSBub2RlIG1hbmlwdWxhdGlvbiBpbg0KCQkvLwkJRG9qby4gTXVjaCBsaWtlIFByb3RvdHlwZSdzICIkJCIgKGJsaW5nLWJsaW5nKSBmdW5jdGlvbiBvciBKUXVlcnkncw0KCQkvLwkJIiQiIGZ1bmN0aW9uLCBkb2pvLnF1ZXJ5IHByb3ZpZGVzIHJvYnVzdCwgaGlnaC1wZXJmb3JtYW5jZQ0KCQkvLwkJQ1NTLWJhc2VkIG5vZGUgc2VsZWN0b3Igc3VwcG9ydCB3aXRoIHRoZSBvcHRpb24gb2Ygc2NvcGluZyBzZWFyY2hlcw0KCQkvLwkJdG8gYSBwYXJ0aWN1bGFyIHN1Yi10cmVlIG9mIGEgZG9jdW1lbnQuDQoJCS8vDQoJCS8vCQlTdXBwb3J0ZWQgU2VsZWN0b3JzOg0KCQkvLwkJLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJLy8NCgkJLy8JCWRvam8ucXVlcnkoKSBzdXBwb3J0cyBhIHJpY2ggc2V0IG9mIENTUzMgc2VsZWN0b3JzLCBpbmNsdWRpbmc6DQoJCS8vDQoJCS8vCQkJKiBjbGFzcyBzZWxlY3RvcnMgKGUuZy4sIGAuZm9vYCkNCgkJLy8JCQkqIG5vZGUgdHlwZSBzZWxlY3RvcnMgbGlrZSBgc3BhbmANCgkJLy8JCQkqIGAgYCBkZXNjZW5kYW50IHNlbGVjdG9ycw0KCQkvLwkJCSogYD5gIGNoaWxkIGVsZW1lbnQgc2VsZWN0b3JzIA0KCQkvLwkJCSogYCNmb29gIHN0eWxlIElEIHNlbGVjdG9ycw0KCQkvLwkJCSogYCpgIHVuaXZlcnNhbCBzZWxlY3Rvcg0KCQkvLwkJCSogYH5gLCB0aGUgaW1tZWRpYXRlbHkgcHJlY2VlZGVkLWJ5IHNpYmxpbmcgc2VsZWN0b3INCgkJLy8JCQkqIGArYCwgdGhlIHByZWNlZWRlZC1ieSBzaWJsaW5nIHNlbGVjdG9yDQoJCS8vCQkJKiBhdHRyaWJ1dGUgcXVlcmllczoNCgkJLy8JCQl8CSogYFtmb29dYCBhdHRyaWJ1dGUgcHJlc2VuY2Ugc2VsZWN0b3INCgkJLy8JCQl8CSogYFtmb289J2JhciddYCBhdHRyaWJ1dGUgdmFsdWUgZXhhY3QgbWF0Y2gNCgkJLy8JCQl8CSogYFtmb29+PSdiYXInXWAgYXR0cmlidXRlIHZhbHVlIGxpc3QgaXRlbSBtYXRjaA0KCQkvLwkJCXwJKiBgW2Zvb149J2JhciddYCBhdHRyaWJ1dGUgc3RhcnQgbWF0Y2gNCgkJLy8JCQl8CSogYFtmb28kPSdiYXInXWAgYXR0cmlidXRlIGVuZCBtYXRjaA0KCQkvLwkJCXwJKiBgW2Zvbyo9J2JhciddYCBhdHRyaWJ1dGUgc3Vic3RyaW5nIG1hdGNoDQoJCS8vCQkJKiBgOmZpcnN0LWNoaWxkYCwgYDpsYXN0LWNoaWxkYCwgYW5kIGA6b25seS1jaGlsZGAgcG9zaXRpb25hbCBzZWxlY3RvcnMNCgkJLy8JCQkqIGA6ZW1wdHlgIGNvbnRlbnQgZW10cHkgc2VsZWN0b3INCgkJLy8JCQkqIGA6Y2hlY2tlZGAgcHNldWRvIHNlbGVjdG9yDQoJCS8vCQkJKiBgOm50aC1jaGlsZChuKWAsIGA6bnRoLWNoaWxkKDJuKzEpYCBzdHlsZSBwb3NpdGlvbmFsIGNhbGN1bGF0aW9ucw0KCQkvLwkJCSogYDpudGgtY2hpbGQoZXZlbilgLCBgOm50aC1jaGlsZChvZGQpYCBwb3NpdGlvbmFsIHNlbGVjdG9ycw0KCQkvLwkJCSogYDpub3QoLi4uKWAgbmVnYXRpb24gcHNldWRvIHNlbGVjdG9ycw0KCQkvLw0KCQkvLwkJQW55IGxlZ2FsIGNvbWJpbmF0aW9uIG9mIHRoZXNlIHNlbGVjdG9ycyB3aWxsIHdvcmsgd2l0aA0KCQkvLwkJYGRvam8ucXVlcnkoKWAsIGluY2x1ZGluZyBjb21wb3VuZCBzZWxlY3RvcnMgKCIsIiBkZWxpbWl0ZWQpLg0KCQkvLwkJVmVyeSBjb21wbGV4IGFuZCB1c2VmdWwgc2VhcmNoZXMgY2FuIGJlIGNvbnN0cnVjdGVkIHdpdGggdGhpcw0KCQkvLwkJcGFsZXR0ZSBvZiBzZWxlY3RvcnMgYW5kIHdoZW4gY29tYmluZWQgd2l0aCBmdW5jdGlvbnMgZm9yDQoJCS8vCQltYW5pcHVsYXRpb24gcHJlc2VudGVkIGJ5IGRvam8uTm9kZUxpc3QsIG1hbnkgdHlwZXMgb2YgRE9NDQoJCS8vCQltYW5pcHVsYXRpb24gb3BlcmF0aW9ucyBiZWNvbWUgdmVyeSBzdHJhaWdodGZvcndhcmQuDQoJCS8vCQkNCgkJLy8JCVVuc3VwcG9ydGVkIFNlbGVjdG9yczoNCgkJLy8JCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJLy8NCgkJLy8JCVdoaWxlIGRvam8ucXVlcnkgaGFuZGxlcyBtYW55IENTUzMgc2VsZWN0b3JzLCBzb21lIGZhbGwgb3V0c2lkZSBvZg0KCQkvLwkJd2hhdCdzIHJlc2FvbmFibGUgZm9yIGEgcHJvZ3JhbW1hdGljIG5vZGUgcXVlcnlpbmcgZW5naW5lIHRvDQoJCS8vCQloYW5kbGUuIEN1cnJlbnRseSB1bnN1cHBvcnRlZCBzZWxlY3RvcnMgaW5jbHVkZToNCgkJLy8JCQ0KCQkvLwkJCSogbmFtZXNwYWNlLWRpZmZlcmVudGlhdGVkIHNlbGVjdG9ycyBvZiBhbnkgZm9ybQ0KCQkvLwkJCSogYWxsIGA6OmAgcHNlZHVvLWVsZW1lbnQgc2VsZWN0b3JzDQoJCS8vCQkJKiBjZXJ0YWluIHBzZWR1by1zZWxlY3RvcnMgd2hpY2ggZG9uJ3QgZ2V0IGEgbG90IG9mIGRheS10by1kYXkgdXNlOg0KCQkvLwkJCXwJKiBgOnJvb3RgLCBgOmxhbmcoKWAsIGA6dGFyZ2V0YCwgYDpmb2N1c2ANCgkJLy8JCQkqIGFsbCB2aXN1YWwgYW5kIHN0YXRlIHNlbGVjdG9yczoNCgkJLy8JCQl8CSogYDpyb290YCwgYDphY3RpdmVgLCBgOmhvdmVyYCwgYDp2aXNpc3RlZGAsIGA6bGlua2AsDQoJCS8vCQkJCSAgYDplbmFibGVkYCwgYDpkaXNhYmxlZGANCgkJLy8JCQkqIGA6Ki1vZi10eXBlYCBwc2V1ZG8gc2VsZWN0b3JzDQoJCS8vCQkNCgkJLy8JCWRvam8ucXVlcnkgYW5kIFhNTCBEb2N1bWVudHM6DQoJCS8vCQktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkvLwkJDQoJCS8vCQlgZG9qby5xdWVyeWAgKGFzIG9mIGRvam8gMS4yKSBzdXBwb3J0cyBzZWFyY2hpbmcgWE1MIGRvY3VtZW50cw0KCQkvLwkJaW4gYSBjYXNlLXNlbnNpdGl2ZSBtYW5uZXIuIElmIGFuIEhUTUwgZG9jdW1lbnQgaXMgc2VydmVkIHdpdGgNCgkJLy8JCWEgZG9jdHlwZSB0aGF0IGZvcmNlcyBjYXNlLXNlbnNpdGl2aXR5IChlLmcuLCBYSFRNTCAxLjENCgkJLy8JCVN0cmljdCksIGRvam8ucXVlcnkoKSB3aWxsIGRldGVjdCB0aGlzIGFuZCAiZG8gdGhlIHJpZ2h0DQoJCS8vCQl0aGluZyIuIENhc2Ugc2Vuc2l0aXZpdHkgaXMgZGVwZW5kZW50IHVwb24gdGhlIGRvY3VtZW50IGJlaW5nDQoJCS8vCQlzZWFyY2hlZCBhbmQgbm90IHRoZSBxdWVyeSB1c2VkLiBJdCBpcyB0aGVyZWZvcmUgcG9zc2libGUgdG8NCgkJLy8JCXVzZSBjYXNlLXNlbnNpdGl2ZSBxdWVyaWVzIG9uIHN0cmljdCBzdWItZG9jdW1lbnRzIChpZnJhbWVzLA0KCQkvLwkJZXRjLikgb3IgWE1MIGRvY3VtZW50cyB3aGlsZSBzdGlsbCBhc3N1bWluZyBjYXNlLWluc2Vuc2l0aXZpdHkNCgkJLy8JCWZvciBhIGhvc3Qvcm9vdCBkb2N1bWVudC4NCgkJLy8NCgkJLy8JCU5vbi1zZWxlY3RvciBRdWVyaWVzOg0KCQkvLwkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCS8vDQoJCS8vCQlJZiBzb21ldGhpbmcgb3RoZXIgdGhhbiBhIFN0cmluZyBpcyBwYXNzZWQgZm9yIHRoZSBxdWVyeSwNCgkJLy8JCWBkb2pvLnF1ZXJ5YCB3aWxsIHJldHVybiBhIG5ldyBgZG9qby5Ob2RlTGlzdGAgaW5zdGFuY2UNCgkJLy8JCWNvbnN0cnVjdGVkIGZyb20gdGhhdCBwYXJhbWV0ZXIgYWxvbmUgYW5kIGFsbCBmdXJ0aGVyDQoJCS8vCQlwcm9jZXNzaW5nIHdpbGwgc3RvcC4gVGhpcyBtZWFucyB0aGF0IGlmIHlvdSBoYXZlIGEgcmVmZXJlbmNlDQoJCS8vCQl0byBhIG5vZGUgb3IgTm9kZUxpc3QsIHlvdSBjYW4gcXVpY2tseSBjb25zdHJ1Y3QgYSBuZXcgTm9kZUxpc3QNCgkJLy8JCWZyb20gdGhlIG9yaWdpbmFsIGJ5IGNhbGxpbmcgYGRvam8ucXVlcnkobm9kZSlgIG9yDQoJCS8vCQlgZG9qby5xdWVyeShsaXN0KWAuDQoJCS8vDQoJCS8vCXF1ZXJ5Og0KCQkvLwkJVGhlIENTUzMgZXhwcmVzc2lvbiB0byBtYXRjaCBhZ2FpbnN0LiBGb3IgZGV0YWlscyBvbiB0aGUgc3ludGF4IG9mDQoJCS8vCQlDU1MzIHNlbGVjdG9ycywgc2VlIDxodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jc2VsZWN0b3JzPg0KCQkvLwlyb290Og0KCQkvLwkJQSBET01Ob2RlIChvciBub2RlIGlkKSB0byBzY29wZSB0aGUgc2VhcmNoIGZyb20uIE9wdGlvbmFsLg0KCQkvLwlyZXR1cm5zOiBkb2pvLk5vZGVMaXN0DQoJCS8vCQlBbiBpbnN0YW5jZSBvZiBgZG9qby5Ob2RlTGlzdGAuIE1hbnkgbWV0aG9kcyBhcmUgYXZhaWxhYmxlIG9uDQoJCS8vCQlOb2RlTGlzdHMgZm9yIHNlYXJjaGluZywgaXRlcmF0aW5nLCBtYW5pcHVsYXRpbmcsIGFuZCBoYW5kbGluZw0KCQkvLwkJZXZlbnRzIG9uIHRoZSBtYXRjaGVkIG5vZGVzIGluIHRoZSByZXR1cm5lZCBsaXN0Lg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJc2VhcmNoIHRoZSBlbnRpcmUgZG9jdW1lbnQgZm9yIGVsZW1lbnRzIHdpdGggdGhlIGNsYXNzICJmb28iOg0KCQkvLwl8CWRvam8ucXVlcnkoIi5mb28iKTsNCgkJLy8JCXRoZXNlIGVsZW1lbnRzIHdpbGwgbWF0Y2g6DQoJCS8vCXwJPHNwYW4gY2xhc3M9ImZvbyI+PC9zcGFuPg0KCQkvLwl8CTxzcGFuIGNsYXNzPSJmb28gYmFyIj48L3NwYW4+DQoJCS8vCXwJPHAgY2xhc3M9InRodWQgZm9vIj48L3A+DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlzZWFyY2ggdGhlIGVudGlyZSBkb2N1bWVudCBmb3IgZWxlbWVudHMgd2l0aCB0aGUgY2xhc3NlcyAiZm9vIiAqYW5kKiAiYmFyIjoNCgkJLy8JfAlkb2pvLnF1ZXJ5KCIuZm9vLmJhciIpOw0KCQkvLwkJdGhlc2UgZWxlbWVudHMgd2lsbCBtYXRjaDoNCgkJLy8JfAk8c3BhbiBjbGFzcz0iZm9vIGJhciI+PC9zcGFuPg0KCQkvLwkJd2hpbGUgdGhlc2Ugd2lsbCBub3Q6DQoJCS8vCXwJPHNwYW4gY2xhc3M9ImZvbyI+PC9zcGFuPg0KCQkvLwl8CTxwIGNsYXNzPSJ0aHVkIGZvbyI+PC9wPg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJZmluZCBgPHNwYW4+YCBlbGVtZW50cyB3aGljaCBhcmUgZGVzY2VuZGFudHMgb2YgcGFyYWdyYXBocyBhbmQNCgkJLy8JCXdoaWNoIGhhdmUgYSAiaGlnaGxpZ2h0ZWQiIGNsYXNzOg0KCQkvLwl8CWRvam8ucXVlcnkoInAgc3Bhbi5oaWdobGlnaHRlZCIpOw0KCQkvLwkJdGhlIGlubmVybW9zdCBzcGFuIGluIHRoaXMgZnJhZ21lbnQgbWF0Y2hlczoNCgkJLy8JfAk8cCBjbGFzcz0iZm9vIj4NCgkJLy8JfAkJPHNwYW4+Li4uDQoJCS8vCXwJCQk8c3BhbiBjbGFzcz0iaGlnaGxpZ2h0ZWQgZm9vIGJhciI+Li4uPC9zcGFuPg0KCQkvLwl8CQk8L3NwYW4+DQoJCS8vCXwJPC9wPg0KCQkvLwlleGFtcGxlOg0KCQkvLwkJc2V0IGFuICJvZGQiIGNsYXNzIG9uIGFsbCBvZGQgdGFibGUgcm93cyBpbnNpZGUgb2YgdGhlIHRhYmxlDQoJCS8vCQlgI3RhYnVsYXJfZGF0YWAsIHVzaW5nIHRoZSBgPmAgKGRpcmVjdCBjaGlsZCkgc2VsZWN0b3IgdG8gYXZvaWQNCgkJLy8JCWFmZmVjdGluZyBhbnkgbmVzdGVkIHRhYmxlczoNCgkJLy8JfAlkb2pvLnF1ZXJ5KCIjdGFidWxhcl9kYXRhID4gdGJvZHkgPiB0cjpudGgtY2hpbGQob2RkKSIpLmFkZENsYXNzKCJvZGQiKTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCXJlbW92ZSBhbGwgZWxlbWVudHMgd2l0aCB0aGUgY2xhc3MgImVycm9yIiBmcm9tIHRoZSBkb2N1bWVudA0KCQkvLwkJYW5kIHN0b3JlIHRoZW0gaW4gYSBsaXN0Og0KCQkvLwl8CXZhciBlcnJvcnMgPSBkb2pvLnF1ZXJ5KCIuZXJyb3IiKS5vcnBoYW4oKTsNCgkJLy8JZXhhbXBsZToNCgkJLy8JCWFkZCBhbiBvbmNsaWNrIGhhbmRsZXIgdG8gZXZlcnkgc3VibWl0IGJ1dHRvbiBpbiB0aGUgZG9jdW1lbnQNCgkJLy8JCXdoaWNoIGNhdXNlcyB0aGUgZm9ybSB0byBiZSBzZW50IHZpYSBBamF4IGluc3RlYWQ6DQoJCS8vCXwJZG9qby5xdWVyeSgiaW5wdXRbdHlwZT0nc3VibWl0J10iKS5vbmNsaWNrKGZ1bmN0aW9uKGUpew0KCQkvLwl8CQlkb2pvLnN0b3BFdmVudChlKTsgLy8gcHJldmVudCBzZW5kaW5nIHRoZSBmb3JtDQoJCS8vCXwJCXZhciBidG4gPSBlLnRhcmdldDsNCgkJLy8JfAkJZG9qby54aHJQb3N0KHsNCgkJLy8JfAkJCWZvcm06IGJ0bi5mb3JtLA0KCQkvLwl8CQkJbG9hZDogZnVuY3Rpb24oZGF0YSl7DQoJCS8vCXwJCQkJLy8gcmVwbGFjZSB0aGUgZm9ybSB3aXRoIHRoZSByZXNwb25zZQ0KCQkvLwl8CQkJCXZhciBkaXYgPSBkb2pvLmRvYy5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJLy8JfAkJCQlkb2pvLnBsYWNlKGRpdiwgYnRuLmZvcm0sICJhZnRlciIpOw0KCQkvLwl8CQkJCWRpdi5pbm5lckhUTUwgPSBkYXRhOw0KCQkvLwl8CQkJCWRvam8uc3R5bGUoYnRuLmZvcm0sICJkaXNwbGF5IiwgIm5vbmUiKTsNCgkJLy8JfAkJCX0NCgkJLy8JfAkJfSk7DQoJCS8vCXwJfSk7DQoNCgkJLy9TZXQgbGlzdCBjb25zdHJ1Y3RvciB0byBkZXNpcmVkIHZhbHVlLiBUaGlzIGNhbiBjaGFuZ2UNCgkJLy9iZXR3ZWVuIGNhbGxzLCBzbyBhbHdheXMgcmUtYXNzaWduIGhlcmUuDQoJCXFsYyA9IGQuX05vZGVMaXN0Q3RvcjsNCg0KCQlpZighcXVlcnkpew0KCQkJcmV0dXJuIG5ldyBxbGMoKTsNCgkJfQ0KDQoJCWlmKHF1ZXJ5LmNvbnN0cnVjdG9yID09IHFsYyl7DQoJCQlyZXR1cm4gcXVlcnk7DQoJCX0NCgkJaWYodHlwZW9mIHF1ZXJ5ICE9ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJcmV0dXJuIG5ldyBxbGMocXVlcnkpOyAvLyBkb2pvLk5vZGVMaXN0DQoJCX0NCgkJaWYodHlwZW9mIHJvb3QgPT0gInN0cmluZyIpeyAvLyBpbmxpbmUnZCB0eXBlIGNoZWNrDQoJCQlyb290ID0gZC5ieUlkKHJvb3QpOw0KCQkJaWYoIXJvb3QpeyByZXR1cm4gbmV3IHFsYygpOyB9DQoJCX0NCg0KCQlyb290ID0gcm9vdHx8Z2V0RG9jKCk7DQoJCXZhciBvZCA9IHJvb3Qub3duZXJEb2N1bWVudHx8cm9vdC5kb2N1bWVudEVsZW1lbnQ7DQoNCgkJLy8gdGhyb3cgdGhlIGJpZyBjYXNlIHNlbnNpdGl2aXR5IHN3aXRjaA0KDQoJCS8vIE5PVEU6DQoJCS8vIAkJT3BlcmEgaW4gWEhUTUwgbW9kZSBkb2Vzbid0IGRldGVjdCBjYXNlLXNlbnNpdGl2aXR5IGNvcnJlY3RseQ0KCQkvLyAJCWFuZCBpdCdzIG5vdCBjbGVhciB0aGF0IHRoZXJlJ3MgYW55IHdheSB0byB0ZXN0IGZvciBpdA0KCQljYXNlU2Vuc2l0aXZlID0gKHJvb3QuY29udGVudFR5cGUgJiYgcm9vdC5jb250ZW50VHlwZT09ImFwcGxpY2F0aW9uL3htbCIpIHx8IA0KCQkJCQkJKGQuaXNPcGVyYSAmJiAocm9vdC5kb2N0eXBlIHx8IG9kLnRvU3RyaW5nKCkgPT0gIltvYmplY3QgWE1MRG9jdW1lbnRdIikpIHx8DQoJCQkJCQkoISFvZCkgJiYgDQoJCQkJCQkoZC5pc0lFID8gb2QueG1sIDogKHJvb3QueG1sVmVyc2lvbnx8b2QueG1sVmVyc2lvbikpOw0KDQoJCS8vIE5PVEU6IA0KCQkvLwkJYWRkaW5nICJ0cnVlIiBhcyB0aGUgMm5kIGFyZ3VtZW50IHRvIGdldFF1ZXJ5RnVuYyBpcyB1c2VmdWwgZm9yDQoJCS8vCQl0ZXN0aW5nIHRoZSBET00gYnJhbmNoIHdpdGhvdXQgd29ycnlpbmcgYWJvdXQgdGhlDQoJCS8vCQliZWhhdmlvci9wZXJmb3JtYW5jZSBvZiB0aGUgUVNBIGJyYW5jaC4NCgkJdmFyIHIgPSBnZXRRdWVyeUZ1bmMocXVlcnkpKHJvb3QpOw0KDQoJCS8vIEZJWE1FOg0KCQkvLwkJbmVlZCB0byBpbnZlc3RpZ2F0ZSB0aGlzIGJyYW5jaCBXUlQgIzgwNzQgYW5kICM4MDc1DQoJCWlmKHIgJiYgci5ub3ppcCAmJiAhcWxjLl93cmFwKXsNCgkJCXJldHVybiByOw0KCQl9DQoJCXJldHVybiBfemlwKHIpOyAvLyBkb2pvLk5vZGVMaXN0DQoJfQ0KDQoJLy8gRklYTUU6IG5lZWQgdG8gYWRkIGluZnJhc3RydWN0dXJlIGZvciBwb3N0LWZpbHRlcmluZyBwc2V1ZG9zLCBhbGEgOmxhc3QNCglkLnF1ZXJ5LnBzZXVkb3MgPSBwc2V1ZG9zOw0KDQoJLy8gb25lLW9mZiBmdW5jdGlvbiBmb3IgZmlsdGVyaW5nIGEgTm9kZUxpc3QgYmFzZWQgb24gYSBzaW1wbGUgc2VsZWN0b3INCglkLl9maWx0ZXJRdWVyeVJlc3VsdCA9IGZ1bmN0aW9uKG5vZGVMaXN0LCBzaW1wbGVGaWx0ZXIpew0KCQl2YXIgdG1wTm9kZUxpc3QgPSBuZXcgZC5fTm9kZUxpc3RDdG9yKCk7DQoJCXZhciBmaWx0ZXJGdW5jID0gZ2V0U2ltcGxlRmlsdGVyRnVuYyhnZXRRdWVyeVBhcnRzKHNpbXBsZUZpbHRlcilbMF0pOw0KCQlmb3IodmFyIHggPSAwLCB0ZTsgdGUgPSBub2RlTGlzdFt4XTsgeCsrKXsNCgkJCWlmKGZpbHRlckZ1bmModGUpKXsgdG1wTm9kZUxpc3QucHVzaCh0ZSk7IH0NCgkJfQ0KCQlyZXR1cm4gdG1wTm9kZUxpc3Q7DQoJfQ0KfSkodGhpc1sicXVlcnlQb3J0YWJpbGl0eSJdfHx0aGlzWyJhY21lIl18fGRvam8pOw0KDQovKg0KKi8NCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UueGhyIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLnhociJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS54aHIiKTsNCg0KDQoNCg0KDQooZnVuY3Rpb24oKXsNCgl2YXIgX2QgPSBkb2pvLCBjZmcgPSBfZC5jb25maWc7DQoNCglmdW5jdGlvbiBzZXRWYWx1ZSgvKk9iamVjdCovb2JqLCAvKlN0cmluZyovbmFtZSwgLypTdHJpbmcqL3ZhbHVlKXsNCgkJLy9zdW1tYXJ5Og0KCQkvLwkJRm9yIHRoZSBuYW1lZCBwcm9wZXJ0eSBpbiBvYmplY3QsIHNldCB0aGUgdmFsdWUuIElmIGEgdmFsdWUNCgkJLy8JCWFscmVhZHkgZXhpc3RzIGFuZCBpdCBpcyBhIHN0cmluZywgY29udmVydCB0aGUgdmFsdWUgdG8gYmUgYW4NCgkJLy8JCWFycmF5IG9mIHZhbHVlcy4NCg0KCQkvL1NraXAgaXQgaWYgdGhlcmUgaXMgbm8gdmFsdWUNCgkJaWYodmFsdWUgPT09IG51bGwpew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJdmFyIHZhbCA9IG9ialtuYW1lXTsNCgkJaWYodHlwZW9mIHZhbCA9PSAic3RyaW5nIil7IC8vIGlubGluZSdkIHR5cGUgY2hlY2sNCgkJCW9ialtuYW1lXSA9IFt2YWwsIHZhbHVlXTsNCgkJfWVsc2UgaWYoX2QuaXNBcnJheSh2YWwpKXsNCgkJCXZhbC5wdXNoKHZhbHVlKTsNCgkJfWVsc2V7DQoJCQlvYmpbbmFtZV0gPSB2YWx1ZTsNCgkJfQ0KCX0NCgkNCglkb2pvLmZpZWxkVG9PYmplY3QgPSBmdW5jdGlvbigvKkRPTU5vZGV8fFN0cmluZyovIGlucHV0Tm9kZSl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlTZXJpYWxpemUgYSBmb3JtIGZpZWxkIHRvIGEgSmF2YVNjcmlwdCBvYmplY3QuDQoJCS8vDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLwkJUmV0dXJucyB0aGUgdmFsdWUgZW5jb2RlZCBpbiBhIGZvcm0gZmllbGQgYXMNCgkJLy8JCWFzIGEgc3RyaW5nIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MuIERpc2FibGVkIGZvcm0gZWxlbWVudHMNCgkJLy8JCWFuZCB1bmNoZWNrZWQgcmFkaW8gYW5kIGNoZWNrYm94ZXMgYXJlIHNraXBwZWQuCU11bHRpLXNlbGVjdA0KCQkvLwkJZWxlbWVudHMgYXJlIHJldHVybmVkIGFzIGFuIGFycmF5IG9mIHN0cmluZyB2YWx1ZXMuDQoJCXZhciByZXQgPSBudWxsOw0KCQl2YXIgaXRlbSA9IF9kLmJ5SWQoaW5wdXROb2RlKTsNCgkJaWYoaXRlbSl7DQoJCQl2YXIgX2luID0gaXRlbS5uYW1lOw0KCQkJdmFyIHR5cGUgPSAoaXRlbS50eXBlfHwiIikudG9Mb3dlckNhc2UoKTsNCgkJCWlmKF9pbiAmJiB0eXBlICYmICFpdGVtLmRpc2FibGVkKXsNCgkJCQlpZih0eXBlID09ICJyYWRpbyIgfHwgdHlwZSA9PSAiY2hlY2tib3giKXsNCgkJCQkJaWYoaXRlbS5jaGVja2VkKXsgcmV0ID0gaXRlbS52YWx1ZSB9DQoJCQkJfWVsc2UgaWYoaXRlbS5tdWx0aXBsZSl7DQoJCQkJCXJldCA9IFtdOw0KCQkJCQlfZC5xdWVyeSgib3B0aW9uIiwgaXRlbSkuZm9yRWFjaChmdW5jdGlvbihvcHQpew0KCQkJCQkJaWYob3B0LnNlbGVjdGVkKXsNCgkJCQkJCQlyZXQucHVzaChvcHQudmFsdWUpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9ZWxzZXsNCgkJCQkJcmV0ID0gaXRlbS52YWx1ZTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHJldDsgLy8gT2JqZWN0DQoJfQ0KDQoJZG9qby5mb3JtVG9PYmplY3QgPSBmdW5jdGlvbigvKkRPTU5vZGV8fFN0cmluZyovIGZvcm1Ob2RlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVNlcmlhbGl6ZSBhIGZvcm0gbm9kZSB0byBhIEphdmFTY3JpcHQgb2JqZWN0Lg0KCQkvLyBkZXNjcmlwdGlvbjoNCgkJLy8JCVJldHVybnMgdGhlIHZhbHVlcyBlbmNvZGVkIGluIGFuIEhUTUwgZm9ybSBhcw0KCQkvLwkJc3RyaW5nIHByb3BlcnRpZXMgaW4gYW4gb2JqZWN0IHdoaWNoIGl0IHRoZW4gcmV0dXJucy4gRGlzYWJsZWQgZm9ybQ0KCQkvLwkJZWxlbWVudHMsIGJ1dHRvbnMsIGFuZCBvdGhlciBub24tdmFsdWUgZm9ybSBlbGVtZW50cyBhcmUgc2tpcHBlZC4NCgkJLy8JCU11bHRpLXNlbGVjdCBlbGVtZW50cyBhcmUgcmV0dXJuZWQgYXMgYW4gYXJyYXkgb2Ygc3RyaW5nIHZhbHVlcy4NCgkJLy8NCgkJLy8gZXhhbXBsZToNCgkJLy8JCVRoaXMgZm9ybToNCgkJLy8JCXwJPGZvcm0gaWQ9InRlc3RfZm9ybSI+DQoJCS8vCQl8CQk8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iYmxhaCIgdmFsdWU9ImJsYWgiPg0KCQkvLwkJfAkJPGlucHV0IHR5cGU9InRleHQiIG5hbWU9Im5vX3ZhbHVlIiB2YWx1ZT0iYmxhaCIgZGlzYWJsZWQ+DQoJCS8vCQl8CQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBuYW1lPSJub192YWx1ZTIiIHZhbHVlPSJibGFoIj4NCgkJLy8JCXwJCTxzZWxlY3QgdHlwZT0ic2VsZWN0IiBtdWx0aXBsZSBuYW1lPSJtdWx0aSIgc2l6ZT0iNSI+DQoJCS8vCQl8CQkJPG9wdGlvbiB2YWx1ZT0iYmxhaCI+YmxhaDwvb3B0aW9uPg0KCQkvLwkJfAkJCTxvcHRpb24gdmFsdWU9InRodWQiIHNlbGVjdGVkPnRodWQ8L29wdGlvbj4NCgkJLy8JCXwJCQk8b3B0aW9uIHZhbHVlPSJ0aG9uayIgc2VsZWN0ZWQ+dGhvbms8L29wdGlvbj4NCgkJLy8JCXwJCTwvc2VsZWN0Pg0KCQkvLwkJfAk8L2Zvcm0+DQoJCS8vDQoJCS8vCQl5aWVsZHMgdGhpcyBvYmplY3Qgc3RydWN0dXJlIGFzIHRoZSByZXN1bHQgb2YgYSBjYWxsIHRvDQoJCS8vCQlmb3JtVG9PYmplY3QoKToNCgkJLy8NCgkJLy8JCXwJeyANCgkJLy8JCXwJCWJsYWg6ICJibGFoIiwNCgkJLy8JCXwJCW11bHRpOiBbDQoJCS8vCQl8CQkJInRodWQiLA0KCQkvLwkJfAkJCSJ0aG9uayINCgkJLy8JCXwJCV0NCgkJLy8JCXwJfTsNCg0KCQl2YXIgcmV0ID0ge307DQoJCXZhciBleGNsdWRlID0gImZpbGV8c3VibWl0fGltYWdlfHJlc2V0fGJ1dHRvbnwiOw0KCQlfZC5mb3JFYWNoKGRvam8uYnlJZChmb3JtTm9kZSkuZWxlbWVudHMsIGZ1bmN0aW9uKGl0ZW0pew0KCQkJdmFyIF9pbiA9IGl0ZW0ubmFtZTsNCgkJCXZhciB0eXBlID0gKGl0ZW0udHlwZXx8IiIpLnRvTG93ZXJDYXNlKCk7DQoJCQlpZihfaW4gJiYgdHlwZSAmJiBleGNsdWRlLmluZGV4T2YodHlwZSkgPT0gLTEgJiYgIWl0ZW0uZGlzYWJsZWQpew0KCQkJCXNldFZhbHVlKHJldCwgX2luLCBfZC5maWVsZFRvT2JqZWN0KGl0ZW0pKTsNCgkJCQlpZih0eXBlID09ICJpbWFnZSIpew0KCQkJCQlyZXRbX2luKyIueCJdID0gcmV0W19pbisiLnkiXSA9IHJldFtfaW5dLnggPSByZXRbX2luXS55ID0gMDsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KCQlyZXR1cm4gcmV0OyAvLyBPYmplY3QNCgl9DQoNCglkb2pvLm9iamVjdFRvUXVlcnkgPSBmdW5jdGlvbigvKk9iamVjdCovIG1hcCl7DQoJCS8vCXN1bW1hcnk6DQoJCS8vCQl0YWtlcyBhIG5hbWUvdmFsdWUgbWFwcGluZyBvYmplY3QgYW5kIHJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50aW5nDQoJCS8vCQlhIFVSTC1lbmNvZGVkIHZlcnNpb24gb2YgdGhhdCBvYmplY3QuDQoJCS8vCWV4YW1wbGU6DQoJCS8vCQl0aGlzIG9iamVjdDoNCgkJLy8NCgkJLy8JCXwJeyANCgkJLy8JCXwJCWJsYWg6ICJibGFoIiwNCgkJLy8JCXwJCW11bHRpOiBbDQoJCS8vCQl8CQkJInRodWQiLA0KCQkvLwkJfAkJCSJ0aG9uayINCgkJLy8JCXwJCV0NCgkJLy8JCXwJfTsNCgkJLy8NCgkJLy8JeWllbGRzIHRoZSBmb2xsb3dpbmcgcXVlcnkgc3RyaW5nOg0KCQkvLwkNCgkJLy8JfAkiYmxhaD1ibGFoJm11bHRpPXRodWQmbXVsdGk9dGhvbmsiDQoNCgkJLy8gRklYTUU6IG5lZWQgdG8gaW1wbGVtZW50IGVuY29kZUFzY2lpISENCgkJdmFyIGVuYyA9IGVuY29kZVVSSUNvbXBvbmVudDsNCgkJdmFyIHBhaXJzID0gW107DQoJCXZhciBiYWNrc3RvcCA9IHt9Ow0KCQlmb3IodmFyIG5hbWUgaW4gbWFwKXsNCgkJCXZhciB2YWx1ZSA9IG1hcFtuYW1lXTsNCgkJCWlmKHZhbHVlICE9IGJhY2tzdG9wW25hbWVdKXsNCgkJCQl2YXIgYXNzaWduID0gZW5jKG5hbWUpICsgIj0iOw0KCQkJCWlmKF9kLmlzQXJyYXkodmFsdWUpKXsNCgkJCQkJZm9yKHZhciBpPTA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKyl7DQoJCQkJCQlwYWlycy5wdXNoKGFzc2lnbiArIGVuYyh2YWx1ZVtpXSkpOw0KCQkJCQl9DQoJCQkJfWVsc2V7DQoJCQkJCXBhaXJzLnB1c2goYXNzaWduICsgZW5jKHZhbHVlKSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCXJldHVybiBwYWlycy5qb2luKCImIik7IC8vIFN0cmluZw0KCX0NCg0KCWRvam8uZm9ybVRvUXVlcnkgPSBmdW5jdGlvbigvKkRPTU5vZGV8fFN0cmluZyovIGZvcm1Ob2RlKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYSBVUkwtZW5jb2RlZCBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBmb3JtIHBhc3NlZCBhcyBlaXRoZXIgYQ0KCQkvLwkJbm9kZSBvciBzdHJpbmcgSUQgaWRlbnRpZnlpbmcgdGhlIGZvcm0gdG8gc2VyaWFsaXplDQoJCXJldHVybiBfZC5vYmplY3RUb1F1ZXJ5KF9kLmZvcm1Ub09iamVjdChmb3JtTm9kZSkpOyAvLyBTdHJpbmcNCgl9DQoNCglkb2pvLmZvcm1Ub0pzb24gPSBmdW5jdGlvbigvKkRPTU5vZGV8fFN0cmluZyovIGZvcm1Ob2RlLCAvKkJvb2xlYW4/Ki9wcmV0dHlQcmludCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vCQlDcmVhdGUgYSBzZXJpYWxpemVkIEpTT04gc3RyaW5nIGZyb20gYSBmb3JtIG5vZGUgb3Igc3RyaW5nDQoJCS8vCQlJRCBpZGVudGlmeWluZyB0aGUgZm9ybSB0byBzZXJpYWxpemUNCgkJcmV0dXJuIF9kLnRvSnNvbihfZC5mb3JtVG9PYmplY3QoZm9ybU5vZGUpLCBwcmV0dHlQcmludCk7IC8vIFN0cmluZw0KCX0NCg0KCWRvam8ucXVlcnlUb09iamVjdCA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gc3RyKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCUNyZWF0ZSBhbiBvYmplY3QgcmVwcmVzZW50aW5nIGEgZGUtc2VyaWFsaXplZCBxdWVyeSBzZWN0aW9uIG9mIGENCgkJLy8JCVVSTC4gUXVlcnkga2V5cyB3aXRoIG11bHRpcGxlIHZhbHVlcyBhcmUgcmV0dXJuZWQgaW4gYW4gYXJyYXkuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlUaGlzIHN0cmluZzoNCgkJLy8NCgkJLy8JfAkJImZvbz1iYXImZm9vPWJheiZ0aGluZ2VyPSUyMHNwYWNlcyUyMD1ibGFoJnpvbms9YmxhcmcmIg0KCQkvLwkJDQoJCS8vCQlyZXN1bHRzIGluIHRoaXMgb2JqZWN0IHN0cnVjdHVyZToNCgkJLy8NCgkJLy8JfAkJew0KCQkvLwl8CQkJZm9vOiBbICJiYXIiLCAiYmF6IiBdLA0KCQkvLwl8CQkJdGhpbmdlcjogIiBzcGFjZXMgPWJsYWgiLA0KCQkvLwl8CQkJem9uazogImJsYXJnIg0KCQkvLwl8CQl9DQoJCS8vCQ0KCQkvLwkJTm90ZSB0aGF0IHNwYWNlcyBhbmQgb3RoZXIgdXJsZW5jb2RlZCBlbnRpdGllcyBhcmUgY29ycmVjdGx5DQoJCS8vCQloYW5kbGVkLg0KDQoJCS8vIEZJWE1FOiBzaG91bGQgd2UgZ3JhYiB0aGUgVVJMIHN0cmluZyBpZiB3ZSdyZSBub3QgcGFzc2VkIG9uZT8NCgkJdmFyIHJldCA9IHt9Ow0KCQl2YXIgcXAgPSBzdHIuc3BsaXQoIiYiKTsNCgkJdmFyIGRlYyA9IGRlY29kZVVSSUNvbXBvbmVudDsNCgkJX2QuZm9yRWFjaChxcCwgZnVuY3Rpb24oaXRlbSl7DQoJCQlpZihpdGVtLmxlbmd0aCl7DQoJCQkJdmFyIHBhcnRzID0gaXRlbS5zcGxpdCgiPSIpOw0KCQkJCXZhciBuYW1lID0gZGVjKHBhcnRzLnNoaWZ0KCkpOw0KCQkJCXZhciB2YWwgPSBkZWMocGFydHMuam9pbigiPSIpKTsNCgkJCQlpZih0eXBlb2YgcmV0W25hbWVdID09ICJzdHJpbmciKXsgLy8gaW5saW5lJ2QgdHlwZSBjaGVjaw0KCQkJCQlyZXRbbmFtZV0gPSBbcmV0W25hbWVdXTsNCgkJCQl9DQoNCgkJCQlpZihfZC5pc0FycmF5KHJldFtuYW1lXSkpew0KCQkJCQlyZXRbbmFtZV0ucHVzaCh2YWwpOw0KCQkJCX1lbHNlew0KCQkJCQlyZXRbbmFtZV0gPSB2YWw7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCgkJcmV0dXJuIHJldDsgLy8gT2JqZWN0DQoJfQ0KDQoJLy8gbmVlZCB0byBibG9jayBhc3luYyBjYWxsYmFja3MgZnJvbSBzbmF0Y2hpbmcgdGhpcyB0aHJlYWQgYXMgdGhlIHJlc3VsdA0KCS8vIG9mIGFuIGFzeW5jIGNhbGxiYWNrIG1pZ2h0IGNhbGwgYW5vdGhlciBzeW5jIFhIUiwgdGhpcyBoYW5ncyBraHRtbCBmb3JldmVyDQoJLy8gbXVzdCBjaGVja2VkIGJ5IHdhdGNoSW5GbGlnaHQoKQ0KDQoJZG9qby5fYmxvY2tBc3luYyA9IGZhbHNlOw0KDQoJLy8gTU9XOiByZW1vdmUgZG9qby5fY29udGVudEhhbmRsZXJzIGFsaWFzIGluIDIuMA0KCXZhciBoYW5kbGVycyA9IF9kLl9jb250ZW50SGFuZGxlcnMgPSBkb2pvLmNvbnRlbnRIYW5kbGVycyA9IHsNCgkJLy8gc3VtbWFyeTogDQoJCS8vCQlBIG1hcCBvZiBhdmFpbGJsZSBYSFIgdHJhbnNwb3J0IGhhbmRsZSB0eXBlcy4gTmFtZSBtYXRjaGVzIHRoZQ0KCQkvLwkJYGhhbmRsZUFzYCBhdHRyaWJ1dGUgcGFzc2VkIHRvIFhIUiBjYWxscy4NCgkJLy8NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQlBIG1hcCBvZiBhdmFpbGJsZSBYSFIgdHJhbnNwb3J0IGhhbmRsZSB0eXBlcy4gTmFtZSBtYXRjaGVzIHRoZQ0KCQkvLwkJYGhhbmRsZUFzYCBhdHRyaWJ1dGUgcGFzc2VkIHRvIFhIUiBjYWxscy4gRWFjaCBjb250ZW50SGFuZGxlciBpcw0KCQkvLwkJY2FsbGVkLCBwYXNzaW5nIHRoZSB4aHIgb2JqZWN0IGZvciBtYW5pcHVsYXRpb24uIFRoZSByZXR1cm4gdmFsdWUNCgkJLy8JCWZyb20gdGhlIGNvbnRlbnRIYW5kbGVyIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBgbG9hZGAgb3IgYGhhbmRsZWAgDQoJCS8vCQlmdW5jdGlvbnMgZGVmaW5lZCBpbiB0aGUgb3JpZ2luYWwgeGhyIGNhbGwuIA0KCQkvLwkJDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlDcmVhdGluZyBhIGN1c3RvbSBjb250ZW50LWhhbmRsZXI6DQoJCS8vCXwJZG9qby5jb250ZW50SGFuZGxlcnMubWFrZUNhcHMgPSBmdW5jdGlvbih4aHIpew0KCQkvLwl8CQlyZXR1cm4geGhyLnJlc3BvbnNlVGV4dC50b1VwcGVyQ2FzZSgpOw0KCQkvLwl8CX0NCgkJLy8JfAkvLyBhbmQgbGF0ZXI6DQoJCS8vCXwJZG9qby54aHJHZXQoeyANCgkJLy8JfAkJdXJsOiJmb28udHh0IiwNCgkJLy8JfAkJaGFuZGxlQXM6Im1ha2VDYXBzIiwNCgkJLy8JfAkJbG9hZDogZnVuY3Rpb24oZGF0YSl7IC8qIGRhdGEgaXMgYSB0b1VwcGVyIHZlcnNpb24gb2YgZm9vLnR4dCAqLyB9DQoJCS8vCXwJfSk7DQoNCgkJdGV4dDogZnVuY3Rpb24oeGhyKXsgDQoJCQkvLyBzdW1tYXJ5OiBBIGNvbnRlbnRIYW5kbGVyIHdoaWNoIHNpbXBseSByZXR1cm5zIHRoZSBwbGFpbnRleHQgcmVzcG9uc2UgZGF0YQ0KCQkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQ7IA0KCQl9LA0KCQlqc29uOiBmdW5jdGlvbih4aHIpew0KCQkJLy8gc3VtbWFyeTogQSBjb250ZW50SGFuZGxlciB3aGljaCByZXR1cm5zIGEgSmF2YVNjcmlwdCBvYmplY3QgY3JlYXRlZCBmcm9tIHRoZSByZXNwb25zZSBkYXRhDQoJCQlyZXR1cm4gX2QuZnJvbUpzb24oeGhyLnJlc3BvbnNlVGV4dCB8fCBudWxsKTsNCgkJfSwNCgkJImpzb24tY29tbWVudC1maWx0ZXJlZCI6IGZ1bmN0aW9uKHhocil7IA0KCQkJLy8gc3VtbWFyeTogQSBjb250ZW50SGFuZGxlciB3aGljaCBleHBlY3RzIGNvbW1lbnQtZmlsdGVyZWQgSlNPTi4gDQoJCQkvLyBkZXNjcmlwdGlvbjogDQoJCQkvLwkJQSBjb250ZW50SGFuZGxlciB3aGljaCBleHBlY3RzIGNvbW1lbnQtZmlsdGVyZWQgSlNPTi4gDQoJCQkvLwkJdGhlIGpzb24tY29tbWVudC1maWx0ZXJlZCBvcHRpb24gd2FzIGltcGxlbWVudGVkIHRvIHByZXZlbnQNCgkJCS8vCQkiSmF2YVNjcmlwdCBIaWphY2tpbmciLCBidXQgaXQgaXMgbGVzcyBzZWN1cmUgdGhhbiBzdGFuZGFyZCBKU09OLiBVc2UNCgkJCS8vCQlzdGFuZGFyZCBKU09OIGluc3RlYWQuIEpTT04gcHJlZml4aW5nIGNhbiBiZSB1c2VkIHRvIHN1YnZlcnQgaGlqYWNraW5nLg0KCQkJLy8JCQ0KCQkJLy8JCVdpbGwgdGhyb3cgYSBub3RpY2Ugc3VnZ2VzdGluZyB0byB1c2UgYXBwbGljYXRpb24vanNvbiBtaW1ldHlwZSwgYXMNCgkJCS8vCQlqc29uLWNvbW1lbnRpbmcgY2FuIGludHJvZHVjZSBzZWN1cml0eSBpc3N1ZXMuIFRvIGRlY3JlYXNlIHRoZSBjaGFuY2VzIG9mIGhpamFja2luZywNCgkJCS8vCQl1c2UgdGhlIHN0YW5kYXJkIGBqc29uYCBjb250ZW50SGFuZGxlciwgYW5kIHByZWZpeCB5b3VyICJKU09OIiB3aXRoOiB7fSYmIA0KCQkJLy8JCQ0KCQkJLy8JCXVzZSBkakNvbmZpZy51c2VDb21tZW50ZWRKc29uID0gdHJ1ZSB0byB0dXJuIG9mZiB0aGUgbm90aWNlDQoJCQlpZighZG9qby5jb25maWcudXNlQ29tbWVudGVkSnNvbil7DQoJCQkJY29uc29sZS53YXJuKCJDb25zaWRlciB1c2luZyB0aGUgc3RhbmRhcmQgbWltZXR5cGU6YXBwbGljYXRpb24vanNvbi4iDQoJCQkJCSsgIiBqc29uLWNvbW1lbnRpbmcgY2FuIGludHJvZHVjZSBzZWN1cml0eSBpc3N1ZXMuIFRvIg0KCQkJCQkrICIgZGVjcmVhc2UgdGhlIGNoYW5jZXMgb2YgaGlqYWNraW5nLCB1c2UgdGhlIHN0YW5kYXJkIHRoZSAnanNvbicgaGFuZGxlciBhbmQiDQoJCQkJCSsgIiBwcmVmaXggeW91ciBqc29uIHdpdGg6IHt9JiZcbiINCgkJCQkJKyAiVXNlIGRqQ29uZmlnLnVzZUNvbW1lbnRlZEpzb249dHJ1ZSB0byB0dXJuIG9mZiB0aGlzIG1lc3NhZ2UuIik7DQoJCQl9DQoNCgkJCXZhciB2YWx1ZSA9IHhoci5yZXNwb25zZVRleHQ7DQoJCQl2YXIgY1N0YXJ0SWR4ID0gdmFsdWUuaW5kZXhPZigiXC8qIik7DQoJCQl2YXIgY0VuZElkeCA9IHZhbHVlLmxhc3RJbmRleE9mKCIqXC8iKTsNCgkJCWlmKGNTdGFydElkeCA9PSAtMSB8fCBjRW5kSWR4ID09IC0xKXsNCgkJCQl0aHJvdyBuZXcgRXJyb3IoIkpTT04gd2FzIG5vdCBjb21tZW50IGZpbHRlcmVkIik7DQoJCQl9DQoJCQlyZXR1cm4gX2QuZnJvbUpzb24odmFsdWUuc3Vic3RyaW5nKGNTdGFydElkeCsyLCBjRW5kSWR4KSk7DQoJCX0sDQoJCWphdmFzY3JpcHQ6IGZ1bmN0aW9uKHhocil7IA0KCQkJLy8gc3VtbWFyeTogQSBjb250ZW50SGFuZGxlciB3aGljaCBldmFsdWF0ZXMgdGhlIHJlc3BvbnNlIGRhdGEsIGV4cGVjdGluZyBpdCB0byBiZSB2YWxpZCBKYXZhU2NyaXB0DQoNCgkJCS8vIEZJWE1FOiB0cnkgTW96IGFuZCBJRSBzcGVjaWZpYyBldmFsIHZhcmlhbnRzPw0KCQkJcmV0dXJuIF9kLmV2YWwoeGhyLnJlc3BvbnNlVGV4dCk7DQoJCX0sDQoJCXhtbDogZnVuY3Rpb24oeGhyKXsNCgkJCS8vIHN1bW1hcnk6IEEgY29udGVudEhhbmRsZXIgcmV0dXJuaW5nIGFuIFhNTCBEb2N1bWVudCBwYXJzZWQgZnJvbSB0aGUgcmVzcG9uc2UgZGF0YQ0KCQkJdmFyIHJlc3VsdCA9IHhoci5yZXNwb25zZVhNTDsNCgkJCQkJCWlmKF9kLmlzSUUgJiYgKCFyZXN1bHQgfHwgIXJlc3VsdC5kb2N1bWVudEVsZW1lbnQpKXsNCgkJCQkvL1dBUk5JTkc6IHRoaXMgYnJhbmNoIHVzZWQgYnkgdGhlIHhtbCBoYW5kbGluZyBpbiBkb2pvLmlvLmlmcmFtZSwNCgkJCQkvL3NvIGJlIHN1cmUgdG8gdGVzdCBkb2pvLmlvLmlmcmFtZSBpZiBtYWtpbmcgY2hhbmdlcyBiZWxvdy4NCgkJCQl2YXIgbXMgPSBmdW5jdGlvbihuKXsgcmV0dXJuICJNU1hNTCIgKyBuICsgIi5ET01Eb2N1bWVudCI7IH0NCgkJCQl2YXIgZHAgPSBbIk1pY3Jvc29mdC5YTUxET00iLCBtcyg2KSwgbXMoNCksIG1zKDMpLCBtcygyKV07DQoJCQkJX2Quc29tZShkcCwgZnVuY3Rpb24ocCl7DQoJCQkJCXRyeXsNCgkJCQkJCXZhciBkb20gPSBuZXcgQWN0aXZlWE9iamVjdChwKTsNCgkJCQkJCWRvbS5hc3luYyA9IGZhbHNlOw0KCQkJCQkJZG9tLmxvYWRYTUwoeGhyLnJlc3BvbnNlVGV4dCk7DQoJCQkJCQlyZXN1bHQgPSBkb207DQoJCQkJCX1jYXRjaChlKXsgcmV0dXJuIGZhbHNlOyB9DQoJCQkJCXJldHVybiB0cnVlOw0KCQkJCX0pOw0KCQkJfQ0KCQkJCQkJcmV0dXJuIHJlc3VsdDsgLy8gRE9NRG9jdW1lbnQNCgkJfSwNCgkJImpzb24tY29tbWVudC1vcHRpb25hbCI6IGZ1bmN0aW9uKHhocil7DQoJCQkvLyBzdW1tYXJ5OiBBIGNvbnRlbnRIYW5kbGVyIHdoaWNoIGNoZWNrcyB0aGUgcHJlc2VuY2Ugb2YgY29tbWVudC1maWx0ZXJlZCBKU09OIGFuZCANCgkJCS8vCQlhbHRlcm5hdGVzIGJldHdlZW4gdGhlIGBqc29uYCBhbmQgYGpzb24tY29tbWVudC1maWx0ZXJlZGAgY29udGVudEhhbmRsZXJzLg0KCQkJaWYoeGhyLnJlc3BvbnNlVGV4dCAmJiAvXltee1xbXSpcL1wqLy50ZXN0KHhoci5yZXNwb25zZVRleHQpKXsNCgkJCQlyZXR1cm4gaGFuZGxlcnNbImpzb24tY29tbWVudC1maWx0ZXJlZCJdKHhocik7DQoJCQl9ZWxzZXsNCgkJCQlyZXR1cm4gaGFuZGxlcnNbImpzb24iXSh4aHIpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCS8qPT09PT0NCglkb2pvLl9fSW9BcmdzID0gZnVuY3Rpb24oKXsNCgkJLy8JdXJsOiBTdHJpbmcNCgkJLy8JCVVSTCB0byBzZXJ2ZXIgZW5kcG9pbnQuDQoJCS8vCWNvbnRlbnQ6IE9iamVjdD8NCgkJLy8JCUNvbnRhaW5zIHByb3BlcnRpZXMgd2l0aCBzdHJpbmcgdmFsdWVzLiBUaGVzZQ0KCQkvLwkJcHJvcGVydGllcyB3aWxsIGJlIHNlcmlhbGl6ZWQgYXMgbmFtZTE9dmFsdWUyIGFuZA0KCQkvLwkJcGFzc2VkIGluIHRoZSByZXF1ZXN0Lg0KCQkvLwl0aW1lb3V0OiBJbnRlZ2VyPw0KCQkvLwkJTWlsbGlzZWNvbmRzIHRvIHdhaXQgZm9yIHRoZSByZXNwb25zZS4gSWYgdGhpcyB0aW1lDQoJCS8vCQlwYXNzZXMsIHRoZSB0aGVuIGVycm9yIGNhbGxiYWNrcyBhcmUgY2FsbGVkLg0KCQkvLwlmb3JtOiBET01Ob2RlPw0KCQkvLwkJRE9NIG5vZGUgZm9yIGEgZm9ybS4gVXNlZCB0byBleHRyYWN0IHRoZSBmb3JtIHZhbHVlcw0KCQkvLwkJYW5kIHNlbmQgdG8gdGhlIHNlcnZlci4NCgkJLy8JcHJldmVudENhY2hlOiBCb29sZWFuPw0KCQkvLwkJRGVmYXVsdCBpcyBmYWxzZS4gSWYgdHJ1ZSwgdGhlbiBhDQoJCS8vCQkiZG9qby5wcmV2ZW50Q2FjaGUiIHBhcmFtZXRlciBpcyBzZW50IGluIHRoZSByZXF1ZXN0DQoJCS8vCQl3aXRoIGEgdmFsdWUgdGhhdCBjaGFuZ2VzIHdpdGggZWFjaCByZXF1ZXN0DQoJCS8vCQkodGltZXN0YW1wKS4gVXNlZnVsIG9ubHkgd2l0aCBHRVQtdHlwZSByZXF1ZXN0cy4NCgkJLy8JaGFuZGxlQXM6IFN0cmluZz8NCgkJLy8JCUFjY2VwdGFibGUgdmFsdWVzIGRlcGVuZCBvbiB0aGUgdHlwZSBvZiBJTw0KCQkvLwkJdHJhbnNwb3J0IChzZWUgc3BlY2lmaWMgSU8gY2FsbHMgZm9yIG1vcmUgaW5mb3JtYXRpb24pLg0KCQkvLyAJcmF3Qm9keTogU3RyaW5nPw0KCQkvLyAJCVNldHMgdGhlIHJhdyBib2R5IGZvciBhbiBIVFRQIHJlcXVlc3QuIElmIHRoaXMgaXMgdXNlZCwgdGhlbiB0aGUgY29udGVudA0KCQkvLyAJCXByb3BlcnR5IGlzIGlnbm9yZWQuIFRoaXMgaXMgbW9zdGx5IHVzZWZ1bCBmb3IgSFRUUCBtZXRob2RzIHRoYXQgaGF2ZQ0KCQkvLyAJCWEgYm9keSB0byB0aGVpciByZXF1ZXN0cywgbGlrZSBQVVQgb3IgUE9TVC4gVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCBpbnN0ZWFkDQoJCS8vIAkJb2YgcG9zdERhdGEgYW5kIHB1dERhdGEgZm9yIGRvam8ucmF3WGhyUG9zdCBhbmQgZG9qby5yYXdYaHJQdXQgcmVzcGVjdGl2ZWx5Lg0KCQkvLwlpb1B1Ymxpc2g6IEJvb2xlYW4/DQoJCS8vCQlTZXQgdGhpcyBleHBsaWNpdGx5IHRvIGZhbHNlIHRvIHByZXZlbnQgcHVibGlzaGluZyBvZiB0b3BpY3MgcmVsYXRlZCB0bw0KCQkvLyAJCUlPIG9wZXJhdGlvbnMuIE90aGVyd2lzZSwgaWYgZGpDb25maWcuaW9QdWJsaXNoIGlzIHNldCB0byB0cnVlLCB0b3BpY3MNCgkJLy8gCQl3aWxsIGJlIHB1Ymxpc2hlZCB2aWEgZG9qby5wdWJsaXNoIGZvciBkaWZmZXJlbnQgcGhhc2VzIG9mIGFuIElPIG9wZXJhdGlvbi4NCgkJLy8gCQlTZWUgZG9qby5fX0lvUHVibGlzaCBmb3IgYSBsaXN0IG9mIHRvcGljcyB0aGF0IGFyZSBwdWJsaXNoZWQuDQoJCS8vCWxvYWQ6IEZ1bmN0aW9uPw0KCQkvLwkJVGhpcyBmdW5jdGlvbiB3aWxsIGJlDQoJCS8vCQljYWxsZWQgb24gYSBzdWNjZXNzZnVsIEhUVFAgcmVzcG9uc2UgY29kZS4NCgkJLy8JZXJyb3I6IEZ1bmN0aW9uPw0KCQkvLwkJVGhpcyBmdW5jdGlvbiB3aWxsDQoJCS8vCQliZSBjYWxsZWQgd2hlbiB0aGUgcmVxdWVzdCBmYWlscyBkdWUgdG8gYSBuZXR3b3JrIG9yIHNlcnZlciBlcnJvciwgdGhlIHVybA0KCQkvLwkJaXMgaW52YWxpZCwgZXRjLiBJdCB3aWxsIGFsc28gYmUgY2FsbGVkIGlmIHRoZSBsb2FkIG9yIGhhbmRsZSBjYWxsYmFjayB0aHJvd3MgYW4NCgkJLy8JCWV4Y2VwdGlvbiwgdW5sZXNzIGRqQ29uZmlnLmRlYnVnQXRBbGxDb3N0cyBpcyB0cnVlLiAgVGhpcyBhbGxvd3MgZGVwbG95ZWQgYXBwbGljYXRpb25zDQoJCS8vCQl0byBjb250aW51ZSB0byBydW4gZXZlbiB3aGVuIGEgbG9naWMgZXJyb3IgaGFwcGVucyBpbiB0aGUgY2FsbGJhY2ssIHdoaWxlIG1ha2luZw0KCQkvLwkJaXQgZWFzaWVyIHRvIHRyb3VibGVzaG9vdCB3aGlsZSBpbiBkZWJ1ZyBtb2RlLg0KCQkvLwloYW5kbGU6IEZ1bmN0aW9uPw0KCQkvLwkJVGhpcyBmdW5jdGlvbiB3aWxsDQoJCS8vCQliZSBjYWxsZWQgYXQgdGhlIGVuZCBvZiBldmVyeSByZXF1ZXN0LCB3aGV0aGVyIG9yIG5vdCBhbiBlcnJvciBvY2N1cnMuDQoJCXRoaXMudXJsID0gdXJsOw0KCQl0aGlzLmNvbnRlbnQgPSBjb250ZW50Ow0KCQl0aGlzLnRpbWVvdXQgPSB0aW1lb3V0Ow0KCQl0aGlzLmZvcm0gPSBmb3JtOw0KCQl0aGlzLnByZXZlbnRDYWNoZSA9IHByZXZlbnRDYWNoZTsNCgkJdGhpcy5oYW5kbGVBcyA9IGhhbmRsZUFzOw0KCQl0aGlzLmlvUHVibGlzaCA9IGlvUHVibGlzaDsNCgkJdGhpcy5sb2FkID0gZnVuY3Rpb24ocmVzcG9uc2UsIGlvQXJncyl7DQoJCQkvLyBpb0FyZ3M6IGRvam8uX19Jb0NhbGxiYWNrQXJncw0KCQkJLy8JCVByb3ZpZGVzIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHJlcXVlc3QuDQoJCQkvLyByZXNwb25zZTogT2JqZWN0DQoJCQkvLwkJVGhlIHJlc3BvbnNlIGluIHRoZSBmb3JtYXQgYXMgZGVmaW5lZCB3aXRoIGhhbmRsZUFzLg0KCQl9DQoJCXRoaXMuZXJyb3IgPSBmdW5jdGlvbihyZXNwb25zZSwgaW9BcmdzKXsNCgkJCS8vIGlvQXJnczogZG9qby5fX0lvQ2FsbGJhY2tBcmdzDQoJCQkvLwkJUHJvdmlkZXMgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgcmVxdWVzdC4NCgkJCS8vIHJlc3BvbnNlOiBPYmplY3QNCgkJCS8vCQlUaGUgcmVzcG9uc2UgaW4gdGhlIGZvcm1hdCBhcyBkZWZpbmVkIHdpdGggaGFuZGxlQXMuDQoJCX0NCgkJdGhpcy5oYW5kbGUgPSBmdW5jdGlvbihsb2FkT3JFcnJvciwgcmVzcG9uc2UsIGlvQXJncyl7DQoJCQkvLyBsb2FkT3JFcnJvcjogU3RyaW5nDQoJCQkvLwkJUHJvdmlkZXMgYSBzdHJpbmcgdGhhdCB0ZWxscyB5b3Ugd2hldGhlciB0aGlzIGZ1bmN0aW9uDQoJCQkvLwkJd2FzIGNhbGxlZCBiZWNhdXNlIG9mIHN1Y2Nlc3MgKGxvYWQpIG9yIGZhaWx1cmUgKGVycm9yKS4NCgkJCS8vIHJlc3BvbnNlOiBPYmplY3QNCgkJCS8vCQlUaGUgcmVzcG9uc2UgaW4gdGhlIGZvcm1hdCBhcyBkZWZpbmVkIHdpdGggaGFuZGxlQXMuDQoJCQkvLyBpb0FyZ3M6IGRvam8uX19Jb0NhbGxiYWNrQXJncw0KCQkJLy8JCVByb3ZpZGVzIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHJlcXVlc3QuDQoJCX0NCgl9DQoJPT09PT0qLw0KDQoJLyo9PT09PQ0KCWRvam8uX19Jb0NhbGxiYWNrQXJncyA9IGZ1bmN0aW9uKGFyZ3MsIHhociwgdXJsLCBxdWVyeSwgaGFuZGxlQXMsIGlkLCBjYW5EZWxldGUsIGpzb24pew0KCQkvLwlhcmdzOiBPYmplY3QNCgkJLy8JCXRoZSBvcmlnaW5hbCBvYmplY3QgYXJndW1lbnQgdG8gdGhlIElPIGNhbGwuDQoJCS8vCXhocjogWE1MSHR0cFJlcXVlc3QNCgkJLy8JCUZvciBYTUxIdHRwUmVxdWVzdCBjYWxscyBvbmx5LCB0aGUNCgkJLy8JCVhNTEh0dHBSZXF1ZXN0IG9iamVjdCB0aGF0IHdhcyB1c2VkIGZvciB0aGUNCgkJLy8JCXJlcXVlc3QuDQoJCS8vCXVybDogU3RyaW5nDQoJCS8vCQlUaGUgZmluYWwgVVJMIHVzZWQgZm9yIHRoZSBjYWxsLiBNYW55IHRpbWVzIGl0DQoJCS8vCQl3aWxsIGJlIGRpZmZlcmVudCB0aGFuIHRoZSBvcmlnaW5hbCBhcmdzLnVybA0KCQkvLwkJdmFsdWUuDQoJCS8vCXF1ZXJ5OiBTdHJpbmcNCgkJLy8JCUZvciBub24tR0VUIHJlcXVlc3RzLCB0aGUNCgkJLy8JCW5hbWUxPXZhbHVlMSZuYW1lMj12YWx1ZTIgcGFyYW1ldGVycyBzZW50IHVwIGluDQoJCS8vCQl0aGUgcmVxdWVzdC4NCgkJLy8JaGFuZGxlQXM6IFN0cmluZw0KCQkvLwkJVGhlIGZpbmFsIGluZGljYXRvciBvbiBob3cgdGhlIHJlc3BvbnNlIHdpbGwgYmUNCgkJLy8JCWhhbmRsZWQuDQoJCS8vCWlkOiBTdHJpbmcNCgkJLy8JCUZvciBkb2pvLmlvLnNjcmlwdCBjYWxscyBvbmx5LCB0aGUgaW50ZXJuYWwNCgkJLy8JCXNjcmlwdCBJRCB1c2VkIGZvciB0aGUgcmVxdWVzdC4NCgkJLy8JY2FuRGVsZXRlOiBCb29sZWFuDQoJCS8vCQlGb3IgZG9qby5pby5zY3JpcHQgY2FsbHMgb25seSwgaW5kaWNhdGVzDQoJCS8vCQl3aGV0aGVyIHRoZSBzY3JpcHQgdGFnIHRoYXQgcmVwcmVzZW50cyB0aGUNCgkJLy8JCXJlcXVlc3QgY2FuIGJlIGRlbGV0ZWQgYWZ0ZXIgY2FsbGJhY2tzIGhhdmUNCgkJLy8JCWJlZW4gY2FsbGVkLiBVc2VkIGludGVybmFsbHkgdG8ga25vdyB3aGVuDQoJCS8vCQljbGVhbnVwIGNhbiBoYXBwZW4gb24gSlNPTlAtdHlwZSByZXF1ZXN0cy4NCgkJLy8JanNvbjogT2JqZWN0DQoJCS8vCQlGb3IgZG9qby5pby5zY3JpcHQgY2FsbHMgb25seTogaG9sZHMgdGhlIEpTT04NCgkJLy8JCXJlc3BvbnNlIGZvciBKU09OUC10eXBlIHJlcXVlc3RzLiBVc2VkDQoJCS8vCQlpbnRlcm5hbGx5IHRvIGhvbGQgb24gdG8gdGhlIEpTT04gcmVzcG9uc2VzLg0KCQkvLwkJWW91IHNob3VsZCBub3QgbmVlZCB0byBhY2Nlc3MgaXQgZGlyZWN0bHkgLS0NCgkJLy8JCXRoZSBzYW1lIG9iamVjdCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBzdWNjZXNzDQoJCS8vCQljYWxsYmFja3MgZGlyZWN0bHkuDQoJCXRoaXMuYXJncyA9IGFyZ3M7DQoJCXRoaXMueGhyID0geGhyOw0KCQl0aGlzLnVybCA9IHVybDsNCgkJdGhpcy5xdWVyeSA9IHF1ZXJ5Ow0KCQl0aGlzLmhhbmRsZUFzID0gaGFuZGxlQXM7DQoJCXRoaXMuaWQgPSBpZDsNCgkJdGhpcy5jYW5EZWxldGUgPSBjYW5EZWxldGU7DQoJCXRoaXMuanNvbiA9IGpzb247DQoJfQ0KCT09PT09Ki8NCg0KDQoJLyo9PT09PQ0KCWRvam8uX19Jb1B1Ymxpc2ggPSBmdW5jdGlvbigpew0KCQkvLyAJc3VtbWFyeToNCgkJLy8gCQlUaGlzIGlzIGEgbGlzdCBvZiBJTyB0b3BpY3MgdGhhdCBjYW4gYmUgcHVibGlzaGVkDQoJCS8vIAkJaWYgZGpDb25maWcuaW9QdWJsaXNoIGlzIHNldCB0byB0cnVlLiBJTyB0b3BpY3MgY2FuIGJlDQoJCS8vIAkJcHVibGlzaGVkIGZvciBhbnkgSW5wdXQvT3V0cHV0LCBuZXR3b3JrIG9wZXJhdGlvbi4gU28sDQoJCS8vIAkJZG9qby54aHIsIGRvam8uaW8uc2NyaXB0IGFuZCBkb2pvLmlvLmlmcmFtZSBjYW4gYWxsDQoJCS8vIAkJdHJpZ2dlciB0aGVzZSB0b3BpY3MgdG8gYmUgcHVibGlzaGVkLg0KCQkvLwlzdGFydDogU3RyaW5nDQoJCS8vCQkiL2Rvam8vaW8vc3RhcnQiIGlzIHNlbnQgd2hlbiB0aGVyZSBhcmUgbm8gb3V0c3RhbmRpbmcgSU8NCgkJLy8gCQlyZXF1ZXN0cywgYW5kIGEgbmV3IElPIHJlcXVlc3QgaXMgc3RhcnRlZC4gTm8gYXJndW1lbnRzDQoJCS8vIAkJYXJlIHBhc3NlZCB3aXRoIHRoaXMgdG9waWMuDQoJCS8vCXNlbmQ6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL3NlbmQiIGlzIHNlbnQgd2hlbmV2ZXIgYSBuZXcgSU8gcmVxdWVzdCBpcyBzdGFydGVkLg0KCQkvLyAJCUl0IHBhc3NlcyB0aGUgZG9qby5EZWZlcnJlZCBmb3IgdGhlIHJlcXVlc3Qgd2l0aCB0aGUgdG9waWMuDQoJCS8vCWxvYWQ6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL2xvYWQiIGlzIHNlbnQgd2hlbmV2ZXIgYW4gSU8gcmVxdWVzdCBoYXMgbG9hZGVkDQoJCS8vIAkJc3VjY2Vzc2Z1bGx5LiBJdCBwYXNzZXMgdGhlIHJlc3BvbnNlIGFuZCB0aGUgZG9qby5EZWZlcnJlZA0KCQkvLyAJCWZvciB0aGUgcmVxdWVzdCB3aXRoIHRoZSB0b3BpYy4NCgkJLy8JZXJyb3I6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL2Vycm9yIiBpcyBzZW50IHdoZW5ldmVyIGFuIElPIHJlcXVlc3QgaGFzIGVycm9yZWQuDQoJCS8vIAkJSXQgcGFzc2VzIHRoZSBlcnJvciBhbmQgdGhlIGRvam8uRGVmZXJyZWQNCgkJLy8gCQlmb3IgdGhlIHJlcXVlc3Qgd2l0aCB0aGUgdG9waWMuDQoJCS8vCWRvbmU6IFN0cmluZw0KCQkvLwkJIi9kb2pvL2lvL2RvbmUiIGlzIHNlbnQgd2hlbmV2ZXIgYW4gSU8gcmVxdWVzdCBoYXMgY29tcGxldGVkLA0KCQkvLyAJCWVpdGhlciBieSBsb2FkaW5nIG9yIGJ5IGVycm9yaW5nLiBJdCBwYXNzZXMgdGhlIGVycm9yIGFuZA0KCQkvLyAJCXRoZSBkb2pvLkRlZmVycmVkIGZvciB0aGUgcmVxdWVzdCB3aXRoIHRoZSB0b3BpYy4NCgkJLy8Jc3RvcDogU3RyaW5nDQoJCS8vCQkiL2Rvam8vaW8vc3RvcCIgaXMgc2VudCB3aGVuIGFsbCBvdXRzdGFuZGluZyBJTyByZXF1ZXN0cyBoYXZlDQoJCS8vIAkJZmluaXNoZWQuIE5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkIHdpdGggdGhpcyB0b3BpYy4NCgkJdGhpcy5zdGFydCA9ICIvZG9qby9pby9zdGFydCI7DQoJCXRoaXMuc2VuZCA9ICIvZG9qby9pby9zZW5kIjsNCgkJdGhpcy5sb2FkID0gIi9kb2pvL2lvL2xvYWQiOw0KCQl0aGlzLmVycm9yID0gIi9kb2pvL2lvL2Vycm9yIjsNCgkJdGhpcy5kb25lID0gIi9kb2pvL2lvL2RvbmUiOw0KCQl0aGlzLnN0b3AgPSAiL2Rvam8vaW8vc3RvcCI7DQoJfQ0KCT09PT09Ki8NCg0KDQoJZG9qby5faW9TZXRBcmdzID0gZnVuY3Rpb24oLypkb2pvLl9fSW9BcmdzKi9hcmdzLA0KCQkJLypGdW5jdGlvbiovY2FuY2VsbGVyLA0KCQkJLypGdW5jdGlvbiovb2tIYW5kbGVyLA0KCQkJLypGdW5jdGlvbiovZXJySGFuZGxlcil7DQoJCS8vCXN1bW1hcnk6IA0KCQkvLwkJc2V0cyB1cCB0aGUgRGVmZXJyZWQgYW5kIGlvQXJncyBwcm9wZXJ0eSBvbiB0aGUgRGVmZXJyZWQgc28gaXQNCgkJLy8JCWNhbiBiZSB1c2VkIGluIGFuIGlvIGNhbGwuDQoJCS8vCWFyZ3M6DQoJCS8vCQlUaGUgYXJncyBvYmplY3QgcGFzc2VkIGludG8gdGhlIHB1YmxpYyBpbyBjYWxsLiBSZWNvZ25pemVkIHByb3BlcnRpZXMgb24NCgkJLy8JCXRoZSBhcmdzIG9iamVjdCBhcmU6DQoJCS8vCWNhbmNlbGxlcjoNCgkJLy8JCVRoZSBjYW5jZWxsZXIgZnVuY3Rpb24gdXNlZCBmb3IgdGhlIERlZmVycmVkIG9iamVjdC4gVGhlIGZ1bmN0aW9uDQoJCS8vCQl3aWxsIHJlY2VpdmUgb25lIGFyZ3VtZW50LCB0aGUgRGVmZXJyZWQgb2JqZWN0IHRoYXQgaXMgcmVsYXRlZCB0byB0aGUNCgkJLy8JCWNhbmNlbGxlci4NCgkJLy8Jb2tIYW5kbGVyOg0KCQkvLwkJVGhlIGZpcnN0IE9LIGNhbGxiYWNrIHRvIGJlIHJlZ2lzdGVyZWQgd2l0aCBEZWZlcnJlZC4gSXQgaGFzIHRoZSBvcHBvcnR1bml0eQ0KCQkvLwkJdG8gdHJhbnNmb3JtIHRoZSBPSyByZXNwb25zZS4gSXQgd2lsbCByZWNlaXZlIG9uZSBhcmd1bWVudCAtLSB0aGUgRGVmZXJyZWQNCgkJLy8JCW9iamVjdCByZXR1cm5lZCBmcm9tIHRoaXMgZnVuY3Rpb24uDQoJCS8vCWVyckhhbmRsZXI6DQoJCS8vCQlUaGUgZmlyc3QgZXJyb3IgY2FsbGJhY2sgdG8gYmUgcmVnaXN0ZXJlZCB3aXRoIERlZmVycmVkLiBJdCBoYXMgdGhlIG9wcG9ydHVuaXR5DQoJCS8vCQl0byBkbyBjbGVhbnVwIG9uIGFuIGVycm9yLiBJdCB3aWxsIHJlY2VpdmUgdHdvIGFyZ3VtZW50czogZXJyb3IgKHRoZSANCgkJLy8JCUVycm9yIG9iamVjdCkgYW5kIGRmZCwgdGhlIERlZmVycmVkIG9iamVjdCByZXR1cm5lZCBmcm9tIHRoaXMgZnVuY3Rpb24uDQoNCgkJdmFyIGlvQXJncyA9IHthcmdzOiBhcmdzLCB1cmw6IGFyZ3MudXJsfTsNCg0KCQkvL0dldCB2YWx1ZXMgZnJvbSBmb3JtIGlmIHJlcXVlc3RkLg0KCQl2YXIgZm9ybU9iamVjdCA9IG51bGw7DQoJCWlmKGFyZ3MuZm9ybSl7IA0KCQkJdmFyIGZvcm0gPSBfZC5ieUlkKGFyZ3MuZm9ybSk7DQoJCQkvL0lFIHJlcXVpcmVzIGdvaW5nIHRocm91Z2ggZ2V0QXR0cmlidXRlTm9kZSBpbnN0ZWFkIG9mIGp1c3QgZ2V0QXR0cmlidXRlIGluIHNvbWUgZm9ybSBjYXNlcywgDQoJCQkvL3NvIHVzZSBpdCBmb3IgYWxsLiAgU2VlICMyODQ0DQoJCQl2YXIgYWN0bk5vZGUgPSBmb3JtLmdldEF0dHJpYnV0ZU5vZGUoImFjdGlvbiIpOw0KCQkJaW9BcmdzLnVybCA9IGlvQXJncy51cmwgfHwgKGFjdG5Ob2RlID8gYWN0bk5vZGUudmFsdWUgOiBudWxsKTsgDQoJCQlmb3JtT2JqZWN0ID0gX2QuZm9ybVRvT2JqZWN0KGZvcm0pOw0KCQl9DQoNCgkJLy8gc2V0IHVwIHRoZSBxdWVyeSBwYXJhbXMNCgkJdmFyIG1pQXJncyA9IFt7fV07DQoJDQoJCWlmKGZvcm1PYmplY3Qpew0KCQkJLy8gcG90ZW50aWFsbHkgb3Zlci1yaWRlIHVybC1wcm92aWRlZCBwYXJhbXMgdy8gZm9ybSB2YWx1ZXMNCgkJCW1pQXJncy5wdXNoKGZvcm1PYmplY3QpOw0KCQl9DQoJCWlmKGFyZ3MuY29udGVudCl7DQoJCQkvLyBzdHVmZiBpbiBjb250ZW50IG92ZXItcmlkZXMgd2hhdCdzIHNldCBieSBmb3JtDQoJCQltaUFyZ3MucHVzaChhcmdzLmNvbnRlbnQpOw0KCQl9DQoJCWlmKGFyZ3MucHJldmVudENhY2hlKXsNCgkJCW1pQXJncy5wdXNoKHsiZG9qby5wcmV2ZW50Q2FjaGUiOiBuZXcgRGF0ZSgpLnZhbHVlT2YoKX0pOw0KCQl9DQoJCWlvQXJncy5xdWVyeSA9IF9kLm9iamVjdFRvUXVlcnkoX2QubWl4aW4uYXBwbHkobnVsbCwgbWlBcmdzKSk7DQoJDQoJCS8vIC4uIGFuZCB0aGUgcmVhbCB3b3JrIG9mIGdldHRpbmcgdGhlIGRlZmVycmVkIGluIG9yZGVyLCBldGMuDQoJCWlvQXJncy5oYW5kbGVBcyA9IGFyZ3MuaGFuZGxlQXMgfHwgInRleHQiOw0KCQl2YXIgZCA9IG5ldyBfZC5EZWZlcnJlZChjYW5jZWxsZXIpOw0KCQlkLmFkZENhbGxiYWNrcyhva0hhbmRsZXIsIGZ1bmN0aW9uKGVycm9yKXsNCgkJCXJldHVybiBlcnJIYW5kbGVyKGVycm9yLCBkKTsNCgkJfSk7DQoNCgkJLy9TdXBwb3J0IHNwZWNpZnlpbmcgbG9hZCwgZXJyb3IgYW5kIGhhbmRsZSBjYWxsYmFjayBmdW5jdGlvbnMgZnJvbSB0aGUgYXJncy4NCgkJLy9Gb3IgdGhvc2UgY2FsbGJhY2tzLCB0aGUgInRoaXMiIG9iamVjdCB3aWxsIGJlIHRoZSBhcmdzIG9iamVjdC4NCgkJLy9UaGUgY2FsbGJhY2tzIHdpbGwgZ2V0IHRoZSBkZWZlcnJlZCByZXN1bHQgdmFsdWUgYXMgdGhlDQoJCS8vZmlyc3QgYXJndW1lbnQgYW5kIHRoZSBpb0FyZ3Mgb2JqZWN0IGFzIHRoZSBzZWNvbmQgYXJndW1lbnQuDQoJCXZhciBsZCA9IGFyZ3MubG9hZDsNCgkJaWYobGQgJiYgX2QuaXNGdW5jdGlvbihsZCkpew0KCQkJZC5hZGRDYWxsYmFjayhmdW5jdGlvbih2YWx1ZSl7DQoJCQkJcmV0dXJuIGxkLmNhbGwoYXJncywgdmFsdWUsIGlvQXJncyk7DQoJCQl9KTsNCgkJfQ0KCQl2YXIgZXJyID0gYXJncy5lcnJvcjsNCgkJaWYoZXJyICYmIF9kLmlzRnVuY3Rpb24oZXJyKSl7DQoJCQlkLmFkZEVycmJhY2soZnVuY3Rpb24odmFsdWUpew0KCQkJCXJldHVybiBlcnIuY2FsbChhcmdzLCB2YWx1ZSwgaW9BcmdzKTsNCgkJCX0pOw0KCQl9DQoJCXZhciBoYW5kbGUgPSBhcmdzLmhhbmRsZTsNCgkJaWYoaGFuZGxlICYmIF9kLmlzRnVuY3Rpb24oaGFuZGxlKSl7DQoJCQlkLmFkZEJvdGgoZnVuY3Rpb24odmFsdWUpew0KCQkJCXJldHVybiBoYW5kbGUuY2FsbChhcmdzLCB2YWx1ZSwgaW9BcmdzKTsNCgkJCX0pOw0KCQl9DQoNCgkJLy9QbHVnIGluIHRvcGljIHB1Ymxpc2hpbmcsIGlmIGRvam8ucHVibGlzaCBpcyBsb2FkZWQuDQoJCWlmKGNmZy5pb1B1Ymxpc2ggJiYgX2QucHVibGlzaCAmJiBpb0FyZ3MuYXJncy5pb1B1Ymxpc2ggIT09IGZhbHNlKXsNCgkJCWQuYWRkQ2FsbGJhY2tzKA0KCQkJCWZ1bmN0aW9uKHJlcyl7DQoJCQkJCV9kLnB1Ymxpc2goIi9kb2pvL2lvL2xvYWQiLCBbZCwgcmVzXSk7DQoJCQkJCXJldHVybiByZXM7DQoJCQkJfSwNCgkJCQlmdW5jdGlvbihyZXMpew0KCQkJCQlfZC5wdWJsaXNoKCIvZG9qby9pby9lcnJvciIsIFtkLCByZXNdKTsNCgkJCQkJcmV0dXJuIHJlczsNCgkJCQl9DQoJCQkpOw0KCQkJZC5hZGRCb3RoKGZ1bmN0aW9uKHJlcyl7DQoJCQkJX2QucHVibGlzaCgiL2Rvam8vaW8vZG9uZSIsIFtkLCByZXNdKTsNCgkJCQlyZXR1cm4gcmVzOw0KCQkJfSk7DQoJCX0NCg0KCQlkLmlvQXJncyA9IGlvQXJnczsNCgkNCgkJLy8gRklYTUU6IG5lZWQgdG8gd2lyZSB1cCB0aGUgeGhyIG9iamVjdCdzIGFib3J0IG1ldGhvZCB0byBzb21ldGhpbmcNCgkJLy8gYW5hbGFnb3VzIGluIHRoZSBEZWZlcnJlZA0KCQlyZXR1cm4gZDsNCgl9DQoNCgl2YXIgX2RlZmVycmVkQ2FuY2VsID0gZnVuY3Rpb24oLypEZWZlcnJlZCovZGZkKXsNCgkJLy8gc3VtbWFyeTogY2FuY2VsbGVyIGZ1bmN0aW9uIGZvciBkb2pvLl9pb1NldEFyZ3MgY2FsbC4NCgkJDQoJCWRmZC5jYW5jZWxlZCA9IHRydWU7DQoJCXZhciB4aHIgPSBkZmQuaW9BcmdzLnhocjsNCgkJdmFyIF9hdCA9IHR5cGVvZiB4aHIuYWJvcnQ7DQoJCWlmKF9hdCA9PSAiZnVuY3Rpb24iIHx8IF9hdCA9PSAib2JqZWN0IiB8fCBfYXQgPT0gInVua25vd24iKXsNCgkJCXhoci5hYm9ydCgpOw0KCQl9DQoJCXZhciBlcnIgPSBkZmQuaW9BcmdzLmVycm9yOw0KCQlpZighZXJyKXsNCgkJCWVyciA9IG5ldyBFcnJvcigieGhyIGNhbmNlbGxlZCIpOw0KCQkJZXJyLmRvam9UeXBlPSJjYW5jZWwiOw0KCQl9DQoJCXJldHVybiBlcnI7DQoJfQ0KCXZhciBfZGVmZXJyZWRPayA9IGZ1bmN0aW9uKC8qRGVmZXJyZWQqL2RmZCl7DQoJCS8vIHN1bW1hcnk6IG9rSGFuZGxlciBmdW5jdGlvbiBmb3IgZG9qby5faW9TZXRBcmdzIGNhbGwuDQoNCgkJdmFyIHJldCA9IGhhbmRsZXJzW2RmZC5pb0FyZ3MuaGFuZGxlQXNdKGRmZC5pb0FyZ3MueGhyKTsNCgkJcmV0dXJuIHJldCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHJldDsNCgl9DQoJdmFyIF9kZWZlckVycm9yID0gZnVuY3Rpb24oLypFcnJvciovZXJyb3IsIC8qRGVmZXJyZWQqL2RmZCl7DQoJCS8vIHN1bW1hcnk6IGVyckhhbmRsZXIgZnVuY3Rpb24gZm9yIGRvam8uX2lvU2V0QXJncyBjYWxsLg0KDQoJCWlmKCFkZmQuaW9BcmdzLmFyZ3MuZmFpbE9rKXsNCgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KCQl9DQoJCXJldHVybiBlcnJvcjsNCgl9DQoNCgkvLyBhdm9pZCBzZXR0aW5nIGEgdGltZXIgcGVyIHJlcXVlc3QuIEl0IGRlZ3JhZGVzIHBlcmZvcm1hbmNlIG9uIElFDQoJLy8gc29tZXRoaW5nIGZpZXJlY2UgaWYgd2UgZG9uJ3QgdXNlIHVuaWZpZWQgbG9vcHMuDQoJdmFyIF9pbkZsaWdodEludHZsID0gbnVsbDsNCgl2YXIgX2luRmxpZ2h0ID0gW107DQoJDQoJDQoJLy9Vc2UgYSBzZXBhcmF0ZSBjb3VudCBmb3Iga25vd2luZyBpZiB3ZSBhcmUgc3RhcnRpbmcvc3RvcHBpbmcgaW8gY2FsbHMuDQoJLy9DYW5ub3QgdXNlIF9pbkZsaWdodC5sZW5ndGggc2luY2UgaXQgY2FuIGNoYW5nZSBhdCBhIGRpZmZlcmVudCB0aW1lIHRoYW4NCgkvL3doZW4gd2Ugd2FudCB0byBkbyB0aGlzIGtpbmQgb2YgdGVzdC4gV2Ugb25seSB3YW50IHRvIGRlY3JlbWVudCB0aGUgY291bnQNCgkvL2FmdGVyIGEgY2FsbGJhY2svZXJyYmFjayBoYXMgZmluaXNoZWQsIHNpbmNlIHRoZSBjYWxsYmFjay9lcnJiYWNrIHNob3VsZCBiZQ0KCS8vY29uc2lkZXJlZCBhcyBwYXJ0IG9mIGZpbmlzaGluZyBhIHJlcXVlc3QuDQoJdmFyIF9wdWJDb3VudCA9IDA7DQoJdmFyIF9jaGVja1B1YkNvdW50ID0gZnVuY3Rpb24oZGZkKXsNCgkJaWYoX3B1YkNvdW50IDw9IDApew0KCQkJX3B1YkNvdW50ID0gMDsNCgkJCWlmKGNmZy5pb1B1Ymxpc2ggJiYgX2QucHVibGlzaCAmJiAoIWRmZCB8fCBkZmQgJiYgZGZkLmlvQXJncy5hcmdzLmlvUHVibGlzaCAhPT0gZmFsc2UpKXsNCgkJCQlfZC5wdWJsaXNoKCIvZG9qby9pby9zdG9wIik7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdmFyIF93YXRjaEluRmxpZ2h0ID0gZnVuY3Rpb24oKXsNCgkJLy9zdW1tYXJ5OiANCgkJLy8JCWludGVybmFsIG1ldGhvZCB0aGF0IGNoZWNrcyBlYWNoIGluZmxpZ2h0IFhNTEh0dHBSZXF1ZXN0IHRvIHNlZQ0KCQkvLwkJaWYgaXQgaGFzIGNvbXBsZXRlZCBvciBpZiB0aGUgdGltZW91dCBzaXR1YXRpb24gYXBwbGllcy4NCgkJDQoJCXZhciBub3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOw0KCQkvLyBtYWtlIHN1cmUgc3luYyBjYWxscyBzdGF5IHRocmVhZCBzYWZlLCBpZiB0aGlzIGNhbGxiYWNrIGlzIGNhbGxlZA0KCQkvLyBkdXJpbmcgYSBzeW5jIGNhbGwgYW5kIHRoaXMgcmVzdWx0cyBpbiBhbm90aGVyIHN5bmMgY2FsbCBiZWZvcmUgdGhlDQoJCS8vIGZpcnN0IHN5bmMgY2FsbCBlbmRzIHRoZSBicm93c2VyIGhhbmdzDQoJCWlmKCFfZC5fYmxvY2tBc3luYyl7DQoJCQkvLyB3ZSBuZWVkIG1hbnVhbCBsb29wIGJlY2F1c2Ugd2Ugb2Z0ZW4gbW9kaWZ5IF9pbkZsaWdodCAoYW5kIHRoZXJlZm9yZSAnaScpIHdoaWxlIGl0ZXJhdGluZw0KCQkJLy8gbm90ZTogdGhlIHNlY29uZCBjbGF1c2UgaXMgYW4gYXNzaWdtZW50IG9uIHB1cnBvc2UsIGxpbnQgbWF5IGNvbXBsYWluDQoJCQlmb3IodmFyIGkgPSAwLCB0aWY7IGkgPCBfaW5GbGlnaHQubGVuZ3RoICYmICh0aWYgPSBfaW5GbGlnaHRbaV0pOyBpKyspew0KCQkJCXZhciBkZmQgPSB0aWYuZGZkOw0KCQkJCXZhciBmdW5jID0gZnVuY3Rpb24oKXsNCgkJCQkJaWYoIWRmZCB8fCBkZmQuY2FuY2VsZWQgfHwgIXRpZi52YWxpZENoZWNrKGRmZCkpew0KCQkJCQkJX2luRmxpZ2h0LnNwbGljZShpLS0sIDEpOyANCgkJCQkJCV9wdWJDb3VudCAtPSAxOw0KCQkJCQl9ZWxzZSBpZih0aWYuaW9DaGVjayhkZmQpKXsNCgkJCQkJCV9pbkZsaWdodC5zcGxpY2UoaS0tLCAxKTsNCgkJCQkJCXRpZi5yZXNIYW5kbGUoZGZkKTsNCgkJCQkJCV9wdWJDb3VudCAtPSAxOw0KCQkJCQl9ZWxzZSBpZihkZmQuc3RhcnRUaW1lKXsNCgkJCQkJCS8vZGlkIHdlIHRpbWVvdXQ/DQoJCQkJCQlpZihkZmQuc3RhcnRUaW1lICsgKGRmZC5pb0FyZ3MuYXJncy50aW1lb3V0IHx8IDApIDwgbm93KXsNCgkJCQkJCQlfaW5GbGlnaHQuc3BsaWNlKGktLSwgMSk7DQoJCQkJCQkJdmFyIGVyciA9IG5ldyBFcnJvcigidGltZW91dCBleGNlZWRlZCIpOw0KCQkJCQkJCWVyci5kb2pvVHlwZSA9ICJ0aW1lb3V0IjsNCgkJCQkJCQlkZmQuZXJyYmFjayhlcnIpOw0KCQkJCQkJCS8vQ2FuY2VsIHRoZSByZXF1ZXN0IHNvIHRoZSBpbyBtb2R1bGUgY2FuIGRvIGFwcHJvcHJpYXRlIGNsZWFudXAuDQoJCQkJCQkJZGZkLmNhbmNlbCgpOw0KCQkJCQkJCV9wdWJDb3VudCAtPSAxOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfTsNCgkJCQlpZihkb2pvLmNvbmZpZy5kZWJ1Z0F0QWxsQ29zdHMpew0KCQkJCQlmdW5jLmNhbGwodGhpcyk7DQoJCQkJfWVsc2V7DQoJCQkJCXRyeXsNCgkJCQkJCWZ1bmMuY2FsbCh0aGlzKTsNCgkJCQkJfWNhdGNoKGUpew0KCQkJCQkJZGZkLmVycmJhY2soZSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQlfY2hlY2tQdWJDb3VudChkZmQpOw0KDQoJCWlmKCFfaW5GbGlnaHQubGVuZ3RoKXsNCgkJCWNsZWFySW50ZXJ2YWwoX2luRmxpZ2h0SW50dmwpOw0KCQkJX2luRmxpZ2h0SW50dmwgPSBudWxsOw0KCQkJcmV0dXJuOw0KCQl9DQoJfQ0KDQoJZG9qby5faW9DYW5jZWxBbGwgPSBmdW5jdGlvbigpew0KCQkvL3N1bW1hcnk6IENhbmNlbHMgYWxsIHBlbmRpbmcgSU8gcmVxdWVzdHMsIHJlZ2FyZGxlc3Mgb2YgSU8gdHlwZQ0KCQkvLyh4aHIsIHNjcmlwdCwgaWZyYW1lKS4NCgkJdHJ5ew0KCQkJX2QuZm9yRWFjaChfaW5GbGlnaHQsIGZ1bmN0aW9uKGkpew0KCQkJCXRyeXsNCgkJCQkJaS5kZmQuY2FuY2VsKCk7DQoJCQkJfWNhdGNoKGUpey8qc3F1ZWxjaCovfQ0KCQkJfSk7DQoJCX1jYXRjaChlKXsvKnNxdWVsY2gqL30NCgl9DQoNCgkvL0F1dG9tYXRpY2FsbHkgY2FsbCBjYW5jZWwgYWxsIGlvIGNhbGxzIG9uIHVubG9hZA0KCS8vaW4gSUUgZm9yIHRyYWMgaXNzdWUgIzIzNTcuDQoJCWlmKF9kLmlzSUUpew0KCQlfZC5hZGRPbldpbmRvd1VubG9hZChfZC5faW9DYW5jZWxBbGwpOw0KCX0NCgkNCglfZC5faW9Ob3RpZnlTdGFydCA9IGZ1bmN0aW9uKC8qRGVmZXJyZWQqL2RmZCl7DQoJCS8vIHN1bW1hcnk6DQoJCS8vIAkJSWYgZG9qby5wdWJsaXNoIGlzIGF2YWlsYWJsZSwgcHVibGlzaCB0b3BpY3MNCgkJLy8gCQlhYm91dCB0aGUgc3RhcnQgb2YgYSByZXF1ZXN0IHF1ZXVlIGFuZC9vciB0aGUNCgkJLy8gCQl0aGUgYmVnaW5uaW5nIG9mIHJlcXVlc3QuDQoJCS8vIGRlc2NyaXB0aW9uOg0KCQkvLyAJCVVzZWQgYnkgSU8gdHJhbnNwb3J0cy4gQW4gSU8gdHJhbnNwb3J0IHNob3VsZA0KCQkvLyAJCWNhbGwgdGhpcyBtZXRob2QgYmVmb3JlIG1ha2luZyB0aGUgbmV0d29yayBjb25uZWN0aW9uLg0KCQlpZihjZmcuaW9QdWJsaXNoICYmIF9kLnB1Ymxpc2ggJiYgZGZkLmlvQXJncy5hcmdzLmlvUHVibGlzaCAhPT0gZmFsc2Upew0KCQkJaWYoIV9wdWJDb3VudCl7DQoJCQkJX2QucHVibGlzaCgiL2Rvam8vaW8vc3RhcnQiKTsNCgkJCX0NCgkJCV9wdWJDb3VudCArPSAxOw0KCQkJX2QucHVibGlzaCgiL2Rvam8vaW8vc2VuZCIsIFtkZmRdKTsNCgkJfQ0KCX0NCg0KCV9kLl9pb1dhdGNoID0gZnVuY3Rpb24oZGZkLCB2YWxpZENoZWNrLCBpb0NoZWNrLCByZXNIYW5kbGUpew0KCQkvLyBzdW1tYXJ5OiANCgkJLy8JCVdhdGNoZXMgdGhlIGlvIHJlcXVlc3QgcmVwcmVzZW50ZWQgYnkgZGZkIHRvIHNlZSBpZiBpdCBjb21wbGV0ZXMuDQoJCS8vIGRmZDogRGVmZXJyZWQNCgkJLy8JCVRoZSBEZWZlcnJlZCBvYmplY3QgdG8gd2F0Y2guDQoJCS8vIHZhbGlkQ2hlY2s6IEZ1bmN0aW9uDQoJCS8vCQlGdW5jdGlvbiB1c2VkIHRvIGNoZWNrIGlmIHRoZSBJTyByZXF1ZXN0IGlzIHN0aWxsIHZhbGlkLiBHZXRzIHRoZSBkZmQNCgkJLy8JCW9iamVjdCBhcyBpdHMgb25seSBhcmd1bWVudC4NCgkJLy8gaW9DaGVjazogRnVuY3Rpb24NCgkJLy8JCUZ1bmN0aW9uIHVzZWQgdG8gY2hlY2sgaWYgYmFzaWMgSU8gY2FsbCB3b3JrZWQuIEdldHMgdGhlIGRmZA0KCQkvLwkJb2JqZWN0IGFzIGl0cyBvbmx5IGFyZ3VtZW50Lg0KCQkvLyByZXNIYW5kbGU6IEZ1bmN0aW9uDQoJCS8vCQlGdW5jdGlvbiB1c2VkIHRvIHByb2Nlc3MgcmVzcG9uc2UuIEdldHMgdGhlIGRmZA0KCQkvLwkJb2JqZWN0IGFzIGl0cyBvbmx5IGFyZ3VtZW50Lg0KCQl2YXIgYXJncyA9IGRmZC5pb0FyZ3MuYXJnczsNCgkJaWYoYXJncy50aW1lb3V0KXsNCgkJCWRmZC5zdGFydFRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOw0KCQl9DQoJCQ0KCQlfaW5GbGlnaHQucHVzaCh7ZGZkOiBkZmQsIHZhbGlkQ2hlY2s6IHZhbGlkQ2hlY2ssIGlvQ2hlY2s6IGlvQ2hlY2ssIHJlc0hhbmRsZTogcmVzSGFuZGxlfSk7DQoJCWlmKCFfaW5GbGlnaHRJbnR2bCl7DQoJCQlfaW5GbGlnaHRJbnR2bCA9IHNldEludGVydmFsKF93YXRjaEluRmxpZ2h0LCA1MCk7DQoJCX0NCgkJLy8gaGFuZGxlIHN5bmMgcmVxdWVzdHMNCgkJLy9BIHdlYWtuZXNzOiBhc3luYyBjYWxscyBpbiBmbGlnaHQNCgkJLy9jb3VsZCBoYXZlIHRoZWlyIGhhbmRsZXJzIGNhbGxlZCBhcyBwYXJ0IG9mIHRoZQ0KCQkvL193YXRjaEluRmxpZ2h0IGNhbGwsIGJlZm9yZSB0aGUgc3luYydzIGNhbGxiYWNrcw0KCQkvLyBhcmUgY2FsbGVkLg0KCQlpZihhcmdzLnN5bmMpew0KCQkJX3dhdGNoSW5GbGlnaHQoKTsNCgkJfQ0KCX0NCg0KCXZhciBfZGVmYXVsdENvbnRlbnRUeXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7DQoNCgl2YXIgX3ZhbGlkQ2hlY2sgPSBmdW5jdGlvbigvKkRlZmVycmVkKi9kZmQpew0KCQlyZXR1cm4gZGZkLmlvQXJncy54aHIucmVhZHlTdGF0ZTsgLy9ib29sZWFuDQoJfQ0KCXZhciBfaW9DaGVjayA9IGZ1bmN0aW9uKC8qRGVmZXJyZWQqL2RmZCl7DQoJCXJldHVybiA0ID09IGRmZC5pb0FyZ3MueGhyLnJlYWR5U3RhdGU7IC8vYm9vbGVhbg0KCX0NCgl2YXIgX3Jlc0hhbmRsZSA9IGZ1bmN0aW9uKC8qRGVmZXJyZWQqL2RmZCl7DQoJCXZhciB4aHIgPSBkZmQuaW9BcmdzLnhocjsNCgkJaWYoX2QuX2lzRG9jdW1lbnRPayh4aHIpKXsNCgkJCWRmZC5jYWxsYmFjayhkZmQpOw0KCQl9ZWxzZXsNCgkJCXZhciBlcnIgPSBuZXcgRXJyb3IoIlVuYWJsZSB0byBsb2FkICIgKyBkZmQuaW9BcmdzLnVybCArICIgc3RhdHVzOiIgKyB4aHIuc3RhdHVzKTsNCgkJCWVyci5zdGF0dXMgPSB4aHIuc3RhdHVzOw0KCQkJZXJyLnJlc3BvbnNlVGV4dCA9IHhoci5yZXNwb25zZVRleHQ7DQoJCQlkZmQuZXJyYmFjayhlcnIpOw0KCQl9DQoJfQ0KDQoJZG9qby5faW9BZGRRdWVyeVRvVXJsID0gZnVuY3Rpb24oLypkb2pvLl9fSW9DYWxsYmFja0FyZ3MqL2lvQXJncyl7DQoJCS8vc3VtbWFyeTogQWRkcyBxdWVyeSBwYXJhbXMgZGlzY292ZXJlZCBieSB0aGUgaW8gZGVmZXJyZWQgY29uc3RydWN0aW9uIHRvIHRoZSBVUkwuDQoJCS8vT25seSB1c2UgdGhpcyBmb3Igb3BlcmF0aW9ucyB3aGljaCBhcmUgZnVuZGFtZW50YWxseSBHRVQtdHlwZSBvcGVyYXRpb25zLg0KCQlpZihpb0FyZ3MucXVlcnkubGVuZ3RoKXsNCgkJCWlvQXJncy51cmwgKz0gKGlvQXJncy51cmwuaW5kZXhPZigiPyIpID09IC0xID8gIj8iIDogIiYiKSArIGlvQXJncy5xdWVyeTsNCgkJCWlvQXJncy5xdWVyeSA9IG51bGw7DQoJCX0JCQ0KCX0NCg0KCS8qPT09PT0NCglkb2pvLmRlY2xhcmUoImRvam8uX19YaHJBcmdzIiwgZG9qby5fX0lvQXJncywgew0KCQljb25zdHJ1Y3RvcjogZnVuY3Rpb24oKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJSW4gYWRkaXRpb24gdG8gdGhlIHByb3BlcnRpZXMgbGlzdGVkIGZvciB0aGUgZG9qby5fSW9BcmdzIHR5cGUsDQoJCQkvLwkJdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzIGFyZSBhbGxvd2VkIGZvciBkb2pvLnhociogbWV0aG9kcy4NCgkJCS8vCWhhbmRsZUFzOiBTdHJpbmc/DQoJCQkvLwkJQWNjZXB0YWJsZSB2YWx1ZXMgYXJlOiB0ZXh0IChkZWZhdWx0KSwganNvbiwganNvbi1jb21tZW50LW9wdGlvbmFsLA0KCQkJLy8JCWpzb24tY29tbWVudC1maWx0ZXJlZCwgamF2YXNjcmlwdCwgeG1sLiBTZWUgYGRvam8uY29udGVudEhhbmRsZXJzYA0KCQkJLy8Jc3luYzogQm9vbGVhbj8NCgkJCS8vCQlmYWxzZSBpcyBkZWZhdWx0LiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgcmVxdWVzdCBzaG91bGQNCgkJCS8vCQliZSBhIHN5bmNocm9ub3VzIChibG9ja2luZykgcmVxdWVzdC4NCgkJCS8vCWhlYWRlcnM6IE9iamVjdD8NCgkJCS8vCQlBZGRpdGlvbmFsIEhUVFAgaGVhZGVycyB0byBzZW5kIGluIHRoZSByZXF1ZXN0Lg0KCQkJLy8JZmFpbE9rOiBCb29sZWFuPw0KCQkJLy8JCWZhbHNlIGlzIGRlZmF1bHQuIEluZGljYXRlcyB3aGV0aGVyIGEgcmVxdWVzdCBzaG91bGQgYmUNCgkJCS8vCQlhbGxvd2VkIHRvIGZhaWwgKGFuZCB0aGVyZWZvcmUgbm8gY29uc29sZSBlcnJvciBtZXNzYWdlIGluDQoJCQkvLwkJdGhlIGV2ZW50IG9mIGEgZmFpbHVyZSkNCgkJCXRoaXMuaGFuZGxlQXMgPSBoYW5kbGVBczsNCgkJCXRoaXMuc3luYyA9IHN5bmM7DQoJCQl0aGlzLmhlYWRlcnMgPSBoZWFkZXJzOw0KCQkJdGhpcy5mYWlsT2sgPSBmYWlsT2s7DQoJCX0NCgl9KTsNCgk9PT09PSovDQoNCglkb2pvLnhociA9IGZ1bmN0aW9uKC8qU3RyaW5nKi8gbWV0aG9kLCAvKmRvam8uX19YaHJBcmdzKi8gYXJncywgLypCb29sZWFuPyovIGhhc0JvZHkpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJU2VuZHMgYW4gSFRUUCByZXF1ZXN0IHdpdGggdGhlIGdpdmVuIG1ldGhvZC4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlTZW5kcyBhbiBIVFRQIHJlcXVlc3Qgd2l0aCB0aGUgZ2l2ZW4gbWV0aG9kLg0KCQkvLwkJU2VlIGFsc28gZG9qby54aHJHZXQoKSwgeGhyUG9zdCgpLCB4aHJQdXQoKSBhbmQgZG9qby54aHJEZWxldGUoKSBmb3Igc2hvcnRjdXRzDQoJCS8vCQlmb3IgdGhvc2UgSFRUUCBtZXRob2RzLiBUaGVyZSBhcmUgYWxzbyBtZXRob2RzIGZvciAicmF3IiBQVVQgYW5kIFBPU1QgbWV0aG9kcw0KCQkvLwkJdmlhIGRvam8ucmF3WGhyUHV0KCkgYW5kIGRvam8ucmF3WGhyUG9zdCgpIHJlc3BlY3RpdmVseS4NCgkJLy8JbWV0aG9kOg0KCQkvLwkJSFRUUCBtZXRob2QgdG8gYmUgdXNlZCwgc3VjaCBhcyBHRVQsIFBPU1QsIFBVVCwgREVMRVRFLiAgU2hvdWxkIGJlIHVwcGVyY2FzZS4NCgkJLy8JaGFzQm9keToNCgkJLy8JCUlmIHRoZSByZXF1ZXN0IGhhcyBhbiBIVFRQIGJvZHksIHRoZW4gcGFzcyB0cnVlIGZvciBoYXNCb2R5Lg0KDQoJCS8vTWFrZSB0aGUgRGVmZXJyZWQgb2JqZWN0IGZvciB0aGlzIHhociByZXF1ZXN0Lg0KCQl2YXIgZGZkID0gX2QuX2lvU2V0QXJncyhhcmdzLCBfZGVmZXJyZWRDYW5jZWwsIF9kZWZlcnJlZE9rLCBfZGVmZXJFcnJvcik7DQoJCXZhciBpb0FyZ3MgPSBkZmQuaW9BcmdzOw0KDQoJCS8vUGFzcyB0aGUgYXJncyB0byBfeGhyT2JqLCB0byBhbGxvdyBhbHRlcm5hdGUgWEhSIGNhbGxzIGJhc2VkIHNwZWNpZmljIGNhbGxzLCBsaWtlDQoJCS8vdGhlIG9uZSB1c2VkIGZvciBpZnJhbWUgcHJveGllcy4NCgkJdmFyIHhociA9IGlvQXJncy54aHIgPSBfZC5feGhyT2JqKGlvQXJncy5hcmdzKTsNCgkJLy9JZiBYSFIgZmFjdG9yeSBmYWlscywgY2FuY2VsIHRoZSBkZWZlcnJlZC4NCgkJaWYoIXhocil7DQoJCQlkZmQuY2FuY2VsKCk7DQoJCQlyZXR1cm4gZGZkOw0KCQl9DQoNCgkJLy9BbGxvdyBmb3Igc3BlY2lmeWluZyB0aGUgSFRUUCBib2R5IGNvbXBsZXRlbHkuDQoJCWlmKCJwb3N0RGF0YSIgaW4gYXJncyl7DQoJCQlpb0FyZ3MucXVlcnkgPSBhcmdzLnBvc3REYXRhOw0KCQl9ZWxzZSBpZigicHV0RGF0YSIgaW4gYXJncyl7DQoJCQlpb0FyZ3MucXVlcnkgPSBhcmdzLnB1dERhdGE7DQoJCX1lbHNlIGlmKCJyYXdCb2R5IiBpbiBhcmdzKXsNCgkJCWlvQXJncy5xdWVyeSA9IGFyZ3MucmF3Qm9keTsNCgkJfWVsc2UgaWYoKGFyZ3VtZW50cy5sZW5ndGggPiAyICYmICFoYXNCb2R5KSB8fCAiUE9TVHxQVVQiLmluZGV4T2YobWV0aG9kLnRvVXBwZXJDYXNlKCkpID09IC0xKXsNCgkJCS8vQ2hlY2sgZm9yIGhhc0JvZHkgYmVpbmcgcGFzc2VkLiBJZiBubyBoYXNCb2R5LA0KCQkJLy90aGVuIG9ubHkgYXBwZW5kIHF1ZXJ5IHN0cmluZyBpZiBub3QgYSBQT1NUIG9yIFBVVCByZXF1ZXN0Lg0KCQkJX2QuX2lvQWRkUXVlcnlUb1VybChpb0FyZ3MpOw0KCQl9DQoNCgkJLy8gSUUgNiBpcyBhIHN0ZWFtaW5nIHBpbGUuIEl0IHdvbid0IGxldCB5b3UgY2FsbCBhcHBseSgpIG9uIHRoZSBuYXRpdmUgZnVuY3Rpb24gKHhoci5vcGVuKS4NCgkJLy8gd29ya2Fyb3VuZCBmb3IgSUU2J3MgYXBwbHkoKSAiaXNzdWVzIg0KCQl4aHIub3BlbihtZXRob2QsIGlvQXJncy51cmwsIGFyZ3Muc3luYyAhPT0gdHJ1ZSwgYXJncy51c2VyIHx8IHVuZGVmaW5lZCwgYXJncy5wYXNzd29yZCB8fCB1bmRlZmluZWQpOw0KCQlpZihhcmdzLmhlYWRlcnMpew0KCQkJZm9yKHZhciBoZHIgaW4gYXJncy5oZWFkZXJzKXsNCgkJCQlpZihoZHIudG9Mb3dlckNhc2UoKSA9PT0gImNvbnRlbnQtdHlwZSIgJiYgIWFyZ3MuY29udGVudFR5cGUpew0KCQkJCQlhcmdzLmNvbnRlbnRUeXBlID0gYXJncy5oZWFkZXJzW2hkcl07DQoJCQkJfWVsc2UgaWYoYXJncy5oZWFkZXJzW2hkcl0pew0KCQkJCQkvL09ubHkgYWRkIGhlYWRlciBpZiBpdCBoYXMgYSB2YWx1ZS4gVGhpcyBhbGxvd3MgZm9yIGluc3RuYWNlLCBza2lwcGluZw0KCQkJCQkvL2luc2VydGlvbiBvZiBYLVJlcXVlc3RlZC1XaXRoIGJ5IHNwZWNpZnlpbmcgZW1wdHkgdmFsdWUuDQoJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKGhkciwgYXJncy5oZWFkZXJzW2hkcl0pOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkvLyBGSVhNRTogaXMgdGhpcyBhcHByb3ByaWF0ZSBmb3IgYWxsIGNvbnRlbnQgdHlwZXM/DQoJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCBhcmdzLmNvbnRlbnRUeXBlIHx8IF9kZWZhdWx0Q29udGVudFR5cGUpOw0KCQlpZighYXJncy5oZWFkZXJzIHx8ICEoIlgtUmVxdWVzdGVkLVdpdGgiIGluIGFyZ3MuaGVhZGVycykpew0KCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIlgtUmVxdWVzdGVkLVdpdGgiLCAiWE1MSHR0cFJlcXVlc3QiKTsNCgkJfQ0KCQkvLyBGSVhNRTogc2V0IG90aGVyIGhlYWRlcnMgaGVyZSENCgkJX2QuX2lvTm90aWZ5U3RhcnQoZGZkKTsNCgkJaWYoZG9qby5jb25maWcuZGVidWdBdEFsbENvc3RzKXsNCgkJCXhoci5zZW5kKGlvQXJncy5xdWVyeSk7DQoJCX1lbHNlew0KCQkJdHJ5ew0KCQkJCXhoci5zZW5kKGlvQXJncy5xdWVyeSk7DQoJCQl9Y2F0Y2goZSl7DQoJCQkJaW9BcmdzLmVycm9yID0gZTsNCgkJCQlkZmQuY2FuY2VsKCk7DQoJCQl9DQoJCX0NCgkJX2QuX2lvV2F0Y2goZGZkLCBfdmFsaWRDaGVjaywgX2lvQ2hlY2ssIF9yZXNIYW5kbGUpOw0KCQl4aHIgPSBudWxsOw0KCQlyZXR1cm4gZGZkOyAvLyBkb2pvLkRlZmVycmVkDQoJfQ0KDQoJZG9qby54aHJHZXQgPSBmdW5jdGlvbigvKmRvam8uX19YaHJBcmdzKi8gYXJncyl7DQoJCS8vCXN1bW1hcnk6IA0KCQkvLwkJU2VuZHMgYW4gSFRUUCBHRVQgcmVxdWVzdCB0byB0aGUgc2VydmVyLg0KCQlyZXR1cm4gX2QueGhyKCJHRVQiLCBhcmdzKTsgLy8gZG9qby5EZWZlcnJlZA0KCX0NCg0KCWRvam8ucmF3WGhyUG9zdCA9IGRvam8ueGhyUG9zdCA9IGZ1bmN0aW9uKC8qZG9qby5fX1hockFyZ3MqLyBhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVNlbmRzIGFuIEhUVFAgUE9TVCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIuIEluIGFkZHRpb24gdG8gdGhlIHByb3BlcnRpZXMNCgkJLy8JCWxpc3RlZCBmb3IgdGhlIGRvam8uX19YaHJBcmdzIHR5cGUsIHRoZSBmb2xsb3dpbmcgcHJvcGVydHkgaXMgYWxsb3dlZDoNCgkJLy8JcG9zdERhdGE6DQoJCS8vCQlTdHJpbmcuIFNlbmQgcmF3IGRhdGEgaW4gdGhlIGJvZHkgb2YgdGhlIFBPU1QgcmVxdWVzdC4NCgkJcmV0dXJuIF9kLnhocigiUE9TVCIsIGFyZ3MsIHRydWUpOyAvLyBkb2pvLkRlZmVycmVkDQoJfQ0KDQoJZG9qby5yYXdYaHJQdXQgPSBkb2pvLnhoclB1dCA9IGZ1bmN0aW9uKC8qZG9qby5fX1hockFyZ3MqLyBhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVNlbmRzIGFuIEhUVFAgUFVUIHJlcXVlc3QgdG8gdGhlIHNlcnZlci4gSW4gYWRkdGlvbiB0byB0aGUgcHJvcGVydGllcw0KCQkvLwkJbGlzdGVkIGZvciB0aGUgZG9qby5fX1hockFyZ3MgdHlwZSwgdGhlIGZvbGxvd2luZyBwcm9wZXJ0eSBpcyBhbGxvd2VkOg0KCQkvLwlwdXREYXRhOg0KCQkvLwkJU3RyaW5nLiBTZW5kIHJhdyBkYXRhIGluIHRoZSBib2R5IG9mIHRoZSBQVVQgcmVxdWVzdC4NCgkJcmV0dXJuIF9kLnhocigiUFVUIiwgYXJncywgdHJ1ZSk7IC8vIGRvam8uRGVmZXJyZWQNCgl9DQoNCglkb2pvLnhockRlbGV0ZSA9IGZ1bmN0aW9uKC8qZG9qby5fX1hockFyZ3MqLyBhcmdzKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCVNlbmRzIGFuIEhUVFAgREVMRVRFIHJlcXVlc3QgdG8gdGhlIHNlcnZlci4NCgkJcmV0dXJuIF9kLnhocigiREVMRVRFIiwgYXJncyk7IC8vZG9qby5EZWZlcnJlZA0KCX0NCg0KCS8qDQoJZG9qby53cmFwRm9ybSA9IGZ1bmN0aW9uKGZvcm1Ob2RlKXsNCgkJLy9zdW1tYXJ5Og0KCQkvLwkJQSByZXBsYWNlbWVudCBmb3IgRm9ybUJpbmQsIGJ1dCBub3QgaW1wbGVtZW50ZWQgeWV0Lg0KDQoJCS8vIEZJWE1FOiBuZWVkIHRvIHRoaW5rIGhhcmRlciBhYm91dCB3aGF0IGV4dGVuc2lvbnMgdG8gdGhpcyB3ZSBtaWdodA0KCQkvLyB3YW50LiBXaGF0IHNob3VsZCB3ZSBhbGxvdyBmb2xrcyB0byBkbyB3LyB0aGlzPyBXaGF0IGV2ZW50cyB0bw0KCQkvLyBzZXQvc2VuZD8NCgkJdGhyb3cgbmV3IEVycm9yKCJkb2pvLndyYXBGb3JtIG5vdCB5ZXQgaW1wbGVtZW50ZWQiKTsNCgl9DQoJKi8NCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmZ4Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmZ4Il0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pvLl9iYXNlLmZ4Iik7DQoNCg0KDQoNCg0KLyoNCglBbmltYXRpb24gbG9vc2VseSBwYWNrYWdlIGJhc2VkIG9uIERhbiBQdXBpdXMnIHdvcmssIGNvbnRyaWJ1dGVkIHVuZGVyIENMQToNCgkJaHR0cDovL3B1cGl1cy5jby51ay9qcy9Ub29sa2l0LkRyYXdpbmcuanMNCiovDQooZnVuY3Rpb24oKXsNCgl2YXIgZCA9IGRvam87DQoJdmFyIF9taXhpbiA9IGQuX21peGluOw0KDQoJZG9qby5fTGluZSA9IGZ1bmN0aW9uKC8qaW50Ki8gc3RhcnQsIC8qaW50Ki8gZW5kKXsNCgkJLy8Jc3VtbWFyeToNCgkJLy8JCWRvam8uX0xpbmUgaXMgdGhlIG9iamVjdCB1c2VkIHRvIGdlbmVyYXRlIHZhbHVlcyBmcm9tIGEgc3RhcnQgdmFsdWUNCgkJLy8JCXRvIGFuIGVuZCB2YWx1ZQ0KCQkvLwlzdGFydDogaW50DQoJCS8vCQlCZWdpbm5pbmcgdmFsdWUgZm9yIHJhbmdlDQoJCS8vCWVuZDogaW50DQoJCS8vCQlFbmRpbmcgdmFsdWUgZm9yIHJhbmdlDQoJCXRoaXMuc3RhcnQgPSBzdGFydDsNCgkJdGhpcy5lbmQgPSBlbmQ7DQoJfTsNCg0KCWRvam8uX0xpbmUucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24oLypmbG9hdCovIG4pew0KCQkvLwlzdW1tYXJ5OiBSZXR1cm5zIHRoZSBwb2ludCBvbiB0aGUgbGluZQ0KCQkvLwluOiBhIGZsb2F0aW5nIHBvaW50IG51bWJlciBncmVhdGVyIHRoYW4gMCBhbmQgbGVzcyB0aGFuIDENCgkJcmV0dXJuICgodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIG4pICsgdGhpcy5zdGFydDsgLy8gRGVjaW1hbA0KCX07DQoNCglkb2pvLkFuaW1hdGlvbiA9IGZ1bmN0aW9uKGFyZ3Mpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQSBnZW5lcmljIGFuaW1hdGlvbiBjbGFzcyB0aGF0IGZpcmVzIGNhbGxiYWNrcyBpbnRvIGl0cyBoYW5kbGVycw0KCQkvLwkJb2JqZWN0IGF0IHZhcmlvdXMgc3RhdGVzLg0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUEgZ2VuZXJpYyBhbmltYXRpb24gY2xhc3MgdGhhdCBmaXJlcyBjYWxsYmFja3MgaW50byBpdHMgaGFuZGxlcnMNCgkJLy8JCW9iamVjdCBhdCB2YXJpb3VzIHN0YXRlcy4gTmVhcmx5IGFsbCBkb2pvIGFuaW1hdGlvbiBmdW5jdGlvbnMNCgkJLy8JCXJldHVybiBhbiBpbnN0YW5jZSBvZiB0aGlzIG1ldGhvZCwgdXN1YWxseSB3aXRob3V0IGNhbGxpbmcgdGhlDQoJCS8vCQkucGxheSgpIG1ldGhvZCBiZWZvcmVoYW5kLiBUaGVyZWZvcmUsIHlvdSB3aWxsIGxpa2VseSBuZWVkIHRvDQoJCS8vCQljYWxsIC5wbGF5KCkgb24gaW5zdGFuY2VzIG9mIGBkb2pvLkFuaW1hdGlvbmAgd2hlbiBvbmUgaXMNCgkJLy8JCXJldHVybmVkLg0KCQkvLyBhcmdzOiBPYmplY3QNCgkJLy8JCVRoZSAnbWFnaWMgYXJndW1lbnQnLCBtaXhpbmcgYWxsIHRoZSBwcm9wZXJ0aWVzIGludG8gdGhpcw0KCQkvLwkJYW5pbWF0aW9uIGluc3RhbmNlLg0KDQoJCV9taXhpbih0aGlzLCBhcmdzKTsNCgkJaWYoZC5pc0FycmF5KHRoaXMuY3VydmUpKXsNCgkJCXRoaXMuY3VydmUgPSBuZXcgZC5fTGluZSh0aGlzLmN1cnZlWzBdLCB0aGlzLmN1cnZlWzFdKTsNCgkJfQ0KDQoJfTsNCg0KCS8vIEFsaWFzIHRvIGRyb3AgY29tZSAyLjA6DQoJZC5fQW5pbWF0aW9uID0gZC5BbmltYXRpb247DQoNCglkLmV4dGVuZChkb2pvLkFuaW1hdGlvbiwgew0KCQkvLyBkdXJhdGlvbjogSW50ZWdlcg0KCQkvLwkJVGhlIHRpbWUgaW4gbWlsbGlzZW9uZHMgdGhlIGFuaW1hdGlvbiB3aWxsIHRha2UgdG8gcnVuDQoJCWR1cmF0aW9uOiAzNTAsDQoNCgkvKj09PT09DQoJCS8vIGN1cnZlOiBkb2pvLl9MaW5lfEFycmF5DQoJCS8vCQlBIHR3byBlbGVtZW50IGFycmF5IG9mIHN0YXJ0IGFuZCBlbmQgdmFsdWVzLCBvciBhIGBkb2pvLl9MaW5lYCBpbnN0YW5jZSB0byBiZQ0KCQkvLwkJdXNlZCBpbiB0aGUgQW5pbWF0aW9uLg0KCQljdXJ2ZTogbnVsbCwNCg0KCQkvLyBlYXNpbmc6IEZ1bmN0aW9uPw0KCQkvLwkJQSBGdW5jdGlvbiB0byBhZGp1c3QgdGhlIGFjY2VsZXJhdGlvbiAob3IgZGVjZWxlcmF0aW9uKSBvZiB0aGUgcHJvZ3Jlc3MNCgkJLy8JCWFjcm9zcyBhIGRvam8uX0xpbmUNCgkJZWFzaW5nOiBudWxsLA0KCT09PT09Ki8NCg0KCQkvLyByZXBlYXQ6IEludGVnZXI/DQoJCS8vCQlUaGUgbnVtYmVyIG9mIHRpbWVzIHRvIGxvb3AgdGhlIGFuaW1hdGlvbg0KCQlyZXBlYXQ6IDAsDQoNCgkJLy8gcmF0ZTogSW50ZWdlcj8NCgkJLy8JCXRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBhZHZhbmNpbmcgdG8gbmV4dCBmcmFtZQ0KCQkvLwkJKHVzZWQgYXMgYSBmcHMgdGltZXI6IDEwMDAvcmF0ZSA9IGZwcykNCgkJcmF0ZTogMjAgLyogNTAgZnBzICovLA0KDQoJLyo9PT09PQ0KCQkvLyBkZWxheTogSW50ZWdlcj8NCgkJLy8JCVRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBzdGFydGluZyBhbmltYXRpb24gYWZ0ZXIgaXQNCgkJLy8JCWhhcyBiZWVuIC5wbGF5KCknZWQNCgkJZGVsYXk6IG51bGwsDQoNCgkJLy8gYmVmb3JlQmVnaW46IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIGJlZm9yZSBhIGRvam8uQW5pbWF0aW9uIGJlZ2lucyBwbGF5aW5nIChzeW5jaHJvbm91cykNCgkJYmVmb3JlQmVnaW46IG51bGwsDQoNCgkJLy8gb25CZWdpbjogRXZlbnQ/DQoJCS8vCQlTeW50aGV0aWMgZXZlbnQgZmlyZWQgYXMgYSBkb2pvLkFuaW1hdGlvbiBiZWdpbnMgcGxheWluZyAodXNlZnVsPykNCgkJb25CZWdpbjogbnVsbCwNCg0KCQkvLyBvbkFuaW1hdGU6IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIGF0IGVhY2ggaW50ZXJ2YWwgb2YgYSBgZG9qby5BbmltYXRpb25gDQoJCW9uQW5pbWF0ZTogbnVsbCwNCg0KCQkvLyBvbkVuZDogRXZlbnQ/DQoJCS8vCQlTeW50aGV0aWMgZXZlbnQgZmlyZWQgYWZ0ZXIgdGhlIGZpbmFsIGZyYW1lIG9mIGEgYGRvam8uQW5pbWF0aW9uYA0KCQlvbkVuZDogbnVsbCwNCg0KCQkvLyBvblBsYXk6IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIGFueSB0aW1lIGEgYGRvam8uQW5pbWF0aW9uYCBpcyBwbGF5KCknZWQNCgkJb25QbGF5OiBudWxsLA0KDQoJCS8vIG9uUGF1c2U6IEV2ZW50Pw0KCQkvLwkJU3ludGhldGljIGV2ZW50IGZpcmVkIHdoZW4gYSBgZG9qby5BbmltYXRpb25gIGlzIHBhdXNlZA0KCQlvblBhdXNlOiBudWxsLA0KDQoJCS8vIG9uU3RvcDogRXZlbnQNCgkJLy8JCVN5bnRoZXRpYyBldmVudCBmaXJlcyB3aGVuIGEgYGRvam8uQW5pbWF0aW9uYCBpcyBzdG9wcGVkDQoJCW9uU3RvcDogbnVsbCwNCg0KCT09PT09Ki8NCg0KCQlfcGVyY2VudDogMCwNCgkJX3N0YXJ0UmVwZWF0Q291bnQ6IDAsDQoNCgkJX2dldFN0ZXA6IGZ1bmN0aW9uKCl7DQoJCQl2YXIgX3AgPSB0aGlzLl9wZXJjZW50LA0KCQkJCV9lID0gdGhpcy5lYXNpbmcNCgkJCTsNCgkJCXJldHVybiBfZSA/IF9lKF9wKSA6IF9wOw0KCQl9LA0KCQlfZmlyZTogZnVuY3Rpb24oLypFdmVudCovIGV2dCwgLypBcnJheT8qLyBhcmdzKXsNCgkJCS8vCXN1bW1hcnk6DQoJCQkvLwkJQ29udmVuaWVuY2UgZnVuY3Rpb24uICBGaXJlIGV2ZW50ICJldnQiIGFuZCBwYXNzIGl0IHRoZQ0KCQkJLy8JCWFyZ3VtZW50cyBzcGVjaWZpZWQgaW4gImFyZ3MiLg0KCQkJLy8JZGVzY3JpcHRpb246DQoJCQkvLwkJQ29udmVuaWVuY2UgZnVuY3Rpb24uICBGaXJlIGV2ZW50ICJldnQiIGFuZCBwYXNzIGl0IHRoZQ0KCQkJLy8JCWFyZ3VtZW50cyBzcGVjaWZpZWQgaW4gImFyZ3MiLg0KCQkJLy8JCUZpcmVzIHRoZSBjYWxsYmFjayBpbiB0aGUgc2NvcGUgb2YgdGhlIGBkb2pvLkFuaW1hdGlvbmANCgkJCS8vCQlpbnN0YW5jZS4NCgkJCS8vCWV2dDoNCgkJCS8vCQlUaGUgZXZlbnQgdG8gZmlyZS4NCgkJCS8vCWFyZ3M6DQoJCQkvLwkJVGhlIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBldmVudC4NCgkJCXZhciBhID0gYXJnc3x8W107DQoJCQlpZih0aGlzW2V2dF0pew0KCQkJCWlmKGQuY29uZmlnLmRlYnVnQXRBbGxDb3N0cyl7DQoJCQkJCXRoaXNbZXZ0XS5hcHBseSh0aGlzLCBhKTsNCgkJCQl9ZWxzZXsNCgkJCQkJdHJ5ew0KCQkJCQkJdGhpc1tldnRdLmFwcGx5KHRoaXMsIGEpOw0KCQkJCQl9Y2F0Y2goZSl7DQoJCQkJCQkvLyBzcXVlbGNoIGFuZCBsb2cgYmVjYXVzZSB3ZSBzaG91bGRuJ3QgYWxsb3cgZXhjZXB0aW9ucyBpbg0KCQkJCQkJLy8gc3ludGhldGljIGV2ZW50IGhhbmRsZXJzIHRvIGNhdXNlIHRoZSBpbnRlcm5hbCB0aW1lciB0byBydW4NCgkJCQkJCS8vIGFtdWNrLCBwb3RlbnRpYWxseSBwZWdnaW5nIHRoZSBDUFUuIEknbSBub3QgYSBmYW4gb2YgdGhpcw0KCQkJCQkJLy8gc3F1ZWxjaCwgYnV0IGhvcGVmdWxseSBsb2dnaW5nIHdpbGwgbWFrZSBpdCBjbGVhciB3aGF0J3MNCgkJCQkJCS8vIGdvaW5nIG9uDQoJCQkJCQljb25zb2xlLmVycm9yKCJleGNlcHRpb24gaW4gYW5pbWF0aW9uIGhhbmRsZXIgZm9yOiIsIGV2dCk7DQoJCQkJCQljb25zb2xlLmVycm9yKGUpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIHRoaXM7IC8vIGRvam8uQW5pbWF0aW9uDQoJCX0sDQoNCgkJcGxheTogZnVuY3Rpb24oLyppbnQ/Ki8gZGVsYXksIC8qQm9vbGVhbj8qLyBnb3RvU3RhcnQpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlTdGFydCB0aGUgYW5pbWF0aW9uLg0KCQkJLy8gZGVsYXk6DQoJCQkvLwkJSG93IG1hbnkgbWlsbGlzZWNvbmRzIHRvIGRlbGF5IGJlZm9yZSBzdGFydGluZy4NCgkJCS8vIGdvdG9TdGFydDoNCgkJCS8vCQlJZiB0cnVlLCBzdGFydHMgdGhlIGFuaW1hdGlvbiBmcm9tIHRoZSBiZWdpbm5pbmc7IG90aGVyd2lzZSwNCgkJCS8vCQlzdGFydHMgaXQgZnJvbSBpdHMgY3VycmVudCBwb3NpdGlvbi4NCgkJCS8vIHJldHVybnM6IGRvam8uQW5pbWF0aW9uDQoJCQkvLwkJVGhlIGluc3RhbmNlIHRvIGFsbG93IGNoYWluaW5nLg0KDQoJCQl2YXIgX3QgPSB0aGlzOw0KCQkJaWYoX3QuX2RlbGF5VGltZXIpeyBfdC5fY2xlYXJUaW1lcigpOyB9DQoJCQlpZihnb3RvU3RhcnQpew0KCQkJCV90Ll9zdG9wVGltZXIoKTsNCgkJCQlfdC5fYWN0aXZlID0gX3QuX3BhdXNlZCA9IGZhbHNlOw0KCQkJCV90Ll9wZXJjZW50ID0gMDsNCgkJCX1lbHNlIGlmKF90Ll9hY3RpdmUgJiYgIV90Ll9wYXVzZWQpew0KCQkJCXJldHVybiBfdDsNCgkJCX0NCg0KCQkJX3QuX2ZpcmUoImJlZm9yZUJlZ2luIiwgW190Lm5vZGVdKTsNCg0KCQkJdmFyIGRlID0gZGVsYXkgfHwgX3QuZGVsYXksDQoJCQkJX3AgPSBkb2pvLmhpdGNoKF90LCAiX3BsYXkiLCBnb3RvU3RhcnQpOw0KDQoJCQlpZihkZSA+IDApew0KCQkJCV90Ll9kZWxheVRpbWVyID0gc2V0VGltZW91dChfcCwgZGUpOw0KCQkJCXJldHVybiBfdDsNCgkJCX0NCgkJCV9wKCk7DQoJCQlyZXR1cm4gX3Q7DQoJCX0sDQoNCgkJX3BsYXk6IGZ1bmN0aW9uKGdvdG9TdGFydCl7DQoJCQl2YXIgX3QgPSB0aGlzOw0KCQkJaWYoX3QuX2RlbGF5VGltZXIpeyBfdC5fY2xlYXJUaW1lcigpOyB9DQoJCQlfdC5fc3RhcnRUaW1lID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7DQoJCQlpZihfdC5fcGF1c2VkKXsNCgkJCQlfdC5fc3RhcnRUaW1lIC09IF90LmR1cmF0aW9uICogX3QuX3BlcmNlbnQ7DQoJCQl9DQoNCgkJCV90Ll9hY3RpdmUgPSB0cnVlOw0KCQkJX3QuX3BhdXNlZCA9IGZhbHNlOw0KCQkJdmFyIHZhbHVlID0gX3QuY3VydmUuZ2V0VmFsdWUoX3QuX2dldFN0ZXAoKSk7DQoJCQlpZighX3QuX3BlcmNlbnQpew0KCQkJCWlmKCFfdC5fc3RhcnRSZXBlYXRDb3VudCl7DQoJCQkJCV90Ll9zdGFydFJlcGVhdENvdW50ID0gX3QucmVwZWF0Ow0KCQkJCX0NCgkJCQlfdC5fZmlyZSgib25CZWdpbiIsIFt2YWx1ZV0pOw0KCQkJfQ0KDQoJCQlfdC5fZmlyZSgib25QbGF5IiwgW3ZhbHVlXSk7DQoNCgkJCV90Ll9jeWNsZSgpOw0KCQkJcmV0dXJuIF90OyAvLyBkb2pvLkFuaW1hdGlvbg0KCQl9LA0KDQoJCXBhdXNlOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeTogUGF1c2VzIGEgcnVubmluZyBhbmltYXRpb24uDQoJCQl2YXIgX3QgPSB0aGlzOw0KCQkJaWYoX3QuX2RlbGF5VGltZXIpeyBfdC5fY2xlYXJUaW1lcigpOyB9DQoJCQlfdC5fc3RvcFRpbWVyKCk7DQoJCQlpZighX3QuX2FjdGl2ZSl7IHJldHVybiBfdDsgLypkb2pvLkFuaW1hdGlvbiovIH0NCgkJCV90Ll9wYXVzZWQgPSB0cnVlOw0KCQkJX3QuX2ZpcmUoIm9uUGF1c2UiLCBbX3QuY3VydmUuZ2V0VmFsdWUoX3QuX2dldFN0ZXAoKSldKTsNCgkJCXJldHVybiBfdDsgLy8gZG9qby5BbmltYXRpb24NCgkJfSwNCg0KCQlnb3RvUGVyY2VudDogZnVuY3Rpb24oLypEZWNpbWFsKi8gcGVyY2VudCwgLypCb29sZWFuPyovIGFuZFBsYXkpew0KCQkJLy8Jc3VtbWFyeToNCgkJCS8vCQlTZXRzIHRoZSBwcm9ncmVzcyBvZiB0aGUgYW5pbWF0aW9uLg0KCQkJLy8JcGVyY2VudDoNCgkJCS8vCQlBIHBlcmNlbnRhZ2UgaW4gZGVjaW1hbCBub3RhdGlvbiAoYmV0d2VlbiBhbmQgaW5jbHVkaW5nIDAuMCBhbmQgMS4wKS4NCgkJCS8vCWFuZFBsYXk6DQoJCQkvLwkJSWYgdHJ1ZSwgcGxheSB0aGUgYW5pbWF0aW9uIGFmdGVyIHNldHRpbmcgdGhlIHByb2dyZXNzLg0KCQkJdmFyIF90ID0gdGhpczsNCgkJCV90Ll9zdG9wVGltZXIoKTsNCgkJCV90Ll9hY3RpdmUgPSBfdC5fcGF1c2VkID0gdHJ1ZTsNCgkJCV90Ll9wZXJjZW50ID0gcGVyY2VudDsNCgkJCWlmKGFuZFBsYXkpeyBfdC5wbGF5KCk7IH0NCgkJCXJldHVybiBfdDsgLy8gZG9qby5BbmltYXRpb24NCgkJfSwNCg0KCQlzdG9wOiBmdW5jdGlvbigvKmJvb2xlYW4/Ki8gZ290b0VuZCl7DQoJCQkvLyBzdW1tYXJ5OiBTdG9wcyBhIHJ1bm5pbmcgYW5pbWF0aW9uLg0KCQkJLy8gZ290b0VuZDogSWYgdHJ1ZSwgdGhlIGFuaW1hdGlvbiB3aWxsIGVuZC4NCgkJCXZhciBfdCA9IHRoaXM7DQoJCQlpZihfdC5fZGVsYXlUaW1lcil7IF90Ll9jbGVhclRpbWVyKCk7IH0NCgkJCWlmKCFfdC5fdGltZXIpeyByZXR1cm4gX3Q7IC8qIGRvam8uQW5pbWF0aW9uICovIH0NCgkJCV90Ll9zdG9wVGltZXIoKTsNCgkJCWlmKGdvdG9FbmQpew0KCQkJCV90Ll9wZXJjZW50ID0gMTsNCgkJCX0NCgkJCV90Ll9maXJlKCJvblN0b3AiLCBbX3QuY3VydmUuZ2V0VmFsdWUoX3QuX2dldFN0ZXAoKSldKTsNCgkJCV90Ll9hY3RpdmUgPSBfdC5fcGF1c2VkID0gZmFsc2U7DQoJCQlyZXR1cm4gX3Q7IC8vIGRvam8uQW5pbWF0aW9uDQoJCX0sDQoNCgkJc3RhdHVzOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeToNCgkJCS8vCQlSZXR1cm5zIGEgc3RyaW5nIHRva2VuIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBzdGF0dXMgb2YNCgkJCS8vCQl0aGUgYW5pbWF0aW9uLCBvbmUgb2Y6ICJwYXVzZWQiLCAicGxheWluZyIsICJzdG9wcGVkIg0KCQkJaWYodGhpcy5fYWN0aXZlKXsNCgkJCQlyZXR1cm4gdGhpcy5fcGF1c2VkID8gInBhdXNlZCIgOiAicGxheWluZyI7IC8vIFN0cmluZw0KCQkJfQ0KCQkJcmV0dXJuICJzdG9wcGVkIjsgLy8gU3RyaW5nDQoJCX0sDQoNCgkJX2N5Y2xlOiBmdW5jdGlvbigpew0KCQkJdmFyIF90ID0gdGhpczsNCgkJCWlmKF90Ll9hY3RpdmUpew0KCQkJCXZhciBjdXJyID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7DQoJCQkJdmFyIHN0ZXAgPSAoY3VyciAtIF90Ll9zdGFydFRpbWUpIC8gKF90LmR1cmF0aW9uKTsNCg0KCQkJCWlmKHN0ZXAgPj0gMSl7DQoJCQkJCXN0ZXAgPSAxOw0KCQkJCX0NCgkJCQlfdC5fcGVyY2VudCA9IHN0ZXA7DQoNCgkJCQkvLyBQZXJmb3JtIGVhc2luZw0KCQkJCWlmKF90LmVhc2luZyl7DQoJCQkJCXN0ZXAgPSBfdC5lYXNpbmcoc3RlcCk7DQoJCQkJfQ0KDQoJCQkJX3QuX2ZpcmUoIm9uQW5pbWF0ZSIsIFtfdC5jdXJ2ZS5nZXRWYWx1ZShzdGVwKV0pOw0KDQoJCQkJaWYoX3QuX3BlcmNlbnQgPCAxKXsNCgkJCQkJX3QuX3N0YXJ0VGltZXIoKTsNCgkJCQl9ZWxzZXsNCgkJCQkJX3QuX2FjdGl2ZSA9IGZhbHNlOw0KDQoJCQkJCWlmKF90LnJlcGVhdCA+IDApew0KCQkJCQkJX3QucmVwZWF0LS07DQoJCQkJCQlfdC5wbGF5KG51bGwsIHRydWUpOw0KCQkJCQl9ZWxzZSBpZihfdC5yZXBlYXQgPT0gLTEpew0KCQkJCQkJX3QucGxheShudWxsLCB0cnVlKTsNCgkJCQkJfWVsc2V7DQoJCQkJCQlpZihfdC5fc3RhcnRSZXBlYXRDb3VudCl7DQoJCQkJCQkJX3QucmVwZWF0ID0gX3QuX3N0YXJ0UmVwZWF0Q291bnQ7DQoJCQkJCQkJX3QuX3N0YXJ0UmVwZWF0Q291bnQgPSAwOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCV90Ll9wZXJjZW50ID0gMDsNCgkJCQkJX3QuX2ZpcmUoIm9uRW5kIiwgW190Lm5vZGVdKTsNCgkJCQkJIV90LnJlcGVhdCAmJiBfdC5fc3RvcFRpbWVyKCk7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIF90OyAvLyBkb2pvLkFuaW1hdGlvbg0KCQl9LA0KDQoJCV9jbGVhclRpbWVyOiBmdW5jdGlvbigpew0KCQkJLy8gc3VtbWFyeTogQ2xlYXIgdGhlIHBsYXkgZGVsYXkgdGltZXINCgkJCWNsZWFyVGltZW91dCh0aGlzLl9kZWxheVRpbWVyKTsNCgkJCWRlbGV0ZSB0aGlzLl9kZWxheVRpbWVyOw0KCQl9DQoNCgl9KTsNCg0KCS8vIHRoZSBsb2NhbCB0aW1lciwgc3R1YmJlZCBpbnRvIGFsbCBBbmltYXRpb24gaW5zdGFuY2VzDQoJdmFyIGN0ciA9IDAsDQoJCXRpbWVyID0gbnVsbCwNCgkJcnVubmVyID0gew0KCQkJcnVuOiBmdW5jdGlvbigpe30NCgkJfTsNCg0KCWQuZXh0ZW5kKGQuQW5pbWF0aW9uLCB7DQoNCgkJX3N0YXJ0VGltZXI6IGZ1bmN0aW9uKCl7DQoJCQlpZighdGhpcy5fdGltZXIpew0KCQkJCXRoaXMuX3RpbWVyID0gZC5jb25uZWN0KHJ1bm5lciwgInJ1biIsIHRoaXMsICJfY3ljbGUiKTsNCgkJCQljdHIrKzsNCgkJCX0NCgkJCWlmKCF0aW1lcil7DQoJCQkJdGltZXIgPSBzZXRJbnRlcnZhbChkLmhpdGNoKHJ1bm5lciwgInJ1biIpLCB0aGlzLnJhdGUpOw0KCQkJfQ0KCQl9LA0KDQoJCV9zdG9wVGltZXI6IGZ1bmN0aW9uKCl7DQoJCQlpZih0aGlzLl90aW1lcil7DQoJCQkJZC5kaXNjb25uZWN0KHRoaXMuX3RpbWVyKTsNCgkJCQl0aGlzLl90aW1lciA9IG51bGw7DQoJCQkJY3RyLS07DQoJCQl9DQoJCQlpZihjdHIgPD0gMCl7DQoJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcik7DQoJCQkJdGltZXIgPSBudWxsOw0KCQkJCWN0ciA9IDA7DQoJCQl9DQoJCX0NCg0KCX0pOw0KDQoJdmFyIF9tYWtlRmFkZWFibGUgPQ0KCQkJCWQuaXNJRSA/IGZ1bmN0aW9uKG5vZGUpew0KCQkJLy8gb25seSBzZXQgdGhlIHpvb20gaWYgdGhlICJ0aWNrbGUiIHZhbHVlIHdvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZQ0KCQkJLy8gZGVmYXVsdA0KCQkJdmFyIG5zID0gbm9kZS5zdHlsZTsNCgkJCS8vIGRvbid0IHNldCB0aGUgd2lkdGggdG8gYXV0byBpZiBpdCBkaWRuJ3QgYWxyZWFkeSBjYXNjYWRlIHRoYXQgd2F5Lg0KCQkJLy8gV2UgZG9uJ3Qgd2FudCB0byBmIGFueW9uZXMgZGVzaWducw0KCQkJaWYoIW5zLndpZHRoLmxlbmd0aCAmJiBkLnN0eWxlKG5vZGUsICJ3aWR0aCIpID09ICJhdXRvIil7DQoJCQkJbnMud2lkdGggPSAiYXV0byI7DQoJCQl9DQoJCX0gOg0KCQkJCWZ1bmN0aW9uKCl7fTsNCg0KCWRvam8uX2ZhZGUgPSBmdW5jdGlvbigvKk9iamVjdCovIGFyZ3Mpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhbiBhbmltYXRpb24gdGhhdCB3aWxsIGZhZGUgdGhlIG5vZGUgZGVmaW5lZCBieQ0KCQkvLwkJYXJncy5ub2RlIGZyb20gdGhlIHN0YXJ0IHRvIGVuZCB2YWx1ZXMgcGFzc2VkIChhcmdzLnN0YXJ0DQoJCS8vCQlhcmdzLmVuZCkgKGVuZCBpcyBtYW5kYXRvcnksIHN0YXJ0IGlzIG9wdGlvbmFsKQ0KDQoJCWFyZ3Mubm9kZSA9IGQuYnlJZChhcmdzLm5vZGUpOw0KCQl2YXIgZkFyZ3MgPSBfbWl4aW4oeyBwcm9wZXJ0aWVzOiB7fSB9LCBhcmdzKSwNCgkJCXByb3BzID0gKGZBcmdzLnByb3BlcnRpZXMub3BhY2l0eSA9IHt9KTsNCg0KCQlwcm9wcy5zdGFydCA9ICEoInN0YXJ0IiBpbiBmQXJncykgPw0KCQkJZnVuY3Rpb24oKXsNCgkJCQlyZXR1cm4gK2Quc3R5bGUoZkFyZ3Mubm9kZSwgIm9wYWNpdHkiKXx8MDsNCgkJCX0gOiBmQXJncy5zdGFydDsNCgkJcHJvcHMuZW5kID0gZkFyZ3MuZW5kOw0KDQoJCXZhciBhbmltID0gZC5hbmltYXRlUHJvcGVydHkoZkFyZ3MpOw0KCQlkLmNvbm5lY3QoYW5pbSwgImJlZm9yZUJlZ2luIiwgZC5wYXJ0aWFsKF9tYWtlRmFkZWFibGUsIGZBcmdzLm5vZGUpKTsNCg0KCQlyZXR1cm4gYW5pbTsgLy8gZG9qby5BbmltYXRpb24NCgl9Ow0KDQoJLyo9PT09PQ0KCWRvam8uX19GYWRlQXJncyA9IGZ1bmN0aW9uKG5vZGUsIGR1cmF0aW9uLCBlYXNpbmcpew0KCQkvLwlub2RlOiBET01Ob2RlfFN0cmluZw0KCQkvLwkJVGhlIG5vZGUgcmVmZXJlbmNlZCBpbiB0aGUgYW5pbWF0aW9uDQoJCS8vCWR1cmF0aW9uOiBJbnRlZ2VyPw0KCQkvLwkJRHVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbiBpbiBtaWxsaXNlY29uZHMuDQoJCS8vCWVhc2luZzogRnVuY3Rpb24/DQoJCS8vCQlBbiBlYXNpbmcgZnVuY3Rpb24uDQoJCXRoaXMubm9kZSA9IG5vZGU7DQoJCXRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjsNCgkJdGhpcy5lYXNpbmcgPSBlYXNpbmc7DQoJfQ0KCT09PT09Ki8NCg0KCWRvam8uZmFkZUluID0gZnVuY3Rpb24oLypkb2pvLl9fRmFkZUFyZ3MqLyBhcmdzKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gYW5pbWF0aW9uIHRoYXQgd2lsbCBmYWRlIG5vZGUgZGVmaW5lZCBpbiAnYXJncycgZnJvbQ0KCQkvLwkJaXRzIGN1cnJlbnQgb3BhY2l0eSB0byBmdWxseSBvcGFxdWUuDQoJCXJldHVybiBkLl9mYWRlKF9taXhpbih7IGVuZDogMSB9LCBhcmdzKSk7IC8vIGRvam8uQW5pbWF0aW9uDQoJfTsNCg0KCWRvam8uZmFkZU91dCA9IGZ1bmN0aW9uKC8qZG9qby5fX0ZhZGVBcmdzKi8gIGFyZ3Mpew0KCQkvLyBzdW1tYXJ5Og0KCQkvLwkJUmV0dXJucyBhbiBhbmltYXRpb24gdGhhdCB3aWxsIGZhZGUgbm9kZSBkZWZpbmVkIGluICdhcmdzJw0KCQkvLwkJZnJvbSBpdHMgY3VycmVudCBvcGFjaXR5IHRvIGZ1bGx5IHRyYW5zcGFyZW50Lg0KCQlyZXR1cm4gZC5fZmFkZShfbWl4aW4oeyBlbmQ6IDAgfSwgYXJncykpOyAvLyBkb2pvLkFuaW1hdGlvbg0KCX07DQoNCglkb2pvLl9kZWZhdWx0RWFzaW5nID0gZnVuY3Rpb24oLypEZWNpbWFsPyovIG4pew0KCQkvLyBzdW1tYXJ5OiBUaGUgZGVmYXVsdCBlYXNpbmcgZnVuY3Rpb24gZm9yIGRvam8uQW5pbWF0aW9uKHMpDQoJCXJldHVybiAwLjUgKyAoKE1hdGguc2luKChuICsgMS41KSAqIE1hdGguUEkpKSAvIDIpOw0KCX07DQoNCgl2YXIgUHJvcExpbmUgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKXsNCgkJLy8gUHJvcExpbmUgaXMgYW4gaW50ZXJuYWwgY2xhc3Mgd2hpY2ggaXMgdXNlZCB0byBtb2RlbCB0aGUgdmFsdWVzIG9mDQoJCS8vIGFuIGEgZ3JvdXAgb2YgQ1NTIHByb3BlcnRpZXMgYWNyb3NzIGFuIGFuaW1hdGlvbiBsaWZlY3ljbGUuIEluDQoJCS8vIHBhcnRpY3VsYXIsIHRoZSAiZ2V0VmFsdWUiIGZ1bmN0aW9uIGhhbmRsZXMgZ2V0dGluZyBpbnRlcnBvbGF0ZWQNCgkJLy8gdmFsdWVzIGJldHdlZW4gc3RhcnQgYW5kIGVuZCBmb3IgYSBwYXJ0aWN1bGFyIENTUyB2YWx1ZS4NCgkJdGhpcy5fcHJvcGVydGllcyA9IHByb3BlcnRpZXM7DQoJCWZvcih2YXIgcCBpbiBwcm9wZXJ0aWVzKXsNCgkJCXZhciBwcm9wID0gcHJvcGVydGllc1twXTsNCgkJCWlmKHByb3Auc3RhcnQgaW5zdGFuY2VvZiBkLkNvbG9yKXsNCgkJCQkvLyBjcmVhdGUgYSByZXVzYWJsZSB0ZW1wIGNvbG9yIG9iamVjdCB0byBrZWVwIGludGVybWVkaWF0ZSByZXN1bHRzDQoJCQkJcHJvcC50ZW1wQ29sb3IgPSBuZXcgZC5Db2xvcigpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCVByb3BMaW5lLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uKHIpew0KCQl2YXIgcmV0ID0ge307DQoJCWZvcih2YXIgcCBpbiB0aGlzLl9wcm9wZXJ0aWVzKXsNCgkJCXZhciBwcm9wID0gdGhpcy5fcHJvcGVydGllc1twXSwNCgkJCQlzdGFydCA9IHByb3Auc3RhcnQ7DQoJCQlpZihzdGFydCBpbnN0YW5jZW9mIGQuQ29sb3Ipew0KCQkJCXJldFtwXSA9IGQuYmxlbmRDb2xvcnMoc3RhcnQsIHByb3AuZW5kLCByLCBwcm9wLnRlbXBDb2xvcikudG9Dc3MoKTsNCgkJCX1lbHNlIGlmKCFkLmlzQXJyYXkoc3RhcnQpKXsNCgkJCQlyZXRbcF0gPSAoKHByb3AuZW5kIC0gc3RhcnQpICogcikgKyBzdGFydCArIChwICE9ICJvcGFjaXR5IiA/IHByb3AudW5pdHMgfHwgInB4IiA6IDApOw0KCQkJfQ0KCQl9DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCS8qPT09PT0NCglkb2pvLmRlY2xhcmUoImRvam8uX19BbmltQXJncyIsIFtkb2pvLl9fRmFkZUFyZ3NdLCB7DQoJCS8vIFByb3BlcnRpZXM6IE9iamVjdD8NCgkJLy8JQSBoYXNoIG1hcCBvZiBzdHlsZSBwcm9wZXJ0aWVzIHRvIE9iamVjdHMgZGVzY3JpYmluZyB0aGUgdHJhbnNpdGlvbiwNCgkJLy8Jc3VjaCBhcyB0aGUgcHJvcGVydGllcyBvZiBkb2pvLl9MaW5lIHdpdGggYW4gYWRkaXRpb25hbCAndW5pdHMnIHByb3BlcnR5DQoJCXByb3BlcnRpZXM6IHt9DQoNCgkJLy9UT0RPQzogYWRkIGV2ZW50IGNhbGxiYWNrcw0KCX0pOw0KCT09PT09Ki8NCg0KCWRvam8uYW5pbWF0ZVByb3BlcnR5ID0gZnVuY3Rpb24oLypkb2pvLl9fQW5pbUFyZ3MqLyBhcmdzKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVJldHVybnMgYW4gYW5pbWF0aW9uIHRoYXQgd2lsbCB0cmFuc2l0aW9uIHRoZSBwcm9wZXJ0aWVzIG9mDQoJCS8vCQlub2RlIGRlZmluZWQgaW4gYGFyZ3NgIGRlcGVuZGluZyBob3cgdGhleSBhcmUgZGVmaW5lZCBpbg0KCQkvLwkJYGFyZ3MucHJvcGVydGllc2ANCgkJLy8NCgkJLy8gZGVzY3JpcHRpb246DQoJCS8vCQlgZG9qby5hbmltYXRlUHJvcGVydHlgIGlzIHRoZSBmb3VuZGF0aW9uIG9mIG1vc3QgYGRvam8uZnhgDQoJCS8vCQlhbmltYXRpb25zLiBJdCB0YWtlcyBhbiBvYmplY3Qgb2YgInByb3BlcnRpZXMiIGNvcnJlc3BvbmRpbmcgdG8NCgkJLy8JCXN0eWxlIHByb3BlcnRpZXMsIGFuZCBhbmltYXRlcyB0aGVtIGluIHBhcmFsbGVsIG92ZXIgYSBzZXQNCgkJLy8JCWR1cmF0aW9uLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJQSBzaW1wbGUgYW5pbWF0aW9uIHRoYXQgY2hhbmdlcyB0aGUgd2lkdGggb2YgdGhlIHNwZWNpZmllZCBub2RlLg0KCQkvLwl8CWRvam8uYW5pbWF0ZVByb3BlcnR5KHsNCgkJLy8JfAkJbm9kZTogIm5vZGVJZCIsDQoJCS8vCXwJCXByb3BlcnRpZXM6IHsgd2lkdGg6IDQwMCB9LA0KCQkvLwl8CX0pLnBsYXkoKTsNCgkJLy8JCURvam8gZmlndXJlcyBvdXQgdGhlIHN0YXJ0IHZhbHVlIGZvciB0aGUgd2lkdGggYW5kIGNvbnZlcnRzIHRoZQ0KCQkvLwkJaW50ZWdlciBzcGVjaWZpZWQgZm9yIHRoZSB3aWR0aCB0byB0aGUgbW9yZSBleHByZXNzaXZlIGJ1dA0KCQkvLwkJdmVyYm9zZSBmb3JtIGB7IHdpZHRoOiB7IGVuZDogJzQwMCcsIHVuaXRzOiAncHgnIH0gfWAgd2hpY2ggeW91DQoJCS8vCQljYW4gYWxzbyBzcGVjaWZ5IGRpcmVjdGx5LiBEZWZhdWx0cyB0byAncHgnIGlmIG9tbWl0dGVkLg0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJQW5pbWF0ZSB3aWR0aCwgaGVpZ2h0LCBhbmQgcGFkZGluZyBvdmVyIDIgc2Vjb25kcy4uLiB0aGUNCgkJLy8JCXBlZGFudGljIHdheToNCgkJLy8JfAlkb2pvLmFuaW1hdGVQcm9wZXJ0eSh7IG5vZGU6IG5vZGUsIGR1cmF0aW9uOjIwMDAsDQoJCS8vCXwJCXByb3BlcnRpZXM6IHsNCgkJLy8JfAkJCXdpZHRoOiB7IHN0YXJ0OiAnMjAwJywgZW5kOiAnNDAwJywgdW5pdHM6InB4IiB9LA0KCQkvLwl8CQkJaGVpZ2h0OiB7IHN0YXJ0OicyMDAnLCBlbmQ6ICc0MDAnLCB1bml0czoicHgiIH0sDQoJCS8vCXwJCQlwYWRkaW5nVG9wOiB7IHN0YXJ0Oic1JywgZW5kOic1MCcsIHVuaXRzOiJweCIgfQ0KCQkvLwl8CQl9DQoJCS8vCXwJfSkucGxheSgpOw0KCQkvLwkJTm90ZSAncGFkZGluZ1RvcCcgaXMgdXNlZCBvdmVyICdwYWRkaW5nLXRvcCcuIE11bHRpLW5hbWUgQ1NTIHByb3BlcnRpZXMNCgkJLy8JCWFyZSB3cml0dGVuIHVzaW5nICJtaXhlZCBjYXNlIiwgYXMgdGhlIGh5cGhlbiBpcyBpbGxlZ2FsIGFzIGFuIG9iamVjdCBrZXkuDQoJCS8vDQoJCS8vIGV4YW1wbGU6DQoJCS8vCQlQbHVnIGluIGEgZGlmZmVyZW50IGVhc2luZyBmdW5jdGlvbiBhbmQgcmVnaXN0ZXIgYSBjYWxsYmFjayBmb3INCgkJLy8JCXdoZW4gdGhlIGFuaW1hdGlvbiBlbmRzLiBFYXNpbmcgZnVuY3Rpb25zIGFjY2VwdCB2YWx1ZXMgYmV0d2Vlbg0KCQkvLwkJemVybyBhbmQgb25lIGFuZCByZXR1cm4gYSB2YWx1ZSBvbiB0aGF0IGJhc2lzLiBJbiB0aGlzIGNhc2UsIGFuDQoJCS8vCQlleHBvbmVudGlhbC1pbiBjdXJ2ZS4NCgkJLy8JfAlkb2pvLmFuaW1hdGVQcm9wZXJ0eSh7DQoJCS8vCXwJCW5vZGU6ICJub2RlSWQiLA0KCQkvLwl8CQkvLyBkb2pvIGZpZ3VyZXMgb3V0IHRoZSBzdGFydCB2YWx1ZQ0KCQkvLwl8CQlwcm9wZXJ0aWVzOiB7IHdpZHRoOiB7IGVuZDogNDAwIH0gfSwNCgkJLy8JfAkJZWFzaW5nOiBmdW5jdGlvbihuKXsNCgkJLy8JfAkJCXJldHVybiAobj09MCkgPyAwIDogTWF0aC5wb3coMiwgMTAgKiAobiAtIDEpKTsNCgkJLy8JfAkJfSwNCgkJLy8JfAkJb25FbmQ6IGZ1bmN0aW9uKG5vZGUpew0KCQkvLwl8CQkJLy8gY2FsbGVkIHdoZW4gdGhlIGFuaW1hdGlvbiBmaW5pc2hlcy4gVGhlIGFuaW1hdGlvbg0KCQkvLwl8CQkJLy8gdGFyZ2V0IGlzIHBhc3NlZCB0byB0aGlzIGZ1bmN0aW9uDQoJCS8vCXwJCX0NCgkJLy8JfAl9KS5wbGF5KDUwMCk7IC8vIGRlbGF5IHBsYXlpbmcgaGFsZiBhIHNlY29uZA0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJTGlrZSBhbGwgYGRvam8uQW5pbWF0aW9uYHMsIGFuaW1hdGVQcm9wZXJ0eSByZXR1cm5zIGEgaGFuZGxlIHRvIHRoZQ0KCQkvLwkJQW5pbWF0aW9uIGluc3RhbmNlLCB3aGljaCBmaXJlcyB0aGUgZXZlbnRzIGNvbW1vbiB0byBEb2pvIEZYLiBVc2UgYGRvam8uY29ubmVjdGANCgkJLy8JCXRvIGFjY2VzcyB0aGVzZSBldmVudHMgb3V0c2lkZSBvZiB0aGUgQW5pbWF0aW9uIGRlZmluaXRvbjoNCgkJLy8JfAl2YXIgYW5pbSA9IGRvam8uYW5pbWF0ZVByb3BlcnR5KHsNCgkJLy8JfAkJbm9kZToic29tZUlkIiwNCgkJLy8JfAkJcHJvcGVydGllczp7DQoJCS8vCXwJCQl3aWR0aDo0MDAsIGhlaWdodDo1MDANCgkJLy8JfAkJfQ0KCQkvLwl8CX0pOw0KCQkvLwl8CWRvam8uY29ubmVjdChhbmltLCJvbkVuZCIsIGZ1bmN0aW9uKCl7DQoJCS8vCXwJCWNvbnNvbGUubG9nKCJhbmltYXRpb24gZW5kZWQiKTsNCgkJLy8JfAl9KTsNCgkJLy8JfAkvLyBwbGF5IHRoZSBhbmltYXRpb24gbm93Og0KCQkvLwl8CWFuaW0ucGxheSgpOw0KCQkvLw0KCQkvLyBleGFtcGxlOg0KCQkvLwkJRWFjaCBwcm9wZXJ0eSBjYW4gYmUgYSBmdW5jdGlvbiB3aG9zZSByZXR1cm4gdmFsdWUgaXMgc3Vic3RpdHV0ZWQgYWxvbmcuDQoJCS8vCQlBZGRpdGlvbmFsbHksIGVhY2ggbWVhc3VyZW1lbnQgKGVnOiBzdGFydCwgZW5kKSBjYW4gYmUgYSBmdW5jdGlvbi4gVGhlIG5vZGUNCgkJLy8JCXJlZmVyZW5jZSBpcyBwYXNzZWQgZGlyZWNseSB0byBjYWxsYmFja3MuDQoJCS8vCXwJZG9qby5hbmltYXRlUHJvcGVydHkoew0KCQkvLwl8CQlub2RlOiJtaW5lIiwNCgkJLy8JfAkJcHJvcGVydGllczp7DQoJCS8vCXwJCQloZWlnaHQ6ZnVuY3Rpb24obm9kZSl7DQoJCS8vCXwJCQkJLy8gc2hyaW5rIHRoaXMgbm9kZSBieSA1MCUNCgkJLy8JfAkJCQlyZXR1cm4gZG9qby5wb3NpdGlvbihub2RlKS5oIC8gMg0KCQkvLwl8CQkJfSwNCgkJLy8JfAkJCXdpZHRoOnsNCgkJLy8JfAkJCQlzdGFydDpmdW5jdGlvbihub2RlKXsgcmV0dXJuIDEwMDsgfSwNCgkJLy8JfAkJCQllbmQ6ZnVuY3Rpb24obm9kZSl7IHJldHVybiAyMDA7IH0NCgkJLy8JfAkJCX0NCgkJLy8JfAkJfQ0KCQkvLwl8CX0pLnBsYXkoKTsNCgkJLy8NCg0KCQl2YXIgbiA9IGFyZ3Mubm9kZSA9IGQuYnlJZChhcmdzLm5vZGUpOw0KCQlpZighYXJncy5lYXNpbmcpeyBhcmdzLmVhc2luZyA9IGQuX2RlZmF1bHRFYXNpbmc7IH0NCg0KCQl2YXIgYW5pbSA9IG5ldyBkLkFuaW1hdGlvbihhcmdzKTsNCgkJZC5jb25uZWN0KGFuaW0sICJiZWZvcmVCZWdpbiIsIGFuaW0sIGZ1bmN0aW9uKCl7DQoJCQl2YXIgcG0gPSB7fTsNCgkJCWZvcih2YXIgcCBpbiB0aGlzLnByb3BlcnRpZXMpew0KCQkJCS8vIE1ha2Ugc2hhbGxvdyBjb3B5IG9mIHByb3BlcnRpZXMgaW50byBwbSBiZWNhdXNlIHdlIG92ZXJ3cml0ZQ0KCQkJCS8vIHNvbWUgdmFsdWVzIGJlbG93LiBJbiBwYXJ0aWN1bGFyIGlmIHN0YXJ0L2VuZCBhcmUgZnVuY3Rpb25zDQoJCQkJLy8gd2UgZG9uJ3Qgd2FudCB0byBvdmVyd3JpdGUgdGhlbSBvciB0aGUgZnVuY3Rpb25zIHdvbid0IGJlDQoJCQkJLy8gY2FsbGVkIGlmIHRoZSBhbmltYXRpb24gaXMgcmV1c2VkLg0KCQkJCWlmKHAgPT0gIndpZHRoIiB8fCBwID09ICJoZWlnaHQiKXsNCgkJCQkJdGhpcy5ub2RlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJCX0NCgkJCQl2YXIgcHJvcCA9IHRoaXMucHJvcGVydGllc1twXTsNCgkJCQlpZihkLmlzRnVuY3Rpb24ocHJvcCkpew0KCQkJCQlwcm9wID0gcHJvcChuKTsNCgkJCQl9DQoJCQkJcHJvcCA9IHBtW3BdID0gX21peGluKHt9LCAoZC5pc09iamVjdChwcm9wKSA/IHByb3A6IHsgZW5kOiBwcm9wIH0pKTsNCg0KCQkJCWlmKGQuaXNGdW5jdGlvbihwcm9wLnN0YXJ0KSl7DQoJCQkJCXByb3Auc3RhcnQgPSBwcm9wLnN0YXJ0KG4pOw0KCQkJCX0NCgkJCQlpZihkLmlzRnVuY3Rpb24ocHJvcC5lbmQpKXsNCgkJCQkJcHJvcC5lbmQgPSBwcm9wLmVuZChuKTsNCgkJCQl9DQoJCQkJdmFyIGlzQ29sb3IgPSAocC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImNvbG9yIikgPj0gMCk7DQoJCQkJZnVuY3Rpb24gZ2V0U3R5bGUobm9kZSwgcCl7DQoJCQkJCS8vIGRvam8uc3R5bGUobm9kZSwgImhlaWdodCIpIGNhbiByZXR1cm4gImF1dG8iIG9yICIiIG9uIElFOyB0aGlzIGlzIG1vcmUgcmVsaWFibGU6DQoJCQkJCXZhciB2ID0geyBoZWlnaHQ6IG5vZGUub2Zmc2V0SGVpZ2h0LCB3aWR0aDogbm9kZS5vZmZzZXRXaWR0aCB9W3BdOw0KCQkJCQlpZih2ICE9PSB1bmRlZmluZWQpeyByZXR1cm4gdjsgfQ0KCQkJCQl2ID0gZC5zdHlsZShub2RlLCBwKTsNCgkJCQkJcmV0dXJuIChwID09ICJvcGFjaXR5IikgPyArdiA6IChpc0NvbG9yID8gdiA6IHBhcnNlRmxvYXQodikpOw0KCQkJCX0NCgkJCQlpZighKCJlbmQiIGluIHByb3ApKXsNCgkJCQkJcHJvcC5lbmQgPSBnZXRTdHlsZShuLCBwKTsNCgkJCQl9ZWxzZSBpZighKCJzdGFydCIgaW4gcHJvcCkpew0KCQkJCQlwcm9wLnN0YXJ0ID0gZ2V0U3R5bGUobiwgcCk7DQoJCQkJfQ0KDQoJCQkJaWYoaXNDb2xvcil7DQoJCQkJCXByb3Auc3RhcnQgPSBuZXcgZC5Db2xvcihwcm9wLnN0YXJ0KTsNCgkJCQkJcHJvcC5lbmQgPSBuZXcgZC5Db2xvcihwcm9wLmVuZCk7DQoJCQkJfWVsc2V7DQoJCQkJCXByb3Auc3RhcnQgPSAocCA9PSAib3BhY2l0eSIpID8gK3Byb3Auc3RhcnQgOiBwYXJzZUZsb2F0KHByb3Auc3RhcnQpOw0KCQkJCX0NCgkJCX0NCgkJCXRoaXMuY3VydmUgPSBuZXcgUHJvcExpbmUocG0pOw0KCQl9KTsNCgkJZC5jb25uZWN0KGFuaW0sICJvbkFuaW1hdGUiLCBkLmhpdGNoKGQsICJzdHlsZSIsIGFuaW0ubm9kZSkpOw0KCQlyZXR1cm4gYW5pbTsgLy8gZG9qby5BbmltYXRpb24NCgl9Ow0KDQoJZG9qby5hbmltID0gZnVuY3Rpb24oCS8qRE9NTm9kZXxTdHJpbmcqLwlub2RlLA0KCQkJCQkJCS8qT2JqZWN0Ki8JCQlwcm9wZXJ0aWVzLA0KCQkJCQkJCS8qSW50ZWdlcj8qLwkJZHVyYXRpb24sDQoJCQkJCQkJLypGdW5jdGlvbj8qLwkJZWFzaW5nLA0KCQkJCQkJCS8qRnVuY3Rpb24/Ki8JCW9uRW5kLA0KCQkJCQkJCS8qSW50ZWdlcj8qLwkJZGVsYXkpew0KCQkvLwlzdW1tYXJ5Og0KCQkvLwkJQSBzaW1wbGVyIGludGVyZmFjZSB0byBgZG9qby5hbmltYXRlUHJvcGVydHkoKWAsIGFsc28gcmV0dXJucw0KCQkvLwkJYW4gaW5zdGFuY2Ugb2YgYGRvam8uQW5pbWF0aW9uYCBidXQgYmVnaW5zIHRoZSBhbmltYXRpb24NCgkJLy8JCWltbWVkaWF0ZWx5LCB1bmxpa2UgbmVhcmx5IGV2ZXJ5IG90aGVyIERvam8gYW5pbWF0aW9uIEFQSS4NCgkJLy8JZGVzY3JpcHRpb246DQoJCS8vCQlgZG9qby5hbmltYCBpcyBhIHNpbXBsZXIgKGJ1dCBzb21ld2hhdCBsZXNzIHBvd2VyZnVsKSB2ZXJzaW9uDQoJCS8vCQlvZiBgZG9qby5hbmltYXRlUHJvcGVydHlgLiAgSXQgdXNlcyBkZWZhdWx0cyBmb3IgbWFueSBiYXNpYyBwcm9wZXJ0aWVzDQoJCS8vCQlhbmQgYWxsb3dzIGZvciBwb3NpdGlvbmFsIHBhcmFtZXRlcnMgdG8gYmUgdXNlZCBpbiBwbGFjZSBvZiB0aGUNCgkJLy8JCXBhY2tlZCAicHJvcGVydHkgYmFnIiB3aGljaCBpcyB1c2VkIGZvciBvdGhlciBEb2pvIGFuaW1hdGlvbg0KCQkvLwkJbWV0aG9kcy4NCgkJLy8NCgkJLy8JCVRoZSBgZG9qby5BbmltYXRpb25gIG9iamVjdCByZXR1cm5lZCBmcm9tIGBkb2pvLmFuaW1gIHdpbGwgYmUNCgkJLy8JCWFscmVhZHkgcGxheWluZyB3aGVuIGl0IGlzIHJldHVybmVkIGZyb20gdGhpcyBmdW5jdGlvbiwgc28NCgkJLy8JCWNhbGxpbmcgcGxheSgpIG9uIGl0IGFnYWluIGlzICh1c3VhbGx5KSBhIG5vLW9wLg0KCQkvLwlub2RlOg0KCQkvLwkJYSBET00gbm9kZSBvciB0aGUgaWQgb2YgYSBub2RlIHRvIGFuaW1hdGUgQ1NTIHByb3BlcnRpZXMgb24NCgkJLy8JZHVyYXRpb246DQoJCS8vCQlUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBvdmVyIHdoaWNoIHRoZSBhbmltYXRpb24NCgkJLy8JCXNob3VsZCBydW4uIERlZmF1bHRzIHRvIHRoZSBnbG9iYWwgYW5pbWF0aW9uIGRlZmF1bHQgZHVyYXRpb24NCgkJLy8JCSgzNTBtcykuDQoJCS8vCWVhc2luZzoNCgkJLy8JCUFuIGVhc2luZyBmdW5jdGlvbiBvdmVyIHdoaWNoIHRvIGNhbGN1bGF0ZSBhY2NlbGVyYXRpb24NCgkJLy8JCWFuZCBkZWNlbGVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbiB0aHJvdWdoIGl0cyBkdXJhdGlvbi4NCgkJLy8JCUEgZGVmYXVsdCBlYXNpbmcgYWxnb3JpdGhtIGlzIHByb3ZpZGVkLCBidXQgeW91IG1heQ0KCQkvLwkJcGx1ZyBpbiBhbnkgeW91IHdpc2guIEEgbGFyZ2Ugc2VsZWN0aW9uIG9mIGVhc2luZyBhbGdvcml0aG1zDQoJCS8vCQlhcmUgYXZhaWxhYmxlIGluIGBkb2pvLmZ4LmVhc2luZ2AuDQoJCS8vCW9uRW5kOg0KCQkvLwkJQSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGUgYW5pbWF0aW9uIGZpbmlzaGVzDQoJCS8vCQlydW5uaW5nLg0KCQkvLwlkZWxheToNCgkJLy8JCVRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIGRlbGF5IGJlZ2lubmluZyB0aGUNCgkJLy8JCWFuaW1hdGlvbiBieS4gVGhlIGRlZmF1bHQgaXMgMC4NCgkJLy8JZXhhbXBsZToNCgkJLy8JCUZhZGUgb3V0IGEgbm9kZQ0KCQkvLwl8CWRvam8uYW5pbSgiaWQiLCB7IG9wYWNpdHk6IDAgfSk7DQoJCS8vCWV4YW1wbGU6DQoJCS8vCQlGYWRlIG91dCBhIG5vZGUgb3ZlciBhIGZ1bGwgc2Vjb25kDQoJCS8vCXwJZG9qby5hbmltKCJpZCIsIHsgb3BhY2l0eTogMCB9LCAxMDAwKTsNCgkJcmV0dXJuIGQuYW5pbWF0ZVByb3BlcnR5KHsgLy8gZG9qby5BbmltYXRpb24NCgkJCW5vZGU6IG5vZGUsDQoJCQlkdXJhdGlvbjogZHVyYXRpb24gfHwgZC5BbmltYXRpb24ucHJvdG90eXBlLmR1cmF0aW9uLA0KCQkJcHJvcGVydGllczogcHJvcGVydGllcywNCgkJCWVhc2luZzogZWFzaW5nLA0KCQkJb25FbmQ6IG9uRW5kDQoJCX0pLnBsYXkoZGVsYXkgfHwgMCk7DQoJfTsNCn0pKCk7DQoNCn0NCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pvLl9iYXNlLmJyb3dzZXIiXSl7IC8vX2hhc1Jlc291cmNlIGNoZWNrcyBhZGRlZCBieSBidWlsZC4gRG8gbm90IHVzZSBfaGFzUmVzb3VyY2UgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KZG9qby5faGFzUmVzb3VyY2VbImRvam8uX2Jhc2UuYnJvd3NlciJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qby5fYmFzZS5icm93c2VyIik7DQoNCg0KDQoNCg0KDQoNCg0KDQoNCi8vTmVlZCB0aGlzIHRvIGJlIHRoZSBsYXN0IGNvZGUgc2VnbWVudCBpbiBiYXNlLCBzbyBkbyBub3QgcGxhY2UgYW55DQovL2Rvam8ucmVxdWlyZUlmIGNhbGxzIGluIHRoaXMgZmlsZS4gT3RoZXJ3aXNlLCBkdWUgdG8gaG93IHRoZSBidWlsZCBzeXN0ZW0NCi8vcHV0cyBhbGwgcmVxdWlyZUlmIGRlcGVuZGVuY2llcyBhZnRlciB0aGUgY3VycmVudCBmaWxlLCB0aGUgcmVxdWlyZSBjYWxscw0KLy9jb3VsZCBiZSBjYWxsZWQgYmVmb3JlIGFsbCBvZiBiYXNlIGlzIGRlZmluZWQuDQpkb2pvLmZvckVhY2goZG9qby5jb25maWcucmVxdWlyZSwgZnVuY3Rpb24oaSl7DQoJZG9qb1sicmVxdWlyZSJdKGkpOw0KfSk7DQoNCn0NCg0KLyoNCglDb3B5cmlnaHQgKGMpIDIwMDQtMjAxMCwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLg0KCUF2YWlsYWJsZSB2aWEgQWNhZGVtaWMgRnJlZSBMaWNlbnNlID49IDIuMSBPUiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UuDQoJc2VlOiBodHRwOi8vZG9qb3Rvb2xraXQub3JnL2xpY2Vuc2UgZm9yIGRldGFpbHMNCiovDQoNCg0KaWYoIWRvam8uX2hhc1Jlc291cmNlWyJkb2pveC5pby53aW5kb3dOYW1lIl0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pveC5pby53aW5kb3dOYW1lIl0gPSB0cnVlOw0KZG9qby5wcm92aWRlKCJkb2pveC5pby53aW5kb3dOYW1lIik7DQovLyBJbXBsZW1lbnRzIHRoZSB3aW5kb3cubmFtZSB0cmFuc3BvcnQgIA0KDQpkb2pveC5pby53aW5kb3dOYW1lID0gew0KCXNlbmQ6IGZ1bmN0aW9uKC8qU3RyaW5nKi8gbWV0aG9kLCAvKmRvam8uX19Jb0FyZ3MqLyBhcmdzKXsNCgkJLy8gc3VtbWFyeToNCgkJLy8JCVByb3ZpZGVzIHNlY3VyZSBjcm9zcy1kb21haW4gcmVxdWVzdCBjYXBhYmlsaXR5Lg0KCQkvLyAJCVNlbmRzIGEgcmVxdWVzdCB1c2luZyBhbiBpZnJhbWUgKFBPU1Qgb3IgR0VUKSBhbmQgcmVhZHMgdGhlIHJlc3BvbnNlIHRocm91Z2ggdGhlIA0KCQkvLyAJCWZyYW1lJ3Mgd2luZG93Lm5hbWUuDQoJCS8vDQoJCS8vCW1ldGhvZDoNCgkJLy8JCVRoZSBtZXRob2QgdG8gdXNlIHRvIHNlbmQgdGhlIHJlcXVlc3QsIEdFVCBvciBQT1NUDQoJCS8vDQoJCS8vCWFyZ3M6DQoJCS8vCQlTZWUgZG9qby54aHINCgkJLy8NCgkJLy8JYXJncy5hdXRoRWxlbWVudDogRE9NTm9kZT8NCgkJLy8JCUJ5IHByb3ZpZGluZyBhbiBhdXRoRWxlbWVudCwgdGhpcyBpbmRpY2F0ZXMgdGhhdCB3aW5kb3dOYW1lIHNob3VsZCB1c2UgdGhlIA0KCQkvLyAJCWF1dGhvcml6ZWQgd2luZG93Lm5hbWUgcHJvdG9jb2wsIHJlbHlpbmcgb24NCgkJLy8JCXRoZSBsb2FkZWQgWEQgcmVzb3VyY2UgdG8gcmV0dXJuIHRvIHRoZSBwcm92aWRlZCByZXR1cm4gVVJMIG9uIGNvbXBsZXRpb24NCgkJLy8JCW9mIGF1dGhvcml6YXRpb24vYXV0aGVudGljYXRpb24uIFRoZSBwcm92aWRlZCBhdXRoRWxlbWVudCB3aWxsIGJlIHVzZWQgdG8gcGxhY2UNCgkJLy8JCXRoZSBpZnJhbWUgaW4sIHNvIHRoZSB1c2VyIGNhbiBpbnRlcmFjdCB3aXRoIHRoZSBzZXJ2ZXIgcmVzb3VyY2UgZm9yIGF1dGhlbnRpY2F0aW9uDQoJCS8vCQlhbmQvb3IgYXV0aG9yaXphdGlvbiB0byBhY2Nlc3MgdGhlIHJlc291cmNlLg0KCQkvLw0KCQkvLwlhcmdzLm9uQXV0aExvYWQ6IEZ1bmN0aW9uPw0KCQkvLwkJV2hlbiB1c2luZyBhdXRob3JpemVkIGFjY2VzcyB0byByZXNvdXJjZXMsIHRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUNCgkJLy8gCQlhdXRob3JpemF0aW9uIHBhZ2UgaGFzIGJlZW4gbG9hZGVkLiAoV2hlbiBhdXRob3JpemF0aW9uIGlzIGFjdHVhbGx5IGNvbXBsZXRlZCwNCgkJLy8gCQl0aGUgZGVmZXJyZWQgY2FsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggdGhlIHJlc3VsdCkuIFRoZSBwcmltYXJ5IHVzZSBmb3IgdGhpcw0KCQkvLyAJCWlzIHRvIG1ha2UgdGhlIGF1dGhFbGVtZW50IHZpc2libGUgdG8gdGhlIHVzZXIgb25jZSB0aGUgcmVzb3VyY2UgaGFzIGxvYWRlZA0KCQkvLyAJCSh0aGlzIGNhbiBiZSBwcmVmZXJhYmxlIHRvIHNob3dpbmcgdGhlIGlmcmFtZSB3aGlsZSB0aGUgcmVzb3VyY2UgaXMgbG9hZGluZw0KCQkvLyAJCXNpbmNlIGl0IG1heSBub3QgcmVxdWlyZSBhdXRob3JpemF0aW9uLCBpdCBtYXkgc2ltcGx5IHJldHVybiB0aGUgcmVzb3VyY2UpLiANCgkJLy8gIA0KCQkvLwlkZXNjcmlwdGlvbjoNCgkJLy8JCUluIG9yZGVyIHRvIHByb3ZpZGUgYSB3aW5kb3duYW1lIHRyYW5zcG9ydCBhY2Nlc3NpYmxlIHJlc291cmNlcy93ZWIgc2VydmljZXMsIGEgc2VydmVyDQoJCS8vIAkJc2hvdWxkIGNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgYSBwYXJhbWV0ZXIgd2luZG93Lm5hbWU9dHJ1ZSBhbmQgaWYgYSByZXF1ZXN0IGluY2x1ZGVzDQoJCS8vIAkJc3VjaCBhIHBhcmFtZXRlciwgaXQgc2hvdWxkIHJlc3BvbmQgdG8gdGhlIHJlcXVlc3Qgd2l0aCBhbiBIVE1MIA0KCQkvLyAJCWRvY3VtZW50IHRoYXQgc2V0cyBpdCdzIHdpbmRvdy5uYW1lIHRvIHRoZSBzdHJpbmcgdGhhdCBpcyB0byBiZSANCgkJLy8gCQlkZWxpdmVyZWQgdG8gdGhlIGNsaWVudC4gRm9yIGV4YW1wbGUsIGlmIGEgY2xpZW50IG1ha2VzIGEgd2luZG93Lm5hbWUgcmVxdWVzdCBsaWtlOg0KCQkvLyAJfAlodHRwOi8vb3RoZXJzaXRlLmNvbS9ncmVldGluZz93aW5kb3duYW1lPXRydWUNCgkJLy8gCQlBbmQgc2VydmVyIHdhbnRzIHRvIHJlc3BvbmQgdG8gdGhlIGNsaWVudCB3aXRoICJIZWxsbyIsIGl0IHNob3VsZCByZXR1cm4gYW4gaHRtbCBwYWdlOg0KCQkvLyB8CTxodG1sPjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCgkJLy8gfAl3aW5kb3cubmFtZT0iSGVsbG8iOw0KCQkvLyB8CTwvc2NyaXB0PjwvaHRtbD4NCgkJLy8gCQlPbmUgY2FuIHByb3ZpZGUgWE1MIG9yIEpTT04gZGF0YSBieSBzaW1wbHkgcXVvdGluZyB0aGUgZGF0YSBhcyBhIHN0cmluZywgYW5kIHBhcnNpbmcgdGhlIGRhdGENCgkJLy8gCQlvbiB0aGUgY2xpZW50Lg0KCQkvLwkJSWYgeW91IHVzZSB0aGUgYXV0aG9yaXphdGlvbiB3aW5kb3cubmFtZSBwcm90b2NvbCwgdGhlIHJlcXVlc3RlciBzaG91bGQgaW5jbHVkZSBhbg0KCQkvLyAJCWF1dGhFbGVtZW50IGVsZW1lbnQgaW4gdGhlIGFyZ3MsIGFuZCBhIHJlcXVlc3Qgd2lsbCBiZSBjcmVhdGVkIGxpa2U6DQoJCS8vIAl8CWh0dHA6Ly9vdGhlcnNpdGUuY29tL2dyZWV0aW5nP3dpbmRvd25hbWU9YXV0aA0KCQkvLyAJCUFuZCB0aGUgc2VydmVyIGNhbiByZXNwb25kIGxpa2UgdGhpczoNCgkJLy8gfAk8aHRtbD48c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCS8vIHwJdmFyIGxvYyA9IHdpbmRvdy5uYW1lOw0KCQkvLyB8CWF1dGhvcml6YXRpb25CdXR0b24ub25jbGljayA9IGZ1bmN0aW9uKCl7CQ0KCQkvLyB8CQl3aW5kb3cubmFtZT0iSGVsbG8iOw0KCQkvLyB8CQlsb2NhdGlvbiA9IGxvYzsNCgkJLy8gfAl9Ow0KCQkvLyB8CTwvc2NyaXB0PjwvaHRtbD4NCgkJLy8JCVdoZW4gdXNpbmcgd2luZG93TmFtZSBmcm9tIGEgWEQgRG9qbyBidWlsZCwgbWFrZSBzdXJlIHRvIHNldCB0aGUgDQoJCS8vIAkJZG9qby5kb2pvQmxhbmtIdG1sVXJsIHByb3BlcnR5IHRvIGEgbG9jYWwgVVJMLg0KCQlhcmdzLnVybCArPSAoYXJncy51cmwubWF0Y2goL1w/LykgPyAnJicgOiAnPycpICsgIndpbmRvd25hbWU9IiArIChhcmdzLmF1dGhFbGVtZW50ID8gImF1dGgiIDogdHJ1ZSk7IC8vIGluZGljYXRlIG91ciBkZXNpcmUgZm9yIHdpbmRvdy5uYW1lIGNvbW11bmljYXRpb24NCgkJdmFyIGF1dGhFbGVtZW50ID0gYXJncy5hdXRoRWxlbWVudDsNCgkJdmFyIGNsZWFudXAgPSBmdW5jdGlvbihyZXN1bHQpew0KCQkJdHJ5ew0KCQkJCS8vIHdlIGhhdmUgdG8gZG8gdGhpcyB0byBzdG9wIHRoZSB3YWl0IGN1cnNvciBpbiBGRiANCgkJCQl2YXIgaW5uZXJEb2MgPSBkZmQuaW9BcmdzLmZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7DQoJCQkJaW5uZXJEb2Mud3JpdGUoIiAiKTsNCgkJCQlpbm5lckRvYy5jbG9zZSgpOw0KCQkJfWNhdGNoKGUpe30NCgkJCShhdXRoRWxlbWVudCB8fCBkb2pvLmJvZHkoKSkucmVtb3ZlQ2hpbGQoZGZkLmlvQXJncy5vdXRlckZyYW1lKTsgLy8gY2xlYW4gdXANCgkJCXJldHVybiByZXN1bHQ7DQoJCX0NCgkJdmFyIGRmZCA9IGRvam8uX2lvU2V0QXJncyhhcmdzLGNsZWFudXAsY2xlYW51cCxjbGVhbnVwKTsNCgkJaWYoYXJncy50aW1lb3V0KXsNCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJaWYoZGZkLmZpcmVkID09IC0xKXsNCgkJCQkJCWRmZC5jYWxsYmFjayhuZXcgRXJyb3IoIlRpbWVvdXQiKSk7DQoJCQkJCX0NCgkJCQl9LA0KCQkJCWFyZ3MudGltZW91dA0KCQkJKTsNCgkJfQ0KCQl2YXIgc2VsZiA9IGRvam94LmlvLndpbmRvd05hbWU7DQoJCWlmKGRvam8uYm9keSgpKXsNCgkJCS8vIHRoZSBET00gaXMgcmVhZHkNCgkJCXNlbGYuX3NlbmQoZGZkLCBtZXRob2QsIGF1dGhFbGVtZW50LCBhcmdzLm9uQXV0aExvYWQpOw0KCQl9ZWxzZXsNCgkJCS8vIHdlIHdpbGwgd2FpdCBmb3IgdGhlIERPTSB0byBiZSByZWFkeSB0byBwcm9jZWVkDQoJCQlkb2pvLmFkZE9uTG9hZChmdW5jdGlvbigpew0KCQkJCXNlbGYuX3NlbmQoZGZkLCBtZXRob2QsIGF1dGhFbGVtZW50LCBhcmdzLm9uQXV0aExvYWQpOw0KCQkJfSk7DQoJCX0NCgkJcmV0dXJuIGRmZDsNCgl9LA0KCV9zZW5kOiBmdW5jdGlvbihkZmQsIG1ldGhvZCwgYXV0aFRhcmdldCwgb25BdXRoTG9hZCl7DQoNCgkJdmFyIGlvQXJncyA9IGRmZC5pb0FyZ3M7DQoJCXZhciBmcmFtZU51bSA9IGRvam94LmlvLndpbmRvd05hbWUuX2ZyYW1lTnVtKys7DQoJCXZhciBzYW1lRG9tYWluVXJsID0gKGRvam8uY29uZmlnLmRvam9CbGFua0h0bWxVcmx8fGRvam8uY29uZmlnLmRvam9DYWxsYmFja1VybHx8ZG9qby5tb2R1bGVVcmwoImRvam8iLCAicmVzb3VyY2VzL2JsYW5rLmh0bWwiKSkgKyAiIyIgKyBmcmFtZU51bTsNCgkJdmFyIGZyYW1lTmFtZSA9IG5ldyBkb2pvLl9Vcmwod2luZG93LmxvY2F0aW9uLCBzYW1lRG9tYWluVXJsKTsNCgkJdmFyIGRvYyA9IGRvam8uZG9jOw0KCQl2YXIgZnJhbWVDb250YWluZXIgPSBhdXRoVGFyZ2V0IHx8IGRvam8uYm9keSgpOw0KCQlmdW5jdGlvbiBzdHlsZUZyYW1lKGZyYW1lKXsNCgkJCWZyYW1lLnN0eWxlLndpZHRoPSIxMDAlIjsNCgkJCWZyYW1lLnN0eWxlLmhlaWdodD0iMTAwJSI7DQoJCQlmcmFtZS5zdHlsZS5ib3JkZXI9IjBweCI7DQoJCX0NCgkJaWYoZG9qby5pc01veiAmJiAhW10ucmVkdWNlKXsNCgkJCS8vIEZGMiBhbGxvd3MgdW5zYWZlIHNpYmxpbmcgZnJhbWUgbW9kaWZpY2F0aW9uLA0KCQkJLy8gdGhlIGZpeCBmb3IgdGhpcyBpcyB0byBjcmVhdGUgbmVzdGVkIGZyYW1lcyB3aXRoIGdldHRlcnMgYW5kIHNldHRlcnMgdG8gcHJvdGVjdCBhY2Nlc3MNCgkJCXZhciBvdXRlckZyYW1lID0gZG9jLmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOw0KCQkJc3R5bGVGcmFtZShvdXRlckZyYW1lKTsNCgkJCWlmKCFhdXRoVGFyZ2V0KXsNCgkJCQlvdXRlckZyYW1lLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KCQkJfQ0KCQkJZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQob3V0ZXJGcmFtZSk7DQoJCQkNCgkJCXZhciBmaXJzdFdpbmRvdyA9IG91dGVyRnJhbWUuY29udGVudFdpbmRvdzsNCgkJCWRvYyA9IGZpcnN0V2luZG93LmRvY3VtZW50Ow0KCQkJZG9jLndyaXRlKCI8aHRtbD48Ym9keSBtYXJnaW49JzBweCc+PGlmcmFtZSBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtib3JkZXI6MHB4JyBuYW1lPSdwcm90ZWN0ZWRGcmFtZSc+PC9pZnJhbWU+PC9ib2R5PjwvaHRtbD4iKTsNCgkJCWRvYy5jbG9zZSgpOw0KCQkJdmFyIHNlY29uZFdpbmRvdyA9IGZpcnN0V2luZG93WzBdOyANCgkJCWZpcnN0V2luZG93Ll9fZGVmaW5lR2V0dGVyX18oMCxmdW5jdGlvbigpe30pOw0KCQkJZmlyc3RXaW5kb3cuX19kZWZpbmVHZXR0ZXJfXygicHJvdGVjdGVkRnJhbWUiLGZ1bmN0aW9uKCl7fSk7DQoJCQlkb2MgPSBzZWNvbmRXaW5kb3cuZG9jdW1lbnQ7DQoJCQlkb2Mud3JpdGUoIjxodG1sPjxib2R5IG1hcmdpbj0nMHB4Jz48L2JvZHk+PC9odG1sPiIpOw0KCQkJZG9jLmNsb3NlKCk7DQoJCQlmcmFtZUNvbnRhaW5lciA9IGRvYy5ib2R5Ow0KCQl9DQoNCiAgICAgICAgLyoqIE9XRiBQQVRDSCB0byBmaXggY3JlYXRlRWxlbWVudCB1c2FnZSBmb3IgSUU5IHN0YW5kYXJkcyBtb2RlICoqLw0KCQkvL3ZhciBmcmFtZSA9IGlvQXJncy5mcmFtZSA9IGZyYW1lID0gZG9jLmNyZWF0ZUVsZW1lbnQoZG9qby5pc0lFID8gJzxpZnJhbWUgc3JjPSJpbml0X3NyYy5odG1sIiBuYW1lPSInICsgZnJhbWVOYW1lICsgJyIgb25sb2FkPSInK2Rvam94Ll9zY29wZU5hbWUrJy5pby53aW5kb3dOYW1lWycrZnJhbWVOdW0rJ10oKSI+JyA6ICdpZnJhbWUnKTsNCgkJdmFyIGZyYW1lID0gaW9BcmdzLmZyYW1lID0gZnJhbWUgPSBkb2MuY3JlYXRlRWxlbWVudChkb2pvLmlzSUUgPCA5ID8gJzxpZnJhbWUgc3JjPSJpbml0X3NyYy5odG1sIiBuYW1lPSInICsgZnJhbWVOYW1lICsgJyIgb25sb2FkPSInK2Rvam94Ll9zY29wZU5hbWUrJy5pby53aW5kb3dOYW1lWycrZnJhbWVOdW0rJ10oKSI+JyA6ICdpZnJhbWUnKTsNCgkJc3R5bGVGcmFtZShmcmFtZSk7DQoJCWlvQXJncy5vdXRlckZyYW1lID0gb3V0ZXJGcmFtZSA9IG91dGVyRnJhbWUgfHwgZnJhbWU7DQoJCWlmKCFhdXRoVGFyZ2V0KXsNCgkJCW91dGVyRnJhbWUuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQoJCX0NCgkJdmFyIHN0YXRlID0gMDsNCgkJZnVuY3Rpb24gZ2V0RGF0YSgpew0KCQkJdmFyIGRhdGEgPSBmcmFtZS5jb250ZW50V2luZG93Lm5hbWU7DQoJCQlpZih0eXBlb2YgZGF0YSA9PSAnc3RyaW5nJyl7DQoJCQkJaWYoZGF0YSAhPSBmcmFtZU5hbWUpew0KCQkJCQlzdGF0ZSA9IDI7IC8vIHdlIGFyZSBkb25lIG5vdw0KCQkJCQlkZmQuaW9BcmdzLmhhc2ggPSBmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uLmhhc2g7DQoJCQkJCWRmZC5jYWxsYmFjayhkYXRhKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJZG9qb3guaW8ud2luZG93TmFtZVtmcmFtZU51bV0gPSBmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbigpew0KCQkJdHJ5ew0KCQkJCWlmKGZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24gPT0nYWJvdXQ6YmxhbmsnKXsNCgkJCQkJLy8gb3BlcmEgYW5kIHNhZmFyaSB3aWxsIGRvIGFuIG9ubG9hZCBmb3IgYWJvdXQ6YmxhbmsgZmlyc3QsIHdlIGNhbiBpZ25vcmUgdGhpcyBmaXJzdCBvbmxvYWQNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCgkJCX1jYXRjaChlKXsNCgkJCQkvLyBpZiB3ZSBhcmUgaW4gdGhlIHRhcmdldCBkb21haW4sIGZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24gd2lsbCB0aHJvdyBhbiBpZ25vcmFibGUgZXJyb3IgDQoJCQl9DQoJCQlpZighc3RhdGUpew0KCQkJCS8vIHdlIGhhdmUgbG9hZGVkIHRoZSB0YXJnZXQgcmVzb3VyY2UsIG5vdyB0aW1lIHRvIG5hdmlnYXRlIGJhY2sgdG8gb3VyIGRvbWFpbiBzbyB3ZSBjYW4gcmVhZCB0aGUgZnJhbWUgbmFtZQ0KCQkJCXN0YXRlPTE7DQoJCQkJaWYoYXV0aFRhcmdldCl7DQoJCQkJCS8vIGNhbGwgdGhlIGNhbGxiYWNrIHNvIGl0IGNhbiBtYWtlIGl0IHZpc2libGUNCgkJCQkJaWYob25BdXRoTG9hZCl7DQoJCQkJCQlvbkF1dGhMb2FkKCk7DQoJCQkJCX0NCgkJCQl9ZWxzZXsNCgkJCQkJLy8gd2UgYXJlIGRvaW5nIGEgc3luY2hyb25vdXMgY2FwdHVyZSwgZ28gZGlyZWN0bHkgdG8gb3VyIHNhbWUgZG9tYWluIFVSTCBhbmQgcmV0cmlldmUgdGhlIHJlc291cmNlDQoJCQkJCWZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24gPSBzYW1lRG9tYWluVXJsOw0KCQkJCX0NCgkJCX0NCgkJCS8vIGJhY2sgdG8gb3VyIGRvbWFpbiwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gYWNjZXNzIHRoZSBmcmFtZSBuYW1lIG5vdw0KCQkJdHJ5ew0KCQkJCWlmKHN0YXRlPDIpew0KCQkJCQlnZXREYXRhKCk7DQoJCQkJfQ0KCQkJfQ0KCQkJY2F0Y2goZSl7DQoJCQl9DQoJCQkNCgkJfTsNCgkJZnJhbWUubmFtZSA9IGZyYW1lTmFtZTsNCgkJaWYobWV0aG9kLm1hdGNoKC9HRVQvaSkpew0KCQkJLy8gaWYgaXQgaXMgYSBHRVQgd2UgY2FuIGp1c3QgdGhlIGlmcmFtZSBvdXIgc3JjIHVybA0KCQkJZG9qby5faW9BZGRRdWVyeVRvVXJsKGlvQXJncyk7DQoJCQlmcmFtZS5zcmMgPSBpb0FyZ3MudXJsOw0KCQkJZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhbWUpOw0KCQkJLy8gQ29tbWVudGVkIHRoZXNlIGxpbmVzIG91dCBmb3IgT1dGLTMxMzE6IFJFU1QgY2FsbHMgZ2V0IGFib3J0ZWQgd2hlbiBNYXJrZXRwbGFjZSB3aWRnZXQgaXMgdXNlZCBpbiBPV0YuDQovLwkJCWlmKGZyYW1lLmNvbnRlbnRXaW5kb3cpew0KLy8JCQkJZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGlvQXJncy51cmwpOw0KLy8JCQl9DQoJCX1lbHNlIGlmKG1ldGhvZC5tYXRjaCgvUE9TVC9pKSl7DQoJCQkvLyBpZiBpdCBpcyBhIFBPU1Qgd2Ugd2lsbCBidWlsZCBhIGZvcm0gdG8gcG9zdCBpdA0KCQkJZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhbWUpOw0KCQkJdmFyIGZvcm0gPSBkb2pvLmRvYy5jcmVhdGVFbGVtZW50KCJmb3JtIik7DQoJCQlkb2pvLmJvZHkoKS5hcHBlbmRDaGlsZChmb3JtKTsNCgkJCXZhciBxdWVyeSA9IGRvam8ucXVlcnlUb09iamVjdChpb0FyZ3MucXVlcnkpOw0KCQkJZm9yKHZhciBpIGluIHF1ZXJ5KXsNCgkJCQl2YXIgdmFsdWVzID0gcXVlcnlbaV07DQoJCQkJdmFsdWVzID0gdmFsdWVzIGluc3RhbmNlb2YgQXJyYXkgPyB2YWx1ZXMgOiBbdmFsdWVzXTsNCgkJCQlmb3IodmFyIGogPSAwOyBqIDwgdmFsdWVzLmxlbmd0aDsgaisrKXsNCgkJCQkJLy8gY3JlYXRlIGhpZGRlbiBpbnB1dHMgZm9yIGFsbCB0aGUgcGFyYW1ldGVycw0KCQkJCQl2YXIgaW5wdXQgPSBkb2MuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCgkJCQkJaW5wdXQudHlwZSA9ICdoaWRkZW4nOw0KCQkJCQlpbnB1dC5uYW1lID0gaTsNCgkJCQkJaW5wdXQudmFsdWUgPSB2YWx1ZXNbal07DQoJCQkJCWZvcm0uYXBwZW5kQ2hpbGQoaW5wdXQpOw0KCQkJCX0NCgkJCX0NCgkJCWZvcm0ubWV0aG9kID0gJ1BPU1QnOw0KCQkJZm9ybS5hY3Rpb24gPSBpb0FyZ3MudXJsOw0KCQkJZm9ybS50YXJnZXQgPSBmcmFtZU5hbWU7Ly8gY29ubmVjdCB0aGUgZm9ybSB0byB0aGUgaWZyYW1lDQoJCQkNCgkJCWZvcm0uc3VibWl0KCk7DQoJCQlmb3JtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZm9ybSk7DQoJCX1lbHNlew0KCQkJdGhyb3cgbmV3IEVycm9yKCJNZXRob2QgIiArIG1ldGhvZCArICIgbm90IHN1cHBvcnRlZCB3aXRoIHRoZSB3aW5kb3dOYW1lIHRyYW5zcG9ydCIpOw0KCQl9DQoJCWlmKGZyYW1lLmNvbnRlbnRXaW5kb3cpew0KCQkJZnJhbWUuY29udGVudFdpbmRvdy5uYW1lID0gZnJhbWVOYW1lOyAvLyBJRSBsaWtlcyBpdCBhZnRlcndhcmRzDQoJCX0NCgl9LA0KCV9mcmFtZU51bTogMCANCgkNCn0NCg0KfQ0KDQppZighZG9qby5faGFzUmVzb3VyY2VbImRvam94LnNlY3VyZS5jYXBhYmlsaXR5Il0peyAvL19oYXNSZXNvdXJjZSBjaGVja3MgYWRkZWQgYnkgYnVpbGQuIERvIG5vdCB1c2UgX2hhc1Jlc291cmNlIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCmRvam8uX2hhc1Jlc291cmNlWyJkb2pveC5zZWN1cmUuY2FwYWJpbGl0eSJdID0gdHJ1ZTsNCmRvam8ucHJvdmlkZSgiZG9qb3guc2VjdXJlLmNhcGFiaWxpdHkiKTsNCg0KZG9qb3guc2VjdXJlLmJhZFByb3BzID0gL15fX3xeKGFwcGx5fGNhbGx8Y2FsbGVlfGNhbGxlcnxjb25zdHJ1Y3RvcnxldmFsfHByb3RvdHlwZXx0aGlzfHVud2F0Y2h8dmFsdWVPZnx3YXRjaCkkfF9fJC87DQpkb2pveC5zZWN1cmUuY2FwYWJpbGl0eSA9IHsNCglrZXl3b3JkczogWyJicmVhayIsICJjYXNlIiwgImNhdGNoIiwgImNvbnN0IiwgImNvbnRpbnVlIiwiZGVidWdnZXIiLCAiZGVmYXVsdCIsICJkZWxldGUiLCAiZG8iLA0KCQkgImVsc2UiLCAiZW51bSIsImZhbHNlIiwgImZpbmFsbHkiLCAiZm9yIiwgImZ1bmN0aW9uIiwiaWYiLCAiaW4iLCAiaW5zdGFuY2VvZiIsICJuZXciLCANCgkJICJudWxsIiwieWllbGQiLCJyZXR1cm4iLCAic3dpdGNoIiwgIA0KCQkgInRocm93IiwgInRydWUiLCAidHJ5IiwgInR5cGVvZiIsICJ2YXIiLCAidm9pZCIsICJ3aGlsZSJdLA0KCXZhbGlkYXRlIDogZnVuY3Rpb24oLypzdHJpbmcqL3NjcmlwdCwvKkFycmF5Ki9zYWZlTGlicmFyaWVzLC8qT2JqZWN0Ki9zYWZlR2xvYmFscykgew0KCQkvLyBzdW1tYXJ5Og0KCQkvLyAJCXBhc3MgaW4gdGhlIHRleHQgb2YgYSBzY3JpcHQuIElmIGl0IHBhc3NlcyBhbmQgaXQgY2FuIGJlIGV2YWwnZWQsIGl0IHNob3VsZCBiZSBzYWZlLiANCgkJLy8gCQlOb3RlIHRoYXQgdGhpcyBkb2VzIG5vdCBkbyBmdWxsIHN5bnRheCBjaGVja2luZywgaXQgcmVsaWVzIG9uIGV2YWwgdG8gcmVqZWN0IGludmFsaWQgc2NyaXB0cy4NCgkJLy8gCQlUaGVyZSBhcmUgYWxzbyBrbm93biBmYWxzZSByZWplY3Rpb25zOg0KCQkvLyAJCQlOZXN0aW5nIHZhcnMgaW5zaWRlIGJsb2NrcyB3aWxsIG5vdCBkZWNsYXJlIHRoZSB2YXJpYWJsZSBmb3IgdGhlIG91dGVyIGJsb2NrDQoJCS8vIAkgCQlOYW1lZCBmdW5jdGlvbnMgYXJlIG5vdCB0cmVhdGVkIGFzIGRlY2xhcmF0aW9uIHNvIHRoZXkgYXJlIGdlbmVyYWxseSBub3QgYWxsb3dlZCB1bmxlc3MgdGhlIG5hbWUgaXMgZGVjbGFyZWQgd2l0aCBhIHZhci4JDQoJCS8vCQkJVmFyIGRlY2xhcmF0aW9uIHRoYXQgaW52b2x2ZSBtdWx0aXBsZSBjb21tYSBkZWxpbWl0ZWQgdmFyaWFibGUgYXNzaWdubWVudHMgYXJlIG5vdCBhY2NlcHRlZA0KCQkvLw0KCQkvLyBzY3JpcHQ6DQoJCS8vIAkJIHRoZSBzY3JpcHQgdG8gZXhlY3V0ZQ0KCQkvLw0KCQkvLyBzYWZlTGlicmFyaWVzOg0KCQkvLyAJCVRoZSBzYWZlIGxpYnJhcmllcyB0aGF0IGNhbiBiZSBjYWxsZWQgKHRoZSBmdW5jdGlvbnMgY2FuIG5vdCBiZSBhY2Nlc3MvbW9kaWZpZWQgYnkgdGhlIHVudHJ1c3RlZCBjb2RlLCBvbmx5IGNhbGxlZCkgDQoJCS8vDQoJCS8vIHNhZmVHbG9iYWxzOg0KCQkvLyAJCVRoZXNlIGdsb2JhbHMgY2FuIGJlIGZyZWVseSBpbnRlcmFjdGVkIHdpdGggYnkgdGhlIHVudHJ1c3RlZCBjb2RlDQoJCQ0KCQ0KCQl2YXIga2V5d29yZHMgPSB0aGlzLmtleXdvcmRzOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGtleXdvcmRzLmxlbmd0aDsgaSsrKSB7DQoJCQlzYWZlR2xvYmFsc1trZXl3b3Jkc1tpXV09dHJ1ZTsNCgkJfQ0KCQl2YXIgYmFkVGhpcyA9ICJ8dGhpc3wga2V5d29yZCBpbiBvYmplY3QgbGl0ZXJhbCB3aXRob3V0IGEgQ2xhc3MgY2FsbCI7DQoJCXZhciBibG9ja3MgPSBbXTsgLy8ga2VlcHMgdHJhY2sgb2YgdGhlIG91dGVyIHJlZmVyZW5jZXMgZnJvbSBlYWNoIGlubmVyIGJsb2NrDQoJCWlmKHNjcmlwdC5tYXRjaCgvW1x1MjAwYy1cdTIwMGZcdTIwMmEtXHUyMDJlXHUyMDZhLVx1MjA2Zlx1ZmYwMC1cdWZmZmZdLykpew0KCQkJdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIHVuaWNvZGUgY2hhcmFjdGVycyBkZXRlY3RlZCIpOw0KCQl9DQoJCWlmKHNjcmlwdC5tYXRjaCgvXC9cKkBjY19vbi8pKXsNCgkJCXRocm93IG5ldyBFcnJvcigiQ29uZGl0aW9uYWwgY29tcGlsYXRpb24gdG9rZW4gaXMgbm90IGFsbG93ZWQiKTsNCgkJfQ0KCQlzY3JpcHQgPSBzY3JpcHQucmVwbGFjZSgvXFxbIidcXFwvYmZucnR1XS9nLCAnQCcpLiAvLyBib3Jyb3dzIHNvbWUgdHJpY2tzIGZyb20ganNvbi5qcw0KCQkJLy8gbm93IGNsZWFyIGxpbmUgY29tbWVudHMsIGJsb2NrIGNvbW1lbnRzLCByZWd1bGFyIGV4cHJlc3Npb25zLCBhbmQgc3RyaW5ncy4NCgkJCS8vIEJ5IGRvaW5nIGl0IGFsbCBhdCBvbmNlLCB0aGUgcmVndWxhciBleHByZXNzaW9uIHVzZXMgbGVmdCB0byByaWdodCBwYXJzaW5nLCBhbmQgdGhlIG1vc3QNCgkJCS8vIGxlZnQgdG9rZW4gaXMgcmVhZCBmaXJzdC4gSXQgaXMgYWxzbyBtb3JlIGNvbXBhY3QuDQoJCQlyZXBsYWNlKC9cL1wvLip8XC9cKltcd1xXXSo/XCpcL3xcLyhcXFtcL1xcXXxbXipcL10pKFxcLnxbXlwvXG5cXF0pKlwvW2dpbV0qfCgiW14iXSoiKXwoJ1teJ10qJykvZyxmdW5jdGlvbih0KSB7DQoJCQkJcmV0dXJuIHQubWF0Y2goL15cL1wvfF5cL1wqLykgPyAnICcgOiAnMCc7IC8vIGNvbW1lbnRzIGFyZSByZXBsYWNlZCB3aXRoIGEgc3BhY2UsIHN0cmluZ3MgYW5kIHJlZ2V4IGFyZSByZXBsYWNlZCB3aXRoIGEgc2luZ2xlIHNhZmUgdG9rZW4gKDApDQoJCQl9KS4NCgkJCXJlcGxhY2UoL1wuXHMqKFthLXpcJF9BLVpdW1x3XCRfXSopfChbOyx7XSlccyooW2EtelwkX0EtWl1bXHdcJF9dKlxzKik6L2csZnVuY3Rpb24odCxwcm9wLHByZWZpeCxrZXkpIHsgDQoJCQkJLy8gZmluZCBhbGwgdGhlIGRvdCBwcm9wZXJ0eSByZWZlcmVuY2VzLCBhbGwgdGhlIG9iamVjdCBsaXRlcmFsIGtleXMsIGFuZCBsYWJlbHMNCgkJCQlwcm9wID0gcHJvcCB8fCBrZXk7IA0KCQkJCWlmKC9eX198XihhcHBseXxjYWxsfGNhbGxlZXxjYWxsZXJ8Y29uc3RydWN0b3J8ZXZhbHxwcm90b3R5cGV8dGhpc3x1bndhdGNofHZhbHVlT2Z8d2F0Y2gpJHxfXyQvLnRlc3QocHJvcCkpew0KCQkJCQl0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgcHJvcGVydHkgbmFtZSAiICsgcHJvcCk7DQoJCQkJfQ0KCQkJCXJldHVybiAocHJlZml4ICYmIChwcmVmaXggKyAiMDoiKSkgfHwgJ34nOyAvLyByZXBsYWNlIGxpdGVyYWwga2V5cyB3aXRoIDA6IGFuZCByZXBsYWNlIHByb3BlcnRpZXMgd2l0aCB0aGUgaW5ub2N1b3VzIH4NCgkJCX0pOw0KCQlzY3JpcHQucmVwbGFjZSgvKFteXFtdW1xdXH1dXHMqPSl8KChcV3JldHVybnxcUylccypcW1xzKlwrPyl8KFtePSFdWz0hXT1bXj1dKS9nLGZ1bmN0aW9uKG9wZXIpIHsvLyBjaGVjayBmb3IgaWxsZWdhbCBvcGVyYXRvciB1c2FnZXMNCgkJCWlmKCFvcGVyLm1hdGNoKC8oKFxXcmV0dXJufFs9XCZcfFw6XD9cLF0pXHMqXFspfFxbXHMqXCskLykpeyAvLyB0aGUgd2hpdGVsaXN0IGZvciBbIG9wZXJhdG9yIGZvciBhcnJheSBpbml0aWFsaXplciBjb250ZXh0IG9yIFsrbnVtXSBzeW50YXgNCgkJCQl0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgb3BlcmF0b3IgIiArIG9wZXIuc3Vic3RyaW5nKDEpKTsNCgkJCX0NCgkJfSk7DQoJCXNjcmlwdCA9IHNjcmlwdC5yZXBsYWNlKG5ldyBSZWdFeHAoIigiICsgc2FmZUxpYnJhcmllcy5qb2luKCJ8IikgKyAiKVtcXHN+XSpcXCgiLCJnIiksZnVuY3Rpb24oY2FsbCkgeyAvLyBmaW5kIGxpYnJhcnkgY2FsbHMgYW5kIG1ha2UgdGhlbSBsb29rIHNhZmUNCgkJCXJldHVybiAibmV3KCI7IC8vIHR1cm4gaW50byBhIGtub3duIHNhZmUgY2FsbCANCgkJfSk7DQoJCWZ1bmN0aW9uIGZpbmRPdXRlclJlZnMoYmxvY2ssZnVuYykgew0KCQkJdmFyIG91dGVyUmVmcyA9IHt9Ow0KCQkJYmxvY2sucmVwbGFjZSgvI1xkKy9nLGZ1bmN0aW9uKGIpIHsgLy8gZ3JhZnQgaW4gdGhlIG91dGVyIHJlZmVyZW5jZXMgZnJvbSB0aGUgaW5uZXIgc2NvcGVzDQoJCQkJdmFyIHJlZnMgPSBibG9ja3NbYi5zdWJzdHJpbmcoMSldOw0KCQkJCWZvciAodmFyIGkgaW4gcmVmcykgew0KCQkJCQlpZihpID09IGJhZFRoaXMpIHsNCgkJCQkJCXRocm93IGk7DQoJCQkJCX0NCgkJCQkJaWYoaSA9PSAndGhpcycgJiYgcmVmc1snOm1ldGhvZCddICYmIHJlZnNbJ3RoaXMnXSA9PSAxKSB7DQoJCQkJCQkvLyBpZiB3ZSBhcmUgaW4gYW4gb2JqZWN0IGxpdGVyYWwgdGhlIGZ1bmN0aW9uIG1heSBiZSBhIGJpbmRhYmxlIG1ldGhvZCwgdGhpcyBtdXN0IG9ubHkgYmUgaW4gdGhlIGxvY2FsIHNjb3BlDQoJCQkJCQlpID0gYmFkVGhpczsNCgkJCQkJfQ0KCQkJCQlpZihpICE9ICc6bWV0aG9kJyl7DQoJCQkJCQlvdXRlclJlZnNbaV0gPSAyOyAvLyB0aGUgcmVmZXJlbmNlIGlzIG1vcmUgdGhhbiBqdXN0IGxvY2FsDQoJCQkJCX0NCgkJCQl9DQoJCQl9KTsNCgkJCWJsb2NrLnJlcGxhY2UoLyhcV3xeKShbYS16X1wkQS1aXVtcd19cJF0qKS9nLGZ1bmN0aW9uKHQsYSxpZGVudGlmaWVyKSB7IC8vIGZpbmQgYWxsIHRoZSBpZGVudGlmaWVycw0KCQkJCWlmKGlkZW50aWZpZXIuY2hhckF0KDApPT0nXycpew0KCQkJCQl0aHJvdyBuZXcgRXJyb3IoIk5hbWVzIG1heSBub3Qgc3RhcnQgd2l0aCBfIik7DQoJCQkJfQ0KCQkJCW91dGVyUmVmc1tpZGVudGlmaWVyXSA9IDE7DQoJCQl9KTsNCgkJCXJldHVybiBvdXRlclJlZnM7DQoJCX0JDQoJCXZhciBuZXdTY3JpcHQsb3V0ZXJSZWZzOw0KCQlmdW5jdGlvbiBwYXJzZUJsb2NrKHQsZnVuYyxhLGIscGFyYW1zLGJsb2NrKSB7DQoJCQlibG9jay5yZXBsYWNlKC8oXnwsKTA6XHMqZnVuY3Rpb24jKFxkKykvZyxmdW5jdGlvbih0LGEsYikgeyAvLyBmaW5kIGZ1bmN0aW9ucyBpbiBvYmplY3QgbGl0ZXJhbHMNCgkJCS8vIG5vdGUgdGhhdCBpZiBuYW1lZCBmdW5jdGlvbnMgYXJlIGFsbG93ZWQsIGl0IGNvdWxkIGJlIHBvc3NpYmxlIHRvIGhhdmUgbGFiZWw6IGZ1bmN0aW9uIG5hbWUoKSB7fSB3aGljaCBpcyBhIHNlY3VyaXR5IGJyZWFjaA0KCQkJCQl2YXIgcmVmcyA9IGJsb2Nrc1tiXTsgDQoJCQkJCXJlZnNbJzptZXRob2QnXSA9IDE7Ly9tYXJrIGl0IGFzIGEgbWV0aG9kDQoJCQl9KTsNCgkJCWJsb2NrID0gYmxvY2sucmVwbGFjZSgvKF58W15fXHdcJF0pQ2xhc3NccypcKFxzKihbX1x3XCRdK1xzKixccyopKiMoXGQrKS9nLGZ1bmN0aW9uKHQscCxhLGIpIHsgLy8gZmluZCBDbGFzcyBjYWxscw0KCQkJCQl2YXIgcmVmcyA9IGJsb2Nrc1tiXTsNCgkJCQkJZGVsZXRlIHJlZnNbYmFkVGhpc107DQoJCQkJCXJldHVybiAocHx8JycpICsgKGF8fCcnKSArICIjIiArIGI7DQoJCQl9KTsNCgkJCW91dGVyUmVmcyA9IGZpbmRPdXRlclJlZnMoYmxvY2ssZnVuYyk7IC8vIGZpbmQgdGhlIHZhcmlhYmxlcyBpbiB0aGlzIGJsb2NrDQoJCQlmdW5jdGlvbiBwYXJzZVZhcnModCxhLGIsZGVjbCkgeyAvLyBmaW5kIHZhciBkZWNscw0KCQkJCWRlY2wucmVwbGFjZSgvLD8oW2EtelwkQS1aXVtfXHdcJF0qKS9nLGZ1bmN0aW9uKHQsaWRlbnRpZmllcikgew0KCQkJCQlpZihpZGVudGlmaWVyID09ICdDbGFzcycpew0KCQkJCQkJdGhyb3cgbmV3IEVycm9yKCJDbGFzcyBpcyByZXNlcnZlZCIpOw0KCQkJCQl9DQoJCQkJCWRlbGV0ZSBvdXRlclJlZnNbaWRlbnRpZmllcl07IC8vIG91dGVyIHJlZmVyZW5jZSBpcyBzYWZlbHkgcmVmZXJlbmNlZCBoZXJlDQoJCQkJfSk7DQoJCQl9DQoJCQkNCgkJCWlmKGZ1bmMpIHsNCgkJCQlwYXJzZVZhcnModCxhLGEscGFyYW1zKTsgLy8gdGhlIHBhcmFtZXRlcnMgYXJlIGRlY2xhcmUgdmFyaWFibGVzDQoJCQl9DQoJCQlibG9jay5yZXBsYWNlKC8oXFd8XikodmFyKSAoWyBcdCxfXHdcJF0rKS9nLHBhcnNlVmFycyk7IC8vIGFuZCB2YXJzIGRlY2xhcmUgdmFyaWFibGVzDQoJCQkvLyBGSVhNRTogR2l2ZSBuYW1lZCBmdW5jdGlvbnMgI25hbWUgc3ludGF4IHNvIHRoZXkgY2FuIGJlIGRldGVjdGVkIGFzIHZhcnMgaW4gb3V0ZXIgc2NvcGVzIChidXQgYmUgY2FyZWZ1bCBvZiBuZXN0aW5nKQ0KCQkJcmV0dXJuIChhIHx8ICcnKSArIChiIHx8ICcnKSArICIjIiArIChibG9ja3MucHVzaChvdXRlclJlZnMpLTEpOyAvLyByZXR1cm4gYSBibG9jayByZWZlcmVuY2Ugc28gdGhlIG91dGVyIGJsb2NrIGNhbiBmZXRjaCBpdCANCgkJfQkNCgkJZG8gew0KCQkJLy8gZ2V0IGFsbCB0aGUgYmxvY2tzLCBzdGFydGluZyB3aXRoIGluc2lkZSBhbmQgbW92aW5nIG91dCwgY2FwdHVyaW5nIHRoZSBwYXJhbWV0ZXJzIG9mIGZ1bmN0aW9ucyBhbmQgY2F0Y2hzIGFzIHZhcmlhYmxlcyBhbG9uZyB0aGUgd2F5DQoJCQluZXdTY3JpcHQgPSBzY3JpcHQucmVwbGFjZSgvKChmdW5jdGlvbnxjYXRjaCkoXHMrW19cd1wkXSspP1xzKlwoKFteXCldKilcKVxzKik/eyhbXnt9XSopfS9nLCBwYXJzZUJsb2NrKTsgDQoJCX0NCgkJd2hpbGUobmV3U2NyaXB0ICE9IHNjcmlwdCAmJiAoc2NyaXB0ID0gbmV3U2NyaXB0KSk7IC8vIGtlZXAgZ29pbmcgdW50aWwgd2UgY2FuJ3QgZmluZCBhbnltb3JlIGJsb2Nrcw0KCQlwYXJzZUJsb2NrKDAsMCwwLDAsMCxzY3JpcHQpOyAvL2ZpbmRPdXRlclJlZnMoc2NyaXB0KTsgLy8gZmluZCB0aGUgcmVmZXJlbmNlcyBpbiB0aGUgb3V0c2lkZSBzY29wZQ0KCQlmb3IgKGkgaW4gb3V0ZXJSZWZzKSB7DQoJCQlpZighKGkgaW4gc2FmZUdsb2JhbHMpKSB7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIHJlZmVyZW5jZSB0byAiICsgaSk7DQoJCQl9DQoJCX0NCgkJDQoJfQ0KfTsNCg0KfQ0KDQoJLy9JTlNFUlQgZG9qby5pMThuLl9wcmVsb2FkTG9jYWxpemF0aW9ucyBIRVJFDQoNCgkvL0NoZWNrIGlmIGRvY3VtZW50IGFscmVhZHkgY29tcGxldGUsIGFuZCBpZiBzbywganVzdCB0cmlnZ2VyIHBhZ2UgbG9hZA0KCS8vbGlzdGVuZXJzLiBOT1RFOiBkb2VzIG5vdCB3b3JrIHdpdGggRmlyZWZveCBiZWZvcmUgMy42LiBUbyBzdXBwb3J0DQoJLy90aG9zZSBicm93c2Vycywgc2V0IGRqQ29uZmlnLmFmdGVyT25Mb2FkID0gdHJ1ZSB3aGVuIHlvdSBrbm93IERvam8gaXMgYWRkZWQNCgkvL2FmdGVyIHBhZ2UgbG9hZC4gVXNpbmcgYSB0aW1lb3V0IHNvIHRoZSByZXN0IG9mIHRoaXMNCgkvL3NjcmlwdCBnZXRzIGV2YWx1YXRlZCBwcm9wZXJseS4gVGhpcyB3b3JrIG5lZWRzIHRvIGhhcHBlbiBhZnRlciB0aGUNCgkvL2Rvam8uY29uZmlnLnJlcXVpcmUgd29yayBkb25lIGluIGRvam8uX2Jhc2UuDQoJaWYoZG9qby5pc0Jyb3dzZXIgJiYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgfHwgZG9qby5jb25maWcuYWZ0ZXJPbkxvYWQpKXsNCgkJd2luZG93LnNldFRpbWVvdXQoZG9qby5fbG9hZEluaXQsIDEwMCk7DQoJfQ0KfSkoKTsNCg0KCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsNCi8qKg0KICogQGlnbm9yZQ0KICovDQpPem9uZS51dGlsID0gT3pvbmUudXRpbCB8fCB7fTsNCi8qKg0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS51dGlsLnBhZ2VMb2FkID0gT3pvbmUudXRpbC5wYWdlTG9hZCB8fCB7fTsNCg0KLyoqDQogKiBAZmllbGQNCiAqIEBkZXNjcmlwdGlvbiBlbmFibGUgb3IgZGlzYWJsZSB0aGUgYXV0b21hdGljIHNlbmRpbmcgb2YgbG9hZHRpbWUNCiAqLw0KT3pvbmUudXRpbC5wYWdlTG9hZC5hdXRvU2VuZCA9IHRydWU7DQoNCi8qKg0KICogQGZpZWxkDQogKiBAZGVzY3JpcHRpb24gaG9sZHMgdGhlIGN1cnJlbnQgZGF0ZSB0aW1lLCBiZWZvcmUgdGhlIG9ubG9hZCBvZiB0aGUgd2lkZ2V0DQogKi8NCk96b25lLnV0aWwucGFnZUxvYWQuYmVmb3JlTG9hZCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7DQoNCi8qKg0KICogQGZpZWxkDQogKiBAZGVzY3JpcHRpb24gaG9sZHMgY3VycmVudCBkYXRlIHRpbWUgYWZ0ZXIgdGhlIG9ubG9hZCBvZiB0aGUgd2lkZ2V0LiAgdGhpcyB2YWx1ZSB3aWxsIGJlIHNldCBhZnRlciBvbmxvYWQNCiAqLw0KT3pvbmUudXRpbC5wYWdlTG9hZC5hZnRlckxvYWQgPSBudWxsOw0KDQoNCk96b25lLnV0aWwucGFnZUxvYWQuY2FsY0xvYWRUaW1lID0gZnVuY3Rpb24odGltZSkgew0KICAvKioNCiAgICogQGZpZWxkDQogICAqIEBkZXNjcmlwdGlvbiBIb2xkcyB0aGUgbG9hZCB0aW1lIG9mIHRoZSB3aWRnZXQuICBUaGlzIG1heSBiZSBhbHRlcmVkIHRvIGFsbG93IHRoZSB3aWRnZXQgdG8gZGV0ZXJtaW5lIGl0J3MgbG9hZCB0aW1lLg0KICAgKiAgIGxvYWRUaW1lIGlzIHNlbnQgdmlhIHRoZSBFdmVudGluZyBBUEksIGlmIGFsdGVyaW5nIHRoaXMgdmFsdWUgZG8gc28gYmVmb3JlIEV2ZW50aW5nIGlzIGluaXRpYWxpemVkDQogICAqLw0KICBPem9uZS51dGlsLnBhZ2VMb2FkLmxvYWRUaW1lID0gKHRpbWUgIT0gbnVsbCA/IHRpbWUgOiBPem9uZS51dGlsLnBhZ2VMb2FkLmFmdGVyTG9hZCkgLSBPem9uZS51dGlsLnBhZ2VMb2FkLmJlZm9yZUxvYWQ7DQogIHJldHVybiBPem9uZS51dGlsLnBhZ2VMb2FkLmxvYWRUaW1lOw0KfTsNCgp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsNCk96b25lLnZlcnNpb24gPSBPem9uZS52ZXJzaW9uIHx8IHt9Ow0KDQpPem9uZS52ZXJzaW9uID0gew0KDQogICAgb3dmdmVyc2lvbjogJzcuMC4xLUdBJywNCg0KICAgIG1wdmVyc2lvbjogJzIuMycsDQoNCiAgICBwcmVmZXJlbmNlOiAnLXYxJywNCg0KICAgIGV2ZW50aW5nOiAnLXYxJywNCg0KICAgIHdpZGdldExhdW5jaGVyOiAnLXYxJywNCg0KICAgIHN0YXRlOiAnLXYxJywNCg0KICAgIGRyYWdBbmREcm9wOiAnLXYxJywNCg0KICAgIHdpZGdldENocm9tZTogJy12MScsDQoNCiAgICBsb2dnaW5nOiAnLXYxJywNCg0KICAgIGxhbmd1YWdlOiAnLXYxJw0KDQp9Ow0KCi8qKgogKiBAaWdub3JlCiAqLwp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsKT3pvbmUudXRpbCA9IE96b25lLnV0aWwgfHwge307Ck96b25lLnV0aWwuZm9ybUZpZWxkID0gT3pvbmUudXRpbC5mb3JtRmllbGQgfHwge307Ck96b25lLmNvbmZpZyA9IE96b25lLmNvbmZpZyB8fCB7fTsKCi8qKgogKiBAcHJpdmF0ZQogKiAKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBzZWUgaWYgYSBzcGVjZmljIHVybCBpcyB0aGUgc2FtZQogKiBhcyB0aGUgbG9jYWwgdXJsLiAgQ2FuIGJlIHVzZWQgdG8gdGVzdCBpZiBBSkFYIGNhbiBiZSB1c2VkLiAgSWYgdXJsCiAqIGlzIG5vdCBhIFVSTCwgaXQncyBhc3N1bWVkIHRvIGJlIGEgcmVsYXRpdmUgZmlsZW5hbWUsIHNvIHRoaXMgZnVuY3Rpb24KICogcmV0dXJucyB0cnVlLgogKgogKiBAcGFyYW0ge1N0cmluZ30gdXJsIFN0cmluZyB0aGF0IHlvdSB3YW50IHRvIGNoZWNrIHRvIHNlZSBpZiBpdHMgbG9jYWwuCiAqCiAqIEByZXR1cm5zIEJvb2xlYW4KICoKICogQHRocm93cyAiTm90IGEgdmFsaWQgVVJMIiBpZiB0aGUgcGFyYW1ldGVyIGlzIG5vdCBhIHZhbGlkIHVybAogKi8KT3pvbmUudXRpbC5pc1VybExvY2FsID0gZnVuY3Rpb24odXJsKSB7CgogICAgdmFyIHdlYkNvbnRleHRQYXRoID0gT3pvbmUudXRpbC5jb250ZXh0UGF0aCgpOwoKICAgIC8vYXBwZW5kIGxhc3QgJy8nIHRoaXMgdmFsdWUgc2hvdWxkIG5ldmVyIGJlIG51bGwKICAgIGlmICh3ZWJDb250ZXh0UGF0aCAhPSAnJyAmJiB3ZWJDb250ZXh0UGF0aCAhPSBudWxsKSB7CiAgICAgICAgd2ViQ29udGV4dFBhdGggKz0gJy8nOwogICAgfQoKICAgIC8vdGhpcyByZWdleCBtYXRjaGVzIHVybHMgYWdhaW5zdCB0aGUgY29uZmlndXJlZCB3ZWJjb250ZXh0IHBhdGggaHR0cHM6Ly88Y29udGV4dFBhdGg+Ly4uLi4uCiAgICAvL29ubHkgb25lIG1hdGNoIGlzIHBvc3NpYmxlIHNpbmNlIHRoaXMgcmVnZXggbWF0Y2hlcyBmcm9tIHRoZSBzdGFydCBvZiB0aGUgc3RyaW5nCiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCJeKGh0dHBzPzopLy8oW14vOl0rKTo/KC4qKSIgKyB3ZWJDb250ZXh0UGF0aCk7CiAgICB2YXIgc2VydmVyID0gdXJsLm1hdGNoKHJlZ2V4KTsKCiAgICAvL2NoZWNrIGlmIHRoaXMgbWlnaHQgYmUgYSByZWxhdGl2ZSB1cmwgCiAgICBpZiAoIXNlcnZlcikgewogICAgICAgIGlmICh1cmwubWF0Y2gobmV3IFJlZ0V4cCgnXmh0dHBzPzpcL1wvJykpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICB2YXIgcG9ydCA9IHdpbmRvdy5sb2NhdGlvbi5wb3J0Oy8vIHx8ICggd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAiaHR0cHM6IiA/ICI0NDMiIDogIjgwIiApCgogICAgLy90b2RvIG5lZWQgdG8gZmluZCBhIGJldHRlciB3YXkgb2YgY2hlY2tpbmcgc2FtZSBkb21haW4gcmVxdWVzdHMKICAgIC8vIHNlZSBpZiBzb2x1dGlvbiBwb3N0ZWQgaGVyZSB3b3JrczogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NDA0NzkzL2NoZWNrLWlmLXNhbWUtb3JpZ2luLXBvbGljeS1hcHBsaWVzCiAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSBzZXJ2ZXJbMV0gJiYgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBzZXJ2ZXJbMl0gJiYgcG9ydCA9PT0gc2VydmVyWzNdCn07CgovKioKICogQHByaXZhdGUKICoKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIHdpbGwgY29udmVydCBhIHN0cmluZyBpbnRvIGEganNvbiBvYmplY3QuICBUaGVyZSBpcyBhIGNoZWNrCiAqIGRvbmUgdG8gZW5zdXJlIG5vIHVuc2FmZSBqc29uIGlzIGluY2x1ZGVkLgogKgogKiBAcGFyYW0ge1N0cmluZ30gc3RyIFN0cmluZyB0aGF0IHJlcHJlc2VudHMgYSBqc29uIG9iamVjdAogKgogKiBAcmV0dXJucyB7T2JqZWN0fSBqc29uIG9iamVjdAogKgogKiBAdGhyb3dzIEVycm9yIGlmIHBhcmFtZXRlciBpcyBub3QgYSBzdHJpbmcKICogQHRocm93cyBFcnJvciBpZiBzZWN1cmUgY2hlY2sgZmluZHMgdW5zYWZlIEpTT04KICogQHRocm93cyBFcnJvciBpZiB0aGVyZSBpcyBhbiBpc3N1ZSBjb252ZXJ0aW5nIHRvIEpTT04KICoKICogQHJlcXVpcmVzIGRvam94LnNlY3VyZS5jYXBhYmlsaXR5CiAqIEByZXF1aXJlcyBkb2pvIGJhc2UKICovCk96b25lLnV0aWwucGFyc2VKc29uID0gZnVuY3Rpb24oc3RyKSB7CiAgICBpZiAodHlwZW9mKHN0cikgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgb3dmZG9qb3guc2VjdXJlLmNhcGFiaWxpdHkudmFsaWRhdGUoc3RyLFtdLHt9KTsgLy8gd2lsbCBlcnJvciBpZiB0aGVyZSBpcyB1bnNhZmUgSlNPTgogICAgICAgIHZhciB4ID0gb3dmZG9qby5mcm9tSnNvbihzdHIpOwogICAgICAgIHJldHVybiB4OwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyAiT3pvbmUudXRpbC5wYXJzZUpzb24gZXhwZWN0ZWQgYSBzdHJpbmcsIGJ1dCBkaWRuJ3QgZ2V0IG9uZSI7CiAgICB9Cn07CgovKioKICogQHByaXZhdGUKICovCk96b25lLnV0aWwuSFRNTEVuY29kZVJlc2VydmVkSlMgPSBmdW5jdGlvbihzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCAiJiMzOTsiKTsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKiAKICogQGRlc2NyaXB0aW9uIFNpbWlsYXIgdG8gRXh0LnV0aWwuRm9ybWF0Lmh0bWxFbmNvZGUgZXhjZXB0IHRoaXMgbWV0aG9kIGFsc28gaGFuZGxlcyB0aGUgc2luZ2xlIHF1b3RlCiAqLwpPem9uZS51dGlsLkhUTUxFbmNvZGUgPSBmdW5jdGlvbihzdHIpewogICAgcmV0dXJuICFzdHIgPyBzdHIgOiBTdHJpbmcoc3RyKS5yZXBsYWNlKC8mL2csICImYW1wOyIpLnJlcGxhY2UoLz4vZywgIiZndDsiKS5yZXBsYWNlKC88L2csICImbHQ7IikucmVwbGFjZSgvIi9nLCAiJnF1b3Q7IikucmVwbGFjZSgvJy9nLCAiJiMzOTsiKTsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKgogKiBDb25zdHJ1Y3RpdmVseSBjbGVhcnMgdGhlIGVudGlyZSBhcnJheQogKi8KT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNvbmZpZ1BhcmFtcyA9IG51bGw7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewoKICAgIC8vaWYgYWxyZWFkeSBwYXJzZWQganVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICBpZiAoY29uZmlnUGFyYW1zKSByZXR1cm4gY29uZmlnUGFyYW1zOwoKICAgIC8vcGFyc2Ugb3V0IHRoZSBjb25maWcKICAgIHRyeSB7CiAgICAgIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VKc29uKAogICAgICAgICAgICAgIHdpbmRvdy5uYW1lCiAgICAgICk7CiAgICAgIHJldHVybiBjb25maWdQYXJhbXM7CiAgICB9CiAgICBjYXRjaCAoZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9Cn0oKTsKCgovKioKICogQHByaXZhdGUKICoKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIGN1cnJlbnQgY29udGV4dCBwYXRoIGJ5CiAqIGNhbGxpbmcgYSBjb250cm9sbGVyIGF0IHRoZSBzZXJ2ZXIgKHdpbGwgbm90CiAqIG1ha2UgdGhlIGNhbGwgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiBkb25lKS4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBvIHVudXNlZAogKgogKiBAcmV0dXJucyBjb250ZXh0IHBhdGggd2l0aCBsZWFkaW5nIHNsYXNoCiAqICAgICAgICAgIChleC4gIi9vd2YiKQogKgogKiBAcmVxdWlyZXMgRXh0IGJhc2UsIGRvam8KICovCk96b25lLnV0aWwuY29udGV4dFBhdGggPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgY29uZmlnUGFyYW1zID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCksCiAgICAgICAgY29udGV4dFBhdGggPSBPem9uZS5jb25maWcud2ViQ29udGV4dFBhdGg7CgogICAgaWYgKGNvbmZpZ1BhcmFtcyAmJiBjb25maWdQYXJhbXMud2ViQ29udGV4dFBhdGgpIHsKICAgICAgICBjb250ZXh0UGF0aCA9IE96b25lLmNvbmZpZy53ZWJDb250ZXh0UGF0aCA9IGNvbmZpZ1BhcmFtcy53ZWJDb250ZXh0UGF0aDsKICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBjb250ZXh0UGF0aCB8fCAnJzsKICAgIH0KfSkoKTsKCi8qKgogKiBAcHJpdmF0ZQogKiAKICogQGRlc2NyaXB0aW9uIENoZWNrcyB3aGV0aGVyIHRoZSB1cmwgY29udGV4dCBpcyBsb2NhbCBvciBub3QsCiAqIHRoZW4gcmV0dXJucyB0aGUgdmFsaWQgdXJsIHcvIGNvbnRleHQuCiAqIAogKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgdGhlIHVybAogKiBAcGFyYW0ge1N0cmluZ30gdmFsaWRDb250ZXh0IHZhbGlkIGNvbnRleHQKICoKICogQHJldHVybnMgdmFsaWQgdXJsIHcvY29udGV4dCBpZiBuZWNlc3NhcnksIGlmIG5vdCBsb2NhbCB0aGVuIHRoZSB1cmwKICovCk96b25lLnV0aWwudmFsaWRVcmxDb250ZXh0ID0gZnVuY3Rpb24odmFsdWUsIHZhbGlkQ29udGV4dCl7CiAgICB2YXIgY29udGFpbnNSZWxEb3RQYXRoID0gKHZhbHVlLmluZGV4T2YoIi4uLyIpID09IDApP3RydWU6ZmFsc2U7CiAgICB2YXIgY29udGFpbnNSZWxQYXRoID0gKHZhbHVlLmluZGV4T2YoIi8iKSA9PSAwKT90cnVlOmZhbHNlOwogICAgdmFyIGlzTG9jYWxVcmwgPSAoY29udGFpbnNSZWxQYXRoIHx8IGNvbnRhaW5zUmVsRG90UGF0aCB8fCAodmFsdWUuaW5kZXhPZigibG9jYWxob3N0IikgPT0gNykgfHwgKHZhbHVlLmluZGV4T2YoImxvY2FsaG9zdCIpID09IDExKSB8fCAodmFsdWUuaW5kZXhPZigiMTI3LjAuMC4xIikgPT0gNykpID8gdHJ1ZSA6IGZhbHNlOwogICAgdmFyIHVybFZhbGlkQ29udGV4dCA9IHZhbHVlOwogICAgdmFsaWRDb250ZXh0ID0gKCh2YWxpZENvbnRleHQgPT0gdW5kZWZpbmVkKSA/IE96b25lLnV0aWwuY29udGV4dFBhdGgoKSA6IHZhbGlkQ29udGV4dCk7CiAgICBpZigoaXNMb2NhbFVybCA9PSB0cnVlKSAmJiAodmFsaWRDb250ZXh0ICE9IG51bGwpKXsKICAgICAgICBpZihjb250YWluc1JlbFBhdGgpewogICAgICAgICAgICB1cmxWYWxpZENvbnRleHQgPSBTdHJpbmcuZm9ybWF0KCJ7MH17MX0iLCB2YWxpZENvbnRleHQsIHZhbHVlKTsKICAgICAgICB9ZWxzZSBpZihjb250YWluc1JlbERvdFBhdGgpewogICAgICAgICAgICB2YXIgdmFsdWVQYXRoTm9SZWwgPSB2YWx1ZS5zdWJzdHJpbmcoMyk7CiAgICAgICAgICAgIHVybFZhbGlkQ29udGV4dCA9IFN0cmluZy5mb3JtYXQoInswfS97MX0iLCB2YWxpZENvbnRleHQsIHZhbHVlUGF0aE5vUmVsKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdXJsVmFsaWRDb250ZXh0Owp9OwoKLyoqCiAqIEBwcml2YXRlCiAqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCBjZW50cmFsaXplcyB0aGUgY29udGFpbmVyIHJlbGF5IGZpbGUgZm9yCiAqIFJQQyBjYWxscy4KICoKICogQHJldHVybnMgcmVsYXkgZmlsZSBwYXRoIHdpdGggY29udGV4dAogKi8KT3pvbmUudXRpbC5nZXRDb250YWluZXJSZWxheSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIE96b25lLnV0aWwuY29udGV4dFBhdGgoKSArIAogICAgJy9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwnOwp9OwoKLyoqCiAqIEBwcml2YXRlCiAqIAogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2Qgd2lsbCBjb252ZXJ0IGFueXRoaW5nIHRvIGEgc3RyaW5nLgogKiBUaGVyZSBpcyBubyBjaGVjayBmb3IgcmVjdXJzaW9uLCBzbyBkb24ndCBkbyB0aGF0CiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogb2JqZWN0IHRvIGNvbnZlcnQKICoKICogQHJldHVybnMgc3RyaW5nCiAqCiAqIEByZXF1aXJlcyBkb2pvIGJhc2UKICovCk96b25lLnV0aWwudG9TdHJpbmcgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gb3dmZG9qby50b0pzb24ob2JqKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG9iaisnJzsKICAgIH0KfTsKCi8qKgogKiBAcHJpdmF0ZQogKi8KT3pvbmUudXRpbC5mb3JtYXRXaW5kb3dOYW1lRGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIC8vIHRoaXMgdmFsdWUgbmVlZHMgdG8gYmUgbm90IHVyaSBlbmNvZGVkCiAgICAvLyByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KG93ZmRvam8ub2JqZWN0VG9RdWVyeShkYXRhKSk7CiAgICByZXR1cm4gT3pvbmUudXRpbC50b1N0cmluZyhkYXRhKTsKfTsKCi8qKgogKiBAcHJpdmF0ZQogKiAgCiAqIFJlbW92ZXMgdGhlIExlYWRpbmcgYW5kIFRyYWlsaW5nIFNwYWNlcyBpbiBhbnkgRXh0SnMgRm9ybSBGaWVsZAogKi8KT3pvbmUudXRpbC5mb3JtRmllbGQucmVtb3ZlTGVhZGluZ1RyYWlsaW5nU3BhY2VzID0gZnVuY3Rpb24odGhpc0ZpZWxkKXsKICAgIHZhciB0aGlzRmllbGRfbm9MZWFkaW5nVHJhaWxpbmdTcGFjZXNWYWx1ZSA9IHRoaXNGaWVsZC5nZXRWYWx1ZSgpLnJlcGxhY2UobmV3IFJlZ0V4cChPem9uZS5sYW5nLnJlZ2V4TGVhZGluZ1RhaWxpbmdTcGFjZUNoYXJzKSwgJycpOwogICAgdGhpc0ZpZWxkLnNldFZhbHVlKHRoaXNGaWVsZF9ub0xlYWRpbmdUcmFpbGluZ1NwYWNlc1ZhbHVlKTsKICAgIHJldHVybiB0aGlzRmllbGRfbm9MZWFkaW5nVHJhaWxpbmdTcGFjZXNWYWx1ZTsKfTsKCmlmICghT3pvbmUudXRpbC5Nb2RhbEJveCkgewogICAgT3pvbmUudXRpbC5Nb2RhbEJveCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhYiA9ICdhYnNvbHV0ZSc7CiAgICAgICAgdmFyIG4gPSAnbm9uZSc7CiAgICAgICAgdmFyIG9ib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKICAgICAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICB2YXIgb2JvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG9ib2wuc2V0QXR0cmlidXRlKCdpZCcsICdvbCcpOwogICAgICAgIG9ib2wuc3R5bGUuZGlzcGxheSA9IG47CiAgICAgICAgb2JvbC5zdHlsZS5wb3NpdGlvbiA9IGFiOwogICAgICAgIG9ib2wuc3R5bGUudG9wID0gMDsKICAgICAgICBvYm9sLnN0eWxlLmxlZnQgPSAwOwogICAgICAgIG9ib2wuc3R5bGUuekluZGV4ID0gMTAwMDA7CiAgICAgICAgb2JvbC5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICBvYm9sLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIjNTU1IjsKICAgICAgICBvYm9sLnN0eWxlLmZpbHRlciA9ICdhbHBoYShvcGFjaXR5PTUwKSc7CiAgICAgICAgb2JvbC5zdHlsZS5Nb3pPcGFjaXR5ID0gMC41OwogICAgICAgIG9ib2wuc3R5bGUub3BhY2l0eSA9IDAuNTsKCiAgICAgICAgCiAgICAgICAgZnJhZy5hcHBlbmRDaGlsZChvYm9sKTsKICAgICAgICB0aGlzLm9ib2wgPSBvYm9sOwogICAgICAgIHZhciBvYmJ4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgb2JieC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ21ib3gnKTsKICAgICAgICBvYmJ4LnN0eWxlLmRpc3BsYXkgPSBuOwogICAgICAgIG9iYnguc3R5bGUucG9zaXRpb24gPSBhYjsKICAgICAgICBvYmJ4LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZWVlJzsKICAgICAgICBvYmJ4LnN0eWxlLnBhZGRpbmcgPSAnOHB4JzsKICAgICAgICBvYmJ4LnN0eWxlLmJvcmRlciA9ICcycHggb3V0c2V0ICM2NjYnOwogICAgICAgIG9iYnguc3R5bGUuekluZGV4ID0gMTAwMDE7CiAgICAgICAgdGhpcy5vYmJ4ID0gb2JieDsKICAgICAgICB2YXIgb2JsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgIG9iYnguYXBwZW5kQ2hpbGQob2JsKTsKICAgICAgICB2YXIgb2JieGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBvYmJ4ZC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ21iZCcpOwogICAgICAgIHZhciBkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICB0eHQuaW5uZXJIVE1MID0gJ1ByZXNzIE9LIHRvIGNvbnRpbnVlLic7CiAgICAgICAgdGhpcy50eHQgPSB0eHQ7CiAgICAgICAgdmFyIGQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZDIuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICAgICAgZDIuc3R5bGUuZm9udFNpemUgPSAnMTRweCc7CiAgICAgICAgZDIuYXBwZW5kQ2hpbGQodHh0KTsKICAgICAgICBkMi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsgICAgICAgCiAgICAgICAgdmFyIGJ1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIAogICAgICAgIGJ1dC5pbm5lckhUTUwgPSAnT0snOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBidXQub25jbGljaz0gZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICAgc2VsZi5oaWRlKCk7CiAgICAgICAgfQogICAgICAgIGQyLmFwcGVuZENoaWxkKGJ1dCk7CiAgICAgICAgZC5hcHBlbmRDaGlsZChkMik7CiAgICAgICAgb2JieGQuYXBwZW5kQ2hpbGQoZCk7CiAgICAgICAgdGhpcy5vYmJ4ZCA9IG9iYnhkOwogICAgICAgIG9ibC5hcHBlbmRDaGlsZChvYmJ4ZCk7CiAgICAgICAgZnJhZy5pbnNlcnRCZWZvcmUob2JieCwgb2JvbC5uZXh0U2libGluZyk7CiAgICAgICAgb2JvZHkuaW5zZXJ0QmVmb3JlKGZyYWcsIG9ib2R5LmZpcnN0Q2hpbGQpOwogICAgICAgIHdpbmRvdy5vbnNjcm9sbCA9IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHNlbGYuc2Nyb2xsRml4KCk7CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHNlbGYuc2l6ZUZpeCgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUucGFnZVdpZHRoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB3aW5kb3cuaW5uZXJXaWR0aCAhPSBudWxsID8gd2luZG93LmlubmVyV2lkdGgKICAgICAgICA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgKICAgICAgICA6IGRvY3VtZW50LmJvZHkgIT0gbnVsbCA/IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggOiBudWxsOwogICAgfQogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUucGFnZUhlaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0ICE9IG51bGwgPyB3aW5kb3cuaW5uZXJIZWlnaHQKICAgICAgICA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodAogICAgICAgIDogZG9jdW1lbnQuYm9keSAhPSBudWxsID8gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgOiBudWxsOwogICAgfQogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUucG9zTGVmdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0eXBlb2Ygd2luZG93LnBhZ2VYT2Zmc2V0ICE9ICd1bmRlZmluZWQnID8gd2luZG93LnBhZ2VYT2Zmc2V0CiAgICAgICAgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdAogICAgICAgIDogZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0ID8gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0IDogMDsKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLnBvc1RvcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHdpbmRvdy5wYWdlWU9mZnNldCAhPSAndW5kZWZpbmVkJyA/IHdpbmRvdy5wYWdlWU9mZnNldAogICAgICAgIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wCiAgICAgICAgOiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA/IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIDogMDsKICAgIH0KCiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5zY3JvbGxGaXggPSBmdW5jdGlvbigpIAogICAgewogICAgICAgIC8vdmFyIG9ib2wgPSAkKCdvbCcpOwogICAgICAgIHRoaXMub2JvbC5zdHlsZS50b3AgPSB0aGlzLnBvc1RvcCgpICsgJ3B4JzsKICAgICAgICB0aGlzLm9ib2wuc3R5bGUubGVmdCA9IHRoaXMucG9zTGVmdCgpICsgJ3B4JwogICAgfQogICAgT3pvbmUudXRpbC5Nb2RhbEJveC5wcm90b3R5cGUuc2l6ZUZpeCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvL3ZhciBvYm9sID0gJCgnb2wnKTsKICAgICAgICB0aGlzLm9ib2wuc3R5bGUuaGVpZ2h0ID0gdGhpcy5wYWdlSGVpZ2h0KCkgKyAncHgnOwogICAgICAgIHRoaXMub2JvbC5zdHlsZS53aWR0aCA9IHRoaXMucGFnZVdpZHRoKCkgKyAncHgnOwogICAgICAgIHZhciB0cCA9IHRoaXMucG9zVG9wKCkgKyAoKHRoaXMucGFnZUhlaWdodCgpIC0gdGhpcy5oZWlnaHQpIC8gMikgLSAxMjsKICAgICAgICB2YXIgbHQgPSB0aGlzLnBvc0xlZnQoKSArICgodGhpcy5wYWdlV2lkdGgoKSAtIHRoaXMud2lkdGgpIC8gMikgLSAxMjsKICAgICAgICB0aGlzLm9iYnguc3R5bGUudG9wID0gKHRwIDwgMCA/IDAgOiB0cCkgKyAncHgnOwogICAgICAgIHRoaXMub2JieC5zdHlsZS5sZWZ0ID0gKGx0IDwgMCA/IDAgOiBsdCkgKyAncHgnOwoKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLmtwID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBreSA9IGUgPyBlLndoaWNoIDogZXZlbnQua2V5Q29kZTsKICAgICAgICBpZiAoa3kgPT0gODggfHwga3kgPT0gMTIwKQogICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICByZXR1cm4gZmFsc2UKICAgIH0KICAgIE96b25lLnV0aWwuTW9kYWxCb3gucHJvdG90eXBlLmluZiA9IGZ1bmN0aW9uIChoKSB7CiAgICAgICAgdGFnID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NlbGVjdCcpOwogICAgICAgIGZvciAoaSA9IHRhZy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAgdGFnW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBoOwogICAgICAgIHRhZyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpZnJhbWUnKTsKICAgICAgICBmb3IgKGkgPSB0YWcubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCiAgICAgICAgICAgIHRhZ1tpXS5zdHlsZS52aXNpYmlsaXR5ID0gaDsKICAgICAgICB0YWcgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb2JqZWN0Jyk7CiAgICAgICAgZm9yIChpID0gdGFnLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKQogICAgICAgICAgICB0YWdbaV0uc3R5bGUudmlzaWJpbGl0eSA9IGg7CiAgICB9CiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB2ID0gJ3Zpc2libGUnOwogICAgICAgIHZhciBuID0gJ25vbmUnOwogICAgICAgIHRoaXMub2JvbC5zdHlsZS5kaXNwbGF5ID0gbjsKICAgICAgICB0aGlzLm9iYnguc3R5bGUuZGlzcGxheSA9IG47CiAgICAgICAgdGhpcy5pbmYodik7CiAgICAgICAgZG9jdW1lbnQub25rZXlwcmVzcyA9ICcnCiAgICB9CiAgICBPem9uZS51dGlsLk1vZGFsQm94LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKG1zZyx3ZCwgaHQpIHsKICAgICAgICB2YXIgaCA9ICdoaWRkZW4nOwogICAgICAgIHZhciBiID0gJ2Jsb2NrJzsKICAgICAgICB2YXIgcCA9ICdweCc7CiAgICAgICAgd2QgPSB3ZCB8IDIwMDsKICAgICAgICBodCA9IGh0IHwgMTAwOwogICAgICAgIHZhciBvYm9sID0gdGhpcy5vYm9sCiAgICAgICAgdmFyIG9iYnhkID0gdGhpcy5vYmJ4ZDsKICAgICAgICB0aGlzLnR4dC5pbm5lckhUTUwgPSBtc2c7CiAgICAgICAgb2JvbC5zdHlsZS5oZWlnaHQgPSB0aGlzLnBhZ2VIZWlnaHQoKSArIHA7CiAgICAgICAgb2JvbC5zdHlsZS53aWR0aCA9IHRoaXMucGFnZVdpZHRoKCkgKyBwOwogICAgICAgIG9ib2wuc3R5bGUudG9wID0gdGhpcy5wb3NUb3AoKSArIHA7CiAgICAgICAgb2JvbC5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NMZWZ0KCkgKyBwOwogICAgICAgIG9ib2wuc3R5bGUuZGlzcGxheSA9IGI7CiAgICAgICAgdmFyIHRwID0gdGhpcy5wb3NUb3AoKSArICgodGhpcy5wYWdlSGVpZ2h0KCkgLSBodCkgLyAyKSAtIDEyOwogICAgICAgIHZhciBsdCA9IHRoaXMucG9zTGVmdCgpICsgKCh0aGlzLnBhZ2VXaWR0aCgpIC0gd2QpIC8gMikgLSAxMjsKICAgICAgICB2YXIgb2JieCA9IHRoaXMub2JieAogICAgICAgIG9iYnguc3R5bGUudG9wID0gKHRwIDwgMCA/IDAgOiB0cCkgKyBwOwogICAgICAgIG9iYnguc3R5bGUubGVmdCA9IChsdCA8IDAgPyAwIDogbHQpICsgcDsKICAgICAgICBvYmJ4LnN0eWxlLndpZHRoID0gd2QgKyBwOwogICAgICAgIG9iYnguc3R5bGUuaGVpZ2h0ID0gaHQgKyBwOwogICAgICAgIHRoaXMuaW5mKGgpOwogICAgICAgIG9iYnguc3R5bGUuZGlzcGxheSA9IGI7CiAgICAgICAgdGhpcy53aWR0aCA9IHdkOwogICAgICAgIHRoaXMuaGVpZ2h0ID0gaHQ7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmlmICghT3pvbmUudXRpbC5FcnJvckRsZykgCnsKICAgIE96b25lLnV0aWwuRXJyb3JEbGcgPSB7fTsKICAgIE96b25lLnV0aWwuRXJyb3JEbGcuc2hvdz1mdW5jdGlvbihtc2csd2lkdGgsaGVpZ2h0KQogICAgewogICAgICAgIGlmICghdGhpcy5kbGdCb3gpCiAgICAgICAgICAgIHRoaXMuZGxnQm94ID0gbmV3IE96b25lLnV0aWwuTW9kYWxCb3goKTsKICAgICAgICB0aGlzLmRsZ0JveC5zaG93KG1zZyx3aWR0aCxoZWlnaHQpOwogICAgfTsKfQoKCi8qKgogKiBAcHJpdmF0ZQogKi8KT3pvbmUudXRpbC5maXJlQnJvd3NlckV2ZW50ID0gZnVuY3Rpb24oZG9tLCB0eXBlLCBidWJibGUsIGNhbmNlbGFibGUpIHsKICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudHMnKTsKICAgICAgICBldmVudC5pbml0RXZlbnQodHlwZSwgYnViYmxlIHx8IHRydWUsIGNhbmNlbGFibGUgfHwgdHJ1ZSk7CiAgICAgICAgZG9tLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgfQogICAgZWxzZSBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QpIHsKICAgICAgICBkb20uZmlyZUV2ZW50KCdvbicgKyB0eXBlKTsKICAgIH0KfTsKCi8qKgogICAgQ2xvbmVzIGRhc2hib2FyZCBhbmQgcmV0dXJucyBhIGRhc2hib2FyZCBjZmcgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gY3JlYXRlIG5ldyBkYXNoYm9hcmRzLgogICAgQG5hbWUgY2xvbmVEYXNoYm9hcmQKICAgIEBtZXRob2RPZiBPV0YuVXRpbAoKICAgIEByZXR1cm5zIE9iamVjdCBkYXNoYm9hcmQgY2ZnIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBuZXcgZGFzaGJvYXJkcy4KICovCk96b25lLnV0aWwuY2xvbmVEYXNoYm9hcmQgPSBmdW5jdGlvbihkYXNoYm9hcmRDZmcsIHJlZ2VuZXJhdGVJZHMsIHJlbW92ZUxhdW5jaERhdGEpIHsKICAgIAogICAgdmFyIGRhc2hib2FyZFN0ciA9IE96b25lLnV0aWwudG9TdHJpbmcoZGFzaGJvYXJkQ2ZnKTsKCiAgICBpZihyZWdlbmVyYXRlSWRzID09PSB0cnVlKSB7CiAgICAgICAgdmFyIG5ld0Rhc2hib2FyZEd1aWQgPSBndWlkLnV0aWwuZ3VpZCgpLAogICAgICAgICAgICBkYXNoYm9hcmRHdWlkID0gZGFzaGJvYXJkQ2ZnLmd1aWQ7CgogICAgICAgIC8vIHVwZGF0ZSBkYXNoYm9hcmQgZ3VpZAogICAgICAgIGRhc2hib2FyZFN0ciA9IGRhc2hib2FyZFN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoZGFzaGJvYXJkR3VpZCwgJ2cnKSwgbmV3RGFzaGJvYXJkR3VpZCk7CiAgICAgICAgZGFzaGJvYXJkU3RyQ29weSA9IGRhc2hib2FyZFN0cjsKCiAgICAgICAgLy8gdXBkYXRlIHdpZGdldCBpbnN0YW5jZSBpZHMKICAgICAgICB2YXIgd2lkZ2V0SW5zdGFuY2VJZFJlZ2V4ID0gL1widW5pcXVlSWRcIlw6XCIoW0EtRmEtZlxkXXs4fS1bQS1GYS1mXGRdezR9LVtBLUZhLWZcZF17NH0tW0EtRmEtZlxkXXs0fS1bQS1GYS1mXGRdezEyfSlcIi9nOwogICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgd2hpbGUgKChyZXN1bHQgPSB3aWRnZXRJbnN0YW5jZUlkUmVnZXguZXhlYyhkYXNoYm9hcmRTdHJDb3B5KSkgIT0gbnVsbCkgewogICAgICAgICAgICAvLyB2YXIgbXNnID0gIkZvdW5kICIgKyByZXN1bHRbMV07CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG1zZyk7CiAgICAgICAgICAgIGRhc2hib2FyZFN0ciA9IGRhc2hib2FyZFN0ci5yZXBsYWNlKG5ldyBSZWdFeHAocmVzdWx0WzFdLCAnZycpLCBndWlkLnV0aWwuZ3VpZCgpKTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIGRhc2hib2FyZCA9IE96b25lLnV0aWwucGFyc2VKc29uKGRhc2hib2FyZFN0cik7CiAgICAKICAgIGlmKHJlbW92ZUxhdW5jaERhdGEgPT09IHRydWUpIHsKICAgICAgICB2YXIgY2xlYW5EYXRhID0gZnVuY3Rpb24oY2ZnKSB7CiAgICAgICAgICAgIGlmKCFjZmcgfHwgIWNmZy5pdGVtcykKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmKGNmZy5pdGVtcy5sZW5ndGggPT09IDAgJiYgY2ZnLndpZGdldHMpIHsKICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGNmZy53aWRnZXRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNmZy53aWRnZXRzW2ldLmxhdW5jaERhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBjZmcuaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjbGVhbkRhdGEoY2ZnLml0ZW1zW2ldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjbGVhbkRhdGEoZGFzaGJvYXJkLmxheW91dENvbmZpZyk7CiAgICB9CgogICAgcmV0dXJuIGRhc2hib2FyZDsKfTsKCk96b25lLnV0aWwuY3JlYXRlUmVxdWlyZWRMYWJlbD0gZnVuY3Rpb24obGFiZWwpIHsKICAgIHJldHVybiAiPHNwYW4gY2xhc3M9J3JlcXVpcmVkLWxhYmVsJz4iICsgbGFiZWwgKyAiIDxzcGFuIGNsYXNzPSdyZXF1aXJlZC1pbmRpY2F0b3InPio8L3NwYW4+PC9zcGFuPiI7Cn0KdmFyIGd1aWQgPSBndWlkIHx8IHt9Owp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsKT3pvbmUudXRpbCA9IE96b25lLnV0aWwgfHwge307CgpndWlkLnV0aWwgPSBmdW5jdGlvbigpIHsKCWZ1bmN0aW9uIFM0KCkgewoJCXJldHVybiAoKCgxK01hdGgucmFuZG9tKCkpKjB4MTAwMDApfDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7Cgl9CglyZXR1cm4gewoJCWd1aWQgOiBmdW5jdGlvbiAoKSB7CgkJICAJcmV0dXJuIChTNCgpK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrUzQoKStTNCgpKTsKCQl9Cgl9Owp9KCk7CgovKioKICogQGRlc2NyaXB0aW9uIFJldHVybnMgYSBnbG9iYWxseSB1bmlxdWUgaWRlbnRpZmllciAoZ3VpZCkKICogCiAqIEByZXR1cm5zIHtTdHJpbmd9IGd1aWQKICovCk96b25lLnV0aWwuZ3VpZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGd1aWQudXRpbC5ndWlkKCk7Cn0KLyoKICogVGhpcyBmaWxlIGNvbnRhaW5zIGNvbnN0YW50IGRlZmluaXRpb25zIHRoYXQgZGVmaW5lIGdsb2JhbCBPV0YgaG90a2V5cwogKi8KCk96b25lID0gT3pvbmUgfHwge307Ck96b25lLmNvbXBvbmVudHMgPSBPem9uZS5jb21wb25lbnRzIHx8IHt9OwpPem9uZS5jb21wb25lbnRzLmtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMgfHwge307Ck96b25lLmNvbXBvbmVudHMua2V5cy5FVkVOVF9OQU1FID0gJ2tleXVwJzsgLy9rZXl1cCBvbmx5IGZpcmVzIG9uY2UsIHdoaWNoIGlzIHdoYXQgd2Ugd2FudC4ga2V5ZG93biBtYXkgZmlyZSByZXBlYXRlZGx5Ck96b25lLmNvbXBvbmVudHMua2V5cy5Ib3RLZXlzID0gT3pvbmUuY29tcG9uZW50cy5rZXlzLkhvdEtleXMgfHwge307Ck96b25lLmNvbXBvbmVudHMua2V5cy5Nb3ZlSG90S2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Nb3ZlSG90S2V5cyB8fCB7fTsKCihmdW5jdGlvbigpIHsKICAgIHZhciBrID0gT3pvbmUuY29tcG9uZW50cy5rZXlzLkhvdEtleXM7CiAgICAKICAgIC8qCiAgICAqIGtleXMgYXJlIGRlZmluZWQgaGVyZS4gIEVhY2gga2V5IGlzIGRlZmluZWQKICAgICogYXMgdGhlIEV4dC5FdmVudE9iamVjdCBjb25zdGFudCByZXByZXNlbnRpbmcKICAgICogdGhhdCBrZXkuIFVuZm9ydHVuYXRlbHksIHNpbmNlIHRoaXMgZmlsZSBpcwogICAgKiBpbmNsdWRlZCBib3RoIGNvbnRhaW5lciBzaWRlIGFuZCB3aWRnZXQgc2lkZSwgCiAgICAqIGl0IGNhbm5vdCBhY3R1YWxseSB1c2UgdGhlIEV4dC5FdmVudE9iamVjdCBjb25zdGFudHMKICAgICogc2luY2UgRXh0IGlzIG5vdCBkZWZpbmVkIHdpZGdldCBzaWRlLiBUaGVyZWZvcmUKICAgICogd2UgdXNlIHRoZSBvd2Zkb2pvIGNvbnN0YW50cyBhbmQgYXNjaWkgY29kZXMsIHdoaWNoIGhhcHBlbgogICAgKiB0byBhbGwgYmUgdGhlIHNhbWUgYXMgdGhlIEV4dCBjb25zdGFudHMuICAKICAgICovCiAgICBrLlNFVFRJTkdTID0gewogICAgICAgIGtleTogJ1MnLmNoYXJDb2RlQXQoMCksCiAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICB9OyAKICAgIAogICAgay5BRE1JTklTVFJBVElPTj0gewogICAgICAgIGtleTogJ0EnLmNoYXJDb2RlQXQoMCksCiAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICB9OwoKICAgIGsuTUFSS0VUUExBQ0U9IHsKICAgICAgICBrZXk6ICdNJy5jaGFyQ29kZUF0KDApLAogICAgICAgIGV4Y2x1c2l2ZTogdHJ1ZQogICAgfTsKCiAgICBrLk1FVFJJQz0gewogICAgICAgIGtleTogJ1InLmNoYXJDb2RlQXQoMCksCiAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICB9OwoKICAgIGsuTEFVTkNIX01FTlUgPSB7IGtleTogJ0wnLmNoYXJDb2RlQXQoMCkgfTsKCiAgICBrLkhFTFAgPSB7CiAgICAgICAga2V5OiAnSCcuY2hhckNvZGVBdCgwKSwKICAgICAgICBleGNsdXNpdmU6IHRydWUKICAgIH07CgogICAgay5MT0dPVVQgPSB7IGtleTogJ08nLmNoYXJDb2RlQXQoMCkgfTsgLy9PIGZvciAnb3V0JwoKICAgIGsuUFJFVklPVVNfREFTSEJPQVJEID0geyBrZXk6IG93ZmRvam8ua2V5cy5QQUdFX1VQIH07IAogICAgCiAgICBrLk5FWFRfREFTSEJPQVJEID0geyBrZXk6IG93ZmRvam8ua2V5cy5QQUdFX0RPV04gfTsKCiAgICBrLkRBU0hCT0FSRF9TV0lUQ0hFUiA9IHsKICAgICAgICBrZXk6ICdDJy5jaGFyQ29kZUF0KDApLAogICAgICAgIGV4Y2x1c2l2ZTogdHJ1ZQogICAgfTsKICAgIAogICAgay5XSURHRVRfU1dJVENIRVIgPSB7CiAgICAgICAga2V5OiAnUScuY2hhckNvZGVBdCgwKSwKICAgICAgICBleGNsdXNpdmU6IHRydWUKICAgIH07IAogICAgCiAgICBrLkRFRkFVTFRfREFTSEJPQVJEID0geyBrZXk6IG93ZmRvam8ua2V5cy5IT01FIH07CiAgICAKICAgIGsuQ0xPU0VfV0lER0VUID0geyBrZXk6ICdXJy5jaGFyQ29kZUF0KDApIH07IAogICAgCiAgICBrLk1BWElNSVpFX0NPTExBUFNFX1dJREdFVCA9IHsgCiAgICAgICAga2V5OiBvd2Zkb2pvLmtleXMuVVBfQVJST1csCiAgICAgICAgZm9jdXNQYXJlbnQ6IGZhbHNlCiAgICB9OwogICAgCiAgICBrLk1JTklNSVpFX0VYUEFORF9XSURHRVQgPSB7IAogICAgICAgIGtleTogb3dmZG9qby5rZXlzLkRPV05fQVJST1csCiAgICAgICAgZm9jdXNQYXJlbnQ6IGZhbHNlCiAgICB9OwogICAgCiAgICBrLkVTQ0FQRV9GT0NVUyA9IHsgCiAgICAgICAga2V5OiBvd2Zkb2pvLmtleXMuRVNDQVBFLAogICAgICAgIC8vdGhlIGVzY2FwZSBrZXkgc2hvdWxkIG5vdCB1c2UgYWx0K3NoaWZ0CiAgICAgICAgYWx0OiBmYWxzZSwKICAgICAgICBzaGlmdDogZmFsc2UKICAgIH07CgogICAgLy8gaGFzaCBtYXAgb2Yga2V5IGNvZGVzCiAgICB2YXIga2V5Q29kZXMgPSB7fTsKCiAgICAvL0FkZCBzaGlmdCBhbmQgYWx0IG1vZGlmaWVycyB0byAKICAgIC8vYWxsIGtleXMgdGhhdCBkb24ndCBhbHJlYWR5IGhhdmUKICAgIC8vdGhlbS4gRGVmYXVsdCB0byByZXF1aXJpbmcgYm90aAogICAgLy9zaGlmdCBhbmQgYWx0CiAgICBmb3IgKHZhciBrZXlfaSBpbiBrKSB7CiAgICAgICAgdmFyIGhvdEtleSA9IGtba2V5X2ldOwoKICAgICAgICBpZiAoaG90S2V5LmFsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhvdEtleS5hbHQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaG90S2V5LnNoaWZ0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaG90S2V5LnNoaWZ0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhvdEtleS5mb2N1c1BhcmVudCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhvdEtleS5mb2N1c1BhcmVudCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGtleUNvZGVzW2hvdEtleS5rZXldID0gaG90S2V5OwogICAgfQoKICAgIC8vIGZvciBvd2Ygc3BlY2lmaWMgaG90a2V5cywgcHJldmVudCBkZWZhdWx0IG9uIGtleWRvd24KICAgIC8vIHRoaXMgaXMgbmVjZXNzYXJ5IGZvciBJRQogICAgb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb25rZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgaG90S2V5ID0ga2V5Q29kZXNbZXZlbnQua2V5Q29kZV07CgogICAgICAgIGlmKGhvdEtleSAmJiBldmVudC5hbHRLZXkgPT09IGhvdEtleS5hbHQgCiAgICAgICAgICAgICYmIGV2ZW50LnNoaWZ0S2V5ID09PSBob3RLZXkuc2hpZnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CiAgICB9KTsKCiAgICB2YXIgbW92ZUtleXMgPSBPem9uZS5jb21wb25lbnRzLmtleXMuTW92ZUhvdEtleXM7CiAgICBtb3ZlS2V5cy5NT1ZFX1VQID0gewogICAgICAgIGtleTogb3dmZG9qby5rZXlzLlVQX0FSUk9XCiAgICB9OwogICAgbW92ZUtleXMuTU9WRV9SSUdIVCA9IHsKICAgICAgICBrZXk6IG93ZmRvam8ua2V5cy5SSUdIVF9BUlJPVwogICAgfTsKICAgIG1vdmVLZXlzLk1PVkVfRE9XTiA9IHsKICAgICAgICBrZXk6IG93ZmRvam8ua2V5cy5ET1dOX0FSUk9XCiAgICB9OwogICAgbW92ZUtleXMuTU9WRV9MRUZUID0gewogICAgICAgIGtleTogb3dmZG9qby5rZXlzLkxFRlRfQVJST1cKICAgIH07CgogICAgZm9yIChrZXlfaSBpbiBtb3ZlS2V5cykgewogICAgICAgIHZhciBob3RLZXkgPSBtb3ZlS2V5c1trZXlfaV07CgogICAgICAgIGlmIChob3RLZXkuY3RybCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhvdEtleS5jdHJsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhvdEtleS5hbHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuYWx0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChob3RLZXkuc2hpZnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBob3RLZXkuc2hpZnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhvdEtleS5mb2N1c1BhcmVudCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhvdEtleS5mb2N1c1BhcmVudCA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KfSkoKTsKCgpPem9uZSA9IE96b25lIHx8IHt9OwpPem9uZS5jb21wb25lbnRzID0gT3pvbmUuY29tcG9uZW50cyB8fCB7fTsKT3pvbmUuY29tcG9uZW50cy5rZXlzID0gT3pvbmUuY29tcG9uZW50cy5rZXlzIHx8IHt9OwoKT3pvbmUuY29tcG9uZW50cy5rZXlzLmNyZWF0ZUtleUV2ZW50U2VuZGVyID0gZnVuY3Rpb24od2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyKSB7CiAgICB2YXIga2V5Q2hhbm5lbE5hbWUgPSAnX2tleUV2ZW50JywKICAgICAgICBycGMgPSBnYWRnZXRzLnJwYywKICAgICAgICBjYWxscnBjID0gcnBjLmNhbGw7CgogICAgCiAgICBycGMucmVnaXN0ZXIoJ19mb2N1c193aWRnZXRfd2luZG93JywgZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoKGUpIHt9CiAgICB9KTsKCiAgICBjYWxscnBjKCcuLicsICdfd2lkZ2V0X2lmcmFtZV9yZWFkeScsIG51bGwsIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpKTsKCiAgICBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbicgKyBPem9uZS5jb21wb25lbnRzLmtleXMuRVZFTlRfTkFNRSwgdGhpcywgZnVuY3Rpb24oa2V5ZXZlbnQpIHsKICAgICAgICB2YXIga2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Ib3RLZXlzLAogICAgICAgICAgICBrZXksIGZvdW5kID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGtleV9pIGluIGtleXMpIHsKICAgICAgICAgICAga2V5ID0ga2V5c1trZXlfaV07CgogICAgICAgICAgICBpZiAoa2V5LmtleSA9PT0ga2V5ZXZlbnQua2V5Q29kZSAKICAgICAgICAgICAgICAgICYmIGtleS5hbHQgPT09IGtleWV2ZW50LmFsdEtleQogICAgICAgICAgICAgICAgJiYga2V5LnNoaWZ0ID09PSBrZXlldmVudC5zaGlmdEtleSkgewoKICAgICAgICAgICAgICAgIGlmKGtleS5mb2N1c1BhcmVudCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudC5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIC8vd2luZG93LmJsdXIoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjYWxscnBjKCcuLicsICdfa2V5X2V2ZW50aW5nJywgbnVsbCwgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIHsKICAgICAgICAgICAgICAgICAgICBrZXlDb2RlOiBrZXlldmVudC5rZXlDb2RlLAogICAgICAgICAgICAgICAgICAgIGFsdEtleToga2V5ZXZlbnQuYWx0S2V5LAogICAgICAgICAgICAgICAgICAgIHNoaWZ0S2V5OiBrZXlldmVudC5zaGlmdEtleSwKICAgICAgICAgICAgICAgICAgICBmb2N1c1BhcmVudDoga2V5LmZvY3VzUGFyZW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsgIC8vaW4gY2FzZSB0aGUgc2FtZSBrZXkgaXMgaW4ga2V5cyB0d2ljZSwgd2Ugc3RpbGwgb25seSB3YW50CiAgICAgICAgICAgICAgICAgICAgICAgIC8vdG8gc2VuZCBvbmUgZXZlbnQKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoZm91bmQgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAga2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Nb3ZlSG90S2V5czsKCiAgICAgICAgZm9yICh2YXIga2V5X2kgaW4ga2V5cykgewogICAgICAgICAgICBrZXkgPSBrZXlzW2tleV9pXTsKCiAgICAgICAgICAgIGlmIChrZXkua2V5ID09PSBrZXlldmVudC5rZXlDb2RlIAogICAgICAgICAgICAgICAgJiYga2V5LmN0cmwgPT09IGtleWV2ZW50LmN0cmxLZXkKICAgICAgICAgICAgICAgICYmIGtleS5hbHQgPT09IGtleWV2ZW50LmFsdEtleQogICAgICAgICAgICAgICAgJiYga2V5LnNoaWZ0ID09PSBrZXlldmVudC5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjYWxscnBjKCcuLicsICdfa2V5X2V2ZW50aW5nJywgbnVsbCwgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIHsKICAgICAgICAgICAgICAgICAgICBrZXlDb2RlOiBrZXlldmVudC5rZXlDb2RlLAogICAgICAgICAgICAgICAgICAgIGN0cmxLZXk6IGtleWV2ZW50LmN0cmxLZXksCiAgICAgICAgICAgICAgICAgICAgYWx0S2V5OiBrZXlldmVudC5hbHRLZXksCiAgICAgICAgICAgICAgICAgICAgc2hpZnRLZXk6IGtleWV2ZW50LnNoaWZ0S2V5LAogICAgICAgICAgICAgICAgICAgIGZvY3VzUGFyZW50OiBrZXkuZm9jdXNQYXJlbnQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgogICAgb3dmZG9qby5jb25uZWN0KGRvY3VtZW50LCAnb25rZXlkb3duJywgdGhpcywgZnVuY3Rpb24oa2V5ZXZlbnQpIHsKICAgICAgICB2YXIga2V5cyA9IE96b25lLmNvbXBvbmVudHMua2V5cy5Nb3ZlSG90S2V5cywKICAgICAgICAgICAga2V5OwoKICAgICAgICBmb3IgKHZhciBrZXlfaSBpbiBrZXlzKSB7CiAgICAgICAgICAgIGtleSA9IGtleXNba2V5X2ldOwoKICAgICAgICAgICAgaWYgKGtleS5rZXkgPT09IGtleWV2ZW50LmtleUNvZGUgCiAgICAgICAgICAgICAgICAmJiBrZXkuY3RybCA9PT0ga2V5ZXZlbnQuY3RybEtleQogICAgICAgICAgICAgICAgJiYga2V5LmFsdCA9PT0ga2V5ZXZlbnQuYWx0S2V5CiAgICAgICAgICAgICAgICAmJiBrZXkuc2hpZnQgPT09IGtleWV2ZW50LnNoaWZ0S2V5KSB7CgogICAgICAgICAgICAgICAgY2FsbHJwYygnLi4nLCAnX2tleV9ldmVudGluZycsIG51bGwsIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCB7CiAgICAgICAgICAgICAgICAgICAga2V5Q29kZToga2V5ZXZlbnQua2V5Q29kZSwKICAgICAgICAgICAgICAgICAgICBjdHJsS2V5OiBrZXlldmVudC5jdHJsS2V5LAogICAgICAgICAgICAgICAgICAgIGFsdEtleToga2V5ZXZlbnQuYWx0S2V5LAogICAgICAgICAgICAgICAgICAgIHNoaWZ0S2V5OiBrZXlldmVudC5zaGlmdEtleSwKICAgICAgICAgICAgICAgICAgICBrZXlkb3duOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGZvY3VzUGFyZW50OiBrZXkuZm9jdXNQYXJlbnQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn07Cgp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsNCk96b25lLmxheW91dCA9IE96b25lLmxheW91dCB8fCB7fTsNCk96b25lLnV4ID0gT3pvbmUudXggfHwge307DQpPem9uZS51dGlsID0gT3pvbmUudXRpbCB8fCB7fTsNCg0KLyoNCiAqIEdlbmVyYWwgQWxnb3JpdGhtIA0KICogDQogKiBpZiBxdWVyeVN0cmluZyBjb250YWlucyBsYW5nIHBhcmFtZXRlciBzd2l0aCB0byB0aGF0IGxvY2FsZQ0KICogZWxzZSBjaGVjayBicm93c2VyIGxhbmd1YWdlIHNldHRpbmcNCiAqIA0KICogTGFuZ3VhZ2Ugc3dpdGNoaW5nIGlzIGFjY29tcGxpc2hlZCBieSBpbmNsaXVkaW5nIGEgbG9jYWxlDQogKiBzcGVjaWZpYyBqYXZhc2NyaXB0IGZpbGUNCiAqLw0KLyoqDQogKiBAY2xhc3MNCiAqIEBkZXNjcmlwdGlvbiBQcm92aWRlcyB1dGlsaXR5IG1ldGhvZHMgZm9yIGxvY2FsaXphdGlvbg0KICovDQpPem9uZS5sYW5nID0gew0KCWxhbmd1YWdlU2V0dGluZyA6ICdlbi1VUycsIA0KCQ0KCXJlZ2V4TGVhZGluZ1RhaWxpbmdTcGFjZUNoYXJzOiAvXlxzK3xccyskL2csDQoJDQoJcmVnZXhUcmFpbGluZ1NwYWNlQ2hhcnM6IC9ccyskLywNCgkNCglyZWdleExlYWRpbmdTcGFjZUNoYXJzOiAvXlxzKy8sDQoJDQoJdmVyc2lvbiA6IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24ubGFuZ3VhZ2UsDQoJDQoJdXJsRGVjb2RlOiBmdW5jdGlvbihzdHJpbmcsIG92ZXJ3cml0ZSl7DQogICAgICAgIGlmICghc3RyaW5nIHx8ICFzdHJpbmcubGVuZ3RoKSB7DQogICAgICAgICAgICByZXR1cm4ge307DQogICAgICAgIH0NCiAgICAgICAgdmFyIG9iaiA9IHt9Ow0KICAgICAgICB2YXIgcGFpcnMgPSBzdHJpbmcuc3BsaXQoJyYnKTsNCiAgICAgICAgdmFyIHBhaXIsIG5hbWUsIHZhbHVlOw0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGFpcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIHBhaXIgPSBwYWlyc1tpXS5zcGxpdCgnPScpOw0KICAgICAgICAgICAgbmFtZSA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzBdKTsNCiAgICAgICAgICAgIHZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pOw0KICAgICAgICAgICAgaWYgKG92ZXJ3cml0ZSAhPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW25hbWVdID09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgICAgIG9ialtuYW1lXSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9ialtuYW1lXSA9PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW25hbWVdID0gW29ialtuYW1lXV07DQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbbmFtZV0ucHVzaCh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbbmFtZV0ucHVzaCh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIG9ialtuYW1lXSA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBvYmo7DQogICAgfSwNCgkNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgbGFuZ3VhZ2UgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgdXNlZCBieSBPV0YNCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIElTTyA2MzktMSBsYW5ndWFnZSBjb2RlIGZvciB0aGUgbGFuZ3VhZ2UgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgdXNlZCBieSBPV0YNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIGlmIChPem9uZS5sYW5nLmdldExhbmd1YWdlKCkgPT0gJ2VzJykgew0KICAgICAqICAgQW5ub3VuY2luZ0Nsb2NrU3RyaW5ncy50aW1lTGFiZWwgPSAnRWwgdGllbXBvIGVzJzsNCiAgICAgKiB9IA0KICAgICAqIA0KICAgICAqLw0KCWdldExhbmd1YWdlIDogZnVuY3Rpb24oKSB7DQoJICAgIHZhciBwYXJhbXMgPSBPem9uZS5sYW5nLnVybERlY29kZSh3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKSk7DQogICAgICAgIGlmIChwYXJhbXMubGFuZykgew0KCQkJcmV0dXJuIHBhcmFtcy5sYW5nOw0KCQl9DQogICAgICAgIGVsc2Ugew0KDQogICAgICAgICAgLy90cnkgdG8gZmluZCBpdCBpbiB0aGUgd2luZG93Lm5hbWUNCiAgICAgICAgICBpZiAoT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKSB7DQoNCiAgICAgICAgICAgIHZhciBkYXRhID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCk7DQogICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGRhdGEubGFuZykgew0KICAgICAgICAgICAgICByZXR1cm4gZGF0YS5sYW5nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vanVzdCB1c2UgZGVmYXVsdA0KICAgICAgICByZXR1cm4gT3pvbmUubGFuZy5sYW5ndWFnZVNldHRpbmc7ICANCiAgICB9IA0KfTsNCg0KT3pvbmUubGF5b3V0Lk1lbnUgPSB7DQoJb3ZlcmZsb3dNZW51QnV0dG9uVG9vbHRpcCA6ICJDbGljayB0byBzaG93IG1vcmUgYnV0dG9ucyINCn07DQoNCk96b25lLmxheW91dC5Db25maWd1cmF0aW9uV2luZG93U3RyaW5nID0gew0KCXNldEFzTmV3IDogIlNhdmUgYXMgbmV3IiwgDQogICAgc2V0QXNEZWZhdWx0IDogIlNldCBhcyBkZWZhdWx0IiwNCiAgICBzaG93Q2Fyb3VzZWwgOiAiU2hvdyBMYXVuY2ggTWVudSIsDQogICAgc2hvd1Nob3J0Y3V0cyA6ICJTaG93IFNob3J0Y3V0cyIsDQogICAgc2hvd1Rvb2xiYXIgOiAiU2hvdyB0b29sYmFyIG9wdGlvbnMiLA0KICAgIGRvY3VtZW50VGl0bGUgOiAiRG9jdW1lbnQgVGl0bGUiLA0KCQ0KCXRvcFNlbGVjdG9yIDogJ1RvcCcsIA0KICAgIGNlbnRlclNlbGVjdG9yIDogJ0NlbnRlcicsDQogICAgYWNjb3JkaW9uU2VsZWN0b3IgOiAnQWNjb3JkaW9uJywgDQogICAgdG9vbGJhckJ1dHRvbnMgOiAnVG9vbGJhciBCdXR0b25zJywgDQogICAgY2xlYXIgOiAnQ2xlYXInLA0KICAgIHNhdmUgOiAnT0snLA0KICAgIGNhbmNlbCA6ICdDYW5jZWwnLA0KICAgIGNsZWFyQWxsOiAnQ2xlYXIgQWxsJywNCgkNCiAgICBjb2x1bW4gOiAnQ29sdW1uJywgDQogICAgY29sdW1ucyA6ICdDb2x1bW5zJywNCgkNCiAgICB0YWIgOiAnVGFiJywgDQogICAgdGFicyA6ICdUYWJzJw0KfTsNCg0KT3pvbmUubGF5b3V0LkNyZWF0ZVZpZXdXaW5kb3dTdHJpbmcgPSB7DQogICAgY3JlYXRlTmV3OiAnQ3JlYXRlIG5ldycsDQogICAgY3JlYXRlRnJvbUV4aXNpdGluZzogJ0NyZWF0ZSBmcm9tIGV4aXN0aW5nJywNCiAgICBpbXBvcnRWaWV3OiAnSW1wb3J0Jw0KfTsNCg0KT3pvbmUubGF5b3V0Lk1hbmFnZVZpZXdzV2luZG93U3RyaW5nID0gew0KICAgIGxhbmd1YWdlczogJ0xhbmd1YWdlJw0KfTsNCg0KT3pvbmUubGF5b3V0LlRvb2xiYXJTdHJpbmcgPSB7DQogICBjb25maWd1cmF0aW9uTWFuYWdlciA6ICdDb25maWd1cmF0aW9uIE1hbmFnZXInDQp9Ow0KDQpPem9uZS5sYXlvdXQuRGVza3RvcFdpbmRvd01hbmFnZXJTdHJpbmcgPSB7DQogICAgY29uZmlndXJlRGFzaGJvYXJkIDogJ0NvbmZpZ3VyZSBEYXNoYm9hcmQnLCANCiAgICB0b2dnbGVDYXJvdXNlbCA6ICdUb2dnbGUgTGF1bmNoIE1lbnUnLA0KICAgIHdlbGNvbWVNZXNzYWdlIDogJ1dlbGNvbWUnDQp9Ow0KDQpPem9uZS5sYXlvdXQudG9vbHRpcFN0cmluZyA9IHsNCgl3aWRnZXRMYXVuY2hNZW51VGl0bGU6IAkJCSdMYXVuY2ggTWVudScsDQoJbWFuYWdlRGFzaGJvYXJkc1RpdGxlOiAJCQknRGFzaGJvYXJkIFNldHRpbmdzJywNCgltYW5hZ2VEYXNoYm9hcmRzQ29udGVudDogCQknVGhpcyBzY3JlZW4gYWxsb3dzIHVzZXJzIHRvIHJlYXJyYW5nZSwgZWRpdCwgYW5kIGRlbGV0ZSBkYXNoYm9hcmRzLiBJdCBhbHNvIGFsbG93cyB1c2VycyB0byBzZXQgdGhlaXIgbGFuZ3VhZ2UgcHJlZmVyZW5jZS4nLA0KCWNyZWF0ZURhc2hib2FyZFRpdGxlOiAJCQknQ3JlYXRlIERhc2hib2FyZCcsDQoJY3JlYXRlRGFzaGJvYXJkQ29udGVudDogCQknVGhpcyBzY3JlZW4gYWxsb3dzIHVzZXJzIHRvIGNyZWF0ZSBibGFuayBkYXNoYm9hcmRzLCBjb3B5IGFuIGV4aXN0aW5nIGRhc2hib2FyZCwgb3IgaW1wb3J0IGEgZGFzaGJvYXJkIGZyb20gYSBzaGFyZWQgY29uZmlndXJhdGlvbi4nLA0KCWFkZFdpZGdldHNUaXRsZTogCQkJCSdMYXVuY2ggTWVudSAoQWx0K1NoaWZ0K0wpJywNCglhZGRXaWRnZXRzQ29udGVudDogCQkJCSdUaGlzIGJ1dHRvbiBvcGVucyBvciBjbG9zZXMgdGhlIExhdW5jaCBNZW51LCBhbGxvd2luZyB1c2VycyB0byBhZGQgd2lkZ2V0cyB0byB0aGVpciBjdXJyZW50IGRhc2hib2FyZC4nLA0KCWRhc2hib2FyZFN3aXRjaGVyVGl0bGU6CQkJJ1N3aXRjaGVyIChBbHQrU2hpZnQrQyknLA0KCWRhc2hib2FyZFN3aXRjaGVyQ29udGVudDoJCSdUaGlzIGJ1dHRvbiBvcGVucyBvciBjbG9zZXMgdGhlIFN3aXRjaGVyLCBhbGxvd2luZyB1c2VycyB0byBzd2l0Y2ggYmV0d2VlbiB0aGVpciBkYXNoYm9hcmRzLicsDQoJbWFya2V0cGxhY2VXaW5kb3dUaXRsZToJCQknTWFya2V0cGxhY2UgKEFsdCtTaGlmdCtNKScsDQoJbWFya2V0cGxhY2VXaW5kb3dDb250ZW50OgkJJ1RoaXMgYnV0dG9uIG9wZW5zIHRoZSBNYXJrZXRwbGFjZSB3aW5kb3csIGFsbG93aW5nIHVzZXJzIHRvIGRpc2NvdmVyIHdpZGdldHMgaW4gTWFya2V0cGxhY2UgYW5kIGFkZCB0aGVtIHRvIHRoZWlyIE9XRiBpbnN0YW5jZS4nLA0KICAgIG1ldHJpY1dpbmRvd1RpdGxlOgkJICAgIAknTWV0cmljIChBbHQrU2hpZnQrUiknLA0KICAgIG1ldHJpY1dpbmRvd0NvbnRlbnQ6ICAgICAgCQknVGhpcyBidXR0b24gb3BlbnMgdGhlIE1ldHJpYyB3aW5kb3csIHdoZXJlIHdpZGdldHMgdGhhdCBtb25pdG9yIE9XRiBhbmQgd2lkZ2V0IHN0YXRpc3RpY3MgYXJlIGxvY2F0ZWQuJywNCglzZXR0aW5nc1RpdGxlOgkJCQkJJ1NldHRpbmdzIChBbHQrU2hpZnQrUyknLA0KCXNldHRpbmdzQ29udGVudDoJCQkJJ1RoaXMgYnV0dG9uIG9wZW5zIHRoZSBTZXR0aW5ncyB3aW5kb3csIGFsbG93aW5nIHVzZXJzIHRvIGN1c3RvbWl6ZSB0aGVpciB3aWRnZXRzIG9yIGNoYW5nZSB0aGVtZXMuJywNCglhZG1pblRvb2xzVGl0bGU6CQkJCSdBZG1pbmlzdHJhdGlvbiAoQWx0K1NoaWZ0K0EpJywNCglhZG1pblRvb2xzQ29udGVudDoJCQkJJ1RoaXMgYnV0dG9uIG9wZW5zIHRoZSBBZG1pbmlzdHJhdGlvbiB3aW5kb3csIGV4cG9zaW5nIGFkbWluaXN0cmF0b3JzIHRvIGZ1bmN0aW9uYWxpdHkgZm9yIG1hbmFnaW5nIGdyb3VwcywgZGFzaGJvYXJkcywgd2lkZ2V0cywgYW5kIHVzZXJzLicsDQoJaGVscFRpdGxlOgkJCQkJCSdIZWxwIChBbHQrU2hpZnQrSCknLA0KCWhlbHBDb250ZW50OgkJCQkJJ1RoaXMgYnV0dG9uIG9wZW5zIHRoZSBIZWxwIHdpbmRvdywgYWxsb3dpbmcgdXNlcnMgdG8gYnJvd3NlIGhlbHAgZmlsZXMgZm9yIGFzc2lzdGFuY2Ugb24gdXNpbmcgT1dGLicsDQoJc2hhcmVUaXRsZTogCQkJCQknU2hhcmUgRGFzaGJvYXJkJywNCglzaGFyZUNvbnRlbnQ6IAkJCQkJJ1RoaXMgZmVhdHVyZSBhbGxvd3MgYSB1c2VyIHRvIGV4cG9ydCB0aGVpciBjdXJyZW50IGRhc2hib2FyZCBzbyB0aGF0IG90aGVyIHVzZXJzIGNhbiBpbXBvcnQgaXQuJywNCgljdXN0b21pemVEYXNoYm9hcmRUaXRsZToJCSdDdXN0b21pemUgRGFzaGJvYXJkJywNCgljdXN0b21pemVEYXNoYm9hcmRDb250ZW50OiAJCSdUaGlzIHNjcmVlbiBhbGxvd3MgdXNlcnMgdG8gY3VzdG9taXplIHRoZSBjdXJyZW50IGRhc2hib2FyZC4nLA0KCWV2ZW50aW5nVGl0bGU6CQkJCQknRHluYW1pYyBFdmVudGluZycsDQoJZXZlbnRpbmdDb250ZW50OiAJCQkJJ1RoaXMgc2NyZWVuIGFsbG93cyB1c2VycyB0byBtYW5hZ2UgZHluYW1pYyB3aWRnZXQgZXZlbnRpbmcuJywNCiAgICB0aGVtZVNlbGVjdG9yVGl0bGU6ICAgICAgICAgICAgICdDaGFuZ2UgdGhlIHN0eWxpbmcgb2YgeW91ciBPV0YnLA0KICAgIHRoZW1lU2VsZWN0b3JDb250ZW50OiAgICAgICAgICAgJ1RoaXMgc2NyZWVuIGFsbG93cyB1c2VycyB0byBjaGFuZ2UgdGhlIGJhY2tncm91bmQsIHdpbmRvdyBjb2xvciBhbmQgc3R5bGUgZm9yIE9XRi4nLA0KCXNob3dCYW5uZXJUaXRsZTogCQkJCSdTaG93L0hpZGUgQmFubmVyJywNCglzaG93QmFubmVyQ29udGVudDogCQkJCSdUaGlzIGJ1dHRvbiBzaG93cyBhbmQgaGlkZXMgdGhlIGJvdHRvbSB0d28gcm93cyBvZiB0aGUgZGFzaGJvYXJkIGJhbm5lci4nLA0KCWNhcm91c2VsQ2xvc2VDb250ZW50OiAJCQknVGhpcyBidXR0b24gY2xvc2VzIHRoZSB3aWRnZXQgTGF1bmNoIE1lbnUuJywNCgljYXJvdXNlbENsb3NlVGl0bGU6IAkJCSdDbG9zZSBMYXVuY2ggTWVudScsDQoJY2Fyb3VzZWxNYW5hZ2VXaWRnZXRzVGl0bGU6CQknV2lkZ2V0IFNldHRpbmdzJywNCgljYXJvdXNlbE1hbmFnZVdpZGdldHNDb250ZW50OiAJJ1RoaXMgc2NyZWVuIGFsbG93cyB1c2VycyB0byBjdXN0b21pemUgdGhlaXIgTGF1bmNoIE1lbnUsIGNvbnRyb2xsaW5nIHdoaWNoIHdpZGdldHMgYXJlIHZpc2libGUgYW5kIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IGFwcGVhci4gSXQgYWxzbyBhbGxvd3MgZm9yIHRoZSBkZWxldGlvbiBvZiB3aWRnZXRzIGFuZCBjb250YWlucyBhIGxpbmsgdG8gdGhlIE9XRiBNYXJrZXRwbGFjZS4gVGhlIGdyb3VwaW5nIHRhZ3Mgb2YgYSB3aWRnZXQgY2FuIGFsc28gYmUgbW9kaWZpZWQgaW4gdGhpcyBzY3JlZW4uJywNCglhZG1pbldERWRpdFRpdGxlOiAJCQkJJ0VkaXQgV2lkZ2V0IERlZmluaXRpb24nLA0KCWFkbWluV0RFZGl0Q29udGVudDogCQkJJ0NoYW5nZSB0aGUgcHJvcGVydGllcyBvZiBhIHdpZGdldCBkZWZpbml0aW9uLiBOb3RlIHRoYXQgd2hpbGUgcHJvcGVydGllcyBzdWNoIGFzIFVSTHMgd2lsbCBwcm9wYWdhdGUgdG8gYWxyZWFkeSBleGlzdGluZyBpbnN0YW5jZXMgb2YgYSB3aWRnZXQsIG1hbGxlYWJsZSBwcm9wZXJ0aWVzIHN1Y2ggYXMgaGVpZ2h0IHdpbGwgbm90IGJlIGFmZmVjdGVkLicsDQoJYWRtaW5XRERlbGV0ZVRpdGxlOiAJCQknRGVsZXRlIFdpZGdldCBEZWZpbml0aW9uJywNCglhZG1pbldERGVsZXRlQ29udGVudDogCQkJJ0RlbGV0ZXMgdGhlIHNlbGVjdGVkIHdpZGdldCBkZWZpbml0aW9uLiBJbiBhZGRpdGlvbiB0byByZW1vdmluZyB0aGUgZGVmaW5pdGlvbiBpdHNlbGYsIGFsbCBpbnN0YW5jZXMgb2YgdGhpcyB3aWRnZXQgd2lsbCBiZSByZW1vdmVkIGZyb20gYWxsIHVzZXIgZGFzaGJvYXJkcy4nLA0KCWFkbWluRGFzaEFkZFRpdGxlOgkJCQknQWRkIERhc2hib2FyZCcsDQoJYWRtaW5QV0RBcHBseVRpdGxlOgkJCQknQXBwbHkgVXNlciBXaWRnZXRzJywNCiAgICBhZG1pblBXREFwcHJvdmVUaXRsZToJCQknQXBwcm92ZSBVc2VyIFdpZGdldHMnLA0KCWFkbWluRGFzaENvcHlUaXRsZTogCQkJJ0NvcHkgRGFzaGJvYXJkJywNCglhZG1pbkRhc2hDb3B5Q29udGVudDogCQkJJ0NvcHkgYW4gZXhpc3RpbmcgZGFzaGJvYXJkIHRvIG9uZSBvciBtb3JlIHVzZXJzLiBOb3RlIHRoYXQgb25jZSBjb3BpZWQsIGVhY2ggZGFzaGJvYXJkIGluc3RhbmNlIGlzIGFuIGluZGVwZW5kZW50IGVudGl0eS4gQ2hhbmdlcyBtYWRlIHRvIHRoZSBpbml0aWFsIGRhc2hib2FyZCBhdCBhIGxhdGVyIGRhdGUgd2lsbCBub3QgYmUgY29waWVkLicsDQoJYWRtaW5EYXNoRWRpdFRpdGxlOiAJCQknRWRpdCBEYXNoYm9hcmQnLA0KCWFkbWluRGFzaEVkaXRDb250ZW50OiAJCQknQ2hhbmdlcyB0aGUgcHJvcGVydGllcyBvZiBhIGRhc2hib2FyZC4gTm90ZSB0aGF0IGRhc2hib2FyZCBzdGF0ZSBpcyByZXByZXNlbnRlZCBhcyBhIEpTT04gb2JqZWN0LCBhbmQgYW55IGNoYW5nZXMgbWFkZSB0byBpdCBtdXN0IGJlIHZhbGlkIEpTT04uJywNCglhZG1pbkRhc2hEZWxldGVUaXRsZTogCQkJJ0RlbGV0ZSBEYXNoYm9hcmQnLA0KCWFkbWluRGFzaERlbGV0ZUNvbnRlbnQ6IAkJJ0RlbGV0ZXMgdGhlIHNlbGVjdGVkIGRhc2hib2FyZC4gTm90ZSB0aGF0IGlmIGEgdXNlciBpcyBjdXJyZW50bHkgdXNpbmcgdGhlIGRhc2hib2FyZCwgdGhleSB3aWxsIG5vdCBiZSBraWNrZWQgb3V0LiBIb3dldmVyLCBpdCB3aWxsIG5vdCBiZSBhdmFpbGFibGUgb25jZSB0aGV5IG5hdmlnYXRlIGF3YXkuJywNCglhZG1pblByZWZzQ29weVRpdGxlOiAJCQknQ29weSBQcmVmZXJlbmNlJywNCglhZG1pblByZWZzQ29weUNvbnRlbnQ6IAkJCSdDb3B5IGFuIGV4aXN0aW5nIHByZWZlcmVuY2UgdG8gb25lIG9yIG1vcmUgdXNlcnMuIE5vdGUgdGhhdCBvbmNlIGNvcGllZCwgZWFjaCBwcmVmZXJlbmNlIGluc3RhbmNlIGlzIGFuIGluZGVwZW5kZW50IGVudGl0eS4gQ2hhbmdlcyBtYWRlIHRvIHRoZSBpbml0aWFsIHByZWZlcmVuY2UgYXQgYSBsYXRlciBkYXRlIHdpbGwgbm90IGJlIGNvcGllZC4nLA0KCWFkbWluUHJlZnNFZGl0VGl0bGU6IAkJCSdFZGl0IFByZWZlcmVuY2UnLA0KCWFkbWluUHJlZnNFZGl0Q29udGVudDogCQkJJ0NoYW5nZXMgdGhlIHByb3BlcnRpZXMgb2YgYSBwcmVmZXJlbmNlLicsDQoJYWRtaW5QcmVmc0RlbGV0ZVRpdGxlOiAJCQknRGVsZXRlIFByZWZlcmVuY2UuJywNCglhZG1pblByZWZzRGVsZXRlQ29udGVudDogCQknRGVsZXRlcyB0aGUgc2VsZWN0ZWQgcHJlZmVyZW5jZS4nLA0KCWFkbWluVXNlcnNFZGl0VGl0bGU6IAkJCSdFZGl0IFVzZXInLA0KCWFkbWluVXNlcnNFZGl0Q29udGVudDogCQkJJ0NoYW5nZXMgdGhlIHByb3BlcnRpZXMgb2YgYSB1c2VyLiBOb3RlIHRoYXQgdGhpcyBkb2VzIG5vdCBlZGl0IGFueSB1c2VyIGluZm9ybWF0aW9uIGluIGFuIHVuZGVybHlpbmcgc2VjdXJpdHkgaW1wbGVtZW50YXRpb24uIE9ubHkgdGhlIGluZm9ybWF0aW9uIHRoYXQgaXMgc3RvcmVkIGluIHRoZSBmcmFtZXdvcmsgaXRzZWxmIHdpbGwgYmUgY2hhbmdlZC4nLA0KCWFkbWluVXNlcnNEZWxldGVUaXRsZTogCQkJJ0RlbGV0ZSBVc2VyJywNCglhZG1pblVzZXJzRGVsZXRlQ29udGVudDoJCSdEZWxldGVzIGEgZ2l2ZW4gdXNlciBmcm9tIHRoZSBmcmFtZXdvcmsuIE5vdGUgdGhhdCB0aGlzIGRvZXMgbm90IGRlbGV0ZSB0aGUgdXNlciBpbmZvcm1hdGlvbiBpbiBhbiB1bmRlcmx5aW5nIHNlY3VyaXR5IGltcGxlbWVudGF0aW9uLiBPbmx5IHRoZSB1c2VyIGluZm9ybWF0aW9uIHRoYXQgaXMgc3RvcmVkIGluIHRoZSBmcmFtZXdvcmsgaXRzZWxmIHdpbGwgYmUgcmVtb3ZlZC4gSW4gYWRkaXRpb24sIGl0IGlzIHBvc3NpYmxlIHRoYXQgd2l0aCBjZXJ0YWluIHNlY3VyaXR5IGltcGxlbWVudGF0aW9ucyBzdWNoIGFzIHg1MDkgY2VydGlmaWNhdGVzLCBhIHVzZXIgd2lsbCBiZSByZS1jcmVhdGVkIGJ5IHRoZSBmcmFtZXdvcmsgaWYgdGhleSBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlLicsDQoJYWRtaW5Vc2VyV2lkZ2V0c0RlbGV0ZVRpdGxlOiAJJ0RlbGV0ZSBVc2VyIFdpZGdldCcsDQoJYWRtaW5Vc2VyV2lkZ2V0c0RlbGV0ZUNvbnRlbnQ6ICdSZW1vdmVzIGFjY2VzcyB0byB0aGlzIHdpZGdldCBmb3IgYSBnaXZlbiB1c2VyLiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgd2lsbCBub3QgZGVsZXRlIHRoZSB1bmRlcmx5aW5nIHdpZGdldCBkZWZpbml0aW9uIC0gb3RoZXIgdXNlcnMgd2lsbCBzdGlsbCBoYXZlIGFjY2Vzcy4nLA0KCWNsZWFyQ29ubmVjdGlvbnNUaXRsZTogCSdDbGVhciBBbGwgQ29ubmVjdGlvbnMnLA0KCWNsZWFyQ29ubmVjdGlvbnNDb250ZW50OiAnUmVtb3ZlcyBhbGwgZGlyZWN0ZWQgZHluYW1pYyBldmVudGluZyBjb25uZWN0aW9ucyBiZXR3ZWVuIHRoZSB3aWRnZXRzIG9uIHRoaXMgZGFzaGJvYXJkLicsDQogICAgICAgIGJhbm5lckRvY2tUaXRsZTogICAgICAgICAgICAgICAgICAgICAgICAnRG9jaycsDQogICAgICAgIGJhbm5lckRvY2tDb250ZW50OiAgICAgICAgICAgICAgICAgICAgICAnRG9jayB0b29sYmFyIHRvIGJhbm5lciBhdCB0b3Agb2YgcGFnZS4nLA0KICAgICAgICBiYW5uZXJVbmRvY2tUaXRsZTogICAgICAgICAgICAgICAgICAgICAgJ1VuZG9jaycsDQogICAgICAgIGJhbm5lclVuZG9ja0NvbnRlbnQ6ICAgICAgICAgICAgICAgICAgICAnVW5kb2NrIHRvb2xiYXIgdG8gZmxvYXRpbmcgcG9zaXRpb24gYW5kIGhpZGUgYmFubmVyLicNCn07DQoNCk96b25lLmxheW91dC5hZG1pbiA9IHsNCgl1cGRhdGVEYXNoYm9hcmRUaXRsZTogCQkJJ1VwZGF0ZSBEYXNoYm9hcmQnLA0KCWRhc2hib2FyZFVwZGF0ZWRDb250ZW50OiAJCSdEYXNoYm9hcmQgdXBkYXRlZCBzdWNjZXNzZnVsbHkuJw0KfTsNCg0KT3pvbmUudXguRGFzaGJvYXJkTWdtdFN0cmluZyA9IHsNCiAgICBjcmVhdGVEYXNoYm9hcmQgOiAnQ3JlYXRlIGEgRGFzaGJvYXJkJywgDQogICAgc2VsZWN0RGFzaGJvYXJkRG90RG90IDogJ1NlbGVjdCBhIGRhc2hib2FyZC4uLicsDQogICAgZGVsZXRlRGFzaGJvYXJkIDogJ0RlbGV0ZSBhIERhc2hib2FyZCcsIA0KICAgIGltcG9ydGFEYXNoYm9hcmQgOiAnSW1wb3J0IGEgRGFzaGJvYXJkJywNCiAgICBleHBvcnREYXNoYm9hcmQgOiAnRXhwb3J0IEN1cnJlbnQgRGFzaGJvYXJkJywgDQogICAgZXhwb3J0RGFzaGJvYXJkQ29uZmlnIDogJ0V4cG9ydCBEYXNoYm9hcmQgQ29uZmlndXJhdGlvbicsIA0KICAgIHVwbG9hZENvbmZpZyA6ICdVcGxvYWQuLi4nLCANCiAgICBzZXRBc0RlZmF1bHQgOiAnU2V0IGFzIGRlZmF1bHQnLCANCiAgICBkYXNoYm9hcmRzIDogJ0Rhc2hib2FyZHMnLCANCiAgICB0aXRsZSA6ICdUaXRsZScsIA0KICAgIGxheW91dCA6ICdMYXlvdXQnLCANCiAgICBkZXNjcmlwdGlvbiA6ICdEZXNjcmlwdGlvbicsDQogICAgdG9wIDogJ1RvcCcsIA0KICAgIGJvdHRvbSA6ICdCb3R0b20nLCANCiAgICBjb2x1bW5zIDogJ0NvbHVtbnMnLCANCiAgICBhcnJhbmdlbWVudCA6ICdBcnJhbmdlbWVudCcsIA0KICAgIHNlbGVjdERhc2hib2FyZCA6ICdTZWxlY3QgRGFzaGJvYXJkJywgDQogICAgYWNjb3JkaW9uIDogJ0FjY29yZGlvbicsIA0KICAgIHBvcnRhbCA6ICdQb3J0YWwnLCANCiAgICB0YWJiZWQgOiAnVGFiYmVkJywgDQogICAgZGVza3RvcCA6ICdEZXNrdG9wJywgDQogICAgZml0IDogJ0ZpdCcsIA0KCXRvb2x0aXBNYW5hZ2VEYXNoYm9hcmRzOiAnRGFzaGJvYXJkIFNldHRpbmdzJywNCgl0b29sdGlwQ3JlYXRlRGFzaGJvYXJkOiAnQ3JlYXRlIERhc2hib2FyZCcsDQoJDQogICAgb2sgOiAnT0snLCANCiAgICByZXNldCA6ICdSZXNldCcsDQogICAgYWJvdXQ6ICdBYm91dCcsIA0KICAgIGxvZ291dDogJ0xvZ291dCcsIA0KICAgIGltcG9ydERhc2hib2FyZCA6ICdJbXBvcnQgRGFzaGJvYXJkJywgDQogICAgZGFzaGJvYXJkVGl0bGUgOiAnRGFzaGJvYXJkIFRpdGxlJywgDQogICAgZW50ZXJEYXNoYm9hcmRUaXRsZSA6ICdFbnRlciBEYXNoYm9hcmQgVGl0bGUuLi4nLA0KICAgIGJyb3dzZSA6ICdCcm93c2UuLi4nLCANCgkNCglsb2FkRGVmYXVsdE1zZyA6ICdMb2FkIERlZmF1bHQgQ29uZmlndXJhdGlvbj8nLA0KCW5vRGFzaGJvYXJkU2VsZWN0ZWRNc2cgOiAnTm8gY29uZmlndXJhdGlvbiB3YXMgc2VsZWN0ZWQuICBEbyB5b3Ugd2FudCB0byBsb2FkIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24/JywNCgljaGFuZ2VMYW5ndWFnZSA6ICdDaGFuZ2UgTGFuZ3VhZ2UnLA0KCWVzIDogJ1NwYW5pc2gnLA0KCWVuX1VTIDogJ0VuZ2xpc2gnLA0KCWtvIDogJ0tvcmVhbicNCn07DQoNCk96b25lLmxheW91dC5BY2NvcmRpb25XaW5kb3dNYW5hZ2VyU3RyaW5nID0gew0KICAgIGNvbmZpZ3VyZUFjY29yZGlvbiA6ICdDb25maWd1cmUgQWNjb3JkaW9uJyANCn07DQoNCk96b25lLmxheW91dC5Qb3J0YWxXaW5kb3dNYW5hZ2VyU3RyaW5nID0gew0KICAgIGNvbmZpZ3VyZVBvcnRsZXRzIDogJ0NvbmZpZ3VyZSBQb3J0bGV0cycgICAgDQp9Ow0KDQpPem9uZS5sYXlvdXQuVGFiYmVkV2luZG93TWFuYWdlclN0cmluZyA9IHsNCiAgICBjb25maWd1cmVUYWJzIDogJzxzcGFuIGNsYXNzPSJjb25maWd1cmVUYWJCdXR0b24iPkNvbmZpZ3VyZSBUYWJzPC9zcGFuPicgICANCn07DQoNCk96b25lLnV0aWwuRXJyb3JNZXNzYWdlU3RyaW5nID0gew0KCWVycm9yVGl0bGUgOiAnRXJyb3InLA0KCWRhc2hib2FyZENvbmZpZyA6ICdEYXNoYm9hcmQgQ29uZmlndXJhdGlvbicsDQoJd2lkZ2V0Q29uZmlndXJhdGlvbiA6ICdXaWRnZXQgQ29uZmlndXJhdGlvbicsIA0KCW5vV2lkZ2V0cyA6ICdUaGVyZSBhcmUgbm8gd2lkZ2V0cyB0byB3aGljaCB5b3UgaGF2ZSBhY2Nlc3MuJywgDQoJY29uZmlndXJhdGlvbk1zZyA6ICdGYWlsZWQgdG8gcmV0cmlldmUgY29uZmlndXJhdGlvbiBkYXRhJywgDQoJZGFzaGJvYXJkQmxhbmtNc2c6ICdJbnZhbGlkIERhc2hib2FyZCBOYW1lLCBpdCBjYW5ub3QgYmUgYmxhbmsuIDxiciAvPlBsZWFzZSBwcm92aWRlIGEgdmFsaWQgRGFzaGJvYXJkIE5hbWUuJywNCglkYXNoYm9hcmRJbnZhbGlkRW50cnlNc2c6ICJVbmFibGUgdG8gdXBkYXRlIGRhc2hib2FyZCBuYW1lKHMpIGR1ZSA8YnIvPnRvIGludmFsaWQgY2hhcmFjdGVycy4iLA0KCWludmFsaWRGb3JtIDogJ0ludmFsaWQgRm9ybScsDQoJaW52YWxpZEZvcm1Nc2cgOiAnRm9ybSBpcyBpbnZhbGlkLiAgUGxlYXNlIG1ha2Ugc3VyZSBhbGwgcmVxdWlyZWQgZmllbGRzIGFyZSBjb21wbGV0ZWQuJywNCglsYW5ndWFnZVByZWZlcmVuY2UgOiAnTGFuZ3VhZ2UgUHJlZmVyZW5jZScsDQoJbGFuZ3VhZ2VQcmVmZXJlbmNlTXNnIDogJ0Vycm9yIHNhdmluZyBsYW5ndWFnZSBwcmVmZXJlbmNlJywNCglzZXR0aW5nU2Vzc2lvbkRhdGFNc2cgOiAnRXJyb3Igc2V0dGluZyBzZXNzaW9uIGRhdGEnLA0KCXJldHJpZXZpbmdTZXNzaW9uRGF0YU1zZyA6ICdFcnJvciByZXRyaWV2aW5nIHNlc3Npb24gZGF0YScsDQoJc2F2ZVVzZXJQcmVmZXJlbmNlcyA6ICdFcnJvciBzYXZpbmcgdXNlciBwcmVmZXJlbmNlJywNCglzdG9yZUVycm9yTXNnIDogJ1N0b3JlIEVycm9yIE1lc3NhZ2UnLA0KCXNlbmRBbmRGb3JnZXQgOiAnU2VuZCBhbmQgRm9yZ2V0JywNCgl1c2VyTmFtZSA6ICdVc2VyIE5hbWUnLA0KCXVwZGF0ZURhc2hib2FyZE1zZyA6ICdFcnJvciB1cGRhdGluZyBkYXNoYm9hcmQnLA0KCXNhdmVVcGRhdGVkVmlld3MgOiAnVXBkYXRlIERhc2hib2FyZHMnLA0KCXNhdmVVcGRhdGVkVmlld3NNc2cgOiAnRXJyb3IgdXBkYXRpbmcgRGFzaGJvYXJkcycsDQoJc2F2ZVVwZGF0ZWRXaWRnZXRzIDogJ1VwZGF0ZSBXaWRnZXRzJywNCglzYXZlVXBkYXRlZFdpZGdldHNNc2cgOiAnRXJyb3IgdXBkYXRpbmcgd2lkZ2V0cycsDQoJcmV0cmlldmVVcGRhdGVkV2lkZ2V0cyA6ICdSZXRyaWV2aW5nIFVwZGF0ZWQgV2lkZ2V0cycsDQoJcmV0cmlldmVVcGRhdGVkV2lkZ2V0c01zZyA6ICdFcnJvciByZXRyaWV2aW5nIHVwZGF0ZWQgd2lkZ2V0cycsDQoJaW52YWxpZFVybDogJ0ludmFsaWQgVXJsJywNCglpbnZhbGlkVXJsTXNnOiAnVGhlIGRhc2hib2FyZCBjYW4gbm90IGJlIGZvdW5kLiBJdCBtYXkgaGF2ZSBiZWVuIGRlbGV0ZWQuIFlvdSB3aWxsIGJlIHJlZGlyZWN0ZWQgdG8geW91ciBkZWZhdWx0IGRhc2hib2FyZC4nLA0KICAgIGludmFsaWREYXNoYm9hcmQ6ICdJbnZhbGlkIERhc2hib2FyZCBJZCcsDQogICAgaW52YWxpZERhc2hib2FyZEdvdG9EZWZhdWx0TXNnOiAnVGhlIGRhc2hib2FyZCBjYW4gbm90IGJlIGZvdW5kLiBJdCBtYXkgaGF2ZSBiZWVuIGRlbGV0ZWQuIFlvdSB3aWxsIGJlIHJlZGlyZWN0ZWQgdG8geW91ciBkZWZhdWx0IGRhc2hib2FyZC4nLA0KICAgIGludmFsaWREYXNoYm9hcmRNc2c6ICdUaGUgZGFzaGJvYXJkIGNhbiBub3QgYmUgZm91bmQuIEl0IG1heSBoYXZlIGJlZW4gZGVsZXRlZC4gWW91IHdpbGwgYmUgcmVkaXJlY3RlZCB0byB0aGUgcHJldmlvdXMgZGFzaGJvYXJkJywNCglpbnZhbGlkRGFzaGJvYXJkTmFtZU1zZzogJ0Rhc2hib2FyZCBuYW1lIGlzIGludmFsaWQuICBJdCBjYW5ub3QgaW5jbHVkZSBzdGFydCBvciBlbmQgd2l0aCBhIHNwYWNlLicsDQoJbGVhZGluZ09yVHJhaWxpbmdXaGl0ZVNwYWNlc01zZyA6ICdMZWFkaW5nIG9yIHRyYWlsaW5nIHNwYWNlcyBhcm91bmQgZGFzaGJvYXJkIG5hbWUgYXJlIG5vdCBhbGxvd2VkJywNCglsb2dvdXRFcnJvcjogJ0xvZ291dCBFcnJvcicsDQoJbG9nb3V0RXJyb3JNc2c6ICdQbGVhc2UgY2xvc2UgeW91ciBicm93c2VyIHRvIGVuc3VyZSBsb2dvdXQgc3VjY2Vzcy4nLA0KCXdpZGdldE5hbWUgOiAnV2lkZ2V0IE5hbWUnLA0KCW1heGltdW1MZW5ndGggOiAnVGhlIG1heGltdW0gbGVuZ3RoIGZvciB0aGlzIGZpZWxkIGlzIHswfScsDQoJYWJvdXQgOiAnQWJvdXQnLA0KCWFib3V0RXJyb3JNc2c6ICdFcnJvciByZXRyaWV2aW5nIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLicsDQoJd2lkZ2V0Tm90QXBwcm92ZWQ6ICdUaGlzIHdpZGdldCBoYXMgbm90IHlldCBiZWVuIGFwcHJvdmVkIGZvciB1c2UuICBQbGVhc2Ugc2VlIGEgc3lzdGVtIGFkbWluaXN0cmF0b3IgZm9yIGFwcHJvdmFsLicsDQogICAgcmVzdHJpY3RlZFRhZ0Vycm9yOiAnIGlzIGEgcmVzdHJpY3RlZCB0YWcuICBZb3UgbWF5IG5vdCBlZGl0IGl0IG9yIGFkZCBpdCB0byBvdGhlciB3aWRnZXRzJywNCiAgICBtcEVycm9yVGl0bGU6ICdNYXJrZXRwbGFjZSBFcnJvcicsDQogICAgbXBFcnJvck1zZzogJ1RoZXJlIGhhcyBiZWVuIGFuIGVycm9yIGFjY2Vzc2luZyBNYXJrZXRwbGFjZS4gUGxlYXNlIGNvbnRhY3QgeW91ciBTeXN0ZW0gQWRtaW5pc3RyYXRvciB0byB2ZXJpZnkgdGhhdCBNYXJrZXRwbGFjZSBjb25uZWN0aXZpdHkgaGFzIGJlZW4gY29ycmVjdGx5IGNvbmZpZ3VyZWQgYW5kIHRoYXQgdGhlIE1hcmtldHBsYWNlIHNlcnZlciBpcyBjdXJyZW50bHkgcnVubmluZy4nLA0KICAgIG9uZVNpbmdsZXRvbjogJ09ubHkgb25lIGluc3RhbmNlIG9mIGEgU2luZ2xldG9uIGlzIHBlcm1pdHRlZCcNCn07DQoNCk96b25lLmxheW91dC5NZXNzYWdlQm94QnV0dG9uVGV4dCA9IHsNCglvazogJ09LJywNCgljYW5jZWwgOiAnQ2FuY2VsJywNCiAgICB5ZXMgOiAnWWVzJywNCiAgICBubyA6ICdObycNCn07DQoNCk96b25lLmxheW91dC5EaWFsb2dNZXNzYWdlcyA9IHsNCgl1cGRhdGU6ICdVcGRhdGUnLA0KCXVwZGF0aW5nOiAnVXBkYXRpbmcuLi4nLA0KCXVwZGF0ZWQ6ICdVcGRhdGVkJywNCglhZGQ6ICdBZGQnLA0KCWFkZGluZyA6ICdBZGRpbmcuLi4nLA0KCWFkZGVkOiAnQWRkZWQnLA0KCWFkZGVkX2NvbG9uOiAnQWRkZWQ6JywNCiAgICBhZGRlZF9zdWNjZXNzZnVsbHk6ICdhZGRlZCBzdWNjZXNzZnVsbHknLA0KCWNvcHk6ICdDb3B5JywNCiAgICBjb3B5aW5nIDogJ0NvcHlpbmcuLi4nLA0KICAgIGNvcGllZDogJ0NvcGllZCcsDQogICAgY2FuY2VsOiAnQ2FuY2VsJywNCiAgICBvazogJ09LJywNCiAgICBlcnJvcjogJ0Vycm9yJywNCiAgICBhZGRXaWRnZXQ6ICdBZGQgV2lkZ2V0JywNCiAgICBlZGl0V2lkZ2V0OiAnRWRpdCBXaWRnZXQnLA0KICAgIHJlbW92ZWRfY29sb246ICdSZW1vdmVkOicsDQogICAgcmV0YWluZWRfY29sb246ICdSZXRhaW5lZDonLA0KICAgIGFwcGxpZWRfY29sb246ICdBcHBsaWVkOicsDQogICAgdXBkYXRlZF9zdWNjZXNzZnVsbHk6ICd1cGRhdGVkIHN1Y2Nlc3NmdWxseScsDQogICAgYWRkZWRfZm9yOiAnYWRkZWQgZm9yJywNCiAgICBmb3JtSW52YWxpZF9DaGVja0ZpZWxkTWVzc2FnZXM6ICdGb3JtIEludmFsaWQuPGJyIC8+Q2hlY2sgaGlnaGxpZ2h0ZWQgZmllbGQgbWVzc2FnZXMgKCEpLicsDQogICAgZm9ybUludmFsaWRfU2VsZWN0T25lVXNlcjogJ0Zvcm0gSW52YWxpZC48YnIgLz5Zb3UgbmVlZCB0byBzZWxlY3QgYXQgbGVhc3QgMSB1c2VyLicsDQogICAgZm9ybUludmFsaWRfU2VsZWN0T25lV2lkZ2V0OiAnRm9ybSBJbnZhbGlkLjxiciAvPllvdSBuZWVkIHRvIHNlbGVjdCBhdCBsZWFzdCAxIHdpZGdldC4nLA0KICAgIHZpZXc6ICdEYXNoYm9hcmQnLA0KICAgIHZpZXdfc3RhdHVzOiAnRGFzaGJvYXJkIFN0YXR1cycsDQogICAgdmlld19kYXNoYm9hcmROYW1lRmllbGRfbGFiZWw6ICdEYXNoYm9hcmQgbmFtZScsDQogICAgdmlld19kYXNoYm9hcmROYW1lRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIERhc2hib2FyZCBOYW1lJywNCiAgICB2aWV3X2Rhc2hib2FyZFN0YXRlRmllbGRfbGFiZWw6ICdDb25maWd1cmF0aW9uJywNCiAgICB2aWV3X2Rhc2hib2FyZFN0YXRlRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIERhc2hib2FyZCBDb25maWd1cmF0aW9uJywNCiAgICB2aWV3X2Rhc2hib2FyZEd1aWRGaWVsZF9sYWJlbDogJ0dVSUQnLA0KICAgIHZpZXdfZGFzaGJvYXJkTGF5b3V0RmllbGRfbGFiZWw6ICdMYXlvdXQnLA0KICAgIHZpZXdfZGFzaGJvYXJkSXNEZWZhdWx0RmllbGRfbGFiZWw6ICdEZWZhdWx0JywNCiAgICBmb3JtRXJyb3Jfc2F2ZVZpZXc6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIHNhdmUgYSBkYXNoYm9hcmQuJywNCiAgICB1c2VyOiAnVXNlcicsDQogICAgdXNlcnNfb3B0OiAndXNlcihzKScsDQogICAgdXNlcl9zdGF0dXM6ICdVc2VyIFN0YXR1cycsDQogICAgdXNlcl91c2VybmFtZUZpZWxkX2xhYmVsOiAnVXNlciBJRCcsDQogICAgdXNlcl91c2VybmFtZUZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBVc2VyIElEJywNCiAgICB1c2VyX3VzZXJSZWFsTmFtZUZpZWxkX2xhYmVsOiAnTmFtZScsIA0KICAgIHVzZXJfdXNlclJlYWxOYW1lRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIG5hbWUgZm9yIHRoZSB1c2VyJywNCiAgICBmb3JtRXJyb3Jfc2F2ZVVzZXI6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIHNhdmUgYSB1c2VyLicsDQogICAgcHJlZmVyZW5jZTogJ1ByZWZlcmVuY2UnLA0KICAgIHByZWZlcmVuY2VfcHJlZmVyZW5jZU5hbWVGaWVsZF9sYWJlbDogJ1ByZWZlcmVuY2UgTmFtZScsDQogICAgcHJlZmVyZW5jZV9wcmVmZXJlbmNlTmFtZUZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBQcmVmZXJlbmNlIE5hbWUnLA0KICAgIHByZWZlcmVuY2VfcHJlZmVyZW5jZU5hbWVzcGFjZUZpZWxkX2xhYmVsOiAnTmFtZXNwYWNlJywNCiAgICBwcmVmZXJlbmNlX3ByZWZlcmVuY2VOYW1lc3BhY2VGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgUHJlZmVyZW5jZSBOYW1lc3BhY2UnLA0KICAgIHByZWZlcmVuY2VfcHJlZmVyZW5jZVZhbHVlRmllbGRfbGFiZWw6ICdWYWx1ZScsDQogICAgcHJlZmVyZW5jZV9wcmVmZXJlbmNlVmFsdWVGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgUHJlZmVyZW5jZSBWYWx1ZScsDQogICAgcHJlZmVyZW5jZV9zdGF0dXM6ICdQcmVmZXJlbmNlIFN0YXR1cycsDQogICAgZm9ybUVycm9yX3NhdmVQcmVmZXJlbmNlOiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYXR0ZW1wdGluZyB0byBzYXZlIGEgcHJlZmVyZW5jZS4nLA0KICAgIHdpZGdldERlZmluaXRpb246ICdXaWRnZXQgRGVmaW5pdGlvbicsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9zdGF0dXM6ICdXaWRnZXQgU3RhdHVzJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZGdldEFjY2VzczogJ1dpZGdldCBBY2Nlc3MnLA0KICAgIHdpZGdldERlZmluaXRpb25fZGVzY3JpcHRvclVybEZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBXaWRnZXQgRGVzY3JpcHRvciBVUkwnLA0KICAgIHdpZGdldERlZmluaXRpb25fZGlzcGxheU5hbWVGaWVsZF9sYWJlbDogJ1dpZGdldCBOYW1lJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZGdldFZlcnNpb25GaWVsZF9sYWJlbDogJ1ZlcnNpb24nLA0KICAgIHdpZGdldERlZmluaXRpb25fZGlzcGxheU5hbWVGaWVsZF9ibGFua1RleHQ6ICdQbGVhc2Ugc3VwcGx5IGEgV2lkZ2V0IE5hbWUnLA0KICAgIHdpZGdldERlZmluaXRpb25fd2lkZ2V0VmVyc2lvbkZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBXaWRnZXQgVmVyc2lvbicsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWRnZXRHdWlkRmllbGRfbGFiZWw6ICdHVUlEJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZGdldFVybEZpZWxkX2xhYmVsOiAnVVJMJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZGdldFVybEZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBXaWRnZXQgVVJMJywNCiAgICB3aWRnZXREZWZpbml0aW9uX2ltYWdlVXJsU21hbGxGaWVsZF9sYWJlbDogJ0NvbnRhaW5lciBJY29uIFVSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9pbWFnZVVybFNtYWxsRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIENvbnRhaW5lciBJY29uIFVSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9pbWFnZUxhcmdlVXJsRmllbGRfbGFiZWw6ICdMYXVuY2ggTWVudSBJY29uIFVSTCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl9pbWFnZUxhcmdlVXJsRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIExhdW5jaCBNZW51IEljb24gVVJMJywNCiAgICB3aWRnZXREZWZpbml0aW9uX3dpZHRoTnVtYmVyRmllbGRfbGFiZWw6ICdXaWR0aCcsDQogICAgd2lkZ2V0RGVmaW5pdGlvbl93aWR0aE51bWJlckZpZWxkX2JsYW5rVGV4dDogJ1BsZWFzZSBzdXBwbHkgYSBXaWRnZXQgd2lkdGgnLA0KICAgIHdpZGdldERlZmluaXRpb25faGVpZ2h0TnVtYmVyRmllbGRfbGFiZWw6ICdIZWlnaHQnLA0KICAgIHdpZGdldERlZmluaXRpb25faGVpZ2h0TnVtYmVyRmllbGRfYmxhbmtUZXh0OiAnUGxlYXNlIHN1cHBseSBhIFdpZGdldCBoZWlnaHQnICwNCiAgICB3aWRnZXREZWZpbml0aW9uX3NlY3VyZVVybF93YXJuaW5nVGV4dDogJ0VudGVyaW5nIGEgc2VjdXJlIEhUVFBTIGFkZHJlc3MgbWF5IHByZXZlbnQgYnJvd3NlciBzZWN1cml0eSB3YXJuaW5ncyBzdWNoIGFzICJUaGlzIHBhZ2UgY29udGFpbnMgdW5zZWN1cmUgY29udGVudC4iJyAsDQogICAgcGVyc29uV2lkZ2V0RGVmX0FwcGx5OiAnQXBwbHknLA0KICAgIHBlcnNvbldpZGdldERlZl9PcmRlcjogJ09yZGVyJywNCiAgICBwZXJzb25XaWRnZXREZWZfV2lkZ2V0OiAnV2lkZ2V0JywNCiAgICBwZXJzb25XaWRnZXREZWZfV2lkZ2V0QWNjZXNzQXBwbGllZDogJ1dpZGdldCBBY2Nlc3MgQXBwbGllZCcsDQogICAgcGVyc29uV2lkZ2V0RGVmX0FwcGx5U3RhdHVzOiAnQXBwbHkgU3RhdHVzJywNCiAgICBwZXJzb25XaWRnZXREZWZfTm9DaGFuZ2VzTmVjZXNzYXJ5OiAnTm8gY2hhbmdlcyB3ZXJlIG5lY2Vzc2FyeScsIA0KICAgIGZvcm1FcnJvcl9zYXZlUGVyc29uRGVmV2lkZ2V0czogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGF0dGVtcHRpbmcgdG8gc2F2ZSB1c2VyIHdpZGdldChzKS4nLA0KICAgIGZvcm1FcnJvcl9zYXZlV2lkZ2V0RGVmaW5pdGlvbjogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGF0dGVtcHRpbmcgdG8gc2F2ZSB0aGUgd2lkZ2V0LicsDQogICAgcGVyc29uV2lkZ2V0RGVmX1dpZGdldENvbnRhaW5lclBhbmVsVGl0bGU6ICdXaWRnZXRzJywNCgltYXJrZXRwbGFjZVdpbmRvd19BZGRXaWRnZXQ6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIGFkZCB0aGUgd2lkZ2V0IGZyb20gTWFya2V0cGxhY2UuJywNCgltYXJrZXRwbGFjZVdpbmRvd19jdXJyZW50VXNlcjogJ0NvdWxkIG5vdCByZXRyaWV2ZSBjdXJyZW50IHVzZXIgbmFtZSBhbmQgaWQuJywNCiAgICBtYXJrZXRwbGFjZVdpbmRvd19BZGRTdWNjZXNzZnVsOiAnVGhlIHdpZGdldCB3YXMgYWRkZWQgc3VjY2Vzc2Z1bGx5IGZyb20gTWFya2V0cGxhY2UnLA0KCXdpZGdldEFkZGVkOiAnU2VsZWN0ZWQgd2lkZ2V0IGlzIGFscmVhZHkgYWRkZWQgZm9yIHRoaXMgdXNlcicsDQoJbWFya2V0cGxhY2VXaW5kb3dfUmVxdWlyZWRMaXN0aW5nc0FsZXJ0TXNnOiAnVGhlIHdpZGdldCB5b3UgaGF2ZSBsYXVuY2hlZCB3aWxsIG5vdCB3b3JrIHdpdGhvdXQgc29tZSBkZXBlbmRlbmNpZXMuICBUaGVzZSB3aWRnZXRzIGFyZSBsaXN0ZWQgYmVsb3cgYW5kIHdpbGwgYmUgYWRkaXRpb25hbGx5IGFkZGVkIHRvIHRoZSBsYXVuY2ggbWVudS4nLA0KICAgIGZpdFBhbmVGdWxsV2FybmluZzogJ1lvdSBhcmUgYXR0ZW1wdGluZyB0byBhZGQgYSB3aWRnZXQgdG8gYSBwYW5lIHdpdGggYSBzaW5nbGUtd2lkZ2V0IGxheW91dC4gQ29udGludWluZyB3aWxsIHJlcGxhY2UgdGhlIGV4aXN0aW5nIHdpZGdldC4nLA0KICAgIGRhc2hib2FyZExvY2tUaXRsZTogJ0xvY2sgRGFzaGJvYXJkJywNCiAgICBkYXNoYm9hcmRMb2NrV2FybmluZzogJ0xvY2tpbmcgdGhpcyBkYXNoYm9hcmQgZGlzYWJsZXMgdGhlIExhdW5jaCBNZW51LiBOZXcgd2lkZ2V0cyBjYW5ub3QgYmUgbGF1bmNoZWQgb3IgYWRkZWQgdG8gdGhpcyBsYXlvdXQuIERvIHlvdSBzdGlsbCB3YW50IHRvIGxvY2sgdGhpcyBkYXNoYm9hcmQ/JywNCiAgICBkYXNoYm9hcmRMb2NrQWxlcnRUaXRsZTogJ0xvY2tlZCBEYXNoYm9hcmQnLA0KICAgIGRhc2hib2FyZExvY2tBbGVydDogJ1RoaXMgZGFzaGJvYXJkIGlzIGxvY2tlZC4gV2lkZ2V0cyBjYW5ub3QgYmUgYWRkZWQgb3IgcmVtb3ZlZCBmcm9tIGEgbG9ja2VkIGRhc2hib2FyZC4nLA0KICAgIGNsb3NlQmFja2dyb3VuZFdpZGdldFdhcm5pbmc6ICcgaXMgYSBiYWNrZ3JvdW5kIHdpZGdldC4gWW91IHdvbuKAmXQgc2VlIGl0IG9uIHlvdXIgc2NyZWVuIGJlY2F1c2UgaXQgcnVucyBiZWhpbmQgdGhlIHNjZW5lcy48YnIvPjxici8+VG8gY2xvc2UgdGhlIHdpZGdldCwgY2xpY2sgT0suJw0KfTsNCg0KT3pvbmUubGF5b3V0LlRoZW1lU3dpdGNoZXJXaW5kb3dDb25zdGFudHMgPSB7DQogICAgdGl0bGU6ICdUaGVtZSBTZXR0aW5ncycsDQogICAgaGVhZGVyOiAnQ2hhbmdlIHRoZSBzdHlsaW5nIG9mIHlvdXIgT1dGJywNCiAgICBzdWJoZWFkZXI6ICdTZWxlY3QgYSB0aGVtZSBiZWxvdyB0byBjaGFuZ2UgdGhlIGJhY2tncm91bmQsIHdpbmRvdyBjb2xvciwgYW5kIHN0eWxlIGZvciBPV0YuJywNCiAgICBvazogJ09LJywNCiAgICBjYW5jZWw6ICdDYW5jZWwnDQp9Ow0KCi8qKg0KICogVmVyc2lvbjogMS4wIEFscGhhLTEgDQogKiBCdWlsZCBEYXRlOiAxMy1Ob3YtMjAwNw0KICogQ29weXJpZ2h0IChjKSAyMDA2LTIwMDcsIENvb2xpdGUgSW5jLiAoaHR0cDovL3d3dy5jb29saXRlLmNvbS8pLiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KICogTGljZW5zZTogTGljZW5zZWQgdW5kZXIgVGhlIE1JVCBMaWNlbnNlLiBTZWUgbGljZW5zZS50eHQgYW5kIGh0dHA6Ly93d3cuZGF0ZWpzLmNvbS9saWNlbnNlLy4gDQogKiBXZWJzaXRlOiBodHRwOi8vd3d3LmRhdGVqcy5jb20vIG9yIGh0dHA6Ly93d3cuY29vbGl0ZS5jb20vZGF0ZWpzLw0KICovDQpEYXRlLkN1bHR1cmVJbmZvID0gewoJLyogQ3VsdHVyZSBOYW1lICovCiAgICBuYW1lOiAiZW4tVVMiLAogICAgZW5nbGlzaE5hbWU6ICJFbmdsaXNoIChVbml0ZWQgU3RhdGVzKSIsCiAgICBuYXRpdmVOYW1lOiAiRW5nbGlzaCAoVW5pdGVkIFN0YXRlcykiLAogICAgCiAgICAvKiBEYXkgTmFtZSBTdHJpbmdzICovCiAgICBkYXlOYW1lczogWyJTdW5kYXkiLCAiTW9uZGF5IiwgIlR1ZXNkYXkiLCAiV2VkbmVzZGF5IiwgIlRodXJzZGF5IiwgIkZyaWRheSIsICJTYXR1cmRheSJdLAogICAgYWJicmV2aWF0ZWREYXlOYW1lczogWyJTdW4iLCAiTW9uIiwgIlR1ZSIsICJXZWQiLCAiVGh1IiwgIkZyaSIsICJTYXQiXSwKICAgIHNob3J0ZXN0RGF5TmFtZXM6IFsiU3UiLCAiTW8iLCAiVHUiLCAiV2UiLCAiVGgiLCAiRnIiLCAiU2EiXSwKICAgIGZpcnN0TGV0dGVyRGF5TmFtZXM6IFsiUyIsICJNIiwgIlQiLCAiVyIsICJUIiwgIkYiLCAiUyJdLAogICAgCiAgICAvKiBNb250aCBOYW1lIFN0cmluZ3MgKi8KICAgIG1vbnRoTmFtZXM6IFsiSmFudWFyeSIsICJGZWJydWFyeSIsICJNYXJjaCIsICJBcHJpbCIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1Z3VzdCIsICJTZXB0ZW1iZXIiLCAiT2N0b2JlciIsICJOb3ZlbWJlciIsICJEZWNlbWJlciJdLAogICAgYWJicmV2aWF0ZWRNb250aE5hbWVzOiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sCgoJLyogQU0vUE0gRGVzaWduYXRvcnMgKi8KICAgIGFtRGVzaWduYXRvcjogIkFNIiwKICAgIHBtRGVzaWduYXRvcjogIlBNIiwKCiAgICBmaXJzdERheU9mV2VlazogMCwKICAgIHR3b0RpZ2l0WWVhck1heDogMjAyOSwKICAgIAogICAgLyoqCiAgICAgKiBUaGUgZGF0ZUVsZW1lbnRPcmRlciBpcyBiYXNlZCBvbiB0aGUgb3JkZXIgb2YgdGhlIAogICAgICogZm9ybWF0IHNwZWNpZmllcnMgaW4gdGhlIGZvcm1hdFBhdHRlcm5zLkRhdGVQYXR0ZXJuLiAKICAgICAqCiAgICAgKiBFeGFtcGxlOgogICAgIDxwcmU+CiAgICAgc2hvcnREYXRlUGF0dGVybiAgICBkYXRlRWxlbWVudE9yZGVyCiAgICAgLS0tLS0tLS0tLS0tLS0tLS0tICAtLS0tLS0tLS0tLS0tLS0tIAogICAgICJNL2QveXl5eSIgICAgICAgICAgIm1keSIKICAgICAiZGQvTU0veXl5eSIgICAgICAgICJkbXkiCiAgICAgInl5eXktTU0tZGQiICAgICAgICAieW1kIgogICAgIDwvcHJlPgogICAgICogVGhlIGNvcnJlY3QgZGF0ZUVsZW1lbnRPcmRlciBpcyByZXF1aXJlZCBieSB0aGUgcGFyc2VyIHRvCiAgICAgKiBkZXRlcm1pbmUgdGhlIGV4cGVjdGVkIG9yZGVyIG9mIHRoZSBkYXRlIGVsZW1lbnRzIGluIHRoZQogICAgICogc3RyaW5nIGJlaW5nIHBhcnNlZC4KICAgICAqIAogICAgICogTk9URTogSXQgaXMgVkVSWSBpbXBvcnRhbnQgdGhpcyB2YWx1ZSBiZSBjb3JyZWN0IGZvciBlYWNoIEN1bHR1cmUuCiAgICAgKi8KICAgIGRhdGVFbGVtZW50T3JkZXI6ICJtZHkiLAogICAgCiAgICAvKiBTdGFuZGFyZCBkYXRlIGFuZCB0aW1lIGZvcm1hdCBwYXR0ZXJucyAqLwogICAgZm9ybWF0UGF0dGVybnM6IHsKICAgICAgICBzaG9ydERhdGU6ICJNL2QveXl5eSIsCiAgICAgICAgbG9uZ0RhdGU6ICJkZGRkLCBNTU1NIGRkLCB5eXl5IiwKICAgICAgICBzaG9ydFRpbWU6ICJoOm1tIHR0IiwKICAgICAgICBsb25nVGltZTogImg6bW06c3MgdHQiLAogICAgICAgIGZ1bGxEYXRlVGltZTogImRkZGQsIE1NTU0gZGQsIHl5eXkgaDptbTpzcyB0dCIsCiAgICAgICAgc29ydGFibGVEYXRlVGltZTogInl5eXktTU0tZGRUSEg6bW06c3MiLAogICAgICAgIHVuaXZlcnNhbFNvcnRhYmxlRGF0ZVRpbWU6ICJ5eXl5LU1NLWRkIEhIOm1tOnNzWiIsCiAgICAgICAgcmZjMTEyMzogImRkZCwgZGQgTU1NIHl5eXkgSEg6bW06c3MgR01UIiwKICAgICAgICBtb250aERheTogIk1NTU0gZGQiLAogICAgICAgIHllYXJNb250aDogIk1NTU0sIHl5eXkiCiAgICB9LAoKICAgIC8qKgogICAgICogTk9URTogSWYgYSBzdHJpbmcgZm9ybWF0IGlzIG5vdCBwYXJzaW5nIGNvcnJlY3RseSwgYnV0CiAgICAgKiB5b3Ugd291bGQgZXhwZWN0IGl0IHBhcnNlLCB0aGUgcHJvYmxlbSBsaWtlbHkgbGllcyBiZWxvdy4gCiAgICAgKiAKICAgICAqIFRoZSBmb2xsb3dpbmcgcmVnZXggcGF0dGVybnMgY29udHJvbCBtb3N0IG9mIHRoZSBzdHJpbmcgbWF0Y2hpbmcKICAgICAqIHdpdGhpbiB0aGUgcGFyc2VyLgogICAgICogCiAgICAgKiBUaGUgTW9udGggbmFtZSBhbmQgRGF5IG5hbWUgcGF0dGVybnMgd2VyZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZAogICAgICogYW5kIGluIGdlbmVyYWwgc2hvdWxkIGJlIChtb3N0bHkpIGNvcnJlY3QuIAogICAgICoKICAgICAqIEJleW9uZCB0aGUgbW9udGggYW5kIGRheSBuYW1lIHBhdHRlcm5zIGFyZSBuYXR1cmFsIGxhbmd1YWdlIHN0cmluZ3MuCiAgICAgKiBFeGFtcGxlOiAibmV4dCIsICJ0b2RheSIsICJtb250aHMiCiAgICAgKgogICAgICogVGhlc2UgbmF0dXJhbCBsYW5ndWFnZSBzdHJpbmcgbWF5IE5PVCBiZSBjb3JyZWN0IGZvciB0aGlzIGN1bHR1cmUuIAogICAgICogSWYgdGhleSBhcmUgbm90IGNvcnJlY3QsIHBsZWFzZSB0cmFuc2xhdGUgYW5kIGVkaXQgdGhpcyBmaWxlCiAgICAgKiBwcm92aWRpbmcgdGhlIGNvcnJlY3QgcmVndWxhciBleHByZXNzaW9uIHBhdHRlcm4uIAogICAgICoKICAgICAqIElmIHlvdSBtb2RpZnkgdGhpcyBmaWxlLCBwbGVhc2UgcG9zdCB5b3VyIHJldmlzZWQgQ3VsdHVyZUluZm8gZmlsZQogICAgICogdG8gdGhlIERhdGVqcyBEaXNjdXNzaW9ucyBsb2NhdGVkIGF0CiAgICAgKiAgICAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL2RhdGUtanMKICAgICAqCiAgICAgKiBQbGVhc2UgbWFyayB0aGUgc3ViamVjdCB3aXRoIFtDdWx0dXJlSW5mb10uIEV4YW1wbGU6CiAgICAgKiAgICBTdWJqZWN0OiBbQ3VsdHVyZUluZm9dIFRyYW5zbGF0ZWQgImRhLURLIiBEYW5pc2goRGVubWFyaykKICAgICAqIAogICAgICogV2Ugd2lsbCBhZGQgdGhlIG1vZGlmaWVkIHBhdHRlcm5zIHRvIHRoZSBtYXN0ZXIgc291cmNlIGZpbGVzLgogICAgICoKICAgICAqIEFzIHdlbGwsIHBsZWFzZSByZXZpZXcgdGhlIGxpc3Qgb2YgIkZ1dHVyZSBTdHJpbmdzIiBzZWN0aW9uIGJlbG93LiAKICAgICAqLwkKICAgIHJlZ2V4UGF0dGVybnM6IHsKICAgICAgICBqYW46IC9eamFuKHVhcnkpPy9pLAogICAgICAgIGZlYjogL15mZWIocnVhcnkpPy9pLAogICAgICAgIG1hcjogL15tYXIoY2gpPy9pLAogICAgICAgIGFwcjogL15hcHIoaWwpPy9pLAogICAgICAgIG1heTogL15tYXkvaSwKICAgICAgICBqdW46IC9eanVuKGUpPy9pLAogICAgICAgIGp1bDogL15qdWwoeSk/L2ksCiAgICAgICAgYXVnOiAvXmF1Zyh1c3QpPy9pLAogICAgICAgIHNlcDogL15zZXAodChlbWJlcik/KT8vaSwKICAgICAgICBvY3Q6IC9eb2N0KG9iZXIpPy9pLAogICAgICAgIG5vdjogL15ub3YoZW1iZXIpPy9pLAogICAgICAgIGRlYzogL15kZWMoZW1iZXIpPy9pLAoKICAgICAgICBzdW46IC9ec3UobihkYXkpPyk/L2ksCiAgICAgICAgbW9uOiAvXm1vKG4oZGF5KT8pPy9pLAogICAgICAgIHR1ZTogL150dShlKHMoZGF5KT8pPyk/L2ksCiAgICAgICAgd2VkOiAvXndlKGQobmVzZGF5KT8pPy9pLAogICAgICAgIHRodTogL150aCh1KHIocyhkYXkpPyk/KT8pPy9pLAogICAgICAgIGZyaTogL15mcihpKGRheSk/KT8vaSwKICAgICAgICBzYXQ6IC9ec2EodCh1cmRheSk/KT8vaSwKCiAgICAgICAgZnV0dXJlOiAvXm5leHQvaSwKICAgICAgICBwYXN0OiAvXmxhc3R8cGFzdHxwcmV2KGlvdXMpPy9pLAogICAgICAgIGFkZDogL14oXCt8YWZ0ZXJ8ZnJvbSkvaSwKICAgICAgICBzdWJ0cmFjdDogL14oXC18YmVmb3JlfGFnbykvaSwKICAgICAgICAKICAgICAgICB5ZXN0ZXJkYXk6IC9eeWVzdGVyZGF5L2ksCiAgICAgICAgdG9kYXk6IC9edChvZGF5KT8vaSwKICAgICAgICB0b21vcnJvdzogL150b21vcnJvdy9pLAogICAgICAgIG5vdzogL15uKG93KT8vaSwKICAgICAgICAKICAgICAgICBtaWxsaXNlY29uZDogL15tc3xtaWxsaShzZWNvbmQpP3M/L2ksCiAgICAgICAgc2Vjb25kOiAvXnNlYyhvbmQpP3M/L2ksCiAgICAgICAgbWludXRlOiAvXm1pbih1dGUpP3M/L2ksCiAgICAgICAgaG91cjogL15oKG91KT9ycz8vaSwKICAgICAgICB3ZWVrOiAvXncoZWUpP2svaSwKICAgICAgICBtb250aDogL15tKG8obnRoKT9zPyk/L2ksCiAgICAgICAgZGF5OiAvXmQoYXlzPyk/L2ksCiAgICAgICAgeWVhcjogL155KChlYSk/cnM/KT8vaSwKCQkKICAgICAgICBzaG9ydE1lcmlkaWFuOiAvXihhfHApL2ksCiAgICAgICAgbG9uZ01lcmlkaWFuOiAvXihhXC4/bT9cLj98cFwuP20/XC4/KS9pLAogICAgICAgIHRpbWV6b25lOiAvXigoZShzfGQpdHxjKHN8ZCl0fG0oc3xkKXR8cChzfGQpdCl8KChnbXQpP1xzKihcK3xcLSlccypcZFxkXGRcZD8pfGdtdCkvaSwKICAgICAgICBvcmRpbmFsU3VmZml4OiAvXlxzKihzdHxuZHxyZHx0aCkvaSwKICAgICAgICB0aW1lQ29udGV4dDogL15ccyooXDp8YXxwKS9pCiAgICB9LAoKICAgIGFiYnJldmlhdGVkVGltZVpvbmVTdGFuZGFyZDogeyBHTVQ6ICItMDAwIiwgRVNUOiAiLTA0MDAiLCBDU1Q6ICItMDUwMCIsIE1TVDogIi0wNjAwIiwgUFNUOiAiLTA3MDAiIH0sCiAgICBhYmJyZXZpYXRlZFRpbWVab25lRFNUOiB7IEdNVDogIi0wMDAiLCBFRFQ6ICItMDUwMCIsIENEVDogIi0wNjAwIiwgTURUOiAiLTA3MDAiLCBQRFQ6ICItMDgwMCIgfQogICAgCn07CgovKioqKioqKioqKioqKioqKioqKioKICoqIEZ1dHVyZSBTdHJpbmdzICoqCiAqKioqKioqKioqKioqKioqKioqKgogKiAKICogVGhlIGZvbGxvd2luZyBsaXN0IG9mIHN0cmluZ3MgYXJlIG5vdCBjdXJyZW50bHkgYmVpbmcgdXNlZCwgYnV0IAogKiBtYXkgYmUgaW5jb3Jwb3JhdGVkIGxhdGVyLiBXZSB3b3VsZCBhcHByZWNpYXRlIGFueSBoZWxwIHRyYW5zbGF0aW5nCiAqIHRoZSBzdHJpbmdzIGJlbG93LgogKiAKICogSWYgeW91IG1vZGlmeSB0aGlzIGZpbGUsIHBsZWFzZSBwb3N0IHlvdXIgcmV2aXNlZCBDdWx0dXJlSW5mbyBmaWxlCiAqIHRvIHRoZSBEYXRlanMgRGlzY3Vzc2lvbnMgbG9jYXRlZCBhdAogKiAgICAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL2RhdGUtanMKICoKICogUGxlYXNlIG1hcmsgdGhlIHN1YmplY3Qgd2l0aCBbQ3VsdHVyZUluZm9dLiBFeGFtcGxlOgogKiAgICBTdWJqZWN0OiBbQ3VsdHVyZUluZm9dIFRyYW5zbGF0ZWQgImRhLURLIiBEYW5pc2goRGVubWFyaykKICoKICogRW5nbGlzaCBOYW1lICAgICAgICBUcmFuc2xhdGVkCiAqIC0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0KICogZGF0ZSAgICAgICAgICAgICAgICBkYXRlCiAqIHRpbWUgICAgICAgICAgICAgICAgdGltZQogKiBjYWxlbmRhciAgICAgICAgICAgIGNhbGVuZGFyCiAqIHNob3cgICAgICAgICAgICAgICAgc2hvdwogKiBob3VybHkgICAgICAgICAgICAgIGhvdXJseQogKiBkYWlseSAgICAgICAgICAgICAgIGRhaWx5CiAqIHdlZWtseSAgICAgICAgICAgICAgd2Vla2x5CiAqIGJpLXdlZWtseSAgICAgICAgICAgYmktd2Vla2x5CiAqIG1vbnRobHkgICAgICAgICAgICAgbW9udGhseQogKiBiaS1tb250aGx5ICAgICAgICAgIGJpLW1vbnRobHkKICogcXVhcnRlciAgICAgICAgICAgICBxdWFydGVyCiAqIHF1YXJ0ZXJseSAgICAgICAgICAgcXVhcnRlcmx5CiAqIHllYXJseSAgICAgICAgICAgICAgeWVhcmx5CiAqIGFubnVhbCAgICAgICAgICAgICAgYW5udWFsCiAqIGFubnVhbGx5ICAgICAgICAgICAgYW5udWFsbHkKICogYW5udW0gICAgICAgICAgICAgICBhbm51bQogKiBhZ2FpbiAgICAgICAgICAgICAgIGFnYWluCiAqIGJldHdlZW4gICAgICAgICAgICAgYmV0d2VlbgogKiBhZnRlciAgICAgICAgICAgICAgIGFmdGVyCiAqIGZyb20gbm93ICAgICAgICAgICAgZnJvbSBub3cKICogcmVwZWF0ICAgICAgICAgICAgICByZXBlYXQKICogdGltZXMgICAgICAgICAgICAgICB0aW1lcwogKiBwZXIgICAgICAgICAgICAgICAgIHBlcgogKi8NCgp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsKT3pvbmUudXRpbCA9IE96b25lLnV0aWwgfHwge307CgoKLyoqCiAqIEBjbGFzcwogKiBAcHJpdmF0ZQogKgogKiBAZGVzY3JpcHRpb24KICogT2JqZWN0IHVzZWQgdG8gdGFsayB0byB0aGUgY3Jvc3MgZG9tYWluIGFuZCBsb2NhbGx5LiAgSWYgdGhlIHNlcnZlciBpcyBsb2NhbCwKICogdGhlbiBBSkFYIHdpbGwgYmUgdXNlZC4gIElmIHRoZSBzZXJ2ZXIgaXMgcmVtb3RlLCB0aGVuIHdlIG11c3QgdXNlIGEKICogaGFjayB0byBnZXQgYXJvdW5kIFNhbWUgT3JpZ2luIFBvbGljeSBhbmQgbWFrZSB0aGUgY2FsbCBjcm9zcyBkb21haW4uCiAqCiAqIEByZXF1aXJlcyB1dGlsLmpzCiAqLwpPem9uZS51dGlsLlRyYW5zcG9ydCA9IHsKICAgIHZlcnNpb246IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24ucHJlZmVyZW5jZQp9OwoKCi8qKgogKiBAcHJpdmF0ZQogKgogKiBAcGFyYW1zICBjZmcudXJsICAgICAgICAgICAgICAgLSAgdXJsIG9mIHRoZSByZXF1ZXN0CiAqICAgICAgICAgIGNmZy5tZXRob2QgICAgICAgICAgICAtICBIVFRQIHZlcmIgKG9ubHkgUE9TVCBvciBHRVQsIHVzZSBfbWV0aG9kID0gUFVUIG9yIERFTEVURSB3aXRoIGEgUE9TVCApCiAqICAgICAgICAgIGNmZy5vblN1Y2Nlc3MgICAgICAgICAtICBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdAogKiAgICAgICAgICBjZmcub25GYWlsdXJlICAgICAgICAgLSAgY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvcgogKiAgICAgICAgICBjZmcuY29udGVudCAgICAgICAgICAgLSAgb3B0aW9uYWwgY29udGVudCB0byBzZW5kIHdpdGggdGhlIHJlcXVlc3QsIGllIHt2YWx1ZTogJ3gnLCBfbWV0aG9kOiAnUFVUJ30KICogICAgICAgICAgY2ZnLmFzeW5jCQkJICAtICBvcHRpb25hbCAoZGVmYXVsdCBpcyB0cnVlLCBhc3luY2hyb25vdXMgc2VuZCwgb25seSBhcHBsaWVzIHRvIEFqYXggY2FsbCkKICogICAgICAgICAgY2ZnLmhhbmRsZUFzICAgICAgICAgIC0gdGV4dCBvciBqc29uCiAqICAgICAgICAgIGNmZy5hdXRvU2VuZFZlcnNpb24gICAtICB0cnVlIHRvIHNlbmQgb3dmIHZlcnNpb24gdG8gdGhlIHNlcnZlciwgZmFsc2UgZG9uJ3Qgc2VuZCAoZGVmYXVsdHMgdG8gdHJ1ZSkKICogICAgICAgICAgY2ZnLmlnbm9yZWRFcnJvckNvZGVzIC0gIG9wdGlvbmFsIGFycmF5IG9mIGh0dHAgZXJyb3IgY29kZXMgdG8gaWdub3JlIChpZiB0aGVzZSBoYXBwZW4gb25TdWNlc3Mgd2lsbCBiZSBjYWxsZWQpCiAqICAgICAgICAgIGNmZy5mb3JjZVhkb21haW4gICAgICAtICBvcHRpb25hbCBmbGFnIHRvIGZvcmNlIHhkb21haW4gYWpheCBjYWxsIHVzaW5nIGRvam8gd2luZG93Lm5hbWUKICoKICogIEByZXR1cm5zIHZvaWQsIHVzZSBjYWxsYmFja3MKICoKICogIFN0YXRpYyBtZXRob2QuICBNdXN0IHVzZSAyIGNhbGxiYWNrcyBzaW5jZSBqYXZhc2NyaXB0IGlzIGFzeW5jcm9ub3VzCiAqICB3ZSBoYXZlIHRvIHdhaXQgZm9yIHRoZSByZXNwb25zZS4KICoKICogIFRoaXMgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgZG9qb3gud2luZG93TmFtZSBoYWNrIGZvciBhIHJlbW90ZSBzZXJ2ZXIsCiAgKiBidXQgY291bGQgYmUgcmVwbGFjZWQgd2l0aCBzb21ldGhpbmcgZWxzZSBsaWtlIEpTT05QIGlmIGRlc2lyZWQKICovCk96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQgPSBmdW5jdGlvbihjZmcpIHsKICAgIGlmIChPem9uZS5sb2cpIHsKICAgICAgICBPem9uZS5sb2cuZ2V0RGVmYXVsdExvZ2dlcigpLmRlYnVnKCdUcmFuc3BvcnQgU2VuZCcsIGNmZy51cmwsIGNmZy5tZXRob2QsIGNmZy5jb250ZW50KTsKICAgIH0KCiAgICB2YXIgZGVmYXVsdEZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsKICAgICAgICAvLyBJZiBlcnJvciBpcyBhbiBIVE1MIHBhZ2UsIGp1c3QgdXNlIGJvZHkKICAgICAgICBpZiAoZXJyID09IHVuZGVmaW5lZCB8fCBlcnIgPT0gbnVsbCkgZXJyID0gIiI7CiAgICAgICAgdmFyIHN0YXJ0ID0gZXJyLmluZGV4T2YoIjxib2R5Iik7CiAgICAgICAgaWYgKHN0YXJ0ID4gLTEpIHsKICAgICAgICAgICAgLy8gc3RhcnQgYXQgdGhlIGVuZCBvZiB0aGUgYm9keSB0YWcKICAgICAgICAgICAgc3RhcnQgPSBlcnIuaW5kZXhPZigiPiIsIHN0YXJ0KSArIDE7CiAgICAgICAgICAgIHZhciBzdG9wID0gZXJyLmluZGV4T2YoIjwvYm9keT4iLCBzdGFydCk7CgogICAgICAgICAgICBpZiAoc3RvcCA+IC0xKSBlcnIgPSBlcnIuc3Vic3RyaW5nKHN0YXJ0LCBzdG9wKTsKICAgICAgICAgICAgZWxzZSBlcnIgPSBlcnIuc3Vic3RyaW5nKHN0YXJ0KTsKICAgICAgICB9CgogICAgICAgIGlmICghT3pvbmUuTXNnKQogICAgICAgICAgICBPem9uZS51dGlsLkVycm9yRGxnLnNob3coZXJyLDIwMCw1MCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBPem9uZS5Nc2cuYWxlcnQoJ1NlcnZlciBFcnJvcicsZXJyLG51bGwsdGhpcyx7CiAgICAgICAgICAgICAgICBjbHM6ICJvd2ZBbGVydCIKICAgICAgICAgICAgfSk7CiAgICB9OwoKICAgIC8vIGNyZWF0ZSBhbiBvbkZhaWx1cmUgbWV0aG9kIGlmIG9uZSBkb2Vzbid0IGV4aXN0CiAgICBpZiAoIWNmZy5vbkZhaWx1cmUpIHsKICAgICAgICBjZmcub25GYWlsdXJlID0gZnVuY3Rpb24oZXJyKXsKICAgICAgICAgICAgZGVmYXVsdEZhaWx1cmUoZXJyKTsKICAgICAgICB9OwogICAgfQoKICAgIHZhciBtZXRob2RUb1VzZSA9IGNmZy5tZXRob2Q7CiAgICB2YXIgaGFzQm9keSA9IGZhbHNlOwogICAgaWYgKG1ldGhvZFRvVXNlID09ICJQVVQiIHx8IG1ldGhvZFRvVXNlID09ICJERUxFVEUiKQogICAgewogICAgICAgIG1ldGhvZFRvVXNlID0gIlBPU1QiOwogICAgfQoKICAgIGlmIChtZXRob2RUb1VzZSA9PSAiUE9TVCIpIHsKICAgICAgICBoYXNCb2R5ID0gdHJ1ZTsKICAgIH0KCiAgICBpZihjZmcuY29udGVudCA9PSBudWxsKSB7CiAgICAgICAgY2ZnLmNvbnRlbnQgPSB7fTsKICAgIH0KCiAgICAvL2F1dG9TZW5kVmVyc2lvbiB0byBzZXJ2ZXIgZGVmYXVsdCBiZWhhdmlvciBpcyB0cnVlCiAgICBpZiAoIShjZmcuYXV0b1NlbmRWZXJzaW9uID09PSBmYWxzZSkpIHsKICAgICAgICAvL2FkZCB2ZXJzaW9uIHByb3BlcnR5IHRvIHNlbmQgdG8gdGhlIHNlcnZlcgogICAgICAgIGNmZy5jb250ZW50LnZlcnNpb24gPSBPem9uZS51dGlsLlRyYW5zcG9ydC52ZXJzaW9uOwogICAgfQoKICAgIC8vIENvbnZlcnQgc3RhdGUgSlNPTiBvYmplY3QgdG8gc3RyaW5nCiAgICBpZiAoY2ZnLmNvbnRlbnQuc3RhdGUpIHsKICAgICAgICBjZmcuY29udGVudC5zdGF0ZSA9IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLmNvbnRlbnQuc3RhdGUpOwogICAgfQoKLy8gICAgLy8gQ29udmVydCBkZWZhdWx0U2V0dGluZ3MgSlNPTiBvYmplY3QgdG8gc3RyaW5nCi8vICAgIGlmIChjZmcuY29udGVudC5kZWZhdWx0U2V0dGluZ3MpIHsKLy8gICAgICAgIGNmZy5jb250ZW50LmRlZmF1bHRTZXR0aW5ncyA9IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLmNvbnRlbnQuZGVmYXVsdFNldHRpbmdzKTsKLy8gICAgfQoKICAgIHZhciAgY29udGVudCA9IGNmZy5jb250ZW50OwoKICAgIHZhciBoYW5kbGVBcyA9ICdqc29uJzsKICAgIGlmIChjZmcuaGFuZGxlQXMgIT0gbnVsbCkgewogICAgICAgIGhhbmRsZUFzID0gY2ZnLmhhbmRsZUFzOwogICAgfQoKICAgIC8vIFVzZSBBSkFYIGlmIHdlIGNhbgogICAgaWYgKE96b25lLnV0aWwuaXNVcmxMb2NhbChjZmcudXJsKSAmJiAhY2ZnLmZvcmNlWGRvbWFpbikgewogICAgICAgIHJldHVybiBvd2Zkb2pvLnhocihtZXRob2RUb1VzZS50b1VwcGVyQ2FzZSgpLCB7CiAgICAgICAgICAgIHVybDogY2ZnLnVybCwKICAgICAgICAgICAgY29udGVudDogY2ZnLmNvbnRlbnQsCiAgICAgICAgICAgIHByZXZlbnRDYWNoZTogdHJ1ZSwKICAgICAgICAgICAgc3luYzogY2ZnLmFzeW5jID09IGZhbHNlPyB0cnVlIDogZmFsc2UsIC8vZGVmYXVsdHMgdG8gZmFsc2UgKG5vdCBzeW5jaHJvbm91cykKICAgICAgICAgICAgdGltZW91dCA6IGNmZy50aW1lb3V0ID8gY2ZnLnRpbWVvdXQgOiAwLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbG9hZDogZnVuY3Rpb24ocmVzcG9uc2UsIGlvQXJncykgewogICAgICAgICAgICAgICAgaWYgKE96b25lLmxvZykgewogICAgICAgICAgICAgICAgICAgIE96b25lLmxvZy5nZXREZWZhdWx0TG9nZ2VyKCkuZGVidWcoJ1RyYW5zcG9ydCBBSkFYIFJldHVybicsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoYW5kbGVBcyA9PSAnanNvbicpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIganNvbiA9IE96b25lLnV0aWwucGFyc2VKc29uKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2Vzcyhqc29uKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uRmFpbHVyZShlLm5hbWUgKyAiIDogIiArIGUubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2VzcyhyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihyZXNwb25zZSwgaW9BcmdzKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZG9qb1R5cGU9PSdjYW5jZWwnKSB7IHJldHVybjsgfQogICAgICAgICAgICAgICAgLy8gRkYyIGtpbGxzIGFsbCBBSkFYIHJlcXVlc3RzIHdoZW4geW91IHJlZnJlc2guIFdoZW4gdGhpcyBoYXBwZW5zLCBpdCBzZXRzIHRoZSBzdGF0dXMgY29kZSB0byAwCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9IDAgKXsKICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnLmlnbm9yZWRFcnJvckNvZGVzICE9IG51bGwgJiYgY2ZnLmlnbm9yZWRFcnJvckNvZGVzLmxlbmd0aCA+IDAgJiYgb3dmZG9qby5pbmRleE9mKGNmZy5pZ25vcmVkRXJyb3JDb2RlcyxyZXNwb25zZS5zdGF0dXMpID4gLTEpewogICAgICAgICAgICAgICAgICAgICAgICBjZmcub25TdWNjZXNzKHt9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUocmVzcG9uc2UucmVzcG9uc2VUZXh0LCByZXNwb25zZS5zdGF0dXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIGhhc0JvZHkpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBVc2Ugd2luZG93Lm5hbWUgdHJhbnNwb3J0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIG1ldGhvZFRvVXNlID0gY2ZnLm1ldGhvZDsKICAgICAgICAgICAgaWYgKG1ldGhvZFRvVXNlID09ICJQVVQiIHx8IG1ldGhvZFRvVXNlID09ICJERUxFVEUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZXRob2RUb1VzZSA9ICJQT1NUIjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBvd2Zkb2pveC5pby53aW5kb3dOYW1lLnNlbmQobWV0aG9kVG9Vc2UudG9VcHBlckNhc2UoKSwgewogICAgICAgICAgICAgICAgdXJsOiBjZmcudXJsLAogICAgICAgICAgICAgICAgY29udGVudDogY29udGVudCwKICAgICAgICAgICAgICAgIHByZXZlbnRDYWNoZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ6IGNmZy50aW1lb3V0ID8gY2ZnLnRpbWVvdXQgOiAyMDAwMCwKICAgICAgICAgICAgICAgIGxvYWQ6CiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBPV0YtMjc1MCAtIGhhbmRsZSB0aW1lb3V0IGVycm9ycyB3aGljaCBhcmUgYWxyZWFkeSBKU09OIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZihyZXN1bHQpID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uID0gT3pvbmUudXRpbC5wYXJzZUpzb24ocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAganNvbiA9IHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gT1dGLTI3NTAgLSBkZXRlY3QgYSB0aW1lb3V0IGVycm9yIGFuZCByZXR1cm4gaXRzIG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24gJiYganNvbi5tZXNzYWdlICYmIGpzb24ubWVzc2FnZSA9PSAnVGltZW91dCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNmZy5vbkZhaWx1cmUoJ0Vycm9yOiBSZXF1ZXN0IHRpbWVkIG91dCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE96b25lLmxvZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE96b25lLmxvZy5nZXREZWZhdWx0TG9nZ2VyKCkuZGVidWcoJ1RyYW5zcG9ydCBBSkFYIFJldHVybicsIGpzb24uZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlQXMgPT0gJ2pzb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2Vzcyhqc29uLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2VzcyhyZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpzb24uc3RhdHVzID09PSA1MDAgfHwganNvbi5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uRmFpbHVyZShqc29uLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgaXQgaXMgYW4gZXJyb3IgY29kZSB3ZSBpZ25vcmUgdGhhbiBjYWxsIG9uU3VjY2VzcyB3aXRoIGVtcHR5IGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY2ZnLmlnbm9yZWRFcnJvckNvZGVzICE9IG51bGwgJiYgY2ZnLmlnbm9yZWRFcnJvckNvZGVzLmxlbmd0aCA+IDAgJiYgb3dmZG9qby5pbmRleE9mKGNmZy5pZ25vcmVkRXJyb3JDb2Rlcyxqc29uLnN0YXR1cykgPiAtMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcub25TdWNjZXNzKHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUoanNvbi5kYXRhLGpzb24uc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2goZTIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uRmFpbHVyZShlMi5uYW1lICsgIiA6ICIgKyBlMi5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6CiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZG9qb1R5cGU9PSdjYW5jZWwnKSB7IHJldHVybjsgfQogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBFcnJvcil7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUocmVzdWx0Lm5hbWUgKyAiIDogIiArIHJlc3VsdC5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9uRmFpbHVyZShyZXN1bHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZDsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZSl7CiAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUoZS5uYW1lICsgIiA6ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KCQp9OwovKioKICogQHByaXZhdGUKICoKICogQHBhcmFtcyAgY2ZnLnVybCAgICAgICAgICAgICAgLSAgdXJsIG9mIHRoZSByZXF1ZXN0CiAqICAgICAgICAgIGNmZy5tZXRob2QgICAgICAgICAgIC0gIEhUVFAgdmVyYiAob25seSBQT1NUIG9yIEdFVCwgdXNlIF9tZXRob2QgPSBQVVQgb3IgREVMRVRFIHdpdGggYSBQT1NUICkKICogICAgICAgICAgY2ZnLmNvbnRlbnQgICAgICAgICAgLSAgb3B0aW9uYWwgY29udGVudCB0byBzZW5kIHdpdGggdGhlIHJlcXVlc3QsIGllIHt2YWx1ZTogJ3gnLCBfbWV0aG9kOiAnUFVUJ30KICogICAgICAgICAgY2ZnLmFzeW5jCQkJIC0gIG9wdGlvbmFsIChkZWZhdWx0IGlzIHRydWUsIGFzeW5jaHJvbm91cyBzZW5kLCBvbmx5IGFwcGxpZXMgdG8gQWpheCBjYWxsKSAgICAgICAgICAKICoKICogIEByZXR1cm5zIHZvaWQKICoKICogIFN0YXRpYyBtZXRob2QuICBObyBjYWxsYmFja3MgYXJlIHBhc3NlZCBpbiwgc28geW91IHdpbGwgbm90IGdldCBhIHJlc3BvbnNlLiAgVXNlZnVsIGZvciBleGFtcGxlIGluCiAqICAgICAgICAgICAgICAgICAgaW4gJ2JlZm9yZXVubG9hZCcgd2hlbiB0aGUgdGhlIGFzeW5jcm9ub3VzIGNhbGxiYWNrcyBhcmUgZ3VhcmFudGVlZCB0byBoYXZlIHRoZSBzYW1lCiAqICAgICAgICAgICAgICAgICAgamF2YXNjcmlwdCBpbiB0aGUgZG9tIHdoZW4gdGhleSBhcmUgZmlydGVkCiAqCiAqCiAqICBUaGlzIGltcGxlbWVudGF0aW9uIHVzZXMgdGhlIGRvam94LndpbmRvd05hbWUgaGFjayBmb3IgYSByZW1vdGUgc2VydmVyLAogICogYnV0IGNvdWxkIGJlIHJlcGxhY2VkIHdpdGggc29tZXRoaW5nIGVsc2UgbGlrZSBKU09OUCBpZiBkZXNpcmVkCiAqLwpPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kQW5kRm9yZ2V0ID0gZnVuY3Rpb24oY2ZnKSB7CiAgICB2YXIgY2ZnID0gY2ZnOwoKICAgIGlmIChPem9uZS5sb2cpIHsKICAgICAgICBPem9uZS5sb2cuZ2V0RGVmYXVsdExvZ2dlcigpLmRlYnVnKCdUcmFuc3BvcnQgU2VuZEFuZEZvcmdldCcsIGNmZy51cmwsIGNmZy5tZXRob2QsIGNmZy5jb250ZW50KTsKICAgIH0KCiAgICB2YXIgbWV0aG9kVG9Vc2UgPSBjZmcubWV0aG9kOwogICAgaWYgKG1ldGhvZFRvVXNlID09ICJQVVQiIHx8IG1ldGhvZFRvVXNlID09ICJERUxFVEUiKQogICAgewogICAgICAgIG1ldGhvZFRvVXNlID0gIlBPU1QiOwogICAgfQoJCiAgICB2YXIgaGFzQm9keSA9IGZhbHNlOwogICAgaWYgKG1ldGhvZFRvVXNlID09ICJQT1NUIikgewogICAgICAgIGhhc0JvZHkgPSB0cnVlOwogICAgfQoJCiAgICBpZihjZmcuY29udGVudCA9PSBudWxsKSB7CiAgICAgICAgY2ZnLmNvbnRlbnQgPSB7fTsKICAgIH0KCiAgICAvL2F1dG9TZW5kVmVyc2lvbiB0byBzZXJ2ZXIgZGVmYXVsdCBiZWhhdmlvciBpcyB0cnVlCiAgICBpZiAoY2ZnLmF1dG9TZW5kVmVyc2lvbiA9PT0gZmFsc2UpIHsKICAgICAgICAvL2FkZCB2ZXJzaW9uIHByb3BlcnR5IHRvIHNlbmQgdG8gdGhlIHNlcnZlcgogICAgICAgIGNmZy5jb250ZW50LnZlcnNpb24gPSBPem9uZS51dGlsLlRyYW5zcG9ydC52ZXJzaW9uOwogICAgfQoKICAgIC8vIENvbnZlcnQgc3RhdGUgSlNPTiBvYmplY3QgdG8gc3RyaW5nCiAgICBpZiAoY2ZnLmNvbnRlbnQuc3RhdGUpIHsKICAgICAgICBjZmcuY29udGVudC5zdGF0ZSA9IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLmNvbnRlbnQuc3RhdGUpOwogICAgfQoKICAgIHZhciBjb250ZW50ID0gbnVsbDsKICAgIGlmIChtZXRob2RUb1VzZSA9PSAiR0VUIikgewogICAgICAgIGNvbnRlbnQgPSBvd2Zkb2pvLm9iamVjdFRvUXVlcnkoY2ZnLmNvbnRlbnQpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgY29udGVudCA9IGNmZy5jb250ZW50OwogICAgfQoKICAgIC8vIFVzZSBBSkFYIGlmIHdlIGNhbgogICAgaWYgKE96b25lLnV0aWwuaXNVcmxMb2NhbChjZmcudXJsKSkgewogICAgICAgIG93ZmRvam8ueGhyKG1ldGhvZFRvVXNlLnRvVXBwZXJDYXNlKCksIHsKICAgICAgICAgICAgdXJsOiBjZmcudXJsLAogICAgICAgICAgICBjb250ZW50OiBjZmcuY29udGVudCwKICAgICAgICAgICAgcHJldmVudENhY2hlOiB0cnVlLAogICAgICAgICAgICBzeW5jOiAgY2ZnLmFzeW5jID09IGZhbHNlPyBmYWxzZSA6IHRydWUgLy9kZWZhdWx0cyB0byB0cnVlCiAgICAgICAgfSwgaGFzQm9keSk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIFVzZSB3aW5kb3cubmFtZSB0cmFuc3BvcnQKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbWV0aG9kVG9Vc2UgPSBjZmcubWV0aG9kOwogICAgICAgICAgICBpZiAobWV0aG9kVG9Vc2UgPT0gIlBVVCIgfHwgbWV0aG9kVG9Vc2UgPT0gIkRFTEVURSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG1ldGhvZFRvVXNlID0gIlBPU1QiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IG93ZmRvam94LmlvLndpbmRvd05hbWUuc2VuZChtZXRob2RUb1VzZS50b1VwcGVyQ2FzZSgpLCB7CiAgICAgICAgICAgICAgICB1cmw6IGNmZy51cmwsCiAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50LAogICAgICAgICAgICAgICAgcHJldmVudENhY2hlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICBpZiAoIU96b25lLk1zZykKICAgICAgICAgICAgICAgIE96b25lLnV0aWwuRXJyb3JEbGcuc2hvdyhPem9uZS51dGlsLkVycm9yTWVzc2FnZVN0cmluZy5zZW5kQW5kRm9yZ2V0LGUubmFtZSArICIgOiAiICsgZS5tZXNzYWdlLDIwMCw1MCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIE96b25lLk1zZy5hbGVydChPem9uZS51dGlsLkVycm9yTWVzc2FnZVN0cmluZy5zZW5kQW5kRm9yZ2V0LGUubmFtZSArICIgOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICB9Cn07CgoKLyoqCiAqIEBwcml2YXRlCiAqCiAqICBAcGFyYW1zICBjZmcudXJscyAgICAgICAgICAgICAgLSAgQXJyYXkgb2YgdXJscyB0byB0cnkKICogICAgICAgICAgIGNmZy5tZXRob2QgICAgICAgICAgIC0gIEhUVFAgdmVyYiAob25seSBQT1NUIG9yIEdFVCwgdXNlIF9tZXRob2QgPSBQVVQgb3IgREVMRVRFIHdpdGggYSBQT1NUICkKICogICAgICAgICAgIGNmZy5vblN1Y2Nlc3MgICAgICAgIC0gIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0CiAqICAgICAgICAgICBjZmcub25MYXN0RmFpbHVyZSAgICAgICAgLSAgY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvcgogKiAgICAgICAgICAgY2ZnLmNvbnRlbnQgICAgICAgICAgLSAgb3B0aW9uYWwgY29udGVudCB0byBzZW5kIHdpdGggdGhlIHJlcXVlc3QsIGllIHt2YWx1ZTogJ3gnLCBfbWV0aG9kOiAnUFVUJ30KICoKICogIEByZXR1cm5zIHZvaWQsIHVzZSBjYWxsYmFja3MKICoKICogIFN0YXRpYyBtZXRob2QuICBBbGxvd3MgdGhlIHVzZXIgdG8gcGFzcyBpbiBhbiBhcnJheSBvZiB1cmxzIHRvIHRyeS4gIFRoZSBmaXJzdCBvbmUgdG8gcmV0dXJuIGEgcmVzcG9uc2Ugc3RvcHMKICogIHRoZSBwcm9jZXNzaW5nLiAgVXNlcyB0aGUgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZCBtZXRob2QuCiAqLwpPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kVG9GaXJzdCA9IGZ1bmN0aW9uKGNmZykgewogICAgdmFyIHUgPSBjZmcudXJscy5zaGlmdCgpOwoJCiAgICBpZiAodSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGNmZy5vbkxhc3RGYWlsdXJlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY2ZnLm9uTGFzdEZhaWx1cmUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoJCiAgICB2YXIgb25UaGlzRmFpbHVyZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmRUb0ZpcnN0KHsKICAgICAgICAgICAgdXJsczpjZmcudXJscywKICAgICAgICAgICAgbWV0aG9kOmNmZy5tZXRob2QsCiAgICAgICAgICAgIG9uU3VjY2VzczpjZmcub25TdWNjZXNzLAogICAgICAgICAgICBvbkxhc3RGYWlsdXJlOmNmZy5vbkxhc3RGYWlsdXJlLAogICAgICAgICAgICBjb250ZW50OmNmZy5jb250ZW50CiAgICAgICAgICAgIH0pOwogICAgfTsKCQogICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZCh7CiAgICAgICAgdXJsOnUsCiAgICAgICAgbWV0aG9kOmNmZy5tZXRob2QsCiAgICAgICAgb25TdWNjZXNzOmNmZy5vblN1Y2Nlc3MsCiAgICAgICAgb25GYWlsdXJlOm9uVGhpc0ZhaWx1cmUsCiAgICAgICAgY29udGVudDpjZmcuY29udGVudAogICAgICAgIH0pOwp9OwoKdmFyIE96b25lID0gT3pvbmUgfHwge307Ci8qKgogKiBAbmFtZXNwYWNlCiAqIEBkZXNjcmlwdGlvbiBQcm92aWRlcyBPV0YgdXRpbGl0eSBtZXRob2RzIGZvciB0aGUgd2lkZ2V0IGRldmVsb3BlcgogKiAKICovCk96b25lLnV0aWwgPSBPem9uZS51dGlsIHx8IHt9OwoKLyoqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCBpbmZvcm1zIGEgd2lkZ2V0IGRldmVsb3BlciBpZiB0aGVpciB3aWRnZXQgaXMgcnVubmluZwogKiBpbiBhIENvbnRhaW5lciwgbGlrZSBPV0YKICoKICogQHJldHVybnMgIGJvb2xlYW4gdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGluc2lkZSBhIGNvbnRhaW5lciwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKi8KT3pvbmUudXRpbC5pc0luQ29udGFpbmVyID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaW5Db250YWluZXIgPSBmYWxzZTsKCiAgICAvL2NoZWNrIHdpbmRvdy5uYW1lCiAgICBpZiAoT3pvbmUudXRpbC5wYXJzZUpzb24pIHsKICAgICAgICB2YXIgY29uZmlnUGFyYW1zID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCk7CiAgICAgICAgaWYgKGNvbmZpZ1BhcmFtcyAhPSBudWxsCiAgICAgICAgICAgICAgICAgLy9pcyB0aGUgZmFjdCB0aGF0IGEganNvbiBzdHJpbmcgd2FzIGluIHdpbmRvdy5uYW1lIGVub3VnaCB0byBkZXRlcm1pbmUgdGhlIHdpZGdldCBpcyBpbiBhIGNvbnRhaW5lcj8KICAgICAgICAgICAgICAgIC8vJiYgY29uZmlnUGFyYW1zLmluQ29udGFpbmVyCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgaW5Db250YWluZXIgPSB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBpbkNvbnRhaW5lcjsKfTsKCi8qKgogKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgaW5mb3JtcyBhIHdpZGdldCBkZXZlbG9wZXIgaWYgdGhlaXIgd2lkZ2V0IGlzIHJ1bm5pbmcgCiAqIGZyb20gdGhlIE9XRiBvciBmcm9tIGEgZGlyZWN0IFVSTCBjYWxsLgogKiAKICogQHJldHVybnMgIGJvb2xlYW4gdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGluc2lkZSBPV0YsIGZhbHNlIG90aGVyd2lzZS4KICoKICovCk96b25lLnV0aWwuaXNSdW5uaW5nSW5PV0YgPSBmdW5jdGlvbigpIHsKICAgIHZhciBpc0luT3dmID0gZmFsc2U7CgogICAgLy9jaGVjayB3aW5kb3cubmFtZQogICAgaWYgKE96b25lLnV0aWwucGFyc2VKc29uKSB7CiAgICAgICAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOwogICAgICAgIGlmIChjb25maWdQYXJhbXMgIT0gbnVsbCAmJiBjb25maWdQYXJhbXMub3dmKSB7CiAgICAgICAgICAgIGlzSW5Pd2YgPSB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBpc0luT3dmOwp9OwoKLyoqCiAqIEBwcml2YXRlCiAqCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCB0YWtlcyBhIHN0cmluZyBhbmQgcmVtb3ZlcyB0aGUgcGFzc2VkIGhlYWRlciBmcm9tIHRoZSBmcm9udCBvZiBpdC4KICogVXNlZCB0byBjb252ZXJ0IGEgdW5pcXVlIGlkIGF0dHJpYnV0ZSBpbnRvIGEgaWQgdGhhdCBvdGhlciBmdW5jdGlvbnMgYW5kIG9iamVjdHMgY2FuIHVzZS4KICogCiAqIEBwYXJhbSB7U3RyaW5nfSBpZCB0aGUgaWQgYXR0cmlidXRlIHZhbHVlIHRvIGJlIG1hbmlwdWxhdGVkCiAqIEBwYXJhbSB7U3RyaW5nfSBoZWFkZXIgdGhlIGhlYWRlciB0byBiZSByZW1vdmVkIGZyb20gdGhlIGlkCiAqIAogKiBAcmV0dXJucyBTdHJpbmcgdGhlIGlkIG1pbnVzIHRoZSBoZWFkZXIuIChFeC4gcGFyc2VJRCgnaGVhZGVyMScsICdoZWFkZXInKSByZXR1cm5zICcxJykKICogCiAqLwpPem9uZS51dGlsLnBhcnNlSUQgPSBmdW5jdGlvbihpZCwgaGVhZGVyKSB7CiAgICByZXR1cm4gaWQuc3Vic3RyaW5nKDAsIGhlYWRlci5sZW5ndGgpID09IGhlYWRlciA/IGlkLnN1YnN0cmluZyhoZWFkZXIubGVuZ3RoKSA6IGlkOwp9CgovKioKICogQGRlc2NyaXB0aW9uIFRoaXMgbWV0aG9kIHJldHVybnMgZmxhc2gvZmxleCBvYmplY3QgZnJvbSBkb20uCiAqIAogKiBAcmV0dXJucyAgZmxhc2gvZmxleCBvYmplY3QgZnJvbSBkb20KICoKICovCk96b25lLnV0aWwuZ2V0Rmxhc2hBcHAgPSBmdW5jdGlvbihpZCkgewogICAgaWQgPSBpZCB8fCBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5nZXRJbnN0YW5jZSgpLmdldEZsYXNoV2lkZ2V0SWQoKTsKICAgIGlmKCFpZCkKICAgICAgICByZXR1cm47CiAgICAKICAgIGlmIChuYXZpZ2F0b3IuYXBwTmFtZS5pbmRleE9mICgiTWljcm9zb2Z0IikgIT0tMSkgewogICAgICAgIHJldHVybiB3aW5kb3dbaWRdOwogICAgICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiBkb2N1bWVudFtpZF07CiAgICB9Cn07Ci8qCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICovCgp2YXIgZ2FkZ2V0cyA9IGdhZGdldHMgfHwge307CgovKioKICogQGZpbGVvdmVydmlldyBHZW5lcmFsIHB1cnBvc2UgdXRpbGl0aWVzIHRoYXQgZ2FkZ2V0cyBjYW4gdXNlLgogKi8KCi8qKgogKiBAc3RhdGljCiAqIEBjbGFzcyBQcm92aWRlcyBnZW5lcmFsLXB1cnBvc2UgdXRpbGl0eSBmdW5jdGlvbnMuCiAqIEBuYW1lIGdhZGdldHMudXRpbAogKi8KCmdhZGdldHMudXRpbCA9IGZ1bmN0aW9uKCkgewogIC8qKgogICAqIFBhcnNlcyBVUkwgcGFyYW1ldGVycyBpbnRvIGFuIG9iamVjdC4KICAgKiBAcmV0dXJuIHtBcnJheS4mbHQ7U3RyaW5nJmd0O30gVGhlIHBhcmFtZXRlcnMKICAgKi8KICBmdW5jdGlvbiBwYXJzZVVybFBhcmFtcygpIHsKICAgIC8vIEdldCBzZXR0aW5ncyBmcm9tIHVybCwgJ2hhc2gnIHRha2VzIHByZWNlZGVuY2Ugb3ZlciAnc2VhcmNoJyBjb21wb25lbnQKICAgIC8vIGRvbid0IHVzZSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoIGR1ZSB0byBicm93c2VyIGRpZmZlcmVuY2VzLgogICAgdmFyIHF1ZXJ5OwogICAgdmFyIGwgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgdmFyIHF1ZXJ5SWR4ID0gbC5pbmRleE9mKCI/Iik7CiAgICB2YXIgaGFzaElkeCA9IGwuaW5kZXhPZigiIyIpOwogICAgaWYgKGhhc2hJZHggPT09IC0xKSB7CiAgICAgIHF1ZXJ5ID0gbC5zdWJzdHIocXVlcnlJZHggKyAxKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGVzc2VudGlhbGx5IHJlcGxhY2VzICIjIiB3aXRoICImIgogICAgICBxdWVyeSA9IFtsLnN1YnN0cihxdWVyeUlkeCArIDEsIGhhc2hJZHggLSBxdWVyeUlkeCAtIDEpLCAiJiIsCiAgICAgICAgICAgICAgIGwuc3Vic3RyKGhhc2hJZHggKyAxKV0uam9pbigiIik7CiAgICB9CiAgICByZXR1cm4gcXVlcnkuc3BsaXQoIiYiKTsKICB9CgogIHZhciBwYXJhbWV0ZXJzID0gbnVsbDsKICB2YXIgZmVhdHVyZXMgPSB7fTsKICB2YXIgb25Mb2FkSGFuZGxlcnMgPSBbXTsKCiAgLy8gTWFwcyBjb2RlIHBvaW50cyB0byB0aGUgdmFsdWUgdG8gcmVwbGFjZSB0aGVtIHdpdGguCiAgLy8gSWYgdGhlIHZhbHVlIGlzICJmYWxzZSIsIHRoZSBjaGFyYWN0ZXIgaXMgcmVtb3ZlZCBlbnRpcmVseSwgb3RoZXJ3aXNlCiAgLy8gaXQgd2lsbCBiZSByZXBsYWNlZCB3aXRoIGFuIGh0bWwgZW50aXR5LgogIHZhciBlc2NhcGVDb2RlUG9pbnRzID0gewogICAvLyBudWw7IG1vc3QgYnJvd3NlcnMgdHJ1bmNhdGUgYmVjYXVzZSB0aGV5IHVzZSBjIHN0cmluZ3MgdW5kZXIgdGhlIGNvdmVycy4KICAgMCA6IGZhbHNlLAogICAvLyBuZXcgbGluZQogICAxMCA6IHRydWUsCiAgIC8vIGNhcnJpYWdlIHJldHVybgogICAxMyA6IHRydWUsCiAgIC8vIGRvdWJsZSBxdW90ZQogICAzNCA6IHRydWUsCiAgIC8vIHNpbmdsZSBxdW90ZQogICAzOSA6IHRydWUsCiAgIC8vIGxlc3MgdGhhbgogICA2MCA6IHRydWUsCiAgIC8vIGdyZWF0ZXIgdGhhbgogICA2MiA6IHRydWUsCiAgIC8vIEJhY2tzbGFzaAogICA5MiA6IHRydWUsCiAgIC8vIGxpbmUgc2VwYXJhdG9yCiAgIDgyMzIgOiB0cnVlLAogICAvLyBwYXJhZ3JhcGggc2VwYXJhdG9yCiAgIDgyMzMgOiB0cnVlCiAgfTsKCiAgLyoqCiAgICogUmVndWxhciBleHByZXNzaW9uIGNhbGxiYWNrIHRoYXQgcmV0dXJucyBzdHJpbmdzIGZyb20gdW5pY29kZSBjb2RlIHBvaW50cy4KICAgKgogICAqIEBwYXJhbSB7QXJyYXl9IG1hdGNoIElnbm9yZWQKICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVGhlIGNvZGVwb2ludCB2YWx1ZSB0byBjb252ZXJ0CiAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgY2hhcmFjdGVyIGNvcnJlc3BvbmRpbmcgdG8gdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gdW5lc2NhcGVFbnRpdHkobWF0Y2gsIHZhbHVlKSB7CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBJbml0aWFsaXplcyBmZWF0dXJlIHBhcmFtZXRlcnMuCiAgICovCiAgZnVuY3Rpb24gaW5pdChjb25maWcpIHsKICAgIGZlYXR1cmVzID0gY29uZmlnWyJjb3JlLnV0aWwiXSB8fCB7fTsKICB9CiAgaWYgKGdhZGdldHMuY29uZmlnKSB7CiAgICBnYWRnZXRzLmNvbmZpZy5yZWdpc3RlcigiY29yZS51dGlsIiwgbnVsbCwgaW5pdCk7CiAgfQoKICByZXR1cm4gLyoqIEBzY29wZSBnYWRnZXRzLnV0aWwgKi8gewoKICAgIC8qKgogICAgICogR2V0cyB0aGUgVVJMIHBhcmFtZXRlcnMuCiAgICAgKgogICAgICogQHJldHVybiB7T2JqZWN0fSBQYXJhbWV0ZXJzIHBhc3NlZCBpbnRvIHRoZSBxdWVyeSBzdHJpbmcKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy51dGlsCiAgICAgKiBAcHJpdmF0ZSBJbXBsZW1lbnRhdGlvbiBkZXRhaWwuCiAgICAgKi8KICAgIGdldFVybFBhcmFtZXRlcnMgOiBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChwYXJhbWV0ZXJzICE9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnM7CiAgICAgIH0KICAgICAgcGFyYW1ldGVycyA9IHt9OwogICAgICB2YXIgcGFpcnMgPSBwYXJzZVVybFBhcmFtcygpOwogICAgICB2YXIgdW5lc2MgPSB3aW5kb3cuZGVjb2RlVVJJQ29tcG9uZW50ID8gZGVjb2RlVVJJQ29tcG9uZW50IDogdW5lc2NhcGU7CiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gcGFpcnMubGVuZ3RoOyBpIDwgajsgKytpKSB7CiAgICAgICAgdmFyIHBvcyA9IHBhaXJzW2ldLmluZGV4T2YoJz0nKTsKICAgICAgICBpZiAocG9zID09PSAtMSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciBhcmdOYW1lID0gcGFpcnNbaV0uc3Vic3RyaW5nKDAsIHBvcyk7CiAgICAgICAgdmFyIHZhbHVlID0gcGFpcnNbaV0uc3Vic3RyaW5nKHBvcyArIDEpOwogICAgICAgIC8vIGRpZmZlcmVuY2UgdG8gSUdfUHJlZnMsIGlzIHRoYXQgYXJncyBkb2Vzbid0IHJlcGxhY2Ugc3BhY2VzIGluCiAgICAgICAgLy8gYXJnbmFtZS4gVW5jbGVhciBvbiBpZiBpdCBzaG91bGQgZG86CiAgICAgICAgLy8gYXJnbmFtZSA9IGFyZ25hbWUucmVwbGFjZSgvXCsvZywgIiAiKTsKICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1wrL2csICIgIik7CiAgICAgICAgcGFyYW1ldGVyc1thcmdOYW1lXSA9IHVuZXNjKHZhbHVlKTsKICAgICAgfQogICAgICByZXR1cm4gcGFyYW1ldGVyczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgY2xvc3VyZSB0aGF0IGlzIHN1aXRhYmxlIGZvciBwYXNzaW5nIGFzIGEgY2FsbGJhY2suCiAgICAgKiBBbnkgbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgICogbWF5IGJlIHBhc3NlZCB0byB0aGUgY2FsbGJhY2s7CiAgICAgKiB0aGV5IHdpbGwgYmUgcmVjZWl2ZWQgaW4gdGhlIG9yZGVyIHRoZXkgYXJlIHBhc3NlZCBpbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2NvcGUgVGhlIGV4ZWN1dGlvbiBzY29wZTsgbWF5IGJlIG51bGwgaWYgdGhlcmUgaXMgbm8KICAgICAqICAgICBuZWVkIHRvIGFzc29jaWF0ZSBhIHNwZWNpZmljIGluc3RhbmNlIG9mIGFuIG9iamVjdCB3aXRoIHRoaXMKICAgICAqICAgICBjYWxsYmFjawogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGludm9rZSB3aGVuIHRoaXMgaXMgcnVuOwogICAgICogICAgIGFueSBhcmd1bWVudHMgcGFzc2VkIGluIHdpbGwgYmUgcGFzc2VkIGFmdGVyIHlvdXIgaW5pdGlhbCBhcmd1bWVudHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YXJfYXJncyBJbml0aWFsIGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnV0aWwKICAgICAqIEBwcml2YXRlIEltcGxlbWVudGF0aW9uIGRldGFpbC4KICAgICAqLwogICAgbWFrZUNsb3N1cmUgOiBmdW5jdGlvbiAoc2NvcGUsIGNhbGxiYWNrLCB2YXJfYXJncykgewogICAgICAvLyBhcmd1bWVudHMgaXNuJ3QgYSByZWFsIGFycmF5LCBzbyB3ZSBjb3B5IGl0IGludG8gb25lLgogICAgICB2YXIgYmFzZUFyZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDIsIGogPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgajsgKytpKSB7CiAgICAgICBiYXNlQXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIGFwcGVuZCBuZXcgYXJndW1lbnRzLgogICAgICAgIHZhciB0bXBBcmdzID0gYmFzZUFyZ3Muc2xpY2UoKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBqOyArK2kpIHsKICAgICAgICAgIHRtcEFyZ3MucHVzaChhcmd1bWVudHNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsbGJhY2suYXBwbHkoc2NvcGUsIHRtcEFyZ3MpOwogICAgICB9OwogICAgfSwKCiAgICAvKioKICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gZm9yIGdlbmVyYXRpbmcgYW4gImVudW0iIGZyb20gYW4gYXJyYXkuCiAgICAgKgogICAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPn0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gZ2VuZXJhdGUuCiAgICAgKiBAcmV0dXJuIHtNYXAmbHQ7U3RyaW5nLFN0cmluZyZndDt9IEFuIG9iamVjdCB3aXRoIG1lbWJlciBmaWVsZHMgdG8gaGFuZGxlCiAgICAgKiAgIHRoZSBlbnVtLgogICAgICoKICAgICAqIEBwcml2YXRlIEltcGxlbWVudGF0aW9uIGRldGFpbC4KICAgICAqLwogICAgbWFrZUVudW0gOiBmdW5jdGlvbiAodmFsdWVzKSB7CiAgICAgIHZhciBvYmogPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDAsIHY7IHYgPSB2YWx1ZXNbaV07ICsraSkgewogICAgICAgIG9ialt2XSA9IHY7CiAgICAgIH0KICAgICAgcmV0dXJuIG9iajsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBmZWF0dXJlIHBhcmFtZXRlcnMuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGZlYXR1cmUgVGhlIGZlYXR1cmUgdG8gZ2V0IHBhcmFtZXRlcnMgZm9yCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBwYXJhbWV0ZXJzIGZvciB0aGUgZ2l2ZW4gZmVhdHVyZSwgb3IgbnVsbAogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy51dGlsCiAgICAgKi8KICAgIGdldEZlYXR1cmVQYXJhbWV0ZXJzIDogZnVuY3Rpb24gKGZlYXR1cmUpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBmZWF0dXJlc1tmZWF0dXJlXSA9PT0gInVuZGVmaW5lZCIKICAgICAgICAgID8gbnVsbCA6IGZlYXR1cmVzW2ZlYXR1cmVdOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgY3VycmVudCBmZWF0dXJlIGlzIHN1cHBvcnRlZC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmVhdHVyZSBUaGUgZmVhdHVyZSB0byB0ZXN0IGZvcgogICAgICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgZmVhdHVyZSBpcyBzdXBwb3J0ZWQKICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMudXRpbAogICAgICovCiAgICBoYXNGZWF0dXJlIDogZnVuY3Rpb24gKGZlYXR1cmUpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBmZWF0dXJlc1tmZWF0dXJlXSAhPT0gInVuZGVmaW5lZCI7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVnaXN0ZXJzIGFuIG9ubG9hZCBoYW5kbGVyLgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGhhbmRsZXIgdG8gcnVuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnV0aWwKICAgICAqLwogICAgcmVnaXN0ZXJPbkxvYWRIYW5kbGVyIDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgIG9uTG9hZEhhbmRsZXJzLnB1c2goY2FsbGJhY2spOwogICAgfSwKCiAgICAvKioKICAgICAqIFJ1bnMgYWxsIGZ1bmN0aW9ucyByZWdpc3RlcmVkIHZpYSByZWdpc3Rlck9uTG9hZEhhbmRsZXIuCiAgICAgKiBAcHJpdmF0ZSBPbmx5IHRvIGJlIHVzZWQgYnkgdGhlIGNvbnRhaW5lciwgbm90IGdhZGdldHMuCiAgICAgKi8KICAgIHJ1bk9uTG9hZEhhbmRsZXJzIDogZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciBpID0gMCwgaiA9IG9uTG9hZEhhbmRsZXJzLmxlbmd0aDsgaSA8IGo7ICsraSkgewogICAgICAgIG9uTG9hZEhhbmRsZXJzW2ldKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBFc2NhcGVzIHRoZSBpbnB1dCB1c2luZyBodG1sIGVudGl0aWVzIHRvIG1ha2UgaXQgc2FmZXIuCiAgICAgKgogICAgICogSWYgdGhlIGlucHV0IGlzIGEgc3RyaW5nLCB1c2VzIGdhZGdldHMudXRpbC5lc2NhcGVTdHJpbmcuCiAgICAgKiBJZiBpdCBpcyBhbiBhcnJheSwgY2FsbHMgZXNjYXBlIG9uIGVhY2ggb2YgdGhlIGFycmF5IGVsZW1lbnRzCiAgICAgKiBpZiBpdCBpcyBhbiBvYmplY3QsIHdpbGwgb25seSBlc2NhcGUgYWxsIHRoZSBtYXBwZWQga2V5cyBhbmQgdmFsdWVzIGlmCiAgICAgKiB0aGUgb3B0X2VzY2FwZU9iamVjdHMgZmxhZyBpcyBzZXQuIFRoaXMgb3BlcmF0aW9uIGludm9sdmVzIGNyZWF0aW5nIGFuCiAgICAgKiBlbnRpcmVseSBuZXcgb2JqZWN0IHNvIG9ubHkgc2V0IHRoZSBmbGFnIHdoZW4gdGhlIGlucHV0IGlzIGEgc2ltcGxlCiAgICAgKiBzdHJpbmcgdG8gc3RyaW5nIG1hcC4KICAgICAqIE90aGVyd2lzZSwgZG9lcyBub3QgYXR0ZW1wdCB0byBtb2RpZnkgdGhlIGlucHV0LgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dCBUaGUgb2JqZWN0IHRvIGVzY2FwZQogICAgICogQHBhcmFtIHtCb29sZWFufSBvcHRfZXNjYXBlT2JqZWN0cyBXaGV0aGVyIHRvIGVzY2FwZSBvYmplY3RzLgogICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgZXNjYXBlZCBvYmplY3QKICAgICAqIEBwcml2YXRlIE9ubHkgdG8gYmUgdXNlZCBieSB0aGUgY29udGFpbmVyLCBub3QgZ2FkZ2V0cy4KICAgICAqLwogICAgZXNjYXBlIDogZnVuY3Rpb24oaW5wdXQsIG9wdF9lc2NhcGVPYmplY3RzKSB7CiAgICAgIGlmICghaW5wdXQpIHsKICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBnYWRnZXRzLnV0aWwuZXNjYXBlU3RyaW5nKGlucHV0KTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICJhcnJheSIpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IGlucHV0Lmxlbmd0aDsgaSA8IGo7ICsraSkgewogICAgICAgICAgaW5wdXRbaV0gPSBnYWRnZXRzLnV0aWwuZXNjYXBlKGlucHV0W2ldKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAib2JqZWN0IiAmJiBvcHRfZXNjYXBlT2JqZWN0cykgewogICAgICAgIHZhciBuZXdPYmplY3QgPSB7fTsKICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBpbnB1dCkgaWYgKGlucHV0Lmhhc093blByb3BlcnR5KGZpZWxkKSkgewogICAgICAgICAgbmV3T2JqZWN0W2dhZGdldHMudXRpbC5lc2NhcGVTdHJpbmcoZmllbGQpXQogICAgICAgICAgICAgID0gZ2FkZ2V0cy51dGlsLmVzY2FwZShpbnB1dFtmaWVsZF0sIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3T2JqZWN0OwogICAgICB9CiAgICAgIHJldHVybiBpbnB1dDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBFc2NhcGVzIHRoZSBpbnB1dCB1c2luZyBodG1sIGVudGl0aWVzIHRvIG1ha2UgaXQgc2FmZXIuCiAgICAgKgogICAgICogQ3VycmVudGx5IG5vdCBpbiB0aGUgc3BlYyAtLSBmdXR1cmUgcHJvcG9zYWxzIG1heSBjaGFuZ2UKICAgICAqIGhvdyB0aGlzIGlzIGhhbmRsZWQuCiAgICAgKgogICAgICogVE9ETzogUGFyc2luZyB0aGUgc3RyaW5nIHdvdWxkIHByb2JhYmx5IGJlIG1vcmUgYWNjdXJhdGUgYW5kIGZhc3RlciB0aGFuCiAgICAgKiBhIGJ1bmNoIG9mIHJlZ3VsYXIgZXhwcmVzc2lvbnMuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGVzY2FwZQogICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgZXNjYXBlZCBzdHJpbmcKICAgICAqLwogICAgZXNjYXBlU3RyaW5nIDogZnVuY3Rpb24oc3RyKSB7CiAgICAgIHZhciBvdXQgPSBbXSwgY2gsIHNob3VsZEVzY2FwZTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBzdHIubGVuZ3RoOyBpIDwgajsgKytpKSB7CiAgICAgICAgY2ggPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICAgICBzaG91bGRFc2NhcGUgPSBlc2NhcGVDb2RlUG9pbnRzW2NoXTsKICAgICAgICBpZiAoc2hvdWxkRXNjYXBlID09PSB0cnVlKSB7CiAgICAgICAgICBvdXQucHVzaCgiJiMiLCBjaCwgIjsiKTsKICAgICAgICB9IGVsc2UgaWYgKHNob3VsZEVzY2FwZSAhPT0gZmFsc2UpIHsKICAgICAgICAgIC8vIHVuZGVmaW5lZCBvciBudWxsIGFyZSBPSy4KICAgICAgICAgIG91dC5wdXNoKHN0ci5jaGFyQXQoaSkpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb3V0LmpvaW4oIiIpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldmVyc2VzIGVzY2FwZVN0cmluZwogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byB1bmVzY2FwZS4KICAgICAqLwogICAgdW5lc2NhcGVTdHJpbmcgOiBmdW5jdGlvbihzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8mIyhbMC05XSspOy9nLCB1bmVzY2FwZUVudGl0eSk7CiAgICB9CiAgfTsKfSgpOwovLyBJbml0aWFsaXplIHVybCBwYXJhbWV0ZXJzIHNvIHRoYXQgaGFzaCBkYXRhIGlzIHB1bGxlZCBpbiBiZWZvcmUgaXQgY2FuIGJlCi8vIGFsdGVyZWQgYnkgYSBjbGljay4KZ2FkZ2V0cy51dGlsLmdldFVybFBhcmFtZXRlcnMoKTsKCgovKgogKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQogKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIEBmaWxlb3ZlcnZpZXcKICogVGhlIGdsb2JhbCBvYmplY3QgZ2FkZ2V0cy5qc29uIGNvbnRhaW5zIHR3byBtZXRob2RzLgogKgogKiBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KHZhbHVlKSB0YWtlcyBhIEphdmFTY3JpcHQgdmFsdWUgYW5kIHByb2R1Y2VzIGEgSlNPTgogKiB0ZXh0LiBUaGUgdmFsdWUgbXVzdCBub3QgYmUgY3ljbGljYWwuCiAqCiAqIGdhZGdldHMuanNvbi5wYXJzZSh0ZXh0KSB0YWtlcyBhIEpTT04gdGV4dCBhbmQgcHJvZHVjZXMgYSBKYXZhU2NyaXB0IHZhbHVlLgogKiBJdCB3aWxsIHJldHVybiBmYWxzZSBpZiB0aGVyZSBpcyBhbiBlcnJvci4KKi8KCnZhciBnYWRnZXRzID0gZ2FkZ2V0cyB8fCB7fTsKCi8qKgogKiBAc3RhdGljCiAqIEBjbGFzcyBQcm92aWRlcyBvcGVyYXRpb25zIGZvciB0cmFuc2xhdGluZyBvYmplY3RzIHRvIGFuZCBmcm9tIEpTT04uCiAqIEBuYW1lIGdhZGdldHMuanNvbgogKi8KCi8qKgogKiBQb3J0IG9mIHRoZSBwdWJsaWMgZG9tYWluIEpTT04gbGlicmFyeSBieSBEb3VnbGFzIENyb2NrZm9yZC4KICogU2VlOiBodHRwOi8vd3d3Lmpzb24ub3JnL2pzb24yLmpzCiAqLwpnYWRnZXRzLmpzb24gPSBmdW5jdGlvbiAoKSB7CgogIC8qKgogICAqIEZvcm1hdHMgaW50ZWdlcnMgdG8gMiBkaWdpdHMuCiAgICogQHBhcmFtIHtOdW1iZXJ9IG4KICAgKi8KICBmdW5jdGlvbiBmKG4pIHsKICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICB9CgogIERhdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBbdGhpcy5nZXRVVENGdWxsWWVhcigpLCAnLScsCiAgICAgICAgICAgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSwgJy0nLAogICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpLCAnVCcsCiAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpLCAnOicsCiAgICAgICAgICAgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSksICc6JywKICAgICAgICAgICBmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSwgJ1onXS5qb2luKCIiKTsKICB9OwoKICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwogIHZhciBtID0gewogICAgJ1xiJzogJ1xcYicsCiAgICAnXHQnOiAnXFx0JywKICAgICdcbic6ICdcXG4nLAogICAgJ1xmJzogJ1xcZicsCiAgICAnXHInOiAnXFxyJywKICAgICciJyA6ICdcXCInLAogICAgJ1xcJzogJ1xcXFwnCiAgfTsKCiAgLyoqCiAgICogQ29udmVydHMgYSBqc29uIG9iamVjdCBpbnRvIGEgc3RyaW5nLgogICAqLwogIGZ1bmN0aW9uIHN0cmluZ2lmeSh2YWx1ZSkgewogICAgdmFyIGEsICAgICAgICAgIC8vIFRoZSBhcnJheSBob2xkaW5nIHRoZSBwYXJ0aWFsIHRleHRzLgogICAgICAgIGksICAgICAgICAgIC8vIFRoZSBsb29wIGNvdW50ZXIuCiAgICAgICAgaywgICAgICAgICAgLy8gVGhlIG1lbWJlciBrZXkuCiAgICAgICAgbCwgICAgICAgICAgLy8gTGVuZ3RoLgogICAgICAgIHIgPSAvWyJcXFx4MDAtXHgxZlx4N2YtXHg5Zl0vZywKICAgICAgICB2OyAgICAgICAgICAvLyBUaGUgbWVtYmVyIHZhbHVlLgoKICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7CiAgICBjYXNlICdzdHJpbmcnOgogICAgLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBubyBjb250cm9sIGNoYXJhY3RlcnMsIG5vIHF1b3RlIGNoYXJhY3RlcnMsIGFuZCBubwogICAgLy8gYmFja3NsYXNoIGNoYXJhY3RlcnMsIHRoZW4gd2UgY2FuIHNhZmVseSBzbGFwIHNvbWUgcXVvdGVzIGFyb3VuZCBpdC4KICAgIC8vIE90aGVyd2lzZSB3ZSBtdXN0IGFsc28gcmVwbGFjZSB0aGUgb2ZmZW5kaW5nIGNoYXJhY3RlcnMgd2l0aCBzYWZlIG9uZXMuCiAgICAgIHJldHVybiByLnRlc3QodmFsdWUpID8KICAgICAgICAgICciJyArIHZhbHVlLnJlcGxhY2UociwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgdmFyIGMgPSBtW2FdOwogICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgIHJldHVybiBjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGMgPSBhLmNoYXJDb2RlQXQoKTsKICAgICAgICAgICAgcmV0dXJuICdcXHUwMCcgKyBNYXRoLmZsb29yKGMgLyAxNikudG9TdHJpbmcoMTYpICsKICAgICAgICAgICAgICAgIChjICUgMTYpLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgfSkgKyAnIicKICAgICAgICAgIDogJyInICsgdmFsdWUgKyAnIic7CiAgICBjYXNlICdudW1iZXInOgogICAgLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCiAgICAgIHJldHVybiBpc0Zpbml0ZSh2YWx1ZSkgPyBTdHJpbmcodmFsdWUpIDogJ251bGwnOwogICAgY2FzZSAnYm9vbGVhbic6CiAgICBjYXNlICdudWxsJzoKICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7CiAgICBjYXNlICdvYmplY3QnOgogICAgLy8gRHVlIHRvIGEgc3BlY2lmaWNhdGlvbiBibHVuZGVyIGluIEVDTUFTY3JpcHQsCiAgICAvLyB0eXBlb2YgbnVsbCBpcyAnb2JqZWN0Jywgc28gd2F0Y2ggb3V0IGZvciB0aGF0IGNhc2UuCiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gJ251bGwnOwogICAgICB9CiAgICAgIC8vIHRvSlNPTiBjaGVjayByZW1vdmVkOyByZS1pbXBsZW1lbnQgd2hlbiBpdCBkb2Vzbid0IGJyZWFrIG90aGVyIGxpYnMuCiAgICAgIGEgPSBbXTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZS5sZW5ndGggPT09ICdudW1iZXInICYmCiAgICAgICAgICAhKHZhbHVlLnByb3BlcnR5SXNFbnVtZXJhYmxlKCdsZW5ndGgnKSkpIHsKICAgICAgICAvLyBUaGUgb2JqZWN0IGlzIGFuIGFycmF5LiBTdHJpbmdpZnkgZXZlcnkgZWxlbWVudC4gVXNlIG51bGwgYXMgYQogICAgICAgIC8vIHBsYWNlaG9sZGVyIGZvciBub24tSlNPTiB2YWx1ZXMuCiAgICAgICAgbCA9IHZhbHVlLmxlbmd0aDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbDsgaSArPSAxKSB7CiAgICAgICAgICBhLnB1c2goc3RyaW5naWZ5KHZhbHVlW2ldKSB8fCAnbnVsbCcpOwogICAgICAgIH0KICAgICAgICAvLyBKb2luIGFsbCBvZiB0aGUgZWxlbWVudHMgdG9nZXRoZXIgYW5kIHdyYXAgdGhlbSBpbiBicmFja2V0cy4KICAgICAgICByZXR1cm4gJ1snICsgYS5qb2luKCcsJykgKyAnXSc7CiAgICAgIH0KICAgICAgLy8gT3RoZXJ3aXNlLCBpdGVyYXRlIHRocm91Z2ggYWxsIG9mIHRoZSBrZXlzIGluIHRoZSBvYmplY3QuCiAgICAgIGZvciAoayBpbiB2YWx1ZSkgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgaWYgKHR5cGVvZiBrID09PSAnc3RyaW5nJykgewogICAgICAgICAgdiA9IHN0cmluZ2lmeSh2YWx1ZVtrXSk7CiAgICAgICAgICBpZiAodikgewogICAgICAgICAgICBhLnB1c2goc3RyaW5naWZ5KGspICsgJzonICsgdik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIEpvaW4gYWxsIG9mIHRoZSBtZW1iZXIgdGV4dHMgdG9nZXRoZXIgYW5kIHdyYXAgdGhlbSBpbiBicmFjZXMuCiAgICAgIHJldHVybiAneycgKyBhLmpvaW4oJywnKSArICd9JzsKICAgIH0KICB9CgogIHJldHVybiB7CiAgICBzdHJpbmdpZnk6IHN0cmluZ2lmeSwKICAgIHBhcnNlOiBmdW5jdGlvbiAodGV4dCkgewovLyBQYXJzaW5nIGhhcHBlbnMgaW4gdGhyZWUgc3RhZ2VzLiBJbiB0aGUgZmlyc3Qgc3RhZ2UsIHdlIHJ1biB0aGUgdGV4dCBhZ2FpbnN0Ci8vIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdGhhdCBsb29rIGZvciBub24tSlNPTiBwYXR0ZXJucy4gV2UgYXJlIGVzcGVjaWFsbHkKLy8gY29uY2VybmVkIHdpdGggJygpJyBhbmQgJ25ldycgYmVjYXVzZSB0aGV5IGNhbiBjYXVzZSBpbnZvY2F0aW9uLCBhbmQgJz0nCi8vIGJlY2F1c2UgaXQgY2FuIGNhdXNlIG11dGF0aW9uLiBCdXQganVzdCB0byBiZSBzYWZlLCB3ZSB3YW50IHRvIHJlamVjdCBhbGwKLy8gdW5leHBlY3RlZCBmb3Jtcy4KCi8vIFdlIHNwbGl0IHRoZSBmaXJzdCBzdGFnZSBpbnRvIDQgcmVnZXhwIG9wZXJhdGlvbnMgaW4gb3JkZXIgdG8gd29yayBhcm91bmQKLy8gY3JpcHBsaW5nIGluZWZmaWNpZW5jaWVzIGluIElFJ3MgYW5kIFNhZmFyaSdzIHJlZ2V4cCBlbmdpbmVzLiBGaXJzdCB3ZQovLyByZXBsYWNlIGFsbCBiYWNrc2xhc2ggcGFpcnMgd2l0aCAnQCcgKGEgbm9uLUpTT04gY2hhcmFjdGVyKS4gU2Vjb25kLCB3ZQovLyByZXBsYWNlIGFsbCBzaW1wbGUgdmFsdWUgdG9rZW5zIHdpdGggJ10nIGNoYXJhY3RlcnMuIFRoaXJkLCB3ZSBkZWxldGUgYWxsCi8vIG9wZW4gYnJhY2tldHMgdGhhdCBmb2xsb3cgYSBjb2xvbiBvciBjb21tYSBvciB0aGF0IGJlZ2luIHRoZSB0ZXh0LiBGaW5hbGx5LAovLyB3ZSBsb29rIHRvIHNlZSB0aGF0IHRoZSByZW1haW5pbmcgY2hhcmFjdGVycyBhcmUgb25seSB3aGl0ZXNwYWNlIG9yICddJyBvcgovLyAnLCcgb3IgJzonIG9yICd7JyBvciAnfScuIElmIHRoYXQgaXMgc28sIHRoZW4gdGhlIHRleHQgaXMgc2FmZSBmb3IgZXZhbC4KCiAgICAgIGlmICgvXltcXSw6e31cc10qJC8udGVzdCh0ZXh0LnJlcGxhY2UoL1xcWyJcXFwvYi11XS9nLCAnQCcpLgogICAgICAgICAgcmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csICddJykuCiAgICAgICAgICByZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csICcnKSkpIHsKICAgICAgICByZXR1cm4gZXZhbCgnKCcgKyB0ZXh0ICsgJyknKTsKICAgICAgfQogICAgICAvLyBJZiB0aGUgdGV4dCBpcyBub3QgSlNPTiBwYXJzZWFibGUsIHRoZW4gcmV0dXJuIGZhbHNlLgoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH07Cn0oKTsKCgovKgogKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQogKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IFJlbW90ZSBwcm9jZWR1cmUgY2FsbCBsaWJyYXJ5IGZvciBnYWRnZXQtdG8tY29udGFpbmVyLAogKiBjb250YWluZXItdG8tZ2FkZ2V0LCBhbmQgZ2FkZ2V0LXRvLWdhZGdldCAodGhydSBjb250YWluZXIpIGNvbW11bmljYXRpb24uCiAqLwoKdmFyIGdhZGdldHMgPSBnYWRnZXRzIHx8IHt9OwoKLyoqCiAqIEBzdGF0aWMKICogQGNsYXNzIFByb3ZpZGVzIG9wZXJhdGlvbnMgZm9yIG1ha2luZyBycGMgY2FsbHMuCiAqIEBuYW1lIGdhZGdldHMucnBjCiAqLwpnYWRnZXRzLnJwYyA9IGZ1bmN0aW9uKCkgewogIC8vYWxlcnQoIkluaXRpbmcgZ2FkZ2V0cy5ycGMiKTsKICAvLyBHZW5lcmFsIGNvbnN0YW50cy4KICB2YXIgQ0FMTEJBQ0tfTkFNRSA9ICdfX2NiJzsKICB2YXIgREVGQVVMVF9OQU1FID0gJyc7CgogIC8vIENvbnN0cyBmb3IgRnJhbWVFbGVtZW50LgogIHZhciBGRV9HMkNfQ0hBTk5FTCA9ICdfX2cyY19ycGMnOwogIHZhciBGRV9DMkdfQ0hBTk5FTCA9ICdfX2MyZ19ycGMnOwoKICAvLyBDb25zdHMgZm9yIE5JWC4gVkJTY3JpcHQgZG9lc24ndAogIC8vIGFsbG93IGl0ZW1zIHRvIHN0YXJ0IHdpdGggXyBmb3Igc29tZSByZWFzb24sCiAgLy8gc28gd2UgbmVlZCB0byBtYWtlIHRoZXNlIG5hbWVzIHF1aXRlIHVuaXF1ZSwgYXMKICAvLyB0aGV5IHdpbGwgZ28gaW50byB0aGUgZ2xvYmFsIG5hbWVzcGFjZS4KICB2YXIgTklYX1dSQVBQRVIgPSAnR1JQQ19fX19OSVhWQlNfd3JhcHBlcic7CiAgdmFyIE5JWF9HRVRfV1JBUFBFUiA9ICdHUlBDX19fX05JWFZCU19nZXRfd3JhcHBlcic7CiAgdmFyIE5JWF9IQU5ETEVfTUVTU0FHRSA9ICdHUlBDX19fX05JWFZCU19oYW5kbGVfbWVzc2FnZSc7CiAgdmFyIE5JWF9DUkVBVEVfQ0hBTk5FTCA9ICdHUlBDX19fX05JWFZCU19jcmVhdGVfY2hhbm5lbCc7CgogIC8vIEphdmFTY3JpcHQgcmVmZXJlbmNlIHRvIHRoZSBOSVggVkJTY3JpcHQgd3JhcHBlcnMuCiAgLy8gR2FkZ2V0cyB3aWxsIGhhdmUgYnV0IGEgc2luZ2xlIGNoYW5uZWwgdW5kZXIKICAvLyBuaXhfY2hhbm5lbHNbJy4uJ10gd2hpbGUgY29udGFpbmVycyB3aWxsIGhhdmUgYSBjaGFubmVsCiAgLy8gcGVyIGdhZGdldCBzdG9yZWQgdW5kZXIgdGhlIGdhZGdldCdzIElELgogIHZhciBuaXhfY2hhbm5lbHMgPSB7fTsKCiAgdmFyIHNlcnZpY2VzID0ge307CiAgdmFyIGlmcmFtZVBvb2wgPSBbXTsKICB2YXIgcmVsYXlVcmwgPSB7fTsKICB2YXIgdXNlTGVnYWN5UHJvdG9jb2wgPSB7fTsKICB2YXIgYXV0aFRva2VuID0ge307CiAgdmFyIGNhbGxJZCA9IDA7CiAgdmFyIGNhbGxiYWNrcyA9IHt9OwogIHZhciBzZXR1cCA9IHt9OwogIHZhciBzYW1lRG9tYWluID0ge307CiAgdmFyIHBhcmFtcyA9IHt9OwoKICAvLyBMb2FkIHRoZSBhdXRoZW50aWNhdGlvbiB0b2tlbiBmb3Igc3BlYWtpbmcgdG8gdGhlIGNvbnRhaW5lcgogIC8vIGZyb20gdGhlIGdhZGdldCdzIHBhcmFtZXRlcnMsIG9yIGRlZmF1bHQgdG8gJzAnIGlmIG5vdCBmb3VuZC4KICBpZiAoZ2FkZ2V0cy51dGlsKSB7CiAgICBwYXJhbXMgPSBnYWRnZXRzLnV0aWwuZ2V0VXJsUGFyYW1ldGVycygpOwoJLy9hbGVydCgiZ2FkZ2V0IHBhcmFtczogIiArIHBhcmFtcyk7CiAgfQoKICBhdXRoVG9rZW5bJy4uJ10gPSBwYXJhbXMucnBjdG9rZW4gfHwgcGFyYW1zLmlmcGN0b2sgfHwgMDsKCiAgLy9pZnBjIG1vZHMKICB2YXIgVVJMX0xJTUlUID0gMjAwMDsKICB2YXIgbWVzc2FnZXNJbiA9IHt9OwogIHZhciB1c2VNdWx0aVBhcnRNZXNzYWdlcyA9IHt9OwogIC8vaWZwYyBtb2RzCgoKICAvKgogICAqIFJldHVybiBhIHNob3J0IGNvZGUgcmVwcmVzZW50aW5nIHRoZSBiZXN0IGF2YWlsYWJsZSBjcm9zcy1kb21haW4KICAgKiBtZXNzYWdlIHRyYW5zcG9ydCBhdmFpbGFibGUgdG8gdGhlIGJyb3dzZXIuCiAgICoKICAgKiArIEZvciB0aG9zZSBicm93c2VycyB0aGF0IHN1cHBvcnQgbmF0aXZlIG1lc3NhZ2luZyAodmFyaW91cyBpbXBsZW1lbnRhdGlvbnMKICAgKiAgIG9mIHRoZSBIVE1MNSBwb3N0TWVzc2FnZSBtZXRob2QpLCB1c2UgdGhhdC4gT2ZmaWNpYWxseSBkZWZpbmVkIGF0CiAgICogICBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS9jb21tcy5odG1sLgogICAqCiAgICogICBwb3N0TWVzc2FnZSBpcyBhIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbiBvZiBYREMuIEEgcGFnZSByZWdpc3RlcnMgdGhhdAogICAqICAgaXQgd291bGQgbGlrZSB0byByZWNlaXZlIG1lc3NhZ2VzIGJ5IGxpc3RlbmluZyB0aGUgdGhlICJtZXNzYWdlIiBldmVudAogICAqICAgb24gdGhlIHdpbmRvdyAoZG9jdW1lbnQgaW4gRFBNKSBvYmplY3QuIEluIHR1cm4sIGFub3RoZXIgcGFnZSBjYW4KICAgKiAgIHJhaXNlIHRoYXQgZXZlbnQgYnkgY2FsbGluZyB3aW5kb3cucG9zdE1lc3NhZ2UgKGRvY3VtZW50LnBvc3RNZXNzYWdlCiAgICogICBpbiBEUE0pIHdpdGggYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBtZXNzYWdlIGFuZCBhIHN0cmluZwogICAqICAgaW5kaWNhdGluZyBvbiB3aGljaCBkb21haW4gdGhlIHJlY2VpdmluZyBwYWdlIG11c3QgYmUgdG8gcmVjZWl2ZQogICAqICAgdGhlIG1lc3NhZ2UuIFRoZSB0YXJnZXQgcGFnZSB3aWxsIHRoZW4gaGF2ZSBpdHMgIm1lc3NhZ2UiIGV2ZW50IHJhaXNlZAogICAqICAgaWYgdGhlIGRvbWFpbiBtYXRjaGVzIGFuZCBjYW4sIGluIHR1cm4sIGNoZWNrIHRoZSBvcmlnaW4gb2YgdGhlIG1lc3NhZ2UKICAgKiAgIGFuZCBwcm9jZXNzIHRoZSBkYXRhIGNvbnRhaW5lZCB3aXRoaW4uCiAgICoKICAgKiAgICAgd3BtOiBwb3N0TWVzc2FnZSBvbiB0aGUgd2luZG93IG9iamVjdC4KICAgKiAgICAgICAgLSBJbnRlcm5ldCBFeHBsb3JlciA4KwogICAqICAgICAgICAtIFNhZmFyaSAobGF0ZXN0IG5pZ2h0bGllcyBhcyBvZiAyNi82LzIwMDgpCiAgICogICAgICAgIC0gRmlyZWZveCAzKwogICAqICAgICAgICAtIE9wZXJhIDkrCiAgICoKICAgKiAgICAgZHBtOiBwb3N0TWVzc2FnZSBvbiB0aGUgZG9jdW1lbnQgb2JqZWN0LgogICAqICAgICAgICAtIE9wZXJhIDgrCiAgICoKICAgKiArIEZvciBJbnRlcm5ldCBFeHBsb3JlciBiZWZvcmUgdmVyc2lvbiA4LCB0aGUgc2VjdXJpdHkgbW9kZWwgYWxsb3dzIGFueW9uZQogICAqICAgcGFyZW50IHRvIHNldCB0aGUgdmFsdWUgb2YgdGhlICJvcGVuZXIiIHByb3BlcnR5IG9uIGFub3RoZXIgd2luZG93LAogICAqICAgd2l0aCBvbmx5IHRoZSByZWNlaXZpbmcgd2luZG93IGFibGUgdG8gcmVhZCBpdC4KICAgKiAgIFRoaXMgbWV0aG9kIGlzIGR1YmJlZCAiTmF0aXZlIElFIFhEQyIgKE5JWCkuCiAgICoKICAgKiAgIFRoaXMgbWV0aG9kIHdvcmtzIGJ5IHBsYWNpbmcgYSBoYW5kbGVyIG9iamVjdCBpbiB0aGUgIm9wZW5lciIgcHJvcGVydHkKICAgKiAgIG9mIGEgZ2FkZ2V0IHdoZW4gdGhlIGNvbnRhaW5lciBzZXRzIHVwIHRoZSBhdXRoZW50aWNhdGlvbiBpbmZvcm1hdGlvbgogICAqICAgZm9yIHRoYXQgZ2FkZ2V0IChieSBjYWxsaW5nIHNldEF1dGhUb2tlbiguLi4pKS4gQXQgdGhhdCBwb2ludCwgYSBOSVgKICAgKiAgIHdyYXBwZXIgaXMgY3JlYXRlZCBhbmQgcGxhY2VkIGludG8gdGhlIGdhZGdldCBieSBjYWxsaW5nCiAgICogICB0aGVmcmFtZS5jb250ZW50V2luZG93Lm9wZW5lciA9IHdyYXBwZXIuIE5vdGUgdGhhdCBhcyBhIHJlc3VsdCwgTklYIGNhbgogICAqICAgb25seSBiZSB1c2VkIGJ5IGEgY29udGFpbmVyIHRvIGNhbGwgYSBwYXJ0aWN1bGFyIGdhZGdldCAqYWZ0ZXIqIHRoYXQKICAgKiAgIGdhZGdldCBoYXMgY2FsbGVkIHRoZSBjb250YWluZXIgYXQgbGVhc3Qgb25jZSB2aWEgTklYLgogICAqCiAgICogICBUaGUgTklYIHdyYXBwZXJzIGluIHRoaXMgUlBDIGltcGxlbWVudGF0aW9uIGFyZSBpbnN0YW5jZXMgb2YgYSBWQlNjcmlwdAogICAqICAgY2xhc3MgdGhhdCBpcyBjcmVhdGVkIHdoZW4gdGhpcyBpbXBsZW1lbnRhdGlvbiBsb2Fkcy4gVGhlIHJlYXNvbiBmb3IKICAgKiAgIHVzaW5nIGEgVkJTY3JpcHQgY2xhc3Mgc3RlbXMgZnJvbSB0aGUgZmFjdCB0aGF0IGFueSBvYmplY3QgY2FuIGJlIHBhc3NlZAogICAqICAgaW50byB0aGUgb3BlbmVyIHByb3BlcnR5LgogICAqICAgV2hpbGUgdGhpcyBpcyBhIGdvb2QgdGhpbmcsIGFzIGl0IGxldHMgdXMgcGFzcyBmdW5jdGlvbnMgYW5kIHNldHVwIGEgdHJ1ZQogICAqICAgYmlkaXJlY3Rpb25hbCBjaGFubmVsIHZpYSBjYWxsYmFja3MsIGl0IG9wZW5zIGEgcG90ZW50aWFsIHNlY3VyaXR5IGhvbGUKICAgKiAgIGJ5IHdoaWNoIHRoZSBvdGhlciBwYWdlIGNhbiBnZXQgYWhvbGQgb2YgdGhlICJ3aW5kb3ciIG9yICJkb2N1bWVudCIKICAgKiAgIG9iamVjdHMgaW4gdGhlIHBhcmVudCBwYWdlIGFuZCBpbiB0dXJuIHdyZWFrIGhhdm9rLiBUaGlzIGlzIGR1ZSB0byB0aGUKICAgKiAgIGZhY3QgdGhhdCBhbnkgSlMgb2JqZWN0IHVzZWZ1bCBmb3IgZXN0YWJsaXNoaW5nIHN1Y2ggYSBiaWRpcmVjdGlvbmFsCiAgICogICBjaGFubmVsIChzdWNoIGFzIGEgZnVuY3Rpb24pIGNhbiBiZSB1c2VkIHRvIGFjY2VzcyBhIGZ1bmN0aW9uCiAgICogICAoZWcuIG9iai50b1N0cmluZywgb3IgYSBmdW5jdGlvbiBpdHNlbGYpIGNyZWF0ZWQgaW4gYSBzcGVjaWZpYyBjb250ZXh0LAogICAqICAgaW4gcGFydGljdWxhciB0aGUgZ2xvYmFsIGNvbnRleHQgb2YgdGhlIHNlbmRlci4gU3VwcG9zZSBjb250YWluZXIKICAgKiAgIGRvbWFpbiBDIHBhc3NlcyBvYmplY3Qgb2JqIHRvIGdhZGdldCBvbiBkb21haW4gRy4gVGhlbiB0aGUgZ2FkZ2V0IGNhbgogICAqICAgYWNjZXNzIEMncyBnbG9iYWwgY29udGV4dCB1c2luZzoKICAgKiAgIHZhciBwYXJlbnRXaW5kb3cgPSAobmV3IG9iai50b1N0cmluZy5jb25zdHJ1Y3RvcigicmV0dXJuIHdpbmRvdzsiKSkoKTsKICAgKiAgIE51bGxpbmcgb3V0IGFsbCBvZiBvYmoncyBwcm9wZXJ0aWVzIGRvZXNuJ3QgZml4IHRoaXMsIHNpbmNlIElFIGhlbHBmdWxseQogICAqICAgcmVzdG9yZXMgdGhlbSB0byB0aGVpciBvcmlnaW5hbCB2YWx1ZXMgaWYgeW91IGRvIHNvbWV0aGluZyBsaWtlOgogICAqICAgZGVsZXRlIG9iai50b1N0cmluZzsgZGVsZXRlIG9iai50b1N0cmluZzsKICAgKiAgIFRodXMsIHdlIHdyYXAgdGhlIG5lY2Vzc2FyeSBmdW5jdGlvbnMgYW5kIGluZm9ybWF0aW9uIGluc2lkZSBhIFZCU2NyaXB0CiAgICogICBvYmplY3QuIFZCU2NyaXB0IG9iamVjdHMgaW4gSUUsIGxpa2UgRE9NIG9iamVjdHMsIGFyZSBpbiBmYWN0IENPTQogICAqICAgd3JhcHBlcnMgd2hlbiB1c2VkIGluIEphdmFTY3JpcHQsIHNvIHdlIGNhbiBzYWZlbHkgcGFzcyB0aGVtIGFyb3VuZAogICAqICAgd2l0aG91dCB3b3JyeWluZyBhYm91dCBhIGJyZWFjaCBvZiBjb250ZXh0IHdoaWxlIGF0IHRoZSBzYW1lIHRpbWUKICAgKiAgIGFsbG93aW5nIHRoZW0gdG8gYWN0IGFzIGEgcGFzcy10aHJvdWdoIG1lY2hhbmlzbSBmb3IgaW5mb3JtYXRpb24KICAgKiAgIGFuZCBmdW5jdGlvbiBjYWxscy4gVGhlIGltcGxlbWVudGF0aW9uIGRldGFpbHMgb2YgdGhpcyBWQlNjcmlwdCB3cmFwcGVyCiAgICogICBjYW4gYmUgZm91bmQgaW4gdGhlIHNldHVwQ2hhbm5lbCgpIG1ldGhvZCBiZWxvdy4KICAgKgogICAqICAgICBuaXg6IEludGVybmV0IEV4cGxvcmVyLXNwZWNpZmljIHdpbmRvdy5vcGVuZXIgdHJpY2suCiAgICogICAgICAgLSBJbnRlcm5ldCBFeHBsb3JlciA2CiAgICogICAgICAgLSBJbnRlcm5ldCBFeHBsb3JlciA3CiAgICoKICAgKiArIEZvciBHZWNrby1iYXNlZCBicm93c2VycywgdGhlIHNlY3VyaXR5IG1vZGVsIGFsbG93cyBhIGNoaWxkIHRvIGNhbGwgYQogICAqICAgZnVuY3Rpb24gb24gdGhlIGZyYW1lRWxlbWVudCBvZiB0aGUgaWZyYW1lLCBldmVuIGlmIHRoZSBjaGlsZCBpcyBpbgogICAqICAgYSBkaWZmZXJlbnQgZG9tYWluLiBUaGlzIG1ldGhvZCBpcyBkdWJiZWQgImZyYW1lRWxlbWVudCIgKGZlKS4KICAgKgogICAqICAgVGhlIGFiaWxpdHkgdG8gYWRkIGFuZCBjYWxsIHN1Y2ggZnVuY3Rpb25zIG9uIHRoZSBmcmFtZUVsZW1lbnQgYWxsb3dzCiAgICogICBhIGJpZGlyZWN0aW9uYWwgY2hhbm5lbCB0byBiZSBzZXR1cCB2aWEgdGhlIGFkZGluZyBvZiBzaW1wbGUgZnVuY3Rpb24KICAgKiAgIHJlZmVyZW5jZXMgb24gdGhlIGZyYW1lRWxlbWVudCBvYmplY3QgaXRzZWxmLiBJbiB0aGlzIGltcGxlbWVudGF0aW9uLAogICAqICAgd2hlbiB0aGUgY29udGFpbmVyIHNldHMgdXAgdGhlIGF1dGhlbnRpY2F0aW9uIGluZm9ybWF0aW9uIGZvciB0aGF0IGdhZGdldAogICAqICAgKGJ5IGNhbGxpbmcgc2V0QXV0aCguLi4pKSBpdCBhcyB3ZWxsIGFkZHMgYSBzcGVjaWFsIGZ1bmN0aW9uIG9uIHRoZQogICAqICAgZ2FkZ2V0J3MgaWZyYW1lLiBUaGlzIGZ1bmN0aW9uIGNhbiB0aGVuIGJlIHVzZWQgYnkgdGhlIGdhZGdldCB0byBzZW5kCiAgICogICBtZXNzYWdlcyB0byB0aGUgY29udGFpbmVyLiBJbiB0dXJuLCB3aGVuIHRoZSBnYWRnZXQgdHJpZXMgdG8gc2VuZCBhCiAgICogICBtZXNzYWdlLCBpdCBjaGVja3MgdG8gc2VlIGlmIHRoaXMgZnVuY3Rpb24gaGFzIGl0cyBvd24gZnVuY3Rpb24gc3RvcmVkCiAgICogICB0aGF0IGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250YWluZXIgdG8gY2FsbCB0aGUgZ2FkZ2V0LiBJZiBub3QsIHRoZQogICAqICAgZnVuY3Rpb24gaXMgY3JlYXRlZCBhbmQgc3Vic2VxdWVudGx5IHVzZWQgYnkgdGhlIGNvbnRhaW5lci4KICAgKiAgIE5vdGUgdGhhdCBhcyBhIHJlc3VsdCwgRkUgY2FuIG9ubHkgYmUgdXNlZCBieSBhIGNvbnRhaW5lciB0byBjYWxsIGEKICAgKiAgIHBhcnRpY3VsYXIgZ2FkZ2V0ICphZnRlciogdGhhdCBnYWRnZXQgaGFzIGNhbGxlZCB0aGUgY29udGFpbmVyIGF0CiAgICogICBsZWFzdCBvbmNlIHZpYSBGRS4KICAgKgogICAqICAgICBmZTogR2Vja28tc3BlY2lmaWMgZnJhbWVFbGVtZW50IHRyaWNrLgogICAqICAgICAgICAtIEZpcmVmb3ggMSsKICAgKgogICAqICsgRm9yIGFsbCBvdGhlcnMsIHdlIGhhdmUgYSBmYWxsYmFjayBtZWNoYW5pc20ga25vd24gYXMgImlmcGMiLiBJRlBDCiAgICogICBleHBsb2l0cyB0aGUgZmFjdCB0aGF0IHdoaWxlIHNhbWUtb3JpZ2luIHBvbGljeSBwcm9oaWJpdHMgYSBmcmFtZSBmcm9tCiAgICogICBhY2Nlc3NpbmcgbWVtYmVycyBvbiBhIHdpbmRvdyBub3QgaW4gdGhlIHNhbWUgZG9tYWluLCB0aGF0IGZyYW1lIGNhbiwKICAgKiAgIGhvd2V2ZXIsIG5hdmlnYXRlIHRoZSB3aW5kb3cgaGVpcmFyY2h5ICh2aWEgcGFyZW50KS4gVGhpcyBpcyBleHBsb2l0ZWQgYnkKICAgKiAgIGhhdmluZyBhIHBhZ2Ugb24gZG9tYWluIEEgdGhhdCB3YW50cyB0byB0YWxrIHRvIGRvbWFpbiBCIGNyZWF0ZSBhbiBpZnJhbWUKICAgKiAgIG9uIGRvbWFpbiBCIHBvaW50aW5nIHRvIGEgc3BlY2lhbCByZWxheSBmaWxlIGFuZCB3aXRoIGEgbWVzc2FnZSBlbmNvZGVkCiAgICogICBhZnRlciB0aGUgaGFzaCAoIykuIFRoaXMgcmVsYXksIGluIHR1cm4sIGZpbmRzIHRoZSBwYWdlIG9uIGRvbWFpbiBCLCBhbmQKICAgKiAgIGNhbiBjYWxsIGEgcmVjZWlwdCBmdW5jdGlvbiB3aXRoIHRoZSBtZXNzYWdlIGdpdmVuIHRvIGl0LiBUaGUgcmVsYXkgVVJMCiAgICogICB1c2VkIGJ5IGVhY2ggY2FsbGVyIGlzIHNldCB2aWEgdGhlIGdhZGdldHMucnBjLnNldFJlbGF5VXJsKC4uKSBhbmQKICAgKiAgICptdXN0KiBiZSBjYWxsZWQgYmVmb3JlIHRoZSBjYWxsIG1ldGhvZCBpcyB1c2VkLgogICAqCiAgICogICAgIGlmcGM6IElmcmFtZS1iYXNlZCBtZXRob2QsIHV0aWxpemluZyBhIHJlbGF5IHBhZ2UsIHRvIHNlbmQgYSBtZXNzYWdlLgogICAqLwogIGZ1bmN0aW9uIGdldFJlbGF5Q2hhbm5lbCgpIHsKLy8gICAgcmV0dXJuICdpZnBjJzsKICAgIHJldHVybiB0eXBlb2Ygd2luZG93LnBvc3RNZXNzYWdlID09PSAnZnVuY3Rpb24nID8gJ3dwbScgOgogICAgICAgICAgIHR5cGVvZiB3aW5kb3cucG9zdE1lc3NhZ2UgPT09ICdvYmplY3QnID8gJ3dwbSc6CiAgICAgICAgICAgdHlwZW9mIGRvY3VtZW50LnBvc3RNZXNzYWdlID09PSAnZnVuY3Rpb24nID8gJ2RwbScgOgogICAgICAgICAgIHdpbmRvdy5BY3RpdmVYT2JqZWN0ID8gJ25peCcgOgogICAgICAgICAgIG5hdmlnYXRvci5wcm9kdWN0ID09PSAnR2Vja28nID8gJ2ZlJyA6CiAgICAgICAgICAgJ2lmcGMnOwogIH0KCiAgLyoqCiAgICogQ29uZHVjdHMgYW55IGluaXRpYWwgZ2xvYmFsIHdvcmsgbmVjZXNzYXJ5IHRvIHNldHVwIHRoZQogICAqIGNoYW5uZWwgdHlwZSBjaG9zZW4uCiAgICovCiAgZnVuY3Rpb24gc2V0dXBDaGFubmVsKCkgewogICAgLy8gSWYgdGhlIGNoYW5uZWwgdHlwZSBpcyBvbmUgb2YgdGhlIG5hdGl2ZQogICAgLy8gcG9zdE1lc3NhZ2UgYmFzZWQgb25lcywgc2V0dXAgdGhlIGhhbmRsZXIgdG8gcmVjZWl2ZQogICAgLy8gbWVzc2FnZXMuCiAgICBpZiAocmVsYXlDaGFubmVsID09PSAnZHBtJyB8fCByZWxheUNoYW5uZWwgPT09ICd3cG0nKSB7CiAgICAgIHZhciBvbm1lc3NhZ2UgPSBmdW5jdGlvbiAocGFja2V0KSB7CiAgICAgICAgLy8gVE9ETyB2YWxpZGF0ZSBwYWNrZXQuZG9tYWluIGZvciBzZWN1cml0eSByZWFzb25zCiAgICAgICAgcHJvY2VzcyhnYWRnZXRzLmpzb24ucGFyc2UocGFja2V0LmRhdGEpKTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAhPSAndW5kZWZpbmVkJykgewogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgb25tZXNzYWdlLCBmYWxzZSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5hdHRhY2hFdmVudCAhPSAndW5kZWZpbmVkJykgewogICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb25tZXNzYWdlJywgb25tZXNzYWdlKTsKICAgICAgfQoKICAgIH0KCiAgICAvLyBJZiB0aGUgY2hhbm5lbCB0eXBlIGlzIE5JWCwgd2UgbmVlZCB0byBlbnN1cmUgdGhlCiAgICAvLyBWQlNjcmlwdCB3cmFwcGVyIGNvZGUgaXMgaW4gdGhlIHBhZ2UgYW5kIHRoYXQgdGhlCiAgICAvLyBnbG9iYWwgSmF2YXNjcmlwdCBoYW5kbGVycyBoYXZlIGJlZW4gc2V0LgogICAgaWYgKHJlbGF5Q2hhbm5lbCA9PT0gJ25peCcpIHsKCiAgICAgICAvL2FsZXJ0KCduaXggc2V0dXAhJyk7CgogICAgICAvLyBWQlNjcmlwdCBtZXRob2RzIHJldHVybiBhIHR5cGUgb2YgJ3Vua25vd24nIHdoZW4KICAgICAgLy8gY2hlY2tlZCB2aWEgdGhlIHR5cGVvZiBvcGVyYXRvciBpbiBJRS4gRm9ydHVuYXRlbHkKICAgICAgLy8gZm9yIHVzLCB0aGlzIG9ubHkgYXBwbGllcyB0byBDT00gb2JqZWN0cywgc28gd2UKICAgICAgLy8gd29uJ3Qgc2VlIHRoaXMgZm9yIGEgcmVhbCBKYXZhc2NyaXB0IG9iamVjdC4KICAgICAgaWYgKHR5cGVvZiB3aW5kb3dbTklYX0dFVF9XUkFQUEVSXSAhPT0gJ3Vua25vd24nKSB7CiAgICAgICAgd2luZG93W05JWF9IQU5ETEVfTUVTU0FHRV0gPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBwcm9jZXNzKGdhZGdldHMuanNvbi5wYXJzZShkYXRhKSk7CiAgICAgICAgfTsKCiAgICAgICAgd2luZG93W05JWF9DUkVBVEVfQ0hBTk5FTF0gPSBmdW5jdGlvbihuYW1lLCBjaGFubmVsLCB0b2tlbikgewogICAgICAgICAgLy8gVmVyaWZ5IHRoZSBhdXRoZW50aWNhdGlvbiB0b2tlbiBvZiB0aGUgZ2FkZ2V0IHRyeWluZwogICAgICAgICAgLy8gdG8gY3JlYXRlIGEgY2hhbm5lbCBmb3IgdXMuCiAgICAgICAgICBpZiAoYXV0aFRva2VuW25hbWVdID09IHRva2VuKSB7CiAgICAgICAgICAgIG5peF9jaGFubmVsc1tuYW1lXSA9IGNoYW5uZWw7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gSW5qZWN0IHRoZSBWQlNjcmlwdCBjb2RlIG5lZWRlZC4KICAgICAgICB2YXIgdmJzY3JpcHQgPQogICAgICAgICAgLy8gV2UgY3JlYXRlIGEgY2xhc3MgdG8gYWN0IGFzIGEgd3JhcHBlciBmb3IKICAgICAgICAgIC8vIGEgSmF2YXNjcmlwdCBjYWxsLCB0byBwcmV2ZW50IGEgYnJlYWsgaW4gb2YKICAgICAgICAgIC8vIHRoZSBjb250ZXh0LgogICAgICAgICAgJ0NsYXNzICcgKyBOSVhfV1JBUFBFUiArICdcbiAnCgogICAgICAgICAgLy8gQW4gaW50ZXJuYWwgbWVtYmVyIGZvciBrZWVwaW5nIHRyYWNrIG9mIHRoZQogICAgICAgICAgLy8gbmFtZSBvZiB0aGUgZG9jdW1lbnQgKGNvbnRhaW5lciBvciBnYWRnZXQpCiAgICAgICAgICAvLyBmb3Igd2hpY2ggdGhpcyB3cmFwcGVyIGlzIGludGVuZGVkLiBGb3IKICAgICAgICAgIC8vIHRob3NlIHdyYXBwZXJzIGNyZWF0ZWQgYnkgZ2FkZ2V0cywgdGhpcyBpcyBub3QKICAgICAgICAgIC8vIHVzZWQgKGFsdGhvdWdoIGl0IGlzIHNldCB0byAiLi4iKQogICAgICAgICAgKyAnUHJpdmF0ZSBtX0ludGVuZGVkXG4nCgogICAgICAgICAgLy8gU3RvcmVzIHRoZSBhdXRoIHRva2VuIHVzZWQgdG8gY29tbXVuaWNhdGUgd2l0aAogICAgICAgICAgLy8gdGhlIGdhZGdldC4gVGhlIEdldENoYW5uZWxDcmVhdG9yIG1ldGhvZCByZXR1cm5zCiAgICAgICAgICAvLyBhbiBvYmplY3QgdGhhdCByZXR1cm5zIHRoaXMgYXV0aCB0b2tlbi4gVXBvbiBtYXRjaGluZwogICAgICAgICAgLy8gdGhhdCB3aXRoIGl0cyBvd24sIHRoZSBnYWRnZXQgdXNlcyB0aGUgb2JqZWN0CiAgICAgICAgICAvLyB0byBhY3R1YWxseSBlc3RhYmxpc2ggdGhlIGNvbW11bmljYXRpb24gY2hhbm5lbC4KICAgICAgICAgICsgJ1ByaXZhdGUgbV9BdXRoXG4nCgogICAgICAgICAgLy8gTWV0aG9kIGZvciBpbnRlcm5hbGx5IHNldHRpbmcgdGhlIHZhbHVlCiAgICAgICAgICAvLyBvZiB0aGUgbV9JbnRlbmRlZCBwcm9wZXJ0eS4KICAgICAgICAgICsgJ1B1YmxpYyBTdWIgU2V0SW50ZW5kZWROYW1lKG5hbWUpXG4gJwogICAgICAgICAgKyAnSWYgaXNFbXB0eShtX0ludGVuZGVkKSBUaGVuXG4nCiAgICAgICAgICArICdtX0ludGVuZGVkID0gbmFtZVxuJwogICAgICAgICAgKyAnRW5kIElmXG4nCiAgICAgICAgICArICdFbmQgU3ViXG4nCgogICAgICAgICAgLy8gTWV0aG9kIGZvciBpbnRlcm5hbGx5IHNldHRpbmcgdGhlIHZhbHVlIG9mIHRoZSBtX0F1dGggcHJvcGVydHkuCiAgICAgICAgICArICdQdWJsaWMgU3ViIFNldEF1dGgoYXV0aClcbiAnCiAgICAgICAgICArICdJZiBpc0VtcHR5KG1fQXV0aCkgVGhlblxuJwogICAgICAgICAgKyAnbV9BdXRoID0gYXV0aFxuJwogICAgICAgICAgKyAnRW5kIElmXG4nCiAgICAgICAgICArICdFbmQgU3ViXG4nCgogICAgICAgICAgLy8gQSB3cmFwcGVyIG1ldGhvZCB3aGljaCBhY3R1YWxseSBjYXVzZXMgYQogICAgICAgICAgLy8gbWVzc2FnZSB0byBiZSBzZW50IHRvIHRoZSBvdGhlciBjb250ZXh0LgogICAgICAgICAgKyAnUHVibGljIFN1YiBTZW5kTWVzc2FnZShkYXRhKVxuICcKICAgICAgICAgICsgTklYX0hBTkRMRV9NRVNTQUdFICsgJyhkYXRhKVxuJwogICAgICAgICAgKyAnRW5kIFN1YlxuJwoKICAgICAgICAgIC8vIFJldHVybnMgdGhlIGF1dGggdG9rZW4gdG8gdGhlIGdhZGdldCwgc28gaXQgY2FuCiAgICAgICAgICAvLyBjb25maXJtIGEgbWF0Y2ggYmVmb3JlIGluaXRpYXRpbmcgdGhlIGNvbm5lY3Rpb24KICAgICAgICAgICsgJ1B1YmxpYyBGdW5jdGlvbiBHZXRBdXRoVG9rZW4oKVxuICcKICAgICAgICAgICsgJ0dldEF1dGhUb2tlbiA9IG1fQXV0aFxuJwogICAgICAgICAgKyAnRW5kIEZ1bmN0aW9uXG4nCgogICAgICAgICAgLy8gTWV0aG9kIGZvciBzZXR0aW5nIHVwIHRoZSBjb250YWluZXItPmdhZGdldAogICAgICAgICAgLy8gY2hhbm5lbC4gTm90IHN0cmljdGx5IG5lZWRlZCBpbiB0aGUgZ2FkZ2V0J3MKICAgICAgICAgIC8vIHdyYXBwZXIsIGJ1dCBubyByZWFzb24gdG8gZ2V0IHJpZCBvZiBpdC4gTm90ZSBoZXJlCiAgICAgICAgICAvLyB0aGF0IHdlIHBhc3MgdGhlIGludGVuZGVkIG5hbWUgdG8gdGhlIE5JWF9DUkVBVEVfQ0hBTk5FTAogICAgICAgICAgLy8gbWV0aG9kIHNvIHRoYXQgaXQgY2FuIHNhdmUgdGhlIGNoYW5uZWwgaW4gdGhlIHByb3BlciBwbGFjZQogICAgICAgICAgLy8gKmFuZCogdmVyaWZ5IHRoZSBjaGFubmVsIHZpYSB0aGUgYXV0aGVudGljYXRpb24gdG9rZW4gcGFzc2VkCiAgICAgICAgICAvLyBoZXJlLgogICAgICAgICAgKyAnUHVibGljIFN1YiBDcmVhdGVDaGFubmVsKGNoYW5uZWwsIGF1dGgpXG4gJwogICAgICAgICAgKyAnQ2FsbCAnICsgTklYX0NSRUFURV9DSEFOTkVMICsgJyhtX0ludGVuZGVkLCBjaGFubmVsLCBhdXRoKVxuJwogICAgICAgICAgKyAnRW5kIFN1YlxuJwogICAgICAgICAgKyAnRW5kIENsYXNzXG4nCgogICAgICAgICAgLy8gRnVuY3Rpb24gdG8gZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSB3cmFwcGVyLgogICAgICAgICAgKyAnRnVuY3Rpb24gJyArIE5JWF9HRVRfV1JBUFBFUiArICcobmFtZSwgYXV0aClcbicKICAgICAgICAgICsgJ0RpbSB3cmFwXG4nCiAgICAgICAgICArICdTZXQgd3JhcCA9IE5ldyAnICsgTklYX1dSQVBQRVIgKyAnXG4nCiAgICAgICAgICArICd3cmFwLlNldEludGVuZGVkTmFtZSBuYW1lXG4nCiAgICAgICAgICArICd3cmFwLlNldEF1dGggYXV0aFxuJwogICAgICAgICAgKyAnU2V0ICcgKyBOSVhfR0VUX1dSQVBQRVIgKyAnID0gd3JhcFxuJwogICAgICAgICAgKyAnRW5kIEZ1bmN0aW9uJzsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vYWxlcnQoJ2V4ZWNTY3JpcHQhICcrdmJzY3JpcHQpOwogICAgICAgICAgd2luZG93LmV4ZWNTY3JpcHQodmJzY3JpcHQsICd2YnNjcmlwdCcpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKCiAgICAgICAgICAvL2FsZXJ0KCdleGNlcHRpb24hIGJhY2sgdG8gaWZwYycpOwogICAgICAgICAgLy8gRmFsbCB0aHJvdWdoIHRvIElGUEMuCiAgICAgICAgICByZWxheUNoYW5uZWwgPSAnaWZwYyc7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvL1N0b3JlIHRoZSBwYXJzZWQgd2luZG93Lm5hbWUgY29uZmlndXJhdGlvbiwgaWYgbmVjZXNzYXJ5CiAgdmFyIGNvbmZpZyA9IG51bGw7CgogIC8vUGFyc2UgdGhlIHdpbmRvdy5uYW1lIGNvbmZpZ3VyYXRpb24gYW5kIGNhY2hlIGl0LiAgSGFuZGxlIHRoZSBjYXNlCiAgLy93aGVyZSBjb250YWluZXJzIHVzZSBhIEpTT04gc3RyaW5nIGluIHRoZSB3aW5kb3cgbmFtZSBhbmQgYSBwbGFpbiBzdHJpbmcsCi8vICBmdW5jdGlvbiBnZXRDb25maWcoKSB7Ci8vICAgIGlmIChjb25maWcgPT0gbnVsbCkgewovLyAgICAgICAgY29uZmlnID0ge307Ci8vICAgICAgICBpZiAod2luZG93Lm5hbWUuY2hhckF0KDApICE9ICd7JykgewovLyAgICAgICAgICAgIGNvbmZpZy5ycGNJZCA9IHdpbmRvdy5uYW1lOwovLyAgICAgICAgICAgIGNvbmZpZy5rZXJuZWwgPSB0cnVlOwovLyAgICAgICAgfSBlbHNlIHsKLy8gICAgICAgICAgICBjb25maWcgPSBnYWRnZXRzLmpzb24ucGFyc2Uod2luZG93Lm5hbWUpOwovLyAgICAgICAgICAgIGNvbmZpZy5ycGNJZCA9IGNvbmZpZy5pZDsKLy8gICAgICAgICAgICByZXR1cm4gY29uZmlnOwovLyAgICAgICAgfQovLyAgICB9IGVsc2UgewovLyAgICAgICAgcmV0dXJuIGNvbmZpZzsKLy8gICAgfQovLyAgfQoKICAvL0dldCB0aGUgSUZyYW1lIElEIGZyb20gdGhlIHdpbmRvdy5uYW1lIHByb3BlcnR5LiAgSGFuZGxlIHRocmVlIGNhc2VzCiAgLy8xLiBPV0YgV2VidG9wLCB3aGljaCBhc3N1bWVzIElGcmFtZSBJRHMgYXJlIGlkZW50aWNhbCB0byB3aW5kb3cgbmFtZXMKICAvLzIuIE9XRiBLZXJuZWwsIHdoaWNoIGFzc3VtZXMgdGhhdCBJRnJhbWUgSURzIGFyZSBjb250aWFuZWQgaW4gdGhlIHdpbmRvdyBuYW1lIGFzIEpTT04gYXMgdGhlIGlkIGZpZWxkCiAgLy8zLiBPdGhlcnMsIHdoaWNoIHVzZSBhIHBsYWluIHN0cmluZyBpbiB0aGUgd2luZG93IG5hbWUgYW5kIGFzc3VtZSB0aGUgSUZyYW1lIGlkIGlzIGFsc28gdGhpcyBwbGFpbiBzdHJpbmcKLy8gIGZ1bmN0aW9uIGdldElkKHdpbmRvd05hbWUpIHsKLy8gICAgdmFyIGNvbmYgPSBnZXRDb25maWcoKTsKLy8gICAgaWYgKGNvbmYua2VybmVsKQovLyAgICAgICAgcmV0dXJuIGNvbmYucnBjSWQ7Ci8vICAgIGVsc2UKLy8gICAgICAgIHJldHVybiB3aW5kb3dOYW1lOwovLyAgfQoKICBmdW5jdGlvbiBnZXRJZCh3aW5kb3dOYW1lKSB7CiAgICBpZiAod2luZG93TmFtZS5jaGFyQXQoMCkgIT0gJ3snKSB7CiAgICAgIHJldHVybiB3aW5kb3dOYW1lCiAgICB9CiAgICBlbHNlIHsKICAgICAgdmFyIG9iaiA9IGdhZGdldHMuanNvbi5wYXJzZSh3aW5kb3dOYW1lKTsKICAgICAgdmFyIGlkID0gb2JqLmlkOwogICAgICByZXR1cm4gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeSh7aWQ6b2JqLmlkfSk7CiAgICB9CiAgfQoKICAvLyBQaWNrIHRoZSBtb3N0IGVmZmljaWVudCBSUEMgcmVsYXkgbWVjaGFuaXNtCiAgdmFyIHJlbGF5Q2hhbm5lbCA9IGdldFJlbGF5Q2hhbm5lbCgpOwogIC8vYWxlcnQoJ3JlbGF5Y2hhbm5lbCBpcyAnK3JlbGF5Q2hhbm5lbCk7CgogIC8vIENvbmR1Y3QgYW55IHNldHVwIG5lY2Vzc2FyeSBmb3IgdGhlIGNob3NlbiBjaGFubmVsLgogIHNldHVwQ2hhbm5lbCgpOwoKICAvLyBDcmVhdGUgdGhlIERlZmF1bHQgUlBDIGhhbmRsZXIuCiAgc2VydmljZXNbREVGQVVMVF9OQU1FXSA9IGZ1bmN0aW9uKCkgewogICAgLy9zdXBwcmVzcyB0aGlzIGVycm9yIC0gbm8gb25lIHNob3VsZCBldmVyIHRyeSB0byB1c2UgYSBzZXJ2aWNlIHRoYXQgd2Fzbid0IHJlZ2lzdGVyZWQgdXNpbmcgb3VyIGFwaQogICAgLy90aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gUlBDIHNlcnZpY2U6ICcgKyB0aGlzLnMpOwogIH07CgogIC8vIENyZWF0ZSBhIFNwZWNpYWwgUlBDIGhhbmRsZXIgZm9yIGNhbGxiYWNrcy4KICBzZXJ2aWNlc1tDQUxMQkFDS19OQU1FXSA9IGZ1bmN0aW9uKGNhbGxiYWNrSWQsIHJlc3VsdCkgewogICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIGRlbGV0ZSBjYWxsYmFja3NbY2FsbGJhY2tJZF07CiAgICAgIGNhbGxiYWNrKHJlc3VsdCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ29uZHVjdHMgYW55IGZyYW1lLXNwZWNpZmljIHdvcmsgbmVjZXNzYXJ5IHRvIHNldHVwCiAgICogdGhlIGNoYW5uZWwgdHlwZSBjaG9zZW4uIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuCiAgICogdGhlIGNvbnRhaW5lciBwYWdlIGZpcnN0IHJlZ2lzdGVycyB0aGUgZ2FkZ2V0IGluIHRoZQogICAqIFJQQyBtZWNoYW5pc20uIEdhZGdldHMsIGluIHR1cm4sIHdpbGwgY29tcGxldGUgdGhlIHNldHVwCiAgICogb2YgdGhlIGNoYW5uZWwgb25jZSB0aGV5IHNlbmQgdGhlaXIgZmlyc3QgbWVzc2FnZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0dXBGcmFtZShmcmFtZUlkLCB0b2tlbikgewogICAgaWYgKHNldHVwW2ZyYW1lSWRdKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAocmVsYXlDaGFubmVsID09PSAnZmUnKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnJhbWVJZCk7CiAgICAgICAgZnJhbWVbRkVfRzJDX0NIQU5ORUxdID0gZnVuY3Rpb24oYXJncykgewogICAgICAgICAgcHJvY2VzcyhnYWRnZXRzLmpzb24ucGFyc2UoYXJncykpOwogICAgICAgIH07CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBTb21ldGhpbmcgd2VudCB3cm9uZy4gU3lzdGVtIHdpbGwgZmFsbGJhY2sgdG8KICAgICAgICAvLyBJRlBDLgogICAgICB9CiAgICB9CgogICAgaWYgKHJlbGF5Q2hhbm5lbCA9PT0gJ25peCcpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmcmFtZUlkKTsKICAgICAgICB2YXIgd3JhcHBlciA9IHdpbmRvd1tOSVhfR0VUX1dSQVBQRVJdKGZyYW1lSWQsIHRva2VuKTsKICAgICAgICBmcmFtZS5jb250ZW50V2luZG93Lm9wZW5lciA9IHdyYXBwZXI7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBTb21ldGhpbmcgd2VudCB3cm9uZy4gU3lzdGVtIHdpbGwgZmFsbGJhY2sgdG8KICAgICAgICAvLyBJRlBDLgogICAgICAgIC8vYWxlcnQoJ3NldHVwRnJhbWUgRXJyb3IhOicrZS5tZXNzYWdlKTsKCiAgICAgIH0KICAgIH0KCiAgICBzZXR1cFtmcmFtZUlkXSA9IHRydWU7CiAgfQoKICAvKioKICAgKiBFbmNvZGVzIGFyZ3VtZW50cyBmb3IgdGhlIGxlZ2FjeSBJRlBDIHdpcmUgZm9ybWF0LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGFyZ3MKICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRoZSBlbmNvZGVkIGFyZ3MKICAgKi8KICBmdW5jdGlvbiBlbmNvZGVMZWdhY3lEYXRhKGFyZ3MpIHsKICAgIHZhciBzdHJpbmdpZnkgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5OwogICAgdmFyIGFyZ3NFc2NhcGVkID0gW107CiAgICBmb3IodmFyIGkgPSAwLCBqID0gYXJncy5sZW5ndGg7IGkgPCBqOyArK2kpIHsKICAgICAgYXJnc0VzY2FwZWQucHVzaChlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5KGFyZ3NbaV0pKSk7CiAgICB9CiAgICByZXR1cm4gYXJnc0VzY2FwZWQuam9pbignJicpOwogIH0KCiAgLyoqCiAgICogSGVscGVyIGZ1bmN0aW9uIHRvIHByb2Nlc3MgYW4gUlBDIHJlcXVlc3QKICAgKiBAcGFyYW0ge09iamVjdH0gcnBjIFJQQyByZXF1ZXN0IG9iamVjdAogICAqIEBwcml2YXRlCiAgICovCiAgICBmdW5jdGlvbiBwcm9jZXNzKHJwYykgewogICAgLy8KICAgIC8vIFJQQyBvYmplY3QgY29udGVudHM6CiAgICAvLyAgIHM6IFNlcnZpY2UgTmFtZQogICAgLy8gICBmOiBGcm9tCiAgICAvLyAgIGM6IFRoZSBjYWxsYmFjayBJRCBvciAwIGlmIG5vbmUuCiAgICAvLyAgIGE6IFRoZSBhcmd1bWVudHMgZm9yIHRoaXMgUlBDIGNhbGwuCiAgICAvLyAgIHQ6IFRoZSBhdXRoZW50aWNhdGlvbiB0b2tlbi4KICAgIC8vCiAgICBpZiAocnBjICYmIHR5cGVvZiBycGMucyA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHJwYy5mID09PSAnc3RyaW5nJyAmJgogICAgICAgIHJwYy5hIGluc3RhbmNlb2YgQXJyYXkpIHsKCiAgICAgIC8vZW5zdXJlIGlkIGlzIGNvbXBhdGlibGUKICAgICAgcnBjLmYgPSBnZXRJZChycGMuZik7CgogICAgICAvLyBWYWxpZGF0ZSBhdXRoIHRva2VuLgogICAgICBpZiAoYXV0aFRva2VuW3JwYy5mXSkgewogICAgICAgIC8vIFdlIGFsbG93IHR5cGUgY29lcmNpb24gaGVyZSBiZWNhdXNlIGFsbCB0aGUgdXJsIHBhcmFtcyBhcmUgc3RyaW5ncy4KICAgICAgICBpZiAoYXV0aFRva2VuW3JwYy5mXSAhPSBycGMudCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGF1dGggdG9rZW4uIik7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBJZiB0aGVyZSBpcyBhIGNhbGxiYWNrIGZvciB0aGlzIHNlcnZpY2UsIGF0dGFjaCBhIGNhbGxiYWNrIGZ1bmN0aW9uCiAgICAgIC8vIHRvIHRoZSBycGMgY29udGV4dCBvYmplY3QgZm9yIGFzeW5jaHJvbm91cyBycGMgc2VydmljZXMuCiAgICAgIC8vCiAgICAgIC8vIFN5bmNocm9ub3VzIHJwYyByZXF1ZXN0IGhhbmRsZXJzIHNob3VsZCBzaW1wbHkgaWdub3JlIGl0IGFuZCByZXR1cm4gYQogICAgICAvLyB2YWx1ZSBhcyB1c3VhbC4KICAgICAgLy8gQXN5bmNocm9ub3VzIHJwYyByZXF1ZXN0IGhhbmRsZXJzLCBvbiB0aGUgb3RoZXIgaGFuZCwgc2hvdWxkIHBhc3MgaXRzCiAgICAgIC8vIHJlc3VsdCB0byB0aGlzIGNhbGxiYWNrIGZ1bmN0aW9uIGFuZCBub3QgcmV0dXJuIGEgdmFsdWUgb24gZXhpdC4KICAgICAgLy8KICAgICAgLy8gRm9yIGV4YW1wbGUsIHRoZSBmb2xsb3dpbmcgcnBjIGhhbmRsZXIgcGFzc2VzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgYmFjawogICAgICAvLyB0byBpdHMgcnBjIGNsaWVudCB3aXRoIGEgb25lLXNlY29uZCBkZWxheS4KICAgICAgLy8KICAgICAgLy8gZnVuY3Rpb24gYXN5bmNScGNIYW5kbGVyKHBhcmFtKSB7CiAgICAgIC8vICAgdmFyIG1lID0gdGhpczsKICAgICAgLy8gICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAvLyAgICAgbWUuY2FsbGJhY2socGFyYW0pOwogICAgICAvLyAgIH0sIDEwMDApOwogICAgICAvLyB9CiAgICAgIGlmIChycGMuYykgewogICAgICAgIHJwYy5jYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChycGMuZiwgQ0FMTEJBQ0tfTkFNRSwgbnVsbCwgcnBjLmMsIHJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgLy8gQ2FsbCB0aGUgcmVxdWVzdGVkIFJQQyBzZXJ2aWNlLgogICAgICB2YXIgcmVzdWx0ID0gKHNlcnZpY2VzW3JwYy5zXSB8fAogICAgICAgICAgICAgICAgICAgIHNlcnZpY2VzW0RFRkFVTFRfTkFNRV0pLmFwcGx5KHJwYywgcnBjLmEpOwoKICAgICAgLy8gSWYgdGhlIHJwYyByZXF1ZXN0IGhhbmRsZXIgcmV0dXJucyBhIHZhbHVlLCBpbW1lZGlhdGVseSBwYXNzIGl0IGJhY2sKICAgICAgLy8gdG8gdGhlIGNhbGxiYWNrLiBPdGhlcndpc2UsIGRvIG5vdGhpbmcsIGFzc3VtaW5nIHRoYXQgdGhlIHJwYyBoYW5kbGVyCiAgICAgIC8vIHdpbGwgbWFrZSBhbiBhc3luY2hyb25vdXMgY2FsbCBsYXRlci4KICAgICAgaWYgKHJwYy5jICYmIHR5cGVvZiByZXN1bHQgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKHJwYy5mLCBDQUxMQkFDS19OQU1FLCBudWxsLCBycGMuYywgcmVzdWx0KTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQXR0ZW1wdHMgdG8gY29uZHVjdCBhbiBSUEMgY2FsbCB0byB0aGUgc3BlY2lmaWVkCiAgICogdGFyZ2V0IHdpdGggdGhlIHNwZWNpZmllZCBkYXRhIHZpYSB0aGUgTklYCiAgICogbWV0aG9kLiBJZiB0aGlzIG1ldGhvZCBmYWlscywgdGhlIHN5c3RlbSBhdHRlbXB0cyBhZ2FpbgogICAqIHVzaW5nIHRoZSBrbm93biBkZWZhdWx0IG9mIElGUEMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdGFyZ2V0SWQgTW9kdWxlIElkIG9mIHRoZSBSUEMgc2VydmljZSBwcm92aWRlci4KICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgTmFtZSBvZiB0aGUgc2VydmljZSB0byBjYWxsLgogICAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tIE1vZHVsZSBJZCBvZiB0aGUgY2FsbGluZyBwcm92aWRlci4KICAgKiBAcGFyYW0ge09iamVjdH0gcnBjRGF0YSBUaGUgUlBDIGRhdGEgZm9yIHRoaXMgY2FsbC4KICAgKi8KICBmdW5jdGlvbiBjYWxsTml4KHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSkgewogICAgdHJ5IHsKLy8gICAgICAgYWxlcnQoJ3RyeSBuaXggdGFyZ2V0SWQ9Jyt0YXJnZXRJZCk7Ci8vICAgICAgIGFsZXJ0KCd0cnkgbml4IGZyb209Jytmcm9tKTsKICAgICAgaWYgKGZyb20gIT0gJy4uJykgewovLyAgICAgICAgYWxlcnQoJ3RyeSBuaXgxJyk7CiAgICAgICAgLy8gQ2FsbCBmcm9tIGdhZGdldCB0byB0aGUgY29udGFpbmVyLgogICAgICAgIHZhciBoYW5kbGVyID0gbml4X2NoYW5uZWxzWycuLiddOwoKLy8gICAgICAgIGFsZXJ0KCdOaXggaGFuZGxlcj0nK2hhbmRsZXIpOwogICAgICAgIC8vYWxlcnQoJ0dldEF1dGhUb2tlbicrKCJHZXRBdXRoVG9rZW4iIGluIHdpbmRvdy5vcGVuZXIpKTsKLy8gICAgICAgIGFsZXJ0KCd3aW5kb3cub3BlbmVyPScrd2luZG93Lm9wZW5lcik7CgogICAgICAgIC8vIElmIHRoZSBnYWRnZXQgaGFzIHlldCB0byByZXRyaWV2ZSBhIHJlZmVyZW5jZSB0bwogICAgICAgIC8vIHRoZSBOSVggaGFuZGxlciwgdHJ5IHRvIGRvIHNvIG5vdy4gV2UgZG9uJ3QgZG8gYQogICAgICAgIC8vIHR5cGVvZih3aW5kb3cub3BlbmVyLkdldEF1dGhUb2tlbikgY2hlY2sgaGVyZQogICAgICAgIC8vIGJlY2F1c2UgaXQgbWVhbnMgYWNjZXNzaW5nIHRoYXQgZmllbGQgb24gdGhlIENPTSBvYmplY3QsIHdoaWNoLAogICAgICAgIC8vIGJlaW5nIGFuIGludGVybmFsIGZ1bmN0aW9uIHJlZmVyZW5jZSwgaXMgbm90IGFsbG93ZWQuCiAgICAgICAgLy8gImluIiB3b3JrcyBiZWNhdXNlIGl0IG1lcmVseSBjaGVja3MgZm9yIHRoZSBwcmVzY2VuY2Ugb2YKICAgICAgICAvLyB0aGUga2V5LCByYXRoZXIgdGhhbiBhY3R1YWxseSBhY2Nlc3NpbmcgdGhlIG9iamVjdCdzIHByb3BlcnR5LgogICAgICAgIC8vIFRoaXMgaXMganVzdCBhIHNhbml0eSBjaGVjaywgbm90IGEgdmFsaWRpdHkgY2hlY2suCiAgICAgICAgaWYgKCFoYW5kbGVyICYmIHdpbmRvdy5vcGVuZXIgJiYgIkdldEF1dGhUb2tlbiIgaW4gd2luZG93Lm9wZW5lcikgewovLyAgICAgICAgICBhbGVydCgndHJ5IG5peCAtIGhhbmRsZXInKTsKICAgICAgICAgIGhhbmRsZXIgPSB3aW5kb3cub3BlbmVyOwoKICAgICAgICAgIC8vIENyZWF0ZSB0aGUgY2hhbm5lbCB0byB0aGUgcGFyZW50L2NvbnRhaW5lci4KICAgICAgICAgIC8vIEZpcnN0IHZlcmlmeSB0aGF0IGl0IGtub3dzIG91ciBhdXRoIHRva2VuIHRvIGVuc3VyZSBpdCdzIG5vdAogICAgICAgICAgLy8gYW4gaW1wb3N0b3IuCiAgICAgICAgICBpZiAoaGFuZGxlci5HZXRBdXRoVG9rZW4oKSA9PSBhdXRoVG9rZW5bJy4uJ10pIHsKICAgICAgICAgICAgLy8gQXV0aCBtYXRjaCAtIHBhc3MgaXQgYmFjayBhbG9uZyB3aXRoIG91ciB3cmFwcGVyIHRvIGZpbmlzaC4KICAgICAgICAgICAgLy8gb3duIHdyYXBwZXIgYW5kIG91ciBhdXRoZW50aWNhdGlvbiB0b2tlbiBmb3IgY28tdmVyaWZpY2F0aW9uLgogICAgICAgICAgICB2YXIgdG9rZW4gPSBhdXRoVG9rZW5bJy4uJ107CiAgICAgICAgICAgIGhhbmRsZXIuQ3JlYXRlQ2hhbm5lbCh3aW5kb3dbTklYX0dFVF9XUkFQUEVSXSgnLi4nLCB0b2tlbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbik7CiAgICAgICAgICAgIC8vIFNldCBjaGFubmVsIGhhbmRsZXIKICAgICAgICAgICAgbml4X2NoYW5uZWxzWycuLiddID0gaGFuZGxlcjsKICAgICAgICAgICAgd2luZG93Lm9wZW5lciA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgaGFuZGxlciwgY2FsbCBpdC4KICAgICAgICBpZiAoaGFuZGxlcikgewogICAgICAgICAgLy9hbGVydCgnc2VudCBuaXgnKTsKICAgICAgICAgIGhhbmRsZXIuU2VuZE1lc3NhZ2UocnBjRGF0YSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKLy8gICAgICAgIGFsZXJ0KCdOaXggZGlkIG5vdCBzZW5kMycpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENhbGwgZnJvbSBjb250YWluZXIgdG8gYSBnYWRnZXRbdGFyZ2V0SWRdLgovLyAgICAgICAgYWxlcnQoJ3RyeSBuaXgyIC0gbml4X2NoYW5uZWxzW3RhcmdldElkXT0nK25peF9jaGFubmVsc1t0YXJnZXRJZF0pOwoKICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgaGFuZGxlciwgY2FsbCBpdC4KICAgICAgICBpZiAobml4X2NoYW5uZWxzW3RhcmdldElkXSkgewovLyAgICAgICAgICBhbGVydCgnc2VudCBuaXgnKTsKICAgICAgICAgIG5peF9jaGFubmVsc1t0YXJnZXRJZF0uU2VuZE1lc3NhZ2UocnBjRGF0YSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKLy8gICAgICAgIGFsZXJ0KCdOaXggZGlkIG5vdCBzZW5kMScpOwogICAgICB9CgovLyAgICAgIGFsZXJ0KCdOaXggZGlkIG5vdCBzZW5kMicpOwoKICAgIH0gY2F0Y2ggKGUpIHsKLy8gICAgICBhbGVydCgnTml4IEZhaWxlZCE6JytlKTsKICAgIH0KCi8vICAgIGFsZXJ0KCdmYWxsYmFjayBpZnBjJyk7CgogICAgLy8gSWYgd2UgaGF2ZSByZWFjaGVkIHRoaXMgcG9pbnQsIHNvbWV0aGluZyBoYXMgZmFpbGVkCiAgICAvLyB3aXRoIHRoZSBOSVggbWV0aG9kLCBzbyB3ZSBkZWZhdWx0IHRvIHVzaW5nCiAgICAvLyBJRlBDIGZvciB0aGlzIGNhbGwuCiAgICBjYWxsSWZwYyh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEpOwogIH0KCiAgLyoqCiAgICogQXR0ZW1wdHMgdG8gY29uZHVjdCBhbiBSUEMgY2FsbCB0byB0aGUgc3BlY2lmaWVkCiAgICogdGFyZ2V0IHdpdGggdGhlIHNwZWNpZmllZCBkYXRhIHZpYSB0aGUgRnJhbWVFbGVtZW50CiAgICogbWV0aG9kLiBJZiB0aGlzIG1ldGhvZCBmYWlscywgdGhlIHN5c3RlbSBhdHRlbXB0cyBhZ2FpbgogICAqIHVzaW5nIHRoZSBrbm93biBkZWZhdWx0IG9mIElGUEMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdGFyZ2V0SWQgTW9kdWxlIElkIG9mIHRoZSBSUEMgc2VydmljZSBwcm92aWRlci4KICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgU2VydmljZSBuYW1lIHRvIGNhbGwuCiAgICogQHBhcmFtIHtTdHJpbmd9IGZyb20gTW9kdWxlIElkIG9mIHRoZSBjYWxsaW5nIHByb3ZpZGVyLgogICAqIEBwYXJhbSB7T2JqZWN0fSBycGNEYXRhIFRoZSBSUEMgZGF0YSBmb3IgdGhpcyBjYWxsLgogICAqIEBwYXJhbSB7QXJyYXkuPE9iamVjdD59IGNhbGxBcmdzIE9yaWdpbmFsIGFyZ3VtZW50cyB0byBjYWxsKCkKICAgKi8KICBmdW5jdGlvbiBjYWxsRnJhbWVFbGVtZW50KHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSwgY2FsbEFyZ3MpIHsKICAgIC8vYWxlcnQoJ2NhbGxGcmFtZUVsZW1lbnQhJyk7CiAgICB0cnkgewogICAgICBpZiAoZnJvbSAhPSAnLi4nKSB7CiAgICAgICAgLy8gQ2FsbCBmcm9tIGdhZGdldCB0byB0aGUgY29udGFpbmVyLgogICAgICAgIHZhciBmZSA9IHdpbmRvdy5mcmFtZUVsZW1lbnQ7CgogICAgICAgIGlmICh0eXBlb2YgZmVbRkVfRzJDX0NIQU5ORUxdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAvLyBDb21wbGV0ZSB0aGUgc2V0dXAgb2YgdGhlIEZFIGNoYW5uZWwgaWYgbmVlZCBiZS4KICAgICAgICAgIGlmICh0eXBlb2YgZmVbRkVfRzJDX0NIQU5ORUxdW0ZFX0MyR19DSEFOTkVMXSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBmZVtGRV9HMkNfQ0hBTk5FTF1bRkVfQzJHX0NIQU5ORUxdID0gZnVuY3Rpb24oYXJncykgewogICAgICAgICAgICAgIHByb2Nlc3MoZ2FkZ2V0cy5qc29uLnBhcnNlKGFyZ3MpKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBDb25kdWN0IHRoZSBSUEMgY2FsbC4KICAgICAgICAgIGZlW0ZFX0cyQ19DSEFOTkVMXShycGNEYXRhKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ2FsbCBmcm9tIGNvbnRhaW5lciB0byBnYWRnZXRbdGFyZ2V0SWRdLgogICAgICAgIHZhciBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKCiAgICAgICAgaWYgKHR5cGVvZiBmcmFtZVtGRV9HMkNfQ0hBTk5FTF0gPT09ICdmdW5jdGlvbicgJiYKICAgICAgICAgICAgdHlwZW9mIGZyYW1lW0ZFX0cyQ19DSEFOTkVMXVtGRV9DMkdfQ0hBTk5FTF0gPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAvLyBDb25kdWN0IHRoZSBSUEMgY2FsbC4KICAgICAgICAgIGZyYW1lW0ZFX0cyQ19DSEFOTkVMXVtGRV9DMkdfQ0hBTk5FTF0ocnBjRGF0YSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICB9CgogICAgLy8gSWYgd2UgaGF2ZSByZWFjaGVkIHRoaXMgcG9pbnQsIHNvbWV0aGluZyBoYXMgZmFpbGVkCiAgICAvLyB3aXRoIHRoZSBGcmFtZUVsZW1lbnQgbWV0aG9kLCBzbyB3ZSBkZWZhdWx0IHRvIHVzaW5nCiAgICAvLyBJRlBDIGZvciB0aGlzIGNhbGwuCiAgICBjYWxsSWZwYyh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEsIGNhbGxBcmdzKTsKICB9CgogIC8qKgogICAqIENvbmR1Y3RzIGFuIFJQQyBjYWxsIHRvIHRoZSBzcGVjaWZpZWQKICAgKiB0YXJnZXQgd2l0aCB0aGUgc3BlY2lmaWVkIGRhdGEgdmlhIHRoZSBJRlBDCiAgICogbWV0aG9kLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE1vZHVsZSBJZCBvZiB0aGUgUlBDIHNlcnZpY2UgcHJvdmlkZXIuCiAgICogQHBhcmFtIHtTdHJpbmd9IHNlcnZpY2VOYW1lIFNlcnZpY2UgbmFtZSB0byBjYWxsLgogICAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tIE1vZHVsZSBJZCBvZiB0aGUgY2FsbGluZyBwcm92aWRlci4KICAgKiBAcGFyYW0ge09iamVjdH0gcnBjRGF0YSBUaGUgUlBDIGRhdGEgZm9yIHRoaXMgY2FsbC4KICAgKiBAcGFyYW0ge0FycmF5LjxPYmplY3Q+fSBjYWxsQXJncyBPcmlnaW5hbCBhcmd1bWVudHMgdG8gY2FsbCgpCiAgICovCiAgZnVuY3Rpb24gY2FsbElmcGModGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhLCBjYWxsQXJncykgewogICAgLy9hbGVydCgiQ09OVEFJTkVSIElGUEMgcGFyYW1zOiAiICsgdGFyZ2V0SWQgKyAiICIgKyBzZXJ2aWNlTmFtZSArICIgIiArIGZyb20gKyAiICIgKyBycGNEYXRhICsgIiAiICsgY2FsbEFyZ3MpOwogICAgLy8gUmV0cmlldmUgdGhlIHJlbGF5IGZpbGUgdXNlZCBieSBJRlBDLiBOb3RlIHRoYXQKICAgIC8vIHRoaXMgbXVzdCBiZSBzZXQgYmVmb3JlIHRoZSBjYWxsLCBhbmQgc28gd2UgY29uZHVjdAogICAgLy8gYW4gZXh0cmEgY2hlY2sgdG8gZW5zdXJlIGl0IGlzIG5vdCBibGFuay4KICAgIHZhciByZWxheSA9IGdhZGdldHMucnBjLmdldFJlbGF5VXJsKHRhcmdldElkKTsKCiAgICBpZiAoIXJlbGF5KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gcmVsYXkgZmlsZSBhc3NpZ25lZCBmb3IgSUZQQycpOwogICAgfQoKICAgIC8vIFRoZSBSUEMgbWVjaGFuaXNtIHN1cHBvcnRzIHR3byBmb3JtYXRzIGZvciBJRlBDIChsZWdhY3kgYW5kIGN1cnJlbnQpLgogICAgdmFyIHNyYyA9IG51bGwsCiAgICAgICAgcXVldWVPdXQgPSBbXTsKICAgIGlmICh1c2VMZWdhY3lQcm90b2NvbFt0YXJnZXRJZF0pIHsKICAgICAgLy8gRm9ybWF0OiAjaWZyYW1lX2lkJmNhbGxJZCZudW1fcGFja2V0cyZwYWNrZXRfbnVtJmJsb2NrX29mX2RhdGEKICAgICAgc3JjID0gW3JlbGF5LCAnIycsIGVuY29kZUxlZ2FjeURhdGEoW2Zyb20sIGNhbGxJZCwgMSwgMCwKICAgICAgICAgICAgIGVuY29kZUxlZ2FjeURhdGEoW2Zyb20sIHNlcnZpY2VOYW1lLCAnJywgJycsIGZyb21dLmNvbmNhdCgKICAgICAgICAgICAgICAgY2FsbEFyZ3MpKV0pXS5qb2luKCcnKTsKICAgICAgcXVldWVPdXQucHVzaChzcmMpOwogICAgfSBlbHNlIHsKCiAgICAgIC8vIEZvcm1hdDogI3RhcmdldElkICYgc291cmNlSWRAY2FsbElkICYgcGFja2V0TnVtICYgcGFja2V0SWQgJiBwYWNrZXREYXRhCiAgICAgIHNyYyA9IFtyZWxheSwgJyMnLCBlbmNvZGVVUklDb21wb25lbnQodGFyZ2V0SWQpLCAnJicsIGZyb20sICdAJywgY2FsbElkLCAnJiddLmpvaW4oJycpOwogICAgICBpZiAoIXVzZU11bHRpUGFydE1lc3NhZ2VzW3RhcmdldElkXSkgewogICAgICAgIC8vIEZvcm1hdDogI3RhcmdldElkICYgc291cmNlSWRAY2FsbElkICYgcGFja2V0TnVtICYgcGFja2V0SWQgJiBwYWNrZXREYXRhCiAgICAgICAgcXVldWVPdXQucHVzaChbc3JjLCAxLCAnJicsIDAsICcmJywgLCBlbmNvZGVVUklDb21wb25lbnQocnBjRGF0YSldLmpvaW4oJycpKTsKCiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgdmFyIG1lc3NhZ2UgPSBlbmNvZGVVUklDb21wb25lbnQocnBjRGF0YSksCiAgICAgICAgICAgIHBheWxvYWRMZW5ndGggPSBVUkxfTElNSVQgLSBzcmMubGVuZ3RoLAogICAgICAgICAgICBudW1QYWNrZXRzID0gTWF0aC5jZWlsKG1lc3NhZ2UubGVuZ3RoIC8gcGF5bG9hZExlbmd0aCksCiAgICAgICAgICAgIHBhY2tldElkeCA9IDAsCiAgICAgICAgICAgIHBhcnQ7CiAgICAgICAgd2hpbGUgKG1lc3NhZ2UubGVuZ3RoID4gMCkgewogICAgICAgICAgcGFydCA9IG1lc3NhZ2Uuc3Vic3RyaW5nKDAsIHBheWxvYWRMZW5ndGgpOwogICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2Uuc3Vic3RyaW5nKHBheWxvYWRMZW5ndGgpOwogICAgICAgICAgcXVldWVPdXQucHVzaChbc3JjLCBudW1QYWNrZXRzLCAnJicsIHBhY2tldElkeCwgJyYnLCBwYXJ0XS5qb2luKCcnKSk7CiAgICAgICAgICBwYWNrZXRJZHggKz0gMTsKICAgICAgICB9CgogICAgICB9CgogICAgfQoKICAgIC8vIENvbmR1Y3QgdGhlIElGUEMgY2FsbCBieSBjcmVhdGluZyB0aGUgSWZyYW1lIHdpdGgKICAgIC8vIHRoZSByZWxheSBVUkwgYW5kIGFwcGVuZGVkIG1lc3NhZ2UuCiAgICBkbyB7CiAgICAgIGVtaXRJbnZpc2libGVJZnJhbWUocXVldWVPdXQuc2hpZnQoKSx0YXJnZXRJZCk7CiAgICB9IHdoaWxlIChxdWV1ZU91dC5sZW5ndGggPiAwKTsKICAgIHJldHVybiB0cnVlOwoKCiAgfQoKICAvL0lFIG9ubHk6IHJldHVybiB0cnVlIGlmIGEgdGFyZ2V0IGlmcmFtZSBpZCBpcyBpbiBhIGNoaWxkIHBvcHVwIHdpbmRvdwogIGZ1bmN0aW9uIGlzSW5Qb3B1cCh0YXJnZXRJZCkgewogICAgaWYgKCF0YXJnZXRJZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGFyZ2V0SWQgPT0gIi4uIikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRJZCk7CiAgICBpZiAoZnJhbWUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHR5cGVvZiBfY2hpbGRXaW5kb3dzID09PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vSUUgb25seTogUXVldWUgb2YgbWVzc2FnZXMgZm9yIGNoaWxkIHdpbmRvd3MKICB3aW5kb3cuX2NoaWxkV2luZG93TWVzc2FnZVF1ZXVlID0gW107CiAgLy9JRSBvbmx5OiBVbmlxdWUgaW5jcmVhc2luZyBJRCBmb3IgYWxsIG1lc3NhZ2VzIHB1dCBvbiB0aGUgY2hpbGQgd2luZG93IHF1ZXVlCiAgd2luZG93Ll9jaGlsZFdpbmRvd01lc3NhZ2VJZCA9IDA7CiAgLy9JRSBvbmx5OiBBbGxvdyBhIGNoaWxkIHdpbmRvdyB0byByZXRyaWV2ZSBhIG1lc3NhZ2UgZnJvbSB0aGUgcXVldWUKICB3aW5kb3cuX2dldENoaWxkV2luZG93TWVzc2FnZSA9IGZ1bmN0aW9uKG1zZ0lkKSB7CiAgICB2YXIgcSA9IF9jaGlsZFdpbmRvd01lc3NhZ2VRdWV1ZTsKICAgIGZvcih2YXIgaWk9MDsgaWkgPCBxLmxlbmd0aDsgaWkrKykgewogICAgICB2YXIgbSA9IHFbaWldOwogICAgICBpZiAobS5pZCA9PSBtc2dJZCkgewogICAgICAgIHJldHVybiBtOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc01lc3NhZ2VDb21wbGV0ZShhcnIsIHRvdGFsKSB7CiAgICBmb3IgKHZhciBpID0gdG90YWwgLSAxOyBpID49IDA7IC0taSkgewogICAgICBpZiAodHlwZW9mIGFycltpXSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGVtaXQgYW4gaW52aXNpYmxlIElGcmFtZS4KICAgKiBAcGFyYW0ge1N0cmluZ30gc3JjIFNSQyBhdHRyaWJ1dGUgb2YgdGhlIElGcmFtZSB0byBlbWl0LgogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gZW1pdEludmlzaWJsZUlmcmFtZShzcmMsIHRhcmdldElkKSB7CiAgICBpZiAoaXNJblBvcHVwKHRhcmdldElkKSkgewogICAgICAgIC8vSUUgb25seToKICAgICAgICAvL1F1ZXVlIHRoZSBtZXNzYWdlIGZvciBvdXIgY2hpbGQgaWZyYW1lcywgd2hpY2ggd2lsbCBwb2xsIGZvciB0aGVtLgogICAgICAgIC8vV2UgZG8gdGhpcyBiZWNhdXNlIGluIElFIGEgcGFyZW50IHdpbmRvdyBkb2VzIG5vdCBoYXZlIGFjY2VzcyB0byB0aGUKICAgICAgICAvL2RvY3VtZW50IG9mIGNoaWxkIHBvcHVwIHdpbmRvd3MsIGFuZCBoZW5jZSBjYW5ub3QgZW1pdCBhbiBpZnJhbWUKICAgICAgICAvL3dpdGhpbiB0aGVtCiAgICAgICAgdmFyIGlkID0gd2luZG93Ll9jaGlsZFdpbmRvd01lc3NhZ2VJZDsKICAgICAgICBpZCsrOwogICAgICAgIHdpbmRvdy5fY2hpbGRXaW5kb3dNZXNzYWdlUXVldWUucHVzaCh7aWQ6aWQsIHRhcmdldDp0YXJnZXRJZCwgc3JjOnNyY30pOwogICAgICAgIHdpbmRvdy5fY2hpbGRXaW5kb3dNZXNzYWdlSWQrKzsKICAgICAgICBpZih3aW5kb3cuX2NoaWxkV2luZG93TWVzc2FnZVF1ZXVlLmxlbmd0aCA+IDIwKSB7CiAgICAgICAgICB3aW5kb3cuX2NoaWxkV2luZG93TWVzc2FnZVF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBpZnJhbWU7CiAgICAvLyBSZWN5Y2xlIElGcmFtZXMKICAgIGZvciAodmFyIGkgPSBpZnJhbWVQb29sLmxlbmd0aCAtIDE7IGkgPj0wOyAtLWkpIHsKICAgICAgdmFyIGlmciA9IGlmcmFtZVBvb2xbaV07CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGlmciAmJiAoaWZyLnJlY3ljbGFibGUgfHwgaWZyLnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpKSB7CiAgICAgICAgICBpZnIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpZnIpOwogICAgICAgICAgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7CiAgICAgICAgICAgIC8vIEZvciBNU0lFLCBkZWxldGUgYW55IGlmcmFtZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGJlaW5nIHVzZWQuIE1TSUUKICAgICAgICAgICAgLy8gY2Fubm90IHJldXNlIHRoZSBJRlJBTUUgYmVjYXVzZSBhIG5hdmlnYXRpb25hbCBjbGljayBzb3VuZCB3aWxsCiAgICAgICAgICAgIC8vIGJlIHRyaWdnZXJlZCB3aGVuIHdlIHNldCB0aGUgU1JDIGF0dHJpYnV0ZS4KICAgICAgICAgICAgLy8gT3RoZXIgYnJvd3NlcnMgc2NhbiB0aGUgcG9vbCBmb3IgYSBmcmVlIGlmcmFtZSB0byByZXVzZS4KICAgICAgICAgICAgaWZyYW1lUG9vbFtpXSA9IGlmciA9IG51bGw7CiAgICAgICAgICAgIGlmcmFtZVBvb2wuc3BsaWNlKGksIDEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWZyLnJlY3ljbGFibGUgPSBmYWxzZTsKICAgICAgICAgICAgaWZyYW1lID0gaWZyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBJZ25vcmU7IElFNyB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gdHJ5aW5nIHRvIHJlYWQgcmVhZHlTdGF0ZSBhbmQKICAgICAgICAvLyByZWFkeVN0YXRlIGlzbid0IHNldC4KICAgICAgfQogICAgfQogICAgLy8gQ3JlYXRlIElGcmFtZSBpZiBuZWNlc3NhcnkKICAgIGlmICghaWZyYW1lKSB7CiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogICAgICBpZnJhbWUuc3R5bGUuYm9yZGVyID0gaWZyYW1lLnN0eWxlLndpZHRoID0gaWZyYW1lLnN0eWxlLmhlaWdodCA9ICcwcHgnOwogICAgICBpZnJhbWUuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgICBpZnJhbWUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24oKSB7IHRoaXMucmVjeWNsYWJsZSA9IHRydWU7IH07CiAgICAgIGlmcmFtZVBvb2wucHVzaChpZnJhbWUpOwogICAgfQogICAgaWZyYW1lLnNyYyA9IHNyYzsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTsgfSwgMCk7CiAgfQoKICAgIC8vRmluZCBhIHRhcmdldCBJRnJhbWUgb3Igd2luZG93IGJhc2VkIG9mZiBhbiBSUEMgSUQsIGFsbG93aW5nIGZvcgogICAgLy90aGUgZmFjdCB0aGF0IGNoaWxkIHBvcHVwIHdpbmRvd3Mgd2l0aCBJRnJhbWVzIG1pZ2h0IGV4aXN0LgogICAgZnVuY3Rpb24gZ2V0VGFyZ2V0V2luKGlkKSB7CiAgICAgIGlmICh0eXBlb2YgaWQgPT09ICJ1bmRlZmluZWQiIHx8IGlkID09PSAiLi4iKSB7CiAgICAgICAgICAvLyBDaHJvbWUgMzAgdGhyb3dzIFNlY3VyaXR5RXJyb3Igd2hlbiBhY2Nlc3Npbmcgb3BlbmVyIHByb3BlcnR5IG9uIHdpbmRvdy5wYXJlbnQKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vQ2hlY2sgdG8gc2VlIGlmIHdlIGFyZSBhbiBpZnJhbWUgaW4gYSBjaGlsZCB3aW5kb3csIGFuZCBpZiBzbyB1c2UgdGhlIG9wZW5lcgogICAgICAgICAgICBpZihzYW1lRG9tYWluW2lkXSAhPT0gZmFsc2UgJiYgd2luZG93LnBhcmVudC5vcGVuZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cucGFyZW50Lm9wZW5lci5wYXJlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNhdGNoKGUpIHt9CiAgICAgICAgICAvL05vcm1hbCBjYXNlLCB3ZSBhcmUgYW4gSUZyYW1lIGluIGEgcGFnZQogICAgICAgICAgcmV0dXJuIHdpbmRvdy5wYXJlbnQ7CiAgICAgIH0KCiAgICAgIC8vQXQgdGhpcyBwb2ludCB3ZSBhcmUgYSBjb250YWluZXIgbG9va2luZyBmb3IgYSBjaGlsZCBpZnJhbWUKCiAgICAgIC8vIENhc3QgdG8gYSBTdHJpbmcgdG8gYXZvaWQgYW4gaW5kZXggbG9va3VwLgogICAgICBpZCA9IFN0cmluZyhpZCk7CgogICAgICB2YXIgdGFyZ2V0ID0gbnVsbDsKCiAgICAgIC8vIFRyeSB3aW5kb3cuZnJhbWVzIGZpcnN0CiAgICAgIC8vYXBwYXJlbnRseSBpbiBGRiB1c2luZyB3aW5kb3cuZnJhbWVzIHdpbGwgcmV0dXJuIGEgYm9ndXMgd2luZG93IG9iamVjdCBpZiB0aGUKICAgICAgLy9pZnJhbWUgd2FzIHJlbW92ZWQgYW5kIHJlLWFkZGVkIHRvIHRoZSBkb2N1bWVudCBzbyBpdCdzIGFsd2F5cyBiZXR0ZXIgdG8ganVzdCBkbwogICAgICAvL2EgZG9tIGxvb2t1cAovLyAgICAgIHRhcmdldCA9IHdpbmRvdy5mcmFtZXNbaWRdOwovLyAgICAgIGlmICh0YXJnZXQpIHsKLy8gICAgICAgICAgcmV0dXJuIHRhcmdldDsKLy8gICAgICB9CgogICAgICAvLyBGYWxsIGJhY2sgdG8gZ2V0RWxlbWVudEJ5SWQoKQogICAgICB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LmNvbnRlbnRXaW5kb3cpIHsKICAgICAgICByZXR1cm4gdGFyZ2V0LmNvbnRlbnRXaW5kb3c7CiAgICAgIH0KCiAgICAgIC8vIEF0IHRoaXMgcG9pbnQgd2UgaGF2ZSBtaXNzZWQgb24gc2VhcmNoaW5nIGZvciBjaGlsZCBpZnJhbWVzCiAgICAgIC8vIGluIHRoZSBtYWluIGJyb3dzZXIgd2luZG93LCBzbyBzZWFyY2ggcG9wdXAgd2luZG93cwogICAgICAvLyBUaGlzIGFzc3VtZXMgdGhlIGNvbnRhaW5lciBpcyBrZWVwaW5nIGEgbGlzdCBvZiBjaGlsZAogICAgICAvLyB3aW5kb3dzIGluIHRoZSBnbG9iYWwgX2NoaWxkV2luZG93cyBhcnJheQogICAgICBpZiAodHlwZW9mIF9jaGlsZFdpbmRvd3MgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBmb3IodmFyIGlpPTA7IGlpPF9jaGlsZFdpbmRvd3MubGVuZ3RoO2lpKyspIHsKICAgICAgICAgICAgICB2YXIgY2hpbGRXaW5kb3cgPSBfY2hpbGRXaW5kb3dzW2lpXTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAvL0luIElFIDgsIHRoaXMgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24uCiAgICAgICAgICAgICAgICAgIGlmIChjaGlsZFdpbmRvdy5kb2N1bWVudCkgewogICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gY2hpbGRXaW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgIC8vQlVHLiBEb24ndCBrbm93IGhvdyB0byBzdXBwb3J0CiAgICAgICAgICAgICAgICAgIC8vZGlyZWN0IFdNUCBjYWxscyBmcm9tIHBhcmVudCB0byBjaGlsZCBwb3B1cHMKICAgICAgICAgICAgICAgICAgLy9pbiBJRSA4LgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC5jb250ZW50V2luZG93KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmNvbnRlbnRXaW5kb3c7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKCiAgLyoqCiAgICogQXR0ZW1wdHMgdG8gbWFrZSBhbiBycGMgYnkgY2FsbGluZyB0aGUgdGFyZ2V0J3MgcmVjZWl2ZSBtZXRob2QgZGlyZWN0bHkuCiAgICogVGhpcyB3b3JrcyB3aGVuIGdhZGdldHMgYXJlIHJlbmRlcmVkIG9uIHRoZSBzYW1lIGRvbWFpbiBhcyB0aGVpciBjb250YWluZXIsCiAgICogYSBwb3RlbnRpYWxseSB1c2VmdWwgb3B0aW1pemF0aW9uIGZvciB0cnVzdGVkIGNvbnRlbnQgd2hpY2gga2VlcHMKICAgKiBSUEMgYmVoaW5kIGEgY29uc2lzdGVudCBpbnRlcmZhY2UuCiAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldCBNb2R1bGUgaWQgb2YgdGhlIHJwYyBzZXJ2aWNlIHByb3ZpZGVyCiAgICogQHBhcmFtIHtTdHJpbmd9IGZyb20gTW9kdWxlIGlkIG9mIHRoZSBjYWxsZXIgKHRoaXMpCiAgICogQHBhcmFtIHtTdHJpbmd9IGNhbGxiYWNrSWQgSWQgb2YgdGhlIGNhbGwKICAgKiBAcGFyYW0ge1N0cmluZ30gcnBjRGF0YSBKU09OLWVuY29kZWQgUlBDIHBheWxvYWQKICAgKiBAcmV0dXJuCiAgICovCiAgZnVuY3Rpb24gY2FsbFNhbWVEb21haW4odGFyZ2V0LCBycGMpIHsKICAgIHZhciBmbjsKCiAgICBpZiAoc2FtZURvbWFpblt0YXJnZXRdICE9PSBmYWxzZSkgewogICAgICAvLyBTZWVkIHdpdGggYSBuZWdhdGl2ZSwgdHlwZWQgdmFsdWUgdG8gYXZvaWQKICAgICAgLy8gaGl0dGluZyB0aGlzIGNvZGUgcGF0aCByZXBlYXRlZGx5CiAgICAgIHZhciB0YXJnZXRFbCA9IGdldFRhcmdldFdpbih0YXJnZXQpOwoKICAgICAgdHJ5IHsKICAgICAgICAvLyBJZiB0aGlzIHN1Y2NlZWRzLCB0aGVuIHNhbWUtZG9tYWluIHBvbGljeSBhcHBsaWVkCi8vICAgICAgICBzYW1lRG9tYWluW3RhcmdldF0gPSB0YXJnZXRFbC5nYWRnZXRzLnJwYy5yZWNlaXZlU2FtZURvbWFpbjsKICAgICAgICBmbiA9IHRhcmdldEVsLmdhZGdldHMucnBjLnJlY2VpdmVTYW1lRG9tYWluOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gVXN1YWwgY2FzZTogZGlmZmVyZW50IGRvbWFpbnMKICAgICAgfQogICAgfQoKICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgLy8gQ2FsbCB0YXJnZXQncyByZWNlaXZlIG1ldGhvZAogICAgICBmbihycGMpOwogICAgICBzYW1lRG9tYWluW3RhcmdldF0gPSB0cnVlOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgICAgICBzYW1lRG9tYWluW3RhcmdldF0gPSBmYWxzZTsKCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBnYWRnZXRzLmNvbmZpZyBtaWdodCBub3QgYmUgYXZhaWxhYmxlLCBzdWNoIGFzIHdoZW4gc2VydmluZyBjb250YWluZXIganMuCiAgaWYgKGdhZGdldHMuY29uZmlnKSB7CiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIFJQQyBmcm9tIHRoZSBwcm92aWRlZCBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBpbml0KGNvbmZpZykgewoJICAvL2FsZXJ0KCJDT05UQUlORVIgQ29uZmlnOiAiICsgY29uZmlnKTsKICAgICAgLy8gQWxsb3cgZm9yIHdpbGQgY2FyZCBwYXJlbnQgcmVsYXkgZmlsZXMgYXMgbG9uZyBhcyBpdCdzIGZyb20gYQogICAgICAvLyB3aGl0ZSBsaXN0ZWQgZG9tYWluLiBUaGlzIGlzIGVuZm9yY2VkIGJ5IHRoZSByZW5kZXJpbmcgc2VydmxldC4KICAgICAgaWYgKGNvbmZpZy5ycGMucGFyZW50UmVsYXlVcmwuc3Vic3RyaW5nKDAsIDcpID09PSAnaHR0cDovLycpIHsKICAgICAgICByZWxheVVybFsnLi4nXSA9IGNvbmZpZy5ycGMucGFyZW50UmVsYXlVcmw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSXQncyBhIHJlbGF0aXZlIHBhdGgsIGFuZCB3ZSBtdXN0IGFwcGVuZCB0byB0aGUgcGFyZW50LgogICAgICAgIC8vIFdlJ3JlIHJlbHlpbmcgb24gdGhlIHNlcnZlciB2YWxpZGF0aW5nIHRoZSBwYXJlbnQgcGFyYW1ldGVyIGluIHRoaXMKICAgICAgICAvLyBjYXNlLiBCZWNhdXNlIG9mIHRoaXMsIHBhcmVudCBtYXkgb25seSBiZSBwYXNzZWQgaW4gdGhlIHF1ZXJ5LCBub3QKICAgICAgICAvLyB0aGUgZnJhZ21lbnQuCiAgICAgICAgdmFyIHBhcmFtcyA9IGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMCkuc3BsaXQoIiYiKTsKCQkvL2FsZXJ0KCJJbml0IENvbmZpZyBtZXRob2QgLSBTZXR0aW5nIFBhcmFtczogIiArIHBhcmFtcyk7CiAgICAgICAgdmFyIHBhcmVudFBhcmFtID0gIiI7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHBhcmFtOyBwYXJhbSA9IHBhcmFtc1tpXTsgKytpKSB7CiAgICAgICAgICAvLyBPbmx5IHRoZSBmaXJzdCBwYXJlbnQgY2FuIGJlIHZhbGlkYXRlZC4KICAgICAgICAgIGlmIChwYXJhbS5pbmRleE9mKCJwYXJlbnQ9IikgPT09IDApIHsKICAgICAgICAgICAgcGFyZW50UGFyYW0gPSBkZWNvZGVVUklDb21wb25lbnQocGFyYW0uc3Vic3RyaW5nKDcpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlbGF5VXJsWycuLiddID0gcGFyZW50UGFyYW0gKyBjb25maWcucnBjLnBhcmVudFJlbGF5VXJsOwogICAgICB9CiAgICAgIHVzZUxlZ2FjeVByb3RvY29sWycuLiddID0gISFjb25maWcucnBjLnVzZUxlZ2FjeVByb3RvY29sOwogICAgfQoKICAgIHZhciByZXF1aXJlZENvbmZpZyA9IHsKICAgICAgcGFyZW50UmVsYXlVcmwgOiBnYWRnZXRzLmNvbmZpZy5Ob25FbXB0eVN0cmluZ1ZhbGlkYXRvcgogICAgfTsKICAgIGdhZGdldHMuY29uZmlnLnJlZ2lzdGVyKCJycGMiLCByZXF1aXJlZENvbmZpZywgaW5pdCk7CiAgfQoKICByZXR1cm4gLyoqIEBzY29wZSBnYWRnZXRzLnJwYyAqLyB7CiAgICAvKioKICAgICAqIFJlZ2lzdGVycyBhbiBSUEMgc2VydmljZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSBTZXJ2aWNlIG5hbWUgdG8gcmVnaXN0ZXIuCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFNlcnZpY2UgaGFuZGxlci4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIHJlZ2lzdGVyOiBmdW5jdGlvbihzZXJ2aWNlTmFtZSwgaGFuZGxlcikgewoJLy9hbGVydCgiQ09OVEFJTkVSIFJFR0lTVEVSIFZBUklBQkxFUzogIiArIHNlcnZpY2VOYW1lICsgIiAtfC0gIiArIGhhbmRsZXIpOwogICAgICBpZiAoc2VydmljZU5hbWUgPT0gQ0FMTEJBQ0tfTkFNRSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IG92ZXJ3cml0ZSBjYWxsYmFjayBzZXJ2aWNlIik7CiAgICAgIH0KCiAgICAgIGlmIChzZXJ2aWNlTmFtZSA9PSBERUZBVUxUX05BTUUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBvdmVyd3JpdGUgZGVmYXVsdCBzZXJ2aWNlOiIKICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHVzZSByZWdpc3RlckRlZmF1bHQiKTsKICAgICAgfQoJICBzZXJ2aWNlc1tzZXJ2aWNlTmFtZV0gPSBoYW5kbGVyOwogICAgfSwKCiAgICAvKioKICAgICAqIFVucmVnaXN0ZXJzIGFuIFJQQyBzZXJ2aWNlLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlcnZpY2VOYW1lIFNlcnZpY2UgbmFtZSB0byB1bnJlZ2lzdGVyLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgdW5yZWdpc3RlcjogZnVuY3Rpb24oc2VydmljZU5hbWUpIHsKICAgICAgaWYgKHNlcnZpY2VOYW1lID09IENBTExCQUNLX05BTUUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBkZWxldGUgY2FsbGJhY2sgc2VydmljZSIpOwogICAgICB9CgogICAgICBpZiAoc2VydmljZU5hbWUgPT0gREVGQVVMVF9OQU1FKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZGVsZXRlIGRlZmF1bHQgc2VydmljZToiCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiB1c2UgdW5yZWdpc3RlckRlZmF1bHQiKTsKICAgICAgfQoKICAgICAgZGVsZXRlIHNlcnZpY2VzW3NlcnZpY2VOYW1lXTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZWdpc3RlcnMgYSBkZWZhdWx0IHNlcnZpY2UgaGFuZGxlciB0byBwcm9jZXNzZXMgYWxsIHVua25vd24KICAgICAqIFJQQyBjYWxscyB3aGljaCByYWlzZSBhbiBleGNlcHRpb24gYnkgZGVmYXVsdC4KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgU2VydmljZSBoYW5kbGVyLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgcmVnaXN0ZXJEZWZhdWx0OiBmdW5jdGlvbihoYW5kbGVyKSB7CiAgICAgIHNlcnZpY2VzWycnXSA9IGhhbmRsZXI7CiAgICB9LAoKICAgIC8qKgogICAgICogVW5yZWdpc3RlcnMgdGhlIGRlZmF1bHQgc2VydmljZSBoYW5kbGVyLiBGdXR1cmUgdW5rbm93biBSUEMKICAgICAqIGNhbGxzIHdpbGwgZmFpbCBzaWxlbnRseS4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIHVucmVnaXN0ZXJEZWZhdWx0OiBmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlIHNlcnZpY2VzWycnXTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDYWxscyBhbiBSUEMgc2VydmljZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRJZCBNb2R1bGUgSWQgb2YgdGhlIFJQQyBzZXJ2aWNlIHByb3ZpZGVyLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIEVtcHR5IGlmIGNhbGxpbmcgdGhlIHBhcmVudCBjb250YWluZXIuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgU2VydmljZSBuYW1lIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufG51bGx9IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIChpZiBhbnkpIHRvIHByb2Nlc3MKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgUlBDIHJlcXVlc3QuCiAgICAgKiBAcGFyYW0geyp9IHZhcl9hcmdzIFBhcmFtZXRlcnMgZm9yIHRoZSBSUEMgcmVxdWVzdC4KICAgICAqCiAgICAgKiBAbWVtYmVyIGdhZGdldHMucnBjCiAgICAgKi8KICAgIGNhbGw6IGZ1bmN0aW9uKHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgY2FsbGJhY2ssIHZhcl9hcmdzKSB7CiAgICAgICsrY2FsbElkOwoJICB0YXJnZXRJZCA9IGdldElkKHRhcmdldElkKSB8fCAnLi4nOwogICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFja3NbY2FsbElkXSA9IGNhbGxiYWNrOwogICAgICB9CgogICAgICAvLyBEZWZhdWx0IHRvIHRoZSBjb250YWluZXIgY2FsbGluZy4KICAgICAgdmFyIGZyb20gPSAnLi4nOwoKICAgICAgaWYgKHRhcmdldElkID09PSAnLi4nKSB7Ci8vICAgICAgICBmcm9tID0gd2luZG93Lm5hbWU7CiAgICAgICAgZnJvbSA9IGdldElkKHdpbmRvdy5uYW1lKTsKICAgICAgfQoKICAgICAgLy8gTm90IHVzZWQgYnkgbGVnYWN5LCBjcmVhdGUgaXQgYW55d2F5Li4uCiAgICAgIHZhciBycGMgPSB7CiAgICAgICAgczogc2VydmljZU5hbWUsCiAgICAgICAgZjogZnJvbSwKICAgICAgICBjOiBjYWxsYmFjayA/IGNhbGxJZCA6IDAsCiAgICAgICAgYTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAzKSwKICAgICAgICB0OiBhdXRoVG9rZW5bdGFyZ2V0SWRdCiAgICAgIH07CgogICAgICAvLyBJZiB0YXJnZXQgaXMgb24gdGhlIHNhbWUgZG9tYWluLCBjYWxsIG1ldGhvZCBkaXJlY3RseQogICAgICBpZiAoY2FsbFNhbWVEb21haW4odGFyZ2V0SWQsIHJwYykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBycGNEYXRhID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShycGMpOwoKICAgICAgdmFyIGNoYW5uZWxUeXBlID0gcmVsYXlDaGFubmVsOwoKICAgICAgLy8gSWYgd2UgYXJlIHRvbGQgdG8gdXNlIHRoZSBsZWdhY3kgZm9ybWF0LCB0aGVuIHdlIG11c3QKICAgICAgLy8gZGVmYXVsdCB0byBJRlBDLgogICAgICBpZiAodXNlTGVnYWN5UHJvdG9jb2xbdGFyZ2V0SWRdKSB7CiAgICAgICAgY2hhbm5lbFR5cGUgPSAnaWZwYyc7CiAgICAgIH0KCiAgICAgIC8vYWxlcnQoJ2NoYW5uZWxUeXBlOicrY2hhbm5lbFR5cGUpOwogICAgICBzd2l0Y2ggKGNoYW5uZWxUeXBlKSB7CiAgICAgICAgY2FzZSAnZHBtJzogLy8gdXNlIGRvY3VtZW50LnBvc3RNZXNzYWdlLgogICAgICAgICAgLy8gR2V0IHRoZSB3aW5kb3cgZnJvbSB0aGUgZG9jdW1lbnQuIEZpeGVzIGEgYnVnIHdpdGggcG9zdE1lc3NhZ2UKICAgICAgICAgIC8vIGNhbGxzIG9uIGEgdGFyZ2V0IHRoYXQgaGFkIGJlZW4gcmVtb3ZlZCB0aGVuIGFwcGVuZGVkIHRvIHRoZSBkb2N1bWVudCBvYmplY3QKICAgICAgICAgICAgdmFyIHRhcmdldFdpbiA9IGdldFRhcmdldFdpbih0YXJnZXRJZCk7CiAgICAgICAgICAgIHZhciB0YXJnZXREb2MgPSB0YXJnZXRXaW4uZG9jdW1lbnQ7CgogICAgICAgICAgaWYgKHRhcmdldERvYyAhPSBudWxsKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHRhcmdldERvYy5wb3N0TWVzc2FnZShycGNEYXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGNhbGxJZnBjKHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSwgcnBjLmEpOwogICAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnd3BtJzogLy8gdXNlIHdpbmRvdy5wb3N0TWVzc2FnZS4KICAgICAgICAgIC8vIEdldCB0aGUgd2luZG93IGZyb20gdGhlIGRvY3VtZW50LiBGaXhlcyBhIGJ1ZyB3aXRoIHBvc3RNZXNzYWdlCiAgICAgICAgICAvLyBjYWxscyBvbiBhIHRhcmdldCB0aGF0IGhhZCBiZWVuIHJlbW92ZWQgdGhlbiBhcHBlbmRlZCB0byB0aGUgZG9jdW1lbnQgb2JqZWN0CiAgICAgICAgICAgIHZhciB0YXJnZXRXaW4gPSBnZXRUYXJnZXRXaW4odGFyZ2V0SWQpOwoKICAgICAgICAgIGlmICh0YXJnZXRXaW4gIT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHRhcmdldFdpbi5wb3N0TWVzc2FnZShycGNEYXRhLCByZWxheVVybFt0YXJnZXRJZF0pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgY2FsbElmcGModGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhLCBycGMuYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICduaXgnOiAvLyB1c2UgTklYLgogICAgICAgICAgLy9hbGVydCgnY2FsbE5peCEnKTsKICAgICAgICAgIGNhbGxOaXgodGFyZ2V0SWQsIHNlcnZpY2VOYW1lLCBmcm9tLCBycGNEYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdmZSc6IC8vIHVzZSBGcmFtZUVsZW1lbnQuCiAgICAgICAgICBjYWxsRnJhbWVFbGVtZW50KHRhcmdldElkLCBzZXJ2aWNlTmFtZSwgZnJvbSwgcnBjRGF0YSwgcnBjLmEpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6IC8vIHVzZSAnaWZwYycgYXMgYSBmYWxsYmFjayBtZWNoYW5pc20uCiAgICAgICAgICBjYWxsSWZwYyh0YXJnZXRJZCwgc2VydmljZU5hbWUsIGZyb20sIHJwY0RhdGEsIHJwYy5hKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0cyB0aGUgcmVsYXkgVVJMIG9mIGEgdGFyZ2V0IGZyYW1lLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE5hbWUgb2YgdGhlIHRhcmdldCBmcmFtZS4KICAgICAqIEByZXR1cm4ge1N0cmluZ3x1bmRlZmluZWR9IFJlbGF5IFVSTCBvZiB0aGUgdGFyZ2V0IGZyYW1lLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgZ2V0UmVsYXlVcmw6IGZ1bmN0aW9uKHRhcmdldElkKSB7CiAgICAgIHJldHVybiByZWxheVVybFt0YXJnZXRJZF07CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyB0aGUgcmVsYXkgVVJMIG9mIGEgdGFyZ2V0IGZyYW1lLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE5hbWUgb2YgdGhlIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgRnVsbCByZWxheSBVUkwgb2YgdGhlIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0X3VzZUxlZ2FjeSBUcnVlIGlmIHRoaXMgcmVsYXkgbmVlZHMgdGhlIGxlZ2FjeSBJRlBDCiAgICAgKiAgICAgd2lyZSBmb3JtYXQuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnJwYwogICAgICovCiAgICBzZXRSZWxheVVybDogZnVuY3Rpb24odGFyZ2V0SWQsIHVybCwgb3B0X3VzZUxlZ2FjeSwgdXNlTXVsdGlQYXJ0TWVzc2FnZXNGb3JJRlBDKSB7CiAgICAgIHJlbGF5VXJsW3RhcmdldElkXSA9IHVybDsKICAgICAgdXNlTGVnYWN5UHJvdG9jb2xbdGFyZ2V0SWRdID0gISFvcHRfdXNlTGVnYWN5OwogICAgICB1c2VNdWx0aVBhcnRNZXNzYWdlc1t0YXJnZXRJZF0gPSAhIXVzZU11bHRpUGFydE1lc3NhZ2VzRm9ySUZQQzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBhdXRoIHRva2VuIG9mIGEgdGFyZ2V0IGZyYW1lLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldElkIE5hbWUgb2YgdGhlIHRhcmdldCBmcmFtZS4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0b2tlbiBUaGUgYXV0aGVudGljYXRpb24gdG9rZW4gdG8gdXNlIGZvciBhbGwKICAgICAqICAgICBjYWxscyB0byBvciBmcm9tIHRoaXMgdGFyZ2V0IGlkLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgc2V0QXV0aFRva2VuOiBmdW5jdGlvbih0YXJnZXRJZCwgdG9rZW4pIHsKICAgICAgYXV0aFRva2VuW3RhcmdldElkXSA9IHRva2VuOwogICAgICBzZXR1cEZyYW1lKHRhcmdldElkLCB0b2tlbik7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0cyB0aGUgUlBDIHJlbGF5IG1lY2hhbmlzbS4KICAgICAqIEByZXR1cm4ge1N0cmluZ30gUlBDIHJlbGF5IG1lY2hhbmlzbS4gU2VlIGFib3ZlIGZvcgogICAgICogICBhIGxpc3Qgb2Ygc3VwcG9ydGVkIHR5cGVzLgogICAgICoKICAgICAqIEBtZW1iZXIgZ2FkZ2V0cy5ycGMKICAgICAqLwogICAgZ2V0UmVsYXlDaGFubmVsOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJlbGF5Q2hhbm5lbDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZWNlaXZlcyBhbmQgcHJvY2Vzc2VzIGFuIFJQQyByZXF1ZXN0LiAoTm90IHRvIGJlIHVzZWQgZGlyZWN0bHkuKQogICAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPn0gZnJhZ21lbnQgQW4gUlBDIHJlcXVlc3QgZnJhZ21lbnQgZW5jb2RlZCBhcwogICAgICogICAgICAgIGFuIGFycmF5LiBUaGUgZmlyc3QgNCBlbGVtZW50cyBhcmUgdGFyZ2V0IGlkLCBzb3VyY2UgaWQgJiBjYWxsIGlkLAogICAgICogICAgICAgIHRvdGFsIHBhY2tldCBudW1iZXIsIHBhY2tldCBpZC4gVGhlIGxhc3QgZWxlbWVudCBzdG9yZXMgdGhlIGFjdHVhbAogICAgICogICAgICAgIEpTT04tZW5jb2RlZCBhbmQgVVJJIGVzY2FwZWQgcGFja2V0IGRhdGEuCiAgICAgKgogICAgICogQG1lbWJlciBnYWRnZXRzLnJwYwogICAgICovCiAgICByZWNlaXZlOiBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICBpZiAoZnJhZ21lbnQubGVuZ3RoID4gNCkgewovLyAgICAgICAgLy8gVE9ETyBwYXJzZSBmcmFnbWVudFsxLi4zXSB0byBtZXJnZSBtdWx0aS1mcmFnbWVudCBtZXNzYWdlcwovLyAgICAgICAgcHJvY2VzcyhnYWRnZXRzLmpzb24ucGFyc2UoCi8vICAgICAgICAgICAgZGVjb2RlVVJJQ29tcG9uZW50KGZyYWdtZW50W2ZyYWdtZW50Lmxlbmd0aCAtIDFdKSkpOwoKICAgICAgICB2YXIgZnJvbSA9IGZyYWdtZW50WzFdLCAgIC8vIGluIHRoZSBmb3JtIG9mICI8ZnJvbT5APGNhbGxpZD4iCiAgICAgICAgICAgIG51bVBhY2tldHMgPSBwYXJzZUludChmcmFnbWVudFsyXSwgMTApLAogICAgICAgICAgICBwYWNrZXRJZHggPSBwYXJzZUludChmcmFnbWVudFszXSwgMTApLAogICAgICAgICAgICBwYXlsb2FkID0gZnJhZ21lbnRbZnJhZ21lbnQubGVuZ3RoIC0gMV0sCiAgICAgICAgICAgIGNvbXBsZXRlZCA9IG51bVBhY2tldHMgPT09IDE7CgogICAgICAgIC8vIGlmIG1lc3NhZ2UgaXMgbXVsdGktcGFydCwgc3RvcmUgcGFydHMgaW4gdGhlIHByb3BlciBvcmRlcgogICAgICAgIGlmIChudW1QYWNrZXRzID4gMSkgewogICAgICAgICAgaWYgKCFtZXNzYWdlc0luW2Zyb21dKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzSW5bZnJvbV0gPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIG1lc3NhZ2VzSW5bZnJvbV1bcGFja2V0SWR4XSA9IHBheWxvYWQ7CiAgICAgICAgICAvLyBjaGVjayBpZiBhbGwgcGFydHMgaGF2ZSBiZWVuIHNlbnQKICAgICAgICAgIGlmIChpc01lc3NhZ2VDb21wbGV0ZShtZXNzYWdlc0luW2Zyb21dLCBudW1QYWNrZXRzKSkgewogICAgICAgICAgICBwYXlsb2FkID0gbWVzc2FnZXNJbltmcm9tXS5qb2luKCcnKTsKICAgICAgICAgICAgZGVsZXRlIG1lc3NhZ2VzSW5bZnJvbV07CiAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjb21wbGV0ZSBtZXNzYWdlIHNlbnQKICAgICAgICBpZiAoY29tcGxldGVkKSB7CiAgICAgICAgICBwcm9jZXNzKGdhZGdldHMuanNvbi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQocGF5bG9hZCkpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZWNlaXZlcyBhbmQgcHJvY2Vzc2VzIGFuIFJQQyByZXF1ZXN0IHNlbnQgdmlhIHRoZSBzYW1lIGRvbWFpbi4KICAgICAqIChOb3QgdG8gYmUgdXNlZCBkaXJlY3RseSkuIENvbnZlcnRzIHRoZSBpbmJvdW5kIHJwYyBvYmplY3QncwogICAgICogQXJyYXkgaW50byBhIGxvY2FsIEFycmF5IHRvIHBhc3MgdGhlIHByb2Nlc3MoKSBBcnJheSB0ZXN0LgogICAgICogQHBhcmFtIHtPYmplY3R9IHJwYyBSUEMgb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHJlcXVlc3QgcGFyYW1zCiAgICAgKi8KICAgIHJlY2VpdmVTYW1lRG9tYWluOiBmdW5jdGlvbihycGMpIHsKICAgICAgLy8gUGFzcyB0aHJvdWdoIHRvIGxvY2FsIHByb2Nlc3MgbWV0aG9kIGJ1dCBjb252ZXJ0aW5nIHRvIGEgbG9jYWwgQXJyYXkKICAgICAgcnBjLmEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChycGMuYSk7CgkgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBwcm9jZXNzKHJwYykgfSwgMCk7CiAgICB9CiAgfTsKfSgpOwoKLyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgovKioKICogQGZpbGVvdmVydmlldyBHYWRnZXQtc2lkZSBQdWJTdWIgbGlicmFyeSBmb3IgZ2FkZ2V0LXRvLWdhZGdldCBjb21tdW5pY2F0aW9uLgogKi8KCnZhciBnYWRnZXRzID0gZ2FkZ2V0cyB8fCB7fTsKCi8qKgogKiBAc3RhdGljCiAqIEBjbGFzcyBQcm92aWRlcyBvcGVyYXRpb25zIGZvciBtYWtpbmcgcnBjIGNhbGxzLgogKiBAbmFtZSBnYWRnZXRzLnB1YnN1YgogKi8KZ2FkZ2V0cy5wdWJzdWIgPSAoZnVuY3Rpb24oKSB7CiAgdmFyIGxpc3RlbmVycyA9IHt9OwoKICBmdW5jdGlvbiByb3V0ZXIoY2hhbm5lbCwgc2VuZGVyLCBtZXNzYWdlKSB7CiAgICB2YXIgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbY2hhbm5lbF07CiAgICBpZiAodHlwZW9mIGxpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIGxpc3RlbmVyKHNlbmRlciwgbWVzc2FnZSxjaGFubmVsKTsKICAgIH0KICB9CgogIHJldHVybiAvKiogQHNjb3BlIGdhZGdldHMucHVic3ViICovIHsKICAgIC8qKgogICAgICogUHVibGlzaGVzIGEgbWVzc2FnZSB0byBhIGNoYW5uZWwuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbCBDaGFubmVsIG5hbWUuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBNZXNzYWdlIHRvIHB1Ymxpc2guCiAgICAgKi8KICAgIHB1Ymxpc2g6IGZ1bmN0aW9uKGNoYW5uZWwsIG1lc3NhZ2UsIGRlc3QpIHsKICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCAncHVic3ViJywgbnVsbCwgJ3B1Ymxpc2gnLCBjaGFubmVsLCBtZXNzYWdlLCBkZXN0KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTdWJzY3JpYmVzIHRvIGEgY2hhbm5lbC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjaGFubmVsIENoYW5uZWwgbmFtZS4KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgbWVzc2FnZXMuCiAgICAgKiAgICAgICAgICAgICAgICAgICBGb3IgZXhhbXBsZToKICAgICAqICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHNlbmRlciwgbWVzc2FnZSkgewogICAgICogICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcnVzdGVkR2FkZ2V0U3BlY1VybChzZW5kZXIpKSB7CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc01lc3NhZ2UobWVzc2FnZSk7CiAgICAgKiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAqICAgICAgICAgICAgICAgICAgIH0KICAgICAqLwogICAgc3Vic2NyaWJlOiBmdW5jdGlvbihjaGFubmVsLCBjYWxsYmFjaykgewogICAgICBsaXN0ZW5lcnNbY2hhbm5lbF0gPSBjYWxsYmFjazsKICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoJ3B1YnN1YicsIHJvdXRlcik7CiAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ3B1YnN1YicsIG51bGwsICdzdWJzY3JpYmUnLCBjaGFubmVsKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBVbnN1YnNjcmliZXMgZnJvbSBhIGNoYW5uZWwuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbCBDaGFubmVsIG5hbWUuCiAgICAgKi8KICAgIHVuc3Vic2NyaWJlOiBmdW5jdGlvbihjaGFubmVsKSB7CiAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbY2hhbm5lbF07CiAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ3B1YnN1YicsIG51bGwsICd1bnN1YnNjcmliZScsIGNoYW5uZWwpOwogICAgICB9CgogIH07Cn0pKCk7CgoKLyoqDQogKiBDb3B5cmlnaHQgMjAwOSBUaW0gRG93bi4NCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCg0KDQppZighQXJyYXkucHJvdG90eXBlLnB1c2gpe0FycmF5LnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTAsbGVuPWFyZ3VtZW50cy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzW3RoaXMubGVuZ3RoXT1hcmd1bWVudHNbaV07fQ0KcmV0dXJuIHRoaXMubGVuZ3RoO307fQ0KaWYoIUFycmF5LnByb3RvdHlwZS5zaGlmdCl7QXJyYXkucHJvdG90eXBlLnNoaWZ0PWZ1bmN0aW9uKCl7aWYodGhpcy5sZW5ndGg+MCl7dmFyIGZpcnN0SXRlbT10aGlzWzBdO2Zvcih2YXIgaT0wLGxlbj10aGlzLmxlbmd0aC0xO2k8bGVuO2krKyl7dGhpc1tpXT10aGlzW2krMV07fQ0KdGhpcy5sZW5ndGg9dGhpcy5sZW5ndGgtMTtyZXR1cm4gZmlyc3RJdGVtO319O30NCmlmKCFBcnJheS5wcm90b3R5cGUuc3BsaWNlKXtBcnJheS5wcm90b3R5cGUuc3BsaWNlPWZ1bmN0aW9uKHN0YXJ0SW5kZXgsZGVsZXRlQ291bnQpe3ZhciBpdGVtc0FmdGVyRGVsZXRlZD10aGlzLnNsaWNlKHN0YXJ0SW5kZXgrZGVsZXRlQ291bnQpO3ZhciBpdGVtc0RlbGV0ZWQ9dGhpcy5zbGljZShzdGFydEluZGV4LHN0YXJ0SW5kZXgrZGVsZXRlQ291bnQpO3RoaXMubGVuZ3RoPXN0YXJ0SW5kZXg7dmFyIGFyZ3VtZW50c0FycmF5PVtdO2Zvcih2YXIgaT0wLGxlbj1hcmd1bWVudHMubGVuZ3RoO2k8bGVuO2krKyl7YXJndW1lbnRzQXJyYXlbaV09YXJndW1lbnRzW2ldO30NCnZhciBpdGVtc1RvQXBwZW5kPShhcmd1bWVudHNBcnJheS5sZW5ndGg+Mik/aXRlbXNBZnRlckRlbGV0ZWQ9YXJndW1lbnRzQXJyYXkuc2xpY2UoMikuY29uY2F0KGl0ZW1zQWZ0ZXJEZWxldGVkKTppdGVtc0FmdGVyRGVsZXRlZDtmb3IoaT0wLGxlbj1pdGVtc1RvQXBwZW5kLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMucHVzaChpdGVtc1RvQXBwZW5kW2ldKTt9DQpyZXR1cm4gaXRlbXNEZWxldGVkO307fQ0KdmFyIGxvZzRqYXZhc2NyaXB0OyhmdW5jdGlvbigpe2Z1bmN0aW9uIGlzVW5kZWZpbmVkKG9iail7cmV0dXJuIHR5cGVvZiBvYmo9PSJ1bmRlZmluZWQiO30NCmZ1bmN0aW9uIEV2ZW50U3VwcG9ydCgpe30NCkV2ZW50U3VwcG9ydC5wcm90b3R5cGU9e2V2ZW50VHlwZXM6W10sZXZlbnRMaXN0ZW5lcnM6e30sc2V0RXZlbnRUeXBlczpmdW5jdGlvbihldmVudFR5cGVzUGFyYW0pe2lmKGV2ZW50VHlwZXNQYXJhbSBpbnN0YW5jZW9mIEFycmF5KXt0aGlzLmV2ZW50VHlwZXM9ZXZlbnRUeXBlc1BhcmFtO3RoaXMuZXZlbnRMaXN0ZW5lcnM9e307Zm9yKHZhciBpPTAsbGVuPXRoaXMuZXZlbnRUeXBlcy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmV2ZW50TGlzdGVuZXJzW3RoaXMuZXZlbnRUeXBlc1tpXV09W107fX1lbHNle2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdC5FdmVudFN1cHBvcnQgWyIrdGhpcysiXTogc2V0RXZlbnRUeXBlczogZXZlbnRUeXBlcyBwYXJhbWV0ZXIgbXVzdCBiZSBhbiBBcnJheSIpO319LGFkZEV2ZW50TGlzdGVuZXI6ZnVuY3Rpb24oZXZlbnRUeXBlLGxpc3RlbmVyKXtpZih0eXBlb2YgbGlzdGVuZXI9PSJmdW5jdGlvbiIpe2lmKCFhcnJheV9jb250YWlucyh0aGlzLmV2ZW50VHlwZXMsZXZlbnRUeXBlKSl7aGFuZGxlRXJyb3IoImxvZzRqYXZhc2NyaXB0LkV2ZW50U3VwcG9ydCBbIit0aGlzKyJdOiBhZGRFdmVudExpc3RlbmVyOiBubyBldmVudCBjYWxsZWQgJyIrZXZlbnRUeXBlKyInIik7fQ0KdGhpcy5ldmVudExpc3RlbmVyc1tldmVudFR5cGVdLnB1c2gobGlzdGVuZXIpO31lbHNle2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdC5FdmVudFN1cHBvcnQgWyIrdGhpcysiXTogYWRkRXZlbnRMaXN0ZW5lcjogbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uIik7fX0scmVtb3ZlRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbihldmVudFR5cGUsbGlzdGVuZXIpe2lmKHR5cGVvZiBsaXN0ZW5lcj09ImZ1bmN0aW9uIil7aWYoIWFycmF5X2NvbnRhaW5zKHRoaXMuZXZlbnRUeXBlcyxldmVudFR5cGUpKXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuRXZlbnRTdXBwb3J0IFsiK3RoaXMrIl06IHJlbW92ZUV2ZW50TGlzdGVuZXI6IG5vIGV2ZW50IGNhbGxlZCAnIitldmVudFR5cGUrIiciKTt9DQphcnJheV9yZW1vdmUodGhpcy5ldmVudExpc3RlbmVyc1tldmVudFR5cGVdLGxpc3RlbmVyKTt9ZWxzZXtoYW5kbGVFcnJvcigibG9nNGphdmFzY3JpcHQuRXZlbnRTdXBwb3J0IFsiK3RoaXMrIl06IHJlbW92ZUV2ZW50TGlzdGVuZXI6IGxpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbiIpO319LGRpc3BhdGNoRXZlbnQ6ZnVuY3Rpb24oZXZlbnRUeXBlLGV2ZW50QXJncyl7aWYoYXJyYXlfY29udGFpbnModGhpcy5ldmVudFR5cGVzLGV2ZW50VHlwZSkpe3ZhciBsaXN0ZW5lcnM9dGhpcy5ldmVudExpc3RlbmVyc1tldmVudFR5cGVdO2Zvcih2YXIgaT0wLGxlbj1saXN0ZW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7bGlzdGVuZXJzW2ldKHRoaXMsZXZlbnRUeXBlLGV2ZW50QXJncyk7fX1lbHNle2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdC5FdmVudFN1cHBvcnQgWyIrdGhpcysiXTogZGlzcGF0Y2hFdmVudDogbm8gZXZlbnQgY2FsbGVkICciK2V2ZW50VHlwZSsiJyIpO319fTt2YXIgYXBwbGljYXRpb25TdGFydERhdGU9bmV3IERhdGUoKTt2YXIgdW5pcXVlSWQ9ImxvZzRqYXZhc2NyaXB0XyIrYXBwbGljYXRpb25TdGFydERhdGUuZ2V0VGltZSgpKyJfIisNCk1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMDAwMDApO3ZhciBlbXB0eUZ1bmN0aW9uPWZ1bmN0aW9uKCl7fTt2YXIgbmV3TGluZT0iXHJcbiI7dmFyIHBhZ2VMb2FkZWQ9ZmFsc2U7ZnVuY3Rpb24gTG9nNEphdmFTY3JpcHQoKXt9DQpMb2c0SmF2YVNjcmlwdC5wcm90b3R5cGU9bmV3IEV2ZW50U3VwcG9ydCgpO2xvZzRqYXZhc2NyaXB0PW5ldyBMb2c0SmF2YVNjcmlwdCgpO2xvZzRqYXZhc2NyaXB0LnZlcnNpb249IjEuNC4xIjtsb2c0amF2YXNjcmlwdC5lZGl0aW9uPSJsb2c0amF2YXNjcmlwdCI7ZnVuY3Rpb24gdG9TdHIob2JqKXtpZihvYmomJm9iai50b1N0cmluZyl7cmV0dXJuIG9iai50b1N0cmluZygpO31lbHNle3JldHVybiBTdHJpbmcob2JqKTt9fQ0KZnVuY3Rpb24gZ2V0RXhjZXB0aW9uTWVzc2FnZShleCl7aWYoZXgubWVzc2FnZSl7cmV0dXJuIGV4Lm1lc3NhZ2U7fWVsc2UgaWYoZXguZGVzY3JpcHRpb24pe3JldHVybiBleC5kZXNjcmlwdGlvbjt9ZWxzZXtyZXR1cm4gdG9TdHIoZXgpO319DQpmdW5jdGlvbiBnZXRVcmxGaWxlTmFtZSh1cmwpe3ZhciBsYXN0U2xhc2hJbmRleD1NYXRoLm1heCh1cmwubGFzdEluZGV4T2YoIi8iKSx1cmwubGFzdEluZGV4T2YoIlxcIikpO3JldHVybiB1cmwuc3Vic3RyKGxhc3RTbGFzaEluZGV4KzEpO30NCmZ1bmN0aW9uIGdldEV4Y2VwdGlvblN0cmluZ1JlcChleCl7aWYoZXgpe3ZhciBleFN0cj0iRXhjZXB0aW9uOiAiK2dldEV4Y2VwdGlvbk1lc3NhZ2UoZXgpO3RyeXtpZihleC5saW5lTnVtYmVyKXtleFN0cis9IiBvbiBsaW5lIG51bWJlciAiK2V4LmxpbmVOdW1iZXI7fQ0KaWYoZXguZmlsZU5hbWUpe2V4U3RyKz0iIGluIGZpbGUgIitnZXRVcmxGaWxlTmFtZShleC5maWxlTmFtZSk7fX1jYXRjaChsb2NhbEV4KXtsb2dMb2cud2FybigiVW5hYmxlIHRvIG9idGFpbiBmaWxlIGFuZCBsaW5lIGluZm9ybWF0aW9uIGZvciBlcnJvciIpO30NCmlmKHNob3dTdGFja1RyYWNlcyYmZXguc3RhY2spe2V4U3RyKz1uZXdMaW5lKyJTdGFjayB0cmFjZToiK25ld0xpbmUrZXguc3RhY2s7fQ0KcmV0dXJuIGV4U3RyO30NCnJldHVybiBudWxsO30NCmZ1bmN0aW9uIGJvb2wob2JqKXtyZXR1cm4gQm9vbGVhbihvYmopO30NCmZ1bmN0aW9uIHRyaW0oc3RyKXtyZXR1cm4gc3RyLnJlcGxhY2UoL15ccysvLCIiKS5yZXBsYWNlKC9ccyskLywiIik7fQ0KZnVuY3Rpb24gc3BsaXRJbnRvTGluZXModGV4dCl7dmFyIHRleHQyPXRleHQucmVwbGFjZSgvXHJcbi9nLCJcbiIpLnJlcGxhY2UoL1xyL2csIlxuIik7cmV0dXJuIHRleHQyLnNwbGl0KCJcbiIpO30NCmZ1bmN0aW9uIHVybEVuY29kZShzdHIpe3JldHVybiBlc2NhcGUoc3RyKS5yZXBsYWNlKC9cKy9nLCIlMkIiKS5yZXBsYWNlKC8iL2csIiUyMiIpLnJlcGxhY2UoLycvZywiJTI3IikucmVwbGFjZSgvXC8vZywiJTJGIikucmVwbGFjZSgvPS9nLCIlM0QiKTt9DQpmdW5jdGlvbiB1cmxEZWNvZGUoc3RyKXtyZXR1cm4gdW5lc2NhcGUoc3RyKS5yZXBsYWNlKC8lMkIvZywiKyIpLnJlcGxhY2UoLyUyMi9nLCJcIiIpLnJlcGxhY2UoLyUyNy9nLCInIikucmVwbGFjZSgvJTJGL2csIi8iKS5yZXBsYWNlKC8lM0QvZywiPSIpO30NCmZ1bmN0aW9uIGFycmF5X3JlbW92ZShhcnIsdmFsKXt2YXIgaW5kZXg9LTE7Zm9yKHZhciBpPTAsbGVuPWFyci5sZW5ndGg7aTxsZW47aSsrKXtpZihhcnJbaV09PT12YWwpe2luZGV4PWk7YnJlYWs7fX0NCmlmKGluZGV4Pj0wKXthcnIuc3BsaWNlKGluZGV4LDEpO3JldHVybiB0cnVlO31lbHNle3JldHVybiBmYWxzZTt9fQ0KZnVuY3Rpb24gYXJyYXlfY29udGFpbnMoYXJyLHZhbCl7Zm9yKHZhciBpPTAsbGVuPWFyci5sZW5ndGg7aTxsZW47aSsrKXtpZihhcnJbaV09PXZhbCl7cmV0dXJuIHRydWU7fX0NCnJldHVybiBmYWxzZTt9DQpmdW5jdGlvbiBleHRyYWN0Qm9vbGVhbkZyb21QYXJhbShwYXJhbSxkZWZhdWx0VmFsdWUpe2lmKGlzVW5kZWZpbmVkKHBhcmFtKSl7cmV0dXJuIGRlZmF1bHRWYWx1ZTt9ZWxzZXtyZXR1cm4gYm9vbChwYXJhbSk7fX0NCmZ1bmN0aW9uIGV4dHJhY3RTdHJpbmdGcm9tUGFyYW0ocGFyYW0sZGVmYXVsdFZhbHVlKXtpZihpc1VuZGVmaW5lZChwYXJhbSkpe3JldHVybiBkZWZhdWx0VmFsdWU7fWVsc2V7cmV0dXJuIFN0cmluZyhwYXJhbSk7fX0NCmZ1bmN0aW9uIGV4dHJhY3RJbnRGcm9tUGFyYW0ocGFyYW0sZGVmYXVsdFZhbHVlKXtpZihpc1VuZGVmaW5lZChwYXJhbSkpe3JldHVybiBkZWZhdWx0VmFsdWU7fWVsc2V7dHJ5e3ZhciB2YWx1ZT1wYXJzZUludChwYXJhbSwxMCk7cmV0dXJuIGlzTmFOKHZhbHVlKT9kZWZhdWx0VmFsdWU6dmFsdWU7fWNhdGNoKGV4KXtsb2dMb2cud2FybigiSW52YWxpZCBpbnQgcGFyYW0gIitwYXJhbSxleCk7cmV0dXJuIGRlZmF1bHRWYWx1ZTt9fX0NCmZ1bmN0aW9uIGV4dHJhY3RGdW5jdGlvbkZyb21QYXJhbShwYXJhbSxkZWZhdWx0VmFsdWUpe2lmKHR5cGVvZiBwYXJhbT09ImZ1bmN0aW9uIil7cmV0dXJuIHBhcmFtO31lbHNle3JldHVybiBkZWZhdWx0VmFsdWU7fX0NCmZ1bmN0aW9uIGlzRXJyb3IoZXJyKXtyZXR1cm4oZXJyIGluc3RhbmNlb2YgRXJyb3IpO30NCmlmKCFGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkpe0Z1bmN0aW9uLnByb3RvdHlwZS5hcHBseT1mdW5jdGlvbihvYmosYXJncyl7dmFyIG1ldGhvZE5hbWU9Il9fYXBwbHlfXyI7aWYodHlwZW9mIG9ialttZXRob2ROYW1lXSE9InVuZGVmaW5lZCIpe21ldGhvZE5hbWUrPVN0cmluZyhNYXRoLnJhbmRvbSgpKS5zdWJzdHIoMik7fQ0Kb2JqW21ldGhvZE5hbWVdPXRoaXM7dmFyIGFyZ3NTdHJpbmdzPVtdO2Zvcih2YXIgaT0wLGxlbj1hcmdzLmxlbmd0aDtpPGxlbjtpKyspe2FyZ3NTdHJpbmdzW2ldPSJhcmdzWyIraSsiXSI7fQ0KdmFyIHNjcmlwdD0ib2JqLiIrbWV0aG9kTmFtZSsiKCIrYXJnc1N0cmluZ3Muam9pbigiLCIpKyIpIjt2YXIgcmV0dXJuVmFsdWU9ZXZhbChzY3JpcHQpO2RlbGV0ZSBvYmpbbWV0aG9kTmFtZV07cmV0dXJuIHJldHVyblZhbHVlO307fQ0KaWYoIUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsKXtGdW5jdGlvbi5wcm90b3R5cGUuY2FsbD1mdW5jdGlvbihvYmope3ZhciBhcmdzPVtdO2Zvcih2YXIgaT0xLGxlbj1hcmd1bWVudHMubGVuZ3RoO2k8bGVuO2krKyl7YXJnc1tpLTFdPWFyZ3VtZW50c1tpXTt9DQpyZXR1cm4gdGhpcy5hcHBseShvYmosYXJncyk7fTt9DQpmdW5jdGlvbiBnZXRMaXN0ZW5lcnNQcm9wZXJ0eU5hbWUoZXZlbnROYW1lKXtyZXR1cm4iX19sb2c0amF2YXNjcmlwdF9saXN0ZW5lcnNfXyIrZXZlbnROYW1lO30NCmZ1bmN0aW9uIGFkZEV2ZW50KG5vZGUsZXZlbnROYW1lLGxpc3RlbmVyLHVzZUNhcHR1cmUsd2luKXt3aW49d2luP3dpbjp3aW5kb3c7aWYobm9kZS5hZGRFdmVudExpc3RlbmVyKXtub2RlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLGxpc3RlbmVyLHVzZUNhcHR1cmUpO31lbHNlIGlmKG5vZGUuYXR0YWNoRXZlbnQpe25vZGUuYXR0YWNoRXZlbnQoIm9uIitldmVudE5hbWUsbGlzdGVuZXIpO31lbHNle3ZhciBwcm9wZXJ0eU5hbWU9Z2V0TGlzdGVuZXJzUHJvcGVydHlOYW1lKGV2ZW50TmFtZSk7aWYoIW5vZGVbcHJvcGVydHlOYW1lXSl7bm9kZVtwcm9wZXJ0eU5hbWVdPVtdO25vZGVbIm9uIitldmVudE5hbWVdPWZ1bmN0aW9uKGV2dCl7ZXZ0PWdldEV2ZW50KGV2dCx3aW4pO3ZhciBsaXN0ZW5lcnNQcm9wZXJ0eU5hbWU9Z2V0TGlzdGVuZXJzUHJvcGVydHlOYW1lKGV2ZW50TmFtZSk7dmFyIGxpc3RlbmVycz10aGlzW2xpc3RlbmVyc1Byb3BlcnR5TmFtZV0uY29uY2F0KFtdKTt2YXIgY3VycmVudExpc3RlbmVyO3doaWxlKChjdXJyZW50TGlzdGVuZXI9bGlzdGVuZXJzLnNoaWZ0KCkpKXtjdXJyZW50TGlzdGVuZXIuY2FsbCh0aGlzLGV2dCk7fX07fQ0Kbm9kZVtwcm9wZXJ0eU5hbWVdLnB1c2gobGlzdGVuZXIpO319DQpmdW5jdGlvbiByZW1vdmVFdmVudChub2RlLGV2ZW50TmFtZSxsaXN0ZW5lcix1c2VDYXB0dXJlKXtpZihub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIpe25vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsbGlzdGVuZXIsdXNlQ2FwdHVyZSk7fWVsc2UgaWYobm9kZS5kZXRhY2hFdmVudCl7bm9kZS5kZXRhY2hFdmVudCgib24iK2V2ZW50TmFtZSxsaXN0ZW5lcik7fWVsc2V7dmFyIHByb3BlcnR5TmFtZT1nZXRMaXN0ZW5lcnNQcm9wZXJ0eU5hbWUoZXZlbnROYW1lKTtpZihub2RlW3Byb3BlcnR5TmFtZV0pe2FycmF5X3JlbW92ZShub2RlW3Byb3BlcnR5TmFtZV0sbGlzdGVuZXIpO319fQ0KZnVuY3Rpb24gZ2V0RXZlbnQoZXZ0LHdpbil7d2luPXdpbj93aW46d2luZG93O3JldHVybiBldnQ/ZXZ0Ondpbi5ldmVudDt9DQpmdW5jdGlvbiBzdG9wRXZlbnRQcm9wYWdhdGlvbihldnQpe2lmKGV2dC5zdG9wUHJvcGFnYXRpb24pe2V2dC5zdG9wUHJvcGFnYXRpb24oKTt9ZWxzZSBpZih0eXBlb2YgZXZ0LmNhbmNlbEJ1YmJsZSE9InVuZGVmaW5lZCIpe2V2dC5jYW5jZWxCdWJibGU9dHJ1ZTt9DQpldnQucmV0dXJuVmFsdWU9ZmFsc2U7fQ0KdmFyIGxvZ0xvZz17cXVpZXRNb2RlOmZhbHNlLGRlYnVnTWVzc2FnZXM6W10sc2V0UXVpZXRNb2RlOmZ1bmN0aW9uKHF1aWV0TW9kZSl7dGhpcy5xdWlldE1vZGU9Ym9vbChxdWlldE1vZGUpO30sbnVtYmVyT2ZFcnJvcnM6MCxhbGVydEFsbEVycm9yczpmYWxzZSxzZXRBbGVydEFsbEVycm9yczpmdW5jdGlvbihhbGVydEFsbEVycm9ycyl7dGhpcy5hbGVydEFsbEVycm9ycz1hbGVydEFsbEVycm9yczt9LGRlYnVnOmZ1bmN0aW9uKG1lc3NhZ2Upe3RoaXMuZGVidWdNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO30sZGlzcGxheURlYnVnOmZ1bmN0aW9uKCl7YWxlcnQodGhpcy5kZWJ1Z01lc3NhZ2VzLmpvaW4obmV3TGluZSkpO30sd2FybjpmdW5jdGlvbihtZXNzYWdlLGV4Y2VwdGlvbil7fSxlcnJvcjpmdW5jdGlvbihtZXNzYWdlLGV4Y2VwdGlvbil7aWYoKyt0aGlzLm51bWJlck9mRXJyb3JzPT0xfHx0aGlzLmFsZXJ0QWxsRXJyb3JzKXtpZighdGhpcy5xdWlldE1vZGUpe3ZhciBhbGVydE1lc3NhZ2U9ImxvZzRqYXZhc2NyaXB0IGVycm9yOiAiK21lc3NhZ2U7aWYoZXhjZXB0aW9uKXthbGVydE1lc3NhZ2UrPW5ld0xpbmUrbmV3TGluZSsiT3JpZ2luYWwgZXJyb3I6ICIrZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGV4Y2VwdGlvbik7fQ0KYWxlcnQoYWxlcnRNZXNzYWdlKTt9fX19O2xvZzRqYXZhc2NyaXB0LmxvZ0xvZz1sb2dMb2c7bG9nNGphdmFzY3JpcHQuc2V0RXZlbnRUeXBlcyhbImxvYWQiLCJlcnJvciJdKTtmdW5jdGlvbiBoYW5kbGVFcnJvcihtZXNzYWdlLGV4Y2VwdGlvbil7bG9nTG9nLmVycm9yKG1lc3NhZ2UsZXhjZXB0aW9uKTtsb2c0amF2YXNjcmlwdC5kaXNwYXRjaEV2ZW50KCJlcnJvciIseyJtZXNzYWdlIjptZXNzYWdlLCJleGNlcHRpb24iOmV4Y2VwdGlvbn0pO30NCmxvZzRqYXZhc2NyaXB0LmhhbmRsZUVycm9yPWhhbmRsZUVycm9yO3ZhciBlbmFibGVkPSEoKHR5cGVvZiBsb2c0amF2YXNjcmlwdF9kaXNhYmxlZCE9InVuZGVmaW5lZCIpJiZsb2c0amF2YXNjcmlwdF9kaXNhYmxlZCk7bG9nNGphdmFzY3JpcHQuc2V0RW5hYmxlZD1mdW5jdGlvbihlbmFibGUpe2VuYWJsZWQ9Ym9vbChlbmFibGUpO307bG9nNGphdmFzY3JpcHQuaXNFbmFibGVkPWZ1bmN0aW9uKCl7cmV0dXJuIGVuYWJsZWQ7fTt2YXIgdXNlVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzPXRydWU7bG9nNGphdmFzY3JpcHQuc2V0VGltZVN0YW1wc0luTWlsbGlzZWNvbmRzPWZ1bmN0aW9uKHRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcyl7dXNlVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzPWJvb2wodGltZVN0YW1wc0luTWlsbGlzZWNvbmRzKTt9O2xvZzRqYXZhc2NyaXB0LmlzVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHVzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kczt9O2xvZzRqYXZhc2NyaXB0LmV2YWxJblNjb3BlPWZ1bmN0aW9uKGV4cHIpe3JldHVybiBldmFsKGV4cHIpO307dmFyIHNob3dTdGFja1RyYWNlcz1mYWxzZTtsb2c0amF2YXNjcmlwdC5zZXRTaG93U3RhY2tUcmFjZXM9ZnVuY3Rpb24oc2hvdyl7c2hvd1N0YWNrVHJhY2VzPWJvb2woc2hvdyk7fTt2YXIgTGV2ZWw9ZnVuY3Rpb24obGV2ZWwsbmFtZSl7dGhpcy5sZXZlbD1sZXZlbDt0aGlzLm5hbWU9bmFtZTt9O0xldmVsLnByb3RvdHlwZT17dG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lO30sZXF1YWxzOmZ1bmN0aW9uKGxldmVsKXtyZXR1cm4gdGhpcy5sZXZlbD09bGV2ZWwubGV2ZWw7fSxpc0dyZWF0ZXJPckVxdWFsOmZ1bmN0aW9uKGxldmVsKXtyZXR1cm4gdGhpcy5sZXZlbD49bGV2ZWwubGV2ZWw7fX07TGV2ZWwuQUxMPW5ldyBMZXZlbChOdW1iZXIuTUlOX1ZBTFVFLCJBTEwiKTtMZXZlbC5UUkFDRT1uZXcgTGV2ZWwoMTAwMDAsIlRSQUNFIik7TGV2ZWwuREVCVUc9bmV3IExldmVsKDIwMDAwLCJERUJVRyIpO0xldmVsLklORk89bmV3IExldmVsKDMwMDAwLCJJTkZPIik7TGV2ZWwuV0FSTj1uZXcgTGV2ZWwoNDAwMDAsIldBUk4iKTtMZXZlbC5FUlJPUj1uZXcgTGV2ZWwoNTAwMDAsIkVSUk9SIik7TGV2ZWwuRkFUQUw9bmV3IExldmVsKDYwMDAwLCJGQVRBTCIpO0xldmVsLk9GRj1uZXcgTGV2ZWwoTnVtYmVyLk1BWF9WQUxVRSwiT0ZGIik7bG9nNGphdmFzY3JpcHQuTGV2ZWw9TGV2ZWw7ZnVuY3Rpb24gVGltZXIobmFtZSxsZXZlbCl7dGhpcy5uYW1lPW5hbWU7dGhpcy5sZXZlbD1pc1VuZGVmaW5lZChsZXZlbCk/TGV2ZWwuSU5GTzpsZXZlbDt0aGlzLnN0YXJ0PW5ldyBEYXRlKCk7fQ0KVGltZXIucHJvdG90eXBlLmdldEVsYXBzZWRUaW1lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpLXRoaXMuc3RhcnQuZ2V0VGltZSgpO307dmFyIGFub255bW91c0xvZ2dlck5hbWU9Ilthbm9ueW1vdXNdIjt2YXIgZGVmYXVsdExvZ2dlck5hbWU9IltkZWZhdWx0XSI7dmFyIG51bGxMb2dnZXJOYW1lPSJbbnVsbF0iO3ZhciByb290TG9nZ2VyTmFtZT0icm9vdCI7ZnVuY3Rpb24gTG9nZ2VyKG5hbWUpe3RoaXMubmFtZT1uYW1lO3RoaXMucGFyZW50PW51bGw7dGhpcy5jaGlsZHJlbj1bXTt2YXIgYXBwZW5kZXJzPVtdO3ZhciBsb2dnZXJMZXZlbD1udWxsO3ZhciBpc1Jvb3Q9KHRoaXMubmFtZT09PXJvb3RMb2dnZXJOYW1lKTt2YXIgaXNOdWxsPSh0aGlzLm5hbWU9PT1udWxsTG9nZ2VyTmFtZSk7dmFyIGFwcGVuZGVyQ2FjaGU9bnVsbDt2YXIgYXBwZW5kZXJDYWNoZUludmFsaWRhdGVkPWZhbHNlO3RoaXMuYWRkQ2hpbGQ9ZnVuY3Rpb24oY2hpbGRMb2dnZXIpe3RoaXMuY2hpbGRyZW4ucHVzaChjaGlsZExvZ2dlcik7Y2hpbGRMb2dnZXIucGFyZW50PXRoaXM7Y2hpbGRMb2dnZXIuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGUoKTt9O3ZhciBhZGRpdGl2ZT10cnVlO3RoaXMuZ2V0QWRkaXRpdml0eT1mdW5jdGlvbigpe3JldHVybiBhZGRpdGl2ZTt9O3RoaXMuc2V0QWRkaXRpdml0eT1mdW5jdGlvbihhZGRpdGl2aXR5KXt2YXIgdmFsdWVDaGFuZ2VkPShhZGRpdGl2ZSE9YWRkaXRpdml0eSk7YWRkaXRpdmU9YWRkaXRpdml0eTtpZih2YWx1ZUNoYW5nZWQpe3RoaXMuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGUoKTt9fTt0aGlzLmFkZEFwcGVuZGVyPWZ1bmN0aW9uKGFwcGVuZGVyKXtpZihpc051bGwpe2hhbmRsZUVycm9yKCJMb2dnZXIuYWRkQXBwZW5kZXI6IHlvdSBtYXkgbm90IGFkZCBhbiBhcHBlbmRlciB0byB0aGUgbnVsbCBsb2dnZXIiKTt9ZWxzZXtpZihhcHBlbmRlciBpbnN0YW5jZW9mIGxvZzRqYXZhc2NyaXB0LkFwcGVuZGVyKXtpZighYXJyYXlfY29udGFpbnMoYXBwZW5kZXJzLGFwcGVuZGVyKSl7YXBwZW5kZXJzLnB1c2goYXBwZW5kZXIpO2FwcGVuZGVyLnNldEFkZGVkVG9Mb2dnZXIodGhpcyk7dGhpcy5pbnZhbGlkYXRlQXBwZW5kZXJDYWNoZSgpO319ZWxzZXtoYW5kbGVFcnJvcigiTG9nZ2VyLmFkZEFwcGVuZGVyOiBhcHBlbmRlciBzdXBwbGllZCAoJyIrDQp0b1N0cihhcHBlbmRlcikrIicpIGlzIG5vdCBhIHN1YmNsYXNzIG9mIEFwcGVuZGVyIik7fX19O3RoaXMucmVtb3ZlQXBwZW5kZXI9ZnVuY3Rpb24oYXBwZW5kZXIpe2FycmF5X3JlbW92ZShhcHBlbmRlcnMsYXBwZW5kZXIpO2FwcGVuZGVyLnNldFJlbW92ZWRGcm9tTG9nZ2VyKHRoaXMpO3RoaXMuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGUoKTt9O3RoaXMucmVtb3ZlQWxsQXBwZW5kZXJzPWZ1bmN0aW9uKCl7dmFyIGFwcGVuZGVyQ291bnQ9YXBwZW5kZXJzLmxlbmd0aDtpZihhcHBlbmRlckNvdW50PjApe2Zvcih2YXIgaT0wO2k8YXBwZW5kZXJDb3VudDtpKyspe2FwcGVuZGVyc1tpXS5zZXRSZW1vdmVkRnJvbUxvZ2dlcih0aGlzKTt9DQphcHBlbmRlcnMubGVuZ3RoPTA7dGhpcy5pbnZhbGlkYXRlQXBwZW5kZXJDYWNoZSgpO319O3RoaXMuZ2V0RWZmZWN0aXZlQXBwZW5kZXJzPWZ1bmN0aW9uKCl7aWYoYXBwZW5kZXJDYWNoZT09PW51bGx8fGFwcGVuZGVyQ2FjaGVJbnZhbGlkYXRlZCl7dmFyIHBhcmVudEVmZmVjdGl2ZUFwcGVuZGVycz0oaXNSb290fHwhdGhpcy5nZXRBZGRpdGl2aXR5KCkpP1tdOnRoaXMucGFyZW50LmdldEVmZmVjdGl2ZUFwcGVuZGVycygpO2FwcGVuZGVyQ2FjaGU9cGFyZW50RWZmZWN0aXZlQXBwZW5kZXJzLmNvbmNhdChhcHBlbmRlcnMpO2FwcGVuZGVyQ2FjaGVJbnZhbGlkYXRlZD1mYWxzZTt9DQpyZXR1cm4gYXBwZW5kZXJDYWNoZTt9O3RoaXMuaW52YWxpZGF0ZUFwcGVuZGVyQ2FjaGU9ZnVuY3Rpb24oKXthcHBlbmRlckNhY2hlSW52YWxpZGF0ZWQ9dHJ1ZTtmb3IodmFyIGk9MCxsZW49dGhpcy5jaGlsZHJlbi5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmNoaWxkcmVuW2ldLmludmFsaWRhdGVBcHBlbmRlckNhY2hlKCk7fX07dGhpcy5sb2c9ZnVuY3Rpb24obGV2ZWwscGFyYW1zKXtpZihsZXZlbC5pc0dyZWF0ZXJPckVxdWFsKHRoaXMuZ2V0RWZmZWN0aXZlTGV2ZWwoKSkpe3ZhciBleGNlcHRpb247dmFyIGZpbmFsUGFyYW1JbmRleD1wYXJhbXMubGVuZ3RoLTE7dmFyIGxhc3RQYXJhbT1wYXJhbXNbcGFyYW1zLmxlbmd0aC0xXTtpZihwYXJhbXMubGVuZ3RoPjEmJmlzRXJyb3IobGFzdFBhcmFtKSl7ZXhjZXB0aW9uPWxhc3RQYXJhbTtmaW5hbFBhcmFtSW5kZXgtLTt9DQp2YXIgbWVzc2FnZXM9W107Zm9yKHZhciBpPTA7aTw9ZmluYWxQYXJhbUluZGV4O2krKyl7bWVzc2FnZXNbaV09cGFyYW1zW2ldO30NCnZhciBsb2dnaW5nRXZlbnQ9bmV3IExvZ2dpbmdFdmVudCh0aGlzLG5ldyBEYXRlKCksbGV2ZWwsbWVzc2FnZXMsZXhjZXB0aW9uKTt0aGlzLmNhbGxBcHBlbmRlcnMobG9nZ2luZ0V2ZW50KTt9fTt0aGlzLmNhbGxBcHBlbmRlcnM9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXt2YXIgZWZmZWN0aXZlQXBwZW5kZXJzPXRoaXMuZ2V0RWZmZWN0aXZlQXBwZW5kZXJzKCk7Zm9yKHZhciBpPTAsbGVuPWVmZmVjdGl2ZUFwcGVuZGVycy5sZW5ndGg7aTxsZW47aSsrKXtlZmZlY3RpdmVBcHBlbmRlcnNbaV0uZG9BcHBlbmQobG9nZ2luZ0V2ZW50KTt9fTt0aGlzLnNldExldmVsPWZ1bmN0aW9uKGxldmVsKXtpZihpc1Jvb3QmJmxldmVsPT09bnVsbCl7aGFuZGxlRXJyb3IoIkxvZ2dlci5zZXRMZXZlbDogeW91IGNhbm5vdCBzZXQgdGhlIGxldmVsIG9mIHRoZSByb290IGxvZ2dlciB0byBudWxsIik7fWVsc2UgaWYobGV2ZWwgaW5zdGFuY2VvZiBMZXZlbCl7bG9nZ2VyTGV2ZWw9bGV2ZWw7fWVsc2V7aGFuZGxlRXJyb3IoIkxvZ2dlci5zZXRMZXZlbDogbGV2ZWwgc3VwcGxpZWQgdG8gbG9nZ2VyICIrDQp0aGlzLm5hbWUrIiBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgbG9nNGphdmFzY3JpcHQuTGV2ZWwiKTt9fTt0aGlzLmdldExldmVsPWZ1bmN0aW9uKCl7cmV0dXJuIGxvZ2dlckxldmVsO307dGhpcy5nZXRFZmZlY3RpdmVMZXZlbD1mdW5jdGlvbigpe2Zvcih2YXIgbG9nZ2VyPXRoaXM7bG9nZ2VyIT09bnVsbDtsb2dnZXI9bG9nZ2VyLnBhcmVudCl7dmFyIGxldmVsPWxvZ2dlci5nZXRMZXZlbCgpO2lmKGxldmVsIT09bnVsbCl7cmV0dXJuIGxldmVsO319fTt0aGlzLmdyb3VwPWZ1bmN0aW9uKG5hbWUsaW5pdGlhbGx5RXhwYW5kZWQpe3ZhciBlZmZlY3RpdmVBcHBlbmRlcnM9dGhpcy5nZXRFZmZlY3RpdmVBcHBlbmRlcnMoKTtmb3IodmFyIGk9MCxsZW49ZWZmZWN0aXZlQXBwZW5kZXJzLmxlbmd0aDtpPGxlbjtpKyspe2VmZmVjdGl2ZUFwcGVuZGVyc1tpXS5ncm91cChuYW1lLGluaXRpYWxseUV4cGFuZGVkKTt9fTt0aGlzLmdyb3VwRW5kPWZ1bmN0aW9uKG5hbWUpe3ZhciBlZmZlY3RpdmVBcHBlbmRlcnM9dGhpcy5nZXRFZmZlY3RpdmVBcHBlbmRlcnMoKTtmb3IodmFyIGk9MCxsZW49ZWZmZWN0aXZlQXBwZW5kZXJzLmxlbmd0aDtpPGxlbjtpKyspe2VmZmVjdGl2ZUFwcGVuZGVyc1tpXS5ncm91cEVuZCgpO319O3ZhciB0aW1lcnM9e307dGhpcy50aW1lPWZ1bmN0aW9uKG5hbWUsbGV2ZWwpe2lmKGlzVW5kZWZpbmVkKG5hbWUpKXtoYW5kbGVFcnJvcigiTG9nZ2VyLnRpbWU6IGEgbmFtZSBmb3IgdGhlIHRpbWVyIG11c3QgYmUgc3VwcGxpZWQiKTt9ZWxzZSBpZihsZXZlbCYmIShsZXZlbCBpbnN0YW5jZW9mIExldmVsKSl7aGFuZGxlRXJyb3IoIkxvZ2dlci50aW1lOiBsZXZlbCBzdXBwbGllZCB0byB0aW1lciAiKw0KbmFtZSsiIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBsb2c0amF2YXNjcmlwdC5MZXZlbCIpO31lbHNle3RpbWVyc1tuYW1lXT1uZXcgVGltZXIobmFtZSxsZXZlbCk7fX07dGhpcy50aW1lRW5kPWZ1bmN0aW9uKG5hbWUpe2lmKGlzVW5kZWZpbmVkKG5hbWUpKXtoYW5kbGVFcnJvcigiTG9nZ2VyLnRpbWVFbmQ6IGEgbmFtZSBmb3IgdGhlIHRpbWVyIG11c3QgYmUgc3VwcGxpZWQiKTt9ZWxzZSBpZih0aW1lcnNbbmFtZV0pe3ZhciB0aW1lcj10aW1lcnNbbmFtZV07dmFyIG1pbGxpc2Vjb25kcz10aW1lci5nZXRFbGFwc2VkVGltZSgpO3RoaXMubG9nKHRpbWVyLmxldmVsLFsiVGltZXIgIit0b1N0cihuYW1lKSsiIGNvbXBsZXRlZCBpbiAiK21pbGxpc2Vjb25kcysibXMiXSk7ZGVsZXRlIHRpbWVyc1tuYW1lXTt9ZWxzZXtsb2dMb2cud2FybigiTG9nZ2VyLnRpbWVFbmQ6IG5vIHRpbWVyIGZvdW5kIHdpdGggbmFtZSAiK25hbWUpO319O3RoaXMuYXNzZXJ0PWZ1bmN0aW9uKGV4cHIpe2lmKCFleHByKXt2YXIgYXJncz1bXTtmb3IodmFyIGk9MSxsZW49YXJndW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe2FyZ3MucHVzaChhcmd1bWVudHNbaV0pO30NCmFyZ3M9KGFyZ3MubGVuZ3RoPjApP2FyZ3M6WyJBc3NlcnRpb24gRmFpbHVyZSJdO2FyZ3MucHVzaChuZXdMaW5lKTthcmdzLnB1c2goZXhwcik7dGhpcy5sb2coTGV2ZWwuRVJST1IsYXJncyk7fX07dGhpcy50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJMb2dnZXJbIit0aGlzLm5hbWUrIl0iO307fQ0KTG9nZ2VyLnByb3RvdHlwZT17dHJhY2U6ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5UUkFDRSxhcmd1bWVudHMpO30sZGVidWc6ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5ERUJVRyxhcmd1bWVudHMpO30saW5mbzpmdW5jdGlvbigpe3RoaXMubG9nKExldmVsLklORk8sYXJndW1lbnRzKTt9LHdhcm46ZnVuY3Rpb24oKXt0aGlzLmxvZyhMZXZlbC5XQVJOLGFyZ3VtZW50cyk7fSxlcnJvcjpmdW5jdGlvbigpe3RoaXMubG9nKExldmVsLkVSUk9SLGFyZ3VtZW50cyk7fSxmYXRhbDpmdW5jdGlvbigpe3RoaXMubG9nKExldmVsLkZBVEFMLGFyZ3VtZW50cyk7fSxpc0VuYWJsZWRGb3I6ZnVuY3Rpb24obGV2ZWwpe3JldHVybiBsZXZlbC5pc0dyZWF0ZXJPckVxdWFsKHRoaXMuZ2V0RWZmZWN0aXZlTGV2ZWwoKSk7fSxpc1RyYWNlRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5UUkFDRSk7fSxpc0RlYnVnRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5ERUJVRyk7fSxpc0luZm9FbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXNFbmFibGVkRm9yKExldmVsLklORk8pO30saXNXYXJuRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmlzRW5hYmxlZEZvcihMZXZlbC5XQVJOKTt9LGlzRXJyb3JFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXNFbmFibGVkRm9yKExldmVsLkVSUk9SKTt9LGlzRmF0YWxFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXNFbmFibGVkRm9yKExldmVsLkZBVEFMKTt9fTtMb2dnZXIucHJvdG90eXBlLnRyYWNlLmlzRW50cnlQb2ludD10cnVlO0xvZ2dlci5wcm90b3R5cGUuZGVidWcuaXNFbnRyeVBvaW50PXRydWU7TG9nZ2VyLnByb3RvdHlwZS5pbmZvLmlzRW50cnlQb2ludD10cnVlO0xvZ2dlci5wcm90b3R5cGUud2Fybi5pc0VudHJ5UG9pbnQ9dHJ1ZTtMb2dnZXIucHJvdG90eXBlLmVycm9yLmlzRW50cnlQb2ludD10cnVlO0xvZ2dlci5wcm90b3R5cGUuZmF0YWwuaXNFbnRyeVBvaW50PXRydWU7dmFyIGxvZ2dlcnM9e307dmFyIGxvZ2dlck5hbWVzPVtdO3ZhciBST09UX0xPR0dFUl9ERUZBVUxUX0xFVkVMPUxldmVsLkRFQlVHO3ZhciByb290TG9nZ2VyPW5ldyBMb2dnZXIocm9vdExvZ2dlck5hbWUpO3Jvb3RMb2dnZXIuc2V0TGV2ZWwoUk9PVF9MT0dHRVJfREVGQVVMVF9MRVZFTCk7bG9nNGphdmFzY3JpcHQuZ2V0Um9vdExvZ2dlcj1mdW5jdGlvbigpe3JldHVybiByb290TG9nZ2VyO307bG9nNGphdmFzY3JpcHQuZ2V0TG9nZ2VyPWZ1bmN0aW9uKGxvZ2dlck5hbWUpe2lmKCEodHlwZW9mIGxvZ2dlck5hbWU9PSJzdHJpbmciKSl7bG9nZ2VyTmFtZT1hbm9ueW1vdXNMb2dnZXJOYW1lO2xvZ0xvZy53YXJuKCJsb2c0amF2YXNjcmlwdC5nZXRMb2dnZXI6IG5vbi1zdHJpbmcgbG9nZ2VyIG5hbWUgIisNCnRvU3RyKGxvZ2dlck5hbWUpKyIgc3VwcGxpZWQsIHJldHVybmluZyBhbm9ueW1vdXMgbG9nZ2VyIik7fQ0KaWYobG9nZ2VyTmFtZT09cm9vdExvZ2dlck5hbWUpe2hhbmRsZUVycm9yKCJsb2c0amF2YXNjcmlwdC5nZXRMb2dnZXI6IHJvb3QgbG9nZ2VyIG1heSBub3QgYmUgb2J0YWluZWQgYnkgbmFtZSIpO30NCmlmKCFsb2dnZXJzW2xvZ2dlck5hbWVdKXt2YXIgbG9nZ2VyPW5ldyBMb2dnZXIobG9nZ2VyTmFtZSk7bG9nZ2Vyc1tsb2dnZXJOYW1lXT1sb2dnZXI7bG9nZ2VyTmFtZXMucHVzaChsb2dnZXJOYW1lKTt2YXIgbGFzdERvdEluZGV4PWxvZ2dlck5hbWUubGFzdEluZGV4T2YoIi4iKTt2YXIgcGFyZW50TG9nZ2VyO2lmKGxhc3REb3RJbmRleD4tMSl7dmFyIHBhcmVudExvZ2dlck5hbWU9bG9nZ2VyTmFtZS5zdWJzdHJpbmcoMCxsYXN0RG90SW5kZXgpO3BhcmVudExvZ2dlcj1sb2c0amF2YXNjcmlwdC5nZXRMb2dnZXIocGFyZW50TG9nZ2VyTmFtZSk7fWVsc2V7cGFyZW50TG9nZ2VyPXJvb3RMb2dnZXI7fQ0KcGFyZW50TG9nZ2VyLmFkZENoaWxkKGxvZ2dlcik7fQ0KcmV0dXJuIGxvZ2dlcnNbbG9nZ2VyTmFtZV07fTt2YXIgZGVmYXVsdExvZ2dlcj1udWxsO2xvZzRqYXZhc2NyaXB0LmdldERlZmF1bHRMb2dnZXI9ZnVuY3Rpb24oKXtpZighZGVmYXVsdExvZ2dlcil7ZGVmYXVsdExvZ2dlcj1sb2c0amF2YXNjcmlwdC5nZXRMb2dnZXIoZGVmYXVsdExvZ2dlck5hbWUpO3ZhciBhPW5ldyBsb2c0amF2YXNjcmlwdC5Qb3BVcEFwcGVuZGVyKCk7ZGVmYXVsdExvZ2dlci5hZGRBcHBlbmRlcihhKTt9DQpyZXR1cm4gZGVmYXVsdExvZ2dlcjt9O3ZhciBudWxsTG9nZ2VyPW51bGw7bG9nNGphdmFzY3JpcHQuZ2V0TnVsbExvZ2dlcj1mdW5jdGlvbigpe2lmKCFudWxsTG9nZ2VyKXtudWxsTG9nZ2VyPW5ldyBMb2dnZXIobnVsbExvZ2dlck5hbWUpO251bGxMb2dnZXIuc2V0TGV2ZWwoTGV2ZWwuT0ZGKTt9DQpyZXR1cm4gbnVsbExvZ2dlcjt9O2xvZzRqYXZhc2NyaXB0LnJlc2V0Q29uZmlndXJhdGlvbj1mdW5jdGlvbigpe3Jvb3RMb2dnZXIuc2V0TGV2ZWwoUk9PVF9MT0dHRVJfREVGQVVMVF9MRVZFTCk7bG9nZ2Vycz17fTt9O3ZhciBMb2dnaW5nRXZlbnQ9ZnVuY3Rpb24obG9nZ2VyLHRpbWVTdGFtcCxsZXZlbCxtZXNzYWdlcyxleGNlcHRpb24pe3RoaXMubG9nZ2VyPWxvZ2dlcjt0aGlzLnRpbWVTdGFtcD10aW1lU3RhbXA7dGhpcy50aW1lU3RhbXBJbk1pbGxpc2Vjb25kcz10aW1lU3RhbXAuZ2V0VGltZSgpO3RoaXMudGltZVN0YW1wSW5TZWNvbmRzPU1hdGguZmxvb3IodGhpcy50aW1lU3RhbXBJbk1pbGxpc2Vjb25kcy8xMDAwKTt0aGlzLm1pbGxpc2Vjb25kcz10aGlzLnRpbWVTdGFtcC5nZXRNaWxsaXNlY29uZHMoKTt0aGlzLmxldmVsPWxldmVsO3RoaXMubWVzc2FnZXM9bWVzc2FnZXM7dGhpcy5leGNlcHRpb249ZXhjZXB0aW9uO307TG9nZ2luZ0V2ZW50LnByb3RvdHlwZT17Z2V0VGhyb3dhYmxlU3RyUmVwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXhjZXB0aW9uP2dldEV4Y2VwdGlvblN0cmluZ1JlcCh0aGlzLmV4Y2VwdGlvbik6IiI7fSxnZXRDb21iaW5lZE1lc3NhZ2VzOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMubWVzc2FnZXMubGVuZ3RoPT0xKT90aGlzLm1lc3NhZ2VzWzBdOnRoaXMubWVzc2FnZXMuam9pbihuZXdMaW5lKTt9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIkxvZ2dpbmdFdmVudFsiK3RoaXMubGV2ZWwrIl0iO319O2xvZzRqYXZhc2NyaXB0LkxvZ2dpbmdFdmVudD1Mb2dnaW5nRXZlbnQ7dmFyIExheW91dD1mdW5jdGlvbigpe307TGF5b3V0LnByb3RvdHlwZT17ZGVmYXVsdHM6e2xvZ2dlcktleToibG9nZ2VyIix0aW1lU3RhbXBLZXk6InRpbWVzdGFtcCIsbWlsbGlzZWNvbmRzS2V5OiJtaWxsaXNlY29uZHMiLGxldmVsS2V5OiJsZXZlbCIsbWVzc2FnZUtleToibWVzc2FnZSIsZXhjZXB0aW9uS2V5OiJleGNlcHRpb24iLHVybEtleToidXJsIn0sbG9nZ2VyS2V5OiJsb2dnZXIiLHRpbWVTdGFtcEtleToidGltZXN0YW1wIixtaWxsaXNlY29uZHNLZXk6Im1pbGxpc2Vjb25kcyIsbGV2ZWxLZXk6ImxldmVsIixtZXNzYWdlS2V5OiJtZXNzYWdlIixleGNlcHRpb25LZXk6ImV4Y2VwdGlvbiIsdXJsS2V5OiJ1cmwiLGJhdGNoSGVhZGVyOiIiLGJhdGNoRm9vdGVyOiIiLGJhdGNoU2VwYXJhdG9yOiIiLHJldHVybnNQb3N0RGF0YTpmYWxzZSxvdmVycmlkZVRpbWVTdGFtcHNTZXR0aW5nOmZhbHNlLHVzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kczpudWxsLGZvcm1hdDpmdW5jdGlvbihsb2dnaW5nRXZlbnQpe2hhbmRsZUVycm9yKCJMYXlvdXQuZm9ybWF0OiBsYXlvdXQgc3VwcGxpZWQgaGFzIG5vIGZvcm1hdCgpIG1ldGhvZCIpO30saWdub3Jlc1Rocm93YWJsZTpmdW5jdGlvbigpe2hhbmRsZUVycm9yKCJMYXlvdXQuaWdub3Jlc1Rocm93YWJsZTogbGF5b3V0IHN1cHBsaWVkIGhhcyBubyBpZ25vcmVzVGhyb3dhYmxlKCkgbWV0aG9kIik7fSxnZXRDb250ZW50VHlwZTpmdW5jdGlvbigpe3JldHVybiJ0ZXh0L3BsYWluIjt9LGFsbG93QmF0Y2hpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZTt9LHNldFRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kczpmdW5jdGlvbih0aW1lU3RhbXBzSW5NaWxsaXNlY29uZHMpe3RoaXMub3ZlcnJpZGVUaW1lU3RhbXBzU2V0dGluZz10cnVlO3RoaXMudXNlVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzPWJvb2wodGltZVN0YW1wc0luTWlsbGlzZWNvbmRzKTt9LGlzVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3ZlcnJpZGVUaW1lU3RhbXBzU2V0dGluZz90aGlzLnVzZVRpbWVTdGFtcHNJbk1pbGxpc2Vjb25kczp1c2VUaW1lU3RhbXBzSW5NaWxsaXNlY29uZHM7fSxnZXRUaW1lU3RhbXBWYWx1ZTpmdW5jdGlvbihsb2dnaW5nRXZlbnQpe3JldHVybiB0aGlzLmlzVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzKCk/bG9nZ2luZ0V2ZW50LnRpbWVTdGFtcEluTWlsbGlzZWNvbmRzOmxvZ2dpbmdFdmVudC50aW1lU3RhbXBJblNlY29uZHM7fSxnZXREYXRhVmFsdWVzOmZ1bmN0aW9uKGxvZ2dpbmdFdmVudCxjb21iaW5lTWVzc2FnZXMpe3ZhciBkYXRhVmFsdWVzPVtbdGhpcy5sb2dnZXJLZXksbG9nZ2luZ0V2ZW50LmxvZ2dlci5uYW1lXSxbdGhpcy50aW1lU3RhbXBLZXksdGhpcy5nZXRUaW1lU3RhbXBWYWx1ZShsb2dnaW5nRXZlbnQpXSxbdGhpcy5sZXZlbEtleSxsb2dnaW5nRXZlbnQubGV2ZWwubmFtZV0sW3RoaXMudXJsS2V5LHdpbmRvdy5sb2NhdGlvbi5ocmVmXSxbdGhpcy5tZXNzYWdlS2V5LGNvbWJpbmVNZXNzYWdlcz9sb2dnaW5nRXZlbnQuZ2V0Q29tYmluZWRNZXNzYWdlcygpOmxvZ2dpbmdFdmVudC5tZXNzYWdlc11dO2lmKCF0aGlzLmlzVGltZVN0YW1wc0luTWlsbGlzZWNvbmRzKCkpe2RhdGFWYWx1ZXMucHVzaChbdGhpcy5taWxsaXNlY29uZHNLZXksbG9nZ2luZ0V2ZW50Lm1pbGxpc2Vjb25kc10pO30NCmlmKGxvZ2dpbmdFdmVudC5leGNlcHRpb24pe2RhdGFWYWx1ZXMucHVzaChbdGhpcy5leGNlcHRpb25LZXksZ2V0RXhjZXB0aW9uU3RyaW5nUmVwKGxvZ2dpbmdFdmVudC5leGNlcHRpb24pXSk7fQ0KaWYodGhpcy5oYXNDdXN0b21GaWVsZHMoKSl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuY3VzdG9tRmllbGRzLmxlbmd0aDtpPGxlbjtpKyspe3ZhciB2YWw9dGhpcy5jdXN0b21GaWVsZHNbaV0udmFsdWU7aWYodHlwZW9mIHZhbD09PSJmdW5jdGlvbiIpe3ZhbD12YWwodGhpcyxsb2dnaW5nRXZlbnQpO30NCmRhdGFWYWx1ZXMucHVzaChbdGhpcy5jdXN0b21GaWVsZHNbaV0ubmFtZSx2YWxdKTt9fQ0KcmV0dXJuIGRhdGFWYWx1ZXM7fSxzZXRLZXlzOmZ1bmN0aW9uKGxvZ2dlcktleSx0aW1lU3RhbXBLZXksbGV2ZWxLZXksbWVzc2FnZUtleSxleGNlcHRpb25LZXksdXJsS2V5LG1pbGxpc2Vjb25kc0tleSl7dGhpcy5sb2dnZXJLZXk9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbShsb2dnZXJLZXksdGhpcy5kZWZhdWx0cy5sb2dnZXJLZXkpO3RoaXMudGltZVN0YW1wS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0odGltZVN0YW1wS2V5LHRoaXMuZGVmYXVsdHMudGltZVN0YW1wS2V5KTt0aGlzLmxldmVsS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0obGV2ZWxLZXksdGhpcy5kZWZhdWx0cy5sZXZlbEtleSk7dGhpcy5tZXNzYWdlS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0obWVzc2FnZUtleSx0aGlzLmRlZmF1bHRzLm1lc3NhZ2VLZXkpO3RoaXMuZXhjZXB0aW9uS2V5PWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0oZXhjZXB0aW9uS2V5LHRoaXMuZGVmYXVsdHMuZXhjZXB0aW9uS2V5KTt0aGlzLnVybEtleT1leHRyYWN0U3RyaW5nRnJvbVBhcmFtKHVybEtleSx0aGlzLmRlZmF1bHRzLnVybEtleSk7dGhpcy5taWxsaXNlY29uZHNLZXk9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbShtaWxsaXNlY29uZHNLZXksdGhpcy5kZWZhdWx0cy5taWxsaXNlY29uZHNLZXkpO30sc2V0Q3VzdG9tRmllbGQ6ZnVuY3Rpb24obmFtZSx2YWx1ZSl7dmFyIGZpZWxkVXBkYXRlZD1mYWxzZTtmb3IodmFyIGk9MCxsZW49dGhpcy5jdXN0b21GaWVsZHMubGVuZ3RoO2k8bGVuO2krKyl7aWYodGhpcy5jdXN0b21GaWVsZHNbaV0ubmFtZT09PW5hbWUpe3RoaXMuY3VzdG9tRmllbGRzW2ldLnZhbHVlPXZhbHVlO2ZpZWxkVXBkYXRlZD10cnVlO319DQppZighZmllbGRVcGRhdGVkKXt0aGlzLmN1c3RvbUZpZWxkcy5wdXNoKHsibmFtZSI6bmFtZSwidmFsdWUiOnZhbHVlfSk7fX0saGFzQ3VzdG9tRmllbGRzOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuY3VzdG9tRmllbGRzLmxlbmd0aD4wKTt9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7aGFuZGxlRXJyb3IoIkxheW91dC50b1N0cmluZzogYWxsIGxheW91dHMgbXVzdCBvdmVycmlkZSB0aGlzIG1ldGhvZCIpO319O2xvZzRqYXZhc2NyaXB0LkxheW91dD1MYXlvdXQ7dmFyIEFwcGVuZGVyPWZ1bmN0aW9uKCl7fTtBcHBlbmRlci5wcm90b3R5cGU9bmV3IEV2ZW50U3VwcG9ydCgpO0FwcGVuZGVyLnByb3RvdHlwZS5sYXlvdXQ9bmV3IFBhdHRlcm5MYXlvdXQoKTtBcHBlbmRlci5wcm90b3R5cGUudGhyZXNob2xkPUxldmVsLkFMTDtBcHBlbmRlci5wcm90b3R5cGUubG9nZ2Vycz1bXTtBcHBlbmRlci5wcm90b3R5cGUuZG9BcHBlbmQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtpZihlbmFibGVkJiZsb2dnaW5nRXZlbnQubGV2ZWwubGV2ZWw+PXRoaXMudGhyZXNob2xkLmxldmVsKXt0aGlzLmFwcGVuZChsb2dnaW5nRXZlbnQpO319O0FwcGVuZGVyLnByb3RvdHlwZS5hcHBlbmQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXt9O0FwcGVuZGVyLnByb3RvdHlwZS5zZXRMYXlvdXQ9ZnVuY3Rpb24obGF5b3V0KXtpZihsYXlvdXQgaW5zdGFuY2VvZiBMYXlvdXQpe3RoaXMubGF5b3V0PWxheW91dDt9ZWxzZXtoYW5kbGVFcnJvcigiQXBwZW5kZXIuc2V0TGF5b3V0OiBsYXlvdXQgc3VwcGxpZWQgdG8gIisNCnRoaXMudG9TdHJpbmcoKSsiIGlzIG5vdCBhIHN1YmNsYXNzIG9mIExheW91dCIpO319O0FwcGVuZGVyLnByb3RvdHlwZS5nZXRMYXlvdXQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sYXlvdXQ7fTtBcHBlbmRlci5wcm90b3R5cGUuc2V0VGhyZXNob2xkPWZ1bmN0aW9uKHRocmVzaG9sZCl7aWYodGhyZXNob2xkIGluc3RhbmNlb2YgTGV2ZWwpe3RoaXMudGhyZXNob2xkPXRocmVzaG9sZDt9ZWxzZXtoYW5kbGVFcnJvcigiQXBwZW5kZXIuc2V0VGhyZXNob2xkOiB0aHJlc2hvbGQgc3VwcGxpZWQgdG8gIisNCnRoaXMudG9TdHJpbmcoKSsiIGlzIG5vdCBhIHN1YmNsYXNzIG9mIExldmVsIik7fX07QXBwZW5kZXIucHJvdG90eXBlLmdldFRocmVzaG9sZD1mdW5jdGlvbigpe3JldHVybiB0aGlzLnRocmVzaG9sZDt9O0FwcGVuZGVyLnByb3RvdHlwZS5zZXRBZGRlZFRvTG9nZ2VyPWZ1bmN0aW9uKGxvZ2dlcil7dGhpcy5sb2dnZXJzLnB1c2gobG9nZ2VyKTt9O0FwcGVuZGVyLnByb3RvdHlwZS5zZXRSZW1vdmVkRnJvbUxvZ2dlcj1mdW5jdGlvbihsb2dnZXIpe2FycmF5X3JlbW92ZSh0aGlzLmxvZ2dlcnMsbG9nZ2VyKTt9O0FwcGVuZGVyLnByb3RvdHlwZS5ncm91cD1lbXB0eUZ1bmN0aW9uO0FwcGVuZGVyLnByb3RvdHlwZS5ncm91cEVuZD1lbXB0eUZ1bmN0aW9uO0FwcGVuZGVyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe2hhbmRsZUVycm9yKCJBcHBlbmRlci50b1N0cmluZzogYWxsIGFwcGVuZGVycyBtdXN0IG92ZXJyaWRlIHRoaXMgbWV0aG9kIik7fTtsb2c0amF2YXNjcmlwdC5BcHBlbmRlcj1BcHBlbmRlcjtmdW5jdGlvbiBTaW1wbGVMYXlvdXQoKXt0aGlzLmN1c3RvbUZpZWxkcz1bXTt9DQpTaW1wbGVMYXlvdXQucHJvdG90eXBlPW5ldyBMYXlvdXQoKTtTaW1wbGVMYXlvdXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3JldHVybiBsb2dnaW5nRXZlbnQubGV2ZWwubmFtZSsiIC0gIitsb2dnaW5nRXZlbnQuZ2V0Q29tYmluZWRNZXNzYWdlcygpO307U2ltcGxlTGF5b3V0LnByb3RvdHlwZS5pZ25vcmVzVGhyb3dhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHRydWU7fTtTaW1wbGVMYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIlNpbXBsZUxheW91dCI7fTtsb2c0amF2YXNjcmlwdC5TaW1wbGVMYXlvdXQ9U2ltcGxlTGF5b3V0O2Z1bmN0aW9uIE51bGxMYXlvdXQoKXt0aGlzLmN1c3RvbUZpZWxkcz1bXTt9DQpOdWxsTGF5b3V0LnByb3RvdHlwZT1uZXcgTGF5b3V0KCk7TnVsbExheW91dC5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7cmV0dXJuIGxvZ2dpbmdFdmVudC5tZXNzYWdlczt9O051bGxMYXlvdXQucHJvdG90eXBlLmlnbm9yZXNUaHJvd2FibGU9ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZTt9O051bGxMYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIk51bGxMYXlvdXQiO307bG9nNGphdmFzY3JpcHQuTnVsbExheW91dD1OdWxsTGF5b3V0O2Z1bmN0aW9uIFhtbExheW91dChjb21iaW5lTWVzc2FnZXMpe3RoaXMuY29tYmluZU1lc3NhZ2VzPWV4dHJhY3RCb29sZWFuRnJvbVBhcmFtKGNvbWJpbmVNZXNzYWdlcyx0cnVlKTt0aGlzLmN1c3RvbUZpZWxkcz1bXTt9DQpYbWxMYXlvdXQucHJvdG90eXBlPW5ldyBMYXlvdXQoKTtYbWxMYXlvdXQucHJvdG90eXBlLmlzQ29tYmluZWRNZXNzYWdlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbWJpbmVNZXNzYWdlczt9O1htbExheW91dC5wcm90b3R5cGUuZ2V0Q29udGVudFR5cGU9ZnVuY3Rpb24oKXtyZXR1cm4idGV4dC94bWwiO307WG1sTGF5b3V0LnByb3RvdHlwZS5lc2NhcGVDZGF0YT1mdW5jdGlvbihzdHIpe3JldHVybiBzdHIucmVwbGFjZSgvXF1cXT4vLCJdXT5dXSZndDs8IVtDREFUQVsiKTt9O1htbExheW91dC5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIGxheW91dD10aGlzO3ZhciBpLGxlbjtmdW5jdGlvbiBmb3JtYXRNZXNzYWdlKG1lc3NhZ2Upe21lc3NhZ2U9KHR5cGVvZiBtZXNzYWdlPT09InN0cmluZyIpP21lc3NhZ2U6dG9TdHIobWVzc2FnZSk7cmV0dXJuIjxsb2c0amF2YXNjcmlwdDptZXNzYWdlPjwhW0NEQVRBWyIrDQpsYXlvdXQuZXNjYXBlQ2RhdGEobWVzc2FnZSkrIl1dPjwvbG9nNGphdmFzY3JpcHQ6bWVzc2FnZT4iO30NCnZhciBzdHI9Ijxsb2c0amF2YXNjcmlwdDpldmVudCBsb2dnZXI9XCIiK2xvZ2dpbmdFdmVudC5sb2dnZXIubmFtZSsiXCIgdGltZXN0YW1wPVwiIit0aGlzLmdldFRpbWVTdGFtcFZhbHVlKGxvZ2dpbmdFdmVudCkrIlwiIjtpZighdGhpcy5pc1RpbWVTdGFtcHNJbk1pbGxpc2Vjb25kcygpKXtzdHIrPSIgbWlsbGlzZWNvbmRzPVwiIitsb2dnaW5nRXZlbnQubWlsbGlzZWNvbmRzKyJcIiI7fQ0Kc3RyKz0iIGxldmVsPVwiIitsb2dnaW5nRXZlbnQubGV2ZWwubmFtZSsiXCI+IituZXdMaW5lO2lmKHRoaXMuY29tYmluZU1lc3NhZ2VzKXtzdHIrPWZvcm1hdE1lc3NhZ2UobG9nZ2luZ0V2ZW50LmdldENvbWJpbmVkTWVzc2FnZXMoKSk7fWVsc2V7c3RyKz0iPGxvZzRqYXZhc2NyaXB0Om1lc3NhZ2VzPiIrbmV3TGluZTtmb3IoaT0wLGxlbj1sb2dnaW5nRXZlbnQubWVzc2FnZXMubGVuZ3RoO2k8bGVuO2krKyl7c3RyKz1mb3JtYXRNZXNzYWdlKGxvZ2dpbmdFdmVudC5tZXNzYWdlc1tpXSkrbmV3TGluZTt9DQpzdHIrPSI8L2xvZzRqYXZhc2NyaXB0Om1lc3NhZ2VzPiIrbmV3TGluZTt9DQppZih0aGlzLmhhc0N1c3RvbUZpZWxkcygpKXtmb3IoaT0wLGxlbj10aGlzLmN1c3RvbUZpZWxkcy5sZW5ndGg7aTxsZW47aSsrKXtzdHIrPSI8bG9nNGphdmFzY3JpcHQ6Y3VzdG9tZmllbGQgbmFtZT1cIiIrDQp0aGlzLmN1c3RvbUZpZWxkc1tpXS5uYW1lKyJcIj48IVtDREFUQVsiKw0KdGhpcy5jdXN0b21GaWVsZHNbaV0udmFsdWUudG9TdHJpbmcoKSsiXV0+PC9sb2c0amF2YXNjcmlwdDpjdXN0b21maWVsZD4iK25ld0xpbmU7fX0NCmlmKGxvZ2dpbmdFdmVudC5leGNlcHRpb24pe3N0cis9Ijxsb2c0amF2YXNjcmlwdDpleGNlcHRpb24+PCFbQ0RBVEFbIisNCmdldEV4Y2VwdGlvblN0cmluZ1JlcChsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKSsiXV0+PC9sb2c0amF2YXNjcmlwdDpleGNlcHRpb24+IituZXdMaW5lO30NCnN0cis9IjwvbG9nNGphdmFzY3JpcHQ6ZXZlbnQ+IituZXdMaW5lK25ld0xpbmU7cmV0dXJuIHN0cjt9O1htbExheW91dC5wcm90b3R5cGUuaWdub3Jlc1Rocm93YWJsZT1mdW5jdGlvbigpe3JldHVybiBmYWxzZTt9O1htbExheW91dC5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iWG1sTGF5b3V0Ijt9O2xvZzRqYXZhc2NyaXB0LlhtbExheW91dD1YbWxMYXlvdXQ7ZnVuY3Rpb24gZXNjYXBlTmV3TGluZXMoc3RyKXtyZXR1cm4gc3RyLnJlcGxhY2UoL1xyXG58XHJ8XG4vZywiXFxyXFxuIik7fQ0KZnVuY3Rpb24gSnNvbkxheW91dChyZWFkYWJsZSxjb21iaW5lTWVzc2FnZXMpe3RoaXMucmVhZGFibGU9ZXh0cmFjdEJvb2xlYW5Gcm9tUGFyYW0ocmVhZGFibGUsZmFsc2UpO3RoaXMuY29tYmluZU1lc3NhZ2VzPWV4dHJhY3RCb29sZWFuRnJvbVBhcmFtKGNvbWJpbmVNZXNzYWdlcyx0cnVlKTt0aGlzLmJhdGNoSGVhZGVyPXRoaXMucmVhZGFibGU/IlsiK25ld0xpbmU6IlsiO3RoaXMuYmF0Y2hGb290ZXI9dGhpcy5yZWFkYWJsZT8iXSIrbmV3TGluZToiXSI7dGhpcy5iYXRjaFNlcGFyYXRvcj10aGlzLnJlYWRhYmxlPyIsIituZXdMaW5lOiIsIjt0aGlzLnNldEtleXMoKTt0aGlzLmNvbG9uPXRoaXMucmVhZGFibGU/IjogIjoiOiI7dGhpcy50YWI9dGhpcy5yZWFkYWJsZT8iXHQiOiIiO3RoaXMubGluZUJyZWFrPXRoaXMucmVhZGFibGU/bmV3TGluZToiIjt0aGlzLmN1c3RvbUZpZWxkcz1bXTt9DQpKc29uTGF5b3V0LnByb3RvdHlwZT1uZXcgTGF5b3V0KCk7SnNvbkxheW91dC5wcm90b3R5cGUuaXNSZWFkYWJsZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJlYWRhYmxlO307SnNvbkxheW91dC5wcm90b3R5cGUuaXNDb21iaW5lZE1lc3NhZ2VzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29tYmluZU1lc3NhZ2VzO307SnNvbkxheW91dC5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIGxheW91dD10aGlzO3ZhciBkYXRhVmFsdWVzPXRoaXMuZ2V0RGF0YVZhbHVlcyhsb2dnaW5nRXZlbnQsdGhpcy5jb21iaW5lTWVzc2FnZXMpO3ZhciBzdHI9InsiK3RoaXMubGluZUJyZWFrO3ZhciBpO2Z1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbCxwcmVmaXgsZXhwYW5kKXt2YXIgZm9ybWF0dGVkVmFsdWU7dmFyIHZhbFR5cGU9dHlwZW9mIHZhbDtpZih2YWwgaW5zdGFuY2VvZiBEYXRlKXtmb3JtYXR0ZWRWYWx1ZT1TdHJpbmcodmFsLmdldFRpbWUoKSk7fWVsc2UgaWYoZXhwYW5kJiYodmFsIGluc3RhbmNlb2YgQXJyYXkpKXtmb3JtYXR0ZWRWYWx1ZT0iWyIrbGF5b3V0LmxpbmVCcmVhaztmb3IoaT0wLGxlbj12YWwubGVuZ3RoO2k8bGVuO2krKyl7dmFyIGNoaWxkUHJlZml4PXByZWZpeCtsYXlvdXQudGFiO2Zvcm1hdHRlZFZhbHVlKz1jaGlsZFByZWZpeCtmb3JtYXRWYWx1ZSh2YWxbaV0sY2hpbGRQcmVmaXgsZmFsc2UpO2lmKGk8dmFsLmxlbmd0aC0xKXtmb3JtYXR0ZWRWYWx1ZSs9IiwiO30NCmZvcm1hdHRlZFZhbHVlKz1sYXlvdXQubGluZUJyZWFrO30NCmZvcm1hdHRlZFZhbHVlKz1wcmVmaXgrIl0iO31lbHNlIGlmKHZhbFR5cGUhPT0ibnVtYmVyIiYmdmFsVHlwZSE9PSJib29sZWFuIil7Zm9ybWF0dGVkVmFsdWU9IlwiIitlc2NhcGVOZXdMaW5lcyh0b1N0cih2YWwpLnJlcGxhY2UoL1wiL2csIlxcXCIiKSkrIlwiIjt9ZWxzZXtmb3JtYXR0ZWRWYWx1ZT12YWw7fQ0KcmV0dXJuIGZvcm1hdHRlZFZhbHVlO30NCmZvcihpPTAsbGVuPWRhdGFWYWx1ZXMubGVuZ3RoO2k8bGVuO2krKyl7c3RyKz10aGlzLnRhYisiXCIiK2RhdGFWYWx1ZXNbaV1bMF0rIlwiIit0aGlzLmNvbG9uK2Zvcm1hdFZhbHVlKGRhdGFWYWx1ZXNbaV1bMV0sdGhpcy50YWIsdHJ1ZSk7aWYoaTxkYXRhVmFsdWVzLmxlbmd0aC0xKXtzdHIrPSIsIjt9DQpzdHIrPXRoaXMubGluZUJyZWFrO30NCnN0cis9In0iK3RoaXMubGluZUJyZWFrO3JldHVybiBzdHI7fTtKc29uTGF5b3V0LnByb3RvdHlwZS5pZ25vcmVzVGhyb3dhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlO307SnNvbkxheW91dC5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iSnNvbkxheW91dCI7fTtKc29uTGF5b3V0LnByb3RvdHlwZS5nZXRDb250ZW50VHlwZT1mdW5jdGlvbigpe3JldHVybiJhcHBsaWNhdGlvbi9qc29uIjt9O2xvZzRqYXZhc2NyaXB0Lkpzb25MYXlvdXQ9SnNvbkxheW91dDtmdW5jdGlvbiBIdHRwUG9zdERhdGFMYXlvdXQoKXt0aGlzLnNldEtleXMoKTt0aGlzLmN1c3RvbUZpZWxkcz1bXTt0aGlzLnJldHVybnNQb3N0RGF0YT10cnVlO30NCkh0dHBQb3N0RGF0YUxheW91dC5wcm90b3R5cGU9bmV3IExheW91dCgpO0h0dHBQb3N0RGF0YUxheW91dC5wcm90b3R5cGUuYWxsb3dCYXRjaGluZz1mdW5jdGlvbigpe3JldHVybiBmYWxzZTt9O0h0dHBQb3N0RGF0YUxheW91dC5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIGRhdGFWYWx1ZXM9dGhpcy5nZXREYXRhVmFsdWVzKGxvZ2dpbmdFdmVudCk7dmFyIHF1ZXJ5Qml0cz1bXTtmb3IodmFyIGk9MCxsZW49ZGF0YVZhbHVlcy5sZW5ndGg7aTxsZW47aSsrKXt2YXIgdmFsPShkYXRhVmFsdWVzW2ldWzFdaW5zdGFuY2VvZiBEYXRlKT9TdHJpbmcoZGF0YVZhbHVlc1tpXVsxXS5nZXRUaW1lKCkpOmRhdGFWYWx1ZXNbaV1bMV07cXVlcnlCaXRzLnB1c2godXJsRW5jb2RlKGRhdGFWYWx1ZXNbaV1bMF0pKyI9Iit1cmxFbmNvZGUodmFsKSk7fQ0KcmV0dXJuIHF1ZXJ5Qml0cy5qb2luKCImIik7fTtIdHRwUG9zdERhdGFMYXlvdXQucHJvdG90eXBlLmlnbm9yZXNUaHJvd2FibGU9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtyZXR1cm4gZmFsc2U7fTtIdHRwUG9zdERhdGFMYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkh0dHBQb3N0RGF0YUxheW91dCI7fTtsb2c0amF2YXNjcmlwdC5IdHRwUG9zdERhdGFMYXlvdXQ9SHR0cFBvc3REYXRhTGF5b3V0O2Z1bmN0aW9uIGZvcm1hdE9iamVjdEV4cGFuc2lvbihvYmosZGVwdGgsaW5kZW50YXRpb24pe3ZhciBvYmplY3RzRXhwYW5kZWQ9W107ZnVuY3Rpb24gZG9Gb3JtYXQob2JqLGRlcHRoLGluZGVudGF0aW9uKXt2YXIgaSxqLGxlbixjaGlsZERlcHRoLGNoaWxkSW5kZW50YXRpb24sY2hpbGRMaW5lcyxleHBhbnNpb24sY2hpbGRFeHBhbnNpb247aWYoIWluZGVudGF0aW9uKXtpbmRlbnRhdGlvbj0iIjt9DQpmdW5jdGlvbiBmb3JtYXRTdHJpbmcodGV4dCl7dmFyIGxpbmVzPXNwbGl0SW50b0xpbmVzKHRleHQpO2Zvcih2YXIgaj0xLGpMZW49bGluZXMubGVuZ3RoO2o8akxlbjtqKyspe2xpbmVzW2pdPWluZGVudGF0aW9uK2xpbmVzW2pdO30NCnJldHVybiBsaW5lcy5qb2luKG5ld0xpbmUpO30NCmlmKG9iaj09PW51bGwpe3JldHVybiJudWxsIjt9ZWxzZSBpZih0eXBlb2Ygb2JqPT0idW5kZWZpbmVkIil7cmV0dXJuInVuZGVmaW5lZCI7fWVsc2UgaWYodHlwZW9mIG9iaj09InN0cmluZyIpe3JldHVybiBmb3JtYXRTdHJpbmcob2JqKTt9ZWxzZSBpZih0eXBlb2Ygb2JqPT0ib2JqZWN0IiYmYXJyYXlfY29udGFpbnMob2JqZWN0c0V4cGFuZGVkLG9iaikpe3RyeXtleHBhbnNpb249dG9TdHIob2JqKTt9Y2F0Y2goZXgpe2V4cGFuc2lvbj0iRXJyb3IgZm9ybWF0dGluZyBwcm9wZXJ0eS4gRGV0YWlsczogIitnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpO30NCnJldHVybiBleHBhbnNpb24rIiBbYWxyZWFkeSBleHBhbmRlZF0iO31lbHNlIGlmKChvYmogaW5zdGFuY2VvZiBBcnJheSkmJmRlcHRoPjApe29iamVjdHNFeHBhbmRlZC5wdXNoKG9iaik7ZXhwYW5zaW9uPSJbIituZXdMaW5lO2NoaWxkRGVwdGg9ZGVwdGgtMTtjaGlsZEluZGVudGF0aW9uPWluZGVudGF0aW9uKyIgICI7Y2hpbGRMaW5lcz1bXTtmb3IoaT0wLGxlbj1vYmoubGVuZ3RoO2k8bGVuO2krKyl7dHJ5e2NoaWxkRXhwYW5zaW9uPWRvRm9ybWF0KG9ialtpXSxjaGlsZERlcHRoLGNoaWxkSW5kZW50YXRpb24pO2NoaWxkTGluZXMucHVzaChjaGlsZEluZGVudGF0aW9uK2NoaWxkRXhwYW5zaW9uKTt9Y2F0Y2goZXgpe2NoaWxkTGluZXMucHVzaChjaGlsZEluZGVudGF0aW9uKyJFcnJvciBmb3JtYXR0aW5nIGFycmF5IG1lbWJlci4gRGV0YWlsczogIisNCmdldEV4Y2VwdGlvblN0cmluZ1JlcChleCkrIiIpO319DQpleHBhbnNpb24rPWNoaWxkTGluZXMuam9pbigiLCIrbmV3TGluZSkrbmV3TGluZStpbmRlbnRhdGlvbisiXSI7cmV0dXJuIGV4cGFuc2lvbjt9ZWxzZSBpZih0eXBlb2Ygb2JqPT0ib2JqZWN0IiYmZGVwdGg+MCl7b2JqZWN0c0V4cGFuZGVkLnB1c2gob2JqKTtleHBhbnNpb249InsiK25ld0xpbmU7Y2hpbGREZXB0aD1kZXB0aC0xO2NoaWxkSW5kZW50YXRpb249aW5kZW50YXRpb24rIiAgIjtjaGlsZExpbmVzPVtdO2ZvcihpIGluIG9iail7dHJ5e2NoaWxkRXhwYW5zaW9uPWRvRm9ybWF0KG9ialtpXSxjaGlsZERlcHRoLGNoaWxkSW5kZW50YXRpb24pO2NoaWxkTGluZXMucHVzaChjaGlsZEluZGVudGF0aW9uK2krIjogIitjaGlsZEV4cGFuc2lvbik7fWNhdGNoKGV4KXtjaGlsZExpbmVzLnB1c2goY2hpbGRJbmRlbnRhdGlvbitpKyI6IEVycm9yIGZvcm1hdHRpbmcgcHJvcGVydHkuIERldGFpbHM6ICIrDQpnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpKTt9fQ0KZXhwYW5zaW9uKz1jaGlsZExpbmVzLmpvaW4oIiwiK25ld0xpbmUpK25ld0xpbmUraW5kZW50YXRpb24rIn0iO3JldHVybiBleHBhbnNpb247fWVsc2V7cmV0dXJuIGZvcm1hdFN0cmluZyh0b1N0cihvYmopKTt9fQ0KcmV0dXJuIGRvRm9ybWF0KG9iaixkZXB0aCxpbmRlbnRhdGlvbik7fQ0KdmFyIFNpbXBsZURhdGVGb3JtYXQ7KGZ1bmN0aW9uKCl7dmFyIHJlZ2V4PS8oJ1teJ10qJyl8KEcrfHkrfE0rfHcrfFcrfEQrfGQrfEYrfEUrfGErfEgrfGsrfEsrfGgrfG0rfHMrfFMrfForKXwoW2EtekEtWl0rKXwoW15hLXpBLVonXSspLzt2YXIgbW9udGhOYW1lcz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl07dmFyIGRheU5hbWVzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgVEVYVDI9MCxURVhUMz0xLE5VTUJFUj0yLFlFQVI9MyxNT05USD00LFRJTUVaT05FPTU7dmFyIHR5cGVzPXtHOlRFWFQyLHk6WUVBUixNOk1PTlRILHc6TlVNQkVSLFc6TlVNQkVSLEQ6TlVNQkVSLGQ6TlVNQkVSLEY6TlVNQkVSLEU6VEVYVDMsYTpURVhUMixIOk5VTUJFUixrOk5VTUJFUixLOk5VTUJFUixoOk5VTUJFUixtOk5VTUJFUixzOk5VTUJFUixTOk5VTUJFUixaOlRJTUVaT05FfTt2YXIgT05FX0RBWT0yNCo2MCo2MCoxMDAwO3ZhciBPTkVfV0VFSz03Kk9ORV9EQVk7dmFyIERFRkFVTFRfTUlOSU1BTF9EQVlTX0lOX0ZJUlNUX1dFRUs9MTt2YXIgbmV3RGF0ZUF0TWlkbmlnaHQ9ZnVuY3Rpb24oeWVhcixtb250aCxkYXkpe3ZhciBkPW5ldyBEYXRlKHllYXIsbW9udGgsZGF5LDAsMCwwKTtkLnNldE1pbGxpc2Vjb25kcygwKTtyZXR1cm4gZDt9O0RhdGUucHJvdG90eXBlLmdldERpZmZlcmVuY2U9ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIHRoaXMuZ2V0VGltZSgpLWRhdGUuZ2V0VGltZSgpO307RGF0ZS5wcm90b3R5cGUuaXNCZWZvcmU9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMuZ2V0VGltZSgpPGQuZ2V0VGltZSgpO307RGF0ZS5wcm90b3R5cGUuZ2V0VVRDVGltZT1mdW5jdGlvbigpe3JldHVybiBEYXRlLlVUQyh0aGlzLmdldEZ1bGxZZWFyKCksdGhpcy5nZXRNb250aCgpLHRoaXMuZ2V0RGF0ZSgpLHRoaXMuZ2V0SG91cnMoKSx0aGlzLmdldE1pbnV0ZXMoKSx0aGlzLmdldFNlY29uZHMoKSx0aGlzLmdldE1pbGxpc2Vjb25kcygpKTt9O0RhdGUucHJvdG90eXBlLmdldFRpbWVTaW5jZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5nZXRVVENUaW1lKCktZC5nZXRVVENUaW1lKCk7fTtEYXRlLnByb3RvdHlwZS5nZXRQcmV2aW91c1N1bmRheT1mdW5jdGlvbigpe3ZhciBtaWRkYXk9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLHRoaXMuZ2V0TW9udGgoKSx0aGlzLmdldERhdGUoKSwxMiwwLDApO3ZhciBwcmV2aW91c1N1bmRheT1uZXcgRGF0ZShtaWRkYXkuZ2V0VGltZSgpLXRoaXMuZ2V0RGF5KCkqT05FX0RBWSk7cmV0dXJuIG5ld0RhdGVBdE1pZG5pZ2h0KHByZXZpb3VzU3VuZGF5LmdldEZ1bGxZZWFyKCkscHJldmlvdXNTdW5kYXkuZ2V0TW9udGgoKSxwcmV2aW91c1N1bmRheS5nZXREYXRlKCkpO307RGF0ZS5wcm90b3R5cGUuZ2V0V2Vla0luWWVhcj1mdW5jdGlvbihtaW5pbWFsRGF5c0luRmlyc3RXZWVrKXtpZihpc1VuZGVmaW5lZCh0aGlzLm1pbmltYWxEYXlzSW5GaXJzdFdlZWspKXttaW5pbWFsRGF5c0luRmlyc3RXZWVrPURFRkFVTFRfTUlOSU1BTF9EQVlTX0lOX0ZJUlNUX1dFRUs7fQ0KdmFyIHByZXZpb3VzU3VuZGF5PXRoaXMuZ2V0UHJldmlvdXNTdW5kYXkoKTt2YXIgc3RhcnRPZlllYXI9bmV3RGF0ZUF0TWlkbmlnaHQodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7dmFyIG51bWJlck9mU3VuZGF5cz1wcmV2aW91c1N1bmRheS5pc0JlZm9yZShzdGFydE9mWWVhcik/MDoxK01hdGguZmxvb3IocHJldmlvdXNTdW5kYXkuZ2V0VGltZVNpbmNlKHN0YXJ0T2ZZZWFyKS9PTkVfV0VFSyk7dmFyIG51bWJlck9mRGF5c0luRmlyc3RXZWVrPTctc3RhcnRPZlllYXIuZ2V0RGF5KCk7dmFyIHdlZWtJblllYXI9bnVtYmVyT2ZTdW5kYXlzO2lmKG51bWJlck9mRGF5c0luRmlyc3RXZWVrPG1pbmltYWxEYXlzSW5GaXJzdFdlZWspe3dlZWtJblllYXItLTt9DQpyZXR1cm4gd2Vla0luWWVhcjt9O0RhdGUucHJvdG90eXBlLmdldFdlZWtJbk1vbnRoPWZ1bmN0aW9uKG1pbmltYWxEYXlzSW5GaXJzdFdlZWspe2lmKGlzVW5kZWZpbmVkKHRoaXMubWluaW1hbERheXNJbkZpcnN0V2Vlaykpe21pbmltYWxEYXlzSW5GaXJzdFdlZWs9REVGQVVMVF9NSU5JTUFMX0RBWVNfSU5fRklSU1RfV0VFSzt9DQp2YXIgcHJldmlvdXNTdW5kYXk9dGhpcy5nZXRQcmV2aW91c1N1bmRheSgpO3ZhciBzdGFydE9mTW9udGg9bmV3RGF0ZUF0TWlkbmlnaHQodGhpcy5nZXRGdWxsWWVhcigpLHRoaXMuZ2V0TW9udGgoKSwxKTt2YXIgbnVtYmVyT2ZTdW5kYXlzPXByZXZpb3VzU3VuZGF5LmlzQmVmb3JlKHN0YXJ0T2ZNb250aCk/MDoxK01hdGguZmxvb3IocHJldmlvdXNTdW5kYXkuZ2V0VGltZVNpbmNlKHN0YXJ0T2ZNb250aCkvT05FX1dFRUspO3ZhciBudW1iZXJPZkRheXNJbkZpcnN0V2Vlaz03LXN0YXJ0T2ZNb250aC5nZXREYXkoKTt2YXIgd2Vla0luTW9udGg9bnVtYmVyT2ZTdW5kYXlzO2lmKG51bWJlck9mRGF5c0luRmlyc3RXZWVrPj1taW5pbWFsRGF5c0luRmlyc3RXZWVrKXt3ZWVrSW5Nb250aCsrO30NCnJldHVybiB3ZWVrSW5Nb250aDt9O0RhdGUucHJvdG90eXBlLmdldERheUluWWVhcj1mdW5jdGlvbigpe3ZhciBzdGFydE9mWWVhcj1uZXdEYXRlQXRNaWRuaWdodCh0aGlzLmdldEZ1bGxZZWFyKCksMCwxKTtyZXR1cm4gMStNYXRoLmZsb29yKHRoaXMuZ2V0VGltZVNpbmNlKHN0YXJ0T2ZZZWFyKS9PTkVfREFZKTt9O1NpbXBsZURhdGVGb3JtYXQ9ZnVuY3Rpb24oZm9ybWF0U3RyaW5nKXt0aGlzLmZvcm1hdFN0cmluZz1mb3JtYXRTdHJpbmc7fTtTaW1wbGVEYXRlRm9ybWF0LnByb3RvdHlwZS5zZXRNaW5pbWFsRGF5c0luRmlyc3RXZWVrPWZ1bmN0aW9uKGRheXMpe3RoaXMubWluaW1hbERheXNJbkZpcnN0V2Vlaz1kYXlzO307U2ltcGxlRGF0ZUZvcm1hdC5wcm90b3R5cGUuZ2V0TWluaW1hbERheXNJbkZpcnN0V2Vlaz1mdW5jdGlvbigpe3JldHVybiBpc1VuZGVmaW5lZCh0aGlzLm1pbmltYWxEYXlzSW5GaXJzdFdlZWspP0RFRkFVTFRfTUlOSU1BTF9EQVlTX0lOX0ZJUlNUX1dFRUs6dGhpcy5taW5pbWFsRGF5c0luRmlyc3RXZWVrO307dmFyIHBhZFdpdGhaZXJvZXM9ZnVuY3Rpb24oc3RyLGxlbil7d2hpbGUoc3RyLmxlbmd0aDxsZW4pe3N0cj0iMCIrc3RyO30NCnJldHVybiBzdHI7fTt2YXIgZm9ybWF0VGV4dD1mdW5jdGlvbihkYXRhLG51bWJlck9mTGV0dGVycyxtaW5MZW5ndGgpe3JldHVybihudW1iZXJPZkxldHRlcnM+PTQpP2RhdGE6ZGF0YS5zdWJzdHIoMCxNYXRoLm1heChtaW5MZW5ndGgsbnVtYmVyT2ZMZXR0ZXJzKSk7fTt2YXIgZm9ybWF0TnVtYmVyPWZ1bmN0aW9uKGRhdGEsbnVtYmVyT2ZMZXR0ZXJzKXt2YXIgZGF0YVN0cmluZz0iIitkYXRhO3JldHVybiBwYWRXaXRoWmVyb2VzKGRhdGFTdHJpbmcsbnVtYmVyT2ZMZXR0ZXJzKTt9O1NpbXBsZURhdGVGb3JtYXQucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihkYXRlKXt2YXIgZm9ybWF0dGVkU3RyaW5nPSIiO3ZhciByZXN1bHQ7dmFyIHNlYXJjaFN0cmluZz10aGlzLmZvcm1hdFN0cmluZzt3aGlsZSgocmVzdWx0PXJlZ2V4LmV4ZWMoc2VhcmNoU3RyaW5nKSkpe3ZhciBxdW90ZWRTdHJpbmc9cmVzdWx0WzFdO3ZhciBwYXR0ZXJuTGV0dGVycz1yZXN1bHRbMl07dmFyIG90aGVyTGV0dGVycz1yZXN1bHRbM107dmFyIG90aGVyQ2hhcmFjdGVycz1yZXN1bHRbNF07aWYocXVvdGVkU3RyaW5nKXtpZihxdW90ZWRTdHJpbmc9PSInJyIpe2Zvcm1hdHRlZFN0cmluZys9IiciO31lbHNle2Zvcm1hdHRlZFN0cmluZys9cXVvdGVkU3RyaW5nLnN1YnN0cmluZygxLHF1b3RlZFN0cmluZy5sZW5ndGgtMSk7fX1lbHNlIGlmKG90aGVyTGV0dGVycyl7fWVsc2UgaWYob3RoZXJDaGFyYWN0ZXJzKXtmb3JtYXR0ZWRTdHJpbmcrPW90aGVyQ2hhcmFjdGVyczt9ZWxzZSBpZihwYXR0ZXJuTGV0dGVycyl7dmFyIHBhdHRlcm5MZXR0ZXI9cGF0dGVybkxldHRlcnMuY2hhckF0KDApO3ZhciBudW1iZXJPZkxldHRlcnM9cGF0dGVybkxldHRlcnMubGVuZ3RoO3ZhciByYXdEYXRhPSIiO3N3aXRjaChwYXR0ZXJuTGV0dGVyKXtjYXNlIkciOnJhd0RhdGE9IkFEIjticmVhaztjYXNlInkiOnJhd0RhdGE9ZGF0ZS5nZXRGdWxsWWVhcigpO2JyZWFrO2Nhc2UiTSI6cmF3RGF0YT1kYXRlLmdldE1vbnRoKCk7YnJlYWs7Y2FzZSJ3IjpyYXdEYXRhPWRhdGUuZ2V0V2Vla0luWWVhcih0aGlzLmdldE1pbmltYWxEYXlzSW5GaXJzdFdlZWsoKSk7YnJlYWs7Y2FzZSJXIjpyYXdEYXRhPWRhdGUuZ2V0V2Vla0luTW9udGgodGhpcy5nZXRNaW5pbWFsRGF5c0luRmlyc3RXZWVrKCkpO2JyZWFrO2Nhc2UiRCI6cmF3RGF0YT1kYXRlLmdldERheUluWWVhcigpO2JyZWFrO2Nhc2UiZCI6cmF3RGF0YT1kYXRlLmdldERhdGUoKTticmVhaztjYXNlIkYiOnJhd0RhdGE9MStNYXRoLmZsb29yKChkYXRlLmdldERhdGUoKS0xKS83KTticmVhaztjYXNlIkUiOnJhd0RhdGE9ZGF5TmFtZXNbZGF0ZS5nZXREYXkoKV07YnJlYWs7Y2FzZSJhIjpyYXdEYXRhPShkYXRlLmdldEhvdXJzKCk+PTEyKT8iUE0iOiJBTSI7YnJlYWs7Y2FzZSJIIjpyYXdEYXRhPWRhdGUuZ2V0SG91cnMoKTticmVhaztjYXNlImsiOnJhd0RhdGE9ZGF0ZS5nZXRIb3VycygpfHwyNDticmVhaztjYXNlIksiOnJhd0RhdGE9ZGF0ZS5nZXRIb3VycygpJTEyO2JyZWFrO2Nhc2UiaCI6cmF3RGF0YT0oZGF0ZS5nZXRIb3VycygpJTEyKXx8MTI7YnJlYWs7Y2FzZSJtIjpyYXdEYXRhPWRhdGUuZ2V0TWludXRlcygpO2JyZWFrO2Nhc2UicyI6cmF3RGF0YT1kYXRlLmdldFNlY29uZHMoKTticmVhaztjYXNlIlMiOnJhd0RhdGE9ZGF0ZS5nZXRNaWxsaXNlY29uZHMoKTticmVhaztjYXNlIloiOnJhd0RhdGE9ZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpO2JyZWFrO30NCnN3aXRjaCh0eXBlc1twYXR0ZXJuTGV0dGVyXSl7Y2FzZSBURVhUMjpmb3JtYXR0ZWRTdHJpbmcrPWZvcm1hdFRleHQocmF3RGF0YSxudW1iZXJPZkxldHRlcnMsMik7YnJlYWs7Y2FzZSBURVhUMzpmb3JtYXR0ZWRTdHJpbmcrPWZvcm1hdFRleHQocmF3RGF0YSxudW1iZXJPZkxldHRlcnMsMyk7YnJlYWs7Y2FzZSBOVU1CRVI6Zm9ybWF0dGVkU3RyaW5nKz1mb3JtYXROdW1iZXIocmF3RGF0YSxudW1iZXJPZkxldHRlcnMpO2JyZWFrO2Nhc2UgWUVBUjppZihudW1iZXJPZkxldHRlcnM8PTMpe3ZhciBkYXRhU3RyaW5nPSIiK3Jhd0RhdGE7Zm9ybWF0dGVkU3RyaW5nKz1kYXRhU3RyaW5nLnN1YnN0cigyLDIpO31lbHNle2Zvcm1hdHRlZFN0cmluZys9Zm9ybWF0TnVtYmVyKHJhd0RhdGEsbnVtYmVyT2ZMZXR0ZXJzKTt9DQpicmVhaztjYXNlIE1PTlRIOmlmKG51bWJlck9mTGV0dGVycz49Myl7Zm9ybWF0dGVkU3RyaW5nKz1mb3JtYXRUZXh0KG1vbnRoTmFtZXNbcmF3RGF0YV0sbnVtYmVyT2ZMZXR0ZXJzLG51bWJlck9mTGV0dGVycyk7fWVsc2V7Zm9ybWF0dGVkU3RyaW5nKz1mb3JtYXROdW1iZXIocmF3RGF0YSsxLG51bWJlck9mTGV0dGVycyk7fQ0KYnJlYWs7Y2FzZSBUSU1FWk9ORTp2YXIgaXNQb3NpdGl2ZT0ocmF3RGF0YT4wKTt2YXIgcHJlZml4PWlzUG9zaXRpdmU/Ii0iOiIrIjt2YXIgYWJzRGF0YT1NYXRoLmFicyhyYXdEYXRhKTt2YXIgaG91cnM9IiIrTWF0aC5mbG9vcihhYnNEYXRhLzYwKTtob3Vycz1wYWRXaXRoWmVyb2VzKGhvdXJzLDIpO3ZhciBtaW51dGVzPSIiKyhhYnNEYXRhJTYwKTttaW51dGVzPXBhZFdpdGhaZXJvZXMobWludXRlcywyKTtmb3JtYXR0ZWRTdHJpbmcrPXByZWZpeCtob3VycyttaW51dGVzO2JyZWFrO319DQpzZWFyY2hTdHJpbmc9c2VhcmNoU3RyaW5nLnN1YnN0cihyZXN1bHQuaW5kZXgrcmVzdWx0WzBdLmxlbmd0aCk7fQ0KcmV0dXJuIGZvcm1hdHRlZFN0cmluZzt9O30pKCk7bG9nNGphdmFzY3JpcHQuU2ltcGxlRGF0ZUZvcm1hdD1TaW1wbGVEYXRlRm9ybWF0O2Z1bmN0aW9uIFBhdHRlcm5MYXlvdXQocGF0dGVybil7aWYocGF0dGVybil7dGhpcy5wYXR0ZXJuPXBhdHRlcm47fWVsc2V7dGhpcy5wYXR0ZXJuPVBhdHRlcm5MYXlvdXQuREVGQVVMVF9DT05WRVJTSU9OX1BBVFRFUk47fQ0KdGhpcy5jdXN0b21GaWVsZHM9W107fQ0KUGF0dGVybkxheW91dC5UVENDX0NPTlZFUlNJT05fUEFUVEVSTj0iJXIgJXAgJWMgLSAlbSVuIjtQYXR0ZXJuTGF5b3V0LkRFRkFVTFRfQ09OVkVSU0lPTl9QQVRURVJOPSIlbSVuIjtQYXR0ZXJuTGF5b3V0LklTTzg2MDFfREFURUZPUk1BVD0ieXl5eS1NTS1kZCBISDptbTpzcyxTU1MiO1BhdHRlcm5MYXlvdXQuREFURVRJTUVfREFURUZPUk1BVD0iZGQgTU1NIHl5eXkgSEg6bW06c3MsU1NTIjtQYXR0ZXJuTGF5b3V0LkFCU09MVVRFVElNRV9EQVRFRk9STUFUPSJISDptbTpzcyxTU1MiO1BhdHRlcm5MYXlvdXQucHJvdG90eXBlPW5ldyBMYXlvdXQoKTtQYXR0ZXJuTGF5b3V0LnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXt2YXIgcmVnZXg9LyUoLT9bMC05XSspPyhcLj9bMC05XSspPyhbYWNkZm1NbnByJV0pKFx7KFteXH1dKylcfSk/fChbXiVdKykvO3ZhciBmb3JtYXR0ZWRTdHJpbmc9IiI7dmFyIHJlc3VsdDt2YXIgc2VhcmNoU3RyaW5nPXRoaXMucGF0dGVybjt3aGlsZSgocmVzdWx0PXJlZ2V4LmV4ZWMoc2VhcmNoU3RyaW5nKSkpe3ZhciBtYXRjaGVkU3RyaW5nPXJlc3VsdFswXTt2YXIgcGFkZGluZz1yZXN1bHRbMV07dmFyIHRydW5jYXRpb249cmVzdWx0WzJdO3ZhciBjb252ZXJzaW9uQ2hhcmFjdGVyPXJlc3VsdFszXTt2YXIgc3BlY2lmaWVyPXJlc3VsdFs1XTt2YXIgdGV4dD1yZXN1bHRbNl07aWYodGV4dCl7Zm9ybWF0dGVkU3RyaW5nKz0iIit0ZXh0O31lbHNle3ZhciByZXBsYWNlbWVudD0iIjtzd2l0Y2goY29udmVyc2lvbkNoYXJhY3Rlcil7Y2FzZSJhIjpjYXNlIm0iOnZhciBkZXB0aD0wO2lmKHNwZWNpZmllcil7ZGVwdGg9cGFyc2VJbnQoc3BlY2lmaWVyLDEwKTtpZihpc05hTihkZXB0aCkpe2hhbmRsZUVycm9yKCJQYXR0ZXJuTGF5b3V0LmZvcm1hdDogaW52YWxpZCBzcGVjaWZpZXIgJyIrDQpzcGVjaWZpZXIrIicgZm9yIGNvbnZlcnNpb24gY2hhcmFjdGVyICciK2NvbnZlcnNpb25DaGFyYWN0ZXIrIicgLSBzaG91bGQgYmUgYSBudW1iZXIiKTtkZXB0aD0wO319DQp2YXIgbWVzc2FnZXM9KGNvbnZlcnNpb25DaGFyYWN0ZXI9PT0iYSIpP2xvZ2dpbmdFdmVudC5tZXNzYWdlc1swXTpsb2dnaW5nRXZlbnQubWVzc2FnZXM7Zm9yKHZhciBpPTAsbGVuPW1lc3NhZ2VzLmxlbmd0aDtpPGxlbjtpKyspe2lmKGk+MCYmKHJlcGxhY2VtZW50LmNoYXJBdChyZXBsYWNlbWVudC5sZW5ndGgtMSkhPT0iICIpKXtyZXBsYWNlbWVudCs9IiAiO30NCmlmKGRlcHRoPT09MCl7cmVwbGFjZW1lbnQrPW1lc3NhZ2VzW2ldO31lbHNle3JlcGxhY2VtZW50Kz1mb3JtYXRPYmplY3RFeHBhbnNpb24obWVzc2FnZXNbaV0sZGVwdGgpO319DQpicmVhaztjYXNlImMiOnZhciBsb2dnZXJOYW1lPWxvZ2dpbmdFdmVudC5sb2dnZXIubmFtZTtpZihzcGVjaWZpZXIpe3ZhciBwcmVjaXNpb249cGFyc2VJbnQoc3BlY2lmaWVyLDEwKTt2YXIgbG9nZ2VyTmFtZUJpdHM9bG9nZ2luZ0V2ZW50LmxvZ2dlci5uYW1lLnNwbGl0KCIuIik7aWYocHJlY2lzaW9uPj1sb2dnZXJOYW1lQml0cy5sZW5ndGgpe3JlcGxhY2VtZW50PWxvZ2dlck5hbWU7fWVsc2V7cmVwbGFjZW1lbnQ9bG9nZ2VyTmFtZUJpdHMuc2xpY2UobG9nZ2VyTmFtZUJpdHMubGVuZ3RoLXByZWNpc2lvbikuam9pbigiLiIpO319ZWxzZXtyZXBsYWNlbWVudD1sb2dnZXJOYW1lO30NCmJyZWFrO2Nhc2UiZCI6dmFyIGRhdGVGb3JtYXQ9UGF0dGVybkxheW91dC5JU084NjAxX0RBVEVGT1JNQVQ7aWYoc3BlY2lmaWVyKXtkYXRlRm9ybWF0PXNwZWNpZmllcjtpZihkYXRlRm9ybWF0PT0iSVNPODYwMSIpe2RhdGVGb3JtYXQ9UGF0dGVybkxheW91dC5JU084NjAxX0RBVEVGT1JNQVQ7fWVsc2UgaWYoZGF0ZUZvcm1hdD09IkFCU09MVVRFIil7ZGF0ZUZvcm1hdD1QYXR0ZXJuTGF5b3V0LkFCU09MVVRFVElNRV9EQVRFRk9STUFUO31lbHNlIGlmKGRhdGVGb3JtYXQ9PSJEQVRFIil7ZGF0ZUZvcm1hdD1QYXR0ZXJuTGF5b3V0LkRBVEVUSU1FX0RBVEVGT1JNQVQ7fX0NCnJlcGxhY2VtZW50PShuZXcgU2ltcGxlRGF0ZUZvcm1hdChkYXRlRm9ybWF0KSkuZm9ybWF0KGxvZ2dpbmdFdmVudC50aW1lU3RhbXApO2JyZWFrO2Nhc2UiZiI6aWYodGhpcy5oYXNDdXN0b21GaWVsZHMoKSl7dmFyIGZpZWxkSW5kZXg9MDtpZihzcGVjaWZpZXIpe2ZpZWxkSW5kZXg9cGFyc2VJbnQoc3BlY2lmaWVyLDEwKTtpZihpc05hTihmaWVsZEluZGV4KSl7aGFuZGxlRXJyb3IoIlBhdHRlcm5MYXlvdXQuZm9ybWF0OiBpbnZhbGlkIHNwZWNpZmllciAnIisNCnNwZWNpZmllcisiJyBmb3IgY29udmVyc2lvbiBjaGFyYWN0ZXIgJ2YnIC0gc2hvdWxkIGJlIGEgbnVtYmVyIik7fWVsc2UgaWYoZmllbGRJbmRleD09PTApe2hhbmRsZUVycm9yKCJQYXR0ZXJuTGF5b3V0LmZvcm1hdDogaW52YWxpZCBzcGVjaWZpZXIgJyIrDQpzcGVjaWZpZXIrIicgZm9yIGNvbnZlcnNpb24gY2hhcmFjdGVyICdmJyAtIG11c3QgYmUgZ3JlYXRlciB0aGFuIHplcm8iKTt9ZWxzZSBpZihmaWVsZEluZGV4PnRoaXMuY3VzdG9tRmllbGRzLmxlbmd0aCl7aGFuZGxlRXJyb3IoIlBhdHRlcm5MYXlvdXQuZm9ybWF0OiBpbnZhbGlkIHNwZWNpZmllciAnIisNCnNwZWNpZmllcisiJyBmb3IgY29udmVyc2lvbiBjaGFyYWN0ZXIgJ2YnIC0gdGhlcmUgYXJlbid0IHRoYXQgbWFueSBjdXN0b20gZmllbGRzIik7fWVsc2V7ZmllbGRJbmRleD1maWVsZEluZGV4LTE7fX0NCnJlcGxhY2VtZW50PXRoaXMuY3VzdG9tRmllbGRzW2ZpZWxkSW5kZXhdLnZhbHVlO30NCmJyZWFrO2Nhc2UibiI6cmVwbGFjZW1lbnQ9bmV3TGluZTticmVhaztjYXNlInAiOnJlcGxhY2VtZW50PWxvZ2dpbmdFdmVudC5sZXZlbC5uYW1lO2JyZWFrO2Nhc2UiciI6cmVwbGFjZW1lbnQ9IiIrbG9nZ2luZ0V2ZW50LnRpbWVTdGFtcC5nZXREaWZmZXJlbmNlKGFwcGxpY2F0aW9uU3RhcnREYXRlKTticmVhaztjYXNlIiUiOnJlcGxhY2VtZW50PSIlIjticmVhaztkZWZhdWx0OnJlcGxhY2VtZW50PW1hdGNoZWRTdHJpbmc7YnJlYWs7fQ0KdmFyIGw7aWYodHJ1bmNhdGlvbil7bD1wYXJzZUludCh0cnVuY2F0aW9uLnN1YnN0cigxKSwxMCk7dmFyIHN0ckxlbj1yZXBsYWNlbWVudC5sZW5ndGg7aWYobDxzdHJMZW4pe3JlcGxhY2VtZW50PXJlcGxhY2VtZW50LnN1YnN0cmluZyhzdHJMZW4tbCxzdHJMZW4pO319DQppZihwYWRkaW5nKXtpZihwYWRkaW5nLmNoYXJBdCgwKT09Ii0iKXtsPXBhcnNlSW50KHBhZGRpbmcuc3Vic3RyKDEpLDEwKTt3aGlsZShyZXBsYWNlbWVudC5sZW5ndGg8bCl7cmVwbGFjZW1lbnQrPSIgIjt9fWVsc2V7bD1wYXJzZUludChwYWRkaW5nLDEwKTt3aGlsZShyZXBsYWNlbWVudC5sZW5ndGg8bCl7cmVwbGFjZW1lbnQ9IiAiK3JlcGxhY2VtZW50O319fQ0KZm9ybWF0dGVkU3RyaW5nKz1yZXBsYWNlbWVudDt9DQpzZWFyY2hTdHJpbmc9c2VhcmNoU3RyaW5nLnN1YnN0cihyZXN1bHQuaW5kZXgrcmVzdWx0WzBdLmxlbmd0aCk7fQ0KcmV0dXJuIGZvcm1hdHRlZFN0cmluZzt9O1BhdHRlcm5MYXlvdXQucHJvdG90eXBlLmlnbm9yZXNUaHJvd2FibGU9ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZTt9O1BhdHRlcm5MYXlvdXQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIlBhdHRlcm5MYXlvdXQiO307bG9nNGphdmFzY3JpcHQuUGF0dGVybkxheW91dD1QYXR0ZXJuTGF5b3V0O2Z1bmN0aW9uIEFsZXJ0QXBwZW5kZXIoKXt9DQpBbGVydEFwcGVuZGVyLnByb3RvdHlwZT1uZXcgQXBwZW5kZXIoKTtBbGVydEFwcGVuZGVyLnByb3RvdHlwZS5sYXlvdXQ9bmV3IFNpbXBsZUxheW91dCgpO0FsZXJ0QXBwZW5kZXIucHJvdG90eXBlLmFwcGVuZD1mdW5jdGlvbihsb2dnaW5nRXZlbnQpe3ZhciBmb3JtYXR0ZWRNZXNzYWdlPXRoaXMuZ2V0TGF5b3V0KCkuZm9ybWF0KGxvZ2dpbmdFdmVudCk7aWYodGhpcy5nZXRMYXlvdXQoKS5pZ25vcmVzVGhyb3dhYmxlKCkpe2Zvcm1hdHRlZE1lc3NhZ2UrPWxvZ2dpbmdFdmVudC5nZXRUaHJvd2FibGVTdHJSZXAoKTt9DQphbGVydChmb3JtYXR0ZWRNZXNzYWdlKTt9O0FsZXJ0QXBwZW5kZXIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkFsZXJ0QXBwZW5kZXIiO307bG9nNGphdmFzY3JpcHQuQWxlcnRBcHBlbmRlcj1BbGVydEFwcGVuZGVyO2Z1bmN0aW9uIEJyb3dzZXJDb25zb2xlQXBwZW5kZXIoKXt9DQpCcm93c2VyQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZT1uZXcgbG9nNGphdmFzY3JpcHQuQXBwZW5kZXIoKTtCcm93c2VyQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5sYXlvdXQ9bmV3IE51bGxMYXlvdXQoKTtCcm93c2VyQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS50aHJlc2hvbGQ9TGV2ZWwuREVCVUc7QnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuYXBwZW5kPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7dmFyIGFwcGVuZGVyPXRoaXM7dmFyIGdldEZvcm1hdHRlZE1lc3NhZ2U9ZnVuY3Rpb24oKXt2YXIgbGF5b3V0PWFwcGVuZGVyLmdldExheW91dCgpO3ZhciBmb3JtYXR0ZWRNZXNzYWdlPWxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KTtpZihsYXlvdXQuaWdub3Jlc1Rocm93YWJsZSgpJiZsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKXtmb3JtYXR0ZWRNZXNzYWdlKz1sb2dnaW5nRXZlbnQuZ2V0VGhyb3dhYmxlU3RyUmVwKCk7fQ0KcmV0dXJuIGZvcm1hdHRlZE1lc3NhZ2U7fTtpZigodHlwZW9mIG9wZXJhIT0idW5kZWZpbmVkIikmJm9wZXJhLnBvc3RFcnJvcil7b3BlcmEucG9zdEVycm9yKGdldEZvcm1hdHRlZE1lc3NhZ2UoKSk7fWVsc2UgaWYod2luZG93LmNvbnNvbGUmJndpbmRvdy5jb25zb2xlLmxvZyl7dmFyIGZvcm1hdHRlZE1lc2FnZT1nZXRGb3JtYXR0ZWRNZXNzYWdlKCk7aWYod2luZG93LmNvbnNvbGUuZGVidWcmJkxldmVsLkRFQlVHLmlzR3JlYXRlck9yRXF1YWwobG9nZ2luZ0V2ZW50LmxldmVsKSl7d2luZG93LmNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzYWdlKTt9ZWxzZSBpZih3aW5kb3cuY29uc29sZS5pbmZvJiZMZXZlbC5JTkZPLmVxdWFscyhsb2dnaW5nRXZlbnQubGV2ZWwpKXt3aW5kb3cuY29uc29sZS5pbmZvKGZvcm1hdHRlZE1lc2FnZSk7fWVsc2UgaWYod2luZG93LmNvbnNvbGUud2FybiYmTGV2ZWwuV0FSTi5lcXVhbHMobG9nZ2luZ0V2ZW50LmxldmVsKSl7d2luZG93LmNvbnNvbGUud2Fybihmb3JtYXR0ZWRNZXNhZ2UpO31lbHNlIGlmKHdpbmRvdy5jb25zb2xlLmVycm9yJiZsb2dnaW5nRXZlbnQubGV2ZWwuaXNHcmVhdGVyT3JFcXVhbChMZXZlbC5FUlJPUikpe3dpbmRvdy5jb25zb2xlLmVycm9yKGZvcm1hdHRlZE1lc2FnZSk7fWVsc2V7d2luZG93LmNvbnNvbGUubG9nKGZvcm1hdHRlZE1lc2FnZSk7fX19O0Jyb3dzZXJDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmdyb3VwPWZ1bmN0aW9uKG5hbWUpe2lmKHdpbmRvdy5jb25zb2xlJiZ3aW5kb3cuY29uc29sZS5ncm91cCl7d2luZG93LmNvbnNvbGUuZ3JvdXAobmFtZSk7fX07QnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuZ3JvdXBFbmQ9ZnVuY3Rpb24oKXtpZih3aW5kb3cuY29uc29sZSYmd2luZG93LmNvbnNvbGUuZ3JvdXBFbmQpe3dpbmRvdy5jb25zb2xlLmdyb3VwRW5kKCk7fX07QnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iQnJvd3NlckNvbnNvbGVBcHBlbmRlciI7fTtsb2c0amF2YXNjcmlwdC5Ccm93c2VyQ29uc29sZUFwcGVuZGVyPUJyb3dzZXJDb25zb2xlQXBwZW5kZXI7ZnVuY3Rpb24gZ2V0WG1sSHR0cChlcnJvckhhbmRsZXIpe3ZhciB4bWxIdHRwPW51bGw7aWYodHlwZW9mIFhNTEh0dHBSZXF1ZXN0PT0ib2JqZWN0Inx8dHlwZW9mIFhNTEh0dHBSZXF1ZXN0PT0iZnVuY3Rpb24iKXt4bWxIdHRwPW5ldyBYTUxIdHRwUmVxdWVzdCgpO31lbHNle3RyeXt4bWxIdHRwPW5ldyBBY3RpdmVYT2JqZWN0KCJNc3htbDIuWE1MSFRUUCIpO31jYXRjaChlMSl7dHJ5e3htbEh0dHA9bmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7fWNhdGNoKGUyKXtpZihlcnJvckhhbmRsZXIpe2Vycm9ySGFuZGxlcigpO31lbHNle2hhbmRsZUVycm9yKCJnZXRYbWxIdHRwOiB1bmFibGUgdG8gb2J0YWluIFhNTEh0dHBSZXF1ZXN0IG9iamVjdCIpO319fX0NCnJldHVybiB4bWxIdHRwO30NCmZ1bmN0aW9uIGlzSHR0cFJlcXVlc3RTdWNjZXNzZnVsKHhtbEh0dHApe3JldHVybihpc1VuZGVmaW5lZCh4bWxIdHRwLnN0YXR1cyl8fHhtbEh0dHAuc3RhdHVzPT09MHx8KHhtbEh0dHAuc3RhdHVzPj0yMDAmJnhtbEh0dHAuc3RhdHVzPDMwMCkpO30NCmZ1bmN0aW9uIEFqYXhBcHBlbmRlcih1cmwpe3ZhciBhcHBlbmRlcj10aGlzO3ZhciBpc1N1cHBvcnRlZD10cnVlO2lmKCF1cmwpe2hhbmRsZUVycm9yKCJBamF4QXBwZW5kZXI6IFVSTCBtdXN0IGJlIHNwZWNpZmllZCBpbiBjb25zdHJ1Y3RvciIpO2lzU3VwcG9ydGVkPWZhbHNlO30NCnZhciB0aW1lZD10aGlzLmRlZmF1bHRzLnRpbWVkO3ZhciB3YWl0Rm9yUmVzcG9uc2U9dGhpcy5kZWZhdWx0cy53YWl0Rm9yUmVzcG9uc2U7dmFyIGJhdGNoU2l6ZT10aGlzLmRlZmF1bHRzLmJhdGNoU2l6ZTt2YXIgdGltZXJJbnRlcnZhbD10aGlzLmRlZmF1bHRzLnRpbWVySW50ZXJ2YWw7dmFyIHJlcXVlc3RTdWNjZXNzQ2FsbGJhY2s9dGhpcy5kZWZhdWx0cy5yZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrO3ZhciBmYWlsQ2FsbGJhY2s9dGhpcy5kZWZhdWx0cy5mYWlsQ2FsbGJhY2s7dmFyIHBvc3RWYXJOYW1lPXRoaXMuZGVmYXVsdHMucG9zdFZhck5hbWU7dmFyIHNlbmRBbGxPblVubG9hZD10aGlzLmRlZmF1bHRzLnNlbmRBbGxPblVubG9hZDt2YXIgc2Vzc2lvbklkPW51bGw7dmFyIHF1ZXVlZExvZ2dpbmdFdmVudHM9W107dmFyIHF1ZXVlZFJlcXVlc3RzPVtdO3ZhciBzZW5kaW5nPWZhbHNlO3ZhciBpbml0aWFsaXplZD1mYWxzZTtmdW5jdGlvbiBjaGVja0NhbkNvbmZpZ3VyZShjb25maWdPcHRpb25OYW1lKXtpZihpbml0aWFsaXplZCl7aGFuZGxlRXJyb3IoIkFqYXhBcHBlbmRlcjogY29uZmlndXJhdGlvbiBvcHRpb24gJyIrDQpjb25maWdPcHRpb25OYW1lKyInIG1heSBub3QgYmUgc2V0IGFmdGVyIHRoZSBhcHBlbmRlciBoYXMgYmVlbiBpbml0aWFsaXplZCIpO3JldHVybiBmYWxzZTt9DQpyZXR1cm4gdHJ1ZTt9DQp0aGlzLmdldFNlc3Npb25JZD1mdW5jdGlvbigpe3JldHVybiBzZXNzaW9uSWQ7fTt0aGlzLnNldFNlc3Npb25JZD1mdW5jdGlvbihzZXNzaW9uSWRQYXJhbSl7c2Vzc2lvbklkPWV4dHJhY3RTdHJpbmdGcm9tUGFyYW0oc2Vzc2lvbklkUGFyYW0sbnVsbCk7dGhpcy5sYXlvdXQuc2V0Q3VzdG9tRmllbGQoInNlc3Npb25pZCIsc2Vzc2lvbklkKTt9O3RoaXMuc2V0TGF5b3V0PWZ1bmN0aW9uKGxheW91dFBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgibGF5b3V0Iikpe3RoaXMubGF5b3V0PWxheW91dFBhcmFtO2lmKHNlc3Npb25JZCE9PW51bGwpe3RoaXMuc2V0U2Vzc2lvbklkKHNlc3Npb25JZCk7fX19O3RoaXMuaXNUaW1lZD1mdW5jdGlvbigpe3JldHVybiB0aW1lZDt9O3RoaXMuc2V0VGltZWQ9ZnVuY3Rpb24odGltZWRQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInRpbWVkIikpe3RpbWVkPWJvb2wodGltZWRQYXJhbSk7fX07dGhpcy5nZXRUaW1lckludGVydmFsPWZ1bmN0aW9uKCl7cmV0dXJuIHRpbWVySW50ZXJ2YWw7fTt0aGlzLnNldFRpbWVySW50ZXJ2YWw9ZnVuY3Rpb24odGltZXJJbnRlcnZhbFBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgidGltZXJJbnRlcnZhbCIpKXt0aW1lckludGVydmFsPWV4dHJhY3RJbnRGcm9tUGFyYW0odGltZXJJbnRlcnZhbFBhcmFtLHRpbWVySW50ZXJ2YWwpO319O3RoaXMuaXNXYWl0Rm9yUmVzcG9uc2U9ZnVuY3Rpb24oKXtyZXR1cm4gd2FpdEZvclJlc3BvbnNlO307dGhpcy5zZXRXYWl0Rm9yUmVzcG9uc2U9ZnVuY3Rpb24od2FpdEZvclJlc3BvbnNlUGFyYW0pe2lmKGNoZWNrQ2FuQ29uZmlndXJlKCJ3YWl0Rm9yUmVzcG9uc2UiKSl7d2FpdEZvclJlc3BvbnNlPWJvb2wod2FpdEZvclJlc3BvbnNlUGFyYW0pO319O3RoaXMuZ2V0QmF0Y2hTaXplPWZ1bmN0aW9uKCl7cmV0dXJuIGJhdGNoU2l6ZTt9O3RoaXMuc2V0QmF0Y2hTaXplPWZ1bmN0aW9uKGJhdGNoU2l6ZVBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgiYmF0Y2hTaXplIikpe2JhdGNoU2l6ZT1leHRyYWN0SW50RnJvbVBhcmFtKGJhdGNoU2l6ZVBhcmFtLGJhdGNoU2l6ZSk7fX07dGhpcy5pc1NlbmRBbGxPblVubG9hZD1mdW5jdGlvbigpe3JldHVybiBzZW5kQWxsT25VbmxvYWQ7fTt0aGlzLnNldFNlbmRBbGxPblVubG9hZD1mdW5jdGlvbihzZW5kQWxsT25VbmxvYWRQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInNlbmRBbGxPblVubG9hZCIpKXtzZW5kQWxsT25VbmxvYWQ9ZXh0cmFjdEludEZyb21QYXJhbShzZW5kQWxsT25VbmxvYWRQYXJhbSxzZW5kQWxsT25VbmxvYWQpO319O3RoaXMuc2V0UmVxdWVzdFN1Y2Nlc3NDYWxsYmFjaz1mdW5jdGlvbihyZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUGFyYW0pe3JlcXVlc3RTdWNjZXNzQ2FsbGJhY2s9ZXh0cmFjdEZ1bmN0aW9uRnJvbVBhcmFtKHJlcXVlc3RTdWNjZXNzQ2FsbGJhY2tQYXJhbSxyZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrKTt9O3RoaXMuc2V0RmFpbENhbGxiYWNrPWZ1bmN0aW9uKGZhaWxDYWxsYmFja1BhcmFtKXtmYWlsQ2FsbGJhY2s9ZXh0cmFjdEZ1bmN0aW9uRnJvbVBhcmFtKGZhaWxDYWxsYmFja1BhcmFtLGZhaWxDYWxsYmFjayk7fTt0aGlzLmdldFBvc3RWYXJOYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHBvc3RWYXJOYW1lO307dGhpcy5zZXRQb3N0VmFyTmFtZT1mdW5jdGlvbihwb3N0VmFyTmFtZVBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgicG9zdFZhck5hbWUiKSl7cG9zdFZhck5hbWU9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbShwb3N0VmFyTmFtZVBhcmFtLHBvc3RWYXJOYW1lKTt9fTtmdW5jdGlvbiBzZW5kQWxsKCl7aWYoaXNTdXBwb3J0ZWQmJmVuYWJsZWQpe3NlbmRpbmc9dHJ1ZTt2YXIgY3VycmVudFJlcXVlc3RCYXRjaDtpZih3YWl0Rm9yUmVzcG9uc2Upe2lmKHF1ZXVlZFJlcXVlc3RzLmxlbmd0aD4wKXtjdXJyZW50UmVxdWVzdEJhdGNoPXF1ZXVlZFJlcXVlc3RzLnNoaWZ0KCk7c2VuZFJlcXVlc3QocHJlcGFyZVBvc3REYXRhKGN1cnJlbnRSZXF1ZXN0QmF0Y2gpLHNlbmRBbGwpO31lbHNle3NlbmRpbmc9ZmFsc2U7aWYodGltZWQpe3NjaGVkdWxlU2VuZGluZygpO319fWVsc2V7d2hpbGUoKGN1cnJlbnRSZXF1ZXN0QmF0Y2g9cXVldWVkUmVxdWVzdHMuc2hpZnQoKSkpe3NlbmRSZXF1ZXN0KHByZXBhcmVQb3N0RGF0YShjdXJyZW50UmVxdWVzdEJhdGNoKSk7fQ0Kc2VuZGluZz1mYWxzZTtpZih0aW1lZCl7c2NoZWR1bGVTZW5kaW5nKCk7fX19fQ0KdGhpcy5zZW5kQWxsPXNlbmRBbGw7ZnVuY3Rpb24gc2VuZEFsbFJlbWFpbmluZygpe2lmKGlzU3VwcG9ydGVkJiZlbmFibGVkKXt2YXIgYWN0dWFsQmF0Y2hTaXplPWFwcGVuZGVyLmdldExheW91dCgpLmFsbG93QmF0Y2hpbmcoKT9iYXRjaFNpemU6MTt2YXIgY3VycmVudExvZ2dpbmdFdmVudDt2YXIgcG9zdERhdGE9IiI7dmFyIGJhdGNoZWRMb2dnaW5nRXZlbnRzPVtdO3doaWxlKChjdXJyZW50TG9nZ2luZ0V2ZW50PXF1ZXVlZExvZ2dpbmdFdmVudHMuc2hpZnQoKSkpe2JhdGNoZWRMb2dnaW5nRXZlbnRzLnB1c2goY3VycmVudExvZ2dpbmdFdmVudCk7aWYocXVldWVkTG9nZ2luZ0V2ZW50cy5sZW5ndGg+PWFjdHVhbEJhdGNoU2l6ZSl7cXVldWVkUmVxdWVzdHMucHVzaChiYXRjaGVkTG9nZ2luZ0V2ZW50cyk7YmF0Y2hlZExvZ2dpbmdFdmVudHM9W107fX0NCmlmKGJhdGNoZWRMb2dnaW5nRXZlbnRzLmxlbmd0aD4wKXtxdWV1ZWRSZXF1ZXN0cy5wdXNoKGJhdGNoZWRMb2dnaW5nRXZlbnRzKTt9DQp3YWl0Rm9yUmVzcG9uc2U9ZmFsc2U7dGltZWQ9ZmFsc2U7c2VuZEFsbCgpO319DQpmdW5jdGlvbiBwcmVwYXJlUG9zdERhdGEoYmF0Y2hlZExvZ2dpbmdFdmVudHMpe3ZhciBmb3JtYXR0ZWRNZXNzYWdlcz1bXTt2YXIgY3VycmVudExvZ2dpbmdFdmVudDt2YXIgcG9zdERhdGE9IiI7d2hpbGUoKGN1cnJlbnRMb2dnaW5nRXZlbnQ9YmF0Y2hlZExvZ2dpbmdFdmVudHMuc2hpZnQoKSkpe3ZhciBjdXJyZW50Rm9ybWF0dGVkTWVzc2FnZT1hcHBlbmRlci5nZXRMYXlvdXQoKS5mb3JtYXQoY3VycmVudExvZ2dpbmdFdmVudCk7aWYoYXBwZW5kZXIuZ2V0TGF5b3V0KCkuaWdub3Jlc1Rocm93YWJsZSgpKXtjdXJyZW50Rm9ybWF0dGVkTWVzc2FnZSs9bG9nZ2luZ0V2ZW50LmdldFRocm93YWJsZVN0clJlcCgpO30NCmZvcm1hdHRlZE1lc3NhZ2VzLnB1c2goY3VycmVudEZvcm1hdHRlZE1lc3NhZ2UpO30NCmlmKGJhdGNoZWRMb2dnaW5nRXZlbnRzLmxlbmd0aD09MSl7cG9zdERhdGE9Zm9ybWF0dGVkTWVzc2FnZXMuam9pbigiIik7fWVsc2V7cG9zdERhdGE9YXBwZW5kZXIuZ2V0TGF5b3V0KCkuYmF0Y2hIZWFkZXIrDQpmb3JtYXR0ZWRNZXNzYWdlcy5qb2luKGFwcGVuZGVyLmdldExheW91dCgpLmJhdGNoU2VwYXJhdG9yKSsNCmFwcGVuZGVyLmdldExheW91dCgpLmJhdGNoRm9vdGVyO30NCnBvc3REYXRhPWFwcGVuZGVyLmdldExheW91dCgpLnJldHVybnNQb3N0RGF0YT9wb3N0RGF0YTp1cmxFbmNvZGUocG9zdFZhck5hbWUpKyI9Iit1cmxFbmNvZGUocG9zdERhdGEpO2lmKHBvc3REYXRhLmxlbmd0aD4wKXtwb3N0RGF0YSs9IiYiO30NCnJldHVybiBwb3N0RGF0YSsibGF5b3V0PSIrdXJsRW5jb2RlKGFwcGVuZGVyLmdldExheW91dCgpLnRvU3RyaW5nKCkpO30NCmZ1bmN0aW9uIHNjaGVkdWxlU2VuZGluZygpe3NldFRpbWVvdXQoc2VuZEFsbCx0aW1lckludGVydmFsKTt9DQpmdW5jdGlvbiB4bWxIdHRwRXJyb3JIYW5kbGVyKCl7dmFyIG1zZz0iQWpheEFwcGVuZGVyOiBjb3VsZCBub3QgY3JlYXRlIFhNTEh0dHBSZXF1ZXN0IG9iamVjdC4gQWpheEFwcGVuZGVyIGRpc2FibGVkIjtoYW5kbGVFcnJvcihtc2cpO2lzU3VwcG9ydGVkPWZhbHNlO2lmKGZhaWxDYWxsYmFjayl7ZmFpbENhbGxiYWNrKG1zZyk7fX0NCmZ1bmN0aW9uIHNlbmRSZXF1ZXN0KHBvc3REYXRhLHN1Y2Nlc3NDYWxsYmFjayl7dHJ5e3ZhciB4bWxIdHRwPWdldFhtbEh0dHAoeG1sSHR0cEVycm9ySGFuZGxlcik7aWYoaXNTdXBwb3J0ZWQpe2lmKHhtbEh0dHAub3ZlcnJpZGVNaW1lVHlwZSl7eG1sSHR0cC5vdmVycmlkZU1pbWVUeXBlKGFwcGVuZGVyLmdldExheW91dCgpLmdldENvbnRlbnRUeXBlKCkpO30NCnhtbEh0dHAub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7aWYoeG1sSHR0cC5yZWFkeVN0YXRlPT00KXtpZihpc0h0dHBSZXF1ZXN0U3VjY2Vzc2Z1bCh4bWxIdHRwKSl7aWYocmVxdWVzdFN1Y2Nlc3NDYWxsYmFjayl7cmVxdWVzdFN1Y2Nlc3NDYWxsYmFjayh4bWxIdHRwKTt9DQppZihzdWNjZXNzQ2FsbGJhY2spe3N1Y2Nlc3NDYWxsYmFjayh4bWxIdHRwKTt9fWVsc2V7dmFyIG1zZz0iQWpheEFwcGVuZGVyLmFwcGVuZDogWE1MSHR0cFJlcXVlc3QgcmVxdWVzdCB0byBVUkwgIisNCnVybCsiIHJldHVybmVkIHN0YXR1cyBjb2RlICIreG1sSHR0cC5zdGF0dXM7aGFuZGxlRXJyb3IobXNnKTtpZihmYWlsQ2FsbGJhY2spe2ZhaWxDYWxsYmFjayhtc2cpO319DQp4bWxIdHRwLm9ucmVhZHlzdGF0ZWNoYW5nZT1lbXB0eUZ1bmN0aW9uO3htbEh0dHA9bnVsbDt9fTt4bWxIdHRwLm9wZW4oIlBPU1QiLHVybCx0cnVlKTt0cnl7eG1sSHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTt9Y2F0Y2goaGVhZGVyRXgpe3ZhciBtc2c9IkFqYXhBcHBlbmRlci5hcHBlbmQ6IHlvdXIgYnJvd3NlcidzIFhNTEh0dHBSZXF1ZXN0IGltcGxlbWVudGF0aW9uIisiIGRvZXMgbm90IHN1cHBvcnQgc2V0UmVxdWVzdEhlYWRlciwgdGhlcmVmb3JlIGNhbm5vdCBwb3N0IGRhdGEuIEFqYXhBcHBlbmRlciBkaXNhYmxlZCI7aGFuZGxlRXJyb3IobXNnKTtpc1N1cHBvcnRlZD1mYWxzZTtpZihmYWlsQ2FsbGJhY2spe2ZhaWxDYWxsYmFjayhtc2cpO30NCnJldHVybjt9DQp4bWxIdHRwLnNlbmQocG9zdERhdGEpO319Y2F0Y2goZXgpe3ZhciBlcnJNc2c9IkFqYXhBcHBlbmRlci5hcHBlbmQ6IGVycm9yIHNlbmRpbmcgbG9nIG1lc3NhZ2UgdG8gIit1cmw7aGFuZGxlRXJyb3IoZXJyTXNnLGV4KTtpc1N1cHBvcnRlZD1mYWxzZTtpZihmYWlsQ2FsbGJhY2spe2ZhaWxDYWxsYmFjayhlcnJNc2crIi4gRGV0YWlsczogIitnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpKTt9fX0NCnRoaXMuYXBwZW5kPWZ1bmN0aW9uKGxvZ2dpbmdFdmVudCl7aWYoaXNTdXBwb3J0ZWQpe2lmKCFpbml0aWFsaXplZCl7aW5pdCgpO30NCnF1ZXVlZExvZ2dpbmdFdmVudHMucHVzaChsb2dnaW5nRXZlbnQpO3ZhciBhY3R1YWxCYXRjaFNpemU9dGhpcy5nZXRMYXlvdXQoKS5hbGxvd0JhdGNoaW5nKCk/YmF0Y2hTaXplOjE7aWYocXVldWVkTG9nZ2luZ0V2ZW50cy5sZW5ndGg+PWFjdHVhbEJhdGNoU2l6ZSl7dmFyIGN1cnJlbnRMb2dnaW5nRXZlbnQ7dmFyIHBvc3REYXRhPSIiO3ZhciBiYXRjaGVkTG9nZ2luZ0V2ZW50cz1bXTt3aGlsZSgoY3VycmVudExvZ2dpbmdFdmVudD1xdWV1ZWRMb2dnaW5nRXZlbnRzLnNoaWZ0KCkpKXtiYXRjaGVkTG9nZ2luZ0V2ZW50cy5wdXNoKGN1cnJlbnRMb2dnaW5nRXZlbnQpO30NCnF1ZXVlZFJlcXVlc3RzLnB1c2goYmF0Y2hlZExvZ2dpbmdFdmVudHMpO2lmKCF0aW1lZCl7aWYoIXdhaXRGb3JSZXNwb25zZXx8KHdhaXRGb3JSZXNwb25zZSYmIXNlbmRpbmcpKXtzZW5kQWxsKCk7fX19fX07ZnVuY3Rpb24gaW5pdCgpe2luaXRpYWxpemVkPXRydWU7aWYoc2VuZEFsbE9uVW5sb2FkKXthZGRFdmVudCh3aW5kb3csInVubG9hZCIsc2VuZEFsbFJlbWFpbmluZyk7fQ0KaWYodGltZWQpe3NjaGVkdWxlU2VuZGluZygpO319fQ0KQWpheEFwcGVuZGVyLnByb3RvdHlwZT1uZXcgQXBwZW5kZXIoKTtBamF4QXBwZW5kZXIucHJvdG90eXBlLmRlZmF1bHRzPXt3YWl0Rm9yUmVzcG9uc2U6ZmFsc2UsdGltZWQ6ZmFsc2UsdGltZXJJbnRlcnZhbDoxMDAwLGJhdGNoU2l6ZToxLHNlbmRBbGxPblVubG9hZDp0cnVlLHJlcXVlc3RTdWNjZXNzQ2FsbGJhY2s6bnVsbCxmYWlsQ2FsbGJhY2s6bnVsbCxwb3N0VmFyTmFtZToiZGF0YSJ9O0FqYXhBcHBlbmRlci5wcm90b3R5cGUubGF5b3V0PW5ldyBIdHRwUG9zdERhdGFMYXlvdXQoKTtBamF4QXBwZW5kZXIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkFqYXhBcHBlbmRlciI7fTtsb2c0amF2YXNjcmlwdC5BamF4QXBwZW5kZXI9QWpheEFwcGVuZGVyO2Z1bmN0aW9uIHNldENvb2tpZShuYW1lLHZhbHVlLGRheXMscGF0aCl7dmFyIGV4cGlyZXM7cGF0aD1wYXRoPyI7IHBhdGg9IitwYXRoOiIiO2lmKGRheXMpe3ZhciBkYXRlPW5ldyBEYXRlKCk7ZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpKyhkYXlzKjI0KjYwKjYwKjEwMDApKTtleHBpcmVzPSI7IGV4cGlyZXM9IitkYXRlLnRvR01UU3RyaW5nKCk7fWVsc2V7ZXhwaXJlcz0iIjt9DQpkb2N1bWVudC5jb29raWU9ZXNjYXBlKG5hbWUpKyI9Iitlc2NhcGUodmFsdWUpK2V4cGlyZXMrcGF0aDt9DQpmdW5jdGlvbiBnZXRDb29raWUobmFtZSl7dmFyIG5hbWVFcXVhbHM9ZXNjYXBlKG5hbWUpKyI9Ijt2YXIgY2E9ZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7Zm9yKHZhciBpPTAsbGVuPWNhLmxlbmd0aDtpPGxlbjtpKyspe3ZhciBjPWNhW2ldO3doaWxlKGMuY2hhckF0KDApPT09IiAiKXtjPWMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpO30NCmlmKGMuaW5kZXhPZihuYW1lRXF1YWxzKT09PTApe3JldHVybiB1bmVzY2FwZShjLnN1YnN0cmluZyhuYW1lRXF1YWxzLmxlbmd0aCxjLmxlbmd0aCkpO319DQpyZXR1cm4gbnVsbDt9DQpmdW5jdGlvbiBnZXRCYXNlVXJsKCl7dmFyIHNjcmlwdHM9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpO2Zvcih2YXIgaT0wLGxlbj1zY3JpcHRzLmxlbmd0aDtpPGxlbjsrK2kpe2lmKHNjcmlwdHNbaV0uc3JjLmluZGV4T2YoImxvZzRqYXZhc2NyaXB0IikhPS0xKXt2YXIgbGFzdFNsYXNoPXNjcmlwdHNbaV0uc3JjLmxhc3RJbmRleE9mKCIvIik7cmV0dXJuKGxhc3RTbGFzaD09LTEpPyIiOnNjcmlwdHNbaV0uc3JjLnN1YnN0cigwLGxhc3RTbGFzaCsxKTt9fQ0KcmV0dXJuIG51bGw7fQ0KZnVuY3Rpb24gaXNMb2FkZWQod2luKXt0cnl7cmV0dXJuIGJvb2wod2luLmxvYWRlZCk7fWNhdGNoKGV4KXtyZXR1cm4gZmFsc2U7fX0NCnZhciBDb25zb2xlQXBwZW5kZXI7KGZ1bmN0aW9uKCl7dmFyIGdldENvbnNvbGVIdG1sTGluZXM9ZnVuY3Rpb24oKXtyZXR1cm5bJzwhRE9DVFlQRSBodG1sIFBVQkxJQyAiLS8vVzNDLy9EVEQgWEhUTUwgMS4wIFN0cmljdC8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9UUi94aHRtbDEvRFREL3hodG1sMS1zdHJpY3QuZHRkIj4nLCc8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgbGFuZz0iZW4iIHhtbDpsYW5nPSJlbiI+JywnPGhlYWQ+JywnPHRpdGxlPmxvZzRqYXZhc2NyaXB0PC90aXRsZT4nLCc8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIgLz4nLCc8IS0tIE1ha2UgSUU4IGJlaGF2ZSBsaWtlIElFNywgaGF2aW5nIGdvbmUgdG8gYWxsIHRoZSB0cm91YmxlIG9mIG1ha2luZyBJRSB3b3JrIC0tPicsJzxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9NyIgLz4nLCc8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+dmFyIGlzSWUgPSBmYWxzZSwgaXNJZVByZTcgPSBmYWxzZTs8L3NjcmlwdD4nLCc8IS0tW2lmIElFXT48c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+aXNJZSA9IHRydWU8L3NjcmlwdD48IVtlbmRpZl0tLT4nLCc8IS0tW2lmIGx0IElFIDddPjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5pc0llUHJlNyA9IHRydWU8L3NjcmlwdD48IVtlbmRpZl0tLT4nLCc8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+JywnLy88IVtDREFUQVsnLCd2YXIgbG9nZ2luZ0VuYWJsZWQ9dHJ1ZTt2YXIgbG9nUXVldWVkRXZlbnRzVGltZXI9bnVsbDt2YXIgbG9nRW50cmllcz1bXTt2YXIgbG9nRW50cmllc0FuZFNlcGFyYXRvcnM9W107dmFyIGxvZ0l0ZW1zPVtdO3ZhciByZW5kZXJEZWxheT0xMDA7dmFyIHVucmVuZGVyZWRMb2dJdGVtc0V4aXN0PWZhbHNlO3ZhciByb290R3JvdXAsY3VycmVudEdyb3VwPW51bGw7dmFyIGxvYWRlZD1mYWxzZTt2YXIgY3VycmVudExvZ0l0ZW09bnVsbDt2YXIgbG9nTWFpbkNvbnRhaW5lcjtmdW5jdGlvbiBjb3B5UHJvcGVydGllcyhvYmoscHJvcHMpe2Zvcih2YXIgaSBpbiBwcm9wcyl7b2JqW2ldPXByb3BzW2ldO319JywnZnVuY3Rpb24gTG9nSXRlbSgpe30nLCdMb2dJdGVtLnByb3RvdHlwZT17bWFpbkNvbnRhaW5lcjpudWxsLHdyYXBwZWRDb250YWluZXI6bnVsbCx1bndyYXBwZWRDb250YWluZXI6bnVsbCxncm91cDpudWxsLGFwcGVuZFRvTG9nOmZ1bmN0aW9uKCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5hcHBlbmRUb0xvZygpO30nLCd0aGlzLmdyb3VwLnVwZGF0ZSgpO30sZG9SZW1vdmU6ZnVuY3Rpb24oZG9VcGRhdGUscmVtb3ZlRnJvbUdyb3VwKXtpZih0aGlzLnJlbmRlcmVkKXtmb3IodmFyIGk9MCxsZW49dGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnJlbW92ZSgpO30nLCd0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXI9bnVsbDt0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW51bGw7dGhpcy5tYWluRWxlbWVudENvbnRhaW5lcj1udWxsO30nLCdpZih0aGlzLmdyb3VwJiZyZW1vdmVGcm9tR3JvdXApe3RoaXMuZ3JvdXAucmVtb3ZlQ2hpbGQodGhpcyxkb1VwZGF0ZSk7fScsJ2lmKHRoaXM9PT1jdXJyZW50TG9nSXRlbSl7Y3VycmVudExvZ0l0ZW09bnVsbDt9fSxyZW1vdmU6ZnVuY3Rpb24oZG9VcGRhdGUscmVtb3ZlRnJvbUdyb3VwKXt0aGlzLmRvUmVtb3ZlKGRvVXBkYXRlLHJlbW92ZUZyb21Hcm91cCk7fSxyZW5kZXI6ZnVuY3Rpb24oKXt9LGFjY2VwdDpmdW5jdGlvbih2aXNpdG9yKXt2aXNpdG9yLnZpc2l0KHRoaXMpO30sZ2V0VW53cmFwcGVkRG9tQ29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ3JvdXAudW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5jb250ZW50RGl2O30sZ2V0V3JhcHBlZERvbUNvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdyb3VwLndyYXBwZWRFbGVtZW50Q29udGFpbmVyLmNvbnRlbnREaXY7fSxnZXRNYWluRG9tQ29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ3JvdXAubWFpbkVsZW1lbnRDb250YWluZXIuY29udGVudERpdjt9fTtMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cz17TE9HX0VOVFJZOjAsR1JPVVBfU1RBUlQ6MSxHUk9VUF9FTkQ6Mn07ZnVuY3Rpb24gTG9nSXRlbUNvbnRhaW5lckVsZW1lbnQoKXt9JywnTG9nSXRlbUNvbnRhaW5lckVsZW1lbnQucHJvdG90eXBlPXthcHBlbmRUb0xvZzpmdW5jdGlvbigpe3ZhciBpbnNlcnRCZWZvcmVGaXJzdD0obmV3ZXN0QXRUb3AmJnRoaXMuY29udGFpbmVyRG9tTm9kZS5oYXNDaGlsZE5vZGVzKCkpO2lmKGluc2VydEJlZm9yZUZpcnN0KXt0aGlzLmNvbnRhaW5lckRvbU5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMubWFpbkRpdix0aGlzLmNvbnRhaW5lckRvbU5vZGUuZmlyc3RDaGlsZCk7fWVsc2V7dGhpcy5jb250YWluZXJEb21Ob2RlLmFwcGVuZENoaWxkKHRoaXMubWFpbkRpdik7fX19O2Z1bmN0aW9uIFNlcGFyYXRvckVsZW1lbnRDb250YWluZXIoY29udGFpbmVyRG9tTm9kZSl7dGhpcy5jb250YWluZXJEb21Ob2RlPWNvbnRhaW5lckRvbU5vZGU7dGhpcy5tYWluRGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMubWFpbkRpdi5jbGFzc05hbWU9InNlcGFyYXRvciI7dGhpcy5tYWluRGl2LmlubmVySFRNTD0iJm5ic3A7Ijt9JywnU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGU9bmV3IExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCk7U2VwYXJhdG9yRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKCl7dGhpcy5tYWluRGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tYWluRGl2KTt0aGlzLm1haW5EaXY9bnVsbDt9O2Z1bmN0aW9uIFNlcGFyYXRvcigpe3RoaXMucmVuZGVyZWQ9ZmFsc2U7fScsJ1NlcGFyYXRvci5wcm90b3R5cGU9bmV3IExvZ0l0ZW0oKTtjb3B5UHJvcGVydGllcyhTZXBhcmF0b3IucHJvdG90eXBlLHtyZW5kZXI6ZnVuY3Rpb24oKXt2YXIgY29udGFpbmVyRG9tTm9kZT10aGlzLmdyb3VwLmNvbnRlbnREaXY7aWYoaXNJZSl7dGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKHRoaXMuZ2V0VW53cmFwcGVkRG9tQ29udGFpbmVyKCkpO3RoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXI9bmV3IFNlcGFyYXRvckVsZW1lbnRDb250YWluZXIodGhpcy5nZXRXcmFwcGVkRG9tQ29udGFpbmVyKCkpO3RoaXMuZWxlbWVudENvbnRhaW5lcnM9W3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcix0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyXTt9ZWxzZXt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyPW5ldyBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKHRoaXMuZ2V0TWFpbkRvbUNvbnRhaW5lcigpKTt0aGlzLmVsZW1lbnRDb250YWluZXJzPVt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyXTt9JywndGhpcy5jb250ZW50PXRoaXMuZm9ybWF0dGVkTWVzc2FnZTt0aGlzLnJlbmRlcmVkPXRydWU7fX0pO2Z1bmN0aW9uIEdyb3VwRWxlbWVudENvbnRhaW5lcihncm91cCxjb250YWluZXJEb21Ob2RlLGlzUm9vdCxpc1dyYXBwZWQpe3RoaXMuZ3JvdXA9Z3JvdXA7dGhpcy5jb250YWluZXJEb21Ob2RlPWNvbnRhaW5lckRvbU5vZGU7dGhpcy5pc1Jvb3Q9aXNSb290O3RoaXMuaXNXcmFwcGVkPWlzV3JhcHBlZDt0aGlzLmV4cGFuZGFibGU9ZmFsc2U7aWYodGhpcy5pc1Jvb3Qpe2lmKGlzSWUpe3RoaXMuY29udGVudERpdj1sb2dNYWluQ29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTt0aGlzLmNvbnRlbnREaXYuaWQ9dGhpcy5pc1dyYXBwZWQ/ImxvZ193cmFwcGVkIjoibG9nX3Vud3JhcHBlZCI7fWVsc2V7dGhpcy5jb250ZW50RGl2PWxvZ01haW5Db250YWluZXI7fX1lbHNle3ZhciBncm91cEVsZW1lbnRDb250YWluZXI9dGhpczt0aGlzLm1haW5EaXY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5tYWluRGl2LmNsYXNzTmFtZT0iZ3JvdXAiO3RoaXMuaGVhZGluZ0Rpdj10aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpO3RoaXMuaGVhZGluZ0Rpdi5jbGFzc05hbWU9Imdyb3VwaGVhZGluZyI7dGhpcy5leHBhbmRlcj10aGlzLmhlYWRpbmdEaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpKTt0aGlzLmV4cGFuZGVyLmNsYXNzTmFtZT0iZXhwYW5kZXIgdW5zZWxlY3RhYmxlIGdyZXllZG91dCI7dGhpcy5leHBhbmRlci51bnNlbGVjdGFibGU9dHJ1ZTt2YXIgZXhwYW5kZXJUZXh0PXRoaXMuZ3JvdXAuZXhwYW5kZWQ/Ii0iOiIrIjt0aGlzLmV4cGFuZGVyVGV4dE5vZGU9dGhpcy5leHBhbmRlci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShleHBhbmRlclRleHQpKTt0aGlzLmhlYWRpbmdEaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiAiK3RoaXMuZ3JvdXAubmFtZSkpO3RoaXMuY29udGVudERpdj10aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpO3ZhciBjb250ZW50Q3NzQ2xhc3M9dGhpcy5ncm91cC5leHBhbmRlZD8iZXhwYW5kZWQiOiJjb2xsYXBzZWQiO3RoaXMuY29udGVudERpdi5jbGFzc05hbWU9Imdyb3VwY29udGVudCAiK2NvbnRlbnRDc3NDbGFzczt0aGlzLmV4cGFuZGVyLm9uY2xpY2s9ZnVuY3Rpb24oKXtpZihncm91cEVsZW1lbnRDb250YWluZXIuZ3JvdXAuZXhwYW5kYWJsZSl7Z3JvdXBFbGVtZW50Q29udGFpbmVyLmdyb3VwLnRvZ2dsZUV4cGFuZGVkKCk7fX07fX0nLCdHcm91cEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlPW5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpO2NvcHlQcm9wZXJ0aWVzKEdyb3VwRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUse3RvZ2dsZUV4cGFuZGVkOmZ1bmN0aW9uKCl7aWYoIXRoaXMuaXNSb290KXt2YXIgb2xkQ3NzQ2xhc3MsbmV3Q3NzQ2xhc3MsZXhwYW5kZXJUZXh0O2lmKHRoaXMuZ3JvdXAuZXhwYW5kZWQpe25ld0Nzc0NsYXNzPSJleHBhbmRlZCI7b2xkQ3NzQ2xhc3M9ImNvbGxhcHNlZCI7ZXhwYW5kZXJUZXh0PSItIjt9ZWxzZXtuZXdDc3NDbGFzcz0iY29sbGFwc2VkIjtvbGRDc3NDbGFzcz0iZXhwYW5kZWQiO2V4cGFuZGVyVGV4dD0iKyI7fScsJ3JlcGxhY2VDbGFzcyh0aGlzLmNvbnRlbnREaXYsbmV3Q3NzQ2xhc3Msb2xkQ3NzQ2xhc3MpO3RoaXMuZXhwYW5kZXJUZXh0Tm9kZS5ub2RlVmFsdWU9ZXhwYW5kZXJUZXh0O319LHJlbW92ZTpmdW5jdGlvbigpe2lmKCF0aGlzLmlzUm9vdCl7dGhpcy5oZWFkaW5nRGl2PW51bGw7dGhpcy5leHBhbmRlci5vbmNsaWNrPW51bGw7dGhpcy5leHBhbmRlcj1udWxsO3RoaXMuZXhwYW5kZXJUZXh0Tm9kZT1udWxsO3RoaXMuY29udGVudERpdj1udWxsO3RoaXMuY29udGFpbmVyRG9tTm9kZT1udWxsO3RoaXMubWFpbkRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWFpbkRpdik7dGhpcy5tYWluRGl2PW51bGw7fX0scmV2ZXJzZUNoaWxkcmVuOmZ1bmN0aW9uKCl7dmFyIG5vZGU9bnVsbDt2YXIgY2hpbGREb21Ob2Rlcz1bXTt3aGlsZSgobm9kZT10aGlzLmNvbnRlbnREaXYuZmlyc3RDaGlsZCkpe3RoaXMuY29udGVudERpdi5yZW1vdmVDaGlsZChub2RlKTtjaGlsZERvbU5vZGVzLnB1c2gobm9kZSk7fScsJ3doaWxlKChub2RlPWNoaWxkRG9tTm9kZXMucG9wKCkpKXt0aGlzLmNvbnRlbnREaXYuYXBwZW5kQ2hpbGQobm9kZSk7fX0sdXBkYXRlOmZ1bmN0aW9uKCl7aWYoIXRoaXMuaXNSb290KXtpZih0aGlzLmdyb3VwLmV4cGFuZGFibGUpe3JlbW92ZUNsYXNzKHRoaXMuZXhwYW5kZXIsImdyZXllZG91dCIpO31lbHNle2FkZENsYXNzKHRoaXMuZXhwYW5kZXIsImdyZXllZG91dCIpO319fSxjbGVhcjpmdW5jdGlvbigpe2lmKHRoaXMuaXNSb290KXt0aGlzLmNvbnRlbnREaXYuaW5uZXJIVE1MPSIiO319fSk7ZnVuY3Rpb24gR3JvdXAobmFtZSxpc1Jvb3QsaW5pdGlhbGx5RXhwYW5kZWQpe3RoaXMubmFtZT1uYW1lO3RoaXMuZ3JvdXA9bnVsbDt0aGlzLmlzUm9vdD1pc1Jvb3Q7dGhpcy5pbml0aWFsbHlFeHBhbmRlZD1pbml0aWFsbHlFeHBhbmRlZDt0aGlzLmVsZW1lbnRDb250YWluZXJzPVtdO3RoaXMuY2hpbGRyZW49W107dGhpcy5leHBhbmRlZD1pbml0aWFsbHlFeHBhbmRlZDt0aGlzLnJlbmRlcmVkPWZhbHNlO3RoaXMuZXhwYW5kYWJsZT1mYWxzZTt9JywnR3JvdXAucHJvdG90eXBlPW5ldyBMb2dJdGVtKCk7Y29weVByb3BlcnRpZXMoR3JvdXAucHJvdG90eXBlLHthZGRDaGlsZDpmdW5jdGlvbihsb2dJdGVtKXt0aGlzLmNoaWxkcmVuLnB1c2gobG9nSXRlbSk7bG9nSXRlbS5ncm91cD10aGlzO30scmVuZGVyOmZ1bmN0aW9uKCl7aWYoaXNJZSl7dmFyIHVud3JhcHBlZERvbUNvbnRhaW5lcix3cmFwcGVkRG9tQ29udGFpbmVyO2lmKHRoaXMuaXNSb290KXt1bndyYXBwZWREb21Db250YWluZXI9bG9nTWFpbkNvbnRhaW5lcjt3cmFwcGVkRG9tQ29udGFpbmVyPWxvZ01haW5Db250YWluZXI7fWVsc2V7dW53cmFwcGVkRG9tQ29udGFpbmVyPXRoaXMuZ2V0VW53cmFwcGVkRG9tQ29udGFpbmVyKCk7d3JhcHBlZERvbUNvbnRhaW5lcj10aGlzLmdldFdyYXBwZWREb21Db250YWluZXIoKTt9JywndGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBHcm91cEVsZW1lbnRDb250YWluZXIodGhpcyx1bndyYXBwZWREb21Db250YWluZXIsdGhpcy5pc1Jvb3QsZmFsc2UpO3RoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXI9bmV3IEdyb3VwRWxlbWVudENvbnRhaW5lcih0aGlzLHdyYXBwZWREb21Db250YWluZXIsdGhpcy5pc1Jvb3QsdHJ1ZSk7dGhpcy5lbGVtZW50Q29udGFpbmVycz1bdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyLHRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXJdO31lbHNle3ZhciBtYWluRG9tQ29udGFpbmVyPXRoaXMuaXNSb290P2xvZ01haW5Db250YWluZXI6dGhpcy5nZXRNYWluRG9tQ29udGFpbmVyKCk7dGhpcy5tYWluRWxlbWVudENvbnRhaW5lcj1uZXcgR3JvdXBFbGVtZW50Q29udGFpbmVyKHRoaXMsbWFpbkRvbUNvbnRhaW5lcix0aGlzLmlzUm9vdCxmYWxzZSk7dGhpcy5lbGVtZW50Q29udGFpbmVycz1bdGhpcy5tYWluRWxlbWVudENvbnRhaW5lcl07fScsJ3RoaXMucmVuZGVyZWQ9dHJ1ZTt9LHRvZ2dsZUV4cGFuZGVkOmZ1bmN0aW9uKCl7dGhpcy5leHBhbmRlZD0hdGhpcy5leHBhbmRlZDtmb3IodmFyIGk9MCxsZW49dGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnRvZ2dsZUV4cGFuZGVkKCk7fX0sZXhwYW5kOmZ1bmN0aW9uKCl7aWYoIXRoaXMuZXhwYW5kZWQpe3RoaXMudG9nZ2xlRXhwYW5kZWQoKTt9fSxhY2NlcHQ6ZnVuY3Rpb24odmlzaXRvcil7dmlzaXRvci52aXNpdEdyb3VwKHRoaXMpO30scmV2ZXJzZUNoaWxkcmVuOmZ1bmN0aW9uKCl7aWYodGhpcy5yZW5kZXJlZCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5yZXZlcnNlQ2hpbGRyZW4oKTt9fX0sdXBkYXRlOmZ1bmN0aW9uKCl7dmFyIHByZXZpb3VzbHlFeHBhbmRhYmxlPXRoaXMuZXhwYW5kYWJsZTt0aGlzLmV4cGFuZGFibGU9KHRoaXMuY2hpbGRyZW4ubGVuZ3RoIT09MCk7aWYodGhpcy5leHBhbmRhYmxlIT09cHJldmlvdXNseUV4cGFuZGFibGUpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0udXBkYXRlKCk7fX19LGZsYXR0ZW46ZnVuY3Rpb24oKXt2YXIgdmlzaXRvcj1uZXcgR3JvdXBGbGF0dGVuZXIoKTt0aGlzLmFjY2VwdCh2aXNpdG9yKTtyZXR1cm4gdmlzaXRvci5sb2dFbnRyaWVzQW5kU2VwYXJhdG9yczt9LHJlbW92ZUNoaWxkOmZ1bmN0aW9uKGNoaWxkLGRvVXBkYXRlKXthcnJheV9yZW1vdmUodGhpcy5jaGlsZHJlbixjaGlsZCk7Y2hpbGQuZ3JvdXA9bnVsbDtpZihkb1VwZGF0ZSl7dGhpcy51cGRhdGUoKTt9fSxyZW1vdmU6ZnVuY3Rpb24oZG9VcGRhdGUscmVtb3ZlRnJvbUdyb3VwKXtmb3IodmFyIGk9MCxsZW49dGhpcy5jaGlsZHJlbi5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZShmYWxzZSxmYWxzZSk7fScsJ3RoaXMuY2hpbGRyZW49W107dGhpcy51cGRhdGUoKTtpZih0aGlzPT09Y3VycmVudEdyb3VwKXtjdXJyZW50R3JvdXA9dGhpcy5ncm91cDt9JywndGhpcy5kb1JlbW92ZShkb1VwZGF0ZSxyZW1vdmVGcm9tR3JvdXApO30sc2VyaWFsaXplOmZ1bmN0aW9uKGl0ZW1zKXtpdGVtcy5wdXNoKFtMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9TVEFSVCx0aGlzLm5hbWVdKTtmb3IodmFyIGk9MCxsZW49dGhpcy5jaGlsZHJlbi5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLmNoaWxkcmVuW2ldLnNlcmlhbGl6ZShpdGVtcyk7fScsJ2lmKHRoaXMhPT1jdXJyZW50R3JvdXApe2l0ZW1zLnB1c2goW0xvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkdST1VQX0VORF0pO319LGNsZWFyOmZ1bmN0aW9uKCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5jbGVhcigpO319fSk7ZnVuY3Rpb24gTG9nRW50cnlFbGVtZW50Q29udGFpbmVyKCl7fScsJ0xvZ0VudHJ5RWxlbWVudENvbnRhaW5lci5wcm90b3R5cGU9bmV3IExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCk7Y29weVByb3BlcnRpZXMoTG9nRW50cnlFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSx7cmVtb3ZlOmZ1bmN0aW9uKCl7dGhpcy5kb1JlbW92ZSgpO30sZG9SZW1vdmU6ZnVuY3Rpb24oKXt0aGlzLm1haW5EaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1haW5EaXYpO3RoaXMubWFpbkRpdj1udWxsO3RoaXMuY29udGVudEVsZW1lbnQ9bnVsbDt0aGlzLmNvbnRhaW5lckRvbU5vZGU9bnVsbDt9LHNldENvbnRlbnQ6ZnVuY3Rpb24oY29udGVudCx3cmFwcGVkQ29udGVudCl7aWYoY29udGVudD09PXRoaXMuZm9ybWF0dGVkTWVzc2FnZSl7dGhpcy5jb250ZW50RWxlbWVudC5pbm5lckhUTUw9IiI7dGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKTt9ZWxzZXt0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTD1jb250ZW50O319LHNldFNlYXJjaE1hdGNoOmZ1bmN0aW9uKGlzTWF0Y2gpe3ZhciBvbGRDc3NDbGFzcz1pc01hdGNoPyJzZWFyY2hub25tYXRjaCI6InNlYXJjaG1hdGNoIjt2YXIgbmV3Q3NzQ2xhc3M9aXNNYXRjaD8ic2VhcmNobWF0Y2giOiJzZWFyY2hub25tYXRjaCI7cmVwbGFjZUNsYXNzKHRoaXMubWFpbkRpdixuZXdDc3NDbGFzcyxvbGRDc3NDbGFzcyk7fSxjbGVhclNlYXJjaDpmdW5jdGlvbigpe3JlbW92ZUNsYXNzKHRoaXMubWFpbkRpdiwic2VhcmNobWF0Y2giKTtyZW1vdmVDbGFzcyh0aGlzLm1haW5EaXYsInNlYXJjaG5vbm1hdGNoIik7fX0pO2Z1bmN0aW9uIExvZ0VudHJ5V3JhcHBlZEVsZW1lbnRDb250YWluZXIobG9nRW50cnksY29udGFpbmVyRG9tTm9kZSl7dGhpcy5sb2dFbnRyeT1sb2dFbnRyeTt0aGlzLmNvbnRhaW5lckRvbU5vZGU9Y29udGFpbmVyRG9tTm9kZTt0aGlzLm1haW5EaXY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMubG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSkpO3RoaXMubWFpbkRpdi5jbGFzc05hbWU9ImxvZ2VudHJ5IHdyYXBwZWQgIit0aGlzLmxvZ0VudHJ5LmxldmVsO3RoaXMuY29udGVudEVsZW1lbnQ9dGhpcy5tYWluRGl2O30nLCdMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZT1uZXcgTG9nRW50cnlFbGVtZW50Q29udGFpbmVyKCk7TG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuc2V0Q29udGVudD1mdW5jdGlvbihjb250ZW50LHdyYXBwZWRDb250ZW50KXtpZihjb250ZW50PT09dGhpcy5mb3JtYXR0ZWRNZXNzYWdlKXt0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTD0iIjt0aGlzLmNvbnRlbnRFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuZm9ybWF0dGVkTWVzc2FnZSkpO31lbHNle3RoaXMuY29udGVudEVsZW1lbnQuaW5uZXJIVE1MPXdyYXBwZWRDb250ZW50O319O2Z1bmN0aW9uIExvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lcihsb2dFbnRyeSxjb250YWluZXJEb21Ob2RlKXt0aGlzLmxvZ0VudHJ5PWxvZ0VudHJ5O3RoaXMuY29udGFpbmVyRG9tTm9kZT1jb250YWluZXJEb21Ob2RlO3RoaXMubWFpbkRpdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLm1haW5EaXYuY2xhc3NOYW1lPSJsb2dlbnRyeSB1bndyYXBwZWQgIit0aGlzLmxvZ0VudHJ5LmxldmVsO3RoaXMucHJlPXRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwcmUiKSk7dGhpcy5wcmUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5sb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlKSk7dGhpcy5wcmUuY2xhc3NOYW1lPSJ1bndyYXBwZWQiO3RoaXMuY29udGVudEVsZW1lbnQ9dGhpcy5wcmU7fScsJ0xvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGU9bmV3IExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpO0xvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKCl7dGhpcy5kb1JlbW92ZSgpO3RoaXMucHJlPW51bGw7fTtmdW5jdGlvbiBMb2dFbnRyeU1haW5FbGVtZW50Q29udGFpbmVyKGxvZ0VudHJ5LGNvbnRhaW5lckRvbU5vZGUpe3RoaXMubG9nRW50cnk9bG9nRW50cnk7dGhpcy5jb250YWluZXJEb21Ob2RlPWNvbnRhaW5lckRvbU5vZGU7dGhpcy5tYWluRGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMubWFpbkRpdi5jbGFzc05hbWU9ImxvZ2VudHJ5IG5vbmllbG9nZW50cnkgIit0aGlzLmxvZ0VudHJ5LmxldmVsO3RoaXMuY29udGVudEVsZW1lbnQ9dGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSk7dGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpKTt9JywnTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGU9bmV3IExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpO2Z1bmN0aW9uIExvZ0VudHJ5KGxldmVsLGZvcm1hdHRlZE1lc3NhZ2Upe3RoaXMubGV2ZWw9bGV2ZWw7dGhpcy5mb3JtYXR0ZWRNZXNzYWdlPWZvcm1hdHRlZE1lc3NhZ2U7dGhpcy5yZW5kZXJlZD1mYWxzZTt9JywnTG9nRW50cnkucHJvdG90eXBlPW5ldyBMb2dJdGVtKCk7Y29weVByb3BlcnRpZXMoTG9nRW50cnkucHJvdG90eXBlLHtyZW5kZXI6ZnVuY3Rpb24oKXt2YXIgbG9nRW50cnk9dGhpczt2YXIgY29udGFpbmVyRG9tTm9kZT10aGlzLmdyb3VwLmNvbnRlbnREaXY7aWYoaXNJZSl7dGhpcy5mb3JtYXR0ZWRNZXNzYWdlPXRoaXMuZm9ybWF0dGVkTWVzc2FnZS5yZXBsYWNlKC9cXHJcXG4vZywiXFxyIik7dGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBMb2dFbnRyeVVud3JhcHBlZEVsZW1lbnRDb250YWluZXIodGhpcyx0aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpKTt0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyPW5ldyBMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyKHRoaXMsdGhpcy5nZXRXcmFwcGVkRG9tQ29udGFpbmVyKCkpO3RoaXMuZWxlbWVudENvbnRhaW5lcnM9W3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lcix0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyXTt9ZWxzZXt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyPW5ldyBMb2dFbnRyeU1haW5FbGVtZW50Q29udGFpbmVyKHRoaXMsdGhpcy5nZXRNYWluRG9tQ29udGFpbmVyKCkpO3RoaXMuZWxlbWVudENvbnRhaW5lcnM9W3RoaXMubWFpbkVsZW1lbnRDb250YWluZXJdO30nLCd0aGlzLmNvbnRlbnQ9dGhpcy5mb3JtYXR0ZWRNZXNzYWdlO3RoaXMucmVuZGVyZWQ9dHJ1ZTt9LHNldENvbnRlbnQ6ZnVuY3Rpb24oY29udGVudCx3cmFwcGVkQ29udGVudCl7aWYoY29udGVudCE9dGhpcy5jb250ZW50KXtpZihpc0llJiYoY29udGVudCE9PXRoaXMuZm9ybWF0dGVkTWVzc2FnZSkpe2NvbnRlbnQ9Y29udGVudC5yZXBsYWNlKC9cXHJcXG4vZywiXFxyIik7fScsJ2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uc2V0Q29udGVudChjb250ZW50LHdyYXBwZWRDb250ZW50KTt9JywndGhpcy5jb250ZW50PWNvbnRlbnQ7fX0sZ2V0U2VhcmNoTWF0Y2hlczpmdW5jdGlvbigpe3ZhciBtYXRjaGVzPVtdO3ZhciBpLGxlbjtpZihpc0llKXt2YXIgdW53cmFwcGVkRWxzPWdldEVsZW1lbnRzQnlDbGFzcyh0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIubWFpbkRpdiwic2VhcmNodGVybSIsInNwYW4iKTt2YXIgd3JhcHBlZEVscz1nZXRFbGVtZW50c0J5Q2xhc3ModGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lci5tYWluRGl2LCJzZWFyY2h0ZXJtIiwic3BhbiIpO2ZvcihpPTAsbGVuPXVud3JhcHBlZEVscy5sZW5ndGg7aTxsZW47aSsrKXttYXRjaGVzW2ldPW5ldyBNYXRjaCh0aGlzLmxldmVsLG51bGwsdW53cmFwcGVkRWxzW2ldLHdyYXBwZWRFbHNbaV0pO319ZWxzZXt2YXIgZWxzPWdldEVsZW1lbnRzQnlDbGFzcyh0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyLm1haW5EaXYsInNlYXJjaHRlcm0iLCJzcGFuIik7Zm9yKGk9MCxsZW49ZWxzLmxlbmd0aDtpPGxlbjtpKyspe21hdGNoZXNbaV09bmV3IE1hdGNoKHRoaXMubGV2ZWwsZWxzW2ldKTt9fScsJ3JldHVybiBtYXRjaGVzO30sc2V0U2VhcmNoTWF0Y2g6ZnVuY3Rpb24oaXNNYXRjaCl7Zm9yKHZhciBpPTAsbGVuPXRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoO2k8bGVuO2krKyl7dGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5zZXRTZWFyY2hNYXRjaChpc01hdGNoKTt9fSxjbGVhclNlYXJjaDpmdW5jdGlvbigpe2Zvcih2YXIgaT0wLGxlbj10aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDtpPGxlbjtpKyspe3RoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uY2xlYXJTZWFyY2goKTt9fSxhY2NlcHQ6ZnVuY3Rpb24odmlzaXRvcil7dmlzaXRvci52aXNpdExvZ0VudHJ5KHRoaXMpO30sc2VyaWFsaXplOmZ1bmN0aW9uKGl0ZW1zKXtpdGVtcy5wdXNoKFtMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5MT0dfRU5UUlksdGhpcy5sZXZlbCx0aGlzLmZvcm1hdHRlZE1lc3NhZ2VdKTt9fSk7ZnVuY3Rpb24gTG9nSXRlbVZpc2l0b3IoKXt9JywnTG9nSXRlbVZpc2l0b3IucHJvdG90eXBlPXt2aXNpdDpmdW5jdGlvbihsb2dJdGVtKXt9LHZpc2l0UGFyZW50OmZ1bmN0aW9uKGxvZ0l0ZW0pe2lmKGxvZ0l0ZW0uZ3JvdXApe2xvZ0l0ZW0uZ3JvdXAuYWNjZXB0KHRoaXMpO319LHZpc2l0Q2hpbGRyZW46ZnVuY3Rpb24obG9nSXRlbSl7Zm9yKHZhciBpPTAsbGVuPWxvZ0l0ZW0uY2hpbGRyZW4ubGVuZ3RoO2k8bGVuO2krKyl7bG9nSXRlbS5jaGlsZHJlbltpXS5hY2NlcHQodGhpcyk7fX0sdmlzaXRMb2dFbnRyeTpmdW5jdGlvbihsb2dFbnRyeSl7dGhpcy52aXNpdChsb2dFbnRyeSk7fSx2aXNpdFNlcGFyYXRvcjpmdW5jdGlvbihzZXBhcmF0b3Ipe3RoaXMudmlzaXQoc2VwYXJhdG9yKTt9LHZpc2l0R3JvdXA6ZnVuY3Rpb24oZ3JvdXApe3RoaXMudmlzaXQoZ3JvdXApO319O2Z1bmN0aW9uIEdyb3VwRmxhdHRlbmVyKCl7dGhpcy5sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycz1bXTt9JywnR3JvdXBGbGF0dGVuZXIucHJvdG90eXBlPW5ldyBMb2dJdGVtVmlzaXRvcigpO0dyb3VwRmxhdHRlbmVyLnByb3RvdHlwZS52aXNpdEdyb3VwPWZ1bmN0aW9uKGdyb3VwKXt0aGlzLnZpc2l0Q2hpbGRyZW4oZ3JvdXApO307R3JvdXBGbGF0dGVuZXIucHJvdG90eXBlLnZpc2l0TG9nRW50cnk9ZnVuY3Rpb24obG9nRW50cnkpe3RoaXMubG9nRW50cmllc0FuZFNlcGFyYXRvcnMucHVzaChsb2dFbnRyeSk7fTtHcm91cEZsYXR0ZW5lci5wcm90b3R5cGUudmlzaXRTZXBhcmF0b3I9ZnVuY3Rpb24oc2VwYXJhdG9yKXt0aGlzLmxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2goc2VwYXJhdG9yKTt9O3dpbmRvdy5vbmxvYWQ9ZnVuY3Rpb24oKXtpZihsb2NhdGlvbi5zZWFyY2gpe3ZhciBxdWVyeUJpdHM9dW5lc2NhcGUobG9jYXRpb24uc2VhcmNoKS5zdWJzdHIoMSkuc3BsaXQoIiYiKSxuYW1lVmFsdWVCaXRzO2Zvcih2YXIgaT0wLGxlbj1xdWVyeUJpdHMubGVuZ3RoO2k8bGVuO2krKyl7bmFtZVZhbHVlQml0cz1xdWVyeUJpdHNbaV0uc3BsaXQoIj0iKTtpZihuYW1lVmFsdWVCaXRzWzBdPT0ibG9nNGphdmFzY3JpcHRfZG9tYWluIil7ZG9jdW1lbnQuZG9tYWluPW5hbWVWYWx1ZUJpdHNbMV07YnJlYWs7fX19JywnbG9nTWFpbkNvbnRhaW5lcj0kKCJsb2ciKTtpZihpc0llUHJlNyl7YWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwib2xkSWUiKTt9Jywncm9vdEdyb3VwPW5ldyBHcm91cCgicm9vdCIsdHJ1ZSk7cm9vdEdyb3VwLnJlbmRlcigpO2N1cnJlbnRHcm91cD1yb290R3JvdXA7c2V0Q29tbWFuZElucHV0V2lkdGgoKTtzZXRMb2dDb250YWluZXJIZWlnaHQoKTt0b2dnbGVMb2dnaW5nRW5hYmxlZCgpO3RvZ2dsZVNlYXJjaEVuYWJsZWQoKTt0b2dnbGVTZWFyY2hGaWx0ZXIoKTt0b2dnbGVTZWFyY2hIaWdobGlnaHQoKTthcHBseUZpbHRlcnMoKTtjaGVja0FsbExldmVscygpO3RvZ2dsZVdyYXAoKTt0b2dnbGVOZXdlc3RBdFRvcCgpO3RvZ2dsZVNjcm9sbFRvTGF0ZXN0KCk7cmVuZGVyUXVldWVkTG9nSXRlbXMoKTtsb2FkZWQ9dHJ1ZTskKCJjb21tYW5kIikudmFsdWU9IiI7JCgiY29tbWFuZCIpLmF1dG9jb21wbGV0ZT0ib2ZmIjskKCJjb21tYW5kIikub25rZXlkb3duPWZ1bmN0aW9uKGV2dCl7ZXZ0PWdldEV2ZW50KGV2dCk7aWYoZXZ0LmtleUNvZGU9PTEwfHxldnQua2V5Q29kZT09MTMpe2V2YWxDb21tYW5kTGluZSgpO3N0b3BQcm9wYWdhdGlvbihldnQpO31lbHNlIGlmKGV2dC5rZXlDb2RlPT0yNyl7dGhpcy52YWx1ZT0iIjt0aGlzLmZvY3VzKCk7fWVsc2UgaWYoZXZ0LmtleUNvZGU9PTM4JiZjb21tYW5kSGlzdG9yeS5sZW5ndGg+MCl7Y3VycmVudENvbW1hbmRJbmRleD1NYXRoLm1heCgwLGN1cnJlbnRDb21tYW5kSW5kZXgtMSk7dGhpcy52YWx1ZT1jb21tYW5kSGlzdG9yeVtjdXJyZW50Q29tbWFuZEluZGV4XTttb3ZlQ2FyZXRUb0VuZCh0aGlzKTt9ZWxzZSBpZihldnQua2V5Q29kZT09NDAmJmNvbW1hbmRIaXN0b3J5Lmxlbmd0aD4wKXtjdXJyZW50Q29tbWFuZEluZGV4PU1hdGgubWluKGNvbW1hbmRIaXN0b3J5Lmxlbmd0aC0xLGN1cnJlbnRDb21tYW5kSW5kZXgrMSk7dGhpcy52YWx1ZT1jb21tYW5kSGlzdG9yeVtjdXJyZW50Q29tbWFuZEluZGV4XTttb3ZlQ2FyZXRUb0VuZCh0aGlzKTt9fTskKCJjb21tYW5kIikub25rZXlwcmVzcz1mdW5jdGlvbihldnQpe2V2dD1nZXRFdmVudChldnQpO2lmKGV2dC5rZXlDb2RlPT0zOCYmY29tbWFuZEhpc3RvcnkubGVuZ3RoPjAmJmV2dC5wcmV2ZW50RGVmYXVsdCl7ZXZ0LnByZXZlbnREZWZhdWx0KCk7fX07JCgiY29tbWFuZCIpLm9ua2V5dXA9ZnVuY3Rpb24oZXZ0KXtldnQ9Z2V0RXZlbnQoZXZ0KTtpZihldnQua2V5Q29kZT09MjcmJmV2dC5wcmV2ZW50RGVmYXVsdCl7ZXZ0LnByZXZlbnREZWZhdWx0KCk7dGhpcy5mb2N1cygpO319O2RvY3VtZW50Lm9ua2V5ZG93bj1mdW5jdGlvbiBrZXlFdmVudEhhbmRsZXIoZXZ0KXtldnQ9Z2V0RXZlbnQoZXZ0KTtzd2l0Y2goZXZ0LmtleUNvZGUpe2Nhc2UgNjk6aWYoZXZ0LnNoaWZ0S2V5JiYoZXZ0LmN0cmxLZXl8fGV2dC5tZXRhS2V5KSl7ZXZhbExhc3RDb21tYW5kKCk7Y2FuY2VsS2V5RXZlbnQoZXZ0KTtyZXR1cm4gZmFsc2U7fScsJ2JyZWFrO2Nhc2UgNzU6aWYoZXZ0LnNoaWZ0S2V5JiYoZXZ0LmN0cmxLZXl8fGV2dC5tZXRhS2V5KSl7Zm9jdXNTZWFyY2goKTtjYW5jZWxLZXlFdmVudChldnQpO3JldHVybiBmYWxzZTt9JywnYnJlYWs7Y2FzZSA0MDpjYXNlIDc2OmlmKGV2dC5zaGlmdEtleSYmKGV2dC5jdHJsS2V5fHxldnQubWV0YUtleSkpe2ZvY3VzQ29tbWFuZExpbmUoKTtjYW5jZWxLZXlFdmVudChldnQpO3JldHVybiBmYWxzZTt9JywnYnJlYWs7fX07c2V0VGltZW91dChzZXRMb2dDb250YWluZXJIZWlnaHQsMjApO3NldFNob3dDb21tYW5kTGluZShzaG93Q29tbWFuZExpbmUpO2RvU2VhcmNoKCk7fTt3aW5kb3cub251bmxvYWQ9ZnVuY3Rpb24oKXtpZihtYWluV2luZG93RXhpc3RzKCkpe2FwcGVuZGVyLnVubG9hZCgpO30nLCdhcHBlbmRlcj1udWxsO307ZnVuY3Rpb24gdG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKXtzZXRMb2dnaW5nRW5hYmxlZCgkKCJlbmFibGVMb2dnaW5nIikuY2hlY2tlZCk7fScsJ2Z1bmN0aW9uIHNldExvZ2dpbmdFbmFibGVkKGVuYWJsZSl7bG9nZ2luZ0VuYWJsZWQ9ZW5hYmxlO30nLCd2YXIgYXBwZW5kZXI9bnVsbDtmdW5jdGlvbiBzZXRBcHBlbmRlcihhcHBlbmRlclBhcmFtKXthcHBlbmRlcj1hcHBlbmRlclBhcmFtO30nLCdmdW5jdGlvbiBzZXRTaG93Q2xvc2VCdXR0b24oc2hvd0Nsb3NlQnV0dG9uKXskKCJjbG9zZUJ1dHRvbiIpLnN0eWxlLmRpc3BsYXk9c2hvd0Nsb3NlQnV0dG9uPyJpbmxpbmUiOiJub25lIjt9JywnZnVuY3Rpb24gc2V0U2hvd0hpZGVCdXR0b24oc2hvd0hpZGVCdXR0b24peyQoImhpZGVCdXR0b24iKS5zdHlsZS5kaXNwbGF5PXNob3dIaWRlQnV0dG9uPyJpbmxpbmUiOiJub25lIjt9JywndmFyIG5ld2VzdEF0VG9wPWZhbHNlO2Z1bmN0aW9uIExvZ0l0ZW1Db250ZW50UmV2ZXJzZXIoKXt9JywnTG9nSXRlbUNvbnRlbnRSZXZlcnNlci5wcm90b3R5cGU9bmV3IExvZ0l0ZW1WaXNpdG9yKCk7TG9nSXRlbUNvbnRlbnRSZXZlcnNlci5wcm90b3R5cGUudmlzaXRHcm91cD1mdW5jdGlvbihncm91cCl7Z3JvdXAucmV2ZXJzZUNoaWxkcmVuKCk7dGhpcy52aXNpdENoaWxkcmVuKGdyb3VwKTt9O2Z1bmN0aW9uIHNldE5ld2VzdEF0VG9wKGlzTmV3ZXN0QXRUb3Ape3ZhciBvbGROZXdlc3RBdFRvcD1uZXdlc3RBdFRvcDt2YXIgaSxpTGVuLGosakxlbjtuZXdlc3RBdFRvcD1Cb29sZWFuKGlzTmV3ZXN0QXRUb3ApO2lmKG9sZE5ld2VzdEF0VG9wIT1uZXdlc3RBdFRvcCl7dmFyIHZpc2l0b3I9bmV3IExvZ0l0ZW1Db250ZW50UmV2ZXJzZXIoKTtyb290R3JvdXAuYWNjZXB0KHZpc2l0b3IpO2lmKGN1cnJlbnRTZWFyY2gpe3ZhciBjdXJyZW50TWF0Y2g9Y3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XTt2YXIgbWF0Y2hJbmRleD0wO3ZhciBtYXRjaGVzPVtdO3ZhciBhY3RPbkxvZ0VudHJ5PWZ1bmN0aW9uKGxvZ0VudHJ5KXt2YXIgbG9nRW50cnlNYXRjaGVzPWxvZ0VudHJ5LmdldFNlYXJjaE1hdGNoZXMoKTtmb3Ioaj0wLGpMZW49bG9nRW50cnlNYXRjaGVzLmxlbmd0aDtqPGpMZW47aisrKXttYXRjaGVzW21hdGNoSW5kZXhdPWxvZ0VudHJ5TWF0Y2hlc1tqXTtpZihjdXJyZW50TWF0Y2gmJmxvZ0VudHJ5TWF0Y2hlc1tqXS5lcXVhbHMoY3VycmVudE1hdGNoKSl7Y3VycmVudE1hdGNoSW5kZXg9bWF0Y2hJbmRleDt9JywnbWF0Y2hJbmRleCsrO319O2lmKG5ld2VzdEF0VG9wKXtmb3IoaT1sb2dFbnRyaWVzLmxlbmd0aC0xO2k+PTA7aS0tKXthY3RPbkxvZ0VudHJ5KGxvZ0VudHJpZXNbaV0pO319ZWxzZXtmb3IoaT0wLGlMZW49bG9nRW50cmllcy5sZW5ndGg7aTxpTGVuO2krKyl7YWN0T25Mb2dFbnRyeShsb2dFbnRyaWVzW2ldKTt9fScsJ2N1cnJlbnRTZWFyY2gubWF0Y2hlcz1tYXRjaGVzO2lmKGN1cnJlbnRNYXRjaCl7Y3VycmVudE1hdGNoLnNldEN1cnJlbnQoKTt9fWVsc2UgaWYoc2Nyb2xsVG9MYXRlc3Qpe2RvU2Nyb2xsVG9MYXRlc3QoKTt9fScsJyQoIm5ld2VzdEF0VG9wIikuY2hlY2tlZD1pc05ld2VzdEF0VG9wO30nLCdmdW5jdGlvbiB0b2dnbGVOZXdlc3RBdFRvcCgpe3ZhciBpc05ld2VzdEF0VG9wPSQoIm5ld2VzdEF0VG9wIikuY2hlY2tlZDtzZXROZXdlc3RBdFRvcChpc05ld2VzdEF0VG9wKTt9JywndmFyIHNjcm9sbFRvTGF0ZXN0PXRydWU7ZnVuY3Rpb24gc2V0U2Nyb2xsVG9MYXRlc3QoaXNTY3JvbGxUb0xhdGVzdCl7c2Nyb2xsVG9MYXRlc3Q9aXNTY3JvbGxUb0xhdGVzdDtpZihzY3JvbGxUb0xhdGVzdCl7ZG9TY3JvbGxUb0xhdGVzdCgpO30nLCckKCJzY3JvbGxUb0xhdGVzdCIpLmNoZWNrZWQ9aXNTY3JvbGxUb0xhdGVzdDt9JywnZnVuY3Rpb24gdG9nZ2xlU2Nyb2xsVG9MYXRlc3QoKXt2YXIgaXNTY3JvbGxUb0xhdGVzdD0kKCJzY3JvbGxUb0xhdGVzdCIpLmNoZWNrZWQ7c2V0U2Nyb2xsVG9MYXRlc3QoaXNTY3JvbGxUb0xhdGVzdCk7fScsJ2Z1bmN0aW9uIGRvU2Nyb2xsVG9MYXRlc3QoKXt2YXIgbD1sb2dNYWluQ29udGFpbmVyO2lmKHR5cGVvZiBsLnNjcm9sbFRvcCE9InVuZGVmaW5lZCIpe2lmKG5ld2VzdEF0VG9wKXtsLnNjcm9sbFRvcD0wO31lbHNle3ZhciBsYXRlc3RMb2dFbnRyeT1sLmxhc3RDaGlsZDtpZihsYXRlc3RMb2dFbnRyeSl7bC5zY3JvbGxUb3A9bC5zY3JvbGxIZWlnaHQ7fX19fScsJ3ZhciBjbG9zZUlmT3BlbmVyQ2xvc2VzPXRydWU7ZnVuY3Rpb24gc2V0Q2xvc2VJZk9wZW5lckNsb3Nlcyhpc0Nsb3NlSWZPcGVuZXJDbG9zZXMpe2Nsb3NlSWZPcGVuZXJDbG9zZXM9aXNDbG9zZUlmT3BlbmVyQ2xvc2VzO30nLCd2YXIgbWF4TWVzc2FnZXM9bnVsbDtmdW5jdGlvbiBzZXRNYXhNZXNzYWdlcyhtYXgpe21heE1lc3NhZ2VzPW1heDtwcnVuZUxvZ0VudHJpZXMoKTt9JywndmFyIHNob3dDb21tYW5kTGluZT1mYWxzZTtmdW5jdGlvbiBzZXRTaG93Q29tbWFuZExpbmUoaXNTaG93Q29tbWFuZExpbmUpe3Nob3dDb21tYW5kTGluZT1pc1Nob3dDb21tYW5kTGluZTtpZihsb2FkZWQpeyQoImNvbW1hbmRMaW5lIikuc3R5bGUuZGlzcGxheT1zaG93Q29tbWFuZExpbmU/ImJsb2NrIjoibm9uZSI7c2V0Q29tbWFuZElucHV0V2lkdGgoKTtzZXRMb2dDb250YWluZXJIZWlnaHQoKTt9fScsJ2Z1bmN0aW9uIGZvY3VzQ29tbWFuZExpbmUoKXtpZihsb2FkZWQpeyQoImNvbW1hbmQiKS5mb2N1cygpO319JywnZnVuY3Rpb24gZm9jdXNTZWFyY2goKXtpZihsb2FkZWQpeyQoInNlYXJjaEJveCIpLmZvY3VzKCk7fX0nLCdmdW5jdGlvbiBnZXRMb2dJdGVtcygpe3ZhciBpdGVtcz1bXTtmb3IodmFyIGk9MCxsZW49bG9nSXRlbXMubGVuZ3RoO2k8bGVuO2krKyl7bG9nSXRlbXNbaV0uc2VyaWFsaXplKGl0ZW1zKTt9JywncmV0dXJuIGl0ZW1zO30nLCdmdW5jdGlvbiBzZXRMb2dJdGVtcyhpdGVtcyl7dmFyIGxvZ2dpbmdSZWFsbHlFbmFibGVkPWxvZ2dpbmdFbmFibGVkO2xvZ2dpbmdFbmFibGVkPXRydWU7Zm9yKHZhciBpPTAsbGVuPWl0ZW1zLmxlbmd0aDtpPGxlbjtpKyspe3N3aXRjaChpdGVtc1tpXVswXSl7Y2FzZSBMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5MT0dfRU5UUlk6bG9nKGl0ZW1zW2ldWzFdLGl0ZW1zW2ldWzJdKTticmVhaztjYXNlIExvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkdST1VQX1NUQVJUOmdyb3VwKGl0ZW1zW2ldWzFdKTticmVhaztjYXNlIExvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkdST1VQX0VORDpncm91cEVuZCgpO2JyZWFrO319JywnbG9nZ2luZ0VuYWJsZWQ9bG9nZ2luZ1JlYWxseUVuYWJsZWQ7fScsJ2Z1bmN0aW9uIGxvZyhsb2dMZXZlbCxmb3JtYXR0ZWRNZXNzYWdlKXtpZihsb2dnaW5nRW5hYmxlZCl7dmFyIGxvZ0VudHJ5PW5ldyBMb2dFbnRyeShsb2dMZXZlbCxmb3JtYXR0ZWRNZXNzYWdlKTtsb2dFbnRyaWVzLnB1c2gobG9nRW50cnkpO2xvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2gobG9nRW50cnkpO2xvZ0l0ZW1zLnB1c2gobG9nRW50cnkpO2N1cnJlbnRHcm91cC5hZGRDaGlsZChsb2dFbnRyeSk7aWYobG9hZGVkKXtpZihsb2dRdWV1ZWRFdmVudHNUaW1lciE9PW51bGwpe2NsZWFyVGltZW91dChsb2dRdWV1ZWRFdmVudHNUaW1lcik7fScsJ2xvZ1F1ZXVlZEV2ZW50c1RpbWVyPXNldFRpbWVvdXQocmVuZGVyUXVldWVkTG9nSXRlbXMscmVuZGVyRGVsYXkpO3VucmVuZGVyZWRMb2dJdGVtc0V4aXN0PXRydWU7fX19JywnZnVuY3Rpb24gcmVuZGVyUXVldWVkTG9nSXRlbXMoKXtsb2dRdWV1ZWRFdmVudHNUaW1lcj1udWxsO3ZhciBwcnVuZWQ9cHJ1bmVMb2dFbnRyaWVzKCk7dmFyIGluaXRpYWxseUhhc01hdGNoZXM9Y3VycmVudFNlYXJjaD9jdXJyZW50U2VhcmNoLmhhc01hdGNoZXMoKTpmYWxzZTtmb3IodmFyIGk9MCxsZW49bG9nSXRlbXMubGVuZ3RoO2k8bGVuO2krKyl7aWYoIWxvZ0l0ZW1zW2ldLnJlbmRlcmVkKXtsb2dJdGVtc1tpXS5yZW5kZXIoKTtsb2dJdGVtc1tpXS5hcHBlbmRUb0xvZygpO2lmKGN1cnJlbnRTZWFyY2gmJihsb2dJdGVtc1tpXWluc3RhbmNlb2YgTG9nRW50cnkpKXtjdXJyZW50U2VhcmNoLmFwcGx5VG8obG9nSXRlbXNbaV0pO319fScsJ2lmKGN1cnJlbnRTZWFyY2gpe2lmKHBydW5lZCl7aWYoY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKXtpZihjdXJyZW50TWF0Y2hJbmRleD09PW51bGwpe3NldEN1cnJlbnRNYXRjaEluZGV4KDApO30nLCdkaXNwbGF5TWF0Y2hlcygpO31lbHNle2Rpc3BsYXlOb01hdGNoZXMoKTt9fWVsc2UgaWYoIWluaXRpYWxseUhhc01hdGNoZXMmJmN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSl7c2V0Q3VycmVudE1hdGNoSW5kZXgoMCk7ZGlzcGxheU1hdGNoZXMoKTt9fScsJ2lmKHNjcm9sbFRvTGF0ZXN0KXtkb1Njcm9sbFRvTGF0ZXN0KCk7fScsJ3VucmVuZGVyZWRMb2dJdGVtc0V4aXN0PWZhbHNlO30nLCdmdW5jdGlvbiBwcnVuZUxvZ0VudHJpZXMoKXtpZigobWF4TWVzc2FnZXMhPT1udWxsKSYmKGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLmxlbmd0aD5tYXhNZXNzYWdlcykpe3ZhciBudW1iZXJUb0RlbGV0ZT1sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5sZW5ndGgtbWF4TWVzc2FnZXM7dmFyIHBydW5lZExvZ0VudHJpZXM9bG9nRW50cmllc0FuZFNlcGFyYXRvcnMuc2xpY2UoMCxudW1iZXJUb0RlbGV0ZSk7aWYoY3VycmVudFNlYXJjaCl7Y3VycmVudFNlYXJjaC5yZW1vdmVNYXRjaGVzKHBydW5lZExvZ0VudHJpZXMpO30nLCd2YXIgZ3JvdXA7Zm9yKHZhciBpPTA7aTxudW1iZXJUb0RlbGV0ZTtpKyspe2dyb3VwPWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldLmdyb3VwO2FycmF5X3JlbW92ZShsb2dJdGVtcyxsb2dFbnRyaWVzQW5kU2VwYXJhdG9yc1tpXSk7YXJyYXlfcmVtb3ZlKGxvZ0VudHJpZXMsbG9nRW50cmllc0FuZFNlcGFyYXRvcnNbaV0pO2xvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldLnJlbW92ZSh0cnVlLHRydWUpO2lmKGdyb3VwLmNoaWxkcmVuLmxlbmd0aD09PTAmJmdyb3VwIT09Y3VycmVudEdyb3VwJiZncm91cCE9PXJvb3RHcm91cCl7YXJyYXlfcmVtb3ZlKGxvZ0l0ZW1zLGdyb3VwKTtncm91cC5yZW1vdmUodHJ1ZSx0cnVlKTt9fScsJ2xvZ0VudHJpZXNBbmRTZXBhcmF0b3JzPWFycmF5X3JlbW92ZUZyb21TdGFydChsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycyxudW1iZXJUb0RlbGV0ZSk7cmV0dXJuIHRydWU7fScsJ3JldHVybiBmYWxzZTt9JywnZnVuY3Rpb24gZ3JvdXAobmFtZSxzdGFydEV4cGFuZGVkKXtpZihsb2dnaW5nRW5hYmxlZCl7aW5pdGlhbGx5RXhwYW5kZWQ9KHR5cGVvZiBzdGFydEV4cGFuZGVkPT09InVuZGVmaW5lZCIpP3RydWU6Qm9vbGVhbihzdGFydEV4cGFuZGVkKTt2YXIgbmV3R3JvdXA9bmV3IEdyb3VwKG5hbWUsZmFsc2UsaW5pdGlhbGx5RXhwYW5kZWQpO2N1cnJlbnRHcm91cC5hZGRDaGlsZChuZXdHcm91cCk7Y3VycmVudEdyb3VwPW5ld0dyb3VwO2xvZ0l0ZW1zLnB1c2gobmV3R3JvdXApO2lmKGxvYWRlZCl7aWYobG9nUXVldWVkRXZlbnRzVGltZXIhPT1udWxsKXtjbGVhclRpbWVvdXQobG9nUXVldWVkRXZlbnRzVGltZXIpO30nLCdsb2dRdWV1ZWRFdmVudHNUaW1lcj1zZXRUaW1lb3V0KHJlbmRlclF1ZXVlZExvZ0l0ZW1zLHJlbmRlckRlbGF5KTt1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdD10cnVlO319fScsJ2Z1bmN0aW9uIGdyb3VwRW5kKCl7Y3VycmVudEdyb3VwPShjdXJyZW50R3JvdXA9PT1yb290R3JvdXApP3Jvb3RHcm91cDpjdXJyZW50R3JvdXAuZ3JvdXA7fScsJ2Z1bmN0aW9uIG1haW5QYWdlUmVsb2FkZWQoKXtjdXJyZW50R3JvdXA9cm9vdEdyb3VwO3ZhciBzZXBhcmF0b3I9bmV3IFNlcGFyYXRvcigpO2xvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2goc2VwYXJhdG9yKTtsb2dJdGVtcy5wdXNoKHNlcGFyYXRvcik7Y3VycmVudEdyb3VwLmFkZENoaWxkKHNlcGFyYXRvcik7fScsJ2Z1bmN0aW9uIGNsb3NlV2luZG93KCl7aWYoYXBwZW5kZXImJm1haW5XaW5kb3dFeGlzdHMoKSl7YXBwZW5kZXIuY2xvc2UodHJ1ZSk7fWVsc2V7d2luZG93LmNsb3NlKCk7fX0nLCdmdW5jdGlvbiBoaWRlKCl7aWYoYXBwZW5kZXImJm1haW5XaW5kb3dFeGlzdHMoKSl7YXBwZW5kZXIuaGlkZSgpO319JywndmFyIG1haW5XaW5kb3c9d2luZG93O3ZhciB3aW5kb3dJZD0ibG9nNGphdmFzY3JpcHRDb25zb2xlV2luZG93XyIrbmV3IERhdGUoKS5nZXRUaW1lKCkrIl8iKygiIitNYXRoLnJhbmRvbSgpKS5zdWJzdHIoMik7ZnVuY3Rpb24gc2V0TWFpbldpbmRvdyh3aW4pe21haW5XaW5kb3c9d2luO21haW5XaW5kb3dbd2luZG93SWRdPXdpbmRvdztpZihvcGVuZXImJmNsb3NlSWZPcGVuZXJDbG9zZXMpe3BvbGxPcGVuZXIoKTt9fScsJ2Z1bmN0aW9uIHBvbGxPcGVuZXIoKXtpZihjbG9zZUlmT3BlbmVyQ2xvc2VzKXtpZihtYWluV2luZG93RXhpc3RzKCkpe3NldFRpbWVvdXQocG9sbE9wZW5lciw1MDApO31lbHNle2Nsb3NlV2luZG93KCk7fX19JywnZnVuY3Rpb24gbWFpbldpbmRvd0V4aXN0cygpe3RyeXtyZXR1cm4obWFpbldpbmRvdyYmIW1haW5XaW5kb3cuY2xvc2VkJiZtYWluV2luZG93W3dpbmRvd0lkXT09d2luZG93KTt9Y2F0Y2goZXgpe30nLCdyZXR1cm4gZmFsc2U7fScsJ3ZhciBsb2dMZXZlbHM9WyJUUkFDRSIsIkRFQlVHIiwiSU5GTyIsIldBUk4iLCJFUlJPUiIsIkZBVEFMIl07ZnVuY3Rpb24gZ2V0Q2hlY2tCb3gobG9nTGV2ZWwpe3JldHVybiAkKCJzd2l0Y2hfIitsb2dMZXZlbCk7fScsJ2Z1bmN0aW9uIGdldEllV3JhcHBlZExvZ0NvbnRhaW5lcigpe3JldHVybiAkKCJsb2dfd3JhcHBlZCIpO30nLCdmdW5jdGlvbiBnZXRJZVVud3JhcHBlZExvZ0NvbnRhaW5lcigpe3JldHVybiAkKCJsb2dfdW53cmFwcGVkIik7fScsJ2Z1bmN0aW9uIGFwcGx5RmlsdGVycygpe2Zvcih2YXIgaT0wO2k8bG9nTGV2ZWxzLmxlbmd0aDtpKyspe2lmKGdldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZCl7YWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lcixsb2dMZXZlbHNbaV0pO31lbHNle3JlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsbG9nTGV2ZWxzW2ldKTt9fScsJ3VwZGF0ZVNlYXJjaEZyb21GaWx0ZXJzKCk7fScsJ2Z1bmN0aW9uIHRvZ2dsZUFsbExldmVscygpe3ZhciB0dXJuT249JCgic3dpdGNoX0FMTCIpLmNoZWNrZWQ7Zm9yKHZhciBpPTA7aTxsb2dMZXZlbHMubGVuZ3RoO2krKyl7Z2V0Q2hlY2tCb3gobG9nTGV2ZWxzW2ldKS5jaGVja2VkPXR1cm5PbjtpZih0dXJuT24pe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsbG9nTGV2ZWxzW2ldKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLGxvZ0xldmVsc1tpXSk7fX19JywnZnVuY3Rpb24gY2hlY2tBbGxMZXZlbHMoKXtmb3IodmFyIGk9MDtpPGxvZ0xldmVscy5sZW5ndGg7aSsrKXtpZighZ2V0Q2hlY2tCb3gobG9nTGV2ZWxzW2ldKS5jaGVja2VkKXtnZXRDaGVja0JveCgiQUxMIikuY2hlY2tlZD1mYWxzZTtyZXR1cm47fX0nLCdnZXRDaGVja0JveCgiQUxMIikuY2hlY2tlZD10cnVlO30nLCdmdW5jdGlvbiBjbGVhckxvZygpe3Jvb3RHcm91cC5jbGVhcigpO2N1cnJlbnRHcm91cD1yb290R3JvdXA7bG9nRW50cmllcz1bXTtsb2dJdGVtcz1bXTtsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycz1bXTtkb1NlYXJjaCgpO30nLCdmdW5jdGlvbiB0b2dnbGVXcmFwKCl7dmFyIGVuYWJsZT0kKCJ3cmFwIikuY2hlY2tlZDtpZihlbmFibGUpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsIndyYXAiKTt9ZWxzZXtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJ3cmFwIik7fScsJ3JlZnJlc2hDdXJyZW50TWF0Y2goKTt9JywndmFyIHNlYXJjaFRpbWVyPW51bGw7ZnVuY3Rpb24gc2NoZWR1bGVTZWFyY2goKXt0cnl7Y2xlYXJUaW1lb3V0KHNlYXJjaFRpbWVyKTt9Y2F0Y2goZXgpe30nLCdzZWFyY2hUaW1lcj1zZXRUaW1lb3V0KGRvU2VhcmNoLDUwMCk7fScsJ2Z1bmN0aW9uIFNlYXJjaChzZWFyY2hUZXJtLGlzUmVnZXgsc2VhcmNoUmVnZXgsaXNDYXNlU2Vuc2l0aXZlKXt0aGlzLnNlYXJjaFRlcm09c2VhcmNoVGVybTt0aGlzLmlzUmVnZXg9aXNSZWdleDt0aGlzLnNlYXJjaFJlZ2V4PXNlYXJjaFJlZ2V4O3RoaXMuaXNDYXNlU2Vuc2l0aXZlPWlzQ2FzZVNlbnNpdGl2ZTt0aGlzLm1hdGNoZXM9W107fScsJ1NlYXJjaC5wcm90b3R5cGU9e2hhc01hdGNoZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXRjaGVzLmxlbmd0aD4wO30saGFzVmlzaWJsZU1hdGNoZXM6ZnVuY3Rpb24oKXtpZih0aGlzLmhhc01hdGNoZXMoKSl7Zm9yKHZhciBpPTA7aTx0aGlzLm1hdGNoZXMubGVuZ3RoO2krKyl7aWYodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKXtyZXR1cm4gdHJ1ZTt9fX0nLCdyZXR1cm4gZmFsc2U7fSxtYXRjaDpmdW5jdGlvbihsb2dFbnRyeSl7dmFyIGVudHJ5VGV4dD1TdHJpbmcobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSk7dmFyIG1hdGNoZXNTZWFyY2g9ZmFsc2U7aWYodGhpcy5pc1JlZ2V4KXttYXRjaGVzU2VhcmNoPXRoaXMuc2VhcmNoUmVnZXgudGVzdChlbnRyeVRleHQpO31lbHNlIGlmKHRoaXMuaXNDYXNlU2Vuc2l0aXZlKXttYXRjaGVzU2VhcmNoPShlbnRyeVRleHQuaW5kZXhPZih0aGlzLnNlYXJjaFRlcm0pPi0xKTt9ZWxzZXttYXRjaGVzU2VhcmNoPShlbnRyeVRleHQudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKT4tMSk7fScsJ3JldHVybiBtYXRjaGVzU2VhcmNoO30sZ2V0TmV4dFZpc2libGVNYXRjaEluZGV4OmZ1bmN0aW9uKCl7Zm9yKHZhciBpPWN1cnJlbnRNYXRjaEluZGV4KzE7aTx0aGlzLm1hdGNoZXMubGVuZ3RoO2krKyl7aWYodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKXtyZXR1cm4gaTt9fScsJ2ZvcihpPTA7aTw9Y3VycmVudE1hdGNoSW5kZXg7aSsrKXtpZih0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpe3JldHVybiBpO319JywncmV0dXJuLTE7fSxnZXRQcmV2aW91c1Zpc2libGVNYXRjaEluZGV4OmZ1bmN0aW9uKCl7Zm9yKHZhciBpPWN1cnJlbnRNYXRjaEluZGV4LTE7aT49MDtpLS0pe2lmKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSl7cmV0dXJuIGk7fX0nLCdmb3IodmFyIGk9dGhpcy5tYXRjaGVzLmxlbmd0aC0xO2k+PWN1cnJlbnRNYXRjaEluZGV4O2ktLSl7aWYodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKXtyZXR1cm4gaTt9fScsJ3JldHVybi0xO30sYXBwbHlUbzpmdW5jdGlvbihsb2dFbnRyeSl7dmFyIGRvZXNNYXRjaD10aGlzLm1hdGNoKGxvZ0VudHJ5KTtpZihkb2VzTWF0Y2gpe2xvZ0VudHJ5Lmdyb3VwLmV4cGFuZCgpO2xvZ0VudHJ5LnNldFNlYXJjaE1hdGNoKHRydWUpO3ZhciBsb2dFbnRyeUNvbnRlbnQ7dmFyIHdyYXBwZWRMb2dFbnRyeUNvbnRlbnQ7dmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnPSI8c3BhbiBjbGFzcz1cXFwic2VhcmNodGVybVxcXCI+Ijt2YXIgc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnPSI8IisiL3NwYW4+Ijt2YXIgcHJlVGFnTmFtZT1pc0llPyJwcmUiOiJzcGFuIjt2YXIgcHJlU3RhcnRUYWc9IjwiK3ByZVRhZ05hbWUrIiBjbGFzcz1cXFwicHJlXFxcIj4iO3ZhciBwcmVFbmRUYWc9IjwiKyIvIitwcmVUYWdOYW1lKyI+Ijt2YXIgc3RhcnRJbmRleD0wO3ZhciBzZWFyY2hJbmRleCxtYXRjaGVkVGV4dCx0ZXh0QmVmb3JlTWF0Y2g7aWYodGhpcy5pc1JlZ2V4KXt2YXIgZmxhZ3M9dGhpcy5pc0Nhc2VTZW5zaXRpdmU/ImciOiJnaSI7dmFyIGNhcHR1cmluZ1JlZ2V4PW5ldyBSZWdFeHAoIigiK3RoaXMuc2VhcmNoUmVnZXguc291cmNlKyIpIixmbGFncyk7dmFyIHJuZD0oIiIrTWF0aC5yYW5kb20oKSkuc3Vic3RyKDIpO3ZhciBzdGFydFRva2VuPSIlJXMiK3JuZCsiJSUiO3ZhciBlbmRUb2tlbj0iJSVlIitybmQrIiUlIjtsb2dFbnRyeUNvbnRlbnQ9bG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5yZXBsYWNlKGNhcHR1cmluZ1JlZ2V4LHN0YXJ0VG9rZW4rIiQxIitlbmRUb2tlbik7bG9nRW50cnlDb250ZW50PWVzY2FwZUh0bWwobG9nRW50cnlDb250ZW50KTt2YXIgcmVzdWx0O3ZhciBzZWFyY2hTdHJpbmc9bG9nRW50cnlDb250ZW50O2xvZ0VudHJ5Q29udGVudD0iIjt3cmFwcGVkTG9nRW50cnlDb250ZW50PSIiO3doaWxlKChzZWFyY2hJbmRleD1zZWFyY2hTdHJpbmcuaW5kZXhPZihzdGFydFRva2VuLHN0YXJ0SW5kZXgpKT4tMSl7dmFyIGVuZFRva2VuSW5kZXg9c2VhcmNoU3RyaW5nLmluZGV4T2YoZW5kVG9rZW4sc2VhcmNoSW5kZXgpO21hdGNoZWRUZXh0PXNlYXJjaFN0cmluZy5zdWJzdHJpbmcoc2VhcmNoSW5kZXgrc3RhcnRUb2tlbi5sZW5ndGgsZW5kVG9rZW5JbmRleCk7dGV4dEJlZm9yZU1hdGNoPXNlYXJjaFN0cmluZy5zdWJzdHJpbmcoc3RhcnRJbmRleCxzZWFyY2hJbmRleCk7bG9nRW50cnlDb250ZW50Kz1wcmVTdGFydFRhZyt0ZXh0QmVmb3JlTWF0Y2grcHJlRW5kVGFnO2xvZ0VudHJ5Q29udGVudCs9c2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcrcHJlU3RhcnRUYWcrbWF0Y2hlZFRleHQrJywncHJlRW5kVGFnK3NlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZztpZihpc0llKXt3cmFwcGVkTG9nRW50cnlDb250ZW50Kz10ZXh0QmVmb3JlTWF0Y2grc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcrJywnbWF0Y2hlZFRleHQrc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnO30nLCdzdGFydEluZGV4PWVuZFRva2VuSW5kZXgrZW5kVG9rZW4ubGVuZ3RoO30nLCdsb2dFbnRyeUNvbnRlbnQrPXByZVN0YXJ0VGFnK3NlYXJjaFN0cmluZy5zdWJzdHIoc3RhcnRJbmRleCkrcHJlRW5kVGFnO2lmKGlzSWUpe3dyYXBwZWRMb2dFbnRyeUNvbnRlbnQrPXNlYXJjaFN0cmluZy5zdWJzdHIoc3RhcnRJbmRleCk7fX1lbHNle2xvZ0VudHJ5Q29udGVudD0iIjt3cmFwcGVkTG9nRW50cnlDb250ZW50PSIiO3ZhciBzZWFyY2hUZXJtUmVwbGFjZW1lbnRMZW5ndGg9c2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcubGVuZ3RoKycsJ3RoaXMuc2VhcmNoVGVybS5sZW5ndGgrc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnLmxlbmd0aDt2YXIgc2VhcmNoVGVybUxlbmd0aD10aGlzLnNlYXJjaFRlcm0ubGVuZ3RoO3ZhciBzZWFyY2hUZXJtTG93ZXJDYXNlPXRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpO3ZhciBsb2dUZXh0TG93ZXJDYXNlPWxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UudG9Mb3dlckNhc2UoKTt3aGlsZSgoc2VhcmNoSW5kZXg9bG9nVGV4dExvd2VyQ2FzZS5pbmRleE9mKHNlYXJjaFRlcm1Mb3dlckNhc2Usc3RhcnRJbmRleCkpPi0xKXttYXRjaGVkVGV4dD1lc2NhcGVIdG1sKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2Uuc3Vic3RyKHNlYXJjaEluZGV4LHRoaXMuc2VhcmNoVGVybS5sZW5ndGgpKTt0ZXh0QmVmb3JlTWF0Y2g9ZXNjYXBlSHRtbChsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLnN1YnN0cmluZyhzdGFydEluZGV4LHNlYXJjaEluZGV4KSk7dmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudD1zZWFyY2hUZXJtUmVwbGFjZW1lbnRTdGFydFRhZysnLCdwcmVTdGFydFRhZyttYXRjaGVkVGV4dCtwcmVFbmRUYWcrc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnO2xvZ0VudHJ5Q29udGVudCs9cHJlU3RhcnRUYWcrdGV4dEJlZm9yZU1hdGNoK3ByZUVuZFRhZytzZWFyY2hUZXJtUmVwbGFjZW1lbnQ7aWYoaXNJZSl7d3JhcHBlZExvZ0VudHJ5Q29udGVudCs9dGV4dEJlZm9yZU1hdGNoK3NlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnKycsJ21hdGNoZWRUZXh0K3NlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZzt9Jywnc3RhcnRJbmRleD1zZWFyY2hJbmRleCtzZWFyY2hUZXJtTGVuZ3RoO30nLCd2YXIgdGV4dEFmdGVyTGFzdE1hdGNoPWVzY2FwZUh0bWwobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5zdWJzdHIoc3RhcnRJbmRleCkpO2xvZ0VudHJ5Q29udGVudCs9cHJlU3RhcnRUYWcrdGV4dEFmdGVyTGFzdE1hdGNoK3ByZUVuZFRhZztpZihpc0llKXt3cmFwcGVkTG9nRW50cnlDb250ZW50Kz10ZXh0QWZ0ZXJMYXN0TWF0Y2g7fX0nLCdsb2dFbnRyeS5zZXRDb250ZW50KGxvZ0VudHJ5Q29udGVudCx3cmFwcGVkTG9nRW50cnlDb250ZW50KTt2YXIgbG9nRW50cnlNYXRjaGVzPWxvZ0VudHJ5LmdldFNlYXJjaE1hdGNoZXMoKTt0aGlzLm1hdGNoZXM9dGhpcy5tYXRjaGVzLmNvbmNhdChsb2dFbnRyeU1hdGNoZXMpO31lbHNle2xvZ0VudHJ5LnNldFNlYXJjaE1hdGNoKGZhbHNlKTtsb2dFbnRyeS5zZXRDb250ZW50KGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UsbG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSk7fScsJ3JldHVybiBkb2VzTWF0Y2g7fSxyZW1vdmVNYXRjaGVzOmZ1bmN0aW9uKGxvZ0VudHJpZXMpe3ZhciBtYXRjaGVzVG9SZW1vdmVDb3VudD0wO3ZhciBjdXJyZW50TWF0Y2hSZW1vdmVkPWZhbHNlO3ZhciBtYXRjaGVzVG9SZW1vdmU9W107dmFyIGksaUxlbixqLGpMZW47Zm9yKGk9MCxpTGVuPXRoaXMubWF0Y2hlcy5sZW5ndGg7aTxpTGVuO2krKyl7Zm9yKGo9MCxqTGVuPWxvZ0VudHJpZXMubGVuZ3RoO2o8akxlbjtqKyspe2lmKHRoaXMubWF0Y2hlc1tpXS5iZWxvbmdzVG8obG9nRW50cmllc1tqXSkpe21hdGNoZXNUb1JlbW92ZS5wdXNoKHRoaXMubWF0Y2hlc1tpXSk7aWYoaT09PWN1cnJlbnRNYXRjaEluZGV4KXtjdXJyZW50TWF0Y2hSZW1vdmVkPXRydWU7fX19fScsJ3ZhciBuZXdNYXRjaD1jdXJyZW50TWF0Y2hSZW1vdmVkP251bGw6dGhpcy5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XTtpZihjdXJyZW50TWF0Y2hSZW1vdmVkKXtmb3IoaT1jdXJyZW50TWF0Y2hJbmRleCxpTGVuPXRoaXMubWF0Y2hlcy5sZW5ndGg7aTxpTGVuO2krKyl7aWYodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpJiYhYXJyYXlfY29udGFpbnMobWF0Y2hlc1RvUmVtb3ZlLHRoaXMubWF0Y2hlc1tpXSkpe25ld01hdGNoPXRoaXMubWF0Y2hlc1tpXTticmVhazt9fX0nLCdmb3IoaT0wLGlMZW49bWF0Y2hlc1RvUmVtb3ZlLmxlbmd0aDtpPGlMZW47aSsrKXthcnJheV9yZW1vdmUodGhpcy5tYXRjaGVzLG1hdGNoZXNUb1JlbW92ZVtpXSk7bWF0Y2hlc1RvUmVtb3ZlW2ldLnJlbW92ZSgpO30nLCdpZih0aGlzLmhhc1Zpc2libGVNYXRjaGVzKCkpe2lmKG5ld01hdGNoPT09bnVsbCl7c2V0Q3VycmVudE1hdGNoSW5kZXgoMCk7fWVsc2V7dmFyIG5ld01hdGNoSW5kZXg9MDtmb3IoaT0wLGlMZW49dGhpcy5tYXRjaGVzLmxlbmd0aDtpPGlMZW47aSsrKXtpZihuZXdNYXRjaD09PXRoaXMubWF0Y2hlc1tpXSl7bmV3TWF0Y2hJbmRleD1pO2JyZWFrO319Jywnc2V0Q3VycmVudE1hdGNoSW5kZXgobmV3TWF0Y2hJbmRleCk7fX1lbHNle2N1cnJlbnRNYXRjaEluZGV4PW51bGw7ZGlzcGxheU5vTWF0Y2hlcygpO319fTtmdW5jdGlvbiBnZXRQYWdlT2Zmc2V0VG9wKGVsLGNvbnRhaW5lcil7dmFyIGN1cnJlbnRFbD1lbDt2YXIgeT0wO3doaWxlKGN1cnJlbnRFbCYmY3VycmVudEVsIT1jb250YWluZXIpe3krPWN1cnJlbnRFbC5vZmZzZXRUb3A7Y3VycmVudEVsPWN1cnJlbnRFbC5vZmZzZXRQYXJlbnQ7fScsJ3JldHVybiB5O30nLCdmdW5jdGlvbiBzY3JvbGxJbnRvVmlldyhlbCl7dmFyIGxvZ0NvbnRhaW5lcj1sb2dNYWluQ29udGFpbmVyO2lmKCEkKCJ3cmFwIikuY2hlY2tlZCl7dmFyIGxvZ0NvbnRhaW5lckxlZnQ9bG9nQ29udGFpbmVyLnNjcm9sbExlZnQ7dmFyIGxvZ0NvbnRhaW5lclJpZ2h0PWxvZ0NvbnRhaW5lckxlZnQrbG9nQ29udGFpbmVyLm9mZnNldFdpZHRoO3ZhciBlbExlZnQ9ZWwub2Zmc2V0TGVmdDt2YXIgZWxSaWdodD1lbExlZnQrZWwub2Zmc2V0V2lkdGg7aWYoZWxMZWZ0PGxvZ0NvbnRhaW5lckxlZnR8fGVsUmlnaHQ+bG9nQ29udGFpbmVyUmlnaHQpe2xvZ0NvbnRhaW5lci5zY3JvbGxMZWZ0PWVsTGVmdC0obG9nQ29udGFpbmVyLm9mZnNldFdpZHRoLWVsLm9mZnNldFdpZHRoKS8yO319JywndmFyIGxvZ0NvbnRhaW5lclRvcD1sb2dDb250YWluZXIuc2Nyb2xsVG9wO3ZhciBsb2dDb250YWluZXJCb3R0b209bG9nQ29udGFpbmVyVG9wK2xvZ0NvbnRhaW5lci5vZmZzZXRIZWlnaHQ7dmFyIGVsVG9wPWdldFBhZ2VPZmZzZXRUb3AoZWwpLWdldFRvb2xCYXJzSGVpZ2h0KCk7dmFyIGVsQm90dG9tPWVsVG9wK2VsLm9mZnNldEhlaWdodDtpZihlbFRvcDxsb2dDb250YWluZXJUb3B8fGVsQm90dG9tPmxvZ0NvbnRhaW5lckJvdHRvbSl7bG9nQ29udGFpbmVyLnNjcm9sbFRvcD1lbFRvcC0obG9nQ29udGFpbmVyLm9mZnNldEhlaWdodC1lbC5vZmZzZXRIZWlnaHQpLzI7fX0nLCdmdW5jdGlvbiBNYXRjaChsb2dFbnRyeUxldmVsLHNwYW5Jbk1haW5EaXYsc3BhbkluVW53cmFwcGVkUHJlLHNwYW5JbldyYXBwZWREaXYpe3RoaXMubG9nRW50cnlMZXZlbD1sb2dFbnRyeUxldmVsO3RoaXMuc3BhbkluTWFpbkRpdj1zcGFuSW5NYWluRGl2O2lmKGlzSWUpe3RoaXMuc3BhbkluVW53cmFwcGVkUHJlPXNwYW5JblVud3JhcHBlZFByZTt0aGlzLnNwYW5JbldyYXBwZWREaXY9c3BhbkluV3JhcHBlZERpdjt9JywndGhpcy5tYWluU3Bhbj1pc0llP3NwYW5JblVud3JhcHBlZFByZTpzcGFuSW5NYWluRGl2O30nLCdNYXRjaC5wcm90b3R5cGU9e2VxdWFsczpmdW5jdGlvbihtYXRjaCl7cmV0dXJuIHRoaXMubWFpblNwYW49PT1tYXRjaC5tYWluU3Bhbjt9LHNldEN1cnJlbnQ6ZnVuY3Rpb24oKXtpZihpc0llKXthZGRDbGFzcyh0aGlzLnNwYW5JblVud3JhcHBlZFByZSwiY3VycmVudG1hdGNoIik7YWRkQ2xhc3ModGhpcy5zcGFuSW5XcmFwcGVkRGl2LCJjdXJyZW50bWF0Y2giKTt2YXIgZWxlbWVudFRvU2Nyb2xsPSQoIndyYXAiKS5jaGVja2VkP3RoaXMuc3BhbkluV3JhcHBlZERpdjp0aGlzLnNwYW5JblVud3JhcHBlZFByZTtzY3JvbGxJbnRvVmlldyhlbGVtZW50VG9TY3JvbGwpO31lbHNle2FkZENsYXNzKHRoaXMuc3BhbkluTWFpbkRpdiwiY3VycmVudG1hdGNoIik7c2Nyb2xsSW50b1ZpZXcodGhpcy5zcGFuSW5NYWluRGl2KTt9fSxiZWxvbmdzVG86ZnVuY3Rpb24obG9nRW50cnkpe2lmKGlzSWUpe3JldHVybiBpc0Rlc2NlbmRhbnQodGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsbG9nRW50cnkudW53cmFwcGVkUHJlKTt9ZWxzZXtyZXR1cm4gaXNEZXNjZW5kYW50KHRoaXMuc3BhbkluTWFpbkRpdixsb2dFbnRyeS5tYWluRGl2KTt9fSxzZXROb3RDdXJyZW50OmZ1bmN0aW9uKCl7aWYoaXNJZSl7cmVtb3ZlQ2xhc3ModGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsImN1cnJlbnRtYXRjaCIpO3JlbW92ZUNsYXNzKHRoaXMuc3BhbkluV3JhcHBlZERpdiwiY3VycmVudG1hdGNoIik7fWVsc2V7cmVtb3ZlQ2xhc3ModGhpcy5zcGFuSW5NYWluRGl2LCJjdXJyZW50bWF0Y2giKTt9fSxpc09ycGhhbjpmdW5jdGlvbigpe3JldHVybiBpc09ycGhhbih0aGlzLm1haW5TcGFuKTt9LGlzVmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiBnZXRDaGVja0JveCh0aGlzLmxvZ0VudHJ5TGV2ZWwpLmNoZWNrZWQ7fSxyZW1vdmU6ZnVuY3Rpb24oKXtpZihpc0llKXt0aGlzLnNwYW5JblVud3JhcHBlZFByZT1udWxsO3RoaXMuc3BhbkluV3JhcHBlZERpdj1udWxsO31lbHNle3RoaXMuc3BhbkluTWFpbkRpdj1udWxsO319fTt2YXIgY3VycmVudFNlYXJjaD1udWxsO3ZhciBjdXJyZW50TWF0Y2hJbmRleD1udWxsO2Z1bmN0aW9uIGRvU2VhcmNoKCl7dmFyIHNlYXJjaEJveD0kKCJzZWFyY2hCb3giKTt2YXIgc2VhcmNoVGVybT1zZWFyY2hCb3gudmFsdWU7dmFyIGlzUmVnZXg9JCgic2VhcmNoUmVnZXgiKS5jaGVja2VkO3ZhciBpc0Nhc2VTZW5zaXRpdmU9JCgic2VhcmNoQ2FzZVNlbnNpdGl2ZSIpLmNoZWNrZWQ7dmFyIGk7aWYoc2VhcmNoVGVybT09PSIiKXskKCJzZWFyY2hSZXNldCIpLmRpc2FibGVkPXRydWU7JCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheT0ibm9uZSI7cmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwic2VhcmNoaW5nIik7cmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCJoYXNtYXRjaGVzIik7cmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCJub21hdGNoZXMiKTtmb3IoaT0wO2k8bG9nRW50cmllcy5sZW5ndGg7aSsrKXtsb2dFbnRyaWVzW2ldLmNsZWFyU2VhcmNoKCk7bG9nRW50cmllc1tpXS5zZXRDb250ZW50KGxvZ0VudHJpZXNbaV0uZm9ybWF0dGVkTWVzc2FnZSxsb2dFbnRyaWVzW2ldLmZvcm1hdHRlZE1lc3NhZ2UpO30nLCdjdXJyZW50U2VhcmNoPW51bGw7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fWVsc2V7JCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZD1mYWxzZTskKCJzZWFyY2hOYXYiKS5zdHlsZS5kaXNwbGF5PSJibG9jayI7dmFyIHNlYXJjaFJlZ2V4O3ZhciByZWdleFZhbGlkO2lmKGlzUmVnZXgpe3RyeXtzZWFyY2hSZWdleD1pc0Nhc2VTZW5zaXRpdmU/bmV3IFJlZ0V4cChzZWFyY2hUZXJtLCJnIik6bmV3IFJlZ0V4cChzZWFyY2hUZXJtLCJnaSIpO3JlZ2V4VmFsaWQ9dHJ1ZTtyZXBsYWNlQ2xhc3Moc2VhcmNoQm94LCJ2YWxpZHJlZ2V4IiwiaW52YWxpZHJlZ2V4Iik7c2VhcmNoQm94LnRpdGxlPSJWYWxpZCByZWdleCI7fWNhdGNoKGV4KXtyZWdleFZhbGlkPWZhbHNlO3JlcGxhY2VDbGFzcyhzZWFyY2hCb3gsImludmFsaWRyZWdleCIsInZhbGlkcmVnZXgiKTtzZWFyY2hCb3gudGl0bGU9IkludmFsaWQgcmVnZXg6ICIrKGV4Lm1lc3NhZ2U/ZXgubWVzc2FnZTooZXguZGVzY3JpcHRpb24/ZXguZGVzY3JpcHRpb246InVua25vd24gZXJyb3IiKSk7cmV0dXJuO319ZWxzZXtzZWFyY2hCb3gudGl0bGU9IiI7cmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCJ2YWxpZHJlZ2V4Iik7cmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCJpbnZhbGlkcmVnZXgiKTt9JywnYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwic2VhcmNoaW5nIik7Y3VycmVudFNlYXJjaD1uZXcgU2VhcmNoKHNlYXJjaFRlcm0saXNSZWdleCxzZWFyY2hSZWdleCxpc0Nhc2VTZW5zaXRpdmUpO2ZvcihpPTA7aTxsb2dFbnRyaWVzLmxlbmd0aDtpKyspe2N1cnJlbnRTZWFyY2guYXBwbHlUbyhsb2dFbnRyaWVzW2ldKTt9Jywnc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7aWYoY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKXtzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTtkaXNwbGF5TWF0Y2hlcygpO31lbHNle2Rpc3BsYXlOb01hdGNoZXMoKTt9fX0nLCdmdW5jdGlvbiB1cGRhdGVTZWFyY2hGcm9tRmlsdGVycygpe2lmKGN1cnJlbnRTZWFyY2gpe2lmKGN1cnJlbnRTZWFyY2guaGFzTWF0Y2hlcygpKXtpZihjdXJyZW50TWF0Y2hJbmRleD09PW51bGwpe2N1cnJlbnRNYXRjaEluZGV4PTA7fScsJ3ZhciBjdXJyZW50TWF0Y2g9Y3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XTtpZihjdXJyZW50TWF0Y2guaXNWaXNpYmxlKCkpe2Rpc3BsYXlNYXRjaGVzKCk7c2V0Q3VycmVudE1hdGNoSW5kZXgoY3VycmVudE1hdGNoSW5kZXgpO31lbHNle2N1cnJlbnRNYXRjaC5zZXROb3RDdXJyZW50KCk7dmFyIG5leHRWaXNpYmxlTWF0Y2hJbmRleD1jdXJyZW50U2VhcmNoLmdldE5leHRWaXNpYmxlTWF0Y2hJbmRleCgpO2lmKG5leHRWaXNpYmxlTWF0Y2hJbmRleD4tMSl7c2V0Q3VycmVudE1hdGNoSW5kZXgobmV4dFZpc2libGVNYXRjaEluZGV4KTtkaXNwbGF5TWF0Y2hlcygpO31lbHNle2Rpc3BsYXlOb01hdGNoZXMoKTt9fX1lbHNle2Rpc3BsYXlOb01hdGNoZXMoKTt9fX0nLCdmdW5jdGlvbiByZWZyZXNoQ3VycmVudE1hdGNoKCl7aWYoY3VycmVudFNlYXJjaCYmY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKXtzZXRDdXJyZW50TWF0Y2hJbmRleChjdXJyZW50TWF0Y2hJbmRleCk7fX0nLCdmdW5jdGlvbiBkaXNwbGF5TWF0Y2hlcygpe3JlcGxhY2VDbGFzcygkKCJzZWFyY2hCb3giKSwiaGFzbWF0Y2hlcyIsIm5vbWF0Y2hlcyIpOyQoInNlYXJjaEJveCIpLnRpdGxlPSIiK2N1cnJlbnRTZWFyY2gubWF0Y2hlcy5sZW5ndGgrIiBtYXRjaGVzIGZvdW5kIjskKCJzZWFyY2hOYXYiKS5zdHlsZS5kaXNwbGF5PSJibG9jayI7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fScsJ2Z1bmN0aW9uIGRpc3BsYXlOb01hdGNoZXMoKXtyZXBsYWNlQ2xhc3MoJCgic2VhcmNoQm94IiksIm5vbWF0Y2hlcyIsImhhc21hdGNoZXMiKTskKCJzZWFyY2hCb3giKS50aXRsZT0iTm8gbWF0Y2hlcyBmb3VuZCI7JCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheT0ibm9uZSI7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fScsJ2Z1bmN0aW9uIHRvZ2dsZVNlYXJjaEVuYWJsZWQoZW5hYmxlKXtlbmFibGU9KHR5cGVvZiBlbmFibGU9PSJ1bmRlZmluZWQiKT8hJCgic2VhcmNoRGlzYWJsZSIpLmNoZWNrZWQ6ZW5hYmxlOyQoInNlYXJjaEJveCIpLmRpc2FibGVkPSFlbmFibGU7JCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZD0hZW5hYmxlOyQoInNlYXJjaFJlZ2V4IikuZGlzYWJsZWQ9IWVuYWJsZTskKCJzZWFyY2hOZXh0IikuZGlzYWJsZWQ9IWVuYWJsZTskKCJzZWFyY2hQcmV2aW91cyIpLmRpc2FibGVkPSFlbmFibGU7JCgic2VhcmNoQ2FzZVNlbnNpdGl2ZSIpLmRpc2FibGVkPSFlbmFibGU7JCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheT0oZW5hYmxlJiYoJCgic2VhcmNoQm94IikudmFsdWUhPT0iIikmJmN1cnJlbnRTZWFyY2gmJmN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSk/ImJsb2NrIjoibm9uZSI7aWYoZW5hYmxlKXtyZW1vdmVDbGFzcygkKCJzZWFyY2giKSwiZ3JleWVkb3V0Iik7YWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwic2VhcmNoaW5nIik7aWYoJCgic2VhcmNoSGlnaGxpZ2h0IikuY2hlY2tlZCl7YWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwic2VhcmNoaGlnaGxpZ2h0Iik7fWVsc2V7cmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwic2VhcmNoaGlnaGxpZ2h0Iik7fScsJ2lmKCQoInNlYXJjaEZpbHRlciIpLmNoZWNrZWQpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGZpbHRlciIpO31lbHNle3JlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGZpbHRlciIpO30nLCckKCJzZWFyY2hEaXNhYmxlIikuY2hlY2tlZD0hZW5hYmxlO31lbHNle2FkZENsYXNzKCQoInNlYXJjaCIpLCJncmV5ZWRvdXQiKTtyZW1vdmVDbGFzcyhkb2N1bWVudC5ib2R5LCJzZWFyY2hpbmciKTtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hoaWdobGlnaHQiKTtyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCJzZWFyY2hmaWx0ZXIiKTt9Jywnc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fScsJ2Z1bmN0aW9uIHRvZ2dsZVNlYXJjaEZpbHRlcigpe3ZhciBlbmFibGU9JCgic2VhcmNoRmlsdGVyIikuY2hlY2tlZDtpZihlbmFibGUpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGZpbHRlciIpO31lbHNle3JlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGZpbHRlciIpO30nLCdyZWZyZXNoQ3VycmVudE1hdGNoKCk7fScsJ2Z1bmN0aW9uIHRvZ2dsZVNlYXJjaEhpZ2hsaWdodCgpe3ZhciBlbmFibGU9JCgic2VhcmNoSGlnaGxpZ2h0IikuY2hlY2tlZDtpZihlbmFibGUpe2FkZENsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGhpZ2hsaWdodCIpO31lbHNle3JlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsInNlYXJjaGhpZ2hsaWdodCIpO319JywnZnVuY3Rpb24gY2xlYXJTZWFyY2goKXskKCJzZWFyY2hCb3giKS52YWx1ZT0iIjtkb1NlYXJjaCgpO30nLCdmdW5jdGlvbiBzZWFyY2hOZXh0KCl7aWYoY3VycmVudFNlYXJjaCE9PW51bGwmJmN1cnJlbnRNYXRjaEluZGV4IT09bnVsbCl7Y3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXROb3RDdXJyZW50KCk7dmFyIG5leHRNYXRjaEluZGV4PWN1cnJlbnRTZWFyY2guZ2V0TmV4dFZpc2libGVNYXRjaEluZGV4KCk7aWYobmV4dE1hdGNoSW5kZXg+Y3VycmVudE1hdGNoSW5kZXh8fGNvbmZpcm0oIlJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgcGFnZS4gU3RhcnQgZnJvbSB0aGUgdG9wPyIpKXtzZXRDdXJyZW50TWF0Y2hJbmRleChuZXh0TWF0Y2hJbmRleCk7fX19JywnZnVuY3Rpb24gc2VhcmNoUHJldmlvdXMoKXtpZihjdXJyZW50U2VhcmNoIT09bnVsbCYmY3VycmVudE1hdGNoSW5kZXghPT1udWxsKXtjdXJyZW50U2VhcmNoLm1hdGNoZXNbY3VycmVudE1hdGNoSW5kZXhdLnNldE5vdEN1cnJlbnQoKTt2YXIgcHJldmlvdXNNYXRjaEluZGV4PWN1cnJlbnRTZWFyY2guZ2V0UHJldmlvdXNWaXNpYmxlTWF0Y2hJbmRleCgpO2lmKHByZXZpb3VzTWF0Y2hJbmRleDxjdXJyZW50TWF0Y2hJbmRleHx8Y29uZmlybSgiUmVhY2hlZCB0aGUgc3RhcnQgb2YgdGhlIHBhZ2UuIENvbnRpbnVlIGZyb20gdGhlIGJvdHRvbT8iKSl7c2V0Q3VycmVudE1hdGNoSW5kZXgocHJldmlvdXNNYXRjaEluZGV4KTt9fX0nLCdmdW5jdGlvbiBzZXRDdXJyZW50TWF0Y2hJbmRleChpbmRleCl7Y3VycmVudE1hdGNoSW5kZXg9aW5kZXg7Y3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXRDdXJyZW50KCk7fScsJ2Z1bmN0aW9uIGFkZENsYXNzKGVsLGNzc0NsYXNzKXtpZighaGFzQ2xhc3MoZWwsY3NzQ2xhc3MpKXtpZihlbC5jbGFzc05hbWUpe2VsLmNsYXNzTmFtZSs9IiAiK2Nzc0NsYXNzO31lbHNle2VsLmNsYXNzTmFtZT1jc3NDbGFzczt9fX0nLCdmdW5jdGlvbiBoYXNDbGFzcyhlbCxjc3NDbGFzcyl7aWYoZWwuY2xhc3NOYW1lKXt2YXIgY2xhc3NOYW1lcz1lbC5jbGFzc05hbWUuc3BsaXQoIiAiKTtyZXR1cm4gYXJyYXlfY29udGFpbnMoY2xhc3NOYW1lcyxjc3NDbGFzcyk7fScsJ3JldHVybiBmYWxzZTt9JywnZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWwsY3NzQ2xhc3Mpe2lmKGhhc0NsYXNzKGVsLGNzc0NsYXNzKSl7dmFyIGV4aXN0aW5nQ2xhc3Nlcz1lbC5jbGFzc05hbWUuc3BsaXQoIiAiKTt2YXIgbmV3Q2xhc3Nlcz1bXTtmb3IodmFyIGk9MCxsZW49ZXhpc3RpbmdDbGFzc2VzLmxlbmd0aDtpPGxlbjtpKyspe2lmKGV4aXN0aW5nQ2xhc3Nlc1tpXSE9Y3NzQ2xhc3Mpe25ld0NsYXNzZXNbbmV3Q2xhc3Nlcy5sZW5ndGhdPWV4aXN0aW5nQ2xhc3Nlc1tpXTt9fScsJ2VsLmNsYXNzTmFtZT1uZXdDbGFzc2VzLmpvaW4oIiAiKTt9fScsJ2Z1bmN0aW9uIHJlcGxhY2VDbGFzcyhlbCxuZXdDc3NDbGFzcyxvbGRDc3NDbGFzcyl7cmVtb3ZlQ2xhc3MoZWwsb2xkQ3NzQ2xhc3MpO2FkZENsYXNzKGVsLG5ld0Nzc0NsYXNzKTt9JywnZnVuY3Rpb24gZ2V0RWxlbWVudHNCeUNsYXNzKGVsLGNzc0NsYXNzLHRhZ05hbWUpe3ZhciBlbGVtZW50cz1lbC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKTt2YXIgbWF0Y2hlcz1bXTtmb3IodmFyIGk9MCxsZW49ZWxlbWVudHMubGVuZ3RoO2k8bGVuO2krKyl7aWYoaGFzQ2xhc3MoZWxlbWVudHNbaV0sY3NzQ2xhc3MpKXttYXRjaGVzLnB1c2goZWxlbWVudHNbaV0pO319JywncmV0dXJuIG1hdGNoZXM7fScsJ2Z1bmN0aW9uICQoaWQpe3JldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7fScsJ2Z1bmN0aW9uIGlzRGVzY2VuZGFudChub2RlLGFuY2VzdG9yTm9kZSl7d2hpbGUobm9kZSE9bnVsbCl7aWYobm9kZT09PWFuY2VzdG9yTm9kZSl7cmV0dXJuIHRydWU7fScsJ25vZGU9bm9kZS5wYXJlbnROb2RlO30nLCdyZXR1cm4gZmFsc2U7fScsJ2Z1bmN0aW9uIGlzT3JwaGFuKG5vZGUpe3ZhciBjdXJyZW50Tm9kZT1ub2RlO3doaWxlKGN1cnJlbnROb2RlKXtpZihjdXJyZW50Tm9kZT09ZG9jdW1lbnQuYm9keSl7cmV0dXJuIGZhbHNlO30nLCdjdXJyZW50Tm9kZT1jdXJyZW50Tm9kZS5wYXJlbnROb2RlO30nLCdyZXR1cm4gdHJ1ZTt9JywnZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpe3JldHVybiBzdHIucmVwbGFjZSgvJi9nLCImYW1wOyIpLnJlcGxhY2UoL1s8XS9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7Iik7fScsJ2Z1bmN0aW9uIGdldFdpbmRvd1dpZHRoKCl7aWYod2luZG93LmlubmVyV2lkdGgpe3JldHVybiB3aW5kb3cuaW5uZXJXaWR0aDt9ZWxzZSBpZihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQmJmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCl7cmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDt9ZWxzZSBpZihkb2N1bWVudC5ib2R5KXtyZXR1cm4gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDt9JywncmV0dXJuIDA7fScsJ2Z1bmN0aW9uIGdldFdpbmRvd0hlaWdodCgpe2lmKHdpbmRvdy5pbm5lckhlaWdodCl7cmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDt9ZWxzZSBpZihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQmJmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpe3JldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O31lbHNlIGlmKGRvY3VtZW50LmJvZHkpe3JldHVybiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDt9JywncmV0dXJuIDA7fScsJ2Z1bmN0aW9uIGdldFRvb2xCYXJzSGVpZ2h0KCl7cmV0dXJuICQoInN3aXRjaGVzIikub2Zmc2V0SGVpZ2h0O30nLCdmdW5jdGlvbiBnZXRDaHJvbWVIZWlnaHQoKXt2YXIgaGVpZ2h0PWdldFRvb2xCYXJzSGVpZ2h0KCk7aWYoc2hvd0NvbW1hbmRMaW5lKXtoZWlnaHQrPSQoImNvbW1hbmRMaW5lIikub2Zmc2V0SGVpZ2h0O30nLCdyZXR1cm4gaGVpZ2h0O30nLCdmdW5jdGlvbiBzZXRMb2dDb250YWluZXJIZWlnaHQoKXtpZihsb2dNYWluQ29udGFpbmVyKXt2YXIgd2luZG93SGVpZ2h0PWdldFdpbmRvd0hlaWdodCgpOyQoImJvZHkiKS5zdHlsZS5oZWlnaHQ9Z2V0V2luZG93SGVpZ2h0KCkrInB4Ijtsb2dNYWluQ29udGFpbmVyLnN0eWxlLmhlaWdodD0iIisnLCdNYXRoLm1heCgwLHdpbmRvd0hlaWdodC1nZXRDaHJvbWVIZWlnaHQoKSkrInB4Ijt9fScsJ2Z1bmN0aW9uIHNldENvbW1hbmRJbnB1dFdpZHRoKCl7aWYoc2hvd0NvbW1hbmRMaW5lKXskKCJjb21tYW5kIikuc3R5bGUud2lkdGg9IiIrTWF0aC5tYXgoMCwkKCJjb21tYW5kTGluZUNvbnRhaW5lciIpLm9mZnNldFdpZHRoLScsJygkKCJldmFsdWF0ZUJ1dHRvbiIpLm9mZnNldFdpZHRoKzEzKSkrInB4Ijt9fScsJ3dpbmRvdy5vbnJlc2l6ZT1mdW5jdGlvbigpe3NldENvbW1hbmRJbnB1dFdpZHRoKCk7c2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7fTtpZighQXJyYXkucHJvdG90eXBlLnB1c2gpe0FycmF5LnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTAsbGVuPWFyZ3VtZW50cy5sZW5ndGg7aTxsZW47aSsrKXt0aGlzW3RoaXMubGVuZ3RoXT1hcmd1bWVudHNbaV07fScsJ3JldHVybiB0aGlzLmxlbmd0aDt9O30nLCdpZighQXJyYXkucHJvdG90eXBlLnBvcCl7QXJyYXkucHJvdG90eXBlLnBvcD1mdW5jdGlvbigpe2lmKHRoaXMubGVuZ3RoPjApe3ZhciB2YWw9dGhpc1t0aGlzLmxlbmd0aC0xXTt0aGlzLmxlbmd0aD10aGlzLmxlbmd0aC0xO3JldHVybiB2YWw7fX07fScsJ2lmKCFBcnJheS5wcm90b3R5cGUuc2hpZnQpe0FycmF5LnByb3RvdHlwZS5zaGlmdD1mdW5jdGlvbigpe2lmKHRoaXMubGVuZ3RoPjApe3ZhciBmaXJzdEl0ZW09dGhpc1swXTtmb3IodmFyIGk9MCxsZW49dGhpcy5sZW5ndGgtMTtpPGxlbjtpKyspe3RoaXNbaV09dGhpc1tpKzFdO30nLCd0aGlzLmxlbmd0aD10aGlzLmxlbmd0aC0xO3JldHVybiBmaXJzdEl0ZW07fX07fScsJ2lmKCFBcnJheS5wcm90b3R5cGUuc3BsaWNlKXtBcnJheS5wcm90b3R5cGUuc3BsaWNlPWZ1bmN0aW9uKHN0YXJ0SW5kZXgsZGVsZXRlQ291bnQpe3ZhciBpdGVtc0FmdGVyRGVsZXRlZD10aGlzLnNsaWNlKHN0YXJ0SW5kZXgrZGVsZXRlQ291bnQpO3ZhciBpdGVtc0RlbGV0ZWQ9dGhpcy5zbGljZShzdGFydEluZGV4LHN0YXJ0SW5kZXgrZGVsZXRlQ291bnQpO3RoaXMubGVuZ3RoPXN0YXJ0SW5kZXg7dmFyIGFyZ3VtZW50c0FycmF5PVtdO2Zvcih2YXIgaT0wLGxlbj1hcmd1bWVudHMubGVuZ3RoO2k8bGVuO2krKyl7YXJndW1lbnRzQXJyYXlbaV09YXJndW1lbnRzW2ldO30nLCd2YXIgaXRlbXNUb0FwcGVuZD0oYXJndW1lbnRzQXJyYXkubGVuZ3RoPjIpP2l0ZW1zQWZ0ZXJEZWxldGVkPWFyZ3VtZW50c0FycmF5LnNsaWNlKDIpLmNvbmNhdChpdGVtc0FmdGVyRGVsZXRlZCk6aXRlbXNBZnRlckRlbGV0ZWQ7Zm9yKGk9MCxsZW49aXRlbXNUb0FwcGVuZC5sZW5ndGg7aTxsZW47aSsrKXt0aGlzLnB1c2goaXRlbXNUb0FwcGVuZFtpXSk7fScsJ3JldHVybiBpdGVtc0RlbGV0ZWQ7fTt9JywnZnVuY3Rpb24gYXJyYXlfcmVtb3ZlKGFycix2YWwpe3ZhciBpbmRleD0tMTtmb3IodmFyIGk9MCxsZW49YXJyLmxlbmd0aDtpPGxlbjtpKyspe2lmKGFycltpXT09PXZhbCl7aW5kZXg9aTticmVhazt9fScsJ2lmKGluZGV4Pj0wKXthcnIuc3BsaWNlKGluZGV4LDEpO3JldHVybiBpbmRleDt9ZWxzZXtyZXR1cm4gZmFsc2U7fX0nLCdmdW5jdGlvbiBhcnJheV9yZW1vdmVGcm9tU3RhcnQoYXJyYXksbnVtYmVyVG9SZW1vdmUpe2lmKEFycmF5LnByb3RvdHlwZS5zcGxpY2Upe2FycmF5LnNwbGljZSgwLG51bWJlclRvUmVtb3ZlKTt9ZWxzZXtmb3IodmFyIGk9bnVtYmVyVG9SZW1vdmUsbGVuPWFycmF5Lmxlbmd0aDtpPGxlbjtpKyspe2FycmF5W2ktbnVtYmVyVG9SZW1vdmVdPWFycmF5W2ldO30nLCdhcnJheS5sZW5ndGg9YXJyYXkubGVuZ3RoLW51bWJlclRvUmVtb3ZlO30nLCdyZXR1cm4gYXJyYXk7fScsJ2Z1bmN0aW9uIGFycmF5X2NvbnRhaW5zKGFycix2YWwpe2Zvcih2YXIgaT0wLGxlbj1hcnIubGVuZ3RoO2k8bGVuO2krKyl7aWYoYXJyW2ldPT12YWwpe3JldHVybiB0cnVlO319JywncmV0dXJuIGZhbHNlO30nLCdmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoZXgpe2lmKGV4Lm1lc3NhZ2Upe3JldHVybiBleC5tZXNzYWdlO31lbHNlIGlmKGV4LmRlc2NyaXB0aW9uKXtyZXR1cm4gZXguZGVzY3JpcHRpb247fScsJ3JldHVybiIiK2V4O30nLCdmdW5jdGlvbiBtb3ZlQ2FyZXRUb0VuZChpbnB1dCl7aWYoaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2Upe2lucHV0LmZvY3VzKCk7dmFyIGxlbmd0aD1pbnB1dC52YWx1ZS5sZW5ndGg7aW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2UobGVuZ3RoLGxlbmd0aCk7fWVsc2UgaWYoaW5wdXQuY3JlYXRlVGV4dFJhbmdlKXt2YXIgcmFuZ2U9aW5wdXQuY3JlYXRlVGV4dFJhbmdlKCk7cmFuZ2UuY29sbGFwc2UoZmFsc2UpO3JhbmdlLnNlbGVjdCgpO30nLCdpbnB1dC5mb2N1cygpO30nLCdmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oZXZ0KXtpZihldnQuc3RvcFByb3BhZ2F0aW9uKXtldnQuc3RvcFByb3BhZ2F0aW9uKCk7fWVsc2UgaWYodHlwZW9mIGV2dC5jYW5jZWxCdWJibGUhPSJ1bmRlZmluZWQiKXtldnQuY2FuY2VsQnViYmxlPXRydWU7fX0nLCdmdW5jdGlvbiBnZXRFdmVudChldnQpe3JldHVybiBldnQ/ZXZ0OmV2ZW50O30nLCdmdW5jdGlvbiBnZXRUYXJnZXQoZXZ0KXtyZXR1cm4gZXZ0LnRhcmdldD9ldnQudGFyZ2V0OmV2dC5zcmNFbGVtZW50O30nLCdmdW5jdGlvbiBnZXRSZWxhdGVkVGFyZ2V0KGV2dCl7aWYoZXZ0LnJlbGF0ZWRUYXJnZXQpe3JldHVybiBldnQucmVsYXRlZFRhcmdldDt9ZWxzZSBpZihldnQuc3JjRWxlbWVudCl7c3dpdGNoKGV2dC50eXBlKXtjYXNlIm1vdXNlb3ZlciI6cmV0dXJuIGV2dC5mcm9tRWxlbWVudDtjYXNlIm1vdXNlb3V0IjpyZXR1cm4gZXZ0LnRvRWxlbWVudDtkZWZhdWx0OnJldHVybiBldnQuc3JjRWxlbWVudDt9fX0nLCdmdW5jdGlvbiBjYW5jZWxLZXlFdmVudChldnQpe2V2dC5yZXR1cm5WYWx1ZT1mYWxzZTtzdG9wUHJvcGFnYXRpb24oZXZ0KTt9JywnZnVuY3Rpb24gZXZhbENvbW1hbmRMaW5lKCl7dmFyIGV4cHI9JCgiY29tbWFuZCIpLnZhbHVlO2V2YWxDb21tYW5kKGV4cHIpOyQoImNvbW1hbmQiKS52YWx1ZT0iIjt9JywnZnVuY3Rpb24gZXZhbExhc3RDb21tYW5kKCl7aWYobGFzdENvbW1hbmQhPW51bGwpe2V2YWxDb21tYW5kKGxhc3RDb21tYW5kKTt9fScsJ3ZhciBsYXN0Q29tbWFuZD1udWxsO3ZhciBjb21tYW5kSGlzdG9yeT1bXTt2YXIgY3VycmVudENvbW1hbmRJbmRleD0wO2Z1bmN0aW9uIGV2YWxDb21tYW5kKGV4cHIpe2lmKGFwcGVuZGVyKXthcHBlbmRlci5ldmFsQ29tbWFuZEFuZEFwcGVuZChleHByKTt9ZWxzZXt2YXIgcHJlZml4PSI+Pj4gIitleHByKyJcXHJcXG4iO3RyeXtsb2coIklORk8iLHByZWZpeCtldmFsKGV4cHIpKTt9Y2F0Y2goZXgpe2xvZygiRVJST1IiLHByZWZpeCsiRXJyb3I6ICIrZ2V0RXJyb3JNZXNzYWdlKGV4KSk7fX0nLCdpZihleHByIT1jb21tYW5kSGlzdG9yeVtjb21tYW5kSGlzdG9yeS5sZW5ndGgtMV0pe2NvbW1hbmRIaXN0b3J5LnB1c2goZXhwcik7aWYoYXBwZW5kZXIpe2FwcGVuZGVyLnN0b3JlQ29tbWFuZEhpc3RvcnkoY29tbWFuZEhpc3RvcnkpO319JywnY3VycmVudENvbW1hbmRJbmRleD0oZXhwcj09Y29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF0pP2N1cnJlbnRDb21tYW5kSW5kZXgrMTpjb21tYW5kSGlzdG9yeS5sZW5ndGg7bGFzdENvbW1hbmQ9ZXhwcjt9JywnLy9dXT4nLCc8L3NjcmlwdD4nLCc8c3R5bGUgdHlwZT0idGV4dC9jc3MiPicsJ2JvZHl7YmFja2dyb3VuZC1jb2xvcjp3aGl0ZTtjb2xvcjpibGFjaztwYWRkaW5nOjA7bWFyZ2luOjA7Zm9udC1mYW1pbHk6dGFob21hLHZlcmRhbmEsYXJpYWwsaGVsdmV0aWNhLHNhbnMtc2VyaWY7b3ZlcmZsb3c6aGlkZGVufWRpdiNzd2l0Y2hlc0NvbnRhaW5lciBpbnB1dHttYXJnaW4tYm90dG9tOjB9ZGl2LnRvb2xiYXJ7Ym9yZGVyLXRvcDpzb2xpZCAjZmZmZmZmIDFweDtib3JkZXItYm90dG9tOnNvbGlkICNhY2E4OTkgMXB4O2JhY2tncm91bmQtY29sb3I6I2YxZWZlNztwYWRkaW5nOjNweCA1cHg7Zm9udC1zaXplOjY4Ljc1JX1kaXYudG9vbGJhcixkaXYjc2VhcmNoIGlucHV0e2ZvbnQtZmFtaWx5OnRhaG9tYSx2ZXJkYW5hLGFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmfWRpdi50b29sYmFyIGlucHV0LmJ1dHRvbntwYWRkaW5nOjAgNXB4O2ZvbnQtc2l6ZToxMDAlfWRpdi50b29sYmFyIGlucHV0LmhpZGRlbntkaXNwbGF5Om5vbmV9ZGl2I3N3aXRjaGVzIGlucHV0I2NsZWFyQnV0dG9ue21hcmdpbi1sZWZ0OjIwcHh9ZGl2I2xldmVscyBsYWJlbHtmb250LXdlaWdodDpib2xkfWRpdiNsZXZlbHMgbGFiZWwsZGl2I29wdGlvbnMgbGFiZWx7bWFyZ2luLXJpZ2h0OjVweH1kaXYjbGV2ZWxzIGxhYmVsI3dyYXBMYWJlbHtmb250LXdlaWdodDpub3JtYWx9ZGl2I3NlYXJjaCBsYWJlbHttYXJnaW4tcmlnaHQ6MTBweH1kaXYjc2VhcmNoIGxhYmVsLnNlYXJjaGJveGxhYmVse21hcmdpbi1yaWdodDowfWRpdiNzZWFyY2ggaW5wdXR7Zm9udC1zaXplOjEwMCV9ZGl2I3NlYXJjaCBpbnB1dC52YWxpZHJlZ2V4e2NvbG9yOmdyZWVufWRpdiNzZWFyY2ggaW5wdXQuaW52YWxpZHJlZ2V4e2NvbG9yOnJlZH1kaXYjc2VhcmNoIGlucHV0Lm5vbWF0Y2hlc3tjb2xvcjp3aGl0ZTtiYWNrZ3JvdW5kLWNvbG9yOiNmZjY2NjZ9ZGl2I3NlYXJjaCBpbnB1dC5ub21hdGNoZXN7Y29sb3I6d2hpdGU7YmFja2dyb3VuZC1jb2xvcjojZmY2NjY2fWRpdiNzZWFyY2hOYXZ7ZGlzcGxheTpub25lfWRpdiNjb21tYW5kTGluZXtkaXNwbGF5Om5vbmV9ZGl2I2NvbW1hbmRMaW5lIGlucHV0I2NvbW1hbmR7Zm9udC1zaXplOjEwMCU7Zm9udC1mYW1pbHk6Q291cmllciBOZXcsQ291cmllcn1kaXYjY29tbWFuZExpbmUgaW5wdXQjZXZhbHVhdGVCdXR0b257fSouZ3JleWVkb3V0e2NvbG9yOmdyYXkgIWltcG9ydGFudDtib3JkZXItY29sb3I6Z3JheSAhaW1wb3J0YW50fSouZ3JleWVkb3V0ICouYWx3YXlzZW5hYmxlZHtjb2xvcjpibGFja30qLnVuc2VsZWN0YWJsZXsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7dXNlci1zZWxlY3Q6bm9uZX1kaXYjbG9ne2ZvbnQtZmFtaWx5OkNvdXJpZXIgTmV3LENvdXJpZXI7Zm9udC1zaXplOjc1JTt3aWR0aDoxMDAlO292ZXJmbG93OmF1dG87Y2xlYXI6Ym90aDtwb3NpdGlvbjpyZWxhdGl2ZX1kaXYuZ3JvdXB7Ym9yZGVyLWNvbG9yOiNjY2NjY2M7Ym9yZGVyLXN0eWxlOnNvbGlkO2JvcmRlci13aWR0aDoxcHggMCAxcHggMXB4O292ZXJmbG93OnZpc2libGV9ZGl2Lm9sZEllIGRpdi5ncm91cCxkaXYub2xkSWUgZGl2Lmdyb3VwICosZGl2Lm9sZEllICoubG9nZW50cnl7aGVpZ2h0OjElfWRpdi5ncm91cCBkaXYuZ3JvdXBoZWFkaW5nIHNwYW4uZXhwYW5kZXJ7Ym9yZGVyOnNvbGlkIGJsYWNrIDFweDtmb250LWZhbWlseTpDb3VyaWVyIE5ldyxDb3VyaWVyO2ZvbnQtc2l6ZTowLjgzM2VtO2JhY2tncm91bmQtY29sb3I6I2VlZWVlZTtwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6LTFweDtjb2xvcjpibGFjaztwYWRkaW5nOjAgMnB4O2N1cnNvcjpwb2ludGVyO2N1cnNvcjpoYW5kO2hlaWdodDoxJX1kaXYuZ3JvdXAgZGl2Lmdyb3VwY29udGVudHttYXJnaW4tbGVmdDoxMHB4O3BhZGRpbmctYm90dG9tOjJweDtvdmVyZmxvdzp2aXNpYmxlfWRpdi5ncm91cCBkaXYuZXhwYW5kZWR7ZGlzcGxheTpibG9ja31kaXYuZ3JvdXAgZGl2LmNvbGxhcHNlZHtkaXNwbGF5Om5vbmV9Ki5sb2dlbnRyeXtvdmVyZmxvdzp2aXNpYmxlO2Rpc3BsYXk6bm9uZTt3aGl0ZS1zcGFjZTpwcmV9c3Bhbi5wcmV7d2hpdGUtc3BhY2U6cHJlfXByZS51bndyYXBwZWR7ZGlzcGxheTppbmxpbmUgIWltcG9ydGFudH1wcmUudW53cmFwcGVkIHByZS5wcmUsZGl2LndyYXBwZWQgcHJlLnByZXtkaXNwbGF5OmlubGluZX1kaXYud3JhcHBlZCBwcmUucHJle3doaXRlLXNwYWNlOm5vcm1hbH1kaXYud3JhcHBlZHtkaXNwbGF5Om5vbmV9Ym9keS5zZWFyY2hpbmcgKi5sb2dlbnRyeSBzcGFuLmN1cnJlbnRtYXRjaHtjb2xvcjp3aGl0ZSAhaW1wb3J0YW50O2JhY2tncm91bmQtY29sb3I6Z3JlZW4gIWltcG9ydGFudH1ib2R5LnNlYXJjaGluZyBkaXYuc2VhcmNoaGlnaGxpZ2h0ICoubG9nZW50cnkgc3Bhbi5zZWFyY2h0ZXJte2NvbG9yOmJsYWNrO2JhY2tncm91bmQtY29sb3I6eWVsbG93fWRpdi53cmFwICoubG9nZW50cnl7d2hpdGUtc3BhY2U6bm9ybWFsICFpbXBvcnRhbnQ7Ym9yZGVyLXdpZHRoOjAgMCAxcHggMDtib3JkZXItY29sb3I6I2RkZGRkZDtib3JkZXItc3R5bGU6ZG90dGVkfWRpdi53cmFwICNsb2dfd3JhcHBlZCwjbG9nX3Vud3JhcHBlZHtkaXNwbGF5OmJsb2NrfWRpdi53cmFwICNsb2dfdW53cmFwcGVkLCNsb2dfd3JhcHBlZHtkaXNwbGF5Om5vbmV9ZGl2LndyYXAgKi5sb2dlbnRyeSBzcGFuLnByZXtvdmVyZmxvdzp2aXNpYmxlO3doaXRlLXNwYWNlOm5vcm1hbH1kaXYud3JhcCAqLmxvZ2VudHJ5IHByZS51bndyYXBwZWR7ZGlzcGxheTpub25lfWRpdi53cmFwICoubG9nZW50cnkgc3Bhbi53cmFwcGVke2Rpc3BsYXk6aW5saW5lfWRpdi5zZWFyY2hmaWx0ZXIgKi5zZWFyY2hub25tYXRjaHtkaXNwbGF5Om5vbmUgIWltcG9ydGFudH1kaXYjbG9nICouVFJBQ0UsbGFiZWwjbGFiZWxfVFJBQ0V7Y29sb3I6IzY2NjY2Nn1kaXYjbG9nICouREVCVUcsbGFiZWwjbGFiZWxfREVCVUd7Y29sb3I6Z3JlZW59ZGl2I2xvZyAqLklORk8sbGFiZWwjbGFiZWxfSU5GT3tjb2xvcjojMDAwMDk5fWRpdiNsb2cgKi5XQVJOLGxhYmVsI2xhYmVsX1dBUk57Y29sb3I6Izk5OTkwMH1kaXYjbG9nICouRVJST1IsbGFiZWwjbGFiZWxfRVJST1J7Y29sb3I6cmVkfWRpdiNsb2cgKi5GQVRBTCxsYWJlbCNsYWJlbF9GQVRBTHtjb2xvcjojNjYwMDY2fWRpdi5UUkFDRSNsb2cgKi5UUkFDRSxkaXYuREVCVUcjbG9nICouREVCVUcsZGl2LklORk8jbG9nICouSU5GTyxkaXYuV0FSTiNsb2cgKi5XQVJOLGRpdi5FUlJPUiNsb2cgKi5FUlJPUixkaXYuRkFUQUwjbG9nICouRkFUQUx7ZGlzcGxheTpibG9ja31kaXYjbG9nIGRpdi5zZXBhcmF0b3J7YmFja2dyb3VuZC1jb2xvcjojY2NjY2NjO21hcmdpbjo1cHggMDtsaW5lLWhlaWdodDoxcHh9JywnPC9zdHlsZT4nLCc8L2hlYWQ+JywnPGJvZHkgaWQ9ImJvZHkiPicsJzxkaXYgaWQ9InN3aXRjaGVzQ29udGFpbmVyIj4nLCc8ZGl2IGlkPSJzd2l0Y2hlcyI+JywnPGRpdiBpZD0ibGV2ZWxzIiBjbGFzcz0idG9vbGJhciI+JywnRmlsdGVyczonLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfVFJBQ0UiIG9uY2xpY2s9ImFwcGx5RmlsdGVycygpOyBjaGVja0FsbExldmVscygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIHRyYWNlIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9UUkFDRSIgaWQ9ImxhYmVsX1RSQUNFIj50cmFjZTwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0RFQlVHIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBkZWJ1ZyBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfREVCVUciIGlkPSJsYWJlbF9ERUJVRyI+ZGVidWc8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9JTkZPIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBpbmZvIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9JTkZPIiBpZD0ibGFiZWxfSU5GTyI+aW5mbzwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX1dBUk4iIG9uY2xpY2s9ImFwcGx5RmlsdGVycygpOyBjaGVja0FsbExldmVscygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIHdhcm4gbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX1dBUk4iIGlkPSJsYWJlbF9XQVJOIj53YXJuPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfRVJST1IiIG9uY2xpY2s9ImFwcGx5RmlsdGVycygpOyBjaGVja0FsbExldmVscygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIGVycm9yIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9FUlJPUiIgaWQ9ImxhYmVsX0VSUk9SIj5lcnJvcjwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0ZBVEFMIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBmYXRhbCBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfRkFUQUwiIGlkPSJsYWJlbF9GQVRBTCI+ZmF0YWw8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9BTEwiIG9uY2xpY2s9InRvZ2dsZUFsbExldmVscygpOyBhcHBseUZpbHRlcnMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBhbGwgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX0FMTCIgaWQ9ImxhYmVsX0FMTCI+YWxsPC9sYWJlbD4nLCc8L2Rpdj4nLCc8ZGl2IGlkPSJzZWFyY2giIGNsYXNzPSJ0b29sYmFyIj4nLCc8bGFiZWwgZm9yPSJzZWFyY2hCb3giIGNsYXNzPSJzZWFyY2hib3hsYWJlbCI+U2VhcmNoOjwvbGFiZWw+IDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic2VhcmNoQm94IiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hFbmFibGVkKHRydWUpIiBvbmtleXVwPSJzY2hlZHVsZVNlYXJjaCgpIiBzaXplPSIyMCIgLz4nLCc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ic2VhcmNoUmVzZXQiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9IlJlc2V0IiBvbmNsaWNrPSJjbGVhclNlYXJjaCgpIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iUmVzZXQgdGhlIHNlYXJjaCIgLz4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hSZWdleCIgb25jbGljaz0iZG9TZWFyY2goKSIgdGl0bGU9IklmIGNoZWNrZWQsIHNlYXJjaCBpcyB0cmVhdGVkIGFzIGEgcmVndWxhciBleHByZXNzaW9uIiAvPjxsYWJlbCBmb3I9InNlYXJjaFJlZ2V4Ij5SZWdleDwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoQ2FzZVNlbnNpdGl2ZSIgb25jbGljaz0iZG9TZWFyY2goKSIgdGl0bGU9IklmIGNoZWNrZWQsIHNlYXJjaCBpcyBjYXNlIHNlbnNpdGl2ZSIgLz48bGFiZWwgZm9yPSJzZWFyY2hDYXNlU2Vuc2l0aXZlIj5NYXRjaCBjYXNlPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hEaXNhYmxlIiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hFbmFibGVkKCkiIHRpdGxlPSJFbmFibGUvZGlzYWJsZSBzZWFyY2giIC8+PGxhYmVsIGZvcj0ic2VhcmNoRGlzYWJsZSIgY2xhc3M9ImFsd2F5c2VuYWJsZWQiPkRpc2FibGU8L2xhYmVsPicsJzxkaXYgaWQ9InNlYXJjaE5hdiI+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9InNlYXJjaE5leHQiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9Ik5leHQiIG9uY2xpY2s9InNlYXJjaE5leHQoKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkdvIHRvIHRoZSBuZXh0IG1hdGNoaW5nIGxvZyBlbnRyeSIgLz4nLCc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ic2VhcmNoUHJldmlvdXMiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9IlByZXZpb3VzIiBvbmNsaWNrPSJzZWFyY2hQcmV2aW91cygpIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iR28gdG8gdGhlIHByZXZpb3VzIG1hdGNoaW5nIGxvZyBlbnRyeSIgLz4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hGaWx0ZXIiIG9uY2xpY2s9InRvZ2dsZVNlYXJjaEZpbHRlcigpIiB0aXRsZT0iSWYgY2hlY2tlZCwgbm9uLW1hdGNoaW5nIGxvZyBlbnRyaWVzIGFyZSBmaWx0ZXJlZCBvdXQiIC8+PGxhYmVsIGZvcj0ic2VhcmNoRmlsdGVyIj5GaWx0ZXI8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNlYXJjaEhpZ2hsaWdodCIgb25jbGljaz0idG9nZ2xlU2VhcmNoSGlnaGxpZ2h0KCkiIHRpdGxlPSJIaWdobGlnaHQgbWF0Y2hlZCBzZWFyY2ggdGVybXMiIC8+PGxhYmVsIGZvcj0ic2VhcmNoSGlnaGxpZ2h0IiBjbGFzcz0iYWx3YXlzZW5hYmxlZCI+SGlnaGxpZ2h0IGFsbDwvbGFiZWw+JywnPC9kaXY+JywnPC9kaXY+JywnPGRpdiBpZD0ib3B0aW9ucyIgY2xhc3M9InRvb2xiYXIiPicsJ09wdGlvbnM6JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZW5hYmxlTG9nZ2luZyIgb25jbGljaz0idG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IkVuYWJsZS9kaXNhYmxlIGxvZ2dpbmciIC8+PGxhYmVsIGZvcj0iZW5hYmxlTG9nZ2luZyIgaWQ9ImVuYWJsZUxvZ2dpbmdMYWJlbCI+TG9nPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ3cmFwIiBvbmNsaWNrPSJ0b2dnbGVXcmFwKCkiIHRpdGxlPSJFbmFibGUgLyBkaXNhYmxlIHdvcmQgd3JhcCIgLz48bGFiZWwgZm9yPSJ3cmFwIiBpZD0id3JhcExhYmVsIj5XcmFwPC9sYWJlbD4nLCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJuZXdlc3RBdFRvcCIgb25jbGljaz0idG9nZ2xlTmV3ZXN0QXRUb3AoKSIgdGl0bGU9IklmIGNoZWNrZWQsIGNhdXNlcyBuZXdlc3QgbWVzc2FnZXMgdG8gYXBwZWFyIGF0IHRoZSB0b3AiIC8+PGxhYmVsIGZvcj0ibmV3ZXN0QXRUb3AiIGlkPSJuZXdlc3RBdFRvcExhYmVsIj5OZXdlc3QgYXQgdGhlIHRvcDwvbGFiZWw+JywnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2Nyb2xsVG9MYXRlc3QiIG9uY2xpY2s9InRvZ2dsZVNjcm9sbFRvTGF0ZXN0KCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJJZiBjaGVja2VkLCB3aW5kb3cgYXV0b21hdGljYWxseSBzY3JvbGxzIHRvIGEgbmV3IG1lc3NhZ2Ugd2hlbiBpdCBpcyBhZGRlZCIgLz48bGFiZWwgZm9yPSJzY3JvbGxUb0xhdGVzdCIgaWQ9InNjcm9sbFRvTGF0ZXN0TGFiZWwiPlNjcm9sbCB0byBsYXRlc3Q8L2xhYmVsPicsJzxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJjbGVhckJ1dHRvbiIgdmFsdWU9IkNsZWFyIiBvbmNsaWNrPSJjbGVhckxvZygpIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iQ2xlYXIgYWxsIGxvZyBtZXNzYWdlcyIgIC8+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImhpZGVCdXR0b24iIHZhbHVlPSJIaWRlIiBvbmNsaWNrPSJoaWRlKCkiIGNsYXNzPSJoaWRkZW4gYnV0dG9uIiB0aXRsZT0iSGlkZSB0aGUgY29uc29sZSIgLz4nLCc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iY2xvc2VCdXR0b24iIHZhbHVlPSJDbG9zZSIgb25jbGljaz0iY2xvc2VXaW5kb3coKSIgY2xhc3M9ImhpZGRlbiBidXR0b24iIHRpdGxlPSJDbG9zZSB0aGUgd2luZG93IiAvPicsJzwvZGl2PicsJzwvZGl2PicsJzwvZGl2PicsJzxkaXYgaWQ9ImxvZyIgY2xhc3M9IlRSQUNFIERFQlVHIElORk8gV0FSTiBFUlJPUiBGQVRBTCI+PC9kaXY+JywnPGRpdiBpZD0iY29tbWFuZExpbmUiIGNsYXNzPSJ0b29sYmFyIj4nLCc8ZGl2IGlkPSJjb21tYW5kTGluZUNvbnRhaW5lciI+JywnPGlucHV0IHR5cGU9InRleHQiIGlkPSJjb21tYW5kIiB0aXRsZT0iRW50ZXIgYSBKYXZhU2NyaXB0IGNvbW1hbmQgaGVyZSBhbmQgaGl0IHJldHVybiBvciBwcmVzcyBcJ0V2YWx1YXRlXCciIC8+JywnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImV2YWx1YXRlQnV0dG9uIiB2YWx1ZT0iRXZhbHVhdGUiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJFdmFsdWF0ZSB0aGUgY29tbWFuZCIgb25jbGljaz0iZXZhbENvbW1hbmRMaW5lKCkiIC8+JywnPC9kaXY+JywnPC9kaXY+JywnPC9ib2R5PicsJzwvaHRtbD4nLCcnXTt9O3ZhciBkZWZhdWx0Q29tbWFuZExpbmVGdW5jdGlvbnM9W107Q29uc29sZUFwcGVuZGVyPWZ1bmN0aW9uKCl7fTt2YXIgY29uc29sZUFwcGVuZGVySWRDb3VudGVyPTE7Q29uc29sZUFwcGVuZGVyLnByb3RvdHlwZT1uZXcgQXBwZW5kZXIoKTtDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmNyZWF0ZT1mdW5jdGlvbihpblBhZ2UsY29udGFpbmVyLGxhenlJbml0LGluaXRpYWxseU1pbmltaXplZCx1c2VEb2N1bWVudFdyaXRlLHdpZHRoLGhlaWdodCxmb2N1c0NvbnNvbGVXaW5kb3cpe3ZhciBhcHBlbmRlcj10aGlzO3ZhciBpbml0aWFsaXplZD1mYWxzZTt2YXIgY29uc29sZVdpbmRvd0NyZWF0ZWQ9ZmFsc2U7dmFyIGNvbnNvbGVXaW5kb3dMb2FkZWQ9ZmFsc2U7dmFyIGNvbnNvbGVDbG9zZWQ9ZmFsc2U7dmFyIHF1ZXVlZExvZ2dpbmdFdmVudHM9W107dmFyIGlzU3VwcG9ydGVkPXRydWU7dmFyIGNvbnNvbGVBcHBlbmRlcklkPWNvbnNvbGVBcHBlbmRlcklkQ291bnRlcisrO2luaXRpYWxseU1pbmltaXplZD1leHRyYWN0Qm9vbGVhbkZyb21QYXJhbShpbml0aWFsbHlNaW5pbWl6ZWQsdGhpcy5kZWZhdWx0cy5pbml0aWFsbHlNaW5pbWl6ZWQpO2xhenlJbml0PWV4dHJhY3RCb29sZWFuRnJvbVBhcmFtKGxhenlJbml0LHRoaXMuZGVmYXVsdHMubGF6eUluaXQpO3VzZURvY3VtZW50V3JpdGU9ZXh0cmFjdEJvb2xlYW5Gcm9tUGFyYW0odXNlRG9jdW1lbnRXcml0ZSx0aGlzLmRlZmF1bHRzLnVzZURvY3VtZW50V3JpdGUpO3ZhciBuZXdlc3RNZXNzYWdlQXRUb3A9dGhpcy5kZWZhdWx0cy5uZXdlc3RNZXNzYWdlQXRUb3A7dmFyIHNjcm9sbFRvTGF0ZXN0TWVzc2FnZT10aGlzLmRlZmF1bHRzLnNjcm9sbFRvTGF0ZXN0TWVzc2FnZTt3aWR0aD13aWR0aD93aWR0aDp0aGlzLmRlZmF1bHRzLndpZHRoO2hlaWdodD1oZWlnaHQ/aGVpZ2h0OnRoaXMuZGVmYXVsdHMuaGVpZ2h0O3ZhciBtYXhNZXNzYWdlcz10aGlzLmRlZmF1bHRzLm1heE1lc3NhZ2VzO3ZhciBzaG93Q29tbWFuZExpbmU9dGhpcy5kZWZhdWx0cy5zaG93Q29tbWFuZExpbmU7dmFyIGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg9dGhpcy5kZWZhdWx0cy5jb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoO3ZhciBzaG93SGlkZUJ1dHRvbj10aGlzLmRlZmF1bHRzLnNob3dIaWRlQnV0dG9uO3ZhciBzaG93Q2xvc2VCdXR0b249dGhpcy5kZWZhdWx0cy5zaG93Q2xvc2VCdXR0b247dmFyIHNob3dMb2dFbnRyeURlbGV0ZUJ1dHRvbnM9dGhpcy5kZWZhdWx0cy5zaG93TG9nRW50cnlEZWxldGVCdXR0b25zO3RoaXMuc2V0TGF5b3V0KHRoaXMuZGVmYXVsdHMubGF5b3V0KTt2YXIgaW5pdCxjcmVhdGVXaW5kb3csc2FmZVRvQXBwZW5kLGdldENvbnNvbGVXaW5kb3csb3Blbjt2YXIgYXBwZW5kZXJOYW1lPWluUGFnZT8iSW5QYWdlQXBwZW5kZXIiOiJQb3BVcEFwcGVuZGVyIjt2YXIgY2hlY2tDYW5Db25maWd1cmU9ZnVuY3Rpb24oY29uZmlnT3B0aW9uTmFtZSl7aWYoY29uc29sZVdpbmRvd0NyZWF0ZWQpe2hhbmRsZUVycm9yKGFwcGVuZGVyTmFtZSsiOiBjb25maWd1cmF0aW9uIG9wdGlvbiAnIitjb25maWdPcHRpb25OYW1lKyInIG1heSBub3QgYmUgc2V0IGFmdGVyIHRoZSBhcHBlbmRlciBoYXMgYmVlbiBpbml0aWFsaXplZCIpO3JldHVybiBmYWxzZTt9DQpyZXR1cm4gdHJ1ZTt9O3ZhciBjb25zb2xlV2luZG93RXhpc3RzPWZ1bmN0aW9uKCl7cmV0dXJuKGNvbnNvbGVXaW5kb3dMb2FkZWQmJmlzU3VwcG9ydGVkJiYhY29uc29sZUNsb3NlZCk7fTt0aGlzLmlzTmV3ZXN0TWVzc2FnZUF0VG9wPWZ1bmN0aW9uKCl7cmV0dXJuIG5ld2VzdE1lc3NhZ2VBdFRvcDt9O3RoaXMuc2V0TmV3ZXN0TWVzc2FnZUF0VG9wPWZ1bmN0aW9uKG5ld2VzdE1lc3NhZ2VBdFRvcFBhcmFtKXtuZXdlc3RNZXNzYWdlQXRUb3A9Ym9vbChuZXdlc3RNZXNzYWdlQXRUb3BQYXJhbSk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0TmV3ZXN0QXRUb3AobmV3ZXN0TWVzc2FnZUF0VG9wKTt9fTt0aGlzLmlzU2Nyb2xsVG9MYXRlc3RNZXNzYWdlPWZ1bmN0aW9uKCl7cmV0dXJuIHNjcm9sbFRvTGF0ZXN0TWVzc2FnZTt9O3RoaXMuc2V0U2Nyb2xsVG9MYXRlc3RNZXNzYWdlPWZ1bmN0aW9uKHNjcm9sbFRvTGF0ZXN0TWVzc2FnZVBhcmFtKXtzY3JvbGxUb0xhdGVzdE1lc3NhZ2U9Ym9vbChzY3JvbGxUb0xhdGVzdE1lc3NhZ2VQYXJhbSk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0U2Nyb2xsVG9MYXRlc3Qoc2Nyb2xsVG9MYXRlc3RNZXNzYWdlKTt9fTt0aGlzLmdldFdpZHRoPWZ1bmN0aW9uKCl7cmV0dXJuIHdpZHRoO307dGhpcy5zZXRXaWR0aD1mdW5jdGlvbih3aWR0aFBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgid2lkdGgiKSl7d2lkdGg9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbSh3aWR0aFBhcmFtLHdpZHRoKTt9fTt0aGlzLmdldEhlaWdodD1mdW5jdGlvbigpe3JldHVybiBoZWlnaHQ7fTt0aGlzLnNldEhlaWdodD1mdW5jdGlvbihoZWlnaHRQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImhlaWdodCIpKXtoZWlnaHQ9ZXh0cmFjdFN0cmluZ0Zyb21QYXJhbShoZWlnaHRQYXJhbSxoZWlnaHQpO319O3RoaXMuZ2V0TWF4TWVzc2FnZXM9ZnVuY3Rpb24oKXtyZXR1cm4gbWF4TWVzc2FnZXM7fTt0aGlzLnNldE1heE1lc3NhZ2VzPWZ1bmN0aW9uKG1heE1lc3NhZ2VzUGFyYW0pe21heE1lc3NhZ2VzPWV4dHJhY3RJbnRGcm9tUGFyYW0obWF4TWVzc2FnZXNQYXJhbSxtYXhNZXNzYWdlcyk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0TWF4TWVzc2FnZXMobWF4TWVzc2FnZXMpO319O3RoaXMuaXNTaG93Q29tbWFuZExpbmU9ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd0NvbW1hbmRMaW5lO307dGhpcy5zZXRTaG93Q29tbWFuZExpbmU9ZnVuY3Rpb24oc2hvd0NvbW1hbmRMaW5lUGFyYW0pe3Nob3dDb21tYW5kTGluZT1ib29sKHNob3dDb21tYW5kTGluZVBhcmFtKTtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS5zZXRTaG93Q29tbWFuZExpbmUoc2hvd0NvbW1hbmRMaW5lKTt9fTt0aGlzLmlzU2hvd0hpZGVCdXR0b249ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd0hpZGVCdXR0b247fTt0aGlzLnNldFNob3dIaWRlQnV0dG9uPWZ1bmN0aW9uKHNob3dIaWRlQnV0dG9uUGFyYW0pe3Nob3dIaWRlQnV0dG9uPWJvb2woc2hvd0hpZGVCdXR0b25QYXJhbSk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuc2V0U2hvd0hpZGVCdXR0b24oc2hvd0hpZGVCdXR0b24pO319O3RoaXMuaXNTaG93Q2xvc2VCdXR0b249ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd0Nsb3NlQnV0dG9uO307dGhpcy5zZXRTaG93Q2xvc2VCdXR0b249ZnVuY3Rpb24oc2hvd0Nsb3NlQnV0dG9uUGFyYW0pe3Nob3dDbG9zZUJ1dHRvbj1ib29sKHNob3dDbG9zZUJ1dHRvblBhcmFtKTtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS5zZXRTaG93Q2xvc2VCdXR0b24oc2hvd0Nsb3NlQnV0dG9uKTt9fTt0aGlzLmdldENvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg9ZnVuY3Rpb24oKXtyZXR1cm4gY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aDt9O3RoaXMuc2V0Q29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aD1mdW5jdGlvbihjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoUGFyYW0pe2NvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg9ZXh0cmFjdEludEZyb21QYXJhbShjb21tYW5kTGluZU9iamVjdEV4cGFuc2lvbkRlcHRoUGFyYW0sY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aCk7fTt2YXIgbWluaW1pemVkPWluaXRpYWxseU1pbmltaXplZDt0aGlzLmlzSW5pdGlhbGx5TWluaW1pemVkPWZ1bmN0aW9uKCl7cmV0dXJuIGluaXRpYWxseU1pbmltaXplZDt9O3RoaXMuc2V0SW5pdGlhbGx5TWluaW1pemVkPWZ1bmN0aW9uKGluaXRpYWxseU1pbmltaXplZFBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgiaW5pdGlhbGx5TWluaW1pemVkIikpe2luaXRpYWxseU1pbmltaXplZD1ib29sKGluaXRpYWxseU1pbmltaXplZFBhcmFtKTttaW5pbWl6ZWQ9aW5pdGlhbGx5TWluaW1pemVkO319O3RoaXMuaXNVc2VEb2N1bWVudFdyaXRlPWZ1bmN0aW9uKCl7cmV0dXJuIHVzZURvY3VtZW50V3JpdGU7fTt0aGlzLnNldFVzZURvY3VtZW50V3JpdGU9ZnVuY3Rpb24odXNlRG9jdW1lbnRXcml0ZVBhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgidXNlRG9jdW1lbnRXcml0ZSIpKXt1c2VEb2N1bWVudFdyaXRlPWJvb2wodXNlRG9jdW1lbnRXcml0ZVBhcmFtKTt9fTtmdW5jdGlvbiBRdWV1ZWRMb2dnaW5nRXZlbnQobG9nZ2luZ0V2ZW50LGZvcm1hdHRlZE1lc3NhZ2Upe3RoaXMubG9nZ2luZ0V2ZW50PWxvZ2dpbmdFdmVudDt0aGlzLmxldmVsTmFtZT1sb2dnaW5nRXZlbnQubGV2ZWwubmFtZTt0aGlzLmZvcm1hdHRlZE1lc3NhZ2U9Zm9ybWF0dGVkTWVzc2FnZTt9DQpRdWV1ZWRMb2dnaW5nRXZlbnQucHJvdG90eXBlLmFwcGVuZD1mdW5jdGlvbigpe2dldENvbnNvbGVXaW5kb3coKS5sb2codGhpcy5sZXZlbE5hbWUsdGhpcy5mb3JtYXR0ZWRNZXNzYWdlKTt9O2Z1bmN0aW9uIFF1ZXVlZEdyb3VwKG5hbWUsaW5pdGlhbGx5RXhwYW5kZWQpe3RoaXMubmFtZT1uYW1lO3RoaXMuaW5pdGlhbGx5RXhwYW5kZWQ9aW5pdGlhbGx5RXhwYW5kZWQ7fQ0KUXVldWVkR3JvdXAucHJvdG90eXBlLmFwcGVuZD1mdW5jdGlvbigpe2dldENvbnNvbGVXaW5kb3coKS5ncm91cCh0aGlzLm5hbWUsdGhpcy5pbml0aWFsbHlFeHBhbmRlZCk7fTtmdW5jdGlvbiBRdWV1ZWRHcm91cEVuZCgpe30NClF1ZXVlZEdyb3VwRW5kLnByb3RvdHlwZS5hcHBlbmQ9ZnVuY3Rpb24oKXtnZXRDb25zb2xlV2luZG93KCkuZ3JvdXBFbmQoKTt9O3ZhciBjaGVja0FuZEFwcGVuZD1mdW5jdGlvbigpe3NhZmVUb0FwcGVuZCgpO2lmKCFpbml0aWFsaXplZCl7aW5pdCgpO31lbHNlIGlmKGNvbnNvbGVDbG9zZWQmJnJlb3BlbldoZW5DbG9zZWQpe2NyZWF0ZVdpbmRvdygpO30NCmlmKHNhZmVUb0FwcGVuZCgpKXthcHBlbmRRdWV1ZWRMb2dnaW5nRXZlbnRzKCk7fX07dGhpcy5hcHBlbmQ9ZnVuY3Rpb24obG9nZ2luZ0V2ZW50KXtpZihpc1N1cHBvcnRlZCl7dmFyIGZvcm1hdHRlZE1lc3NhZ2U9YXBwZW5kZXIuZ2V0TGF5b3V0KCkuZm9ybWF0KGxvZ2dpbmdFdmVudCk7aWYodGhpcy5nZXRMYXlvdXQoKS5pZ25vcmVzVGhyb3dhYmxlKCkpe2Zvcm1hdHRlZE1lc3NhZ2UrPWxvZ2dpbmdFdmVudC5nZXRUaHJvd2FibGVTdHJSZXAoKTt9DQpxdWV1ZWRMb2dnaW5nRXZlbnRzLnB1c2gobmV3IFF1ZXVlZExvZ2dpbmdFdmVudChsb2dnaW5nRXZlbnQsZm9ybWF0dGVkTWVzc2FnZSkpO2NoZWNrQW5kQXBwZW5kKCk7fX07dGhpcy5ncm91cD1mdW5jdGlvbihuYW1lLGluaXRpYWxseUV4cGFuZGVkKXtpZihpc1N1cHBvcnRlZCl7cXVldWVkTG9nZ2luZ0V2ZW50cy5wdXNoKG5ldyBRdWV1ZWRHcm91cChuYW1lLGluaXRpYWxseUV4cGFuZGVkKSk7Y2hlY2tBbmRBcHBlbmQoKTt9fTt0aGlzLmdyb3VwRW5kPWZ1bmN0aW9uKCl7aWYoaXNTdXBwb3J0ZWQpe3F1ZXVlZExvZ2dpbmdFdmVudHMucHVzaChuZXcgUXVldWVkR3JvdXBFbmQoKSk7Y2hlY2tBbmRBcHBlbmQoKTt9fTt2YXIgYXBwZW5kUXVldWVkTG9nZ2luZ0V2ZW50cz1mdW5jdGlvbigpe3ZhciBjdXJyZW50TG9nZ2luZ0V2ZW50O3doaWxlKHF1ZXVlZExvZ2dpbmdFdmVudHMubGVuZ3RoPjApe3F1ZXVlZExvZ2dpbmdFdmVudHMuc2hpZnQoKS5hcHBlbmQoKTt9DQppZihmb2N1c0NvbnNvbGVXaW5kb3cpe2dldENvbnNvbGVXaW5kb3coKS5mb2N1cygpO319O3RoaXMuc2V0QWRkZWRUb0xvZ2dlcj1mdW5jdGlvbihsb2dnZXIpe3RoaXMubG9nZ2Vycy5wdXNoKGxvZ2dlcik7aWYoZW5hYmxlZCYmIWxhenlJbml0KXtpbml0KCk7fX07dGhpcy5jbGVhcj1mdW5jdGlvbigpe2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLmNsZWFyTG9nKCk7fQ0KcXVldWVkTG9nZ2luZ0V2ZW50cy5sZW5ndGg9MDt9O3RoaXMuZm9jdXM9ZnVuY3Rpb24oKXtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS5mb2N1cygpO319O3RoaXMuZm9jdXNDb21tYW5kTGluZT1mdW5jdGlvbigpe2lmKGNvbnNvbGVXaW5kb3dFeGlzdHMoKSl7Z2V0Q29uc29sZVdpbmRvdygpLmZvY3VzQ29tbWFuZExpbmUoKTt9fTt0aGlzLmZvY3VzU2VhcmNoPWZ1bmN0aW9uKCl7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuZm9jdXNTZWFyY2goKTt9fTt2YXIgY29tbWFuZFdpbmRvdz13aW5kb3c7dGhpcy5nZXRDb21tYW5kV2luZG93PWZ1bmN0aW9uKCl7cmV0dXJuIGNvbW1hbmRXaW5kb3c7fTt0aGlzLnNldENvbW1hbmRXaW5kb3c9ZnVuY3Rpb24oY29tbWFuZFdpbmRvd1BhcmFtKXtjb21tYW5kV2luZG93PWNvbW1hbmRXaW5kb3dQYXJhbTt9O3RoaXMuZXhlY3V0ZUxhc3RDb21tYW5kPWZ1bmN0aW9uKCl7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXtnZXRDb25zb2xlV2luZG93KCkuZXZhbExhc3RDb21tYW5kKCk7fX07dmFyIGNvbW1hbmRMYXlvdXQ9bmV3IFBhdHRlcm5MYXlvdXQoIiVtIik7dGhpcy5nZXRDb21tYW5kTGF5b3V0PWZ1bmN0aW9uKCl7cmV0dXJuIGNvbW1hbmRMYXlvdXQ7fTt0aGlzLnNldENvbW1hbmRMYXlvdXQ9ZnVuY3Rpb24oY29tbWFuZExheW91dFBhcmFtKXtjb21tYW5kTGF5b3V0PWNvbW1hbmRMYXlvdXRQYXJhbTt9O3RoaXMuZXZhbENvbW1hbmRBbmRBcHBlbmQ9ZnVuY3Rpb24oZXhwcil7dmFyIGNvbW1hbmRSZXR1cm5WYWx1ZT17YXBwZW5kUmVzdWx0OnRydWUsaXNFcnJvcjpmYWxzZX07dmFyIGNvbW1hbmRPdXRwdXQ9IiI7dHJ5e3ZhciByZXN1bHQsaTtpZighY29tbWFuZFdpbmRvdy5ldmFsJiZjb21tYW5kV2luZG93LmV4ZWNTY3JpcHQpe2NvbW1hbmRXaW5kb3cuZXhlY1NjcmlwdCgibnVsbCIpO30NCnZhciBjb21tYW5kTGluZUZ1bmN0aW9uc0hhc2g9e307Zm9yKGk9MCxsZW49Y29tbWFuZExpbmVGdW5jdGlvbnMubGVuZ3RoO2k8bGVuO2krKyl7Y29tbWFuZExpbmVGdW5jdGlvbnNIYXNoW2NvbW1hbmRMaW5lRnVuY3Rpb25zW2ldWzBdXT1jb21tYW5kTGluZUZ1bmN0aW9uc1tpXVsxXTt9DQp2YXIgb2JqZWN0c1RvUmVzdG9yZT1bXTt2YXIgYWRkT2JqZWN0VG9SZXN0b3JlPWZ1bmN0aW9uKG5hbWUpe29iamVjdHNUb1Jlc3RvcmUucHVzaChbbmFtZSxjb21tYW5kV2luZG93W25hbWVdXSk7fTthZGRPYmplY3RUb1Jlc3RvcmUoImFwcGVuZGVyIik7Y29tbWFuZFdpbmRvdy5hcHBlbmRlcj1hcHBlbmRlcjthZGRPYmplY3RUb1Jlc3RvcmUoImNvbW1hbmRSZXR1cm5WYWx1ZSIpO2NvbW1hbmRXaW5kb3cuY29tbWFuZFJldHVyblZhbHVlPWNvbW1hbmRSZXR1cm5WYWx1ZTthZGRPYmplY3RUb1Jlc3RvcmUoImNvbW1hbmRMaW5lRnVuY3Rpb25zSGFzaCIpO2NvbW1hbmRXaW5kb3cuY29tbWFuZExpbmVGdW5jdGlvbnNIYXNoPWNvbW1hbmRMaW5lRnVuY3Rpb25zSGFzaDt2YXIgYWRkRnVuY3Rpb25Ub1dpbmRvdz1mdW5jdGlvbihuYW1lKXthZGRPYmplY3RUb1Jlc3RvcmUobmFtZSk7Y29tbWFuZFdpbmRvd1tuYW1lXT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbW1hbmRMaW5lRnVuY3Rpb25zSGFzaFtuYW1lXShhcHBlbmRlcixhcmd1bWVudHMsY29tbWFuZFJldHVyblZhbHVlKTt9O307Zm9yKGk9MCxsZW49Y29tbWFuZExpbmVGdW5jdGlvbnMubGVuZ3RoO2k8bGVuO2krKyl7YWRkRnVuY3Rpb25Ub1dpbmRvdyhjb21tYW5kTGluZUZ1bmN0aW9uc1tpXVswXSk7fQ0KaWYoY29tbWFuZFdpbmRvdz09PXdpbmRvdyYmY29tbWFuZFdpbmRvdy5leGVjU2NyaXB0KXthZGRPYmplY3RUb1Jlc3RvcmUoImV2YWxFeHByIik7YWRkT2JqZWN0VG9SZXN0b3JlKCJyZXN1bHQiKTt3aW5kb3cuZXZhbEV4cHI9ZXhwcjtjb21tYW5kV2luZG93LmV4ZWNTY3JpcHQoIndpbmRvdy5yZXN1bHQ9ZXZhbCh3aW5kb3cuZXZhbEV4cHIpOyIpO3Jlc3VsdD13aW5kb3cucmVzdWx0O31lbHNle3Jlc3VsdD1jb21tYW5kV2luZG93LmV2YWwoZXhwcik7fQ0KY29tbWFuZE91dHB1dD1pc1VuZGVmaW5lZChyZXN1bHQpP3Jlc3VsdDpmb3JtYXRPYmplY3RFeHBhbnNpb24ocmVzdWx0LGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGgpO2ZvcihpPTAsbGVuPW9iamVjdHNUb1Jlc3RvcmUubGVuZ3RoO2k8bGVuO2krKyl7Y29tbWFuZFdpbmRvd1tvYmplY3RzVG9SZXN0b3JlW2ldWzBdXT1vYmplY3RzVG9SZXN0b3JlW2ldWzFdO319Y2F0Y2goZXgpe2NvbW1hbmRPdXRwdXQ9IkVycm9yIGV2YWx1YXRpbmcgY29tbWFuZDogIitnZXRFeGNlcHRpb25TdHJpbmdSZXAoZXgpO2NvbW1hbmRSZXR1cm5WYWx1ZS5pc0Vycm9yPXRydWU7fQ0KaWYoY29tbWFuZFJldHVyblZhbHVlLmFwcGVuZFJlc3VsdCl7dmFyIG1lc3NhZ2U9Ij4+PiAiK2V4cHI7aWYoIWlzVW5kZWZpbmVkKGNvbW1hbmRPdXRwdXQpKXttZXNzYWdlKz1uZXdMaW5lK2NvbW1hbmRPdXRwdXQ7fQ0KdmFyIGxldmVsPWNvbW1hbmRSZXR1cm5WYWx1ZS5pc0Vycm9yP0xldmVsLkVSUk9SOkxldmVsLklORk87dmFyIGxvZ2dpbmdFdmVudD1uZXcgTG9nZ2luZ0V2ZW50KG51bGwsbmV3IERhdGUoKSxsZXZlbCxbbWVzc2FnZV0sbnVsbCk7dmFyIG1haW5MYXlvdXQ9dGhpcy5nZXRMYXlvdXQoKTt0aGlzLnNldExheW91dChjb21tYW5kTGF5b3V0KTt0aGlzLmFwcGVuZChsb2dnaW5nRXZlbnQpO3RoaXMuc2V0TGF5b3V0KG1haW5MYXlvdXQpO319O3ZhciBjb21tYW5kTGluZUZ1bmN0aW9ucz1kZWZhdWx0Q29tbWFuZExpbmVGdW5jdGlvbnMuY29uY2F0KFtdKTt0aGlzLmFkZENvbW1hbmRMaW5lRnVuY3Rpb249ZnVuY3Rpb24oZnVuY3Rpb25OYW1lLGNvbW1hbmRMaW5lRnVuY3Rpb24pe2NvbW1hbmRMaW5lRnVuY3Rpb25zLnB1c2goW2Z1bmN0aW9uTmFtZSxjb21tYW5kTGluZUZ1bmN0aW9uXSk7fTt2YXIgY29tbWFuZEhpc3RvcnlDb29raWVOYW1lPSJsb2c0amF2YXNjcmlwdENvbW1hbmRIaXN0b3J5Ijt0aGlzLnN0b3JlQ29tbWFuZEhpc3Rvcnk9ZnVuY3Rpb24oY29tbWFuZEhpc3Rvcnkpe3NldENvb2tpZShjb21tYW5kSGlzdG9yeUNvb2tpZU5hbWUsY29tbWFuZEhpc3Rvcnkuam9pbigiLCIpKTt9O3ZhciB3cml0ZUh0bWw9ZnVuY3Rpb24oZG9jKXt2YXIgbGluZXM9Z2V0Q29uc29sZUh0bWxMaW5lcygpO2RvYy5vcGVuKCk7Zm9yKHZhciBpPTAsbGVuPWxpbmVzLmxlbmd0aDtpPGxlbjtpKyspe2RvYy53cml0ZWxuKGxpbmVzW2ldKTt9DQpkb2MuY2xvc2UoKTt9O3RoaXMuc2V0RXZlbnRUeXBlcyhbImxvYWQiLCJ1bmxvYWQiXSk7dmFyIGNvbnNvbGVXaW5kb3dMb2FkSGFuZGxlcj1mdW5jdGlvbigpe3ZhciB3aW49Z2V0Q29uc29sZVdpbmRvdygpO3dpbi5zZXRBcHBlbmRlcihhcHBlbmRlcik7d2luLnNldE5ld2VzdEF0VG9wKG5ld2VzdE1lc3NhZ2VBdFRvcCk7d2luLnNldFNjcm9sbFRvTGF0ZXN0KHNjcm9sbFRvTGF0ZXN0TWVzc2FnZSk7d2luLnNldE1heE1lc3NhZ2VzKG1heE1lc3NhZ2VzKTt3aW4uc2V0U2hvd0NvbW1hbmRMaW5lKHNob3dDb21tYW5kTGluZSk7d2luLnNldFNob3dIaWRlQnV0dG9uKHNob3dIaWRlQnV0dG9uKTt3aW4uc2V0U2hvd0Nsb3NlQnV0dG9uKHNob3dDbG9zZUJ1dHRvbik7d2luLnNldE1haW5XaW5kb3cod2luZG93KTt2YXIgc3RvcmVkVmFsdWU9Z2V0Q29va2llKGNvbW1hbmRIaXN0b3J5Q29va2llTmFtZSk7aWYoc3RvcmVkVmFsdWUpe3dpbi5jb21tYW5kSGlzdG9yeT1zdG9yZWRWYWx1ZS5zcGxpdCgiLCIpO3dpbi5jdXJyZW50Q29tbWFuZEluZGV4PXdpbi5jb21tYW5kSGlzdG9yeS5sZW5ndGg7fQ0KYXBwZW5kZXIuZGlzcGF0Y2hFdmVudCgibG9hZCIseyJ3aW4iOndpbn0pO307dGhpcy51bmxvYWQ9ZnVuY3Rpb24oKXtsb2dMb2cuZGVidWcoInVubG9hZCAiK3RoaXMrIiwgY2FsbGVyOiAiK3RoaXMudW5sb2FkLmNhbGxlcik7aWYoIWNvbnNvbGVDbG9zZWQpe2xvZ0xvZy5kZWJ1ZygicmVhbGx5IGRvaW5nIHVubG9hZCAiK3RoaXMpO2NvbnNvbGVDbG9zZWQ9dHJ1ZTtjb25zb2xlV2luZG93TG9hZGVkPWZhbHNlO2NvbnNvbGVXaW5kb3dDcmVhdGVkPWZhbHNlO2FwcGVuZGVyLmRpc3BhdGNoRXZlbnQoInVubG9hZCIse30pO319O3ZhciBwb2xsQ29uc29sZVdpbmRvdz1mdW5jdGlvbih3aW5kb3dUZXN0LGludGVydmFsLHN1Y2Nlc3NDYWxsYmFjayxlcnJvck1lc3NhZ2Upe2Z1bmN0aW9uIGRvUG9sbCgpe3RyeXtpZihjb25zb2xlQ2xvc2VkKXtjbGVhckludGVydmFsKHBvbGwpO30NCmlmKHdpbmRvd1Rlc3QoZ2V0Q29uc29sZVdpbmRvdygpKSl7Y2xlYXJJbnRlcnZhbChwb2xsKTtzdWNjZXNzQ2FsbGJhY2soKTt9fWNhdGNoKGV4KXtjbGVhckludGVydmFsKHBvbGwpO2lzU3VwcG9ydGVkPWZhbHNlO2hhbmRsZUVycm9yKGVycm9yTWVzc2FnZSxleCk7fX0NCnZhciBwb2xsPXNldEludGVydmFsKGRvUG9sbCxpbnRlcnZhbCk7fTt2YXIgZ2V0Q29uc29sZVVybD1mdW5jdGlvbigpe3ZhciBkb2N1bWVudERvbWFpblNldD0oZG9jdW1lbnQuZG9tYWluIT1sb2NhdGlvbi5ob3N0bmFtZSk7cmV0dXJuIHVzZURvY3VtZW50V3JpdGU/IiI6Z2V0QmFzZVVybCgpKyJjb25zb2xlLmh0bWwiKw0KKGRvY3VtZW50RG9tYWluU2V0PyI/bG9nNGphdmFzY3JpcHRfZG9tYWluPSIrZXNjYXBlKGRvY3VtZW50LmRvbWFpbik6IiIpO307aWYoaW5QYWdlKXt2YXIgY29udGFpbmVyRWxlbWVudD1udWxsO3ZhciBjc3NQcm9wZXJ0aWVzPVtdO3RoaXMuYWRkQ3NzUHJvcGVydHk9ZnVuY3Rpb24obmFtZSx2YWx1ZSl7aWYoY2hlY2tDYW5Db25maWd1cmUoImNzc1Byb3BlcnRpZXMiKSl7Y3NzUHJvcGVydGllcy5wdXNoKFtuYW1lLHZhbHVlXSk7fX07dmFyIHdpbmRvd0NyZWF0aW9uU3RhcnRlZD1mYWxzZTt2YXIgaWZyYW1lQ29udGFpbmVyRGl2O3ZhciBpZnJhbWVJZD11bmlxdWVJZCsiX0luUGFnZUFwcGVuZGVyXyIrY29uc29sZUFwcGVuZGVySWQ7dGhpcy5oaWRlPWZ1bmN0aW9uKCl7aWYoaW5pdGlhbGl6ZWQmJmNvbnNvbGVXaW5kb3dDcmVhdGVkKXtpZihjb25zb2xlV2luZG93RXhpc3RzKCkpe2dldENvbnNvbGVXaW5kb3coKS4kKCJjb21tYW5kIikuYmx1cigpO30NCmlmcmFtZUNvbnRhaW5lckRpdi5zdHlsZS5kaXNwbGF5PSJub25lIjttaW5pbWl6ZWQ9dHJ1ZTt9fTt0aGlzLnNob3c9ZnVuY3Rpb24oKXtpZihpbml0aWFsaXplZCl7aWYoY29uc29sZVdpbmRvd0NyZWF0ZWQpe2lmcmFtZUNvbnRhaW5lckRpdi5zdHlsZS5kaXNwbGF5PSJibG9jayI7dGhpcy5zZXRTaG93Q29tbWFuZExpbmUoc2hvd0NvbW1hbmRMaW5lKTttaW5pbWl6ZWQ9ZmFsc2U7fWVsc2UgaWYoIXdpbmRvd0NyZWF0aW9uU3RhcnRlZCl7Y3JlYXRlV2luZG93KHRydWUpO319fTt0aGlzLmlzVmlzaWJsZT1mdW5jdGlvbigpe3JldHVybiFtaW5pbWl6ZWQmJiFjb25zb2xlQ2xvc2VkO307dGhpcy5jbG9zZT1mdW5jdGlvbihmcm9tQnV0dG9uKXtpZighY29uc29sZUNsb3NlZCYmKCFmcm9tQnV0dG9ufHxjb25maXJtKCJUaGlzIHdpbGwgcGVybWFuZW50bHkgcmVtb3ZlIHRoZSBjb25zb2xlIGZyb20gdGhlIHBhZ2UuIE5vIG1vcmUgbWVzc2FnZXMgd2lsbCBiZSBsb2dnZWQuIERvIHlvdSB3aXNoIHRvIGNvbnRpbnVlPyIpKSl7aWZyYW1lQ29udGFpbmVyRGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaWZyYW1lQ29udGFpbmVyRGl2KTt0aGlzLnVubG9hZCgpO319O29wZW49ZnVuY3Rpb24oKXt2YXIgaW5pdEVycm9yTWVzc2FnZT0iSW5QYWdlQXBwZW5kZXIub3BlbjogdW5hYmxlIHRvIGNyZWF0ZSBjb25zb2xlIGlmcmFtZSI7ZnVuY3Rpb24gZmluYWxJbml0KCl7dHJ5e2lmKCFpbml0aWFsbHlNaW5pbWl6ZWQpe2FwcGVuZGVyLnNob3coKTt9DQpjb25zb2xlV2luZG93TG9hZEhhbmRsZXIoKTtjb25zb2xlV2luZG93TG9hZGVkPXRydWU7YXBwZW5kUXVldWVkTG9nZ2luZ0V2ZW50cygpO31jYXRjaChleCl7aXNTdXBwb3J0ZWQ9ZmFsc2U7aGFuZGxlRXJyb3IoaW5pdEVycm9yTWVzc2FnZSxleCk7fX0NCmZ1bmN0aW9uIHdyaXRlVG9Eb2N1bWVudCgpe3RyeXt2YXIgd2luZG93VGVzdD1mdW5jdGlvbih3aW4pe3JldHVybiBpc0xvYWRlZCh3aW4pO307aWYodXNlRG9jdW1lbnRXcml0ZSl7d3JpdGVIdG1sKGdldENvbnNvbGVXaW5kb3coKS5kb2N1bWVudCk7fQ0KaWYod2luZG93VGVzdChnZXRDb25zb2xlV2luZG93KCkpKXtmaW5hbEluaXQoKTt9ZWxzZXtwb2xsQ29uc29sZVdpbmRvdyh3aW5kb3dUZXN0LDEwMCxmaW5hbEluaXQsaW5pdEVycm9yTWVzc2FnZSk7fX1jYXRjaChleCl7aXNTdXBwb3J0ZWQ9ZmFsc2U7aGFuZGxlRXJyb3IoaW5pdEVycm9yTWVzc2FnZSxleCk7fX0NCm1pbmltaXplZD1mYWxzZTtpZnJhbWVDb250YWluZXJEaXY9Y29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7aWZyYW1lQ29udGFpbmVyRGl2LnN0eWxlLndpZHRoPXdpZHRoO2lmcmFtZUNvbnRhaW5lckRpdi5zdHlsZS5oZWlnaHQ9aGVpZ2h0O2lmcmFtZUNvbnRhaW5lckRpdi5zdHlsZS5ib3JkZXI9InNvbGlkIGdyYXkgMXB4Ijtmb3IodmFyIGk9MCxsZW49Y3NzUHJvcGVydGllcy5sZW5ndGg7aTxsZW47aSsrKXtpZnJhbWVDb250YWluZXJEaXYuc3R5bGVbY3NzUHJvcGVydGllc1tpXVswXV09Y3NzUHJvcGVydGllc1tpXVsxXTt9DQp2YXIgaWZyYW1lU3JjPXVzZURvY3VtZW50V3JpdGU/IiI6IiBzcmM9JyIrZ2V0Q29uc29sZVVybCgpKyInIjtpZnJhbWVDb250YWluZXJEaXYuaW5uZXJIVE1MPSI8aWZyYW1lIGlkPSciK2lmcmFtZUlkKyInIG5hbWU9JyIraWZyYW1lSWQrIicgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZnJhbWVib3JkZXI9JzAnIitpZnJhbWVTcmMrInNjcm9sbGluZz0nbm8nPjwvaWZyYW1lPiI7Y29uc29sZUNsb3NlZD1mYWxzZTt2YXIgaWZyYW1lRG9jdW1lbnRFeGlzdHNUZXN0PWZ1bmN0aW9uKHdpbil7dHJ5e3JldHVybiBib29sKHdpbikmJmJvb2wod2luLmRvY3VtZW50KTt9Y2F0Y2goZXgpe3JldHVybiBmYWxzZTt9fTtpZihpZnJhbWVEb2N1bWVudEV4aXN0c1Rlc3QoZ2V0Q29uc29sZVdpbmRvdygpKSl7d3JpdGVUb0RvY3VtZW50KCk7fWVsc2V7cG9sbENvbnNvbGVXaW5kb3coaWZyYW1lRG9jdW1lbnRFeGlzdHNUZXN0LDEwMCx3cml0ZVRvRG9jdW1lbnQsaW5pdEVycm9yTWVzc2FnZSk7fQ0KY29uc29sZVdpbmRvd0NyZWF0ZWQ9dHJ1ZTt9O2NyZWF0ZVdpbmRvdz1mdW5jdGlvbihzaG93KXtpZihzaG93fHwhaW5pdGlhbGx5TWluaW1pemVkKXt2YXIgcGFnZUxvYWRIYW5kbGVyPWZ1bmN0aW9uKCl7aWYoIWNvbnRhaW5lcil7Y29udGFpbmVyRWxlbWVudD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtjb250YWluZXJFbGVtZW50LnN0eWxlLnBvc2l0aW9uPSJmaXhlZCI7Y29udGFpbmVyRWxlbWVudC5zdHlsZS5sZWZ0PSIwIjtjb250YWluZXJFbGVtZW50LnN0eWxlLnJpZ2h0PSIwIjtjb250YWluZXJFbGVtZW50LnN0eWxlLmJvdHRvbT0iMCI7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXJFbGVtZW50KTthcHBlbmRlci5hZGRDc3NQcm9wZXJ0eSgiYm9yZGVyV2lkdGgiLCIxcHggMCAwIDAiKTthcHBlbmRlci5hZGRDc3NQcm9wZXJ0eSgiekluZGV4IiwxMDAwMDAwKTtvcGVuKCk7fWVsc2V7dHJ5e3ZhciBlbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXIpO2lmKGVsLm5vZGVUeXBlPT0xKXtjb250YWluZXJFbGVtZW50PWVsO30NCm9wZW4oKTt9Y2F0Y2goZXgpe2hhbmRsZUVycm9yKCJJblBhZ2VBcHBlbmRlci5pbml0OiBpbnZhbGlkIGNvbnRhaW5lciBlbGVtZW50ICciK2NvbnRhaW5lcisiJyBzdXBwbGllZCIsZXgpO319fTtpZihwYWdlTG9hZGVkJiZjb250YWluZXImJmNvbnRhaW5lci5hcHBlbmRDaGlsZCl7Y29udGFpbmVyRWxlbWVudD1jb250YWluZXI7b3BlbigpO31lbHNlIGlmKHBhZ2VMb2FkZWQpe3BhZ2VMb2FkSGFuZGxlcigpO31lbHNle2xvZzRqYXZhc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLHBhZ2VMb2FkSGFuZGxlcik7fQ0Kd2luZG93Q3JlYXRpb25TdGFydGVkPXRydWU7fX07aW5pdD1mdW5jdGlvbigpe2NyZWF0ZVdpbmRvdygpO2luaXRpYWxpemVkPXRydWU7fTtnZXRDb25zb2xlV2luZG93PWZ1bmN0aW9uKCl7dmFyIGlmcmFtZT13aW5kb3cuZnJhbWVzW2lmcmFtZUlkXTtpZihpZnJhbWUpe3JldHVybiBpZnJhbWU7fX07c2FmZVRvQXBwZW5kPWZ1bmN0aW9uKCl7aWYoaXNTdXBwb3J0ZWQmJiFjb25zb2xlQ2xvc2VkKXtpZihjb25zb2xlV2luZG93Q3JlYXRlZCYmIWNvbnNvbGVXaW5kb3dMb2FkZWQmJmdldENvbnNvbGVXaW5kb3coKSYmaXNMb2FkZWQoZ2V0Q29uc29sZVdpbmRvdygpKSl7Y29uc29sZVdpbmRvd0xvYWRlZD10cnVlO30NCnJldHVybiBjb25zb2xlV2luZG93TG9hZGVkO30NCnJldHVybiBmYWxzZTt9O31lbHNle3ZhciB1c2VPbGRQb3BVcD1hcHBlbmRlci5kZWZhdWx0cy51c2VPbGRQb3BVcDt2YXIgY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmc9YXBwZW5kZXIuZGVmYXVsdHMuY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmc7dmFyIHJlb3BlbldoZW5DbG9zZWQ9dGhpcy5kZWZhdWx0cy5yZW9wZW5XaGVuQ2xvc2VkO3RoaXMuaXNVc2VPbGRQb3BVcD1mdW5jdGlvbigpe3JldHVybiB1c2VPbGRQb3BVcDt9O3RoaXMuc2V0VXNlT2xkUG9wVXA9ZnVuY3Rpb24odXNlT2xkUG9wVXBQYXJhbSl7aWYoY2hlY2tDYW5Db25maWd1cmUoInVzZU9sZFBvcFVwIikpe3VzZU9sZFBvcFVwPWJvb2wodXNlT2xkUG9wVXBQYXJhbSk7fX07dGhpcy5pc0NvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nPWZ1bmN0aW9uKCl7cmV0dXJuIGNvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nO307dGhpcy5zZXRDb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZz1mdW5jdGlvbihjb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZ1BhcmFtKXtpZihjaGVja0NhbkNvbmZpZ3VyZSgiY29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmciKSl7Y29tcGxhaW5BYm91dFBvcFVwQmxvY2tpbmc9Ym9vbChjb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZ1BhcmFtKTt9fTt0aGlzLmlzRm9jdXNQb3BVcD1mdW5jdGlvbigpe3JldHVybiBmb2N1c0NvbnNvbGVXaW5kb3c7fTt0aGlzLnNldEZvY3VzUG9wVXA9ZnVuY3Rpb24oZm9jdXNQb3BVcFBhcmFtKXtmb2N1c0NvbnNvbGVXaW5kb3c9Ym9vbChmb2N1c1BvcFVwUGFyYW0pO307dGhpcy5pc1Jlb3BlbldoZW5DbG9zZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gcmVvcGVuV2hlbkNsb3NlZDt9O3RoaXMuc2V0UmVvcGVuV2hlbkNsb3NlZD1mdW5jdGlvbihyZW9wZW5XaGVuQ2xvc2VkUGFyYW0pe3Jlb3BlbldoZW5DbG9zZWQ9Ym9vbChyZW9wZW5XaGVuQ2xvc2VkUGFyYW0pO307dGhpcy5jbG9zZT1mdW5jdGlvbigpe2xvZ0xvZy5kZWJ1ZygiY2xvc2UgIit0aGlzKTt0cnl7cG9wVXAuY2xvc2UoKTt0aGlzLnVubG9hZCgpO31jYXRjaChleCl7fX07dGhpcy5oaWRlPWZ1bmN0aW9uKCl7bG9nTG9nLmRlYnVnKCJoaWRlICIrdGhpcyk7aWYoY29uc29sZVdpbmRvd0V4aXN0cygpKXt0aGlzLmNsb3NlKCk7fX07dGhpcy5zaG93PWZ1bmN0aW9uKCl7bG9nTG9nLmRlYnVnKCJzaG93ICIrdGhpcyk7aWYoIWNvbnNvbGVXaW5kb3dDcmVhdGVkKXtvcGVuKCk7fX07dGhpcy5pc1Zpc2libGU9ZnVuY3Rpb24oKXtyZXR1cm4gc2FmZVRvQXBwZW5kKCk7fTt2YXIgcG9wVXA7b3Blbj1mdW5jdGlvbigpe3ZhciB3aW5kb3dQcm9wZXJ0aWVzPSJ3aWR0aD0iK3dpZHRoKyIsaGVpZ2h0PSIraGVpZ2h0KyIsc3RhdHVzLHJlc2l6YWJsZSI7dmFyIHdpbmRvd05hbWU9IlBvcFVwXyIrbG9jYXRpb24uaG9zdC5yZXBsYWNlKC9bXmEtejAtOV0vZ2ksIl8iKSsiXyIrY29uc29sZUFwcGVuZGVySWQ7aWYoIXVzZU9sZFBvcFVwfHwhdXNlRG9jdW1lbnRXcml0ZSl7d2luZG93TmFtZT13aW5kb3dOYW1lKyJfIit1bmlxdWVJZDt9DQp2YXIgY2hlY2tQb3BVcENsb3NlZD1mdW5jdGlvbih3aW4pe2lmKGNvbnNvbGVDbG9zZWQpe3JldHVybiB0cnVlO31lbHNle3RyeXtyZXR1cm4gYm9vbCh3aW4pJiZ3aW4uY2xvc2VkO31jYXRjaChleCl7fX0NCnJldHVybiBmYWxzZTt9O3ZhciBwb3BVcENsb3NlZENhbGxiYWNrPWZ1bmN0aW9uKCl7aWYoIWNvbnNvbGVDbG9zZWQpe2FwcGVuZGVyLnVubG9hZCgpO319O2Z1bmN0aW9uIGZpbmFsSW5pdCgpe2dldENvbnNvbGVXaW5kb3coKS5zZXRDbG9zZUlmT3BlbmVyQ2xvc2VzKCF1c2VPbGRQb3BVcHx8IXVzZURvY3VtZW50V3JpdGUpO2NvbnNvbGVXaW5kb3dMb2FkSGFuZGxlcigpO2NvbnNvbGVXaW5kb3dMb2FkZWQ9dHJ1ZTthcHBlbmRRdWV1ZWRMb2dnaW5nRXZlbnRzKCk7cG9sbENvbnNvbGVXaW5kb3coY2hlY2tQb3BVcENsb3NlZCw1MDAscG9wVXBDbG9zZWRDYWxsYmFjaywiUG9wVXBBcHBlbmRlci5jaGVja1BvcFVwQ2xvc2VkOiBlcnJvciBjaGVja2luZyBwb3AtdXAgd2luZG93Iik7fQ0KdHJ5e3BvcFVwPXdpbmRvdy5vcGVuKGdldENvbnNvbGVVcmwoKSx3aW5kb3dOYW1lLHdpbmRvd1Byb3BlcnRpZXMpO2NvbnNvbGVDbG9zZWQ9ZmFsc2U7Y29uc29sZVdpbmRvd0NyZWF0ZWQ9dHJ1ZTtpZihwb3BVcCl7aWYodXNlRG9jdW1lbnRXcml0ZSYmdXNlT2xkUG9wVXAmJmlzTG9hZGVkKHBvcFVwKSl7cG9wVXAubWFpblBhZ2VSZWxvYWRlZCgpO2ZpbmFsSW5pdCgpO31lbHNle2lmKHVzZURvY3VtZW50V3JpdGUpe3dyaXRlSHRtbChwb3BVcC5kb2N1bWVudCk7fQ0KdmFyIHBvcFVwTG9hZGVkVGVzdD1mdW5jdGlvbih3aW4pe3JldHVybiBib29sKHdpbikmJmlzTG9hZGVkKHdpbik7fTtpZihpc0xvYWRlZChwb3BVcCkpe2ZpbmFsSW5pdCgpO31lbHNle3BvbGxDb25zb2xlV2luZG93KHBvcFVwTG9hZGVkVGVzdCwxMDAsZmluYWxJbml0LCJQb3BVcEFwcGVuZGVyLmluaXQ6IHVuYWJsZSB0byBjcmVhdGUgY29uc29sZSB3aW5kb3ciKTt9fX1lbHNle2lzU3VwcG9ydGVkPWZhbHNlO2xvZ0xvZy53YXJuKCJQb3BVcEFwcGVuZGVyLmluaXQ6IHBvcC11cHMgYmxvY2tlZCwgcGxlYXNlIHVuYmxvY2sgdG8gdXNlIFBvcFVwQXBwZW5kZXIiKTtpZihjb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZyl7aGFuZGxlRXJyb3IoImxvZzRqYXZhc2NyaXB0OiBwb3AtdXAgd2luZG93cyBhcHBlYXIgdG8gYmUgYmxvY2tlZC4gUGxlYXNlIHVuYmxvY2sgdGhlbSB0byB1c2UgcG9wLXVwIGxvZ2dpbmcuIik7fX19Y2F0Y2goZXgpe2hhbmRsZUVycm9yKCJQb3BVcEFwcGVuZGVyLmluaXQ6IGVycm9yIGNyZWF0aW5nIHBvcC11cCIsZXgpO319O2NyZWF0ZVdpbmRvdz1mdW5jdGlvbigpe2lmKCFpbml0aWFsbHlNaW5pbWl6ZWQpe29wZW4oKTt9fTtpbml0PWZ1bmN0aW9uKCl7Y3JlYXRlV2luZG93KCk7aW5pdGlhbGl6ZWQ9dHJ1ZTt9O2dldENvbnNvbGVXaW5kb3c9ZnVuY3Rpb24oKXtyZXR1cm4gcG9wVXA7fTtzYWZlVG9BcHBlbmQ9ZnVuY3Rpb24oKXtpZihpc1N1cHBvcnRlZCYmIWlzVW5kZWZpbmVkKHBvcFVwKSYmIWNvbnNvbGVDbG9zZWQpe2lmKHBvcFVwLmNsb3NlZHx8KGNvbnNvbGVXaW5kb3dMb2FkZWQmJmlzVW5kZWZpbmVkKHBvcFVwLmNsb3NlZCkpKXthcHBlbmRlci51bmxvYWQoKTtsb2dMb2cuZGVidWcoIlBvcFVwQXBwZW5kZXI6IHBvcC11cCBjbG9zZWQiKTtyZXR1cm4gZmFsc2U7fQ0KaWYoIWNvbnNvbGVXaW5kb3dMb2FkZWQmJmlzTG9hZGVkKHBvcFVwKSl7Y29uc29sZVdpbmRvd0xvYWRlZD10cnVlO319DQpyZXR1cm4gaXNTdXBwb3J0ZWQmJmNvbnNvbGVXaW5kb3dMb2FkZWQmJiFjb25zb2xlQ2xvc2VkO307fQ0KdGhpcy5nZXRDb25zb2xlV2luZG93PWdldENvbnNvbGVXaW5kb3c7fTtDb25zb2xlQXBwZW5kZXIuYWRkR2xvYmFsQ29tbWFuZExpbmVGdW5jdGlvbj1mdW5jdGlvbihmdW5jdGlvbk5hbWUsY29tbWFuZExpbmVGdW5jdGlvbil7ZGVmYXVsdENvbW1hbmRMaW5lRnVuY3Rpb25zLnB1c2goW2Z1bmN0aW9uTmFtZSxjb21tYW5kTGluZUZ1bmN0aW9uXSk7fTtmdW5jdGlvbiBQb3BVcEFwcGVuZGVyKGxhenlJbml0LGluaXRpYWxseU1pbmltaXplZCx1c2VEb2N1bWVudFdyaXRlLHdpZHRoLGhlaWdodCl7dGhpcy5jcmVhdGUoZmFsc2UsbnVsbCxsYXp5SW5pdCxpbml0aWFsbHlNaW5pbWl6ZWQsdXNlRG9jdW1lbnRXcml0ZSx3aWR0aCxoZWlnaHQsdGhpcy5kZWZhdWx0cy5mb2N1c1BvcFVwKTt9DQpQb3BVcEFwcGVuZGVyLnByb3RvdHlwZT1uZXcgQ29uc29sZUFwcGVuZGVyKCk7UG9wVXBBcHBlbmRlci5wcm90b3R5cGUuZGVmYXVsdHM9e2xheW91dDpuZXcgUGF0dGVybkxheW91dCgiJWR7SEg6bW06c3N9ICUtNXAgLSAlbXsxfSVuIiksaW5pdGlhbGx5TWluaW1pemVkOmZhbHNlLGZvY3VzUG9wVXA6ZmFsc2UsbGF6eUluaXQ6dHJ1ZSx1c2VPbGRQb3BVcDp0cnVlLGNvbXBsYWluQWJvdXRQb3BVcEJsb2NraW5nOnRydWUsbmV3ZXN0TWVzc2FnZUF0VG9wOmZhbHNlLHNjcm9sbFRvTGF0ZXN0TWVzc2FnZTp0cnVlLHdpZHRoOiI2MDAiLGhlaWdodDoiNDAwIixyZW9wZW5XaGVuQ2xvc2VkOmZhbHNlLG1heE1lc3NhZ2VzOm51bGwsc2hvd0NvbW1hbmRMaW5lOnRydWUsY29tbWFuZExpbmVPYmplY3RFeHBhbnNpb25EZXB0aDoxLHNob3dIaWRlQnV0dG9uOmZhbHNlLHNob3dDbG9zZUJ1dHRvbjp0cnVlLHNob3dMb2dFbnRyeURlbGV0ZUJ1dHRvbnM6dHJ1ZSx1c2VEb2N1bWVudFdyaXRlOnRydWV9O1BvcFVwQXBwZW5kZXIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIlBvcFVwQXBwZW5kZXIiO307bG9nNGphdmFzY3JpcHQuUG9wVXBBcHBlbmRlcj1Qb3BVcEFwcGVuZGVyO2Z1bmN0aW9uIEluUGFnZUFwcGVuZGVyKGNvbnRhaW5lcixsYXp5SW5pdCxpbml0aWFsbHlNaW5pbWl6ZWQsdXNlRG9jdW1lbnRXcml0ZSx3aWR0aCxoZWlnaHQpe3RoaXMuY3JlYXRlKHRydWUsY29udGFpbmVyLGxhenlJbml0LGluaXRpYWxseU1pbmltaXplZCx1c2VEb2N1bWVudFdyaXRlLHdpZHRoLGhlaWdodCxmYWxzZSk7fQ0KSW5QYWdlQXBwZW5kZXIucHJvdG90eXBlPW5ldyBDb25zb2xlQXBwZW5kZXIoKTtJblBhZ2VBcHBlbmRlci5wcm90b3R5cGUuZGVmYXVsdHM9e2xheW91dDpuZXcgUGF0dGVybkxheW91dCgiJWR7SEg6bW06c3N9ICUtNXAgLSAlbXsxfSVuIiksaW5pdGlhbGx5TWluaW1pemVkOmZhbHNlLGxhenlJbml0OnRydWUsbmV3ZXN0TWVzc2FnZUF0VG9wOmZhbHNlLHNjcm9sbFRvTGF0ZXN0TWVzc2FnZTp0cnVlLHdpZHRoOiIxMDAlIixoZWlnaHQ6IjIyMHB4IixtYXhNZXNzYWdlczpudWxsLHNob3dDb21tYW5kTGluZTp0cnVlLGNvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGg6MSxzaG93SGlkZUJ1dHRvbjpmYWxzZSxzaG93Q2xvc2VCdXR0b246ZmFsc2Usc2hvd0xvZ0VudHJ5RGVsZXRlQnV0dG9uczp0cnVlLHVzZURvY3VtZW50V3JpdGU6dHJ1ZX07SW5QYWdlQXBwZW5kZXIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIkluUGFnZUFwcGVuZGVyIjt9O2xvZzRqYXZhc2NyaXB0LkluUGFnZUFwcGVuZGVyPUluUGFnZUFwcGVuZGVyO2xvZzRqYXZhc2NyaXB0LklubGluZUFwcGVuZGVyPUluUGFnZUFwcGVuZGVyO30pKCk7ZnVuY3Rpb24gcGFkV2l0aFNwYWNlcyhzdHIsbGVuKXtpZihzdHIubGVuZ3RoPGxlbil7dmFyIHNwYWNlcz1bXTt2YXIgbnVtYmVyT2ZTcGFjZXM9TWF0aC5tYXgoMCxsZW4tc3RyLmxlbmd0aCk7Zm9yKHZhciBpPTA7aTxudW1iZXJPZlNwYWNlcztpKyspe3NwYWNlc1tpXT0iICI7fQ0Kc3RyKz1zcGFjZXMuam9pbigiIik7fQ0KcmV0dXJuIHN0cjt9DQooZnVuY3Rpb24oKXtmdW5jdGlvbiBkaXIob2JqKXt2YXIgbWF4TGVuPTA7Zm9yKHZhciBwIGluIG9iail7bWF4TGVuPU1hdGgubWF4KHRvU3RyKHApLmxlbmd0aCxtYXhMZW4pO30NCnZhciBwcm9wTGlzdD1bXTtmb3IocCBpbiBvYmope3ZhciBwcm9wTmFtZVN0cj0iICAiK3BhZFdpdGhTcGFjZXModG9TdHIocCksbWF4TGVuKzIpO3ZhciBwcm9wVmFsO3RyeXtwcm9wVmFsPXNwbGl0SW50b0xpbmVzKHRvU3RyKG9ialtwXSkpLmpvaW4ocGFkV2l0aFNwYWNlcyhuZXdMaW5lLG1heExlbis2KSk7fWNhdGNoKGV4KXtwcm9wVmFsPSJbRXJyb3Igb2J0YWluaW5nIHByb3BlcnR5LiBEZXRhaWxzOiAiK2dldEV4Y2VwdGlvbk1lc3NhZ2UoZXgpKyJdIjt9DQpwcm9wTGlzdC5wdXNoKHByb3BOYW1lU3RyK3Byb3BWYWwpO30NCnJldHVybiBwcm9wTGlzdC5qb2luKG5ld0xpbmUpO30NCnZhciBub2RlVHlwZXM9e0VMRU1FTlRfTk9ERToxLEFUVFJJQlVURV9OT0RFOjIsVEVYVF9OT0RFOjMsQ0RBVEFfU0VDVElPTl9OT0RFOjQsRU5USVRZX1JFRkVSRU5DRV9OT0RFOjUsRU5USVRZX05PREU6NixQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREU6NyxDT01NRU5UX05PREU6OCxET0NVTUVOVF9OT0RFOjksRE9DVU1FTlRfVFlQRV9OT0RFOjEwLERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6MTEsTk9UQVRJT05fTk9ERToxMn07dmFyIHByZUZvcm1hdHRlZEVsZW1lbnRzPVsic2NyaXB0IiwicHJlIl07dmFyIGVtcHR5RWxlbWVudHM9WyJiciIsImltZyIsImhyIiwicGFyYW0iLCJsaW5rIiwiYXJlYSIsImlucHV0IiwiY29sIiwiYmFzZSIsIm1ldGEiXTt2YXIgaW5kZW50YXRpb25Vbml0PSIgICI7ZnVuY3Rpb24gZ2V0WGh0bWwocm9vdE5vZGUsaW5jbHVkZVJvb3ROb2RlLGluZGVudGF0aW9uLHN0YXJ0TmV3TGluZSxwcmVmb3JtYXR0ZWQpe2luY2x1ZGVSb290Tm9kZT0odHlwZW9mIGluY2x1ZGVSb290Tm9kZT09InVuZGVmaW5lZCIpP3RydWU6KGluY2x1ZGVSb290Tm9kZT90cnVlOmZhbHNlKTtpZih0eXBlb2YgaW5kZW50YXRpb24hPSJzdHJpbmciKXtpbmRlbnRhdGlvbj0iIjt9DQpzdGFydE5ld0xpbmU9c3RhcnROZXdMaW5lP3RydWU6ZmFsc2U7cHJlZm9ybWF0dGVkPXByZWZvcm1hdHRlZD90cnVlOmZhbHNlO3ZhciB4aHRtbDtmdW5jdGlvbiBpc1doaXRlc3BhY2Uobm9kZSl7cmV0dXJuKChub2RlLm5vZGVUeXBlPT1ub2RlVHlwZXMuVEVYVF9OT0RFKSYmL15bIFx0XHJcbl0qJC8udGVzdChub2RlLm5vZGVWYWx1ZSkpO30NCmZ1bmN0aW9uIGZpeEF0dHJpYnV0ZVZhbHVlKGF0dHJWYWx1ZSl7cmV0dXJuIGF0dHJWYWx1ZS50b1N0cmluZygpLnJlcGxhY2UoL1wmL2csIiZhbXA7IikucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvXCIvZywiJnF1b3Q7Iik7fQ0KZnVuY3Rpb24gZ2V0U3R5bGVBdHRyaWJ1dGVWYWx1ZShlbCl7dmFyIHN0eWxlUGFpcnM9ZWwuc3R5bGUuY3NzVGV4dC5zcGxpdCgiOyIpO3ZhciBzdHlsZVZhbHVlPSIiO3ZhciBpc0ZpcnN0PXRydWU7Zm9yKHZhciBqPTAsbGVuPXN0eWxlUGFpcnMubGVuZ3RoO2o8bGVuO2orKyl7dmFyIG5hbWVWYWx1ZUJpdHM9c3R5bGVQYWlyc1tqXS5zcGxpdCgiOiIpO3ZhciBwcm9wcz1bXTtpZighL15ccyokLy50ZXN0KG5hbWVWYWx1ZUJpdHNbMF0pKXtwcm9wcy5wdXNoKHRyaW0obmFtZVZhbHVlQml0c1swXSkudG9Mb3dlckNhc2UoKSsiOiIrdHJpbShuYW1lVmFsdWVCaXRzWzFdKSk7fQ0Kc3R5bGVWYWx1ZT1wcm9wcy5qb2luKCI7Iik7fQ0KcmV0dXJuIHN0eWxlVmFsdWU7fQ0KZnVuY3Rpb24gZ2V0TmFtZXNwYWNlKGVsKXtpZihlbC5wcmVmaXgpe3JldHVybiBlbC5wcmVmaXg7fWVsc2UgaWYoZWwub3V0ZXJIVE1MKXt2YXIgcmVnZXg9bmV3IFJlZ0V4cCgiPChbXjpdKyk6IitlbC50YWdOYW1lKyJbXj5dKj4iLCJpIik7aWYocmVnZXgudGVzdChlbC5vdXRlckhUTUwpKXtyZXR1cm4gUmVnRXhwLiQxLnRvTG93ZXJDYXNlKCk7fX0NCnJldHVybiIiO30NCnZhciBsdD0iPCI7dmFyIGd0PSI+IjtpZihpbmNsdWRlUm9vdE5vZGUmJnJvb3ROb2RlLm5vZGVUeXBlIT1ub2RlVHlwZXMuRE9DVU1FTlRfRlJBR01FTlRfTk9ERSl7c3dpdGNoKHJvb3ROb2RlLm5vZGVUeXBlKXtjYXNlIG5vZGVUeXBlcy5FTEVNRU5UX05PREU6dmFyIHRhZ05hbWU9cm9vdE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO3hodG1sPXN0YXJ0TmV3TGluZT9uZXdMaW5lK2luZGVudGF0aW9uOiIiO3hodG1sKz1sdDt2YXIgcHJlZml4PWdldE5hbWVzcGFjZShyb290Tm9kZSk7dmFyIGhhc1ByZWZpeD1wcmVmaXg/dHJ1ZTpmYWxzZTtpZihoYXNQcmVmaXgpe3hodG1sKz1wcmVmaXgrIjoiO30NCnhodG1sKz10YWdOYW1lO2ZvcihpPTAsbGVuPXJvb3ROb2RlLmF0dHJpYnV0ZXMubGVuZ3RoO2k8bGVuO2krKyl7dmFyIGN1cnJlbnRBdHRyPXJvb3ROb2RlLmF0dHJpYnV0ZXNbaV07aWYoIWN1cnJlbnRBdHRyLnNwZWNpZmllZHx8Y3VycmVudEF0dHIubm9kZVZhbHVlPT09bnVsbHx8Y3VycmVudEF0dHIubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PSJzdHlsZSJ8fHR5cGVvZiBjdXJyZW50QXR0ci5ub2RlVmFsdWUhPT0ic3RyaW5nInx8Y3VycmVudEF0dHIubm9kZU5hbWUuaW5kZXhPZigiX21veiIpPT09MCl7Y29udGludWU7fQ0KeGh0bWwrPSIgIitjdXJyZW50QXR0ci5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKyI9XCIiO3hodG1sKz1maXhBdHRyaWJ1dGVWYWx1ZShjdXJyZW50QXR0ci5ub2RlVmFsdWUpO3hodG1sKz0iXCIiO30NCmlmKHJvb3ROb2RlLnN0eWxlLmNzc1RleHQpe3ZhciBzdHlsZVZhbHVlPWdldFN0eWxlQXR0cmlidXRlVmFsdWUocm9vdE5vZGUpO2lmKHN0eWxlVmFsdWUhPT0iIil7eGh0bWwrPSIgc3R5bGU9XCIiK2dldFN0eWxlQXR0cmlidXRlVmFsdWUocm9vdE5vZGUpKyJcIiI7fX0NCmlmKGFycmF5X2NvbnRhaW5zKGVtcHR5RWxlbWVudHMsdGFnTmFtZSl8fChoYXNQcmVmaXgmJiFyb290Tm9kZS5oYXNDaGlsZE5vZGVzKCkpKXt4aHRtbCs9Ii8iK2d0O31lbHNle3hodG1sKz1ndDt2YXIgY2hpbGRTdGFydE5ld0xpbmU9IShyb290Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aD09PTEmJnJvb3ROb2RlLmNoaWxkTm9kZXNbMF0ubm9kZVR5cGU9PT1ub2RlVHlwZXMuVEVYVF9OT0RFKTt2YXIgY2hpbGRQcmVmb3JtYXR0ZWQ9YXJyYXlfY29udGFpbnMocHJlRm9ybWF0dGVkRWxlbWVudHMsdGFnTmFtZSk7Zm9yKHZhciBpPTAsbGVuPXJvb3ROb2RlLmNoaWxkTm9kZXMubGVuZ3RoO2k8bGVuO2krKyl7eGh0bWwrPWdldFhodG1sKHJvb3ROb2RlLmNoaWxkTm9kZXNbaV0sdHJ1ZSxpbmRlbnRhdGlvbitpbmRlbnRhdGlvblVuaXQsY2hpbGRTdGFydE5ld0xpbmUsY2hpbGRQcmVmb3JtYXR0ZWQpO30NCnZhciBlbmRUYWc9bHQrIi8iK3RhZ05hbWUrZ3Q7eGh0bWwrPWNoaWxkU3RhcnROZXdMaW5lP25ld0xpbmUraW5kZW50YXRpb24rZW5kVGFnOmVuZFRhZzt9DQpyZXR1cm4geGh0bWw7Y2FzZSBub2RlVHlwZXMuVEVYVF9OT0RFOmlmKGlzV2hpdGVzcGFjZShyb290Tm9kZSkpe3hodG1sPSIiO31lbHNle2lmKHByZWZvcm1hdHRlZCl7eGh0bWw9cm9vdE5vZGUubm9kZVZhbHVlO31lbHNle3ZhciBsaW5lcz1zcGxpdEludG9MaW5lcyh0cmltKHJvb3ROb2RlLm5vZGVWYWx1ZSkpO3ZhciB0cmltbWVkTGluZXM9W107Zm9yKHZhciBpPTAsbGVuPWxpbmVzLmxlbmd0aDtpPGxlbjtpKyspe3RyaW1tZWRMaW5lc1tpXT10cmltKGxpbmVzW2ldKTt9DQp4aHRtbD10cmltbWVkTGluZXMuam9pbihuZXdMaW5lK2luZGVudGF0aW9uKTt9DQppZihzdGFydE5ld0xpbmUpe3hodG1sPW5ld0xpbmUraW5kZW50YXRpb24reGh0bWw7fX0NCnJldHVybiB4aHRtbDtjYXNlIG5vZGVUeXBlcy5DREFUQV9TRUNUSU9OX05PREU6cmV0dXJuIjwhW0NEQSIrIlRBWyIrcm9vdE5vZGUubm9kZVZhbHVlKyJdIisiXT4iK25ld0xpbmU7Y2FzZSBub2RlVHlwZXMuRE9DVU1FTlRfTk9ERTp4aHRtbD0iIjtmb3IodmFyIGk9MCxsZW49cm9vdE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7aTxsZW47aSsrKXt4aHRtbCs9Z2V0WGh0bWwocm9vdE5vZGUuY2hpbGROb2Rlc1tpXSx0cnVlLGluZGVudGF0aW9uKTt9DQpyZXR1cm4geGh0bWw7ZGVmYXVsdDpyZXR1cm4iIjt9fWVsc2V7eGh0bWw9IiI7Zm9yKHZhciBpPTAsbGVuPXJvb3ROb2RlLmNoaWxkTm9kZXMubGVuZ3RoO2k8bGVuO2krKyl7eGh0bWwrPWdldFhodG1sKHJvb3ROb2RlLmNoaWxkTm9kZXNbaV0sdHJ1ZSxpbmRlbnRhdGlvbitpbmRlbnRhdGlvblVuaXQpO30NCnJldHVybiB4aHRtbDt9fQ0KdmFyIGxheW91dHM9e307ZnVuY3Rpb24gY3JlYXRlQ29tbWFuZExpbmVGdW5jdGlvbnMoYXBwZW5kZXIpe0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCIkIixmdW5jdGlvbihhcHBlbmRlcixhcmdzLHJldHVyblZhbHVlKXtyZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYXJnc1swXSk7fSk7Q29uc29sZUFwcGVuZGVyLmFkZEdsb2JhbENvbW1hbmRMaW5lRnVuY3Rpb24oImRpciIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7dmFyIGxpbmVzPVtdO2Zvcih2YXIgaT0wLGxlbj1hcmdzLmxlbmd0aDtpPGxlbjtpKyspe2xpbmVzW2ldPWRpcihhcmdzW2ldKTt9DQpyZXR1cm4gbGluZXMuam9pbihuZXdMaW5lK25ld0xpbmUpO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJkaXJ4bWwiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciBsaW5lcz1bXTtmb3IodmFyIGk9MCxsZW49YXJncy5sZW5ndGg7aTxsZW47aSsrKXt2YXIgd2luPWFwcGVuZGVyLmdldENvbW1hbmRXaW5kb3coKTtsaW5lc1tpXT1nZXRYaHRtbChhcmdzW2ldKTt9DQpyZXR1cm4gbGluZXMuam9pbihuZXdMaW5lK25ld0xpbmUpO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJjZCIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7dmFyIHdpbixtZXNzYWdlO2lmKGFyZ3MubGVuZ3RoPT09MHx8YXJnc1swXT09PSIiKXt3aW49d2luZG93O21lc3NhZ2U9IkNvbW1hbmQgbGluZSBzZXQgdG8gcnVuIGluIG1haW4gd2luZG93Ijt9ZWxzZXtpZihhcmdzWzBdLndpbmRvdz09YXJnc1swXSl7d2luPWFyZ3NbMF07bWVzc2FnZT0iQ29tbWFuZCBsaW5lIHNldCB0byBydW4gaW4gZnJhbWUgJyIrYXJnc1swXS5uYW1lKyInIjt9ZWxzZXt3aW49d2luZG93LmZyYW1lc1thcmdzWzBdXTtpZih3aW4pe21lc3NhZ2U9IkNvbW1hbmQgbGluZSBzZXQgdG8gcnVuIGluIGZyYW1lICciK2FyZ3NbMF0rIiciO31lbHNle3JldHVyblZhbHVlLmlzRXJyb3I9dHJ1ZTttZXNzYWdlPSJGcmFtZSAnIithcmdzWzBdKyInIGRvZXMgbm90IGV4aXN0Ijt3aW49YXBwZW5kZXIuZ2V0Q29tbWFuZFdpbmRvdygpO319fQ0KYXBwZW5kZXIuc2V0Q29tbWFuZFdpbmRvdyh3aW4pO3JldHVybiBtZXNzYWdlO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJjbGVhciIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7cmV0dXJuVmFsdWUuYXBwZW5kUmVzdWx0PWZhbHNlO2FwcGVuZGVyLmNsZWFyKCk7fSk7Q29uc29sZUFwcGVuZGVyLmFkZEdsb2JhbENvbW1hbmRMaW5lRnVuY3Rpb24oImtleXMiLGZ1bmN0aW9uKGFwcGVuZGVyLGFyZ3MscmV0dXJuVmFsdWUpe3ZhciBrZXlzPVtdO2Zvcih2YXIgayBpbiBhcmdzWzBdKXtrZXlzLnB1c2goayk7fQ0KcmV0dXJuIGtleXM7fSk7Q29uc29sZUFwcGVuZGVyLmFkZEdsb2JhbENvbW1hbmRMaW5lRnVuY3Rpb24oInZhbHVlcyIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7dmFyIHZhbHVlcz1bXTtmb3IodmFyIGsgaW4gYXJnc1swXSl7dHJ5e3ZhbHVlcy5wdXNoKGFyZ3NbMF1ba10pO31jYXRjaChleCl7bG9nTG9nLndhcm4oInZhbHVlcygpOiBVbmFibGUgdG8gb2J0YWluIHZhbHVlIGZvciBrZXkgIitrKyIuIERldGFpbHM6ICIrZ2V0RXhjZXB0aW9uTWVzc2FnZShleCkpO319DQpyZXR1cm4gdmFsdWVzO30pO0NvbnNvbGVBcHBlbmRlci5hZGRHbG9iYWxDb21tYW5kTGluZUZ1bmN0aW9uKCJleHBhbnNpb25EZXB0aCIsZnVuY3Rpb24oYXBwZW5kZXIsYXJncyxyZXR1cm5WYWx1ZSl7dmFyIGV4cGFuc2lvbkRlcHRoPXBhcnNlSW50KGFyZ3NbMF0sMTApO2lmKGlzTmFOKGV4cGFuc2lvbkRlcHRoKXx8ZXhwYW5zaW9uRGVwdGg8MCl7cmV0dXJuVmFsdWUuaXNFcnJvcj10cnVlO3JldHVybiIiK2FyZ3NbMF0rIiBpcyBub3QgYSB2YWxpZCBleHBhbnNpb24gZGVwdGgiO31lbHNle2FwcGVuZGVyLnNldENvbW1hbmRMaW5lT2JqZWN0RXhwYW5zaW9uRGVwdGgoZXhwYW5zaW9uRGVwdGgpO3JldHVybiJPYmplY3QgZXhwYW5zaW9uIGRlcHRoIHNldCB0byAiK2V4cGFuc2lvbkRlcHRoO319KTt9DQpmdW5jdGlvbiBpbml0KCl7Y3JlYXRlQ29tbWFuZExpbmVGdW5jdGlvbnMoKTtpbml0aWFsaXplZD10cnVlO30NCmluaXQoKTt9KSgpO2Z1bmN0aW9uIGFkZFdpbmRvd0xvYWRMaXN0ZW5lcihsaXN0ZW5lcil7dmFyIG9sZE9ubG9hZD13aW5kb3cub25sb2FkO2lmKHR5cGVvZiB3aW5kb3cub25sb2FkIT0iZnVuY3Rpb24iKXt3aW5kb3cub25sb2FkPWxpc3RlbmVyO31lbHNle3dpbmRvdy5vbmxvYWQ9ZnVuY3Rpb24oZXZ0KXtpZihvbGRPbmxvYWQpe29sZE9ubG9hZChldnQpO30NCmxpc3RlbmVyKGV2dCk7fTt9fQ0KYWRkV2luZG93TG9hZExpc3RlbmVyKGZ1bmN0aW9uKCl7cGFnZUxvYWRlZD10cnVlO2xvZzRqYXZhc2NyaXB0LmRpc3BhdGNoRXZlbnQoImxvYWQiLHt9KTt9KTt3aW5kb3cubG9nNGphdmFzY3JpcHQ9bG9nNGphdmFzY3JpcHQ7fSkoKTsKdmFyIE96b25lID0gT3pvbmUgfHwge307CgovKioKICogQGNsYXNzCiAqIEBkZXNjcmlwdGlvbiBQcm92aWRlcyBmdW5jdGlvbnMgdG8gbG9nIG1lc3NhZ2VzIGFuZCBvYmplY3RzCiAqIEBPem9uZS5sb2cKICogCiAqLwovKgogKiBUaGUgb25seSBmdW5jdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgZnJvbSBnYWRnZXRzIGlzIE96b25lLmxvZy5nYWRnZXRMb2cKICovCk96b25lLmxvZyA9IHsKCQp9OwoKT3pvbmUubG9nLmxvZ0VuYWJsZWQgPSBmYWxzZTsgCgpPem9uZS5sb2cuZGVmYXVsdExvZ2dlciA9IG51bGw7IApPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyID0gbnVsbDsgCgpPem9uZS5sb2cudmVyc2lvbiA9IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24ubG9nZ2luZzsKCi8qKgogKiBAT3pvbmUubG9nLmdldExvZ2dlcgogKiBAZGVzY3JpcHRpb24gR2V0IGEgbG9nZ2VyIGJ5IG5hbWUsIGlmIHRoZSBsb2dnZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gY3JlYXRlZCBpdCB3aWxsIGJlIGNyZWF0ZWQKICogQHBhcmFtIHtTdHJpbmd9IGxvZ2dlck5hbWUKICovCk96b25lLmxvZy5nZXRMb2dnZXIgPSBmdW5jdGlvbihsb2dnZXJOYW1lKSB7IAogICAgcmV0dXJuIGxvZzRqYXZhc2NyaXB0LmdldExvZ2dlcihsb2dnZXJOYW1lKTsKfTsKCi8qKgogKiBAT3pvbmUubG9nLnNldEVuYWJsZWQKICogQGRlc2NyaXB0aW9uIEVuYWJsZS9EaXNhYmxlIGxvZ2dpbmcgZm9yIHRoZSBPV0YgYXBwbGljYXRpb24KICogQHBhcmFtIHtCb29sZWFufSBlbmFibGVkIHRydWUgd2lsbCBlbmFibGUgbG9nZ2luZyBmYWxzZSB3aWxsIGRpc2FibGUKICovCk96b25lLmxvZy5zZXRFbmFibGVkID0gZnVuY3Rpb24oZW5hYmxlZCl7Cglsb2c0amF2YXNjcmlwdC5zZXRFbmFibGVkKGVuYWJsZWQpOwp9OwoKLyoqCiAqIEBPem9uZS5sb2cuZ2V0RGVmYXVsdExvZ2dlcgogKiBAZGVzY3JpcHRpb24gR2V0IE9XRidzIGRlZmF1bHQgbG9nZ2VyCiAqLwovL1RoZSBkZWZhdWx0IGxvZ2dlciBjYW5ub3QgYmUgdXNlZCBmcm9tIGdhZGdldHMKT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIgPSBmdW5jdGlvbigpIHsKCWlmICghT3pvbmUubG9nLmRlZmF1bHRMb2dnZXIpIHsKCQkKCQoJCXZhciBkZWZhdWx0TG9nZ2VyTmFtZSA9ICJbb3pvbmVkZWZhdWx0XSI7IAoJCQoJCU96b25lLmxvZy5kZWZhdWx0TG9nZ2VyID0gIE96b25lLmxvZy5nZXRMb2dnZXIoZGVmYXVsdExvZ2dlck5hbWUpOwoJCU96b25lLmxvZy5kZWZhdWx0QXBwZW5kZXIgPSBuZXcgbG9nNGphdmFzY3JpcHQuUG9wVXBBcHBlbmRlcigpOwoJCU96b25lLmxvZy5kZWZhdWx0QXBwZW5kZXIuc2V0VXNlT2xkUG9wVXAodHJ1ZSk7CgkJT3pvbmUubG9nLmRlZmF1bHRBcHBlbmRlci5zZXRDb21wbGFpbkFib3V0UG9wVXBCbG9ja2luZyhmYWxzZSk7CgkJLy8gY2hhbmdlIHRoZSBsb2dnaW5nIGxldmVsIGhlcmUsIGZvciBleGFtcGxlOgoJCS8vIE96b25lLmxvZy5kZWZhdWx0QXBwZW5kZXIuc2V0VGhyZXNob2xkKGxvZzRqYXZhc2NyaXB0LkxldmVsLkVSUk9SKTsKICAgICAgICBPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyLnNldFRocmVzaG9sZChsb2c0amF2YXNjcmlwdC5MZXZlbC5PRkYpOwoJCWxvZzRqYXZhc2NyaXB0LmdldFJvb3RMb2dnZXIoKS5hZGRBcHBlbmRlcihPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyKTsKCQkvL096b25lLmxvZy5kZWZhdWx0QXBwZW5kZXIuc2V0SW5pdGlhbGx5TWluaW1pemVkKHRydWUpOwoJCQoJCXJldHVybiBPem9uZS5sb2cuZGVmYXVsdExvZ2dlcjsKCX0gCgkKCXJldHVybiBPem9uZS5sb2cuZGVmYXVsdExvZ2dlcjsKfTsKCi8qKgogKiBAZGVzY3JpcHRpb24gTGF1bmNoIHRoZSBsb2cgd2luZG93IHBvcC11cCwgdGhpcyB3aWxsIHJlLWxhdW5jaCB0aGUgd2luZG93IGluIHRoZSBldmVudCAKICogaXQgaGFzIGJlZW4gY2xvc2VkCiAqLwpPem9uZS5sb2cubGF1bmNoUG9wdXBBcHBlbmRlciA9IGZ1bmN0aW9uKCkgewoJCglPem9uZS5sb2cuZGVmYXVsdEFwcGVuZGVyLnNob3coKTsKCQoJT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIoKS5kZWJ1ZygiTG9nZ2VyIFdpbmRvdyBMYXVjaGVkIik7Cn07CgoKLyoKICogTG9nIG1lc3NhZ2VzIGZyb20gd2lkZ2V0cwogKiBAcGFyYW0ge09iamVjdH0gbWVzc2FnZQogKi8KT3pvbmUubG9nLndpZGdldExvZyA9IGZ1bmN0aW9uKCkgeyAKICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ096b25lLmxvZycsbnVsbCwgYXJndW1lbnRzKTsKfTsKCgppZiAodHlwZW9mKEV4dCkgIT0gInVuZGVmaW5lZCIpIHsKCUV4dC5vblJlYWR5KGZ1bmN0aW9uKCl7CgkJZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoJ096b25lLmxvZycsIGZ1bmN0aW9uKGFyZ3MpewoJCQl2YXIgbG9nZ2VyID0gT3pvbmUubG9nLmdldERlZmF1bHRMb2dnZXIoKTsgCgkJCWxvZ2dlci5kZWJ1Zy5hcHBseShsb2dnZXIsIGFyZ3MpOwoJCX0pOwoJfSk7Cn0KCi8qKg0KICogQGZpbGVvdmVydmlldyBUaGUgcHJlZmVyZW5jZSBzZXJ2ZXIgc2NyaXB0IGNvbnRyb2xzIGFsbCB0aGUgcHJlZmVyZW5jZSBzZXJ2ZXIgY29tbXVuaWNhdGlvbi4NCiAqLw0KDQoNCg0KLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lIHx8IHt9Ow0KDQovKioNCiAqIEBpZ25vcmUNCiAqLw0KT3pvbmUucHJlZiA9IE96b25lLnByZWYgfHwge307DQoNCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsNCiAgLyoqDQogICAqIEBjb25zdHJ1Y3RvciAgTm9uZSwgdGhpcyBpcyBhIFNpbmdsZXRvbg0KICAgKiBAZGVzY3JpcHRpb24gVGhpcyBvYmplY3QgaXMgdXNlZCB0byBjcmVhdGUsIHJldHJpZXZlLCB1cGRhdGUgYW5kIGRlbGV0ZSB1c2VyIHByZWZlcmVuY2VzLiBBIHVzZXIgcHJlZmVyZW5jZSBpcyBzaW1wbHkgYSBzdHJpbmcNCiAgICogc3RvcmVkIGluIE9XRiB0aGF0IGlzIHVuaXF1ZWx5IG1hcHBlZCB0byBhIHVzZXIsIG5hbWVzcGFjZSwgYW5kIG5hbWUgY29tYmluYXRpb24uDQogICAqIDxicj48YnI+DQogICAqIEFsbCBwdWJsaWMgbWV0aG9kcyBvZiB0aGlzIGNsYXNzIGFjY2VwdCBhbiBvblN1Y2Nlc3MgZnVuY3Rpb24uIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXBvbiBzdWNjZXNzZnVsIGNvbXBsZXRpb24gb2YgdGhlIHJlcXVlc3RlZCBvcGVyYXRpb24gYW5kIGlzIHBhc3NlZCBhIGNvcHkgb2YgdGhlIHByZWZlcmVuY2Ugb2JqZWN0Lg0KICAgKiBAZXhhbXBsZQ0KICAgKiBUaGUgZm9sbG93aW5nIGlzIGFuIGV4YW1wbGUgb2YgYSBwcmVmZXJlbmNlIG9iamVjdCBwYXNzZWQgdG8gdGhlIG9uU3VjY2Vzcw0KICAgKiBmdW5jdGlvbjoNCiAgICoNCiAgICogew0KICAgKiAgICAgInZhbHVlIjoidHJ1ZSIsDQogICAqICAgICAicGF0aCI6Im1pbGl0YXJ5VGltZSIsDQogICAqICAgICAidXNlciI6DQogICAqICAgICB7DQogICAqICAgICAgICAgInVzZXJJZCI6InRlc3RBZG1pbjEiDQogICAqICAgICB9LA0KICAgKiAgICAgIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIg0KICAgKiB9DQogICAqDQogICAqIFdoZXJlOg0KICAgKg0KICAgKiB2YWx1ZTogVGhlIHByZWZlcmVuY2UgdmFsdWUgdGhhdCBpcyBzdG9yZWQgaW4gdGhlIGRhdGFiYXNlLiBUaGlzIGNhbiBiZSBhbnkgc3RyaW5nDQogICAqICAgICAgICBpbmNsdWRpbmcgSlNPTi4NCiAgICogcGF0aDogVGhlIG5hbWUgb2YgdGhlIHVzZXIgcHJlZmVyZW5jZS4NCiAgICogdXNlcjogVGhlIHVzZXIgb2JqZWN0LiBUaGUgb25seSB1c2VyIGluZm9ybWF0aW9uIHJldHVybmVkIGF0IHRoaXMgdGltZSBpcyB0aGUgdXNlcg0KICAgKiAgICAgICBJRC4NCiAgICogbmFtZXNwYWNlOiBUaGUgbmFtZXNwYWNlIG9mIHRoZSByZXF1ZXN0ZWQgdXNlciBwcmVmZXJlbmNlLg0KICAgKg0KICAgKiBAcmVxdWlyZXMgT3pvbmUudXRpbC5UcmFuc3BvcnQNCiAgICovDQogIE96b25lLnByZWYuUHJlZlNlcnZlciA9IGZ1bmN0aW9uKF91cmwpIHsNCiAgICAgIGlmICggX3VybCA9PT0gdW5kZWZpbmVkIHx8IF91cmwgPT09ICJudWxsIiB8fCAgX3VybC5pbmRleE9mKCckJykgIT09IC0xIHx8IF91cmwubGVuZ3RoID09PSAwICkgew0KICAgICAgICAgIC8vIGRlZmF1bHQgaW5jYXNlIG5vIHByZWZMb2NhdGlvbiBpcyBnaXZlbg0KICAgICAgICAgIC8vIHVnbHkgYWxlcnQgbWVzc2FnZSwgYnV0IGxldCdzIGZhaWwgZmFzdA0KICAgICAgICAgICAvLyBhbGVydCgicHJlZnNMb2NhdGlvbiBpcyBudWxsIG9yIGluY29ycmVjdC4gIFBlcmhhcHMgaW4gdGhlIE93ZkNvbmZpZy54bWwgZmlsZT8iKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy9TdHJpcCBvZmYgYSB0cmFpbGluZyBzbGFzaC4NCiAgICAgICAgICBpZiAoX3VybC5sYXN0SW5kZXhPZigiLyIpID09PSAoX3VybC5sZW5ndGggLTEpKSB7DQogICAgICAgICAgICAgIF91cmwgPSBfdXJsLnN1YnN0cmluZygwLF91cmwubGVuZ3RoLTEpOw0KICAgICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgLyoqIEBwcml2YXRlDQogICAgICAgKiBAZGVzY3JpcHRpb24gTG9vayB1cCBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gdXJsLiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZSwgcmF0aGVyLCBhbiBlbnRpdHktc3BlY2lmaWMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQuDQogICAgICAgKiBAcmV0dXJuIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgcmVxdWVzdGVkIHByZWZlcmVuY2UNCiAgICAgICAqIEBwYXJhbSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSBjZmcudXJsIHVybCB0byBiZSB1c2VkIGluIHRoZSBjYWxsDQogICAgICAgKiBAcGFyYW0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdA0KICAgICAgICogQHBhcmFtIGNmZy5vbkZhaWx1cmUgY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBpcyBwcm92aWRlZCkNCiAgICAgICAqIEBwYXJhbSBjZmcuaWdub3JlZEVycm9yQ29kZXMgYWxsb3dzIHRoZSBjYWxsZXIgdG8gaWdub3JlIGNlcnRhaW4gaHR0cCBlcnJvciBjb2Rlcy4gIElmIHRoZXkgb2NjdXIgb25zdWNjZXNzIHdpbGwgYmUgY2FsbGVkIHdpdGggYSBudWxsIHBheWxvYWQNCiAgICAgICAqDQogICAgICAgKiBAZXhhbXBsZSB2YXIgcHJlZnMgPSBuZXcgT3pvbmUucHJlZi5QcmVmcygpOw0KICAgICAgICoNCiAgICAgICAqIHZhciBteXN1Y2Nlc3MgPSBmdW5jdGlvbihyZXN1bHQpew0KICAgICAgICogICAgICAgICB0aGlzLnZhbHVlID0gcmVzdWx0Ow0KICAgICAgICogICAgICAgICBhbGVydChyZXN1bHQpOw0KICAgICAgICogICAgICAgICBhbGVydChyZXN1bHQudmFsdWUpOw0KICAgICAgICoNCiAgICAgICAqIGdldFZhbHVlKHt1cmw6X3VybCArICIvIiArIG5hbWVzcGFjZSArICIvIiArIHBhdGgsIG9uU3VjY2VzczpvblN1Y2Nlc3NDYWxsYmFjaywgb25GYWlsdXJlOm9uRmFpbENhbGxiYWNrfSk7DQogICAgICAgKg0KICAgICAgICovDQogICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgIGNmZy5tZXRob2QgPSAiR0VUIjsNCiAgICAgICAgICBjZmcuYXN5bmMgPSB0cnVlOw0KICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgIH07DQoNCiAgICAgIC8qKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIERlbGV0ZSBpbnN0YW5jZSBvZiB0aGUgZ2l2ZW4gdXJsLiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZSwgcmF0aGVyLCBhbiBlbnRpdHktc3BlY2lmaWMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQuDQogICAgICAgKiBAcGFyYW0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCB1cmwgdG8gYmUgdXNlZCBpbiB0aGUgY2FsbA0KICAgICAgICogQHBhcmFtIGNmZy5vblN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQNCiAgICAgICAqIEBwYXJhbSBjZmcub25GYWlsdXJlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgaXMgcHJvdmlkZWQpDQogICAgICAgKg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihyZXN1bHQpew0KICAgICAgICogICAgICAgICB0aGlzLnZhbHVlID0gcmVzdWx0Ow0KICAgICAgICogICAgICAgICBhbGVydChyZXN1bHQpOw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAqICAgYWxlcnQoIlRoZXJlIHdhcyBhbiBlcnJvcjogIiArIGVycik7DQogICAgICAgKiB9DQogICAgICAgKg0KICAgICAgICogZGVsZXRlQmFzZSh7dXJsOl91cmwgKyAiLyIgKyBuYW1lc3BhY2UgKyAiLyIgKyBwYXRoLCBvblN1Y2Nlc3M6b25TdWNjZXNzQ2FsbGJhY2ssIG9uRmFpbHVyZTpvbkZhaWxDYWxsYmFja30pOw0KICAgICAgICovDQogICAgICB2YXIgZGVsZXRlQmFzZSA9IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICBjZmcubWV0aG9kID0gJ0RFTEVURSc7DQogICAgICAgICAgc2V0VmFsdWUoY2ZnKTsNCiAgICAgIH07DQoNCiAgICAgIC8qKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIEdldCBhbiBhcnJheSBvZiBvYmplY3QgZm9yIHRoZSByZXF1ZXN0ZWQgbmFtZXNwYWNlDQogICAgICAgKiBAcGFyYW0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCAgICAgICAgLSBzdHJpbmcNCiAgICAgICAqIEBwYXJhbSBjZmcub25TdWNjZXNzICAgICAgICAtIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0DQogICAgICAgKiBAcGFyYW0gY2ZnLm9uRmFpbHVyZSAgICAgICAgLSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKQ0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihyZXN1bHQpew0KICAgICAgICogCQl0aGlzLnZhbHVlID0gcmVzdWx0Ow0KICAgICAgICogCQlhbGVydChyZXN1bHQpOw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAqICAgYWxlcnQoIlRoZXJlIHdhcyBhbiBlcnJvcjogIiArIGVycik7DQogICAgICAgKiB9DQogICAgICAgKg0KICAgICAgICogbGlzdCh7bmFtZXNwYWNlOiJuYW1lc3BhY2UxIiwgb25TdWNjZXNzOm9uU3VjY2Vzcywgb25GYWlsdXJlOm9uRmFpbHVyZX0pOw0KICAgICAgICovDQogICAgICB2YXIgbGlzdCA9IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvIiArIGNmZy51cmw7DQogICAgICAgICAgZ2V0KGNmZyk7DQogICAgICB9Ow0KDQogICAgICAvKioNCiAgICAgICAqIEBwcml2YXRlDQogICAgICAgKiBAZGVzY3JpcHRpb24gU2V0IGEgdmFsdWUgZm9yIHRoZSBnaXZlbiB1cmwuIFRoaXMgc2hvdWxkIGdlbmVyYWxseSBub3QgYmUgY2FsbGVkIGZyb20gdXNlciBjb2RlLCByYXRoZXIsIGFuIGVudGl0eS1zcGVjaWZpYyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZC4NCiAgICAgICAqIEBwYXJhbSBjZmcudXJsIHVybCB0byBiZSB1c2VkIGluIHRoZSBjYWxsDQogICAgICAgKiBAcGFyYW0gY2ZnLmNvbnRlbnQgVGhlIGNvbnRlbnQgb2YgdGhlIHNlbmQuIEVpdGhlciBtYXAgb3IgSlNPTiB3aXRoIHRoZSBfbWV0aG9kIHByb3BlcnR5IGFscmVhZHkgZGVmaW5lZC4NCiAgICAgICAqIEBwYXJhbSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0IChvcHRpb25hbCkNCiAgICAgICAqIEBwYXJhbSBjZmcub25GYWlsdXJlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgaXMgcHJvdmlkZWQgaWYgYW4gb25TdWNjZXNzIGNhbGxiYWNrIGlzIHBhc3NlZCBpbikNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ocmVzdWx0KXsNCiAgICAgICAqICAgICAgICAgdGhpcy52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAqICAgICAgICAgYWxlcnQocmVzdWx0KTsgIC8vVE9ETzogdGhlIHByZWZlcmVuY2Ugc2VydmVyIGN1cnJlbnRseSBkb2Vzbid0IHJldHVybiBhbnl0aGluZw0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAqICAgYWxlcnQoIlRoZXJlIHdhcyBhbiBlcnJvcjogIiArIGVycik7DQogICAgICAgKiB9DQogICAgICAgKg0KICAgICAgICogc2V0VmFsdWVCYXNlKF91cmwgKyAiLyIgKyBuYW1lc3BhY2UgKyAiLyIgKyBwYXRoLCBjb250ZW50LCBvblN1Y2Nlc3NDYWxsYmFjaywgb25GYWlsQ2FsbGJhY2spOw0KICAgICAgICovDQogICAgICB2YXIgc2V0VmFsdWVCYXNlID0gZnVuY3Rpb24oY2ZnKQ0KICAgICAgew0KICAgICAgICAgICBjZmcubWV0aG9kID0gY2ZnLmNvbnRlbnRbIl9tZXRob2QiXTsNCiAgICAgICAgICAgaWYgKGNmZy5vblN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgaWYgKCFjZmcub25GYWlsdXJlKSB7ICAvL211c3QgZW5zdXJlIHRoZXJlIGlzIGFuIG9uZmFpbHVyZSBtZXRob2QsIGFzIHdlIHVzaW5nIGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydChPem9uZS51dGlsLkVycm9yTWVzc2FnZVN0cmluZy5zYXZlVXNlclByZWZlcmVuY2VzICsgIiA6ICIgKyBlcnIpOw0KICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZEFuZEZvcmdldChjZmcpOw0KICAgICAgICAgIH0NCg0KICAgICAgfTsNCg0KICAgICAgLyoqDQogICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gdXJsLiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZSwgcmF0aGVyLCBhbiBlbnRpdHktc3BlY2lmaWMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQuDQogICAgICAgKiBAcGFyYW0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCB1cmwgdG8gYmUgdXNlZCBpbiB0aGUgY2FsbA0KICAgICAgICogQHBhcmFtIGNmZy5qc29uIFRoZSB2YWx1ZSB0byBzdG9yZS4NCiAgICAgICAqIEBwYXJhbSBjZmcubWV0aG9kIFRoZSBtZXRob2QgZm9yIHRoZSBjYWxsLiAoJ0RFTEVURScsICdQVVQnKQ0KICAgICAgICogQHBhcmFtIGNmZy5vblN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQgKG9wdGlvbmFsKQ0KICAgICAgICogQHBhcmFtIGNmZy5vbkZhaWx1cmUgY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBpcyBwcm92aWRlZCBpZiBhbiBvblN1Y2Nlc3MgY2FsbGJhY2sgaXMgcGFzc2VkIGluKQ0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihyZXN1bHQpew0KICAgICAgICogICAgICAgICB0aGlzLnZhbHVlID0gcmVzdWx0Ow0KICAgICAgICogICAgICAgICBhbGVydChyZXN1bHQpOyAgLy9UT0RPOiB0aGUgcHJlZmVyZW5jZSBzZXJ2ZXIgY3VycmVudGx5IGRvZXNuJ3QgcmV0dXJuIGFueXRoaW5nDQogICAgICAgKiB9DQogICAgICAgKg0KICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycikgew0KICAgICAgICogICBhbGVydCgiVGhlcmUgd2FzIGFuIGVycm9yOiAiICsgZXJyKTsNCiAgICAgICAqIH0NCiAgICAgICAqDQogICAgICAgKiBzZXRWYWx1ZSh7dXJsOl91cmwgKyAiLyIgKyBuYW1lc3BhY2UgKyAiLyIgKyBwYXRoLCBqc29uOnZhbHVlLCBtZXRob2Q6bWV0aG9kLCBvblN1Y2Nlc3M6b25TdWNjZXNzQ2FsbGJhY2ssIG9uRmFpbHVyZTpvbkZhaWxDYWxsYmFja30pOw0KICAgICAgICovDQogICAgICB2YXIgc2V0VmFsdWUgPSBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgaWYgKGNmZy5tZXRob2QgPT0gbnVsbCkgew0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BVVCc7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgdmFyIGNvbnRlbnQgPSB7DQogICAgICAgICAgICAgICdfbWV0aG9kJzogY2ZnLm1ldGhvZA0KICAgICAgICAgIH07DQoNCiAgICAgICAgICBpZiAoY2ZnLmpzb24pIHsNCiAgICAgICAgICAgICAgY29udGVudCA9IHsNCiAgICAgICAgICAgICAgICAgICdfbWV0aG9kJzogY2ZnLm1ldGhvZCwNCiAgICAgICAgICAgICAgICAgICduYW1lJzogY2ZnLmpzb24ubmFtZSwNCiAgICAgICAgICAgICAgICAgICdkZXNjcmlwdGlvbic6IGNmZy5qc29uLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgJ2d1aWQnOiBjZmcuanNvbi5ndWlkLA0KICAgICAgICAgICAgICAgICAgJ2lzZGVmYXVsdCc6IGNmZy5qc29uLmlzZGVmYXVsdCwNCiAgICAgICAgICAgICAgICAgICdsb2NrZWQnOiBjZmcuanNvbi5sb2NrZWQsDQogICAgICAgICAgICAgICAgICAnc3RhdGUnOiBjZmcuanNvbi5zdGF0ZSwNCiAgICAgICAgICAgICAgICAgICdsYXlvdXRDb25maWcnOiBjZmcuanNvbi5sYXlvdXRDb25maWcsDQogICAgICAgICAgICAgICAgICAnc3RhY2snOiBjZmcuanNvbi5zdGFjaw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICBpZiAoY2ZnLmpzb24uY2xvbmVkID09PSB0cnVlKSBjb250ZW50LmNsb25lZCA9IHRydWU7DQogICAgICAgICAgICAgIGlmIChjZmcuanNvbi5ieXBhc3NMYXlvdXRSZWFycmFuZ2UgPT09IHRydWUpIGNvbnRlbnQuYnlwYXNzTGF5b3V0UmVhcnJhbmdlID0gdHJ1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgY2ZnLmNvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgIHNldFZhbHVlQmFzZShjZmcpOw0KICAgICAgfTsNCg0KICAgICAgLyoqDQogICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gdXJsIGJ5IHVzaW5nIGEgSlNPTiBvYmplY3QsIGFsbG93aW5nIG11bHRpcGxlIHBhcmFtZXRlcnMgZm9yIFBVVC9QT1NULiBUaGlzIHNob3VsZCBnZW5lcmFsbHkgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZSwgcmF0aGVyLCBhbiBlbnRpdHktc3BlY2lmaWMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQuDQogICAgICAgKiBAcGFyYW0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0gY2ZnLnVybCB1cmwgdG8gYmUgdXNlZCBpbiB0aGUgY2FsbA0KICAgICAgICogQHBhcmFtIGNmZy5qc29uT2JqZWN0IFRoZSBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4uIE5vdGUgdGhhdCB0aGUgdmFsdWUgcGFyYW1ldGVyIGlzIHJlcXVpcmVkLCBhbmQgdGhpcyBpcyB3aGF0IHdpbGwgYmUgc3RvcmVkIGluIHRoZSAidmFsdWUiIGNvbHVtbiBvZiB0aGUgYXBwcm9wcmlhdGUgdGFibGUuDQogICAgICAgKiBAcGFyYW0gY2ZnLm1ldGhvZCBUaGUgbWV0aG9kIGZvciB0aGUgY2FsbC4gKCdERUxFVEUnLCAnUFVUJykNCiAgICAgICAqIEBwYXJhbSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0IChvcHRpb25hbCkNCiAgICAgICAqIEBwYXJhbSBjZmcub25GYWlsdXJlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgaXMgcHJvdmlkZWQgaWYgYW4gb25TdWNjZXNzIGNhbGxiYWNrIGlzIHBhc3NlZCBpbikNCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKg0KICAgICAgICogLi4uY29kZSBzZXR0aW5nIHVwIGEgZGVza3RvcCBkYXNoYm9hcmQNCiAgICAgICAqDQogICAgICAgKiB2YXIgcG9zdFBhcmFtcyA9DQogICAgICAgKiAgIHsNCiAgICAgICAqICAgICAndmFsdWUnOiB0aGlzLmNvbmZpZy52YWx1ZSwNCiAgICAgICAqICAgICAgJ3BhdGgnOiB0aGlzLmNvbmZpZy52YWx1ZS5ndWlkLA0KICAgICAgICogICAgICAndHlwZSc6ICdkZXNrdG9wJywNCiAgICAgICAqICAgICAgJ2lzZGVmYXVsdCc6IHNhdmVBc0RlZmF1bHQNCiAgICAgICAqICAgfTsNCiAgICAgICAqDQogICAgICAgKglzZXRWYWx1ZXNWaWFKU09OT2JqZWN0KF91cmwgKyAiLyIgKyBuYW1lc3BhY2UgKyAiLyIgKyBwYXRoLCBqc29uT2JqZWN0LCBzYXZlTWV0aG9kLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7DQogICAgICAgKi8NCiAgICAgIHZhciBzZXRWYWx1ZXNWaWFKU09OT2JqZWN0ID0gZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgICAgaWYgKGNmZy5qc29uT2JqZWN0Ll9tZXRob2QgPT09IHVuZGVmaW5lZCkNCiAgICAgICAgICB7DQogICAgICAgICAgICAgIGlmIChjZmcubWV0aG9kID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnUFVUJzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjZmcuanNvbk9iamVjdC5fbWV0aG9kID0gY2ZnLm1ldGhvZDsNCiAgICAgICAgICB9DQogICAgICAgICAgY2ZnLmpzb24gPSBjZmcuanNvbk9iamVjdDsNCiAgICAgICAgICBzZXRWYWx1ZShjZmcpOw0KDQogICAgICB9Ow0KDQogICAgIC8qKg0KICAgICAgICogQHByaXZhdGUNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBDcmVhdGUgSlNPTiBvYmplY3Qgd2l0aCBwYXJhbXMuIFRoaXMgc2hvdWxkIGdlbmVyYWxseSBub3QgYmUgY2FsbGVkIGZyb20gdXNlciBjb2RlLg0KICAgICAgICogQHBhcmFtIGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIGNmZy5kYXNoYm9hcmRJZA0KICAgICAgICogQHBhcmFtIGNmZy52YWx1ZQ0KICAgICAgICogQHBhcmFtIGNmZy50eXBlDQogICAgICAgKiBAcGFyYW0gY2ZnLmlzRGVmYXVsdA0KICAgICAgICogQHJldHVybiB0aGUgSlNPTiBvYmplY3QNCiAgICAgICAqLw0KICAgICAgdmFyIGdlbmVyYXRlRGFzaGJvYXJkUG9zdFBhcmFtc0pTT04gPSBmdW5jdGlvbiAoanNvbikgew0KICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gew0KICAgICAgICAgICAgJ25hbWUnOiBqc29uLm5hbWUsDQogICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBqc29uLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgJ2d1aWQnOiBqc29uLmd1aWQsDQogICAgICAgICAgICAnaXNkZWZhdWx0JzoganNvbi5pc2RlZmF1bHQsDQogICAgICAgICAgICAnbG9ja2VkJzoganNvbi5sb2NrZWQsDQogICAgICAgICAgICAnc3RhdGUnOiBqc29uLnN0YXRlLA0KICAgICAgICAgICAgJ2xheW91dENvbmZpZyc6IHR5cGVvZiBqc29uLmxheW91dENvbmZpZyA9PT0gJ3N0cmluZycgPyBqc29uLmxheW91dENvbmZpZyA6IE96b25lLnV0aWwudG9TdHJpbmcoanNvbi5sYXlvdXRDb25maWcpLA0KICAgICAgICAgICAgJ3N0YWNrJzoganNvbi5zdGFjaw0KICAgICAgICAgIH07DQogICAgICAgICAgcmV0dXJuIHBvc3RQYXJhbXM7DQogICAgICB9Ow0KDQogICAgICByZXR1cm4gLyoqIEBsZW5kcyBPem9uZS5wcmVmLlByZWZTZXJ2ZXIucHJvdG90eXBlICovew0KDQogICAgICAgICAgdmVyc2lvbjogT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi5wcmVmZXJlbmNlLA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIEdldCB0aGUgdXJsIGZvciB0aGUgUHJlZmVyZW5jZSBTZXJ2ZXINCiAgICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSB1cmwNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXRVcmwgOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIF91cmw7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSB1cmwgZm9yIHRoZSBQcmVmZXJlbmNlIFNlcnZlcg0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwNCiAgICAgICAgICAgKiBAcmV0dXJucyB2b2lkDQogICAgICAgICAgICovDQogICAgICAgICAgc2V0VXJsIDogZnVuY3Rpb24odXJsKSB7DQogICAgICAgICAgICAgIF91cmwgPSB1cmw7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSBkYXNoYm9hcmQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuZGFzaGJvYXJkSWQgVW5pZ3VlIGRhc2hiYXJkIGlkZW50aWZpZXINCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIGRhc2hib2FyZC4NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuDQogICAgICAgICAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoDQogICAgICAgICAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4NCiAgICAgICAgICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4NCiAgICAgICAgICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPC91bD4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPg0KICAgICAgICAgICAqICAgICA8L3VsPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuDQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmdldERhc2hib2FyZCh7DQogICAgICAgICAgICogICAgIGRhc2hib2FyZElkOic5MTdiNGNkMC1lY2JkLTQxMGItYWZkOS00MmQxNTBjMjY0MjYnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0RGFzaGJvYXJkIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi8iICsgJ2Rhc2hib2FyZCcgKyAiLyIgKyBjZmcuZGFzaGJvYXJkSWQ7DQogICAgICAgICAgICAgIGdldChjZmcpOw0KICAgICAgICAgIH0sDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgdXNlcidzIGRlZmF1bHQgZGFzaGJvYXJkDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgew0KICAgICAgICAgICAqICAgICBhbGVydChkYXNoYm9hcmQubmFtZSk7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZ2V0RGVmYXVsdERhc2hib2FyZCh7DQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXREZWZhdWx0RGFzaGJvYXJkIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsiL2Rhc2hib2FyZD9pc2RlZmF1bHQ9dHJ1ZSI7DQogICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAiUE9TVCI7DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNldHMgdGhlIHVzZXIncyBkZWZhdWx0IGRhc2hib2FyZA0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLmRhc2hib2FyZElkIFVuaWd1ZSBkYXNoYmFyZCBpZGVudGlmaWVyDQogICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBjZmcuaXNEZWZhdWx0IHRydWUgdG8gc2V0IGFzIGRlZmF1bHQgZGFzaGJvYXJkDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuDQogICAgICAgICAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLg0KICAgICAgICAgICAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaA0KICAgICAgICAgICAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuDQogICAgICAgICAgICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+DQogICAgICAgICAgICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4NCiAgICAgICAgICAgKiAgICAgPC91bD4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLnNldERlZmF1bHREYXNoYm9hcmQoew0KICAgICAgICAgICAqICAgICBkYXNoYm9hcmRJZDonOTE3YjRjZDAtZWNiZC00MTBiLWFmZDktNDJkMTUwYzI2NDI2JywNCiAgICAgICAgICAgKiAgICAgaXNEZWZhdWx0OnRydWUsDQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBzZXREZWZhdWx0RGFzaGJvYXJkIDogZnVuY3Rpb24gKGNmZyl7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9kYXNoYm9hcmQvIiArIGNmZy5kYXNoYm9hcmRJZCArICI/aXNkZWZhdWx0PSIgKyBjZmcuaXNEZWZhdWx0Ow0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BVVCc7DQogICAgICAgICAgICAgIHNldFZhbHVlKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTYXZlcyBjaGFuZ2VzIHRvIGEgbmV3IG9yIGV4aXN0aW5nIGRhc2hib2FyZA0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLmpzb24gVGhlIGVuY29kZWQgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkYXNoYm9hcmQuDQogICAgICAgICAgICogVGhlIGRhc2hib2FyZCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dDogbGF5b3V0IG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7TnVtYmVyfSBjb2x1bW5Db3VudDogbnVtYmVyIG9mIGNvbHVtbnMgaWYgZGFzaGJvYXJkIGlzIGEgcG9ydGFsIHR5cGU8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtMaXN0fSBFRGFzaGJvYXJkTGF5b3V0TGlzdDogbGlzdCBvZiBkYXNoYm9hcmQgdHlwZXM8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgZGFzaGJvYXJkIHR5cGU8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2ZnLnNhdmVBc05ldyBBIEJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbnRpdHkgYmVpbmcgc2F2ZWQgaXMgbmV3Lg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjZmcuYXN5bmNdIEFzeW5jIHRydWUgb3IgZmFsc2UgZGVmYXVsdHMgdG8gdHJ1ZQ0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7DQogICAgICAgICAgICogICBhbGVydChkYXNoYm9hcmQubmFtZSk7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgZGFzaGJvYXJkID0gew0KICAgICAgICAgICAqICAgYWx0ZXJlZEJ5QWRtaW46ICdmYWxzZScsDQogICAgICAgICAgICogICBjcmVhdGVkRGF0ZTogJzA0LzE4LzIwMTIgMTE6MjkgQU0gRURUJywNCiAgICAgICAgICAgKiAgIGlzR3JvdXBEYXNoYm9hcmQ6IGZhbHNlLA0KICAgICAgICAgICAqICAgaXNkZWZhdWx0OiBmYWxzZSwNCiAgICAgICAgICAgKiAgIGxvY2tlZDogZmFsc2UsDQogICAgICAgICAgICogICBuYW1lOiAnTXkgRGFzaGJvYXJkJywNCiAgICAgICAgICAgKiAgIHVzZXI6IHsNCiAgICAgICAgICAgKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsDQogICAgICAgICAgICogICB9LA0KICAgICAgICAgICAqICAgY3JlYXRlZEJ5OiB7DQogICAgICAgICAgICogICAgIHVzZXJJZDogJ3Rlc3RBZG1pbjEnLA0KICAgICAgICAgICAqICAgICB1c2VyUmVhbE5hbWU6ICdUZXN0IEFkbWluIDEnDQogICAgICAgICAgICogICB9LA0KICAgICAgICAgICAqICAgZWRpdGVkRGF0ZTogJzA0LzE4LzIwMTIgMTE6MjkgQU0gRURUJywNCiAgICAgICAgICAgKiAgIGdyb3VwczogW10sDQogICAgICAgICAgICogICBkZXNjcmlwdGlvbjogJ1RoaXMgaXMgbXkgZGFzaGJvYXJkJywNCiAgICAgICAgICAgKiAgIGd1aWQ6IGd1aWQudXRpbC5ndWlkKCksDQogICAgICAgICAgICogICBsYXlvdXRDb25maWc6IHsNCiAgICAgICAgICAgKiAgICAgICB4dHlwZTogImRlc2t0b3BwYW5lIiwgDQogICAgICAgICAgICogICAgICAgZmxleDogMSwgDQogICAgICAgICAgICogICAgICAgaGVpZ2h0OiAiMTAwJSIsIA0KICAgICAgICAgICAqICAgICAgIGl0ZW1zOiBbDQogICAgICAgICAgICogICAgICAgXSwgDQogICAgICAgICAgICogICAgICAgcGFuZVR5cGU6ICJkZXNrdG9wcGFuZSIsIA0KICAgICAgICAgICAqICAgICAgIHdpZGdldHM6IFt7DQogICAgICAgICAgICogICAgICAgICAgICAgICB3aWRnZXRHdWlkOiAiZWM1NDM1Y2YtNDAyMS00ZjJhLWJhNjktZGRlNDUxZDEyNTUxIiwgDQogICAgICAgICAgICogICAgICAgICAgICAgICB1bmlxdWVJZDogZ3VpZC51dGlsLmd1aWQoKSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBkYXNoYm9hcmRHdWlkOiAiNmQ3MjE5Y2ItYjQ4NS1hY2U1LTk0NmItMGFmZmExZjIyN2EzIiwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBwYW5lR3VpZDogZ3VpZC51dGlsLmd1aWQoKSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBuYW1lOiAiQ2hhbm5lbCBMaXN0ZW5lciIsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgYWN0aXZlOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICB4OiA1MCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICB5OiA2NiwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBtaW5pbWl6ZWQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIG1heGltaXplZDogZmFsc2UsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgcGlubmVkOiBmYWxzZSwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBjb2xsYXBzZWQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGNvbHVtblBvczogMCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBidXR0b25JZDogbnVsbCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICBidXR0b25PcGVuZWQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHJlZ2lvbjogIm5vbmUiLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHN0YXRlUG9zaXRpb246IDEsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgaW50ZW50Q29uZmlnOiBudWxsLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHNpbmdsZXRvbjogZmFsc2UsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgZmxvYXRpbmdXaWRnZXQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IGZhbHNlLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgIHpJbmRleDogMTkwNTAsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgaGVpZ2h0OiA0NDAsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgd2lkdGg6IDU0MA0KICAgICAgICAgICAqICAgICAgICAgICB9DQogICAgICAgICAgICogICAgICAgXSwgDQogICAgICAgICAgICogICAgICAgZGVmYXVsdFNldHRpbmdzOiB7DQogICAgICAgICAgICogICAgICAgICAgIHdpZGdldFN0YXRlczogew0KICAgICAgICAgICAqICAgICAgICAgICAgICAgImVjNTQzNWNmLTQwMjEtNGYyYS1iYTY5LWRkZTQ1MWQxMjU1MSI6IHsNCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICAgICB4OiA1MCwgDQogICAgICAgICAgICogICAgICAgICAgICAgICAgICAgeTogNjYsIA0KICAgICAgICAgICAqICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDQwLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICAgICB3aWR0aDogNTQwLCANCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IDEzNDk4MDk3NDczMzYNCiAgICAgICAgICAgKiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICogICAgICAgICAgIH0NCiAgICAgICAgICAgKiAgICAgICB9DQogICAgICAgICAgICogICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5jcmVhdGVPclVwZGF0ZURhc2hib2FyZCh7DQogICAgICAgICAgICogICBqc29uOiBkYXNoYm9hcmQsDQogICAgICAgICAgICogICBzYXZlQXNOZXc6IHRydWUsDQogICAgICAgICAgICogICBvblN1Y2Nlc3M6IG9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgIG9uRmFpbHVyZTogb25GYWlsdXJlLA0KICAgICAgICAgICAqICAgYXN5bmM6IHRydWUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBjcmVhdGVPclVwZGF0ZURhc2hib2FyZCA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvIiArICdkYXNoYm9hcmQnICsgIi8iICsgY2ZnLmpzb24uZ3VpZDsNCiAgICAgICAgICAgICAgdmFyIHBvc3RQYXJhbXMgPSBnZW5lcmF0ZURhc2hib2FyZFBvc3RQYXJhbXNKU09OKGNmZy5qc29uKTsNCiAgICAgICAgICAgICAgcG9zdFBhcmFtcy5ieXBhc3NMYXlvdXRSZWFycmFuZ2UgPSB0cnVlOw0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gY2ZnLnNhdmVBc05ldyA/ICdQT1NUJyA6ICdQVVQnOw0KICAgICAgICAgICAgICBjZmcuanNvbk9iamVjdCA9IHBvc3RQYXJhbXM7DQogICAgICAgICAgICAgIHNldFZhbHVlc1ZpYUpTT05PYmplY3QoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIENvcGllcyBhbiBleGlzdGluZyBkYXNoYm9hcmQgYW5kIHNhdmVzIGl0IGFzIG5ldw0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLmpzb24gVGhlIGVuY29kZWQgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkYXNoYm9hcmQuDQogICAgICAgICAgICogVGhlIGRhc2hib2FyZCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLg0KICAgICAgICAgICAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaA0KICAgICAgICAgICAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuDQogICAgICAgICAgICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+DQogICAgICAgICAgICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4NCiAgICAgICAgICAgKiAgICAgPC91bD4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuDQogICAgICAgICAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+DQogICAgICAgICAgICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+DQogICAgICAgICAgICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLg0KICAgICAgICAgICAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaA0KICAgICAgICAgICAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuDQogICAgICAgICAgICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+DQogICAgICAgICAgICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+DQogICAgICAgICAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+DQogICAgICAgICAgICogICAgICAgIDwvdWw+DQogICAgICAgICAgICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4NCiAgICAgICAgICAgKiAgICAgPC91bD4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7DQogICAgICAgICAgICogICBhbGVydChkYXNoYm9hcmQubmFtZSk7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgZGFzaGJvYXJkID0gew0KICAgICAgICAgICAqICAgYWx0ZXJlZEJ5QWRtaW46ICdmYWxzZScsDQogICAgICAgICAgICogICBjcmVhdGVkRGF0ZTogJzA0LzE4LzIwMTIgMTE6MjkgQU0gRURUJywNCiAgICAgICAgICAgKiAgIGlzR3JvdXBEYXNoYm9hcmQ6IGZhbHNlLA0KICAgICAgICAgICAqICAgaXNkZWZhdWx0OiBmYWxzZSwNCiAgICAgICAgICAgKiAgIG5hbWU6ICdNeSBEYXNoYm9hcmQnLA0KICAgICAgICAgICAqICAgdXNlcjogew0KICAgICAgICAgICAqICAgICB1c2VySWQ6ICd0ZXN0QWRtaW4xJywNCiAgICAgICAgICAgKiAgIH0sDQogICAgICAgICAgICogICBjcmVhdGVkQnk6IHsNCiAgICAgICAgICAgKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsDQogICAgICAgICAgICogICAgIHVzZXJSZWFsTmFtZTogJ1Rlc3QgQWRtaW4gMScNCiAgICAgICAgICAgKiAgIH0sDQogICAgICAgICAgICogICBlZGl0ZWREYXRlOiAnMDQvMTgvMjAxMiAxMToyOSBBTSBFRFQnLA0KICAgICAgICAgICAqICAgZ3JvdXBzOiBbXSwNCiAgICAgICAgICAgKiAgIGRlc2NyaXB0aW9uOiAnVGhpcyBpcyBteSBkYXNoYm9hcmQnLA0KICAgICAgICAgICAqICAgZ3VpZDogZ3VpZC51dGlsLmd1aWQoKSwNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmNsb25lRGFzaGJvYXJkKHsNCiAgICAgICAgICAgKiAgIGpzb246IGRhc2hib2FyZCwNCiAgICAgICAgICAgKiAgIG9uU3VjY2Vzczogb25TdWNjZXNzLA0KICAgICAgICAgICAqICAgb25GYWlsdXJlOiBvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBjbG9uZURhc2hib2FyZCA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvIiArICdkYXNoYm9hcmQnICsgIi8iICsgY2ZnLmpzb24uZ3VpZDsNCiAgICAgICAgICAgICAgdmFyIHBvc3RQYXJhbXMgPSBnZW5lcmF0ZURhc2hib2FyZFBvc3RQYXJhbXNKU09OKGNmZy5qc29uKTsNCiAgICAgICAgICAgICAgcG9zdFBhcmFtcy5jbG9uZWQgPSB0cnVlOw0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BPU1QnOw0KICAgICAgICAgICAgICBjZmcuanNvbk9iamVjdCA9IHBvc3RQYXJhbXM7DQogICAgICAgICAgICAgIHNldFZhbHVlc1ZpYUpTT05PYmplY3QoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNhdmVzIGNoYW5nZXMgdG8gZXhpc3RpbmcgZGFzaGJvYXJkcw0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBjZmcudmlld3NUb1VwZGF0ZSBhcnJheSBvZiBKU09OIG9iamVjdHMgY29udGFpbmluZyB0aGUgdmlldyBndWlkIGFuZCBkYXRhIHRvIGJlIHVwZGF0ZWQNCiAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBjZmcudmlld0d1aWRzVG9EZWxldGUgYXJyYXkgb2YgZ3VpZHMgb2Ygdmlld3MgdG8gYmUgZGVsZXRlZA0KICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2ZnLnVwZGF0ZU9yZGVyIGZsYWcgdG8gdXBkYXRlIG9yZGVyDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdA0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKQ0KICAgICAgICAgICAqLw0KICAgICAgICAgIHVwZGF0ZUFuZERlbGV0ZURhc2hib2FyZHMgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL2Rhc2hib2FyZCI7DQogICAgICAgICAgICAgIHZhciBwb3N0UGFyYW1zID0gew0KICAgICAgICAgICAgICAgICAgJ19tZXRob2QnOiAnUFVUJywNCiAgICAgICAgICAgICAgICAgICd2aWV3c1RvVXBkYXRlJzogT3pvbmUudXRpbC50b1N0cmluZyhjZmcudmlld3NUb1VwZGF0ZSksDQogICAgICAgICAgICAgICAgICAndmlld0d1aWRzVG9EZWxldGUnOiBPem9uZS51dGlsLnRvU3RyaW5nKGNmZy52aWV3R3VpZHNUb0RlbGV0ZSksDQogICAgICAgICAgICAgICAgICAndXBkYXRlT3JkZXInOiBjZmcudXBkYXRlT3JkZXINCiAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BPU1QnOw0KICAgICAgICAgICAgICBjZmcuY29udGVudCA9IHBvc3RQYXJhbXM7DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIERlbGV0ZXMgdGhlIGRhc2hib2FyZCB3aXRoIHRoZSBzcGVjaWZpZWQgaWQNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kYXNoYm9hcmRJZCBVbmlndWUgZGFzaGJhcmQgaWRlbnRpZmllcg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgew0KICAgICAgICAgICAqICAgICBhbGVydChkYXNoYm9hcmQubmFtZSk7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZGVsZXRlRGFzaGJvYXJkKHsNCiAgICAgICAgICAgKiAgICAgZGFzaGJvYXJkSWQ6JzkxN2I0Y2QwLWVjYmQtNDEwYi1hZmQ5LTQyZDE1MGMyNjQyNicsDQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBkZWxldGVEYXNoYm9hcmQgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL2Rhc2hib2FyZC8iICsgY2ZnLmRhc2hib2FyZElkOw0KICAgICAgICAgICAgICBkZWxldGVCYXNlKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIGFsbCBkYXNoYm9hcmRzIGZvciB0aGUgbG9nZ2VkIGluIHVzZXIuDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuDQogICAgICAgICAgICogVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtCb29sZWFufSBzdWNjZXNzOiB0cnVlIGlmIGRhc2hib2FyZHMgZm91bmQ8YnI+DQogICAgICAgICAgICogICAgIHtOdW1iZXJ9IHJlc3VsdHM6IG51bWJlciBvZiBkYXNoYm9hcmRzIGZvdW5kPGJyPg0KICAgICAgICAgICAqICAgICB7QXJyYXl9IGRhdGE6IGFycmF5IG9mIGRhc2hib2FyZHMgb2JqZWN0cyBmb3VuZC4gIERhc2hib2FyZCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogICAgIDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4NCiAgICAgICAgICAgKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gNCiAgICAgICAgICAgKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5Lg0KICAgICAgICAgICAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+DQogICAgICAgICAgICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4NCiAgICAgICAgICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4NCiAgICAgICAgICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPg0KICAgICAgICAgICAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+DQogICAgICAgICAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPg0KICAgICAgICAgICAqICAgICAgICA8L3VsPg0KICAgICAgICAgICAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+DQogICAgICAgICAgICogICAgIDwvdWw+DQogICAgICAgICAgICogICAgIDxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ob2JqKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KG9iai5yZXN1bHRzKTsNCiAgICAgICAgICAgKiAgICAgaWYgKG9iai5yZXN1bHRzID4gMCkgew0KICAgICAgICAgICAqICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoucmVzdWx0czsgaSsrKSB7DQogICAgICAgICAgICogICAgICAgICAgICAgYWxlcnQob2JqLmRhdGFbaV0ubmFtZSk7DQogICAgICAgICAgICogICAgICAgICB9DQogICAgICAgICAgICogICAgIH0NCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmZpbmREYXNoYm9hcmRzKHsNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGZpbmREYXNoYm9hcmRzIDogZnVuY3Rpb24gIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gImRhc2hib2FyZCI7DQogICAgICAgICAgICAgIGxpc3QoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlcHJlY2F0ZWQgRGVwcmVjYXRlZCBzdGFydGluZyB3aXRoIE9XRiA3LiBEYXNoYm9hcmRzIG5vIGxvbmdlciBoYXZlIGEgc3BlY2lmaWMgdHlwZS4gVGhpcyBmdW5jdGlvbiBpcyBzdHViYmVkIA0KICAgICAgICAgICAqIHRvIHJldHVybiBzdWNjZXNzIHdpdGggMCByZXN1bHRzIHVudGlsIHJlbW92YWwuDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIFJldHVybnMgYWxsIGRhc2hib2FyZHMgZm9yIHRoZSBsb2dnZWQgaW4gdXNlciBmaWx0ZXJlZCBieSB0aGUgdHlwZSBvZiBkYXNoYm9hcmQuDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcudHlwZSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHR5cGUgb2YgZGFzaGJvYXJkLiBJZiB1c2luZyBidWlsdCBpbiBkYXNoYm9hcmQgdHlwZXMsIHRoaXMgd291bGQgaW5jbHVkZSBkZXNrdG9wLCB0YWJiZWQsIHBvcnRhbCwgYW5kIGFjY29yZGlvbi4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0Lg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiBkYXNoYm9hcmRzIGZvdW5kPGJyPg0KICAgICAgICAgICAqICAgICB7TnVtYmVyfSByZXN1bHRzOiBudW1iZXIgb2YgZGFzaGJvYXJkcyBmb3VuZDxicj4NCiAgICAgICAgICAgKiAgICAge0FycmF5fSBkYXRhOiBhbiBlbXB0eSBhcnJheTxicj4NCiAgICAgICAgICAgKiAgICAgDQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBhbGVydChvYmoucmVzdWx0cyk7DQogICAgICAgICAgICogICAgIGlmIChvYmoucmVzdWx0cyA+IDApIHsNCiAgICAgICAgICAgKiAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLnJlc3VsdHM7IGkrKykgew0KICAgICAgICAgICAqICAgICAgICAgICAgIGFsZXJ0KG9iai5kYXRhW2ldLm5hbWUpOw0KICAgICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5maW5kRGFzaGJvYXJkc0J5VHlwZSh7DQogICAgICAgICAgICogICAgIHR5cGU6J2Rlc2t0b3AnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZmluZERhc2hib2FyZHNCeVR5cGUgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjZmcub25TdWNjZXNzID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0geyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW10sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUNCiAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgY2ZnLm9uU3VjY2VzcyhyZXRWYWwpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSB3aWRnZXQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcud2lkZ2V0SWQgVGhlIGd1aWQgb2YgdGhlIHdpZGdldC4NCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLnVuaXZlcnNhbE5hbWUgVGhlIHVuaXZlcnNhbCBuYW1lIGZvciB0aGUgd2lkZ2V0Lg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIGlzIHBhc3NlZCB0aGUgZm9sbG93aW5nIG9iamVjdCBhcyBhIHBhcmFtZXRlcjoge2lkOk51bWJlciwgbmFtZXNwYWNlOlN0cmluZywgdmFsdWU6T2JqZWN0LCBwYXRoOlN0cmluZ30NCiAgICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge051bWJlcn0gaWQ6IGRhdGFiYXNlIHBrIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWVzcGFjZTogIndpZGdldCI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHZhbHVlOiB3aWRnZXQgb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBlZGl0YWJsZTogdHJ1ZSBpZiB3aWRnZXQgY2FuIGJlIGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHZpc2libGU6IHRydWUgaWYgd2lkZ2V0IGlzIHZpc2libGU8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHBvc2l0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHdpZGdldCBvd25lciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHdpZGdldCBvd25lciBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBuYW1lc3BhY2U6IHdpZGdldCBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1cmw6IHVybCBvZiB3aWRnZXQgYXBwbGljYXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGhlYWRlckljb246IHVybCBvZiB3aWRnZXQgaGVhZGVyIGljb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGltYWdlOiB1cmwgb2Ygd2lkZ2V0IGltYWdlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBzbWFsbEljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBzbWFsbCBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBsYXJnZUljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBsYXJnZSBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB3aWR0aDogd2lkdGggb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHdpZGdldFZlcnNpb246IHdpZGdldCB2ZXJzaW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IHRhZ3M6IGFycmF5IG9mIHRhZyBzdHJpbmdzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZGVmaW5pdGlvblZpc2libGU6IHRydWUgaWYgZGVmaW5pdGlvbiBpcyB2aXNpYmxlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gc2luZ2xldG9uOiB0cnVlIGlmIHdpZGdldCBpcyBhIHNpbmdsZXRvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGJhY2tncm91bmQ6IHRydWUgaWYgd2lkZ2V0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gYWxsUmVxdWlyZWQ6IGFycmF5IG9mIGFsbCB3aWRnZXRzIHJlcXVpcmVkIGJ5IHRoaXMgd2lkZ2V0PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGRpcmVjdFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyBkaXJlY3RseSByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB3aWRnZXRUeXBlczogYXJyYXkgb2Ygd2lkZ2V0IHR5cGVzIHRoaXMgd2lkZ2V0IGJlbG9uZ3MgdG88YnI+DQogICAgICAgICAgICogICAgIDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gcGF0aDogVGhlIGd1aWQgb2YgdGhlIHdpZGdldC48YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBpZiAob2JqLnZhbHVlKSB7DQogICAgICAgICAgICogICAgICAgICBhbGVydChvYmoudmFsdWUubmFtZXNwYWNlKTsNCiAgICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoZXJyb3IpOw0KICAgICAgICAgICAqIH07DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZ2V0V2lkZ2V0KHsNCiAgICAgICAgICAgKiAgICAgd2lkZ2V0SWQ6J2VhNTQzNWNmLTQwMjEtNGYyYS1iYTY5LWRkZTQ1MWQxMjU1MScsDQogICAgICAgICAgICogICAgIHdpZGdldFV1aWQ6ICdjb20uY29tcGFueS53aWRnZXQubmFtZScsDQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXRXaWRnZXQgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiLyIgKyAnd2lkZ2V0JyArICIvIiArIGNmZy53aWRnZXRJZDsNCiAgICAgICAgICAgICAgaWYoY2ZnLnVuaXZlcnNhbE5hbWUpIHsNCiAgICAgICAgICAgICAgICAgIGNmZy51cmwgKz0gJz91bml2ZXJzYWxOYW1lPScgKyBjZmcudW5pdmVyc2FsTmFtZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBnZXQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIEdldHMgYWxsIHdpZGdldHMgZm9yIGEgZ2l2ZW4gdXNlci4NCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLnVzZXJPbmx5XSBib29sZWFuIGZsYWcgdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgdG8gb25seSByZXR1cm4gd2lkZ2V0cyBhc3NpZ25lZCB0byB0aGUgdXNlciAoZXhjbHVkaW5nIHdpZGdldHMgdG8gd2hpY2ggdGhlIHVzZXIgb25seSBoYXMgYWNjZXNzIHZpYSB0aGVpciBhc3NpZ25lZCBncm91cHMpDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtjZmcuc2VhcmNoUGFyYW1zXSBvYmplY3QgY29udGFpbmluZyBzZWFyY2ggcGFyYW1ldGVycw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXROYW1lXSBuYW1lIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXROYW1lRXhhY3RNYXRjaF0gdHJ1ZSBvciBmYWxzZSB0byBtYXRjaCB0aGUgbmFtZSBleGFjdGx5LiBkZWZhdWx0cyB0byBmYWxzZQ0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRWZXJzaW9uXSB2ZXJzaW9uIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRHdWlkXSBHdWlkIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy51bml2ZXJzYWxOYW1lXSBVbml2ZXJzYWwgbmFtZSBvZiB3aWRnZXQgJyUnIGFyZSB3aWxkY2FyZHMNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0Lg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBhcnJheSBvZiBvYmplY3RzIGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiAgICAge051bWJlcn0gaWQ6IGRhdGFiYXNlIHBrIGlkZW50aWZpZXI8YnI+DQogICAgICAgICAgICogICAgIHtTdHJpbmd9IG5hbWVzcGFjZTogIndpZGdldCI8YnI+DQogICAgICAgICAgICogICAgIHtPYmplY3R9IHZhbHVlOiB3aWRnZXQgb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPg0KICAgICAgICAgICAqICAgICA8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBlZGl0YWJsZTogdHJ1ZSBpZiB3aWRnZXQgY2FuIGJlIGVkaXRlZDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHZpc2libGU6IHRydWUgaWYgd2lkZ2V0IGlzIHZpc2libGU8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHBvc2l0aW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHdpZGdldCBvd25lciBpZGVudGlmaWVyPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHdpZGdldCBvd25lciBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBuYW1lc3BhY2U6IHdpZGdldCBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1cmw6IHVybCBvZiB3aWRnZXQgYXBwbGljYXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGhlYWRlckljb246IHVybCBvZiB3aWRnZXQgaGVhZGVyIGljb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGltYWdlOiB1cmwgb2Ygd2lkZ2V0IGltYWdlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBzbWFsbEljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBzbWFsbCBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBsYXJnZUljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBsYXJnZSBpY29uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB3aWR0aDogd2lkdGggb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHRoZSB3aWRnZXQgaW4gcGl4ZWxzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb248YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHdpZGdldFZlcnNpb246IHdpZGdldCB2ZXJzaW9uPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IHRhZ3M6IGFycmF5IG9mIHRhZyBzdHJpbmdzPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZGVmaW5pdGlvblZpc2libGU6IHRydWUgaWYgZGVmaW5pdGlvbiBpcyB2aXNpYmxlPGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gc2luZ2xldG9uOiB0cnVlIGlmIHdpZGdldCBpcyBhIHNpbmdsZXRvbjxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGJhY2tncm91bmQ6IHRydWUgaWYgd2lkZ2V0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQ8YnI+DQogICAgICAgICAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gYWxsUmVxdWlyZWQ6IGFycmF5IG9mIGFsbCB3aWRnZXRzIHJlcXVpcmVkIGJ5IHRoaXMgd2lkZ2V0PGJyPg0KICAgICAgICAgICAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGRpcmVjdFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyBkaXJlY3RseSByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4NCiAgICAgICAgICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB3aWRnZXRUeXBlczogYXJyYXkgb2Ygd2lkZ2V0IHR5cGVzIHRoaXMgd2lkZ2V0IGJlbG9uZ3MgdG88YnI+DQogICAgICAgICAgICogICAgIDxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gcGF0aDogVGhlIGd1aWQgb2YgdGhlIHdpZGdldC48YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdHdvIHBhcmFtZXRlcnM6IGEgZXJyb3IgbWVzc2FnZSBzdHJpbmcsIGFuZCBvcHRpb25hbGx5IGEgc3RhdHVzIGNvZGUNCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHdpZGdldHMpIHsNCiAgICAgICAgICAgKiAgICAgaWYgKHdpZGdldHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAqICAgICAgICAgYWxlcnQod2lkZ2V0c1swXS52YWx1ZS5uYW1lc3BhY2UpOw0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvciwgc3RhdHVzKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmZpbmRXaWRnZXRzKHsNCiAgICAgICAgICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywNCiAgICAgICAgICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQ0KICAgICAgICAgICAqIH0pOw0KICAgICAgICAgICAqLw0KICAgICAgICAgIGZpbmRXaWRnZXRzIDogZnVuY3Rpb24gKGNmZyl7DQoNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL3dpZGdldCI7DQogICAgICAgICAgICAgIGlmICghY2ZnLnVzZXJPbmx5KSB7DQogICAgICAgICAgICAgICAgICBjZmcudXJsICs9ICIvbGlzdFVzZXJBbmRHcm91cFdpZGdldHMiOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gQWRkIHNlYXJjaCBwYXJhbXMNCiAgICAgICAgICAgICAgdmFyIHBvc3RQYXJhbXMgPSB7DQogICAgICAgICAgICAgICAgICAnX21ldGhvZCc6ICdHRVQnDQogICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgaWYgKGNmZy5zZWFyY2hQYXJhbXMpIHsNCiAgICAgICAgICAgICAgICAgIGlmIChjZmcuc2VhcmNoUGFyYW1zLndpZGdldE5hbWUgJiYgY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXROYW1lLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VhcmNoVGVybSA9IGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZUV4YWN0TWF0Y2gpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVGVybSA9ICclJytzZWFyY2hUZXJtKyclJzsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgcG9zdFBhcmFtc1snd2lkZ2V0TmFtZSddID0gc2VhcmNoVGVybTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChjZmcuc2VhcmNoUGFyYW1zLndpZGdldFZlcnNpb24gJiYgY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRWZXJzaW9uLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICBwb3N0UGFyYW1zWyd3aWRnZXRWZXJzaW9uJ10gPSBjZmcuc2VhcmNoUGFyYW1zLndpZGdldFZlcnNpb247DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRHdWlkICYmIGNmZy5zZWFyY2hQYXJhbXMud2lkZ2V0R3VpZC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgcG9zdFBhcmFtc1snd2lkZ2V0R3VpZCddID0gY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRHdWlkOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKGNmZy5zZWFyY2hQYXJhbXMudW5pdmVyc2FsTmFtZSAmJiBjZmcuc2VhcmNoUGFyYW1zLnVuaXZlcnNhbE5hbWUubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIHBvc3RQYXJhbXNbJ3VuaXZlcnNhbE5hbWUnXSA9IGNmZy5zZWFyY2hQYXJhbXMudW5pdmVyc2FsTmFtZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChjZmcuc2VhcmNoUGFyYW1zLmdyb3VwX2lkKSB7DQogICAgICAgICAgICAgICAgICAgICAgcG9zdFBhcmFtc1snZ3JvdXBfaWQnXSA9IGNmZy5zZWFyY2hQYXJhbXMuZ3JvdXBfaWQ7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gJ1BPU1QnOw0KICAgICAgICAgICAgICBjZmcuY29udGVudCA9IHBvc3RQYXJhbXM7DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNhdmVzIGNoYW5nZXMgdG8gZXhpc3Rpbmcgd2lkZ2V0cw0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBjZmcud2lkZ2V0c1RvVXBkYXRlIGFycmF5IG9mIEpTT04gb2JqZWN0cyBjb250YWluaW5nIHRoZSB3aWRnZXQgZ3VpZCBhbmQgZGF0YSB0byBiZSB1cGRhdGVkDQogICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gY2ZnLndpZGdldEd1aWRzVG9EZWxldGUgYXJyYXkgb2YgZ3VpZHMgb2Ygd2lkZ2V0cyB0byBiZSBkZWxldGVkDQogICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBjZmcudXBkYXRlT3JkZXIgZmxhZyB0byB1cGRhdGUgb3JkZXINCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpDQogICAgICAgICAgICovDQogICAgICAgICAgdXBkYXRlQW5kRGVsZXRlV2lkZ2V0cyA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvd2lkZ2V0IjsNCiAgICAgICAgICAgICAgdmFyIHBvc3RQYXJhbXMgPSB7DQogICAgICAgICAgICAgICAgICAnX21ldGhvZCc6ICdQVVQnLA0KICAgICAgICAgICAgICAgICAgJ3dpZGdldHNUb1VwZGF0ZSc6IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLndpZGdldHNUb1VwZGF0ZSksDQogICAgICAgICAgICAgICAgICAnd2lkZ2V0R3VpZHNUb0RlbGV0ZSc6IE96b25lLnV0aWwudG9TdHJpbmcoY2ZnLndpZGdldEd1aWRzVG9EZWxldGUpLA0KICAgICAgICAgICAgICAgICAgJ3VwZGF0ZU9yZGVyJzogY2ZnLnVwZGF0ZU9yZGVyDQogICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgY2ZnLmNvbnRlbnQgPSBwb3N0UGFyYW1zOw0KICAgICAgICAgICAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBSZXRyaWV2ZXMgdGhlIHVzZXIgcHJlZmVyZW5jZSBmb3IgdGhlIHByb3ZpZGVkIG5hbWUgYW5kIG5hbWVzcGFjZQ0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWVzcGFjZSBUaGUgbmFtZXNwYWNlIG9mIHRoZSByZXF1ZXN0ZWQgdXNlciBwcmVmZXJlbmNlDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSByZXF1ZXN0ZWQgdXNlciBwcmVmZXJlbmNlDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgaXMgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tDQogICAgICAgICAgICogdGhlIGRhdGFiYXNlLiAgVGhpcyBmdW5jdGlvbiB0YWtlcyBhIHNpbmdsZSBhcmd1bWVudCwgd2hpY2ggaXMgYSBKU09OIG9iamVjdC4gIElmIGEgcHJlZmVyZW5jZSBpcyBmb3VuZCwgdGhlDQogICAgICAgICAgICogY29tcGxldGUgSlNPTiBzdHJ1Y3R1cmUgYXMgc2hvd24gYmVsb3cgd2lsbCBiZSByZXR1cm5lZC4gIElmIGl0IGlzIG5vdCBmb3VuZCB0aGlzIGZ1bmN0aW9uIGJlIHBhc3NlZCBhbiBlbXB0eSBKU09OIG9iamVjdC4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzDQogICAgICAgICAgICogZnVuY3Rpb246DQogICAgICAgICAgICogew0KICAgICAgICAgICAqICAgICAidmFsdWUiOiJ0cnVlIiwNCiAgICAgICAgICAgKiAgICAgInBhdGgiOiJtaWxpdGFyeVRpbWUiLA0KICAgICAgICAgICAqICAgICAidXNlciI6DQogICAgICAgICAgICogICAgIHsNCiAgICAgICAgICAgKiAgICAgICAgICJ1c2VySWQiOiJ0ZXN0QWRtaW4xIg0KICAgICAgICAgICAqICAgICB9LA0KICAgICAgICAgICAqICAgICAibmFtZXNwYWNlIjoiY29tLm15Y29tcGFueS5Bbm5vdW5jaW5nQ2xvY2siDQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGlzIHBhcmFtZXRlciBpcyBvcHRpb25hbC4gSWYgdGhpcyBmdW5jdGlvbiBpcyBub3Qgc3BlY2lmaWVkIGEgZGVmYXVsdCBlcnJvcg0KICAgICAgICAgICAqIG1lc3NhZ2Ugd2lsbCBiZSBkaXNwbGF5ZWQuVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgaWYgYW4gZXJyb3Igb2NjdXJzIG9uIHByZWZlcmVuY2UgcmV0cmlldmFsLiAgSXQgaXMgbm90DQogICAgICAgICAgICogY2FsbGVkIGlmIHRoZSBwcmVmZXJlbmNlIGlzIHNpbXBseSBtaXNzaW5nLg0KICAgICAgICAgICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGFjY2VwdCB0d28gYXJndW1lbnRzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogZXJyb3I6IFN0cmluZzxicj4NCiAgICAgICAgICAgKiBUaGUgZXJyb3IgbWVzc2FnZTxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogU3RhdHVzOiBUaGUgbnVtZXJpYyBIVFRQIFN0YXR1cyBjb2RlIChpZiBhcHBsaWNhYmxlKTxicj4NCiAgICAgICAgICAgKiA0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4NCiAgICAgICAgICAgKiA1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPg0KICAgICAgICAgICAqIDQwNDogVGhlIHVzZXIgcHJlZmVyZW5jZSB3YXMgbm90IGZvdW5kLjxicj4NCiAgICAgICAgICAgKiA0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uPGJyPg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICogVGhlIGZvbGxvd2luZyBzaG93cyBob3cgdG8gbWFrZSBhIGNhbGwgdG8gZ2V0VXNlclByZWZlcmVuY2U6DQogICAgICAgICAgICogZnVuY3Rpb24gb25TdWNjZXNzKHByZWYpew0KICAgICAgICAgICAqICAgICBhbGVydChPem9uZS51dGlsLnRvU3RyaW5nKHByZWYudmFsdWUpKTsNCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBmdW5jdGlvbiBvbkZhaWx1cmUoZXJyb3Isc3RhdHVzKXsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoJ0Vycm9yICcgKyBlcnJvcik7DQogICAgICAgICAgICogICAgIGFsZXJ0KHN0YXR1cyk7DQogICAgICAgICAgICogfQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogLy8gVGhlIGZvbGxvd2luZyBjb2RlIGNhbGxzIGdldFVzZXJQcmVmZXJlbmNlIHdpdGggdGhlIGFib3ZlIGRlZmluZWQgb25TdWNjZXNzIGFuZA0KICAgICAgICAgICAqIC8vIG9uRmFpbHVyZSBjYWxsYmFja3MuDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmdldFVzZXJQcmVmZXJlbmNlKHsNCiAgICAgICAgICAgKiAgICAgbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLA0KICAgICAgICAgICAqICAgICBuYW1lOidGaXJzdCBQcmVzaWRlbnQnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0VXNlclByZWZlcmVuY2UgOiBmdW5jdGlvbiAoY2ZnKXsNCiAgICAgICAgICAgICAgY2ZnLnVybCA9IF91cmwgKyAiL3ByZWZlcmVuY2UvIiArIGNmZy5uYW1lc3BhY2UgKyAiLyIgKyBjZmcubmFtZTsNCg0KICAgICAgICAgICAgICAvL2lnb25vcmUgNDA0IGVycm9yIGNvZGUsIG9uU3VjY2VzcyB3aWxsIGJlIGNhbGxlZCB3aXRoIGVtdHB5IG9iamVjdCBwYXlsb2FkDQogICAgICAgICAgICAgIGNmZy5pZ25vcmVkRXJyb3JDb2RlcyA9IFs0MDRdOw0KICAgICAgICAgICAgICBnZXQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIENoZWNrcyBmb3IgdGhlIGV4aXN0ZW5jZSBvZiBhIHVzZXIgcHJlZmVyZW5jZSBmb3IgYSBnaXZlbiBuYW1lc3BhY2UgYW5kIG5hbWUNCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lc3BhY2UgVGhlIG5hbWVzcGFjZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXINCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWUgVGhlIG5hbWUgb2YgdGhlIHJlcXVlc3RlZCB1c2VyDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgaWYgYSBwcmVmZXJlbmNlIHN1Y2Nlc3NmdWxseSByZXR1cm4gZnJvbSB0aGUgZGF0YWJhc2UuDQogICAgICAgICAgICogVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogICAgIHtOdW1iZXJ9IHN0YXR1c0NvZGU6IHN0YXR1cyBjb2RlPGJyPg0KICAgICAgICAgICAqICAgICB7Qm9vbGVhbn0gcHJlZmVyZW5jZUV4aXN0OiB0cnVlIGlmIHByZWZlcmVuY2UgZXhpc3RzPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGlmIHRoZXJlIHdhcw0KICAgICAgICAgICAqIGFuIGVycm9yIGxvb2tpbmcgdXAgdGhlIHByZWZlcmVuY2UuICBUaGlzIGZ1bmN0aW9uIGlzIDxlbT5ub3Q8L2VtPiBjYWxsZWQNCiAgICAgICAgICAgKiBpZiB0aGUgcHJlZmVyZW5jZSBzaW1wbHkgZG9lcyBub3QgZXhpc3QNCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBpZiAob2JqLnN0YXR1c0NvZGUgPSAyMDApIHsNCiAgICAgICAgICAgKiAgICAgICAgIGFsZXJ0KG9iai5wcmVmZXJlbmNlRXhpc3QpOw0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5kb2VzVXNlclByZWZlcmVuY2VFeGlzdCh7DQogICAgICAgICAgICogICAgIG5hbWVzcGFjZTonZm9vLmJhci4wJywNCiAgICAgICAgICAgKiAgICAgbmFtZTondGVzdCBwYXRoIGVudHJ5IDAnLA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZG9lc1VzZXJQcmVmZXJlbmNlRXhpc3Q6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICIvaGFzUHJlZmVyZW5jZS8iICsgY2ZnLm5hbWVzcGFjZSArICIvIiArIGNmZy5uYW1lOw0KICAgICAgICAgICAgICBnZXQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQGRlc2NyaXB0aW9uIHJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyIGxvZ2dlZCBpbnRvIHRoZSBzeXN0ZW0NCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZm9yIGEgc3VjY2Vzc2Z1bCByZXRyaWV2YWwgb2YgdGhlIHVzZXIgbG9nZ2VkIGluLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSBjdXJyZW50VXNlck5hbWU6IHVzZXIgbmFtZTxicj4NCiAgICAgICAgICAgKiAgICAge1N0cmluZ30gY3VycmVudFVzZXI6IHVzZXIgcmVhbCBuYW1lPGJyPg0KICAgICAgICAgICAqICAgICB7RGF0ZX0gY3VycmVudFVzZXJQcmV2TG9naW46IHByZXZpb3VzIGxvZ2luIGRhdGU8YnI+DQogICAgICAgICAgICogICAgIHtOdW1iZXJ9IGN1cnJlbnRJZDogZGF0YWJhc2UgcGsgaW5kZXg8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5bb25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgc3lzdGVtIGlzIHVuYWJsZSB0byByZXRyaWV2ZSB0aGUgY3VycmVudCB1c2VyIGxvZ2dlZCBpbi4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBpZiAob2JqKSB7DQogICAgICAgICAgICogICAgICAgICBhbGVydChvYmouY3VycmVudFVzZXIpOw0KICAgICAgICAgICAqICAgICB9DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIHZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgew0KICAgICAgICAgICAqICAgICBhbGVydChlcnJvcik7DQogICAgICAgICAgICogfTsNCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIE96b25lLnByZWYuUHJlZlNlcnZlci5nZXRDdXJyZW50VXNlcih7DQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXRDdXJyZW50VXNlcjogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9wZXJzb24vd2hvYW1pIjsNCiAgICAgICAgICAgICAgZ2V0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBGb3IgcmV0cmlldmluZyB0aGUgT1dGIHN5c3RlbSBzZXJ2ZXIgdmVyc2lvbg0KICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBmb3Igc3VjY2Vzc2Z1bGx5IHJldHJpZXZpbmcgdGhlIHNlcnZlciB2ZXJzaW9uIG9mIHRoZSBPV0Ygc3lzdGVtLg0KICAgICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqICAgICB7U3RyaW5nfSB7c2VydmVyVmVyc2lvbjogc2VydmVyIHZlcnNpb248YnI+DQogICAgICAgICAgICogPGJyPg0KICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgc3lzdGVtIGZhaWxzIHRvIHJldHJpZXZlIHRoZSBzZXJ2ZXIgdmVyc2lvbiBvZiB0aGUgT1dGIHN5c3RlbS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICAgICAqICAgICBpZiAob2JqKSB7DQogICAgICAgICAgICogICAgICAgICBhbGVydChvYmouc2VydmVyVmVyc2lvbik7DQogICAgICAgICAgICogICAgIH0NCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7DQogICAgICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsNCiAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAqDQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLmdldFNlcnZlclZlcnNpb24oew0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgZ2V0U2VydmVyVmVyc2lvbjogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9zZXJ2ZXIvcmVzb3VyY2VzIjsNCiAgICAgICAgICAgICAgZ2V0KGNmZyk7DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDcmVhdGVzIG9yIHVwZGF0ZXMgYSB1c2VyIHByZWZlcmVuY2UgZm9yIHRoZSBwcm92aWRlZCBuYW1lc3BhY2UgYW5kIG5hbWUuDQogICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlICBUaGUgbmFtZXNwYWNlIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UNCiAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWUgVGhlIG5hbWUgb2YgdGhlIHVzZXIgcHJlZmVyZW5jZQ0KICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcudmFsdWUgIFRoZSB2YWx1ZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlLiBUaGUgdmFsdWUgY2FuIGJlIGFueSBzdHJpbmcgaW5jbHVkaW5nIEpTT04uDQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgaXMgc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgaW4NCiAgICAgICAgICAgKiB0aGUgZGF0YWJhc2UuDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogVGhlIGZvbGxvd2luZyBpcyBhbiBleGFtcGxlIG9mIGEgY29tcGxldGUgcHJlZmVyZW5jZSBvYmplY3QgcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MNCiAgICAgICAgICAgKiBmdW5jdGlvbjoNCiAgICAgICAqIHsNCiAgICAgICAqICAgICAidmFsdWUiOiJ0cnVlIiwNCiAgICAgICAqICAgICAicGF0aCI6Im1pbGl0YXJ5VGltZSIsDQogICAgICAgKiAgICAgInVzZXIiOg0KICAgICAgICogICAgIHsNCiAgICAgICAqICAgICAgICAgInVzZXJJZCI6InRlc3RBZG1pbjEiDQogICAgICAgKiAgICAgfSwNCiAgICAgICAqICAgICAibmFtZXNwYWNlIjoiY29tLm15Y29tcGFueS5Bbm5vdW5jaW5nQ2xvY2siDQogICAgICAgKiB9DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBjYW5ub3QgYmUgc3RvcmVkIGluIHRoZSBkYXRhYmFzZS4NCiAgICAgICAgICAgKiBJZiB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBzcGVjaWZpZWQgYSBkZWZhdWx0IGVycm9yIG1lc3NhZ2Ugd2lsbCBiZSBkaXNwbGF5ZWQuIFRoaXMgZnVuY3Rpb24gaXMgcGFzc2VkDQogICAgICAgICAgICogYmFjayB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBlcnJvcjogU3RyaW5nPGJyPg0KICAgICAgICAgICAqIFRoZSBlcnJvciBtZXNzYWdlPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBTdGF0dXM6IFRoZSBIVFRQIFN0YXR1cyBjb2RlPGJyPg0KICAgICAgICAgICAqIDQwMTogWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyBlbnRpdHkuPGJyPg0KICAgICAgICAgICAqIDUwMDogQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC48YnI+DQogICAgICAgICAgICogNDA0OiBUaGUgcmVxdWVzdGVkIGVudGl0eSB3YXMgbm90IGZvdW5kLjxicj4NCiAgICAgICAgICAgKiA0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uPGJyPg0KICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBmdW5jdGlvbiBvblN1Y2Nlc3MocHJlZil7DQogICAgICAgICAgICogICAgIGFsZXJ0KHByZWYudmFsdWUpOw0KICAgICAgICAgICAqIH0NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIGZ1bmN0aW9uIG9uRmFpbHVyZShlcnJvcixzdGF0dXMpew0KICAgICAgICAgICAqICAgICBhbGVydCgnRXJyb3IgJyArIGVycm9yKTsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoc3RhdHVzKTsNCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB2YXIgdGV4dCA9ICdHZW9yZ2UgV2FzaGluZ3Rvbic7DQogICAgICAgICAgICogT3pvbmUucHJlZi5QcmVmU2VydmVyLnNldFVzZXJQcmVmZXJlbmNlKHsNCiAgICAgICAgICAgKiAgICAgbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLA0KICAgICAgICAgICAqICAgICBuYW1lOidGaXJzdCBQcmVzaWRlbnQnLA0KICAgICAgICAgICAqICAgICB2YWx1ZTp0ZXh0LA0KICAgICAgICAgICAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLA0KICAgICAgICAgICAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlDQogICAgICAgICAgICogfSk7DQogICAgICAgICAgICovDQogICAgICAgICAgc2V0VXNlclByZWZlcmVuY2UgOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgICAgIGNmZy51cmwgPSBfdXJsICsgIi9wcmVmZXJlbmNlLyIgKyBjZmcubmFtZXNwYWNlICsgIi8iICsgY2ZnLm5hbWU7DQogICAgICAgICAgICAgIGlmIChjZmcubWV0aG9kID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnUFVUJzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjZmcuY29udGVudCA9IHsNCiAgICAgICAgICAgICAgICAgICdfbWV0aG9kJzogY2ZnLm1ldGhvZCwNCiAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IGNmZy52YWx1ZQ0KICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgIGlmIChjZmcub25TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICBpZiAoIWNmZy5vbkZhaWx1cmUpIHsgIC8vbXVzdCBlbnN1cmUgdGhlcmUgaXMgYW4gb25mYWlsdXJlIG1ldGhvZCwgYXMgd2UgdXNpbmcgY29udGVudA0KICAgICAgICAgICAgICAgICAgICAgIGNmZy5vbkZhaWx1cmUgPSBmdW5jdGlvbihlcnIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoT3pvbmUudXRpbC5FcnJvck1lc3NhZ2VTdHJpbmcuc2F2ZVVzZXJQcmVmZXJlbmNlcyArICIgOiAiICsgZXJyKTsNCiAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZChjZmcpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgT3pvbmUudXRpbC5UcmFuc3BvcnQuc2VuZEFuZEZvcmdldChjZmcpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfSwNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBEZWxldGVzIGEgdXNlciBwcmVmZXJlbmNlIHdpdGggdGhlIHByb3ZpZGVkIG5hbWVzcGFjZSBhbmQgbmFtZS4NCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lc3BhY2UgVGhlIG5hbWVzcGFjZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlDQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UNCiAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBpcyBzdWNjZXNzZnVsbHkgZGVsZXRlZCBmcm9tIHRoZSBkYXRhYmFzZS4NCiAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzDQogICAgICAgICAgICogZnVuY3Rpb246DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiB7DQogICAgICAgICAgICogICAgICJ2YWx1ZSI6InRydWUiLA0KICAgICAgICAgICAqICAgICAicGF0aCI6Im1pbGl0YXJ5VGltZSIsDQogICAgICAgICAgICogICAgICJ1c2VyIjoNCiAgICAgICAgICAgKiAgICAgew0KICAgICAgICAgICAqICAgICAgICAgInVzZXJJZCI6InRlc3RBZG1pbjEiDQogICAgICAgICAgICogICAgIH0sDQogICAgICAgICAgICogICAgICJuYW1lc3BhY2UiOiJjb20ubXljb21wYW55LkFubm91bmNpbmdDbG9jayINCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBjYW5ub3QgYmUgZGVsZXRlZCBmcm9tIHRoZQ0KICAgICAgICAgICAqIGRhdGFiYXNlIG9yIGlmIHRoZSBwcmVmZXJlbmNlIGRvZXMgbm90IGV4aXN0LiBJZiB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBzcGVjaWZpZWQgYSBkZWZhdWx0IGVycm9yIG1lc3NhZ2Ugd2lsbCBiZQ0KICAgICAgICAgICAqIGRpc3BsYXllZC4gVGhpcyBmdW5jdGlvbiBpcyBwYXNzZWQgYmFjayB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6IDxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogZXJyb3I6IFN0cmluZyA8YnI+DQogICAgICAgICAgICogVGhlIGVycm9yIG1lc3NhZ2UgPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiBTdGF0dXM6IFRoZSBIVFRQIFN0YXR1cyBjb2RlPGJyPg0KICAgICAgICAgICAqIDxicj4NCiAgICAgICAgICAgKiA0MDE6IFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgZW50aXR5Ljxicj4NCiAgICAgICAgICAgKiA1MDA6IEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuPGJyPg0KICAgICAgICAgICAqIDQwNDogVGhlIHVzZXIgcHJlZmVyZW5jZSB3YXMgbm90IGZvdW5kLjxicj4NCiAgICAgICAgICAgKiA0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uIDxicj4NCiAgICAgICAgICAgKiA8YnI+DQogICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgKiBmdW5jdGlvbiBvblN1Y2Nlc3MocHJlZil7DQogICAgICAgICAgICogICAgIGFsZXJ0KHByZWYudmFsdWUpOw0KICAgICAgICAgICAqIH0NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIGZ1bmN0aW9uIG9uRmFpbHVyZShlcnJvcixzdGF0dXMpew0KICAgICAgICAgICAqICAgICBhbGVydCgnRXJyb3IgJyArIGVycm9yKTsNCiAgICAgICAgICAgKiAgICAgYWxlcnQoc3RhdHVzKTsNCiAgICAgICAgICAgKiB9DQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuZGVsZXRlVXNlclByZWZlcmVuY2Uoew0KICAgICAgICAgICAqICAgICBuYW1lc3BhY2U6J2NvbS5jb21wYW55LndpZGdldCcsDQogICAgICAgICAgICogICAgIG5hbWU6J0ZpcnN0IFByZXNpZGVudCcsDQogICAgICAgICAgICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsDQogICAgICAgICAgICogICAgIG9uRmFpbHVyZTpvbkZhaWx1cmUNCiAgICAgICAgICAgKiB9KTsNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBkZWxldGVVc2VyUHJlZmVyZW5jZSA6IGZ1bmN0aW9uIChjZmcpew0KICAgICAgICAgICAgICBjZmcubWV0aG9kID0gIkRFTEVURSI7DQogICAgICAgICAgICAgIC8vaWdvbm9yZSA0MDQgZXJyb3IgY29kZSwgb25TdWNjZXNzIHdpbGwgYmUgY2FsbGVkIHdpdGggbnVsbCBwYXlsb2FkDQogICAgICAgICAgICAgIGNmZy5pZ25vcmVkRXJyb3JDb2RlcyA9IFs0MDRdOw0KICAgICAgICAgICAgICBjZmcucGF0aCA9IGNmZy5uYW1lOw0KICAgICAgICAgICAgICBPem9uZS5wcmVmLlByZWZTZXJ2ZXIuc2V0VXNlclByZWZlcmVuY2UoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQHByaXZhdGUNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXREZXBlbmRlbnRXaWRnZXRzIDogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICcvd2lkZ2V0RGVmaW5pdGlvbi9kZXBlbmRlbnRzJzsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgaWYgKCFjZmcuY29udGVudCkgeyBjZmcuY29udGVudCA9IHt9OyB9DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQHByaXZhdGUNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBnZXREZXBlbmRlbnRQZXJzb25XaWRnZXRzIDogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICcvcGVyc29uV2lkZ2V0RGVmaW5pdGlvbi9kZXBlbmRlbnRzJzsNCiAgICAgICAgICAgICAgY2ZnLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgICAgICAgICAgaWYgKCFjZmcuY29udGVudCkgeyBjZmcuY29udGVudCA9IHt9OyB9DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9LA0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQHByaXZhdGUNCiAgICAgICAgICAgKi8NCiAgICAgICAgICBkZWxldGVXaWRnZXREZWZzIDogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgICAgICBjZmcudXJsID0gX3VybCArICcvd2lkZ2V0RGVmaW5pdGlvbic7DQogICAgICAgICAgICAgIGNmZy5tZXRob2QgPSAnREVMRVRFJzsNCiAgICAgICAgICAgICAgaWYgKCFjZmcuY29udGVudCkgeyBjZmcuY29udGVudCA9IHt9OyB9DQogICAgICAgICAgICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoY2ZnKTsNCiAgICAgICAgICB9DQoNCiAgICAgIH07DQogIH07DQoNCiAgdmFyIGNvbmZpZ1BhcmFtcyA9IE96b25lLnV0aWwucGFyc2VXaW5kb3dOYW1lRGF0YSgpOw0KICB2YXIgdXJsID0gbnVsbDsNCiAgaWYgKGNvbmZpZ1BhcmFtcyAhPSBudWxsICYmIGNvbmZpZ1BhcmFtcy5wcmVmZXJlbmNlTG9jYXRpb24gIT0gbnVsbCkgew0KICAgdXJsID0gY29uZmlnUGFyYW1zLnByZWZlcmVuY2VMb2NhdGlvbjsNCiAgfQ0KICBlbHNlIHsNCiAgICB1cmwgPSBPem9uZS5jb25maWcucHJlZnNMb2NhdGlvbjsNCiAgfQ0KDQogIE96b25lLnByZWYuUHJlZlNlcnZlciA9IE96b25lLnByZWYuUHJlZlNlcnZlcih1cmwpOw0KICBpZih1cmwgPT0gbnVsbCkgew0KICAgIGZvciAodmFyIGZuYW1lIGluIE96b25lLnByZWYuUHJlZlNlcnZlcikgIHsNCiAgICAgIGlmICh0eXBlb2YgT3pvbmUucHJlZi5QcmVmU2VydmVyW2ZuYW1lXSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIC8vZHVtbXlmeQ0KICAgICAgICBPem9uZS5wcmVmLlByZWZTZXJ2ZXJbZm5hbWVdID0gZnVuY3Rpb24oKXt9Ow0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfSh3aW5kb3csIGRvY3VtZW50KSk7DQoKLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLmV2ZW50aW5nID0gT3pvbmUuZXZlbnRpbmcgPyBPem9uZS5ldmVudGluZyA6IHt9Ow0KDQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovL096b25lIEV2ZW50aW5nIFdpZGdldCBPYmplY3QNCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8qKg0KICogQGRlcHJlY2F0ZWQgU2luY2UgT1dGIDMuNy4wICBZb3Ugc2hvdWxkIHVzZSA8YSBocmVmPSIjLmdldEluc3RhbmNlIj5Pem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0SW5zdGFuY2U8L2E+DQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7U3RyaW5nfSB3aWRnZXRSZWxheSBUaGUgVVJMIGZvciB0aGUgd2lkZ2V0IHJlbGF5IGZpbGUuIFRoZSByZWxheSBmaWxlIG11c3QgYmUgc3BlY2lmaWVkIHdpdGggZnVsbCBsb2NhdGlvbiBkZXRhaWxzLCBidXQgd2l0aG91dCBhIGZ1bGx5DQogKiBxdWFsaWZpZWQgcGF0aC4gSW4gdGhlIGNhc2Ugd2hlcmUgdGhlIHJlbGF5IGlzIHJlc2lkaW5nIEAgaHR0cDovL3NlcnZlci9wYXRoL3JlbGF5Lmh0bWwsIHRoZSBwYXRoIHVzZWQgbXVzdCBiZSBmcm9tIHRoZSBjb250ZXh0IHJvb3Qgb2YgdGhlIGxvY2FsDQogKiB3aWRnZXQuIEluIHRoaXMgY2FzZSwgaXQgd291bGQgYmUgL3BhdGgvcmVsYXkuaHRtbC4gIERvIG5vdCBpbmNsdWRlIHRoZSBwcm90b2NvbC4NCiAqIEBwYXJhbSB7RnVuY3Rpb259IGFmdGVySW5pdCAtIGNhbGxiYWNrIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIHRoZSB3aWRnZXQgaXMgZmluaXNoZWQgaW5pdGlhbGl6aW5nLg0KICogQGRlc2NyaXB0aW9uIFRoZSBPem9uZS5ldmVudGluZy5XaWRnZXQgb2JqZWN0IG1hbmFnZXMgdGhlIGV2ZW50aW5nIGZvciBhbiBpbmRpdmlkdWFsIHdpZGdldCAoRGVwcmVjYXRlZCkuICBUaGlzIGNvbnN0cnVjdG9yIGlzIGRlcHJlY2F0ZWQuDQogKiAgWW91IHNob3VsZCB1c2UgPGEgaHJlZj0iIy5nZXRJbnN0YW5jZSI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlPC9hPg0KICogQGV4YW1wbGUNCiAqIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyID0gbmV3IE96b25lLmV2ZW50aW5nLldpZGdldCgNCiAqICdvd2Ytc2FtcGxlLWh0bWwvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJywgZnVuY3Rpb24oKSB7DQogKiANCiAqICAvL3B1dCBjb2RlIGhlcmUgdG8gZXhlY3V0ZSBhZnRlciB3aWRnZXQgaW5pdCAtIHBlcmhhcHMgaW1tZWRpYXRlbHkgcHVibGlzaCB0byBhIGNoYW5uZWwNCiAqIA0KICogfSk7DQogKiBAdGhyb3dzIHtFcnJvcn0gdGhyb3dzIGFuIGVycm9yIHdpdGggYSBtZXNzYWdlIGlmIHdpZGdldCBpbml0aWFsaXphdGlvbiBmYWlscw0KICovDQpPem9uZS5ldmVudGluZy5XaWRnZXQgPSBmdW5jdGlvbih3aWRnZXRSZWxheSwgYWZ0ZXJJbml0KSB7DQogIGlmIChPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgIE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZSA9IHRoaXM7DQogICAgdGhpcy5pc0FmdGVySW5pdCA9IGZhbHNlOw0KICAgIC8vY29ubmVjdCBwYXNzZWQgaW4gZnVuY3Rpb24gdG8gdGhlIGludGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uDQogICAgaWYgKGFmdGVySW5pdCAhPSBudWxsKSB7DQogICAgICBvd2Zkb2pvLmNvbm5lY3QoDQogICAgICAgICAgICAgIHRoaXMsJ2FmdGVySW5pdENhbGxCYWNrJywNCiAgICAgICAgICAgICAgdGhpcyxhZnRlckluaXQpOw0KICAgIH0NCiAgICB0aGlzLnNldFdpZGdldFJlbGF5KHdpZGdldFJlbGF5KTsNCiAgICB0cnkgew0KICAgICAgICB0aGlzLndpZGdldEluaXQoKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICB0aHJvdyAnV2lkZ2V0IHJlbGF5IGluaXQgZmFpbGVkLiBSZWxheWluZyB3aWxsIG5vdCB3b3JrLiBJbm5lciBFeGNlcHRpb246ICcgKyBlcnJvci5uYW1lICsgIjogIiArIGVycm9yLm1lc3NhZ2U7DQogICAgfQ0KICB9DQogIGVsc2Ugew0KICAgIGlmIChhZnRlckluaXQgIT0gbnVsbCkgew0KICAgICAgaWYgKHRoaXMuaXNBZnRlckluaXQgPT09IGZhbHNlKSB7DQogICAgICAgIC8vY29ubmVjdCBwYXNzZWQgaW4gZnVuY3Rpb24gdG8gdGhlIGludGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uDQogICAgICAgIG93ZmRvam8uY29ubmVjdCgNCiAgICAgICAgICAgICAgICB0aGlzLCdhZnRlckluaXRDYWxsQmFjaycsDQogICAgICAgICAgICAgICAgdGhpcyxhZnRlckluaXQpOw0KICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICAvL2FscmVhZHkgaW5pdGlhbGl6ZWQganVzdCBleGVjdXRlIHRoZSBzdXBwbGllZCBjYWxsYmFjaw0KICAgICAgICBzZXRUaW1lb3V0KGFmdGVySW5pdCw1MCk7DQogIH0NCiAgICB9DQogIH0NCiAgcmV0dXJuIE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZTsNCn07DQoNCi8qKg0KICogQGRlc2NyaXB0aW9uIFRoZSBsb2NhdGlvbiBvZiB0aGUgd2lkZ2V0IHJlbGF5IGZpbGUuICBUaGUgcmVsYXkgZmlsZSBzaG91bGQgYmUgZGVmaW5lZA0KICogICBnbG9iYWxseSBmb3IgdGhlIGVudGlyZSB3aWRnZXQgYnkgc2V0dGluZyBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgdG8gdGhlIHJlbGF5IGZpbGUgdXJsLCBpbW1lZGlhdGVseSBhZnRlcg0KICogICBpbmNsdWRpbmcgdGhlIHdpZGdldCBidW5kbGUgamF2YXNjcmlwdC4gIElmIHRoZSByZWxheSBpcyBub3QgZGVmaW5lZCBhdCBhbGwgaXQgaXMgYXNzdW1lZCB0byBiZSBhdA0KICogICAvW2NvbnRleHRdL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbC4gVGhlIHJlbGF5IGZpbGUgbXVzdCBiZSBzcGVjaWZpZWQgd2l0aCBmdWxsIGxvY2F0aW9uIGRldGFpbHMsIGJ1dCB3aXRob3V0IGEgZnVsbHkNCiAqICAgcXVhbGlmaWVkIHBhdGguIEluIHRoZSBjYXNlIHdoZXJlIHRoZSByZWxheSBpcyByZXNpZGluZyBAIGh0dHA6Ly9zZXJ2ZXIvcGF0aC9yZWxheS5odG1sLCB0aGUgcGF0aCB1c2VkIG11c3QgYmUgZnJvbSB0aGUgY29udGV4dCByb290IG9mIHRoZSBsb2NhbA0KICogICB3aWRnZXQuIEluIHRoaXMgY2FzZSwgaXQgd291bGQgYmUgL3BhdGgvcmVsYXkuaHRtbC4gIERvIG5vdCBpbmNsdWRlIHRoZSBwcm90b2NvbC4NCiAqIEBzaW5jZSBPV0YgMy43LjANCiAqIEBleGFtcGxlDQogKiAmbHQ7c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSIuLi8uLi9qcy1taW4vb3dmLXdpZGdldC1taW4uanMiJmd0OyZsdDsvc2NyaXB0Jmd0Ow0KICogJmx0O3NjcmlwdCZndDsNCiAqICAgICAgIC8vVGhlIGxvY2F0aW9uIGlzIGFzc3VtZWQgdG8gYmUgYXQgL1tjb250ZXh0XS9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwgaWYgaXQgaXMgbm90DQogKiAgICAgICAvL3NldCB0aGUgcGF0aCBjb3JyZWN0bHkgYmVsb3cNCiAqICAgICAgIE96b25lLmV2ZW50aW5nLldpZGdldC53aWRnZXRSZWxheVVSTCA9ICcvb3dmL2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbCc7DQogKiAgICAgICAvLy4uLg0KICogJmx0Oy9zY3JpcHQmZ3Q7DQogKg0KICovDQpPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgPSBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgPyBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgOiBudWxsOw0KDQpPem9uZS5ldmVudGluZy5XaWRnZXQucHJvdG90eXBlID0gew0KDQogICAgdmVyc2lvbjogT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi5ldmVudGluZywNCg0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBAcmV0dXJucyBUaGUgVVJMIGZvciB0aGUgd2lkZ2V0UmVsYXkNCiAgICAgKiBAZGVzY3JpcHRpb24gVGhpcyBzaG91bGQgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXJjb2RlLg0KICAgICAqLw0KICAgIGdldFdpZGdldFJlbGF5IDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLndpZGdldFJlbGF5Ow0KICAgIH0sDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIEBwYXJhbSBUaGUgcmVsYXlwYXRoIHRvIHNldC4NCiAgICAgKiBAZGVzY3JpcHRpb24gVGhpcyBzaG91bGQgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXJjb2RlLg0KICAgICAqLw0KICAgIHNldFdpZGdldFJlbGF5IDogZnVuY3Rpb24ocmVsYXlwYXRoKSB7DQogICAgICAvL2lmIG51bGwgZmlndXJlIG91dCBwYXRoDQogICAgICBpZiAocmVsYXlwYXRoID09IG51bGwpIHsNCiAgICAgICAgLy9jaGVjayBpZiBnbG9iYWwgcGF0aCB2YXJpYWJsZSB3YXMgc2V0DQogICAgICAgIGlmIChPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgIT0gbnVsbCkgew0KICAgICAgICAgIHJlbGF5cGF0aCA9IE96b25lLmV2ZW50aW5nLldpZGdldC53aWRnZXRSZWxheVVSTDsNCiAgICAgICAgfQ0KICAgICAgICAvL2Vsc2UgY2FsY3VsYXRlIGEgc3RhbmRhcmQgcmVsYXRpdmUgcGF0aA0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAvL2ZpbmQgcm9vdCBjb250ZXh0IC0gYXNzdW1lIHJlbGF5IGZpbGUgaXMgYXQgLzxjb250ZXh0L2pzL2V2ZW50aW5nL3JwY19yZWxheS51bmNvbXByZXNzZWQuaHRtbA0KICAgICAgICAgIHZhciBiYXNlQ29udGV4dFBhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7DQogICAgICAgICAgdmFyIGJhc2VDb250ZXh0UGF0aFJlZ2V4ID0gL14oXC9bXlwvXStcLykuKiQvaTsNCiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IGJhc2VDb250ZXh0UGF0aC5tYXRjaChiYXNlQ29udGV4dFBhdGhSZWdleCk7DQogICAgICAgICAgaWYgKG1hdGNoZXMgIT0gbnVsbCAmJiBtYXRjaGVzWzFdICE9IG51bGwgJiYgbWF0Y2hlc1sxXS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBiYXNlQ29udGV4dFBhdGggPSBtYXRjaGVzWzFdOw0KICAgICAgICAgICAgLy9yZW1vdmUgZmluYWwgLw0KICAgICAgICAgICAgYmFzZUNvbnRleHRQYXRoID0gYmFzZUNvbnRleHRQYXRoLnN1YnN0cmluZygwLGJhc2VDb250ZXh0UGF0aC5sZW5ndGgtMSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYmFzZUNvbnRleHRQYXRoID0gJyc7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJlbGF5cGF0aCA9IGJhc2VDb250ZXh0UGF0aCArICcvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJzsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy53aWRnZXRSZWxheSA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIChyZWxheXBhdGguY2hhckF0KDApICE9ICcvJz8gKCcvJytyZWxheXBhdGgpIDogcmVsYXlwYXRoKTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBXaWRnZXQgSWQNCiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgd2lkZ2V0SWQgaXMgYSBjb21wbGV4IEpTT04gZW5jb2RlZCBzdHJpbmcgd2hpY2ggaWRlbnRpZmllcyBhIHdpZGdldCBmb3IgRXZlbnRpbmcuDQogICAgICogICBFbWJlZGRlZCBpbiB0aGlzIHN0cmluZyBpcyB0aGUgd2lkZ2V0J3MgdW5pcXVlSWQgYXMgdGhlICdpZCcgYXR0cmlidXRlLiAgVGhlcmUgaXMgb3RoZXIgZGF0YSBpcyBpbiB0aGUgc3RyaW5nDQogICAgICogICB3aGljaCBpcyBuZWVkZWQgZm9yIEV2ZW50aW5nIGFuZCBvdGhlciBBUElzIHRvIGZ1bmN0aW9uIHByb3Blcmx5LiBUaGlzIGNvbXBsZXggd2lkZ2V0SWQgc3RyaW5nIG1heSBiZSB1c2VkIGluDQogICAgICogICB0aGUgPGEgaHJlZj0iI3B1Ymxpc2giPk96b25lLmV2ZW50aW5nLldpZGdldC5wdWJsaXNoPC9hPiBmdW5jdGlvbiB0byBkZXNpZ25hdGUgYSBzcGVjaWZpYyByZWNpcGllbnQgZm9yIGEgbWVzc2FnZS4NCiAgICAgKiAgIEFkZGl0aW9uYWxseSwgb25jZSBzdWJzY3JpYmVkIHRvIGEgY2hhbm5lbCB2aWEgPGEgaHJlZj0iI3N1YnNjcmliZSI+T3pvbmUuZXZlbnRpbmcuV2lkZ2V0LnN1YnNjcmliZTwvYT4gZHVyaW5nIHRoZQ0KICAgICAqICAgcmVjZWlwdCBvZiBhIG1lc3NhZ2UsIHRoZSBzZW5kZXIncyB3aWRnZXRJZCBpcyBtYWRlIGF2YWlsYWJsZSBhcyB0aGUgZmlyc3QgYXJndW1lbnQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKiAvL2RlY29kZSBhbmQgcmV0cmlldmUgdGhlIHdpZGdldCdzIHVuaXF1ZSBpZA0KICAgICAqIHZhciBjb21wbGV4SWRTdHJpbmcgPSB0aGlzLmV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpOw0KICAgICAqIHZhciBjb21wbGV4SWRPYmogPSBvd2Zkb2pvLnRvSnNvbihjb21wbGV4SWRTdHJpbmcpOw0KICAgICAqDQogICAgICogLy9jb21wbGV4SWRPYmogd2lsbCBsb29rIGxpa2UNCiAgICAgKiAvLyB7DQogICAgICogLy8gIC8vd2lkZ2V0J3MgdW5pcXVlSWQNCiAgICAgKiAvLyAgaWQ6IjQ5Y2QyMWYwLTMxMTAtODEyMS1kOTA1LTE4ZmZhODFiNDQyZSINCiAgICAgKiAvLyB9DQogICAgICoNCiAgICAgKiAvL2dldCBXaWRnZXQncyB1bmlxdWVJZA0KICAgICAqIGFsZXJ0KCd3aWRnZXQgaWQgPSAnICsgY29tcGxleElkT2JqLmlkKTsNCiAgICAgKi8NCiAgICBnZXRXaWRnZXRJZCA6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy53aWRnZXRJZDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBAcmV0dXJucyBUaGUgY29udGFpbmVyUmVsYXkNCiAgICAgKiBAZGVzY3JpcHRpb24gVGhpcyBzaG91bGQgbm90IGJlIGNhbGxlZCBmcm9tIHVzZXJjb2RlLg0KICAgICAqLw0KICAgIGdldENvbnRhaW5lclJlbGF5IDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lclJlbGF5Ow0KICAgIH0sDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYnkgdGhlIFdpZGdldCdzIGNvbnN0cnVjdG9yLiBJdCBzaG91bGQgbmV2ZXIgYmUgY2FsbGVkIGZyb20gdXNlciBjb2RlLg0KICAgICAqLw0KICAgIHdpZGdldEluaXQgOiBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHF1ZXJ5SGFzaCA9IHt9Ow0KICAgICAgICB2YXIganNvblN0cmluZyA9IG51bGw7DQoNCiAgICAgICAgLy9jaGVjayBmb3IgZGF0YSBpbiB3aW5kb3cubmFtZQ0KICAgICAgICB2YXIgY29uZmlnUGFyYW1zID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCk7DQogICAgICAgIGlmIChjb25maWdQYXJhbXMgIT0gbnVsbCkgew0KDQogICAgICAgICAgLy90aGUgaWQgaXMgdGhlIHdob2xlIGNvbnRlbnRzIG9mIHRoZSB3aW5kb3cubmFtZQ0KICAgICAgICAgIHRoaXMud2lkZ2V0SWQgPSAne1wiaWRcIjpcIicgKyBjb25maWdQYXJhbXMuaWQgKyAnXCJ9JzsNCiAgICAgICAgICB0aGlzLmxvY2tlZCA9IGNvbmZpZ1BhcmFtcy5sb2NrZWQ7DQoNCiAgICAgICAgICAvL2VtYmVkZGVkIGluIHRoZSBpZCBpcyB0aGUgcmVsYXkNCiAgICAgICAgICB0aGlzLmNvbnRhaW5lclJlbGF5ID0gY29uZmlnUGFyYW1zLnJlbGF5VXJsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIHRocm93IHsNCiAgICAgICAgICAgIG5hbWUgOidXaWRnZXRJbml0RXhjZXB0aW9uJywNCiAgICAgICAgICAgIG1lc3NhZ2UgOidUaGUgY2FsbCB0byBjb250YWluZXJfaW5pdCBmYWlsZWQuIElubmVyIEV4Y2VwdGlvbjogJw0KICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICBnYWRnZXRzLnJwYy5zZXRSZWxheVVybCgiLi4iLCB0aGlzLmNvbnRhaW5lclJlbGF5LCBmYWxzZSwgdHJ1ZSk7DQoNCiAgICAgICAgDQogICAgICAgIHZhciBvbkNsaWNrSGFuZGxlciwNCiAgICAgICAgICAgIG9uS2V5RG93bkhhbmRsZXI7DQoNCiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGVXaWRnZXQoKSB7DQoNCiAgICAgICAgICAgICB2YXIgY29uZmlnID0gew0KICAgICAgICAgICAgICAgICBmbjogImFjdGl2YXRlV2lkZ2V0IiwNCiAgICAgICAgICAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgICAgICAgICAgIGd1aWQ6IGNvbmZpZ1BhcmFtcy5pZCwNCiAgICAgICAgICAgICAgICAgICAgZm9jdXNJZnJhbWU6IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGRvY3VtZW50LmJvZHkNCiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICB2YXIgc3RhdGVDaGFubmVsID0gJ19XSURHRVRfU1RBVEVfQ0hBTk5FTF8nICsgY29uZmlnUGFyYW1zLmlkOw0KICAgICAgICAgICAgIGlmICghdGhpcy5kaXNhYmxlQWN0aXZhdGVXaWRnZXQpIHsNCiAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc3RhdGVDaGFubmVsLCBudWxsLCB0aGlzLndpZGdldElkLCBjb25maWcpOw0KICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUFjdGl2YXRlV2lkZ2V0ID0gZmFsc2U7DQogICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9yZWdpc3RlciBmb3IgYWZ0ZXJfY29udGFpbmVyX2luaXQNCiAgICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoImFmdGVyX2NvbnRhaW5lcl9pbml0Iiwgb3dmZG9qby5oaXRjaCh0aGlzLGZ1bmN0aW9uKCkgew0KDQogICAgICAgICAgICBnYWRnZXRzLnJwYy51bnJlZ2lzdGVyKCJhZnRlcl9jb250YWluZXJfaW5pdCIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2F0dGFjaCBtb3VzZSBjbGljayBhbmQga2V5ZG93biBsaXN0ZW5lciB0byBzZW5kIGFjdGl2YXRlIGNhbGxzIGZvciB0aGUgd2lkZ2V0DQogICAgICAgICAgICBpZighb25DbGlja0hhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICBvbkNsaWNrSGFuZGxlciA9IG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ2NsaWNrJywgb3dmZG9qby5oaXRjaCh0aGlzLCBhY3RpdmF0ZVdpZGdldCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb25LZXlEb3duSGFuZGxlcikgew0KICAgICAgICAgICAgICAgIG9uS2V5RG93bkhhbmRsZXIgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbmtleXVwJywgb3dmZG9qby5oaXRjaCh0aGlzLCBhY3RpdmF0ZVdpZGdldCkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvL2V4ZWN1dGUgY2FsbGJhY2sNCiAgICAgICAgICAgIHRoaXMuYWZ0ZXJDb250YWluZXJJbml0KCk7DQoNCiAgICAgICAgfSkpOw0KDQogICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJfd2lkZ2V0X2FjdGl2YXRlZCIsIG93ZmRvam8uaGl0Y2godGhpcyxmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIC8vY29uc29sZS5sb2coIl93aWRnZXRfYWN0aXZhdGVkID0+ICIgKyBjb25maWdQYXJhbXMuaWQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihvbkNsaWNrSGFuZGxlcikgew0KICAgICAgICAgICAgICAgIG93ZmRvam8uZGlzY29ubmVjdChvbkNsaWNrSGFuZGxlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZihvbkNsaWNrSGFuZGxlcikgew0KICAgICAgICAgICAgICAgIG93ZmRvam8uZGlzY29ubmVjdChvbktleURvd25IYW5kbGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgb25DbGlja0hhbmRsZXIgPSBudWxsOw0KICAgICAgICAgICAgb25LZXlEb3duSGFuZGxlciA9IG51bGw7DQoNCiAgICAgICAgfSkpOw0KDQogICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJfd2lkZ2V0X2RlYWN0aXZhdGVkIiwgb3dmZG9qby5oaXRjaCh0aGlzLGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiX3dpZGdldF9kZWFjdGl2YXRlZCA9PiAiICsgY29uZmlnUGFyYW1zLmlkKTsNCg0KICAgICAgICAgICAgaWYoIW9uQ2xpY2tIYW5kbGVyKSB7DQogICAgICAgICAgICAgICAgb25DbGlja0hhbmRsZXIgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdjbGljaycsIG93ZmRvam8uaGl0Y2godGhpcywgYWN0aXZhdGVXaWRnZXQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmKCFvbktleURvd25IYW5kbGVyKSB7DQogICAgICAgICAgICAgICAgb25LZXlEb3duSGFuZGxlciA9IG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ29ua2V5dXAnLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIGFjdGl2YXRlV2lkZ2V0KSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pKTsNCg0KICAgICAgICAvL3JlZ2lzdGVyIHdpdGggY29udGFpbmVyDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgaWRTdHJpbmcgPSAne1wiaWRcIjpcIicgKyBjb25maWdQYXJhbXMuaWQgKyAnXCJ9JzsNCiAgICAgICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgICAgICBpZDogaWRTdHJpbmcsDQogICAgICAgICAgICAgIHZlcnNpb246IHRoaXMudmVyc2lvbiwNCiAgICAgICAgICAgICAgdXNlTXVsdGlQYXJ0TWVzc2FnZXNGb3JJRlBDOiB0cnVlLA0KICAgICAgICAgICAgICByZWxheVVybDogdGhpcy53aWRnZXRSZWxheQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgaWYgKE96b25lLnV0aWwucGFnZUxvYWQubG9hZFRpbWUgIT0gbnVsbCAmJiBPem9uZS51dGlsLnBhZ2VMb2FkLmF1dG9TZW5kKSB7DQogICAgICAgICAgICAgIGRhdGEubG9hZFRpbWUgPSBPem9uZS51dGlsLnBhZ2VMb2FkLmxvYWRUaW1lOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvL2pzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICAgICAganNvblN0cmluZyA9IE96b25lLnV0aWwudG9TdHJpbmcoZGF0YSk7DQogICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdjb250YWluZXJfaW5pdCcsIG51bGwsIGlkU3RyaW5nLCBqc29uU3RyaW5nKTsNCg0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgdGhyb3cgew0KICAgICAgICAgICAgICAgIG5hbWUgOidXaWRnZXRJbml0RXhjZXB0aW9uJywNCiAgICAgICAgICAgICAgICBtZXNzYWdlIDonVGhlIGNhbGwgdG8gY29udGFpbmVyX2luaXQgZmFpbGVkLiBJbm5lciBFeGNlcHRpb246ICcgKyBlcnJvcg0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBpc0luaXRpYWxpemVkOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmlzQWZ0ZXJJbml0Ow0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogZGVmYXVsdCBub29wIGNhbGxiYWNrDQogICAgICovDQogICAgYWZ0ZXJJbml0Q2FsbEJhY2s6IGZ1bmN0aW9uKHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcikgew0KDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBAZGVzY3JpcHRpb24gVGhpcyBtZXRob2QgaXMgY2FsbGVkIGJ5IHRoZSBXaWRnZXQncyBjb25zdHJ1Y3Rvci4gSXQgc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCBmcm9tIHVzZXIgY29kZS4NCiAgICAgKi8NCiAgICAgYWZ0ZXJDb250YWluZXJJbml0OiBmdW5jdGlvbigpIHsNCiAgICAgICB0aGlzLmlzQWZ0ZXJJbml0ID0gdHJ1ZTsNCiAgICAgICBpZiAodGhpcy5hZnRlckluaXRDYWxsQmFjayAhPSBudWxsKSB7DQogICAgICAgICB0aGlzLmFmdGVySW5pdENhbGxCYWNrKHRoaXMpOw0KICAgICAgIH0NCiAgICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKi8NCiAgICByZWdpc3RlckhhbmRsZXIgOiBmdW5jdGlvbihoYW5kbGVyTmFtZSwgaGFuZGxlck9iamVjdCkgew0KICAgICAgLy9TaW1wbGUgd3JhcHBlciBmb3IgbWFuYWdlciBvYmplY3RzIHRvIHJlZ2lzdGVyIGhhbmRsZXIgZnVuY3Rpb25zDQogICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihoYW5kbGVyTmFtZSwgaGFuZGxlck9iamVjdCk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBXcmFwcyBnYWRnZXRzLnJwYy5jYWxsLg0KICAgICAqLw0KICAgIHNlbmQ6ZnVuY3Rpb24gKCkgew0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsLmFwcGx5KGdhZGdldHMucnBjLCBhcmd1bWVudHMpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gU3Vic2NyaWJlIHRvIGEgbmFtZWQgY2hhbm5lbCBmb3IgYSBnaXZlbiBmdW5jdGlvbi4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2hhbm5lbE5hbWUgVGhlIGNoYW5uZWwgdG8gc3Vic2NyaWJlIHRvLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIGZ1bmN0aW9uIHlvdSB3aXNoIHRvIHN1YnNjcmliZS4gIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2l0aCB0aHJlZQ0KICAgICAqICAgYXJndW1lbnRzOiBzZW5kZXIsIG1zZywgY2hhbm5lbC4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2hhbmRsZXIuc2VuZGVyXSBUaGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBpZCBvZiB0aGUgc2VuZGVyDQogICAgICogICBvZiB0aGUgbWVzc2FnZS4gIFNlZSA8YSBocmVmPSIjZ2V0V2lkZ2V0SWQiPk96b25lLmV2ZW50aW5nLldpZGdldC5nZXRXaWRnZXRJZDwvYT4NCiAgICAgKiAgIGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoaXMgaWQuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtoYW5kbGVyLm1zZ10gVGhlIHNlY29uZCBhcmd1bWVudCBwYXNzZWQgdG8gdGhlIGhhbmRsZXIgZnVuY3Rpb24gaXMgdGhlIG1lc3NhZ2UgaXRzZWxmLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaGFuZGxlci5jaGFubmVsXSBUaGUgdGhpcmQgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBjaGFubmVsIHRoZSBtZXNzYWdlIHdhcw0KICAgICAqICAgcHVibGlzaGVkIG9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgPSBPem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0SW5zdGFuY2UoKTsNCiAgICAgKiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUoIkNsb2NrQ2hhbm5lbCIsIHRoaXMudXBkYXRlKTsNCiAgICAgKg0KICAgICAqIHZhciB1cGRhdGUgPSBmdW5jdGlvbihzZW5kZXIsIG1zZywgY2hhbm5lbCkgew0KICAgICAqICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudFRpbWUnKS5pbm5lckhUTUwgPSBtc2c7DQogICAgICogfQ0KICAgICAqDQogICAgICovDQogICAgc3Vic2NyaWJlIDogZnVuY3Rpb24oY2hhbm5lbE5hbWUsIGhhbmRsZXIpIHsNCiAgICAgICAgZ2FkZ2V0cy5wdWJzdWIuc3Vic2NyaWJlKGNoYW5uZWxOYW1lLCBoYW5kbGVyKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gVW5zdWJzY3JpYmUgdG8gYSBuYW1lZCBjaGFubmVsDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBjaGFubmVsIHRvIHVuc3Vic2NyaWJlIHRvLg0KICAgICAqIEBleGFtcGxlDQogICAgICogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIudW5zdWJzY3JpYmUoIkNsb2NrQ2hhbm5lbCIpOw0KICAgICAqLw0KICAgIHVuc3Vic2NyaWJlIDogZnVuY3Rpb24oY2hhbm5lbE5hbWUpIHsNCiAgICAgICAgZ2FkZ2V0cy5wdWJzdWIudW5zdWJzY3JpYmUoY2hhbm5lbE5hbWUpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBkZXNjcmlwdGlvbiBQdWJsaXNoIGEgbWVzc2FnZSB0byBhIGdpdmVuIGNoYW5uZWwNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2hhbm5lbE5hbWUgVGhlIG5hbWUgb2YgdGhlIGNoYW5uZWwgdG8gcHVibGlzaCB0bw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHB1Ymxpc2ggdG8gdGhlIGNoYW5uZWwuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtkZXN0XSBUaGUgaWQgb2YgYSBwYXJ0aWN1bGFyIGRlc3RpbmF0aW9uLiAgRGVmYXVsdHMgdG8gbnVsbCB3aGljaCBzZW5kcyB0byBhbGwNCiAgICAgKiAgICAgICAgICAgICAgICAgc3Vic2NyaWJlcnMgb24gdGhlIGNoYW5uZWwuICBTZWUgPGEgaHJlZj0iI2dldFdpZGdldElkIj5Pem9uZS5ldmVudGluZy5XaWRnZXQuZ2V0V2lkZ2V0SWQ8L2E+DQogICAgICogICAgICAgICAgICAgICAgIGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoZSBpZC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyID0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlKCk7DQogICAgICogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucHVibGlzaCgiQ2xvY2tDaGFubmVsIiwgY3VycmVudFRpbWVTdHJpbmcpOw0KICAgICAqLw0KICAgIHB1Ymxpc2ggOiBmdW5jdGlvbihjaGFubmVsTmFtZSwgbWVzc2FnZSwgZGVzdCkgew0KICAgICAgICBnYWRnZXRzLnB1YnN1Yi5wdWJsaXNoKGNoYW5uZWxOYW1lLCBtZXNzYWdlLCBkZXN0KTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KfTsNCg0KLyoqDQogKiBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLmV2ZW50aW5nLldpZGdldCBTaW5nbGV0b24gaW5zdGFuY2UNCiAqIEBwYXJhbSB7RnVuY3Rpb259IFthZnRlckluaXRdIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIHRoZSBPem9uZS5ldmVudGluZy5XaWRnZXQgc2luZ2xldG9uIGlzIGluaXRpYWxpemVkDQogKiBAcGFyYW0ge1N0cmluZ30gW3dpZGdldFJlbGF5XSBPcHRpb25hbGx5IHJlZGVmaW5lIHRoZSBsb2NhdGlvbiBvZiB0aGUgcmVsYXkgZmlsZS4gIFRoZSByZWxheSBmaWxlIHNob3VsZCBiZSBkZWZpbmVkDQogKiAgIGdsb2JhbGx5IGZvciB0aGUgZW50aXJlIHdpZGdldCBieSBzZXR0aW5nIE96b25lLmV2ZW50aW5nLldpZGdldC53aWRnZXRSZWxheVVSTCB0byB0aGUgcmVsYXkgZmlsZSB1cmwsIGltbWVkaWF0ZWx5IGFmdGVyDQogKiAgIGluY2x1ZGluZyB0aGUgd2lkZ2V0IGJ1bmRsZSBqYXZhc2NyaXB0LiAgSWYgdGhlIHJlbGF5IGlzIG5vdCBkZWZpbmVkIGF0IGFsbCBpdCBpcyBhc3N1bWVkIHRvIGJlIGF0DQogKiAgIC9bY29udGV4dF0vanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sLiAgVGhlIHJlbGF5IGZpbGUgbXVzdCBiZSBzcGVjaWZpZWQgd2l0aCBmdWxsIGxvY2F0aW9uIGRldGFpbHMsIGJ1dCB3aXRob3V0IGEgZnVsbHkNCiAqICAgcXVhbGlmaWVkIHBhdGguIEluIHRoZSBjYXNlIHdoZXJlIHRoZSByZWxheSBpcyByZXNpZGluZyBAIGh0dHA6Ly9zZXJ2ZXIvcGF0aC9yZWxheS5odG1sLCB0aGUgcGF0aCB1c2VkIG11c3QgYmUgZnJvbSB0aGUgY29udGV4dCByb290IG9mIHRoZSBsb2NhbA0KICogICB3aWRnZXQuIEluIHRoaXMgY2FzZSwgaXQgd291bGQgYmUgL3BhdGgvcmVsYXkuaHRtbC4gIERvIG5vdCBpbmNsdWRlIHRoZSBwcm90b2NvbC4NCiAqIEBzaW5jZSBPV0YgMy43LjANCiAqIEB0aHJvd3Mge0Vycm9yfSB0aHJvd3MgYW4gZXJyb3Igd2l0aCBhIG1lc3NhZ2UgaWYgd2lkZ2V0IGluaXRpYWxpemF0aW9uIGZhaWxzDQogKiBAZXhhbXBsZQ0KICogJmx0O3NjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iLi4vLi4vanMtbWluL293Zi13aWRnZXQtbWluLmpzIiZndDsmbHQ7L3NjcmlwdCZndDsNCiAqICZsdDtzY3JpcHQmZ3Q7DQogKiAgICAgICAvL1RoZSBsb2NhdGlvbiBpcyBhc3N1bWVkIHRvIGJlIGF0IC9bY29udGV4dF0vanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sIGlmIGl0IGlzIG5vdA0KICogICAgICAgLy9zZXQgdGhlIHBhdGggY29ycmVjdGx5IGJlbG93DQogKiAgICAgICBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgPSAnL293Zi9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwnOw0KICoNCiAqICAgICAgIG93ZmRvam8uYWRkT25Mb2FkKGZ1bmN0aW9uKCkgew0KICogICAgICAgICAvL2dldCB3aWRnZXQgaW5zdGFuY2UNCiAqICAgICAgICAgdmFyIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IE96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZSgpOw0KICogICAgICAgICAvL2RvIHNvbWV0aGluZw0KICogICAgICAgICB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucHVibGlzaCgiRm9vQ2hhbm5lbCIsICdtZXNzYWdlIGdvZXMgaGVyZScpOw0KICogICAgICAgfSk7DQogKiAmbHQ7L3NjcmlwdCZndDsNCiAqLw0KT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlID0gZnVuY3Rpb24oYWZ0ZXJJbml0LCB3aWRnZXRSZWxheSkgew0KICBpZiAoT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlID09IG51bGwpIHsNCiAgICBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UgPSBuZXcgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0KHdpZGdldFJlbGF5LCBhZnRlckluaXQpOw0KICB9DQogIGVsc2Ugew0KICAgIGlmIChhZnRlckluaXQgIT0gbnVsbCkgew0KICAgICAgaWYgKCFPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2UuaXNBZnRlckluaXQpIHsNCiAgICAgICAgLy9jb25uZWN0IHBhc3NlZCBpbiBmdW5jdGlvbiB0byB0aGUgaW50ZXJuYWwgY2FsbGJhY2sgZnVuY3Rpb24NCiAgICAgICAgb3dmZG9qby5jb25uZWN0KA0KICAgICAgICAgICAgICAgIE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZSwnYWZ0ZXJJbml0Q2FsbEJhY2snLA0KICAgICAgICAgICAgICAgIE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZSxhZnRlckluaXQpOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIC8vYWxyZWFkeSBpbml0aWFsaXplZCBqdXN0IGV4ZWN1dGUgdGhlIHN1cHBsaWVkIGNhbGxiYWNrDQogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICBhZnRlckluaXQoT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlKQ0KICAgICAgfSw1MCk7DQogICAgfQ0KICB9DQogIH0NCiAgcmV0dXJuIE96b25lLmV2ZW50aW5nLldpZGdldC5pbnN0YW5jZTsNCn07DQoKLyoqCiAqIEBpZ25vcmUKICogQG5hbWVzcGFjZQogKiBAc2luY2UgT1dGIDUuMAogKi8KT1dGID0gd2luZG93Lk9XRiA/IHdpbmRvdy5PV0YgOiB7fTsKCihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CgogICAgLyoqCiAgICAgKiBAbmFtZXNwYWNlCiAgICAgKi8KICAgIE9XRi5JbnRlbnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBJTlRFTlRTX1NFUlZJQ0VfTkFNRSA9ICdfaW50ZW50cycsCiAgICAgICAgICAgIElOVEVOVFNfU0VSVklDRV9SRUNFSVZFX05BTUUgPSAnX2ludGVudHNfcmVjZWl2ZScsCiAgICAgICAgICAgIGludGVudFJlY2VpdmVyTWFwID0ge307CgogICAgICAgIHJldHVybiAvKiogQGxlbmRzIE9XRi5JbnRlbnRzICovIHsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBTdGFydHMgYW4gSW50ZW50LiAgVGhpcyB3aWxsIHNlbmQgdGhlIGludGVudCBhbmQgZGF0YSB0byBvbmUgb3IgbW9yZSB3aWRnZXRzLiAgSWYgdGhpcyBsYXVuY2hlcyBhIHdpZGdldCwgaXQgc2V0cyB0aGUgbGF1bmNoIGRhdGEgdG8gdGhlIEpTT04gc3RyaW5nIHsgaW50ZW50czogdHJ1ZSB9LgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaW50ZW50IE9iamVjdCByZXByZXNlbnRpbmcgdGhlIEludGVudAogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW50ZW50LmFjdGlvbiBOYW1lIG9mIHRoZSBJbnRlbnQKICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGludGVudC5kYXRhVHlwZSBEZXNjcmliZXMgdGhlIGRhdGEgdGhhdCB3aWxsIGJlIHNlbnQgd2l0aCB0aGUgaW50ZW50LiAgSXQgaXMgcmVjb21tZW5kZWQKICAgICAgICAgICAgICogICB0aGF0IHRoaXMgYmUgYSBNSU1FIHR5cGUuCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIERhdGEgdG8gYmUgc2VudCB3aXRoIHRoZSBpbnRlbnQKICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBGdW5jdGlvbiB0byBiZSBleGVjdXRlZCBvbmNlIHRoZSBJbnRlbnQgaGFzIGJlZW4gc2VudCB0byBhIGRlc3RpbmF0aW9uIHdpZGdldAogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBbaGFuZGxlci5kZXN0XSBUaGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBpZChzKSBvZiB0aGUgcmVjaXBpZW50KHMpCiAgICAgICAgICAgICAqICAgb2YgdGhlIG1lc3NhZ2UuIFNlZSA8YSBocmVmPSIuL09XRi5odG1sIy5nZXRJZnJhbWVJZCI+T1dGLmdldElmcmFtZUlkPC9hPgogICAgICAgICAgICAgKiAgIGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoaXMgaWQuCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IFtkZXN0XSBFeHBsaWNpdGx5IGRlZmluZSB3aGljaCB3aWRnZXRzIHdpbGwgZ2V0IHRoaXMgaW50ZW50IHVzaW5nIFdpZGdldCBQcm94aWVzCiAgICAgICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICAgICAqIE9XRi5JbnRlbnRzLnN0YXJ0QWN0aXZpdHkoCiAgICAgICAgICAgICAqICAgewogICAgICAgICAgICAgKiAgICBhY3Rpb246ICdQbG90JywKICAgICAgICAgICAgICogICAgZGF0YVR5cGU6ICdhcHBsaWNhdGlvbi92bmQub3dmLmxhdGxvbicKICAgICAgICAgICAgICogICB9LAogICAgICAgICAgICAgKiAgIHsKICAgICAgICAgICAgICogICAgIGxhdDogMCwKICAgICAgICAgICAgICogICAgIGxvbjogMAogICAgICAgICAgICAgKiAgIH0sCiAgICAgICAgICAgICAqICAgZnVuY3Rpb24oZGVzdCkgewogICAgICAgICAgICAgKiAgICAgLy9kZXN0IGlzIGFuIGFycmF5IG9mIGRlc3RpbmF0aW9uIHdpZGdldCBwcm94aWVzCiAgICAgICAgICAgICAqICAgfQogICAgICAgICAgICAgKiApOwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc3RhcnRBY3Rpdml0eTpmdW5jdGlvbiAoaW50ZW50LCBkYXRhLCBoYW5kbGVyLCBkZXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgZGVzdElkcyA9IFtdOwoKICAgICAgICAgICAgICAgIC8vcHVsbCBkZXN0SWRzIGZyb20gYW55IHByb3hpZXMgcGFzc2VkIGluCiAgICAgICAgICAgICAgICBpZiAoZGVzdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RJZHMucHVzaChkZXN0W2ldLmlkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBJTlRFTlRTX1NFUlZJQ0VfTkFNRSwKICAgICAgICAgICAgICAgICAgICAvL2NhbGxiYWNrIGZvciB3aGVuIGFuIGludGVudCBoYXMgcmVhY2hlZCB0aGUgZGVzdGluYXRpb24gd2lkZ2V0KHMpCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGlkcykgewogICAgICAgICAgICAgICAgICAgICAgICAvL2V4ZWMgaGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlc3RXaWRnZXRJZHMgPSBbXS5jb25jYXQoaWRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRlc3RXaWRnZXRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9nZXQgZGVzdCB3aWRnZXQgcHJveHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpZGdldCA9IE96b25lLmV2ZW50aW5nLmdldFdpZGdldFByb3h5TWFwKClbZGVzdFdpZGdldElkc107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKHdpZGdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0cy5sZW5ndGggPT0gZGVzdFdpZGdldElkcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKHdpZGdldHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgbnVsbCBjcmVhdGUgbmV3IHdpZGdldCBwcm94eQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE96b25lLmV2ZW50aW5nLmltcG9ydFdpZGdldChkZXN0V2lkZ2V0SWRzW2ldLCBmdW5jdGlvbiAod3Byb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKHdwcm94eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldHMubGVuZ3RoID09IGRlc3RXaWRnZXRJZHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIod2lkZ2V0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXN0V2lkZ2V0SWRzLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ubyBkZXN0IGlkcyB3ZXJlIHNlbnQgc2VuZCBiYWNrIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIod2lkZ2V0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ubyBkZXN0IGlkcyB3ZXJlIHNlbnQgc2VuZCBiYWNrIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcih3aWRnZXRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIE9XRi5nZXRJZnJhbWVJZCgpLCBpbnRlbnQsIGRhdGEsIGRlc3RJZHMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlZ2lzdGVyIHRvIHJlY2VpdmUgYW4gSW50ZW50CiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnRlbnQgT2JqZWN0IHJlcHJlc2VudGluZyB0aGUgSW50ZW50CiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpbnRlbnQuYWN0aW9uIE5hbWUgb2YgdGhlIEludGVudAogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW50ZW50LmRhdGFUeXBlIERlc2NyaWJlcyB0aGUgZGF0YSB0aGF0IHdpbGwgYmUgc2VudCB3aXRoIHRoZSBpbnRlbnQuICBJdCBpcyByZWNvbW1lbmRlZAogICAgICAgICAgICAgKiAgIHRoYXQgdGhpcyBiZSBhIE1JTUUgdHlwZS4KICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBGdW5jdGlvbiB0byBiZSBleGVjdXRlZCBvbmNlIGFuIEludGVudCBoYXMgYmVlbiByZWNlaXZlZAogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2hhbmRsZXIuc2VuZGVyXSBUaGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBpZCBvZiB0aGUgc2VuZGVyCiAgICAgICAgICAgICAqICAgb2YgdGhlIG1lc3NhZ2UuIFNlZSA8YSBocmVmPSIuL09XRi5odG1sIy5nZXRJZnJhbWVJZCI+T1dGLmdldElmcmFtZUlkPC9hPgogICAgICAgICAgICAgKiAgIGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoaXMgaWQuCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbaGFuZGxlci5pbnRlbnRdIFRoZSBzZWNvbmQgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBpbnRlbnQgaXRzZWxmLgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW2hhbmRsZXIuZGF0YV0gVGhlIHRoaXJkIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgaW50ZW50IGRhdGEuCiAgICAgICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICAgICAqIE9XRi5JbnRlbnRzLnJlY2VpdmUoCiAgICAgICAgICAgICAqICAgewogICAgICAgICAgICAgKiAgICAgYWN0aW9uOiAnUGxvdCcsCiAgICAgICAgICAgICAqICAgIGRhdGFUeXBlOiAnYXBwbGljYXRpb24vdm5kLm93Zi5sYXRsb24nCiAgICAgICAgICAgICAqICAgfSwKICAgICAgICAgICAgICogICBmdW5jdGlvbihzZW5kZXIsaW50ZW50LCBkYXRhKSB7CiAgICAgICAgICAgICAqICAgICAvL2RvIHNvbWV0aGluZyB3aXRoIHRoZSBkYXRhCiAgICAgICAgICAgICAqICAgfQogICAgICAgICAgICAgKiApOwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgcmVjZWl2ZTpmdW5jdGlvbiAoaW50ZW50LCBoYW5kbGVyKSB7CiAgICAgICAgICAgICAgICB2YXIgaW50ZW50S2V5ID0gb3dmZG9qby50b0pzb24oaW50ZW50KTsKCiAgICAgICAgICAgICAgICAvL3NhdmUgYSBsaXN0IG9mIGhhbmRsZXJzIHBlciBpbnRlbnQKICAgICAgICAgICAgICAgIGludGVudFJlY2VpdmVyTWFwW2ludGVudEtleV0gPSBoYW5kbGVyOwoKICAgICAgICAgICAgICAgIC8vcmVnaXN0ZXIgd2l0aCBzaGluZGlnIGZvciB3aGVuIHRoZSBpbnRlbnQgbWVzc2FnZSBpcyBzZW50CiAgICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihJTlRFTlRTX1NFUlZJQ0VfTkFNRSwgZnVuY3Rpb24oc2VuZGVyLCBpbnRlbnQsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVudEtleSA9IG93ZmRvam8udG9Kc29uKGludGVudCk7CgogICAgICAgICAgICAgICAgICAgIC8vZXhlY3V0ZSB0aGUgaGFuZGxlciB0aGF0IG1hdGNoZXMgdGhlIGludGVudAogICAgICAgICAgICAgICAgICAgIHZhciByZWNlaXZlckhhbmRsZXIgPSBpbnRlbnRSZWNlaXZlck1hcFtpbnRlbnRLZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnRlbnRSZWNlaXZlck1hcFtpbnRlbnRLZXldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJIYW5kbGVyLmNhbGwodGhpcywgc2VuZGVyLCBpbnRlbnQsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgSU5URU5UU19TRVJWSUNFX1JFQ0VJVkVfTkFNRSwgbnVsbCwgaW50ZW50LCBPV0YuZ2V0SWZyYW1lSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgIH0oKTsKCgp9KHdpbmRvdywgZG9jdW1lbnQpKTsKLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLmNocm9tZSA9IE96b25lLmNocm9tZSA/IE96b25lLmNocm9tZSA6IHt9Ow0KDQovKioNCiAqICBAZGVwcmVjYXRlZCBTaW5jZSBPV0YgMy43LjAgIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUuZ2V0SW5zdGFuY2U8L2E+DQogKiAgQGNvbnN0cnVjdG9yICB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgLSBPem9uZS5ldmVudGluZy5XaWRnZXQgb2JqZWN0DQogKiAgQHBhcmFtICB7T2JqZWN0fSBjb25maWcgLSBjb25maWcgb2JqZWN0IHdpdGggcGFyYW1ldGVycw0KICogIEBwYXJhbSAge096b25lLmV2ZW50aW5nLldpZGdldH0gY29uZmlnLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciAtIHdpZGdldCBldmVudGluZyBvYmplY3Qgd2hpY2ggaGFuZGxlcyBldmVudGluZyBmb3IgdGhlIHdpZGdldA0KICogIEBkZXNjcmlwdGlvbiBUaGlzIG9iamVjdCBhbGxvd3MgYSB3aWRnZXQgdG8gbW9kaWZ5IHRoZSBidXR0b24gY29udGFpbmVkIGluIHRoZSB3aWRnZXQgaGVhZGVyICh0aGUgY2hyb21lKS4gIA0KICogIFRvIGRvIHNvIGl0IHJlcXVpcmVzIGEgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiAgQGV4YW1wbGUNCiAqICAgIHRoaXMud2MgPSBuZXcgT3pvbmUuY2hyb21lLldpZGdldENocm9tZSh7DQogKiAgICAgICAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogICAgfSk7DQogKg0KICogQHRocm93cyB7RXJyb3J9IHRocm93cyBhbiBlcnJvciB3aXRoIGEgbWVzc2FnZSBpZiB3aWRnZXQgaW5pdGlhbGl6YXRpb24gZmFpbHMNCiAqLw0KT3pvbmUuY2hyb21lLldpZGdldENocm9tZSA9IGZ1bmN0aW9uKGNvbmZpZykgew0KICBpZiAoT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgdmFyIHNjb3BlID0gdGhpczsNCiAgICBzY29wZS5jaGFubmVsTmFtZSA9ICJPem9uZS5fV2lkZ2V0Q2hyb21lQ2hhbm5lbCI7DQogICAgc2NvcGUudmVyc2lvbiA9IE96b25lLnZlcnNpb24ub3dmdmVyc2lvbiArIE96b25lLnZlcnNpb24ud2lkZ2V0Q2hyb21lOw0KICAgIHNjb3BlLml0ZW1zID0ge307DQogICAgc2NvcGUucmVnaXN0ZXJDaHJvbWVNZW51ID0gZnVuY3Rpb24obWVudUNvbmZpZykgew0KICAJCS8vIFJlZ3VsYXIgbWVudSBpdGVtDQogICAgICAgCXNjb3BlLml0ZW1zW21lbnVDb25maWcuaXRlbUlkICE9IG51bGwgPyBtZW51Q29uZmlnLml0ZW1JZCA6IG1lbnVDb25maWcuaWRdID0gbWVudUNvbmZpZzsNCiAgICAgICAJDQogIAkgIAlpZiAobWVudUNvbmZpZy5tZW51KSB7DQogIAkgICAgCWZvciAodmFyIGogPSAwIDsgaiA8IG1lbnVDb25maWcubWVudS5pdGVtcy5sZW5ndGggOyBqKyspIHsNCiAgCSAgICAJCXZhciBtZW51SXRlbSA9IG1lbnVDb25maWcubWVudS5pdGVtc1tqXTsNCiAgICAJCQkvLyBTdWItbWVudQ0KICAgIAkJCXNjb3BlLnJlZ2lzdGVyQ2hyb21lTWVudShtZW51SXRlbSk7DQogIAkgICAgCX0NCgkgIAl9DQogICAgfTsNCg0KICAgIHZhciBwdWIgPSAvKiogQGxlbmRzIE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUucHJvdG90eXBlICovIHsNCg0KICAgICAgaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZykgew0KDQogICAgICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTsNCg0KICAgICAgICAgIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IGNvbmZpZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgfHwgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlOw0KICAgICAgICAgIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5yZWdpc3RlckhhbmRsZXIoc2NvcGUuY2hhbm5lbE5hbWUsIGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7DQogICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSB0cnVlOw0KDQogICAgICAgICAgICAvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nDQogICAgICAgICAgICB2YXIgZGF0YSA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7DQoNCiAgICAgICAgICAgIHZhciBpZCA9IGRhdGEuaXRlbUlkICE9IG51bGwgPyBkYXRhLml0ZW1JZCA6IGRhdGEuaWQ7DQogICAgICAgICAgICB2YXIgaGFuZGxlciA9IHNjb3BlLml0ZW1zW2lkXS5oYW5kbGVyOw0KICAgICAgICAgICAgaWYgKGhhbmRsZXIgIT0gbnVsbCAmJiBvd2Zkb2pvLmlzRnVuY3Rpb24oaGFuZGxlcikpIHsNCiAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBoYW5kbGVyLmFwcGx5KGRhdGEuc2NvcGUgIT0gbnVsbCA/IGRhdGEuc2NvcGUgOiB3aW5kb3csIGRhdGEuYXJncyAhPSBudWxsID8gZGF0YS5hcmdzIDogW10pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7DQogICAgICAgICAgfSk7DQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBDaGVja3MgdG8gc2VlIGlmIHRoZSBXaWRnZXQgQ2hyb21lIGhhcyBhbHJlYWR5IGJlZW4gbW9kaWZpZWQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgd2lkZ2V0IGlmcmFtZSBpcyByZWxvYWRlZA0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4NCiAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIGFuIG9iamVjdCB3aGljaCBoYXMgZm9sbG93aW5nIHByb3BlcnRpZXMuIDxicj4NCiAgICAgICAqIDxicj4NCiAgICAgICAqICAgICB7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGN1cnJlbnRseSBvcGVuZWQgb24gdGhlIGRhc2hib2FyZCwgb3IgZWxzZSBmYWxzZS4gPGJyPg0KICAgICAgICogICAgIHtCb29sZWFufSBtb2RpZmllZDogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGNocm9tZShoZWFkZXIpIGlzIG1vZGlmaWVkLCBvciBlbHNlIGZhbHNlLiA8YnI+DQogICAgICAgKg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICB0aGlzLndjLmlzTW9kaWZpZWQoew0KICAgICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsNCiAgICAgICAqICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZw0KICAgICAgICogICAgICAgICB2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsNCiAgICAgICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7DQogICAgICAgKg0KICAgICAgICogICAgICAgICAgICAgLy9pZiB0aGUgY2hyb21lIHdhcyBuZXZlciBtb2RpZmllZA0KICAgICAgICogICAgICAgICAgICAgaWYgKCFyZXMubW9kaWZpZWQpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgIC8vZG8gc29tZXRoaW5nLCBwZXJoYXBzIGFkZCBidXR0b25zDQogICAgICAgKiAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAvL2lmIHdlIGFscmVhZHkgbW9kaWZpZWQgdGhlIGNocm9tZQ0KICAgICAgICogICAgICAgICAgICAgZWxzZSB7DQogICAgICAgKiAgICAgICAgICAgICAgIC8vZG8gc29tZXRoaW5nIG9yIHBlcmhhcHMgbm90aGluZyBpZiB0aGUgYnV0dG9ucyBhcmUgYWxyZWFkeSBhZGRlZA0KICAgICAgICogICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICB9DQogICAgICAgKiAgICAgfQ0KICAgICAgICogICB9KTsNCiAgICAgICAqLw0KICAgICAgaXNNb2RpZmllZDogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgIGFjdGlvbjogJ2lzTW9kaWZpZWQnDQogICAgICAgIH07DQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBBZGRzIGJ1dHRvbnMgdG8gdGhlIFdpZGdldCBDaHJvbWUuICBCdXR0b25zIGFyZSBhZGRlZCBhZnRlciBleGlzdGluZyBidXR0b25zLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgYnV0dG9uIGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIEV4dEpTLWxpa2UgcHJvcGVydHkgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGNvbXBvbmVudCB0byBjcmVhdGUuICBDdXJyZW50bHkgdGhlIFdpZGdldCBDaHJvbWUgQVBJIG9ubHkgc3VwcG9ydHMgdHdvIHh0eXBlIHZhbHVlczog4oCYYnV0dG9u4oCZIGFuZCDigJh3aWRnZXR0b29s4oCZLiAgeHR5cGUgaXMgYW4gb3B0aW9uYWwgZmllbGQsIGlmIGl0IGlzIG9taXR0ZWQg4oCYd2lkZ2V0dG9vbOKAmSBpcyB1c2VkLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50eXBlIFVzZWQgb25seSBmb3Ig4oCYd2lkZ2V0dG9vbOKAmSBidXR0b25zLiAgSXQgZGV0ZXJtaW5lcyB0aGUgc3RhbmRhcmQgaWNvbiB0byBiZSB1c2VkLiAgRm9yIGEgY29tcGxldGUgbGlzdCBvZiB0eXBlcyBwbGVhc2Ugc2VlIHRoZSBFeHRKUyA0LnggQVBJIGRvY3VtZW50YXRpb24sIDxhIGhyZWY9J2h0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZSc+aHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlPC9hPg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgYnV0dG9uLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgYnV0dG9uLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbi7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0Lg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS50b29sdGlwIFRoaXMgcHJvcGVydHkgZGVmaW5lcyBhIHRvb2x0aXAuICBJdCBoYXMgdHdvIGltcG9ydGFudCBzdWIgcHJvcGVydGllcywgdGl0bGUgYW5kIHRleHQuICB0b29sdGlwIGlzIG9ubHkgdXNlZCB3aGVuIHRoZSB4dHlwZSBpcyDigJhidXR0b27igJkNCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9u4oCZcyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy5hZGRIZWFkZXJCdXR0b25zKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOg0KICAgICAgICogICAgICAgICAgICAgIFsNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJywNCiAgICAgICAqICAgICAgICAgICAgICAgICAvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dA0KICAgICAgICogICAgICAgICAgICAgICAgIGljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxlcnQnLA0KICAgICAgICogICAgICAgICAgICAgICAgIGl0ZW1JZDonYWxlcnQnLA0KICAgICAgICogICAgICAgICAgICAgICAgIHRvb2x0aXA6ICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxlcnQhJw0KICAgICAgICogICAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAvL3dpZGdldFN0YXRlIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldFN0YXRlIE9iag0KICAgICAgICogICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldFN0YXRlKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdpZGdldFN0YXRlLmdldFdpZGdldFN0YXRlKHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdGF0ZSkgew0KICAgICAgICoNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5jb2xsYXBzZWQgJiYgIXN0YXRlLm1pbmltaXplZCAmJiBzdGF0ZS5hY3RpdmUpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29ubHkgcmVuZGVyIHZpc3VhbCBjb250ZW50LCBwZXJoYXBzIHBvcHVwIGEgbWVzc2FnZSBib3ggaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UgaXQgbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgeHR5cGU6ICd3aWRnZXR0b29sJywNCiAgICAgICAqICAgICAgICAgICAgICAgICAvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dA0KICAgICAgICogICAgICAgICAgICAgICAgIGljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vaW5mb3JtYXRpb24ucG5nJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2hlbHAnLA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgYWxlcnQoJ0Fib3V0IEJ1dHRvbiBQcmVzc2VkJyk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9nZWFyIGlzIGEgc3RhbmRhcmQgZXh0IHRvb2wgdHlwZQ0KICAgICAgICogICAgICAgICAgICAgICAgIHR5cGU6ICdnZWFyJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2dlYXInLA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgYWxlcnQoJ1V0aWxpdHkgQnV0dG9uIFByZXNzZWQnKTsNCiAgICAgICAqICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgIF0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgYWRkSGVhZGVyQnV0dG9ucyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAnYWRkSGVhZGVyQnV0dG9ucyc7DQogICAgICAgIGRhdGEudHlwZSA9ICdidXR0b24nOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBzY29wZS5pdGVtc1tpdGVtc1tpXS5pdGVtSWQgIT0gbnVsbCA/IGl0ZW1zW2ldLml0ZW1JZCA6IGl0ZW1zW2ldLmlkXSA9IGl0ZW1zW2ldOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCg0KICAgICAgfSwNCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gVXBkYXRlcyBhbnkgZXhpc3RpbmcgYnV0dG9ucyBpbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiB0aGUgaXRlbUlkLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIEV4dEpTLWxpa2UgcHJvcGVydHkgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGNvbXBvbmVudCB0byBjcmVhdGUuICBDdXJyZW50bHkgdGhlIFdpZGdldCBDaHJvbWUgQVBJIG9ubHkgc3VwcG9ydHMgdHdvIHh0eXBlIHZhbHVlczog4oCYYnV0dG9u4oCZIGFuZCDigJh3aWRnZXR0b29s4oCZLiAgeHR5cGUgaXMgYW4gb3B0aW9uYWwgZmllbGQsIGlmIGl0IGlzIG9taXR0ZWQg4oCYd2lkZ2V0dG9vbOKAmSBpcyB1c2VkLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50eXBlIFVzZWQgb25seSBmb3Ig4oCYd2lkZ2V0dG9vbOKAmSBidXR0b25zLiAgSXQgZGV0ZXJtaW5lcyB0aGUgc3RhbmRhcmQgaWNvbiB0byBiZSB1c2VkLiAgRm9yIGEgY29tcGxldGUgbGlzdCBvZiB0eXBlcyBwbGVhc2Ugc2VlIHRoZSBFeHRKUyA0LnggQVBJIGRvY3VtZW50YXRpb24sIDxhIGhyZWY9J2h0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZSc+aHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlPC9hPg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgYnV0dG9uLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgYnV0dG9uLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbi7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0Lg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS50b29sdGlwIFRoaXMgcHJvcGVydHkgZGVmaW5lcyBhIHRvb2x0aXAuICBJdCBoYXMgdHdvIGltcG9ydGFudCBzdWIgcHJvcGVydGllcywgdGl0bGUgYW5kIHRleHQuICB0b29sdGlwIGlzIG9ubHkgdXNlZCB3aGVuIHRoZSB4dHlwZSBpcyDigJhidXR0b27igJkNCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9u4oCZcyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy51cGRhdGVIZWFkZXJCdXR0b25zKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOg0KICAgICAgICogICAgICAgICAgICAgIFsNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJywNCiAgICAgICAqICAgICAgICAgICAgICAgICAvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dA0KICAgICAgICogICAgICAgICAgICAgICAgIGljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxlcnQnLA0KICAgICAgICogICAgICAgICAgICAgICAgIGl0ZW1JZDonYWxlcnQnLA0KICAgICAgICogICAgICAgICAgICAgICAgIHRvb2x0aXA6ICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxlcnQhJw0KICAgICAgICogICAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAvL3dpZGdldFN0YXRlIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldFN0YXRlIE9iag0KICAgICAgICogICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldFN0YXRlKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdpZGdldFN0YXRlLmdldFdpZGdldFN0YXRlKHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdGF0ZSkgew0KICAgICAgICoNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5jb2xsYXBzZWQgJiYgIXN0YXRlLm1pbmltaXplZCAmJiBzdGF0ZS5hY3RpdmUpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29ubHkgcmVuZGVyIHZpc3VhbCBjb250ZW50LCBwZXJoYXBzIHBvcHVwIGEgbWVzc2FnZSBib3ggaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UgaXQgbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgeHR5cGU6ICd3aWRnZXR0b29sJywNCiAgICAgICAqICAgICAgICAgICAgICAgICAvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dA0KICAgICAgICogICAgICAgICAgICAgICAgIGljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vaW5mb3JtYXRpb24ucG5nJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2hlbHAnLA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgYWxlcnQoJ0Fib3V0IEJ1dHRvbiBQcmVzc2VkJyk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9nZWFyIGlzIGEgc3RhbmRhcmQgZXh0IHRvb2wgdHlwZQ0KICAgICAgICogICAgICAgICAgICAgICAgIHR5cGU6ICdnZWFyJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2dlYXInLA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgYWxlcnQoJ1V0aWxpdHkgQnV0dG9uIFByZXNzZWQnKTsNCiAgICAgICAqICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgIF0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgdXBkYXRlSGVhZGVyQnV0dG9ucyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAndXBkYXRlSGVhZGVyQnV0dG9ucyc7DQogICAgICAgIGRhdGEudHlwZSA9ICdidXR0b24nOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAvL3NhdmUgZGF0YQ0KICAgICAgICAgIHZhciBpZCA9IGl0ZW1zW2ldLml0ZW1JZCAhPSBudWxsID8gaXRlbXNbaV0uaXRlbUlkIDogaXRlbXNbaV0uaWQ7DQogICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2lkXSAhPSBudWxsKSB7DQogICAgICAgICAgICBvd2Zkb2pvLm1peGluKHNjb3BlLml0ZW1zW2lkXSwgaXRlbXNbaV0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHNjb3BlLml0ZW1zW2lkXSA9IGl0ZW1zW2ldOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQoNCiAgICAgIH0sDQoNCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIEluc2VydHMgbmV3IGJ1dHRvbnMgdG8gdGhlIFdpZGdldCBDaHJvbWUuICBCdXR0b25zIGFyZSBhZGRlZCB0byB0aGUgc2FtZSBhcmVhIGFzIGV4aXN0aW5nIGJ1dHRvbnMuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge051bWJlcn0gW2NmZy5wb3M9MF0gMC1iYXNlZCBpbmRleCBvZiB3aGVyZSBidXR0b25zIHdpbGwgYmUgYWRkZWQsIGFtb25nIGFueSBwcmUtZXhpc3RpbmcgYnV0dG9ucy4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBidXR0b25zIGNvbmZpZ3VyYXRpb25zIHRvIGluc2VydCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIGJ1dHRvbiBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIGJ1dHRvbnMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBidXR0b25zIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyBFeHRKUy1saWtlIHByb3BlcnR5IHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBjb21wb25lbnQgdG8gY3JlYXRlLiAgQ3VycmVudGx5IHRoZSBXaWRnZXQgQ2hyb21lIEFQSSBvbmx5IHN1cHBvcnRzIHR3byB4dHlwZSB2YWx1ZXM6IOKAmGJ1dHRvbuKAmSBhbmQg4oCYd2lkZ2V0dG9vbOKAmS4gIHh0eXBlIGlzIGFuIG9wdGlvbmFsIGZpZWxkLCBpZiBpdCBpcyBvbWl0dGVkIOKAmHdpZGdldHRvb2zigJkgaXMgdXNlZC4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udHlwZSBVc2VkIG9ubHkgZm9yIOKAmHdpZGdldHRvb2zigJkgYnV0dG9ucy4gIEl0IGRldGVybWluZXMgdGhlIHN0YW5kYXJkIGljb24gdG8gYmUgdXNlZC4gIEZvciBhIGNvbXBsZXRlIGxpc3Qgb2YgdHlwZXMgcGxlYXNlIHNlZSB0aGUgRXh0SlMgNC54IEFQSSBkb2N1bWVudGF0aW9uLCA8YSBocmVmPSdodHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGUnPmh0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZTwvYT4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIGJ1dHRvbi4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIGJ1dHRvbi4gIFRoaXMgcHJvcGVydHkgaXMgb25seSB1c2VkIGlmIHRoZSB4dHlwZSBpcyDigJhidXR0b24u4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0udG9vbHRpcCBUaGlzIHByb3BlcnR5IGRlZmluZXMgYSB0b29sdGlwLiAgSXQgaGFzIHR3byBpbXBvcnRhbnQgc3ViIHByb3BlcnRpZXMsIHRpdGxlIGFuZCB0ZXh0LiAgdG9vbHRpcCBpcyBvbmx5IHVzZWQgd2hlbiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9u4oCZDQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGJ1dHRvbiBpcyBwcmVzc2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbuKAmXMgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLg0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MuaW5zZXJ0SGVhZGVyQnV0dG9ucyh7DQogICAgICAgKiAgICAgICAgICAgICBwb3M6IDAsDQogICAgICAgKiAgICAgICAgICAgICBpdGVtczoNCiAgICAgICAqICAgICAgICAgICAgICBbDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2FsZXJ0JywNCiAgICAgICAqICAgICAgICAgICAgICAgICB0b29sdGlwOiAgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgdGV4dDogJ0FsZXJ0IScNCiAgICAgICAqICAgICAgICAgICAgICAgICB9LA0KICAgICAgICogICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRTdGF0ZSkgew0KICAgICAgICogICAgICAgICAgICAgICAgICAgICB3aWRnZXRTdGF0ZS5nZXRXaWRnZXRTdGF0ZSh7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAqDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUuY29sbGFwc2VkICYmICFzdGF0ZS5taW5pbWl6ZWQgJiYgc3RhdGUuYWN0aXZlKSB7DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vbmx5IHJlbmRlciB2aXN1YWwgY29udGVudCwgcGVyaGFwcyBwb3B1cCBhIG1lc3NhZ2UgYm94IGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIGl0IG1heSBub3QgcmVuZGVyIGNvcnJlY3RseQ0KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICogICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIHh0eXBlOiAnd2lkZ2V0dG9vbCcsDQogICAgICAgKiAgICAgICAgICAgICAgICAgLy9wYXRoIHRvIGFuIGltYWdlIHRvIHVzZS4gdGhpcyBwYXRoIHNob3VsZCBlaXRoZXIgYmUgZnVsbHkgcXVhbGlmaWVkIG9yIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQNCiAgICAgICAqICAgICAgICAgICAgICAgICBpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidoZWxwJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBYm91dCBCdXR0b24gUHJlc3NlZCcpOw0KICAgICAgICogICAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIC8vZ2VhciBpcyBhIHN0YW5kYXJkIGV4dCB0b29sIHR5cGUNCiAgICAgICAqICAgICAgICAgICAgICAgICB0eXBlOiAnZ2VhcicsDQogICAgICAgKiAgICAgICAgICAgICAgICAgaXRlbUlkOidnZWFyJywNCiAgICAgICAqICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdVdGlsaXR5IEJ1dHRvbiBQcmVzc2VkJyk7DQogICAgICAgKiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICogICAgICAgICAgICAgICB9DQogICAgICAgKiAgICAgICAgICAgICBdDQogICAgICAgKiAgICAgfSk7DQogICAgICAgKi8NCiAgICAgIGluc2VydEhlYWRlckJ1dHRvbnMgOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgdmFyIGRhdGEgPSB7fTsNCiAgICAgICAgdmFyIGl0ZW1zID0gbnVsbDsNCg0KICAgICAgICBpZiAoIW93ZmRvam8uaXNBcnJheShjZmcuaXRlbXMpKSB7DQogICAgICAgICAgaXRlbXMgPSBbY2ZnLml0ZW1zXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpdGVtcyA9IGNmZy5pdGVtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhdGEuYWN0aW9uID0gJ2luc2VydEhlYWRlckJ1dHRvbnMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnYnV0dG9uJzsNCiAgICAgICAgaWYgKGNmZy5wb3MgIT0gbnVsbCkgew0KICAgICAgICAgIGRhdGEucG9zID0gY2ZnLnBvczsNCiAgICAgICAgfQ0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBzY29wZS5pdGVtc1tpdGVtc1tpXS5pdGVtSWQgIT0gbnVsbCA/IGl0ZW1zW2ldLml0ZW1JZCA6IGl0ZW1zW2ldLmlkXSA9IGl0ZW1zW2ldOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHNjb3BlLmNoYW5uZWxOYW1lLCBjZmcuY2FsbGJhY2ssIHNjb3BlLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLCBqc29uU3RyaW5nKTsNCiAgICAgIH0sDQoNCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIFJlbW92ZXMgZXhpc3RpbmcgYnV0dG9ucyBvbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiBpdGVtSWQuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgYnV0dG9ucyBjb25maWd1cmF0aW9ucyB0byByZW1vdmUgdG8gdGhlIGNocm9tZS4gIE9ubHkgaXRlbUlkIGlzIHJlcXVpcmVkLg0KICAgICAgICogICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy5yZW1vdmVIZWFkZXJCdXR0b25zKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOg0KICAgICAgICogICAgICAgICAgICAgIFsNCiAgICAgICAqICAgICAgICAgICAgICAgew0KICAgICAgICogICAgICAgICAgICAgICAgIGl0ZW1JZDonYWxlcnQnDQogICAgICAgKiAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2hlbHAnDQogICAgICAgKiAgICAgICAgICAgICAgIH0sDQogICAgICAgKiAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICBpdGVtSWQ6J2dlYXInDQogICAgICAgKiAgICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgICAgIF0NCiAgICAgICAqICAgICB9KTsNCiAgICAgICAqLw0KICAgICAgcmVtb3ZlSGVhZGVyQnV0dG9ucyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAncmVtb3ZlSGVhZGVyQnV0dG9ucyc7DQogICAgICAgIGRhdGEudHlwZSA9ICdidXR0b24nOw0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgaWQgPSBpdGVtc1tpXS5pdGVtSWQgIT0gbnVsbCA/IGl0ZW1zW2ldLml0ZW1JZCA6IGl0ZW1zW2ldLmlkOw0KICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tpZF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgLy9kZWxldGUgc2F2ZWQgZGF0YQ0KICAgICAgICAgICAgZGVsZXRlIHNjb3BlLml0ZW1zW2lkXTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgfSwNCiAgICAgDQogICAgDQogICAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24gTGlzdHMgYWxsIGJ1dHRvbnMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhlIHdpZGdldCBjaHJvbWUuDQogICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICogICAgdGhpcy53Yy5saXN0SGVhZGVyQnV0dG9ucyh7DQogICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsNCiAgICAgKiAgICAgICAgIC8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcNCiAgICAgKiAgICAgICAgIHZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOw0KICAgICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7DQogICAgICogICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXMuaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgKiAgICAgICAgICAgICAJLy8gZG8gc29tZXRoaW5nIHdpdGggdGhlIGJ1dHRvbnMNCiAgICAgKiAgICAgICAgICAgICB9DQogICAgICogICAgICAgICB9DQogICAgICogICAgIH0NCiAgICAgKiAgIH0pOw0KICAgICAqLw0KICAgICAgbGlzdEhlYWRlckJ1dHRvbnM6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgdmFyIGRhdGEgPSB7DQogICAgICAgIGFjdGlvbjogJ2xpc3RIZWFkZXJNZW51cycsDQogICAgICAgIHR5cGU6ICdidXR0b24nDQogICAgICB9Ow0KICAgICAgdmFyIGpzb25TdHJpbmcgPSBnYWRnZXRzLmpzb24uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgfSwNCiAgICANCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIEFkZHMgbWVudXMgdG8gdGhlIFdpZGdldCBDaHJvbWUuICBNZW51cyBhcmUgYWRkZWQgYWZ0ZXIgZXhpc3RpbmcgbWVudXMuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ucGFyZW50SWQgaXRlbUlkIGlzIHRoZSBpdGVtSWQgb2YgdGhlIG1lbnUgdG8gd2hpY2ggdGhpcyBjb25maWd1cmF0aW9uIHNob3VsZCBiZSBhZGRlZCBhcyBhIHN1Yi1tZW51LiAgSWYgb21pdHRlZCwgdGhlIGNvbmZpZ3VyYXRpb24gd2lsbCBiZSBhZGRlZCBhcyBhIG1haW4gbWVudSBvbiB0aGUgbWVudSB0b29sYmFyLiAgDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnVzIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgbWVudXMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51LiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgbWVudS4gIA0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51IG1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgaXRlbSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGl0ZW0gY29uZmlncw0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnUgaXRlbXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIHVzZWQgdG8gc3BlY2lmeSB0aGUgdHlwZSBvZiBtZW51IGl0ZW0gdG8gYWRkLiAgVGhpcyBhdHRyaWJ1dGUgc2hvdWxkIGJlIG9taXR0ZWQgdW5sZXNzIHNwZWNpZnlpbmcgYSBtZW51c2VwYXJhdG9yLiBTZXR0aW5nIHRoaXMgdmFsdWUgdG8gIm1lbnVzZXBhcmF0b3IiIGFkZHMgYSBzZXBhcmF0b3IgYmFyIHRvIGEgbWVudSwgdXNlZCB0byBkaXZpZGUgbG9naWNhbCBncm91cHMgb2YgbWVudSBpdGVtcy4gSWYgc3BlY2lmaWVkLCBvbmx5IHh0eXBlIHNob3VsZCBiZSBzcGVjaWZpZWQuICBHZW5lcmFsbHkgeW91IHdpbGwgYWRkIG9uZSBvZiB0aGVzZSBieSB1c2luZyAiLSIgaW4geW91ciBpdGVtcyBjb25maWcgcmF0aGVyIHRoYW4gY3JlYXRpbmcgb25lIGRpcmVjdGx5IHVzaW5nIHh0eXBlLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIHVzYWdlLiANCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudSBpdGVtLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgZm9yIHRoZSBtZW51IGl0ZW0uIA0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBjbGlja2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbidzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5tZW51IHN1Yi1tZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0LiAgU2VlIGV4YW1wbGUgZm9yIHN1Yi1tZW51IGNvbmZpZy4NCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiAgICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAqICAgICB0aGlzLndjLmFkZEhlYWRlck1lbnVzKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOg0KICAgICAgICogICAgICAgICAgICAgIFsNCiAgICAgICAqCQkJCXsNCiAgICAgICAqCQkJCQlpdGVtSWQ6J3JlZ3VsYXJNZW51JywNCiAgICAgICAqCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJdGV4dDogJ1JlZ3VsYXIgTWVudScsDQogICAgICAgKgkJCQkJbWVudTogew0KICAgICAgICoJCQkJCQlpdGVtczogWw0KICAgICAgICoJCQkJCQkgICAgew0KICAgICAgICoJCQkJCQkgICAgCWl0ZW1JZDoncmVndWxhck1lbnVJdGVtMScsDQogICAgICAgKgkJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkgICAgCXRleHQ6ICdSZWd1bGFyIE1lbnUgSXRlbSAxJywNCiAgICAgICAqCQkJCQkJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkJICAgIAkJYWxlcnQoJ1lvdSBjbGlja2VkIHRoZSBSZWd1bGFyIE1lbnUgbWVudSBpdGVtLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0NCiAgICAgICAqCQkJCQkJXQ0KICAgICAgICoJCQkJCX0NCiAgICAgICAqCQkJCX0sDQogICAgICAgKgkJCQl7DQogICAgICAgKgkJCQkJaXRlbUlkOidzbmFja3MnLA0KICAgICAgICoJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQl0ZXh0OiAnTWVudSB3aXRoIFN1Yi1NZW51JywNCiAgICAgICAqCQkJCQltZW51OiB7DQogICAgICAgKgkJCQkJCWl0ZW1zOiBbDQogICAgICAgKgkJCQkJCSAgICB7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidmcnVpdHMnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnRnJ1aXRzJywNCiAgICAgICAqCQkJCQkJICAgIAltZW51OiB7DQogICAgICAgKgkJCQkJCQkgICAgCWl0ZW1zOiBbDQogICAgICAgKgkJCQkJCQkgICAgCSAgICB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaXRlbUlkOidhcHBsZScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdBcHBsZScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYW4gQXBwbGUuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ21lbnVzZXBhcmF0b3InDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonYmFuYW5hJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJdGV4dDogJ0JhbmFuYScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBCYW5hbmEuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfSwgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonY2hlcnJ5JywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJdGV4dDogJ0NoZXJyaWVzJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBDaGVycmllcy4nKTsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAl9DQogICAgICAgKgkJCQkJCQkgICAgCSAgICB9DQogICAgICAgKgkJCQkJCQkgICAgCV0NCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9LA0KICAgICAgICoJCQkJCQkJJy0nLCAvLyBhbm90aGVyIHdheSB0byBhZGQgYSBtZW51IHNlcGFyYXRvciANCiAgICAgICAqCQkJCQkJCXsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J2N1cGNha2UnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnQ3VwY2FrZScsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBDdXBjYWtlLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0sIHsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J2NoaXBzJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ1BvdGF0byBDaGlwcycsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBQb3RhdG8gQ2hpcHMuJyk7DQogICAgICAgKgkJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCQkgICAgfQ0KICAgICAgICoJCQkJCQldDQogICAgICAgKgkJCQkJfQ0KICAgICAgICoJCQkJfQ0KICAgICAgICogICAgICAgICAgICAgXQ0KICAgICAgICogICAgIH0pOw0KICAgICAgICovDQogICAgICBhZGRIZWFkZXJNZW51cyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAnYWRkSGVhZGVyTWVudXMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnbWVudSc7DQogICAgICAgIGRhdGEuaXRlbXMgPSBpdGVtczsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAJdmFyIGl0ZW0gPSBpdGVtc1tpXTsNCiAgICAgICAgCXNjb3BlLnJlZ2lzdGVyQ2hyb21lTWVudShpdGVtKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQoNCiAgICAgIH0sDQogICAgICANCiAgICAgIC8qKg0KICAgICAgICogQGRlc2NyaXB0aW9uIFVwZGF0ZXMgYW55IGV4aXN0aW5nIG1lbnVzIGluIHRoZSBXaWRnZXQgQ2hyb21lIGJhc2VkIG9uIHRoZSBpdGVtSWQuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGNvbmZpZ3MNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBtZW51cyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUuICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwNCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBtZW51LiAgDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUgbWVudSBjb25maWd1cmF0aW9uIG9iamVjdA0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBpdGVtIGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgaXRlbSBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudSBpdGVtcyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgdXNlZCB0byBzcGVjaWZ5IHRoZSB0eXBlIG9mIG1lbnUgaXRlbSB0byBhZGQuICBUaGlzIGF0dHJpYnV0ZSBzaG91bGQgYmUgb21pdHRlZCB1bmxlc3Mgc3BlY2lmeWluZyBhIG1lbnVzZXBhcmF0b3IuIFNldHRpbmcgdGhpcyB2YWx1ZSB0byAibWVudXNlcGFyYXRvciIgYWRkcyBhIHNlcGFyYXRvciBiYXIgdG8gYSBtZW51LCB1c2VkIHRvIGRpdmlkZSBsb2dpY2FsIGdyb3VwcyBvZiBtZW51IGl0ZW1zLiBJZiBzcGVjaWZpZWQsIG9ubHkgeHR5cGUgc2hvdWxkIGJlIHNwZWNpZmllZC4gIFNlZSBleGFtcGxlIGJlbG93IGZvciB1c2FnZS4NCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudSBpdGVtLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgZm9yIHRoZSBtZW51IGl0ZW0uIA0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBjbGlja2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbidzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5tZW51IHN1Yi1tZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0LiAgU2VlIGV4YW1wbGUgZm9yIHN1Yi1tZW51IGNvbmZpZy4NCiAgICAgICAqIEBleGFtcGxlDQogICAgICAgKiAgICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAqICAgICB0aGlzLndjLnVwZGF0ZUhlYWRlck1lbnVzKHsNCiAgICAgICAqICAgICAgICAgICAgIGl0ZW1zOg0KICAgICAgICogICAgICAgICAgICAgIFsNCiAgICAgICAqCQkJCXsNCiAgICAgICAqCQkJCQlpdGVtSWQ6J3JlZ3VsYXJNZW51JywNCiAgICAgICAqCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJdGV4dDogJ1JlZ3VsYXIgTWVudScsDQogICAgICAgKgkJCQkJbWVudTogew0KICAgICAgICoJCQkJCQlpdGVtczogWw0KICAgICAgICoJCQkJCQkgICAgew0KICAgICAgICoJCQkJCQkgICAgCWl0ZW1JZDoncmVndWxhck1lbnVJdGVtMScsDQogICAgICAgKgkJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkgICAgCXRleHQ6ICdSZWd1bGFyIE1lbnUgSXRlbSAxJywNCiAgICAgICAqCQkJCQkJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkJICAgIAkJYWxlcnQoJ1lvdSBjbGlja2VkIHRoZSBSZWd1bGFyIE1lbnUgbWVudSBpdGVtLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0NCiAgICAgICAqCQkJCQkJXQ0KICAgICAgICoJCQkJCX0NCiAgICAgICAqCQkJCX0sDQogICAgICAgKgkJCQl7DQogICAgICAgKgkJCQkJaXRlbUlkOidzbmFja3MnLA0KICAgICAgICoJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQl0ZXh0OiAnTWVudSB3aXRoIFN1Yi1NZW51JywNCiAgICAgICAqCQkJCQltZW51OiB7DQogICAgICAgKgkJCQkJCWl0ZW1zOiBbDQogICAgICAgKgkJCQkJCSAgICB7DQogICAgICAgKgkJCQkJCSAgICAJaXRlbUlkOidmcnVpdHMnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnRnJ1aXRzJywNCiAgICAgICAqCQkJCQkJICAgIAltZW51OiB7DQogICAgICAgKgkJCQkJCQkgICAgCWl0ZW1zOiBbDQogICAgICAgKgkJCQkJCQkgICAgCSAgICB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaXRlbUlkOidhcHBsZScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCXRleHQ6ICdBcHBsZScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYW4gQXBwbGUuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfSwNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ21lbnVzZXBhcmF0b3InDQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICoJCQkJCQkJICAgIAkgICAgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonYmFuYW5hJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJdGV4dDogJ0JhbmFuYScsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBCYW5hbmEuJyk7DQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJfQ0KICAgICAgICoJCQkJCQkJICAgIAkgICAgfSwgew0KICAgICAgICoJCQkJCQkJICAgIAkgICAgCWl0ZW1JZDonY2hlcnJ5JywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCQkgICAgCSAgICAJdGV4dDogJ0NoZXJyaWVzJywNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBDaGVycmllcy4nKTsNCiAgICAgICAqCQkJCQkJCSAgICAJICAgIAl9DQogICAgICAgKgkJCQkJCQkgICAgCSAgICB9DQogICAgICAgKgkJCQkJCQkgICAgCV0NCiAgICAgICAqCQkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCSAgICB9LA0KICAgICAgICoJCQkJCQkJJy0nLCAvLyBhbm90aGVyIHdheSB0byBhZGQgYSBtZW51IHNlcGFyYXRvciANCiAgICAgICAqCQkJCQkJCXsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J2N1cGNha2UnLA0KICAgICAgICoJCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkJICAgIAl0ZXh0OiAnQ3VwY2FrZScsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBDdXBjYWtlLicpOw0KICAgICAgICoJCQkJCQkgICAgCX0NCiAgICAgICAqCQkJCQkJICAgIH0sIHsNCiAgICAgICAqCQkJCQkJICAgIAlpdGVtSWQ6J2NoaXBzJywNCiAgICAgICAqCQkJCQkJICAgIAlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsDQogICAgICAgKgkJCQkJCSAgICAJdGV4dDogJ1BvdGF0byBDaGlwcycsDQogICAgICAgKgkJCQkJCSAgICAJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7DQogICAgICAgKgkJCQkJCSAgICAJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBQb3RhdG8gQ2hpcHMuJyk7DQogICAgICAgKgkJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCQkgICAgfQ0KICAgICAgICoJCQkJCQldDQogICAgICAgKgkJCQkJfQ0KICAgICAgICoJCQkJfQ0KICAgICAgICogICAgICAgICAgICAgXQ0KICAgICAgICogICAgIH0pOw0KICAgICAgICovDQogICAgICB1cGRhdGVIZWFkZXJNZW51cyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAndXBkYXRlSGVhZGVyTWVudXMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnbWVudSc7DQogICAgICAgIGRhdGEuaXRlbXMgPSBpdGVtczsNCiAgICAgICAgDQogICAgICAgIHZhciBtZXJnZSA9IGZ1bmN0aW9uKHNvdXJjZSwga2V5LCB2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZVtrZXldICYmIHNvdXJjZVtrZXldLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlKHNvdXJjZVtrZXldLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2Vba2V5XSA9IEV4dC5jbG9uZSh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHNvdXJjZVtrZXldID0gdmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIGkgPSAxLA0KICAgICAgICAgICAgICAgIGxuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBvYmplY3QsIHByb3BlcnR5Ow0KDQogICAgICAgICAgICBmb3IgKDsgaSA8IGxuOyBpKyspIHsNCiAgICAgICAgICAgICAgICBvYmplY3QgPSBhcmd1bWVudHNbaV07DQoNCiAgICAgICAgICAgICAgICBmb3IgKHByb3BlcnR5IGluIG9iamVjdCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2Uoc291cmNlLCBwcm9wZXJ0eSwgb2JqZWN0W3Byb3BlcnR5XSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBzb3VyY2U7DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIAl2YXIgaXRlbSA9IGl0ZW1zW2ldOw0KICAgICAgICAJLy8gZG9uJ3QgcmUtcmVnaXN0ZXIgbWVudSBpZiBzdWJtZW51IG9yIGhhbmRsZXIgYXJlIHVuY2hhbmdlZA0KICAgICAgICAJaWYgKGl0ZW0ubWVudSB8fCBpdGVtLmhhbmRsZXIpIHsNCiAgICAgICAgCQlzY29wZS5yZWdpc3RlckNocm9tZU1lbnUoaXRlbSk7DQogICAgICAgIAl9DQogICAgICAgIAlpZiAoaXRlbS5tZW51KSB7DQoJICAgICAgICAJZm9yICh2YXIgaiA9IDAgOyBqIDwgaXRlbS5tZW51Lml0ZW1zLmxlbmd0aCA7IGorKykgew0KCSAgICAgICAgCQl2YXIgbWVudUl0ZW0gPSBpdGVtLm1lbnUuaXRlbXNbal07DQoJICAgICAgICAJCWlmICghbWVudUl0ZW0ubWVudSkgew0KCSAgICAgICAgCQkJLy8gUmVndWxhciBtZW51IGl0ZW0NCgkgICAgICAgIAkJCS8vIE1lcmdlIHdpdGggY3VycmVudCBtZW51IGl0ZW0NCgkgICAgICAgIAkJCXZhciBrZXkgPSBtZW51SXRlbS5pdGVtSWQgIT0gbnVsbCA/IG1lbnVJdGVtLml0ZW1JZCA6IG1lbnVJdGVtLmlkOw0KCSAgICAgICAgCQkJc2NvcGUuaXRlbXNba2V5XSA9IHNjb3BlLml0ZW1zW2tleV0gPyBzY29wZS5pdGVtc1trZXldIDoge307DQoJICAgICAgICAgICAgICAgIAlzY29wZS5pdGVtc1trZXldID0gbWVyZ2Uoc2NvcGUuaXRlbXNba2V5XSwgbWVudUl0ZW0pOw0KCSAgICAgICAgCQl9IGVsc2Ugew0KCSAgICAgICAgCQkJLy8gU3ViLW1lbnUgDQoJICAgICAgICAJCQlmb3IgKHZhciBrID0gMCA7IGsgPCBtZW51SXRlbS5tZW51Lml0ZW1zLmxlbmd0aCA7IGsrKykgew0KCSAgICAgICAgCQkJCXZhciBzdWJNZW51SXRlbSA9IG1lbnVJdGVtLm1lbnUuaXRlbXNba107DQoJCSAgICAgICAgCQkJLy8gTWVyZ2Ugd2l0aCBjdXJyZW50IHN1Yi1tZW51IGl0ZW0NCgkJICAgICAgICAJCQl2YXIga2V5ID0gc3ViTWVudUl0ZW0uaXRlbUlkICE9IG51bGwgPyBzdWJNZW51SXRlbS5pdGVtSWQgOiBzdWJNZW51SXRlbS5pZDsNCgkJICAgICAgICAJCQlzY29wZS5pdGVtc1trZXldID0gc2NvcGUuaXRlbXNba2V5XSA/IHNjb3BlLml0ZW1zW2tleV0gOiB7fTsNCgkJICAgICAgICAgICAgICAgIAlzY29wZS5pdGVtc1trZXldID0gbWVyZ2Uoc2NvcGUuaXRlbXNba2V5XSwgc3ViTWVudUl0ZW0pOw0KCSAgICAgICAgCQkJfQ0KCSAgICAgICAgCQl9DQoJICAgICAgICAJfQ0KICAgICAgICAJfSBlbHNlIHsNCiAgICAJCQkvLyBSZWd1bGFyIG1lbnUgaXRlbQ0KICAgIAkJCS8vIE1lcmdlIHdpdGggY3VycmVudCBtZW51IGl0ZW0NCiAgICAJCQl2YXIga2V5ID0gaXRlbS5pdGVtSWQgIT0gbnVsbCA/IGl0ZW0uaXRlbUlkIDogaXRlbS5pZDsNCiAgICAJCQlzY29wZS5pdGVtc1trZXldID0gc2NvcGUuaXRlbXNba2V5XSA/IHNjb3BlLml0ZW1zW2tleV0gOiB7fTsNCiAgICAgICAgICAgIAlzY29wZS5pdGVtc1trZXldID0gbWVyZ2Uoc2NvcGUuaXRlbXNba2V5XSwgaXRlbSk7DQogICAgICAgIAl9DQogICAgICAgIAkNCiAgICAgICAgCS8vIFVwZGF0ZSBkYXRhIHdpdGggbWVyZ2VkIGl0ZW0NCiAgICAgICAgCWRhdGEuaXRlbXNbaV0gPSBzY29wZS5pdGVtc1tkYXRhLml0ZW1zW2ldLml0ZW1JZF07DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KDQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBJbnNlcnRzIG5ldyBtZW51cyBpbnRvIHRoZSBXaWRnZXQgQ2hyb21lLiAgTWVudXMgYXJlIGFkZGVkIHRvIHRoZSBzYW1lIGFyZWEgYXMgZXhpc3RpbmcgbWVudXMuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogICAgICAgKiBAcGFyYW0ge051bWJlcn0gW2NmZy5wb3M9MF0gMC1iYXNlZCBpbmRleCBvZiB3aGVyZSBtZW51cyB3aWxsIGJlIGFkZGVkLCBhbW9uZyBhbnkgcHJlLWV4aXN0aW5nIG1lbnVzLg0KICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBjb25maWdzDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnBhcmVudElkIGl0ZW1JZCBpcyB0aGUgaXRlbUlkIG9mIHRoZSBtZW51IHRvIHdoaWNoIHRoaXMgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgYWRkZWQgYXMgYSBzdWItbWVudS4gIElmIG9taXR0ZWQsIHRoZSBjb25maWd1cmF0aW9uIHdpbGwgYmUgYWRkZWQgYXMgYSBtYWluIG1lbnUgb24gdGhlIG1lbnUgdG9vbGJhci4gIA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51cyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIG1lbnVzIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5Lg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIG1lbnUuICBUaGlzIHByb3BlcnR5IGlzIG9ubHkgdXNlZCBpZiB0aGUgeHR5cGUgaXMg4oCYbWVudS7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0Lg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51IG1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgaXRlbSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGl0ZW0gY29uZmlncw0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnUgaXRlbXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLg0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIHVzZWQgdG8gc3BlY2lmeSB0aGUgdHlwZSBvZiBtZW51IGl0ZW0gdG8gYWRkLiAgVGhpcyBhdHRyaWJ1dGUgc2hvdWxkIGJlIG9taXR0ZWQgdW5sZXNzIHNwZWNpZnlpbmcgYSBtZW51c2VwYXJhdG9yLiBTZXR0aW5nIHRoaXMgdmFsdWUgdG8gIm1lbnVzZXBhcmF0b3IiIGFkZHMgYSBzZXBhcmF0b3IgYmFyIHRvIGEgbWVudSwgdXNlZCB0byBkaXZpZGUgbG9naWNhbCBncm91cHMgb2YgbWVudSBpdGVtcy4gSWYgc3BlY2lmaWVkLCBvbmx5IHh0eXBlIHNob3VsZCBiZSBzcGVjaWZpZWQuICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgdXNhZ2UuDQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUgaXRlbS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbA0KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGZvciB0aGUgbWVudSBpdGVtLiANCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBtZW51IGl0ZW0gaXMgY2xpY2tlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0ubWVudSBzdWItbWVudSBjb25maWd1cmF0aW9uIG9iamVjdC4gIFNlZSBleGFtcGxlIGZvciBzdWItbWVudSBjb25maWcuDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgIC8vdGhpcy53YyBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRDaHJvbWUgb2JqDQogICAgICAgKiAgICAgdGhpcy53Yy5pbnNlcnRIZWFkZXJNZW51cyh7DQogICAgICAgKiAgICAgICAgICAgICBwb3M6IDAsDQogICAgICAgKiAgICAgICAgICAgICBpdGVtczogW3sNCiAgICAgICAqCQkJIGl0ZW1JZDonaW5zZXJ0ZWRNZW51JywNCiAgICAgICAqCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCXRleHQ6ICdJbnNlcnRlZCBNZW51JywNCiAgICAgICAqCQkJCW1lbnU6IHsNCiAgICAgICAqCQkJCQlpdGVtczogWw0KICAgICAgICoJCQkJCSAgICB7DQogICAgICAgKgkJCQkJICAgIAlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0xJywNCiAgICAgICAqCQkJCQkgICAgCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywNCiAgICAgICAqCQkJCQkgICAgCXRleHQ6ICdJbnNlcnRlZCBNZW51IEl0ZW0gMScsDQogICAgICAgKgkJCQkJICAgIAloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsNCiAgICAgICAqCQkJCQkgICAgCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIEluc2VydGVkIE1lbnUgbWVudSBpdGVtLicpOw0KICAgICAgICoJCQkJCSAgICAJfQ0KICAgICAgICoJCQkJCSAgICB9LA0KICAgICAgICoJCQkJCSAgICB7DQogICAgICAgKgkJCQkJICAgIAl4dHlwZTogJ21lbnVzZXBhcmF0b3InDQogICAgICAgKgkJCQkJICAgIH0sDQogICAgICAgKgkJCQkJICAgIHsNCiAgICAgICAqCQkJCQkgICAgCWl0ZW1JZDonaW5zZXJ0ZWRNZW51SXRlbTInLA0KICAgICAgICoJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCSAgICAJdGV4dDogJ0luc2VydGVkIE1lbnUgSXRlbSAyJywNCiAgICAgICAqCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCSAgICAJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgSW5zZXJ0ZWQgTWVudSBtZW51IGl0ZW0uJyk7DQogICAgICAgKgkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJCX0sDQogICAgICAgKgkJCQkJCSctJywgLy8gYW5vdGhlciB3YXkgdG8gYWRkIGEgbWVudSBzZXBhcmF0b3IgDQogICAgICAgKgkJCQkJCXsNCiAgICAgICAqCQkJCQkgICAgCWl0ZW1JZDonaW5zZXJ0ZWRNZW51SXRlbTMnLA0KICAgICAgICoJCQkJCSAgICAJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLA0KICAgICAgICoJCQkJCSAgICAJdGV4dDogJ0luc2VydGVkIE1lbnUgSXRlbSAzJywNCiAgICAgICAqCQkJCQkgICAgCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgew0KICAgICAgICoJCQkJCSAgICAJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgSW5zZXJ0ZWQgTWVudSBtZW51IGl0ZW0uJyk7DQogICAgICAgKgkJCQkJICAgIAl9DQogICAgICAgKgkJCQkJICAgIH0NCiAgICAgICAqCQkJCQldDQogICAgICAgKgkJCQl9DQogICAgICAgKgkJCX1dDQogICAgICAgKiAgICAgfSk7DQogICAgICAgKi8NCiAgICAgIGluc2VydEhlYWRlck1lbnVzIDogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgIHZhciBkYXRhID0ge307DQogICAgICAgIHZhciBpdGVtcyA9IG51bGw7DQoNCiAgICAgICAgaWYgKCFvd2Zkb2pvLmlzQXJyYXkoY2ZnLml0ZW1zKSkgew0KICAgICAgICAgIGl0ZW1zID0gW2NmZy5pdGVtc107DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgaXRlbXMgPSBjZmcuaXRlbXM7DQogICAgICAgIH0NCg0KICAgICAgICBkYXRhLmFjdGlvbiA9ICdpbnNlcnRIZWFkZXJNZW51cyc7DQogICAgICAgIGRhdGEudHlwZSA9ICdtZW51JzsNCiAgICAgICAgaWYgKGNmZy5wb3MgIT0gbnVsbCkgew0KICAgICAgICAgIGRhdGEucG9zID0gY2ZnLnBvczsNCiAgICAgICAgfQ0KICAgICAgICBkYXRhLml0ZW1zID0gaXRlbXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgCXZhciBpdGVtID0gaXRlbXNbaV07DQogICAgICAgIAlpZiAoaXRlbS5tZW51KSB7DQoJICAgICAgICAJZm9yICh2YXIgaiA9IDAgOyBqIDwgaXRlbS5tZW51Lml0ZW1zLmxlbmd0aCA7IGorKykgew0KCSAgICAgICAgCQl2YXIgbWVudUl0ZW0gPSBpdGVtLm1lbnUuaXRlbXNbal07DQoJICAgICAgICAJCWlmICghbWVudUl0ZW0ubWVudSkgew0KCSAgICAgICAgCQkJLy8gUmVndWxhciBtZW51IGl0ZW0NCgkgICAgICAgICAgICAgICAgCXNjb3BlLml0ZW1zW21lbnVJdGVtLml0ZW1JZCAhPSBudWxsID8gbWVudUl0ZW0uaXRlbUlkIDogbWVudUl0ZW0uaWRdID0gbWVudUl0ZW07DQoJICAgICAgICAJCX0gZWxzZSB7DQoJICAgICAgICAJCQkvLyBTdWItbWVudSANCgkgICAgICAgIAkJCWZvciAodmFyIGsgPSAwIDsgayA8IG1lbnVJdGVtLm1lbnUuaXRlbXMubGVuZ3RoIDsgaysrKSB7DQoJICAgICAgICAJCQkJdmFyIHN1Yk1lbnVJdGVtID0gbWVudUl0ZW0ubWVudS5pdGVtc1trXTsNCgkgICAgICAgICAgICAgICAgICAgIAlzY29wZS5pdGVtc1tzdWJNZW51SXRlbS5pdGVtSWQgIT0gbnVsbCA/IHN1Yk1lbnVJdGVtLml0ZW1JZCA6IHN1Yk1lbnVJdGVtLmlkXSA9IHN1Yk1lbnVJdGVtOw0KCSAgICAgICAgCQkJfQ0KCSAgICAgICAgCQl9DQoJICAgICAgICAJfQ0KICAgICAgICAJfSBlbHNlIHsNCiAgICAJCQkvLyBSZWd1bGFyIG1lbnUgaXRlbQ0KICAgICAgICAgICAgCXNjb3BlLml0ZW1zW2l0ZW0uaXRlbUlkICE9IG51bGwgPyBpdGVtLml0ZW1JZCA6IGl0ZW0uaWRdID0gaXRlbTsNCiAgICAgICAgCX0NCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgICB9LA0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGV4aXN0aW5nIG1lbnVzIG9uIHRoZSBXaWRnZXQgQ2hyb21lIGJhc2VkIG9uIGl0ZW1JZC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgaXRlbUlkcyBmb3IgdGhlIG1lbnVzIHRvIHJlbW92ZSBmcm9tIHRoZSBjaHJvbWUuDQogICAgICAgKiAgIFNlZSBleGFtcGxlIGJlbG93IGZvciBidXR0b24gY29uZmlncw0KICAgICAgICogQGV4YW1wbGUNCiAgICAgICAqICAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICogICAgIHRoaXMud2MucmVtb3ZlSGVhZGVyTWVudXMoew0KICAgICAgICogICAgICAgICAgICAgaXRlbXM6IFt7DQogICAgICAgKiAgICAgICAgICAgIAkgaXRlbUlkOiAncmVndWxhck1lbnUnDQogICAgICAgKiAgICAgICAgICAgICB9XQ0KICAgICAgICogICAgIH0pOw0KICAgICAgICovDQogICAgICByZW1vdmVIZWFkZXJNZW51cyA6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICB2YXIgaXRlbXMgPSBudWxsOw0KDQogICAgICAgIGlmICghb3dmZG9qby5pc0FycmF5KGNmZy5pdGVtcykpIHsNCiAgICAgICAgICBpdGVtcyA9IFtjZmcuaXRlbXNdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGl0ZW1zID0gY2ZnLml0ZW1zOw0KICAgICAgICB9DQoNCiAgICAgICAgZGF0YS5hY3Rpb24gPSAncmVtb3ZlSGVhZGVyTWVudXMnOw0KICAgICAgICBkYXRhLnR5cGUgPSAnbWVudSc7DQogICAgICAgIGRhdGEuaXRlbXMgPSBpdGVtczsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIHZhciBpZCA9IGl0ZW1zW2ldOw0KICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tpZF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgLy9kZWxldGUgc2F2ZWQgZGF0YQ0KICAgICAgICAgICAgZGVsZXRlIHNjb3BlLml0ZW1zW2lkXTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgfSwNCiAgICAgIA0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gTGlzdHMgYWxsIG1lbnVzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSB3aWRnZXQgY2hyb21lLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4NCiAgICAgICAqDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICogICAgLy90aGlzLndjIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldENocm9tZSBvYmoNCiAgICAgICAqICAgIHRoaXMud2MubGlzdEhlYWRlck1lbnVzKHsNCiAgICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24obXNnKSB7DQogICAgICAgKiAgICAgICAgIC8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcNCiAgICAgICAqICAgICAgICAgdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7DQogICAgICAgKiAgICAgICAgIGlmIChyZXMuc3VjY2Vzcykgew0KICAgICAgICogICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXMuaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAqICAgICAgICAgICAgIAkvLyBkbyBzb21ldGhpbmcgd2l0aCB0aGUgbWVudXMNCiAgICAgICAqICAgICAgICAgICAgIH0NCiAgICAgICAqICAgICAgICAgfQ0KICAgICAgICogICAgIH0NCiAgICAgICAqICAgfSk7DQogICAgICAgKi8NCiAgICAgIGxpc3RIZWFkZXJNZW51czogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgIGFjdGlvbjogJ2xpc3RIZWFkZXJNZW51cycsDQogICAgICAgICAgdHlwZTogJ21lbnUnDQogICAgICAgIH07DQogICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgICB9LA0KDQogICAgICAgLyoqDQogICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSBXaWRnZXQncyBUaXRsZSBmcm9tIHRoZSBDaHJvbWUNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKiAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICAgKiAgICB0aGlzLndjLmdldFRpdGxlKHsNCiAgICAgICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsNCiAgICAgICAgICogICAgICAgICAvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nDQogICAgICAgICAqICAgICAgICAgdmFyIHJlcyA9IE96b25lLnV0aWwucGFyc2VKc29uKG1zZyk7DQogICAgICAgICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7DQogICAgICAgICAqDQogICAgICAgICAqICAgICAgICAgICAvL2RvIHNvbWV0aGluZyB3aXRoIHRpdGxlDQogICAgICAgICAqICAgICAgICAgICAvLyByZXMudGl0bGUNCiAgICAgICAgICogICAgICAgICB9DQogICAgICAgICAqICAgICB9DQogICAgICAgICAqICAgfSk7DQogICAgICAgICAqLw0KICAgICAgIGdldFRpdGxlOiBmdW5jdGlvbihjZmcpIHsNCiAgICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgICAgYWN0aW9uOiAnZ2V0VGl0bGUnDQogICAgICAgICAgfTsNCiAgICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgc2NvcGUuY2hhbm5lbE5hbWUsIGNmZy5jYWxsYmFjaywgc2NvcGUud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksIGpzb25TdHJpbmcpOw0KICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAgKiBAZGVzY3JpcHRpb24gU2V0cyB0aGUgV2lkZ2V0J3MgVGl0bGUgaW4gdGhlIENocm9tZQ0KICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcw0KICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy50aXRsZSBUaGUgc3RyaW5nIHdoaWNoIHdpbGwgcmVwbGFjZSB0aGUgd2lkZ2V0IHRpdGxlDQogICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLg0KICAgICAgICAgICoNCiAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgKiAgICAvL3RoaXMud2MgaXMgYW4gYWxyZWFkeSBpbnN0YW50aWF0ZWQgV2lkZ2V0Q2hyb21lIG9iag0KICAgICAgICAgICogICAgdGhpcy53Yy5zZXRUaXRsZSh7DQogICAgICAgICAgKiAgICAgdGl0bGU6ICduZXcgdGl0bGUnLA0KICAgICAgICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsNCiAgICAgICAgICAqICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZw0KICAgICAgICAgICogICAgICAgICB2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsNCiAgICAgICAgICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7DQogICAgICAgICAgKiAgICAgICAgICAgLy9nZXQgdGl0bGUgYmFjayBmb3IgY29uZmlybWF0aW9uDQogICAgICAgICAgKiAgICAgICAgICAgLy8gcmVzLnRpdGxlDQogICAgICAgICAgKg0KICAgICAgICAgICogICAgICAgICB9DQogICAgICAgICAgKiAgICAgfQ0KICAgICAgICAgICogICB9KTsNCiAgICAgICAgICAqLw0KICAgICAgICBzZXRUaXRsZTogZnVuY3Rpb24oY2ZnKSB7DQogICAgICAgICAgdmFyIGRhdGEgPSB7DQogICAgICAgICAgICAgYWN0aW9uOiAnc2V0VGl0bGUnLA0KICAgICAgICAgICAgIHRpdGxlOiBjZmcudGl0bGUNCiAgICAgICAgICAgfTsNCiAgICAgICAgICB2YXIganNvblN0cmluZyA9IGdhZGdldHMuanNvbi5zdHJpbmdpZnkoZGF0YSk7DQogICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBzY29wZS5jaGFubmVsTmFtZSwgY2ZnLmNhbGxiYWNrLCBzY29wZS53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSwganNvblN0cmluZyk7DQogICAgICAgIH0NCg0KICAgIH07DQoNCiAgICBwdWIuaW5pdChjb25maWcpOw0KICAgIE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUuaW5zdGFuY2UgPSBwdWI7DQogIH0NCiAgcmV0dXJuIE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUuaW5zdGFuY2U7DQp9Ow0KDQovKioNCiAqICBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUgU2luZ2xldG9uIGluc3RhbmNlLiAgVG8gZG8gc28gaXQgcmVxdWlyZXMgYSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqICBAcGFyYW0gIHtPYmplY3R9IGNvbmZpZyAtIGNvbmZpZyBvYmplY3Qgd2l0aCBwYXJhbWV0ZXJzDQogKiAgQHBhcmFtICB7T3pvbmUuZXZlbnRpbmcuV2lkZ2V0fSBjb25maWcud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIC0gd2lkZ2V0IGV2ZW50aW5nIG9iamVjdCB3aGljaCBoYW5kbGVzIGV2ZW50aW5nIGZvciB0aGUgd2lkZ2V0DQogKiAgQGV4YW1wbGUNCiAqICAgIHRoaXMud2MgPSBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmdldEluc3RhbmNlKHsNCiAqICAgICAgICB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXI6IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiAgICB9KTsNCiAqDQogKiBAdGhyb3dzIHtFcnJvcn0gdGhyb3dzIGFuIGVycm9yIHdpdGggYSBtZXNzYWdlIGlmIHdpZGdldCBpbml0aWFsaXphdGlvbiBmYWlscw0KICovDQpPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmdldEluc3RhbmNlID0gZnVuY3Rpb24oY2ZnKSB7DQogIGlmIChPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmluc3RhbmNlID09IG51bGwpIHsNCiAgICBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmluc3RhbmNlID0gbmV3IE96b25lLmNocm9tZS5XaWRnZXRDaHJvbWUoY2ZnKTsNCiAgfQ0KICByZXR1cm4gT3pvbmUuY2hyb21lLldpZGdldENocm9tZS5pbnN0YW5jZTsNCn07DQoNCg0KCi8qKg0KICogQGlnbm9yZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSA/IE96b25lIDoge307DQoNCi8qKg0KICogQGlnbm9yZQ0KICogQG5hbWVzcGFjZQ0KICovDQpPem9uZS5kcmFnQW5kRHJvcCA9IE96b25lLmRyYWdBbmREcm9wID8gT3pvbmUuZHJhZ0FuZERyb3AgOiB7fTsNCg0KLyoqDQogKiBAZGVwcmVjYXRlZCBTaW5jZSBPV0YgMy43LjAgIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wLmdldEluc3RhbmNlPC9hPg0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogKiBAcGFyYW0ge09iamVjdH0gW2NmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXJdICBUaGUgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLg0KICogQHBhcmFtIHtCb29sZWFufSBbY2ZnLmF1dG9Jbml0XSAgVHJ1ZSB0byBhdXRvbWF0aWNhbGx5IGNhbGwgaW5pdCgpLCBGYWxzZSBvdGhlcndpc2UuICBUaGUgZGVmYXVsdCBpcyBUcnVlIGlmIGxlZnQgdW5kZWZpbmVkDQogKiBAcGFyYW0ge09iamVjdH0gW2NmZy5jYWxsYmFja3NdICBPYmplY3Qgd2l0aCBjYWxsYmFja3Mgd2hvJ3MgbmFtZXMgbWF0Y2ggZHJhZyBhbmQgZHJvcCBldmVudHMuICBBbHRlcm5hdGl2ZWx5IG9uZSBjb3VsZA0KICogdXNlIHRoZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPiBmdW5jdGlvbg0KICogQGRlc2NyaXB0aW9uIFRoZSBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcCBvYmplY3QgbWFuYWdlcyB0aGUgZHJhZyBhbmQgZHJvcCBmb3IgYW4gaW5kaXZpZHVhbCB3aWRnZXQuDQogKiBAcmVxdWlyZXMgb3dmZG9qbyB3aGljaCBpcyBhIGN1c3RvbSB2ZXJzaW9uIG9mIGRvam8gZm9yIE9XRg0KICogQHJlcXVpcmVzIDxhIGhyZWY9Ik96b25lLmV2ZW50aW5nLldpZGdldC5odG1sIj5Pem9uZS5ldmVudGluZy5XaWRnZXQ8L2E+IGZvciBldmVudGluZw0KICogQHNlZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPg0KICogQGV4YW1wbGUNCiAqDQogKiB2YXIgd2RkID0gbmV3IE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wKHsNCiAqICAgICAgICAgICAgICAgICAgIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcjogdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqICAgICAgICAgICAgICAgfSk7DQogKg0KICovDQpPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcCA9IGZ1bmN0aW9uKGNmZykgew0KDQogICAgdGhpcy5saXN0ZW5lcnMgPSB7fTsNCiAgICB0aGlzLmNhbGxiYWNrcyA9IHt9Ow0KICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsNCiAgICB0aGlzLmRyb3BFbmFibGVkRmxhZyA9IGZhbHNlOw0KICAgIHRoaXMuZHJvcFpvbmVIYW5kbGVycyA9IFtdOw0KDQogICAgY2ZnID0gY2ZnIHx8IHt9Ow0KDQogICAgLy9zZXQgaW5pdGlhbCBkcmFnIHRleHQNCiAgICB0aGlzLmRyYWdJbmRpY2F0b3JUZXh0ID0gY2ZnLmRyYWdJbmRpY2F0b3JUZXh0ID8gY2ZnLmRyYWdJbmRpY2F0b3JUZXh0IDogJ0RyYWdnaW5nIERhdGEnOw0KDQogICAgaWYgKGNmZy5jYWxsYmFja3MgIT0gbnVsbCAmJiBvd2Zkb2pvLmlzT2JqZWN0KGNmZy5jYWxsYmFja3MpKSB7DQogICAgICBvd2Zkb2pvLm1peGluKHRoaXMuY2FsbGJhY2tzLCBjZmcuY2FsbGJhY2tzKQ0KICAgIH0NCg0KICAgIC8vY3JlYXRlIGRyYWcgaW5kaWNhdG9yDQogICAgdGhpcy5kcmFnSW5kaWNhdG9yID0gdGhpcy5jcmVhdGVEcmFnSW5kaWNhdG9yKCk7DQogICAgdGhpcy5kcmFnSW5kaWNhdG9yVGV4dE5vZGUgPSBvd2Zkb2pvLnF1ZXJ5KCdzcGFuLmRkVGV4dCcsIHRoaXMuZHJhZ0luZGljYXRvcilbMF07DQoNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IGNmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgfHwgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlOw0KDQogICAgaWYgKGNmZy5rZWVwTW91c2VMaXN0ZW5lcnNBdHRhY2hlZCA9PT0gdW5kZWZpbmVkICYmIG93ZmRvam8uaXNJRSkgew0KICAgICAgICBjZmcua2VlcE1vdXNlTGlzdGVuZXJzQXR0YWNoZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIGlmIChjZmcuYXV0b0luaXQgfHwgY2ZnLmF1dG9Jbml0ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdGhpcy5pbml0KGNmZyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZmlyZU1vdXNlRXZlbnQoZWwsIHR5cGUsIG1zZykgew0KICAgICAgICB2YXIgZXZ0Ow0KICAgICAgICBpZihkb2N1bWVudC5jcmVhdGVFdmVudCkgew0KICAgICAgICAgICAgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7DQogICAgICAgICAgICBldnQuaW5pdE1vdXNlRXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSwgd2luZG93LCAxLCANCiAgICAgICAgICAgICAgICBtc2cuc2NyZWVuWCwgbXNnLnNjcmVlblksIG1zZy5wYWdlWCwgbXNnLnBhZ2VZLCANCiAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgbnVsbCwgbnVsbA0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGVsLmRpc3BhdGNoRXZlbnQoZXZ0KTsNCiAgICAgICAgfSBlbHNlIGlmKCBkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCApIHsNCiAgICAgICAgICAgIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7DQogICAgICAgICAgICBlbC5maXJlRXZlbnQoJ29uJyArIHR5cGUsIGV2dCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcignX2ZpcmVfbW91c2VfbW92ZScsIG93ZmRvam8uaGl0Y2godGhpcywgZnVuY3Rpb24obXNnKSB7DQoNCiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChtc2cucGFnZVgsIG1zZy5wYWdlWSk7DQoNCiAgICAgICAgaWYodGhpcy5nZXRGbGFzaFdpZGdldElkKCkpIHsNCiAgICAgICAgICAgIGlmKG1zZy5zZW5kZXIgIT09IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCkpIHsNCiAgICAgICAgICAgICAgICBPem9uZS51dGlsLmdldEZsYXNoQXBwKCkuZGlzcGF0Y2hFeHRlcm5hbE1vdXNlRXZlbnQobXNnLnBhZ2VYLCBtc2cucGFnZVkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5tb3VzZU1vdmUobXNnLCB0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmKCFhcmd1bWVudHMuY2FsbGVlLmxhc3RFbCkgew0KICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUubGFzdEVsID0gZWw7DQogICAgICAgICAgICAgICAgZmlyZU1vdXNlRXZlbnQoZWwsICdtb3VzZW92ZXInLCBtc2cpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZihhcmd1bWVudHMuY2FsbGVlLmxhc3RFbCAhPT0gZWwpIHsNCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdsYXN0RWwgJywgYXJndW1lbnRzLmNhbGxlZS5sYXN0RWwpOw0KICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2VsICcsIGVsKTsNCiAgICAgICAgICAgICAgICBmaXJlTW91c2VFdmVudChhcmd1bWVudHMuY2FsbGVlLmxhc3RFbCwgJ21vdXNlb3V0JywgbXNnKTsNCiAgICAgICAgICAgICAgICBmaXJlTW91c2VFdmVudChlbCwgJ21vdXNlb3ZlcicsIG1zZyk7DQogICAgICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZS5sYXN0RWwgPSBlbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZmlyZU1vdXNlRXZlbnQoZWwsICdtb3VzZW1vdmUnLCBtc2cpOw0KICAgICAgICB9DQoNCiAgICB9KSk7DQoNCiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcignX2ZpcmVfbW91c2VfdXAnLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIGZ1bmN0aW9uKG1zZykgew0KICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KG1zZy5wYWdlWCwgbXNnLnBhZ2VZKTsNCiAgICAgICAgaWYoZWwgJiYgZWwubm9kZU5hbWUgPT09ICdPQkpFQ1QnKSB7DQogICAgICAgICAgICB0aGlzLm1vdXNlVXAobXNnLCB0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZpcmVNb3VzZUV2ZW50KGVsLCAnbW91c2V1cCcsIG1zZyk7DQogICAgICAgIH0NCiAgICB9KSk7DQoNCiAgICBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5pbnN0YW5jZSA9IHRoaXM7DQogICAgcmV0dXJuIHRoaXM7DQp9Ow0KDQpPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5wcm90b3R5cGUgPSB7DQoNCiAgLy9wdWJsaWMgZXZlbnRzDQogIC8qKg0KICAgKiBAZmllbGQNCiAgICogQGRlc2NyaXB0aW9uIGRyYWdTdGFydCBpcyB0aGUgbmFtZSBvZiB0aGUgZXZlbnQgd2hlbiBhIGRyYWcgaXMgc3RhcnRlZC4gIFVzZSAnZHJhZ1N0YXJ0JyB3aXRoIHRoZSBhZGRDYWxsYmFjayBmdW5jdGlvbg0KICAgKiB0byBhZGQgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGEgZHJhZ1N0YXJ0IGV2ZW50IG9jY3Vycw0KICAgKiBAc2VlIDxhIGhyZWY9IiNhZGRDYWxsYmFjayI+YWRkQ2FsbGJhY2s8L2E+DQogICAqIEBleGFtcGxlDQogICAqDQogICAqICAvL3RoaXMud2RkIGlzIGEgaW5pdGlhbGl6ZWQgV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0DQogICAqICB0aGlzLndkZC5hZGRDYWxsYmFjaygnZHJhZ1N0YXJ0JyxmdW5jdGlvbigpIHsNCiAgICogICAgLy91c2UgdGhpcyBmdW5jdGlvbiB0byBjaGFuZ2Ugc3R5bGVzIG9yIGNoYW5nZSBzdGF0ZSB3aGVuIGEgZHJhZyBpcyBpbml0aWF0ZWQNCiAgICogICAgY21wLmRyYWdnaW5nID0gdHJ1ZTsNCiAgICogICAgY21wLmdldFZpZXcoKS5zY3JvbGxlci5hZGRDbHMoJ2RkT3ZlcicpOw0KICAgKiAgfSk7DQogICAqDQogICAqLw0KICBkcmFnU3RhcnQ6ICdkcmFnU3RhcnQnLA0KDQogIC8qKg0KICAgKiBAZmllbGQNCiAgICogQGRlc2NyaXB0aW9uIGRyYWdTdG9wIGlzIHRoZSBuYW1lIG9mIHRoZSBldmVudCB3aGVuIGEgZHJhZyBpcyBzdG9wcGVkLiAgVXNlICdkcmFnU3RvcCcgd2l0aCB0aGUgYWRkQ2FsbGJhY2sgZnVuY3Rpb24NCiAgICogdG8gYWRkIGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBhIGRyYWdTdG9wIGV2ZW50IG9jY3Vycw0KICAgKiBAc2VlIDxhIGhyZWY9IiNhZGRDYWxsYmFjayI+YWRkQ2FsbGJhY2s8L2E+DQogICAqIEBleGFtcGxlDQogICAqDQogICAqICAvL3RoaXMud2RkIGlzIGEgaW5pdGlhbGl6ZWQgV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0DQogICAqICB0aGlzLndkZC5hZGRDYWxsYmFjaygnZHJhZ1N0b3AnLGZ1bmN0aW9uKCkgew0KICAgKiAgICAvL3VzZSB0aGlzIGZ1bmN0aW9uIHRvIGNoYW5nZSBzdHlsZXMgb3IgY2hhbmdlIHN0YXRlIHdoZW4gYSBkcmFnIGlzIHN0b3BwZWQNCiAgICogICAgY21wLmRyYWdnaW5nID0gZmFsc2U7DQogICAqICAgIGNtcC5nZXRWaWV3KCkuc2Nyb2xsZXIucmVtb3ZlQ2xzKCdkZE92ZXInKTsNCiAgICogIH0pOw0KICAgKg0KICAgKi8NCiAgZHJhZ1N0b3A6ICdkcmFnU3RvcCcsDQoNCiAgLyoqDQogICAqIEBmaWVsZA0KICAgKiBAZGVzY3JpcHRpb24gZHJvcFJlY2VpdmUgaXMgdGhlIG5hbWUgb2YgdGhlIGV2ZW50IHdoZW4gYSBkcm9wIG9jY3VycyBvbiB0aGlzIHdpZGdldC4gIFRoaXMgZXZlbnQgaW5kaWNhdGVzIGEgc3VjY2Vzc2Z1bA0KICAgKiBkcmFnIGFuZCBkcm9wIGFuZCBkYXRhIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjayBmdW5jdGlvbi4gIFVzZSAnZHJvcFJlY2VpdmUnIHdpdGggdGhlIGFkZENhbGxiYWNrIGZ1bmN0aW9uDQogICAqIHRvIGFkZCBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gYSBkcm9wUmVjZWl2ZSBldmVudCBvY2N1cnMuICBUaGlzIGNhbGxiYWNrIGZ1bmN0aW9uIGZvciB0aGlzIGV2ZW50IHdpbGwgYmUgY2FsbGVkIGZvcg0KICAgKiBhbGwgc3VjY2Vzc2Z1bCBkcm9wcy4gIFRvIHN1cHBvcnQgbXVsdGlwbGUgZHJvcCB6b25lcyB1c2UgPGEgaHJlZj0iI2FkZERyb3Bab25lSGFuZGxlciI+YWRkRHJvcFpvbmVIYW5kbGVyPC9hPg0KICAgKiBAc2VlIDxhIGhyZWY9IiNhZGRDYWxsYmFjayI+YWRkQ2FsbGJhY2s8L2E+DQogICAqIEBleGFtcGxlDQogICAqDQogICAqICAvL3RoaXMud2RkIGlzIGEgaW5pdGlhbGl6ZWQgV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0DQogICAqICAgdGhpcy53ZGQuYWRkQ2FsbGJhY2soJ2Ryb3BSZWNlaXZlJyxmdW5jdGlvbihtc2cpIHsNCiAgICogICAgICAvL21zZy5kcmFnRHJvcERhdGEgY29udGFpbnMgdGhlIGRhdGEgLSB0aGlzIGV4YW1wbGUgdGhlIGRhdGEgaXMgYSBjaGFubmVsIG5hbWUgdGhhdCB3aWxsIGJlIHN1YnNjcmliZWQgdG8NCiAgICogICAgICB0aGlzLnN1YnNjcmliZVRvQ2hhbm5lbChtc2cuZHJhZ0Ryb3BEYXRhKTsNCiAgICogICB9LmJpbmQodGhpcykpOw0KICAgKi8NCiAgZHJvcFJlY2VpdmU6ICdkcm9wUmVjZWl2ZScsDQoNCiAgLy9wcml2YXRlIGV2ZW50cw0KICBkcmFnU3RhcnROYW1lOiAnX2RyYWdTdGFydCcsDQogIGRyYWdPdmVyV2lkZ2V0TmFtZTogJ19kcmFnT3ZlcldpZGdldCcsDQogIGRyYWdPdXROYW1lOiAnX2RyYWdPdXROYW1lJywNCiAgZHJhZ1N0b3BJbkNvbnRhaW5lck5hbWU6ICdfZHJhZ1N0b3BJbkNvbnRhaW5lcicsDQogIGRyYWdTdG9wSW5XaWRnZXROYW1lOiAnX2RyYWdTdG9wSW5XaWRnZXQnLA0KICBkcmFnU2VuZERhdGFOYW1lOiAiX2RyYWdTZW5kRGF0YSIsDQogIGRyb3BSZWNlaXZlRGF0YU5hbWU6ICJfZHJvcFJlY2VpdmVEYXRhIiwNCg0KICAvKioNCiAgICogQGZpZWxkDQogICAqIEBkZXNjcmlwdGlvbiB2ZXJzaW9uIG51bWJlcg0KICAgKi8NCiAgdmVyc2lvbjogT3pvbmUudmVyc2lvbi5vd2Z2ZXJzaW9uICsgT3pvbmUudmVyc2lvbi5kcmFnQW5kRHJvcCwNCg0KICAvKioNCiAgICogQGRlc2NyaXB0aW9uIEluaXRpYWxpemVzIHRoZSBXaWRnZXREcmFnQW5kRHJvcCBvYmplY3QuICBVc2luZyB0aGlzIGZ1bmN0aW9uIGlzIG9ubHkgcmVxdWlyZWQgaWYgYXV0b0luaXQgY29uZmlnIGlzIGZhbHNlDQogICAqIGluIHRoZSBjb25zdHJ1Y3Rvci4gIFRoaXMgZnVuY3Rpb24gaXMgc29tZXRpbWVzIHVzZWZ1bCB3aGVuIGl0IGlzIG5lY2Vzc2FyeSB0byBkZWZlciBkcmFnIGFuZCBkcm9wIGV2ZW50IGhhbmRsaW5nIGFmdGVyDQogICAqIGNyZWF0aW5nIHRoZSBPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcCBvYmplY3QNCiAgICogQHBhcmFtIHtPYmplY3R9IFtjZmddIGNvbmZpZyBvYmplY3QNCiAgICogQHNlZSA8YSBocmVmPSIjY29uc3RydWN0b3IiPmNvbnN0cnVjdG9yPC9hPg0KICAgKi8NCiAgaW5pdCA6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICBjZmcgPSBjZmcgfHwge307DQoNCiAgICAvL3N1YnNjcmliZSB0byBjaGFubmVscw0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnN1YnNjcmliZSh0aGlzLmRyYWdTdGFydE5hbWUsIG93ZmRvam8uaGl0Y2godGhpcywgdGhpcy5vblN0YXJ0RHJhZykpOw0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnN1YnNjcmliZSh0aGlzLmRyYWdPdXROYW1lLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIHRoaXMub25EcmFnT3V0KSk7DQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuc3Vic2NyaWJlKHRoaXMuZHJhZ1N0b3BJbkNvbnRhaW5lck5hbWUsIG93ZmRvam8uaGl0Y2godGhpcywgdGhpcy5vbkRyYWdTdG9wSW5Db250YWluZXIpKTsNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5zdWJzY3JpYmUodGhpcy5kcm9wUmVjZWl2ZURhdGFOYW1lLCBvd2Zkb2pvLmhpdGNoKHRoaXMsIHRoaXMuZHJvcFJlY2VpdmVEYXRhKSk7DQoNCiAgICBpZiAoY2ZnLmtlZXBNb3VzZUxpc3RlbmVyc0F0dGFjaGVkID09PSB0cnVlKSB7DQogICAgICB0aGlzLmtlZXBNb3VzZUxpc3RlbmVyc0F0dGFjaGVkID0gdHJ1ZTsNCg0KICAgICAgLy9ob29rIG1vdXNlIG1vdmUgYW5kIG1vdXNlIHVwDQogICAgICBpZiAodGhpcy5saXN0ZW5lcnMub25tb3VzZW1vdmUgPT0gbnVsbCkgew0KICAgICAgICB0aGlzLmxpc3RlbmVycy5vbm1vdXNlbW92ZSA9IG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ29ubW91c2Vtb3ZlJywgdGhpcywgdGhpcy5tb3VzZU1vdmUpOw0KICAgICAgfQ0KICAgICAgaWYgKHRoaXMubGlzdGVuZXJzLm9ubW91c2V1cCA9PSBudWxsKSB7DQogICAgICAgIHRoaXMubGlzdGVuZXJzLm9ubW91c2V1cCA9IG93ZmRvam8uY29ubmVjdChkb2N1bWVudCwgJ29ubW91c2V1cCcsIHRoaXMsIHRoaXMubW91c2VVcCk7DQogICAgICB9DQogICAgfQ0KICB9LA0KDQogIC8qKg0KICAgKiBAcHJpdmF0ZQ0KICAgKi8NCiAgY3JlYXRlRHJhZ0luZGljYXRvcjogZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiBvd2Zkb2pvLmNyZWF0ZSgnc3BhbicsIHsNCiAgICAgIGNsYXNzTmFtZTogJ2RkQm94IGRkQm94Q2Fubm90RHJvcCcsDQogICAgICBzdHlsZToge2Rpc3BsYXk6ICdub25lJ30sDQogICAgICBpbm5lckhUTUw6ICc8c3BhbiBjbGFzcz0iZGRUZXh0Ij4nICsgdGhpcy5kcmFnSW5kaWNhdG9yVGV4dCArICc8L3NwYW4+Jw0KICAgIH0sDQogICAgb3dmZG9qby5ib2R5KCkNCiAgICApOw0KICB9LA0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gU3RhcnRzIGEgZHJhZy4gIFRoZSBjb25maWcgb2JqZWN0IHBhc3NlZCBpbiBkZXNjcmliZXMgdGhlIGRyYWcgYW5kIGNvbnRhaW5zIHRoZSBkYXRhIHRvIGJlIHBhc3NlZCB0byB0aGUgZHJvcC4NCiAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdw0KICAgKiBAcGFyYW0ge1N0cmluZ30gY2ZnLmRyYWdEcm9wTGFiZWwgTmFtZSB0byBiZSB1c2VkIGFzIHRleHQgZm9yIHRoZSBkcmFnRHJvcCBpbmRpY2F0b3INCiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5kcmFnRHJvcERhdGEgRGF0YSB0byBiZSBzZW50IG9uIGEgc3VjY2Vzc2Z1bCBkcmFnIGFuZCBkcm9wLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHNlbnQgdG8gdGhlDQogICAqIHN1Y2Nlc3NmdWwgcmVjaXBpZW50IG9mIHRoZSBkcmFnICh0aGUgZHJvcFJlY2VpdmUgZXZlbnQpLiAgSXQgd2lsbCBub3QgYmUgc2VudCBmb3Igb3RoZXIgZXZlbnRzLg0KICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLmRyYWdab25lIGRvbSBub2RlIHdoaWNoIHByZXNlbnRzIGEgZHJhZ1pvbmUgd2hpY2ggaXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZHJhZy4gIFRoaXMgcHJvcGVydHkgaXMNCiAgICogb25seSBzYXZlZCBhbmQgdXNlZCBsb2NhbGx5IHRvIHRoZSB3aWRnZXQgdG8gaWRlbnRpZnkgd2hldGhlciBhIGRyYWdab25lIGlzIGluIGZhY3QgdGhlIG5vZGUgYXMgYSBkcm9wWm9uZS4gIEl0IHdpbGwgbm90IGJlDQogICAqIHNlbnQgdG8gb3RoZXIgZXZlbnRzIGNhbGxiYWNrcy4NCiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy4qIG90aGVyIGN1c3RvbSBwcm9wZXJ0aWVzIG1heSBiZSBzcGVjaWZpZWQsIHRoZXNlIHdpbGwgYmUgcGFzc2VkIGFsb25nIHRvIGV2ZW50IGhhbmRsZXJzDQogICAqIEBleGFtcGxlDQogICAqDQogICAqICAvL2FkZCBoYW5kbGVyIHRvIHRleHQgZmllbGQgZm9yIGRyYWdnaW5nDQogICAqICBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyYWdTb3VyY2UnKSwnb25tb3VzZWRvd24nLHRoaXMsZnVuY3Rpb24oZSkgew0KICAgKiAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICogICAgICB2YXIgZGF0YSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdJbnB1dENoYW5uZWwnKS52YWx1ZTsNCiAgICogICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGRhdGEgIT0gJycpIHsNCiAgICogICAgICAgIHRoaXMud2RkLmRvU3RhcnREcmFnKHsNCiAgICogICAgICAgICAgICBkcmFnRHJvcExhYmVsOiBkYXRhLA0KICAgKiAgICAgICAgICAgIGRyYWdab25lOiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyYWdab25lJyksDQogICAqICAgICAgICAgICAgZHJhZ0Ryb3BHcm91cDogJ2xvY2F0aW9uJywgIC8vZXh0cmEgcHJvcGVydHkgdG8gcGFzcyBhbG9uZw0KICAgKiAgICAgICAgICAgIGRyYWdEcm9wRGF0YTogZGF0YQ0KICAgKiAgICAgICAgfSk7DQogICAqICAgICAgfQ0KICAgKiAgfSk7DQogICAqLw0KICBkb1N0YXJ0RHJhZyA6IGZ1bmN0aW9uIChjZmcpIHsNCg0KICAgIHZhciBkcmFnU3RhcnRDZmcgPSB7DQogICAgICBkcmFnU291cmNlSWQ6IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCkNCiAgICB9Ow0KDQogICAgdGhpcy5kcmFnWm9uZSA9IGNmZy5kcmFnWm9uZTsNCg0KICAgIC8vYWxsb3cgY2FsbGVyIHRvIHBhc3MgZXh0cmEgcHJvcGVydGllcyB0byBkcmFnU3RhcnQNCiAgICAvL2JlIHN1cmUgdG8gbm90IHNlbmQgdGhlIGRyYWdEcm9wRGF0YQ0KICAgIG93ZmRvam8ubWl4aW4oZHJhZ1N0YXJ0Q2ZnLGNmZyk7DQogICAgZGVsZXRlIGRyYWdTdGFydENmZy5kcmFnRHJvcERhdGE7DQogICAgZGVsZXRlIGRyYWdTdGFydENmZy5kcmFnWm9uZTsNCg0KICAgIC8vc3RhcnQgZHJhZw0KICAgIHRoaXMub25TdGFydERyYWcodGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIuZ2V0V2lkZ2V0SWQoKSxkcmFnU3RhcnRDZmcpOw0KDQogICAgLy9zZW5kIG1lc3NhZ2UgdG8gc3RhcnQgZHJhZ2dpbmcgZm9yIG90aGVyIHdpZGdldHMgLSB1bnN1YnNjcmliZSBzbyB3ZSBkb24ndCByZXBlYXQgb25zdGFydGRyYWcNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci51bnN1YnNjcmliZSh0aGlzLmRyYWdTdGFydE5hbWUpOw0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnB1Ymxpc2godGhpcy5kcmFnU3RhcnROYW1lLCBkcmFnU3RhcnRDZmcpOw0KICAgIHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnN1YnNjcmliZSh0aGlzLmRyYWdTdGFydE5hbWUsIG93ZmRvam8uaGl0Y2godGhpcywgdGhpcy5vblN0YXJ0RHJhZykpOw0KDQogICAgLy9zZW5kIGRhdGEgdG8gY29udGFpbmVyDQogICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucHVibGlzaCh0aGlzLmRyYWdTZW5kRGF0YU5hbWUsIG93ZmRvam8ubWl4aW4oew0KICAgICAgZHJhZ1NvdXJjZUlkOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpDQogICAgfSxjZmcpLCcuLicpOw0KDQogIH0sDQoNCiAgLyoqDQogICAqIEBwcml2YXRlDQogICAqLw0KICBvblN0YXJ0RHJhZyA6IGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7DQoNCiAgICB0aGlzLmRyYWdnaW5nID0gdHJ1ZTsNCg0KICAgIHRoaXMuZHJhZ1N0YXJ0RGF0YSA9IG1zZzsNCg0KICAgIGlmIChvd2Zkb2pvLmlzRnVuY3Rpb24odGhpcy5jYWxsYmFja3NbdGhpcy5kcmFnU3RhcnRdKSkgew0KICAgICAgLy9leGVjdXRlIGNhbGxiYWNrIGlmIGZhbHNlIGlzIHJldHVybmVkIGRvbid0IGNvbnRpbnVlDQogICAgICBpZiAodGhpcy5jYWxsYmFja3NbdGhpcy5kcmFnU3RhcnRdKHNlbmRlcixtc2cpID09PSBmYWxzZSkgew0KICAgICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvL3ByZXZlbnQgSUUgYnVnIHdoZXJlIHRleHQgaXMgZHJhZ2dlZCBpbnN0ZWFkIG9mIHRoZSBub2RlDQogICAgaWYgKG93ZmRvam8uaXNJRSkgew0KICAgICAgZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9Ow0KICAgICAgZG9jdW1lbnQub25kcmFnc3RhcnQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgdGhpcy5kcmFnSW5kaWNhdG9yVGV4dCA9IG1zZy5kcmFnRHJvcExhYmVsOw0KICAgIHRoaXMuZHJhZ0luZGljYXRvclRleHROb2RlLmlubmVySFRNTCA9IHRoaXMuZHJhZ0luZGljYXRvclRleHQ7DQoNCiAgICAvL2hvb2sgbW91c2UgbW92ZSBhbmQgbW91c2UgdXANCiAgICBpZiAodGhpcy5saXN0ZW5lcnMub25tb3VzZW1vdmUgPT0gbnVsbCkgew0KICAgICAgdGhpcy5saXN0ZW5lcnMub25tb3VzZW1vdmUgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbm1vdXNlbW92ZScsIHRoaXMsIHRoaXMubW91c2VNb3ZlKTsNCiAgICB9DQogICAgaWYgKHRoaXMubGlzdGVuZXJzLm9ubW91c2V1cCA9PSBudWxsKSB7DQogICAgICB0aGlzLmxpc3RlbmVycy5vbm1vdXNldXAgPSBvd2Zkb2pvLmNvbm5lY3QoZG9jdW1lbnQsICdvbm1vdXNldXAnLCB0aGlzLCB0aGlzLm1vdXNlVXApOw0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQHByaXZhdGUNCiAgICovDQogIG9uRHJhZ091dCA6IGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7DQogICAgb3dmZG9qby5zdHlsZSh0aGlzLmRyYWdJbmRpY2F0b3IsIHsNCiAgICAgIGRpc3BsYXk6ICdub25lJw0KICAgIH0pOw0KICB9LA0KDQogIC8qKg0KICAgKiBAcHJpdmF0ZQ0KICAgKi8NCiAgZ2V0TW91c2VDb29yZGluYXRlczogZnVuY3Rpb24gKGUpIHsNCiAgICB2YXIgcmV0dXJuVmFsdWUgPSBudWxsOw0KICAgIGlmIChlLnBhZ2VYIHx8IGUucGFnZVkpIHsNCiAgICAgIHJldHVyblZhbHVlID0gew0KICAgICAgICB4IDogZS5wYWdlWCwNCiAgICAgICAgeSA6IGUucGFnZVkNCiAgICAgIH07DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgcmV0dXJuVmFsdWUgPSB7DQogICAgICAgIHggOiBlLmNsaWVudFggKyBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgLSBkb2N1bWVudC5ib2R5LmNsaWVudExlZnQsDQogICAgICAgIHkgOiBlLmNsaWVudFkgKyBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCAtIGRvY3VtZW50LmJvZHkuY2xpZW50VG9wDQogICAgICB9Ow0KICAgIH0NCiAgICByZXR1cm4gcmV0dXJuVmFsdWU7DQogIH0sDQoNCiAgICAvKioNCiAgICAqIEBwcml2YXRlDQogICAgKi8NCiAgICBtb3VzZU1vdmUgOiBmdW5jdGlvbiAoZSwgZmFrZSkgew0KICAgICAgICAvL29ubHkgc2hvdyB0aGUgaW5kaWNhdG9yIGlmIHdlIGFyZSBjdXJyZW5sdHkgZHJhZ2dpbmcNCiAgICAgICAgaWYgKHRoaXMuZHJhZ2dpbmcgPT09IHRydWUpIHsNCg0KICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGZsZXggd2lkZ2V0LCBldmVudCBpcyBub3QgZmFrZWQgYW5kIGN1cnJlbnQgZGFzaGJvYXJkIGxheW91dCBpcyB0YWJiZWQsIGZha2UgDQogICAgICAgICAgICAvLyBtb3VzZSBldmVudHMgYXMgc29vbiBhcyB0aGUgZHJhZyBzdGFydHMNCiAgICAgICAgICAgIGlmKHRoaXMuZ2V0Rmxhc2hXaWRnZXRJZCgpICYmIGZha2UgIT09IHRydWUgJiYgT3pvbmUuV2lkZ2V0LmdldERhc2hib2FyZExheW91dCgpID09PSAndGFiYmVkJykgew0KICAgICAgICAgICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsICdfZmFrZV9tb3VzZV9tb3ZlJywgbnVsbCwgew0KICAgICAgICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksDQogICAgICAgICAgICAgICAgICAgIHBhZ2VYOiBlLnBhZ2VYLA0KICAgICAgICAgICAgICAgICAgICBwYWdlWTogZS5wYWdlWSwNCiAgICAgICAgICAgICAgICAgICAgc2NyZWVuWDogZS5zY3JlZW5YLA0KICAgICAgICAgICAgICAgICAgICBzY3JlZW5ZOiBlLnNjcmVlblkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBjbGllbnRXaWR0aCA9IG51bGw7DQogICAgICAgICAgICB2YXIgY2xpZW50SGVpZ2h0ID0gbnVsbDsNCiAgICAgICAgICAgIHZhciBtb3VzZVBvc2l0aW9uID0gdGhpcy5nZXRNb3VzZUNvb3JkaW5hdGVzKGUpOw0KICAgICAgICAgICAgdmFyIGxlZnRXaWR0aCA9IG1vdXNlUG9zaXRpb24ueDsNCiAgICAgICAgICAgIHZhciB0b3BIZWlnaHQgPSBtb3VzZVBvc2l0aW9uLnk7DQoNCiAgICAgICAgICAgIC8vIEhpZGUgdGhlIGRyYWcgaW5kaWNhdG9yIGJveCB3aGlsZSB3ZSBtb3ZlIGl0DQogICAgICAgICAgICBvd2Zkb2pvLnN0eWxlKHRoaXMuZHJhZ0luZGljYXRvciwgew0KICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBlID0gd2luZG93LmV2ZW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAob3dmZG9qby5pc0lFKSB7DQogICAgICAgICAgICAgICAgY2xpZW50V2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOw0KICAgICAgICAgICAgICAgIGNsaWVudEhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY2xpZW50V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsNCiAgICAgICAgICAgICAgICBjbGllbnRIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKChvd2Zkb2pvLmlzRkYgJiYgb3dmZG9qby5pc0ZGID49IDQpIHx8IHRoaXMuZ2V0Rmxhc2hXaWRnZXRJZCgpKSB7DQoNCiAgICAgICAgICAgICAgICBpZihlLmNsaWVudFggPCAwIHx8IGUuY2xpZW50WCA+IGNsaWVudFdpZHRoIHx8IA0KICAgICAgICAgICAgICAgICAgICBlLmNsaWVudFkgPCAwIHx8IGUuY2xpZW50WSA+IGNsaWVudEhlaWdodCkgew0KDQogICAgICAgICAgICAgICAgICAgIC8vIHNldCB2YXJpYWJsZSBvbiBmdW5jdGlvbiB0byBrZWVwIHRyYWNrIGlmIHdlIGZha2VkIGFuIGV2ZW50DQogICAgICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIGZha2UgbW91c2VvdXQgbGF0ZXIgd2hlbiBtb3VzZW92ZXIgdGhlIGN1cnJlbnQgd2lkZ2V0DQogICAgICAgICAgICAgICAgICAgIGlmKCFhcmd1bWVudHMuY2FsbGVlLl9mYWtlRXZlbnRDb3VudGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZS5fZmFrZUV2ZW50Q291bnRlciA9IDE7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUuX2Zha2VFdmVudENvdW50ZXIgKz0gMTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ19mYWtlX21vdXNlX21vdmUnLCBudWxsLCB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCksDQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlWDogZS5wYWdlWCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VZOiBlLnBhZ2VZLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuWDogZS5zY3JlZW5YLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuWTogZS5zY3JlZW5ZDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYoIGFyZ3VtZW50cy5jYWxsZWUuX2Zha2VFdmVudENvdW50ZXIgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhZCBmYWtlZCBhIG1vdXNlbW92ZSBldmVudCBiZWZvcmUNCiAgICAgICAgICAgICAgICAgICAgLy8gbm93IGZha2UgbW91c2VvdXQgZXZlbnQgb24gdGhlIGNvbnRhaW5lcg0KICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHMuY2FsbGVlLl9mYWtlRXZlbnRDb3VudGVyID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCAnX2Zha2VfbW91c2Vfb3V0Jyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBmbGlwcGluZyBtZWNoYW5pc20gd2hlbiB0aGUgY3Vyc29yIHJlYWNoZXMgdGhlIHJpZ2h0IG9yIGJvdHRvbSBlZGdlIG9mIHRoZSB3aWRnZXQNCiAgICAgICAgICAgIHRoaXMuZHJhZ0luZGljYXRvci5zdHlsZS50b3AgPSB0b3BIZWlnaHQgKyAxOSArICJweCI7DQoNCiAgICAgICAgICAgIHZhciByaWdodExpbWl0ID0gY2xpZW50V2lkdGggLSAxMDA7DQogICAgICAgICAgICBpZiAoKGxlZnRXaWR0aCA8IGNsaWVudFdpZHRoKSAmJiAobGVmdFdpZHRoID4gcmlnaHRMaW1pdCkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmRyYWdJbmRpY2F0b3Iuc3R5bGUubGVmdCA9IGxlZnRXaWR0aCAtIDg4ICsgInB4IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0luZGljYXRvci5zdHlsZS5sZWZ0ID0gbGVmdFdpZHRoICsgMTIgKyAicHgiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGJvdHRvbUxpbWl0ID0gY2xpZW50SGVpZ2h0IC0gNDA7DQogICAgICAgICAgICBpZiAoKHRvcEhlaWdodCA+IGJvdHRvbUxpbWl0KSAmJiAodG9wSGVpZ2h0IDwgY2xpZW50SGVpZ2h0KSkgew0KICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0luZGljYXRvci5zdHlsZS50b3AgPSB0b3BIZWlnaHQgLSAzMCArICJweCI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHNldCB0ZXh0IG9uIGluZGljYXRvcg0KICAgICAgICAgICAgdGhpcy5kcmFnSW5kaWNhdG9yVGV4dE5vZGUuaW5uZXJIVE1MID0gdGhpcy5kcmFnSW5kaWNhdG9yVGV4dDsNCiAgICAgICAgICAgIG93ZmRvam8uc3R5bGUodGhpcy5kcmFnSW5kaWNhdG9yLCB7DQogICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgLyoqDQogICAqIEBwcml2YXRlDQogICAqLw0KICBvbkRyYWdTdG9wSW5Db250YWluZXIgOiBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KICAgIG93ZmRvam8uc3R5bGUodGhpcy5kcmFnSW5kaWNhdG9yLCB7DQogICAgICBkaXNwbGF5OiAnbm9uZScNCiAgICB9KTsNCiAgICAvL2Rpc2Nvbm5lY3QgbGlzdGVuZXJzDQogICAgaWYgKCF0aGlzLmtlZXBNb3VzZUxpc3RlbmVyc0F0dGFjaGVkKSB7DQogICAgICBmb3IgKGwgaW4gdGhpcy5saXN0ZW5lcnMpIHsNCiAgICAgICAgb3dmZG9qby5kaXNjb25uZWN0KHRoaXMubGlzdGVuZXJzW2xdKTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNbbF0gPSBudWxsOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsNCiAgICB0aGlzLmRyYWdTdGFydERhdGEgPSBudWxsOw0KICAgIHRoaXMuZHJhZ1pvbmUgPSBudWxsOw0KICAgIHRoaXMuc2V0RHJvcEVuYWJsZWQoZmFsc2UpOw0KDQogICAgaWYgKG93ZmRvam8uaXNGdW5jdGlvbih0aGlzLmNhbGxiYWNrc1t0aGlzLmRyYWdTdG9wXSkpIHsNCiAgICAgIHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJhZ1N0b3BdKHRoaXMuZHJvcFRhcmdldCk7DQogICAgfQ0KICB9LA0KDQogIC8qKg0KICAgKiBAcHJpdmF0ZQ0KICAgKi8NCiAgbW91c2VVcCA6IGZ1bmN0aW9uIChlLCBmYWtlKSB7DQogICAgaWYgKHRoaXMuZHJhZ2dpbmcgPT09IHRydWUpIHsNCiAgICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsNCg0KICAgICAgLy9wcmV2ZW50IElFIGJ1ZyB3aGVyZSB0ZXh0IGlzIGRyYWdnZWQgaW5zdGVhZCBvZiB0aGUgbm9kZQ0KICAgICAgaWYgKG93ZmRvam8uaXNJRSkgew0KICAgICAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH07DQogICAgICAgIGRvY3VtZW50Lm9uZHJhZ3N0YXJ0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBvd2Zkb2pvLnN0eWxlKHRoaXMuZHJhZ0luZGljYXRvciwgew0KICAgICAgICBkaXNwbGF5OiAnbm9uZScNCiAgICAgIH0pOw0KDQogICAgICBpZih0aGlzLmdldEZsYXNoV2lkZ2V0SWQoKSkgew0KDQogICAgICAgICAgdmFyIGNsaWVudFdpZHRoID0gbnVsbDsNCiAgICAgICAgICB2YXIgY2xpZW50SGVpZ2h0ID0gbnVsbDsNCiAgICAgICAgICBpZiAob3dmZG9qby5pc0lFKSB7DQogICAgICAgICAgICAgIGNsaWVudFdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsNCiAgICAgICAgICAgICAgY2xpZW50SGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICBjbGllbnRXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOw0KICAgICAgICAgICAgICBjbGllbnRIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYoKGUuY2xpZW50WCA8IDAgfHwgZS5jbGllbnRYID4gY2xpZW50V2lkdGggfHwgDQogICAgICAgICAgICAgICAgZS5jbGllbnRZIDwgMCB8fCBlLmNsaWVudFkgPiBjbGllbnRIZWlnaHQNCiAgICAgICAgICAgICAgICB8fCBPem9uZS5XaWRnZXQuZ2V0RGFzaGJvYXJkTGF5b3V0KCkgPT09ICd0YWJiZWQnKQ0KICAgICAgICAgICAgICAgICYmIGZha2UgIT09IHRydWUpIHsNCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgIGdhZGdldHMucnBjLmNhbGwoJy4uJywgJ19mYWtlX21vdXNlX3VwJywgbnVsbCwgew0KICAgICAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpLA0KICAgICAgICAgICAgICAgICAgcGFnZVg6IGUucGFnZVgsDQogICAgICAgICAgICAgICAgICBwYWdlWTogZS5wYWdlWSwNCiAgICAgICAgICAgICAgICAgIHNjcmVlblg6IGUuc2NyZWVuWCwNCiAgICAgICAgICAgICAgICAgIHNjcmVlblk6IGUuc2NyZWVuWQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgLy9kaXNjb25uZWN0IGxpc3RlbmVycw0KICAgICAgZm9yIChsIGluIHRoaXMubGlzdGVuZXJzKSB7DQogICAgICAgIG93ZmRvam8uZGlzY29ubmVjdCh0aGlzLmxpc3RlbmVyc1tsXSk7DQogICAgICAgIHRoaXMubGlzdGVuZXJzW2xdID0gbnVsbDsNCiAgICAgIH0NCg0KICAgICAgLy9zYXZlIGRyb3B6b25lIGluZm8NCiAgICAgIHRoaXMuZHJvcFRhcmdldCA9IGUudGFyZ2V0Ow0KDQogICAgICAvL3NlbmQgbWVzc2FnZQ0KICAgICAgdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucHVibGlzaCh0aGlzLmRyYWdTdG9wSW5XaWRnZXROYW1lLCB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpKTsNCg0KICAvLyAgICBpZiAob3dmZG9qby5pc0Z1bmN0aW9uKHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJhZ1N0b3BdKSkgew0KICAvLyAgICAgIHRoaXMuY2FsbGJhY2tzW3RoaXMuZHJhZ1N0b3BdKHRoaXMuZHJvcFRhcmdldCk7DQogIC8vICAgIH0NCiAgICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQHByaXZhdGUNCiAgICovDQogIGRyb3BSZWNlaXZlRGF0YSA6IGZ1bmN0aW9uIChzZW5kZXIsIG1zZywgY2hhbm5lbCkgew0KDQogICAgLy9vbmx5IGlmIHRoZSBtb3VzZSBpcyBvdmVyIGEgZHJvcCB6b25lDQogICAgaWYgKHRoaXMuZHJvcEVuYWJsZWRGbGFnKSB7DQogICAgICBpZiAodGhpcy5kcm9wVGFyZ2V0KSB7DQogICAgICAgIG1zZy5kcm9wVGFyZ2V0ID0gdGhpcy5kcm9wVGFyZ2V0Ow0KDQogICAgICAgIC8vZmluZCBpZiB3ZSBoYXZlIGFueSBkcm9wem9uZSBoYW5kbGVycyBmb3IgdGhlIGRyb3B6b25lIHVzZWQgYW5kIGV4ZWN1dGUNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRyb3Bab25lSGFuZGxlcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAvL21hdGNoIGVpdGhlciBvbiBpZCBvciBjbGFzcyBvciBpcyB0YXJnZXQgbm9kZSBhIGNoaWxkIG9mIHRoZSBkcm9wWm9uZQ0KICAgICAgICAgIC8vYWxzbyBtYWtlIHN1cmUgdGhlIGRyb3Bab25lIGlzIG5vdCB0aGUgc2FtZSBhcyB0aGUgZHJhZ1pvbmUNCiAgICAgICAgICBpZiAoKCh0aGlzLmRyb3BUYXJnZXQuaWQgPT0gdGhpcy5kcm9wWm9uZUhhbmRsZXJzW2ldLmlkICYmIHRoaXMuZHJvcFRhcmdldC5pZCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgfHwgKG93ZmRvam8uaGFzQ2xhc3ModGhpcy5kcm9wVGFyZ2V0LCB0aGlzLmRyb3Bab25lSGFuZGxlcnNbaV0uY2xhc3NOYW1lKSkNCiAgICAgICAgICAgICAgICAgIHx8IChvd2Zkb2pvLmlzRGVzY2VuZGFudCh0aGlzLmRyb3BUYXJnZXQsIHRoaXMuZHJvcFpvbmVIYW5kbGVyc1tpXS5kcm9wWm9uZSkpKQ0KICAgICAgICAgICAgICAgICAgJiYgdGhpcy5kcmFnWm9uZSAhPSB0aGlzLmRyb3Bab25lSGFuZGxlcnNbaV0uZHJvcFpvbmUNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgdGhpcy5kcm9wWm9uZUhhbmRsZXJzW2ldLmhhbmRsZXIobXNnKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL2NsZWFyIGRyb3BUYXJnZXQgYmVjYXVzZSB0aGUgZHJvcCBpcyBvdmVyDQogICAgICAgIHRoaXMuZHJvcFRhcmdldCA9IG51bGw7DQogICAgICB9DQoNCiAgICAgIC8vbm90aWZ5IHRoYXQgYSBkcm9wIGhhcyBoYXBwZW5lZCBhbmQgc2VuZCB0aGUgZGF0YQ0KICAgICAgaWYgKG93ZmRvam8uaXNGdW5jdGlvbih0aGlzLmNhbGxiYWNrc1t0aGlzLmRyb3BSZWNlaXZlXSkpIHsNCiAgICAgICAgdGhpcy5jYWxsYmFja3NbdGhpcy5kcm9wUmVjZWl2ZV0obXNnKTsNCiAgICAgIH0NCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBBZGRzIGEgZnVuY3Rpb24gYXMgYSBjYWxsYmFjayB0byBEcmFnIGFuZCBEcm9wIGV2ZW50cy4gIFRoaXMgZnVuY3Rpb24gc3VwcG9ydHMgbXVsdGlwbGUgY2FsbGJhY2tzIGZvcg0KICAgKiB0aGUgc2FtZSBldmVudCBieSBhbGxvd2luZyB0aGUgdXNlciBjYWxsIGl0IG1vcmUgdGhhbiBvbmNlIHdpdGggZGlmZmVyZW50IGNhbGxiYWNrIGZ1bmN0aW9ucw0KICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIFRoZSBldmVudCBuYW1lLg0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYiBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBhcyBhIGNhbGxiYWNrLg0KICAgKiBAc2VlIDxhIGhyZWY9IiNkcmFnU3RhcnQiPmRyYWdTdGFydCBFdmVudDwvYT4gLQ0KICAgKiB0aGUgY2FsbGJhY2sgZm9yIHRoZSBkcmFnU3RhcnQgZXZlbnQgaXMgY2FsbGVkIHdpdGggdGhlIHNhbWUgY29uZmlnIG9iamVjdCB1c2VkIGluIHRoZSA8YSBocmVmPSIjZG9TdGFydERyYWciPmRvU3RhcnREcmFnPC9hPiBmdW5jdGlvbg0KICAgKiB3aXRoIHRoZSBleGNlcHRpb24gb2YgdGhlIGRyYWdEcm9wRGF0YSBhbmQgdGhlIGRyYWdab25lIHByb3BlcnRpZXMuDQogICAqIEBzZWUgPGEgaHJlZj0iI2RyYWdTdG9wIj5kcmFnU3RvcCBFdmVudDwvYT4gLQ0KICAgKiBJZiB0aGUgZHJhZyBzdG9wcGVkIGluIHRoZSBzYW1lIHdpZGdldCB0aGF0IHN0YXJ0ZWQgdGhlIGRyYWcgdGhlIGNhbGxiYWNrIGZvciBkcmFnU3RvcCB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZSBkcm9wVGFyZ2V0DQogICAqIEhUTUwgbm9kZSBvdGhlcndpc2UgdGhlIGZpcnN0IGFyZ3VtZW50IHdpbGwgYmUgbnVsbC4NCiAgICogQHNlZSA8YSBocmVmPSIjZHJvcFJlY2VpdmUiPmRyb3BSZWNlaXZlIEV2ZW50PC9hPiAtDQogICAqIHRoZSBjYWxsYmFjayBmb3IgdGhlIGRyb3BSZWNlaXZlIGV2ZW50IGlzIGNhbGxlZCBmb3IgYW55IGRyb3AgdGhhdCBvY2N1cnMgb24gYSB3aWRnZXQuICBJZiBvbmUgaGFzIG11bHRpcGxlIGRyb3Bab25lcw0KICAgKiBpbiBhIHdpZGdldCBpdCBpcyBlYXNpZXIgdG8gdXNlIDxhIGhyZWY9IiNhZGREcm9wWm9uZUhhbmRsZXIiPmFkZERyb3Bab25lSGFuZGxlcjwvYT4NCiAgICogQGV4YW1wbGUNCiAgICogLy9leGFtcGxlIGRyYWdTdGFydCBoYW5kbGVyIHdoaWNoIGhpZ2hsaWdodHMgYW4gRXh0IEdyaWQgd2hlbiBhIGRyYWcgb2NjdXJzDQogICAqIHRoaXMud2RkLmFkZENhbGxiYWNrKCdkcmFnU3RhcnQnLCAoZnVuY3Rpb24oc2VuZGVyLCBtc2cpew0KICAgKiAgICAgIC8vZ2V0IHRoZSBFeHQgR3JpZA0KICAgKiAgICAgIHZhciBncmlkID0gdGhpcy5nZXRDb21wb25lbnQodGhpcy5ncmlkSWQpOw0KICAgKg0KICAgKiAgICAgIC8vY2hlY2sgY3VzdG9tIGRyYWdEcm9wR3JvdXAgcHJvcGVydHkgdG8gc2VlIGlmIHRoZSBkcmFnIGlzIG1lYW50IGZvciB0aGlzIGdyaWQNCiAgICogICAgICAvL2lmIHNvIGhpZ2hsaWdodCB0aGUgZ3JpZCBieSBhZGRpbmcgdGhlIGRkT3ZlciBjbGFzcw0KICAgKiAgICAgIGlmIChncmlkICYmIG1zZyAhPSBudWxsICYmIG1zZy5kcmFnRHJvcEdyb3VwID09ICd1c2VycycpIHsNCiAgICogICAgICAgICAgZ3JpZC5nZXRWaWV3KCkuc2Nyb2xsZXIuYWRkQ2xhc3MoJ2RkT3ZlcicpOw0KICAgKiAgICAgIH0NCiAgICogIH0pLmNyZWF0ZURlbGVnYXRlKHRoaXMpKTsgIC8vY3JlYXRlRGVsZWdhdGUgaXMgYW4gRXh0IGZ1bmN0aW9uIHdoaWNoIHNldHMgdGhlIHNjb3BlDQogICAqDQogICAqICAvL3RoaXMud2RkIGlzIGEgaW5pdGlhbGl6ZWQgV2lkZ2V0RHJhZ0FuZERyb3Agb2JqZWN0DQogICAqICAgdGhpcy53ZGQuYWRkQ2FsbGJhY2soJ2Ryb3BSZWNlaXZlJyxvd2Zkb2pvLmhpdGNoKHRoaXMsZnVuY3Rpb24obXNnKSB7DQogICAqICAgICAgLy9tc2cuZHJhZ0Ryb3BEYXRhIGNvbnRhaW5zIHRoZSBkYXRhDQogICAqICAgICAgLy90aGlzIGV4YW1wbGUgdGhlIGRhdGEgaXMgYSBjaGFubmVsIG5hbWUgdGhhdCB3aWxsIGJlIHN1YnNjcmliZWQgdG8NCiAgICogICAgICB0aGlzLnN1YnNjcmliZVRvQ2hhbm5lbChtc2cuZHJhZ0Ryb3BEYXRhKTsNCiAgICogICB9KSk7DQogICAqLw0KICBhZGRDYWxsYmFjayA6IGZ1bmN0aW9uKGV2ZW50TmFtZSwgY2IpIHsNCg0KICAgIGlmICh0aGlzLmNhbGxiYWNrc1tldmVudE5hbWVdID09IG51bGwpIHsNCiAgICAgIC8vcHV0IGR1bW15IGZ1bmN0aW9uIGluDQogICAgICB0aGlzLmNhbGxiYWNrc1tldmVudE5hbWVdID0gY2I7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgLy9jYWxsYmFjayBhbHJlYWR5IGV4aXN0cyBjaGFpbiB0aGUgc3Vic2VxdWVudCBjYWxsYmFja3MgdG8gdGhlIGZpcnN0DQogICAgICBvd2Zkb2pvLmNvbm5lY3QodGhpcy5jYWxsYmFja3MsZXZlbnROYW1lLGNiKTsNCiAgICB9DQogIH0sDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gQWRkcyBhIG5ldyBkcm9wIHpvbmUgdG8gYmUgbWFuYWdlZC4gIFRoZSBoYW5kbGVyIGZ1bmN0aW9uIGRlZmluZWQgaW4gdGhlIGNmZyBvYmplY3Qgd2lsbCBiZSBjYWxsZWQgd2hlbg0KICAgKiBhIGRyb3Agb2NjdXJzIG92ZXIgYSBkb20gbm9kZSB3aGljaCBtYXRjaGVzIHRoZSBpZCBvciB0aGUgY2xhc3NOYW1lIG9yIGlzIGVxdWFsIHRvIG9yIGEgY2hpbGQgb2YgdGhlIGRyb3BUYXJnZXQgbm9kZQ0KICAgKiBAc2VlIGRvU3RhcnREcmFnDQogICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cNCiAgICogQHBhcmFtIHtjbGFzc05hbWV9IGNmZy5jbGFzcyBjbGFzcyBvZiB0aGUgZHJvcFpvbmUNCiAgICogQHBhcmFtIHtTdHJpbmd9IGNmZy5pZCBJZCBvZiB0aGUgZHJvcFpvbmUNCiAgICogQHBhcmFtIHtOb2RlfSBjZmcuZHJvcFpvbmUgSFRNTCBub2RlIHdoaWNoIHJlcHJlc2VudHMgdGhlIGRyb3Bab25lDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5oYW5kbGVyIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIGEgZHJvcCBvY2N1cnMgb3ZlciB0aGUgZHJvcFpvbmUuICBBIG1zZyBvYmplY3Qgd2lsbCBiZSBwYXNzZWQgaW4NCiAgICoNCiAgICogQGV4YW1wbGUNCiAgICogLy9FeGFtcGxlIGNmZyBPYmplY3QNCiAgICogew0KICAgKiAgaWQ6ICdteWdyaWQtMScsDQogICAqICBjbGFzc05hbWU6ICdteWdyaWRDbGFzcycsDQogICAqICBkcm9wWm9uZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bab25lJyksDQogICAqICBoYW5kbGVyOiBmdW5jdGlvbihtc2cpIHsNCiAgICogICAgLy9zb21lIGNvZGUgaGVyZSB0byBoYW5kbGUgdGhlIG1zZyBhbmQgcmVzcG9uZA0KICAgKiAgfQ0KICAgKiB9DQogICAqDQogICAqIC8vRXhhbXBsZSB1c2FnZSBvZiBhZGREcm9wWm9uZUhhbmRsZXIgd2hpY2ggaGFuZGxlcyBhIGRyb3AgdGhhdCBvY2N1cnMgb3ZlciBhbiBFeHQgR3JpZCBhbmQgaW5zZXJ0cyBuZXcgZGF0YSBpbnRvDQogICAqIC8vdGhhdCBncmlkIGJhc2VkIG9uIHRoZSBkcmFnZ2VkIGRhdGENCiAgICogLy90aGlzLndkZCBpcyB0aGUgV2lkZ2V0RHJhZ0FuZERyb3AgT2JqZWN0DQogICAqIHRoaXMud2RkLmFkZERyb3Bab25lSGFuZGxlcih7DQogICAqICAgLy9kb20gbm9kZSBvZiBhbiBFeHQgZ3JpZA0KICAgKiAgIGRyb3Bab25lOmdyaWQuZ2V0VmlldygpLnNjcm9sbGVyLmRvbSwNCiAgICoNCiAgICogICAvL3RoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9ubHkgd2hlbiBhIGRyb3Agb2NjdXJzIG92ZXIgdGhlIGdyaWQgKGkuZS4gdGhlIG1vdXNlIHdhcyByZWxlYXNlZCBvdmVyIHRoZSBncmlkKQ0KICAgKiAgIGhhbmRsZXI6IChmdW5jdGlvbihtc2cpew0KICAgKg0KICAgKiAgICAgdmFyIHN0b3JlID0gZ3JpZC5nZXRTdG9yZSgpOw0KICAgKiAgICAgdmFyIHByb2Nlc3NlZFNlbGVjdGlvbnMgPSBbXTsNCiAgICogICAgIHZhciBlcnJvck1zZyA9IG51bGw7DQogICAqDQogICAqICAgICAvL2xvb3AgdGhyb3VnaCBtc2cuZHJhZ0Ryb3BEYXRhIHdoaWNoIGlzIGFuIGFycmF5IGFuZCBjaGVjayBmb3IgZHVwZXMgdmVyc3VzIHRoZSBkZXN0aW5hdGlvbiBzdG9yZQ0KICAgKiAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtc2cuZHJhZ0Ryb3BEYXRhLmxlbmd0aDsgaSsrKSB7DQogICAqICAgICAgIC8vZ2V0IGRhdGEgZm9yIG9uZSBwb3NzaWJsZSBuZXcgcmVjb3JkIGluIHRoZSBkcmFnRHJvcERhdGENCiAgICogICAgICAgdmFyIHJlY0RhdGEgPSBtc2cuZHJhZ0Ryb3BEYXRhW2ldOw0KICAgKg0KICAgKiAgICAgICAvL2lzIGl0IGFscmVhZHkgaW4gdGhlIGRlc3QgRXh0IFN0b3JlPw0KICAgKiAgICAgICBpZiAoc3RvcmUuZmluZEV4YWN0KCdpZCcscmVjRGF0YS5pZCkgPj0gMCkgew0KICAgKiAgICAgICAgIC8vZm91bmQgdGhlIHJlY29yZCBhbHJlYWR5IGluIHRoZSBzdG9yZQ0KICAgKiAgICAgICB9DQogICAqICAgICAgIGVsc2Ugew0KICAgKiAgICAgICAgIC8vYWRkIG5ldyByZWNvcmQgYmFzZWQgb24gdGhlIGRyYWdEcm9wRGF0YQ0KICAgKiAgICAgICAgIHZhciBuZXdSZWMgPSBuZXcgc3RvcmUucmVjb3JkVHlwZShyZWNEYXRhKTsNCiAgICogICAgICAgICAvL2NhbGxpbmcgYW4gZXh0ZXJuYWwgZnVuY3Rpb24gdG8gZGVjaWRlIHdoZXRoZXIgdG8gYWRkIHRoZSBuZXcgcmVjDQogICAqICAgICAgICAgdmFyIHJzID0gZGlzcGxheVBhbmVsLnZhbGlkYXRlUmVjb3JkT25BZGQobmV3UmVjKTsNCiAgICogICAgICAgICBpZiAocnMuc3VjY2Vzcykgew0KICAgKiAgICAgICAgICAgcHJvY2Vzc2VkU2VsZWN0aW9ucy5wdXNoKG5ld1JlYyk7DQogICAqICAgICAgICAgfQ0KICAgKiAgICAgICAgIGVsc2Ugew0KICAgKiAgICAgICAgICAgZXJyb3JNc2cgPSBycy5tc2c7DQogICAqICAgICAgICAgfQ0KICAgKiAgICAgICB9DQogICAqICAgICB9DQogICAqDQogICAqICAgICBpZiAoZXJyb3JNc2cpIHsNCiAgICogICAgICAgRXh0Lk1zZy5hbGVydCgnRXJyb3InLCBlcnJvck1zZyk7DQogICAqICAgICB9DQogICAqDQogICAqICAgICAvL2FjdHVhbGx5IGluc2VydCBpbnRvIHRoZSBzdG9yZSB3aGljaCBhZGRzIGl0IHRoZSBuZXcgcmVjcyB0byB0aGUgZ3JpZA0KICAgKiAgICAgaWYgKHByb2Nlc3NlZFNlbGVjdGlvbnMubGVuZ3RoID4gMCkgew0KICAgKiAgICAgICBzdG9yZS5pbnNlcnQoMCwgcHJvY2Vzc2VkU2VsZWN0aW9ucyk7DQogICAqICAgICB9DQogICAqDQogICAqIH0pLmNyZWF0ZURlbGVnYXRlKGdyaWQpfSk7ICAgLy9jcmVhdGVEZWxlZ2F0ZSBpcyBhbiBFeHQgZnVuY3Rpb24gd2hpY2ggc2V0cyB0aGUgc2NvcGUgb2YgdGhlIGNhbGxiYWNrDQogICAqDQogICAqDQogICAqLw0KICBhZGREcm9wWm9uZUhhbmRsZXI6IGZ1bmN0aW9uKGNmZykgew0KICAgIHRoaXMuZHJvcFpvbmVIYW5kbGVycy5wdXNoKGNmZykNCiAgfSwNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiByZXR1cm5zIHdoZXRoZXIgdGhlIGEgZHJvcCBpcyBlbmFibGVkICh0aGlzIGlzIG9ubHkgdHJ1ZSB3aGVuIHRoZSBtb3VzZSBpcyBvdmVyIGEgZHJvcCB6b25lKQ0KICAgKi8NCiAgZ2V0RHJvcEVuYWJsZWQgOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5kcm9wRW5hYmxlZEZsYWc7DQogIH0sDQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiByZXR1cm5zIHdoZXRoZXIgYSBkcmFnIGlzIGluIHByb2dyZXNzDQogICAqLw0KICBpc0RyYWdnaW5nIDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuZHJhZ2dpbmc7DQogIH0sDQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiByZXR1cm5zIGRhdGEgc2VudCB3aGVuIGEgZHJhZyB3YXMgc3RhcnRlZA0KICAgKi8NCiAgZ2V0RHJhZ1N0YXJ0RGF0YSA6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBvd2Zkb2pvLm1peGluKHRoaXMuZHJhZ1N0YXJ0RGF0YSx7ZHJhZ1pvbmU6dGhpcy5kcmFnWm9uZX0pOw0KICB9LA0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gdG9nZ2xlcyB0aGUgZHJhZ0luZGljYXRvciB0byBpbmRpY2F0ZSBzdWNjZXNzZnVsIG9yIHVuc3VjY2Vzc2Z1bCBkcm9wDQogICAqIEBwYXJhbSB7Qm9vbGVhbn0gZHJvcEVuYWJsZWQgdHJ1ZSB0byBlbmFibGUgYSBkcm9wLCBmYWxzZSB0byBpbmRpY2F0ZSBhIHVuc3VjY2Vzc2Z1bCBkcm9wDQogICAqIEBleGFtcGxlDQogICAqDQogICAqICAvL2F0dGFjaCBtb3VzZW92ZXIgY2FsbGJhY2sgdG8gYSBwYXJ0aWN1bGFyIGFyZWEuIElmIHRoZSBtb3VzZSBpcyBoZXJlIGFsbG93IGEgZHJvcA0KICAgKiAgY21wLmdldFZpZXcoKS5zY3JvbGxlci5vbignbW91c2VvdmVyJyxmdW5jdGlvbihlLHQsbykgew0KICAgKiAgICBpZiAoY21wLmRyYWdnaW5nKSB7DQogICAqICAgICAgdGhpcy53ZGQuc2V0RHJvcEVuYWJsZWQodHJ1ZSk7DQogICAqICAgIH0NCiAgICogIH0sdGhpcyk7DQogICAqDQogICAqICAvL2F0dGFjaCBhIG1vdXNlIG91dCBjYWxsYmFjayB0byBhIHBhcnRpY3VsYXIgYXJlYS4gSWYgdGhlIG1vdXNlIGxlYXZlcyBkaXNhYmxlIGRyb3ANCiAgICogIGNtcC5nZXRWaWV3KCkuc2Nyb2xsZXIub24oJ21vdXNlb3V0JyxmdW5jdGlvbihlLHQsbykgew0KICAgKiAgICBpZiAoY21wLmRyYWdnaW5nKSB7DQogICAqICAgICAgdGhpcy53ZGQuc2V0RHJvcEVuYWJsZWQoZmFsc2UpOw0KICAgKiAgICB9DQogICAqICB9LHRoaXMpOw0KICAgKi8NCiAgc2V0RHJvcEVuYWJsZWQgOiBmdW5jdGlvbihkcm9wRW5hYmxlZCkgew0KICAgIGlmIChkcm9wRW5hYmxlZCkgew0KICAgICAgdGhpcy5kcm9wRW5hYmxlZEZsYWcgPSB0cnVlOw0KICAgICAgb3dmZG9qby5yZW1vdmVDbGFzcyh0aGlzLmRyYWdJbmRpY2F0b3IsICdkZEJveENhbm5vdERyb3AnKTsNCiAgICAgIG93ZmRvam8uYWRkQ2xhc3ModGhpcy5kcmFnSW5kaWNhdG9yLCAnZGRCb3hDYW5Ecm9wJyk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgdGhpcy5kcm9wRW5hYmxlZEZsYWcgPSBmYWxzZTsNCiAgICAgIG93ZmRvam8ucmVtb3ZlQ2xhc3ModGhpcy5kcmFnSW5kaWNhdG9yLCAnZGRCb3hDYW5Ecm9wJyk7DQogICAgICBvd2Zkb2pvLmFkZENsYXNzKHRoaXMuZHJhZ0luZGljYXRvciwgJ2RkQm94Q2Fubm90RHJvcCcpOw0KICAgIH0NCiAgfSwNCg0KICBzZXRGbGFzaFdpZGdldElkOiBmdW5jdGlvbihpZCkgew0KICAgIHRoaXMuZmxhc2hXaWRnZXRJZCA9IGlkOw0KICB9LA0KDQogIGdldEZsYXNoV2lkZ2V0SWQ6IGZ1bmN0aW9uKGlkKSB7DQogICAgcmV0dXJuIHRoaXMuZmxhc2hXaWRnZXRJZDsNCiAgfQ0KfTsNCg0KLyoqDQogKiBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wIFNpbmdsZXRvbiBpbnN0YW5jZS4gTWFuYWdlcyB0aGUgZHJhZyBhbmQgZHJvcCBmb3IgYW4gaW5kaXZpZHVhbCB3aWRnZXQuDQogKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogKiBAcGFyYW0ge09iamVjdH0gW2NmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXJdICBUaGUgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiBAcGFyYW0ge0Jvb2xlYW59IFtjZmcuYXV0b0luaXRdICBUcnVlIHRvIGF1dG9tYXRpY2FsbHkgY2FsbCBpbml0KCksIEZhbHNlIG90aGVyd2lzZS4gIFRoZSBkZWZhdWx0IGlzIFRydWUgaWYgbGVmdCB1bmRlZmluZWQNCiAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnLmNhbGxiYWNrc10gIE9iamVjdCB3aXRoIGNhbGxiYWNrcyB3aG8ncyBuYW1lcyBtYXRjaCBkcmFnIGFuZCBkcm9wIGV2ZW50cy4gIEFsdGVybmF0aXZlbHkgb25lIGNvdWxkDQogKiB1c2UgdGhlIDxhIGhyZWY9IiNhZGRDYWxsYmFjayI+YWRkQ2FsbGJhY2s8L2E+IGZ1bmN0aW9uDQogKiBAcmVxdWlyZXMgb3dmZG9qbyB3aGljaCBpcyBhIGN1c3RvbSB2ZXJzaW9uIG9mIGRvam8gZm9yIE9XRg0KICogQHJlcXVpcmVzIDxhIGhyZWY9Ik96b25lLmV2ZW50aW5nLldpZGdldC5odG1sIj5Pem9uZS5ldmVudGluZy5XaWRnZXQ8L2E+IGZvciBldmVudGluZw0KICogQHNlZSA8YSBocmVmPSIjYWRkQ2FsbGJhY2siPmFkZENhbGxiYWNrPC9hPg0KICogQGV4YW1wbGUNCiAqDQogKiB2YXIgd2RkID0gT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuZ2V0SW5zdGFuY2Uoew0KICogICAgICAgICAgICAgICAgICAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyOiB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogICAgICAgICAgICAgICB9KTsNCiAqDQogKi8NCk96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wLmdldEluc3RhbmNlID0gZnVuY3Rpb24oY2ZnKSB7DQogIGlmIChPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AuaW5zdGFuY2UgPSBuZXcgT3pvbmUuZHJhZ0FuZERyb3AuV2lkZ2V0RHJhZ0FuZERyb3AoY2ZnKTsNCiAgfQ0KICByZXR1cm4gb3dmZG9qby5taXhpbihPem9uZS5kcmFnQW5kRHJvcC5XaWRnZXREcmFnQW5kRHJvcC5pbnN0YW5jZSwgY2ZnKTsNCn07DQoNCgovKioNCiAqIEBuYW1lc3BhY2UNCiAqLw0KdmFyIE96b25lID0gT3pvbmUgPyBPem9uZSA6IHt9Ow0KDQovKioNCiAqIEBpZ25vcmUNCiAqIEBuYW1lc3BhY2UNCiAqLw0KT3pvbmUubGF1bmNoZXIgPSBPem9uZS5sYXVuY2hlciA/IE96b25lLmxhdW5jaGVyIDoge307DQoNCihmdW5jdGlvbigpIHsNCg0KICAgIHZhciBsYXVuY2hDaGFubmVsTmFtZSA9ICJfV0lER0VUX0xBVU5DSEVSX0NIQU5ORUwiOw0KDQogICAgLyoqDQogICAgICogIEBkZXByZWNhdGVkIFNpbmNlIE9XRiAzLjcuMCAgWW91IHNob3VsZCB1c2UgPGEgaHJlZj0iIy5nZXRJbnN0YW5jZSI+T3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuZ2V0SW5zdGFuY2U8L2E+DQogICAgICogIEBjb25zdHJ1Y3RvciAgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIC0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0IG9iamVjdA0KICAgICAqICBAcGFyYW0gIHtPem9uZS5ldmVudGluZy5XaWRnZXR9IFt3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXJdIC0gd2lkZ2V0IGV2ZW50aW5nIG9iamVjdCB3aGljaCBoYW5kbGVzIGV2ZW50aW5nIGZvciB0aGUgd2lkZ2V0DQogICAgICogIEBkZXNjcmlwdGlvbiBUaGlzIG9iamVjdCBpcyB1c2VkIGxhdW5jaCBvdGhlciB3aWRnZXRzLiAgVG8gZG8gc28gaXQgcmVxdWlyZXMgYSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAgICAgKg0KICAgICAqLw0KICAgIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGlmIChPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnZlcnNpb24gPSBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLndpZGdldExhdW5jaGVyDQoNCiAgICAgICAgICAgIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmluc3RhbmNlID0gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5pbnN0YW5jZTsNCiAgICB9Ow0KDQogICAgT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIucHJvdG90eXBlID0gew0KDQogICAgICAvKioNCiAgICAgICAqIEBkZXNjcmlwdGlvbiBsYXVuY2hlcyBhIFdpZGdldCBiYXNlZCBvbiB0aGUgY29uZmlnDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIG9iamVjdCBzZWUgZXhhbXBsZSBmb3Igc3RydWN0dXJlDQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIGFmdGVyIHRoZSBsYXVuY2hXaWRnZXQgaXMgZXhlY3V0ZWQNCiAgICAgICAqDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICoNCiAgICAgICAqIC8vRXhhbXBsZSBmb3IgbGF1bmNoaW5nIGEgd2lkZ2V0DQogICAgICAgKiB2YXIgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyID0gT3pvbmUuZXZlbnRpbmcuV2lkZ2V0LmdldEluc3RhbmNlKCk7DQogICAgICAgKiB2YXIgd2lkZ2V0TGF1bmNoZXIgPSBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5nZXRJbnN0YW5jZSh0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcik7DQogICAgICAgKiB2YXIgZGF0YSA9IHsNCiAgICAgICAqICAgY2hhbm5lbDogY2hhbm5lbCwNCiAgICAgICAqICAgbWVzc2FnZTogbWVzc2FnZQ0KICAgICAgICogfTsNCiAgICAgICAqIHZhciBkYXRhU3RyaW5nID0gT3pvbmUudXRpbC50b1N0cmluZyhkYXRhKTsNCiAgICAgICAqIHdpZGdldExhdW5jaGVyLmxhdW5jaFdpZGdldCh7DQogICAgICAgKiAgICAgdW5pdmVyc2FsTmFtZTogJ3VuaXZlcnNhbCBuYW1lIG9mIHdpZGdldCB0byBsYXVuY2gnLCAgLy91bml2ZXJzYWxOYW1lIG9yIGd1aWQgbWF5YmUgaWRlbnRpZnkgdGhlIHdpZGdldCB0byBiZSBsYXVuY2hlZA0KICAgICAgICogICAgIGd1aWQ6ICdndWlkIG9mIHdpZGdldCB0byBsYXVuY2gnLA0KICAgICAgICogICAgIHRpdGxlOiAndGl0bGUgdG8gcmVwbGFjZSB0aGUgd2lkZ2V0cyB0aXRsZScgdGhlIHRpdGxlIHdpbGwgb25seSBiZSBjaGFuZ2VkIGlmIHRoZSB3aWRnZXQgaXMgb3BlbmVkLg0KICAgICAgICogICAgIHRpdGxlUmVnZXg6IG9wdGlvbmFsIHJlZ2V4IHVzZWQgdG8gcmVwbGFjZSB0aGUgcHJldmlvdXMgdGl0bGUgd2l0aCB0aGUgbmV3IHZhbHVlIG9mIHRpdGxlDQogICAgICAgKiAgICAgbGF1bmNoT25seUlmQ2xvc2VkOiB0cnVlLCAvL2lmIHRydWUgd2lsbCBvbmx5IGxhdW5jaCB0aGUgd2lkZ2V0IGlmIGl0IGlzIG5vdCBhbHJlYWR5IG9wZW5lZC4NCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgaXQgaXMgb3BlbmVkIHRoZW4gdGhlIHdpZGdldCB3aWxsIGJlIHJlc3RvcmVkDQogICAgICAgKiAgICAgZGF0YTogZGF0YVN0cmluZyAgLy9pbml0aWFsIGxhdW5jaCBjb25maWcgZGF0YSB0byBiZSBwYXNzZWQgdG8gYSB3aWRnZXQgb25seSBpZiB0aGUgd2lkZ2V0IGlzIG9wZW5lZC4gIHRoaXMgbXVzdCBiZSBhIHN0cmluZw0KICAgICAgICogfSk7DQogICAgICAgKg0KICAgICAgICovDQogICAgICAgIGxhdW5jaFdpZGdldDogZnVuY3Rpb24oY29uZmlnLGNhbGxiYWNrKSB7DQogICAgICAgICAgICAvL3NlbmQgbWVzc2FnZSB0byBsYXVuY2ggYSB3aWRnZXQNCg0KICAgICAgICAgICAgaWYgKGNvbmZpZy50aXRsZVJlZ2V4ICE9IG51bGwgJiYgY29uZmlnLnRpdGxlUmVnZXggaW5zdGFuY2VvZiBSZWdFeHApIHsNCiAgICAgICAgICAgICAgICBjb25maWcudGl0bGVSZWdleCA9IGNvbmZpZy50aXRsZVJlZ2V4LnRvU3RyaW5nKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBqc29uU3RyaW5nID0gZ2FkZ2V0cy5qc29uLnN0cmluZ2lmeShjb25maWcpOw0KICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBsYXVuY2hDaGFubmVsTmFtZSwgY2FsbGJhY2ssIE9XRi5nZXRJZnJhbWVJZCgpLCBqc29uU3RyaW5nKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQGNvbnN0cnVjdG9yIG5vbmUNCiAgICAgKiAgQGRlc2NyaXB0aW9uIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBhIHdpZGdldCB0aGF0IGhhcyBiZWVuIGxhdW5jaGVkDQogICAgICoNCiAgICAgKi8NCiAgICBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlclV0aWxzID0gew0KICAgICAgLyoqDQogICAgICAgKiBAZGVzY3JpcHRpb24gZ2V0cyBpbml0aWFsIGxhdW5jaCBjb25maWcgZGF0YSBmb3IgdGhpcyB3aWRnZXQgaWYgaXQgd2FzIGp1c3QgbGF1bmNoZWQNCiAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGRhdGEgb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGluaXRpYWwgaW5mb3JtYXRpb24gZm9yIHRoZSB3aWRnZXQgDQogICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICoNCiAgICAgICAqIHZhciBsYXVuY2hDb25maWcgPSBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlclV0aWxzLmdldExhdW5jaENvbmZpZ0RhdGEoKTsNCiAgICAgICAqIGlmIChsYXVuY2hDb25maWcgIT0gbnVsbCkgew0KICAgICAgICogICB2YXIgZGF0YSA9IE96b25lLnV0aWwucGFyc2VKc29uKGxhdW5jaENvbmZpZyk7ICAvL2luIHRoaXMgZXhhbXBsZSB0aGUgZGF0YSBvYmplY3QgaGFzIHR3byBmaWVsZHM6IGNoYW5uZWwgYW5kIG1lc3NhZ2UNCiAgICAgICAqICAgaWYgKGRhdGEgIT0gbnVsbCkgew0KICAgICAgICogICAgICAgLy9kbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQ0KICAgICAgICogICAgICAgc2NvcGUuc3Vic2NyaWJlVG9DaGFubmVsKGRhdGEuY2hhbm5lbCk7DQogICAgICAgKiAgICAgICBzY29wZS5hZGRUb0dyaWQobnVsbCxkYXRhLm1lc3NhZ2UsZGF0YS5jaGFubmVsKTsNCiAgICAgICAqICAgfQ0KICAgICAgICogfQ0KICAgICAgICoNCiAgICAgICAqLw0KICAgICAgICBnZXRMYXVuY2hDb25maWdEYXRhOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBsYXVuY2hDb25maWcgPSBudWxsOw0KDQogICAgICAgICAgICAvL2NoZWNrIGZvciBkYXRhIGluIHdpbmRvdy5uYW1lDQogICAgICAgICAgICB2YXIgY29uZmlnUGFyYW1zID0gT3pvbmUudXRpbC5wYXJzZVdpbmRvd05hbWVEYXRhKCk7DQogICAgICAgICAgICBpZiAoY29uZmlnUGFyYW1zICE9IG51bGwpIHsNCg0KICAgICAgICAgICAgICAgIC8vZ2V0IGxhdW5jaENvbmZpZw0KICAgICAgICAgICAgICAgIGxhdW5jaENvbmZpZyA9IGNvbmZpZ1BhcmFtcy5kYXRhOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gbGF1bmNoQ29uZmlnOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqICBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLmV2ZW50aW5nLldpZGdldCBTaW5nbGV0b24gaW5zdGFuY2UuIFRoaXMgb2JqZWN0IGlzIHVzZWQgbGF1bmNoIG90aGVyIHdpZGdldHMuDQogICAgICogIEBleGFtcGxlDQogICAgICogIHRoaXMud2lkZ2V0TGF1bmNoZXIgPSBPem9uZS5sYXVuY2hlci5XaWRnZXRMYXVuY2hlci5nZXRJbnN0YW5jZSh0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcik7DQogICAgICovDQogICAgT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmluc3RhbmNlID09IG51bGwpIHsNCiAgICAgICAgICAgIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmluc3RhbmNlID0gbmV3IE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmluc3RhbmNlOw0KICAgIH07DQoNCn0oKSk7DQoKLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLnN0YXRlID0gT3pvbmUuc3RhdGUgPyBPem9uZS5zdGF0ZSA6IHt9Ow0KDQovKioNCiAqICBAZGVwcmVjYXRlZCBTaW5jZSBPV0YgMy43LjAgIFlvdSBzaG91bGQgdXNlIDxhIGhyZWY9IiMuZ2V0SW5zdGFuY2UiPk96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5nZXRJbnN0YW5jZTwvYT4NCiAqICBAY29uc3RydWN0b3IgIFdpZGdldFN0YXRlSGFuZGxlciAtIEhhbmRsZXMgZXZlbnRpbmcgZnJvbSBPV0Ygd2lkZ2V0IHRvIE9XRiBjb250YWluZXINCiAqICBAcGFyYW0gIHtPem9uZS5ldmVudGluZy5XaWRnZXR9IHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciAtIHdpZGdldCBldmVudGluZyBvYmplY3Qgd2hpY2ggaGFuZGxlcyBldmVudGluZyBmb3IgdGhlIHdpZGdldA0KICogIEBkZXNjcmlwdGlvbiBUaGlzIG9iamVjdCBpcyB1c2VkIGhhbmRsZSB3aWRnZXQgcmVxdWVzdHMuICBUbyBkbyBzbyBpdCByZXF1aXJlcyBhIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICoNCiAqLw0KT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyID0gZnVuY3Rpb24od2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyKSB7DQogIGlmIChPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgIHRoaXMuc3RhdGVDaGFubmVsTmFtZSA9ICJfV0lER0VUX1NUQVRFX0NIQU5ORUxfIjsNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciB8fCBPem9uZS5ldmVudGluZy5XaWRnZXQuaW5zdGFuY2U7DQogICAgdGhpcy53aWRnZXRJZEpTT04gPSBPem9uZS51dGlsLnBhcnNlSnNvbih0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlci5nZXRXaWRnZXRJZCgpKTsNCiAgICB0aGlzLnZlcnNpb24gPSBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLndpZGdldFN0YXRlSGFuZGxlcg0KDQogICAgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmluc3RhbmNlID0gdGhpczsNCiAgfQ0KDQogIHJldHVybiBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuaW5zdGFuY2U7DQp9Ow0KDQpPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIucHJvdG90eXBlID0gew0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gaGFuZGxlcyBhIHdpZGdldCBzdGF0ZSByZXF1ZXN0IGJhc2VkIG9uIHRoZSBjb25maWcNCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBvYmplY3Qgc2VlIGV4YW1wbGUgZm9yIHN0cnVjdHVyZQ0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIGFmdGVyIHRoZSBzdGF0ZVdpZGdldCBpcyBleGVjdXRlZA0KICAgKg0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiAvL0V4YW1wbGUgZm9yIGNsb3NpbmcgYSB3aWRnZXQNCiAgICogdmFyIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IG5ldyBPem9uZS5ldmVudGluZy5XaWRnZXQoT3pvbmUudXRpbC5jb250ZXh0UGF0aCgpICsgJy9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwnKTsNCiAgICogdmFyIHdpZGdldFN0YXRlSGFuZGxlciA9IG5ldyBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIodGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIpOw0KICAgKiB3aWRnZXRTdGF0ZUhhbmRsZXIuaGFuZGxlU3RhdGVSZXF1ZXN0KHsNCiAgICogICAgIGZuOiAnY2xvc2VXaWRnZXQnLA0KICAgKiAgICAgcGFyYW1zOiB7DQogICAqICAgICAJZ3VpZDogPHdpZGdldEd1aWQ+DQogICAqICAgICB9DQogICAqIH0pOw0KICAgKg0KICAgKi8NCgloYW5kbGVXaWRnZXRSZXF1ZXN0OiBmdW5jdGlvbihjb25maWcsIGNhbGxiYWNrKSB7DQoNCgkJLy9zZW5kIHN0YXRlIHJlcXVlc3QgdG8gYSB3aWRnZXQNCgkJdmFyIHN0YXRlQ2hhbm5lbCA9IHRoaXMuc3RhdGVDaGFubmVsTmFtZSArIHRoaXMud2lkZ2V0SWRKU09OLmlkOw0KCSAgICBnYWRnZXRzLnJwYy5jYWxsKCcuLicsIHN0YXRlQ2hhbm5lbCwgY2FsbGJhY2ssIHRoaXMud2lkZ2V0SWRKU09OLCBjb25maWcpOwkNCgl9DQp9Ow0KDQovKioNCiAqICBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLmV2ZW50aW5nLldpZGdldCBTaW5nbGV0b24gaW5zdGFuY2UuDQogKiAgICBUaGlzIG9iamVjdCBpcyB1c2VkIGhhbmRsZSB3aWRnZXQgcmVxdWVzdHMuICBUbyBkbyBzbyBpdCByZXF1aXJlcyBhIHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcg0KICogIEBwYXJhbSAge096b25lLmV2ZW50aW5nLldpZGdldH0gd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyIC0gd2lkZ2V0IGV2ZW50aW5nIG9iamVjdCB3aGljaCBoYW5kbGVzIGV2ZW50aW5nIGZvciB0aGUgd2lkZ2V0DQogKiAgQGV4YW1wbGUNCiAqICB0aGlzLndpZGdldFN0YXRlSGFuZGxlciA9IE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5nZXRJbnN0YW5jZSh0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcik7DQogKi8NCk96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcikgew0KICBpZiAoT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmluc3RhbmNlID09IG51bGwpIHsNCiAgICBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZUhhbmRsZXIuaW5zdGFuY2UgPSBuZXcgT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyKHdpZGdldEV2ZW50aW5nQ29udHJvbGxlcik7DQogIH0NCiAgcmV0dXJuIE96b25lLnN0YXRlLldpZGdldFN0YXRlSGFuZGxlci5pbnN0YW5jZTsNCn07DQoKLyoqDQogKiBAaWdub3JlDQogKi8NCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsNCg0KLyoqDQogKiBAaWdub3JlDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLnN0YXRlID0gT3pvbmUuc3RhdGUgPyBPem9uZS5zdGF0ZSA6IHt9Ow0KDQovKioNCiAqIEBkZXByZWNhdGVkIFNpbmNlIE9XRiAzLjcuMCAgWW91IHNob3VsZCB1c2UgPGEgaHJlZj0iIy5nZXRJbnN0YW5jZSI+T3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUuZ2V0SW5zdGFuY2U8L2E+DQoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtPYmplY3R9IFtjZmddIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzDQogKiBAcGFyYW0ge1N0cmluZ30gW2NmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXJdICBUaGUgd2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyDQogKiBAcGFyYW0ge0Jvb2xlYW59IFtjZmcuYXV0b0luaXRdIFdoZXRoZXIgb3Igbm90IHRvIGF1dG9tYXRpY2FsbHkgc3RhcnQgbGlzdGVuaW5nIHRvIHRoZSBzdGF0ZSBjaGFubmVsLiAgRGVmYXVsdCBpcyB0cnVlLg0KICogQHBhcmFtIHtTdHJpbmd9IFtjZmcud2lkZ2V0R3VpZF0gIFRoZSBndWlkIG9mIHRoZSB3aWRnZXQgdG8gbW9uaXRvci4gRGVmYXVsdCBpcyBpdHNlbGYuDQogKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5vblN0YXRlRXZlbnRSZWNlaXZlZF0gIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGFuIGV2ZW50IGlzIHJlY2VpdmVkLg0KICogQGRlc2NyaXB0aW9uIFRoZSBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZSBvYmplY3QgbWFuYWdlcyB0aGUgdHdvLXdheSBjb21tdW5pY2F0aW9uIGJldHdlZW4gYW4gT1dGIHdpZGdldCBhbmQgaXRzIE9XRiBDb250YWluZXIuDQogKiBAcmVxdWlyZXMgPGEgaHJlZj0iT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmh0bWwiPk96b25lLmV2ZW50aW5nLldpZGdldDwvYT4gZm9yIGV2ZW50aW5nDQogKiBAZXhhbXBsZQ0KICoNCiAqIHZhciB3aWRnZXRTdGF0ZSA9IG5ldyBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZSh7DQogKiAgICAgb25TdGF0ZUV2ZW50UmVjZWl2ZWQ6IGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7DQogKiAgICAgCQkvLyBkbyBzb21ldGhpbmcNCiAqICAgICB9DQogKiB9KTsNCiAqDQogKi8NCk96b25lLnN0YXRlLldpZGdldFN0YXRlID0gZnVuY3Rpb24oY2ZnKSB7DQoNCiAgaWYgKE96b25lLnN0YXRlLldpZGdldFN0YXRlLmluc3RhbmNlID09IG51bGwpIHsNCg0KCXZhciBTVEFURV9FVkVOVF9DSEFOTkVMX05BTUVfcHJlZml4ID0gIl9XSURHRVRfU1RBVEVfQ0hBTk5FTF8iOw0KDQogICAgY2ZnID0gY2ZnIHx8IHt9Ow0KDQoJLy8gaW5pdGlhbGl6ZSB0aGUgc3RhdGUgaGFuZGxpbmcNCiAgICB0aGlzLndpZGdldEV2ZW50aW5nQ29udHJvbGxlciA9IGNmZy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIgfHwgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmluc3RhbmNlOw0KCXRoaXMud2lkZ2V0U3RhdGVIYW5kbGVyID0gT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGVIYW5kbGVyLmdldEluc3RhbmNlKHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyKTsNCgl0aGlzLndpZGdldElkSlNPTiA9IE96b25lLnV0aWwucGFyc2VKc29uKHRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLmdldFdpZGdldElkKCkpOw0KCXRoaXMud2lkZ2V0R3VpZCA9IGNmZy53aWRnZXRHdWlkID8gY2ZnLndpZGdldEd1aWQgOiB0aGlzLndpZGdldElkSlNPTi5pZDsNCiAgICB0aGlzLnN0YXRlQ2hhbm5lbCA9IFNUQVRFX0VWRU5UX0NIQU5ORUxfTkFNRV9wcmVmaXggKyB0aGlzLndpZGdldEd1aWQ7DQoJdGhpcy5vblN0YXRlRXZlbnRSZWNlaXZlZCA9IGNmZy5vblN0YXRlRXZlbnRSZWNlaXZlZCA/IGNmZy5vblN0YXRlRXZlbnRSZWNlaXZlZCA6IHRoaXMub25TdGF0ZUV2ZW50UmVjZWl2ZWQ7DQoJDQoJaWYgKGNmZy5hdXRvSW5pdCAhPT0gZmFsc2UpIHsNCgkJdGhpcy5pbml0KCk7DQoJfQ0KDQogICAgIE96b25lLnN0YXRlLldpZGdldFN0YXRlLmluc3RhbmNlID0gdGhpczsNCiAgfQ0KDQogIHJldHVybiBPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5pbnN0YW5jZTsNCn07DQoNCk96b25lLnN0YXRlLldpZGdldFN0YXRlLnByb3RvdHlwZSA9IHsNCgkvKioNCgkgKiBAZmllbGQNCgkgKiBAZGVzY3JpcHRpb24gdmVyc2lvbiBudW1iZXINCgkgKi8NCgl2ZXJzaW9uOiBPem9uZS52ZXJzaW9uLm93ZnZlcnNpb24gKyBPem9uZS52ZXJzaW9uLnN0YXRlLA0KDQoJLyoqDQogICAgICogQGRlc2NyaXB0aW9uIEluaXRpYWxpemVzIHRoZSBXaWRnZXRTdGF0ZSBvYmplY3QuICBVc2luZyB0aGlzIGZ1bmN0aW9uIGlzIG9ubHkgcmVxdWlyZWQgaWYgYXV0b0luaXQgY29uZmlnIGlzIGZhbHNlDQogICAgICogaW4gdGhlIGNvbnN0cnVjdG9yLiAgVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgdXNlZnVsIHdoZW4gaXQgaXMgbmVjZXNzYXJ5IHRvIGRlZmVyIGV2ZW50IGhhbmRsaW5nIGFmdGVyDQogICAgICogY3JlYXRpbmcgdGhlIE96b25lLnN0YXRlLldpZGdldFN0YXRlIG9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBjb25maWcgb2JqZWN0DQogICAgICogQHNlZSA8YSBocmVmPSIjY29uc3RydWN0b3IiPmNvbnN0cnVjdG9yPC9hPg0KICAgICAqLw0KCWluaXQgOiBmdW5jdGlvbiAoKSB7DQoJCXRoaXMud2lkZ2V0RXZlbnRpbmdDb250cm9sbGVyLnN1YnNjcmliZSh0aGlzLnN0YXRlQ2hhbm5lbCwgdGhpcy5vblN0YXRlRXZlbnRSZWNlaXZlZCk7DQovLwkJdGhpcy53aWRnZXRFdmVudGluZ0NvbnRyb2xsZXIucmVnaXN0ZXJIYW5kbGVyKHRoaXMuc3RhdGVDaGFubmVsLCB0aGlzLm9uU3RhdGVFdmVudFJlY2VpdmVkKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBUaGUgZGVmYXVsdCBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGFuIGV2ZW50IGlzIHJlY2VpdmVkLiANCgkgKi8NCglvblN0YXRlRXZlbnRSZWNlaXZlZDogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdHJ1ZTsNCgl9LA0KCQ0KCWdldFN0YXRlQ2hhbm5lbDogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdGhpcy5zdGF0ZUNoYW5uZWw7DQoJfSwNCg0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBHZXRzIGN1cnJlbnQgd2lkZ2V0IHN0YXRlLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgd2hvc2Ugc3RhdGUgc2hvdWxkIGJlIHJldHJpZXZlZC4gRGVmYXVsdHMgdG8gY3VycmVudCB3aWRnZXQgZ3VpZC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgc3RhdGUgaXMgcmV0cmlldmVkLg0KICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBzdGF0ZSBvYmplY3Qgd2hpY2ggaGFzIGZvbGxvd2luZyBwcm9wZXJ0aWVzLiA8YnI+DQogICAgICogPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIHRoZSB3aWRnZXQgPGJyPg0KICAgICAqICAgICB7TnVtYmVyfSB4OiB4LWNvb3JkaW5hdGUgdmFsdWUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgd2lkZ2V0PGJyPg0KICAgICAqICAgICB7TnVtYmVyfSB5OiB5LWNvb3JkaW5hdGUgdmFsdWUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgd2lkZ2V0PGJyPg0KICAgICAqICAgICB7TnVtYmVyfSB3aWR0aDogd2lkdGggb2YgdGhlIHdpZGdldCA8YnI+DQogICAgICogICAgIHtOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHRoZSB3aWRnZXQgPGJyPg0KICAgICAqICAgICB7Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgYWN0aXZlLCBvciBlbHNlIGZhbHNlLiBUaGlzIHByb3BlcnR5IGlzIGFwcGxpY2FibGUgZm9yIGRlc2t0b3AgbGF5b3V0IG9ubHkuIDxicj4NCiAgICAgKiAgICAge0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIG1heGltaXplZCwgb3IgZWxzZSBmYWxzZSA8YnI+DQogICAgICogICAgIHtCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgdGhlIHdpZGdldCBpcyBtaW5pbWl6ZWQsIG9yIGVsc2UgZmFsc2UgPGJyPg0KICAgICAqICAgICB7Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgY29sbGFwc2VkLCBvciBlbHNlIGZhbHNlIDxicj4NCiAgICAgKiAgICAge0Jvb2xlYW59IHNpbmdsZXRvbjogdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIHNpbmdsZXRvbiwgb3IgZWxzZSBmYWxzZSA8YnI+DQogICAgICogICAgIHtCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgdGhlIHdpZGdldCBpcyBwaW5uZWQsIG9yIGVsc2UgZmFsc2UgPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIGlkIG9mIHRoZSB3aWRnZXQgPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSB3aWRnZXRHdWlkOiBndWlkIG9mIHRoZSB3aWRnZXQgPGJyPg0KICAgICAqICAgICB7U3RyaW5nfSBwYW5lR3VpZDogZ3VpZCBvZiB0aGUgcGFuZSA8YnI+DQogICAgICogICAgIHtTdHJpbmd9IGRhc2hib2FyZEd1aWQ6IGd1aWQgb2YgdGhlIGRhc2hib2FyZCB0aGUgd2lkZ2V0IGlzIG9wZW5lZCBvbiA8YnI+DQogICAgICogICAgIHtTdHJpbmd9IHJlZ2lvbjogcmVnaW9uIG9mIHRoZSB3aWRnZXQuIFRoaXMgcHJvcGVydHkgaXMgYXBwbGljYWJsZSBmb3IgYWNjb3JkaW9uIGxheW91dCBvbmx5LiBQb3NzaWJsZSB2YWx1ZXMgZm9yIGFjY29yZGlvbiBsYXlvdXQgYXJlICJhY2NvcmRpb24iLCAiY2VudGVyIiBhbmQgInNvdXRoIi4gSW4gb3RoZXIgbGF5b3V0cywgaXRzIHZhbHVlIGlzICJub25lIi4gPGJyPg0KICAgICAqICAgICB7TnVtYmVyfSBjb2x1bW5Qb3M6IGNvbHVtbiB0aGUgd2lkZ2V0IGlzIG9wZW5lZCBpbi4gVGhpcyBwcm9wZXJ0eSBpcyBhcHBsaWNhYmxlIGZvciBwb3J0YWwgbGF5b3V0IG9ubHkuIFBvc3NpYmxlIHZhbHVlcyBmb3IgcG9ydGFsIGxheW91dCBhcmUgMCwgMSBhbmQgMi4gSW4gb3RoZXIgbGF5b3V0cywgaXRzIHZhbHVlIGlzIDAuIDxicj4NCiAgICAgKiAgICAge051bWJlcn0gekluZGV4OiB6LWluZGV4IG9mIHRoZSB3aWRnZXQuIDxicj4NCgkgKg0KCSAqIEBleGFtcGxlDQoJICoNCgkgKiB3aWRnZXRTdGF0ZS5nZXRXaWRnZXRTdGF0ZSh7DQogICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdGF0ZSkgew0KCSAqICAgICAJCS8vIERvIHNvbWV0aGluZw0KCSAqICAgICB9DQoJICogfSk7DQoJICoNCgkgKi8NCglnZXRXaWRnZXRTdGF0ZTogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAiZ2V0V2lkZ2V0U3RhdGUiLA0KCQkJcGFyYW1zOiB7DQoJCQkJZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZA0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBHZXRzIHJlZ2lzdGVyZWQgd2lkZ2V0IHN0YXRlIGV2ZW50cw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgd2hvc2UgZXZlbnRzIHNob3VsZCBiZSByZXRyaWV2ZWQuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0IGd1aWQuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5jYWxsYmFja10gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIHN0YXRlV2lkZ2V0IGlzIGV4ZWN1dGVkLg0KCSAqDQoJICogQGV4YW1wbGUNCgkgKg0KCSAqIHdpZGdldFN0YXRlLmdldFJlZ2lzdGVyZWRTdGF0ZUV2ZW50cyh7DQoJICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihldmVudHMpIHsNCgkgKiAgICAgCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykgew0KCSAqICAgICAJCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgCQl9DQoJICogICAgIH0NCgkgKiB9KTsNCgkgKg0KCSAqLw0KCWdldFJlZ2lzdGVyZWRTdGF0ZUV2ZW50czogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAiZ2V0V2lkZ2V0U3RhdGVFdmVudHMiLA0KCQkJcGFyYW1zOiB7DQoJCQkJZ3VpZDogY2ZnLmd1aWQgPyBjZmcuZ3VpZCA6IHRoaXMud2lkZ2V0R3VpZA0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KICAgIC8qKg0KICAgICAqIEBkZXNjcmlwdGlvbiBBY3RpdmF0ZXMgYSB3aWRnZXQuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtjZmddIENvbmZpZyBvYmplY3QuIFNlZSBiZWxvdyBmb3IgcHJvcGVydGllcy4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NmZy5ndWlkXSAgSWQgb2YgdGhlIHdpZGdldCB0byBhY3RpdmF0ZS4gRGVmYXVsdHMgdG8gY3VycmVudCB3aWRnZXQncyBndWlkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcuY2FsbGJhY2tdIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIGFmdGVyIHRoZSB3aWRnZXQgaGFzIGJlZW4gYWN0aXZhdGVkLg0KICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgcGFzc2VkIGJhY2sgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzLiA8YnI+DQogICAgICogPGJyPg0KICAgICAqICAgICAgICAgIHtCb29sZWFufSByZXN1bHQ6IHRydWUgaWYgdGhlIHdpZGdldCBoYXMgYmVlbiBhY3RpdmF0ZWQsIG9yIGVsc2UgZmFsc2UuDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogd2lkZ2V0U3RhdGUuYWN0aXZhdGVXaWRnZXQoew0KICAgICAqICAgICBndWlkOiAiR1VJRF9PRl9BX1dJREdFVCIsDQogICAgICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihyZXN1bHQpIHsNCiAgICAgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCiAgICAgKiAgICAgfQ0KICAgICAqIH0pOw0KICAgICAqDQogICAgICovDQogICAgYWN0aXZhdGVXaWRnZXQ6IGZ1bmN0aW9uKGNmZykgew0KICAgICAgICBjZmcgPSBjZmcgPyBjZmcgOiB7fTsNCg0KICAgICAgICB2YXIgY29uZmlnID0gew0KICAgICAgICAgICAgZm46ICJhY3RpdmF0ZVdpZGdldCIsDQogICAgICAgICAgICBwYXJhbXM6IHsNCiAgICAgICAgICAgICAgICBndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIHRoaXMud2lkZ2V0U3RhdGVIYW5kbGVyLmhhbmRsZVdpZGdldFJlcXVlc3QoY29uZmlnLCBjZmcuY2FsbGJhY2spOw0KICAgIH0sDQoNCgkvKioNCgkgKiBAZGVzY3JpcHRpb24gQ2xvc2VzIGEgd2lkZ2V0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgdG8gY2xvc2UuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0J3MgZ3VpZC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgd2lkZ2V0IGlzIGNsb3NlZC4gT25seSB1c2UgdGhpcyBpZiB0aGUgd2lkZ2V0IGlzIG5vdCBjbG9zaW5nIGl0c2VsZi4NCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHBhc3NlZCBiYWNrIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycy4gPGJyPg0KICAgICAqIDxicj4NCiAgICAgKiAgICAgICAgICB7Qm9vbGVhbn0gcmVzdWx0OiB0cnVlIGlmIHRoZSB3aWRnZXQgaGFzIGJlZW4gY2xvc2VkLCBvciBlbHNlIGZhbHNlLg0KCSAqDQoJICogQGV4YW1wbGUNCgkgKg0KCSAqIHdpZGdldFN0YXRlLmNsb3NlV2lkZ2V0KHsNCiAgICAgKiAgICAgZ3VpZDogIkdVSURfT0ZfQV9XSURHRVQiLA0KICAgICAqICAgICBjYWxsYmFjazogZnVuY3Rpb24ocmVzdWx0KSB7DQoJICogICAgIAkJLy8gRG8gc29tZXRoaW5nDQoJICogICAgIH0NCgkgKiB9KTsNCgkgKg0KCSAqLw0KCWNsb3NlV2lkZ2V0OiBmdW5jdGlvbihjZmcpIHsNCgkJY2ZnID0gY2ZnID8gY2ZnIDoge307DQoJCQ0KCQl2YXIgY29uZmlnID0gew0KCQkJZm46ICJjbG9zZVdpZGdldCIsDQoJCQlwYXJhbXM6IHsNCgkJCQlndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkDQoJCQl9DQoJCX07DQoJCXRoaXMud2lkZ2V0U3RhdGVIYW5kbGVyLmhhbmRsZVdpZGdldFJlcXVlc3QoY29uZmlnLCBjZmcuY2FsbGJhY2spOw0KCX0sDQoJDQoJLyoqDQoJICogQGRlc2NyaXB0aW9uIEFkZHMgY3VzdG9tIHN0YXRlIGV2ZW50IGhhbmRsZXJzIHRvIGxpc3RlbiB0byB3aWRnZXQgZXZlbnRzLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgd2hvc2UgZXZlbnRzIHNob3VsZCBiZSBtb25pdG9yZWQuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0IGd1aWQuDQogICAgICogQHBhcmFtIHtBcnJheX0gW2NmZy5ldmVudHNdIEFycmF5IG9mIGV2ZW50cy4gSWYgbm8gZXZlbnQgaXMgcHJvdmlkZWQgdGhpcyBtZXRob2Qgd2lsbCBhZGQgbGlzdGVuZXJzIHRvIGFsbCByZWdpc3RlcmVkIGV2ZW50cy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgbGlzdGVuZXIgaXMgYWRkZWQuDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqDQoJICogd2lkZ2V0U3RhdGUuYWRkU3RhdGVFdmVudExpc3RlbmVycyh7DQoJICogCSAgIGV2ZW50czogWydiZWZvcmVjbG9zZScsJ21heGltaXplJ10sDQoJICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHsNCgkgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgfQ0KCSAqIH0pOw0KCSAqDQoJICovDQoJYWRkU3RhdGVFdmVudExpc3RlbmVyczogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAiYWRkU3RhdGVFdmVudExpc3RlbmVycyIsDQoJCQlwYXJhbXM6IHsNCgkJCQlndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkLA0KCQkJCWV2ZW50czogY2ZnLmV2ZW50cw0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGN1c3RvbSBzdGF0ZSBldmVudCBsaXN0ZW5lcnMgZnJvbSBhIHdpZGdldC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIGV2ZW50cyBzaG91bGQgYmUgbW9uaXRvcmVkLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCBndWlkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtjZmcuZXZlbnRzXSBBcnJheSBvZiBldmVudHMuIElmIG5vIGV2ZW50IGlzIHByb3ZpZGVkIHRoaXMgbWV0aG9kIHdpbGwgcmVtb3ZlIG9ubHkgY3VzdG9tIGxpc3RlbmVycyBmcm9tIGFsbCByZWdpc3RlcmVkIGV2ZW50cy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgbGlzdGVuZXIgaXMgcmVtb3ZlZC4NCgkgKg0KCSAqIEBleGFtcGxlDQoJICoNCgkgKiB3aWRnZXRTdGF0ZS5yZW1vdmVTdGF0ZUV2ZW50TGlzdGVuZXJzKHsNCgkgKiAJICAgZXZlbnRzOiBbJ2JlZm9yZWNsb3NlJywnbWF4aW1pemUnXSwNCgkgKiAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KCSAqICAgICAJCS8vIERvIHNvbWV0aGluZw0KCSAqICAgICB9DQoJICogfSk7DQoJICoNCgkgKi8NCglyZW1vdmVTdGF0ZUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbihjZmcpIHsNCgkJY2ZnID0gY2ZnID8gY2ZnIDoge307DQoJCQ0KCQl2YXIgY29uZmlnID0gew0KCQkJZm46ICJyZW1vdmVTdGF0ZUV2ZW50TGlzdGVuZXJzIiwNCgkJCXBhcmFtczogew0KCQkJCWd1aWQ6IGNmZy5ndWlkID8gY2ZnLmd1aWQgOiB0aGlzLndpZGdldEd1aWQsDQoJCQkJZXZlbnRzOiBjZmcuZXZlbnRzDQoJCQl9DQoJCX07DQoJCXRoaXMud2lkZ2V0U3RhdGVIYW5kbGVyLmhhbmRsZVdpZGdldFJlcXVlc3QoY29uZmlnLCBjZmcuY2FsbGJhY2spOw0KCX0sDQoJDQoJLyoqDQoJICogQGRlc2NyaXB0aW9uIEFkZHMgY3VzdG9tIHN0YXRlIGV2ZW50IGhhbmRsZXJzIHRvIG92ZXJyaWRlIGEgd2lkZ2V0IGV2ZW50Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2ZnXSBDb25maWcgb2JqZWN0LiBTZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtjZmcuZ3VpZF0gIElkIG9mIHRoZSB3aWRnZXQgd2hvc2UgZXZlbnRzIHNob3VsZCBiZSBtb25pdG9yZWQuIERlZmF1bHRzIHRvIGN1cnJlbnQgd2lkZ2V0IGd1aWQuDQogICAgICogQHBhcmFtIHtBcnJheX0gW2NmZy5ldmVudHNdIEFycmF5IG9mIGV2ZW50cy4gSWYgbm8gZXZlbnQgaXMgcHJvdmlkZWQgdGhpcyBtZXRob2Qgd2lsbCBhZGQgbGlzdGVuZXJzIHRvIGFsbCByZWdpc3RlcmVkIGV2ZW50cy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgbGlzdGVuZXIgaXMgYWRkZWQuDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqDQoJICogd2lkZ2V0U3RhdGUuYWRkU3RhdGVFdmVudE92ZXJyaWRlcyh7DQoJICogCSAgIGV2ZW50czogWydiZWZvcmVjbG9zZScsJ21heGltaXplJ10sDQoJICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHsNCgkgKiAgICAgCQkvLyBEbyBzb21ldGhpbmcNCgkgKiAgICAgfQ0KCSAqIH0pOw0KCSAqDQoJICovDQoJYWRkU3RhdGVFdmVudE92ZXJyaWRlczogZnVuY3Rpb24oY2ZnKSB7DQoJCWNmZyA9IGNmZyA/IGNmZyA6IHt9Ow0KCQkNCgkJdmFyIGNvbmZpZyA9IHsNCgkJCWZuOiAiYWRkU3RhdGVFdmVudE92ZXJyaWRlcyIsDQoJCQlwYXJhbXM6IHsNCgkJCQlndWlkOiBjZmcuZ3VpZCA/IGNmZy5ndWlkIDogdGhpcy53aWRnZXRHdWlkLA0KCQkJCWV2ZW50czogY2ZnLmV2ZW50cw0KCQkJfQ0KCQl9Ow0KCQl0aGlzLndpZGdldFN0YXRlSGFuZGxlci5oYW5kbGVXaWRnZXRSZXF1ZXN0KGNvbmZpZywgY2ZnLmNhbGxiYWNrKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGN1c3RvbSBzdGF0ZSBldmVudCBsaXN0ZW5lcnMgZnJvbSBhIHdpZGdldC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gQ29uZmlnIG9iamVjdC4gU2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzLg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLmd1aWRdICBJZCBvZiB0aGUgd2lkZ2V0IHdob3NlIGV2ZW50cyBzaG91bGQgYmUgbW9uaXRvcmVkLiBEZWZhdWx0cyB0byBjdXJyZW50IHdpZGdldCBndWlkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtjZmcuZXZlbnRzXSBBcnJheSBvZiBldmVudHMuIElmIG5vIGV2ZW50IGlzIHByb3ZpZGVkIHRoaXMgbWV0aG9kIHdpbGwgcmVtb3ZlIG9ubHkgY3VzdG9tIGxpc3RlbmVycyBmcm9tIGFsbCByZWdpc3RlcmVkIGV2ZW50cy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLmNhbGxiYWNrXSBGdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSBhZnRlciB0aGUgbGlzdGVuZXIgaXMgcmVtb3ZlZC4NCgkgKg0KCSAqIEBleGFtcGxlDQoJICoNCgkgKiB3aWRnZXRTdGF0ZS5yZW1vdmVTdGF0ZUV2ZW50T3ZlcnJpZGVzKHsNCgkgKiAJICAgZXZlbnRzOiBbJ2JlZm9yZWNsb3NlJywnbWF4aW1pemUnXSwNCgkgKiAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KCSAqICAgICAJCS8vIERvIHNvbWV0aGluZw0KCSAqICAgICB9DQoJICogfSk7DQoJICoNCgkgKi8NCglyZW1vdmVTdGF0ZUV2ZW50T3ZlcnJpZGVzOiBmdW5jdGlvbihjZmcpIHsNCgkJY2ZnID0gY2ZnID8gY2ZnIDoge307DQoJCQ0KCQl2YXIgY29uZmlnID0gew0KCQkJZm46ICJyZW1vdmVTdGF0ZUV2ZW50T3ZlcnJpZGVzIiwNCgkJCXBhcmFtczogew0KCQkJCWd1aWQ6IGNmZy5ndWlkID8gY2ZnLmd1aWQgOiB0aGlzLndpZGdldEd1aWQsDQoJCQkJZXZlbnRzOiBjZmcuZXZlbnRzDQoJCQl9DQoJCX07DQoJCXRoaXMud2lkZ2V0U3RhdGVIYW5kbGVyLmhhbmRsZVdpZGdldFJlcXVlc3QoY29uZmlnLCBjZmcuY2FsbGJhY2spOw0KCX0NCg0KfTsNCg0KLyoqDQogKiBAcGFyYW0ge09iamVjdH0gW2NmZ10gY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMNCiAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLndpZGdldEV2ZW50aW5nQ29udHJvbGxlcl0gIFRoZSB3aWRnZXRFdmVudGluZ0NvbnRyb2xsZXINCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NmZy5hdXRvSW5pdF0gV2hldGhlciBvciBub3QgdG8gYXV0b21hdGljYWxseSBzdGFydCBsaXN0ZW5pbmcgdG8gdGhlIHN0YXRlIGNoYW5uZWwuICBEZWZhdWx0IGlzIHRydWUuDQogKiBAcGFyYW0ge1N0cmluZ30gW2NmZy53aWRnZXRHdWlkXSAgVGhlIGd1aWQgb2YgdGhlIHdpZGdldCB0byBtb25pdG9yLiBEZWZhdWx0IGlzIGl0c2VsZi4NCiAqIEBwYXJhbSB7U3RyaW5nfSBbY2ZnLm9uU3RhdGVFdmVudFJlY2VpdmVkXSAgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gYW4gZXZlbnQgaXMgcmVjZWl2ZWQuDQogKiBAZGVzY3JpcHRpb24gUmV0cmlldmVzIE96b25lLnN0YXRlLldpZGdldFN0YXRlIFNpbmdsZXRvbiBpbnN0YW5jZS4gTWFuYWdlcyB0aGUgdHdvLXdheSBjb21tdW5pY2F0aW9uIGJldHdlZW4gYW4gT1dGIHdpZGdldCBhbmQgaXRzIE9XRiBDb250YWluZXIuDQogKiBAcmVxdWlyZXMgPGEgaHJlZj0iT3pvbmUuZXZlbnRpbmcuV2lkZ2V0Lmh0bWwiPk96b25lLmV2ZW50aW5nLldpZGdldDwvYT4gZm9yIGV2ZW50aW5nDQogKiBAc2luY2UgT1dGIDMuNy4wDQogKiBAZXhhbXBsZQ0KICogdmFyIHdpZGdldFN0YXRlID0gT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUuZ2V0SW5zdGFuY2Uoew0KICogICAgIG9uU3RhdGVFdmVudFJlY2VpdmVkOiBmdW5jdGlvbihzZW5kZXIsIG1zZykgew0KICogICAgICAgICAgLy8gZG8gc29tZXRoaW5nDQogKiAgICAgfQ0KICogfSk7DQogKg0KICovDQpPem9uZS5zdGF0ZS5XaWRnZXRTdGF0ZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGNmZykgew0KICBpZiAoT3pvbmUuc3RhdGUuV2lkZ2V0U3RhdGUuaW5zdGFuY2UgPT0gbnVsbCkgew0KICAgIE96b25lLnN0YXRlLldpZGdldFN0YXRlLmluc3RhbmNlID0gbmV3IE96b25lLnN0YXRlLldpZGdldFN0YXRlKGNmZyk7DQogIH0NCiAgcmV0dXJuIE96b25lLnN0YXRlLldpZGdldFN0YXRlLmluc3RhbmNlOw0KfTsNCgovKioNCiAqIEBpZ25vcmUNCiAqLw0KdmFyIE96b25lID0gT3pvbmUgPyBPem9uZSA6IHt9Ow0KDQovKioNCiAqIEBpZ25vcmUNCiAqIEBuYW1lc3BhY2UNCiAqLw0KT3pvbmUuZXZlbnRpbmcgPSBPem9uZS5ldmVudGluZyA/IE96b25lLmV2ZW50aW5nIDoge307DQoNCihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoNCiAgICBmdW5jdGlvbiBycGNDYWxsKHdpZGdldElkLCB3aWRnZXRJZENhbGxlciwgZnVuY3Rpb25OYW1lLCB2YXJfYXJncykgew0KICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICJGVU5DVElPTl9DQUxMIiwgbnVsbCwgd2lkZ2V0SWQsIHdpZGdldElkQ2FsbGVyLCBmdW5jdGlvbk5hbWUsIHZhcl9hcmdzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIG9yIHVwZGF0ZXMgYSBwcm94eSAtIFRoaXMgaXMgYSBwcml2YXRlIGNvbnN0cnVjdG9yIC0gRG8gbm90IGNhbGwgdGhpcyBkaXJlY3RseS4gIFRoZSBvdGhlcg0KICAgICAqIFdpZGdldCBBUElzIHN1Y2ggYXMgV2lkZ2V0IEludGVudHMgbWF5IHJldHVybiBhIHByb3h5LiAgQSBwcm94eSBtYXkgY29udGFpbiBkeW5hbWljIGZ1bmN0aW9ucyB0aGF0IHdlcmUNCiAgICAgKiByZWdpc3RlcmVkIGJ5IHRoZSBvcmlnaW4gd2lkZ2V0Lg0KICAgICAqDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHdpZCBJZCBvZiB0aGUgV2lkZ2V0IHRoaXMgcHJveHkgcmVwcmVzZW50cw0KICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGZ1bmN0aW9ucyBBcnJheSBvZiBvYmplY3RzIHJlcHJlc2VudGluZyBwcm94eSBmdW5jdGlvbnMNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3JjSWQgSWQgb2YgdGhlIHNvdXJjZSBXaWRnZXQgd2hvIGlzIHVzaW5nIHRoZSBwcm94eQ0KICAgICAqIEBwYXJhbSB7T3pvbmUuZXZlbnRpbmcuV2lkZ2V0UHJveHl9IFtwcm94eV0gQSBleGlzdGluZyBwcm94eSBvYmplY3QgdG8gYmUgdXNlZCwgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBpbnN0YW5jZQ0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIE96b25lLmV2ZW50aW5nLldpZGdldFByb3h5ID0gZnVuY3Rpb24gKHdpZCwgZnVuY3Rpb25zLCBzcmNJZCwgcHJveHkpIHsNCiAgICAgICAgdmFyIHdpZGdldElkID0gd2lkLA0KICAgICAgICAgICAgd2lkZ2V0SWZyYW1lSWQsDQogICAgICAgICAgICByZWFkeUxpc3QgPSBbXSwNCiAgICAgICAgICAgIHB1YiA9IHByb3h5Ow0KDQogICAgICAgIC8vIGFzc3VtZSBKU09ODQogICAgICAgIGlmKHdpZGdldElkLmNoYXJBdCgwKSA9PT0gJ3snKSB7DQogICAgICAgICAgICB3aWRnZXRJZnJhbWVJZCA9IHdpZGdldElkOw0KICAgICAgICAgICAgd2lkZ2V0SWQgPSBPV0YuVXRpbC5wYXJzZUpzb24od2lkZ2V0SWZyYW1lSWQpLmlkOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgd2lkZ2V0SWZyYW1lSWQgPSAne1wiaWRcIjpcIicgKyB3aWRnZXRJZCArICdcIn0nOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAocHViID09IG51bGwpIHsNCiAgICAgICAgICAgIHB1YiA9IC8qKiBAbGVuZHMgT3pvbmUuZXZlbnRpbmcuV2lkZ2V0UHJveHkucHJvdG90eXBlICovIHsNCg0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIElkIG9mIHRoZSBXaWRnZXQgdGhhdCB0aGlzIHByb3h5IHJlcHJlc2VudHMNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICBpZDp3aWRnZXRJZnJhbWVJZCwNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBGbGFnIHdoaWNoIHJlcHJlc2VudHMgaWYgdGhlIFdpZGdldCB0aGlzIHByb3h5IHJlcHJlc2VudHMNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICBpc1JlYWR5OmZhbHNlLA0KICAgICAgICAgICAgICAgIGNhbGxiYWNrczp7fSwNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBTZW5kcyBhIGRpcmVjdCBtZXNzYWdlIHRvIHRoZSBXaWRnZXQgdGhpcyBwcm94eSByZXByZXNlbnRzDQogICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFUb1NlbmQNCiAgICAgICAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAgICAgICAqIHZhciB3aWRnZXRQcm94eSA9IE9XRi5SUEMuZ2V0V2lkZ2V0UHJveHkoaWQpOw0KICAgICAgICAgICAgICAgICAqIHdpZGdldFByb3h5LnNlbmRNZXNzYWdlKHtkYXRhOidmb28nfSk7DQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2U6ZnVuY3Rpb24gKGRhdGFUb1NlbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAnRElSRUNUX01FU1NBR0UnLCBudWxsLCB3aWRnZXRJZCwgZGF0YVRvU2VuZCk7DQogICAgICAgICAgICAgICAgfSwNCg0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIFJlZ2lzdGVycyBhIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIFdpZGdldCBoYXMgY2FsbGVkIG5vdGlmeVJlYWR5DQogICAgICAgICAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gcmVhZHlMaXN0ZW5lciBmdW5jdGlvbiB0byBleGVjdXRlDQogICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJlYWR5TGlzdGVuZXJTY29wZSBzY29wZSBmb3IgdGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2l0aA0KICAgICAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgICAgICogdmFyIHdpZGdldFByb3h5ID0gT1dGLlJQQy5nZXRXaWRnZXRQcm94eShpZCk7DQogICAgICAgICAgICAgICAgICogd2lkZ2V0UHJveHkub25SZWFkeShmdW5jdGlvbigpIHsgY29uc29sZS5sb2coIk90aGVyIHdpZGdldCBpcyByZWFkeSEiKTsgfSk7DQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgb25SZWFkeTpmdW5jdGlvbiAocmVhZHlMaXN0ZW5lciwgcmVhZHlMaXN0ZW5lclNjb3BlKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNSZWFkeSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9qdXN0IGV4ZWN1dGUgYmVjYXVzZSB0aGUgd2lkZ2V0IGlzIGFscmVhZHkgcmVhZHkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWR5TGlzdGVuZXIuY2FsbChyZWFkeUxpc3RlbmVyU2NvcGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9zYXZlIHJlYWR5IGxpc3RlbmVycw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZHlMaXN0LnB1c2goe2ZuOnJlYWR5TGlzdGVuZXIsIHNjb3BlOnJlYWR5TGlzdGVuZXJTY29wZX0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBmaXJlUmVhZHk6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUmVhZHkgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVhZHlMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkeUxpc3RbaV0uZm4uY2FsbChyZWFkeUxpc3RbaV0uc2NvcGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChmdW5jdGlvbnMgIT0gbnVsbCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IGZ1bmN0aW9ucy5sZW5ndGg7IGlpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgZnVuY3Rpb25OYW1lID0gZnVuY3Rpb25zW2lpXTsNCg0KICAgICAgICAgICAgICAgIHB1YltmdW5jdGlvbk5hbWVdID0gZnVuY3Rpb24gKG5hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2tFeGlzdHMgPSB0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwLCBjYWxsYmFja0V4aXN0cyA/IGFyZ3VtZW50cy5sZW5ndGggLSAxIDogYXJndW1lbnRzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWIuY2FsbGJhY2tzW25hbWVdID0gY2FsbGJhY2s7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBycGNDYWxsLmNhbGwodGhpcywgd2lkZ2V0SWQsIHNyY0lkLCBuYW1lLCBhcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0oZnVuY3Rpb25OYW1lKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHB1YjsNCiAgICB9Ow0KDQp9KHdpbmRvdywgZG9jdW1lbnQpKTsKLy9Ub3AgbGV2ZWwgbmFtZXNwYWNlIGRlZnMKdmFyIE96b25lID0gT3pvbmUgfHwge307Ck96b25lLmV2ZW50aW5nID0gT3pvbmUuZXZlbnRpbmcgfHwge307Ck96b25lLmV2ZW50aW5nLnByaXYgPSBPem9uZS5ldmVudGluZy5wcml2IHx8IHt9OwoKLy8gaWYgKHR5cGVvZiBKU09OID09PSAndW5kZWZpbmVkJykgewovLyAgICAgSlNPTiA9IGdhZGdldHMuanNvbjsKLy8gfQoKKGZ1bmN0aW9uIChvem9uZUV2ZW50aW5nKSB7CgogICAgaWYgKHR5cGVvZiBKU09OID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHZhciBKU09OID0gZ2FkZ2V0cy5qc29uOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBwcml2YXRlIG9iamVjdHMgYW5kIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICB2YXIgV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSA9ICdfd2lkZ2V0UmVhZHknLAogICAgICAgIEdFVF9XSURHRVRfUkVBRFlfU0VSVklDRV9OQU1FID0gJ19nZXRXaWRnZXRSZWFkeScsCiAgICAgICAgY29uZmlnID0gbnVsbCwKICAgICAgICBmbk1hcCA9IHt9LAogICAgICAgIHdpZGdldFByb3h5TWFwID0ge307CgogICAgZnVuY3Rpb24gZ2V0Q29uZmlnKCkgewogICAgICAgIGlmIChjb25maWcgPT0gbnVsbCkgewogICAgICAgICAgICBjb25maWcgPSB7fTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lLmNoYXJBdCgwKSAhPSAneycpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5ycGNJZCA9IHdpbmRvdy5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uZmlnID0gSlNPTi5wYXJzZSh3aW5kb3cubmFtZSk7CiAgICAgICAgICAgICAgICBjb25maWcucnBjSWQgPSBjb25maWcuaWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gY29uZmlnOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRXaWRnZXRQcm94eU1hcCgpIHsKICAgICAgICByZXR1cm4gd2lkZ2V0UHJveHlNYXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SWRGcm9tV2luZG93TmFtZSgpIHsKICAgICAgICByZXR1cm4gZ2V0Q29uZmlnKCkucnBjSWQ7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRGlyZWN0TWVzc2FnZVdyYXBwZXIobWVzc2FnZSkgewogICAgICAgIGlmIChvem9uZUV2ZW50aW5nLmhhbmRsZURpcmVjdE1lc3NhZ2UpIG96b25lRXZlbnRpbmcuaGFuZGxlRGlyZWN0TWVzc2FnZShtZXNzYWdlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDaGlsZFdpZGdldDogS2VybmVsOiBEZWZhdWx0IGRpcmVjdCBtZXNzYWdlIGhhbmRsZXIsIGRvaW5nIG5vdGhpbmcuICBPdmVycmlkZSBieSBkZWZpbmluZyBPem9uZS5ldmVudGluZy5oYW5kbGVEaXJlY3RNZXNzYWdlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRnVuY3Rpb25DYWxsKCkgewogICAgICAgIHZhciB2YXJfYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdmFyIGZuX2FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDMpOwogICAgICAgIHZhciB3aWRnZXRJZCA9IHZhcl9hcmdzWzBdOwogICAgICAgIHZhciB3aWRnZXRJZENhbGxlciA9IHZhcl9hcmdzWzFdOwoKICAgICAgICB2YXIgZm5OYW1lID0gdmFyX2FyZ3NbMl07CiAgICAgICAgdmFyIGZuT2JqID0gZm5NYXBbZm5OYW1lXTsKCiAgICAgICAgLy9pZCBvZiB0aGUgY2FsbGluZyB3aWRnZXQKICAgICAgICBmbk9iai5mbi53aWRnZXRJZENhbGxlciA9IHdpZGdldElkQ2FsbGVyOwoKICAgICAgICB2YXIgcmVzdWx0ID0gZm5PYmouZm4uYXBwbHkoZm5PYmouc2NvcGUsIGZuX2FyZ3NbMF0pOwoKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICdGVU5DVElPTl9DQUxMX1JFU1VMVCcsIG51bGwsIHdpZGdldElkLCB3aWRnZXRJZENhbGxlciwgZm5OYW1lLCByZXN1bHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUZ1bmN0aW9uQ2FsbFJlc3VsdCh3aWRnZXRJZCwgZnVuY3Rpb25OYW1lLCByZXN1bHQpIHsKICAgICAgICB2YXIgd3Byb3h5ID0gd2lkZ2V0UHJveHlNYXBbd2lkZ2V0SWRdOwogICAgICAgIGlmICh3cHJveHkgIT0gbnVsbCkgewogICAgICAgICAgICB2YXIgY2IgPSB3cHJveHkuY2FsbGJhY2tzW2Z1bmN0aW9uTmFtZV07CiAgICAgICAgICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGNiLmNhbGwod2luZG93LCByZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUV2ZW50Q2FsbChldmVudE5hbWUpIHsKICAgICAgICB2YXIgZm4gPSBvem9uZUV2ZW50aW5nLnByaXYuY2xpZW50RXZlbnROYW1lVG9IYW5kbGVyW2V2ZW50TmFtZV07CiAgICAgICAgdmFyIHZhcl9hcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICBmbi5hcHBseSh3aW5kb3csIHZhcl9hcmdzKTsKICAgIH0KCiAgICBvem9uZUV2ZW50aW5nLnByaXYuY2xpZW50RXZlbnROYW1lVG9IYW5kbGVyID0ge307CgogICAgb3pvbmVFdmVudGluZy5hZnRlcl9jb250YWluZXJfaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgIH07CgogICAgLy9SZWNvcmQgYWxsIHB1YmxpYyBmdW5jdGlvbnMgZnJvbSBhIHdpZGdldAogICAgZnVuY3Rpb24gZ2V0RnVuY3Rpb25OYW1lcyhmdW5jdGlvbnMpIHsKICAgICAgICBpZiAoZnVuY3Rpb25zKSB7CiAgICAgICAgICAgIHZhciBmdW5jTmFtZXMgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IGZ1bmN0aW9ucy5sZW5ndGg7IGlpKyspIHsKICAgICAgICAgICAgICAgIHZhciBmbk5hbWUgPSBmdW5jdGlvbnNbaWldLm5hbWU7CiAgICAgICAgICAgICAgICBmdW5jTmFtZXMucHVzaChmbk5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmdW5jTmFtZXM7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsaWVudFNpZGVGdW5jdGlvblNoaW1zKHdpZGdldElkLCBmdW5jdGlvbnMsIGluaXRpYWxQcm94eSkgewogICAgICAgIHdpZGdldFByb3h5TWFwW3dpZGdldElkXSA9IG5ldyBPem9uZS5ldmVudGluZy5XaWRnZXRQcm94eSh3aWRnZXRJZCwgZnVuY3Rpb25zLCBnZXRJZEZyb21XaW5kb3dOYW1lKCksIGluaXRpYWxQcm94eSk7CiAgICAgICAgcmV0dXJuIHdpZGdldFByb3h5TWFwW3dpZGdldElkXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZWxheVVybCh1cmwpIHsKICAgICAgICB2YXIgcHJvdG9jb2xJZHggPSB1cmwuaW5kZXhPZigiLy8iKTsKICAgICAgICB2YXIgcHJvdG9jb2xFbmRJZHggPSB1cmwuaW5kZXhPZigiLyIsIHByb3RvY29sSWR4ICsgMik7CiAgICAgICAgdmFyIGFwcEVuZElkeCA9IHVybC5pbmRleE9mKCIvIiwgcHJvdG9jb2xFbmRJZHggKyAxKTsKICAgICAgICB2YXIgcmVsYXkgPSB1cmwuc3Vic3RyaW5nKDAsIGFwcEVuZElkeCArIDEpICsgInJwY19yZWxheS5odG1sIjsKICAgICAgICByZXR1cm4gcmVsYXk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FjaGVGdW5jdGlvbnMoZnVuY3Rpb25zKSB7CiAgICAgICAgdmFyIGZuT2JqOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZnVuY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGZuT2JqID0gZnVuY3Rpb25zW2ldOwoKICAgICAgICAgICAgaWYgKCFmbk9iai5uYW1lKQogICAgICAgICAgICAgICAgdGhyb3cgJ0Vycm9yOiBuYW1lIGlzIG5vdCBzZXQnCiAgICAgICAgICAgIGlmICghZm5PYmouZm4pCiAgICAgICAgICAgICAgICB0aHJvdyAnRXJyb3I6IGZuIGlzIG5vdCBzZXQnCgogICAgICAgICAgICBmbk1hcFtmbk9iai5uYW1lXSA9IGZuT2JqOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gcHVibGljIG9iamVjdHMgYW5kIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogICAgLyoqCiAgICAgKiBjbGllbnRJbml0aWFsaXplIC0gSW5pdGlhbGl6ZSBhIHdpZGdldAogICAgICoKICAgICAqIEBwYXJhbXMgICAgICAgIHB1YmxpY0Z1Y25jdGlvbnMgLSBvcHRpb25hbCBhcnJheSBvZiBmdW5jdGlvbnMgdG8gZXhwb3NlIHRvIG90aGVyIHdpZGdldHMKICAgICAqCiAgICAgKiAgICBGb3IgZXhhbXBsZQogICAgICogICAgICAgIGZ1bmN0aW9uIHBsb3QobGF0LCBsb24pIHsgLy9kbyBzb21lIHBsb3R0aW5nIH0KICAgICAqICAgICAgICBmdW5jdGlvbiBjZW50ZXIobGF0LCBsb24pIHsgLy9kbyBzb21lIGNlbnRlcmluZyB9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsaWVudEluaXRpYWxpemUocHVibGljRnVuY3Rpb25zLCByZWxheVVybCkgewogICAgICAgIGdhZGdldHMucnBjLnNldFJlbGF5VXJsKCIuLiIsIGdldENvbmZpZygpLnJlbGF5VXJsLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoImFmdGVyX2NvbnRhaW5lcl9pbml0Iiwgb3pvbmVFdmVudGluZy5hZnRlcl9jb250YWluZXJfaW5pdCk7CgogICAgICAgIHB1YmxpY0Z1bmN0aW9ucyA9IFtdLmNvbmNhdChwdWJsaWNGdW5jdGlvbnMpOwogICAgICAgIGNhY2hlRnVuY3Rpb25zKHB1YmxpY0Z1bmN0aW9ucyk7CgogICAgICAgIHZhciBmbk5hbWVzID0gZ2V0RnVuY3Rpb25OYW1lcyhwdWJsaWNGdW5jdGlvbnMpOwogICAgICAgIHZhciBpZCA9IGdldElkRnJvbVdpbmRvd05hbWUoKTsKCiAgICAgICAgaWYgKHJlbGF5VXJsID09IG51bGwpIHsKICAgICAgICAgICAgcmVsYXlVcmwgPSBnZXRSZWxheVVybChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKTsKICAgICAgICB9CgovLyAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAiVEVMTF9GVU5DVElPTlMiLCBudWxsLCBpZCwgZm5OYW1lcywgcmVsYXlVcmwpOwoKICAgICAgICAvL3RoaXMgcnBjIGNhbGwgbXVzdCBiZSBjb25zaXN0ZW50IHdpdGggT1dGIGNvbnRhaW5lcl9pbml0CiAgICAgICAgdmFyIGlkU3RyaW5nID0gJ3tcImlkXCI6XCInICsgaWQgKyAnXCJ9JzsKICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgaWQ6aWRTdHJpbmcsCiAgICAgICAgICAgIHZlcnNpb246JzEuMCcsCiAgICAgICAgICAgIHVzZU11bHRpUGFydE1lc3NhZ2VzRm9ySUZQQzp0cnVlLAogICAgICAgICAgICByZWxheVVybDpyZWxheVVybAogICAgICAgIH07CiAgICAgICAgdmFyIGRhdGFTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICJjb250YWluZXJfaW5pdCIsIG51bGwsIGlkU3RyaW5nLCBkYXRhU3RyaW5nLCBmbk5hbWVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlckZ1bmN0aW9ucyhmdW5jdGlvbnMpIHsKICAgICAgICBmdW5jdGlvbnMgPSBbXS5jb25jYXQoZnVuY3Rpb25zKTsKCiAgICAgICAgY2FjaGVGdW5jdGlvbnMoZnVuY3Rpb25zKTsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICJyZWdpc3Rlcl9mdW5jdGlvbnMiLCBudWxsLCB3aW5kb3cubmFtZSwgZ2V0RnVuY3Rpb25OYW1lcyhmdW5jdGlvbnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIGltcG9ydFdpZGdldCAtIEdldCBhIHByb3h5IHRvIGFub3RoZXIgd2lkZ2V0IGluIHRoZSBjb250YWluZXIKICAgICAqCiAgICAgKiBAcmV0dXJucyAgICAgICBhIHByb3h5IG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHNlbmQgZGlyZWN0IG1lc3NhZ2VzLCBoYW5kbGUgZXZlbnRzLAogICAgICogICAgICAgICAgICAgICAgb3IgY2FsbCBmdW5jdGlvbnMgXAogICAgICoKICAgICAqICBOb3RlIHRoYXQgb25jZSBjcmVhdGVkLCB0aGUgcHJveHkgd2lsbCBiZSBhdmFpbGFibGUgaW4gdGhlIGdsb2JhbCBPem9uZS5ldmVudGluZwogICAgICogIGNvbGxlY3Rpb24KICAgICAqICAgIEZvciBleGFtcGxlCiAgICAgKiAgICAgICAgY3JlYXRlV2lkZ2V0KCJodHRwOi8vbWFwcy5jb20vd2lkZ2V0TWFwIiwgIk15TWFwV2lkZ2V0IiwgImRpdjEiLCAiMTAwJSIsICIxMDAlIiwgb2spOwogICAgICogICAgICAgIGZ1bmN0aW9uIG9rKCkgewogICAgICogICAgICAgICAgIE96b25lLmV2ZW50aW5nLk15TWFwV2lkZ2V0LnBsb3QoMS4xLDIuMik7CiAgICAgKiAgICAgICAgfQogICAgICovCiAgICBmdW5jdGlvbiBpbXBvcnRXaWRnZXQod2lkZ2V0SWQsIHJlYWR5KSB7CiAgICAgICAgLy8gYXNzdW1lIEpTT04KICAgICAgICBpZih3aWRnZXRJZC5jaGFyQXQoMCkgPT09ICd7JykgewogICAgICAgICAgICB3aWRnZXRJZCA9IE9XRi5VdGlsLnBhcnNlSnNvbih3aWRnZXRJZCkuaWQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJveHkgPSBjcmVhdGVDbGllbnRTaWRlRnVuY3Rpb25TaGltcyh3aWRnZXRJZCk7CgogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NGdW5jdGlvbnNGcm9tQ29udGFpbmVyKGZ1bmN0aW9ucykgewogICAgICAgICAgICBwcm94eSA9IGNyZWF0ZUNsaWVudFNpZGVGdW5jdGlvblNoaW1zKHdpZGdldElkLCBmdW5jdGlvbnMsIHByb3h5KTsKICAgICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCBHRVRfV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSwgZnVuY3Rpb24oaXNSZWFkeSkgewogICAgICAgICAgICAgICAgaWYgKGlzUmVhZHkpIHsKICAgICAgICAgICAgICAgICAgcHJveHkuZmlyZVJlYWR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlYWR5ID09ICdmdW5jdGlvbicpIHJlYWR5LmNhbGwodGhpcywgcHJveHkpOwogICAgICAgICAgICB9LCB3aWRnZXRJZCwgc3JjV2lkZ2V0SWZyYW1lSWQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGlkID0gZ2V0SWRGcm9tV2luZG93TmFtZSgpOwogICAgICAgIHZhciBzcmNXaWRnZXRJZnJhbWVJZCA9ICd7XCJpZFwiOlwiJyArIGlkICsgJ1wifSc7CiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgiLi4iLCAnR0VUX0ZVTkNUSU9OUycsIHByb2Nlc3NGdW5jdGlvbnNGcm9tQ29udGFpbmVyLCB3aWRnZXRJZCwgc3JjV2lkZ2V0SWZyYW1lSWQpOwogICAgICAgIHJldHVybiBwcm94eTsKICAgIH0KCiAgICAvKioKICAgICAqIExpc3RlbiBmb3IgZXZlbnRzIG9mIGEgZ2l2ZW4gbmFtZSB1c2luZyB0aGUgc3BlY2lmaWVkIGhhbmRsZXIgZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gYWRkRXZlbnRIYW5kbGVyKGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgICAgIG96b25lRXZlbnRpbmcucHJpdi5jbGllbnRFdmVudE5hbWVUb0hhbmRsZXJbZXZlbnROYW1lXSA9IGhhbmRsZXI7CiAgICAgICAgdmFyIHdpZGdldElkID0gZ2V0SWRGcm9tV2luZG93TmFtZSgpOwogICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgJ0FERF9FVkVOVCcsIG51bGwsIHdpZGdldElkLCBldmVudE5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmFpc2UgYW5kIGV2ZW50IHdpdGggYSBqc29uIHBheWxvYWQKICAgICAqLwogICAgZnVuY3Rpb24gcmFpc2VFdmVudChldmVudE5hbWUsIHBheWxvYWQpIHsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICdDQUxMX0VWRU5UJywgbnVsbCwgZXZlbnROYW1lLCBwYXlsb2FkKTsKICAgIH0KCiAgICAvKioKICAgICAqIGNsb3NlRGlhbG9nIC0gQ2xvc2UgY3VycmVudCBkaWFsb2cgd2lkZ2V0LCByZXR1cm5pbmcgYSBqc29uIHBheWxvYWQgdG8gdGhlIGNvbnRhaW5lci4KICAgICAqLwogICAgZnVuY3Rpb24gY2xvc2VEaWFsb2cocGF5bG9hZCkgewogICAgICAgIGRvY3VtZW50LmJvZHkuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBnYWRnZXRzLnJwYy5jYWxsKCIuLiIsICdDTE9TRV9FVkVOVCcsIG51bGwsIGdldElkRnJvbVdpbmRvd05hbWUoKSwgcGF5bG9hZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBnZXRBbGxXaWRnZXRzIC0gR2V0IGFuIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyB0aGUgdXJsIGFuZCBpZCBvZiBhbGwgY3VycmVudGx5CiAgICAgKiAgICAgICAgICAgICAgICAgb3BlbiB3aWRnZXRzLgogICAgICoKICAgICAqICAgZWcgWyB7IHVybDogImh0dHA6Ly93d3cuZXhhbXBsZS5jb20iLCBpZDogImZvbyIgfSwgLi4uIF0KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QWxsV2lkZ2V0cyhoYW5kbGVyRm4pIHsKICAgICAgICBmdW5jdGlvbiBsaXN0UmVzdWx0SGFuZGxlcih3aWRnZXRMaXN0KSB7CiAgICAgICAgICAgIGhhbmRsZXJGbih3aWRnZXRMaXN0KTsKICAgICAgICB9CgogICAgICAgIGdhZGdldHMucnBjLmNhbGwoIi4uIiwgJ0xJU1RfV0lER0VUUycsIGxpc3RSZXN1bHRIYW5kbGVyKTsKICAgIH0KCiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcignRElSRUNUX01FU1NBR0VMX0NMSUVOVCcsIGhhbmRsZURpcmVjdE1lc3NhZ2VXcmFwcGVyKTsKICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJGVU5DVElPTl9DQUxMX0NMSUVOVCIsIGhhbmRsZUZ1bmN0aW9uQ2FsbCk7CiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcigiRlVOQ1RJT05fQ0FMTF9SRVNVTFRfQ0xJRU5UIiwgaGFuZGxlRnVuY3Rpb25DYWxsUmVzdWx0KTsKICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKCJFVkVOVF9DTElFTlQiLCBoYW5kbGVFdmVudENhbGwpOwogICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoV0lER0VUX1JFQURZX1NFUlZJQ0VfTkFNRSwgZnVuY3Rpb24gKHdpZGdldElkKSB7CiAgICAgICAgdmFyIHdwcm94eSA9IHdpZGdldFByb3h5TWFwW3dpZGdldElkXTsKICAgICAgICBpZiAod3Byb3h5ICE9IG51bGwpIHsKICAgICAgICAgICAgd3Byb3h5LmZpcmVSZWFkeSgpOwogICAgICAgIH0KICAgIH0pOwoKCgogICAgb3pvbmVFdmVudGluZy5jbGllbnRJbml0aWFsaXplID0gY2xpZW50SW5pdGlhbGl6ZTsKICAgIG96b25lRXZlbnRpbmcucmVnaXN0ZXJGdW5jdGlvbnMgPSByZWdpc3RlckZ1bmN0aW9uczsKICAgIG96b25lRXZlbnRpbmcuaW1wb3J0V2lkZ2V0ID0gaW1wb3J0V2lkZ2V0OwogICAgb3pvbmVFdmVudGluZy5hZGRFdmVudEhhbmRsZXIgPSBhZGRFdmVudEhhbmRsZXI7CiAgICBvem9uZUV2ZW50aW5nLnJhaXNlRXZlbnQgPSByYWlzZUV2ZW50OwogICAgb3pvbmVFdmVudGluZy5jbG9zZURpYWxvZyA9IGNsb3NlRGlhbG9nOwogICAgb3pvbmVFdmVudGluZy5nZXRBbGxXaWRnZXRzID0gZ2V0QWxsV2lkZ2V0czsKICAgIG96b25lRXZlbnRpbmcuZ2V0V2lkZ2V0UHJveHlNYXAgPSBnZXRXaWRnZXRQcm94eU1hcDsKCn0pKE96b25lLmV2ZW50aW5nKTsKCi8qKg0KICogQGZpbGVvdmVydmlldyBCYXNpYyBtZXRyaWNzIGNhcGFiaWxpdHkuICBFeHBlY3RhdGlvbiBpcyB0aGF0IG5ldyBtZXRyaWNzIHdpbGwgDQogKiAgbGlrZWx5IGJlIHNldCB1cCBhcyBzZXBhcmF0ZSBmaWxlcyAvIHNlcGFyYXRlIHNldHMuICAgIA0KICovDQoNCi8qKg0KICogQG5hbWVzcGFjZQ0KICovDQp2YXIgT3pvbmUgPSBPem9uZSB8fCB7fTsNCg0KLyoqDQogKiBAbmFtZXNwYWNlDQogKi8NCk96b25lLm1ldHJpY3MgPSBPem9uZS5tZXRyaWNzIHx8IHt9Ow0KDQovKioNCiAqIEBkZXNjcmlwdGlvbiBCYXNpYyBsb2dnaW5nIGNhcGFiaWxpdHkgLSBtZWFudCB0byBiZSBjYWxsZWQgYnkgb3RoZXIgbWV0aG9kcw0KICogICAgd2hpY2ggdHJhbnNmb3JtIG9yIHZhbGlkYXRlIGRhdGEgIA0KICogQHNpbmNlIE9XRiAzLjguMA0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQNCiAqIEBwYXJhbSB7U3RyaW5nfSB1c2VyTmFtZQ0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY1NpdGUgSWRlbnRpZmllciwgcG90ZW50aWFsbHkgVVJMLCBmb3Igc291cmNlIG9mIG1ldHJpYyAtIHR5cGljYWxseSBPV0YgaW5zdGFuY2UNCiAqIEBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnROYW1lICAgIA0KICogQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudElkIA0KICogQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudEluc3RhbmNlSWQNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNUeXBlSWQgU3RyaW5nIGRlc2NyaWJpbmcgbWV0cmljIC0gcmVjb21tZW5kIHBhY2thZ2UgbmFtZSBjb25zdHJ1Y3QNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNEYXRhIEFueSBhZGRpdGlvbmFsIGRhdGEgZm9yIG1ldHJpYyAtIGRvIGFueSBuZWNlc3NhcnkgdmFsaWRhdGlvbiBhcHByb3ByaWF0ZSB0byBtZXRyaWNUeXBlSWQgYmVmb3JlIHNlbmRpbmcgdGhyb3VnaCANCiAqLw0KT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgPSBmdW5jdGlvbih1c2VySWQsIHVzZXJOYW1lLCBtZXRyaWNTaXRlLCBjb21wb25lbnROYW1lLCBjb21wb25lbnRJZCwgY29tcG9uZW50SW5zdGFuY2VJZCwgbWV0cmljVHlwZUlkLCBtZXRyaWNEYXRhKSB7DQoJdmFyIGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTsNCgkNCiAgICBPem9uZS51dGlsLlRyYW5zcG9ydC5zZW5kKHsNCiAgICAgICAgdXJsOiBPV0YuZ2V0Q29udGFpbmVyVXJsKCkgKyAnL21ldHJpYycsDQogICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7DQogICAgICAgIH0sDQogICAgICAgIGF1dG9TZW5kVmVyc2lvbiA6IGZhbHNlLA0KICAgICAgICBjb250ZW50IDogew0KICAgICAgICAgIG1ldHJpY1RpbWU6IGN1cnJlbnREYXRlLmdldFRpbWUoKSwNCiAgICAgICAgICB1c2VySWQ6IHVzZXJJZCwNCiAgICAgICAgICB1c2VyTmFtZTogdXNlck5hbWUsDQogICAgICAgICAgc2l0ZTogbWV0cmljU2l0ZSwNCiAgICAgICAgICB1c2VyQWdlbnQ6IG5hdmlnYXRvci51c2VyQWdlbnQsDQogICAgICAgICAgY29tcG9uZW50OiBjb21wb25lbnROYW1lLA0KICAgICAgICAgIGNvbXBvbmVudElkOiBjb21wb25lbnRJZCwNCiAgICAgICAgICBpbnN0YW5jZUlkOiBjb21wb25lbnRJbnN0YW5jZUlkLA0KICAgICAgICAgIG1ldHJpY1R5cGVJZDogbWV0cmljVHlwZUlkLA0KICAgICAgICAgIHdpZGdldERhdGE6IG1ldHJpY0RhdGENCiAgICAgICAgfQ0KICAgIH0pOw0KfTsNCg0KLyoqDQogKiBAZGVzY3JpcHRpb24gTG9ncyBhIHNldCBvZiBtZXRyaWNzIHRvIHRoZSBzZXJ2ZXIgYWxsIGF0IG9uY2UuICBBbGwNCiAqIG1ldHJpY3MgcGFzc2VkIGludG8gYSBjYWxsIHRvIHRoaXMgZnVuY3Rpb24gd2lsbCBiZSBsb2dnZWQgaW4gYSBzaW5nbGUNCiAqIEhUVFAgcmVxdWVzdCwgaW5zdGVhZCBvZiBvbmUgcmVxdWVzdCBwZXIgbWV0cmljDQogKiBAc2luY2UgT1dGIDYuMA0KICoNCiAqIEBwYXJhbSB7QXJyYXl9IG1ldHJpY3MgDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS51c2VySWQNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLnVzZXJOYW1lDQogKiBAcGFyYW0ge051bWJlcn0gbWV0cmljc1sqXS5tZXRyaWNUaW1lIFRoZSB0aW1lIGF0IHdoaWNoIGlzIG1ldHJpYyB3YXMgY29sbGVjdGVkIChpbiBVTklYIHRpbWUpDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS5zaXRlIElkZW50aWZpZXIsIHBvdGVudGlhbGx5IFVSTCwgZm9yIHNvdXJjZSBvZiBtZXRyaWMgLSB0eXBpY2FsbHkgT1dGIGluc3RhbmNlDQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS5jb21wb25lbnQNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLmNvbXBvbmVudElkIA0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uaW5zdGFuY2VJZA0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0ubWV0cmljVHlwZUlkIFN0cmluZyBkZXNjcmliaW5nIG1ldHJpYyAtIHJlY29tbWVuZCBwYWNrYWdlIG5hbWUgY29uc3RydWN0DQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS53aWRnZXREYXRhIEFueSBhZGRpdGlvbmFsIGRhdGEgZm9yIG1ldHJpYyAtIGRvIGFueSBuZWNlc3NhcnkgdmFsaWRhdGlvbiBhcHByb3ByaWF0ZSB0byBtZXRyaWNUeXBlSWQgYmVmb3JlIHNlbmRpbmcgdGhyb3VnaCANCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLnVzZXJBZ2VudCBTaG91bGQgYmUgc2V0IHRvIHRoZSB1c2VyLWFnZW50IHN0cmluZyBvZiB0aGUgYnJvd3Nlcg0KICovDQpPem9uZS5tZXRyaWNzLmxvZ0JhdGNoTWV0cmljcyA9IGZ1bmN0aW9uKG1ldHJpY3MpIHsNCgl2YXIgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpOw0KCQ0KICAgIE96b25lLnV0aWwuVHJhbnNwb3J0LnNlbmQoew0KICAgICAgICB1cmw6IE9XRi5nZXRDb250YWluZXJVcmwoKSArICcvbWV0cmljJywNCiAgICAgICAgbWV0aG9kOiAnUE9TVCcsDQogICAgICAgIG9uU3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHsNCiAgICAgICAgfSwNCiAgICAgICAgYXV0b1NlbmRWZXJzaW9uIDogZmFsc2UsDQogICAgICAgIGNvbnRlbnQgOiB7DQogICAgICAgIAlkYXRhOiBtZXRyaWNzDQogICAgICAgIH0NCiAgICB9KTsNCn07DQoNCi8qKg0KICogQGRlc2NyaXB0aW9uIExvZyB2aWV3IG9mIHdpZGdldCAtIHNlZSBjYWxscyBpbiBkYXNoYm9hcmRzDQogKiBAc2luY2UgT1dGIDMuOC4wDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IHVzZXJJZCAgICAgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgdXNlcklkDQogKiBAcGFyYW0ge1N0cmluZ30gdXNlck5hbWUgICAtIHNlZSBPem9uZS5tZXRyaWNzLmxvZ01ldHJpYyB1c2VyTmFtZQ0KICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY1NpdGUgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgbWV0cmljU2l0ZQ0KICogQHBhcmFtIHtPYmplY3R9IHdpZGdldCAgIA0KICovIA0KT3pvbmUubWV0cmljcy5sb2dXaWRnZXRSZW5kZXIgPSBmdW5jdGlvbih1c2VySWQsIHVzZXJOYW1lLCBtZXRyaWNTaXRlLCB3aWRnZXQpIHsNCg0KICAvLyBjaGVja2luZyBoZXJlLCBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBtYXkgc2F2ZSBvdXJzZWx2ZXMgc29tZSB2YWxpZGF0aW9uIHRpbWUNCiAgLy8gICBvbiBhbnkgd2lkZ2V0IGRhdGEgdmFsaWRhdGlvbiAobGFzdCBwYXJhbSkNCiAgaWYgKE96b25lLmNvbmZpZy5tZXRyaWMuZW5hYmxlZCA9PT0gdHJ1ZSkgew0KICAgICAgT3pvbmUubWV0cmljcy5sb2dNZXRyaWModXNlcklkLCB1c2VyTmFtZSwgbWV0cmljU2l0ZSwgd2lkZ2V0Lm5hbWUsIHdpZGdldC53aWRnZXRHdWlkLCB3aWRnZXQuaWQsICJvem9uZS53aWRnZXQudmlldyIsICIiKTsNCiAgICAgIH0NCn07DQoKLyoqCiAqIEBpZ25vcmUKICovCnZhciBPem9uZSA9IE96b25lID8gT3pvbmUgOiB7fTsKCi8qKgogKiBAbmFtZXNwYWNlCiAqIEBzaW5jZSBPV0YgNS4wCiAqLwpPV0YgPSB3aW5kb3cuT1dGID8gd2luZG93Lk9XRiA6IHt9OwoKKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoKCXZhciBXSURHRVRfUkVBRFlfU0VSVklDRV9OQU1FID0gJ193aWRnZXRSZWFkeScsCgogICAgICAgIGlzUmVhZHkgPSBmYWxzZSwKCQlyZWFkeUxpc3QgPSBbXSwKCQl3aWRnZXQgPSBPem9uZS51dGlsLnBhcnNlV2luZG93TmFtZURhdGEoKSwKCQlldmVudGluZ0NvbnRyb2xsZXIsCgkJZHJhZ0FuZERyb3BDb250cm9sbGVyLAoJCWxhdW5jaGluZ0NvbnRyb2xsZXIsCgkJY2hyb21lQ29udHJvbGxlcjsKCglvd2Zkb2pvLm1peGluKE9XRiwgLyoqIEBsZW5kcyBPV0YgKi8gewoKCQkvKioKCQkgKiBUaGUgT1dGLkV2ZW50aW5nIG9iamVjdCBtYW5hZ2VzIHRoZSBldmVudGluZyBmb3IgYW4gaW5kaXZpZHVhbCB3aWRnZXQKCQkgKiAKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLkV2ZW50aW5nCgkJICovCgkJRXZlbnRpbmc6IHt9LAoKCQkvKioKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLlJQQwoJCSAqLwoJCVJQQzoge30sCgoJCS8qKgoJCSAqIFRoaXMgb2JqZWN0IGlzIHVzZWQgdG8gY3JlYXRlLCByZXRyaWV2ZSwgdXBkYXRlIGFuZCBkZWxldGUgdXNlciBwcmVmZXJlbmNlcy4KCQkgKiAKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLlByZWZlcmVuY2VzCgkJICovCgkJUHJlZmVyZW5jZXM6IHt9LAoKCQkvKioKCQkgKiBUaGlzIG9iamVjdCBpcyB1c2VkIGxhdW5jaCBvdGhlciB3aWRnZXRzLiAKCQkgKgoJCSAqIEBuYW1lc3BhY2UKCQkgKiBAbmFtZSBPV0YuTGF1bmNoZXIKCQkgKi8KCQlMYXVuY2hlcjoge30sCgoJCS8qKgoJCSAqIFRoZSBPV0YuRHJhZ0FuZERyb3Agb2JqZWN0IG1hbmFnZXMgdGhlIGRyYWcgYW5kIGRyb3AgZm9yIGFuIGluZGl2aWR1YWwgd2lkZ2V0LgoJCSAqIAoJCSAqIEBuYW1lc3BhY2UKCQkgKiBAbmFtZSBPV0YuRHJhZ0FuZERyb3AKCQkgKi8KCQlEcmFnQW5kRHJvcDoge30sCgoJCS8qKgoJCSAqIFRoaXMgb2JqZWN0IGFsbG93cyBhIHdpZGdldCB0byBtb2RpZnkgdGhlIGJ1dHRvbiBjb250YWluZWQgaW4gdGhlIHdpZGdldCBoZWFkZXIgKHRoZSBjaHJvbWUpLiAKCQkgKgoJCSAqIEBuYW1lc3BhY2UKCQkgKiBAbmFtZSBPV0YuQ2hyb21lCgkJICovCgkJQ2hyb21lOiB7fSwKCgkJLyoqCgkJICogUHJvdmlkZXMgT1dGIHV0aWxpdHkgbWV0aG9kcyBmb3IgdGhlIHdpZGdldCBkZXZlbG9wZXIgCgkJICoKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLlV0aWwKCQkgKi8KCQlVdGlsOiBPem9uZS51dGlsLAoKCQkvKioKCQkgKiAKCQkgKgoJCSAqIEBuYW1lc3BhY2UKCQkgKiBAbmFtZSBPV0YuTWV0cmljcwoJCSAqLwoJCU1ldHJpY3M6IE96b25lLm1ldHJpY3MsCgoJCS8qKgoJCSAqIFByb3ZpZGVzIGZ1bmN0aW9ucyB0byBsb2cgbWVzc2FnZXMgYW5kIG9iamVjdHMKCQkgKiAKCQkgKiBAbmFtZXNwYWNlCgkJICogQG5hbWUgT1dGLkxvZwoJCSAqLwoJCUxvZzogT3pvbmUubG9nLAoKCQkvKioKCQkgKiBQcm92aWRlcyB1dGlsaXR5IG1ldGhvZHMgZm9yIGxvY2FsaXphdGlvbgoJCSAqCgkJICogQG5hbWVzcGFjZQoJCSAqIEBuYW1lIE9XRi5MYW5nCgkJICovCgkJTGFuZzogT3pvbmUubGFuZywKCQkKCQlWZXJzaW9uOiBPem9uZS52ZXJzaW9uLAoKCQkvKioKCQkJQWNjZXB0cyBhIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgd2hlbiBPem9uZSBBUElzIGFyZSByZWFkeSBmb3IgdXNlCgkJCUBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgRnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIE9XRiBBUElzIGFyZSByZWFkeQoJCQlAcGFyYW0ge09iamVjdH0gc2NvcGUgVGhlIHNjb3BlICh0aGlzIHJlZmVyZW5jZSkgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLiBJZiBvbWl0dGVkLCBkZWZhdWx0cyB0byB0aGUgYnJvd3NlciB3aW5kb3cuCgkJKi8KCQlyZWFkeTogZnVuY3Rpb24oaGFuZGxlciwgc2NvcGUpIHsKCgkJCWlmKGhhbmRsZXIgPT09IHVuZGVmaW5lZCkgewoJCQkJdGhyb3cgJ0Vycm9yOiBubyBhcmd1bWVudHMgcGFzc2VkJzsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYodHlwZW9mIGhhbmRsZXIgIT09ICdmdW5jdGlvbicpIHsKCQkJCXRocm93ICdFcnJvcjogaGFuZGxlciBtdXN0IGJlIGEgZnVuY3Rpb24nOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpc1JlYWR5ID09PSB0cnVlID8gaGFuZGxlci5jYWxsKHNjb3BlKSA6IHJlYWR5TGlzdC5wdXNoKCB7Zm46IGhhbmRsZXIsIHNjb3BlOiBzY29wZX0gKTsKCgkJfSwKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgb25jZSB0aGUgd2lkZ2V0IGlzIHJlYWR5IGFuZCBhbGwgaW5pdGlhbGl6YXRpb24gaXMgY29tcGxldGVkLiAgVGhpcyB3aWxsIHNlbmQgYQogICAgICAgKiBtZXNzYWdlIHRvIHRoZSBjb250YWluZXIgd2hpY2ggaW4gdHVybiBtYXkgbm90aWZ5IG90aGVyIHdpZGdldHMKICAgICAgICovCiAgICAgICAgbm90aWZ5V2lkZ2V0UmVhZHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgLy9zZW5kIGEgbWVzc2FnZSB0byBjb250YWluZXIgdGhhdCB0aGlzIHdpZGdldCBpcyByZWFkeQogICAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbCgnLi4nLCBXSURHRVRfUkVBRFlfU0VSVklDRV9OQU1FLCBudWxsLCBPV0YuZ2V0SW5zdGFuY2VJZCgpKTsKICAgICAgICB9LAoKCQkvKioKCQkJUmV0dXJucyBkZWZpbml0aW9uIEdVSUQgb2YgdGhlIHdpZGdldC4gVGhpcyBpcyBhdXRvIGdlbmVyYXRlZCBieSBPV0Ygd2hlbiB0aGUgd2lkZ2V0IHdhcyBicm91Z2h0IGluIGFuIE9XRiBpbnN0YW5jZS4KCQkqLwoJCWdldFdpZGdldEd1aWQgOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHdpZGdldC5ndWlkOwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIGluc3RhbmNlIEdVSUQgb2YgdGhlIHdpZGdldC4KCQkqLwoJCWdldEluc3RhbmNlSWQgOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHdpZGdldC5pZDsKCQl9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgV2lkZ2V0IElkCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHdpZGdldElkIGlzIGEgY29tcGxleCBKU09OIGVuY29kZWQgc3RyaW5nIHdoaWNoIGlkZW50aWZpZXMgYSB3aWRnZXQgZm9yIEV2ZW50aW5nLgogICAgICAgICAqICAgRW1iZWRkZWQgaW4gdGhpcyBzdHJpbmcgaXMgdGhlIHdpZGdldCdzIHVuaXF1ZUlkIGFzIHRoZSAnaWQnIGF0dHJpYnV0ZS4gIFRoZXJlIGlzIG90aGVyIGRhdGEgaXMgaW4gdGhlIHN0cmluZwogICAgICAgICAqICAgd2hpY2ggaXMgbmVlZGVkIGZvciBFdmVudGluZyBhbmQgb3RoZXIgQVBJcyB0byBmdW5jdGlvbiBwcm9wZXJseS4gVGhpcyBjb21wbGV4IHdpZGdldElkIHN0cmluZyBtYXkgYmUgdXNlZCBpbgogICAgICAgICAqICAgdGhlIDxhIGhyZWY9Ii4vT1dGLkV2ZW50aW5nLmh0bWwjLnB1Ymxpc2giPk9XRi5FdmVudGluZy5wdWJsaXNoPC9hPiBmdW5jdGlvbiB0byBkZXNpZ25hdGUgYSBzcGVjaWZpYyByZWNpcGllbnQgZm9yIGEgbWVzc2FnZS4KICAgICAgICAgKiAgIEFkZGl0aW9uYWxseSwgb25jZSBzdWJzY3JpYmVkIHRvIGEgY2hhbm5lbCB2aWEgPGEgaHJlZj0iLi9PV0YuRXZlbnRpbmcuaHRtbCMuc3Vic2NyaWJlIj5PV0YuRXZlbnRpbmcuc3Vic2NyaWJlPC9hPiBkdXJpbmcgdGhlCiAgICAgICAgICogICByZWNlaXB0IG9mIGEgbWVzc2FnZSwgdGhlIHNlbmRlcidzIHdpZGdldElkIGlzIG1hZGUgYXZhaWxhYmxlIGFzIHRoZSBmaXJzdCBhcmd1bWVudCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbi4KICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqIC8vZGVjb2RlIGFuZCByZXRyaWV2ZSB0aGUgd2lkZ2V0J3MgdW5pcXVlIGlkCiAgICAgICAgICogdmFyIGNvbXBsZXhJZFN0cmluZyA9IE9XRi5nZXRJZnJhbWVJZCgpOwogICAgICAgICAqIHZhciBjb21wbGV4SWRPYmogPSBvd2Zkb2pvLnRvSnNvbihjb21wbGV4SWRTdHJpbmcpOwogICAgICAgICAqCiAgICAgICAgICogLy9jb21wbGV4SWRPYmogd2lsbCBsb29rIGxpa2UKICAgICAgICAgKiAvLyB7CiAgICAgICAgICogLy8gIC8vd2lkZ2V0J3MgdW5pcXVlSWQKICAgICAgICAgKiAvLyAgaWQ6IjQ5Y2QyMWYwLTMxMTAtODEyMS1kOTA1LTE4ZmZhODFiNDQyZSIKICAgICAgICAgKiAvLyB9CiAgICAgICAgICoKICAgICAgICAgKiAvL2dldCBXaWRnZXQncyB1bmlxdWVJZAogICAgICAgICAqIGFsZXJ0KCd3aWRnZXQgaWQgPSAnICsgY29tcGxleElkT2JqLmlkKTsKICAgICAgICAgKi8KCQlnZXRJZnJhbWVJZCA6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gJ3tcImlkXCI6XCInICsgd2lkZ2V0LmlkICsgJ1wifSc7CgkJfSwKCgkJLyoqCgkJCVJldHVybnMgdHlwZSBvZiBkYXNoYm9hcmQgaW4gd2hpY2ggdGhlIHdpZGdldCBpcyBvcGVuZWQuIFtwb3J0YWwsIGRlc2t0b3AsIGFjY29yZGlvbiwgdGFiYmVkXQoJCSovCgkJZ2V0RGFzaGJvYXJkTGF5b3V0IDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQubGF5b3V0OwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIHZlcnNpb24gb2YgdGhlIHdpZGdldC4KCQkqLwoJCWdldFZlcnNpb24gOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHdpZGdldC52ZXJzaW9uOwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIFVSTCBvZiB0aGUgd2lkZ2V0LgoJCSovCgkJZ2V0VXJsIDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQudXJsOwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIG9uIHRoZSBjdXJyZW50IE9XRiB0aGVtZQoJCQlAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBiZWxvdzogPGJyPgoJCQl7IDxicj4KCQkJCS8vbmFtZSBvZiB0aGUgdGhlbWUgPGJyPgoJCQkJdGhlbWVOYW1lOiAndGhlbWUtbmFtZScsIDxicj4KCQkJCTxicj4KCQkJCS8vZGVzY3JpYmVzIGNvbG9yIGNvbnRyYXN0IG9mIHRoZSB0aGVtZS4gIFRoaXMgbWF5IGJlIG9uZSBvZiAzIHZhbHVlczogPGJyPgoJCQkJLy8gJ3N0YW5kYXJkJyAoY29sb3JzIHByb3ZpZGUgbm8gc3BlY2lhbCBjb250cmFzdCkgPGJyPgoJCQkJLy8gJ2JsYWNrLW9uLXdoaXRlJyAoYmxhY2sgb24gd2hpdGUgY29sb3IgY29udHJhc3QpIDxicj4KCQkJCS8vICd3aGl0ZS1vbi1ibGFjaycgKHdoaXRlIG9uIGJsYWNrIGNvbG9yIGNvbnRyYXN0KSA8YnI+CgkJCQl0aGVtZUNvbnRyYXN0OiAnYmxhY2stb24td2hpdGUnLCA8YnI+CgkJCQk8YnI+CgkJCQkvL3RoaXMgZmllbGQgaXMgYSBudW1iZXIgb2YgdGhlIGZvbnRTaXplIGluIHBpeGVscyA8YnI+CgkJCQl0aGVtZUZvbnRTaXplOiAxMiA8YnI+CgkJCX0KCQkJQGV4YW1wbGUKCQkJdmFyIHRoZW1lT2JqID0gT1dGLmdldEN1cnJlbnRUaGVtZSgpOwoJCSovCgkJZ2V0Q3VycmVudFRoZW1lIDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQuY3VycmVudFRoZW1lOwoJCX0sCgoJCS8qKgoJCQlSZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBDb250YWluZXIgdGhlIFdpZGdldCBpcyBpbgoJCSovCgkJZ2V0Q29udGFpbmVyTmFtZTogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQuY29udGFpbmVyTmFtZTsKCQl9LAoJCQoJCS8qKgoJCQlSZXR1cm5zIHRoZSB2ZXJzaW9uIG9mIHRoZSBDb250YWluZXIgdGhlIFdpZGdldCBpcyBpbgoJCSovCgkJZ2V0Q29udGFpbmVyVmVyc2lvbjogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB3aWRnZXQuY29udGFpbmVyVmVyc2lvbjsKCQl9LAoKCQkvKioKCQkJUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgZGFzaGJvYXJkIGluIHdoaWNoIHRoZSB3aWRnZXQgaXMgb3BlbmVkIGlzIGxvY2tlZC4gCgkJKi8KCQlpc0Rhc2hib2FyZExvY2tlZCA6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gd2lkZ2V0LmxvY2tlZDsKCQl9LAoKCQkvKioKCQlSZXR1cm5zIHRoZSBVUkwgb2YgdGhlIENvbnRhaW5lciB0aGUgV2lkZ2V0IGlzIGluCgkJKi8KCQlnZXRDb250YWluZXJVcmw6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvL2ZpZ3VyZSBvdXQgZnJvbSBwcmVmZXJlbmNlIGxvY2F0aW9uCgkJCXZhciBwcmVmID0gd2lkZ2V0LnByZWZlcmVuY2VMb2NhdGlvbjsKICAgICAgICAgICAgcmV0dXJuIHByZWYuc3Vic3RyaW5nKDAsIHByZWYubGVuZ3RoIC0gNik7CgkJfSwKCgkJLyoqCgkJCUdldHMgYWxsIG9wZW5lZCB3aWRnZXRzIG9uIHRoZSBjdXJyZW50IGRhc2hib2FyZC4KCgkJCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiBvcGVuZWQgd2lkZ2V0cyBhcmUgcmV0cmlldmVkIGZyb20gT1dGLiBGdW5jdGlvbiBpcyBwYXNzZWQgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoIHRoZSBzdHJ1Y3R1cmUgYmVsb3c6IDxicj4KCQkJezxicj4KCQkJCWlkOiAnaW5zdGFuY2UgZ3VpZCBvZiB3aWRnZXQnLDxicj4KCQkJCWZyYW1lSWQ6ICdpZnJhbWUgaWQgb2Ygd2lkZ2V0Jyw8YnI+CgkJCQl3aWRnZXRHdWlkOiAnd2lkZ2V0IGd1aWQgb2YgdGhlIHdpZGdldCcsPGJyPgoJCQkJdXJsOiAndXJsIG9mIHRoZSB3aWRnZXQnLDxicj4KCQkJCW5hbWU6ICduYW1lIG9mIHRoZSB3aWRnZXQnPGJyPgogICAgICAgICAgICAgICAgdW5pdmVyc2FsTmFtZTogJ3VuaXZlcnNhbCBuYW1lIG9mIHRoZSB3aWRnZXQnPGJyPgoJCQl9PGJyPgoJCQlAZXhhbXBsZQoJCQlPV0YuZ2V0T3BlbmVkV2lkZ2V0cyhmdW5jdGlvbihvcGVuZWRXaWRnZXRzKSB7CgkJCQkKCQkJfSk7CgkJKi8KCQlnZXRPcGVuZWRXaWRnZXRzOiBmdW5jdGlvbihmbikgewoJCQkKCQkJaWYoZm4gPT09IHVuZGVmaW5lZCkgewoJCQkJdGhyb3cgJ0Vycm9yOiBubyBhcmd1bWVudHMgcGFzc2VkJzsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7CgkJCQl0aHJvdyAnRXJyb3I6IGZuIG11c3QgYmUgYSBmdW5jdGlvbic7CgkJCQlyZXR1cm47CgkJCX0KCgkJCU96b25lLmV2ZW50aW5nLmdldEFsbFdpZGdldHMoZm4pOwoJCX0KCX0pOwoKCS8vIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoJT3pvbmUuV2lkZ2V0ID0gT1dGOwoKCU9XRi5faW5pdCA9IGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoKICAgICAgICBpZiAoT1dGLnJlbGF5RmlsZSAhPSBudWxsKSB7CiAgICAgICAgICBPem9uZS5ldmVudGluZy5XaWRnZXQud2lkZ2V0UmVsYXlVUkwgPSBPV0YucmVsYXlGaWxlOwogICAgICAgIH0KCgkJLy8gRXZlbnRpbmcgQVBJCgkJZnVuY3Rpb24gaW5pdEV2ZW50aW5nKCkgewoJCQlmb3IodmFyIGkgPSAwLCBtZXRob2RzID0gWydwdWJsaXNoJywgJ3N1YnNjcmliZScsICd1bnN1YnNjcmliZSddIDsgaSA8IG1ldGhvZHMubGVuZ3RoIDsgaSsrKSB7CgkJCQlPV0YuRXZlbnRpbmdbIG1ldGhvZHNbaV0gXSA9IHRoaXNbIG1ldGhvZHNbaV0gXTsKCQkJfQoJCX0KCgkJLy8gUlBDL0RpcmVjdGVkIEV2ZW50aW5nIEFQSQoJCWZ1bmN0aW9uIGluaXRSUEMoKSB7CgkJCU9XRi5SUEMucmVnaXN0ZXJGdW5jdGlvbnMgPSBPem9uZS5ldmVudGluZy5yZWdpc3RlckZ1bmN0aW9uczsKCQkJT1dGLlJQQy5nZXRXaWRnZXRQcm94eSA9IE96b25lLmV2ZW50aW5nLmltcG9ydFdpZGdldDsKCQkJT1dGLlJQQy5oYW5kbGVEaXJlY3RNZXNzYWdlID0gZnVuY3Rpb24oZm4pIHsKCQkJCWlmKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykgewoJCQkJCXRocm93ICdFcnJvcjogZm4gbXVzdCBiZSBhIGZ1bmN0aW9uJzsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlPem9uZS5ldmVudGluZy5oYW5kbGVEaXJlY3RNZXNzYWdlID0gZm47CgkJCX07CgkJfQoKCQkvLyBQcmVmZXJlbmNlcyBBUEkKCQlmdW5jdGlvbiBpbml0UHJlZmVyZW5jZXMoKSB7CgkJCWZvcih2YXIgaSBpbiBPem9uZS5wcmVmLlByZWZTZXJ2ZXIpIHsKCQkJCWlmKHR5cGVvZiBPem9uZS5wcmVmLlByZWZTZXJ2ZXJbIGkgXSA9PT0gJ2Z1bmN0aW9uJykKCQkJCQlPV0YuUHJlZmVyZW5jZXNbIGkgXSA9IE96b25lLnByZWYuUHJlZlNlcnZlclsgaSBdOwoJCQl9CgkJfQoKCQkvLyBMYXVuY2hpbmcgQVBJCgkJZnVuY3Rpb24gaW5pdExhdW5jaGVyKCkgewoJCQlPV0YuTGF1bmNoZXIubGF1bmNoID0gbGF1bmNoaW5nQ29udHJvbGxlci5sYXVuY2hXaWRnZXQ7CgkJCU9XRi5MYXVuY2hlci5nZXRMYXVuY2hEYXRhID0gT3pvbmUubGF1bmNoZXIuV2lkZ2V0TGF1bmNoZXJVdGlscy5nZXRMYXVuY2hDb25maWdEYXRhOwoJCX0KCgkJLy8gRHJhZyBhbmQgRHJvcCBBUEkKCQlmdW5jdGlvbiBpbml0RHJhZ0FuZERyb3AoKSB7CgkJCU9XRi5EcmFnQW5kRHJvcCA9IHsKCQkJCW9uRHJhZ1N0YXJ0OiBmdW5jdGlvbihjYWxsYmFjaywgc2NvcGUpIHsKCQkJCQlkcmFnQW5kRHJvcENvbnRyb2xsZXIuYWRkQ2FsbGJhY2soJ2RyYWdTdGFydCcsIG93ZmRvam8uaGl0Y2goc2NvcGUsIGNhbGxiYWNrKSk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCW9uRHJhZ1N0b3A6IGZ1bmN0aW9uKGNhbGxiYWNrLCBzY29wZSkgewoJCQkJCWRyYWdBbmREcm9wQ29udHJvbGxlci5hZGRDYWxsYmFjaygnZHJhZ1N0b3AnLCBvd2Zkb2pvLmhpdGNoKHNjb3BlLCBjYWxsYmFjaykpOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQlvbkRyb3A6IGZ1bmN0aW9uKGNhbGxiYWNrLCBzY29wZSkgewoJCQkJCWRyYWdBbmREcm9wQ29udHJvbGxlci5hZGRDYWxsYmFjaygnZHJvcFJlY2VpdmUnLCBvd2Zkb2pvLmhpdGNoKHNjb3BlLCBjYWxsYmFjaykpOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQlzdGFydERyYWc6IGZ1bmN0aW9uKGNmZykgewoJCQkJCWRyYWdBbmREcm9wQ29udHJvbGxlci5kb1N0YXJ0RHJhZyhjZmcpOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkJZm9yKHZhciBpID0gMCwgbWV0aG9kcyA9IFsnYWRkRHJvcFpvbmVIYW5kbGVyJywgJ2dldERyYWdTdGFydERhdGEnLCAnZ2V0RHJvcEVuYWJsZWQnLCAnc2V0RHJvcEVuYWJsZWQnLCAnaXNEcmFnZ2luZycsICdnZXRGbGFzaFdpZGdldElkJywgJ3NldEZsYXNoV2lkZ2V0SWQnXSA7IGkgPCBtZXRob2RzLmxlbmd0aCA7IGkrKykgewoJCQkJCgkJCQlPV0YuRHJhZ0FuZERyb3BbIG1ldGhvZHNbaV0gXSA9IGZ1bmN0aW9uKCBtZXRob2ROYW1lICkgewoJCQkJCQoJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGRyYWdBbmREcm9wQ29udHJvbGxlclttZXRob2ROYW1lXS5hcHBseShkcmFnQW5kRHJvcENvbnRyb2xsZXIsIGFyZ3VtZW50cyk7CgkJCQkJfTsKCgkJCQl9KCBtZXRob2RzW2ldICk7CgkJCQoJCQl9CgkJfQoKCQkvLyBDaHJvbWUgQVBJCgkJZnVuY3Rpb24gaW5pdENocm9tZSgpIHsKCQkJZm9yKHZhciBpID0gMCwgCgkJCQltZXRob2RzID0gWydhZGRIZWFkZXJCdXR0b25zJywgJ2FkZEhlYWRlck1lbnVzJywgJ2luc2VydEhlYWRlckJ1dHRvbnMnLCAnaW5zZXJ0SGVhZGVyTWVudXMnLAogICAgICAgICAgICAgICAgICAgICdpc01vZGlmaWVkJywgJ2xpc3RIZWFkZXJCdXR0b25zJywgJ2xpc3RIZWFkZXJNZW51cycsICdyZW1vdmVIZWFkZXJCdXR0b25zJywgJ3JlbW92ZUhlYWRlck1lbnVzJywKICAgICAgICAgICAgICAgICAgICAndXBkYXRlSGVhZGVyQnV0dG9ucycsICd1cGRhdGVIZWFkZXJNZW51cycsICdnZXRUaXRsZScsICdzZXRUaXRsZSddIDsgaSA8IG1ldGhvZHMubGVuZ3RoIDsgaSsrKSB7CgkJCQlPV0YuQ2hyb21lWyBtZXRob2RzW2ldIF0gPSBjaHJvbWVDb250cm9sbGVyWyBtZXRob2RzW2ldIF07CgkJCX0KCQl9CgoJCWV2ZW50aW5nQ29udHJvbGxlciA9IE96b25lLmV2ZW50aW5nLldpZGdldC5nZXRJbnN0YW5jZShmdW5jdGlvbigpIHsKCgkJCWRyYWdBbmREcm9wQ29udHJvbGxlciA9IE96b25lLmRyYWdBbmREcm9wLldpZGdldERyYWdBbmREcm9wLmdldEluc3RhbmNlKHsKCQkJCXdpZGdldEV2ZW50aW5nQ29udHJvbGxlcjogdGhpcwoJCQl9KTsKCQkJbGF1bmNoaW5nQ29udHJvbGxlciA9IE96b25lLmxhdW5jaGVyLldpZGdldExhdW5jaGVyLmdldEluc3RhbmNlKCk7CgkJCWNocm9tZUNvbnRyb2xsZXIgPSBPem9uZS5jaHJvbWUuV2lkZ2V0Q2hyb21lLmdldEluc3RhbmNlKHsKCQkJCXdpZGdldEV2ZW50aW5nQ29udHJvbGxlcjogdGhpcwoJCQl9KTsKCgkJCWluaXRFdmVudGluZy5jYWxsKHRoaXMpOwoJCQlpbml0UlBDKCk7CgkJCWluaXRQcmVmZXJlbmNlcygpOwoJCQlpbml0TGF1bmNoZXIoKTsKCQkJaW5pdERyYWdBbmREcm9wKCk7CgkJCWluaXRDaHJvbWUoKTsKCgkJCU96b25lLmNvbXBvbmVudHMua2V5cy5jcmVhdGVLZXlFdmVudFNlbmRlcih0aGlzKTsKCgkJCS8vIGV4ZWN1dGUgcmVhZHkgbGlzdGVuZXJzCgkJCWlzUmVhZHkgPSB0cnVlOwoJCQlmb3IodmFyIGkgPSAwLCBsZW4gPSByZWFkeUxpc3QubGVuZ3RoIDsgaSA8IGxlbiA7IGkrKykgewoJCQkJcmVhZHlMaXN0W2ldLmZuLmNhbGwocmVhZHlMaXN0W2ldLnNjb3BlKTsKCQkJfQoKCQl9KTsKCgl9OwoKfSh3aW5kb3csIGRvY3VtZW50KSk7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tIEV2ZW50aW5nIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKioKICogQG5hbWUgcmVsYXlGaWxlCiAqIEBtZW1iZXJPZiBPV0YKICogQGRlc2NyaXB0aW9uIFRoZSBsb2NhdGlvbiBvZiB0aGUgd2lkZ2V0IHJlbGF5IGZpbGUuICBUaGUgcmVsYXkgZmlsZSBzaG91bGQgYmUgZGVmaW5lZAogKiAgIGdsb2JhbGx5IGZvciB0aGUgZW50aXJlIHdpZGdldCBieSBzZXR0aW5nIE9XRi5yZWxheUZpbGUgdG8gdGhlIHJlbGF5IGZpbGUgdXJsLCBpbW1lZGlhdGVseSBhZnRlcgogKiAgIGluY2x1ZGluZyB0aGUgd2lkZ2V0IGJ1bmRsZSBqYXZhc2NyaXB0LiAgSWYgdGhlIHJlbGF5IGlzIG5vdCBkZWZpbmVkIGF0IGFsbCBpdCBpcyBhc3N1bWVkIHRvIGJlIGF0CiAqICAgL1tjb250ZXh0XS9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwuIFRoZSByZWxheSBmaWxlIG11c3QgYmUgc3BlY2lmaWVkIHdpdGggZnVsbCBsb2NhdGlvbiBkZXRhaWxzLCBidXQgd2l0aG91dCBhIGZ1bGx5CiAqICAgcXVhbGlmaWVkIHBhdGguIEluIHRoZSBjYXNlIHdoZXJlIHRoZSByZWxheSBpcyByZXNpZGluZyBAIGh0dHA6Ly9zZXJ2ZXIvcGF0aC9yZWxheS5odG1sLCB0aGUgcGF0aCB1c2VkIG11c3QgYmUgZnJvbSB0aGUgY29udGV4dCByb290IG9mIHRoZSBsb2NhbAogKiAgIHdpZGdldC4gSW4gdGhpcyBjYXNlLCBpdCB3b3VsZCBiZSAvcGF0aC9yZWxheS5odG1sLiAgRG8gbm90IGluY2x1ZGUgdGhlIHByb3RvY29sLgogKiBAc2luY2UgT1dGIDUuMC4wCiAqIEBleGFtcGxlCiAqICZsdDtzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii4uLy4uL2pzLW1pbi9vd2Ytd2lkZ2V0LW1pbi5qcyImZ3Q7Jmx0Oy9zY3JpcHQmZ3Q7CiAqICZsdDtzY3JpcHQmZ3Q7CiAqICAgICAgIC8vVGhlIGxvY2F0aW9uIGlzIGFzc3VtZWQgdG8gYmUgYXQgL1tjb250ZXh0XS9qcy9ldmVudGluZy9ycGNfcmVsYXkudW5jb21wcmVzc2VkLmh0bWwgaWYgaXQgaXMgbm90CiAqICAgICAgIC8vc2V0IHRoZSBwYXRoIGNvcnJlY3RseSBiZWxvdwogKiAgICAgICBPV0YucmVsYXlGaWxlID0gJy9vd2YvanMvZXZlbnRpbmcvcnBjX3JlbGF5LnVuY29tcHJlc3NlZC5odG1sJzsKICogICAgICAgLy8uLi4KICogJmx0Oy9zY3JpcHQmZ3Q7CiAqCiAqLwoKLyoqCglTdWJzY3JpYmUgdG8gYSBuYW1lZCBjaGFubmVsIGZvciBhIGdpdmVuIGZ1bmN0aW9uLgoJQG5hbWUgc3Vic2NyaWJlCglAbWV0aG9kT2YgT1dGLkV2ZW50aW5nCgoJQHBhcmFtIHtTdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBjaGFubmVsIHRvIHN1YnNjcmliZSB0by4KCUBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIGZ1bmN0aW9uIHlvdSB3aXNoIHRvIHN1YnNjcmliZS4gIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2l0aCB0aHJlZQoJCWFyZ3VtZW50czogc2VuZGVyLCBtc2csIGNoYW5uZWwuCglAcGFyYW0ge1N0cmluZ30gW2hhbmRsZXIuc2VuZGVyXSBUaGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGlzIHRoZSBpZCBvZiB0aGUgc2VuZGVyIG9mIHRoZSBtZXNzYWdlLiBTZWUgPGEgaHJlZj0iT1dGLmh0bWwjLmdldElmcmFtZUlkIj5PV0YuZ2V0SWZyYW1lSWQ8L2E+IGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoaXMgaWQuCglAcGFyYW0ge09iamVjdH0gW2hhbmRsZXIubXNnXSBUaGUgc2Vjb25kIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgbWVzc2FnZSBpdHNlbGYuCglAcGFyYW0ge1N0cmluZ30gW2hhbmRsZXIuY2hhbm5lbF0gVGhlIHRoaXJkIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpcyB0aGUgY2hhbm5lbCB0aGUgbWVzc2FnZSB3YXMgcHVibGlzaGVkIG9uLgoJCQoJQGV4YW1wbGUKT1dGLkV2ZW50aW5nLnN1YnNjcmliZSgiQ2xvY2tDaGFubmVsIiwgdGhpcy51cGRhdGUpOwp2YXIgdXBkYXRlID0gZnVuY3Rpb24oc2VuZGVyLCBtc2csIGNoYW5uZWwpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW50VGltZScpLmlubmVySFRNTCA9IG1zZzsKfQogKi8KCi8qKgoJVW5zdWJzY3JpYmUgdG8gYSBuYW1lZCBjaGFubmVsLgoJQG5hbWUgdW5zdWJzY3JpYmUKCUBtZXRob2RPZiBPV0YuRXZlbnRpbmcKCglAcGFyYW0ge1N0cmluZ30gY2hhbm5lbE5hbWUgVGhlIGNoYW5uZWwgdG8gdW5zdWJzY3JpYmUgdG8uCgkKCUBleGFtcGxlCk9XRi5FdmVudGluZy51bnN1YnNjcmliZSgiQ2xvY2tDaGFubmVsIik7CiAqLwoKLyoqCglQdWJsaXNoZXMgYSBtZXNzYWdlIHRvIGEgZ2l2ZW4gY2hhbm5lbC4KCUBuYW1lIHB1Ymxpc2gKCUBtZXRob2RPZiBPV0YuRXZlbnRpbmcKCglAcGFyYW0ge1N0cmluZ30gY2hhbm5lbE5hbWUgVGhlIG5hbWUgb2YgdGhlIGNoYW5uZWwgdG8gcHVibGlzaCB0bwoJQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gcHVibGlzaCB0byB0aGUgY2hhbm5lbC4KCUBwYXJhbSB7U3RyaW5nfSBbZGVzdF0gVGhlIGlkIG9mIGEgcGFydGljdWxhciBkZXN0aW5hdGlvbi4gIERlZmF1bHRzIHRvIG51bGwgd2hpY2ggc2VuZHMgdG8gYWxsCgkJc3Vic2NyaWJlcnMgb24gdGhlIGNoYW5uZWwuICBTZWUgPGEgaHJlZj0iT1dGLmh0bWwjLmdldElmcmFtZUlkIj5PV0YuZ2V0SWZyYW1lSWQ8L2E+CgkJZm9yIGEgZGVzY3JpcHRpb24gb2YgdGhlIGlkLgoJCglAZXhhbXBsZQpPV0YuRXZlbnRpbmcucHVibGlzaCgiQ2xvY2tDaGFubmVsIiwgY3VycmVudFRpbWVTdHJpbmcpOwoqLwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLSBSUEMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8qKgoJUmVnaXN0ZXIgb25lIG9yIG1vcmUgZnVuY3Rpb25zIHRvIE9XRiB0byBleHBvc2UgdG8gb3RoZXIgd2lkZ2V0cy4KCUBuYW1lIHJlZ2lzdGVyRnVuY3Rpb25zCglAbWV0aG9kT2YgT1dGLlJQQwoKCUBwYXJhbSB7T2JqZWN0L0FycmF5fSBvYmpzIE9iamVjdCBvciBhbiBhcnJheSBvZiBvYmplY3RzIG9mIGZvbGxvd2luZyBzdHJ1Y3R1cmUuPGJyIC8+CgkJezxiciAvPgoJCQluYW1lOiAnbmFtZSBvZiB0aGUgZnVuY3Rpb24nLCA8YnIgLz4KCQkJZm46IGZ1bmN0aW9uKCkge30sIDxiciAvPgoJCQlzY29wZTogd2luZG93IC8vVGhlIHNjb3BlICh0aGlzIHJlZmVyZW5jZSkgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLiBJZiBvbWl0dGVkLCBkZWZhdWx0cyB0byB0aGUgYnJvd3NlciB3aW5kb3cuPGJyIC8+CgkJfTxiciAvPgoKCUBleGFtcGxlCkNhbGN1bGF0b3IgPSB7CglhZGQ6IGZ1bmN0aW9uKCkgewoJCXZhciBhcmdzID0gYXJndW1lbnRzLAoJCQl2YWwgPSAwOwoJCWZvcih2YXIgaSA9IDAsIGxlbiA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJdmFsICs9IHBhcnNlRmxvYXQoYXJnc1tpXSk7CgkJfQoJCXJldHVybiB2YWw7Cgl9LAoJbXVsdGlwbHk6IGZ1bmN0aW9uKCkgewoJCXZhciBhcmdzID0gYXJndW1lbnRzLAoJCQl2YWwgPSAxOwoJCWZvcih2YXIgaSA9IDAsIGxlbiA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJdmFsICo9IHBhcnNlRmxvYXQoYXJnc1tpXSk7CgkJfQoJCXJldHVybiB2YWw7Cgl9Cn07Ck9XRi5SUEMucmVnaXN0ZXJGdW5jdGlvbnMoWwoJewoJCW5hbWU6ICdhZGQnCgkJZm46IENhbGN1bGF0b3IuYWRkLAoJCXNjb3BlOiBDYWxjdWxhdG9yCgl9LAoJewoJCW5hbWU6ICdtdWx0aXBseScKCQlmbjogQ2FsY3VsYXRvci5tdWx0aXBseSwKCQlzY29wZTogQ2FsY3VsYXRvcgoJfQpdKTsKKi8KCi8qKgoJR2V0cyBhIHByb3h5IG9iamVjdCB0aGF0IGNvbnRhaW5zIG1ldGhvZHMgZXhwb3NlZCBieSBvdGhlciB3aWRnZXQuCglAbmFtZSBnZXRXaWRnZXRQcm94eQoJQG1ldGhvZE9mIE9XRi5SUEMKCglAcGFyYW0ge1N0cmluZ30gaW5zdGFuY2VHdWlkIGluc3RhbmNlIGd1aWQgb2YgdGhlIHdpZGdldCB0byBpbXBvcnQKCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBpZiB0aGUgd2lkZ2V0IGlzIGZvdW5kIG9wZW5lZCBvbiB0aGUgY3VycmVudCBkYXNoYm9hcmQuIFRoZSBmdW5jdGlvbiBpcyBwYXNzZWQgYSBwcm94eSBvYmplY3QgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHdoaWNoIHdpbGwgY29udGFpbiBtZXRob2RzIHRoYXQgd2VyZSBleHBvc2VkIGJ5IHRoZSB3aWRnZXQuIEluIGFkZGl0aW9uLCB0aGUgcHJveHkgYWJqZWN0IGFsc28gaGFzIHNlbmRNZXNzYWdlIG1ldGhvZCB0byBzZW5kIGEgZGlyZWN0IG1lc3NhZ2UgdG8gdGhlIHdpZGdldC4KCglAZXhhbXBsZQpPV0YuUlBDLmdldFdpZGdldFByb3h5KCdpbnN0YW5jZUd1aWQgb2Ygd2lkZ2V0QScsIGZ1bmN0aW9uKHdpZGdldEEpIHsKCgl3aWRnZXRBLmFkZCgxLDIsMywgZnVuY3Rpb24ocmVzdWx0KSB7CgkJY29uc29sZS5sb2cocmVzdWx0KTsgLy8gbG9nIHRoZSByZXN1bHQKCX0pCgoJd2lkZ2V0QS5zZW5kTWVzc2FnZSgnc29tZSBzZWNyZXQgbWVzc2FnZScpOwoKfSk7CiovCgovKioKCVJlZ2lzdGVyIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiBhIGRpcmVjdCBtZXNzYWdlIGlzIHJlY2VpdmVkIGZyb20gYW5vdGhlciB3aWRnZXQuCglAbmFtZSBoYW5kbGVEaXJlY3RNZXNzYWdlCglAbWV0aG9kT2YgT1dGLlJQQwoKCUBwYXJhbSB7RnVuY3Rpb259IGZuIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCB3aGVuIGEgZGlyZWN0IG1lc3NhZ2UgaXMgcmVjZWl2ZWQgZnJvbSBhbm90aGVyIHdpZGdldC4KCglAZXhhbXBsZQpPV0YuUlBDLmhhbmRsZURpcmVjdE1lc3NhZ2UoZnVuY3Rpb24obXNnKSB7CgkvLyBkbyBzb21ldGhpbmcgd2l0aCB0aGUgbWVzc2FnZQp9KTsKKi8KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0gRHJhZyBhbmQgRHJvcCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qKgoJVXNlIHRoaXMgbWV0aG9kIHRvIHNldCBmbGV4IGRvbSBlbGVtZW50IGlkLCBzbyB0aGF0IGRyYWcgYW5kIGRyb3AgY2FuIGJlIGVuYWJsZWQgaW4gZmxleCB3aWRnZXRzLgoJQG5hbWUgc2V0Rmxhc2hXaWRnZXRJZAoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoKCUBwYXJhbSB7U3RyaW5nfSBpZCBkb20gZWxlbWVudCBpZCBvZiBmbGV4IHdpZGdldAoqLwoKLyoqCglTdGFydHMgYSBkcmFnLiAgVGhlIGNvbmZpZyBvYmplY3QgcGFzc2VkIGluIGRlc2NyaWJlcyB0aGUgZHJhZyBhbmQgY29udGFpbnMgdGhlIGRhdGEgdG8gYmUgcGFzc2VkIHRvIHRoZSBkcm9wLgoJQG5hbWUgc3RhcnREcmFnCglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5kcmFnRHJvcExhYmVsIE5hbWUgdG8gYmUgdXNlZCBhcyB0ZXh0IGZvciB0aGUgZHJhZ0Ryb3AgaW5kaWNhdG9yCglAcGFyYW0ge09iamVjdH0gY2ZnLmRyYWdEcm9wRGF0YSBEYXRhIHRvIGJlIHNlbnQgb24gYSBzdWNjZXNzZnVsIGRyYWcgYW5kIGRyb3AuICBUaGlzIHByb3BlcnR5IGlzIG9ubHkgc2VudCB0byB0aGUKCXN1Y2Nlc3NmdWwgcmVjaXBpZW50IG9mIHRoZSBkcmFnICh0aGUgZHJvcFJlY2VpdmUgZXZlbnQpLiAgSXQgd2lsbCBub3QgYmUgc2VudCBmb3Igb3RoZXIgZXZlbnRzLgoJQHBhcmFtIHtPYmplY3R9IGNmZy5kcmFnWm9uZSBkb20gbm9kZSB3aGljaCBwcmVzZW50cyBhIGRyYWdab25lIHdoaWNoIGlzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRyYWcuICBUaGlzIHByb3BlcnR5IGlzCglvbmx5IHNhdmVkIGFuZCB1c2VkIGxvY2FsbHkgdG8gdGhlIHdpZGdldCB0byBpZGVudGlmeSB3aGV0aGVyIGEgZHJhZ1pvbmUgaXMgaW4gZmFjdCB0aGUgbm9kZSBhcyBhIGRyb3Bab25lLiAgSXQgd2lsbCBub3QgYmUKCXNlbnQgdG8gb3RoZXIgZXZlbnRzIGNhbGxiYWNrcy4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuKiBvdGhlciBjdXN0b20gcHJvcGVydGllcyBtYXkgYmUgc3BlY2lmaWVkLCB0aGVzZSB3aWxsIGJlIHBhc3NlZCBhbG9uZyB0byBldmVudCBoYW5kbGVycwoJCglAZXhhbXBsZQovL2FkZCBoYW5kbGVyIHRvIHRleHQgZmllbGQgZm9yIGRyYWdnaW5nCm93ZmRvam8uY29ubmVjdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJhZ1NvdXJjZScpLCAnb25tb3VzZWRvd24nLCB0aGlzLCBmdW5jdGlvbihlKSB7CgllLnByZXZlbnREZWZhdWx0KCk7Cgl2YXIgZGF0YSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdJbnB1dENoYW5uZWwnKS52YWx1ZTsKCWlmIChkYXRhKSB7CgkJT1dGLkRyYWdBbmREcm9wLnN0YXJ0RHJhZyh7CgkJCWRyYWdEcm9wTGFiZWw6IGRhdGEsCgkJCWRyYWdEcm9wRGF0YTogZGF0YSwKCQkJZHJhZ1pvbmU6ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJhZ1pvbmUnKSwKCQkJZHJhZ0Ryb3BHcm91cDogJ2xvY2F0aW9uJyAgLy9leHRyYSBwcm9wZXJ0eSB0byBwYXNzIGFsb25nCgkJfSk7Cgl9Cn0pOwoqLwoKCi8qKgoJQWRkcyBhIG5ldyBkcm9wIHpvbmUgdG8gYmUgbWFuYWdlZC4gIFRoZSBoYW5kbGVyIGZ1bmN0aW9uIGRlZmluZWQgaW4gdGhlIGNmZyBvYmplY3Qgd2lsbCBiZSBjYWxsZWQgd2hlbgoJYSBkcm9wIG9jY3VycyBvdmVyIGEgZG9tIG5vZGUgd2hpY2ggbWF0Y2hlcyB0aGUgaWQgb3IgdGhlIGNsYXNzTmFtZSBvciBpcyBlcXVhbCB0byBvciBhIGNoaWxkIG9mIHRoZSBkcm9wVGFyZ2V0IG5vZGUKCUBuYW1lIGFkZERyb3Bab25lSGFuZGxlcgoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cKCUBwYXJhbSB7Y2xhc3NOYW1lfSBjZmcuY2xhc3MgY2xhc3Mgb2YgdGhlIGRyb3Bab25lCglAcGFyYW0ge1N0cmluZ30gY2ZnLmlkIElkIG9mIHRoZSBkcm9wWm9uZQoJQHBhcmFtIHtOb2RlfSBjZmcuZHJvcFpvbmUgSFRNTCBub2RlIHdoaWNoIHJlcHJlc2VudHMgdGhlIGRyb3Bab25lCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaGFuZGxlciBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiBhIGRyb3Agb2NjdXJzIG92ZXIgdGhlIGRyb3Bab25lLiAgQSBtc2cgb2JqZWN0IHdpbGwgYmUgcGFzc2VkIGluCgoJQGV4YW1wbGUKLy9FeGFtcGxlIGNmZyBPYmplY3QKewoJaWQ6ICdteWdyaWQtMScsCgljbGFzc05hbWU6ICdteWdyaWRDbGFzcycsCglkcm9wWm9uZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bab25lJyksCgloYW5kbGVyOiBmdW5jdGlvbihtc2cpIHsKCQkvL3NvbWUgY29kZSBoZXJlIHRvIGhhbmRsZSB0aGUgbXNnIGFuZCByZXNwb25kCgl9Cn0KCi8vRXhhbXBsZSB1c2FnZSBvZiBhZGREcm9wWm9uZUhhbmRsZXIgd2hpY2ggaGFuZGxlcyBhIGRyb3AgdGhhdCBvY2N1cnMgb3ZlciBhbiBFeHQgR3JpZCBhbmQgaW5zZXJ0cyBuZXcgZGF0YSBpbnRvCi8vdGhhdCBncmlkIGJhc2VkIG9uIHRoZSBkcmFnZ2VkIGRhdGEKT1dGLkRyYWdBbmREcm9wLmFkZERyb3Bab25lSGFuZGxlcih7CgkvL2RvbSBub2RlIG9mIGFuIEV4dCBncmlkCglkcm9wWm9uZTpncmlkLmdldFZpZXcoKS5zY3JvbGxlci5kb20sCgoJLy90aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbmx5IHdoZW4gYSBkcm9wIG9jY3VycyBvdmVyIHRoZSBncmlkIChpLmUuIHRoZSBtb3VzZSB3YXMgcmVsZWFzZWQgb3ZlciB0aGUgZ3JpZCkKCWhhbmRsZXI6IChmdW5jdGlvbihtc2cpewoJCgkJdmFyIHN0b3JlID0gZ3JpZC5nZXRTdG9yZSgpOwoJCXZhciBwcm9jZXNzZWRTZWxlY3Rpb25zID0gW107CgkJdmFyIGVycm9yTXNnID0gbnVsbDsKCgkJLy9sb29wIHRocm91Z2ggbXNnLmRyYWdEcm9wRGF0YSB3aGljaCBpcyBhbiBhcnJheSBhbmQgY2hlY2sgZm9yIGR1cGVzIHZlcnN1cyB0aGUgZGVzdGluYXRpb24gc3RvcmUKCQlmb3IgKHZhciBpID0gMDsgaSA8IG1zZy5kcmFnRHJvcERhdGEubGVuZ3RoOyBpKyspIHsKCQkJLy9nZXQgZGF0YSBmb3Igb25lIHBvc3NpYmxlIG5ldyByZWNvcmQgaW4gdGhlIGRyYWdEcm9wRGF0YQoJCQl2YXIgcmVjRGF0YSA9IG1zZy5kcmFnRHJvcERhdGFbaV07CgoJCQkvL2lzIGl0IGFscmVhZHkgaW4gdGhlIGRlc3QgRXh0IFN0b3JlPwoJCQlpZiAoc3RvcmUuZmluZEV4YWN0KCdpZCcscmVjRGF0YS5pZCkgPj0gMCkgewoJCQkJLy9mb3VuZCB0aGUgcmVjb3JkIGFscmVhZHkgaW4gdGhlIHN0b3JlCgkJCX0KCQkJZWxzZSB7CgkJCQkvL2FkZCBuZXcgcmVjb3JkIGJhc2VkIG9uIHRoZSBkcmFnRHJvcERhdGEKCQkJCXZhciBuZXdSZWMgPSBuZXcgc3RvcmUucmVjb3JkVHlwZShyZWNEYXRhKTsKCQkJCS8vY2FsbGluZyBhbiBleHRlcm5hbCBmdW5jdGlvbiB0byBkZWNpZGUgd2hldGhlciB0byBhZGQgdGhlIG5ldyByZWMKCQkJCXZhciBycyA9IGRpc3BsYXlQYW5lbC52YWxpZGF0ZVJlY29yZE9uQWRkKG5ld1JlYyk7CgkJCQlpZiAocnMuc3VjY2VzcykgewoJCQkJCXByb2Nlc3NlZFNlbGVjdGlvbnMucHVzaChuZXdSZWMpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZXJyb3JNc2cgPSBycy5tc2c7CgkJCQl9CgkJCX0KCQl9CgoJCWlmIChlcnJvck1zZykgewoJCQlFeHQuTXNnLmFsZXJ0KCdFcnJvcicsIGVycm9yTXNnKTsKCQl9CgoJCS8vYWN0dWFsbHkgaW5zZXJ0IGludG8gdGhlIHN0b3JlIHdoaWNoIGFkZHMgaXQgdGhlIG5ldyByZWNzIHRvIHRoZSBncmlkCgkJaWYgKHByb2Nlc3NlZFNlbGVjdGlvbnMubGVuZ3RoID4gMCkgewoJCQlzdG9yZS5pbnNlcnQoMCwgcHJvY2Vzc2VkU2VsZWN0aW9ucyk7CgkJfQoKfSkuY3JlYXRlRGVsZWdhdGUoZ3JpZCl9KTsgICAvL2NyZWF0ZURlbGVnYXRlIGlzIGFuIEV4dCBmdW5jdGlvbiB3aGljaCBzZXRzIHRoZSBzY29wZSBvZiB0aGUgY2FsbGJhY2sKCiovCgoKLyoqCglSZXR1cm5zIHdoZXRoZXIgdGhlIGEgZHJvcCBpcyBlbmFibGVkICh0aGlzIGlzIG9ubHkgdHJ1ZSB3aGVuIHRoZSBtb3VzZSBpcyBvdmVyIGEgZHJvcCB6b25lKQoJQG5hbWUgZ2V0RHJvcEVuYWJsZWQKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKKi8KCi8qKgoJUmV0dXJucyB3aGV0aGVyIGEgZHJhZyBpcyBpbiBwcm9ncmVzcwoJQG5hbWUgaXNEcmFnZ2luZwoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoqLwoKLyoqCglSZXR1cm5zIGRhdGEgc2VudCB3aGVuIGEgZHJhZyB3YXMgc3RhcnRlZAoJQG5hbWUgZ2V0RHJhZ1N0YXJ0RGF0YQoJQG1ldGhvZE9mIE9XRi5EcmFnQW5kRHJvcAoqLwoKLyoqCglUb2dnbGVzIHRoZSBkcmFnSW5kaWNhdG9yIHRvIGluZGljYXRlIHN1Y2Nlc3NmdWwgb3IgdW5zdWNjZXNzZnVsIGRyb3AKCUBuYW1lIHNldERyb3BFbmFibGVkCglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCgoJQHBhcmFtIHtCb29sZWFufSBkcm9wRW5hYmxlZCB0cnVlIHRvIGVuYWJsZSBhIGRyb3AsIGZhbHNlIHRvIGluZGljYXRlIGEgdW5zdWNjZXNzZnVsIGRyb3AKCQoJQGV4YW1wbGUKLy9hdHRhY2ggbW91c2VvdmVyIGNhbGxiYWNrIHRvIGEgcGFydGljdWxhciBhcmVhLiBJZiB0aGUgbW91c2UgaXMgaGVyZSBhbGxvdyBhIGRyb3AKY21wLmdldFZpZXcoKS5zY3JvbGxlci5vbignbW91c2VvdmVyJyxmdW5jdGlvbihlLHQsbykgewoJaWYgKGNtcC5kcmFnZ2luZykgewoJCU9XRi5EcmFnQW5kRHJvcC5zZXREcm9wRW5hYmxlZCh0cnVlKTsKCX0KfSx0aGlzKTsKCi8vYXR0YWNoIGEgbW91c2Ugb3V0IGNhbGxiYWNrIHRvIGEgcGFydGljdWxhciBhcmVhLiBJZiB0aGUgbW91c2UgbGVhdmVzIGRpc2FibGUgZHJvcApjbXAuZ2V0VmlldygpLnNjcm9sbGVyLm9uKCdtb3VzZW91dCcsZnVuY3Rpb24oZSx0LG8pIHsKCWlmIChjbXAuZHJhZ2dpbmcpIHsKCQlPV0YuRHJhZ0FuZERyb3Auc2V0RHJvcEVuYWJsZWQoZmFsc2UpOwoJfQp9LHRoaXMpOwogICAqLwoKCi8qKgoJRXhlY3V0ZXMgdGhlIGNhbGxiYWNrIHBhc3NlZCB3aGVuIGEgZHJhZyBzdGFydHMgaW4gYW55IHdpZGdldC4KCUBuYW1lIG9uRHJhZ1N0YXJ0CglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCgkKCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBleGVjdXRlIGFzIGEgY2FsbGJhY2suCglAcGFyYW0ge09iamVjdH0gc2NvcGUgVGhlIHNjb3BlICh0aGlzIHJlZmVyZW5jZSkgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLiBJZiBvbWl0dGVkLCBkZWZhdWx0cyB0byB0aGUgYnJvd3NlciB3aW5kb3cuCgoJQGV4YW1wbGUKLy9leGFtcGxlIGNhbGxiYWNrLCBoaWdobGlnaHRzIGFuIEV4dCBHcmlkIHdoZW4gYSBkcmFnIG9jY3VycwpPV0YuRHJhZ0FuZERyb3Aub25EcmFnU3RhcnQoZnVuY3Rpb24oc2VuZGVyLCBtc2cpIHsKCS8vZ2V0IHRoZSBFeHQgR3JpZAoJdmFyIGdyaWQgPSB0aGlzLmdldENvbXBvbmVudCh0aGlzLmdyaWRJZCk7CgoJLy9jaGVjayBjdXN0b20gZHJhZ0Ryb3BHcm91cCBwcm9wZXJ0eSB0byBzZWUgaWYgdGhlIGRyYWcgaXMgbWVhbnQgZm9yIHRoaXMgZ3JpZAoJLy9pZiBzbyBoaWdobGlnaHQgdGhlIGdyaWQgYnkgYWRkaW5nIHRoZSBkZE92ZXIgY2xhc3MKCWlmIChncmlkICYmIG1zZyAhPSBudWxsICYmIG1zZy5kcmFnRHJvcEdyb3VwID09ICd1c2VycycpIHsKCQlncmlkLmdldFZpZXcoKS5zY3JvbGxlci5hZGRDbGFzcygnZGRPdmVyJyk7Cgl9Cn0sIHRoaXMpOwoqLwoKLyoqCglFeGVjdXRlcyB0aGUgY2FsbGJhY2sgcGFzc2VkIHdoZW4gYSBkcmFnIHN0b3BzIGluIGFueSB3aWRnZXQuCglAbmFtZSBvbkRyYWdTdG9wCglAbWV0aG9kT2YgT1dGLkRyYWdBbmREcm9wCgkKCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBleGVjdXRlIGFzIGEgY2FsbGJhY2suCglAcGFyYW0ge09iamVjdH0gc2NvcGUgVGhlIHNjb3BlICh0aGlzIHJlZmVyZW5jZSkgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLiBJZiBvbWl0dGVkLCBkZWZhdWx0cyB0byB0aGUgYnJvd3NlciB3aW5kb3cuCgoJQGV4YW1wbGUKCk9XRi5EcmFnQW5kRHJvcC5vbkRyYWdTdG9wKGZ1bmN0aW9uKHNlbmRlciwgbXNnKSB7CgkvLyBkbyBzb21ldGhpbmcgaGVyZQp9LCB0aGlzKTsKKi8KCi8qKgoJRXhlY3V0ZXMgdGhlIGNhbGxiYWNrIHBhc3NlZCB3aGVuIGEgZHJvcCBvY2N1cnMgaW4gdGhlIHdpZGdldC4gSWYgb25lIGhhcyBtdWx0aXBsZSBkcm9wWm9uZXMgaW4gYSB3aWRnZXQgaXQgaXMgZWFzaWVyIHRvIHVzZSA8YSBocmVmPSIjYWRkRHJvcFpvbmVIYW5kbGVyIj5hZGREcm9wWm9uZUhhbmRsZXI8L2E+CglAbmFtZSBvbkRyb3AKCUBtZXRob2RPZiBPV0YuRHJhZ0FuZERyb3AKCQoJQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgYXMgYSBjYWxsYmFjay4KCUBwYXJhbSB7T2JqZWN0fSBzY29wZSBUaGUgc2NvcGUgKHRoaXMgcmVmZXJlbmNlKSBpbiB3aGljaCB0aGUgZnVuY3Rpb24gaXMgZXhlY3V0ZWQuIElmIG9taXR0ZWQsIGRlZmF1bHRzIHRvIHRoZSBicm93c2VyIHdpbmRvdy4KCglAZXhhbXBsZQoKT1dGLkRyYWdBbmREcm9wLm9uRHJvcChmdW5jdGlvbihzZW5kZXIsIG1zZykgewoJdmFyIGRhdGEgPSBtc2cuZHJhZ0Ryb3BEYXRhOwoKCS8vIGRvIHNvbWV0aGluZyB3aXRoIHRoZSBkYXRhIGhlcmUKfSwgdGhpcyk7CgkqLwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLSBMYXVuY2hlciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8qKgoJTGF1bmNoZXMgYSBXaWRnZXQgYmFzZWQgb24gdGhlIGNvbmZpZy4KCUBuYW1lIGxhdW5jaAoJQG1ldGhvZE9mIE9XRi5MYXVuY2hlcgoKCUBwYXJhbSB7T2JqZWN0fSBjb25maWcgb2JqZWN0IHNlZSBleGFtcGxlIGZvciBzdHJ1Y3R1cmUKCUBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIGxhdW5jaFdpZGdldCBpcyBleGVjdXRlZAoKCUBleGFtcGxlCk9XRi5MYXVuY2hlci5sYXVuY2goewogICAgdW5pdmVyc2FsTmFtZTogJ3VuaXZlcnNhbCBuYW1lIG9mIHdpZGdldCB0byBsYXVuY2gnLCAgLy91bml2ZXJzYWxOYW1lIG9yIGd1aWQgbWF5YmUgaWRlbnRpZnkgdGhlIHdpZGdldCB0byBiZSBsYXVuY2hlZAogICAgZ3VpZDogJ2d1aWRfb2Zfd2lkZ2V0X3RvX2xhdW5jaCcsCiAgICB0aXRsZTogJ3RpdGxlIHRvIHJlcGxhY2UgdGhlIHdpZGdldCB0aXRsZScgdGhlIHRpdGxlIHdpbGwgb25seSBiZSBjaGFuZ2VkIGlmIHRoZSB3aWRnZXQgaXMgb3BlbmVkLgogICAgdGl0bGVSZWdleDogb3B0aW9uYWwgcmVnZXggdXNlZCB0byByZXBsYWNlIHRoZSBwcmV2aW91cyB0aXRsZSB3aXRoIHRoZSBuZXcgdmFsdWUgb2YgdGl0bGUKICAgIGxhdW5jaE9ubHlJZkNsb3NlZDogdHJ1ZSwgICAvL2lmIHRydWUgd2lsbCBvbmx5IGxhdW5jaCB0aGUgd2lkZ2V0IGlmIGl0IGlzIG5vdCBhbHJlYWR5IG9wZW5lZC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGl0IGlzIG9wZW5lZCB0aGVuIHRoZSB3aWRnZXQgd2lsbCBiZSBicm91Z2h0IHRvIGZvY3VzCiAgICBkYXRhOiBkYXRhU3RyaW5nICAgICAgICAgICAgLy9pbml0aWFsIGxhdW5jaCBkYXRhIHRvIGJlIHBhc3NlZCB0byBhIHdpZGdldCBvbmx5IGlmIHRoZSB3aWRnZXQgaXMgb3BlbmVkLiBUaGlzIG11c3QgYmUgYSBzdHJpbmcuCn0sIGNhbGxiYWNrKTsKICovCgovKioKCVJldHJpZXZlcyBpbml0aWFsIGxhdW5jaCBkYXRhIGZvciB0aGlzIHdpZGdldCBpZiBpdCBpcyBvcGVuZWQgYnkgYW5vdGhlciB3aWRnZXQuICBJZiBsYXVuY2hlZCB2aWEgYW4gaW50ZW50LCBpdCB3aWxsIHJldHVybiB0aGUgSlNPTiBzdHJpbmcgeyBpbnRlbnRzOiB0cnVlIH0uCglAbmFtZSBnZXRMYXVuY2hEYXRhCglAbWV0aG9kT2YgT1dGLkxhdW5jaGVyCgoJQHJldHVybnMge09iamVjdH0gZGF0YSBvYmplY3Qgd2hpY2ggY29udGFpbnMgaW5pdGlhbCBsYXVuY2ggZGF0YSBmb3IgdGhlIHdpZGdldCAKCglAZXhhbXBsZQp2YXIgbGF1bmNoRGF0YSA9IE9XRi5MYXVuY2hlci5nZXRMYXVuY2hEYXRhKCk7CmlmIChsYXVuY2hEYXRhICE9IG51bGwpIHsKCXZhciBkYXRhID0gT3pvbmUudXRpbC5wYXJzZUpzb24obGF1bmNoRGF0YSk7ICAvL2luIHRoaXMgZXhhbXBsZSB0aGUgZGF0YSBvYmplY3QgaGFzIHR3byBmaWVsZHM6IGNoYW5uZWwgYW5kIG1lc3NhZ2UKCWlmIChkYXRhICE9IG51bGwpIHsKCQkvL2RvIHNvbWV0aGluZyB3aXRoIHRoZSBkYXRhCgkJT1dGLkV2ZW50aW5nLnN1YnNjcmliZShkYXRhLmNoYW5uZWwsIGZ1bmN0aW9uKCkge30pOwoJfQp9CiovCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tIENocm9tZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqCglDaGVja3MgdG8gc2VlIGlmIHRoZSBXaWRnZXQgQ2hyb21lIGhhcyBhbHJlYWR5IGJlZW4gbW9kaWZpZWQuICBUaGlzIGlzIHVzZWZ1bCB3aGVuIHRoZSB3aWRnZXQgaWZyYW1lIGlzIHJlbG9hZGVkLgoJQG5hbWUgaXNNb2RpZmllZAoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLgoJVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgYW4gb2JqZWN0IHdoaWNoIGhhcyBmb2xsb3dpbmcgcHJvcGVydGllcy4gPGJyPgoJPGJyPgoJCXtCb29sZWFufSBzdWNjZXNzOiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgY3VycmVudGx5IG9wZW5lZCBvbiB0aGUgZGFzaGJvYXJkLCBvciBlbHNlIGZhbHNlLiA8YnI+CgkJe0Jvb2xlYW59IG1vZGlmaWVkOiB0cnVlIGlmIHRoZSB3aWRnZXQgY2hyb21lKGhlYWRlcikgaXMgbW9kaWZpZWQsIG9yIGVsc2UgZmFsc2UuIDxicj4KCSoKCUBleGFtcGxlCk9XRi5DaHJvbWUuaXNNb2RpZmllZCh7CgljYWxsYmFjazogZnVuY3Rpb24obXNnKSB7CgkJLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZwoJCXZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOwoJCWlmIChyZXMuc3VjY2VzcykgewoJCQkvL2lmIHRoZSBjaHJvbWUgd2FzIG5ldmVyIG1vZGlmaWVkCgkJCWlmICghcmVzLm1vZGlmaWVkKSB7CgkJCSAgIC8vZG8gc29tZXRoaW5nLCBwZXJoYXBzIGFkZCBidXR0b25zCgkJCX0KCQkJLy9pZiB3ZSBhbHJlYWR5IG1vZGlmaWVkIHRoZSBjaHJvbWUKCQkJZWxzZSB7CgkJCSAgLy9kbyBzb21ldGhpbmcgb3IgcGVyaGFwcyBub3RoaW5nIGlmIHRoZSBidXR0b25zIGFyZSBhbHJlYWR5IGFkZGVkCgkJCX0KCQl9Cgl9Cn0pOwoqLwoKCi8qKgoJQWRkcyBidXR0b25zIHRvIHRoZSBXaWRnZXQgQ2hyb21lLiBCdXR0b25zIGFyZSBhZGRlZCBhZnRlciBleGlzdGluZyBidXR0b25zLgoJQG5hbWUgYWRkSGVhZGVyQnV0dG9ucwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgYnV0dG9ucyBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBidXR0b24gY29uZmlncwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBidXR0b25zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgYnV0dG9ucyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgRXh0SlMtbGlrZSBwcm9wZXJ0eSB1c2VkIHRvIGRldGVybWluZSB0aGUgY29tcG9uZW50IHRvIGNyZWF0ZS4gIEN1cnJlbnRseSB0aGUgV2lkZ2V0IENocm9tZSBBUEkgb25seSBzdXBwb3J0cyB0d28geHR5cGUgdmFsdWVzOiDigJhidXR0b27igJkgYW5kIOKAmHdpZGdldHRvb2zigJkuICB4dHlwZSBpcyBhbiBvcHRpb25hbCBmaWVsZCwgaWYgaXQgaXMgb21pdHRlZCDigJh3aWRnZXR0b29s4oCZIGlzIHVzZWQuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnR5cGUgVXNlZCBvbmx5IGZvciDigJh3aWRnZXR0b29s4oCZIGJ1dHRvbnMuICBJdCBkZXRlcm1pbmVzIHRoZSBzdGFuZGFyZCBpY29uIHRvIGJlIHVzZWQuICBGb3IgYSBjb21wbGV0ZSBsaXN0IG9mIHR5cGVzIHBsZWFzZSBzZWUgdGhlIEV4dEpTIDQueCBBUEkgZG9jdW1lbnRhdGlvbiwgPGEgaHJlZj0naHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlJz5odHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGU8L2E+CglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBidXR0b24uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBidXR0b24uICBUaGlzIHByb3BlcnR5IGlzIG9ubHkgdXNlZCBpZiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9uLuKAmSAg4oCYd2lkZ2V0dG9vbOKAmSB3aWxsIG5vdCBzaG93IHRleHQuCglAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLnRvb2x0aXAgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIGEgdG9vbHRpcC4gIEl0IGhhcyB0d28gaW1wb3J0YW50IHN1YiBwcm9wZXJ0aWVzLCB0aXRsZSBhbmQgdGV4dC4gIHRvb2x0aXAgaXMgb25seSB1c2VkIHdoZW4gdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbuKAmQoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBidXR0b24gaXMgcHJlc3NlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb27igJlzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5hZGRIZWFkZXJCdXR0b25zKHsKCWl0ZW1zOiBbCgkJewoJCQl4dHlwZTogJ2J1dHRvbicsCgkJCS8vcGF0aCB0byBhbiBpbWFnZSB0byB1c2UuIHRoaXMgcGF0aCBzaG91bGQgZWl0aGVyIGJlIGZ1bGx5IHF1YWxpZmllZCBvciByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0CgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJdGV4dDogJ0FsZXJ0JywKCQkJaXRlbUlkOidhbGVydCcsCgkJCXRvb2x0aXA6ICB7CgkJCSAgdGV4dDogJ0FsZXJ0IScKCQkJfSwKCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkvL3dpZGdldFN0YXRlIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldFN0YXRlIE9iagoJCQkJaWYgKHdpZGdldFN0YXRlKSB7CgkJCQkJd2lkZ2V0U3RhdGUuZ2V0V2lkZ2V0U3RhdGUoewoJCQkJCQljYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsKCQkJCQkJCS8vY2hlY2sgaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlCgkJCQkJCQlpZiAoIXN0YXRlLmNvbGxhcHNlZCAmJiAhc3RhdGUubWluaW1pemVkICYmIHN0YXRlLmFjdGl2ZSkgewoJCQkJCQkJCS8vb25seSByZW5kZXIgdmlzdWFsIGNvbnRlbnQsIHBlcmhhcHMgcG9wdXAgYSBtZXNzYWdlIGJveCBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUKCQkJCQkJCQkvL290aGVyd2lzZSBpdCBtYXkgbm90IHJlbmRlciBjb3JyZWN0bHkKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQl9CgkJfSwKCQl7CgkJCXh0eXBlOiAnd2lkZ2V0dG9vbCcsCgkJCS8vcGF0aCB0byBhbiBpbWFnZSB0byB1c2UuIHRoaXMgcGF0aCBzaG91bGQgZWl0aGVyIGJlIGZ1bGx5IHF1YWxpZmllZCBvciByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0CgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vaW5mb3JtYXRpb24ucG5nJywKCQkJaXRlbUlkOidoZWxwJywKCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQlhbGVydCgnQWJvdXQgQnV0dG9uIFByZXNzZWQnKTsKCQkJfQoJCX0sCgkJewoJCQkvL2dlYXIgaXMgYSBzdGFuZGFyZCBleHQgdG9vbCB0eXBlCgkJCXR5cGU6ICdnZWFyJywKCQkJaXRlbUlkOidnZWFyJywKCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQlhbGVydCgnVXRpbGl0eSBCdXR0b24gUHJlc3NlZCcpOwoJCQl9CgkJfQoJXQp9KTsKICAgKi8KCi8qKgoJVXBkYXRlcyBhbnkgZXhpc3RpbmcgYnV0dG9ucyBpbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiB0aGUgaXRlbUlkLgoJQG5hbWUgdXBkYXRlSGVhZGVyQnV0dG9ucwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgYnV0dG9ucyBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGJlbG93IGZvciBidXR0b24gY29uZmlncwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBidXR0b25zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgYnV0dG9ucyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ueHR5cGUgeHR5cGUgaXMgRXh0SlMtbGlrZSBwcm9wZXJ0eSB1c2VkIHRvIGRldGVybWluZSB0aGUgY29tcG9uZW50IHRvIGNyZWF0ZS4gIEN1cnJlbnRseSB0aGUgV2lkZ2V0IENocm9tZSBBUEkgb25seSBzdXBwb3J0cyB0d28geHR5cGUgdmFsdWVzOiDigJhidXR0b27igJkgYW5kIOKAmHdpZGdldHRvb2zigJkuICB4dHlwZSBpcyBhbiBvcHRpb25hbCBmaWVsZCwgaWYgaXQgaXMgb21pdHRlZCDigJh3aWRnZXR0b29s4oCZIGlzIHVzZWQuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnR5cGUgVXNlZCBvbmx5IGZvciDigJh3aWRnZXR0b29s4oCZIGJ1dHRvbnMuICBJdCBkZXRlcm1pbmVzIHRoZSBzdGFuZGFyZCBpY29uIHRvIGJlIHVzZWQuICBGb3IgYSBjb21wbGV0ZSBsaXN0IG9mIHR5cGVzIHBsZWFzZSBzZWUgdGhlIEV4dEpTIDQueCBBUEkgZG9jdW1lbnRhdGlvbiwgPGEgaHJlZj0naHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlJz5odHRwOi8vZG9jcy5zZW5jaGEuY29tL2V4dC1qcy80LTAvIy9hcGkvRXh0LnBhbmVsLlRvb2wtY2ZnLXR5cGU8L2E+CglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBidXR0b24uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBidXR0b24uICBUaGlzIHByb3BlcnR5IGlzIG9ubHkgdXNlZCBpZiB0aGUgeHR5cGUgaXMg4oCYYnV0dG9uLuKAmSAg4oCYd2lkZ2V0dG9vbOKAmSB3aWxsIG5vdCBzaG93IHRleHQuCglAcGFyYW0ge09iamVjdH0gY2ZnLml0ZW1zWypdLnRvb2x0aXAgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIGEgdG9vbHRpcC4gIEl0IGhhcyB0d28gaW1wb3J0YW50IHN1YiBwcm9wZXJ0aWVzLCB0aXRsZSBhbmQgdGV4dC4gIHRvb2x0aXAgaXMgb25seSB1c2VkIHdoZW4gdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbuKAmQoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLmhhbmRsZXIgVGhlIGhhbmRsZXIgYXR0cmlidXRlIGRlZmluZXMgYSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBidXR0b24gaXMgcHJlc3NlZC4gVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB1c2luZyBXaWRnZXQgRXZlbnRpbmcgQVBJIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQuICBUaGUgaW50ZXJuYWwgY2hhbm5lbCBuYW1lIHVzZWQgaXMgdGhlIGl0ZW1JZCBhdHRyaWJ1dGUuIFRoaXMgZnVuY3Rpb27igJlzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4KCQkKCUBleGFtcGxlCk9XRi5DaHJvbWUudXBkYXRlSGVhZGVyQnV0dG9ucyh7CglpdGVtczogWwoJCXsKCQkJeHR5cGU6ICdidXR0b24nLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdBbGVydCcsCgkJCWl0ZW1JZDonYWxlcnQnLAoJCQl0b29sdGlwOiAgewoJCQkgIHRleHQ6ICdBbGVydCEnCgkJCX0sCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJLy93aWRnZXRTdGF0ZSBpcyBhbiBhbHJlYWR5IGluc3RhbnRpYXRlZCBXaWRnZXRTdGF0ZSBPYmoKCQkJCWlmICh3aWRnZXRTdGF0ZSkgewoJCQkJCXdpZGdldFN0YXRlLmdldFdpZGdldFN0YXRlKHsKCQkJCQkJY2FsbGJhY2s6IGZ1bmN0aW9uKHN0YXRlKSB7CgkJCQkJCQkvL2NoZWNrIGlmIHRoZSB3aWRnZXQgaXMgdmlzaWJsZQoJCQkJCQkJaWYgKCFzdGF0ZS5jb2xsYXBzZWQgJiYgIXN0YXRlLm1pbmltaXplZCAmJiBzdGF0ZS5hY3RpdmUpIHsKCQkJCQkJCQkvL29ubHkgcmVuZGVyIHZpc3VhbCBjb250ZW50LCBwZXJoYXBzIHBvcHVwIGEgbWVzc2FnZSBib3ggaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlCgkJCQkJCQkJLy9vdGhlcndpc2UgaXQgbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJfQoJCX0sCgkJewoJCQl4dHlwZTogJ3dpZGdldHRvb2wnLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2luZm9ybWF0aW9uLnBuZycsCgkJCWl0ZW1JZDonaGVscCcsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ0Fib3V0IEJ1dHRvbiBQcmVzc2VkJyk7CgkJCX0KCQl9LAoJCXsKCQkJLy9nZWFyIGlzIGEgc3RhbmRhcmQgZXh0IHRvb2wgdHlwZQoJCQl0eXBlOiAnZ2VhcicsCgkJCWl0ZW1JZDonZ2VhcicsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ1V0aWxpdHkgQnV0dG9uIFByZXNzZWQnKTsKCQkJfQoJCX0KCV0KfSk7CiovCgovKioKCUluc2VydHMgbmV3IGJ1dHRvbnMgdG8gdGhlIFdpZGdldCBDaHJvbWUuICBCdXR0b25zIGFyZSBhZGRlZCB0byB0aGUgc2FtZSBhcmVhIGFzIGV4aXN0aW5nIGJ1dHRvbnMuCglAbmFtZSBpbnNlcnRIZWFkZXJCdXR0b25zCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7TnVtYmVyfSBbY2ZnLnBvcz0wXSAwLWJhc2VkIGluZGV4IG9mIHdoZXJlIGJ1dHRvbnMgd2lsbCBiZSBhZGRlZCwgYW1vbmcgYW55IHByZS1leGlzdGluZyBidXR0b25zLgoJQHBhcmFtIHtPYmplY3RbXX0gY2ZnLml0ZW1zIGFuIGFycmF5IG9mIGJ1dHRvbnMgY29uZmlndXJhdGlvbnMgdG8gaW5zZXJ0IHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIEV4dEpTLWxpa2UgcHJvcGVydHkgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGNvbXBvbmVudCB0byBjcmVhdGUuICBDdXJyZW50bHkgdGhlIFdpZGdldCBDaHJvbWUgQVBJIG9ubHkgc3VwcG9ydHMgdHdvIHh0eXBlIHZhbHVlczog4oCYYnV0dG9u4oCZIGFuZCDigJh3aWRnZXR0b29s4oCZLiAgeHR5cGUgaXMgYW4gb3B0aW9uYWwgZmllbGQsIGlmIGl0IGlzIG9taXR0ZWQg4oCYd2lkZ2V0dG9vbOKAmSBpcyB1c2VkLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50eXBlIFVzZWQgb25seSBmb3Ig4oCYd2lkZ2V0dG9vbOKAmSBidXR0b25zLiAgSXQgZGV0ZXJtaW5lcyB0aGUgc3RhbmRhcmQgaWNvbiB0byBiZSB1c2VkLiAgRm9yIGEgY29tcGxldGUgbGlzdCBvZiB0eXBlcyBwbGVhc2Ugc2VlIHRoZSBFeHRKUyA0LnggQVBJIGRvY3VtZW50YXRpb24sIDxhIGhyZWY9J2h0dHA6Ly9kb2NzLnNlbmNoYS5jb20vZXh0LWpzLzQtMC8jL2FwaS9FeHQucGFuZWwuVG9vbC1jZmctdHlwZSc+aHR0cDovL2RvY3Muc2VuY2hhLmNvbS9leHQtanMvNC0wLyMvYXBpL0V4dC5wYW5lbC5Ub29sLWNmZy10eXBlPC9hPgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgYnV0dG9uLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgYnV0dG9uLiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmGJ1dHRvbi7igJkgIOKAmHdpZGdldHRvb2zigJkgd2lsbCBub3Qgc2hvdyB0ZXh0LgoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS50b29sdGlwIFRoaXMgcHJvcGVydHkgZGVmaW5lcyBhIHRvb2x0aXAuICBJdCBoYXMgdHdvIGltcG9ydGFudCBzdWIgcHJvcGVydGllcywgdGl0bGUgYW5kIHRleHQuICB0b29sdGlwIGlzIG9ubHkgdXNlZCB3aGVuIHRoZSB4dHlwZSBpcyDigJhidXR0b27igJkKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9u4oCZcyBwYXJhbWV0ZXIgbGlzdCBjb250YWlucyB0aGUgc3RhbmRhcmQgcGFyYW1ldGVycyBmb3IgYW4gRXZlbnRpbmcgY2FsbGJhY2sgZnVuY3Rpb24uCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUuaW5zZXJ0SGVhZGVyQnV0dG9ucyh7Cglwb3M6IDAsCglpdGVtczogWwoJCXsKCQkJeHR5cGU6ICdidXR0b24nLAoJCQkvL3BhdGggdG8gYW4gaW1hZ2UgdG8gdXNlLiB0aGlzIHBhdGggc2hvdWxkIGVpdGhlciBiZSBmdWxseSBxdWFsaWZpZWQgb3IgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdBbGVydCcsCgkJCWl0ZW1JZDonYWxlcnQnLAoJCQl0b29sdGlwOiAgewoJCQkJdGV4dDogJ0FsZXJ0IScKCQkJfSwKCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkvL3dpZGdldFN0YXRlIGlzIGFuIGFscmVhZHkgaW5zdGFudGlhdGVkIFdpZGdldFN0YXRlIE9iagoJCQkJaWYgKHdpZGdldFN0YXRlKSB7CgkJCQkJd2lkZ2V0U3RhdGUuZ2V0V2lkZ2V0U3RhdGUoewoJCQkJCQljYWxsYmFjazogZnVuY3Rpb24oc3RhdGUpIHsKCQkJCQkJCS8vY2hlY2sgaWYgdGhlIHdpZGdldCBpcyB2aXNpYmxlCgkJCQkJCQlpZiAoIXN0YXRlLmNvbGxhcHNlZCAmJiAhc3RhdGUubWluaW1pemVkICYmIHN0YXRlLmFjdGl2ZSkgewoJCQkJCQkJCS8vb25seSByZW5kZXIgdmlzdWFsIGNvbnRlbnQsIHBlcmhhcHMgcG9wdXAgYSBtZXNzYWdlIGJveCBpZiB0aGUgd2lkZ2V0IGlzIHZpc2libGUKCQkJCQkJCQkvL290aGVyd2lzZSBpdCBtYXkgbm90IHJlbmRlciBjb3JyZWN0bHkKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQl9CgkJfSwKCQl7CgkJCXh0eXBlOiAnd2lkZ2V0dG9vbCcsCgkJCS8vcGF0aCB0byBhbiBpbWFnZSB0byB1c2UuIHRoaXMgcGF0aCBzaG91bGQgZWl0aGVyIGJlIGZ1bGx5IHF1YWxpZmllZCBvciByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0CgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vaW5mb3JtYXRpb24ucG5nJywKCQkJaXRlbUlkOidoZWxwJywKCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQlhbGVydCgnQWJvdXQgQnV0dG9uIFByZXNzZWQnKTsKCQkJfQoJCX0sCgkJCXsKCQkJLy9nZWFyIGlzIGEgc3RhbmRhcmQgZXh0IHRvb2wgdHlwZQoJCQl0eXBlOiAnZ2VhcicsCgkJCWl0ZW1JZDonZ2VhcicsCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJYWxlcnQoJ1V0aWxpdHkgQnV0dG9uIFByZXNzZWQnKTsKCQkJfQoJCX0KCV0KfSk7CiovCgovKioKCVJlbW92ZXMgZXhpc3RpbmcgYnV0dG9ucyBvbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiBpdGVtSWQuCglAbmFtZSByZW1vdmVIZWFkZXJCdXR0b25zCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBidXR0b25zIGNvbmZpZ3VyYXRpb25zIHRvIHJlbW92ZSB0byB0aGUgY2hyb21lLiAgT25seSBpdGVtSWQgaXMgcmVxdWlyZWQuCglTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgYnV0dG9ucyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIGJ1dHRvbnMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCgkKCUBleGFtcGxlCk9XRi5DaHJvbWUucmVtb3ZlSGVhZGVyQnV0dG9ucyh7CgkJaXRlbXM6WwoJCQl7CgkJCQlpdGVtSWQ6J2FsZXJ0JwoJCQl9LAoJCQl7CgkJCQlpdGVtSWQ6J2hlbHAnCgkJCX0sCgkJCXsKCQkJCWl0ZW1JZDonZ2VhcicKCQkJfQoJCV0KfSk7CiovCgovKioKCUxpc3RzIGFsbCBidXR0b25zIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSB3aWRnZXQgY2hyb21lLgoJQG5hbWUgbGlzdEhlYWRlckJ1dHRvbnMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5saXN0SGVhZGVyQnV0dG9ucyh7CgljYWxsYmFjazogZnVuY3Rpb24obXNnKSB7CgkJLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZwoJCXZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOwoJCWlmIChyZXMuc3VjY2VzcykgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlcy5pdGVtcy5sZW5ndGg7IGkrKykgewoJCQkJLy8gZG8gc29tZXRoaW5nIHdpdGggdGhlIGJ1dHRvbnMKCQkJfQoJCX0KCX0KfSk7CiovCgovKioKCUFkZHMgbWVudXMgdG8gdGhlIFdpZGdldCBDaHJvbWUuICBNZW51cyBhcmUgYWRkZWQgYWZ0ZXIgZXhpc3RpbmcgbWVudXMuCglAbmFtZSBhZGRIZWFkZXJNZW51cwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2YgbWVudSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ucGFyZW50SWQgaXRlbUlkIGlzIHRoZSBpdGVtSWQgb2YgdGhlIG1lbnUgdG8gd2hpY2ggdGhpcyBjb25maWd1cmF0aW9uIHNob3VsZCBiZSBhZGRlZCBhcyBhIHN1Yi1tZW51LiAgSWYgb21pdHRlZCwgdGhlIGNvbmZpZ3VyYXRpb24gd2lsbCBiZSBhZGRlZCBhcyBhIG1haW4gbWVudSBvbiB0aGUgbWVudSB0b29sYmFyLiAgCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnVzIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4gIElmIGl0ZW1JZCBpcyBub3QgdW5pcXVlIHRoaXMgbWF5IHJlc3VsdCBpbiBkdXBsaWNhdGUgbWVudXMgd2hpY2ggbWF5IG5vdCBiZSBhYmxlIHRvIGJlIHJlbW92ZWQgcHJvcGVybHkuCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51LiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLnRleHQgVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRleHQgdG8gYXBwZWFyIGFsb25nc2lkZSB0aGUgbWVudS4gIAoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51IG1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QKCUBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zIGFuIGFycmF5IG9mIG1lbnUgaXRlbSBjb25maWd1cmF0aW9ucyB0byBhZGQgdG8gdGhlIGNocm9tZS4gIFNlZSBleGFtcGxlIGZvciBtZW51IGl0ZW0gY29uZmlncwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLml0ZW1JZCBpdGVtSWQgaXMgYSB1bmlxdWUgaWQgYW1vbmcgYWxsIG1lbnUgaXRlbXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLnh0eXBlIHh0eXBlIGlzIHVzZWQgdG8gc3BlY2lmeSB0aGUgdHlwZSBvZiBtZW51IGl0ZW0gdG8gYWRkLiAgVGhpcyBhdHRyaWJ1dGUgc2hvdWxkIGJlIG9taXR0ZWQgdW5sZXNzIHNwZWNpZnlpbmcgYSBtZW51c2VwYXJhdG9yLiBTZXR0aW5nIHRoaXMgdmFsdWUgdG8gIm1lbnVzZXBhcmF0b3IiIGFkZHMgYSBzZXBhcmF0b3IgYmFyIHRvIGEgbWVudSwgdXNlZCB0byBkaXZpZGUgbG9naWNhbCBncm91cHMgb2YgbWVudSBpdGVtcy4gSWYgc3BlY2lmaWVkLCBvbmx5IHh0eXBlIHNob3VsZCBiZSBzcGVjaWZpZWQuICBHZW5lcmFsbHkgeW91IHdpbGwgYWRkIG9uZSBvZiB0aGVzZSBieSB1c2luZyAiLSIgaW4geW91ciBpdGVtcyBjb25maWcgcmF0aGVyIHRoYW4gY3JlYXRpbmcgb25lIGRpcmVjdGx5IHVzaW5nIHh0eXBlLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIHVzYWdlLiAKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudSBpdGVtLiAgSWYgdGhlIFVSTCBpcyBhIHJlbGF0aXZlIHBhdGgsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIC9vd2YgY29udGV4dC4gIFRoaXMgaXMgdXNlZnVsIGlmIHRoZSBkZXNpcmVkIGltYWdlIGlzIGhvc3RlZCBieSB0aGUgT1dGIHdlYiBzZXJ2ZXIuICBPdGhlcndpc2UgYSBmdWxseSBxdWFsaWZpZWQgVVJMIHNob3VsZCBiZSB1c2VkLiAgSWYgdHlwZSBpcyBiZWluZyB1c2VkIHRvIGRldGVybWluZSB0aGUgaW1hZ2UsIHRoZSBpY29uIHByb3BlcnR5IGlzIG9wdGlvbmFsCglAcGFyYW0ge1N0cmluZ30gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgZm9yIHRoZSBtZW51IGl0ZW0uIAoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLml0ZW1zWypdLm1lbnUuaXRlbXNbKl0uaGFuZGxlciBUaGUgaGFuZGxlciBhdHRyaWJ1dGUgZGVmaW5lcyBhIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBjbGlja2VkLiBUaGlzIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHVzaW5nIFdpZGdldCBFdmVudGluZyBBUEkgZnJvbSBpbnNpZGUgdGhlIHdpZGdldC4gIFRoZSBpbnRlcm5hbCBjaGFubmVsIG5hbWUgdXNlZCBpcyB0aGUgaXRlbUlkIGF0dHJpYnV0ZS4gVGhpcyBmdW5jdGlvbidzIHBhcmFtZXRlciBsaXN0IGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBwYXJhbWV0ZXJzIGZvciBhbiBFdmVudGluZyBjYWxsYmFjayBmdW5jdGlvbi4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5tZW51IHN1Yi1tZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0LiAgU2VlIGV4YW1wbGUgZm9yIHN1Yi1tZW51IGNvbmZpZy4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5hZGRIZWFkZXJNZW51cyh7CglpdGVtczogWwoJCXsKCQkJaXRlbUlkOidyZWd1bGFyTWVudScsCgkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJdGV4dDogJ1JlZ3VsYXIgTWVudScsCgkJCW1lbnU6IHsKCQkJCWl0ZW1zOiBbCgkJCQkJewoJCQkJCQlpdGVtSWQ6J3JlZ3VsYXJNZW51SXRlbTEnLAoJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCXRleHQ6ICdSZWd1bGFyIE1lbnUgSXRlbSAxJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91IGNsaWNrZWQgdGhlIFJlZ3VsYXIgTWVudSBtZW51IGl0ZW0uJyk7CgkJCQkJCX0KCQkJCQl9CgkJCQldCgkJCX0KCQl9LAoJCXsKCQkJaXRlbUlkOidzbmFja3MnLAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdNZW51IHdpdGggU3ViLU1lbnUnLAoJCQltZW51OiB7CgkJCQlpdGVtczogWwoJCQkJCXsKCQkJCQkJaXRlbUlkOidmcnVpdHMnLAoJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCXRleHQ6ICdGcnVpdHMnLAoJCQkJCQltZW51OiB7CgkJCQkJCQlpdGVtczogWwoJCQkJCQkJCXsKCQkJCQkJCQkJaXRlbUlkOidhcHBsZScsCgkJCQkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJCQkJdGV4dDogJ0FwcGxlJywKCQkJCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGFuIEFwcGxlLicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSwKCQkJCQkJCSAgIHsKCQkJCQkJCQkgICB4dHlwZTogJ21lbnVzZXBhcmF0b3InCgkJCQkJCQkgICB9LAoJCQkJCQkJCXsKCQkJCQkJCQkJaXRlbUlkOidiYW5hbmEnLAoJCQkJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCQkJCXRleHQ6ICdCYW5hbmEnLAoJCQkJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCQkJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgYSBCYW5hbmEuJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9LCB7CgkJCQkJCQkJCWl0ZW1JZDonY2hlcnJ5JywKCQkJCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQkJCQl0ZXh0OiAnQ2hlcnJpZXMnLAoJCQkJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCQkJCWFsZXJ0KCdZb3VyIHNuYWNrIHdpbGwgYmUgQ2hlcnJpZXMuJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQldCgkJCQkJCX0KCQkJCQl9LAoJCQkJCSctJywgLy8gYW5vdGhlciB3YXkgdG8gYWRkIGEgbWVudSBzZXBhcmF0b3IgCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2N1cGNha2UnLAoJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCXRleHQ6ICdDdXBjYWtlJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQ3VwY2FrZS4nKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2NoaXBzJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnUG90YXRvIENoaXBzJywKCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgUG90YXRvIENoaXBzLicpOwoJCQkJCQl9CgkJCQkJfQoJCQkJXQoJCQl9CgkJfQoJXQp9KTsKKi8KCi8qKgoJVXBkYXRlcyBhbnkgZXhpc3RpbmcgbWVudXMgaW4gdGhlIFdpZGdldCBDaHJvbWUgYmFzZWQgb24gdGhlIGl0ZW1JZC4KCUBuYW1lIHVwZGF0ZUhlYWRlck1lbnVzCglAbWV0aG9kT2YgT1dGLkNocm9tZQoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgY29uZmlncwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51cyB0aGF0IGFyZSBhZGRlZC4gIEl0IGlzIGEgcmVxdWlyZWQgcHJvcGVydHkuICBJdCBpcyB1c2VkIGZvciBpZGVudGlmaWNhdGlvbiBhbmQgZGVmaW5lcyB0aGUgaW50ZXJuYWwgRXZlbnRpbmcgY2hhbm5lbCB3aGljaCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIGhhbmRsZXIgZnVuY3Rpb24uICBJZiBpdGVtSWQgaXMgbm90IHVuaXF1ZSB0aGlzIG1heSByZXN1bHQgaW4gZHVwbGljYXRlIG1lbnVzIHdoaWNoIG1heSBub3QgYmUgYWJsZSB0byBiZSByZW1vdmVkIHByb3Blcmx5LgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5pY29uIFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0aGUgVVJMIG9mIHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciB0aGUgbWVudS4gIElmIHRoZSBVUkwgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSAvb3dmIGNvbnRleHQuICBUaGlzIGlzIHVzZWZ1bCBpZiB0aGUgZGVzaXJlZCBpbWFnZSBpcyBob3N0ZWQgYnkgdGhlIE9XRiB3ZWIgc2VydmVyLiAgT3RoZXJ3aXNlIGEgZnVsbHkgcXVhbGlmaWVkIFVSTCBzaG91bGQgYmUgdXNlZC4gIElmIHR5cGUgaXMgYmVpbmcgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGltYWdlLCB0aGUgaWNvbiBwcm9wZXJ0eSBpcyBvcHRpb25hbAoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBhbG9uZ3NpZGUgdGhlIG1lbnUuICAKCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudSBtZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0CglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGl0ZW0gY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBpdGVtIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51IGl0ZW1zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHR5cGUgb2YgbWVudSBpdGVtIHRvIGFkZC4gIFRoaXMgYXR0cmlidXRlIHNob3VsZCBiZSBvbWl0dGVkIHVubGVzcyBzcGVjaWZ5aW5nIGEgbWVudXNlcGFyYXRvci4gU2V0dGluZyB0aGlzIHZhbHVlIHRvICJtZW51c2VwYXJhdG9yIiBhZGRzIGEgc2VwYXJhdG9yIGJhciB0byBhIG1lbnUsIHVzZWQgdG8gZGl2aWRlIGxvZ2ljYWwgZ3JvdXBzIG9mIG1lbnUgaXRlbXMuIElmIHNwZWNpZmllZCwgb25seSB4dHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIHVzYWdlLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51IGl0ZW0uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBmb3IgdGhlIG1lbnUgaXRlbS4gCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgbWVudSBpdGVtIGlzIGNsaWNrZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9uJ3MgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLgoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLm1lbnUgc3ViLW1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QuICBTZWUgZXhhbXBsZSBmb3Igc3ViLW1lbnUgY29uZmlnLgoJCglAZXhhbXBsZQpPV0YuQ2hyb21lLnVwZGF0ZUhlYWRlck1lbnVzKHsKCWl0ZW1zOlsKCQl7CgkJCWl0ZW1JZDoncmVndWxhck1lbnUnLAoJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCXRleHQ6ICdSZWd1bGFyIE1lbnUnLAoJCQltZW51OiB7CgkJCQlpdGVtczogWwoJCQkJCXsKCQkJCQkJaXRlbUlkOidyZWd1bGFyTWVudUl0ZW0xJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnUmVndWxhciBNZW51IEl0ZW0gMScsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdSBjbGlja2VkIHRoZSBSZWd1bGFyIE1lbnUgbWVudSBpdGVtLicpOwoJCQkJCQl9CgkJCQkJfQoJCQkJXQoJCQl9CgkJfSwKCQl7CgkJCWl0ZW1JZDonc25hY2tzJywKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnTWVudSB3aXRoIFN1Yi1NZW51JywKCQkJbWVudTogewoJCQkJaXRlbXM6IFsKCQkJCQl7CgkJCQkJCWl0ZW1JZDonZnJ1aXRzJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnRnJ1aXRzJywKCQkJCQkJbWVudTogewoJCQkJCQkJaXRlbXM6IFsKCQkJCQkJCQl7CgkJCQkJCQkJCWl0ZW1JZDonYXBwbGUnLAoJCQkJCQkJCQlpY29uOiAnLi90aGVtZXMvY29tbW9uL2ltYWdlcy9za2luL2V4Y2xhbWF0aW9uLnBuZycsCgkJCQkJCQkJCXRleHQ6ICdBcHBsZScsCgkJCQkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhbiBBcHBsZS4nKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0sCgkJCQkJCQkgICB7CgkJCQkJCQkJICAgeHR5cGU6ICdtZW51c2VwYXJhdG9yJwoJCQkJCQkJICAgfSwKCQkJCQkJCQl7CgkJCQkJCQkJCWl0ZW1JZDonYmFuYW5hJywKCQkJCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQkJCQl0ZXh0OiAnQmFuYW5hJywKCQkJCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIGEgQmFuYW5hLicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSwgewoJCQkJCQkJCQlpdGVtSWQ6J2NoZXJyeScsCgkJCQkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJCQkJdGV4dDogJ0NoZXJyaWVzJywKCQkJCQkJCQkJaGFuZGxlcjogZnVuY3Rpb24oc2VuZGVyLCBkYXRhKSB7CgkJCQkJCQkJCQlhbGVydCgnWW91ciBzbmFjayB3aWxsIGJlIENoZXJyaWVzLicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJXQoJCQkJCQl9CgkJCQkJfSwKCQkJCQknLScsIC8vIGFub3RoZXIgd2F5IHRvIGFkZCBhIG1lbnUgc2VwYXJhdG9yIAoJCQkJCXsKCQkJCQkJaXRlbUlkOidjdXBjYWtlJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnQ3VwY2FrZScsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhIEN1cGNha2UuJyk7CgkJCQkJCX0KCQkJCQl9LAoJCQkJCXsKCQkJCQkJaXRlbUlkOidjaGlwcycsCgkJCQkJCWljb246ICcuL3RoZW1lcy9jb21tb24vaW1hZ2VzL3NraW4vZXhjbGFtYXRpb24ucG5nJywKCQkJCQkJdGV4dDogJ1BvdGF0byBDaGlwcycsCgkJCQkJCWhhbmRsZXI6IGZ1bmN0aW9uKHNlbmRlciwgZGF0YSkgewoJCQkJCQkJYWxlcnQoJ1lvdXIgc25hY2sgd2lsbCBiZSBhIFBvdGF0byBDaGlwcy4nKTsKCQkJCQkJfQoJCQkJCX0KCQkJCV0KCQkJfQoJCX0KCV0KfSk7CiovCgovKioKCUluc2VydHMgbmV3IG1lbnVzIGludG8gdGhlIFdpZGdldCBDaHJvbWUuIE1lbnVzIGFyZSBhZGRlZCB0byB0aGUgc2FtZSBhcmVhIGFzIGV4aXN0aW5nIG1lbnVzLgoJQG5hbWUgaW5zZXJ0SGVhZGVyTWVudXMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtOdW1iZXJ9IFtjZmcucG9zPTBdIDAtYmFzZWQgaW5kZXggb2Ygd2hlcmUgbWVudXMgd2lsbCBiZSBhZGRlZCwgYW1vbmcgYW55IHByZS1leGlzdGluZyBtZW51cy4KCUBwYXJhbSB7T2JqZWN0W119IGNmZy5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGNvbmZpZ3VyYXRpb25zIHRvIGFkZCB0byB0aGUgY2hyb21lLiAgU2VlIGV4YW1wbGUgZm9yIG1lbnUgY29uZmlncwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5wYXJlbnRJZCBpdGVtSWQgaXMgdGhlIGl0ZW1JZCBvZiB0aGUgbWVudSB0byB3aGljaCB0aGlzIGNvbmZpZ3VyYXRpb24gc2hvdWxkIGJlIGFkZGVkIGFzIGEgc3ViLW1lbnUuICBJZiBvbWl0dGVkLCB0aGUgY29uZmlndXJhdGlvbiB3aWxsIGJlIGFkZGVkIGFzIGEgbWFpbiBtZW51IG9uIHRoZSBtZW51IHRvb2xiYXIuICAKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaXRlbUlkIGl0ZW1JZCBpcyBhIHVuaXF1ZSBpZCBhbW9uZyBhbGwgbWVudXMgdGhhdCBhcmUgYWRkZWQuICBJdCBpcyBhIHJlcXVpcmVkIHByb3BlcnR5LiAgSXQgaXMgdXNlZCBmb3IgaWRlbnRpZmljYXRpb24gYW5kIGRlZmluZXMgdGhlIGludGVybmFsIEV2ZW50aW5nIGNoYW5uZWwgd2hpY2ggaXMgdXNlZCB0byBleGVjdXRlIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLiAgSWYgaXRlbUlkIGlzIG5vdCB1bmlxdWUgdGhpcyBtYXkgcmVzdWx0IGluIGR1cGxpY2F0ZSBtZW51cyB3aGljaCBtYXkgbm90IGJlIGFibGUgdG8gYmUgcmVtb3ZlZCBwcm9wZXJseS4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0uaWNvbiBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGhlIFVSTCBvZiB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhlIG1lbnUuICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0udGV4dCBUaGlzIHByb3BlcnR5IGRlZmluZXMgdGV4dCB0byBhcHBlYXIgYWxvbmdzaWRlIHRoZSBtZW51LiAgVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgaWYgdGhlIHh0eXBlIGlzIOKAmG1lbnUu4oCZICDigJh3aWRnZXR0b29s4oCZIHdpbGwgbm90IHNob3cgdGV4dC4KCUBwYXJhbSB7T2JqZWN0fSBjZmcuaXRlbXNbKl0ubWVudSBtZW51IGNvbmZpZ3VyYXRpb24gb2JqZWN0CglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtcyBhbiBhcnJheSBvZiBtZW51IGl0ZW0gY29uZmlndXJhdGlvbnMgdG8gYWRkIHRvIHRoZSBjaHJvbWUuICBTZWUgZXhhbXBsZSBmb3IgbWVudSBpdGVtIGNvbmZpZ3MKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5pdGVtSWQgaXRlbUlkIGlzIGEgdW5pcXVlIGlkIGFtb25nIGFsbCBtZW51IGl0ZW1zIHRoYXQgYXJlIGFkZGVkLiAgSXQgaXMgYSByZXF1aXJlZCBwcm9wZXJ0eS4gIEl0IGlzIHVzZWQgZm9yIGlkZW50aWZpY2F0aW9uIGFuZCBkZWZpbmVzIHRoZSBpbnRlcm5hbCBFdmVudGluZyBjaGFubmVsIHdoaWNoIGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgaGFuZGxlciBmdW5jdGlvbi4KCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS54dHlwZSB4dHlwZSBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHR5cGUgb2YgbWVudSBpdGVtIHRvIGFkZC4gIFRoaXMgYXR0cmlidXRlIHNob3VsZCBiZSBvbWl0dGVkIHVubGVzcyBzcGVjaWZ5aW5nIGEgbWVudXNlcGFyYXRvci4gU2V0dGluZyB0aGlzIHZhbHVlIHRvICJtZW51c2VwYXJhdG9yIiBhZGRzIGEgc2VwYXJhdG9yIGJhciB0byBhIG1lbnUsIHVzZWQgdG8gZGl2aWRlIGxvZ2ljYWwgZ3JvdXBzIG9mIG1lbnUgaXRlbXMuIElmIHNwZWNpZmllZCwgb25seSB4dHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiAgU2VlIGV4YW1wbGUgYmVsb3cgZm9yIHVzYWdlLgoJQHBhcmFtIHtTdHJpbmd9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLmljb24gVGhpcyBwcm9wZXJ0eSBkZWZpbmVzIHRoZSBVUkwgb2YgdGhlIGltYWdlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZW51IGl0ZW0uICBJZiB0aGUgVVJMIGlzIGEgcmVsYXRpdmUgcGF0aCwgaXQgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGUgL293ZiBjb250ZXh0LiAgVGhpcyBpcyB1c2VmdWwgaWYgdGhlIGRlc2lyZWQgaW1hZ2UgaXMgaG9zdGVkIGJ5IHRoZSBPV0Ygd2ViIHNlcnZlci4gIE90aGVyd2lzZSBhIGZ1bGx5IHF1YWxpZmllZCBVUkwgc2hvdWxkIGJlIHVzZWQuICBJZiB0eXBlIGlzIGJlaW5nIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbWFnZSwgdGhlIGljb24gcHJvcGVydHkgaXMgb3B0aW9uYWwKCUBwYXJhbSB7U3RyaW5nfSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS50ZXh0IFRoaXMgcHJvcGVydHkgZGVmaW5lcyB0ZXh0IHRvIGFwcGVhciBmb3IgdGhlIG1lbnUgaXRlbS4gCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuaXRlbXNbKl0ubWVudS5pdGVtc1sqXS5oYW5kbGVyIFRoZSBoYW5kbGVyIGF0dHJpYnV0ZSBkZWZpbmVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgbWVudSBpdGVtIGlzIGNsaWNrZWQuIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgdXNpbmcgV2lkZ2V0IEV2ZW50aW5nIEFQSSBmcm9tIGluc2lkZSB0aGUgd2lkZ2V0LiAgVGhlIGludGVybmFsIGNoYW5uZWwgbmFtZSB1c2VkIGlzIHRoZSBpdGVtSWQgYXR0cmlidXRlLiBUaGlzIGZ1bmN0aW9uJ3MgcGFyYW1ldGVyIGxpc3QgY29udGFpbnMgdGhlIHN0YW5kYXJkIHBhcmFtZXRlcnMgZm9yIGFuIEV2ZW50aW5nIGNhbGxiYWNrIGZ1bmN0aW9uLgoJQHBhcmFtIHtPYmplY3R9IGNmZy5pdGVtc1sqXS5tZW51Lml0ZW1zWypdLm1lbnUgc3ViLW1lbnUgY29uZmlndXJhdGlvbiBvYmplY3QuICBTZWUgZXhhbXBsZSBmb3Igc3ViLW1lbnUgY29uZmlnLgoJCglAZXhhbXBsZQpPV0YuQ2hyb21lLmluc2VydEhlYWRlck1lbnVzKHsKCQlwb3M6IDAsCgkJaXRlbXM6IFt7CgkJIGl0ZW1JZDonaW5zZXJ0ZWRNZW51JywKCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQl0ZXh0OiAnSW5zZXJ0ZWQgTWVudScsCgkJCW1lbnU6IHsKCQkJCWl0ZW1zOiBbCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0xJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnSW5zZXJ0ZWQgTWVudSBJdGVtIDEnLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgSW5zZXJ0ZWQgTWVudSBtZW51IGl0ZW0uJyk7CgkJCQkJCX0KCQkJCQl9LAoJCQkJCXsKCQkJCQkJeHR5cGU6ICdtZW51c2VwYXJhdG9yJwoJCQkJCX0sCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0yJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnSW5zZXJ0ZWQgTWVudSBJdGVtIDInLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgSW5zZXJ0ZWQgTWVudSBtZW51IGl0ZW0uJyk7CgkJCQkJCX0KCQkJCQl9LAoJCQkJCSctJywgLy8gYW5vdGhlciB3YXkgdG8gYWRkIGEgbWVudSBzZXBhcmF0b3IgCgkJCQkJewoJCQkJCQlpdGVtSWQ6J2luc2VydGVkTWVudUl0ZW0zJywKCQkJCQkJaWNvbjogJy4vdGhlbWVzL2NvbW1vbi9pbWFnZXMvc2tpbi9leGNsYW1hdGlvbi5wbmcnLAoJCQkJCQl0ZXh0OiAnSW5zZXJ0ZWQgTWVudSBJdGVtIDMnLAoJCQkJCQloYW5kbGVyOiBmdW5jdGlvbihzZW5kZXIsIGRhdGEpIHsKCQkJCQkJCWFsZXJ0KCdZb3UgY2xpY2tlZCB0aGUgSW5zZXJ0ZWQgTWVudSBtZW51IGl0ZW0uJyk7CgkJCQkJCX0KCQkJCQl9CgkJCQldCgkJCX0KCQl9XQp9KTsKKi8KCi8qKgoJUmVtb3ZlcyBleGlzdGluZyBtZW51cyBvbiB0aGUgV2lkZ2V0IENocm9tZSBiYXNlZCBvbiBpdGVtSWQuCglAbmFtZSByZW1vdmVIZWFkZXJNZW51cwoJQG1ldGhvZE9mIE9XRi5DaHJvbWUKCglAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCglAcGFyYW0ge09iamVjdFtdfSBjZmcuaXRlbXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBjb250YWluaW5nIGl0ZW1JZHMgZm9yIHRoZSBtZW51cyB0byByZW1vdmUgZnJvbSB0aGUgY2hyb21lLgoJICBTZWUgZXhhbXBsZSBiZWxvdyBmb3IgYnV0dG9uIGNvbmZpZ3MKCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5yZW1vdmVIZWFkZXJNZW51cyh7CglpdGVtczogW3sKCQlpdGVtSWQ6ICdyZWd1bGFyTWVudScKCX1dCn0pOwoqLwoKLyoqCglMaXN0cyBhbGwgbWVudXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhlIHdpZGdldCBjaHJvbWUuCglAbmFtZSBsaXN0SGVhZGVyTWVudXMKCUBtZXRob2RPZiBPV0YuQ2hyb21lCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLmNhbGxiYWNrIFRoZSBmdW5jdGlvbiB3aGljaCByZWNlaXZlcyB0aGUgcmVzdWx0cy4KCQoJQGV4YW1wbGUKT1dGLkNocm9tZS5saXN0SGVhZGVyTWVudXMoewoJY2FsbGJhY2s6IGZ1bmN0aW9uKG1zZykgewoJCS8vbXNnIHdpbGwgYWx3YXlzIGJlIGEganNvbiBzdHJpbmcKCQl2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsKCQlpZiAocmVzLnN1Y2Nlc3MpIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZXMuaXRlbXMubGVuZ3RoOyBpKyspIHsKCQkJCS8vIGRvIHNvbWV0aGluZyB3aXRoIHRoZSBtZW51cwoJCQl9CgkJfQoJfQp9KTsKCSovCgovKioKICAqCiAgKglAbmFtZSBnZXRUaXRsZQogICogQG1ldGhvZE9mIE9XRi5DaHJvbWUKICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSBXaWRnZXQncyBUaXRsZSBmcm9tIHRoZSBDaHJvbWUKICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5jYWxsYmFjayBUaGUgZnVuY3Rpb24gd2hpY2ggcmVjZWl2ZXMgdGhlIHJlc3VsdHMuCiAgKgogICogQGV4YW1wbGUKICAqICAgIE9XRi5DaHJvbWUuZ2V0VGl0bGUoewogICogICAgIGNhbGxiYWNrOiBmdW5jdGlvbihtc2cpIHsKICAqICAgICAgICAgLy9tc2cgd2lsbCBhbHdheXMgYmUgYSBqc29uIHN0cmluZwogICogICAgICAgICB2YXIgcmVzID0gT3pvbmUudXRpbC5wYXJzZUpzb24obXNnKTsKICAqICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgKgogICogICAgICAgICAgIC8vZG8gc29tZXRoaW5nIHdpdGggdGl0bGUKICAqICAgICAgICAgICAvLyByZXMudGl0bGUKICAqICAgICAgICAgfQogICogICAgIH0KICAqICAgfSk7CiAgKi8KCi8qKgogICoJQG5hbWUgc2V0VGl0bGUKICAqIEBtZXRob2RPZiBPV0YuQ2hyb21lCiAgKiBAZGVzY3JpcHRpb24gU2V0cyB0aGUgV2lkZ2V0J3MgVGl0bGUgaW4gdGhlIENocm9tZQogICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogICogQHBhcmFtIHtTdHJpbmd9IGNmZy50aXRsZSBUaGUgc3RyaW5nIHdoaWNoIHdpbGwgcmVwbGFjZSB0aGUgd2lkZ2V0IHRpdGxlCiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHdoaWNoIHJlY2VpdmVzIHRoZSByZXN1bHRzLgogICoKICAqIEBleGFtcGxlCiAgKiAgICBPV0YuQ2hyb21lLnNldFRpdGxlKHsKICAqICAgICB0aXRsZTogJ25ldyB0aXRsZScsCiAgKiAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKG1zZykgewogICogICAgICAgICAvL21zZyB3aWxsIGFsd2F5cyBiZSBhIGpzb24gc3RyaW5nCiAgKiAgICAgICAgIHZhciByZXMgPSBPem9uZS51dGlsLnBhcnNlSnNvbihtc2cpOwogICogICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAqICAgICAgICAgICAvL2dldCB0aXRsZSBiYWNrIGZvciBjb25maXJtYXRpb24KICAqICAgICAgICAgICAvLyByZXMudGl0bGUKICAqCiAgKiAgICAgICAgIH0KICAqICAgICB9CiAgKiAgIH0pOwogICovCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tIFByZWZlcmVuY2VzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqCglHZXQgdGhlIHVybCBmb3IgdGhlIFByZWZlcmVuY2UgU2VydmVyCglAbmFtZSBnZXRVcmwKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcmV0dXJucyB7U3RyaW5nfSB1cmwKICovCgovKioKCVNldHMgdGhlIHVybCBmb3IgdGhlIFByZWZlcmVuY2UgU2VydmVyCglAbmFtZSBzZXRVcmwKCUBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKCglAcGFyYW0ge1N0cmluZ30gdXJsCglAcmV0dXJucyB2b2lkCiAqLwoKLyoqCiAqIEBuYW1lIGdldERhc2hib2FyZAogKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSBkYXNoYm9hcmQgd2l0aCB0aGUgc3BlY2lmaWVkIGlkCiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtTdHJpbmd9IGNmZy5kYXNoYm9hcmRJZCBVbmlndWUgZGFzaGJhcmQgaWRlbnRpZmllcgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIGRhc2hib2FyZC4KICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqIDxicj4KICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+CiAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+CiAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4KICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgogKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogKiAgICAgPC91bD4KICogPGJyPgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCiAqIEBleGFtcGxlCiAqCiAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsKICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgKiAgICAgYWxlcnQoZXJyb3IpOwogKiB9OwogKgogKiBPem9uZS5QcmVmZXJlbmNlcy5nZXREYXNoYm9hcmQoewogKiAgICAgZGFzaGJvYXJkSWQ6JzkxN2I0Y2QwLWVjYmQtNDEwYi1hZmQ5LTQyZDE1MGMyNjQyNicsCiAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLAogKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogKiB9KTsKICovCgoKIC8qKgogICAqIEBuYW1lIGdldERlZmF1bHREYXNoYm9hcmQKICAgKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAgICogQGRlc2NyaXB0aW9uIEdldHMgdGhlIHVzZXIncyBkZWZhdWx0IGRhc2hib2FyZAogICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4KICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICAgKiA8YnI+CiAgICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+CiAgICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAgICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICAgKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+CiAgICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogICAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogICAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAgICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICAgKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICAgKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4KICAgKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogICAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogICAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPgogICAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAgICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAgICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4KICAgKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICAgKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAgICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPgogICAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPgogICAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICAgKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICAgKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+CiAgICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4KICAgKiAgICAgICAgPC91bD4KICAgKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICAgKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAgICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogICAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogICAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPgogICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogICAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogICAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPgogICAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICAgKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4KICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAgICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICAgKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+CiAgICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICAgKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogICAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4KICAgKiAgICAgICAgPC91bD4KICAgKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogICAqICAgICA8L3VsPgogICAqIDxicj4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsKICAgKiAgICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOwogICAqIH07CiAgICoKICAgKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICogICAgIGFsZXJ0KGVycm9yKTsKICAgKiB9OwogICAqCiAgICogT3pvbmUuUHJlZmVyZW5jZXMuZ2V0RGFzaGJvYXJkKHsKICAgKiAgICAgb25TdWNjZXNzOm9uU3VjY2VzcywKICAgKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogICAqIH0pOwogICAqLwovKioKICogQG5hbWUgc2V0RGVmYXVsdERhc2hib2FyZAogKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAqIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSB1c2VyJ3MgZGVmYXVsdCBkYXNoYm9hcmQKICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogKiBAcGFyYW0ge1N0cmluZ30gY2ZnLmRhc2hib2FyZElkIFVuaWd1ZSBkYXNoYmFyZCBpZGVudGlmaWVyCiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2ZnLmlzRGVmYXVsdCB0cnVlIHRvIHNldCBhcyBkZWZhdWx0IGRhc2hib2FyZAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMganNvbiByZXByZXNlbnRhdGlvbiBvZiBhIERhc2hib2FyZC4KICogVGhpcyBtZXRob2Qgd2lsbCBiZSBwYXNzZWQgdGhlIGRhc2hib2FyZCBvYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqIDxicj4KICogICAgIHtCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+CiAqICAgICB7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPgogKiAgICAge0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+CiAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4KICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgogKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogKiAgICAgPC91bD4KICogPGJyPgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCiAqIEBleGFtcGxlCiAqCiAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXNoYm9hcmQpIHsKICogICAgIGFsZXJ0KGRhc2hib2FyZC5uYW1lKTsKICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAqICAgICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5zZXREZWZhdWx0RGFzaGJvYXJkKHsKICogICAgIGRhc2hib2FyZElkOic5MTdiNGNkMC1lY2JkLTQxMGItYWZkOS00MmQxNTBjMjY0MjYnLAogKiAgICAgaXNEZWZhdWx0OnRydWUsCiAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLAogKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogKiB9KTsKICovCgovKioKICogQG5hbWUgY3JlYXRlT3JVcGRhdGVEYXNoYm9hcmQKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVzY3JpcHRpb24gU2F2ZXMgY2hhbmdlcyB0byBhIG5ldyBvciBleGlzdGluZyBkYXNoYm9hcmQKICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogKiBAcGFyYW0ge09iamVjdH0gY2ZnLmpzb24gVGhlIGVuY29kZWQgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkYXNoYm9hcmQuCiAqIFRoZSBkYXNoYm9hcmQgb2JqZWN0IGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGxheW91dDogbGF5b3V0IG9mIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7TnVtYmVyfSBjb2x1bW5Db3VudDogbnVtYmVyIG9mIGNvbHVtbnMgaWYgZGFzaGJvYXJkIGlzIGEgcG9ydGFsIHR5cGU8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtMaXN0fSBFRGFzaGJvYXJkTGF5b3V0TGlzdDogbGlzdCBvZiBkYXNoYm9hcmQgdHlwZXM8YnI+CiAqICAgICB7U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IGRhc2hib2FyZCB0eXBlPGJyPgogKiAgICAge09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICogICAgIHtEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAqICAgICB7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+CiAqICAgICB7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4KICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgogKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogKiAgICAgPC91bD4KICogPGJyPgogKiBAcGFyYW0ge0Jvb2xlYW59IGNmZy5zYXZlQXNOZXcgQSBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW50aXR5IGJlaW5nIHNhdmVkIGlzIG5ldy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuCiAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAcGFyYW0ge0Jvb2xlYW59IFtjZmcuYXN5bmNdIEFzeW5jIHRydWUgb3IgZmFsc2UgZGVmYXVsdHMgdG8gdHJ1ZQogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7CiAqICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOwogKiB9OwogKgogKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKICogICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIHZhciBkYXNoYm9hcmQgPSB7CiAqICAgYWx0ZXJlZEJ5QWRtaW46ICdmYWxzZScsCiAqICAgY3JlYXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsCiAqICAgaXNHcm91cERhc2hib2FyZDogZmFsc2UsCiAqICAgaXNkZWZhdWx0OiBmYWxzZSwKICogICBsb2NrZWQ6IGZhbHNlLAogKiAgIG5hbWU6ICdNeSBEYXNoYm9hcmQnLAogKiAgIHVzZXI6IHsKICogICAgIHVzZXJJZDogJ3Rlc3RBZG1pbjEnLAogKiAgIH0sCiAqICAgY3JlYXRlZEJ5OiB7CiAqICAgICB1c2VySWQ6ICd0ZXN0QWRtaW4xJywKICogICAgIHVzZXJSZWFsTmFtZTogJ1Rlc3QgQWRtaW4gMScKICogICB9LAogKiAgIGVkaXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsCiAqICAgZ3JvdXBzOiBbXSwKICogICBkZXNjcmlwdGlvbjogJ1RoaXMgaXMgbXkgZGFzaGJvYXJkJywKICogICBndWlkOiBndWlkLnV0aWwuZ3VpZCgpLAogKiAgIGxheW91dENvbmZpZzogewogKiAgICAgICB4dHlwZTogImRlc2t0b3BwYW5lIiwgCiAqICAgICAgIGZsZXg6IDEsIAogKiAgICAgICBoZWlnaHQ6ICIxMDAlIiwgCiAqICAgICAgIGl0ZW1zOiBbCiAqICAgICAgIF0sIAogKiAgICAgICBwYW5lVHlwZTogImRlc2t0b3BwYW5lIiwgCiAqICAgICAgIHdpZGdldHM6IFt7CiAqICAgICAgICAgICAgICAgd2lkZ2V0R3VpZDogImVjNTQzNWNmLTQwMjEtNGYyYS1iYTY5LWRkZTQ1MWQxMjU1MSIsIAogKiAgICAgICAgICAgICAgIHVuaXF1ZUlkOiBndWlkLnV0aWwuZ3VpZCgpLCAKICogICAgICAgICAgICAgICBkYXNoYm9hcmRHdWlkOiAiNmQ3MjE5Y2ItYjQ4NS1hY2U1LTk0NmItMGFmZmExZjIyN2EzIiwgCiAqICAgICAgICAgICAgICAgcGFuZUd1aWQ6IGd1aWQudXRpbC5ndWlkKCksIAogKiAgICAgICAgICAgICAgIG5hbWU6ICJDaGFubmVsIExpc3RlbmVyIiwgCiAqICAgICAgICAgICAgICAgYWN0aXZlOiBmYWxzZSwgCiAqICAgICAgICAgICAgICAgeDogNTAsIAogKiAgICAgICAgICAgICAgIHk6IDY2LCAKICogICAgICAgICAgICAgICBtaW5pbWl6ZWQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICBtYXhpbWl6ZWQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICBwaW5uZWQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICBjb2xsYXBzZWQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICBjb2x1bW5Qb3M6IDAsIAogKiAgICAgICAgICAgICAgIGJ1dHRvbklkOiBudWxsLCAKICogICAgICAgICAgICAgICBidXR0b25PcGVuZWQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICByZWdpb246ICJub25lIiwgCiAqICAgICAgICAgICAgICAgc3RhdGVQb3NpdGlvbjogMSwgCiAqICAgICAgICAgICAgICAgaW50ZW50Q29uZmlnOiBudWxsLCAKICogICAgICAgICAgICAgICBzaW5nbGV0b246IGZhbHNlLCAKICogICAgICAgICAgICAgICBmbG9hdGluZ1dpZGdldDogZmFsc2UsIAogKiAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IGZhbHNlLCAKICogICAgICAgICAgICAgICB6SW5kZXg6IDE5MDUwLCAKICogICAgICAgICAgICAgICBoZWlnaHQ6IDQ0MCwgCiAqICAgICAgICAgICAgICAgd2lkdGg6IDU0MAogKiAgICAgICAgICAgfQogKiAgICAgICBdLCAKICogICAgICAgZGVmYXVsdFNldHRpbmdzOiB7CiAqICAgICAgICAgICB3aWRnZXRTdGF0ZXM6IHsKICogICAgICAgICAgICAgICAiZWM1NDM1Y2YtNDAyMS00ZjJhLWJhNjktZGRlNDUxZDEyNTUxIjogewogKiAgICAgICAgICAgICAgICAgICB4OiA1MCwgCiAqICAgICAgICAgICAgICAgICAgIHk6IDY2LCAKICogICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0NDAsIAogKiAgICAgICAgICAgICAgICAgICB3aWR0aDogNTQwLCAKICogICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiAxMzQ5ODA5NzQ3MzM2CiAqICAgICAgICAgICAgICAgIH0KICogICAgICAgICAgIH0KICogICAgICAgfQogKiAgICAgIH0KICogfTsKICoKICogT1dGLlByZWZlcmVuY2VzLmNyZWF0ZU9yVXBkYXRlRGFzaGJvYXJkKHsKICogICBqc29uOiBkYXNoYm9hcmQsCiAqICAgc2F2ZUFzTmV3OiB0cnVlLAogKiAgIG9uU3VjY2Vzczogb25TdWNjZXNzLAogKiAgIG9uRmFpbHVyZTogb25GYWlsdXJlLAogKiAgIGFzeW5jOiB0cnVlCiAqIH0pOwogKi8KCi8qKgogKiBAbmFtZSBjbG9uZURhc2hib2FyZAogKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAqIEBkZXNjcmlwdGlvbiBDb3BpZXMgYW4gZXhpc3RpbmcgZGFzaGJvYXJkIGFuZCBzYXZlcyBpdCBhcyBuZXcKICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogKiBAcGFyYW0ge09iamVjdH0gY2ZnLmpzb24gVGhlIGVuY29kZWQgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkYXNoYm9hcmQuCiAqIFRoZSBkYXNoYm9hcmQgb2JqZWN0IGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGpzb24gcmVwcmVzZW50YXRpb24gb2YgYSBEYXNoYm9hcmQuCiAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgcGFzc2VkIHRoZSBkYXNoYm9hcmQgb2JqZWN0IHdoaWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gYWx0ZXJlZEJ5QWRtaW46IHRydWUgaWYgYWx0ZXJlZCBieSBhbiBhZG1pbmlzdHJhdG9yPGJyPgogKiAgICAge0RhdGV9IGNyZWF0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgY3JlYXRlZDxicj4KICogICAgIHtCb29sZWFufSBpc0dyb3VwRGFzaGJvYXJkOiB0cnVlIGlmIGRhc2hib2FyZCBpcyBhIGdyb3VwIGRhc2hib2FyZDxicj4KICogICAgIHtCb29sZWFufSBpc2RlZmF1bHQ6IHRydWUgaWYgdGhpcyBpcyBhIGRlZmF1bHQgZGFzaGJvYXJkPGJyPgogKiAgICAge1N0cmluZ30gbmFtZTogbmFtZSBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7T2JqZWN0fSB1c2VyOiB0aGUgZGFzaG9hcmQgb3duZXIuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgIHtPYmplY3R9IGNyZWF0ZWRCeTogZGFzaGJvYXJkIGNyZWF0b3IuICBIYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogdW5pcXVlIHVzZXIgaWRlbnRpZmllcjxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJSZWFsTmFtZTogdXNlcidzIG5hbWU8YnI+CiAqICAgICB7RGF0ZX0gZWRpdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGxhc3QgZWRpdGVkPGJyPgogKiAgICAge0FycmF5fSBncm91cHM6ICBncm91cHMgZGFzaGJvYXJkIGlzIGFzc2lnbmVkIHRvPGJyPgogKiAgICAge1N0cmluZ30gZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIG9mIGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IGd1aWQ6IHVuaXF1ZWQgZGFzaGJvYXJkIGlkZW50aWZpZXI8YnI+CiAqICAgICB7U3RyaW5nfSBsYXlvdXRDb25maWc6IEhvbGRzIHRoZSB2YXJpb3VzIGNvbnRhaW5lcnMgYW5kIHBhbmVzIG9uIGEgZGFzaGJvYXJkIGFuZCB0aGUgd2lkZ2V0cyBpbnNpZGUgb2YgdGhlIHBhbmVzLCBpbmNsdWRpbmcgdGhlIHdpZGdldCBzdGF0ZXMuCiAqICAgICBUaGlzIHBhcmFtZXRlciBwcm92aWRlcyBhbiBFWFQgSlMgc3R5bGUgY29uZmlndXJhdGlvbiB1c2VkIHRvIGxheW91dCB0aGUgc3VwcG9ydGVkIHBhbmUgdHlwZXMgaW4gYW4gT1dGIGRhc2hib2FyZCBhbG9uZy4gRWFjaAogKiAgICAgaW50ZXJuYWwgZGVmaW5pdGlvbiBjYW4gaG9sZCBuZXN0ZWQgcGFuZXMgaW4gYW4gaXRlbXMgYXJyYXksIHdpZGdldHMgaW4gYSB3aWRnZXRzIGFycmF5LCBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIHRob3NlIHdpZGdldHMgaW4gYSBkZWZhdWx0VmFsdWVzIGFycmF5LgogKiAgICAgUGFuZXMgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOjxicj4KICogICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHh0eXBlOiBjb250YWluZXJ8YWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZXxkYXNoYm9hcmRzcGxpdHRlcjwvbGk+CiAqICAgICAgICA8bGk+e051bWJlcn0gZmxleDogMSBpZiBmb3IgYSBwYW5lOyAzIGZvciBhIGNvbnRhaW5lcjxsaT4KICogICAgICAgIDxsaT57U3RyaW5nfSBodG1sVGV4dDogaW4gcGl4ZWxzIChlLmcuLCAzMDBweCkgb3IgcGVyY2VudCAoZS5nLiwgMTAwJSkgb3IgInZhcmlhYmxlIjsgdmFsaWQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5L3ZlcnRpY2FsbHkgc3BsaXQgcGFuZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gY2xzOiBsZWZ0fHJpZ2h0IGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseSBzcGxpdCBwYW5lOyB0b3B8Ym90dG9tIGlmIG5lc3RlZCBpbiBhIHZlcnRpY2FsbHkgc3BsaXQgcGFuZTsgdmJveHxoYm94IGlmIHh0eXBlIGlzIGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBpdGVtczogYW4gYXJyYXkgb2YgMiBuZXN0ZWQgcGFuZSBjb25maWd1cmF0aW9ucyBhbG9uZyB3aXRoIGEgcG9zc2libGUgZGFzaGJvYXJkc3BsaWl0ZXIgZm9yIHZib3ggYW5kIGhib3ggY29udGFpbmVyczsgZW1wdHkgb3RoZXJ3aXNlPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBwYW5lVHlwZTogYWNjb3JkaW9ucGFuZXxkZXNrdG9wcGFuZXxmaXRwYW5lfHBvcnRhbHBhbmV8dGFiYmVkcGFuZTsgdmFsaWQgaWYgeHR5cGUgaXMgbm90IGNvbnRhaW5lcjwvbGk+CiAqICAgICAgICA8bGk+e0FycmF5fSBsYXlvdXQ6IHZhbGlkIG9ubHkgZm9yIGNvbnRhaW5lciB4dHlwZS4gIEluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZWxlbWVudHM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHR5cGU6IHZib3h8aGJveDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYWxpZ246IHN0cmV0Y2g8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57QXJyYXl9IHdpZGdldHM6IGFycmF5IG9mIHdpZGdldCBzdGF0ZSBvYmplY3RzLiAgRWFjaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB3aWRnZXRHdWlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXI8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB6SW5kZXg6IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gcmVnaW9uOiBjb250YWluaW5nIHJlZ2lvbiBvbiBkYXNoYm9hcmQuICBEYXNoYm9hcmQgdHlwZSBzcGVjaWZpYy48L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBwaW5uZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIHBpbm5lZCBvcGVuPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBidXR0b25JZDogaWRlbnRpZmllciBvZiBidXR0b24gdGhhdCBvcGVucyB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGhlaWdodDogaGVpZ2h0IG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IGNvbHVtblBvczogcG9zaXRpb24gb2Ygd2lkZ2V0IGluIGEgY29sdW1uPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBuYW1lOiB3aWRnZXQgbmFtZTwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gc3RhdGVQb3NpdGlvbjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGFjdGl2ZTogdHJ1ZSBpZiB0aGlzIHdpZGdldCBpcyB0aGUgYWN0aXZlIChoYXMgZm9jdXMpIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdW5pcXVlSWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllciBvbiBkYXNoYm9hcmQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGJ1dHRvbk9wZW5lZDogdHJ1ZSBpZiBidXR0b24gbGF1bmNoZWQgd2lkZ2V0IGlzIG9wZW5lZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IGNvbGxhcHNlZDogdHJ1ZSBpZiB3aWRnZXQgaXMgY29sbGFwc2VkPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB5OiB5LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb24gaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8L2xpPgogKiAgICAgICAgPC91bD4KICogICAgICAgIDxsaT57U3RyaW5nfSBkZWZhdWx0U2V0dGluZ3M6IEpTT04gc3RyaW5nIG9mIGRlZmF1bHQgc2V0dGluZ3Mgd2hpY2ggdmFyaWVzIGJ5IHBhbmUgdHlwZTsgbm90IHZhbGlkIGZvciBjb250YWluZXJzPC9saT4KICogICAgIDwvdWw+CiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGFzaGJvYXJkKSB7CiAqICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOwogKiB9OwogKgogKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKICogICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIHZhciBkYXNoYm9hcmQgPSB7CiAqICAgYWx0ZXJlZEJ5QWRtaW46ICdmYWxzZScsCiAqICAgY3JlYXRlZERhdGU6ICcwNC8xOC8yMDEyIDExOjI5IEFNIEVEVCcsCiAqICAgaXNHcm91cERhc2hib2FyZDogZmFsc2UsCiAqICAgaXNkZWZhdWx0OiBmYWxzZSwKICogICBuYW1lOiAnTXkgRGFzaGJvYXJkJywKICogICB1c2VyOiB7CiAqICAgICB1c2VySWQ6ICd0ZXN0QWRtaW4xJywKICogICB9LAogKiAgIGNyZWF0ZWRCeTogewogKiAgICAgdXNlcklkOiAndGVzdEFkbWluMScsCiAqICAgICB1c2VyUmVhbE5hbWU6ICdUZXN0IEFkbWluIDEnCiAqICAgfSwKICogICBlZGl0ZWREYXRlOiAnMDQvMTgvMjAxMiAxMToyOSBBTSBFRFQnLAogKiAgIGdyb3VwczogW10sCiAqICAgZGVzY3JpcHRpb246ICdUaGlzIGlzIG15IGRhc2hib2FyZCcsCiAqICAgZ3VpZDogZ3VpZC51dGlsLmd1aWQoKSwKICogfTsKICoKICogT1dGLlByZWZlcmVuY2VzLmNsb25lRGFzaGJvYXJkKHsKICogICBqc29uOiBkYXNoYm9hcmQsCiAqICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MsCiAqICAgb25GYWlsdXJlOiBvbkZhaWx1cmUKICogfSk7CiAqLwoKCi8qKgoJQGRlc2NyaXB0aW9uIFNhdmVzIGNoYW5nZXMgdG8gZXhpc3RpbmcgZGFzaGJvYXJkcwoJQG5hbWUgdXBkYXRlQW5kRGVsZXRlRGFzaGJvYXJkcwoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7QXJyYXl9IGNmZy52aWV3c1RvVXBkYXRlIGFycmF5IG9mIEpTT04gb2JqZWN0cyBjb250YWluaW5nIHRoZSB2aWV3IGd1aWQgYW5kIGRhdGEgdG8gYmUgdXBkYXRlZAoJQHBhcmFtIHtBcnJheX0gY2ZnLnZpZXdHdWlkc1RvRGVsZXRlIGFycmF5IG9mIGd1aWRzIG9mIHZpZXdzIHRvIGJlIGRlbGV0ZWQKCUBwYXJhbSB7Qm9vbGVhbn0gY2ZnLnVwZGF0ZU9yZGVyIGZsYWcgdG8gdXBkYXRlIG9yZGVyCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0CglAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gY2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkKICovCgovKioKICogQG5hbWUgZGVsZXRlRGFzaGJvYXJkCiAqIEBtZXRob2RPZiBPV0YuUHJlZmVyZW5jZXMKICogQGRlc2NyaXB0aW9uIERlbGV0ZXMgdGhlIGRhc2hib2FyZCB3aXRoIHRoZSBzcGVjaWZpZWQgaWQKICogQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwogKiBAcGFyYW0ge1N0cmluZ30gY2ZnLmRhc2hib2FyZElkIFVuaWd1ZSBkYXNoYmFyZCBpZGVudGlmaWVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGEgRGFzaGJvYXJkLgogKiBUaGlzIG1ldGhvZCB3aWxsIGJlIHBhc3NlZCB0aGUgZGFzaGJvYXJkIG9iamVjdCB3aGljaCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogPGJyPgogKiAgICAge0Jvb2xlYW59IGFsdGVyZWRCeUFkbWluOiB0cnVlIGlmIGFsdGVyZWQgYnkgYW4gYWRtaW5pc3RyYXRvcjxicj4KICogICAgIHtEYXRlfSBjcmVhdGVkRGF0ZTogZGF0ZSBkYXNoYm9hcmQgd2FzIGNyZWF0ZWQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNHcm91cERhc2hib2FyZDogdHJ1ZSBpZiBkYXNoYm9hcmQgaXMgYSBncm91cCBkYXNoYm9hcmQ8YnI+CiAqICAgICB7Qm9vbGVhbn0gaXNkZWZhdWx0OiB0cnVlIGlmIHRoaXMgaXMgYSBkZWZhdWx0IGRhc2hib2FyZDxicj4KICogICAgIHtTdHJpbmd9IG5hbWU6IG5hbWUgb2YgZGFzaGJvYXJkPGJyPgogKiAgICAge09iamVjdH0gdXNlcjogdGhlIGRhc2hvYXJkIG93bmVyLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICB7T2JqZWN0fSBjcmVhdGVkQnk6IGRhc2hib2FyZCBjcmVhdG9yLiAgSGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VySWQ6IHVuaXF1ZSB1c2VyIGlkZW50aWZpZXI8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHVzZXIncyBuYW1lPGJyPgogKiAgICAge0RhdGV9IGVkaXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBsYXN0IGVkaXRlZDxicj4KICogICAgIHtBcnJheX0gZ3JvdXBzOiAgZ3JvdXBzIGRhc2hib2FyZCBpcyBhc3NpZ25lZCB0bzxicj4KICogICAgIHtTdHJpbmd9IGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiBvZiBkYXNoYm9hcmQ8YnI+CiAqICAgICB7U3RyaW5nfSBndWlkOiB1bmlxdWVkIGRhc2hib2FyZCBpZGVudGlmaWVyPGJyPgogKiAgICAge1N0cmluZ30gbGF5b3V0Q29uZmlnOiBIb2xkcyB0aGUgdmFyaW91cyBjb250YWluZXJzIGFuZCBwYW5lcyBvbiBhIGRhc2hib2FyZCBhbmQgdGhlIHdpZGdldHMgaW5zaWRlIG9mIHRoZSBwYW5lcywgaW5jbHVkaW5nIHRoZSB3aWRnZXQgc3RhdGVzLgogKiAgICAgVGhpcyBwYXJhbWV0ZXIgcHJvdmlkZXMgYW4gRVhUIEpTIHN0eWxlIGNvbmZpZ3VyYXRpb24gdXNlZCB0byBsYXlvdXQgdGhlIHN1cHBvcnRlZCBwYW5lIHR5cGVzIGluIGFuIE9XRiBkYXNoYm9hcmQgYWxvbmcuIEVhY2gKICogICAgIGludGVybmFsIGRlZmluaXRpb24gY2FuIGhvbGQgbmVzdGVkIHBhbmVzIGluIGFuIGl0ZW1zIGFycmF5LCB3aWRnZXRzIGluIGEgd2lkZ2V0cyBhcnJheSwgYW5kIGRlZmF1bHQgdmFsdWVzIGZvciB0aG9zZSB3aWRnZXRzIGluIGEgZGVmYXVsdFZhbHVlcyBhcnJheS4KICogICAgIFBhbmVzIGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczo8YnI+CiAqICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgIDxsaT57U3RyaW5nfSB4dHlwZTogY29udGFpbmVyfGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmV8ZGFzaGJvYXJkc3BsaXR0ZXI8L2xpPgogKiAgICAgICAgPGxpPntOdW1iZXJ9IGZsZXg6IDEgaWYgZm9yIGEgcGFuZTsgMyBmb3IgYSBjb250YWluZXI8bGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gaHRtbFRleHQ6IGluIHBpeGVscyAoZS5nLiwgMzAwcHgpIG9yIHBlcmNlbnQgKGUuZy4sIDEwMCUpIG9yICJ2YXJpYWJsZSI7IHZhbGlkIGlmIG5lc3RlZCBpbiBhIGhvcml6b250YWxseS92ZXJ0aWNhbGx5IHNwbGl0IHBhbmU8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGNsczogbGVmdHxyaWdodCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkgc3BsaXQgcGFuZTsgdG9wfGJvdHRvbSBpZiBuZXN0ZWQgaW4gYSB2ZXJ0aWNhbGx5IHNwbGl0IHBhbmU7IHZib3h8aGJveCBpZiB4dHlwZSBpcyBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gaXRlbXM6IGFuIGFycmF5IG9mIDIgbmVzdGVkIHBhbmUgY29uZmlndXJhdGlvbnMgYWxvbmcgd2l0aCBhIHBvc3NpYmxlIGRhc2hib2FyZHNwbGlpdGVyIGZvciB2Ym94IGFuZCBoYm94IGNvbnRhaW5lcnM7IGVtcHR5IG90aGVyd2lzZTwvbGk+CiAqICAgICAgICA8bGk+e1N0cmluZ30gcGFuZVR5cGU6IGFjY29yZGlvbnBhbmV8ZGVza3RvcHBhbmV8Zml0cGFuZXxwb3J0YWxwYW5lfHRhYmJlZHBhbmU7IHZhbGlkIGlmIHh0eXBlIGlzIG5vdCBjb250YWluZXI8L2xpPgogKiAgICAgICAgPGxpPntBcnJheX0gbGF5b3V0OiB2YWxpZCBvbmx5IGZvciBjb250YWluZXIgeHR5cGUuICBJbmNsdWRlcyB0aGUgZm9sbG93aW5nIGVsZW1lbnRzOjwvbGk+CiAqICAgICAgICA8dWwgc3R5bGU9Imxpc3Qtc3R5bGUtdHlwZTpub25lIj4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB0eXBlOiB2Ym94fGhib3g8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGFsaWduOiBzdHJldGNoPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e0FycmF5fSB3aWRnZXRzOiBhcnJheSBvZiB3aWRnZXQgc3RhdGUgb2JqZWN0cy4gIEVhY2ggaGFzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gd2lkZ2V0R3VpZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSB3aWR0aDogd2lkdGggb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gekluZGV4OiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHJlZ2lvbjogY29udGFpbmluZyByZWdpb24gb24gZGFzaGJvYXJkLiAgRGFzaGJvYXJkIHR5cGUgc3BlY2lmaWMuPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gcGlubmVkOiB0cnVlIGlmIHdpZGdldCBpcyBwaW5uZWQgb3BlbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gYnV0dG9uSWQ6IGlkZW50aWZpZXIgb2YgYnV0dG9uIHRoYXQgb3BlbnMgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB3aWRnZXQgaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBjb2x1bW5Qb3M6IHBvc2l0aW9uIG9mIHdpZGdldCBpbiBhIGNvbHVtbjwvbGk+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gbmFtZTogd2lkZ2V0IG5hbWU8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHN0YXRlUG9zaXRpb248L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBhY3RpdmU6IHRydWUgaWYgdGhpcyB3aWRnZXQgaXMgdGhlIGFjdGl2ZSAoaGFzIGZvY3VzKSB3aWRnZXQ8L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHVuaXF1ZUlkOiB1bmlxdWUgd2lkZ2V0IGlkZW50aWZpZXIgb24gZGFzaGJvYXJkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBidXR0b25PcGVuZWQ6IHRydWUgaWYgYnV0dG9uIGxhdW5jaGVkIHdpZGdldCBpcyBvcGVuZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBjb2xsYXBzZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIGNvbGxhcHNlZDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uIGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPC9saT4KICogICAgICAgIDwvdWw+CiAqICAgICAgICA8bGk+e1N0cmluZ30gZGVmYXVsdFNldHRpbmdzOiBKU09OIHN0cmluZyBvZiBkZWZhdWx0IHNldHRpbmdzIHdoaWNoIHZhcmllcyBieSBwYW5lIHR5cGU7IG5vdCB2YWxpZCBmb3IgY29udGFpbmVyczwvbGk+CiAqICAgICA8L3VsPgogKiA8YnI+CiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBDYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KICogQGV4YW1wbGUKICoKICogdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhc2hib2FyZCkgewogKiAgICAgYWxlcnQoZGFzaGJvYXJkLm5hbWUpOwogKiB9OwogKgogKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKICAgICAqICAgICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5kZWxldGVEYXNoYm9hcmQoewogKiAgICAgZGFzaGJvYXJkSWQ6JzkxN2I0Y2QwLWVjYmQtNDEwYi1hZmQ5LTQyZDE1MGMyNjQyNicsCiAqICAgICBvblN1Y2Nlc3M6b25TdWNjZXNzLAogKiAgICAgb25GYWlsdXJlOm9uRmFpbHVyZQogKiB9KTsKICovCgovKioKICogQG5hbWUgZmluZERhc2hib2FyZHMKICogQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwogKiBAZGVzY3JpcHRpb24gUmV0dXJucyBhbGwgZGFzaGJvYXJkcyBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLgogKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3Qgc2VlIGJlbG93IGZvciBwcm9wZXJ0aWVzCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FwdHVyZSB0aGUgc3VjY2VzcyByZXN1bHQuCiAqIFRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+CiAqIDxicj4KICogICAgIHtCb29sZWFufSBzdWNjZXNzOiB0cnVlIGlmIGRhc2hib2FyZHMgZm91bmQ8YnI+CiAqICAgICB7TnVtYmVyfSByZXN1bHRzOiBudW1iZXIgb2YgZGFzaGJvYXJkcyBmb3VuZDxicj4KICogICAgIHtBcnJheX0gZGF0YTogYXJyYXkgb2YgZGFzaGJvYXJkcyBvYmplY3RzIGZvdW5kLiAgRGFzaGJvYXJkIG9iamVjdCBoYXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KICogICAgIDxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBhbHRlcmVkQnlBZG1pbjogdHJ1ZSBpZiBhbHRlcmVkIGJ5IGFuIGFkbWluaXN0cmF0b3I8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7RGF0ZX0gY3JlYXRlZERhdGU6IGRhdGUgZGFzaGJvYXJkIHdhcyBjcmVhdGVkPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGlzR3JvdXBEYXNoYm9hcmQ6IHRydWUgaWYgZGFzaGJvYXJkIGlzIGEgZ3JvdXAgZGFzaGJvYXJkPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGlzZGVmYXVsdDogdHJ1ZSBpZiB0aGlzIGlzIGEgZGVmYXVsdCBkYXNoYm9hcmQ8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBuYW1lOiBuYW1lIG9mIGRhc2hib2FyZDxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tPYmplY3R9IHVzZXI6IHRoZSBkYXNob2FyZCBvd25lci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e09iamVjdH0gY3JlYXRlZEJ5OiBkYXNoYm9hcmQgY3JlYXRvci4gIEhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB1bmlxdWUgdXNlciBpZGVudGlmaWVyPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB1c2VyJ3MgbmFtZTxicj4KICogICAgICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tEYXRlfSBlZGl0ZWREYXRlOiBkYXRlIGRhc2hib2FyZCB3YXMgbGFzdCBlZGl0ZWQ8YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGdyb3VwczogIGdyb3VwcyBkYXNoYm9hcmQgaXMgYXNzaWduZWQgdG88YnI+CiAqICAgICAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gb2YgZGFzaGJvYXJkPGJyPgogKiAgICAgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gZ3VpZDogdW5pcXVlZCBkYXNoYm9hcmQgaWRlbnRpZmllcjxicj4KICogICAgIHtTdHJpbmd9IGxheW91dENvbmZpZzogSG9sZHMgdGhlIHZhcmlvdXMgY29udGFpbmVycyBhbmQgcGFuZXMgb24gYSBkYXNoYm9hcmQgYW5kIHRoZSB3aWRnZXRzIGluc2lkZSBvZiB0aGUgcGFuZXMsIGluY2x1ZGluZyB0aGUgd2lkZ2V0IHN0YXRlcy4KICogICAgIFRoaXMgcGFyYW1ldGVyIHByb3ZpZGVzIGFuIEVYVCBKUyBzdHlsZSBjb25maWd1cmF0aW9uIHVzZWQgdG8gbGF5b3V0IHRoZSBzdXBwb3J0ZWQgcGFuZSB0eXBlcyBpbiBhbiBPV0YgZGFzaGJvYXJkIGFsb25nLiBFYWNoCiAqICAgICBpbnRlcm5hbCBkZWZpbml0aW9uIGNhbiBob2xkIG5lc3RlZCBwYW5lcyBpbiBhbiBpdGVtcyBhcnJheSwgd2lkZ2V0cyBpbiBhIHdpZGdldHMgYXJyYXksIGFuZCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhvc2Ugd2lkZ2V0cyBpbiBhIGRlZmF1bHRWYWx1ZXMgYXJyYXkuCiAqICAgICBQYW5lcyBjYW4gaGF2ZSB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgogKiAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICA8bGk+e1N0cmluZ30geHR5cGU6IGNvbnRhaW5lcnxhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lfGRhc2hib2FyZHNwbGl0dGVyPC9saT4KICogICAgICAgIDxsaT57TnVtYmVyfSBmbGV4OiAxIGlmIGZvciBhIHBhbmU7IDMgZm9yIGEgY29udGFpbmVyPGxpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGh0bWxUZXh0OiBpbiBwaXhlbHMgKGUuZy4sIDMwMHB4KSBvciBwZXJjZW50IChlLmcuLCAxMDAlKSBvciAidmFyaWFibGUiOyB2YWxpZCBpZiBuZXN0ZWQgaW4gYSBob3Jpem9udGFsbHkvdmVydGljYWxseSBzcGxpdCBwYW5lPC9saT4KICogICAgICAgIDxsaT57U3RyaW5nfSBjbHM6IGxlZnR8cmlnaHQgaWYgbmVzdGVkIGluIGEgaG9yaXpvbnRhbGx5IHNwbGl0IHBhbmU7IHRvcHxib3R0b20gaWYgbmVzdGVkIGluIGEgdmVydGljYWxseSBzcGxpdCBwYW5lOyB2Ym94fGhib3ggaWYgeHR5cGUgaXMgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGl0ZW1zOiBhbiBhcnJheSBvZiAyIG5lc3RlZCBwYW5lIGNvbmZpZ3VyYXRpb25zIGFsb25nIHdpdGggYSBwb3NzaWJsZSBkYXNoYm9hcmRzcGxpaXRlciBmb3IgdmJveCBhbmQgaGJveCBjb250YWluZXJzOyBlbXB0eSBvdGhlcndpc2U8L2xpPgogKiAgICAgICAgPGxpPntTdHJpbmd9IHBhbmVUeXBlOiBhY2NvcmRpb25wYW5lfGRlc2t0b3BwYW5lfGZpdHBhbmV8cG9ydGFscGFuZXx0YWJiZWRwYW5lOyB2YWxpZCBpZiB4dHlwZSBpcyBub3QgY29udGFpbmVyPC9saT4KICogICAgICAgIDxsaT57QXJyYXl9IGxheW91dDogdmFsaWQgb25seSBmb3IgY29udGFpbmVyIHh0eXBlLiAgSW5jbHVkZXMgdGhlIGZvbGxvd2luZyBlbGVtZW50czo8L2xpPgogKiAgICAgICAgPHVsIHN0eWxlPSJsaXN0LXN0eWxlLXR5cGU6bm9uZSI+CiAqICAgICAgICAgICA8bGk+e1N0cmluZ30gdHlwZTogdmJveHxoYm94PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSBhbGlnbjogc3RyZXRjaDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntBcnJheX0gd2lkZ2V0czogYXJyYXkgb2Ygd2lkZ2V0IHN0YXRlIG9iamVjdHMuICBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PC9saT4KICogICAgICAgIDx1bCBzdHlsZT0ibGlzdC1zdHlsZS10eXBlOm5vbmUiPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IHdpZGdldEd1aWQ6IHVuaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gd2lkdGg6IHdpZHRoIG9mIHdpZGdldCBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHpJbmRleDogaW4gcGl4ZWxzPC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSByZWdpb246IGNvbnRhaW5pbmcgcmVnaW9uIG9uIGRhc2hib2FyZC4gIERhc2hib2FyZCB0eXBlIHNwZWNpZmljLjwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IHBpbm5lZDogdHJ1ZSBpZiB3aWRnZXQgaXMgcGlubmVkIG9wZW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IGJ1dHRvbklkOiBpZGVudGlmaWVyIG9mIGJ1dHRvbiB0aGF0IG9wZW5zIHdpZGdldDwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2Ygd2lkZ2V0IGluIHBpeGVsczwvbGk+CiAqICAgICAgICAgICA8bGk+e051bWJlcn0gY29sdW1uUG9zOiBwb3NpdGlvbiBvZiB3aWRnZXQgaW4gYSBjb2x1bW48L2xpPgogKiAgICAgICAgICAgPGxpPntTdHJpbmd9IG5hbWU6IHdpZGdldCBuYW1lPC9saT4KICogICAgICAgICAgIDxsaT57TnVtYmVyfSBzdGF0ZVBvc2l0aW9uPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYWN0aXZlOiB0cnVlIGlmIHRoaXMgd2lkZ2V0IGlzIHRoZSBhY3RpdmUgKGhhcyBmb2N1cykgd2lkZ2V0PC9saT4KICogICAgICAgICAgIDxsaT57U3RyaW5nfSB1bmlxdWVJZDogdW5pcXVlIHdpZGdldCBpZGVudGlmaWVyIG9uIGRhc2hib2FyZDwvbGk+CiAqICAgICAgICAgICA8bGk+e0Jvb2xlYW59IG1pbmltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWluaW1pemVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gYnV0dG9uT3BlbmVkOiB0cnVlIGlmIGJ1dHRvbiBsYXVuY2hlZCB3aWRnZXQgaXMgb3BlbmVkPC9saT4KICogICAgICAgICAgIDxsaT57Qm9vbGVhbn0gY29sbGFwc2VkOiB0cnVlIGlmIHdpZGdldCBpcyBjb2xsYXBzZWQ8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntOdW1iZXJ9IHg6IHgtYXhpcyBwb3NpdGlvbiBpbiBwaXhlbHM8L2xpPgogKiAgICAgICAgICAgPGxpPntCb29sZWFufSBtYXhpbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1heGltaXplZDwvbGk+CiAqICAgICAgICA8L3VsPgogKiAgICAgICAgPGxpPntTdHJpbmd9IGRlZmF1bHRTZXR0aW5nczogSlNPTiBzdHJpbmcgb2YgZGVmYXVsdCBzZXR0aW5ncyB3aGljaCB2YXJpZXMgYnkgcGFuZSB0eXBlOyBub3QgdmFsaWQgZm9yIGNvbnRhaW5lcnM8L2xpPgogKiAgICAgPC91bD4KICogICAgIDxicj4KICogPGJyPgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gQ2FsbGJhY2sgdG8gZXhlY3V0ZSBpZiB0aGVyZSBpcyBhbiBlcnJvciAob3B0aW9uYWwsIGEgZGVmYXVsdCBhbGVydCBwcm92aWRlZCkuIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCiAqIEBleGFtcGxlCiAqCiAqIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsKICogICAgIGFsZXJ0KG9iai5yZXN1bHRzKTsKICogICAgIGlmIChvYmoucmVzdWx0cyA+IDApIHsKICogICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5yZXN1bHRzOyBpKyspIHsKICogICAgICAgICAgICAgYWxlcnQob2JqLmRhdGFbaV0ubmFtZSk7CiAqICAgICAgICAgfQogKiAgICAgfQogKiB9OwogKgogKiB2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKICogICAgIGFsZXJ0KGVycm9yKTsKICogfTsKICoKICogT1dGLlByZWZlcmVuY2VzLmZpbmREYXNoYm9hcmRzKHsKICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsCiAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlCiAqIH0pOwogKi8KCi8qKgogKiBAbmFtZSBmaW5kRGFzaGJvYXJkc0J5VHlwZQogKiBAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCiAqIEBkZXByZWNhdGVkIERlcHJlY2F0ZWQgc3RhcnRpbmcgd2l0aCBPV0YgNy4gRGFzaGJvYXJkcyBubyBsb25nZXIgaGF2ZSBhIHNwZWNpZmljIHR5cGUuIFRoaXMgZnVuY3Rpb24gaXMgc3R1YmJlZCAKICogdG8gcmV0dXJuIHN1Y2Nlc3Mgd2l0aCAwIHJlc3VsdHMgdW50aWwgcmVtb3ZhbC4KICogQGRlc2NyaXB0aW9uIFJldHVybnMgYWxsIGRhc2hib2FyZHMgZm9yIHRoZSBsb2dnZWQgaW4gdXNlciBmaWx0ZXJlZCBieSB0aGUgdHlwZSBvZiBkYXNoYm9hcmQuCiAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKICogQHBhcmFtIHtTdHJpbmd9IGNmZy50eXBlIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdHlwZSBvZiBkYXNoYm9hcmQuIElmIHVzaW5nIGJ1aWx0IGluIGRhc2hib2FyZCB0eXBlcywgdGhpcyB3b3VsZCBpbmNsdWRlIGRlc2t0b3AsIHRhYmJlZCwgcG9ydGFsLCBhbmQgYWNjb3JkaW9uLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LgogKiBUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgogKiA8YnI+CiAqICAgICB7Qm9vbGVhbn0gc3VjY2VzczogdHJ1ZSBpZiBkYXNoYm9hcmRzIGZvdW5kPGJyPgogKiAgICAge051bWJlcn0gcmVzdWx0czogbnVtYmVyIG9mIGRhc2hib2FyZHMgZm91bmQ8YnI+CiAqICAgICB7QXJyYXl9IGRhdGE6IGFuIGVtcHR5IGFycmF5PGJyPgogKiAgICAgCiAqIDxicj4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24ob2JqKSB7CiAqICAgICBhbGVydChvYmoucmVzdWx0cyk7CiAqICAgICBpZiAob2JqLnJlc3VsdHMgPiAwKSB7CiAqICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoucmVzdWx0czsgaSsrKSB7CiAqICAgICAgICAgICAgIGFsZXJ0KG9iai5kYXRhW2ldLm5hbWUpOwogKiAgICAgICAgIH0KICogICAgIH0KICogfTsKICoKICogdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CiAqICAgICBhbGVydChlcnJvcik7CiAqIH07CiAqCiAqIE9XRi5QcmVmZXJlbmNlcy5maW5kRGFzaGJvYXJkc0J5VHlwZSh7CiAqICAgICB0eXBlOidkZXNrdG9wJywKICogICAgIG9uU3VjY2VzczpvblN1Y2Nlc3MsCiAqICAgICBvbkZhaWx1cmU6b25GYWlsdXJlCiAqIH0pOwogKi8KCi8qKgoJQGRlc2NyaXB0aW9uIEdldHMgdGhlIHdpZGdldCB3aXRoIHRoZSBzcGVjaWZpZWQgaWQKCUBuYW1lIGdldFdpZGdldAoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7U3RyaW5nfSBjZmcud2lkZ2V0SWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIChub3JtYWxseSBhIGd1aWQpIGZvciB0aGUgd2lkZ2V0LgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBDYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdC4gQ2FsbGJhY2sgaXMgcGFzc2VkIHRoZSBmb2xsb3dpbmcgb2JqZWN0IGFzIGEgcGFyYW1ldGVyOiB7aWQ6TnVtYmVyLCBuYW1lc3BhY2U6U3RyaW5nLCB2YWx1ZTpPYmplY3QsIHBhdGg6U3RyaW5nfQoJVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KCTxicj4KCQl7TnVtYmVyfSBpZDogZGF0YWJhc2UgcGsgaWRlbnRpZmllcjxicj4KCQl7U3RyaW5nfSBuYW1lc3BhY2U6ICJ3aWRnZXQiPGJyPgoJCXtPYmplY3R9IHZhbHVlOiB3aWRnZXQgb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgoJCTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZWRpdGFibGU6IHRydWUgaWYgd2lkZ2V0IGNhbiBiZSBlZGl0ZWQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IHZpc2libGU6IHRydWUgaWYgd2lkZ2V0IGlzIHZpc2libGU8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gcG9zaXRpb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlcklkOiB3aWRnZXQgb3duZXIgaWRlbnRpZmllcjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSB1c2VyUmVhbE5hbWU6IHdpZGdldCBvd25lciBuYW1lPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IG5hbWVzcGFjZTogd2lkZ2V0IG5hbWU8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXJsOiB1cmwgb2Ygd2lkZ2V0IGFwcGxpY2F0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGhlYWRlckljb246IHVybCBvZiB3aWRnZXQgaGVhZGVyIGljb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gaW1hZ2U6IHVybCBvZiB3aWRnZXQgaW1hZ2U8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gc21hbGxJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3Mgc21hbGwgaWNvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBsYXJnZUljb25Vcmw6IHVybCBvZiB3aWRnZXQncyBsYXJnZSBpY29uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHdpZHRoOiB3aWR0aCBvZiB0aGUgd2lkZ2V0IGluIHBpeGVsczxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSBoZWlnaHQ6IGhlaWdodCBvZiB0aGUgd2lkZ2V0IGluIHBpeGVsczxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB4OiB4LWF4aXMgcG9zaXRpb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0geTogeS1heGlzIHBvc2l0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBtaW5pbWl6ZWQ6IHRydWUgaWYgd2lkZ2V0IGlzIG1pbmltaXplZDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gbWF4aW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtYXhpbWl6ZWQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gd2lkZ2V0VmVyc2lvbjogd2lkZ2V0IHZlcnNpb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0FycmF5fSB0YWdzOiBhcnJheSBvZiB0YWcgc3RyaW5nczxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gZGVmaW5pdGlvblZpc2libGU6IHRydWUgaWYgZGVmaW5pdGlvbiBpcyB2aXNpYmxlPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBzaW5nbGV0b246IHRydWUgaWYgd2lkZ2V0IGlzIGEgc2luZ2xldG9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSBiYWNrZ3JvdW5kOiB0cnVlIGlmIHdpZGdldCBydW5zIGluIHRoZSBiYWNrZ3JvdW5kPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gYWxsUmVxdWlyZWQ6IGFycmF5IG9mIGFsbCB3aWRnZXRzIHJlcXVpcmVkIGJ5IHRoaXMgd2lkZ2V0PGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gZGlyZWN0UmVxdWlyZWQ6IGFycmF5IG9mIGFsbCB3aWRnZXRzIGRpcmVjdGx5IHJlcXVpcmVkIGJ5IHRoaXMgd2lkZ2V0PGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gd2lkZ2V0VHlwZXM6IGFycmF5IG9mIHdpZGdldCB0eXBlcyB0aGlzIHdpZGdldCBiZWxvbmdzIHRvPGJyPgoJCTxicj4KCQl7U3RyaW5nfSBwYXRoOiB1bm5pcXVlIHdpZGdldCBpZGVudGlmaWVyPGJyPgoJPGJyPgoJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIENhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpLiBDYWxsYmFjayBwYXJhbWV0ZXIgaXMgYW4gZXJyb3Igc3RyaW5nLgoJCglAZXhhbXBsZQkKdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgewoJaWYgKG9iai52YWx1ZSkgewoJCWFsZXJ0KG9iai52YWx1ZS5uYW1lc3BhY2UpOwoJfQp9OwoKdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CglhbGVydChlcnJvcik7Cn07CgpPV0YuUHJlZmVyZW5jZXMuZ2V0V2lkZ2V0KHsKCXdpZGdldElkOidlYTU0MzVjZi00MDIxLTRmMmEtYmE2OS1kZGU0NTFkMTI1NTEnLAoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCUBkZXNjcmlwdGlvbiBHZXRzIGFsbCB3aWRnZXRzIGZvciBhIGdpdmVuIHVzZXIuCglAbmFtZSBmaW5kV2lkZ2V0cwoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7Qm9vbGVhbn0gW2NmZy51c2VyT25seV0gYm9vbGVhbiBmbGFnIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIHRvIG9ubHkgcmV0dXJuIHdpZGdldHMgYXNzaWduZWQgdG8gdGhlIHVzZXIgKGV4Y2x1ZGluZyB3aWRnZXRzIHRvIHdoaWNoIHRoZSB1c2VyIG9ubHkgaGFzIGFjY2VzcyB2aWEgdGhlaXIgYXNzaWduZWQgZ3JvdXBzKQoJQHBhcmFtIHtPYmplY3R9IFtjZmcuc2VhcmNoUGFyYW1zXSBvYmplY3QgY29udGFpbmluZyBzZWFyY2ggcGFyYW1ldGVycwoJQHBhcmFtIHtTdHJpbmd9IFtjZmcuc2VhcmNoUGFyYW1zLndpZGdldE5hbWVdIG5hbWUgb2Ygd2lkZ2V0ICclJyBhcmUgd2lsZGNhcmRzCglAcGFyYW0ge1N0cmluZ30gW2NmZy5zZWFyY2hQYXJhbXMud2lkZ2V0TmFtZUV4YWN0TWF0Y2hdIHRydWUgb3IgZmFsc2UgdG8gbWF0Y2ggdGhlIG5hbWUgZXhhY3RseS4gZGVmYXVsdHMgdG8gZmFsc2UKCUBwYXJhbSB7U3RyaW5nfSBbY2ZnLnNlYXJjaFBhcmFtcy53aWRnZXRWZXJzaW9uXSB2ZXJzaW9uIG9mIHdpZGdldCAnJScgYXJlIHdpbGRjYXJkcwoJQHBhcmFtIHtTdHJpbmd9IFtjZmcuc2VhcmNoUGFyYW1zLndpZGdldEd1aWRdIGd1aWQgb2Ygd2lkZ2V0ICclJyBhcmUgd2lsZGNhcmRzCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhcHR1cmUgdGhlIHN1Y2Nlc3MgcmVzdWx0LgoJVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIGFycmF5IG9mIG9iamVjdHMgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+Cgk8YnI+CgkJe051bWJlcn0gaWQ6IGRhdGFiYXNlIHBrIGlkZW50aWZpZXI8YnI+CgkJe1N0cmluZ30gbmFtZXNwYWNlOiAid2lkZ2V0Ijxicj4KCQl7T2JqZWN0fSB2YWx1ZTogd2lkZ2V0IG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KCQk8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGVkaXRhYmxlOiB0cnVlIGlmIHdpZGdldCBjYW4gYmUgZWRpdGVkPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tCb29sZWFufSB2aXNpYmxlOiB0cnVlIGlmIHdpZGdldCBpcyB2aXNpYmxlPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHBvc2l0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVzZXJJZDogd2lkZ2V0IG93bmVyIGlkZW50aWZpZXI8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gdXNlclJlYWxOYW1lOiB3aWRnZXQgb3duZXIgbmFtZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBuYW1lc3BhY2U6IHdpZGdldCBuYW1lPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHVybDogdXJsIG9mIHdpZGdldCBhcHBsaWNhdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7U3RyaW5nfSBoZWFkZXJJY29uOiB1cmwgb2Ygd2lkZ2V0IGhlYWRlciBpY29uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IGltYWdlOiB1cmwgb2Ygd2lkZ2V0IGltYWdlPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHNtYWxsSWNvblVybDogdXJsIG9mIHdpZGdldCdzIHNtYWxsIGljb248YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e1N0cmluZ30gbGFyZ2VJY29uVXJsOiB1cmwgb2Ygd2lkZ2V0J3MgbGFyZ2UgaWNvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7TnVtYmVyfSB3aWR0aDogd2lkdGggb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0gaGVpZ2h0OiBoZWlnaHQgb2YgdGhlIHdpZGdldCBpbiBwaXhlbHM8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e051bWJlcn0geDogeC1heGlzIHBvc2l0aW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tOdW1iZXJ9IHk6IHktYXhpcyBwb3NpdGlvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gbWluaW1pemVkOiB0cnVlIGlmIHdpZGdldCBpcyBtaW5pbWl6ZWQ8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IG1heGltaXplZDogdHJ1ZSBpZiB3aWRnZXQgaXMgbWF4aW1pemVkPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tTdHJpbmd9IHdpZGdldFZlcnNpb246IHdpZGdldCB2ZXJzaW9uPGJyPgoJCSZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO3tBcnJheX0gdGFnczogYXJyYXkgb2YgdGFnIHN0cmluZ3M8YnI+CgkJJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7e0Jvb2xlYW59IGRlZmluaXRpb25WaXNpYmxlOiB0cnVlIGlmIGRlZmluaXRpb24gaXMgdmlzaWJsZTxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gc2luZ2xldG9uOiB0cnVlIGlmIHdpZGdldCBpcyBhIHNpbmdsZXRvbjxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7Qm9vbGVhbn0gYmFja2dyb3VuZDogdHJ1ZSBpZiB3aWRnZXQgcnVucyBpbiB0aGUgYmFja2dyb3VuZDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGFsbFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IGRpcmVjdFJlcXVpcmVkOiBhcnJheSBvZiBhbGwgd2lkZ2V0cyBkaXJlY3RseSByZXF1aXJlZCBieSB0aGlzIHdpZGdldDxicj4KCQkmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDt7QXJyYXl9IHdpZGdldFR5cGVzOiBhcnJheSBvZiB3aWRnZXQgdHlwZXMgdGhpcyB3aWRnZXQgYmVsb25ncyB0bzxicj4KCQk8YnI+CgkJe1N0cmluZ30gcGF0aDogdW5uaXF1ZSB3aWRnZXQgaWRlbnRpZmllcjxicj4KCTxicj4KCUBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBjYWxsYmFjayB0byBleGVjdXRlIGlmIHRoZXJlIGlzIGFuIGVycm9yIChvcHRpb25hbCwgYSBkZWZhdWx0IGFsZXJ0IHByb3ZpZGVkKS4gIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdHdvIHBhcmFtZXRlcnM6IGEgZXJyb3IgbWVzc2FnZSBzdHJpbmcsIGFuZCBvcHRpb25hbGx5IGEgc3RhdHVzIGNvZGUKCQoJQGV4YW1wbGUKdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHdpZGdldHMpIHsKCWlmICh3aWRnZXRzLmxlbmd0aCA+IDApIHsKCQlhbGVydCh3aWRnZXRzWzBdLnZhbHVlLm5hbWVzcGFjZSk7Cgl9Cn07Cgp2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IsIHN0YXR1cykgewoJYWxlcnQoZXJyb3IpOwp9OwoKT1dGLlByZWZlcmVuY2VzLmZpbmRXaWRnZXRzKHsKCW9uU3VjY2VzczpvblN1Y2Nlc3MsCglvbkZhaWx1cmU6b25GYWlsdXJlCn0pOwoqLwoKLyoqCglAZGVzY3JpcHRpb24gU2F2ZXMgY2hhbmdlcyB0byBleGlzdGluZyB3aWRnZXRzCglAbmFtZSB1cGRhdGVBbmREZWxldGVXaWRnZXRzCglAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtBcnJheX0gY2ZnLndpZGdldHNUb1VwZGF0ZSBhcnJheSBvZiBKU09OIG9iamVjdHMgY29udGFpbmluZyB0aGUgd2lkZ2V0IGd1aWQgYW5kIGRhdGEgdG8gYmUgdXBkYXRlZAoJQHBhcmFtIHtBcnJheX0gY2ZnLndpZGdldEd1aWRzVG9EZWxldGUgYXJyYXkgb2YgZ3VpZHMgb2Ygd2lkZ2V0cyB0byBiZSBkZWxldGVkCglAcGFyYW0ge0Jvb2xlYW59IGNmZy51cGRhdGVPcmRlciBmbGFnIHRvIHVwZGF0ZSBvcmRlcgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBjYXB0dXJlIHRoZSBzdWNjZXNzIHJlc3VsdAoJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIGNhbGxiYWNrIHRvIGV4ZWN1dGUgaWYgdGhlcmUgaXMgYW4gZXJyb3IgKG9wdGlvbmFsLCBhIGRlZmF1bHQgYWxlcnQgcHJvdmlkZWQpCiAqLwoKLyoqCglAZGVzY3JpcHRpb24gUmV0cmlldmVzIHRoZSB1c2VyIHByZWZlcmVuY2UgZm9yIHRoZSBwcm92aWRlZCBuYW1lIGFuZCBuYW1lc3BhY2UKCUBuYW1lIGdldFVzZXJQcmVmZXJlbmNlCglAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lc3BhY2UgVGhlIG5hbWVzcGFjZSBvZiB0aGUgcmVxdWVzdGVkIHVzZXIgcHJlZmVyZW5jZQoJQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSByZXF1ZXN0ZWQgdXNlciBwcmVmZXJlbmNlCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBpcyBzdWNjZXNzZnVsbHkgcmV0cmlldmVkIGZyb20KCXRoZSBkYXRhYmFzZS4gIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBzaW5nbGUgYXJndW1lbnQsIHdoaWNoIGlzIGEgSlNPTiBvYmplY3QuICBJZiBhIHByZWZlcmVuY2UgaXMgZm91bmQsIHRoZQoJY29tcGxldGUgSlNPTiBzdHJ1Y3R1cmUgYXMgc2hvd24gYmVsb3cgd2lsbCBiZSByZXR1cm5lZC4gIElmIGl0IGlzIG5vdCBmb3VuZCB0aGlzIGZ1bmN0aW9uIGJlIHBhc3NlZCBhbiBlbXB0eSBKU09OIG9iamVjdC4KCUBleGFtcGxlClRoZSBmb2xsb3dpbmcgaXMgYW4gZXhhbXBsZSBvZiBhIGNvbXBsZXRlIHByZWZlcmVuY2Ugb2JqZWN0IHBhc3NlZCB0byB0aGUgb25TdWNjZXNzCmZ1bmN0aW9uOgp7CgkidmFsdWUiOiJ0cnVlIiwKCSJwYXRoIjoibWlsaXRhcnlUaW1lIiwKCSJ1c2VyIjoKCXsKCQkidXNlcklkIjoidGVzdEFkbWluMSIKCX0sCgkibmFtZXNwYWNlIjoiY29tLm15Y29tcGFueS5Bbm5vdW5jaW5nQ2xvY2siCn0KCQlAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhpcyBwYXJhbWV0ZXIgaXMgb3B0aW9uYWwuIElmIHRoaXMgZnVuY3Rpb24gaXMgbm90IHNwZWNpZmllZCBhIGRlZmF1bHQgZXJyb3IgCgkJbWVzc2FnZSB3aWxsIGJlIGRpc3BsYXllZC5UaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBpZiBhbiBlcnJvciBvY2N1cnMgb24gcHJlZmVyZW5jZSByZXRyaWV2YWwuICBJdCBpcyBub3QKCQljYWxsZWQgaWYgdGhlIHByZWZlcmVuY2UgaXMgc2ltcGx5IG1pc3NpbmcuCgkJVGhpcyBmdW5jdGlvbiBzaG91bGQgYWNjZXB0IHR3byBhcmd1bWVudHM6PGJyPgoJCTxicj4KCQllcnJvcjogU3RyaW5nPGJyPgoJCVRoZSBlcnJvciBtZXNzYWdlPGJyPgoJCTxicj4KCQlTdGF0dXM6IFRoZSBudW1lcmljIEhUVFAgU3RhdHVzIGNvZGUgKGlmIGFwcGxpY2FibGUpPGJyPgoJCTQwMTogWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyBlbnRpdHkuPGJyPgoJCTUwMDogQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC48YnI+CgkJNDA0OiBUaGUgdXNlciBwcmVmZXJlbmNlIHdhcyBub3QgZm91bmQuPGJyPgoJCTQwMDogVGhlIHJlcXVlc3RlZCBlbnRpdHkgZmFpbGVkIHRvIHBhc3MgdmFsaWRhdGlvbi48YnI+CgkJCgkJQGV4YW1wbGUKVGhlIGZvbGxvd2luZyBzaG93cyBob3cgdG8gbWFrZSBhIGNhbGwgdG8gZ2V0VXNlclByZWZlcmVuY2U6CmZ1bmN0aW9uIG9uU3VjY2VzcyhwcmVmKXsKCWFsZXJ0KE96b25lLnV0aWwudG9TdHJpbmcocHJlZi52YWx1ZSkpOwp9CgpmdW5jdGlvbiBvbkZhaWx1cmUoZXJyb3Isc3RhdHVzKXsKCWFsZXJ0KCdFcnJvciAnICsgZXJyb3IpOwoJYWxlcnQoc3RhdHVzKTsKfQoKLy8gVGhlIGZvbGxvd2luZyBjb2RlIGNhbGxzIGdldFVzZXJQcmVmZXJlbmNlIHdpdGggdGhlIGFib3ZlIGRlZmluZWQgb25TdWNjZXNzIGFuZAovLyBvbkZhaWx1cmUgY2FsbGJhY2tzLgpPV0YuUHJlZmVyZW5jZXMuZ2V0VXNlclByZWZlcmVuY2UoewoJbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLCAKCW5hbWU6J0ZpcnN0IFByZXNpZGVudCcsCglvblN1Y2Nlc3M6b25TdWNjZXNzLCAKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCUBkZXNjcmlwdGlvbiBDaGVja3MgZm9yIHRoZSBleGlzdGVuY2Ugb2YgYSB1c2VyIHByZWZlcmVuY2UgZm9yIGEgZ2l2ZW4gbmFtZXNwYWNlIGFuZCBuYW1lCglAbmFtZSBkb2VzVXNlclByZWZlcmVuY2VFeGlzdAoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugb2YgdGhlIHJlcXVlc3RlZCB1c2VyCglAcGFyYW0ge1N0cmluZ30gY2ZnLm5hbWUgVGhlIG5hbWUgb2YgdGhlIHJlcXVlc3RlZCB1c2VyCglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcub25TdWNjZXNzIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBpZiBhIHByZWZlcmVuY2Ugc3VjY2Vzc2Z1bGx5IHJldHVybiBmcm9tIHRoZSBkYXRhYmFzZS4KCVRoaXMgbWV0aG9kIGlzIHBhc3NlZCBhbiBvYmplY3QgaGF2aW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczo8YnI+Cgk8YnI+CgkJe051bWJlcn0gc3RhdHVzQ29kZTogc3RhdHVzIGNvZGU8YnI+CgkJe0Jvb2xlYW59IHByZWZlcmVuY2VFeGlzdDogdHJ1ZSBpZiBwcmVmZXJlbmNlIGV4aXN0czxicj4KCTxicj4KICAgIEBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgaWYgdGhlcmUgd2FzCiAgICBhbiBlcnJvciBsb29raW5nIHVwIHRoZSBwcmVmZXJlbmNlLiAgVGhpcyBmdW5jdGlvbiBpcyA8ZW0+bm90PC9lbT4gY2FsbGVkCiAgICBpZiB0aGUgcHJlZmVyZW5jZSBzaW1wbHkgZG9lcyBub3QgZXhpc3QKCQoJQGV4YW1wbGUKdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgewoJaWYgKG9iai5zdGF0dXNDb2RlID0gMjAwKSB7CgkJYWxlcnQob2JqLnByZWZlcmVuY2VFeGlzdCk7Cgl9Cn07Cgp2YXIgb25GYWlsdXJlID0gZnVuY3Rpb24oZXJyb3IpIHsKCWFsZXJ0KGVycm9yKTsKfTsKCk9XRi5QcmVmZXJlbmNlcy5kb2VzVXNlclByZWZlcmVuY2VFeGlzdCh7CgluYW1lc3BhY2U6J2Zvby5iYXIuMCcsCgluYW1lOid0ZXN0IHBhdGggZW50cnkgMCcsCglvblN1Y2Nlc3M6b25TdWNjZXNzLAoJb25GYWlsdXJlOm9uRmFpbHVyZQp9KTsKKi8KCi8qKgoJQGRlc2NyaXB0aW9uIHJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyIGxvZ2dlZCBpbnRvIHRoZSBzeXN0ZW0KCUBuYW1lIGdldEN1cnJlbnRVc2VyCglAbWV0aG9kT2YgT1dGLlByZWZlcmVuY2VzCgoJQHBhcmFtIHtPYmplY3R9IGNmZyBjb25maWcgb2JqZWN0IHNlZSBiZWxvdyBmb3IgcHJvcGVydGllcwoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZm9yIGEgc3VjY2Vzc2Z1bCByZXRyaWV2YWwgb2YgdGhlIHVzZXIgbG9nZ2VkIGluLgoJVGhpcyBtZXRob2QgaXMgcGFzc2VkIGFuIG9iamVjdCBoYXZpbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOjxicj4KCTxicj4KCQl7U3RyaW5nfSBjdXJyZW50VXNlck5hbWU6IHVzZXIgbmFtZTxicj4KCQl7U3RyaW5nfSBjdXJyZW50VXNlcjogdXNlciByZWFsIG5hbWU8YnI+CgkJe0RhdGV9IGN1cnJlbnRVc2VyUHJldkxvZ2luOiBwcmV2aW91cyBsb2dpbiBkYXRlPGJyPgoJCXtOdW1iZXJ9IGN1cnJlbnRJZDogZGF0YWJhc2UgcGsgaW5kZXg8YnI+Cgk8YnI+CglAcGFyYW0ge0Z1bmN0aW9ufSBjZmcuW29uRmFpbHVyZV0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN5c3RlbSBpcyB1bmFibGUgdG8gcmV0cmlldmUgdGhlIGN1cnJlbnQgdXNlciBsb2dnZWQgaW4uIENhbGxiYWNrIHBhcmFtZXRlciBpcyBhbiBlcnJvciBzdHJpbmcuCgkKCUBleGFtcGxlCnZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihvYmopIHsKCWlmIChvYmopIHsKCQlhbGVydChvYmouY3VycmVudFVzZXIpOwoJfQp9OwoKdmFyIG9uRmFpbHVyZSA9IGZ1bmN0aW9uKGVycm9yKSB7CglhbGVydChlcnJvcik7Cn07CgpPV0YuUHJlZmVyZW5jZXMuZ2V0Q3VycmVudFVzZXIoewoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCUBkZXNjcmlwdGlvbiBGb3IgcmV0cmlldmluZyB0aGUgT1dGIHN5c3RlbSBzZXJ2ZXIgdmVyc2lvbgoJQG5hbWUgZ2V0U2VydmVyVmVyc2lvbgoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGZvciBzdWNjZXNzZnVsbHkgcmV0cmlldmluZyB0aGUgc2VydmVyIHZlcnNpb24gb2YgdGhlIE9XRiBzeXN0ZW0uCglUaGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gb2JqZWN0IGhhdmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6PGJyPgoJPGJyPgoJCXtTdHJpbmd9IHtzZXJ2ZXJWZXJzaW9uOiBzZXJ2ZXIgdmVyc2lvbjxicj4KCTxicj4KCUBwYXJhbSB7RnVuY3Rpb259IFtjZmcub25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgc3lzdGVtIGZhaWxzIHRvIHJldHJpZXZlIHRoZSBzZXJ2ZXIgdmVyc2lvbiBvZiB0aGUgT1dGIHN5c3RlbS4gQ2FsbGJhY2sgcGFyYW1ldGVyIGlzIGFuIGVycm9yIHN0cmluZy4KCUBleGFtcGxlCgkKdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKG9iaikgewoJaWYgKG9iaikgewoJCWFsZXJ0KG9iai5zZXJ2ZXJWZXJzaW9uKTsKCX0KfTsKCnZhciBvbkZhaWx1cmUgPSBmdW5jdGlvbihlcnJvcikgewoJYWxlcnQoZXJyb3IpOwp9OwoKT1dGLlByZWZlcmVuY2VzLmdldFNlcnZlclZlcnNpb24oewoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiovCgovKioKCUBkZXNjcmlwdGlvbiBDcmVhdGVzIG9yIHVwZGF0ZXMgYSB1c2VyIHByZWZlcmVuY2UgZm9yIHRoZSBwcm92aWRlZCBuYW1lc3BhY2UgYW5kIG5hbWUuCglAbmFtZSBzZXRVc2VyUHJlZmVyZW5jZQoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlICBUaGUgbmFtZXNwYWNlIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZSBUaGUgbmFtZSBvZiB0aGUgdXNlciBwcmVmZXJlbmNlCglAcGFyYW0ge1N0cmluZ30gY2ZnLnZhbHVlICBUaGUgdmFsdWUgb2YgdGhlIHVzZXIgcHJlZmVyZW5jZS4gVGhlIHZhbHVlIGNhbiBiZSBhbnkgc3RyaW5nIGluY2x1ZGluZyBKU09OLgoJQHBhcmFtIHtGdW5jdGlvbn0gY2ZnLm9uU3VjY2VzcyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGlmIHRoZSB1c2VyIHByZWZlcmVuY2UgaXMgc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgaW4KCXRoZSBkYXRhYmFzZS4KCQoJQGV4YW1wbGUKVGhlIGZvbGxvd2luZyBpcyBhbiBleGFtcGxlIG9mIGEgY29tcGxldGUgcHJlZmVyZW5jZSBvYmplY3QgcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MgZnVuY3Rpb246CnsKCSJ2YWx1ZSI6InRydWUiLAoJInBhdGgiOiJtaWxpdGFyeVRpbWUiLAoJInVzZXIiOiB7CgkJInVzZXJJZCI6InRlc3RBZG1pbjEiCgl9LAoJIm5hbWVzcGFjZSI6ImNvbS5teWNvbXBhbnkuQW5ub3VuY2luZ0Nsb2NrIgp9CgkJQHBhcmFtIHtGdW5jdGlvbn0gW2NmZy5vbkZhaWx1cmVdIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaWYgdGhlIHVzZXIgcHJlZmVyZW5jZSBjYW5ub3QgYmUgc3RvcmVkIGluIHRoZSBkYXRhYmFzZS4KCQlJZiB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBzcGVjaWZpZWQgYSBkZWZhdWx0IGVycm9yIG1lc3NhZ2Ugd2lsbCBiZSBkaXNwbGF5ZWQuIFRoaXMgZnVuY3Rpb24gaXMgcGFzc2VkCgkJYmFjayB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6PGJyPgoJCTxicj4KCQllcnJvcjogU3RyaW5nPGJyPgoJCVRoZSBlcnJvciBtZXNzYWdlPGJyPgoJCTxicj4KCQlTdGF0dXM6IFRoZSBIVFRQIFN0YXR1cyBjb2RlPGJyPgoJCTQwMTogWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyBlbnRpdHkuPGJyPgoJCTUwMDogQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC48YnI+CgkJNDA0OiBUaGUgcmVxdWVzdGVkIGVudGl0eSB3YXMgbm90IGZvdW5kLjxicj4KCQk0MDA6IFRoZSByZXF1ZXN0ZWQgZW50aXR5IGZhaWxlZCB0byBwYXNzIHZhbGlkYXRpb24uPGJyPgoJCQoJCUBleGFtcGxlCmZ1bmN0aW9uIG9uU3VjY2VzcyhwcmVmKXsKCWFsZXJ0KHByZWYudmFsdWUpOwp9CgpmdW5jdGlvbiBvbkZhaWx1cmUoZXJyb3Isc3RhdHVzKXsKCWFsZXJ0KCdFcnJvciAnICsgZXJyb3IpOwoJYWxlcnQoc3RhdHVzKTsKfQoKdmFyIHRleHQgPSAnR2VvcmdlIFdhc2hpbmd0b24nOwpPV0YuUHJlZmVyZW5jZXMuc2V0VXNlclByZWZlcmVuY2UoewoJbmFtZXNwYWNlOidjb20uY29tcGFueS53aWRnZXQnLAoJbmFtZTonRmlyc3QgUHJlc2lkZW50JywKCXZhbHVlOnRleHQsCglvblN1Y2Nlc3M6b25TdWNjZXNzLAoJb25GYWlsdXJlOm9uRmFpbHVyZQp9KTsKKi8KCi8qKgoJRGVsZXRlcyBhIHVzZXIgcHJlZmVyZW5jZSB3aXRoIHRoZSBwcm92aWRlZCBuYW1lc3BhY2UgYW5kIG5hbWUuCglAbmFtZSBkZWxldGVVc2VyUHJlZmVyZW5jZQoJQG1ldGhvZE9mIE9XRi5QcmVmZXJlbmNlcwoKCUBwYXJhbSB7T2JqZWN0fSBjZmcgY29uZmlnIG9iamVjdCBzZWUgYmVsb3cgZm9yIHByb3BlcnRpZXMKCUBwYXJhbSB7U3RyaW5nfSBjZmcubmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugb2YgdGhlIHVzZXIgcHJlZmVyZW5jZQoJQHBhcmFtIHtTdHJpbmd9IGNmZy5uYW1lIFRoZSBuYW1lIG9mIHRoZSB1c2VyIHByZWZlcmVuY2UKCUBwYXJhbSB7RnVuY3Rpb259IGNmZy5vblN1Y2Nlc3MgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpZiB0aGUgdXNlciBwcmVmZXJlbmNlIGlzIHN1Y2Nlc3NmdWxseSBkZWxldGVkIGZyb20gdGhlIGRhdGFiYXNlLgoJQGV4YW1wbGUKVGhlIGZvbGxvd2luZyBpcyBhbiBleGFtcGxlIG9mIGEgY29tcGxldGUgcHJlZmVyZW5jZSBvYmplY3QgcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MKZnVuY3Rpb246Cgp7CgkidmFsdWUiOiJ0cnVlIiwKCSJwYXRoIjoibWlsaXRhcnlUaW1lIiwKCSJ1c2VyIjoKCXsKCQkidXNlcklkIjoidGVzdEFkbWluMSIKCX0sCgkibmFtZXNwYWNlIjoiY29tLm15Y29tcGFueS5Bbm5vdW5jaW5nQ2xvY2siCn0KCQlAcGFyYW0ge0Z1bmN0aW9ufSBbY2ZnLm9uRmFpbHVyZV0gVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpZiB0aGUgdXNlciBwcmVmZXJlbmNlIGNhbm5vdCBiZSBkZWxldGVkIGZyb20gdGhlCgkJZGF0YWJhc2Ugb3IgaWYgdGhlIHByZWZlcmVuY2UgZG9lcyBub3QgZXhpc3QuIElmIHRoaXMgZnVuY3Rpb24gaXMgbm90IHNwZWNpZmllZCBhIGRlZmF1bHQgZXJyb3IgbWVzc2FnZSB3aWxsIGJlCgkJZGlzcGxheWVkLiBUaGlzIGZ1bmN0aW9uIGlzIHBhc3NlZCBiYWNrIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczogPGJyPgoJCTxicj4KCQllcnJvcjogU3RyaW5nIDxicj4KCQlUaGUgZXJyb3IgbWVzc2FnZSA8YnI+CgkJPGJyPgoJCVN0YXR1czogVGhlIEhUVFAgU3RhdHVzIGNvZGU8YnI+CgkJPGJyPgoJCTQwMTogWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyBlbnRpdHkuPGJyPgoJCTUwMDogQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC48YnI+CgkJNDA0OiBUaGUgdXNlciBwcmVmZXJlbmNlIHdhcyBub3QgZm91bmQuPGJyPgoJCTQwMDogVGhlIHJlcXVlc3RlZCBlbnRpdHkgZmFpbGVkIHRvIHBhc3MgdmFsaWRhdGlvbi4gPGJyPgoJCTxicj4KCQlAZXhhbXBsZQpmdW5jdGlvbiBvblN1Y2Nlc3MocHJlZil7CglhbGVydChwcmVmLnZhbHVlKTsKfQoKZnVuY3Rpb24gb25GYWlsdXJlKGVycm9yLHN0YXR1cyl7CglhbGVydCgnRXJyb3IgJyArIGVycm9yKTsKCWFsZXJ0KHN0YXR1cyk7Cn0KCk9XRi5QcmVmZXJlbmNlcy5kZWxldGVVc2VyUHJlZmVyZW5jZSh7CgluYW1lc3BhY2U6J2NvbS5jb21wYW55LndpZGdldCcsCgluYW1lOidGaXJzdCBQcmVzaWRlbnQnLAoJb25TdWNjZXNzOm9uU3VjY2VzcywKCW9uRmFpbHVyZTpvbkZhaWx1cmUKfSk7CiAqLwoKLyoqCglUaGlzIG1ldGhvZCBpbmZvcm1zIGEgd2lkZ2V0IGRldmVsb3BlciBpZiB0aGVpciB3aWRnZXQgaXMgcnVubmluZyBmcm9tIHRoZSBPV0Ygb3IgZnJvbSBhIGRpcmVjdCBVUkwgY2FsbC4KCUBuYW1lIGlzUnVubmluZ0luT1dGCglAbWV0aG9kT2YgT1dGLlV0aWwKCglAcmV0dXJucyAgYm9vbGVhbiB0cnVlIGlmIHRoZSB3aWRnZXQgaXMgaW5zaWRlIE9XRiwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KCi8qKgogQG5hbWUgaXNJbkNvbnRhaW5lcgogQG1ldGhvZE9mIE9XRi5VdGlsCiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1ldGhvZCBpbmZvcm1zIGEgd2lkZ2V0IGRldmVsb3BlciBpZiB0aGVpciB3aWRnZXQgaXMgcnVubmluZwogKiBpbiBhIENvbnRhaW5lciwgbGlrZSBPV0YKICoKICogQHJldHVybnMgIGJvb2xlYW4gdHJ1ZSBpZiB0aGUgd2lkZ2V0IGlzIGluc2lkZSBhIGNvbnRhaW5lciwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKi8KCi8qKgoJUmV0dXJucyBhIGdsb2JhbGx5IHVuaXF1ZSBpZGVudGlmaWVyIChndWlkKS4KCUBuYW1lIGd1aWQKCUBtZXRob2RPZiBPV0YuVXRpbAoKCUByZXR1cm5zICBib29sZWFuIHRydWUgaWYgdGhlIHdpZGdldCBpcyBpbnNpZGUgT1dGLCBmYWxzZSBvdGhlcndpc2UuCiAqLwoKLyoqCglUaGlzIG1ldGhvZCByZXR1cm5zIGZsYXNoL2ZsZXggZG9tIGVsZW1lbnQgZnJvbSBkb20uCglAbmFtZSBnZXRGbGFzaEFwcAoJQG1ldGhvZE9mIE9XRi5VdGlsCgkKCUBwYXJhbSB7U3RyaW5nfSBpZCBpZCBvZiB0aGUgZmxleCBkb20gZWxlbWVudAoKCUByZXR1cm5zICBmbGFzaC9mbGV4IG9iamVjdCBmcm9tIGRvbQogKi8KCiAvKioKCUJhc2ljIGxvZ2dpbmcgY2FwYWJpbGl0eSAtIG1lYW50IHRvIGJlIGNhbGxlZCBieSBvdGhlciBtZXRob2RzIHdoaWNoIHRyYW5zZm9ybSBvciB2YWxpZGF0ZSBkYXRhLgoJQG5hbWUgbG9nTWV0cmljCglAbWV0aG9kT2YgT1dGLk1ldHJpY3MKCUBzaW5jZSBPV0YgMy44LjAKCglAcGFyYW0ge1N0cmluZ30gdXNlcklkCglAcGFyYW0ge1N0cmluZ30gdXNlck5hbWUKCUBwYXJhbSB7U3RyaW5nfSBtZXRyaWNTaXRlIElkZW50aWZpZXIsIHBvdGVudGlhbGx5IFVSTCwgZm9yIHNvdXJjZSBvZiBtZXRyaWMgLSB0eXBpY2FsbHkgT1dGIGluc3RhbmNlCglAcGFyYW0ge1N0cmluZ30gY29tcG9uZW50TmFtZSAgICAKCUBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnRJZCAKCUBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnRJbnN0YW5jZUlkCglAcGFyYW0ge1N0cmluZ30gbWV0cmljVHlwZUlkIFN0cmluZyBkZXNjcmliaW5nIG1ldHJpYyAtIHJlY29tbWVuZCBwYWNrYWdlIG5hbWUgY29uc3RydWN0CglAcGFyYW0ge1N0cmluZ30gbWV0cmljRGF0YSBBbnkgYWRkaXRpb25hbCBkYXRhIGZvciBtZXRyaWMgLSBkbyBhbnkgbmVjZXNzYXJ5IHZhbGlkYXRpb24gYXBwcm9wcmlhdGUgdG8gbWV0cmljVHlwZUlkIGJlZm9yZSBzZW5kaW5nIHRocm91Z2ggCiAqLwoKLyoqCiAqIEBkZXNjcmlwdGlvbiBMb2dzIGEgc2V0IG9mIG1ldHJpY3MgdG8gdGhlIHNlcnZlciBhbGwgYXQgb25jZS4gIEFsbAogKiBtZXRyaWNzIHBhc3NlZCBpbnRvIGEgY2FsbCB0byB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgbG9nZ2VkIGluIGEgc2luZ2xlCiAqIEhUVFAgcmVxdWVzdCwgaW5zdGVhZCBvZiBvbmUgcmVxdWVzdCBwZXIgbWV0cmljCiAqIEBuYW1lIGxvZ0JhdGNoTWV0cmljcwogKiBAbWV0aG9kT2YgT1dGLk1ldHJpY3MKICogQHNpbmNlIE9XRiA2LjAKICoKICogQHBhcmFtIHtBcnJheX0gbWV0cmljcyAKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0udXNlcklkCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLnVzZXJOYW1lCiAqIEBwYXJhbSB7TnVtYmVyfSBtZXRyaWNzWypdLm1ldHJpY1RpbWUgVGhlIHRpbWUgYXQgd2hpY2ggaXMgbWV0cmljIHdhcyBjb2xsZWN0ZWQgKGluIFVOSVggdGltZSkKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uc2l0ZSBJZGVudGlmaWVyLCBwb3RlbnRpYWxseSBVUkwsIGZvciBzb3VyY2Ugb2YgbWV0cmljIC0gdHlwaWNhbGx5IE9XRiBpbnN0YW5jZQogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS5jb21wb25lbnQKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0uY29tcG9uZW50SWQgCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLmluc3RhbmNlSWQKICogQHBhcmFtIHtTdHJpbmd9IG1ldHJpY3NbKl0ubWV0cmljVHlwZUlkIFN0cmluZyBkZXNjcmliaW5nIG1ldHJpYyAtIHJlY29tbWVuZCBwYWNrYWdlIG5hbWUgY29uc3RydWN0CiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRyaWNzWypdLndpZGdldERhdGEgQW55IGFkZGl0aW9uYWwgZGF0YSBmb3IgbWV0cmljIC0gZG8gYW55IG5lY2Vzc2FyeSB2YWxpZGF0aW9uIGFwcHJvcHJpYXRlIHRvIG1ldHJpY1R5cGVJZCBiZWZvcmUgc2VuZGluZyB0aHJvdWdoIAogKiBAcGFyYW0ge1N0cmluZ30gbWV0cmljc1sqXS51c2VyQWdlbnQgU2hvdWxkIGJlIHNldCB0byB0aGUgdXNlci1hZ2VudCBzdHJpbmcgb2YgdGhlIGJyb3dzZXIKICovCgovKioKCUxvZyB2aWV3IG9mIHdpZGdldCAtIHNlZSBjYWxscyBpbiBkYXNoYm9hcmRzLgoJQG5hbWUgbG9nV2lkZ2V0UmVuZGVyCglAbWV0aG9kT2YgT1dGLk1ldHJpY3MKCUBzaW5jZSBPV0YgMy44LjAKCQoJQHBhcmFtIHtTdHJpbmd9IHVzZXJJZCAgICAgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgdXNlcklkCglAcGFyYW0ge1N0cmluZ30gdXNlck5hbWUgICAtIHNlZSBPem9uZS5tZXRyaWNzLmxvZ01ldHJpYyB1c2VyTmFtZQoJQHBhcmFtIHtTdHJpbmd9IG1ldHJpY1NpdGUgLSBzZWUgT3pvbmUubWV0cmljcy5sb2dNZXRyaWMgbWV0cmljU2l0ZQoJQHBhcmFtIHtPYmplY3R9IHdpZGdldCAgIAogKi8KCi8qKgoJR2V0IGEgbG9nZ2VyIGJ5IG5hbWUsIGlmIHRoZSBsb2dnZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gY3JlYXRlZCBpdCB3aWxsIGJlIGNyZWF0ZWQuCglAbmFtZSBnZXRMb2dnZXIKCUBtZXRob2RPZiBPV0YuTG9nCglAc2luY2UgT1dGIDMuOC4wCglAcGFyYW0ge1N0cmluZ30gbG9nZ2VyTmFtZQogKi8KCi8qKgoJRW5hYmxlL0Rpc2FibGUgbG9nZ2luZyBmb3IgdGhlIE9XRiBhcHBsaWNhdGlvbi4KCUBuYW1lIHNldEVuYWJsZWQKCUBtZXRob2RPZiBPV0YuTG9nCglAc2luY2UgT1dGIDMuOC4wCglAcGFyYW0ge0Jvb2xlYW59IGVuYWJsZWQgdHJ1ZSB3aWxsIGVuYWJsZSBsb2dnaW5nIGZhbHNlIHdpbGwgZGlzYWJsZQogKi8KCi8qKgoJR2V0IE9XRidzIGRlZmF1bHQgbG9nZ2VyCglAbmFtZSBnZXREZWZhdWx0TG9nZ2VyCglAbWV0aG9kT2YgT1dGLkxvZwoJQHNpbmNlIE9XRiAzLjguMAogKi8KCi8qKgoJTGF1bmNoIHRoZSBsb2cgd2luZG93IHBvcC11cCwgdGhpcyB3aWxsIHJlLWxhdW5jaCB0aGUgd2luZG93IGluIHRoZSBldmVudCBpdCBoYXMgYmVlbiBjbG9zZWQuCglAbmFtZSBsYXVuY2hQb3B1cEFwcGVuZGVyCglAbWV0aG9kT2YgT1dGLkxvZwoJQHNpbmNlIE9XRiAzLjguMAogKi8KCi8qKgoJR2V0cyB0aGUgbGFuZ3VhZ2UgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgdXNlZCBieSBPV0YuCglAbmFtZSBnZXRMYW5ndWFnZQoJQG1ldGhvZE9mIE9XRi5MYW5nCgoJQHJldHVybnMge1N0cmluZ30gUmV0dXJucyB0aGUgSVNPIDYzOS0xIGxhbmd1YWdlIGNvZGUgZm9yIHRoZSBsYW5ndWFnZSB0aGF0IGlzIGN1cnJlbnRseSBiZWluZyB1c2VkIGJ5IE9XRi4KICovCgppZiAoIU96b25lLmRpc2FibGVXaWRnZXRJbml0KSB7DQoNCg0KICAgIG93ZmRvam8uYWRkT25Mb2FkKGZ1bmN0aW9uKCkgew0KDQogICAgICAgIC8vY2FsYyBwYWdlbG9hZCB0aW1lDQogICAgICAgIE96b25lLnV0aWwucGFnZUxvYWQuYWZ0ZXJMb2FkID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCiAgICAgICAgT3pvbmUudXRpbC5wYWdlTG9hZC5jYWxjTG9hZFRpbWUoKTsNCg0KICAgICAgICBpZihPem9uZS51dGlsLmlzSW5Db250YWluZXIoKSkgew0KICAgICAgICAgICAgT1dGLl9pbml0KHdpbmRvdywgZG9jdW1lbnQpOw0KICAgICAgICB9DQoNCiAgICB9KTsNCn0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:31:59 GMT",
                    "Content-Length": "1033182",
                    "Date": "Fri, 07 Nov 2014 21:31:59 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}