{
    "url": "http://localhost:9999/NicolasCARPi/elabftw/js/jeditable/tests/testrunner.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.href</b> via the following statement:<ul><li>location.href = location.href.match(/^(.+?)(\\?.*)?$/)[1] + \"?\" + encodeURIComponent(jQuery.trim(target.text()));</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/NicolasCARPi/elabftw/js/jeditable/tests/testrunner.js",
                "path": "/NicolasCARPi/elabftw/js/jeditable/tests/testrunner.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9OaWNvbGFzQ0FSUGkvZWxhYmZ0dy9qcy9qZWRpdGFibGUvdGVzdHMvdGVzdHJ1bm5lci5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTA1MDMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjI6MzE6MjEgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIyOjMxOjE4IEdNVA0KDQovKgogKiBRVW5pdCAtIGpRdWVyeSB1bml0IHRlc3RydW5uZXIKICogCiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vUVVuaXQKICoKICogQ29weXJpZ2h0IChjKSAyMDA4IEpvaG4gUmVzaWcsIErDtnJuIFphZWZmZXJlcgogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgKE1JVC1MSUNFTlNFLnR4dCkKICogYW5kIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy4KICoKICogJElkOiB0ZXN0cnVubmVyLmpzIDU4MjcgMjAwOC0wOC0xMyAxNzoxNDo0OFogam9lcm4uemFlZmZlcmVyICQKICovCgp2YXIgX2NvbmZpZyA9IHsKCWZpeHR1cmU6IG51bGwsCglUZXN0OiBbXSwKCXN0YXRzOiB7CgkJYWxsOiAwLAoJCWJhZDogMAoJfSwKCXF1ZXVlOiBbXSwKCWJsb2NraW5nOiB0cnVlLAoJdGltZW91dDogbnVsbCwKCWV4cGVjdGVkOiBudWxsLAoJY3VycmVudE1vZHVsZTogbnVsbCwKCWFzeW5jVGltZW91dDogMiAvLyBzZWNvbmRzIGZvciBhc3luYyB0aW1lb3V0Cn07CgpfY29uZmlnLmZpbHRlcnMgPSBsb2NhdGlvbi5zZWFyY2gubGVuZ3RoID4gMSAmJiAvL3Jlc3RyaWN0IG1vZHVsZXMvdGVzdHMgYnkgZ2V0IHBhcmFtZXRlcnMKCQlqUXVlcnkubWFwKCBsb2NhdGlvbi5zZWFyY2guc2xpY2UoMSkuc3BsaXQoJyYnKSwgZGVjb2RlVVJJQ29tcG9uZW50ICk7Cgp2YXIgaXNMb2NhbCA9ICEhKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PSAnZmlsZTonKTsKCmpRdWVyeShmdW5jdGlvbigpIHsKCWpRdWVyeSgnI3VzZXJBZ2VudCcpLmh0bWwobmF2aWdhdG9yLnVzZXJBZ2VudCk7CglydW5UZXN0KCk7CQp9KTsKCmZ1bmN0aW9uIHN5bmNocm9uaXplKGNhbGxiYWNrKSB7CglfY29uZmlnLnF1ZXVlW19jb25maWcucXVldWUubGVuZ3RoXSA9IGNhbGxiYWNrOwoJaWYoIV9jb25maWcuYmxvY2tpbmcpIHsKCQlwcm9jZXNzKCk7Cgl9Cn0KCmZ1bmN0aW9uIHByb2Nlc3MoKSB7Cgl3aGlsZShfY29uZmlnLnF1ZXVlLmxlbmd0aCAmJiAhX2NvbmZpZy5ibG9ja2luZykgewoJCXZhciBjYWxsID0gX2NvbmZpZy5xdWV1ZVswXTsKCQlfY29uZmlnLnF1ZXVlID0gX2NvbmZpZy5xdWV1ZS5zbGljZSgxKTsKCQljYWxsKCk7Cgl9Cn0KCmZ1bmN0aW9uIHN0b3AoYWxsb3dGYWlsdXJlKSB7CglfY29uZmlnLmJsb2NraW5nID0gdHJ1ZTsKCXZhciBoYW5kbGVyID0gYWxsb3dGYWlsdXJlID8gc3RhcnQgOiBmdW5jdGlvbigpIHsKCQlvayggZmFsc2UsICJUZXN0IHRpbWVkIG91dCIgKTsKCQlzdGFydCgpOwoJfTsKCS8vIERpc2FibGVkLCBjYXVzZWQgdG9vIG1hbnkgcmFuZG9tIGVycm9ycwoJLy9fY29uZmlnLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGhhbmRsZXIsIF9jb25maWcuYXN5bmNUaW1lb3V0ICogMTAwMCk7Cn0KZnVuY3Rpb24gc3RhcnQoKSB7CgkvLyBBIHNsaWdodCBkZWxheSwgdG8gYXZvaWQgYW55IGN1cnJlbnQgY2FsbGJhY2tzCglzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJaWYoX2NvbmZpZy50aW1lb3V0KQoJCQljbGVhclRpbWVvdXQoX2NvbmZpZy50aW1lb3V0KTsKCQlfY29uZmlnLmJsb2NraW5nID0gZmFsc2U7CgkJcHJvY2VzcygpOwoJfSwgMTMpOwp9CgpmdW5jdGlvbiB2YWxpZFRlc3QoIG5hbWUgKSB7Cgl2YXIgZmlsdGVycyA9IF9jb25maWcuZmlsdGVyczsKCWlmKCAhZmlsdGVycyApCgkJcmV0dXJuIHRydWU7CgoJdmFyIGkgPSBmaWx0ZXJzLmxlbmd0aCwKCQlydW4gPSBmYWxzZTsKCXdoaWxlKCBpLS0gKXsKCQl2YXIgZmlsdGVyID0gZmlsdGVyc1tpXSwKCQkJbm90ID0gZmlsdGVyLmNoYXJBdCgwKSA9PSAnISc7CgkJaWYoIG5vdCApIAoJCQlmaWx0ZXIgPSBmaWx0ZXIuc2xpY2UoMSk7CgkJaWYoIG5hbWUuaW5kZXhPZihmaWx0ZXIpICE9IC0xICkKCQkJcmV0dXJuICFub3Q7CgkJaWYoIG5vdCApCgkJCXJ1biA9IHRydWU7Cgl9CglyZXR1cm4gcnVuOwp9CgpmdW5jdGlvbiBydW5UZXN0KCkgewoJX2NvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoJdmFyIHN0YXJ0ZWQgPSArbmV3IERhdGU7CglfY29uZmlnLmZpeHR1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmlubmVySFRNTDsKCV9jb25maWcuYWpheFNldHRpbmdzID0galF1ZXJ5LmFqYXhTZXR0aW5nczsKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCWpRdWVyeSgnPHAgaWQ9InRlc3RyZXN1bHQiIGNsYXNzPSJyZXN1bHQiPicpLmh0bWwoWydUZXN0cyBjb21wbGV0ZWQgaW4gJywKCQkJK25ldyBEYXRlIC0gc3RhcnRlZCwgJyBtaWxsaXNlY29uZHMuPGJyLz4nLAoJCQknPHNwYW4gY2xhc3M9ImJhZCI+JywgX2NvbmZpZy5zdGF0cy5iYWQsICc8L3NwYW4+IHRlc3RzIG9mIDxzcGFuIGNsYXNzPSJhbGwiPicsIF9jb25maWcuc3RhdHMuYWxsLCAnPC9zcGFuPiBmYWlsZWQuPC9wPiddCgkJCS5qb2luKCcnKSkKCQkJLmFwcGVuZFRvKCJib2R5Iik7CgkJalF1ZXJ5KCIjYmFubmVyIikuYWRkQ2xhc3MoX2NvbmZpZy5zdGF0cy5iYWQgPyAiZmFpbCIgOiAicGFzcyIpOwoJfSk7Cn0KCmZ1bmN0aW9uIHRlc3QobmFtZSwgY2FsbGJhY2ssIG5vd2FpdCkgewoJaWYoX2NvbmZpZy5jdXJyZW50TW9kdWxlKQoJCW5hbWUgPSBfY29uZmlnLmN1cnJlbnRNb2R1bGUgKyAiIG1vZHVsZTogIiArIG5hbWU7CgkJCglpZiAoICF2YWxpZFRlc3QobmFtZSkgKQoJCXJldHVybjsKCQkKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCV9jb25maWcuVGVzdCA9IFtdOwoJCXRyeSB7CgkJCWNhbGxiYWNrKCk7CgkJfSBjYXRjaChlKSB7CgkJCWlmKCB0eXBlb2YgY29uc29sZSAhPSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLmVycm9yICYmIGNvbnNvbGUud2FybiApIHsKCQkJCWNvbnNvbGUuZXJyb3IoIlRlc3QgIiArIG5hbWUgKyAiIGRpZWQsIGV4Y2VwdGlvbiBhbmQgdGVzdCBmb2xsb3dzIik7CgkJCQljb25zb2xlLmVycm9yKGUpOwoJCQkJY29uc29sZS53YXJuKGNhbGxiYWNrLnRvU3RyaW5nKCkpOwoJCQl9CgkJCV9jb25maWcuVGVzdC5wdXNoKCBbIGZhbHNlLCAiRGllZCBvbiB0ZXN0ICMiICsgKF9jb25maWcuVGVzdC5sZW5ndGgrMSkgKyAiOiAiICsgZS5tZXNzYWdlIF0gKTsKCQl9Cgl9KTsKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCXRyeSB7CgkJCXJlc2V0KCk7CgkJfSBjYXRjaChlKSB7CgkJCWlmKCB0eXBlb2YgY29uc29sZSAhPSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLmVycm9yICYmIGNvbnNvbGUud2FybiApIHsKCQkJCWNvbnNvbGUuZXJyb3IoInJlc2V0KCkgZmFpbGVkLCBmb2xsb3dpbmcgVGVzdCAiICsgbmFtZSArICIsIGV4Y2VwdGlvbiBhbmQgcmVzZXQgZm4gZm9sbG93cyIpOwoJCQkJY29uc29sZS5lcnJvcihlKTsKCQkJCWNvbnNvbGUud2FybihyZXNldC50b1N0cmluZygpKTsKCQkJfQoJCX0KCQkKCQkvLyBkb24ndCBvdXRwdXQgcGF1c2UgdGVzdHMKCQlpZihub3dhaXQpIHJldHVybjsKCQkKCQlpZihfY29uZmlnLmV4cGVjdGVkICYmIF9jb25maWcuZXhwZWN0ZWQgIT0gX2NvbmZpZy5UZXN0Lmxlbmd0aCkgewoJCQlfY29uZmlnLlRlc3QucHVzaCggWyBmYWxzZSwgIkV4cGVjdGVkICIgKyBfY29uZmlnLmV4cGVjdGVkICsgIiBhc3NlcnRpb25zLCBidXQgIiArIF9jb25maWcuVGVzdC5sZW5ndGggKyAiIHdlcmUgcnVuIiBdICk7CgkJfQoJCV9jb25maWcuZXhwZWN0ZWQgPSBudWxsOwoJCQoJCXZhciBnb29kID0gMCwgYmFkID0gMDsKCQl2YXIgb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvbCIpOwoJCW9sLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJdmFyIGxpID0gIiIsIHN0YXRlID0gInBhc3MiOwoJCWZvciAoIHZhciBpID0gMDsgaSA8IF9jb25maWcuVGVzdC5sZW5ndGg7IGkrKyApIHsKCQkJdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGkiKTsKCQkJbGkuY2xhc3NOYW1lID0gX2NvbmZpZy5UZXN0W2ldWzBdID8gInBhc3MiIDogImZhaWwiOwoJCQlsaS5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoX2NvbmZpZy5UZXN0W2ldWzFdKSApOwoJCQlvbC5hcHBlbmRDaGlsZCggbGkgKTsKCQkJCgkJCV9jb25maWcuc3RhdHMuYWxsKys7CgkJCWlmICggIV9jb25maWcuVGVzdFtpXVswXSApIHsKCQkJCXN0YXRlID0gImZhaWwiOwoJCQkJYmFkKys7CgkJCQlfY29uZmlnLnN0YXRzLmJhZCsrOwoJCQl9IGVsc2UgZ29vZCsrOwoJCX0KCQoJCXZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7CgkJbGkuY2xhc3NOYW1lID0gc3RhdGU7CgkKCQl2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIpOwoJCWIuaW5uZXJIVE1MID0gbmFtZSArICIgPGIgc3R5bGU9J2NvbG9yOmJsYWNrOyc+KDxiIGNsYXNzPSdmYWlsJz4iICsgYmFkICsgIjwvYj4sIDxiIGNsYXNzPSdwYXNzJz4iICsgZ29vZCArICI8L2I+LCAiICsgX2NvbmZpZy5UZXN0Lmxlbmd0aCArICIpPC9iPiI7CgkJYi5vbmNsaWNrID0gZnVuY3Rpb24oKXsKCQkJdmFyIG4gPSB0aGlzLm5leHRTaWJsaW5nOwoJCQlpZiAoIGpRdWVyeS5jc3MoIG4sICJkaXNwbGF5IiApID09ICJub25lIiApCgkJCQluLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQllbHNlCgkJCQluLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJfTsKCQlqUXVlcnkoYikuZGJsY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsKCQkJdmFyIHRhcmdldCA9IGpRdWVyeShldmVudC50YXJnZXQpLmZpbHRlcigic3Ryb25nIikuY2xvbmUoKTsKCQkJaWYgKCB0YXJnZXQubGVuZ3RoICkgewoJCQkJdGFyZ2V0LmNoaWxkcmVuKCkucmVtb3ZlKCk7CgkJCQlsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24uaHJlZi5tYXRjaCgvXiguKz8pKFw/LiopPyQvKVsxXSArICI/IiArIGVuY29kZVVSSUNvbXBvbmVudChqUXVlcnkudHJpbSh0YXJnZXQudGV4dCgpKSk7CgkJCX0KCQl9KTsKCQlsaS5hcHBlbmRDaGlsZCggYiApOwoJCWxpLmFwcGVuZENoaWxkKCBvbCApOwoJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlc3RzIikuYXBwZW5kQ2hpbGQoIGxpICk7CQkKCX0pOwp9CgovLyBjYWxsIG9uIHN0YXJ0IG9mIG1vZHVsZSB0ZXN0IHRvIHByZXBlbmQgbmFtZSB0byBhbGwgdGVzdHMKZnVuY3Rpb24gbW9kdWxlKG1vZHVsZU5hbWUpIHsKCV9jb25maWcuY3VycmVudE1vZHVsZSA9IG1vZHVsZU5hbWU7Cn0KCi8qKgogKiBTcGVjaWZ5IHRoZSBudW1iZXIgb2YgZXhwZWN0ZWQgYXNzZXJ0aW9ucyB0byBndXJhbnRlZSB0aGF0IGZhaWxlZCB0ZXN0IChubyBhc3NlcnRpb25zIGFyZSBydW4gYXQgYWxsKSBkb24ndCBzbGlwIHRocm91Z2guCiAqLwpmdW5jdGlvbiBleHBlY3QoYXNzZXJ0cykgewoJX2NvbmZpZy5leHBlY3RlZCA9IGFzc2VydHM7Cn0KCi8qKgogKiBSZXNldHMgdGhlIHRlc3Qgc2V0dXAuIFVzZWZ1bCBmb3IgdGVzdHMgdGhhdCBtb2RpZnkgdGhlIERPTS4KICovCmZ1bmN0aW9uIHJlc2V0KCkgewoJalF1ZXJ5KCIjbWFpbiIpLmh0bWwoIF9jb25maWcuZml4dHVyZSApOwoJalF1ZXJ5LmV2ZW50Lmdsb2JhbCA9IHt9OwoJalF1ZXJ5LmFqYXhTZXR0aW5ncyA9IGpRdWVyeS5leHRlbmQoe30sIF9jb25maWcuYWpheFNldHRpbmdzKTsKfQoKLyoqCiAqIEFzc2VydHMgdHJ1ZS4KICogQGV4YW1wbGUgb2soIGpRdWVyeSgiYSIpLnNpemUoKSA+IDUsICJUaGVyZSBtdXN0IGJlIGF0IGxlYXN0IDUgYW5jaG9ycyIgKTsKICovCmZ1bmN0aW9uIG9rKGEsIG1zZykgewoJX2NvbmZpZy5UZXN0LnB1c2goIFsgISFhLCBtc2cgXSApOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IHR3byBhcnJheXMgYXJlIHRoZSBzYW1lCiAqLwpmdW5jdGlvbiBpc1NldChhLCBiLCBtc2cpIHsKCXZhciByZXQgPSB0cnVlOwoJaWYgKCBhICYmIGIgJiYgYS5sZW5ndGggIT0gdW5kZWZpbmVkICYmIGEubGVuZ3RoID09IGIubGVuZ3RoICkgewoJCWZvciAoIHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKysgKQoJCQlpZiAoIGFbaV0gIT0gYltpXSApCgkJCQlyZXQgPSBmYWxzZTsKCX0gZWxzZQoJCXJldCA9IGZhbHNlOwoJaWYgKCAhcmV0ICkKCQlfY29uZmlnLlRlc3QucHVzaCggWyByZXQsIG1zZyArICIgZXhwZWN0ZWQ6ICIgKyBzZXJpYWxBcnJheShiKSArICIgcmVzdWx0OiAiICsgc2VyaWFsQXJyYXkoYSkgXSApOwoJZWxzZSAKCQlfY29uZmlnLlRlc3QucHVzaCggWyByZXQsIG1zZyBdICk7Cn0KCi8qKgogKiBBc3NlcnRzIHRoYXQgdHdvIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQKICovCmZ1bmN0aW9uIGlzT2JqKGEsIGIsIG1zZykgewoJdmFyIHJldCA9IHRydWU7CgkKCWlmICggYSAmJiBiICkgewoJCWZvciAoIHZhciBpIGluIGEgKQoJCQlpZiAoIGFbaV0gIT0gYltpXSApCgkJCQlyZXQgPSBmYWxzZTsKCgkJZm9yICggaSBpbiBiICkKCQkJaWYgKCBhW2ldICE9IGJbaV0gKQoJCQkJcmV0ID0gZmFsc2U7Cgl9IGVsc2UKCQlyZXQgPSBmYWxzZTsKCiAgICBfY29uZmlnLlRlc3QucHVzaCggWyByZXQsIG1zZyBdICk7Cn0KCmZ1bmN0aW9uIHNlcmlhbEFycmF5KCBhICkgewoJdmFyIHIgPSBbXTsKCQoJaWYgKCBhICYmIGEubGVuZ3RoICkKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB2YXIgc3RyID0gYVtpXS5ub2RlTmFtZTsKICAgICAgICAgICAgaWYgKCBzdHIgKSB7CiAgICAgICAgICAgICAgICBzdHIgPSBzdHIudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmICggYVtpXS5pZCApCiAgICAgICAgICAgICAgICAgICAgc3RyICs9ICIjIiArIGFbaV0uaWQ7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgc3RyID0gYVtpXTsKICAgICAgICAgICAgci5wdXNoKCBzdHIgKTsKICAgICAgICB9CgoJcmV0dXJuICJbICIgKyByLmpvaW4oIiwgIikgKyAiIF0iOwp9CgpmdW5jdGlvbiBmbGF0TWFwKGEsIGJsb2NrKSB7Cgl2YXIgcmVzdWx0ID0gW107CgkkLmVhY2goYSwgZnVuY3Rpb24oKSB7CgkJdmFyIHggPSBibG9jay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCWlmICh4ICE9PSBmYWxzZSkKCQkJcmVzdWx0LnB1c2goeCk7Cgl9KQoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gc2VyaWFsT2JqZWN0KCBhICkgewoJcmV0dXJuICJ7ICIgKyBmbGF0TWFwKGEsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKCQlyZXR1cm4ga2V5ICsgIjogIiArIHZhbHVlOwoJfSkuam9pbigiLCAiKSArICIgfSI7Cn0KCmZ1bmN0aW9uIGNvbXBhcmUoYSwgYiwgbXNnKSB7Cgl2YXIgcmV0ID0gdHJ1ZTsKCWlmICggYSAmJiBiICYmIGEubGVuZ3RoICE9IHVuZGVmaW5lZCAmJiBhLmxlbmd0aCA9PSBiLmxlbmd0aCApIHsKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrICkKCQkJZm9yKHZhciBrZXkgaW4gYVtpXSkgewoJCQkJaWYgKGFbaV1ba2V5XS5jb25zdHJ1Y3RvciA9PSBBcnJheSkgewoJCQkJCWZvciAodmFyIGFycmF5S2V5IGluIGFbaV1ba2V5XSkgewoJCQkJCQlpZiAoYVtpXVtrZXldW2FycmF5S2V5XSAhPSBiW2ldW2tleV1bYXJyYXlLZXldKSB7CgkJCQkJCQlyZXQgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0gZWxzZSBpZiAoYVtpXVtrZXldICE9IGJbaV1ba2V5XSkgewoJCQkJCXJldCA9IGZhbHNlCgkJCQl9CgkJCX0KCX0gZWxzZQoJCXJldCA9IGZhbHNlOwoJb2soIHJldCwgbXNnICsgIiBleHBlY3RlZDogIiArIHNlcmlhbEFycmF5KGIpICsgIiByZXN1bHQ6ICIgKyBzZXJpYWxBcnJheShhKSApOwp9CgpmdW5jdGlvbiBjb21wYXJlMihhLCBiLCBtc2cpIHsKCXZhciByZXQgPSB0cnVlOwoJaWYgKCBhICYmIGIgKSB7CgkJZm9yKHZhciBrZXkgaW4gYSkgewoJCQlpZiAoYVtrZXldLmNvbnN0cnVjdG9yID09IEFycmF5KSB7CgkJCQlmb3IgKHZhciBhcnJheUtleSBpbiBhW2tleV0pIHsKCQkJCQlpZiAoYVtrZXldW2FycmF5S2V5XSAhPSBiW2tleV1bYXJyYXlLZXldKSB7CgkJCQkJCXJldCA9IGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIGlmIChhW2tleV0gIT0gYltrZXldKSB7CgkJCQlyZXQgPSBmYWxzZQoJCQl9CgkJfQoJCWZvcihrZXkgaW4gYikgewoJCQlpZiAoYltrZXldLmNvbnN0cnVjdG9yID09IEFycmF5KSB7CgkJCQlmb3IgKHZhciBhcnJheUtleSBpbiBiW2tleV0pIHsKCQkJCQlpZiAoYVtrZXldW2FycmF5S2V5XSAhPSBiW2tleV1bYXJyYXlLZXldKSB7CgkJCQkJCXJldCA9IGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIGlmIChhW2tleV0gIT0gYltrZXldKSB7CgkJCQlyZXQgPSBmYWxzZQoJCQl9CgkJfQoJfSBlbHNlCgkJcmV0ID0gZmFsc2U7CglvayggcmV0LCBtc2cgKyAiIGV4cGVjdGVkOiAiICsgc2VyaWFsT2JqZWN0KGIpICsgIiByZXN1bHQ6ICIgKyBzZXJpYWxPYmplY3QoYSkgKTsKfQoKLyoqCiAqIFJldHVybnMgYW4gYXJyYXkgb2YgZWxlbWVudHMgd2l0aCB0aGUgZ2l2ZW4gSURzLCBlZy4KICogQGV4YW1wbGUgcSgibWFpbiIsICJmb28iLCAiYmFyIikKICogQHJlc3VsdCBbPGRpdiBpZD0ibWFpbiI+LCA8c3BhbiBpZD0iZm9vIj4sIDxpbnB1dCBpZD0iYmFyIj5dCiAqLwpmdW5jdGlvbiBxKCkgewoJdmFyIHIgPSBbXTsKCWZvciAoIHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKyApCgkJci5wdXNoKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggYXJndW1lbnRzW2ldICkgKTsKCXJldHVybiByOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IGEgc2VsZWN0IG1hdGNoZXMgdGhlIGdpdmVuIElEcwogKiBAZXhhbXBsZSB0KCJDaGVjayBmb3Igc29tZXRoaW5nIiwgIi8vW2FdIiwgWyJmb28iLCAiYmFhciJdKTsKICogQHJlc3VsdCByZXR1cm5zIHRydWUgaWYgIi8vW2FdIiByZXR1cm4gdHdvIGVsZW1lbnRzIHdpdGggdGhlIElEcyAnZm9vJyBhbmQgJ2JhYXInCiAqLwpmdW5jdGlvbiB0KGEsYixjKSB7Cgl2YXIgZiA9IGpRdWVyeShiKTsKCXZhciBzID0gIiI7Cglmb3IgKCB2YXIgaSA9IDA7IGkgPCBmLmxlbmd0aDsgaSsrICkKCQlzICs9IChzICYmICIsIikgKyAnIicgKyBmW2ldLmlkICsgJyInOwoJaXNTZXQoZiwgcS5hcHBseShxLGMpLCBhICsgIiAoIiArIGIgKyAiKSIpOwp9CgovKioKICogQWRkIHJhbmRvbSBudW1iZXIgdG8gdXJsIHRvIHN0b3AgSUUgZnJvbSBjYWNoaW5nCiAqCiAqIEBleGFtcGxlIHVybCgiZGF0YS90ZXN0Lmh0bWwiKQogKiBAcmVzdWx0ICJkYXRhL3Rlc3QuaHRtbD8xMDUzODM1ODQyODk0MyIKICoKICogQGV4YW1wbGUgdXJsKCJkYXRhL3Rlc3QucGhwP2Zvbz1iYXIiKQogKiBAcmVzdWx0ICJkYXRhL3Rlc3QucGhwP2Zvbz1iYXImMTA1MzgzNTgzNDU1NTQiCiAqLwpmdW5jdGlvbiB1cmwodmFsdWUpIHsKCXJldHVybiB2YWx1ZSArICgvXD8vLnRlc3QodmFsdWUpID8gIiYiIDogIj8iKSArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgIiIgKyBwYXJzZUludChNYXRoLnJhbmRvbSgpKjEwMDAwMCk7Cn0KCi8qKgogKiBDaGVja3MgdGhhdCB0aGUgZmlyc3QgdHdvIGFyZ3VtZW50cyBhcmUgZXF1YWwsIHdpdGggYW4gb3B0aW9uYWwgbWVzc2FnZS4KICogUHJpbnRzIG91dCBib3RoIGFjdHVhbCBhbmQgZXhwZWN0ZWQgdmFsdWVzLgogKgogKiBQcmVmZXJlZCB0byBvayggYWN0dWFsID09IGV4cGVjdGVkLCBtZXNzYWdlICkKICoKICogQGV4YW1wbGUgZXF1YWxzKCAkLmZvcm1hdCgiUmVjZWl2ZWQgezB9IGJ5dGVzLiIsIDIpLCAiUmVjZWl2ZWQgMiBieXRlcy4iICk7CiAqCiAqIEBwYXJhbSBPYmplY3QgYWN0dWFsCiAqIEBwYXJhbSBPYmplY3QgZXhwZWN0ZWQKICogQHBhcmFtIFN0cmluZyBtZXNzYWdlIChvcHRpb25hbCkKICovCmZ1bmN0aW9uIGVxdWFscyhhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7Cgl2YXIgcmVzdWx0ID0gZXhwZWN0ZWQgPT0gYWN0dWFsOwoJbWVzc2FnZSA9IG1lc3NhZ2UgfHwgKHJlc3VsdCA/ICJva2F5IiA6ICJmYWlsZWQiKTsKCV9jb25maWcuVGVzdC5wdXNoKCBbIHJlc3VsdCwgcmVzdWx0ID8gbWVzc2FnZSArICI6ICIgKyBleHBlY3RlZCA6IG1lc3NhZ2UgKyAiIGV4cGVjdGVkOiAiICsgZXhwZWN0ZWQgKyAiIGFjdHVhbDogIiArIGFjdHVhbCBdICk7Cn0KCi8qKgogKiBUcmlnZ2VyIGFuIGV2ZW50IG9uIGFuIGVsZW1lbnQuCiAqCiAqIEBleGFtcGxlIHRyaWdnZXJFdmVudCggZG9jdW1lbnQuYm9keSwgImNsaWNrIiApOwogKgogKiBAcGFyYW0gRE9NRWxlbWVudCBlbGVtCiAqIEBwYXJhbSBTdHJpbmcgdHlwZQogKi8KZnVuY3Rpb24gdHJpZ2dlckV2ZW50KCBlbGVtLCB0eXBlLCBldmVudCApIHsKCWlmICggalF1ZXJ5LmJyb3dzZXIubW96aWxsYSB8fCBqUXVlcnkuYnJvd3Nlci5vcGVyYSApIHsKCQlldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpOwoJCWV2ZW50LmluaXRNb3VzZUV2ZW50KHR5cGUsIHRydWUsIHRydWUsIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldywKCQkJMCwgMCwgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpOwoJCWVsZW0uZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCX0gZWxzZSBpZiAoIGpRdWVyeS5icm93c2VyLm1zaWUgKSB7CgkJZWxlbS5maXJlRXZlbnQoIm9uIit0eXBlKTsKCX0KfQo=",
                "body": "LyoKICogUVVuaXQgLSBqUXVlcnkgdW5pdCB0ZXN0cnVubmVyCiAqIAogKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1FVbml0CiAqCiAqIENvcHlyaWdodCAoYykgMjAwOCBKb2huIFJlc2lnLCBKw7ZybiBaYWVmZmVyZXIKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpCiAqIGFuZCBHUEwgKEdQTC1MSUNFTlNFLnR4dCkgbGljZW5zZXMuCiAqCiAqICRJZDogdGVzdHJ1bm5lci5qcyA1ODI3IDIwMDgtMDgtMTMgMTc6MTQ6NDhaIGpvZXJuLnphZWZmZXJlciAkCiAqLwoKdmFyIF9jb25maWcgPSB7CglmaXh0dXJlOiBudWxsLAoJVGVzdDogW10sCglzdGF0czogewoJCWFsbDogMCwKCQliYWQ6IDAKCX0sCglxdWV1ZTogW10sCglibG9ja2luZzogdHJ1ZSwKCXRpbWVvdXQ6IG51bGwsCglleHBlY3RlZDogbnVsbCwKCWN1cnJlbnRNb2R1bGU6IG51bGwsCglhc3luY1RpbWVvdXQ6IDIgLy8gc2Vjb25kcyBmb3IgYXN5bmMgdGltZW91dAp9OwoKX2NvbmZpZy5maWx0ZXJzID0gbG9jYXRpb24uc2VhcmNoLmxlbmd0aCA+IDEgJiYgLy9yZXN0cmljdCBtb2R1bGVzL3Rlc3RzIGJ5IGdldCBwYXJhbWV0ZXJzCgkJalF1ZXJ5Lm1hcCggbG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpLnNwbGl0KCcmJyksIGRlY29kZVVSSUNvbXBvbmVudCApOwoKdmFyIGlzTG9jYWwgPSAhISh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT0gJ2ZpbGU6Jyk7CgpqUXVlcnkoZnVuY3Rpb24oKSB7CglqUXVlcnkoJyN1c2VyQWdlbnQnKS5odG1sKG5hdmlnYXRvci51c2VyQWdlbnQpOwoJcnVuVGVzdCgpOwkKfSk7CgpmdW5jdGlvbiBzeW5jaHJvbml6ZShjYWxsYmFjaykgewoJX2NvbmZpZy5xdWV1ZVtfY29uZmlnLnF1ZXVlLmxlbmd0aF0gPSBjYWxsYmFjazsKCWlmKCFfY29uZmlnLmJsb2NraW5nKSB7CgkJcHJvY2VzcygpOwoJfQp9CgpmdW5jdGlvbiBwcm9jZXNzKCkgewoJd2hpbGUoX2NvbmZpZy5xdWV1ZS5sZW5ndGggJiYgIV9jb25maWcuYmxvY2tpbmcpIHsKCQl2YXIgY2FsbCA9IF9jb25maWcucXVldWVbMF07CgkJX2NvbmZpZy5xdWV1ZSA9IF9jb25maWcucXVldWUuc2xpY2UoMSk7CgkJY2FsbCgpOwoJfQp9CgpmdW5jdGlvbiBzdG9wKGFsbG93RmFpbHVyZSkgewoJX2NvbmZpZy5ibG9ja2luZyA9IHRydWU7Cgl2YXIgaGFuZGxlciA9IGFsbG93RmFpbHVyZSA/IHN0YXJ0IDogZnVuY3Rpb24oKSB7CgkJb2soIGZhbHNlLCAiVGVzdCB0aW1lZCBvdXQiICk7CgkJc3RhcnQoKTsKCX07CgkvLyBEaXNhYmxlZCwgY2F1c2VkIHRvbyBtYW55IHJhbmRvbSBlcnJvcnMKCS8vX2NvbmZpZy50aW1lb3V0ID0gc2V0VGltZW91dChoYW5kbGVyLCBfY29uZmlnLmFzeW5jVGltZW91dCAqIDEwMDApOwp9CmZ1bmN0aW9uIHN0YXJ0KCkgewoJLy8gQSBzbGlnaHQgZGVsYXksIHRvIGF2b2lkIGFueSBjdXJyZW50IGNhbGxiYWNrcwoJc2V0VGltZW91dChmdW5jdGlvbigpewoJCWlmKF9jb25maWcudGltZW91dCkKCQkJY2xlYXJUaW1lb3V0KF9jb25maWcudGltZW91dCk7CgkJX2NvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoJCXByb2Nlc3MoKTsKCX0sIDEzKTsKfQoKZnVuY3Rpb24gdmFsaWRUZXN0KCBuYW1lICkgewoJdmFyIGZpbHRlcnMgPSBfY29uZmlnLmZpbHRlcnM7CglpZiggIWZpbHRlcnMgKQoJCXJldHVybiB0cnVlOwoKCXZhciBpID0gZmlsdGVycy5sZW5ndGgsCgkJcnVuID0gZmFsc2U7Cgl3aGlsZSggaS0tICl7CgkJdmFyIGZpbHRlciA9IGZpbHRlcnNbaV0sCgkJCW5vdCA9IGZpbHRlci5jaGFyQXQoMCkgPT0gJyEnOwoJCWlmKCBub3QgKSAKCQkJZmlsdGVyID0gZmlsdGVyLnNsaWNlKDEpOwoJCWlmKCBuYW1lLmluZGV4T2YoZmlsdGVyKSAhPSAtMSApCgkJCXJldHVybiAhbm90OwoJCWlmKCBub3QgKQoJCQlydW4gPSB0cnVlOwoJfQoJcmV0dXJuIHJ1bjsKfQoKZnVuY3Rpb24gcnVuVGVzdCgpIHsKCV9jb25maWcuYmxvY2tpbmcgPSBmYWxzZTsKCXZhciBzdGFydGVkID0gK25ldyBEYXRlOwoJX2NvbmZpZy5maXh0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKS5pbm5lckhUTUw7CglfY29uZmlnLmFqYXhTZXR0aW5ncyA9IGpRdWVyeS5hamF4U2V0dGluZ3M7CglzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQlqUXVlcnkoJzxwIGlkPSJ0ZXN0cmVzdWx0IiBjbGFzcz0icmVzdWx0Ij4nKS5odG1sKFsnVGVzdHMgY29tcGxldGVkIGluICcsCgkJCStuZXcgRGF0ZSAtIHN0YXJ0ZWQsICcgbWlsbGlzZWNvbmRzLjxici8+JywKCQkJJzxzcGFuIGNsYXNzPSJiYWQiPicsIF9jb25maWcuc3RhdHMuYmFkLCAnPC9zcGFuPiB0ZXN0cyBvZiA8c3BhbiBjbGFzcz0iYWxsIj4nLCBfY29uZmlnLnN0YXRzLmFsbCwgJzwvc3Bhbj4gZmFpbGVkLjwvcD4nXQoJCQkuam9pbignJykpCgkJCS5hcHBlbmRUbygiYm9keSIpOwoJCWpRdWVyeSgiI2Jhbm5lciIpLmFkZENsYXNzKF9jb25maWcuc3RhdHMuYmFkID8gImZhaWwiIDogInBhc3MiKTsKCX0pOwp9CgpmdW5jdGlvbiB0ZXN0KG5hbWUsIGNhbGxiYWNrLCBub3dhaXQpIHsKCWlmKF9jb25maWcuY3VycmVudE1vZHVsZSkKCQluYW1lID0gX2NvbmZpZy5jdXJyZW50TW9kdWxlICsgIiBtb2R1bGU6ICIgKyBuYW1lOwoJCQoJaWYgKCAhdmFsaWRUZXN0KG5hbWUpICkKCQlyZXR1cm47CgkJCglzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQlfY29uZmlnLlRlc3QgPSBbXTsKCQl0cnkgewoJCQljYWxsYmFjaygpOwoJCX0gY2F0Y2goZSkgewoJCQlpZiggdHlwZW9mIGNvbnNvbGUgIT0gInVuZGVmaW5lZCIgJiYgY29uc29sZS5lcnJvciAmJiBjb25zb2xlLndhcm4gKSB7CgkJCQljb25zb2xlLmVycm9yKCJUZXN0ICIgKyBuYW1lICsgIiBkaWVkLCBleGNlcHRpb24gYW5kIHRlc3QgZm9sbG93cyIpOwoJCQkJY29uc29sZS5lcnJvcihlKTsKCQkJCWNvbnNvbGUud2FybihjYWxsYmFjay50b1N0cmluZygpKTsKCQkJfQoJCQlfY29uZmlnLlRlc3QucHVzaCggWyBmYWxzZSwgIkRpZWQgb24gdGVzdCAjIiArIChfY29uZmlnLlRlc3QubGVuZ3RoKzEpICsgIjogIiArIGUubWVzc2FnZSBdICk7CgkJfQoJfSk7CglzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQl0cnkgewoJCQlyZXNldCgpOwoJCX0gY2F0Y2goZSkgewoJCQlpZiggdHlwZW9mIGNvbnNvbGUgIT0gInVuZGVmaW5lZCIgJiYgY29uc29sZS5lcnJvciAmJiBjb25zb2xlLndhcm4gKSB7CgkJCQljb25zb2xlLmVycm9yKCJyZXNldCgpIGZhaWxlZCwgZm9sbG93aW5nIFRlc3QgIiArIG5hbWUgKyAiLCBleGNlcHRpb24gYW5kIHJlc2V0IGZuIGZvbGxvd3MiKTsKCQkJCWNvbnNvbGUuZXJyb3IoZSk7CgkJCQljb25zb2xlLndhcm4ocmVzZXQudG9TdHJpbmcoKSk7CgkJCX0KCQl9CgkJCgkJLy8gZG9uJ3Qgb3V0cHV0IHBhdXNlIHRlc3RzCgkJaWYobm93YWl0KSByZXR1cm47CgkJCgkJaWYoX2NvbmZpZy5leHBlY3RlZCAmJiBfY29uZmlnLmV4cGVjdGVkICE9IF9jb25maWcuVGVzdC5sZW5ndGgpIHsKCQkJX2NvbmZpZy5UZXN0LnB1c2goIFsgZmFsc2UsICJFeHBlY3RlZCAiICsgX2NvbmZpZy5leHBlY3RlZCArICIgYXNzZXJ0aW9ucywgYnV0ICIgKyBfY29uZmlnLlRlc3QubGVuZ3RoICsgIiB3ZXJlIHJ1biIgXSApOwoJCX0KCQlfY29uZmlnLmV4cGVjdGVkID0gbnVsbDsKCQkKCQl2YXIgZ29vZCA9IDAsIGJhZCA9IDA7CgkJdmFyIG9sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib2wiKTsKCQlvbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCXZhciBsaSA9ICIiLCBzdGF0ZSA9ICJwYXNzIjsKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBfY29uZmlnLlRlc3QubGVuZ3RoOyBpKysgKSB7CgkJCXZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7CgkJCWxpLmNsYXNzTmFtZSA9IF9jb25maWcuVGVzdFtpXVswXSA/ICJwYXNzIiA6ICJmYWlsIjsKCQkJbGkuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKF9jb25maWcuVGVzdFtpXVsxXSkgKTsKCQkJb2wuYXBwZW5kQ2hpbGQoIGxpICk7CgkJCQoJCQlfY29uZmlnLnN0YXRzLmFsbCsrOwoJCQlpZiAoICFfY29uZmlnLlRlc3RbaV1bMF0gKSB7CgkJCQlzdGF0ZSA9ICJmYWlsIjsKCQkJCWJhZCsrOwoJCQkJX2NvbmZpZy5zdGF0cy5iYWQrKzsKCQkJfSBlbHNlIGdvb2QrKzsKCQl9CgkKCQl2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOwoJCWxpLmNsYXNzTmFtZSA9IHN0YXRlOwoJCgkJdmFyIGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHJvbmciKTsKCQliLmlubmVySFRNTCA9IG5hbWUgKyAiIDxiIHN0eWxlPSdjb2xvcjpibGFjazsnPig8YiBjbGFzcz0nZmFpbCc+IiArIGJhZCArICI8L2I+LCA8YiBjbGFzcz0ncGFzcyc+IiArIGdvb2QgKyAiPC9iPiwgIiArIF9jb25maWcuVGVzdC5sZW5ndGggKyAiKTwvYj4iOwoJCWIub25jbGljayA9IGZ1bmN0aW9uKCl7CgkJCXZhciBuID0gdGhpcy5uZXh0U2libGluZzsKCQkJaWYgKCBqUXVlcnkuY3NzKCBuLCAiZGlzcGxheSIgKSA9PSAibm9uZSIgKQoJCQkJbi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJZWxzZQoJCQkJbi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCX07CgkJalF1ZXJ5KGIpLmRibGNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CgkJCXZhciB0YXJnZXQgPSBqUXVlcnkoZXZlbnQudGFyZ2V0KS5maWx0ZXIoInN0cm9uZyIpLmNsb25lKCk7CgkJCWlmICggdGFyZ2V0Lmxlbmd0aCApIHsKCQkJCXRhcmdldC5jaGlsZHJlbigpLnJlbW92ZSgpOwoJCQkJbG9jYXRpb24uaHJlZiA9IGxvY2F0aW9uLmhyZWYubWF0Y2goL14oLis/KShcPy4qKT8kLylbMV0gKyAiPyIgKyBlbmNvZGVVUklDb21wb25lbnQoalF1ZXJ5LnRyaW0odGFyZ2V0LnRleHQoKSkpOwoJCQl9CgkJfSk7CgkJbGkuYXBwZW5kQ2hpbGQoIGIgKTsKCQlsaS5hcHBlbmRDaGlsZCggb2wgKTsKCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZXN0cyIpLmFwcGVuZENoaWxkKCBsaSApOwkJCgl9KTsKfQoKLy8gY2FsbCBvbiBzdGFydCBvZiBtb2R1bGUgdGVzdCB0byBwcmVwZW5kIG5hbWUgdG8gYWxsIHRlc3RzCmZ1bmN0aW9uIG1vZHVsZShtb2R1bGVOYW1lKSB7CglfY29uZmlnLmN1cnJlbnRNb2R1bGUgPSBtb2R1bGVOYW1lOwp9CgovKioKICogU3BlY2lmeSB0aGUgbnVtYmVyIG9mIGV4cGVjdGVkIGFzc2VydGlvbnMgdG8gZ3VyYW50ZWUgdGhhdCBmYWlsZWQgdGVzdCAobm8gYXNzZXJ0aW9ucyBhcmUgcnVuIGF0IGFsbCkgZG9uJ3Qgc2xpcCB0aHJvdWdoLgogKi8KZnVuY3Rpb24gZXhwZWN0KGFzc2VydHMpIHsKCV9jb25maWcuZXhwZWN0ZWQgPSBhc3NlcnRzOwp9CgovKioKICogUmVzZXRzIHRoZSB0ZXN0IHNldHVwLiBVc2VmdWwgZm9yIHRlc3RzIHRoYXQgbW9kaWZ5IHRoZSBET00uCiAqLwpmdW5jdGlvbiByZXNldCgpIHsKCWpRdWVyeSgiI21haW4iKS5odG1sKCBfY29uZmlnLmZpeHR1cmUgKTsKCWpRdWVyeS5ldmVudC5nbG9iYWwgPSB7fTsKCWpRdWVyeS5hamF4U2V0dGluZ3MgPSBqUXVlcnkuZXh0ZW5kKHt9LCBfY29uZmlnLmFqYXhTZXR0aW5ncyk7Cn0KCi8qKgogKiBBc3NlcnRzIHRydWUuCiAqIEBleGFtcGxlIG9rKCBqUXVlcnkoImEiKS5zaXplKCkgPiA1LCAiVGhlcmUgbXVzdCBiZSBhdCBsZWFzdCA1IGFuY2hvcnMiICk7CiAqLwpmdW5jdGlvbiBvayhhLCBtc2cpIHsKCV9jb25maWcuVGVzdC5wdXNoKCBbICEhYSwgbXNnIF0gKTsKfQoKLyoqCiAqIEFzc2VydHMgdGhhdCB0d28gYXJyYXlzIGFyZSB0aGUgc2FtZQogKi8KZnVuY3Rpb24gaXNTZXQoYSwgYiwgbXNnKSB7Cgl2YXIgcmV0ID0gdHJ1ZTsKCWlmICggYSAmJiBiICYmIGEubGVuZ3RoICE9IHVuZGVmaW5lZCAmJiBhLmxlbmd0aCA9PSBiLmxlbmd0aCApIHsKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrICkKCQkJaWYgKCBhW2ldICE9IGJbaV0gKQoJCQkJcmV0ID0gZmFsc2U7Cgl9IGVsc2UKCQlyZXQgPSBmYWxzZTsKCWlmICggIXJldCApCgkJX2NvbmZpZy5UZXN0LnB1c2goIFsgcmV0LCBtc2cgKyAiIGV4cGVjdGVkOiAiICsgc2VyaWFsQXJyYXkoYikgKyAiIHJlc3VsdDogIiArIHNlcmlhbEFycmF5KGEpIF0gKTsKCWVsc2UgCgkJX2NvbmZpZy5UZXN0LnB1c2goIFsgcmV0LCBtc2cgXSApOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IHR3byBvYmplY3RzIGFyZSBlcXVpdmFsZW50CiAqLwpmdW5jdGlvbiBpc09iaihhLCBiLCBtc2cpIHsKCXZhciByZXQgPSB0cnVlOwoJCglpZiAoIGEgJiYgYiApIHsKCQlmb3IgKCB2YXIgaSBpbiBhICkKCQkJaWYgKCBhW2ldICE9IGJbaV0gKQoJCQkJcmV0ID0gZmFsc2U7CgoJCWZvciAoIGkgaW4gYiApCgkJCWlmICggYVtpXSAhPSBiW2ldICkKCQkJCXJldCA9IGZhbHNlOwoJfSBlbHNlCgkJcmV0ID0gZmFsc2U7CgogICAgX2NvbmZpZy5UZXN0LnB1c2goIFsgcmV0LCBtc2cgXSApOwp9CgpmdW5jdGlvbiBzZXJpYWxBcnJheSggYSApIHsKCXZhciByID0gW107CgkKCWlmICggYSAmJiBhLmxlbmd0aCApCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdmFyIHN0ciA9IGFbaV0ubm9kZU5hbWU7CiAgICAgICAgICAgIGlmICggc3RyICkgewogICAgICAgICAgICAgICAgc3RyID0gc3RyLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBpZiAoIGFbaV0uaWQgKQogICAgICAgICAgICAgICAgICAgIHN0ciArPSAiIyIgKyBhW2ldLmlkOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHN0ciA9IGFbaV07CiAgICAgICAgICAgIHIucHVzaCggc3RyICk7CiAgICAgICAgfQoKCXJldHVybiAiWyAiICsgci5qb2luKCIsICIpICsgIiBdIjsKfQoKZnVuY3Rpb24gZmxhdE1hcChhLCBibG9jaykgewoJdmFyIHJlc3VsdCA9IFtdOwoJJC5lYWNoKGEsIGZ1bmN0aW9uKCkgewoJCXZhciB4ID0gYmxvY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQlpZiAoeCAhPT0gZmFsc2UpCgkJCXJlc3VsdC5wdXNoKHgpOwoJfSkKCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIHNlcmlhbE9iamVjdCggYSApIHsKCXJldHVybiAieyAiICsgZmxhdE1hcChhLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7CgkJcmV0dXJuIGtleSArICI6ICIgKyB2YWx1ZTsKCX0pLmpvaW4oIiwgIikgKyAiIH0iOwp9CgpmdW5jdGlvbiBjb21wYXJlKGEsIGIsIG1zZykgewoJdmFyIHJldCA9IHRydWU7CglpZiAoIGEgJiYgYiAmJiBhLmxlbmd0aCAhPSB1bmRlZmluZWQgJiYgYS5sZW5ndGggPT0gYi5sZW5ndGggKSB7CgkJZm9yICggdmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKyApCgkJCWZvcih2YXIga2V5IGluIGFbaV0pIHsKCQkJCWlmIChhW2ldW2tleV0uY29uc3RydWN0b3IgPT0gQXJyYXkpIHsKCQkJCQlmb3IgKHZhciBhcnJheUtleSBpbiBhW2ldW2tleV0pIHsKCQkJCQkJaWYgKGFbaV1ba2V5XVthcnJheUtleV0gIT0gYltpXVtrZXldW2FycmF5S2V5XSkgewoJCQkJCQkJcmV0ID0gZmFsc2U7CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGVsc2UgaWYgKGFbaV1ba2V5XSAhPSBiW2ldW2tleV0pIHsKCQkJCQlyZXQgPSBmYWxzZQoJCQkJfQoJCQl9Cgl9IGVsc2UKCQlyZXQgPSBmYWxzZTsKCW9rKCByZXQsIG1zZyArICIgZXhwZWN0ZWQ6ICIgKyBzZXJpYWxBcnJheShiKSArICIgcmVzdWx0OiAiICsgc2VyaWFsQXJyYXkoYSkgKTsKfQoKZnVuY3Rpb24gY29tcGFyZTIoYSwgYiwgbXNnKSB7Cgl2YXIgcmV0ID0gdHJ1ZTsKCWlmICggYSAmJiBiICkgewoJCWZvcih2YXIga2V5IGluIGEpIHsKCQkJaWYgKGFba2V5XS5jb25zdHJ1Y3RvciA9PSBBcnJheSkgewoJCQkJZm9yICh2YXIgYXJyYXlLZXkgaW4gYVtrZXldKSB7CgkJCQkJaWYgKGFba2V5XVthcnJheUtleV0gIT0gYltrZXldW2FycmF5S2V5XSkgewoJCQkJCQlyZXQgPSBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSBpZiAoYVtrZXldICE9IGJba2V5XSkgewoJCQkJcmV0ID0gZmFsc2UKCQkJfQoJCX0KCQlmb3Ioa2V5IGluIGIpIHsKCQkJaWYgKGJba2V5XS5jb25zdHJ1Y3RvciA9PSBBcnJheSkgewoJCQkJZm9yICh2YXIgYXJyYXlLZXkgaW4gYltrZXldKSB7CgkJCQkJaWYgKGFba2V5XVthcnJheUtleV0gIT0gYltrZXldW2FycmF5S2V5XSkgewoJCQkJCQlyZXQgPSBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSBpZiAoYVtrZXldICE9IGJba2V5XSkgewoJCQkJcmV0ID0gZmFsc2UKCQkJfQoJCX0KCX0gZWxzZQoJCXJldCA9IGZhbHNlOwoJb2soIHJldCwgbXNnICsgIiBleHBlY3RlZDogIiArIHNlcmlhbE9iamVjdChiKSArICIgcmVzdWx0OiAiICsgc2VyaWFsT2JqZWN0KGEpICk7Cn0KCi8qKgogKiBSZXR1cm5zIGFuIGFycmF5IG9mIGVsZW1lbnRzIHdpdGggdGhlIGdpdmVuIElEcywgZWcuCiAqIEBleGFtcGxlIHEoIm1haW4iLCAiZm9vIiwgImJhciIpCiAqIEByZXN1bHQgWzxkaXYgaWQ9Im1haW4iPiwgPHNwYW4gaWQ9ImZvbyI+LCA8aW5wdXQgaWQ9ImJhciI+XQogKi8KZnVuY3Rpb24gcSgpIHsKCXZhciByID0gW107Cglmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKysgKQoJCXIucHVzaCggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGFyZ3VtZW50c1tpXSApICk7CglyZXR1cm4gcjsKfQoKLyoqCiAqIEFzc2VydHMgdGhhdCBhIHNlbGVjdCBtYXRjaGVzIHRoZSBnaXZlbiBJRHMKICogQGV4YW1wbGUgdCgiQ2hlY2sgZm9yIHNvbWV0aGluZyIsICIvL1thXSIsIFsiZm9vIiwgImJhYXIiXSk7CiAqIEByZXN1bHQgcmV0dXJucyB0cnVlIGlmICIvL1thXSIgcmV0dXJuIHR3byBlbGVtZW50cyB3aXRoIHRoZSBJRHMgJ2ZvbycgYW5kICdiYWFyJwogKi8KZnVuY3Rpb24gdChhLGIsYykgewoJdmFyIGYgPSBqUXVlcnkoYik7Cgl2YXIgcyA9ICIiOwoJZm9yICggdmFyIGkgPSAwOyBpIDwgZi5sZW5ndGg7IGkrKyApCgkJcyArPSAocyAmJiAiLCIpICsgJyInICsgZltpXS5pZCArICciJzsKCWlzU2V0KGYsIHEuYXBwbHkocSxjKSwgYSArICIgKCIgKyBiICsgIikiKTsKfQoKLyoqCiAqIEFkZCByYW5kb20gbnVtYmVyIHRvIHVybCB0byBzdG9wIElFIGZyb20gY2FjaGluZwogKgogKiBAZXhhbXBsZSB1cmwoImRhdGEvdGVzdC5odG1sIikKICogQHJlc3VsdCAiZGF0YS90ZXN0Lmh0bWw/MTA1MzgzNTg0Mjg5NDMiCiAqCiAqIEBleGFtcGxlIHVybCgiZGF0YS90ZXN0LnBocD9mb289YmFyIikKICogQHJlc3VsdCAiZGF0YS90ZXN0LnBocD9mb289YmFyJjEwNTM4MzU4MzQ1NTU0IgogKi8KZnVuY3Rpb24gdXJsKHZhbHVlKSB7CglyZXR1cm4gdmFsdWUgKyAoL1w/Ly50ZXN0KHZhbHVlKSA/ICImIiA6ICI/IikgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArICIiICsgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSoxMDAwMDApOwp9CgovKioKICogQ2hlY2tzIHRoYXQgdGhlIGZpcnN0IHR3byBhcmd1bWVudHMgYXJlIGVxdWFsLCB3aXRoIGFuIG9wdGlvbmFsIG1lc3NhZ2UuCiAqIFByaW50cyBvdXQgYm90aCBhY3R1YWwgYW5kIGV4cGVjdGVkIHZhbHVlcy4KICoKICogUHJlZmVyZWQgdG8gb2soIGFjdHVhbCA9PSBleHBlY3RlZCwgbWVzc2FnZSApCiAqCiAqIEBleGFtcGxlIGVxdWFscyggJC5mb3JtYXQoIlJlY2VpdmVkIHswfSBieXRlcy4iLCAyKSwgIlJlY2VpdmVkIDIgYnl0ZXMuIiApOwogKgogKiBAcGFyYW0gT2JqZWN0IGFjdHVhbAogKiBAcGFyYW0gT2JqZWN0IGV4cGVjdGVkCiAqIEBwYXJhbSBTdHJpbmcgbWVzc2FnZSAob3B0aW9uYWwpCiAqLwpmdW5jdGlvbiBlcXVhbHMoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJdmFyIHJlc3VsdCA9IGV4cGVjdGVkID09IGFjdHVhbDsKCW1lc3NhZ2UgPSBtZXNzYWdlIHx8IChyZXN1bHQgPyAib2theSIgOiAiZmFpbGVkIik7CglfY29uZmlnLlRlc3QucHVzaCggWyByZXN1bHQsIHJlc3VsdCA/IG1lc3NhZ2UgKyAiOiAiICsgZXhwZWN0ZWQgOiBtZXNzYWdlICsgIiBleHBlY3RlZDogIiArIGV4cGVjdGVkICsgIiBhY3R1YWw6ICIgKyBhY3R1YWwgXSApOwp9CgovKioKICogVHJpZ2dlciBhbiBldmVudCBvbiBhbiBlbGVtZW50LgogKgogKiBAZXhhbXBsZSB0cmlnZ2VyRXZlbnQoIGRvY3VtZW50LmJvZHksICJjbGljayIgKTsKICoKICogQHBhcmFtIERPTUVsZW1lbnQgZWxlbQogKiBAcGFyYW0gU3RyaW5nIHR5cGUKICovCmZ1bmN0aW9uIHRyaWdnZXJFdmVudCggZWxlbSwgdHlwZSwgZXZlbnQgKSB7CglpZiAoIGpRdWVyeS5icm93c2VyLm1vemlsbGEgfHwgalF1ZXJ5LmJyb3dzZXIub3BlcmEgKSB7CgkJZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiTW91c2VFdmVudHMiKTsKCQlldmVudC5pbml0TW91c2VFdmVudCh0eXBlLCB0cnVlLCB0cnVlLCBlbGVtLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcsCgkJCTAsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTsKCQllbGVtLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7Cgl9IGVsc2UgaWYgKCBqUXVlcnkuYnJvd3Nlci5tc2llICkgewoJCWVsZW0uZmlyZUV2ZW50KCJvbiIrdHlwZSk7Cgl9Cn0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 22:31:18 GMT",
                    "Content-Length": "10503",
                    "Date": "Thu, 06 Nov 2014 22:31:21 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}