{
    "url": "http://localhost:9999/phono/s.phono.com/releases/1.0/samples/kitchen-sink/www/kitchen-sink.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.href</b> and written to <b>the 'html()' function of JQuery</b> via the following statements:<ul><li>var baseUrl = window.location.href.substring(0, window.location.href.indexOf('?'));</li><li>newPhonoDi....find(\" ...sessionId+ \"&lt;/a&gt;\" ) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/phono/s.phono.com/releases/1.0/samples/kitchen-sink/www/kitchen-sink.js",
                "path": "/phono/s.phono.com/releases/1.0/samples/kitchen-sink/www/kitchen-sink.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9waG9uby9zLnBob25vLmNvbS9yZWxlYXNlcy8xLjAvc2FtcGxlcy9raXRjaGVuLXNpbmsvd3d3L2tpdGNoZW4tc2luay5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjM1NTMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6NTg6MjYgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjU4OjIyIEdNVA0KDQovKiBLaXRjaGVuIFNpbmsgKi8KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgICAvKiB1c2UgY29kZSBsaWtlIHRoaXMgdG8gc2VwY2lmaXkgYSBwYXJ0aWN1bGFyIGNvZGVjLiAqLwogICAgLyoKICAgICBQaG9uby51dGlsLmZpbHRlcldpZGViYW5kID0gZnVuY3Rpb24ob2ZmZXIsIHdpZGViYW5kKSB7CiAgICAgICAgdmFyIGNvZGVjcyA9IG5ldyBBcnJheSgpOwogICAgICAgIFBob25vLnV0aWwuZWFjaChvZmZlciwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghd2lkZWJhbmQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUudG9VcHBlckNhc2UoKSA9PSAiRzcyMiIgJiYgdGhpcy5yYXRlID09ICI4MDAwIikgewogICAgICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5hbWUgPT0gInRlbGVwaG9uZS1ldmVudCIpewogICAgICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29kZWNzLnB1c2godGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gY29kZWNzOwogICAgfTsgICAKICAgICovIAoKICAgIHZhciBwaG9ub3M9e30sIGNhbGxzPXt9LCBjaGF0cz17fTsKCiAgICBmdW5jdGlvbiB1cmxQYXJhbShuYW1lKXsKCXZhciByZXN1bHRzID0gbmV3IFJlZ0V4cCgnW1xcPyZdJyArIG5hbWUgKyAnPShbXiYjXSopJykuZXhlYyh3aW5kb3cubG9jYXRpb24uaHJlZik7CglpZiAoIXJlc3VsdHMpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfQoJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdKSB8fCB1bmRlZmluZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlTmV3UGhvbm8oY29ubmVjdGlvbil7CgkvL0Nsb25lIGEgcGhvbm8gZGl2Cgl2YXIgcGhvbm9DdHIgPSAoJCgiLnBob25vIikuc2l6ZSgpICsgMSkgLSAxOwoJdmFyIG5ld1Bob25vSUQgPSAiUGhvbm8iICsgcGhvbm9DdHI7Cgl2YXIgZmlyc3RQaG9ubyA9ICQoJy5waG9ubycpLmZpcnN0KCkKCXZhciBuZXdQaG9ub0RpdiA9IGZpcnN0UGhvbm8uY2xvbmUoKQogICAgICAgIHZhciBhdWRpb1R5cGUgPSAkKCcuYXVkaW8tcGx1Z2luJykudmFsKCk7CiAgICAgICAgdmFyIGJyaWRnZWQgPSBmYWxzZTsKICAgICAgICB2YXIgY29ubmVjdGlvblVybCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCsiLy9hcHAudjEucGhvbm8uY29tL2h0dHAtYmluZCI7CiAgICAgICAgdmFyIHByb3Zpc2lvbmluZ1VybCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgZGlhbFN0cmluZyA9ICJzaXA6MzM2NkBsb2dpbi56aXBkeC5jb20iOwogICAgICAgIHZhciBjaGF0U3RyaW5nID0gImVuMmZyQGJvdC50YWxrLmdvb2dsZS5jb20iOwogICAgICAgIHZhciBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgCiAgICAgICAgaWYgKGNvbm5lY3Rpb25VcmwuaW5kZXhPZigiZmlsZToiKSA9PSAwKXsKICAgICAgICAgICAgY29ubmVjdGlvblVybCA9ICJodHRwOi8vYXBwLnYxLnBob25vLmNvbS9odHRwLWJpbmQiOwogICAgICAgIH0KCiAgICAgICAgLy8gRG8gd2UgaGF2ZSBVUkwgcGFyYW1ldGVycyB0byBvdmVycmlkZSBoZXJlPwogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gImF1dG8iICYmIHVybFBhcmFtKCJhdWRpbyIpICE9IHVuZGVmaW5lZCkgYXVkaW9UeXBlID0gdXJsUGFyYW0oImF1ZGlvIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJjb25uZWN0aW9uVXJsIikgIT0gdW5kZWZpbmVkKSBjb25uZWN0aW9uVXJsID0gdXJsUGFyYW0oImNvbm5lY3Rpb25VcmwiKTsKICAgICAgICBpZiAodXJsUGFyYW0oInByb3Zpc2lvbmluZ1VybCIpICE9IHVuZGVmaW5lZCkgcHJvdmlzaW9uaW5nVXJsID0gdXJsUGFyYW0oInByb3Zpc2lvbmluZ1VybCIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiZGlhbCIpICE9IHVuZGVmaW5lZCkgZGlhbFN0cmluZyA9IHVybFBhcmFtKCJkaWFsIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJjaGF0IikgIT0gdW5kZWZpbmVkKSBjaGF0U3RyaW5nID0gdXJsUGFyYW0oImNoYXQiKTsKICAgICAgICBpZiAodXJsUGFyYW0oImdhdGV3YXkiKSAhPSB1bmRlZmluZWQpIGd3ID0gdXJsUGFyYW0oImdhdGV3YXkiKTsKCiAgICAgICAgY29uc29sZS5sb2coImF1ZGlvVHlwZSA9ICIgKyBhdWRpb1R5cGUpOwogICAgICAgIGNvbnNvbGUubG9nKCJkaWFsU3RyaW5nID0gIiArIGRpYWxTdHJpbmcpOwogICAgICAgIGNvbnNvbGUubG9nKCJjaGFyU3RyaW5nID0gIiArIGNoYXRTdHJpbmcpOwoKCW5ld1Bob25vRGl2LmF0dHIoImlkIixuZXdQaG9ub0lEKS5hcHBlbmRUbygnLnBob25vSGxkcicpLnNob3coKTsKCW5ld1Bob25vRGl2LmZpbmQoIi5waG9ub0lEIikudGV4dChuZXdQaG9ub0lEKyI6Iik7CiAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQoYXVkaW9UeXBlKTsKICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuY2FsbFRvIikudmFsKGRpYWxTdHJpbmcpOwogICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5jaGF0VG8iKS52YWwoY2hhdFN0cmluZyk7CgogICAgICAgIHZhciBhdWRpbyA9IGF1ZGlvVHlwZTsKICAgICAgICB2YXIgdmlkZW8gPSBmYWxzZTsKCiAgICAgICAgdmFyIHByb3RvY29sID0gInNpcDoiOwogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gIndlYnJ0YyIgfHwgYXVkaW9UeXBlID09ICJqc2VwIikgcHJvdG9jb2wgPSAieG1wcDoiOwoKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJmbGFzaCIpIHsKICAgICAgICAgICAgZ3cgPSAiZ3ctdjMuZC5waG9uby5jb20iOwogICAgICAgICAgICBhdWRpbyA9ICJmbGFzaCI7CiAgICAgICAgICAgIGJyaWRnZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAicGFuZGEiKSB7CiAgICAgICAgICAgIGd3ID0gImd3LXY2LmQucGhvbm8uY29tIjsKICAgICAgICAgICAgYXVkaW8gPSAiZmxhc2giOwogICAgICAgICAgICBicmlkZ2VkID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJwYW5kYWJyaWRnZWQiKSB7CiAgICAgICAgICAgIGd3ID0gImd3LXY2LmQucGhvbm8uY29tIjsKICAgICAgICAgICAgYXVkaW8gPSAiZmxhc2giOwogICAgICAgICAgICBicmlkZ2VkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gImpzZXAiKSB7CiAgICAgICAgICAgIGd3ID0gImd3LXY2LmQucGhvbm8uY29tIjsKICAgICAgICAgICAgYXVkaW8gPSAianNlcCI7CiAgICAgICAgICAgIHZpZGVvID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcGhvbm9zW25ld1Bob25vSURdID0gJC5waG9ubyh7CgkgICAgYXBpS2V5OiAiQzE3RDE2N0YtMDlDNi00RTRDLUEzREQtMjAyNUQ0OEJBMjQzIiwKICAgICAgICAgICAgY29ubmVjdGlvblVybDpjb25uZWN0aW9uVXJsLAogICAgICAgICAgICBwcm92aXNpb25pbmdVcmw6cHJvdmlzaW9uaW5nVXJsLAogICAgICAgICAgICBnYXRld2F5Omd3LAogICAgICAgICAgICBjb25uZWN0aW9uOiBjb25uZWN0aW9uLAogICAgICAgICAgICAKICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBiYXNlVXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyaW5nKDAsIHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJz8nKSk7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuc2Vzc2lvbklkIikuaHRtbCgiPGEgY2xhc3M9J3Nlc3Npb25JZCcgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9JyIgKyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVcmwgKyAiP2F1ZGlvPSIgKyBhdWRpb1R5cGUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICImY29ubmVjdGlvblVybD0iICsgY29ubmVjdGlvblVybCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiZkaWFsPSIgKyBwcm90b2NvbCArIHRoaXMuc2Vzc2lvbklkIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiJmNoYXQ9IiArIHRoaXMuc2Vzc2lvbklkICsgIic+IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdGhpcy5zZXNzaW9uSWQgKyAiPC9hPiIpOwogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLnBob25lQ29udHJvbCIpLnNob3coKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHR5cGVvZih0aGlzLmF1ZGlvKSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW9UeXBlIikudGV4dCh0aGlzLmF1ZGlvLnR5cGUpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvLnR5cGUgPT0gImZsYXNoIiAmJiBndyA9PSAiZ3ctdjYuZC5waG9uby5jb20iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5hdWRpb1R5cGUiKS50ZXh0KGJyaWRnZWQ/ImZsYXNoIChuZXcgLSBicmlkZ2VkKSI6ImZsYXNoIChuZXcpIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmF1ZGlvLnR5cGUgPT0gImZsYXNoIikgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW9UeXBlIikudGV4dCgiZmxhc2ggKG9sZCkiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXVkaW8uYXVkaW9JbkRldmljZXMpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5MaXN0ID0gdGhpcy5hdWRpby5hdWRpb0luRGV2aWNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBpbkxpc3QgPSBbIkEiLCJCIiwiQyJdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZGV2aWNlcyBhcmUgOiIraW5MaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsPTA7bDxpbkxpc3QubGVuZ3RoO2wrKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCgnPG9wdGlvbiB2YWx1ZT0iJysgaW5MaXN0W2xdICsnIj4nKyBpbkxpc3RbbF0gKyc8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW8taW5wdXQiKS5odG1sKG91dHB1dC5qb2luKCcnKSk7OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBQaG9ubyBsb2FkZWQiKTsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYoICEgdGhpcy5hdWRpby5wZXJtaXNzaW9uKCkgKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpby5zaG93UGVybWlzc2lvbkJveCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9LAogICAgICAgICAgICBvblVucmVhZHk6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuc2Vzc2lvbklkIikudGV4dCgiZGlzY29ubmVjdGVkIik7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBQaG9ubyBkaXNjb25uZWN0ZWQiKTsgIAogICAgICAgICAgICB9LAkJICAgCiAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuc2Vzc2lvbklkIikudGV4dChldmVudC5yZWFzb24pOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQucmVhc29uKTsgIAogICAgICAgICAgICB9LAkJICAgCgkgICAgYXVkaW86IHsKICAgICAgICAgICAgICAgIHR5cGU6IGF1ZGlvLAogICAgICAgICAgICAgICAgamFyOiAiLi4vLi4vLi4vcGx1Z2lucy9hdWRpby9waG9uby5hdWRpby5qYXIiLAogICAgICAgICAgICAgICAgc3dmOiAiLi4vLi4vLi4vcGx1Z2lucy9hdWRpby9waG9uby5hdWRpby5zd2YiLAogICAgICAgICAgICAgICAgbWVkaWE6IHthdWRpbzp0cnVlLCB2aWRlbzp2aWRlb30sCiAgICAgICAgICAgICAgICBicmlkZ2VkOiBicmlkZ2VkLAogICAgICAgICAgICAgICAgb25QZXJtaXNzaW9uQm94U2hvdzogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBGbGFzaCBwZXJtaXNzaW9uIGJveCBsb2FkZWQiKTsgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25QZXJtaXNzaW9uQm94SGlkZTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBGbGFzaCBwZXJtaXNzaW9uIGJveCBjbG9zZWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiggISB0aGlzLnBlcm1pc3Npb24oKSApewogICAgICAgCQkgICAgCXRoaXMuc2hvd1Blcm1pc3Npb25Cb3goKTsKICAgICAgIAkJICAgIH0KICAgICAgICAgICAgICAgIH0KCSAgICB9LAkgICAgICAKCSAgICBwaG9uZTogewogICAgICAgICAgICAgICAgcmluZ1RvbmU6ICJyaW5ndG9uZXMvRGlnZ3p0b25lX01hcmltYmEubXAzIiwKICAgICAgICAgICAgICAgIHJpbmdiYWNrVG9uZTogInJpbmd0b25lcy9yaW5nYmFjay11cy5tcDMiLAogICAgICAgICAgICAgICAgb25JbmNvbWluZ0NhbGw6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gd2FzIHB1c2ggdG8gdGFsayBlbmFibGVkIGZvciBjYWxscz8KCQkgICAgdmFyIHB0dEVuYWJsZWQ7CgkJICAgICgkKCIjIituZXdQaG9ub0lEKS5maW5kKCIucHVzaC10by10YWxrIikuaXMoIjpjaGVja2VkIikpID8gcHR0RW5hYmxlZCA9IHRydWUgOiBwdHRFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0NhbGxJRCA9IGNyZWF0ZUNhbGxEaXYobmV3UGhvbm9JRCwiaW5jb21pbmciLHB0dEVuYWJsZWQpOwogICAgICAgICAgICAgICAgICAgIHZhciBuZXdDYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsSGVhZGVyIC5jYWxsRGV0YWlsIikuaHRtbCgiPHN0cm9uZz5JbmNvbWluZyBjYWxsIGZyb206IDwvc3Ryb25nPiIgKyBldmVudC5jYWxsLmluaXRpYXRvcik7CiAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbEhlYWRlciAuY2FsbElEIikuaHRtbChuZXdDYWxsSUQpOwogICAgICAgICAgICAJICAgIGNhbGxzW25ld0NhbGxJRF0gPSBldmVudC5jYWxsOwogICAgICAgICAgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIE5ldyBpbmNvbWluZyBjYWxsIik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuY2FsbC50b25lcyh0cnVlKTsgCiAgICAgICAgICAgIAkgICAgLy9CaW5kIGV2ZW50cyBmcm9tIHRoaXMgY2FsbAogICAgICAgICAgICAJICAgIGNhbGxzW25ld0NhbGxJRF0uYmluZCh7CiAgICAgICAgICAgICAJICAgICAgICBvbkhhbmd1cDogZnVuY3Rpb24oZXZlbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3lQb2xsKTsKICAgICAgICAgICAgIAkgICAgICAgICAgICBuZXdDYWxsRGl2LnNsaWRlVXAoKTsKICAgICAgICAgICAgIAkgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdID0gbnVsbDsKICAgICAgICAgICAgIAkgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBodW5ndXAiKTsKICAgICAgICAgICAgIAkgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQW5zd2VyOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlY3VyZSA9IGNhbGxzW25ld0NhbGxJRF0uc2VjdXJlKCk7CiAgICAgICAgICAgIAkgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBhbnN3ZXJlZCB1c2luZyAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxDb2RlYyIpLmh0bWwoIjxzdHJvbmc+Q29kZWM6PC9zdHJvbmc+ICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbFNlY3VyZSIpLmh0bWwoc2VjdXJlID8gIihzZWN1cmUpIiA6ICIiKTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5NaWM6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLm1pYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgbWUpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsTWljRW5lcmd5IikuaHRtbChzdHIpOwkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5TcGs6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2UgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLnNwazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgc2UpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsU3BrRW5lcmd5IikuaHRtbChzdHIpOwkKCQkgICAgICAgICAgICB9LDUwMCk7CgkJCSAgICAKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgIAkgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAJICAgCSAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gRXJyb3I6IFsiICsgZXZlbnQucmVhc29uICsgIl0iKTsKICAgICAgICAgICAgIAkgICAgICAgIH0KICAgICAgICAgICAgCSAgICB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIEVycm9yOiBbIiArIGV2ZW50LnJlYXNvbiArICJdIik7CiAgICAgICAgICAgICAgICB9CgkgICAgfSwKCSAgICAKCSAgICBtZXNzYWdpbmc6IHsKICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24oZXZlbnQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgCSAgICB2YXIgSklEID0gbWVzc2FnZS5mcm9tLnNwbGl0KCIvIik7CiAgICAgICAgICAgIAkgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gTWVzc2FnZSBmcm9tICIgKyBKSURbMF0gKyAiIFsiICsgbWVzc2FnZS5ib2R5ICsgIl0iKTsKICAgICAgICAgICAgCSAgICByb3V0ZU1lc3NhZ2UobmV3UGhvbm9JRCwiaW5jb21pbmciLEpJRFswXSxtZXNzYWdlLmJvZHkpOwogICAgICAgICAgICAgICAgfQoJICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgICAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBjYWxsCiAgICBmdW5jdGlvbiBjcmVhdGVOZXdDYWxsKHBob25vSUQsIHRvKXsKCS8vY2xvbmUgYSBjYWxsIGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7CgkKCS8vIHdhcyBwdXNoIHRvIHRhbGsgZW5hYmxlZCBmb3IgY2FsbHM/Cgl2YXIgcHR0RW5hYmxlZDsKCShwaG9ub0Rpdi5maW5kKCIucHVzaC10by10YWxrIikuaXMoIjpjaGVja2VkIikpID8gcHR0RW5hYmxlZCA9IHRydWUgOiBwdHRFbmFibGVkID0gZmFsc2U7CgkKCXZhciBuZXdDYWxsSUQgPSBjcmVhdGVDYWxsRGl2KHBob25vSUQsIm91dGdvaW5nIixwdHRFbmFibGVkKTsKCXZhciBjYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKCWNhbGxEaXYuZmluZCgiLmNhbGxJRCIpLnRleHQobmV3Q2FsbElEKTsKCWNhbGxEaXYuZmluZCgiLmNhbGxEZXRhaWwiKS5odG1sKCI8c3Ryb25nPk91dGdvaW5nIGNhbGwgdG86PC9zdHJvbmc+ICIgKyB0byk7Cgljb25zb2xlLmxvZygiWyIrcGhvbm9EaXYuYXR0cignaWQnKSsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbGluZyAiK3RvKTsKCQoJY2FsbHNbbmV3Q2FsbElEXSA9IHBob25vc1twaG9ub0lEXS5waG9uZS5kaWFsKHRvLCB7CgkgICAgdG9uZXM6IHRydWUsCgkgICAgcHVzaFRvVGFsazogcHR0RW5hYmxlZCwKICAgICAgICAgICAgb25BbnN3ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgc2VjdXJlID0gY2FsbHNbbmV3Q2FsbElEXS5zZWN1cmUoKTsKICAgICAgICAgICAgCWNvbnNvbGUubG9nKCJbIitwaG9ub0Rpdi5hdHRyKCdpZCcpKyJdIFsiK25ld0NhbGxJRCsiXSBDYWxsIGFuc3dlcmVkIHVzaW5nICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbENvZGVjIikuaHRtbCgiPHN0cm9uZz5Db2RlYzo8L3N0cm9uZz4gIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMubmFtZSArICIvIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMucmF0ZSk7CiAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsU2VjdXJlIikuaHRtbChzZWN1cmUgPyAiKHNlY3VyZSkiIDogIiIpOyAKICAgICAgICAgICAgICAgIGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5UG9sbCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpewoJICAgICAgICAgICAgIHZhciBjYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKICAgICAgICAgICAgICAgICAgICAgc3RyID0gIjxzdHJvbmc+TWljOjwvc3Ryb25nPiAiOwogICAgICAgICAgICAgICAgICAgICBtZSA9IGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5KCkubWljOwogICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyKyAoKGkgPCBtZSk/IlgiOiJfIik7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbE1pY0VuZXJneSIpLmh0bWwoc3RyKTsJCiAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5TcGs6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgIHNlID0gY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3koKS5zcGs7CiAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8MTA7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIrICgoaSA8IHNlKT8iWCI6Il8iKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsU3BrRW5lcmd5IikuaHRtbChzdHIpOwkKCQl9LDUwMCk7CgkJCQogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkhhbmd1cDogZnVuY3Rpb24oKSB7CgkJd2luZG93LmNsZWFySW50ZXJ2YWwoY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3lQb2xsKTsKICAgICAgICAgICAgCWNhbGxzW25ld0NhbGxJRF0gPSBudWxsOwogICAgICAgICAgICAJJCgiIyIrbmV3Q2FsbElEKS5zbGlkZVVwKCk7CiAgICAgICAgICAgIAljb25zb2xlLmxvZygiWyIrcGhvbm9EaXYuYXR0cignaWQnKSsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBodW5ndXAiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNhbGxzW25ld0NhbGxJRF0ucGhvbm9JRCA9IHBob25vSUQ7CiAgICB9CiAgICAKICAgIC8vUm91dGVzIGEgbWVzc2FnZSB0byB0aGUgYXBwcm9wcmlhdGUgY2hhdCBvciBjcmVhdGVzIGEgbmV3IGNoYXQKICAgIGZ1bmN0aW9uIHJvdXRlTWVzc2FnZShwaG9ub0lELCB0eXBlLCBqaWQsIG1lc3NhZ2UpewoJdmFyIHRoZUNoYXQgPSAiIjsKCSQuZWFjaChjaGF0cywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewoJICAgIGlmKCB2YWx1ZSA9PSBqaWQgKXsKCQl0aGVDaGF0ID0ga2V5OwoJCXZhciBuZXdNc2cgPSBjaGF0TWVzc2FnZShqaWQsbWVzc2FnZSwiaW5ib3VuZCIpOwoJCXZhciBjaGF0RGl2ID0gJCgiIyIrdGhlQ2hhdCk7CgkJcmVuZGVyTmV3TWVzc2FnZShjaGF0RGl2LCBuZXdNc2cpOwoJCWNoYXREaXYuZmluZCgiLmNoYXRUeHRJbnB1dCIpLmZvY3VzKCk7CgkJcmV0dXJuOwoJICAgIH0KICAgCX0pOwogICAJCiAJLy9EaWQgd2UgZmluZCBhIGNoYXQ/CglpZighIHRoZUNoYXQubGVuZ3RoKXsKCSAgICBjcmVhdGVOZXdDaGF0KHBob25vSUQsamlkLG1lc3NhZ2UpOwoJfQogICAgfQogICAgCiAgICAvL091dHB1dHMgYW4gSU0gbWVzc2FnZQogICAgZnVuY3Rpb24gcmVuZGVyTmV3TWVzc2FnZShjaGF0LCBtc2cpewoJY2hhdC5maW5kKCIuY2hhdEJveCIpLmFwcGVuZChtc2cpOwoJY2hhdC5maW5kKCIuY2hhdEJveCIpLmF0dHIoeyBzY3JvbGxUb3A6IGNoYXQuZmluZCgiLmNoYXRCb3giKS5hdHRyKCJzY3JvbGxIZWlnaHQiKSB9KTsKICAgIH0KICAgIAogICAgLy9DcmVhdGVzIGEgbmV3IGRpdiB0byBob2xkIGEgY2FsbC4gUmV0dXJucyB0aGUgaWQgb2YgdGhlIG5ldyBkaXYKICAgIGZ1bmN0aW9uIGNyZWF0ZUNhbGxEaXYocGhvbm9JRCxjYWxsVHlwZSxwdHRFbmFibGVkKXsKCS8vY2xvbmUgYSBjYWxsIGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7Cgl2YXIgY2FsbEJveCA9IHBob25vRGl2LmZpbmQoIi5jYWxscyIpOwoJdmFyIG5ld0NhbGxDdHIgPSAoJCgiLmNhbGxIbGRyIikuc2l6ZSgpICsgMSkgLSAyOwoJbmV3Q2FsbElEID0gIkNhbGwiICsgbmV3Q2FsbEN0cjsKCXZhciBmaXJzdENhbGwgPSAkKCIuY2FsbEhsZHIiKS5maXJzdCgpCgl2YXIgbmV3Q2FsbERpdiA9IGZpcnN0Q2FsbC5jbG9uZSgpCgluZXdDYWxsRGl2LmF0dHIoImlkIixuZXdDYWxsSUQpLmFwcGVuZFRvKGNhbGxCb3gpLnNob3coKTsKCQoJaWYoIGNhbGxUeXBlID09ICJvdXRnb2luZyIpewoJICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxJbnB1dHMiKS5zaG93KCk7Cgl9ZWxzZXsKCSAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsQ29udHJvbHMiKS5zaG93KCk7Cgl9CgkKCXB0dEVuYWJsZWQgPyBuZXdDYWxsRGl2LmZpbmQoIi50YWxrU3RhcnQiKS5zaG93KCkgOiBuZXdDYWxsRGl2LmZpbmQoIi50YWxrU3RhcnQiKS5oaWRlKCk7CgkKCXJldHVybiBuZXdDYWxsSUQ7CiAgICB9CiAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBjaGF0CiAgICBmdW5jdGlvbiBjcmVhdGVOZXdDaGF0KHBob25vSUQsIHRvLCBtZXNzYWdlKXsKCS8vY2xvbmUgYSBjaGF0IGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7Cgl2YXIgbmV3Q2hhdElEID0gY3JlYXRlQ2hhdERpdihwaG9ub0lEKTsKCXZhciBjaGF0RGl2ID0gJCgiIyIrbmV3Q2hhdElEKTsKCWNoYXREaXYuZmluZCgiLmNoYXRJRCIpLnRleHQobmV3Q2hhdElEKTsKCWNoYXREaXYuZmluZCgiLmNoYXREZXRhaWwiKS5odG1sKHRvKTsKCQoJaWYoIG1lc3NhZ2UubGVuZ3RoICl7CgkgICAgdmFyIG5ld01zZyA9IGNoYXRNZXNzYWdlKHRvLG1lc3NhZ2UsImluYm91bmQiKTsKCSAgICByZW5kZXJOZXdNZXNzYWdlKGNoYXREaXYsIG5ld01zZyk7Cgl9CgkKCWNvbnNvbGUubG9nKCJbIitwaG9ub0Rpdi5hdHRyKCdpZCcpKyJdIFsiK25ld0NoYXRJRCsiXSBDaGF0IHN0YXJ0ZWQgd2l0aCAiICsgdG8pOwoJCgljaGF0c1tuZXdDaGF0SURdID0gdG87CiAgICB9CiAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBkaXYgdG8gaG9sZCBhIGNoYXQuIFJldHVybnMgdGhlIGlkIG9mIHRoZSBuZXcgZGl2CiAgICBmdW5jdGlvbiBjcmVhdGVDaGF0RGl2KHBob25vSUQpewoJLy9jbG9uZSBhIGNoYXQgYm94Cgl2YXIgcGhvbm9EaXYgPSAkKCIjIitwaG9ub0lEKTsKCXZhciBjaGF0Qm94ID0gcGhvbm9EaXYuZmluZCgiLmNoYXRzIik7Cgl2YXIgbmV3Q2hhdEN0ciA9ICgkKCIuY2hhdEhsZHIiKS5zaXplKCkgKyAxKSAtIDI7CgluZXdDaGF0SUQgPSAiQ2hhdCIgKyBuZXdDaGF0Q3RyOwoJdmFyIGZpcnN0Q2hhdCA9ICQoIi5jaGF0SGxkciIpLmZpcnN0KCk7Cgl2YXIgbmV3Q2hhdERpdiA9IGZpcnN0Q2hhdC5jbG9uZSgpOwoJbmV3Q2hhdERpdi5hdHRyKCJpZCIsbmV3Q2hhdElEKS5hcHBlbmRUbyhjaGF0Qm94KS5zaG93KCk7CgluZXdDaGF0RGl2LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS5mb2N1cygpOwoJCglyZXR1cm4gbmV3Q2hhdElEOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSU9TKCkgewogICAgICAgIHZhciB1c2VyQWdlbnQgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgICAgICBpZiAodXNlckFnZW50Lm1hdGNoKC9pUGFkL2kpIHx8IHVzZXJBZ2VudC5tYXRjaCgvaVBob25lL2kpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzQW5kcm9pZCgpIHsKICAgICAgICB2YXIgdXNlckFnZW50ID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICAgICAgaWYgKHVzZXJBZ2VudC5tYXRjaCgvQW5kcm9pZC9pKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICAvLyBDcmVhdGUgYW5kIHJldHVybiBhIGNoYXQgbWVzc2FnZSBidWJibGUKICAgIHZhciBjaGF0TWVzc2FnZSA9IGZ1bmN0aW9uKGZyb20sYm9keSx0eXBlKXsKCXZhciByZXN1bHQ7CgkKCWlmKCB0eXBlID09ICdpbmJvdW5kJyl7CgkgICAgdmFyIGJvcmRlclN0eWxlID0gImluYm91bmQiOwoJICAgIHZhciBmcm9tU3R5bGUgPSAiZnJvbUluYm91bmQiOwoJfWVsc2V7CgkgICAgdmFyIGJvcmRlclN0eWxlID0gIm91dGJvdW5kIjsKCSAgICB2YXIgZnJvbVN0eWxlID0gImZyb21PdXRib3VuZCI7Cgl9CgkKCXJlc3VsdCA9ICQoIjxkaXY+IikKCSAgICAuYWRkQ2xhc3MoImNoYXRFbnRyeSIpCgkgICAgLmFkZENsYXNzKGJvcmRlclN0eWxlKTsKCXZhciBmcm9tSGVhZGVyID0gJCgiPGRpdj4iKQoJICAgIC5hZGRDbGFzcygiZnJvbSIpCgkgICAgLmFkZENsYXNzKGZyb21TdHlsZSkKCSAgICAuaHRtbChmcm9tKQoJICAgIC5hcHBlbmRUbyhyZXN1bHQpOwoJdmFyIG1zZ0JvZHkgPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJib2R5IikKCSAgICAuaHRtbChib2R5KQoJICAgIC5hcHBlbmRUbyhyZXN1bHQpOwoJCglyZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAvL0RPTSBFdmVudCBIYW5kbGVycwogICAgJCgiLmFkZFBob25vIikuY2xpY2soZnVuY3Rpb24oKXsKCWNyZWF0ZU5ld1Bob25vKCk7CglyZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIAogICAgJCgnLmNsb3NlUGhvbm8nKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl2YXIgdGhpc1Bob25vSUQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl0aGlzUGhvbm8uc2xpZGVVcCgpOwoKICAgICAgICAvLyBIYW5ndXAgYW55IGNhbGwgdGhhdCBpcyBpbiBwcm9ncmVzcwogICAgICAgICQuZWFjaChjYWxscywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiB2YWx1ZS5waG9ub0lEID09IHRoaXNQaG9ub0lEKSB7CiAgICAgICAgICAgICAgICB2YWx1ZS5oYW5ndXAoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoJCgkkKCIjIit0aGlzQ2FsbCkuc2xpZGVVcCgiZmFzdCIsIGZ1bmN0aW9uKCl7CgkgICAgJCh0aGlzKS5yZW1vdmUoKTsJCgl9KTsKCglwaG9ub3NbdGhpc1Bob25vLmF0dHIoImlkIildID0gbnVsbDsKCQoJdGhpc1Bob25vLmZpbmQoIi5jYWxsSGxkciIpLmVhY2goZnVuY3Rpb24oKXsKCSAgICBjYWxsc1skKHRoaXMpLmF0dHIoImlkIildID0gbnVsbDsKCX0pOwoJY29uc29sZS5sb2coIlsiK3RoaXNQaG9ub0lEKyJdIFBob25lIHJlbW92ZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcuY2xvc2VDaGF0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2hhdCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIik7Cgl2YXIgdGhpc0NoYXRJRCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIikuYXR0cigiaWQiKTsKCXRoaXNDaGF0LnNsaWRlVXAoKTsKCWNoYXRzW3RoaXNDaGF0SURdID0gbnVsbDsJCgljb25zb2xlLmxvZygiWyIrdGhpc0NoYXRJRCsiXSBDaGF0IGNsb3NlZCIpOwogICAgfSk7CiAgICAKICAgICQoJy5jYWxsJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgY2FsbFRvID0gJC50cmltKCQoIiMiK3RoaXNQaG9ubykuZmluZCgiLmNhbGxUbyIpLnZhbCgpKTsKCWNyZWF0ZU5ld0NhbGwodGhpc1Bob25vLCBjYWxsVG8pOwogICAgfSk7CiAgICAKICAgICQoJy5oZWFkc2V0JykubGl2ZSgnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKCXZhciBoZWFkc2V0RW5hYmxlZCA9ICQoIiMiK3Bob25vSWQpLmZpbmQoIi5oZWFkc2V0IikuaXMoIjpjaGVja2VkIik7Cgljb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBIZWFkc2V0OiAiICsgaGVhZHNldEVuYWJsZWQpOwogICAgCXBob25vc1twaG9ub0lkXS5waG9uZS5oZWFkc2V0KGhlYWRzZXRFbmFibGVkKTsJCQogICAgfSk7CgogICAgJCgnLndpZGViYW5kJykubGl2ZSgnY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgd2lkZWJhbmREaXNhYmxlZCA9ICQoIiMiK3Bob25vSWQpLmZpbmQoIi53aWRlYmFuZCIpLmlzKCI6Y2hlY2tlZCIpOwoJY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gV2lkZWJhbmREaXNhYmxlZDogIiArIHdpZGViYW5kRGlzYWJsZWQpOwogICAgCXBob25vc1twaG9ub0lkXS5waG9uZS53aWRlYmFuZCghd2lkZWJhbmREaXNhYmxlZCk7CiAgICB9KTsKICAgIAogICAgJCgnLnJpbmctdG9uZSwgLnJpbmdiYWNrLXRvbmUnKS5saXZlKCQuYnJvd3Nlci5tc2llID8gJ2NsaWNrJzogJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgdG9uZSA9ICQodGhpcykudmFsKCk7CgkKCWlmKCQodGhpcykuaGFzQ2xhc3MoInJpbmctdG9uZSIpKXsKCSAgICBwaG9ub3NbcGhvbm9JZF0ucGhvbmUucmluZ1RvbmUodG9uZSk7CgkgICAgY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gUmluZyB0b25lIHNldDogIiArIHRvbmUpOwoJfWVsc2V7CgkgICAgcGhvbm9zW3Bob25vSWRdLnBob25lLnJpbmdiYWNrVG9uZSh0b25lKTsKCSAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBSaW5nYmFjayB0b25lIHNldDogIiArIHRvbmUpOwoJfQkKICAgIH0pOwogICAgJCgnLmF1ZGlvLWlucHV0JykubGl2ZSgkLmJyb3dzZXIubXNpZSA/ICdjbGljayc6ICdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKCXZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwogICAgICAgIHZhciBkZXZpY2UgPSAkKHRoaXMpLnZhbCgpOwogICAgICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIEF1ZGlvIElucHV0IHNldDogIiArIGRldmljZSk7CglwaG9ub3NbcGhvbm9JZF0ucGhvbmUuYXVkaW9JbnB1dChkZXZpY2UpOwogICAgfSk7IAogICAgJCgnLnNlY3VyaXR5LW9wdGlvbicpLmxpdmUoJC5icm93c2VyLm1zaWUgPyAnY2xpY2snOiAnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKICAgICAgICB2YXIgc2VjdXJpdHkgPSAkKHRoaXMpLnZhbCgpOwogICAgICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFNlY3VyaXR5IHNldDogIiArIHNlY3VyaXR5KTsKCXBob25vc1twaG9ub0lkXS5waG9uZS5zZWN1cml0eShzZWN1cml0eSk7CiAgICB9KTsgCiAgICAkKCcuZmxhc2hIZWxwIGEnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7CgkkKCIuZmxhc2gtaGxkciIpLmNzcygibGVmdCIsIjI1MC41cHgiKTsKCXRoaXNQaG9uby5maW5kKCIuZmxhc2hIZWxwIikudGV4dCgiVHJ5IGFnYWluIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICAKICAgICQoJy5jaGF0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgY2hhdFRvID0gJC50cmltKCQoIiMiK3RoaXNQaG9ubykuZmluZCgiLmNoYXRUbyIpLnZhbCgpKTsKCWNyZWF0ZU5ld0NoYXQodGhpc1Bob25vLCBjaGF0VG8sICIiKTsKICAgIH0pOwogICAgCiAgICAkKCcuc2VuZE1zZycpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXZhciB0aGlzQ2hhdCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIik7Cgl2YXIgbXNnVGV4dCA9IHRoaXNDaGF0LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS52YWwoKTsKCXZhciBuZXdNc2cgPSBjaGF0TWVzc2FnZSgiWW91Iixtc2dUZXh0LCJvdXRnb2luZyIpOwoJcmVuZGVyTmV3TWVzc2FnZSh0aGlzQ2hhdCxuZXdNc2cpOwoJcGhvbm9zW3RoaXNQaG9uby5hdHRyKCJpZCIpXS5tZXNzYWdpbmcuc2VuZChjaGF0c1t0aGlzQ2hhdC5hdHRyKCJpZCIpXSxtc2dUZXh0KTsKCXRoaXNDaGF0LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS52YWwoIiIpOwoJY29uc29sZS5sb2coIlsiK3RoaXNQaG9uby5hdHRyKCdpZCcpKyJdIFNlbmRpbmcgbWVzc2FnZSB0bzogIiArIGNoYXRzW3RoaXNDaGF0LmF0dHIoJ2lkJyldICsgIiBbIiArIG1zZ1RleHQgKyAiXSIpOwogICAgfSk7CiAgICAKICAgICQoJy5oYW5ndXAnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLmhhbmd1cCgpOwoJCgkkKCIjIit0aGlzQ2FsbCkuc2xpZGVVcCgiZmFzdCIsIGZ1bmN0aW9uKCl7CgkgICAgJCh0aGlzKS5yZW1vdmUoKTsJCgl9KTsKICAgIH0pOwogICAgCiAgICAkKCcuYW5zd2VyJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciBjYWxsRGl2ID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKTsKCWNhbGxzW2NhbGxEaXYuYXR0cigiaWQiKV0uYW5zd2VyKCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsQ29udHJvbHMiKS5oaWRlKCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsSW5wdXRzIikuc2hvdygpOwoJY29uc29sZS5sb2coIkNhbGwgYW5zd2VyZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcubXV0ZScpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0ubXV0ZSh0cnVlKTsKICAgICAgICBpZiAoY2FsbHNbdGhpc0NhbGxdLm11dGUoKSkgewogICAgICAgICAgICAkKCcubXV0ZScpLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICQoJy51bk11dGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICAkKCcudW5NdXRlJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS5tdXRlKGZhbHNlKTsKICAgICAgICBpZiAoIWNhbGxzW3RoaXNDYWxsXS5tdXRlKCkpIHsKICAgICAgICAgICAgJCgnLnVuTXV0ZScpLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICQoJy5tdXRlJykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKICAgICAgICB9CiAgICB9KTsKICAgIAogICAgJCgnLmRpZ2l0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCXZhciB0aGVEaWdpdCA9ICQodGhpcykuYXR0cigidmFsdWUiKTsKCWNhbGxzW3RoaXNDYWxsXS5kaWdpdCh0aGVEaWdpdCk7CiAgICB9KTsKICAgIAogICAgJCgnLnRhbGtTdGFydCcpLmxpdmUoJ21vdXNlZG93bicsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLnRhbGtpbmcodHJ1ZSk7CiAgICB9KTsKICAgIAogICAgJCgnLnRhbGtTdGFydCcpLmxpdmUoJ21vdXNldXAnLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS50YWxraW5nKGZhbHNlKTsKICAgIH0pOwogICAgCiAgICAkKCcuc2hvd0NhbGwnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl0aGlzUGhvbm8uZmluZCgiLnBob25lSW5wdXQiKS5zaG93KCk7Cgl0aGlzUGhvbm8uZmluZCgiLmNoYXRJbnB1dCIpLmhpZGUoKTsKICAgIH0pOwogICAgCiAgICAkKCcudGV4dCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXZhciB0byA9IHRoaXNQaG9uby5maW5kKCIuamlkIikudmFsKCk7Cgl2YXIgbXNnID0gdGhpc1Bob25vLmZpbmQoIi5tc2dCb2R5IikudmFsKCk7CglzZW5kTWVzc2FnZSh0aGlzUGhvbm8uYXR0cigiaWQiKSx0byxtc2cpOwoJdGhpc1Bob25vLmZpbmQoIi5tc2dCb2R5IikudmFsKCIiKTsKICAgIH0pOwogICAgCiAgICAkKCIubG9nVG9nZ2xlciIpLmNsaWNrKGZ1bmN0aW9uKCl7CglpZiggJCgiI2xvZ0NvbnNvbGUiKS5jc3MoImhlaWdodCIpID09ICIyNXB4IiApewoJICAgICQoIiNsb2dDb25zb2xlIikuY3NzKCJoZWlnaHQiLCIyNDVweCIpOwoJICAgICQoImJvZHkiKS5jc3MoIm1hcmdpbi1ib3R0b20iLCIyODVweCIpOwoJICAgICQodGhpcykudGV4dCgiSGlkZSBMb2cgVmlld2VyIik7Cgl9ZWxzZXsKCSAgICAkKCIjbG9nQ29uc29sZSIpLmNzcygiaGVpZ2h0IiwiMjVweCIpOwoJICAgICQoImJvZHkiKS5jc3MoIm1hcmdpbi1ib3R0b20iLCIyNXB4Iik7CgkgICAgJCh0aGlzKS50ZXh0KCJTaG93IExvZyBWaWV3ZXIiKTsKCX0KCQoJcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgaWYod2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9ICJodHRwczoiICYmIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAhPSAiaHR0cDoiICYmICFpc0lPUygpICYmICFpc0FuZHJvaWQoKSl7Cgl2YXIgZXJyb3JUZXh0ID0gIkxvb2tzIGxpa2UgeW91IGFyZSBydW5uaW5nIHRoaXMgc2FtcGxlIGxvY2FsbHkgYW5kIG5vdCBvbiBhIHdlYiBzZXJ2ZXIuIFRvIHJ1biB0aGlzIGV4YW1wbGUsIGVpdGhlciBsb2FkIGl0IGZyb20gYSB3ZWIgc2VydmVyIG9yIDxhIGhyZWY9J2h0dHA6Ly93d3cubWFjcm9tZWRpYS5jb20vc3VwcG9ydC9kb2N1bWVudGF0aW9uL2VuL2ZsYXNocGxheWVyL2hlbHAvc2V0dGluZ3NfbWFuYWdlcjA0Lmh0bWwnIHRhcmdldD0nX2JsYW5rJz5lZGl0IHlvdXIgRmxhc2ggc2VjdXJpdHkgc2V0dGluZ3M8L2E+LiI7CgllcnJvclRleHQgKz0gIjxici8+U2VsZWN0IFwiRWRpdCBsb2NhdGlvbnNcIiA+IFwiQWRkIGxvY2F0aW9uXCIgPiBcIkJyb3dzZSBmb3IgZm9sZGVyXCIgYW5kIHNlbGVjdCB0aGUgXCIvanNcIiBmb2xkZXIgaW4gdGhlIHJvb3Qgb2YgeW91ciBkb3dubG9hZC4iOwoJZXJyb3JUZXh0ICs9ICIgPGEgaHJlZj0nIycgb25jbGljaz0nJCh0aGlzKS5wYXJlbnQoKS5zbGlkZVVwKCk7Jz5DbG9zZSB0aGlzPC9hPiI7Cgl2YXIgZXJyb3JCb3ggPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJlcnJvciIpCgkgICAgLmh0bWwoZXJyb3JUZXh0KQoJICAgIC5wcmVwZW5kVG8oImJvZHkiKTsKICAgIH0KCiAgICBpZiAodXJsUGFyYW0oImNvbm5lY3Rpb25VcmwiKSAhPSB1bmRlZmluZWQgJiYgdXJsUGFyYW0oImppZCIpICE9IHVuZGVmaW5lZCAmJiB1cmxQYXJhbSgicGFzc3dvcmQiKSAhPSB1bmRlZmluZWQpIHsKICAgICAgICBjb25uZWN0aW9uID0gbmV3IFN0cm9waGUuQ29ubmVjdGlvbih1cmxQYXJhbSgiY29ubmVjdGlvblVybCIpKTsKICAgICAgICBjb25uZWN0aW9uLmNvbm5lY3QodXJsUGFyYW0oImppZCIpICsgIi9waG9ubyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybFBhcmFtKCJwYXNzd29yZCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihzdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVEVEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zZW5kKCRwcmVzKCkudHJlZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVOZXdQaG9ubyhjb25uZWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBjcmVhdGVOZXdQaG9ubyhudWxsKTsKICAgIH0KfSk7Cgo=",
                "body": "LyogS2l0Y2hlbiBTaW5rICovCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgLyogdXNlIGNvZGUgbGlrZSB0aGlzIHRvIHNlcGNpZml5IGEgcGFydGljdWxhciBjb2RlYy4gKi8KICAgIC8qCiAgICAgUGhvbm8udXRpbC5maWx0ZXJXaWRlYmFuZCA9IGZ1bmN0aW9uKG9mZmVyLCB3aWRlYmFuZCkgewogICAgICAgIHZhciBjb2RlY3MgPSBuZXcgQXJyYXkoKTsKICAgICAgICBQaG9uby51dGlsLmVhY2gob2ZmZXIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIXdpZGViYW5kKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lLnRvVXBwZXJDYXNlKCkgPT0gIkc3MjIiICYmIHRoaXMucmF0ZSA9PSAiODAwMCIpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlY3MucHVzaCh0aGlzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5uYW1lID09ICJ0ZWxlcGhvbmUtZXZlbnQiKXsKICAgICAgICAgICAgICAgICAgICBjb2RlY3MucHVzaCh0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNvZGVjczsKICAgIH07ICAgCiAgICAqLyAKCiAgICB2YXIgcGhvbm9zPXt9LCBjYWxscz17fSwgY2hhdHM9e307CgogICAgZnVuY3Rpb24gdXJsUGFyYW0obmFtZSl7Cgl2YXIgcmVzdWx0cyA9IG5ldyBSZWdFeHAoJ1tcXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpLmV4ZWMod2luZG93LmxvY2F0aW9uLmhyZWYpOwoJaWYgKCFyZXN1bHRzKSB7IHJldHVybiB1bmRlZmluZWQ7IH0KCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXSkgfHwgdW5kZWZpbmVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld1Bob25vKGNvbm5lY3Rpb24pewoJLy9DbG9uZSBhIHBob25vIGRpdgoJdmFyIHBob25vQ3RyID0gKCQoIi5waG9ubyIpLnNpemUoKSArIDEpIC0gMTsKCXZhciBuZXdQaG9ub0lEID0gIlBob25vIiArIHBob25vQ3RyOwoJdmFyIGZpcnN0UGhvbm8gPSAkKCcucGhvbm8nKS5maXJzdCgpCgl2YXIgbmV3UGhvbm9EaXYgPSBmaXJzdFBob25vLmNsb25lKCkKICAgICAgICB2YXIgYXVkaW9UeXBlID0gJCgnLmF1ZGlvLXBsdWdpbicpLnZhbCgpOwogICAgICAgIHZhciBicmlkZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIGNvbm5lY3Rpb25VcmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrIi8vYXBwLnYxLnBob25vLmNvbS9odHRwLWJpbmQiOwogICAgICAgIHZhciBwcm92aXNpb25pbmdVcmwgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGRpYWxTdHJpbmcgPSAic2lwOjMzNjZAbG9naW4uemlwZHguY29tIjsKICAgICAgICB2YXIgY2hhdFN0cmluZyA9ICJlbjJmckBib3QudGFsay5nb29nbGUuY29tIjsKICAgICAgICB2YXIgZ3cgPSAiZ3ctdjYuZC5waG9uby5jb20iOwogICAgICAgIAogICAgICAgIGlmIChjb25uZWN0aW9uVXJsLmluZGV4T2YoImZpbGU6IikgPT0gMCl7CiAgICAgICAgICAgIGNvbm5lY3Rpb25VcmwgPSAiaHR0cDovL2FwcC52MS5waG9uby5jb20vaHR0cC1iaW5kIjsKICAgICAgICB9CgogICAgICAgIC8vIERvIHdlIGhhdmUgVVJMIHBhcmFtZXRlcnMgdG8gb3ZlcnJpZGUgaGVyZT8KICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJhdXRvIiAmJiB1cmxQYXJhbSgiYXVkaW8iKSAhPSB1bmRlZmluZWQpIGF1ZGlvVHlwZSA9IHVybFBhcmFtKCJhdWRpbyIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiY29ubmVjdGlvblVybCIpICE9IHVuZGVmaW5lZCkgY29ubmVjdGlvblVybCA9IHVybFBhcmFtKCJjb25uZWN0aW9uVXJsIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJwcm92aXNpb25pbmdVcmwiKSAhPSB1bmRlZmluZWQpIHByb3Zpc2lvbmluZ1VybCA9IHVybFBhcmFtKCJwcm92aXNpb25pbmdVcmwiKTsKICAgICAgICBpZiAodXJsUGFyYW0oImRpYWwiKSAhPSB1bmRlZmluZWQpIGRpYWxTdHJpbmcgPSB1cmxQYXJhbSgiZGlhbCIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiY2hhdCIpICE9IHVuZGVmaW5lZCkgY2hhdFN0cmluZyA9IHVybFBhcmFtKCJjaGF0Iik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJnYXRld2F5IikgIT0gdW5kZWZpbmVkKSBndyA9IHVybFBhcmFtKCJnYXRld2F5Iik7CgogICAgICAgIGNvbnNvbGUubG9nKCJhdWRpb1R5cGUgPSAiICsgYXVkaW9UeXBlKTsKICAgICAgICBjb25zb2xlLmxvZygiZGlhbFN0cmluZyA9ICIgKyBkaWFsU3RyaW5nKTsKICAgICAgICBjb25zb2xlLmxvZygiY2hhclN0cmluZyA9ICIgKyBjaGF0U3RyaW5nKTsKCgluZXdQaG9ub0Rpdi5hdHRyKCJpZCIsbmV3UGhvbm9JRCkuYXBwZW5kVG8oJy5waG9ub0hsZHInKS5zaG93KCk7CgluZXdQaG9ub0Rpdi5maW5kKCIucGhvbm9JRCIpLnRleHQobmV3UGhvbm9JRCsiOiIpOwogICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5hdWRpb1R5cGUiKS50ZXh0KGF1ZGlvVHlwZSk7CiAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmNhbGxUbyIpLnZhbChkaWFsU3RyaW5nKTsKICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuY2hhdFRvIikudmFsKGNoYXRTdHJpbmcpOwoKICAgICAgICB2YXIgYXVkaW8gPSBhdWRpb1R5cGU7CiAgICAgICAgdmFyIHZpZGVvID0gZmFsc2U7CgogICAgICAgIHZhciBwcm90b2NvbCA9ICJzaXA6IjsKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJ3ZWJydGMiIHx8IGF1ZGlvVHlwZSA9PSAianNlcCIpIHByb3RvY29sID0gInhtcHA6IjsKCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAiZmxhc2giKSB7CiAgICAgICAgICAgIGd3ID0gImd3LXYzLmQucGhvbm8uY29tIjsKICAgICAgICAgICAgYXVkaW8gPSAiZmxhc2giOwogICAgICAgICAgICBicmlkZ2VkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gInBhbmRhIikgewogICAgICAgICAgICBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImZsYXNoIjsKICAgICAgICAgICAgYnJpZGdlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAicGFuZGFicmlkZ2VkIikgewogICAgICAgICAgICBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImZsYXNoIjsKICAgICAgICAgICAgYnJpZGdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJqc2VwIikgewogICAgICAgICAgICBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImpzZXAiOwogICAgICAgICAgICB2aWRlbyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHBob25vc1tuZXdQaG9ub0lEXSA9ICQucGhvbm8oewoJICAgIGFwaUtleTogIkMxN0QxNjdGLTA5QzYtNEU0Qy1BM0RELTIwMjVENDhCQTI0MyIsCiAgICAgICAgICAgIGNvbm5lY3Rpb25Vcmw6Y29ubmVjdGlvblVybCwKICAgICAgICAgICAgcHJvdmlzaW9uaW5nVXJsOnByb3Zpc2lvbmluZ1VybCwKICAgICAgICAgICAgZ2F0ZXdheTpndywKICAgICAgICAgICAgY29ubmVjdGlvbjogY29ubmVjdGlvbiwKICAgICAgICAgICAgCiAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgYmFzZVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cmluZygwLCB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCc/JykpOwogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLnNlc3Npb25JZCIpLmh0bWwoIjxhIGNsYXNzPSdzZXNzaW9uSWQnIHRhcmdldD0nX2JsYW5rJyBocmVmPSciICsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlVXJsICsgIj9hdWRpbz0iICsgYXVkaW9UeXBlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiJmNvbm5lY3Rpb25Vcmw9IiArIGNvbm5lY3Rpb25VcmwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICImZGlhbD0iICsgcHJvdG9jb2wgKyB0aGlzLnNlc3Npb25JZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiZjaGF0PSIgKyB0aGlzLnNlc3Npb25JZCArICInPiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRoaXMuc2Vzc2lvbklkICsgIjwvYT4iKTsKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5waG9uZUNvbnRyb2wiKS5zaG93KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YodGhpcy5hdWRpbykgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQodGhpcy5hdWRpby50eXBlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdWRpby50eXBlID09ICJmbGFzaCIgJiYgZ3cgPT0gImd3LXY2LmQucGhvbm8uY29tIikgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW9UeXBlIikudGV4dChicmlkZ2VkPyJmbGFzaCAobmV3IC0gYnJpZGdlZCkiOiJmbGFzaCAobmV3KSIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdWRpby50eXBlID09ICJmbGFzaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQoImZsYXNoIChvbGQpIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvLmF1ZGlvSW5EZXZpY2VzKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluTGlzdCA9IHRoaXMuYXVkaW8uYXVkaW9JbkRldmljZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgaW5MaXN0ID0gWyJBIiwiQiIsIkMiXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImRldmljZXMgYXJlIDoiK2luTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobD0wO2w8aW5MaXN0Lmxlbmd0aDtsKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goJzxvcHRpb24gdmFsdWU9IicrIGluTGlzdFtsXSArJyI+JysgaW5MaXN0W2xdICsnPC9vcHRpb24+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvLWlucHV0IikuaHRtbChvdXRwdXQuam9pbignJykpOzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gUGhvbm8gbG9hZGVkIik7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmKCAhIHRoaXMuYXVkaW8ucGVybWlzc2lvbigpICl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW8uc2hvd1Blcm1pc3Npb25Cb3goKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25VbnJlYWR5OiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLnNlc3Npb25JZCIpLnRleHQoImRpc2Nvbm5lY3RlZCIpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gUGhvbm8gZGlzY29ubmVjdGVkIik7ICAKICAgICAgICAgICAgfSwJCSAgIAogICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLnNlc3Npb25JZCIpLnRleHQoZXZlbnQucmVhc29uKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LnJlYXNvbik7ICAKICAgICAgICAgICAgfSwJCSAgIAoJICAgIGF1ZGlvOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBhdWRpbywKICAgICAgICAgICAgICAgIGphcjogIi4uLy4uLy4uL3BsdWdpbnMvYXVkaW8vcGhvbm8uYXVkaW8uamFyIiwKICAgICAgICAgICAgICAgIHN3ZjogIi4uLy4uLy4uL3BsdWdpbnMvYXVkaW8vcGhvbm8uYXVkaW8uc3dmIiwKICAgICAgICAgICAgICAgIG1lZGlhOiB7YXVkaW86dHJ1ZSwgdmlkZW86dmlkZW99LAogICAgICAgICAgICAgICAgYnJpZGdlZDogYnJpZGdlZCwKICAgICAgICAgICAgICAgIG9uUGVybWlzc2lvbkJveFNob3c6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gRmxhc2ggcGVybWlzc2lvbiBib3ggbG9hZGVkIik7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9uUGVybWlzc2lvbkJveEhpZGU6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gRmxhc2ggcGVybWlzc2lvbiBib3ggY2xvc2VkIik7CiAgICAgICAgICAgICAgICAgICAgaWYoICEgdGhpcy5wZXJtaXNzaW9uKCkgKXsKICAgICAgIAkJICAgIAl0aGlzLnNob3dQZXJtaXNzaW9uQm94KCk7CiAgICAgICAJCSAgICB9CiAgICAgICAgICAgICAgICB9CgkgICAgfSwJICAgICAgCgkgICAgcGhvbmU6IHsKICAgICAgICAgICAgICAgIHJpbmdUb25lOiAicmluZ3RvbmVzL0RpZ2d6dG9uZV9NYXJpbWJhLm1wMyIsCiAgICAgICAgICAgICAgICByaW5nYmFja1RvbmU6ICJyaW5ndG9uZXMvcmluZ2JhY2stdXMubXAzIiwKICAgICAgICAgICAgICAgIG9uSW5jb21pbmdDYWxsOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgIC8vIHdhcyBwdXNoIHRvIHRhbGsgZW5hYmxlZCBmb3IgY2FsbHM/CgkJICAgIHZhciBwdHRFbmFibGVkOwoJCSAgICAoJCgiIyIrbmV3UGhvbm9JRCkuZmluZCgiLnB1c2gtdG8tdGFsayIpLmlzKCI6Y2hlY2tlZCIpKSA/IHB0dEVuYWJsZWQgPSB0cnVlIDogcHR0RW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZhciBuZXdDYWxsSUQgPSBjcmVhdGVDYWxsRGl2KG5ld1Bob25vSUQsImluY29taW5nIixwdHRFbmFibGVkKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3Q2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CiAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbEhlYWRlciAuY2FsbERldGFpbCIpLmh0bWwoIjxzdHJvbmc+SW5jb21pbmcgY2FsbCBmcm9tOiA8L3N0cm9uZz4iICsgZXZlbnQuY2FsbC5pbml0aWF0b3IpOwogICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxIZWFkZXIgLmNhbGxJRCIpLmh0bWwobmV3Q2FsbElEKTsKICAgICAgICAgICAgCSAgICBjYWxsc1tuZXdDYWxsSURdID0gZXZlbnQuY2FsbDsKICAgICAgICAgICAgCSAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBOZXcgaW5jb21pbmcgY2FsbCIpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50LmNhbGwudG9uZXModHJ1ZSk7IAogICAgICAgICAgICAJICAgIC8vQmluZCBldmVudHMgZnJvbSB0aGlzIGNhbGwKICAgICAgICAgICAgCSAgICBjYWxsc1tuZXdDYWxsSURdLmJpbmQoewogICAgICAgICAgICAgCSAgICAgICAgb25IYW5ndXA6IGZ1bmN0aW9uKGV2ZW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5UG9sbCk7CiAgICAgICAgICAgICAJICAgICAgICAgICAgbmV3Q2FsbERpdi5zbGlkZVVwKCk7CiAgICAgICAgICAgICAJICAgICAgICAgICAgY2FsbHNbbmV3Q2FsbElEXSA9IG51bGw7CiAgICAgICAgICAgICAJICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGwgaHVuZ3VwIik7CiAgICAgICAgICAgICAJICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBvbkFuc3dlcjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWN1cmUgPSBjYWxsc1tuZXdDYWxsSURdLnNlY3VyZSgpOwogICAgICAgICAgICAJICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGwgYW5zd2VyZWQgdXNpbmcgIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMubmFtZSArICIvIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMucmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsQ29kZWMiKS5odG1sKCI8c3Ryb25nPkNvZGVjOjwvc3Ryb25nPiAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxTZWN1cmUiKS5odG1sKHNlY3VyZSA/ICIoc2VjdXJlKSIgOiAiIik7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3lQb2xsID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCl7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gIjxzdHJvbmc+TWljOjwvc3Ryb25nPiAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lID0gY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3koKS5taWM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTwxMDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIrICgoaSA8IG1lKT8iWCI6Il8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbE1pY0VuZXJneSIpLmh0bWwoc3RyKTsJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gIjxzdHJvbmc+U3BrOjwvc3Ryb25nPiAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlID0gY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3koKS5zcGs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTwxMDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIrICgoaSA8IHNlKT8iWCI6Il8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbFNwa0VuZXJneSIpLmh0bWwoc3RyKTsJCgkJICAgICAgICAgICAgfSw1MDApOwoJCQkgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAJICAgICAgICBvbkVycm9yOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgCSAgIAkgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gWyIrbmV3Q2FsbElEKyJdIEVycm9yOiBbIiArIGV2ZW50LnJlYXNvbiArICJdIik7CiAgICAgICAgICAgICAJICAgICAgICB9CiAgICAgICAgICAgIAkgICAgfSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgCSAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBFcnJvcjogWyIgKyBldmVudC5yZWFzb24gKyAiXSIpOwogICAgICAgICAgICAgICAgfQoJICAgIH0sCgkgICAgCgkgICAgbWVzc2FnaW5nOiB7CiAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKGV2ZW50LCBtZXNzYWdlKSB7CiAgICAgICAgICAgIAkgICAgdmFyIEpJRCA9IG1lc3NhZ2UuZnJvbS5zcGxpdCgiLyIpOwogICAgICAgICAgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIE1lc3NhZ2UgZnJvbSAiICsgSklEWzBdICsgIiBbIiArIG1lc3NhZ2UuYm9keSArICJdIik7CiAgICAgICAgICAgIAkgICAgcm91dGVNZXNzYWdlKG5ld1Bob25vSUQsImluY29taW5nIixKSURbMF0sbWVzc2FnZS5ib2R5KTsKICAgICAgICAgICAgICAgIH0KCSAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAgICAgCiAgICAvL0NyZWF0ZXMgYSBuZXcgY2FsbAogICAgZnVuY3Rpb24gY3JlYXRlTmV3Q2FsbChwaG9ub0lELCB0byl7CgkvL2Nsb25lIGEgY2FsbCBib3gKCXZhciBwaG9ub0RpdiA9ICQoIiMiK3Bob25vSUQpOwoJCgkvLyB3YXMgcHVzaCB0byB0YWxrIGVuYWJsZWQgZm9yIGNhbGxzPwoJdmFyIHB0dEVuYWJsZWQ7CgkocGhvbm9EaXYuZmluZCgiLnB1c2gtdG8tdGFsayIpLmlzKCI6Y2hlY2tlZCIpKSA/IHB0dEVuYWJsZWQgPSB0cnVlIDogcHR0RW5hYmxlZCA9IGZhbHNlOwoJCgl2YXIgbmV3Q2FsbElEID0gY3JlYXRlQ2FsbERpdihwaG9ub0lELCJvdXRnb2luZyIscHR0RW5hYmxlZCk7Cgl2YXIgY2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsSUQiKS50ZXh0KG5ld0NhbGxJRCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsRGV0YWlsIikuaHRtbCgiPHN0cm9uZz5PdXRnb2luZyBjYWxsIHRvOjwvc3Ryb25nPiAiICsgdG8pOwoJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGxpbmcgIit0byk7CgkKCWNhbGxzW25ld0NhbGxJRF0gPSBwaG9ub3NbcGhvbm9JRF0ucGhvbmUuZGlhbCh0bywgewoJICAgIHRvbmVzOiB0cnVlLAoJICAgIHB1c2hUb1RhbGs6IHB0dEVuYWJsZWQsCiAgICAgICAgICAgIG9uQW5zd2VyOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHNlY3VyZSA9IGNhbGxzW25ld0NhbGxJRF0uc2VjdXJlKCk7CiAgICAgICAgICAgIAljb25zb2xlLmxvZygiWyIrcGhvbm9EaXYuYXR0cignaWQnKSsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBhbnN3ZXJlZCB1c2luZyAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxDb2RlYyIpLmh0bWwoIjxzdHJvbmc+Q29kZWM6PC9zdHJvbmc+ICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbFNlY3VyZSIpLmh0bWwoc2VjdXJlID8gIihzZWN1cmUpIiA6ICIiKTsgCiAgICAgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCSAgICAgICAgICAgICB2YXIgY2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CiAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICI8c3Ryb25nPk1pYzo8L3N0cm9uZz4gIjsKICAgICAgICAgICAgICAgICAgICAgbWUgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLm1pYzsKICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTwxMDtpKyspewogICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgbWUpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxNaWNFbmVyZ3kiKS5odG1sKHN0cik7CQogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgc3RyID0gIjxzdHJvbmc+U3BrOjwvc3Ryb25nPiAiOwogICAgICAgICAgICAgICAgICAgICBzZSA9IGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5KCkuc3BrOwogICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyKyAoKGkgPCBzZSk/IlgiOiJfIik7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbFNwa0VuZXJneSIpLmh0bWwoc3RyKTsJCgkJfSw1MDApOwoJCQkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25IYW5ndXA6IGZ1bmN0aW9uKCkgewoJCXdpbmRvdy5jbGVhckludGVydmFsKGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5UG9sbCk7CiAgICAgICAgICAgIAljYWxsc1tuZXdDYWxsSURdID0gbnVsbDsKICAgICAgICAgICAgCSQoIiMiK25ld0NhbGxJRCkuc2xpZGVVcCgpOwogICAgICAgICAgICAJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGwgaHVuZ3VwIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjYWxsc1tuZXdDYWxsSURdLnBob25vSUQgPSBwaG9ub0lEOwogICAgfQogICAgCiAgICAvL1JvdXRlcyBhIG1lc3NhZ2UgdG8gdGhlIGFwcHJvcHJpYXRlIGNoYXQgb3IgY3JlYXRlcyBhIG5ldyBjaGF0CiAgICBmdW5jdGlvbiByb3V0ZU1lc3NhZ2UocGhvbm9JRCwgdHlwZSwgamlkLCBtZXNzYWdlKXsKCXZhciB0aGVDaGF0ID0gIiI7CgkkLmVhY2goY2hhdHMsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKCSAgICBpZiggdmFsdWUgPT0gamlkICl7CgkJdGhlQ2hhdCA9IGtleTsKCQl2YXIgbmV3TXNnID0gY2hhdE1lc3NhZ2UoamlkLG1lc3NhZ2UsImluYm91bmQiKTsKCQl2YXIgY2hhdERpdiA9ICQoIiMiK3RoZUNoYXQpOwoJCXJlbmRlck5ld01lc3NhZ2UoY2hhdERpdiwgbmV3TXNnKTsKCQljaGF0RGl2LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS5mb2N1cygpOwoJCXJldHVybjsKCSAgICB9CiAgIAl9KTsKICAgCQogCS8vRGlkIHdlIGZpbmQgYSBjaGF0PwoJaWYoISB0aGVDaGF0Lmxlbmd0aCl7CgkgICAgY3JlYXRlTmV3Q2hhdChwaG9ub0lELGppZCxtZXNzYWdlKTsKCX0KICAgIH0KICAgIAogICAgLy9PdXRwdXRzIGFuIElNIG1lc3NhZ2UKICAgIGZ1bmN0aW9uIHJlbmRlck5ld01lc3NhZ2UoY2hhdCwgbXNnKXsKCWNoYXQuZmluZCgiLmNoYXRCb3giKS5hcHBlbmQobXNnKTsKCWNoYXQuZmluZCgiLmNoYXRCb3giKS5hdHRyKHsgc2Nyb2xsVG9wOiBjaGF0LmZpbmQoIi5jaGF0Qm94IikuYXR0cigic2Nyb2xsSGVpZ2h0IikgfSk7CiAgICB9CiAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBkaXYgdG8gaG9sZCBhIGNhbGwuIFJldHVybnMgdGhlIGlkIG9mIHRoZSBuZXcgZGl2CiAgICBmdW5jdGlvbiBjcmVhdGVDYWxsRGl2KHBob25vSUQsY2FsbFR5cGUscHR0RW5hYmxlZCl7CgkvL2Nsb25lIGEgY2FsbCBib3gKCXZhciBwaG9ub0RpdiA9ICQoIiMiK3Bob25vSUQpOwoJdmFyIGNhbGxCb3ggPSBwaG9ub0Rpdi5maW5kKCIuY2FsbHMiKTsKCXZhciBuZXdDYWxsQ3RyID0gKCQoIi5jYWxsSGxkciIpLnNpemUoKSArIDEpIC0gMjsKCW5ld0NhbGxJRCA9ICJDYWxsIiArIG5ld0NhbGxDdHI7Cgl2YXIgZmlyc3RDYWxsID0gJCgiLmNhbGxIbGRyIikuZmlyc3QoKQoJdmFyIG5ld0NhbGxEaXYgPSBmaXJzdENhbGwuY2xvbmUoKQoJbmV3Q2FsbERpdi5hdHRyKCJpZCIsbmV3Q2FsbElEKS5hcHBlbmRUbyhjYWxsQm94KS5zaG93KCk7CgkKCWlmKCBjYWxsVHlwZSA9PSAib3V0Z29pbmciKXsKCSAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsSW5wdXRzIikuc2hvdygpOwoJfWVsc2V7CgkgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbENvbnRyb2xzIikuc2hvdygpOwoJfQoJCglwdHRFbmFibGVkID8gbmV3Q2FsbERpdi5maW5kKCIudGFsa1N0YXJ0Iikuc2hvdygpIDogbmV3Q2FsbERpdi5maW5kKCIudGFsa1N0YXJ0IikuaGlkZSgpOwoJCglyZXR1cm4gbmV3Q2FsbElEOwogICAgfQogICAgCiAgICAvL0NyZWF0ZXMgYSBuZXcgY2hhdAogICAgZnVuY3Rpb24gY3JlYXRlTmV3Q2hhdChwaG9ub0lELCB0bywgbWVzc2FnZSl7CgkvL2Nsb25lIGEgY2hhdCBib3gKCXZhciBwaG9ub0RpdiA9ICQoIiMiK3Bob25vSUQpOwoJdmFyIG5ld0NoYXRJRCA9IGNyZWF0ZUNoYXREaXYocGhvbm9JRCk7Cgl2YXIgY2hhdERpdiA9ICQoIiMiK25ld0NoYXRJRCk7CgljaGF0RGl2LmZpbmQoIi5jaGF0SUQiKS50ZXh0KG5ld0NoYXRJRCk7CgljaGF0RGl2LmZpbmQoIi5jaGF0RGV0YWlsIikuaHRtbCh0byk7CgkKCWlmKCBtZXNzYWdlLmxlbmd0aCApewoJICAgIHZhciBuZXdNc2cgPSBjaGF0TWVzc2FnZSh0byxtZXNzYWdlLCJpbmJvdW5kIik7CgkgICAgcmVuZGVyTmV3TWVzc2FnZShjaGF0RGl2LCBuZXdNc2cpOwoJfQoJCgljb25zb2xlLmxvZygiWyIrcGhvbm9EaXYuYXR0cignaWQnKSsiXSBbIituZXdDaGF0SUQrIl0gQ2hhdCBzdGFydGVkIHdpdGggIiArIHRvKTsKCQoJY2hhdHNbbmV3Q2hhdElEXSA9IHRvOwogICAgfQogICAgCiAgICAvL0NyZWF0ZXMgYSBuZXcgZGl2IHRvIGhvbGQgYSBjaGF0LiBSZXR1cm5zIHRoZSBpZCBvZiB0aGUgbmV3IGRpdgogICAgZnVuY3Rpb24gY3JlYXRlQ2hhdERpdihwaG9ub0lEKXsKCS8vY2xvbmUgYSBjaGF0IGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7Cgl2YXIgY2hhdEJveCA9IHBob25vRGl2LmZpbmQoIi5jaGF0cyIpOwoJdmFyIG5ld0NoYXRDdHIgPSAoJCgiLmNoYXRIbGRyIikuc2l6ZSgpICsgMSkgLSAyOwoJbmV3Q2hhdElEID0gIkNoYXQiICsgbmV3Q2hhdEN0cjsKCXZhciBmaXJzdENoYXQgPSAkKCIuY2hhdEhsZHIiKS5maXJzdCgpOwoJdmFyIG5ld0NoYXREaXYgPSBmaXJzdENoYXQuY2xvbmUoKTsKCW5ld0NoYXREaXYuYXR0cigiaWQiLG5ld0NoYXRJRCkuYXBwZW5kVG8oY2hhdEJveCkuc2hvdygpOwoJbmV3Q2hhdERpdi5maW5kKCIuY2hhdFR4dElucHV0IikuZm9jdXMoKTsKCQoJcmV0dXJuIG5ld0NoYXRJRDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lPUygpIHsKICAgICAgICB2YXIgdXNlckFnZW50ID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICAgICAgaWYgKHVzZXJBZ2VudC5tYXRjaCgvaVBhZC9pKSB8fCB1c2VyQWdlbnQubWF0Y2goL2lQaG9uZS9pKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBpc0FuZHJvaWQoKSB7CiAgICAgICAgdmFyIHVzZXJBZ2VudCA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50OwogICAgICAgIGlmICh1c2VyQWdlbnQubWF0Y2goL0FuZHJvaWQvaSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLy8gQ3JlYXRlIGFuZCByZXR1cm4gYSBjaGF0IG1lc3NhZ2UgYnViYmxlCiAgICB2YXIgY2hhdE1lc3NhZ2UgPSBmdW5jdGlvbihmcm9tLGJvZHksdHlwZSl7Cgl2YXIgcmVzdWx0OwoJCglpZiggdHlwZSA9PSAnaW5ib3VuZCcpewoJICAgIHZhciBib3JkZXJTdHlsZSA9ICJpbmJvdW5kIjsKCSAgICB2YXIgZnJvbVN0eWxlID0gImZyb21JbmJvdW5kIjsKCX1lbHNlewoJICAgIHZhciBib3JkZXJTdHlsZSA9ICJvdXRib3VuZCI7CgkgICAgdmFyIGZyb21TdHlsZSA9ICJmcm9tT3V0Ym91bmQiOwoJfQoJCglyZXN1bHQgPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJjaGF0RW50cnkiKQoJICAgIC5hZGRDbGFzcyhib3JkZXJTdHlsZSk7Cgl2YXIgZnJvbUhlYWRlciA9ICQoIjxkaXY+IikKCSAgICAuYWRkQ2xhc3MoImZyb20iKQoJICAgIC5hZGRDbGFzcyhmcm9tU3R5bGUpCgkgICAgLmh0bWwoZnJvbSkKCSAgICAuYXBwZW5kVG8ocmVzdWx0KTsKCXZhciBtc2dCb2R5ID0gJCgiPGRpdj4iKQoJICAgIC5hZGRDbGFzcygiYm9keSIpCgkgICAgLmh0bWwoYm9keSkKCSAgICAuYXBwZW5kVG8ocmVzdWx0KTsKCQoJcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgLy9ET00gRXZlbnQgSGFuZGxlcnMKICAgICQoIi5hZGRQaG9ubyIpLmNsaWNrKGZ1bmN0aW9uKCl7CgljcmVhdGVOZXdQaG9ubygpOwoJcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICAKICAgICQoJy5jbG9zZVBob25vJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpOwoJdmFyIHRoaXNQaG9ub0lEID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdGhpc1Bob25vLnNsaWRlVXAoKTsKCiAgICAgICAgLy8gSGFuZ3VwIGFueSBjYWxsIHRoYXQgaXMgaW4gcHJvZ3Jlc3MKICAgICAgICAkLmVhY2goY2FsbHMsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUucGhvbm9JRCA9PSB0aGlzUGhvbm9JRCkgewogICAgICAgICAgICAgICAgdmFsdWUuaGFuZ3VwKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCQoJJCgiIyIrdGhpc0NhbGwpLnNsaWRlVXAoImZhc3QiLCBmdW5jdGlvbigpewoJICAgICQodGhpcykucmVtb3ZlKCk7CQoJfSk7CgoJcGhvbm9zW3RoaXNQaG9uby5hdHRyKCJpZCIpXSA9IG51bGw7CgkKCXRoaXNQaG9uby5maW5kKCIuY2FsbEhsZHIiKS5lYWNoKGZ1bmN0aW9uKCl7CgkgICAgY2FsbHNbJCh0aGlzKS5hdHRyKCJpZCIpXSA9IG51bGw7Cgl9KTsKCWNvbnNvbGUubG9nKCJbIit0aGlzUGhvbm9JRCsiXSBQaG9uZSByZW1vdmVkIik7CiAgICB9KTsKICAgIAogICAgJCgnLmNsb3NlQ2hhdCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NoYXQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpOwoJdmFyIHRoaXNDaGF0SUQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpLmF0dHIoImlkIik7Cgl0aGlzQ2hhdC5zbGlkZVVwKCk7CgljaGF0c1t0aGlzQ2hhdElEXSA9IG51bGw7CQoJY29uc29sZS5sb2coIlsiK3RoaXNDaGF0SUQrIl0gQ2hhdCBjbG9zZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcuY2FsbCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIGNhbGxUbyA9ICQudHJpbSgkKCIjIit0aGlzUGhvbm8pLmZpbmQoIi5jYWxsVG8iKS52YWwoKSk7CgljcmVhdGVOZXdDYWxsKHRoaXNQaG9ubywgY2FsbFRvKTsKICAgIH0pOwogICAgCiAgICAkKCcuaGVhZHNldCcpLmxpdmUoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgaGVhZHNldEVuYWJsZWQgPSAkKCIjIitwaG9ub0lkKS5maW5kKCIuaGVhZHNldCIpLmlzKCI6Y2hlY2tlZCIpOwoJY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gSGVhZHNldDogIiArIGhlYWRzZXRFbmFibGVkKTsKICAgIAlwaG9ub3NbcGhvbm9JZF0ucGhvbmUuaGVhZHNldChoZWFkc2V0RW5hYmxlZCk7CQkKICAgIH0pOwoKICAgICQoJy53aWRlYmFuZCcpLmxpdmUoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIHdpZGViYW5kRGlzYWJsZWQgPSAkKCIjIitwaG9ub0lkKS5maW5kKCIud2lkZWJhbmQiKS5pcygiOmNoZWNrZWQiKTsKCWNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFdpZGViYW5kRGlzYWJsZWQ6ICIgKyB3aWRlYmFuZERpc2FibGVkKTsKICAgIAlwaG9ub3NbcGhvbm9JZF0ucGhvbmUud2lkZWJhbmQoIXdpZGViYW5kRGlzYWJsZWQpOwogICAgfSk7CiAgICAKICAgICQoJy5yaW5nLXRvbmUsIC5yaW5nYmFjay10b25lJykubGl2ZSgkLmJyb3dzZXIubXNpZSA/ICdjbGljayc6ICdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKCXZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIHRvbmUgPSAkKHRoaXMpLnZhbCgpOwoJCglpZigkKHRoaXMpLmhhc0NsYXNzKCJyaW5nLXRvbmUiKSl7CgkgICAgcGhvbm9zW3Bob25vSWRdLnBob25lLnJpbmdUb25lKHRvbmUpOwoJICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFJpbmcgdG9uZSBzZXQ6ICIgKyB0b25lKTsKCX1lbHNlewoJICAgIHBob25vc1twaG9ub0lkXS5waG9uZS5yaW5nYmFja1RvbmUodG9uZSk7CgkgICAgY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gUmluZ2JhY2sgdG9uZSBzZXQ6ICIgKyB0b25lKTsKCX0JCiAgICB9KTsKICAgICQoJy5hdWRpby1pbnB1dCcpLmxpdmUoJC5icm93c2VyLm1zaWUgPyAnY2xpY2snOiAnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKICAgICAgICB2YXIgZGV2aWNlID0gJCh0aGlzKS52YWwoKTsKICAgICAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBBdWRpbyBJbnB1dCBzZXQ6ICIgKyBkZXZpY2UpOwoJcGhvbm9zW3Bob25vSWRdLnBob25lLmF1ZGlvSW5wdXQoZGV2aWNlKTsKICAgIH0pOyAKICAgICQoJy5zZWN1cml0eS1vcHRpb24nKS5saXZlKCQuYnJvd3Nlci5tc2llID8gJ2NsaWNrJzogJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7CiAgICAgICAgdmFyIHNlY3VyaXR5ID0gJCh0aGlzKS52YWwoKTsKICAgICAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBTZWN1cml0eSBzZXQ6ICIgKyBzZWN1cml0eSk7CglwaG9ub3NbcGhvbm9JZF0ucGhvbmUuc2VjdXJpdHkoc2VjdXJpdHkpOwogICAgfSk7IAogICAgJCgnLmZsYXNoSGVscCBhJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpOwoJJCgiLmZsYXNoLWhsZHIiKS5jc3MoImxlZnQiLCIyNTAuNXB4Iik7Cgl0aGlzUGhvbm8uZmluZCgiLmZsYXNoSGVscCIpLnRleHQoIlRyeSBhZ2FpbiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwogICAgCiAgICAkKCcuY2hhdCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIGNoYXRUbyA9ICQudHJpbSgkKCIjIit0aGlzUGhvbm8pLmZpbmQoIi5jaGF0VG8iKS52YWwoKSk7CgljcmVhdGVOZXdDaGF0KHRoaXNQaG9ubywgY2hhdFRvLCAiIik7CiAgICB9KTsKICAgIAogICAgJCgnLnNlbmRNc2cnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl2YXIgdGhpc0NoYXQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpOwoJdmFyIG1zZ1RleHQgPSB0aGlzQ2hhdC5maW5kKCIuY2hhdFR4dElucHV0IikudmFsKCk7Cgl2YXIgbmV3TXNnID0gY2hhdE1lc3NhZ2UoIllvdSIsbXNnVGV4dCwib3V0Z29pbmciKTsKCXJlbmRlck5ld01lc3NhZ2UodGhpc0NoYXQsbmV3TXNnKTsKCXBob25vc1t0aGlzUGhvbm8uYXR0cigiaWQiKV0ubWVzc2FnaW5nLnNlbmQoY2hhdHNbdGhpc0NoYXQuYXR0cigiaWQiKV0sbXNnVGV4dCk7Cgl0aGlzQ2hhdC5maW5kKCIuY2hhdFR4dElucHV0IikudmFsKCIiKTsKCWNvbnNvbGUubG9nKCJbIit0aGlzUGhvbm8uYXR0cignaWQnKSsiXSBTZW5kaW5nIG1lc3NhZ2UgdG86ICIgKyBjaGF0c1t0aGlzQ2hhdC5hdHRyKCdpZCcpXSArICIgWyIgKyBtc2dUZXh0ICsgIl0iKTsKICAgIH0pOwogICAgCiAgICAkKCcuaGFuZ3VwJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS5oYW5ndXAoKTsKCQoJJCgiIyIrdGhpc0NhbGwpLnNsaWRlVXAoImZhc3QiLCBmdW5jdGlvbigpewoJICAgICQodGhpcykucmVtb3ZlKCk7CQoJfSk7CiAgICB9KTsKICAgIAogICAgJCgnLmFuc3dlcicpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgY2FsbERpdiA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIik7CgljYWxsc1tjYWxsRGl2LmF0dHIoImlkIildLmFuc3dlcigpOwoJY2FsbERpdi5maW5kKCIuY2FsbENvbnRyb2xzIikuaGlkZSgpOwoJY2FsbERpdi5maW5kKCIuY2FsbElucHV0cyIpLnNob3coKTsKCWNvbnNvbGUubG9nKCJDYWxsIGFuc3dlcmVkIik7CiAgICB9KTsKICAgIAogICAgJCgnLm11dGUnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLm11dGUodHJ1ZSk7CiAgICAgICAgaWYgKGNhbGxzW3RoaXNDYWxsXS5tdXRlKCkpIHsKICAgICAgICAgICAgJCgnLm11dGUnKS5hdHRyKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOwogICAgICAgICAgICAkKCcudW5NdXRlJykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKICAgICAgICB9CiAgICB9KTsKICAgIAogICAgJCgnLnVuTXV0ZScpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0ubXV0ZShmYWxzZSk7CiAgICAgICAgaWYgKCFjYWxsc1t0aGlzQ2FsbF0ubXV0ZSgpKSB7CiAgICAgICAgICAgICQoJy51bk11dGUnKS5hdHRyKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOwogICAgICAgICAgICAkKCcubXV0ZScpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgICQoJy5kaWdpdCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7Cgl2YXIgdGhlRGlnaXQgPSAkKHRoaXMpLmF0dHIoInZhbHVlIik7CgljYWxsc1t0aGlzQ2FsbF0uZGlnaXQodGhlRGlnaXQpOwogICAgfSk7CiAgICAKICAgICQoJy50YWxrU3RhcnQnKS5saXZlKCdtb3VzZWRvd24nLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS50YWxraW5nKHRydWUpOwogICAgfSk7CiAgICAKICAgICQoJy50YWxrU3RhcnQnKS5saXZlKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0udGFsa2luZyhmYWxzZSk7CiAgICB9KTsKICAgIAogICAgJCgnLnNob3dDYWxsJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpOwoJdGhpc1Bob25vLmZpbmQoIi5waG9uZUlucHV0Iikuc2hvdygpOwoJdGhpc1Bob25vLmZpbmQoIi5jaGF0SW5wdXQiKS5oaWRlKCk7CiAgICB9KTsKICAgIAogICAgJCgnLnRleHQnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl2YXIgdG8gPSB0aGlzUGhvbm8uZmluZCgiLmppZCIpLnZhbCgpOwoJdmFyIG1zZyA9IHRoaXNQaG9uby5maW5kKCIubXNnQm9keSIpLnZhbCgpOwoJc2VuZE1lc3NhZ2UodGhpc1Bob25vLmF0dHIoImlkIiksdG8sbXNnKTsKCXRoaXNQaG9uby5maW5kKCIubXNnQm9keSIpLnZhbCgiIik7CiAgICB9KTsKICAgIAogICAgJCgiLmxvZ1RvZ2dsZXIiKS5jbGljayhmdW5jdGlvbigpewoJaWYoICQoIiNsb2dDb25zb2xlIikuY3NzKCJoZWlnaHQiKSA9PSAiMjVweCIgKXsKCSAgICAkKCIjbG9nQ29uc29sZSIpLmNzcygiaGVpZ2h0IiwiMjQ1cHgiKTsKCSAgICAkKCJib2R5IikuY3NzKCJtYXJnaW4tYm90dG9tIiwiMjg1cHgiKTsKCSAgICAkKHRoaXMpLnRleHQoIkhpZGUgTG9nIFZpZXdlciIpOwoJfWVsc2V7CgkgICAgJCgiI2xvZ0NvbnNvbGUiKS5jc3MoImhlaWdodCIsIjI1cHgiKTsKCSAgICAkKCJib2R5IikuY3NzKCJtYXJnaW4tYm90dG9tIiwiMjVweCIpOwoJICAgICQodGhpcykudGV4dCgiU2hvdyBMb2cgVmlld2VyIik7Cgl9CgkKCXJldHVybiBmYWxzZTsKICAgIH0pOwoKICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAhPSAiaHR0cHM6IiAmJiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgIT0gImh0dHA6IiAmJiAhaXNJT1MoKSAmJiAhaXNBbmRyb2lkKCkpewoJdmFyIGVycm9yVGV4dCA9ICJMb29rcyBsaWtlIHlvdSBhcmUgcnVubmluZyB0aGlzIHNhbXBsZSBsb2NhbGx5IGFuZCBub3Qgb24gYSB3ZWIgc2VydmVyLiBUbyBydW4gdGhpcyBleGFtcGxlLCBlaXRoZXIgbG9hZCBpdCBmcm9tIGEgd2ViIHNlcnZlciBvciA8YSBocmVmPSdodHRwOi8vd3d3Lm1hY3JvbWVkaWEuY29tL3N1cHBvcnQvZG9jdW1lbnRhdGlvbi9lbi9mbGFzaHBsYXllci9oZWxwL3NldHRpbmdzX21hbmFnZXIwNC5odG1sJyB0YXJnZXQ9J19ibGFuayc+ZWRpdCB5b3VyIEZsYXNoIHNlY3VyaXR5IHNldHRpbmdzPC9hPi4iOwoJZXJyb3JUZXh0ICs9ICI8YnIvPlNlbGVjdCBcIkVkaXQgbG9jYXRpb25zXCIgPiBcIkFkZCBsb2NhdGlvblwiID4gXCJCcm93c2UgZm9yIGZvbGRlclwiIGFuZCBzZWxlY3QgdGhlIFwiL2pzXCIgZm9sZGVyIGluIHRoZSByb290IG9mIHlvdXIgZG93bmxvYWQuIjsKCWVycm9yVGV4dCArPSAiIDxhIGhyZWY9JyMnIG9uY2xpY2s9JyQodGhpcykucGFyZW50KCkuc2xpZGVVcCgpOyc+Q2xvc2UgdGhpczwvYT4iOwoJdmFyIGVycm9yQm94ID0gJCgiPGRpdj4iKQoJICAgIC5hZGRDbGFzcygiZXJyb3IiKQoJICAgIC5odG1sKGVycm9yVGV4dCkKCSAgICAucHJlcGVuZFRvKCJib2R5Iik7CiAgICB9CgogICAgaWYgKHVybFBhcmFtKCJjb25uZWN0aW9uVXJsIikgIT0gdW5kZWZpbmVkICYmIHVybFBhcmFtKCJqaWQiKSAhPSB1bmRlZmluZWQgJiYgdXJsUGFyYW0oInBhc3N3b3JkIikgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24odXJsUGFyYW0oImNvbm5lY3Rpb25VcmwiKSk7CiAgICAgICAgY29ubmVjdGlvbi5jb25uZWN0KHVybFBhcmFtKCJqaWQiKSArICIvcGhvbm8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxQYXJhbSgicGFzc3dvcmQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VuZCgkcHJlcygpLnRyZWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlTmV3UGhvbm8oY29ubmVjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgY3JlYXRlTmV3UGhvbm8obnVsbCk7CiAgICB9Cn0pOwoK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:58:22 GMT",
                    "Content-Length": "23553",
                    "Date": "Fri, 07 Nov 2014 21:58:26 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}