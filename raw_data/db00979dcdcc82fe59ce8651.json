{
    "url": "http://localhost:9999/alvarotrigo/pagepiling.js/jquery.pagepiling.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var value =  window.location.hash.replace('#', '');</li><li>var sectionAnchor = value;</li><li>var section = $('.pp-section[data-anchor=\"'+sectionAnchor+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/alvarotrigo/pagepiling.js/jquery.pagepiling.js",
                "path": "/alvarotrigo/pagepiling.js/jquery.pagepiling.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hbHZhcm90cmlnby9wYWdlcGlsaW5nLmpzL2pxdWVyeS5wYWdlcGlsaW5nLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzIyMzYNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6MzU6NTkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjM1OjU5IEdNVA0KDQovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogcGFnZXBpbGluZy5qcyAwLjAuOCAoQmV0YSkNCiAqDQogKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vcGFnZVBpbGluZy5qcw0KICogTUlUIGxpY2Vuc2VkDQogKg0KICogQ29weXJpZ2h0IChDKSAyMDEzIGFsdmFyb3RyaWdvLmNvbSAtIEEgcHJvamVjdCBieSBBbHZhcm8gVHJpZ28NCiAqDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCihmdW5jdGlvbiAoJCkgew0KICAgICQuZm4ucGFnZXBpbGluZyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7DQogICAgICAgIHZhciBjb250YWluZXIgPSAkKHRoaXMpOw0KICAgICAgICB2YXIgbGFzdFNjcm9sbGVkRGVzdGlueTsNCiAgICAgICAgdmFyIGxhc3RBbmltYXRpb24gPSAwOw0KICAgICAgICB2YXIgaXNUb3VjaCA9ICgoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB8fCAobmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMgPiAwKSk7DQogICAgICAgIHZhciB0b3VjaFN0YXJ0WSA9IHRvdWNoU3RhcnRYID0gdG91Y2hFbmRZID0gdG91Y2hFbmRYID0gMDsNCg0KICAgICAgICAvL0RlZmluZXMgdGhlIGRlbGF5IHRvIHRha2UgcGxhY2UgYmVmb3JlIGJlaW5nIGFibGUgdG8gc2Nyb2xsIHRvIHRoZSBuZXh0IHNlY3Rpb24NCiAgICAgICAgLy9CRSBDQVJFRlVMISBOb3QgcmVjb21tZW5lZCB0byBjaGFuZ2UgaXQgdW5kZXIgNDAwIGZvciBhIGdvb2QgYmVoYXZpb3IgaW4gbGFwdG9wcyBhbmQNCiAgICAgICAgLy9BcHBsZSBkZXZpY2VzIChsYXB0b3BzLCBtb3VzZXMuLi4pDQogICAgICAgIHZhciBzY3JvbGxEZWxheSA9IDYwMDsNCg0KICAgICAgICAvLyBDcmVhdGUgc29tZSBkZWZhdWx0cywgZXh0ZW5kaW5nIHRoZW0gd2l0aCBhbnkgb3B0aW9ucyB0aGF0IHdlcmUgcHJvdmlkZWQNCiAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHsNCiAgICAgICAgICAgIGRpcmVjdGlvbjogJ3ZlcnRpY2FsJywNCiAgICAgICAgICAgIG1lbnU6IG51bGwsDQogICAgICAgICAgICB2ZXJ0aWNhbENlbnRlcmVkOiB0cnVlLA0KICAgICAgICAgICAgc2VjdGlvbnNDb2xvcjogW10sDQogICAgICAgICAgICBhbmNob3JzOiBbXSwNCiAgICAgICAgICAgIHNjcm9sbGluZ1NwZWVkOiA3MDAsDQogICAgICAgICAgICBlYXNpbmc6ICdzd2luZycsDQogICAgICAgICAgICBsb29wQm90dG9tOiBmYWxzZSwNCiAgICAgICAgICAgIGxvb3BUb3A6IGZhbHNlLA0KICAgICAgICAgICAgY3NzMzogdHJ1ZSwNCiAgICAgICAgICAgIG5hdmlnYXRpb246IHsNCiAgICAgICAgICAgICAgICAndGV4dENvbG9yJzogJyMwMDAnLA0KICAgICAgICAgICAgICAgICdidWxsZXRzQ29sb3InOiAnIzAwMCcsDQogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JpZ2h0JywNCiAgICAgICAgICAgICAgICAndG9vbHRpcHMnOiBbJ3NlY3Rpb24xJywgJ3NlY3Rpb24yJywgJ3NlY3Rpb24zJywgJ3NlY3Rpb240J10NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBub3JtYWxTY3JvbGxFbGVtZW50czogbnVsbCwNCiAgICAgICAgICAgIG5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZDogNSwNCiAgICAgICAgICAgIHRvdWNoU2Vuc2l0aXZpdHk6IDUsDQogICAgICAgICAgICBrZXlib2FyZFNjcm9sbGluZzogdHJ1ZSwNCiAgICAgICAgICAgIHNlY3Rpb25TZWxlY3RvcjogJy5zZWN0aW9uJywNCiAgICAgICAgICAgIGFuaW1hdGVBbmNob3I6IGZhbHNlLA0KDQogICAgICAgICAgICAvL2V2ZW50cw0KICAgICAgICAgICAgYWZ0ZXJMb2FkOiBudWxsLA0KICAgICAgICAgICAgb25MZWF2ZTogbnVsbCwNCiAgICAgICAgICAgIGFmdGVyUmVuZGVyOiBudWxsDQogICAgICAgIH0sIG9wdGlvbnMpOw0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICogRGVmaW5lcyB0aGUgc2Nyb2xsaW5nIHNwZWVkDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRTY3JvbGxpbmdTcGVlZCA9IGZ1bmN0aW9uKHZhbHVlKXsNCiAgICAgICAgICAgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCA9IHZhbHVlOw0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBtb3VzZSB3aGVlbCBvciB0aGUgdHJhY2twYWQuDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCiAgICAgICAgICAgIGlmKHZhbHVlKXsNCiAgICAgICAgICAgICAgICBhZGRNb3VzZVdoZWVsSGFuZGxlcigpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUgbW91c2Ugd2hlZWwvdHJhY2twYWQgb3IgdG91Y2ggZ2VzdHVyZXMuDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRBbGxvd1Njcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQogICAgICAgICAgICBpZih2YWx1ZSl7DQogICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcodHJ1ZSk7DQogICAgICAgICAgICAgICAgYWRkVG91Y2hIYW5kbGVyKCk7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQogICAgICAgICAgICAgICAgcmVtb3ZlVG91Y2hIYW5kbGVyKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIGtleWJvYXJkIGFycm93IGtleXMNCiAgICAgICAgKi8NCiAgICAgICAgJC5mbi5wYWdlcGlsaW5nLnNldEtleWJvYXJkU2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCiAgICAgICAgICAgIG9wdGlvbnMua2V5Ym9hcmRTY3JvbGxpbmcgPSB2YWx1ZTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBNb3ZlcyBzZWN0aW8gdXANCiAgICAgICAgKi8NCiAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uVXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgcHJldiA9ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLnByZXYoJy5wcC1zZWN0aW9uJyk7DQoNCiAgICAgICAgICAgIC8vbG9vcGluZyB0byB0aGUgYm90dG9tIGlmIHRoZXJlJ3Mgbm8gbW9yZSBzZWN0aW9ucyBhYm92ZQ0KICAgICAgICAgICAgaWYgKCFwcmV2Lmxlbmd0aCAmJiBvcHRpb25zLmxvb3BUb3ApIHsNCiAgICAgICAgICAgICAgICBwcmV2ID0gJCgnLnBwLXNlY3Rpb24nKS5sYXN0KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChwcmV2Lmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIHNjcm9sbFBhZ2UocHJldik7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICogTW92ZXMgc2VjdGlvIGRvd24NCiAgICAgICAgKi8NCiAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uRG93biA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBuZXh0ID0gJCgnLnBwLXNlY3Rpb24uYWN0aXZlJykubmV4dCgnLnBwLXNlY3Rpb24nKTsNCg0KICAgICAgICAgICAgLy9sb29waW5nIHRvIHRoZSB0b3AgaWYgdGhlcmUncyBubyBtb3JlIHNlY3Rpb25zIGJlbG93DQogICAgICAgICAgICBpZighbmV4dC5sZW5ndGggJiYgb3B0aW9ucy5sb29wQm90dG9tKXsNCiAgICAgICAgICAgICAgICBuZXh0ID0gJCgnLnBwLXNlY3Rpb24nKS5maXJzdCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobmV4dC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBzY3JvbGxQYWdlKG5leHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAqIE1vdmVzIHRoZSBzaXRlIHRvIHRoZSBnaXZlbiBhbmNob3Igb3IgaW5kZXgNCiAgICAgICAgKi8NCiAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVUbyA9IGZ1bmN0aW9uIChzZWN0aW9uKXsNCiAgICAgICAgICAgIHZhciBkZXN0aW55ID0gJyc7DQoNCiAgICAgICAgICAgIGlmKGlzTmFOKHNlY3Rpb24pKXsNCiAgICAgICAgICAgICAgICBkZXN0aW55ID0gJCgnW2RhdGEtYW5jaG9yPSInK3NlY3Rpb24rJyJdJyk7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBkZXN0aW55ID0gJCgnLnBwLXNlY3Rpb24nKS5lcSggKHNlY3Rpb24gLTEpICk7DQogICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgaWYoZGVzdGlueS5sZW5ndGggPiAwKXsNCiAgICAgICAgICAgICAgICBzY3JvbGxQYWdlKGRlc3RpbnkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vYWRkaW5nIGludGVybmFsIGNsYXNzIG5hbWVzIHRvIHZvaWQgcHJvYmxlbSB3aXRoIGNvbW1vbiBvbmVzDQogICAgICAgICQob3B0aW9ucy5zZWN0aW9uU2VsZWN0b3IpLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ3BwLXNlY3Rpb24nKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy9pZiBjc3MzIGlzIG5vdCBzdXBwb3J0ZWQsIGl0IHdpbGwgdXNlIGpRdWVyeSBhbmltYXRpb25zDQogICAgICAgIGlmKG9wdGlvbnMuY3NzMyl7DQogICAgICAgICAgICBvcHRpb25zLmNzczMgPSBzdXBwb3J0M2QoKTsNCiAgICAgICAgfQ0KDQogICAgICAgICQoY29udGFpbmVyKS5jc3Moew0KICAgICAgICAgICAgJ292ZXJmbG93JyA6ICdoaWRkZW4nLA0KICAgICAgICAgICAgJy1tcy10b3VjaC1hY3Rpb24nOiAnbm9uZScsICAvKiBUb3VjaCBkZXRlY3Rpb24gZm9yIFdpbmRvd3MgOCAqLw0KICAgICAgICAgICAgJ3RvdWNoLWFjdGlvbic6ICdub25lJyAgICAgICAvKiBJRSAxMSBvbiBXaW5kb3dzIFBob25lIDguMSovDQogICAgICAgIH0pOw0KDQogICAgICAgIC8vaW5pdA0KICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0QWxsb3dTY3JvbGxpbmcodHJ1ZSk7DQoNCiAgICAgICAgLy9jcmVhdGluZyB0aGUgbmF2aWdhdGlvbiBkb3RzDQogICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KG9wdGlvbnMubmF2aWdhdGlvbikgKSB7DQogICAgICAgICAgICBhZGRWZXJ0aWNhbE5hdmlnYXRpb24oKTsNCiAgICAgICAgfQ0KDQogICAgICAgICB2YXIgekluZGV4ID0gJCgnLnBwLXNlY3Rpb24nKS5sZW5ndGg7DQoNCiAgICAgICAgJCgnLnBwLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgew0KICAgICAgICAgICAgJCh0aGlzKS5kYXRhKCdkYXRhLWluZGV4JywgaW5kZXgpOw0KICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ3otaW5kZXgnLCB6SW5kZXgpOw0KDQogICAgICAgICAgICAvL2lmIG5vIGFjdGl2ZSBzZWN0aW9uIGlzIGRlZmluZWQsIHRoZSAxc3Qgb25lIHdpbGwgYmUgdGhlIGRlZmF1bHQgb25lDQogICAgICAgICAgICBpZiAoIWluZGV4ICYmICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuYW5jaG9yc1tpbmRleF0gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCdkYXRhLWFuY2hvcicsIG9wdGlvbnMuYW5jaG9yc1tpbmRleF0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2VjdGlvbnNDb2xvcltpbmRleF0gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBvcHRpb25zLnNlY3Rpb25zQ29sb3JbaW5kZXhdKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCiAgICAgICAgICAgICAgICBhZGRUYWJsZUNsYXNzKCQodGhpcykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB6SW5kZXggPSB6SW5kZXggLSAxOw0KICAgICAgICB9KS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbigpew0KICAgICAgICAgICAgLy92ZXJ0aWNhbCBjZW50ZXJlZCBvZiB0aGUgbmF2aWdhdGlvbiArIGZpcnN0IGJ1bGxldCBhY3RpdmUNCiAgICAgICAgICAgIGlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQogICAgICAgICAgICAgICAgJCgnI3BwLW5hdicpLmNzcygnbWFyZ2luLXRvcCcsICctJyArICgkKCcjcHAtbmF2JykuaGVpZ2h0KCkvMikgKyAncHgnKTsNCiAgICAgICAgICAgICAgICAkKCcjcHAtbmF2JykuZmluZCgnbGknKS5lcSgkKCcucHAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnBwLXNlY3Rpb24nKSkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc2Nyb2xsVG9BbmNob3IoKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KICAgICAgICB9KTsNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEVuYWJsZXMgdmVydGljYWwgY2VudGVyaW5nIGJ5IHdyYXBwaW5nIHRoZSBjb250ZW50IGFuZCB0aGUgdXNlIG9mIHRhYmxlIGFuZCB0YWJsZS1jZWxsDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFkZFRhYmxlQ2xhc3MoZWxlbWVudCl7DQogICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdwcC10YWJsZScpLndyYXBJbm5lcignPGRpdiBjbGFzcz0icHAtdGFibGVDZWxsIiBzdHlsZT0iaGVpZ2h0OjEwMCUiIC8+Jyk7DQogICAgICAgIH0NCg0KDQogICAgICAgLyoqDQogICAgICAgICogUmV0dW5zIGB1cGAgb3IgYGRvd25gIGRlcGVuZGluZyBvbiB0aGUgc2Nyb2xsaW5nIG1vdmVtZW50IHRvIHJlYWNoIGl0cyBkZXN0aW5hdGlvbg0KICAgICAgICAqIGZyb20gdGhlIGN1cnJlbnQgc2VjdGlvbi4NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0WW1vdmVtZW50KGRlc3Rpbnkpew0KICAgICAgICAgICAgdmFyIGZyb21JbmRleCA9ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcucHAtc2VjdGlvbicpOw0KICAgICAgICAgICAgdmFyIHRvSW5kZXggPSBkZXN0aW55LmluZGV4KCcucHAtc2VjdGlvbicpOw0KDQogICAgICAgICAgICBpZihmcm9tSW5kZXggPiB0b0luZGV4KXsNCiAgICAgICAgICAgICAgICByZXR1cm4gJ3VwJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAnZG93bic7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBTY3JvbGxzIHRoZSBwYWdlIHRvIHRoZSBnaXZlbiBkZXN0aW5hdGlvbg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBzY3JvbGxQYWdlKGRlc3RpbmF0aW9uLCBhbmltYXRlZCkgew0KICAgICAgICAgICAgdmFyIHYgPXsNCiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sDQogICAgICAgICAgICAgICAgYW5pbWF0ZWQ6IGFuaW1hdGVkLA0KICAgICAgICAgICAgICAgIGFjdGl2ZVNlY3Rpb246ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLA0KICAgICAgICAgICAgICAgIGFuY2hvckxpbms6IGRlc3RpbmF0aW9uLmRhdGEoJ2FuY2hvcicpLA0KICAgICAgICAgICAgICAgIHNlY3Rpb25JbmRleDogZGVzdGluYXRpb24uaW5kZXgoJy5wcC1zZWN0aW9uJyksDQogICAgICAgICAgICAgICAgdG9Nb3ZlOiBkZXN0aW5hdGlvbiwNCiAgICAgICAgICAgICAgICB5TW92ZW1lbnQ6IGdldFltb3ZlbWVudChkZXN0aW5hdGlvbiksDQogICAgICAgICAgICAgICAgbGVhdmluZ1NlY3Rpb246ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcucHAtc2VjdGlvbicpICsgMQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgLy9xdWl0aW5nIHdoZW4gYWN0aXZlU2VjdGlvbiBpcyB0aGUgdGFyZ2V0IGVsZW1lbnQNCiAgICAgICAgICAgIGlmKHYuYWN0aXZlU2VjdGlvbi5pcyhkZXN0aW5hdGlvbikpeyByZXR1cm47IH0NCg0KICAgICAgICAgICAgaWYodHlwZW9mIHYuYW5pbWF0ZWQgPT09ICd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB2LmFuaW1hdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYodHlwZW9mIHYuYW5jaG9yTGluayAhPT0gJ3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHNldFVSTEhhc2godi5hbmNob3JMaW5rKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdi5kZXN0aW5hdGlvbi5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCiAgICAgICAgICAgIHYuc2VjdGlvbnNUb01vdmUgPSBnZXRTZWN0aW9uc1RvTW92ZSh2KTsNCg0KICAgICAgICAgICAgLy9zY3JvbGxpbmcgZG93biAobW92aW5nIHNlY3Rpb25zIHVwIG1ha2luZyB0aGVtIGRpc2FwcGVhcikNCiAgICAgICAgICAgIGlmICh2LnlNb3ZlbWVudCA9PT0gJ2Rvd24nKSB7DQogICAgICAgICAgICAgICAgdi50cmFuc2xhdGUzZCA9IGdldFRyYW5zbGF0ZTNkKCk7DQogICAgICAgICAgICAgICAgdi5zY3JvbGxpbmcgPSAnLTEwMCUnOw0KDQogICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMuY3NzMyl7DQogICAgICAgICAgICAgICAgICAgIHYuc2VjdGlvbnNUb01vdmUuZWFjaChmdW5jdGlvbihpbmRleCl7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCAhPSB2LmFjdGl2ZVNlY3Rpb24uaW5kZXgoJy5wcC1zZWN0aW9uJykpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKGdldFNjcm9sbFByb3Aodi5zY3JvbGxpbmcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdi5hbmltYXRlU2VjdGlvbiA9IHYuYWN0aXZlU2VjdGlvbjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9zY3JvbGxpbmcgdXAgKG1vdmluZyBzZWN0aW9uIGRvd24gdG8gdGhlIHZpZXdwb3J0KQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdi50cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KSc7DQogICAgICAgICAgICAgICAgdi5zY3JvbGxpbmcgPSAnMCc7DQoNCiAgICAgICAgICAgICAgICB2LmFuaW1hdGVTZWN0aW9uID0gZGVzdGluYXRpb247DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKHRoaXMsIHYubGVhdmluZ1NlY3Rpb24sICh2LnNlY3Rpb25JbmRleCArIDEpLCB2LnlNb3ZlbWVudCk7DQoNCiAgICAgICAgICAgIHBlcmZvcm1Nb3ZlbWVudCh2KTsNCg0KICAgICAgICAgICAgYWN0aXZhdGVNZW51RWxlbWVudCh2LmFuY2hvckxpbmspOw0KICAgICAgICAgICAgYWN0aXZhdGVOYXZEb3RzKHYuYW5jaG9yTGluaywgdi5zZWN0aW9uSW5kZXgpOw0KICAgICAgICAgICAgbGFzdFNjcm9sbGVkRGVzdGlueSA9IHYuYW5jaG9yTGluazsNCg0KICAgICAgICAgICAgdmFyIHRpbWVOb3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgICAgICAgIGxhc3RBbmltYXRpb24gPSB0aW1lTm93Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogUGVyZm9ybXMgdGhlIG1vdmVtZW50IChieSBDU1MzIG9yIGJ5IGpRdWVyeSkNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gcGVyZm9ybU1vdmVtZW50KHYpew0KICAgICAgICAgICAgaWYob3B0aW9ucy5jc3MzKXsNCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250YWluZXIodi5hbmltYXRlU2VjdGlvbiwgdi50cmFuc2xhdGUzZCwgdi5hbmltYXRlZCk7DQoNCiAgICAgICAgICAgICAgICB2LnNlY3Rpb25zVG9Nb3ZlLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udGFpbmVyKCQodGhpcyksIHYudHJhbnNsYXRlM2QsIHYuYW5pbWF0ZWQpOw0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGFmdGVyU2VjdGlvbkxvYWRzKHYpOw0KICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgdi5zY3JvbGxPcHRpb25zID0gZ2V0U2Nyb2xsUHJvcCh2LnNjcm9sbGluZyk7DQoNCiAgICAgICAgICAgICAgICBpZih2LmFuaW1hdGVkKXsNCiAgICAgICAgICAgICAgICAgICAgdi5hbmltYXRlU2VjdGlvbi5hbmltYXRlKA0KICAgICAgICAgICAgICAgICAgICAgICAgdi5zY3JvbGxPcHRpb25zDQogICAgICAgICAgICAgICAgICAgICwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCwgb3B0aW9ucy5lYXNpbmcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRqdXN0U2VjdGlvbnModik7DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkanVzdFNlY3Rpb25zKHYpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgdi5hbmltYXRlU2VjdGlvbi5jc3MoZ2V0U2Nyb2xsUHJvcCh2LnNjcm9sbGluZykpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkanVzdFNlY3Rpb25zKHYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJTZWN0aW9uTG9hZHModik7DQogICAgICAgICAgICAgICAgICAgIH0sNDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBBY3Rpb25zIHRvIGV4ZWN1dGUgYWZ0ZXIgYSBzZWNpb24gaXMgbG9hZGVkDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFmdGVyU2VjdGlvbkxvYWRzKHYpew0KICAgICAgICAgICAgLy9jYWxsYmFjayAoYWZ0ZXJMb2FkKSBpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KICAgICAgICAgICAgJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJMb2FkKSAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKHRoaXMsIHYuYW5jaG9yTGluaywgKHYuc2VjdGlvbkluZGV4ICsgMSkpOw0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBnZXRTZWN0aW9uc1RvTW92ZSh2KXsNCiAgICAgICAgICAgIHZhciBzZWN0aW9uVG9Nb3ZlOw0KDQogICAgICAgICAgICBpZih2LnlNb3ZlbWVudCA9PT0gJ2Rvd24nKXsNCiAgICAgICAgICAgICAgICBzZWN0aW9uVG9Nb3ZlID0gJCgnLnBwLXNlY3Rpb24nKS5tYXAoZnVuY3Rpb24oaW5kZXgpew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB2LmRlc3RpbmF0aW9uLmluZGV4KCcucHAtc2VjdGlvbicpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBzZWN0aW9uVG9Nb3ZlID0gJCgnLnBwLXNlY3Rpb24nKS5tYXAoZnVuY3Rpb24oaW5kZXgpew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiB2LmRlc3RpbmF0aW9uLmluZGV4KCcucHAtc2VjdGlvbicpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBzZWN0aW9uVG9Nb3ZlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogUmV0dXJucyB0aGUgc2VjdGlvbnMgdG8gcmUtYWRqdXN0IGluIHRoZSBiYWNrZ3JvdW5kIGFmdGVyIHRoZSBzZWN0aW9uIGxvYWRzLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiByZWFkanVzdFNlY3Rpb25zKHYpew0KICAgICAgICAgICAgdmFyIHJlYWRqdXN0U2VjdGlvbnM7DQoNCiAgICAgICAgICAgIGlmKHYueU1vdmVtZW50ID09PSAndXAnKXsNCiAgICAgICAgICAgICAgICB2LnNlY3Rpb25zVG9Nb3ZlLmVhY2goZnVuY3Rpb24oaW5kZXgpew0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhnZXRTY3JvbGxQcm9wKHYuc2Nyb2xsaW5nKSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiByZWFkanVzdFNlY3Rpb25zOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogR2V0cyB0aGUgcHJvcGVydHkgdXNlZCB0byBjcmVhdGUgdGhlIHNjcm9sbGluZyBlZmZlY3Qgd2hlbiB1c2luZyBqUXVlcnkgYW5pbWF0aW9ucw0KICAgICAgICAqIGRlcGVuZGluZyBvbiB0aGUgcGx1Z2luIGRpcmVjdGlvbiBvcHRpb24uDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGdldFNjcm9sbFByb3AocHJvcGVydHlWYWx1ZSl7DQogICAgICAgICAgICBpZihvcHRpb25zLmRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJyl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsndG9wJzogcHJvcGVydHlWYWx1ZX07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4geydsZWZ0JzogcHJvcGVydHlWYWx1ZX07DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBTY3JvbGxzIHRoZSBzaXRlIHdpdGhvdXQgYW55bWF0aW9ucyAodXN1YWxseSB1c2VkIGluIHRoZSBiYWNrZ3JvdW5kIHdpdGhvdXQgdGhlIHVzZXIgbm90aWNpbmcgaXQpDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHNpbGVudFNjcm9sbChzZWN0aW9uLCBvZmZzZXQpew0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuY3NzMykgew0KICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvbnRhaW5lcihzZWN0aW9uLCBnZXRUcmFuc2xhdGUzZCgpLCBmYWxzZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgIHNlY3Rpb24uY3NzKGdldFNjcm9sbFByb3Aob2Zmc2V0KSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBTZXRzIHRoZSBVUkwgaGFzaCBmb3IgYSBzZWN0aW9uIHdpdGggc2xpZGVzDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHNldFVSTEhhc2goYW5jaG9yTGluayl7DQogICAgICAgICAgICBpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vVE8gRE8NCiAgICAgICAgZnVuY3Rpb24gc2Nyb2xsVG9BbmNob3IoKXsNCiAgICAgICAgICAgIC8vZ2V0dGluZyB0aGUgYW5jaG9yIGxpbmsgaW4gdGhlIFVSTCBhbmQgZGVsZXRpbmcgdGhlIGAjYA0KICAgICAgICAgICAgdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJyk7DQogICAgICAgICAgICB2YXIgc2VjdGlvbkFuY2hvciA9IHZhbHVlOw0KICAgICAgICAgICAgdmFyIHNlY3Rpb24gPSAkKCcucHAtc2VjdGlvbltkYXRhLWFuY2hvcj0iJytzZWN0aW9uQW5jaG9yKyciXScpOw0KDQogICAgICAgICAgICBpZihzZWN0aW9uLmxlbmd0aCA+IDApeyAgLy9pZiB0aGVyZXMgYW55ICMNCiAgICAgICAgICAgICAgICBzY3JvbGxQYWdlKHNlY3Rpb24sIG9wdGlvbnMuYW5pbWF0ZUFuY2hvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSB0cmFuc2l0aW9ucyBiZXR3ZWVuIHNlY3Rpb25zIHN0aWxsIHRha2luZyBwbGFjZS4NCiAgICAgICAgKiBUaGUgdmFyaWFibGUgYHNjcm9sbERlbGF5YCBhZGRzIGEgInNhdmUgem9uZSIgZm9yIGRldmljZXMgc3VjaCBhcyBBcHBsZSBsYXB0b3BzIGFuZCBBcHBsZSBtYWdpYyBtb3VzZXMNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaXNNb3ZpbmcoKXsNCiAgICAgICAgICAgIHZhciB0aW1lTm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgICAgICAvLyBDYW5jZWwgc2Nyb2xsIGlmIGN1cnJlbnRseSBhbmltYXRpbmcgb3Igd2l0aGluIHF1aWV0IHBlcmlvZA0KICAgICAgICAgICAgaWYgKHRpbWVOb3cgLSBsYXN0QW5pbWF0aW9uIDwgc2Nyb2xsRGVsYXkgKyBvcHRpb25zLnNjcm9sbGluZ1NwZWVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAvL2RldGVjdGluZyBhbnkgY2hhbmdlIG9uIHRoZSBVUkwgdG8gc2Nyb2xsIHRvIHRoZSBnaXZlbiBhbmNob3IgbGluaw0KICAgICAgICAvLyhhIHdheSB0byBkZXRlY3QgYmFjayBoaXN0b3J5IGJ1dHRvbiBhcyB3ZSBwbGF5IHdpdGggdGhlIGhhc2hlcyBvbiB0aGUgVVJMKQ0KICAgICAgICAkKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLCBoYXNoQ2hhbmdlSGFuZGxlcik7DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWN0aW9ucyB0byBkbyB3aGVuIHRoZSBoYXNoICgjKSBpbiB0aGUgVVJMIGNoYW5nZXMuDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGhhc2hDaGFuZ2VIYW5kbGVyKCl7DQogICAgICAgICAgICB2YXIgdmFsdWUgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKS5zcGxpdCgnLycpOw0KICAgICAgICAgICAgdmFyIHNlY3Rpb25BbmNob3IgPSB2YWx1ZVswXTsNCg0KICAgICAgICAgICAgaWYoc2VjdGlvbkFuY2hvci5sZW5ndGgpew0KICAgICAgICAgICAgICAgIC8vd2hlbiBtb3ZpbmcgdG8gYSBzbGlkZSBpbiB0aGUgZmlyc3Qgc2VjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWUgKGZpcnN0IHRpbWUgdG8gYWRkIGFuIGFuY2hvciB0byB0aGUgVVJMKQ0KICAgICAgICAgICAgICAgIHZhciBpc0ZpcnN0TW92ZSA9ICAodHlwZW9mIGxhc3RTY3JvbGxlZERlc3RpbnkgPT09ICd1bmRlZmluZWQnKTsNCg0KICAgICAgICAgICAgICAgIC8qaW4gb3JkZXIgdG8gY2FsbCBzY3JvbGxwYWdlKCkgb25seSBvbmNlIGZvciBlYWNoIGRlc3RpbmF0aW9uIGF0IGEgdGltZQ0KICAgICAgICAgICAgICAgIEl0IGlzIGNhbGxlZCB0d2ljZSBmb3IgZWFjaCBzY3JvbGwgb3RoZXJ3aXNlLCBhcyBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvcmxpbmtzIGBoYXNoQ2hhbmdlYA0KICAgICAgICAgICAgICAgIGV2ZW50IGlzIGZpcmVkIG9uIGV2ZXJ5IHNjcm9sbCB0b28uKi8NCiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbkFuY2hvciAmJiBzZWN0aW9uQW5jaG9yICE9PSBsYXN0U2Nyb2xsZWREZXN0aW55KSAgew0KICAgICAgICAgICAgICAgICAgICBpZihpc05hTihzZWN0aW9uQW5jaG9yKSl7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VjdGlvbiA9ICQoJ1tkYXRhLWFuY2hvcj0iJytzZWN0aW9uQW5jaG9yKyciXScpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWN0aW9uID0gJCgnLnBwLXNlY3Rpb24nKS5lcSggKHNlY3Rpb25BbmNob3IgLTEpICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFnZShzZWN0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBDcm9zcyBicm93c2VyIHRyYW5zZm9ybWF0aW9ucw0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkLA0KICAgICAgICAgICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZCwNCiAgICAgICAgICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZCwNCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFkZHMgYSBjc3MzIHRyYW5zZm9ybSBwcm9wZXJ0eSB0byB0aGUgY29udGFpbmVyIGNsYXNzIHdpdGggb3Igd2l0aG91dCBhbmltYXRpb24gZGVwZW5kaW5nIG9uIHRoZSBhbmltYXRlZCBwYXJhbS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybUNvbnRhaW5lcihlbGVtZW50LCB0cmFuc2xhdGUzZCwgYW5pbWF0ZWQpIHsNCiAgICAgICAgICAgIGVsZW1lbnQudG9nZ2xlQ2xhc3MoJ3BwLWVhc2luZycsIGFuaW1hdGVkKTsNCg0KICAgICAgICAgICAgZWxlbWVudC5jc3MoZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRpbmcgd2l0aCBhcnJvdyBrZXlzLCBib3RoLCB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbA0KICAgICAgICAgKi8NCiAgICAgICAgJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgaWYob3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyAmJiAhaXNNb3ZpbmcoKSl7DQogICAgICAgICAgICAgICAgLy9Nb3ZpbmcgdGhlIG1haW4gcGFnZSB3aXRoIHRoZSBrZXlib2FyZCBhcnJvd3MgaWYga2V5Ym9hcmQgc2Nyb2xsaW5nIGlzIGVuYWJsZWQNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUud2hpY2gpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdXANCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzODoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMzoNCiAgICAgICAgICAgICAgICAgICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvblVwKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy9kb3duDQogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ6DQogICAgICAgICAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcubW92ZVNlY3Rpb25Eb3duKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy9Ib21lDQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzY6DQogICAgICAgICAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcubW92ZVRvKDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kDQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzU6DQogICAgICAgICAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcubW92ZVRvKCQoJy5wcC1zZWN0aW9uJykubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvL2xlZnQNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoNCiAgICAgICAgICAgICAgICAgICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvblVwKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy9yaWdodA0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM5Og0KICAgICAgICAgICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uRG93bigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gZXhpdCB0aGlzIGhhbmRsZXIgZm9yIG90aGVyIGtleXMNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8qKg0KICAgICAgICAqIElmIGBub3JtYWxTY3JvbGxFbGVtZW50c2AgaXMgdXNlZCwgdGhlIG1vdXNlIHdoZWVsIHNjcm9sbGluZyB3aWxsIHNjcm9sbCBub3JtYWxseQ0KICAgICAgICAqIG92ZXIgdGhlIGRlZmluZWQgZWxlbWVudHMgaW4gdGhlIG9wdGlvbi4NCiAgICAgICAgKi8NCiAgICAgICAgaWYob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cyl7DQogICAgICAgICAgICAkKGRvY3VtZW50KS5vbignbW91c2VlbnRlcicsIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNlbGVhdmUnLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKHRydWUpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGV0ZWN0aW5nIG1vdXNld2hlZWwgc2Nyb2xsaW5nDQogICAgICAgICAqDQogICAgICAgICAqIGh0dHA6Ly9ibG9ncy5zaXRlcG9pbnRzdGF0aWMuY29tL2V4YW1wbGVzL3RlY2gvbW91c2Utd2hlZWwvaW5kZXguaHRtbA0KICAgICAgICAgKiBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vaHRtbDUtamF2YXNjcmlwdC1tb3VzZS13aGVlbC8NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIE1vdXNlV2hlZWxIYW5kbGVyKGUpIHsNCiAgICAgICAgICAgIGlmKCFpc01vdmluZygpKXsNCiAgICAgICAgICAgICAgICAvLyBjcm9zcy1icm93c2VyIHdoZWVsIGRlbHRhDQogICAgICAgICAgICAgICAgZSA9IHdpbmRvdy5ldmVudCB8fCBlOw0KICAgICAgICAgICAgICAgIHZhciBkZWx0YSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGUud2hlZWxEZWx0YSB8fCAtZS5kZWx0YVkgfHwgLWUuZGV0YWlsKSkpOw0KDQogICAgICAgICAgICAgICAgdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKTsNCiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsYWJsZSA9IGlzU2Nyb2xsYWJsZShhY3RpdmVTZWN0aW9uKTsNCg0KICAgICAgICAgICAgICAgIC8vc2Nyb2xsaW5nIGRvd24/DQogICAgICAgICAgICAgICAgaWYgKGRlbHRhIDwgMCkgew0KICAgICAgICAgICAgICAgICAgICBzY3JvbGxpbmcoJ2Rvd24nLCBzY3JvbGxhYmxlKTsNCg0KICAgICAgICAgICAgICAgIC8vc2Nyb2xsaW5nIHVwPw0KICAgICAgICAgICAgICAgIH1lbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nKCd1cCcsIHNjcm9sbGFibGUpOw0KICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIERldGVybWluZXMgdGhlIHdheSBvZiBzY3JvbGxpbmcgdXAgb3IgZG93bjoNCiAgICAgICAgKiBieSAnYXV0b21hdGljYWxseScgc2Nyb2xsaW5nIGEgc2VjdGlvbiBvciBieSB1c2luZyB0aGUgZGVmYXVsdCBhbmQgbm9ybWFsIHNjcm9sbGluZy4NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gc2Nyb2xsaW5nKHR5cGUsIHNjcm9sbGFibGUpew0KICAgICAgICAgICAgaWYodHlwZSA9PSAnZG93bicpew0KICAgICAgICAgICAgICAgIHZhciBjaGVjayA9ICdib3R0b20nOw0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxTZWN0aW9uID0gJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uRG93bjsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHZhciBjaGVjayA9ICd0b3AnOw0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxTZWN0aW9uID0gJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uVXA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCApew0KICAgICAgICAgICAgICAgIC8vaXMgdGhlIHNjcm9sbGJhciBhdCB0aGUgc3RhcnQvZW5kIG9mIHRoZSBzY3JvbGw/DQogICAgICAgICAgICAgICAgaWYoaXNTY3JvbGxlZChjaGVjaywgc2Nyb2xsYWJsZSkpew0KICAgICAgICAgICAgICAgICAgICBzY3JvbGxTZWN0aW9uKCk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vIG1vdmVkIHVwL2Rvd24NCiAgICAgICAgICAgICAgICBzY3JvbGxTZWN0aW9uKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAgLyoqDQogICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBhY3RpdmUgc2VjdGlvbiBvciBzbGlkZSBpcyBzY3JvbGxhYmxlIHRocm91Z2ggYW5kIHNjcm9sbGluZyBiYXINCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaXNTY3JvbGxhYmxlKGFjdGl2ZVNlY3Rpb24pew0KICAgICAgICAgICAgc2Nyb2xsYWJsZSA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLnBwLXNjcm9sbGFibGUnKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHNjcm9sbGFibGU7DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZpcmVkIGJ5IHRoZSBtb3VzZSB3aGVlbCBhbmQgdGFja3BhZC4NCiAgICAgICAgKiBBZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIG1vdXNld2hlZWwgYW5kIHRyYWNrcGFkIG1vdmVtZW50cyB3b24ndCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucy4NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKXsNCiAgICAgICAgICAgIGlmIChjb250YWluZXIuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0KDApLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0lFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXINCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0KDApLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3doZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5nZXQoMCkuZGV0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWRkcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZvciB0aGUgbW91c2Ugd2hlZWwgYW5kIHRhY2twYWQuDQogICAgICAgICogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSBtb3VzZXdoZWVsIGFuZCB0cmFja3BhZCBtb3ZlbWVudHMgd2lsbCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucw0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhZGRNb3VzZVdoZWVsSGFuZGxlcigpew0KICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5nZXQoMCkuYWRkRXZlbnRMaXN0ZW5lcikgew0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5nZXQoMCkuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vSUU5LCBDaHJvbWUsIFNhZmFyaSwgT3Blcg0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5nZXQoMCkuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29udGFpbmVyLmdldCgwKS5hdHRhY2hFdmVudCgib25tb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIpOyAvL0lFIDYvNy84DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBBZGRzIHRoZSBwb3NzaWJpbGl0eSB0byBhdXRvIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zIG9uIHRvdWNoIGRldmljZXMuDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFkZFRvdWNoSGFuZGxlcigpew0KICAgICAgICAgICAgaWYoaXNUb3VjaCl7DQogICAgICAgICAgICAgICAgLy9NaWNyb3NvZnQgcG9pbnRlcnMNCiAgICAgICAgICAgICAgICBNU1BvaW50ZXIgPSBnZXRNU1BvaW50ZXIoKTsNCg0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoJ3RvdWNoc3RhcnQgJyArICBNU1BvaW50ZXIuZG93bikub24oJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duLCB0b3VjaFN0YXJ0SGFuZGxlcik7DQogICAgICAgICAgICAgICAgY29udGFpbmVyLm9mZigndG91Y2htb3ZlICcgKyBNU1BvaW50ZXIubW92ZSkub24oJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUsIHRvdWNoTW92ZUhhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgZm9yIHRvdWNoIGRldmljZXMuDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHJlbW92ZVRvdWNoSGFuZGxlcigpew0KICAgICAgICAgICAgaWYoaXNUb3VjaCl7DQogICAgICAgICAgICAgICAgLy9NaWNyb3NvZnQgcG9pbnRlcnMNCiAgICAgICAgICAgICAgICBNU1BvaW50ZXIgPSBnZXRNU1BvaW50ZXIoKTsNCg0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duKTsNCiAgICAgICAgICAgICAgICBjb250YWluZXIub2ZmKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qDQogICAgICAgICogUmV0dXJucyBhbmQgb2JqZWN0IHdpdGggTWljcm9zb2Z0IHBvaW50ZXJzIChmb3IgSUU8MTEgYW5kIGZvciBJRSA+PSAxMSkNCiAgICAgICAgKiBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvZG4zMDQ4ODYodj12cy44NSkuYXNweA0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBnZXRNU1BvaW50ZXIoKXsNCiAgICAgICAgICAgIHZhciBwb2ludGVyOw0KDQogICAgICAgICAgICAvL0lFID49IDExDQogICAgICAgICAgICBpZih3aW5kb3cuUG9pbnRlckV2ZW50KXsNCiAgICAgICAgICAgICAgICBwb2ludGVyID0geyBkb3duOiAicG9pbnRlcmRvd24iLCBtb3ZlOiAicG9pbnRlcm1vdmUiLCB1cDogInBvaW50ZXJ1cCJ9Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvL0lFIDwgMTENCiAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgcG9pbnRlciA9IHsgZG93bjogIk1TUG9pbnRlckRvd24iLCBtb3ZlOiAiTVNQb2ludGVyTW92ZSIsIHVwOiAiTVNQb2ludGVyVXAifTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHBvaW50ZXI7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBHZXRzIHRoZSBwYWdlWCBhbmQgcGFnZVkgcHJvcGVydGllcyBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXIuDQogICAgICAgICogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzL2lzc3Vlcy8xOTQjaXNzdWVjb21tZW50LTM0MDY5ODU0DQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGdldEV2ZW50c1BhZ2UoZSl7DQogICAgICAgICAgICB2YXIgZXZlbnRzID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKXsNCiAgICAgICAgICAgICAgICBldmVudHNbJ3knXSA9IGUucGFnZVk7DQogICAgICAgICAgICAgICAgZXZlbnRzWyd4J10gPSBlLnBhZ2VYOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgZXZlbnRzWyd5J10gPSBlLnRvdWNoZXNbMF0ucGFnZVk7DQogICAgICAgICAgICAgICAgZXZlbnRzWyd4J10gPSAgZS50b3VjaGVzWzBdLnBhZ2VYOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZXZlbnRzOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogR2V0dGluZyB0aGUgc3RhcnRpbmcgcG9zc2l0aW9ucyBvZiB0aGUgdG91Y2ggZXZlbnQNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gdG91Y2hTdGFydEhhbmRsZXIoZXZlbnQpew0KDQogICAgICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7DQogICAgICAgICAgICB2YXIgdG91Y2hFdmVudHMgPSBnZXRFdmVudHNQYWdlKGUpOw0KICAgICAgICAgICAgdG91Y2hTdGFydFkgPSB0b3VjaEV2ZW50c1sneSddOw0KICAgICAgICAgICAgdG91Y2hTdGFydFggPSB0b3VjaEV2ZW50c1sneCddOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogRGV0ZWN0aW5nIHRvdWNoIGV2ZW50cw0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiB0b3VjaE1vdmVIYW5kbGVyKGV2ZW50KXsNCiAgICAgICAgICAgIHZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDsNCg0KICAgICAgICAgICAgLy8gYWRkaXRpb25hbDogaWYgb25lIG9mIHRoZSBub3JtYWxTY3JvbGxFbGVtZW50cyBpc24ndCB3aXRoaW4gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgaG9wcyB1cCB0aGUgRE9NIGNoYWluDQogICAgICAgICAgICBpZiAoIWNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChldmVudC50YXJnZXQpKSB7DQogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCg0KICAgICAgICAgICAgICAgIHZhciBhY3RpdmVTZWN0aW9uID0gJCgnLnBwLXNlY3Rpb24uYWN0aXZlJyk7DQogICAgICAgICAgICAgICAgdmFyIHNjcm9sbGFibGUgPSBpc1Njcm9sbGFibGUoYWN0aXZlU2VjdGlvbik7DQoNCiAgICAgICAgICAgICAgICBpZiAoIWlzTW92aW5nKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCiAgICAgICAgICAgICAgICAgICAgdG91Y2hFbmRZID0gdG91Y2hFdmVudHNbJ3knXTsNCiAgICAgICAgICAgICAgICAgICAgdG91Y2hFbmRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCg0KICAgICAgICAgICAgICAgICAgLy8kKCdib2R5JykuYXBwZW5kKCc8c3BhbiBzdHlsZT0icG9zaXRpb246Zml4ZWQ7IHRvcDogMjUwcHg7IGxlZnQ6IDIwcHg7IHotaW5kZXg6ODg7IGZvbnQtc2l6ZTogMjVweDsgY29sb3I6ICMwMDA7Ij50b3VjaEVuZFk6ICcgKyB0b3VjaEVuZFkgICsgJzwvZGl2PicpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vWCBtb3ZlbWVudCBiaWdnZXIgdGhhbiBZIG1vdmVtZW50Pw0KICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJyAmJiBNYXRoLmFicyh0b3VjaFN0YXJ0WCAtIHRvdWNoRW5kWCkgPiAoTWF0aC5hYnModG91Y2hTdGFydFkgLSB0b3VjaEVuZFkpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9pcyB0aGUgbW92ZW1lbnQgZ3JlYXRlciB0aGFuIHRoZSBtaW5pbXVtIHJlc2lzdGFuY2UgdG8gc2Nyb2xsPw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYKSA+IChjb250YWluZXIud2lkdGgoKSAvIDEwMCAqIG9wdGlvbnMudG91Y2hTZW5zaXRpdml0eSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG91Y2hTdGFydFggPiB0b3VjaEVuZFgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nKCdkb3duJywgc2Nyb2xsYWJsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b3VjaEVuZFggPiB0b3VjaFN0YXJ0WCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxpbmcoJ3VwJywgc2Nyb2xsYWJsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSA+IChjb250YWluZXIuaGVpZ2h0KCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoU3RhcnRZID4gdG91Y2hFbmRZKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZygnZG93bicsIHNjcm9sbGFibGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG91Y2hFbmRZID4gdG91Y2hTdGFydFkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nKCd1cCcsIHNjcm9sbGFibGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiByZWN1cnNpdmUgZnVuY3Rpb24gdG8gbG9vcCB1cCB0aGUgcGFyZW50IG5vZGVzIHRvIGNoZWNrIGlmIG9uZSBvZiB0aGVtIGV4aXN0cyBpbiBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQogICAgICAgICAqIEN1cnJlbnRseSB3b3JrcyB3ZWxsIGZvciBpT1MgLSBBbmRyb2lkIG1pZ2h0IG5lZWQgc29tZSB0ZXN0aW5nDQogICAgICAgICAqIEBwYXJhbSAge0VsZW1lbnR9IGVsICB0YXJnZXQgZWxlbWVudCAvIGpxdWVyeSBzZWxlY3RvciAoaW4gc3Vic2VxdWVudCBub2RlcykNCiAgICAgICAgICogQHBhcmFtICB7aW50fSAgICAgaG9wIGN1cnJlbnQgaG9wIGNvbXBhcmVkIHRvIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkDQogICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlcmUgaXMgYSBtYXRjaCB0byBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQgKGVsLCBob3ApIHsNCiAgICAgICAgICAgIGhvcCA9IGhvcCB8fCAwOw0KICAgICAgICAgICAgdmFyIHBhcmVudCA9ICQoZWwpLnBhcmVudCgpOw0KDQogICAgICAgICAgICBpZiAoaG9wIDwgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgJiYNCiAgICAgICAgICAgICAgICBwYXJlbnQuaXMob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cykgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGhvcCA9PSBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChwYXJlbnQsICsraG9wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICogQ3JlYXRlcyBhIHZlcnRpY2FsIG5hdmlnYXRpb24gYmFyLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhZGRWZXJ0aWNhbE5hdmlnYXRpb24oKXsNCiAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9InBwLW5hdiI+PHVsPjwvdWw+PC9kaXY+Jyk7DQogICAgICAgICAgICB2YXIgbmF2ID0gJCgnI3BwLW5hdicpOw0KDQogICAgICAgICAgICBuYXYuY3NzKCdjb2xvcicsIG9wdGlvbnMubmF2aWdhdGlvbi50ZXh0Q29sb3IpOw0KDQogICAgICAgICAgICBuYXYuYWRkQ2xhc3Mob3B0aW9ucy5uYXZpZ2F0aW9uLnBvc2l0aW9uKTsNCg0KICAgICAgICAgICAgZm9yKHZhciBjb250ID0gMDsgY29udCA8ICQoJy5wcC1zZWN0aW9uJykubGVuZ3RoOyBjb250Kyspew0KICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJyc7DQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBvcHRpb25zLmFuY2hvcnNbY29udF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBvcHRpb25zLm5hdmlnYXRpb24udG9vbHRpcHMgIT09ICd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2x0aXAgPSBvcHRpb25zLm5hdmlnYXRpb24udG9vbHRpcHNbY29udF07DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB0b29sdGlwID09PSAndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwID0gJyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBuYXYuZmluZCgndWwnKS5hcHBlbmQoJzxsaSBkYXRhLXRvb2x0aXA9IicgKyB0b29sdGlwICsgJyI+PGEgaHJlZj0iIycgKyBsaW5rICsgJyI+PHNwYW4+PC9zcGFuPjwvYT48L2xpPicpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBuYXYuZmluZCgnc3BhbicpLmNzcygnYm9yZGVyLWNvbG9yJywgb3B0aW9ucy5uYXZpZ2F0aW9uLmJ1bGxldHNDb2xvcik7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBTY3JvbGxzIHRvIHRoZSBzZWN0aW9uIHdoZW4gY2xpY2tpbmcgdGhlIG5hdmlnYXRpb24gYnVsbGV0DQogICAgICAgICovDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgJyNwcC1uYXYgYScsIGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyIGluZGV4ID0gJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpOw0KDQogICAgICAgICAgICBzY3JvbGxQYWdlKCQoJy5wcC1zZWN0aW9uJykuZXEoaW5kZXgpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLyoqDQogICAgICAgICogTmF2aWdhdGlvbiB0b29sdGlwcw0KICAgICAgICAqLw0KICAgICAgICAkKGRvY3VtZW50KS5vbih7DQogICAgICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIHZhciB0b29sdGlwID0gJCh0aGlzKS5kYXRhKCd0b29sdGlwJyk7DQogICAgICAgICAgICAgICAgJCgnPGRpdiBjbGFzcz0icHAtdG9vbHRpcCAnICsgb3B0aW9ucy5uYXZpZ2F0aW9uLnBvc2l0aW9uICsnIj4nICsgdG9vbHRpcCArICc8L2Rpdj4nKS5oaWRlKCkuYXBwZW5kVG8oJCh0aGlzKSkuZmFkZUluKDIwMCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbW91c2VsZWF2ZTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5wcC10b29sdGlwJykuZmFkZU91dCgyMDAsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCAnI3BwLW5hdiBsaScpOw0KDQogICAgICAgICAvKioNCiAgICAgICAgICogQWN0aXZhdGluZyB0aGUgd2Vic2l0ZSBuYXZpZ2F0aW9uIGRvdHMgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBzbGlkZSBuYW1lLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGVOYXZEb3RzKG5hbWUsIHNlY3Rpb25JbmRleCl7DQogICAgICAgICAgICBpZihvcHRpb25zLm5hdmlnYXRpb24pew0KICAgICAgICAgICAgICAgICQoJyNwcC1uYXYnKS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgICAgIGlmKG5hbWUpew0KICAgICAgICAgICAgICAgICAgICAkKCcjcHAtbmF2JykuZmluZCgnYVtocmVmPSIjJyArIG5hbWUgKyAnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICQoJyNwcC1uYXYnKS5maW5kKCdsaScpLmVxKHNlY3Rpb25JbmRleCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQWN0aXZhdGluZyB0aGUgd2Vic2l0ZSBtYWluIG1lbnUgZWxlbWVudHMgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBzbGlkZSBuYW1lLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGVNZW51RWxlbWVudChuYW1lKXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMubWVudSl7DQogICAgICAgICAgICAgICAgJChvcHRpb25zLm1lbnUpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQogICAgICAgICAgICAgICAgJChvcHRpb25zLm1lbnUpLmZpbmQoJ1tkYXRhLW1lbnVhbmNob3I9IicrbmFtZSsnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBDaGVja3MgZm9yIHRyYW5zbGF0ZTNkIHN1cHBvcnQNCiAgICAgICAgKiBAcmV0dXJuIGJvb2xlYW4NCiAgICAgICAgKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzU2NjE2NzEvZGV0ZWN0aW5nLXRyYW5zZm9ybS10cmFuc2xhdGUzZC1zdXBwb3J0DQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHN1cHBvcnQzZCgpIHsNCiAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKSwNCiAgICAgICAgICAgICAgICBoYXMzZCwNCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1zID0gew0KICAgICAgICAgICAgICAgICAgICAnd2Via2l0VHJhbnNmb3JtJzonLXdlYmtpdC10cmFuc2Zvcm0nLA0KICAgICAgICAgICAgICAgICAgICAnT1RyYW5zZm9ybSc6Jy1vLXRyYW5zZm9ybScsDQogICAgICAgICAgICAgICAgICAgICdtc1RyYW5zZm9ybSc6Jy1tcy10cmFuc2Zvcm0nLA0KICAgICAgICAgICAgICAgICAgICAnTW96VHJhbnNmb3JtJzonLW1vei10cmFuc2Zvcm0nLA0KICAgICAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzondHJhbnNmb3JtJw0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIC8vIEFkZCBpdCB0byB0aGUgYm9keSB0byBnZXQgdGhlIGNvbXB1dGVkIHN0eWxlLg0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoZWwsIG51bGwpOw0KDQogICAgICAgICAgICBmb3IgKHZhciB0IGluIHRyYW5zZm9ybXMpIHsNCiAgICAgICAgICAgICAgICBpZiAoZWwuc3R5bGVbdF0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZVt0XSA9ICJ0cmFuc2xhdGUzZCgxcHgsMXB4LDFweCkiOw0KICAgICAgICAgICAgICAgICAgICBoYXMzZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKHRyYW5zZm9ybXNbdF0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbCk7DQoNCiAgICAgICAgICAgIHJldHVybiAoaGFzM2QgIT09IHVuZGVmaW5lZCAmJiBoYXMzZC5sZW5ndGggPiAwICYmIGhhczNkICE9PSAibm9uZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogR2V0cyB0aGUgdHJhbnNsYXRlM2QgcHJvcGVydHkgdG8gYXBwbHkgd2hlbiB1c2luZyBjc3MzOnRydWUgZGVwZW5kaW5nIG9uIHRoZSBgZGlyZWN0aW9uYCBvcHRpb24uDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGdldFRyYW5zbGF0ZTNkKCl7DQogICAgICAgICAgICBpZiAob3B0aW9ucy5kaXJlY3Rpb24gIT09ICd2ZXJ0aWNhbCcpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlM2QoLTEwMCUsIDBweCwgMHB4KSc7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlM2QoMHB4LCAtMTAwJSwgMHB4KSc7DQogICAgICAgIH0NCg0KICAgIH07DQp9KShqUXVlcnkpOw0K",
                "body": "LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIHBhZ2VwaWxpbmcuanMgMC4wLjggKEJldGEpDQogKg0KICogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL3BhZ2VQaWxpbmcuanMNCiAqIE1JVCBsaWNlbnNlZA0KICoNCiAqIENvcHlyaWdodCAoQykgMjAxMyBhbHZhcm90cmlnby5jb20gLSBBIHByb2plY3QgYnkgQWx2YXJvIFRyaWdvDQogKg0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQooZnVuY3Rpb24gKCQpIHsNCiAgICAkLmZuLnBhZ2VwaWxpbmcgPSBmdW5jdGlvbiAob3B0aW9ucykgew0KICAgICAgICB2YXIgY29udGFpbmVyID0gJCh0aGlzKTsNCiAgICAgICAgdmFyIGxhc3RTY3JvbGxlZERlc3Rpbnk7DQogICAgICAgIHZhciBsYXN0QW5pbWF0aW9uID0gMDsNCiAgICAgICAgdmFyIGlzVG91Y2ggPSAoKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdykgfHwgKG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzID4gMCkpOw0KICAgICAgICB2YXIgdG91Y2hTdGFydFkgPSB0b3VjaFN0YXJ0WCA9IHRvdWNoRW5kWSA9IHRvdWNoRW5kWCA9IDA7DQoNCiAgICAgICAgLy9EZWZpbmVzIHRoZSBkZWxheSB0byB0YWtlIHBsYWNlIGJlZm9yZSBiZWluZyBhYmxlIHRvIHNjcm9sbCB0byB0aGUgbmV4dCBzZWN0aW9uDQogICAgICAgIC8vQkUgQ0FSRUZVTCEgTm90IHJlY29tbWVuZWQgdG8gY2hhbmdlIGl0IHVuZGVyIDQwMCBmb3IgYSBnb29kIGJlaGF2aW9yIGluIGxhcHRvcHMgYW5kDQogICAgICAgIC8vQXBwbGUgZGV2aWNlcyAobGFwdG9wcywgbW91c2VzLi4uKQ0KICAgICAgICB2YXIgc2Nyb2xsRGVsYXkgPSA2MDA7DQoNCiAgICAgICAgLy8gQ3JlYXRlIHNvbWUgZGVmYXVsdHMsIGV4dGVuZGluZyB0aGVtIHdpdGggYW55IG9wdGlvbnMgdGhhdCB3ZXJlIHByb3ZpZGVkDQogICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7DQogICAgICAgICAgICBkaXJlY3Rpb246ICd2ZXJ0aWNhbCcsDQogICAgICAgICAgICBtZW51OiBudWxsLA0KICAgICAgICAgICAgdmVydGljYWxDZW50ZXJlZDogdHJ1ZSwNCiAgICAgICAgICAgIHNlY3Rpb25zQ29sb3I6IFtdLA0KICAgICAgICAgICAgYW5jaG9yczogW10sDQogICAgICAgICAgICBzY3JvbGxpbmdTcGVlZDogNzAwLA0KICAgICAgICAgICAgZWFzaW5nOiAnc3dpbmcnLA0KICAgICAgICAgICAgbG9vcEJvdHRvbTogZmFsc2UsDQogICAgICAgICAgICBsb29wVG9wOiBmYWxzZSwNCiAgICAgICAgICAgIGNzczM6IHRydWUsDQogICAgICAgICAgICBuYXZpZ2F0aW9uOiB7DQogICAgICAgICAgICAgICAgJ3RleHRDb2xvcic6ICcjMDAwJywNCiAgICAgICAgICAgICAgICAnYnVsbGV0c0NvbG9yJzogJyMwMDAnLA0KICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyaWdodCcsDQogICAgICAgICAgICAgICAgJ3Rvb2x0aXBzJzogWydzZWN0aW9uMScsICdzZWN0aW9uMicsICdzZWN0aW9uMycsICdzZWN0aW9uNCddDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbm9ybWFsU2Nyb2xsRWxlbWVudHM6IG51bGwsDQogICAgICAgICAgICBub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQ6IDUsDQogICAgICAgICAgICB0b3VjaFNlbnNpdGl2aXR5OiA1LA0KICAgICAgICAgICAga2V5Ym9hcmRTY3JvbGxpbmc6IHRydWUsDQogICAgICAgICAgICBzZWN0aW9uU2VsZWN0b3I6ICcuc2VjdGlvbicsDQogICAgICAgICAgICBhbmltYXRlQW5jaG9yOiBmYWxzZSwNCg0KICAgICAgICAgICAgLy9ldmVudHMNCiAgICAgICAgICAgIGFmdGVyTG9hZDogbnVsbCwNCiAgICAgICAgICAgIG9uTGVhdmU6IG51bGwsDQogICAgICAgICAgICBhZnRlclJlbmRlcjogbnVsbA0KICAgICAgICB9LCBvcHRpb25zKTsNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAqIERlZmluZXMgdGhlIHNjcm9sbGluZyBzcGVlZA0KICAgICAgICAqLw0KICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0U2Nyb2xsaW5nU3BlZWQgPSBmdW5jdGlvbih2YWx1ZSl7DQogICAgICAgICAgIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQgPSB2YWx1ZTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUgbW91c2Ugd2hlZWwgb3IgdGhlIHRyYWNrcGFkLg0KICAgICAgICAqLw0KICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0TW91c2VXaGVlbFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQogICAgICAgICAgICBpZih2YWx1ZSl7DQogICAgICAgICAgICAgICAgYWRkTW91c2VXaGVlbEhhbmRsZXIoKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJlbW92ZU1vdXNlV2hlZWxIYW5kbGVyKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIG1vdXNlIHdoZWVsL3RyYWNrcGFkIG9yIHRvdWNoIGdlc3R1cmVzLg0KICAgICAgICAqLw0KICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0QWxsb3dTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KICAgICAgICAgICAgaWYodmFsdWUpew0KICAgICAgICAgICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKHRydWUpOw0KICAgICAgICAgICAgICAgIGFkZFRvdWNoSGFuZGxlcigpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcoZmFsc2UpOw0KICAgICAgICAgICAgICAgIHJlbW92ZVRvdWNoSGFuZGxlcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBrZXlib2FyZCBhcnJvdyBrZXlzDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5zZXRLZXlib2FyZFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQogICAgICAgICAgICBvcHRpb25zLmtleWJvYXJkU2Nyb2xsaW5nID0gdmFsdWU7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICogTW92ZXMgc2VjdGlvIHVwDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvblVwID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHByZXYgPSAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKS5wcmV2KCcucHAtc2VjdGlvbicpOw0KDQogICAgICAgICAgICAvL2xvb3BpbmcgdG8gdGhlIGJvdHRvbSBpZiB0aGVyZSdzIG5vIG1vcmUgc2VjdGlvbnMgYWJvdmUNCiAgICAgICAgICAgIGlmICghcHJldi5sZW5ndGggJiYgb3B0aW9ucy5sb29wVG9wKSB7DQogICAgICAgICAgICAgICAgcHJldiA9ICQoJy5wcC1zZWN0aW9uJykubGFzdCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAocHJldi5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBzY3JvbGxQYWdlKHByZXYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAqIE1vdmVzIHNlY3RpbyBkb3duDQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvbkRvd24gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgbmV4dCA9ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpLm5leHQoJy5wcC1zZWN0aW9uJyk7DQoNCiAgICAgICAgICAgIC8vbG9vcGluZyB0byB0aGUgdG9wIGlmIHRoZXJlJ3Mgbm8gbW9yZSBzZWN0aW9ucyBiZWxvdw0KICAgICAgICAgICAgaWYoIW5leHQubGVuZ3RoICYmIG9wdGlvbnMubG9vcEJvdHRvbSl7DQogICAgICAgICAgICAgICAgbmV4dCA9ICQoJy5wcC1zZWN0aW9uJykuZmlyc3QoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKG5leHQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgc2Nyb2xsUGFnZShuZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBNb3ZlcyB0aGUgc2l0ZSB0byB0aGUgZ2l2ZW4gYW5jaG9yIG9yIGluZGV4DQogICAgICAgICovDQogICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlVG8gPSBmdW5jdGlvbiAoc2VjdGlvbil7DQogICAgICAgICAgICB2YXIgZGVzdGlueSA9ICcnOw0KDQogICAgICAgICAgICBpZihpc05hTihzZWN0aW9uKSl7DQogICAgICAgICAgICAgICAgZGVzdGlueSA9ICQoJ1tkYXRhLWFuY2hvcj0iJytzZWN0aW9uKyciXScpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgZGVzdGlueSA9ICQoJy5wcC1zZWN0aW9uJykuZXEoIChzZWN0aW9uIC0xKSApOw0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIGlmKGRlc3RpbnkubGVuZ3RoID4gMCl7DQogICAgICAgICAgICAgICAgc2Nyb2xsUGFnZShkZXN0aW55KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvL2FkZGluZyBpbnRlcm5hbCBjbGFzcyBuYW1lcyB0byB2b2lkIHByb2JsZW0gd2l0aCBjb21tb24gb25lcw0KICAgICAgICAkKG9wdGlvbnMuc2VjdGlvblNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdwcC1zZWN0aW9uJyk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vaWYgY3NzMyBpcyBub3Qgc3VwcG9ydGVkLCBpdCB3aWxsIHVzZSBqUXVlcnkgYW5pbWF0aW9ucw0KICAgICAgICBpZihvcHRpb25zLmNzczMpew0KICAgICAgICAgICAgb3B0aW9ucy5jc3MzID0gc3VwcG9ydDNkKCk7DQogICAgICAgIH0NCg0KICAgICAgICAkKGNvbnRhaW5lcikuY3NzKHsNCiAgICAgICAgICAgICdvdmVyZmxvdycgOiAnaGlkZGVuJywNCiAgICAgICAgICAgICctbXMtdG91Y2gtYWN0aW9uJzogJ25vbmUnLCAgLyogVG91Y2ggZGV0ZWN0aW9uIGZvciBXaW5kb3dzIDggKi8NCiAgICAgICAgICAgICd0b3VjaC1hY3Rpb24nOiAnbm9uZScgICAgICAgLyogSUUgMTEgb24gV2luZG93cyBQaG9uZSA4LjEqLw0KICAgICAgICB9KTsNCg0KICAgICAgICAvL2luaXQNCiAgICAgICAgJC5mbi5wYWdlcGlsaW5nLnNldEFsbG93U2Nyb2xsaW5nKHRydWUpOw0KDQogICAgICAgIC8vY3JlYXRpbmcgdGhlIG5hdmlnYXRpb24gZG90cw0KICAgICAgICBpZiAoISQuaXNFbXB0eU9iamVjdChvcHRpb25zLm5hdmlnYXRpb24pICkgew0KICAgICAgICAgICAgYWRkVmVydGljYWxOYXZpZ2F0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICAgdmFyIHpJbmRleCA9ICQoJy5wcC1zZWN0aW9uJykubGVuZ3RoOw0KDQogICAgICAgICQoJy5wcC1zZWN0aW9uJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHsNCiAgICAgICAgICAgICQodGhpcykuZGF0YSgnZGF0YS1pbmRleCcsIGluZGV4KTsNCiAgICAgICAgICAgICQodGhpcykuY3NzKCd6LWluZGV4JywgekluZGV4KTsNCg0KICAgICAgICAgICAgLy9pZiBubyBhY3RpdmUgc2VjdGlvbiBpcyBkZWZpbmVkLCB0aGUgMXN0IG9uZSB3aWxsIGJlIHRoZSBkZWZhdWx0IG9uZQ0KICAgICAgICAgICAgaWYgKCFpbmRleCAmJiAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmFuY2hvcnNbaW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgICQodGhpcykuYXR0cignZGF0YS1hbmNob3InLCBvcHRpb25zLmFuY2hvcnNbaW5kZXhdKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnNlY3Rpb25zQ29sb3JbaW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb3B0aW9ucy5zZWN0aW9uc0NvbG9yW2luZGV4XSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQogICAgICAgICAgICAgICAgYWRkVGFibGVDbGFzcygkKHRoaXMpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgekluZGV4ID0gekluZGV4IC0gMTsNCiAgICAgICAgfSkucHJvbWlzZSgpLmRvbmUoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIC8vdmVydGljYWwgY2VudGVyZWQgb2YgdGhlIG5hdmlnYXRpb24gKyBmaXJzdCBidWxsZXQgYWN0aXZlDQogICAgICAgICAgICBpZihvcHRpb25zLm5hdmlnYXRpb24pew0KICAgICAgICAgICAgICAgICQoJyNwcC1uYXYnKS5jc3MoJ21hcmdpbi10b3AnLCAnLScgKyAoJCgnI3BwLW5hdicpLmhlaWdodCgpLzIpICsgJ3B4Jyk7DQogICAgICAgICAgICAgICAgJCgnI3BwLW5hdicpLmZpbmQoJ2xpJykuZXEoJCgnLnBwLXNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5wcC1zZWN0aW9uJykpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHNjcm9sbFRvQW5jaG9yKCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyUmVuZGVyICkgJiYgb3B0aW9ucy5hZnRlclJlbmRlci5jYWxsKCB0aGlzKTsNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBFbmFibGVzIHZlcnRpY2FsIGNlbnRlcmluZyBieSB3cmFwcGluZyB0aGUgY29udGVudCBhbmQgdGhlIHVzZSBvZiB0YWJsZSBhbmQgdGFibGUtY2VsbA0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhZGRUYWJsZUNsYXNzKGVsZW1lbnQpew0KICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygncHAtdGFibGUnKS53cmFwSW5uZXIoJzxkaXYgY2xhc3M9InBwLXRhYmxlQ2VsbCIgc3R5bGU9ImhlaWdodDoxMDAlIiAvPicpOw0KICAgICAgICB9DQoNCg0KICAgICAgIC8qKg0KICAgICAgICAqIFJldHVucyBgdXBgIG9yIGBkb3duYCBkZXBlbmRpbmcgb24gdGhlIHNjcm9sbGluZyBtb3ZlbWVudCB0byByZWFjaCBpdHMgZGVzdGluYXRpb24NCiAgICAgICAgKiBmcm9tIHRoZSBjdXJyZW50IHNlY3Rpb24uDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGdldFltb3ZlbWVudChkZXN0aW55KXsNCiAgICAgICAgICAgIHZhciBmcm9tSW5kZXggPSAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnBwLXNlY3Rpb24nKTsNCiAgICAgICAgICAgIHZhciB0b0luZGV4ID0gZGVzdGlueS5pbmRleCgnLnBwLXNlY3Rpb24nKTsNCg0KICAgICAgICAgICAgaWYoZnJvbUluZGV4ID4gdG9JbmRleCl7DQogICAgICAgICAgICAgICAgcmV0dXJuICd1cCc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gJ2Rvd24nOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogU2Nyb2xscyB0aGUgcGFnZSB0byB0aGUgZ2l2ZW4gZGVzdGluYXRpb24NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gc2Nyb2xsUGFnZShkZXN0aW5hdGlvbiwgYW5pbWF0ZWQpIHsNCiAgICAgICAgICAgIHZhciB2ID17DQogICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLA0KICAgICAgICAgICAgICAgIGFuaW1hdGVkOiBhbmltYXRlZCwNCiAgICAgICAgICAgICAgICBhY3RpdmVTZWN0aW9uOiAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKSwNCiAgICAgICAgICAgICAgICBhbmNob3JMaW5rOiBkZXN0aW5hdGlvbi5kYXRhKCdhbmNob3InKSwNCiAgICAgICAgICAgICAgICBzZWN0aW9uSW5kZXg6IGRlc3RpbmF0aW9uLmluZGV4KCcucHAtc2VjdGlvbicpLA0KICAgICAgICAgICAgICAgIHRvTW92ZTogZGVzdGluYXRpb24sDQogICAgICAgICAgICAgICAgeU1vdmVtZW50OiBnZXRZbW92ZW1lbnQoZGVzdGluYXRpb24pLA0KICAgICAgICAgICAgICAgIGxlYXZpbmdTZWN0aW9uOiAkKCcucHAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnBwLXNlY3Rpb24nKSArIDENCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIC8vcXVpdGluZyB3aGVuIGFjdGl2ZVNlY3Rpb24gaXMgdGhlIHRhcmdldCBlbGVtZW50DQogICAgICAgICAgICBpZih2LmFjdGl2ZVNlY3Rpb24uaXMoZGVzdGluYXRpb24pKXsgcmV0dXJuOyB9DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZiB2LmFuaW1hdGVkID09PSAndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdi5hbmltYXRlZCA9IHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZiB2LmFuY2hvckxpbmsgIT09ICd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICBzZXRVUkxIYXNoKHYuYW5jaG9yTGluayk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHYuZGVzdGluYXRpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KDQogICAgICAgICAgICB2LnNlY3Rpb25zVG9Nb3ZlID0gZ2V0U2VjdGlvbnNUb01vdmUodik7DQoNCiAgICAgICAgICAgIC8vc2Nyb2xsaW5nIGRvd24gKG1vdmluZyBzZWN0aW9ucyB1cCBtYWtpbmcgdGhlbSBkaXNhcHBlYXIpDQogICAgICAgICAgICBpZiAodi55TW92ZW1lbnQgPT09ICdkb3duJykgew0KICAgICAgICAgICAgICAgIHYudHJhbnNsYXRlM2QgPSBnZXRUcmFuc2xhdGUzZCgpOw0KICAgICAgICAgICAgICAgIHYuc2Nyb2xsaW5nID0gJy0xMDAlJzsNCg0KICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmNzczMpew0KICAgICAgICAgICAgICAgICAgICB2LnNlY3Rpb25zVG9Nb3ZlLmVhY2goZnVuY3Rpb24oaW5kZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggIT0gdi5hY3RpdmVTZWN0aW9uLmluZGV4KCcucHAtc2VjdGlvbicpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhnZXRTY3JvbGxQcm9wKHYuc2Nyb2xsaW5nKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHYuYW5pbWF0ZVNlY3Rpb24gPSB2LmFjdGl2ZVNlY3Rpb247DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vc2Nyb2xsaW5nIHVwIChtb3Zpbmcgc2VjdGlvbiBkb3duIHRvIHRoZSB2aWV3cG9ydCkNCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHYudHJhbnNsYXRlM2QgPSAndHJhbnNsYXRlM2QoMHB4LCAwcHgsIDBweCknOw0KICAgICAgICAgICAgICAgIHYuc2Nyb2xsaW5nID0gJzAnOw0KDQogICAgICAgICAgICAgICAgdi5hbmltYXRlU2VjdGlvbiA9IGRlc3RpbmF0aW9uOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkLmlzRnVuY3Rpb24ob3B0aW9ucy5vbkxlYXZlKSAmJiBvcHRpb25zLm9uTGVhdmUuY2FsbCh0aGlzLCB2LmxlYXZpbmdTZWN0aW9uLCAodi5zZWN0aW9uSW5kZXggKyAxKSwgdi55TW92ZW1lbnQpOw0KDQogICAgICAgICAgICBwZXJmb3JtTW92ZW1lbnQodik7DQoNCiAgICAgICAgICAgIGFjdGl2YXRlTWVudUVsZW1lbnQodi5hbmNob3JMaW5rKTsNCiAgICAgICAgICAgIGFjdGl2YXRlTmF2RG90cyh2LmFuY2hvckxpbmssIHYuc2VjdGlvbkluZGV4KTsNCiAgICAgICAgICAgIGxhc3RTY3JvbGxlZERlc3RpbnkgPSB2LmFuY2hvckxpbms7DQoNCiAgICAgICAgICAgIHZhciB0aW1lTm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgICAgICBsYXN0QW5pbWF0aW9uID0gdGltZU5vdzsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIFBlcmZvcm1zIHRoZSBtb3ZlbWVudCAoYnkgQ1NTMyBvciBieSBqUXVlcnkpDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHBlcmZvcm1Nb3ZlbWVudCh2KXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuY3NzMyl7DQogICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udGFpbmVyKHYuYW5pbWF0ZVNlY3Rpb24sIHYudHJhbnNsYXRlM2QsIHYuYW5pbWF0ZWQpOw0KDQogICAgICAgICAgICAgICAgdi5zZWN0aW9uc1RvTW92ZS5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvbnRhaW5lcigkKHRoaXMpLCB2LnRyYW5zbGF0ZTNkLCB2LmFuaW1hdGVkKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBhZnRlclNlY3Rpb25Mb2Fkcyh2KTsNCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHYuc2Nyb2xsT3B0aW9ucyA9IGdldFNjcm9sbFByb3Aodi5zY3JvbGxpbmcpOw0KDQogICAgICAgICAgICAgICAgaWYodi5hbmltYXRlZCl7DQogICAgICAgICAgICAgICAgICAgIHYuYW5pbWF0ZVNlY3Rpb24uYW5pbWF0ZSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHYuc2Nyb2xsT3B0aW9ucw0KICAgICAgICAgICAgICAgICAgICAsIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZWFkanVzdFNlY3Rpb25zKHYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGp1c3RTZWN0aW9ucyh2KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHYuYW5pbWF0ZVNlY3Rpb24uY3NzKGdldFNjcm9sbFByb3Aodi5zY3JvbGxpbmcpKTsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGp1c3RTZWN0aW9ucyh2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU2VjdGlvbkxvYWRzKHYpOw0KICAgICAgICAgICAgICAgICAgICB9LDQwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWN0aW9ucyB0byBleGVjdXRlIGFmdGVyIGEgc2VjaW9uIGlzIGxvYWRlZA0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhZnRlclNlY3Rpb25Mb2Fkcyh2KXsNCiAgICAgICAgICAgIC8vY2FsbGJhY2sgKGFmdGVyTG9hZCkgaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCiAgICAgICAgICAgICQuaXNGdW5jdGlvbihvcHRpb25zLmFmdGVyTG9hZCkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCh0aGlzLCB2LmFuY2hvckxpbmssICh2LnNlY3Rpb25JbmRleCArIDEpKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0U2VjdGlvbnNUb01vdmUodil7DQogICAgICAgICAgICB2YXIgc2VjdGlvblRvTW92ZTsNCg0KICAgICAgICAgICAgaWYodi55TW92ZW1lbnQgPT09ICdkb3duJyl7DQogICAgICAgICAgICAgICAgc2VjdGlvblRvTW92ZSA9ICQoJy5wcC1zZWN0aW9uJykubWFwKGZ1bmN0aW9uKGluZGV4KXsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgdi5kZXN0aW5hdGlvbi5pbmRleCgnLnBwLXNlY3Rpb24nKSl7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgc2VjdGlvblRvTW92ZSA9ICQoJy5wcC1zZWN0aW9uJykubWFwKGZ1bmN0aW9uKGluZGV4KXsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gdi5kZXN0aW5hdGlvbi5pbmRleCgnLnBwLXNlY3Rpb24nKSl7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gc2VjdGlvblRvTW92ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIFJldHVybnMgdGhlIHNlY3Rpb25zIHRvIHJlLWFkanVzdCBpbiB0aGUgYmFja2dyb3VuZCBhZnRlciB0aGUgc2VjdGlvbiBsb2Fkcy4NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gcmVhZGp1c3RTZWN0aW9ucyh2KXsNCiAgICAgICAgICAgIHZhciByZWFkanVzdFNlY3Rpb25zOw0KDQogICAgICAgICAgICBpZih2LnlNb3ZlbWVudCA9PT0gJ3VwJyl7DQogICAgICAgICAgICAgICAgdi5zZWN0aW9uc1RvTW92ZS5lYWNoKGZ1bmN0aW9uKGluZGV4KXsNCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoZ2V0U2Nyb2xsUHJvcCh2LnNjcm9sbGluZykpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gcmVhZGp1c3RTZWN0aW9uczsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEdldHMgdGhlIHByb3BlcnR5IHVzZWQgdG8gY3JlYXRlIHRoZSBzY3JvbGxpbmcgZWZmZWN0IHdoZW4gdXNpbmcgalF1ZXJ5IGFuaW1hdGlvbnMNCiAgICAgICAgKiBkZXBlbmRpbmcgb24gdGhlIHBsdWdpbiBkaXJlY3Rpb24gb3B0aW9uLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBnZXRTY3JvbGxQcm9wKHByb3BlcnR5VmFsdWUpew0KICAgICAgICAgICAgaWYob3B0aW9ucy5kaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpew0KICAgICAgICAgICAgICAgIHJldHVybiB7J3RvcCc6IHByb3BlcnR5VmFsdWV9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHsnbGVmdCc6IHByb3BlcnR5VmFsdWV9Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogU2Nyb2xscyB0aGUgc2l0ZSB3aXRob3V0IGFueW1hdGlvbnMgKHVzdWFsbHkgdXNlZCBpbiB0aGUgYmFja2dyb3VuZCB3aXRob3V0IHRoZSB1c2VyIG5vdGljaW5nIGl0KQ0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBzaWxlbnRTY3JvbGwoc2VjdGlvbiwgb2Zmc2V0KXsNCiAgICAgICAgICAgIGlmIChvcHRpb25zLmNzczMpIHsNCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250YWluZXIoc2VjdGlvbiwgZ2V0VHJhbnNsYXRlM2QoKSwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBzZWN0aW9uLmNzcyhnZXRTY3JvbGxQcm9wKG9mZnNldCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogU2V0cyB0aGUgVVJMIGhhc2ggZm9yIGEgc2VjdGlvbiB3aXRoIHNsaWRlcw0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBzZXRVUkxIYXNoKGFuY2hvckxpbmspew0KICAgICAgICAgICAgaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvL1RPIERPDQogICAgICAgIGZ1bmN0aW9uIHNjcm9sbFRvQW5jaG9yKCl7DQogICAgICAgICAgICAvL2dldHRpbmcgdGhlIGFuY2hvciBsaW5rIGluIHRoZSBVUkwgYW5kIGRlbGV0aW5nIHRoZSBgI2ANCiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpOw0KICAgICAgICAgICAgdmFyIHNlY3Rpb25BbmNob3IgPSB2YWx1ZTsNCiAgICAgICAgICAgIHZhciBzZWN0aW9uID0gJCgnLnBwLXNlY3Rpb25bZGF0YS1hbmNob3I9Iicrc2VjdGlvbkFuY2hvcisnIl0nKTsNCg0KICAgICAgICAgICAgaWYoc2VjdGlvbi5sZW5ndGggPiAwKXsgIC8vaWYgdGhlcmVzIGFueSAjDQogICAgICAgICAgICAgICAgc2Nyb2xsUGFnZShzZWN0aW9uLCBvcHRpb25zLmFuaW1hdGVBbmNob3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgdHJhbnNpdGlvbnMgYmV0d2VlbiBzZWN0aW9ucyBzdGlsbCB0YWtpbmcgcGxhY2UuDQogICAgICAgICogVGhlIHZhcmlhYmxlIGBzY3JvbGxEZWxheWAgYWRkcyBhICJzYXZlIHpvbmUiIGZvciBkZXZpY2VzIHN1Y2ggYXMgQXBwbGUgbGFwdG9wcyBhbmQgQXBwbGUgbWFnaWMgbW91c2VzDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGlzTW92aW5nKCl7DQogICAgICAgICAgICB2YXIgdGltZU5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICAgICAgLy8gQ2FuY2VsIHNjcm9sbCBpZiBjdXJyZW50bHkgYW5pbWF0aW5nIG9yIHdpdGhpbiBxdWlldCBwZXJpb2QNCiAgICAgICAgICAgIGlmICh0aW1lTm93IC0gbGFzdEFuaW1hdGlvbiA8IHNjcm9sbERlbGF5ICsgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9kZXRlY3RpbmcgYW55IGNoYW5nZSBvbiB0aGUgVVJMIHRvIHNjcm9sbCB0byB0aGUgZ2l2ZW4gYW5jaG9yIGxpbmsNCiAgICAgICAgLy8oYSB3YXkgdG8gZGV0ZWN0IGJhY2sgaGlzdG9yeSBidXR0b24gYXMgd2UgcGxheSB3aXRoIHRoZSBoYXNoZXMgb24gdGhlIFVSTCkNCiAgICAgICAgJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgaGFzaENoYW5nZUhhbmRsZXIpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEFjdGlvbnMgdG8gZG8gd2hlbiB0aGUgaGFzaCAoIykgaW4gdGhlIFVSTCBjaGFuZ2VzLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBoYXNoQ2hhbmdlSGFuZGxlcigpew0KICAgICAgICAgICAgdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCiAgICAgICAgICAgIHZhciBzZWN0aW9uQW5jaG9yID0gdmFsdWVbMF07DQoNCiAgICAgICAgICAgIGlmKHNlY3Rpb25BbmNob3IubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAvL3doZW4gbW92aW5nIHRvIGEgc2xpZGUgaW4gdGhlIGZpcnN0IHNlY3Rpb24gZm9yIHRoZSBmaXJzdCB0aW1lIChmaXJzdCB0aW1lIHRvIGFkZCBhbiBhbmNob3IgdG8gdGhlIFVSTCkNCiAgICAgICAgICAgICAgICB2YXIgaXNGaXJzdE1vdmUgPSAgKHR5cGVvZiBsYXN0U2Nyb2xsZWREZXN0aW55ID09PSAndW5kZWZpbmVkJyk7DQoNCiAgICAgICAgICAgICAgICAvKmluIG9yZGVyIHRvIGNhbGwgc2Nyb2xscGFnZSgpIG9ubHkgb25jZSBmb3IgZWFjaCBkZXN0aW5hdGlvbiBhdCBhIHRpbWUNCiAgICAgICAgICAgICAgICBJdCBpcyBjYWxsZWQgdHdpY2UgZm9yIGVhY2ggc2Nyb2xsIG90aGVyd2lzZSwgYXMgaW4gY2FzZSBvZiB1c2luZyBhbmNob3JsaW5rcyBgaGFzaENoYW5nZWANCiAgICAgICAgICAgICAgICBldmVudCBpcyBmaXJlZCBvbiBldmVyeSBzY3JvbGwgdG9vLiovDQogICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25BbmNob3IgJiYgc2VjdGlvbkFuY2hvciAhPT0gbGFzdFNjcm9sbGVkRGVzdGlueSkgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoaXNOYU4oc2VjdGlvbkFuY2hvcikpew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlY3Rpb24gPSAkKCdbZGF0YS1hbmNob3I9Iicrc2VjdGlvbkFuY2hvcisnIl0nKTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VjdGlvbiA9ICQoJy5wcC1zZWN0aW9uJykuZXEoIChzZWN0aW9uQW5jaG9yIC0xKSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHNjcm9sbFBhZ2Uoc2VjdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQ3Jvc3MgYnJvd3NlciB0cmFuc2Zvcm1hdGlvbnMNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCkgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZCwNCiAgICAgICAgICAgICAgICAgICAgJy1tb3otdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQogICAgICAgICAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQogICAgICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZA0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBZGRzIGEgY3NzMyB0cmFuc2Zvcm0gcHJvcGVydHkgdG8gdGhlIGNvbnRhaW5lciBjbGFzcyB3aXRoIG9yIHdpdGhvdXQgYW5pbWF0aW9uIGRlcGVuZGluZyBvbiB0aGUgYW5pbWF0ZWQgcGFyYW0uDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Db250YWluZXIoZWxlbWVudCwgdHJhbnNsYXRlM2QsIGFuaW1hdGVkKSB7DQogICAgICAgICAgICBlbGVtZW50LnRvZ2dsZUNsYXNzKCdwcC1lYXNpbmcnLCBhbmltYXRlZCk7DQoNCiAgICAgICAgICAgIGVsZW1lbnQuY3NzKGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2QpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTbGlkaW5nIHdpdGggYXJyb3cga2V5cywgYm90aCwgdmVydGljYWwgYW5kIGhvcml6b250YWwNCiAgICAgICAgICovDQogICAgICAgICQoZG9jdW1lbnQpLmtleWRvd24oZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMua2V5Ym9hcmRTY3JvbGxpbmcgJiYgIWlzTW92aW5nKCkpew0KICAgICAgICAgICAgICAgIC8vTW92aW5nIHRoZSBtYWluIHBhZ2Ugd2l0aCB0aGUga2V5Ym9hcmQgYXJyb3dzIGlmIGtleWJvYXJkIHNjcm9sbGluZyBpcyBlbmFibGVkDQogICAgICAgICAgICAgICAgc3dpdGNoIChlLndoaWNoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvL3VwDQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzg6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzM6DQogICAgICAgICAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcubW92ZVNlY3Rpb25VcCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vZG93bg0KICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOg0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM0Og0KICAgICAgICAgICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVTZWN0aW9uRG93bigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vSG9tZQ0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM2Og0KICAgICAgICAgICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVUbygxKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvL0VuZA0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM1Og0KICAgICAgICAgICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLm1vdmVUbygkKCcucHAtc2VjdGlvbicpLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy9sZWZ0DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzc6DQogICAgICAgICAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcubW92ZVNlY3Rpb25VcCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOToNCiAgICAgICAgICAgICAgICAgICAgICAgICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvbkRvd24oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGV4aXQgdGhpcyBoYW5kbGVyIGZvciBvdGhlciBrZXlzDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvKioNCiAgICAgICAgKiBJZiBgbm9ybWFsU2Nyb2xsRWxlbWVudHNgIGlzIHVzZWQsIHRoZSBtb3VzZSB3aGVlbCBzY3JvbGxpbmcgd2lsbCBzY3JvbGwgbm9ybWFsbHkNCiAgICAgICAgKiBvdmVyIHRoZSBkZWZpbmVkIGVsZW1lbnRzIGluIHRoZSBvcHRpb24uDQogICAgICAgICovDQogICAgICAgIGlmKG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpew0KICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNlZW50ZXInLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgJC5mbi5wYWdlcGlsaW5nLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcoZmFsc2UpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZWxlYXZlJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAkLmZuLnBhZ2VwaWxpbmcuc2V0TW91c2VXaGVlbFNjcm9sbGluZyh0cnVlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIERldGVjdGluZyBtb3VzZXdoZWVsIHNjcm9sbGluZw0KICAgICAgICAgKg0KICAgICAgICAgKiBodHRwOi8vYmxvZ3Muc2l0ZXBvaW50c3RhdGljLmNvbS9leGFtcGxlcy90ZWNoL21vdXNlLXdoZWVsL2luZGV4Lmh0bWwNCiAgICAgICAgICogaHR0cDovL3d3dy5zaXRlcG9pbnQuY29tL2h0bWw1LWphdmFzY3JpcHQtbW91c2Utd2hlZWwvDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBNb3VzZVdoZWVsSGFuZGxlcihlKSB7DQogICAgICAgICAgICBpZighaXNNb3ZpbmcoKSl7DQogICAgICAgICAgICAgICAgLy8gY3Jvc3MtYnJvd3NlciB3aGVlbCBkZWx0YQ0KICAgICAgICAgICAgICAgIGUgPSB3aW5kb3cuZXZlbnQgfHwgZTsNCiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChlLndoZWVsRGVsdGEgfHwgLWUuZGVsdGFZIHx8IC1lLmRldGFpbCkpKTsNCg0KICAgICAgICAgICAgICAgIHZhciBhY3RpdmVTZWN0aW9uID0gJCgnLnBwLXNlY3Rpb24uYWN0aXZlJyk7DQogICAgICAgICAgICAgICAgdmFyIHNjcm9sbGFibGUgPSBpc1Njcm9sbGFibGUoYWN0aXZlU2VjdGlvbik7DQoNCiAgICAgICAgICAgICAgICAvL3Njcm9sbGluZyBkb3duPw0KICAgICAgICAgICAgICAgIGlmIChkZWx0YSA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nKCdkb3duJywgc2Nyb2xsYWJsZSk7DQoNCiAgICAgICAgICAgICAgICAvL3Njcm9sbGluZyB1cD8NCiAgICAgICAgICAgICAgICB9ZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZygndXAnLCBzY3JvbGxhYmxlKTsNCiAgICAgICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgKiBEZXRlcm1pbmVzIHRoZSB3YXkgb2Ygc2Nyb2xsaW5nIHVwIG9yIGRvd246DQogICAgICAgICogYnkgJ2F1dG9tYXRpY2FsbHknIHNjcm9sbGluZyBhIHNlY3Rpb24gb3IgYnkgdXNpbmcgdGhlIGRlZmF1bHQgYW5kIG5vcm1hbCBzY3JvbGxpbmcuDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHNjcm9sbGluZyh0eXBlLCBzY3JvbGxhYmxlKXsNCiAgICAgICAgICAgIGlmKHR5cGUgPT0gJ2Rvd24nKXsNCiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSAnYm90dG9tJzsNCiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsU2VjdGlvbiA9ICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvbkRvd247DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSAndG9wJzsNCiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsU2VjdGlvbiA9ICQuZm4ucGFnZXBpbGluZy5tb3ZlU2VjdGlvblVwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihzY3JvbGxhYmxlLmxlbmd0aCA+IDAgKXsNCiAgICAgICAgICAgICAgICAvL2lzIHRoZSBzY3JvbGxiYXIgYXQgdGhlIHN0YXJ0L2VuZCBvZiB0aGUgc2Nyb2xsPw0KICAgICAgICAgICAgICAgIGlmKGlzU2Nyb2xsZWQoY2hlY2ssIHNjcm9sbGFibGUpKXsNCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsU2VjdGlvbigpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvLyBtb3ZlZCB1cC9kb3duDQogICAgICAgICAgICAgICAgc2Nyb2xsU2VjdGlvbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgIC8qKg0KICAgICAgICAqIERldGVybWluZXMgd2hldGhlciB0aGUgYWN0aXZlIHNlY3Rpb24gb3Igc2xpZGUgaXMgc2Nyb2xsYWJsZSB0aHJvdWdoIGFuZCBzY3JvbGxpbmcgYmFyDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGlzU2Nyb2xsYWJsZShhY3RpdmVTZWN0aW9uKXsNCiAgICAgICAgICAgIHNjcm9sbGFibGUgPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5wcC1zY3JvbGxhYmxlJyk7DQoNCiAgICAgICAgICAgIHJldHVybiBzY3JvbGxhYmxlOw0KICAgICAgICB9DQoNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAqIFJlbW92ZXMgdGhlIGF1dG8gc2Nyb2xsaW5nIGFjdGlvbiBmaXJlZCBieSB0aGUgbW91c2Ugd2hlZWwgYW5kIHRhY2twYWQuDQogICAgICAgICogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSBtb3VzZXdoZWVsIGFuZCB0cmFja3BhZCBtb3ZlbWVudHMgd29uJ3Qgc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMuDQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHJlbW92ZU1vdXNlV2hlZWxIYW5kbGVyKCl7DQogICAgICAgICAgICBpZiAoY29udGFpbmVyLmdldCgwKS5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICAgICAgY29udGFpbmVyLmdldCgwKS5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQogICAgICAgICAgICAgICAgY29udGFpbmVyLmdldCgwKS5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vRmlyZWZveA0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0KDApLmRldGFjaEV2ZW50KCJvbm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlcik7IC8vSUUgNi83LzgNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEFkZHMgdGhlIGF1dG8gc2Nyb2xsaW5nIGFjdGlvbiBmb3IgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KICAgICAgICAqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdpbGwgc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYWRkTW91c2VXaGVlbEhhbmRsZXIoKXsNCiAgICAgICAgICAgIGlmIChjb250YWluZXIuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0lFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXINCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5nZXQoMCkuYXR0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQWRkcyB0aGUgcG9zc2liaWxpdHkgdG8gYXV0byBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucyBvbiB0b3VjaCBkZXZpY2VzLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhZGRUb3VjaEhhbmRsZXIoKXsNCiAgICAgICAgICAgIGlmKGlzVG91Y2gpew0KICAgICAgICAgICAgICAgIC8vTWljcm9zb2Z0IHBvaW50ZXJzDQogICAgICAgICAgICAgICAgTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCiAgICAgICAgICAgICAgICBjb250YWluZXIub2ZmKCd0b3VjaHN0YXJ0ICcgKyAgTVNQb2ludGVyLmRvd24pLm9uKCd0b3VjaHN0YXJ0ICcgKyBNU1BvaW50ZXIuZG93biwgdG91Y2hTdGFydEhhbmRsZXIpOw0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUpLm9uKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlLCB0b3VjaE1vdmVIYW5kbGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIFJlbW92ZXMgdGhlIGF1dG8gc2Nyb2xsaW5nIGZvciB0b3VjaCBkZXZpY2VzLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiByZW1vdmVUb3VjaEhhbmRsZXIoKXsNCiAgICAgICAgICAgIGlmKGlzVG91Y2gpew0KICAgICAgICAgICAgICAgIC8vTWljcm9zb2Z0IHBvaW50ZXJzDQogICAgICAgICAgICAgICAgTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCiAgICAgICAgICAgICAgICBjb250YWluZXIub2ZmKCd0b3VjaHN0YXJ0ICcgKyBNU1BvaW50ZXIuZG93bik7DQogICAgICAgICAgICAgICAgY29udGFpbmVyLm9mZigndG91Y2htb3ZlICcgKyBNU1BvaW50ZXIubW92ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAqIFJldHVybnMgYW5kIG9iamVjdCB3aXRoIE1pY3Jvc29mdCBwb2ludGVycyAoZm9yIElFPDExIGFuZCBmb3IgSUUgPj0gMTEpDQogICAgICAgICogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2RuMzA0ODg2KHY9dnMuODUpLmFzcHgNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0TVNQb2ludGVyKCl7DQogICAgICAgICAgICB2YXIgcG9pbnRlcjsNCg0KICAgICAgICAgICAgLy9JRSA+PSAxMQ0KICAgICAgICAgICAgaWYod2luZG93LlBvaW50ZXJFdmVudCl7DQogICAgICAgICAgICAgICAgcG9pbnRlciA9IHsgZG93bjogInBvaW50ZXJkb3duIiwgbW92ZTogInBvaW50ZXJtb3ZlIiwgdXA6ICJwb2ludGVydXAifTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy9JRSA8IDExDQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgIHBvaW50ZXIgPSB7IGRvd246ICJNU1BvaW50ZXJEb3duIiwgbW92ZTogIk1TUG9pbnRlck1vdmUiLCB1cDogIk1TUG9pbnRlclVwIn07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBwb2ludGVyOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogR2V0cyB0aGUgcGFnZVggYW5kIHBhZ2VZIHByb3BlcnRpZXMgZGVwZW5kaW5nIG9uIHRoZSBicm93c2VyLg0KICAgICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHZhcm90cmlnby9mdWxsUGFnZS5qcy9pc3N1ZXMvMTk0I2lzc3VlY29tbWVudC0zNDA2OTg1NA0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBnZXRFdmVudHNQYWdlKGUpew0KICAgICAgICAgICAgdmFyIGV2ZW50cyA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCl7DQogICAgICAgICAgICAgICAgZXZlbnRzWyd5J10gPSBlLnBhZ2VZOw0KICAgICAgICAgICAgICAgIGV2ZW50c1sneCddID0gZS5wYWdlWDsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIGV2ZW50c1sneSddID0gZS50b3VjaGVzWzBdLnBhZ2VZOw0KICAgICAgICAgICAgICAgIGV2ZW50c1sneCddID0gIGUudG91Y2hlc1swXS5wYWdlWDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGV2ZW50czsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEdldHRpbmcgdGhlIHN0YXJ0aW5nIHBvc3NpdGlvbnMgb2YgdGhlIHRvdWNoIGV2ZW50DQogICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHRvdWNoU3RhcnRIYW5kbGVyKGV2ZW50KXsNCg0KICAgICAgICAgICAgdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KICAgICAgICAgICAgdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCiAgICAgICAgICAgIHRvdWNoU3RhcnRZID0gdG91Y2hFdmVudHNbJ3knXTsNCiAgICAgICAgICAgIHRvdWNoU3RhcnRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERldGVjdGluZyB0b3VjaCBldmVudHMNCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gdG91Y2hNb3ZlSGFuZGxlcihldmVudCl7DQogICAgICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7DQoNCiAgICAgICAgICAgIC8vIGFkZGl0aW9uYWw6IGlmIG9uZSBvZiB0aGUgbm9ybWFsU2Nyb2xsRWxlbWVudHMgaXNuJ3Qgd2l0aGluIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkIGhvcHMgdXAgdGhlIERPTSBjaGFpbg0KICAgICAgICAgICAgaWYgKCFjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQoZXZlbnQudGFyZ2V0KSkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5wcC1zZWN0aW9uLmFjdGl2ZScpOw0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxhYmxlID0gaXNTY3JvbGxhYmxlKGFjdGl2ZVNlY3Rpb24pOw0KDQogICAgICAgICAgICAgICAgaWYgKCFpc01vdmluZygpKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQogICAgICAgICAgICAgICAgICAgIHRvdWNoRW5kWSA9IHRvdWNoRXZlbnRzWyd5J107DQogICAgICAgICAgICAgICAgICAgIHRvdWNoRW5kWCA9IHRvdWNoRXZlbnRzWyd4J107DQoNCiAgICAgICAgICAgICAgICAgIC8vJCgnYm9keScpLmFwcGVuZCgnPHNwYW4gc3R5bGU9InBvc2l0aW9uOmZpeGVkOyB0b3A6IDI1MHB4OyBsZWZ0OiAyMHB4OyB6LWluZGV4Ojg4OyBmb250LXNpemU6IDI1cHg7IGNvbG9yOiAjMDAwOyI+dG91Y2hFbmRZOiAnICsgdG91Y2hFbmRZICArICc8L2Rpdj4nKTsNCg0KICAgICAgICAgICAgICAgICAgICAvL1ggbW92ZW1lbnQgYmlnZ2VyIHRoYW4gWSBtb3ZlbWVudD8NCiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCcgJiYgTWF0aC5hYnModG91Y2hTdGFydFggLSB0b3VjaEVuZFgpID4gKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WCAtIHRvdWNoRW5kWCkgPiAoY29udGFpbmVyLndpZHRoKCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoU3RhcnRYID4gdG91Y2hFbmRYKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZygnZG93bicsIHNjcm9sbGFibGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG91Y2hFbmRYID4gdG91Y2hTdGFydFgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nKCd1cCcsIHNjcm9sbGFibGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WSAtIHRvdWNoRW5kWSkgPiAoY29udGFpbmVyLmhlaWdodCgpIC8gMTAwICogb3B0aW9ucy50b3VjaFNlbnNpdGl2aXR5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFN0YXJ0WSA+IHRvdWNoRW5kWSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxpbmcoJ2Rvd24nLCBzY3JvbGxhYmxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvdWNoRW5kWSA+IHRvdWNoU3RhcnRZKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZygndXAnLCBzY3JvbGxhYmxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogcmVjdXJzaXZlIGZ1bmN0aW9uIHRvIGxvb3AgdXAgdGhlIHBhcmVudCBub2RlcyB0byBjaGVjayBpZiBvbmUgb2YgdGhlbSBleGlzdHMgaW4gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cw0KICAgICAgICAgKiBDdXJyZW50bHkgd29ya3Mgd2VsbCBmb3IgaU9TIC0gQW5kcm9pZCBtaWdodCBuZWVkIHNvbWUgdGVzdGluZw0KICAgICAgICAgKiBAcGFyYW0gIHtFbGVtZW50fSBlbCAgdGFyZ2V0IGVsZW1lbnQgLyBqcXVlcnkgc2VsZWN0b3IgKGluIHN1YnNlcXVlbnQgbm9kZXMpDQogICAgICAgICAqIEBwYXJhbSAge2ludH0gICAgIGhvcCBjdXJyZW50IGhvcCBjb21wYXJlZCB0byBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZA0KICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZXJlIGlzIGEgbWF0Y2ggdG8gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cw0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gY2hlY2tQYXJlbnRGb3JOb3JtYWxTY3JvbGxFbGVtZW50IChlbCwgaG9wKSB7DQogICAgICAgICAgICBob3AgPSBob3AgfHwgMDsNCiAgICAgICAgICAgIHZhciBwYXJlbnQgPSAkKGVsKS5wYXJlbnQoKTsNCg0KICAgICAgICAgICAgaWYgKGhvcCA8IG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkICYmDQogICAgICAgICAgICAgICAgcGFyZW50LmlzKG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChob3AgPT0gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQocGFyZW50LCArK2hvcCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8qKg0KICAgICAgICAqIENyZWF0ZXMgYSB2ZXJ0aWNhbCBuYXZpZ2F0aW9uIGJhci4NCiAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYWRkVmVydGljYWxOYXZpZ2F0aW9uKCl7DQogICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPSJwcC1uYXYiPjx1bD48L3VsPjwvZGl2PicpOw0KICAgICAgICAgICAgdmFyIG5hdiA9ICQoJyNwcC1uYXYnKTsNCg0KICAgICAgICAgICAgbmF2LmNzcygnY29sb3InLCBvcHRpb25zLm5hdmlnYXRpb24udGV4dENvbG9yKTsNCg0KICAgICAgICAgICAgbmF2LmFkZENsYXNzKG9wdGlvbnMubmF2aWdhdGlvbi5wb3NpdGlvbik7DQoNCiAgICAgICAgICAgIGZvcih2YXIgY29udCA9IDA7IGNvbnQgPCAkKCcucHAtc2VjdGlvbicpLmxlbmd0aDsgY29udCsrKXsNCiAgICAgICAgICAgICAgICB2YXIgbGluayA9ICcnOw0KICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMuYW5jaG9ycy5sZW5ndGgpew0KICAgICAgICAgICAgICAgICAgICBsaW5rID0gb3B0aW9ucy5hbmNob3JzW2NvbnRdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZih0eXBlb2Ygb3B0aW9ucy5uYXZpZ2F0aW9uLnRvb2x0aXBzICE9PSAndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHZhciB0b29sdGlwID0gb3B0aW9ucy5uYXZpZ2F0aW9uLnRvb2x0aXBzW2NvbnRdOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgdG9vbHRpcCA9PT0gJ3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGkgZGF0YS10b29sdGlwPSInICsgdG9vbHRpcCArICciPjxhIGhyZWY9IiMnICsgbGluayArICciPjxzcGFuPjwvc3Bhbj48L2E+PC9saT4nKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbmF2LmZpbmQoJ3NwYW4nKS5jc3MoJ2JvcmRlci1jb2xvcicsIG9wdGlvbnMubmF2aWdhdGlvbi5idWxsZXRzQ29sb3IpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogU2Nyb2xscyB0byB0aGUgc2VjdGlvbiB3aGVuIGNsaWNraW5nIHRoZSBuYXZpZ2F0aW9uIGJ1bGxldA0KICAgICAgICAqLw0KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsICcjcHAtbmF2IGEnLCBmdW5jdGlvbihlKXsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykucGFyZW50KCkuaW5kZXgoKTsNCg0KICAgICAgICAgICAgc2Nyb2xsUGFnZSgkKCcucHAtc2VjdGlvbicpLmVxKGluZGV4KSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8qKg0KICAgICAgICAqIE5hdmlnYXRpb24gdG9vbHRpcHMNCiAgICAgICAgKi8NCiAgICAgICAgJChkb2N1bWVudCkub24oew0KICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICB2YXIgdG9vbHRpcCA9ICQodGhpcykuZGF0YSgndG9vbHRpcCcpOw0KICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9InBwLXRvb2x0aXAgJyArIG9wdGlvbnMubmF2aWdhdGlvbi5wb3NpdGlvbiArJyI+JyArIHRvb2x0aXAgKyAnPC9kaXY+JykuaGlkZSgpLmFwcGVuZFRvKCQodGhpcykpLmZhZGVJbigyMDApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcucHAtdG9vbHRpcCcpLmZhZGVPdXQoMjAwLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgJyNwcC1uYXYgbGknKTsNCg0KICAgICAgICAgLyoqDQogICAgICAgICAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbmF2aWdhdGlvbiBkb3RzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlTmF2RG90cyhuYW1lLCBzZWN0aW9uSW5kZXgpew0KICAgICAgICAgICAgaWYob3B0aW9ucy5uYXZpZ2F0aW9uKXsNCiAgICAgICAgICAgICAgICAkKCcjcHAtbmF2JykuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCiAgICAgICAgICAgICAgICBpZihuYW1lKXsNCiAgICAgICAgICAgICAgICAgICAgJCgnI3BwLW5hdicpLmZpbmQoJ2FbaHJlZj0iIycgKyBuYW1lICsgJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAkKCcjcHAtbmF2JykuZmluZCgnbGknKS5lcShzZWN0aW9uSW5kZXgpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbWFpbiBtZW51IGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlTWVudUVsZW1lbnQobmFtZSl7DQogICAgICAgICAgICBpZihvcHRpb25zLm1lbnUpew0KICAgICAgICAgICAgICAgICQob3B0aW9ucy5tZW51KS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICQob3B0aW9ucy5tZW51KS5maW5kKCdbZGF0YS1tZW51YW5jaG9yPSInK25hbWUrJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICogQ2hlY2tzIGZvciB0cmFuc2xhdGUzZCBzdXBwb3J0DQogICAgICAgICogQHJldHVybiBib29sZWFuDQogICAgICAgICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81NjYxNjcxL2RldGVjdGluZy10cmFuc2Zvcm0tdHJhbnNsYXRlM2Qtc3VwcG9ydA0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBzdXBwb3J0M2QoKSB7DQogICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyksDQogICAgICAgICAgICAgICAgaGFzM2QsDQogICAgICAgICAgICAgICAgdHJhbnNmb3JtcyA9IHsNCiAgICAgICAgICAgICAgICAgICAgJ3dlYmtpdFRyYW5zZm9ybSc6Jy13ZWJraXQtdHJhbnNmb3JtJywNCiAgICAgICAgICAgICAgICAgICAgJ09UcmFuc2Zvcm0nOictby10cmFuc2Zvcm0nLA0KICAgICAgICAgICAgICAgICAgICAnbXNUcmFuc2Zvcm0nOictbXMtdHJhbnNmb3JtJywNCiAgICAgICAgICAgICAgICAgICAgJ01velRyYW5zZm9ybSc6Jy1tb3otdHJhbnNmb3JtJywNCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6J3RyYW5zZm9ybScNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGJvZHkgdG8gZ2V0IHRoZSBjb21wdXRlZCBzdHlsZS4NCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGVsLCBudWxsKTsNCg0KICAgICAgICAgICAgZm9yICh2YXIgdCBpbiB0cmFuc2Zvcm1zKSB7DQogICAgICAgICAgICAgICAgaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGVbdF0gPSAidHJhbnNsYXRlM2QoMXB4LDFweCwxcHgpIjsNCiAgICAgICAgICAgICAgICAgICAgaGFzM2QgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSh0cmFuc2Zvcm1zW3RdKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOw0KDQogICAgICAgICAgICByZXR1cm4gKGhhczNkICE9PSB1bmRlZmluZWQgJiYgaGFzM2QubGVuZ3RoID4gMCAmJiBoYXMzZCAhPT0gIm5vbmUiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAqIEdldHMgdGhlIHRyYW5zbGF0ZTNkIHByb3BlcnR5IHRvIGFwcGx5IHdoZW4gdXNpbmcgY3NzMzp0cnVlIGRlcGVuZGluZyBvbiB0aGUgYGRpcmVjdGlvbmAgb3B0aW9uLg0KICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBnZXRUcmFuc2xhdGUzZCgpew0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGlyZWN0aW9uICE9PSAndmVydGljYWwnKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZTNkKC0xMDAlLCAwcHgsIDBweCknOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZTNkKDBweCwgLTEwMCUsIDBweCknOw0KICAgICAgICB9DQoNCiAgICB9Ow0KfSkoalF1ZXJ5KTsNCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:35:59 GMT",
                    "Content-Length": "32236",
                    "Date": "Fri, 07 Nov 2014 21:35:59 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}