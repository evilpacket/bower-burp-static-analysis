{
    "url": "http://localhost:9999/shramov/leaflet-plugins/layer/OpenStreetBugs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location.pathname</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>a_link.href = location.protocol + '//' + location.host + location.pathname +     L.Util.getParamString(vars);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/shramov/leaflet-plugins/layer/OpenStreetBugs.js",
                "path": "/shramov/leaflet-plugins/layer/OpenStreetBugs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zaHJhbW92L2xlYWZsZXQtcGx1Z2lucy9sYXllci9PcGVuU3RyZWV0QnVncy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ0MjQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDg6MzE6MzYgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA4OjMxOjM2IEdNVA0KDQovKiBnbG9iYWwgYWxlcnQ6IHRydWUgKi8KTC5PcGVuU3RyZWV0QnVncyA9IEwuRmVhdHVyZUdyb3VwLmV4dGVuZCh7CglvcHRpb25zIDogewoJCXNlcnZlclVSTCA6ICdodHRwOi8vb3BlbnN0cmVldGJ1Z3Muc2Nob2tva2Vrcy5vcmcvYXBpLzAuMS8nLAoJCXJlYWRvbmx5IDogZmFsc2UsCgkJc2V0Q29va2llIDogdHJ1ZSwKCQl1c2VybmFtZSA6ICdOb05hbWUnLAoJCWNvb2tpZUxpZmV0aW1lIDogMTAwMCwKCQljb29raWVQYXRoIDogbnVsbCwKCQlwZXJtYWxpbmtab29tIDogMTQsCgkJcGVybWFsaW5rVXJsOiBudWxsLAoJCW9wYWNpdHkgOiAwLjcsCgkJc2hvd09wZW46IHRydWUsCgkJc2hvd0Nsb3NlZDogdHJ1ZSwKCQlpY29uT3BlbjogJ2h0dHA6Ly9vcGVuc3RyZWV0YnVncy5zY2hva29rZWtzLm9yZy9jbGllbnQvb3Blbl9idWdfbWFya2VyLnBuZycsCgkJaWNvbkNsb3NlZDonaHR0cDovL29wZW5zdHJlZXRidWdzLnNjaG9rb2tla3Mub3JnL2NsaWVudC9jbG9zZWRfYnVnX21hcmtlci5wbmcnLAoJCWljb25BY3RpdmU6IHVuZGVmaW5lZCwKCQllZGl0QXJlYTogMC4wMSwKCQlwb3B1cE9wdGlvbnM6IHthdXRvUGFuOiBmYWxzZX0sCgkJZGJsQ2xpY2s6IHRydWUKCX0sCgoJaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpCgl7CgkJdmFyIHRtcCA9IEwuVXRpbC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy5wb3B1cE9wdGlvbnMsIChvcHRpb25zIHx8IHt9KS5wb3B1cE9wdGlvbnMpOwoJCUwuVXRpbC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJCXRoaXMub3B0aW9ucy5wb3B1cE9wdGlvbnMgPSB0bXA7CgoJCXB1dEFKQVhNYXJrZXIubGF5ZXJzLnB1c2godGhpcyk7CgoJCXRoaXMuYnVncyA9IHt9OwoJCXRoaXMuX2xheWVycyA9IHt9OwoKCQl2YXIgdXNlcm5hbWUgPSB0aGlzLmdldF9jb29raWUoJ29zYlVzZXJuYW1lJyk7CgkJaWYgKHVzZXJuYW1lKQoJCQl0aGlzLm9wdGlvbnMudXNlcm5hbWUgPSB1c2VybmFtZTsKCgkJTC5PcGVuU3RyZWV0QnVncy5zZXRDU1MoKTsKCX0sCgoJb25BZGQgOiBmdW5jdGlvbihtYXApCgl7CgkJTC5GZWF0dXJlR3JvdXAucHJvdG90eXBlLm9uQWRkLmFwcGx5KHRoaXMsIFttYXBdKTsKCgkJdGhpcy5fbWFwLm9uKCdtb3ZlZW5kJywgdGhpcy5sb2FkQnVncywgdGhpcyk7CgkJdGhpcy5sb2FkQnVncygpOwoJCWlmICghdGhpcy5vcHRpb25zLnJlYWRvbmx5KSB7CgkJICBpZiAodGhpcy5vcHRpb25zLmRibENsaWNrKSB7CgkJCSAgbWFwLmRvdWJsZUNsaWNrWm9vbS5kaXNhYmxlKCk7CgkJCSAgbWFwLm9uKCdkYmxjbGljaycsIHRoaXMuYWRkQnVnLCB0aGlzKTsKCQkgIH0KCQkgIGVsc2UgewoJCQkgIG1hcC5vbignY2xpY2snLCB0aGlzLmFkZEJ1ZywgdGhpcyk7CgkJCX0KCQl9CgkJdGhpcy5maXJlKCdhZGQnKTsKCX0sCgoJb25SZW1vdmUgOiBmdW5jdGlvbihtYXApCgl7CgkJdGhpcy5fbWFwLm9mZignbW92ZWVuZCcsIHRoaXMubG9hZEJ1Z3MsIHRoaXMpOwoJCXRoaXMuX2l0ZXJhdGVMYXllcnMobWFwLnJlbW92ZUxheWVyLCBtYXApOwoJCWRlbGV0ZSB0aGlzLl9tYXA7CgkJaWYgKCF0aGlzLm9wdGlvbnMucmVhZG9ubHkpIHsKCQkgIGlmICh0aGlzLm9wdGlvbnMuZGJsQ2xpY2spIHsKCQkJICBtYXAuZG91YmxlQ2xpY2tab29tLmVuYWJsZSgpOwoJCQkgIG1hcC5vZmYoJ2RibGNsaWNrJywgdGhpcy5hZGRCdWcsIHRoaXMpOwoJCSAgfQoJCSAgZWxzZSB7CgkJICAgIG1hcC5vZmYoJ2NsaWNrJywgdGhpcy5hZGRCdWcsIHRoaXMpOwoJCQl9CgkJfQoJCXRoaXMuZmlyZSgncmVtb3ZlJyk7Cgl9LAoKCXNldF9jb29raWUgOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkKCXsKCQl2YXIgZXhwaXJlcyA9IChuZXcgRGF0ZSgobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgNjA0ODAwMDAwKSkudG9HTVRTdHJpbmcoKTsgLy8gb25lIHdlZWsgZnJvbSBub3cKCQlkb2N1bWVudC5jb29raWUgPSBuYW1lKyc9JytlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKyc7JzsKCX0sCgoJZ2V0X2Nvb2tpZSA6IGZ1bmN0aW9uKG5hbWUpCgl7CgkJdmFyIGNvb2tpZXMgPSAoZG9jdW1lbnQuY29va2llIHx8ICcnKS5zcGxpdCgvO1xzKi8pOwoJCWZvcih2YXIgaT0wOyBpPGNvb2tpZXMubGVuZ3RoOyBpKyspCgkJewoJCQl2YXIgY29va2llID0gY29va2llc1tpXS5zcGxpdCgnPScpOwoJCQlpZihjb29raWVbMF0gPT09IG5hbWUpCgkJCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGNvb2tpZVsxXSk7CgkJfQoJCXJldHVybiBudWxsOwoJfSwKCglsb2FkQnVncyA6IGZ1bmN0aW9uKCkKCXsKCQkvL2lmKCF0aGlzLmdldFZpc2liaWxpdHkoKSkKCQkvLwlyZXR1cm4gdHJ1ZTsKCgkJdmFyIGJvdW5kcyA9IHRoaXMuX21hcC5nZXRCb3VuZHMoKTsKCQlpZighYm91bmRzKSByZXR1cm4gZmFsc2U7CgkJdmFyIHN3ID0gYm91bmRzLmdldFNvdXRoV2VzdCgpLCBuZSA9IGJvdW5kcy5nZXROb3J0aEVhc3QoKTsKCgkJZnVuY3Rpb24gcm91bmQobnVtYmVyLCBkaWdpdHMpIHsKCQkJdmFyIGZhY3RvciA9IE1hdGgucG93KDEwLCBkaWdpdHMpOwoJCQlyZXR1cm4gTWF0aC5yb3VuZChudW1iZXIqZmFjdG9yKS9mYWN0b3I7CgkJfQoKCQl0aGlzLmFwaVJlcXVlc3QoJ2dldEJ1Z3MnCgkJCSsgJz90PScrcm91bmQobmUubGF0LCA1KQoJCQkrICcmcj0nK3JvdW5kKG5lLmxuZywgNSkKCQkJKyAnJmI9Jytyb3VuZChzdy5sYXQsIDUpCgkJCSsgJyZsPScrcm91bmQoc3cubG5nLCA1KSk7Cgl9LAoKCWFwaVJlcXVlc3QgOiBmdW5jdGlvbih1cmwsIHJlbG9hZCkKCXsKCQl2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CgkJc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsKCQlzY3JpcHQuc3JjID0gdGhpcy5vcHRpb25zLnNlcnZlclVSTCArIHVybCArICcmbm9jYWNoZT0nKyhuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7CgkJdmFyIF90aGlzID0gdGhpczsKCQlzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oZSkgewoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMpOwoJCQlpZiAocmVsb2FkKSBfdGhpcy5sb2FkQnVncygpOwoJCX07CgkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOwoJfSwKCgljcmVhdGVNYXJrZXI6IGZ1bmN0aW9uKGlkLCBmb3JjZSkKCXsKCQl2YXIgYnVnID0gcHV0QUpBWE1hcmtlci5idWdzW2lkXTsKCQlpZih0aGlzLmJ1Z3NbaWRdKQoJCXsKCQkJaWYgKGZvcmNlIHx8IHRoaXMuYnVnc1tpZF0ub3NiLmNsb3NlZCAhPT0gYnVnWzJdKQoJCQkJdGhpcy5yZW1vdmVMYXllcih0aGlzLmJ1Z3NbaWRdKTsKCQkJZWxzZQoJCQkJcmV0dXJuOwoJCX0KCgkJdmFyIGNsb3NlZCA9IGJ1Z1syXTsKCgkJaWYgKGNsb3NlZCAmJiAhdGhpcy5vcHRpb25zLnNob3dDbG9zZWQpIHJldHVybjsKCQlpZiAoIWNsb3NlZCAmJiAhdGhpcy5vcHRpb25zLnNob3dPcGVuKSByZXR1cm47CgoJCXZhciBpY29uX3VybCA9IG51bGw7CgkJdmFyIGNsYXNzX3BvcHVwID0gJyBvc2InOwoJCWlmIChidWdbMl0pIHsKCQkJaWNvbl91cmwgPSB0aGlzLm9wdGlvbnMuaWNvbkNsb3NlZDsKCQkJY2xhc3NfcG9wdXAgKz0gJyBvc2JDbG9zZWQnOwoJCX0KCQllbHNlIGlmIChidWdbMV0ubGVuZ3RoID09PSAxKSB7CgkJCWljb25fdXJsID0gdGhpcy5vcHRpb25zLmljb25PcGVuOwoJCQljbGFzc19wb3B1cCArPSAnIG9zYk9wZW4nOwoJCX0KCQllbHNlIHsKCQkgIGlmICh0aGlzLm9wdGlvbnMuaWNvbkFjdGl2ZSkgewoJCSAgICBpY29uX3VybCA9IHRoaXMub3B0aW9ucy5pY29uQWN0aXZlOwoJCSAgICBjbGFzc19wb3B1cCArPSAnIG9zYkFjdGl2ZSc7CgkJICB9CgkJICBlbHNlIHsKCQkgICAgaWNvbl91cmwgPSB0aGlzLm9wdGlvbnMuaWNvbk9wZW47CgkJICAgIGNsYXNzX3BvcHVwICs9ICcgb3NiT3Blbic7CgkJICB9CgkJfQoJCXZhciBmZWF0dXJlID0gbmV3IEwuTWFya2VyKGJ1Z1swXSwge2ljb246bmV3IHRoaXMub3NiSWNvbih7aWNvblVybDogaWNvbl91cmx9KX0pOwoJCWZlYXR1cmUub3NiID0ge2lkOiBpZCwgY2xvc2VkOiBjbG9zZWR9OwoJCXRoaXMuYWRkTGF5ZXIoZmVhdHVyZSk7CgkJdGhpcy5idWdzW2lkXSA9IGZlYXR1cmU7CgkJdGhpcy5zZXRQb3B1cENvbnRlbnQoaWQpOwoJCWZlYXR1cmUuX3BvcHVwLm9wdGlvbnMuY2xhc3NOYW1lICs9IGNsYXNzX3BvcHVwOwoKCQlpZiAodGhpcy5vcHRpb25zLmJ1Z2lkICYmIChwYXJzZUludCh0aGlzLm9wdGlvbnMuYnVnaWQpID09PSBpZCkpCgkJCWZlYXR1cmUub3BlblBvcHVwKCk7CgoJCS8vdGhpcy5ldmVudHMudHJpZ2dlckV2ZW50KCdtYXJrZXJBZGRlZCcpOwoJfSwKCglvc2JJY29uIDogIEwuSWNvbi5leHRlbmQoewoJCW9wdGlvbnM6IHsKCQkJaWNvblVybDogJ2h0dHA6Ly9vcGVuc3RyZWV0YnVncy5zY2hva29rZWtzLm9yZy9jbGllbnQvb3Blbl9idWdfbWFya2VyLnBuZycsCgkJCWljb25TaXplOiBuZXcgTC5Qb2ludCgyMiwgMjIpLAoJCQlzaGFkb3dTaXplOiBuZXcgTC5Qb2ludCgwLCAwKSwKCQkJaWNvbkFuY2hvcjogbmV3IEwuUG9pbnQoMTEsIDExKSwKCQkJcG9wdXBBbmNob3I6IG5ldyBMLlBvaW50KDAsIC0xMSkKCQl9Cgl9KSwKCglzZXRQb3B1cENvbnRlbnQ6IGZ1bmN0aW9uKGlkKSB7CgkJaWYodGhpcy5idWdzW2lkXS5fcG9wdXBfY29udGVudCkKCQkJcmV0dXJuOwoKCQl2YXIgZWwxLGVsMixlbDM7CgkJdmFyIGxheWVyID0gdGhpczsKCgkJdmFyIHJhd2J1ZyA9IHB1dEFKQVhNYXJrZXIuYnVnc1tpZF07CgkJdmFyIGlzY2xvc2VkID0gcmF3YnVnWzJdOwoKCQl2YXIgbmV3Q29udGVudCA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdvc2ItcG9wdXAnKTsKCQl2YXIgaDEgPSBMLkRvbVV0aWwuY3JlYXRlKCdoMScsIG51bGwsIG5ld0NvbnRlbnQpOwoJCWlmIChyYXdidWdbMl0pIAoJCQloMS50ZXh0Q29udGVudCA9IEwuaTE4bignRml4ZWQgRXJyb3InKTsKCQllbHNlIGlmIChyYXdidWdbMV0ubGVuZ3RoID09PSAxKQoJCQloMS50ZXh0Q29udGVudCA9IEwuaTE4bignVW5yZXNvbHZlZCBFcnJvcicpOwoJCWVsc2UKCQkJaDEudGV4dENvbnRlbnQgPSBMLmkxOG4oJ0FjdGl2ZSBFcnJvcicpOwoKCQl2YXIgZGl2aW5mbyA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdvc2ItaW5mbycsIG5ld0NvbnRlbnQpOwoJCXZhciB0YWJsZSA9IEwuRG9tVXRpbC5jcmVhdGUoJ3RhYmxlJywgJ29zYi10YWJsZScsIGRpdmluZm8pOwoJCWZvcih2YXIgaT0wOyBpPHJhd2J1Z1sxXS5sZW5ndGg7IGkrKykKCQl7CgkJCXZhciB0ciA9IEwuRG9tVXRpbC5jcmVhdGUoJ3RyJywgJ29zYi10ci1pbmZvJywgdGFibGUpOwoJCQl0ci5zZXRBdHRyaWJ1dGUoJ3ZhbGlnbicsJ3RvcCcpOwoJCQl2YXIgdGRfbmlja25hbWUgPSBMLkRvbVV0aWwuY3JlYXRlKCd0ZCcsICdvc2ItdGQtbmlja25hbWUnLCB0cik7CgkJCXRkX25pY2tuYW1lLnRleHRDb250ZW50ID0gcmF3YnVnWzVdW2ldICsgJzonOwoJCQl2YXIgdGRfZGF0ZXRpbWUgPSBMLkRvbVV0aWwuY3JlYXRlKCd0ZCcsICdvc2ItdGQtZGF0ZXRpbWUnLCB0cik7CgkJCXRkX2RhdGV0aW1lLnRleHRDb250ZW50ID0gcmF3YnVnWzZdW2ldOwoJCQl2YXIgdGRfY29tbWVudCA9IEwuRG9tVXRpbC5jcmVhdGUoJ3RkJywgJ29zYi10ZC1jb21tZW50JywgTC5Eb21VdGlsLmNyZWF0ZSgndHInLCAnb3NiLXRyLWNvbW1lbnQnLCB0YWJsZSkpOwoJCQl0ZF9jb21tZW50LnNldEF0dHJpYnV0ZSgnY29sc3BhbicsJzInKTsKCQkJdGRfY29tbWVudC5zZXRBdHRyaWJ1dGUoJ2NoYXJvZmYnLCcyJyk7CgkJCXRkX2NvbW1lbnQudGV4dENvbnRlbnQgPSByYXdidWdbNF1baV07CgkJfQoKCQlmdW5jdGlvbiBjcmVhdGVfbGluayh1bCwgdGV4dCkgewoJCQl2YXIgYSA9IEwuRG9tVXRpbC5jcmVhdGUoJ2EnLCBudWxsLAoJCQkJCUwuRG9tVXRpbC5jcmVhdGUoJ2xpJywgbnVsbCwgdWwpKTsKCQkJYS5ocmVmID0gJyMnOwoJCQlhLnRleHRDb250ZW50ID0gTC5pMThuKHRleHQpOwoJCQlyZXR1cm4gYTsKCQl9CgoJCXZhciB1bCA9IEwuRG9tVXRpbC5jcmVhdGUoJ3VsJywgbnVsbCwgbmV3Q29udGVudCk7CgkJdmFyIF90aGlzID0gdGhpczsKCQl2YXIgYnVnID0gdGhpcy5idWdzW2lkXTsKCgkJZnVuY3Rpb24gc2hvd0NvbW1lbnQodGl0bGUsIGFkZF9jb21tZW50KSB7CgkJCWgxLnRleHRDb250ZW50X29sZCA9IGgxLnRleHRDb250ZW50OwoJCQloMS50ZXh0Q29udGVudCA9IEwuaTE4bih0aXRsZSk7CgkJCXZhciBmb3JtID0gX3RoaXMuY3JlYXRlQ29tbWVudEZvcm0oKTsKCQkJZm9ybS5vc2JpZC52YWx1ZSA9IGlkOwoJCQlmb3JtLmNhbmNlbC5vbmNsaWNrID0gZnVuY3Rpb24gKGUpIHsKCQkJCWgxLnRleHRDb250ZW50ID0gaDEudGV4dENvbnRlbnRfb2xkOwoJCQkJbmV3Q29udGVudC5yZW1vdmVDaGlsZChmb3JtKTsKCQkJCW5ld0NvbnRlbnQuYXBwZW5kQ2hpbGQodWwpOwoJCQl9OwoJCQlmb3JtLm9rLm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7CgkJCQlidWcuY2xvc2VQb3B1cCgpOwoJCQkJaWYgKCFhZGRfY29tbWVudCkKCQkJCQlfdGhpcy5jbG9zZUJ1Zyhmb3JtKTsKCQkJCWVsc2UKCQkJCQlfdGhpcy5zdWJtaXRDb21tZW50KGZvcm0pOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9OwoJCQluZXdDb250ZW50LmFwcGVuZENoaWxkKGZvcm0pOwoJCQluZXdDb250ZW50LnJlbW92ZUNoaWxkKHVsKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYgKCFpc2Nsb3NlZCAmJiAhdGhpcy5vcHRpb25zLnJlYWRvbmx5KSB7CgkJCXZhciBhOwoJCQlhID0gY3JlYXRlX2xpbmsodWwsICdBZGQgY29tbWVudCcpOwoJCQlhLm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7IHJldHVybiBzaG93Q29tbWVudCgnQWRkIGNvbW1lbnQnLCB0cnVlKTsgfTsKCgkJCWEgPSBjcmVhdGVfbGluayh1bCwgJ01hcmsgYXMgRml4ZWQnKTsKCQkJYS5vbmNsaWNrID0gZnVuY3Rpb24oZSkgeyByZXR1cm4gc2hvd0NvbW1lbnQoJ0Nsb3NlIGJ1ZycsIGZhbHNlKTsgfTsKCQl9CgkJdmFyIGFfam9zbSA9IGNyZWF0ZV9saW5rKHVsLCAnSk9TTScpOwoJCWFfam9zbS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7IF90aGlzLnJlbW90ZUVkaXQocmF3YnVnWzBdKTsgfTsKCgkJdmFyIGFfbGluayA9IGNyZWF0ZV9saW5rKHVsLCAnTGluaycpOwoJCXZhciB2YXJzID0ge2xhdDpyYXdidWdbMF0ubGF0LCBsb246cmF3YnVnWzBdLmxuZywgem9vbTp0aGlzLm9wdGlvbnMucGVybWFsaW5rWm9vbSwgYnVnaWQ6aWR9OwoJCWlmICh0aGlzLm9wdGlvbnMucGVybWFsaW5rVXJsKQoJCQlhX2xpbmsuaHJlZiA9IEwuVXRpbC50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMucGVybWFsaW5rVXJsLCB2YXJzKTsKCQllbHNlCgkJCWFfbGluay5ocmVmID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnBhdGhuYW1lICsKCQkJCUwuVXRpbC5nZXRQYXJhbVN0cmluZyh2YXJzKTsKCgoJCWJ1Zy5fcG9wdXBfY29udGVudCA9IG5ld0NvbnRlbnQ7CgkJYnVnLmJpbmRQb3B1cChuZXdDb250ZW50LCB0aGlzLm9wdGlvbnMucG9wdXBPcHRpb25zKTsKCQlidWcuX3BvcHVwLm9wdGlvbnMubWF4V2lkdGg9NDEwOwoJCWJ1Zy5fcG9wdXAub3B0aW9ucy5taW5XaWR0aD00MTA7CgkJYnVnLm9uKCdtb3VzZW92ZXInLCBidWcub3BlblRlbXBQb3B1cCwgYnVnKTsKCX0sCgoJc3VibWl0Q29tbWVudDogZnVuY3Rpb24oZm9ybSkgewoJCWlmICghZm9ybS5vc2Jjb21tZW50LnZhbHVlKSByZXR1cm47CgkJdmFyIG5pY2tuYW1lID0gZm9ybS5vc2JuaWNrbmFtZS52YWx1ZSB8fCB0aGlzLm9wdGlvbnMudXNlcm5hbWU7CgkJdGhpcy5hcGlSZXF1ZXN0KCdlZGl0UE9JZXhlYycKCQkJKyAnP2lkPScrZW5jb2RlVVJJQ29tcG9uZW50KGZvcm0ub3NiaWQudmFsdWUpCgkJCSsgJyZ0ZXh0PScrZW5jb2RlVVJJQ29tcG9uZW50KGZvcm0ub3NiY29tbWVudC52YWx1ZSArICcgWycgKyBuaWNrbmFtZSArICddJykKCQkJKyAnJmZvcm1hdD1qcycsIHRydWUKCQkpOwoJCXRoaXMuc2V0X2Nvb2tpZSgnb3NiVXNlcm5hbWUnLG5pY2tuYW1lKTsKCQl0aGlzLm9wdGlvbnMudXNlcm5hbWU9bmlja25hbWU7Cgl9LAoKCWNsb3NlQnVnOiBmdW5jdGlvbihmb3JtKSB7CgkJdmFyIGlkID0gZm9ybS5vc2JpZC52YWx1ZTsKCQl0aGlzLnN1Ym1pdENvbW1lbnQoZm9ybSk7CgkJdGhpcy5hcGlSZXF1ZXN0KCdjbG9zZVBPSWV4ZWMnCgkJCSsgJz9pZD0nK2VuY29kZVVSSUNvbXBvbmVudChpZCkKCQkJKyAnJmZvcm1hdD1qcycsIHRydWUKCQkpOwoJfSwKCgljcmVhdGVDb21tZW50Rm9ybTogZnVuY3Rpb24oZWx0KSB7CgkJdmFyIGZvcm0gPSBMLkRvbVV0aWwuY3JlYXRlKCdmb3JtJywgJ29zYi1hZGQtY29tbWVudCcsIGVsdCk7CgkJdmFyIGNvbnRlbnQgPSAnJzsKCQljb250ZW50ICs9ICc8aW5wdXQgbmFtZT0ib3NiaWQiIHR5cGU9ImhpZGRlbiIvPic7CgkJY29udGVudCArPSAnPGlucHV0IG5hbWU9Im9zYmxhdCIgdHlwZT0iaGlkZGVuIi8+JzsKCQljb250ZW50ICs9ICc8aW5wdXQgbmFtZT0ib3NibG9uIiB0eXBlPSJoaWRkZW4iLz4nOwoJCWNvbnRlbnQgKz0gJzxkaXY+PHNwYW4gY2xhc3M9Im9zYi1pbnB1dGxhYmVsIj4nK0wuaTE4bignTmlja25hbWUnKSsnOjwvc3Bhbj48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0ib3Nibmlja25hbWUiPjwvZGl2Pic7CgkJY29udGVudCArPSAnPGRpdj48c3BhbiBjbGFzcz0ib3NiLWlucHV0bGFiZWwiPicrTC5pMThuKCdDb21tZW50JykrJzo8L3NwYW4+PGlucHV0IHR5cGU9InRleHQiIG5hbWU9Im9zYmNvbW1lbnQiPjwvZGl2Pic7CgkJY29udGVudCArPSAnPGRpdiBjbGFzcz0ib3NiLWZvcm1mb290ZXIiPjxpbnB1dCB0eXBlPSJzdWJtaXQiIG5hbWU9Im9rIi8+PGlucHV0IHR5cGU9ImJ1dHRvbiIgbmFtZT0iY2FuY2VsIi8+PC9kaXY+JzsKCQlmb3JtLmlubmVySFRNTCA9IGNvbnRlbnQ7CgkJZm9ybS5vay52YWx1ZSA9IEwuaTE4bignT0snKTsKCQlmb3JtLmNhbmNlbC52YWx1ZSA9IEwuaTE4bignQ2FuY2VsJyk7CgkJZm9ybS5vc2JuaWNrbmFtZS52YWx1ZSA9IHRoaXMub3B0aW9ucy51c2VybmFtZTsKCQlyZXR1cm4gZm9ybTsKCX0sCgoJYWRkQnVnOiBmdW5jdGlvbihlKSB7CgkJdmFyIG5ld0NvbnRlbnQgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnb3NiLXBvcHVwJyk7CgoJCW5ld0NvbnRlbnQuaW5uZXJIVE1MICs9ICc8aDE+JytMLmkxOG4oJ05ldyBidWcnKSsnPC9oMT4nOwoJCW5ld0NvbnRlbnQuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPSJvc2JDcmVhdGVJbmZvIj4nK0wuaTE4bignRmluZCB5b3VyIGJ1Zz8nKSsnPGJyIC8+JytMLmkxOG4oJ0NvbnRhY3QgZGV0YWlscyBhbmQgc29tZW9uZSB3aWxsIGZpeCBpdC4nKSsnPC9kaXY+JzsKCgkJdmFyIHBvcHVwID0gbmV3IEwuUG9wdXAoKTsKCQl2YXIgX3RoaXMgPSB0aGlzOwoJCXZhciBmb3JtID0gdGhpcy5jcmVhdGVDb21tZW50Rm9ybShuZXdDb250ZW50KTsKCQlmb3JtLm9zYmxhdC52YWx1ZSA9IGUubGF0bG5nLmxhdDsKCQlmb3JtLm9zYmxvbi52YWx1ZSA9IGUubGF0bG5nLmxuZzsKCQlmb3JtLm9rLnZhbHVlID0gTC5pMThuKCdBZGQgY29tbWVudCcpOwoJCWZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbihlKSB7CgkJCV90aGlzLl9tYXAuY2xvc2VQb3B1cChwb3B1cCk7CgkJCV90aGlzLmNyZWF0ZUJ1Zyhmb3JtKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX07CgkJZm9ybS5jYW5jZWwub25jbGljayA9IGZ1bmN0aW9uKGUpIHsgX3RoaXMuX21hcC5jbG9zZVBvcHVwKHBvcHVwKTsgfTsKCgkJcG9wdXAuc2V0TGF0TG5nKGUubGF0bG5nKTsKCQlwb3B1cC5zZXRDb250ZW50KG5ld0NvbnRlbnQpOwoJCXBvcHVwLm9wdGlvbnMubWF4V2lkdGg9NDEwOwoJCXBvcHVwLm9wdGlvbnMubWluV2lkdGg9NDEwOwoJCXBvcHVwLm9wdGlvbnMuY2xhc3NOYW1lICs9ICcgb3NiIG9zYkNyZWF0ZSc7CgoJCXRoaXMuX21hcC5vcGVuUG9wdXAocG9wdXApOwoJfSwKCgljcmVhdGVCdWc6IGZ1bmN0aW9uKGZvcm0pIHsKCQlpZiAoIWZvcm0ub3NiY29tbWVudC52YWx1ZSkgcmV0dXJuOwoJCXZhciBuaWNrbmFtZSA9IGZvcm0ub3Nibmlja25hbWUudmFsdWUgfHwgdGhpcy5vcHRpb25zLnVzZXJuYW1lOwoJCXRoaXMuYXBpUmVxdWVzdCgnYWRkUE9JZXhlYycKCQkJKyAnP2xhdD0nK2VuY29kZVVSSUNvbXBvbmVudChmb3JtLm9zYmxhdC52YWx1ZSkKCQkJKyAnJmxvbj0nK2VuY29kZVVSSUNvbXBvbmVudChmb3JtLm9zYmxvbi52YWx1ZSkKCQkJKyAnJnRleHQ9JytlbmNvZGVVUklDb21wb25lbnQoZm9ybS5vc2Jjb21tZW50LnZhbHVlICsgJyBbJyArIG5pY2tuYW1lICsgJ10nKQoJCQkrICcmZm9ybWF0PWpzJywgdHJ1ZQoJCSk7CgkJdGhpcy5zZXRfY29va2llKCdvc2JVc2VybmFtZScsbmlja25hbWUpOwoJCXRoaXMub3B0aW9ucy51c2VybmFtZT1uaWNrbmFtZTsKCX0sCgoJcmVtb3RlRWRpdDogZnVuY3Rpb24oeCkgewoJCXZhciB5ZGVsdGEgPSB0aGlzLm9wdGlvbnMuZWRpdEFyZWEgfHwgMC4wMTsKCQl2YXIgeGRlbHRhID0geWRlbHRhICogMjsKCQl2YXIgcCA9IFsgJ2xlZnQ9JyAgKyAoeC5sbmcgLSB4ZGVsdGEpLCAnYm90dG9tPScgKyAoeC5sYXQgLSB5ZGVsdGEpLCAncmlnaHQ9JyArICh4LmxuZyArIHhkZWx0YSksICd0b3A9JyAgICArICh4LmxhdCArIHlkZWx0YSldOwoJCXZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDo4MTExL2xvYWRfYW5kX3pvb20/JyArIHAuam9pbignJicpOwoJCXZhciBmcmFtZSA9IEwuRG9tVXRpbC5jcmVhdGUoJ2lmcmFtZScsIG51bGwpOwoJCWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJZnJhbWUuc3JjID0gdXJsOwoJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZnJhbWUpOwoJCWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmcmFtZSk7IH07CgkJcmV0dXJuIGZhbHNlOwoJfQp9KTsKCkwuT3BlblN0cmVldEJ1Z3Muc2V0Q1NTID0gZnVuY3Rpb24oKSB7CglpZihMLk9wZW5TdHJlZXRCdWdzLnNldENTUy5kb25lKQoJCXJldHVybjsKCWVsc2UKCQlMLk9wZW5TdHJlZXRCdWdzLnNldENTUy5kb25lID0gdHJ1ZTsKCgkvLyBTZWUgaHR0cDovL3d3dy5odW5sb2NrLmNvbS9ibG9ncy9Ub3RhbGx5X1B3bl9DU1Nfd2l0aF9KYXZhc2NyaXB0Cgl2YXIgaWR4ID0gMDsKCXZhciBhZGRSdWxlID0gZnVuY3Rpb24oc2VsZWN0b3IsIHJ1bGVzKSB7CgkJdmFyIHMgPSBkb2N1bWVudC5zdHlsZVNoZWV0c1swXTsKCQl2YXIgcnVsZTsKCQlpZihzLmFkZFJ1bGUpIC8vIE0kSUUKCQkJcnVsZSA9IHMuYWRkUnVsZShzZWxlY3RvciwgcnVsZXMsIGlkeCk7CgkJZWxzZQoJCQlydWxlID0gcy5pbnNlcnRSdWxlKHNlbGVjdG9yICsgJyB7ICcgKyBydWxlcyArICcgfScsIGlkeCk7CgkJcy5zdHlsZSA9IEwuVXRpbC5leHRlbmQocy5zdHlsZSB8fCB7fSwgcnVsZXMpOwoJCWlkeCsrOwoJfTsKCglhZGRSdWxlKCcub3NiLXBvcHVwIGRsJywgJ21hcmdpbjowOyBwYWRkaW5nOjA7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIGR0JywgJ21hcmdpbjowOyBwYWRkaW5nOjA7IGZvbnQtd2VpZ2h0OmJvbGQ7IGZsb2F0OmxlZnQ7IGNsZWFyOmxlZnQ7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIGR0OmFmdGVyJywgJ2NvbnRlbnQ6ICI6wqAiOycpOwoJYWRkUnVsZSgnKiBodG1sIC5vc2ItcG9wdXAgZHQnLCAnbWFyZ2luLXJpZ2h0OjFleDsnKTsKCWFkZFJ1bGUoJy5vc2ItcG9wdXAgZGQnLCAnbWFyZ2luOjA7IHBhZGRpbmc6MDsnKTsKCWFkZFJ1bGUoJy5vc2ItcG9wdXAgdWwuYnV0dG9ucycsICdsaXN0LXN0eWxlLXR5cGU6bm9uZTsgcGFkZGluZzowOyBtYXJnaW46MDsnKTsKCWFkZFJ1bGUoJy5vc2ItcG9wdXAgdWwuYnV0dG9ucyBsaScsICdkaXNwbGF5OmlubGluZTsgbWFyZ2luOjA7IHBhZGRpbmc6MDsnKTsKCWFkZFJ1bGUoJy5vc2ItcG9wdXAgaDMnLCAnZm9udC1zaXplOjEuMmVtOyBtYXJnaW46LjJlbSAwIC43ZW0gMDsnKTsKfTsKCmZ1bmN0aW9uIHB1dEFKQVhNYXJrZXIoaWQsIGxvbiwgbGF0LCB0ZXh0LCBjbG9zZWQpCnsKCXZhciBjb21tZW50cyA9IHRleHQuc3BsaXQoLzxociBcLz4vKTsKCXZhciBjb21tZW50c19vbmx5ID0gW107Cgl2YXIgbmlja25hbWUgPSBbXTsKCXZhciBkYXRldGltZSA9IFtdOwoJdmFyIGluZm8gPSBudWxsOwoJdmFyIGlzcGxpdCA9IDA7Cgl2YXIgaTsKCWZvcihpPTA7IGk8Y29tbWVudHMubGVuZ3RoOyBpKyspIHsKCQlpbmZvID0gbnVsbDsKCQlpc3BsaXQgPSAwOwoJCWNvbW1lbnRzW2ldID0gY29tbWVudHNbaV0ucmVwbGFjZSgvJnF1b3Q7L2csICciJykucmVwbGFjZSgvJmx0Oy9nLCAnPCcpLnJlcGxhY2UoLyZndDsvZywgJz4nKS5yZXBsYWNlKC8mYW1wOy9nLCAnJicpOwoJCWlzcGxpdCA9IGNvbW1lbnRzW2ldLmxhc3RJbmRleE9mKCdbJyk7CgkJaWYgKGlzcGxpdCA+IDApIHsKCQkgIGNvbW1lbnRzX29ubHlbaV0gPSBjb21tZW50c1tpXS5zdWJzdHIoMCxpc3BsaXQtMSk7CgkJICBpbmZvID0gY29tbWVudHNbaV0uc3Vic3RyKGlzcGxpdCsxKTsKCQkgIG5pY2tuYW1lW2ldID0gaW5mby5zdWJzdHIoMCxpbmZvLmxhc3RJbmRleE9mKCcsJykpOwoJCSAgZGF0ZXRpbWVbaV0gPSBpbmZvLnN1YnN0cihpbmZvLmxhc3RJbmRleE9mKCcsJykrMik7CgkJICBkYXRldGltZVtpXSA9IGRhdGV0aW1lW2ldLnN1YnN0cigwLGRhdGV0aW1lW2ldLmxhc3RJbmRleE9mKCddJykpOwoJCX0KCQllbHNlIHsKCQkgIGNvbW1lbnRzX29ubHlbaV0gPSBjb21tZW50c1tpXTsKCQl9Cgl9Cgl2YXIgb2xkID0gcHV0QUpBWE1hcmtlci5idWdzW2lkXTsKCXB1dEFKQVhNYXJrZXIuYnVnc1tpZF0gPSBbCgkJbmV3IEwuTGF0TG5nKGxhdCwgbG9uKSwKCQljb21tZW50cywKCQljbG9zZWQsCgkJdGV4dCwKCQljb21tZW50c19vbmx5LAoJCW5pY2tuYW1lLAoJCWRhdGV0aW1lCgldOwoJdmFyIGZvcmNlID0gKG9sZCAmJiBvbGRbM10pICE9PSB0ZXh0OwoJZm9yKGk9MDsgaTxwdXRBSkFYTWFya2VyLmxheWVycy5sZW5ndGg7IGkrKykKCQlwdXRBSkFYTWFya2VyLmxheWVyc1tpXS5jcmVhdGVNYXJrZXIoaWQsIGZvcmNlKTsKfQoKZnVuY3Rpb24gb3NiUmVzcG9uc2UoZXJyb3IpCnsKCWlmKGVycm9yKQoJCWFsZXJ0KCdFcnJvcjogJytlcnJvcik7CgoJcmV0dXJuOwp9CgpwdXRBSkFYTWFya2VyLmxheWVycyA9IFsgXTsKcHV0QUpBWE1hcmtlci5idWdzID0geyB9OwoKTC5NYXJrZXIuaW5jbHVkZSh7CglvcGVuVGVtcFBvcHVwOiBmdW5jdGlvbigpIHsKCQl0aGlzLm9wZW5Qb3B1cCgpOwoJCXRoaXMub2ZmKCdjbGljaycsIHRoaXMub3BlblBvcHVwLCB0aGlzKTsKCgkJZnVuY3Rpb24gb25jbGljaygpIHsKCQkJdGhpcy5vZmYoJ21vdXNlb3V0Jywgb25vdXQsIHRoaXMpOwoJCQl0aGlzLm9mZignY2xpY2snLCBvbmNsaWNrLCB0aGlzKTsKCQkJdGhpcy5vbignY2xpY2snLCB0aGlzLm9wZW5Qb3B1cCwgdGhpcyk7CgkJfQoKCQlmdW5jdGlvbiBvbm91dCgpIHsKCQkJb25jbGljay5jYWxsKHRoaXMpOwoJCQl0aGlzLmNsb3NlUG9wdXAoKTsKCQl9CgkJdGhpcy5vbignbW91c2VvdXQnLCBvbm91dCwgdGhpcyk7CgkJdGhpcy5vbignY2xpY2snLCBvbmNsaWNrLCB0aGlzKTsKCX0KfSk7CgpMLmkxOG4gPSBmdW5jdGlvbihzKSB7IHJldHVybiAoTC5pMThuLmxhbmdbTC5pMThuLmN1cnJlbnRdIHx8IHt9KVtzXSB8fCBzOyB9OwpMLmkxOG4uY3VycmVudCA9ICdydSc7CkwuaTE4bi5sYW5nID0ge307CkwuaTE4bi5leHRlbmQgPSBmdW5jdGlvbihsYW5nLCBhcmdzKSB7CglMLmkxOG4ubGFuZ1tsYW5nXSA9IEwuVXRpbC5leHRlbmQoTC5pMThuLmxhbmdbbGFuZ10gfHwge30sIGFyZ3MpOwp9OwoKTC5pMThuLmV4dGVuZCgncnUnLCB7CgknRml4ZWQgRXJyb3InOifQntGI0LjQsdC60LAg0LjRgdC/0YDQsNCy0LvQtdC90LAnLAoJJ1VucmVzb2x2ZWQgRXJyb3InOifQndC10LjRgdC/0YDQsNCy0LvQtdC90L3QsNGPINC+0YjQuNCx0LrQsCcsCgknQWN0aXZlIEVycm9yJzon0J7RiNC40LHQutCwINGD0YLQvtGH0L3Rj9C10YLRgdGPJywKCSdEZXNjcmlwdGlvbic6J9Ce0L/QuNGB0LDQvdC40LUnLAoJJ0NvbW1lbnQnOifQntC/0LjRgdCw0L3QuNC1JywKCSdBZGQgY29tbWVudCc6J9CU0L7Qv9C+0LvQvdC40YLRjCcsCgknTWFyayBhcyBGaXhlZCc6J9CY0YHQv9GA0LDQstC70LXQvdC+JywKCSdMaW5rJzon0KHRgdGL0LvQutCwJywKCSdDYW5jZWwnOifQntGC0LzQtdC90LAnLAoJJ05ldyBidWcnOifQryDQvdCw0YjQtdC7INC+0YjQuNCx0LrRgycsCgknRmluZCB5b3VyIGJ1Zz8nOifQndCw0YjQu9C4INC+0YjQuNCx0LrRgz8nLAoJJ0NvbnRhY3QgZGV0YWlscyBhbmQgc29tZW9uZSB3aWxsIGZpeCBpdC4nOifQndCw0L/QuNGI0LjRgtC1INC/0L7QtNGA0L7QsdC90LXQtSDQuCDQutGC0L4t0L3QuNCx0YPQtNGMINC10ZEg0LjRgdC/0YDQsNCy0LjRgi4nCn0pOwo=",
                "body": "LyogZ2xvYmFsIGFsZXJ0OiB0cnVlICovCkwuT3BlblN0cmVldEJ1Z3MgPSBMLkZlYXR1cmVHcm91cC5leHRlbmQoewoJb3B0aW9ucyA6IHsKCQlzZXJ2ZXJVUkwgOiAnaHR0cDovL29wZW5zdHJlZXRidWdzLnNjaG9rb2tla3Mub3JnL2FwaS8wLjEvJywKCQlyZWFkb25seSA6IGZhbHNlLAoJCXNldENvb2tpZSA6IHRydWUsCgkJdXNlcm5hbWUgOiAnTm9OYW1lJywKCQljb29raWVMaWZldGltZSA6IDEwMDAsCgkJY29va2llUGF0aCA6IG51bGwsCgkJcGVybWFsaW5rWm9vbSA6IDE0LAoJCXBlcm1hbGlua1VybDogbnVsbCwKCQlvcGFjaXR5IDogMC43LAoJCXNob3dPcGVuOiB0cnVlLAoJCXNob3dDbG9zZWQ6IHRydWUsCgkJaWNvbk9wZW46ICdodHRwOi8vb3BlbnN0cmVldGJ1Z3Muc2Nob2tva2Vrcy5vcmcvY2xpZW50L29wZW5fYnVnX21hcmtlci5wbmcnLAoJCWljb25DbG9zZWQ6J2h0dHA6Ly9vcGVuc3RyZWV0YnVncy5zY2hva29rZWtzLm9yZy9jbGllbnQvY2xvc2VkX2J1Z19tYXJrZXIucG5nJywKCQlpY29uQWN0aXZlOiB1bmRlZmluZWQsCgkJZWRpdEFyZWE6IDAuMDEsCgkJcG9wdXBPcHRpb25zOiB7YXV0b1BhbjogZmFsc2V9LAoJCWRibENsaWNrOiB0cnVlCgl9LAoKCWluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKQoJewoJCXZhciB0bXAgPSBMLlV0aWwuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMucG9wdXBPcHRpb25zLCAob3B0aW9ucyB8fCB7fSkucG9wdXBPcHRpb25zKTsKCQlMLlV0aWwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCQl0aGlzLm9wdGlvbnMucG9wdXBPcHRpb25zID0gdG1wOwoKCQlwdXRBSkFYTWFya2VyLmxheWVycy5wdXNoKHRoaXMpOwoKCQl0aGlzLmJ1Z3MgPSB7fTsKCQl0aGlzLl9sYXllcnMgPSB7fTsKCgkJdmFyIHVzZXJuYW1lID0gdGhpcy5nZXRfY29va2llKCdvc2JVc2VybmFtZScpOwoJCWlmICh1c2VybmFtZSkKCQkJdGhpcy5vcHRpb25zLnVzZXJuYW1lID0gdXNlcm5hbWU7CgoJCUwuT3BlblN0cmVldEJ1Z3Muc2V0Q1NTKCk7Cgl9LAoKCW9uQWRkIDogZnVuY3Rpb24obWFwKQoJewoJCUwuRmVhdHVyZUdyb3VwLnByb3RvdHlwZS5vbkFkZC5hcHBseSh0aGlzLCBbbWFwXSk7CgoJCXRoaXMuX21hcC5vbignbW92ZWVuZCcsIHRoaXMubG9hZEJ1Z3MsIHRoaXMpOwoJCXRoaXMubG9hZEJ1Z3MoKTsKCQlpZiAoIXRoaXMub3B0aW9ucy5yZWFkb25seSkgewoJCSAgaWYgKHRoaXMub3B0aW9ucy5kYmxDbGljaykgewoJCQkgIG1hcC5kb3VibGVDbGlja1pvb20uZGlzYWJsZSgpOwoJCQkgIG1hcC5vbignZGJsY2xpY2snLCB0aGlzLmFkZEJ1ZywgdGhpcyk7CgkJICB9CgkJICBlbHNlIHsKCQkJICBtYXAub24oJ2NsaWNrJywgdGhpcy5hZGRCdWcsIHRoaXMpOwoJCQl9CgkJfQoJCXRoaXMuZmlyZSgnYWRkJyk7Cgl9LAoKCW9uUmVtb3ZlIDogZnVuY3Rpb24obWFwKQoJewoJCXRoaXMuX21hcC5vZmYoJ21vdmVlbmQnLCB0aGlzLmxvYWRCdWdzLCB0aGlzKTsKCQl0aGlzLl9pdGVyYXRlTGF5ZXJzKG1hcC5yZW1vdmVMYXllciwgbWFwKTsKCQlkZWxldGUgdGhpcy5fbWFwOwoJCWlmICghdGhpcy5vcHRpb25zLnJlYWRvbmx5KSB7CgkJICBpZiAodGhpcy5vcHRpb25zLmRibENsaWNrKSB7CgkJCSAgbWFwLmRvdWJsZUNsaWNrWm9vbS5lbmFibGUoKTsKCQkJICBtYXAub2ZmKCdkYmxjbGljaycsIHRoaXMuYWRkQnVnLCB0aGlzKTsKCQkgIH0KCQkgIGVsc2UgewoJCSAgICBtYXAub2ZmKCdjbGljaycsIHRoaXMuYWRkQnVnLCB0aGlzKTsKCQkJfQoJCX0KCQl0aGlzLmZpcmUoJ3JlbW92ZScpOwoJfSwKCglzZXRfY29va2llIDogZnVuY3Rpb24obmFtZSwgdmFsdWUpCgl7CgkJdmFyIGV4cGlyZXMgPSAobmV3IERhdGUoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIDYwNDgwMDAwMCkpLnRvR01UU3RyaW5nKCk7IC8vIG9uZSB3ZWVrIGZyb20gbm93CgkJZG9jdW1lbnQuY29va2llID0gbmFtZSsnPScrZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSsnOyc7Cgl9LAoKCWdldF9jb29raWUgOiBmdW5jdGlvbihuYW1lKQoJewoJCXZhciBjb29raWVzID0gKGRvY3VtZW50LmNvb2tpZSB8fCAnJykuc3BsaXQoLztccyovKTsKCQlmb3IodmFyIGk9MDsgaTxjb29raWVzLmxlbmd0aDsgaSsrKQoJCXsKCQkJdmFyIGNvb2tpZSA9IGNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJaWYoY29va2llWzBdID09PSBuYW1lKQoJCQkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChjb29raWVbMV0pOwoJCX0KCQlyZXR1cm4gbnVsbDsKCX0sCgoJbG9hZEJ1Z3MgOiBmdW5jdGlvbigpCgl7CgkJLy9pZighdGhpcy5nZXRWaXNpYmlsaXR5KCkpCgkJLy8JcmV0dXJuIHRydWU7CgoJCXZhciBib3VuZHMgPSB0aGlzLl9tYXAuZ2V0Qm91bmRzKCk7CgkJaWYoIWJvdW5kcykgcmV0dXJuIGZhbHNlOwoJCXZhciBzdyA9IGJvdW5kcy5nZXRTb3V0aFdlc3QoKSwgbmUgPSBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7CgoJCWZ1bmN0aW9uIHJvdW5kKG51bWJlciwgZGlnaXRzKSB7CgkJCXZhciBmYWN0b3IgPSBNYXRoLnBvdygxMCwgZGlnaXRzKTsKCQkJcmV0dXJuIE1hdGgucm91bmQobnVtYmVyKmZhY3RvcikvZmFjdG9yOwoJCX0KCgkJdGhpcy5hcGlSZXF1ZXN0KCdnZXRCdWdzJwoJCQkrICc/dD0nK3JvdW5kKG5lLmxhdCwgNSkKCQkJKyAnJnI9Jytyb3VuZChuZS5sbmcsIDUpCgkJCSsgJyZiPScrcm91bmQoc3cubGF0LCA1KQoJCQkrICcmbD0nK3JvdW5kKHN3LmxuZywgNSkpOwoJfSwKCglhcGlSZXF1ZXN0IDogZnVuY3Rpb24odXJsLCByZWxvYWQpCgl7CgkJdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwoJCXNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7CgkJc2NyaXB0LnNyYyA9IHRoaXMub3B0aW9ucy5zZXJ2ZXJVUkwgKyB1cmwgKyAnJm5vY2FjaGU9JysobmV3IERhdGUoKSkuZ2V0VGltZSgpOwoJCXZhciBfdGhpcyA9IHRoaXM7CgkJc2NyaXB0Lm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsKCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzKTsKCQkJaWYgKHJlbG9hZCkgX3RoaXMubG9hZEJ1Z3MoKTsKCQl9OwoJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCX0sCgoJY3JlYXRlTWFya2VyOiBmdW5jdGlvbihpZCwgZm9yY2UpCgl7CgkJdmFyIGJ1ZyA9IHB1dEFKQVhNYXJrZXIuYnVnc1tpZF07CgkJaWYodGhpcy5idWdzW2lkXSkKCQl7CgkJCWlmIChmb3JjZSB8fCB0aGlzLmJ1Z3NbaWRdLm9zYi5jbG9zZWQgIT09IGJ1Z1syXSkKCQkJCXRoaXMucmVtb3ZlTGF5ZXIodGhpcy5idWdzW2lkXSk7CgkJCWVsc2UKCQkJCXJldHVybjsKCQl9CgoJCXZhciBjbG9zZWQgPSBidWdbMl07CgoJCWlmIChjbG9zZWQgJiYgIXRoaXMub3B0aW9ucy5zaG93Q2xvc2VkKSByZXR1cm47CgkJaWYgKCFjbG9zZWQgJiYgIXRoaXMub3B0aW9ucy5zaG93T3BlbikgcmV0dXJuOwoKCQl2YXIgaWNvbl91cmwgPSBudWxsOwoJCXZhciBjbGFzc19wb3B1cCA9ICcgb3NiJzsKCQlpZiAoYnVnWzJdKSB7CgkJCWljb25fdXJsID0gdGhpcy5vcHRpb25zLmljb25DbG9zZWQ7CgkJCWNsYXNzX3BvcHVwICs9ICcgb3NiQ2xvc2VkJzsKCQl9CgkJZWxzZSBpZiAoYnVnWzFdLmxlbmd0aCA9PT0gMSkgewoJCQlpY29uX3VybCA9IHRoaXMub3B0aW9ucy5pY29uT3BlbjsKCQkJY2xhc3NfcG9wdXAgKz0gJyBvc2JPcGVuJzsKCQl9CgkJZWxzZSB7CgkJICBpZiAodGhpcy5vcHRpb25zLmljb25BY3RpdmUpIHsKCQkgICAgaWNvbl91cmwgPSB0aGlzLm9wdGlvbnMuaWNvbkFjdGl2ZTsKCQkgICAgY2xhc3NfcG9wdXAgKz0gJyBvc2JBY3RpdmUnOwoJCSAgfQoJCSAgZWxzZSB7CgkJICAgIGljb25fdXJsID0gdGhpcy5vcHRpb25zLmljb25PcGVuOwoJCSAgICBjbGFzc19wb3B1cCArPSAnIG9zYk9wZW4nOwoJCSAgfQoJCX0KCQl2YXIgZmVhdHVyZSA9IG5ldyBMLk1hcmtlcihidWdbMF0sIHtpY29uOm5ldyB0aGlzLm9zYkljb24oe2ljb25Vcmw6IGljb25fdXJsfSl9KTsKCQlmZWF0dXJlLm9zYiA9IHtpZDogaWQsIGNsb3NlZDogY2xvc2VkfTsKCQl0aGlzLmFkZExheWVyKGZlYXR1cmUpOwoJCXRoaXMuYnVnc1tpZF0gPSBmZWF0dXJlOwoJCXRoaXMuc2V0UG9wdXBDb250ZW50KGlkKTsKCQlmZWF0dXJlLl9wb3B1cC5vcHRpb25zLmNsYXNzTmFtZSArPSBjbGFzc19wb3B1cDsKCgkJaWYgKHRoaXMub3B0aW9ucy5idWdpZCAmJiAocGFyc2VJbnQodGhpcy5vcHRpb25zLmJ1Z2lkKSA9PT0gaWQpKQoJCQlmZWF0dXJlLm9wZW5Qb3B1cCgpOwoKCQkvL3RoaXMuZXZlbnRzLnRyaWdnZXJFdmVudCgnbWFya2VyQWRkZWQnKTsKCX0sCgoJb3NiSWNvbiA6ICBMLkljb24uZXh0ZW5kKHsKCQlvcHRpb25zOiB7CgkJCWljb25Vcmw6ICdodHRwOi8vb3BlbnN0cmVldGJ1Z3Muc2Nob2tva2Vrcy5vcmcvY2xpZW50L29wZW5fYnVnX21hcmtlci5wbmcnLAoJCQlpY29uU2l6ZTogbmV3IEwuUG9pbnQoMjIsIDIyKSwKCQkJc2hhZG93U2l6ZTogbmV3IEwuUG9pbnQoMCwgMCksCgkJCWljb25BbmNob3I6IG5ldyBMLlBvaW50KDExLCAxMSksCgkJCXBvcHVwQW5jaG9yOiBuZXcgTC5Qb2ludCgwLCAtMTEpCgkJfQoJfSksCgoJc2V0UG9wdXBDb250ZW50OiBmdW5jdGlvbihpZCkgewoJCWlmKHRoaXMuYnVnc1tpZF0uX3BvcHVwX2NvbnRlbnQpCgkJCXJldHVybjsKCgkJdmFyIGVsMSxlbDIsZWwzOwoJCXZhciBsYXllciA9IHRoaXM7CgoJCXZhciByYXdidWcgPSBwdXRBSkFYTWFya2VyLmJ1Z3NbaWRdOwoJCXZhciBpc2Nsb3NlZCA9IHJhd2J1Z1syXTsKCgkJdmFyIG5ld0NvbnRlbnQgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnb3NiLXBvcHVwJyk7CgkJdmFyIGgxID0gTC5Eb21VdGlsLmNyZWF0ZSgnaDEnLCBudWxsLCBuZXdDb250ZW50KTsKCQlpZiAocmF3YnVnWzJdKSAKCQkJaDEudGV4dENvbnRlbnQgPSBMLmkxOG4oJ0ZpeGVkIEVycm9yJyk7CgkJZWxzZSBpZiAocmF3YnVnWzFdLmxlbmd0aCA9PT0gMSkKCQkJaDEudGV4dENvbnRlbnQgPSBMLmkxOG4oJ1VucmVzb2x2ZWQgRXJyb3InKTsKCQllbHNlCgkJCWgxLnRleHRDb250ZW50ID0gTC5pMThuKCdBY3RpdmUgRXJyb3InKTsKCgkJdmFyIGRpdmluZm8gPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnb3NiLWluZm8nLCBuZXdDb250ZW50KTsKCQl2YXIgdGFibGUgPSBMLkRvbVV0aWwuY3JlYXRlKCd0YWJsZScsICdvc2ItdGFibGUnLCBkaXZpbmZvKTsKCQlmb3IodmFyIGk9MDsgaTxyYXdidWdbMV0ubGVuZ3RoOyBpKyspCgkJewoJCQl2YXIgdHIgPSBMLkRvbVV0aWwuY3JlYXRlKCd0cicsICdvc2ItdHItaW5mbycsIHRhYmxlKTsKCQkJdHIuc2V0QXR0cmlidXRlKCd2YWxpZ24nLCd0b3AnKTsKCQkJdmFyIHRkX25pY2tuYW1lID0gTC5Eb21VdGlsLmNyZWF0ZSgndGQnLCAnb3NiLXRkLW5pY2tuYW1lJywgdHIpOwoJCQl0ZF9uaWNrbmFtZS50ZXh0Q29udGVudCA9IHJhd2J1Z1s1XVtpXSArICc6JzsKCQkJdmFyIHRkX2RhdGV0aW1lID0gTC5Eb21VdGlsLmNyZWF0ZSgndGQnLCAnb3NiLXRkLWRhdGV0aW1lJywgdHIpOwoJCQl0ZF9kYXRldGltZS50ZXh0Q29udGVudCA9IHJhd2J1Z1s2XVtpXTsKCQkJdmFyIHRkX2NvbW1lbnQgPSBMLkRvbVV0aWwuY3JlYXRlKCd0ZCcsICdvc2ItdGQtY29tbWVudCcsIEwuRG9tVXRpbC5jcmVhdGUoJ3RyJywgJ29zYi10ci1jb21tZW50JywgdGFibGUpKTsKCQkJdGRfY29tbWVudC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCcyJyk7CgkJCXRkX2NvbW1lbnQuc2V0QXR0cmlidXRlKCdjaGFyb2ZmJywnMicpOwoJCQl0ZF9jb21tZW50LnRleHRDb250ZW50ID0gcmF3YnVnWzRdW2ldOwoJCX0KCgkJZnVuY3Rpb24gY3JlYXRlX2xpbmsodWwsIHRleHQpIHsKCQkJdmFyIGEgPSBMLkRvbVV0aWwuY3JlYXRlKCdhJywgbnVsbCwKCQkJCQlMLkRvbVV0aWwuY3JlYXRlKCdsaScsIG51bGwsIHVsKSk7CgkJCWEuaHJlZiA9ICcjJzsKCQkJYS50ZXh0Q29udGVudCA9IEwuaTE4bih0ZXh0KTsKCQkJcmV0dXJuIGE7CgkJfQoKCQl2YXIgdWwgPSBMLkRvbVV0aWwuY3JlYXRlKCd1bCcsIG51bGwsIG5ld0NvbnRlbnQpOwoJCXZhciBfdGhpcyA9IHRoaXM7CgkJdmFyIGJ1ZyA9IHRoaXMuYnVnc1tpZF07CgoJCWZ1bmN0aW9uIHNob3dDb21tZW50KHRpdGxlLCBhZGRfY29tbWVudCkgewoJCQloMS50ZXh0Q29udGVudF9vbGQgPSBoMS50ZXh0Q29udGVudDsKCQkJaDEudGV4dENvbnRlbnQgPSBMLmkxOG4odGl0bGUpOwoJCQl2YXIgZm9ybSA9IF90aGlzLmNyZWF0ZUNvbW1lbnRGb3JtKCk7CgkJCWZvcm0ub3NiaWQudmFsdWUgPSBpZDsKCQkJZm9ybS5jYW5jZWwub25jbGljayA9IGZ1bmN0aW9uIChlKSB7CgkJCQloMS50ZXh0Q29udGVudCA9IGgxLnRleHRDb250ZW50X29sZDsKCQkJCW5ld0NvbnRlbnQucmVtb3ZlQ2hpbGQoZm9ybSk7CgkJCQluZXdDb250ZW50LmFwcGVuZENoaWxkKHVsKTsKCQkJfTsKCQkJZm9ybS5vay5vbmNsaWNrID0gZnVuY3Rpb24oZSkgewoJCQkJYnVnLmNsb3NlUG9wdXAoKTsKCQkJCWlmICghYWRkX2NvbW1lbnQpCgkJCQkJX3RoaXMuY2xvc2VCdWcoZm9ybSk7CgkJCQllbHNlCgkJCQkJX3RoaXMuc3VibWl0Q29tbWVudChmb3JtKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfTsKCQkJbmV3Q29udGVudC5hcHBlbmRDaGlsZChmb3JtKTsKCQkJbmV3Q29udGVudC5yZW1vdmVDaGlsZCh1bCk7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICghaXNjbG9zZWQgJiYgIXRoaXMub3B0aW9ucy5yZWFkb25seSkgewoJCQl2YXIgYTsKCQkJYSA9IGNyZWF0ZV9saW5rKHVsLCAnQWRkIGNvbW1lbnQnKTsKCQkJYS5vbmNsaWNrID0gZnVuY3Rpb24oZSkgeyByZXR1cm4gc2hvd0NvbW1lbnQoJ0FkZCBjb21tZW50JywgdHJ1ZSk7IH07CgoJCQlhID0gY3JlYXRlX2xpbmsodWwsICdNYXJrIGFzIEZpeGVkJyk7CgkJCWEub25jbGljayA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuIHNob3dDb21tZW50KCdDbG9zZSBidWcnLCBmYWxzZSk7IH07CgkJfQoJCXZhciBhX2pvc20gPSBjcmVhdGVfbGluayh1bCwgJ0pPU00nKTsKCQlhX2pvc20ub25jbGljayA9IGZ1bmN0aW9uKCkgeyBfdGhpcy5yZW1vdGVFZGl0KHJhd2J1Z1swXSk7IH07CgoJCXZhciBhX2xpbmsgPSBjcmVhdGVfbGluayh1bCwgJ0xpbmsnKTsKCQl2YXIgdmFycyA9IHtsYXQ6cmF3YnVnWzBdLmxhdCwgbG9uOnJhd2J1Z1swXS5sbmcsIHpvb206dGhpcy5vcHRpb25zLnBlcm1hbGlua1pvb20sIGJ1Z2lkOmlkfTsKCQlpZiAodGhpcy5vcHRpb25zLnBlcm1hbGlua1VybCkKCQkJYV9saW5rLmhyZWYgPSBMLlV0aWwudGVtcGxhdGUodGhpcy5vcHRpb25zLnBlcm1hbGlua1VybCwgdmFycyk7CgkJZWxzZQoJCQlhX2xpbmsuaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSArCgkJCQlMLlV0aWwuZ2V0UGFyYW1TdHJpbmcodmFycyk7CgoKCQlidWcuX3BvcHVwX2NvbnRlbnQgPSBuZXdDb250ZW50OwoJCWJ1Zy5iaW5kUG9wdXAobmV3Q29udGVudCwgdGhpcy5vcHRpb25zLnBvcHVwT3B0aW9ucyk7CgkJYnVnLl9wb3B1cC5vcHRpb25zLm1heFdpZHRoPTQxMDsKCQlidWcuX3BvcHVwLm9wdGlvbnMubWluV2lkdGg9NDEwOwoJCWJ1Zy5vbignbW91c2VvdmVyJywgYnVnLm9wZW5UZW1wUG9wdXAsIGJ1Zyk7Cgl9LAoKCXN1Ym1pdENvbW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHsKCQlpZiAoIWZvcm0ub3NiY29tbWVudC52YWx1ZSkgcmV0dXJuOwoJCXZhciBuaWNrbmFtZSA9IGZvcm0ub3Nibmlja25hbWUudmFsdWUgfHwgdGhpcy5vcHRpb25zLnVzZXJuYW1lOwoJCXRoaXMuYXBpUmVxdWVzdCgnZWRpdFBPSWV4ZWMnCgkJCSsgJz9pZD0nK2VuY29kZVVSSUNvbXBvbmVudChmb3JtLm9zYmlkLnZhbHVlKQoJCQkrICcmdGV4dD0nK2VuY29kZVVSSUNvbXBvbmVudChmb3JtLm9zYmNvbW1lbnQudmFsdWUgKyAnIFsnICsgbmlja25hbWUgKyAnXScpCgkJCSsgJyZmb3JtYXQ9anMnLCB0cnVlCgkJKTsKCQl0aGlzLnNldF9jb29raWUoJ29zYlVzZXJuYW1lJyxuaWNrbmFtZSk7CgkJdGhpcy5vcHRpb25zLnVzZXJuYW1lPW5pY2tuYW1lOwoJfSwKCgljbG9zZUJ1ZzogZnVuY3Rpb24oZm9ybSkgewoJCXZhciBpZCA9IGZvcm0ub3NiaWQudmFsdWU7CgkJdGhpcy5zdWJtaXRDb21tZW50KGZvcm0pOwoJCXRoaXMuYXBpUmVxdWVzdCgnY2xvc2VQT0lleGVjJwoJCQkrICc/aWQ9JytlbmNvZGVVUklDb21wb25lbnQoaWQpCgkJCSsgJyZmb3JtYXQ9anMnLCB0cnVlCgkJKTsKCX0sCgoJY3JlYXRlQ29tbWVudEZvcm06IGZ1bmN0aW9uKGVsdCkgewoJCXZhciBmb3JtID0gTC5Eb21VdGlsLmNyZWF0ZSgnZm9ybScsICdvc2ItYWRkLWNvbW1lbnQnLCBlbHQpOwoJCXZhciBjb250ZW50ID0gJyc7CgkJY29udGVudCArPSAnPGlucHV0IG5hbWU9Im9zYmlkIiB0eXBlPSJoaWRkZW4iLz4nOwoJCWNvbnRlbnQgKz0gJzxpbnB1dCBuYW1lPSJvc2JsYXQiIHR5cGU9ImhpZGRlbiIvPic7CgkJY29udGVudCArPSAnPGlucHV0IG5hbWU9Im9zYmxvbiIgdHlwZT0iaGlkZGVuIi8+JzsKCQljb250ZW50ICs9ICc8ZGl2PjxzcGFuIGNsYXNzPSJvc2ItaW5wdXRsYWJlbCI+JytMLmkxOG4oJ05pY2tuYW1lJykrJzo8L3NwYW4+PGlucHV0IHR5cGU9InRleHQiIG5hbWU9Im9zYm5pY2tuYW1lIj48L2Rpdj4nOwoJCWNvbnRlbnQgKz0gJzxkaXY+PHNwYW4gY2xhc3M9Im9zYi1pbnB1dGxhYmVsIj4nK0wuaTE4bignQ29tbWVudCcpKyc6PC9zcGFuPjxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJvc2Jjb21tZW50Ij48L2Rpdj4nOwoJCWNvbnRlbnQgKz0gJzxkaXYgY2xhc3M9Im9zYi1mb3JtZm9vdGVyIj48aW5wdXQgdHlwZT0ic3VibWl0IiBuYW1lPSJvayIvPjxpbnB1dCB0eXBlPSJidXR0b24iIG5hbWU9ImNhbmNlbCIvPjwvZGl2Pic7CgkJZm9ybS5pbm5lckhUTUwgPSBjb250ZW50OwoJCWZvcm0ub2sudmFsdWUgPSBMLmkxOG4oJ09LJyk7CgkJZm9ybS5jYW5jZWwudmFsdWUgPSBMLmkxOG4oJ0NhbmNlbCcpOwoJCWZvcm0ub3Nibmlja25hbWUudmFsdWUgPSB0aGlzLm9wdGlvbnMudXNlcm5hbWU7CgkJcmV0dXJuIGZvcm07Cgl9LAoKCWFkZEJ1ZzogZnVuY3Rpb24oZSkgewoJCXZhciBuZXdDb250ZW50ID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ29zYi1wb3B1cCcpOwoKCQluZXdDb250ZW50LmlubmVySFRNTCArPSAnPGgxPicrTC5pMThuKCdOZXcgYnVnJykrJzwvaDE+JzsKCQluZXdDb250ZW50LmlubmVySFRNTCArPSAnPGRpdiBjbGFzcz0ib3NiQ3JlYXRlSW5mbyI+JytMLmkxOG4oJ0ZpbmQgeW91ciBidWc/JykrJzxiciAvPicrTC5pMThuKCdDb250YWN0IGRldGFpbHMgYW5kIHNvbWVvbmUgd2lsbCBmaXggaXQuJykrJzwvZGl2Pic7CgoJCXZhciBwb3B1cCA9IG5ldyBMLlBvcHVwKCk7CgkJdmFyIF90aGlzID0gdGhpczsKCQl2YXIgZm9ybSA9IHRoaXMuY3JlYXRlQ29tbWVudEZvcm0obmV3Q29udGVudCk7CgkJZm9ybS5vc2JsYXQudmFsdWUgPSBlLmxhdGxuZy5sYXQ7CgkJZm9ybS5vc2Jsb24udmFsdWUgPSBlLmxhdGxuZy5sbmc7CgkJZm9ybS5vay52YWx1ZSA9IEwuaTE4bignQWRkIGNvbW1lbnQnKTsKCQlmb3JtLm9uc3VibWl0ID0gZnVuY3Rpb24oZSkgewoJCQlfdGhpcy5fbWFwLmNsb3NlUG9wdXAocG9wdXApOwoJCQlfdGhpcy5jcmVhdGVCdWcoZm9ybSk7CgkJCXJldHVybiBmYWxzZTsKCQl9OwoJCWZvcm0uY2FuY2VsLm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7IF90aGlzLl9tYXAuY2xvc2VQb3B1cChwb3B1cCk7IH07CgoJCXBvcHVwLnNldExhdExuZyhlLmxhdGxuZyk7CgkJcG9wdXAuc2V0Q29udGVudChuZXdDb250ZW50KTsKCQlwb3B1cC5vcHRpb25zLm1heFdpZHRoPTQxMDsKCQlwb3B1cC5vcHRpb25zLm1pbldpZHRoPTQxMDsKCQlwb3B1cC5vcHRpb25zLmNsYXNzTmFtZSArPSAnIG9zYiBvc2JDcmVhdGUnOwoKCQl0aGlzLl9tYXAub3BlblBvcHVwKHBvcHVwKTsKCX0sCgoJY3JlYXRlQnVnOiBmdW5jdGlvbihmb3JtKSB7CgkJaWYgKCFmb3JtLm9zYmNvbW1lbnQudmFsdWUpIHJldHVybjsKCQl2YXIgbmlja25hbWUgPSBmb3JtLm9zYm5pY2tuYW1lLnZhbHVlIHx8IHRoaXMub3B0aW9ucy51c2VybmFtZTsKCQl0aGlzLmFwaVJlcXVlc3QoJ2FkZFBPSWV4ZWMnCgkJCSsgJz9sYXQ9JytlbmNvZGVVUklDb21wb25lbnQoZm9ybS5vc2JsYXQudmFsdWUpCgkJCSsgJyZsb249JytlbmNvZGVVUklDb21wb25lbnQoZm9ybS5vc2Jsb24udmFsdWUpCgkJCSsgJyZ0ZXh0PScrZW5jb2RlVVJJQ29tcG9uZW50KGZvcm0ub3NiY29tbWVudC52YWx1ZSArICcgWycgKyBuaWNrbmFtZSArICddJykKCQkJKyAnJmZvcm1hdD1qcycsIHRydWUKCQkpOwoJCXRoaXMuc2V0X2Nvb2tpZSgnb3NiVXNlcm5hbWUnLG5pY2tuYW1lKTsKCQl0aGlzLm9wdGlvbnMudXNlcm5hbWU9bmlja25hbWU7Cgl9LAoKCXJlbW90ZUVkaXQ6IGZ1bmN0aW9uKHgpIHsKCQl2YXIgeWRlbHRhID0gdGhpcy5vcHRpb25zLmVkaXRBcmVhIHx8IDAuMDE7CgkJdmFyIHhkZWx0YSA9IHlkZWx0YSAqIDI7CgkJdmFyIHAgPSBbICdsZWZ0PScgICsgKHgubG5nIC0geGRlbHRhKSwgJ2JvdHRvbT0nICsgKHgubGF0IC0geWRlbHRhKSwgJ3JpZ2h0PScgKyAoeC5sbmcgKyB4ZGVsdGEpLCAndG9wPScgICAgKyAoeC5sYXQgKyB5ZGVsdGEpXTsKCQl2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6ODExMS9sb2FkX2FuZF96b29tPycgKyBwLmpvaW4oJyYnKTsKCQl2YXIgZnJhbWUgPSBMLkRvbVV0aWwuY3JlYXRlKCdpZnJhbWUnLCBudWxsKTsKCQlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCWZyYW1lLnNyYyA9IHVybDsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZyYW1lKTsKCQlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbihlKSB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZnJhbWUpOyB9OwoJCXJldHVybiBmYWxzZTsKCX0KfSk7CgpMLk9wZW5TdHJlZXRCdWdzLnNldENTUyA9IGZ1bmN0aW9uKCkgewoJaWYoTC5PcGVuU3RyZWV0QnVncy5zZXRDU1MuZG9uZSkKCQlyZXR1cm47CgllbHNlCgkJTC5PcGVuU3RyZWV0QnVncy5zZXRDU1MuZG9uZSA9IHRydWU7CgoJLy8gU2VlIGh0dHA6Ly93d3cuaHVubG9jay5jb20vYmxvZ3MvVG90YWxseV9Qd25fQ1NTX3dpdGhfSmF2YXNjcmlwdAoJdmFyIGlkeCA9IDA7Cgl2YXIgYWRkUnVsZSA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBydWxlcykgewoJCXZhciBzID0gZG9jdW1lbnQuc3R5bGVTaGVldHNbMF07CgkJdmFyIHJ1bGU7CgkJaWYocy5hZGRSdWxlKSAvLyBNJElFCgkJCXJ1bGUgPSBzLmFkZFJ1bGUoc2VsZWN0b3IsIHJ1bGVzLCBpZHgpOwoJCWVsc2UKCQkJcnVsZSA9IHMuaW5zZXJ0UnVsZShzZWxlY3RvciArICcgeyAnICsgcnVsZXMgKyAnIH0nLCBpZHgpOwoJCXMuc3R5bGUgPSBMLlV0aWwuZXh0ZW5kKHMuc3R5bGUgfHwge30sIHJ1bGVzKTsKCQlpZHgrKzsKCX07CgoJYWRkUnVsZSgnLm9zYi1wb3B1cCBkbCcsICdtYXJnaW46MDsgcGFkZGluZzowOycpOwoJYWRkUnVsZSgnLm9zYi1wb3B1cCBkdCcsICdtYXJnaW46MDsgcGFkZGluZzowOyBmb250LXdlaWdodDpib2xkOyBmbG9hdDpsZWZ0OyBjbGVhcjpsZWZ0OycpOwoJYWRkUnVsZSgnLm9zYi1wb3B1cCBkdDphZnRlcicsICdjb250ZW50OiAiOsKgIjsnKTsKCWFkZFJ1bGUoJyogaHRtbCAub3NiLXBvcHVwIGR0JywgJ21hcmdpbi1yaWdodDoxZXg7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIGRkJywgJ21hcmdpbjowOyBwYWRkaW5nOjA7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIHVsLmJ1dHRvbnMnLCAnbGlzdC1zdHlsZS10eXBlOm5vbmU7IHBhZGRpbmc6MDsgbWFyZ2luOjA7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIHVsLmJ1dHRvbnMgbGknLCAnZGlzcGxheTppbmxpbmU7IG1hcmdpbjowOyBwYWRkaW5nOjA7Jyk7CglhZGRSdWxlKCcub3NiLXBvcHVwIGgzJywgJ2ZvbnQtc2l6ZToxLjJlbTsgbWFyZ2luOi4yZW0gMCAuN2VtIDA7Jyk7Cn07CgpmdW5jdGlvbiBwdXRBSkFYTWFya2VyKGlkLCBsb24sIGxhdCwgdGV4dCwgY2xvc2VkKQp7Cgl2YXIgY29tbWVudHMgPSB0ZXh0LnNwbGl0KC88aHIgXC8+Lyk7Cgl2YXIgY29tbWVudHNfb25seSA9IFtdOwoJdmFyIG5pY2tuYW1lID0gW107Cgl2YXIgZGF0ZXRpbWUgPSBbXTsKCXZhciBpbmZvID0gbnVsbDsKCXZhciBpc3BsaXQgPSAwOwoJdmFyIGk7Cglmb3IoaT0wOyBpPGNvbW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJaW5mbyA9IG51bGw7CgkJaXNwbGl0ID0gMDsKCQljb21tZW50c1tpXSA9IGNvbW1lbnRzW2ldLnJlcGxhY2UoLyZxdW90Oy9nLCAnIicpLnJlcGxhY2UoLyZsdDsvZywgJzwnKS5yZXBsYWNlKC8mZ3Q7L2csICc+JykucmVwbGFjZSgvJmFtcDsvZywgJyYnKTsKCQlpc3BsaXQgPSBjb21tZW50c1tpXS5sYXN0SW5kZXhPZignWycpOwoJCWlmIChpc3BsaXQgPiAwKSB7CgkJICBjb21tZW50c19vbmx5W2ldID0gY29tbWVudHNbaV0uc3Vic3RyKDAsaXNwbGl0LTEpOwoJCSAgaW5mbyA9IGNvbW1lbnRzW2ldLnN1YnN0cihpc3BsaXQrMSk7CgkJICBuaWNrbmFtZVtpXSA9IGluZm8uc3Vic3RyKDAsaW5mby5sYXN0SW5kZXhPZignLCcpKTsKCQkgIGRhdGV0aW1lW2ldID0gaW5mby5zdWJzdHIoaW5mby5sYXN0SW5kZXhPZignLCcpKzIpOwoJCSAgZGF0ZXRpbWVbaV0gPSBkYXRldGltZVtpXS5zdWJzdHIoMCxkYXRldGltZVtpXS5sYXN0SW5kZXhPZignXScpKTsKCQl9CgkJZWxzZSB7CgkJICBjb21tZW50c19vbmx5W2ldID0gY29tbWVudHNbaV07CgkJfQoJfQoJdmFyIG9sZCA9IHB1dEFKQVhNYXJrZXIuYnVnc1tpZF07CglwdXRBSkFYTWFya2VyLmJ1Z3NbaWRdID0gWwoJCW5ldyBMLkxhdExuZyhsYXQsIGxvbiksCgkJY29tbWVudHMsCgkJY2xvc2VkLAoJCXRleHQsCgkJY29tbWVudHNfb25seSwKCQluaWNrbmFtZSwKCQlkYXRldGltZQoJXTsKCXZhciBmb3JjZSA9IChvbGQgJiYgb2xkWzNdKSAhPT0gdGV4dDsKCWZvcihpPTA7IGk8cHV0QUpBWE1hcmtlci5sYXllcnMubGVuZ3RoOyBpKyspCgkJcHV0QUpBWE1hcmtlci5sYXllcnNbaV0uY3JlYXRlTWFya2VyKGlkLCBmb3JjZSk7Cn0KCmZ1bmN0aW9uIG9zYlJlc3BvbnNlKGVycm9yKQp7CglpZihlcnJvcikKCQlhbGVydCgnRXJyb3I6ICcrZXJyb3IpOwoKCXJldHVybjsKfQoKcHV0QUpBWE1hcmtlci5sYXllcnMgPSBbIF07CnB1dEFKQVhNYXJrZXIuYnVncyA9IHsgfTsKCkwuTWFya2VyLmluY2x1ZGUoewoJb3BlblRlbXBQb3B1cDogZnVuY3Rpb24oKSB7CgkJdGhpcy5vcGVuUG9wdXAoKTsKCQl0aGlzLm9mZignY2xpY2snLCB0aGlzLm9wZW5Qb3B1cCwgdGhpcyk7CgoJCWZ1bmN0aW9uIG9uY2xpY2soKSB7CgkJCXRoaXMub2ZmKCdtb3VzZW91dCcsIG9ub3V0LCB0aGlzKTsKCQkJdGhpcy5vZmYoJ2NsaWNrJywgb25jbGljaywgdGhpcyk7CgkJCXRoaXMub24oJ2NsaWNrJywgdGhpcy5vcGVuUG9wdXAsIHRoaXMpOwoJCX0KCgkJZnVuY3Rpb24gb25vdXQoKSB7CgkJCW9uY2xpY2suY2FsbCh0aGlzKTsKCQkJdGhpcy5jbG9zZVBvcHVwKCk7CgkJfQoJCXRoaXMub24oJ21vdXNlb3V0Jywgb25vdXQsIHRoaXMpOwoJCXRoaXMub24oJ2NsaWNrJywgb25jbGljaywgdGhpcyk7Cgl9Cn0pOwoKTC5pMThuID0gZnVuY3Rpb24ocykgeyByZXR1cm4gKEwuaTE4bi5sYW5nW0wuaTE4bi5jdXJyZW50XSB8fCB7fSlbc10gfHwgczsgfTsKTC5pMThuLmN1cnJlbnQgPSAncnUnOwpMLmkxOG4ubGFuZyA9IHt9OwpMLmkxOG4uZXh0ZW5kID0gZnVuY3Rpb24obGFuZywgYXJncykgewoJTC5pMThuLmxhbmdbbGFuZ10gPSBMLlV0aWwuZXh0ZW5kKEwuaTE4bi5sYW5nW2xhbmddIHx8IHt9LCBhcmdzKTsKfTsKCkwuaTE4bi5leHRlbmQoJ3J1JywgewoJJ0ZpeGVkIEVycm9yJzon0J7RiNC40LHQutCwINC40YHQv9GA0LDQstC70LXQvdCwJywKCSdVbnJlc29sdmVkIEVycm9yJzon0J3QtdC40YHQv9GA0LDQstC70LXQvdC90LDRjyDQvtGI0LjQsdC60LAnLAoJJ0FjdGl2ZSBFcnJvcic6J9Ce0YjQuNCx0LrQsCDRg9GC0L7Rh9C90Y/QtdGC0YHRjycsCgknRGVzY3JpcHRpb24nOifQntC/0LjRgdCw0L3QuNC1JywKCSdDb21tZW50Jzon0J7Qv9C40YHQsNC90LjQtScsCgknQWRkIGNvbW1lbnQnOifQlNC+0L/QvtC70L3QuNGC0YwnLAoJJ01hcmsgYXMgRml4ZWQnOifQmNGB0L/RgNCw0LLQu9C10L3QvicsCgknTGluayc6J9Ch0YHRi9C70LrQsCcsCgknQ2FuY2VsJzon0J7RgtC80LXQvdCwJywKCSdOZXcgYnVnJzon0K8g0L3QsNGI0LXQuyDQvtGI0LjQsdC60YMnLAoJJ0ZpbmQgeW91ciBidWc/Jzon0J3QsNGI0LvQuCDQvtGI0LjQsdC60YM/JywKCSdDb250YWN0IGRldGFpbHMgYW5kIHNvbWVvbmUgd2lsbCBmaXggaXQuJzon0J3QsNC/0LjRiNC40YLQtSDQv9C+0LTRgNC+0LHQvdC10LUg0Lgg0LrRgtC+LdC90LjQsdGD0LTRjCDQtdGRINC40YHQv9GA0LDQstC40YIuJwp9KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 08:31:36 GMT",
                    "Content-Length": "14424",
                    "Date": "Fri, 07 Nov 2014 08:31:36 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}