{
    "url": "http://localhost:9999/alvarotrigo/multiscroll.js/jquery.multiscroll.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var sectionAnchor =  window.location.hash.replace('#', '');</li><li>var section = $('.ms-left .ms-section[data-anchor=\"'+sectionAnchor+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/alvarotrigo/multiscroll.js/jquery.multiscroll.js",
                "path": "/alvarotrigo/multiscroll.js/jquery.multiscroll.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hbHZhcm90cmlnby9tdWx0aXNjcm9sbC5qcy9qcXVlcnkubXVsdGlzY3JvbGwuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjA4MDkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTg6MzI6MjAgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE4OjMyOjIwIEdNVA0KDQovKioNCiAqIG11bHRpc2Nyb2xsLmpzIDAuMS41IEJldGENCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHZhcm90cmlnby9tdWx0aXNjcm9sbC5qcw0KICogTUlUIGxpY2Vuc2VkDQogKg0KICogQ29weXJpZ2h0IChDKSAyMDEzIGFsdmFyb3RyaWdvLmNvbSAtIEEgcHJvamVjdCBieSBBbHZhcm8gVHJpZ28NCiAqLw0KDQooZnVuY3Rpb24oJCkgew0KCSQuZm4ubXVsdGlzY3JvbGwgPSBmdW5jdGlvbihvcHRpb25zKSB7DQoJCS8vIENyZWF0ZSBzb21lIGRlZmF1bHRzLCBleHRlbmRpbmcgdGhlbSB3aXRoIGFueSBvcHRpb25zIHRoYXQgd2VyZSBwcm92aWRlZA0KCQlvcHRpb25zID0gJC5leHRlbmQoew0KCQkJJ3ZlcnRpY2FsQ2VudGVyZWQnIDogdHJ1ZSwNCgkJCSdzY3JvbGxpbmdTcGVlZCc6IDcwMCwNCgkJCSdlYXNpbmcnOiAnZWFzZUluUXVhcnQnLA0KCQkJJ21lbnUnOiBmYWxzZSwNCgkJCSdzZWN0aW9uc0NvbG9yJzogW10sDQoJCQknYW5jaG9ycyc6W10sDQoJCQknbmF2aWdhdGlvbic6IGZhbHNlLA0KCQkJJ25hdmlnYXRpb25Qb3NpdGlvbic6ICdyaWdodCcsDQoJCQknbmF2aWdhdGlvbkNvbG9yJzogJyMwMDAnLA0KCQkJJ25hdmlnYXRpb25Ub29sdGlwcyc6IFtdLA0KCQkJJ2xvb3BCb3R0b20nOiBmYWxzZSwNCgkJCSdsb29wVG9wJzogZmFsc2UsDQoJCQknY3NzMyc6IGZhbHNlLA0KCQkJJ3BhZGRpbmdUb3AnOiAwLA0KCQkJJ3BhZGRpbmdCb3R0b20nOiAwLA0KCQkJJ2ZpeGVkRWxlbWVudHMnOiBudWxsLA0KCQkJJ25vcm1hbFNjcm9sbEVsZW1lbnRzJzogbnVsbCwNCgkJCSdrZXlib2FyZFNjcm9sbGluZyc6IHRydWUsDQoJCQkndG91Y2hTZW5zaXRpdml0eSc6IDUsDQoNCgkJCS8vZXZlbnRzDQoJCQknYWZ0ZXJMb2FkJzogbnVsbCwNCgkJCSdvbkxlYXZlJzogbnVsbCwNCgkJCSdhZnRlclJlbmRlcic6IG51bGwsDQoJCQknYWZ0ZXJSZXNpemUnOiBudWxsDQoJCX0sIG9wdGlvbnMpOw0KDQoNCgkJLy9EZWZpbmVzIHRoZSBkZWxheSB0byB0YWtlIHBsYWNlIGJlZm9yZSBiZWluZyBhYmxlIHRvIHNjcm9sbCB0byB0aGUgbmV4dCBzZWN0aW9uDQoJCS8vQkUgQ0FSRUZVTCEgTm90IHJlY29tbWVuZWQgdG8gY2hhbmdlIGl0IHVuZGVyIDQwMCBmb3IgYSBnb29kIGJlaGF2aW9yIGluIGxhcHRvcHMgYW5kDQoJCS8vQXBwbGUgZGV2aWNlcyAobGFwdG9wcywgbW91c2VzLi4uKQ0KCQl2YXIgc2Nyb2xsRGVsYXkgPSA2MDA7DQoNCgkJdmFyIGlzVG91Y2ggPSAoKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdykgfHwgKG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzID4gMCkpOw0KCQl2YXIgbnVtYmVyU2VjdGlvbnMgPSAkKCcubXMtbGVmdCcpLmZpbmQoJy5tcy1zZWN0aW9uJykubGVuZ3RoOw0KCQl2YXIgaXNNb3ZpbmcgPSBmYWxzZTsNCgkJdmFyIG5hdjsNCgkJdmFyIHdpbmRvd0hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTsNCg0KDQoJCWFkZE1vdXNlV2hlZWxIYW5kbGVyKCk7DQoJCWFkZFRvdWNoSGFuZGxlcigpOw0KDQoJCS8vaWYgY3NzMyBpcyBub3Qgc3VwcG9ydGVkLCBpdCB3aWxsIHVzZSBqUXVlcnkgYW5pbWF0aW9ucw0KCQlpZihvcHRpb25zLmNzczMpew0KCQkJb3B0aW9ucy5jc3MzID0gc3VwcG9ydDNkKCk7DQoJCX0NCg0KCQkkKCdodG1sLCBib2R5JykuY3NzKHsNCgkJCSdvdmVyZmxvdycgOiAnaGlkZGVuJywNCgkJCSdoZWlnaHQnIDogJzEwMCUnDQoJCX0pOw0KDQoJCS8vY3JlYXRpbmcgdGhlIG5hdmlnYXRpb24gZG90cw0KCQlpZiAob3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQkkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPSJtdWx0aXNjcm9sbC1uYXYiPjx1bD48L3VsPjwvZGl2PicpOw0KCQkJbmF2ID0gJCgnI211bHRpc2Nyb2xsLW5hdicpOw0KDQoJCQluYXYuY3NzKCdjb2xvcicsIG9wdGlvbnMubmF2aWdhdGlvbkNvbG9yKTsNCgkJCW5hdi5hZGRDbGFzcyhvcHRpb25zLm5hdmlnYXRpb25Qb3NpdGlvbik7DQoJCX0NCg0KCQkkKCcubXMtcmlnaHQsIC5tcy1sZWZ0JykuY3NzKHsNCgkJCSd3aWR0aCc6ICc1MCUnLA0KCQkJJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCgkJCSdoZWlnaHQnOiAnMTAwJScsDQoJCQknLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJw0KCQl9KTsNCg0KCQkkKCcubXMtcmlnaHQnKS5jc3Moew0KCQkJJ3JpZ2h0JzogJzFweCcsIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMzY3NTQ1Ny9jaHJvbWUtYW5kLW9wZXJhLWNyZWF0aW5nLXNtYWxsLXBhZGRpbmctd2hlbi11c2luZy1kaXNwbGF5dGFibGUNCgkJCSd0b3AnOiAnMCcsDQoJCQknLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJywNCgkJCSd0b3VjaC1hY3Rpb24nOiAnbm9uZScNCgkJfSk7DQoNCgkJJCgnLm1zLWxlZnQnKS5jc3Moew0KCQkJJ2xlZnQnOiAnMCcsDQoJCQkndG9wJzogJzAnLA0KCQkJJy1tcy10b3VjaC1hY3Rpb24nOiAnbm9uZScsDQoJCQkndG91Y2gtYWN0aW9uJzogJ25vbmUnDQoJCX0pOw0KDQoNCgkJJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24sIC5tcy1yaWdodCAubXMtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCgkJCXZhciBzZWN0aW9uSW5kZXggPSAkKHRoaXMpLmluZGV4KCk7DQoNCgkJCWlmKG9wdGlvbnMucGFkZGluZ1RvcCB8fCBvcHRpb25zLnBhZGRpbmdCb3R0b20pew0KCQkJCSQodGhpcykuY3NzKCdwYWRkaW5nJywgb3B0aW9ucy5wYWRkaW5nVG9wICArICcgMCAnICsgb3B0aW9ucy5wYWRkaW5nQm90dG9tICsgJyAwJyk7DQoJCQl9DQoNCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5zZWN0aW9uc0NvbG9yW3NlY3Rpb25JbmRleF0gIT09ICAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb3B0aW9ucy5zZWN0aW9uc0NvbG9yW3NlY3Rpb25JbmRleF0pOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIG9wdGlvbnMuYW5jaG9yc1tzZWN0aW9uSW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuYXR0cignZGF0YS1hbmNob3InLCBvcHRpb25zLmFuY2hvcnNbc2VjdGlvbkluZGV4XSk7DQoJCQl9DQoNCgkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJYWRkVGFibGVDbGFzcygkKHRoaXMpKTsNCgkJCX0NCg0KCQkJLy9vbmx5IGZvciB0aGUgbGVmdCBwYW5lbA0KCQkJaWYoJCh0aGlzKS5jbG9zZXN0KCcubXMtbGVmdCcpLmxlbmd0aCAmJiBvcHRpb25zLm5hdmlnYXRpb24pIHsNCgkJCQl2YXIgbGluayA9ICcnOw0KCQkJCWlmKG9wdGlvbnMuYW5jaG9ycy5sZW5ndGgpew0KCQkJCQlsaW5rID0gb3B0aW9ucy5hbmNob3JzW3NlY3Rpb25JbmRleF07DQoJCQkJfQ0KCQkJCXZhciB0b29sdGlwID0gb3B0aW9ucy5uYXZpZ2F0aW9uVG9vbHRpcHNbc2VjdGlvbkluZGV4XTsNCgkJCQlpZih0eXBlb2YgdG9vbHRpcCA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCQl0b29sdGlwID0gJyc7DQoJCQkJfQ0KCQkJCWlmIChvcHRpb25zLm5hdmlnYXRpb24pIHsNCgkJCQkJbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGkgZGF0YS10b29sdGlwPSInICsgdG9vbHRpcCArICciPjxhIGhyZWY9IiMnICsgbGluayArICciPjxzcGFuPjwvc3Bhbj48L2E+PC9saT4nKTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KDQoJCS8vaW52ZXJ0aW5nIHRoZSByaWdodCBwYW5lbA0KCQkkKCcubXMtcmlnaHQnKS5odG1sKCAkKCcubXMtcmlnaHQnKS5maW5kKCcubXMtc2VjdGlvbicpLmdldCgpLnJldmVyc2UoKSk7DQoNCgkJJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24sIC5tcy1yaWdodCAubXMtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCgkJCXZhciBzZWN0aW9uSW5kZXggPSAkKHRoaXMpLmluZGV4KCk7DQoNCgkJCSQodGhpcykuY3NzKHsNCgkJCQknaGVpZ2h0JzogJzEwMCUnDQoJCQl9KTsNCg0KDQoJCQlpZighc2VjdGlvbkluZGV4ICYmIG9wdGlvbnMubmF2aWdhdGlvbiApew0KCQkJCS8vYWN0aXZhdGluZyB0aGUgbmF2aWdhdGlvbiBidWxsZXQNCgkJCQluYXYuZmluZCgnbGknKS5lcShzZWN0aW9uSW5kZXgpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoJCX0pLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uKCl7DQoNCgkJCS8vaWYgbm8gYWN0aXZlIHNlY3Rpb24gaXMgZGVmaW5lZCwgdGhlIDFzdCBvbmUgd2lsbCBiZSB0aGUgZGVmYXVsdCBvbmUNCgkJCWlmKCEkKCcubXMtbGVmdCAubXMtc2VjdGlvbi5hY3RpdmUnKS5sZW5ndGgpew0KCQkJCSQoJy5tcy1yaWdodCcpLmZpbmQoJy5tcy1zZWN0aW9uJykubGFzdCgpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQkkKCcubXMtbGVmdCcpLmZpbmQoJy5tcy1zZWN0aW9uJykuZmlyc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlbmRlciApICYmIG9wdGlvbnMuYWZ0ZXJSZW5kZXIuY2FsbCggdGhpcyk7DQoNCgkJCS8vc2Nyb2xsaW5nIHRvIHRoZSBkZWZpbmVkIGFjdGl2ZSBzZWN0aW9uIGFuZCBhZGp1c3RpbmcgcmlnaHQgYW5kIGxlZnQgcGFuZWxzDQoJCQlzaWxlbnRTY3JvbGwoKTsNCg0KCQkJJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQoJCQkJc2Nyb2xsVG9BbmNob3IoKTsNCgkJCX0pOw0KCQl9KTsNCg0KDQoJCS8vZGV0ZWN0aW5nIGFueSBjaGFuZ2Ugb24gdGhlIFVSTCB0byBzY3JvbGwgdG8gdGhlIGdpdmVuIGFuY2hvciBsaW5rDQoJCS8vKGEgd2F5IHRvIGRldGVjdCBiYWNrIGhpc3RvcnkgYnV0dG9uIGFzIHdlIHBsYXkgd2l0aCB0aGUgaGFzaGVzIG9uIHRoZSBVUkwpDQoJCSQod2luZG93KS5vbignaGFzaGNoYW5nZScsZnVuY3Rpb24oKXsNCgkJCXZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpOw0KCQkJdmFyIHNlY3Rpb25BbmNob3IgPSB2YWx1ZTsNCg0KCQkJaWYoc2VjdGlvbkFuY2hvci5sZW5ndGgpew0KCQkJCXZhciBzZWN0aW9uID0gJCgnLm1zLWxlZnQnKS5maW5kKCdbZGF0YS1hbmNob3I9Iicrc2VjdGlvbkFuY2hvcisnIl0nKTsNCg0KCQkJCXZhciBpc0ZpcnN0U2Nyb2xsTW92ZSA9ICh0eXBlb2YgbGFzdFNjcm9sbGVkRGVzdGlueSA9PT0gJ3VuZGVmaW5lZCcgKTsNCg0KCQkJCWlmIChpc0ZpcnN0U2Nyb2xsTW92ZSB8fCBzZWN0aW9uQW5jaG9yICE9PSBsYXN0U2Nyb2xsZWREZXN0aW55KXsNCgkJCQkJc2Nyb2xsUGFnZShzZWN0aW9uKTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KDQoNCgkJLyoqDQoJCSAqIFNsaWRpbmcgd2l0aCBhcnJvdyBrZXlzLCBib3RoLCB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbA0KCQkgKi8NCgkJJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbihlKSB7DQoJCQlpZihlLndoaWNoID09IDQwIHx8IGUud2hpY2ggPT0gMzgpew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCX0NCg0KCQkJLy9Nb3ZpbmcgdGhlIG1haW4gcGFnZSB3aXRoIHRoZSBrZXlib2FyZCBhcnJvd3MgaWYga2V5Ym9hcmQgc2Nyb2xsaW5nIGlzIGVuYWJsZWQNCgkJCWlmIChvcHRpb25zLmtleWJvYXJkU2Nyb2xsaW5nICYmICFpc01vdmluZykgew0KCQkJCXN3aXRjaCAoZS53aGljaCkgew0KCQkJCQkvL3VwDQoJCQkJCWNhc2UgMzg6DQoJCQkJCWNhc2UgMzM6DQoJCQkJCQkkLmZuLm11bHRpc2Nyb2xsLm1vdmVTZWN0aW9uVXAoKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vZG93bg0KCQkJCQljYXNlIDQwOg0KCQkJCQljYXNlIDM0Og0KCQkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vSG9tZQ0KCQkJCQljYXNlIDM2Og0KCQkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlVG8oMSk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL0VuZA0KCQkJCQljYXNlIDM1Og0KCQkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlVG8oICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uJykubGVuZ3RoICk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQlkZWZhdWx0Og0KCQkJCQkJcmV0dXJuOyAvLyBleGl0IHRoaXMgaGFuZGxlciBmb3Igb3RoZXIga2V5cw0KCQkJCX0NCgkJCX0NCgkJfSk7DQoNCg0KCQkvKioNCgkJICogRGlzYWJsaW5nIGFueSBhY3Rpb24gd2hlbiBwcmVzc2luZyBvZiB0aGUgbW91c2Ugd2hlZWwgKENocm9tZSwgSUUsIE9wZXJhLCBTYWZhcmkpDQoJCSAqLw0KCQkkKGRvY3VtZW50KS5tb3VzZWRvd24oZnVuY3Rpb24oZSkgew0KCQkJaWYoZS5idXR0b24gPT0gMSl7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfSk7DQoNCgkJLy9uYXZpZ2F0aW9uIGFjdGlvbg0KCQkkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI211bHRpc2Nyb2xsLW5hdiBhJywgZnVuY3Rpb24oZSl7DQoJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQl2YXIgaW5kZXggPSAkKHRoaXMpLnBhcmVudCgpLmluZGV4KCk7DQoJCQlzY3JvbGxQYWdlKCQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uJykuZXEoaW5kZXgpKTsNCgkJfSk7DQoNCgkJLy9uYXZpZ2F0aW9uIHRvb2x0aXBzDQoJCSQoZG9jdW1lbnQpLm9uKHsNCgkJCW1vdXNlZW50ZXI6IGZ1bmN0aW9uKCl7DQoJCQkJdmFyIHRvb2x0aXAgPSAkKHRoaXMpLmRhdGEoJ3Rvb2x0aXAnKTsNCgkJCQkkKCc8ZGl2IGNsYXNzPSJtdWx0aXNjcm9sbC10b29sdGlwICcgKyBvcHRpb25zLm5hdmlnYXRpb25Qb3NpdGlvbiArJyI+JyArIHRvb2x0aXAgKyAnPC9kaXY+JykuaGlkZSgpLmFwcGVuZFRvKCQodGhpcykpLmZhZGVJbigyMDApOw0KCQkJfSwNCgkJCW1vdXNlbGVhdmU6IGZ1bmN0aW9uKCl7DQoJCQkJJCh0aGlzKS5maW5kKCcubXVsdGlzY3JvbGwtdG9vbHRpcCcpLmZhZGVPdXQoMjAwLCBmdW5jdGlvbigpIHsNCgkJCQkJJCh0aGlzKS5yZW1vdmUoKTsNCgkJCQl9KTsNCgkJCX0NCgkJfSwgJyNtdWx0aXNjcm9sbC1uYXYgbGknKTsNCg0KDQoJCWlmKG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpew0KCQkJJChkb2N1bWVudCkub24oJ21vdXNlZW50ZXInLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbiAoKSB7DQoJCQkJJC5mbi5tdWx0aXNjcm9sbC5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKGZhbHNlKTsNCgkJCX0pOw0KDQoJCQkkKGRvY3VtZW50KS5vbignbW91c2VsZWF2ZScsIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMsIGZ1bmN0aW9uKCl7DQoJCQkJJC5mbi5tdWx0aXNjcm9sbC5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKHRydWUpOw0KCQkJfSk7DQoJCX0NCg0KDQoJCS8vd2hlbiByZXNpemluZyB0aGUgc2l0ZSwgd2UgYWRqdXN0IHRoZSBoZWlnaHRzIG9mIHRoZSBzZWN0aW9ucw0KCQkkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkgew0KCQkJZG9uZVJlc2l6aW5nKCk7DQoJCX0pOw0KDQoJCS8qKg0KCQkgKiBXaGVuIHJlc2l6aW5nIGlzIGZpbmlzaGVkLCB3ZSBhZGp1c3QgdGhlIHNsaWRlcyBzaXplcyBhbmQgcG9zaXRpb25zDQoJCSAqLw0KCQlmdW5jdGlvbiBkb25lUmVzaXppbmcoKSB7DQoJCQl3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoJCQkkKCcubXMtdGFibGVDZWxsJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkkKHRoaXMpLmNzcyh7IGhlaWdodDogZ2V0VGFibGVIZWlnaHQoJCh0aGlzKS5wYXJlbnQoKSkgfSk7DQoJCQl9KTsNCgkJCXNpbGVudFNjcm9sbCgpOw0KCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyUmVzaXplICkgJiYgb3B0aW9ucy5hZnRlclJlc2l6ZS5jYWxsKCB0aGlzKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHNpbGVudFNjcm9sbCgpew0KCQkJLy9tb3ZpbmcgdGhlIHJpZ2h0IHNlY3Rpb24gdG8gdGhlIGJvdHRvbQ0KCQkJaWYob3B0aW9ucy5jc3MzKXsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIoJCgnLm1zLWxlZnQnKSwgJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyAkKCcubXMtbGVmdCcpLmZpbmQoJy5tcy1zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCkudG9wICsgJ3B4LCAwcHgpJywgZmFsc2UpOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcigkKCcubXMtcmlnaHQnKSwgJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyAkKCcubXMtcmlnaHQnKS5maW5kKCcubXMtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCArICdweCwgMHB4KScsIGZhbHNlKTsNCgkJCX1lbHNlew0KCQkJCSQoJy5tcy1sZWZ0JykuY3NzKCd0b3AnLCAtJCgnLm1zLWxlZnQnKS5maW5kKCcubXMtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCApOw0KCQkJCSQoJy5tcy1yaWdodCcpLmNzcygndG9wJywgLSQoJy5tcy1yaWdodCcpLmZpbmQoJy5tcy1zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCkudG9wICk7DQoJCQl9DQoJCX0NCg0KCQkkLmZuLm11bHRpc2Nyb2xsLm1vdmVTZWN0aW9uVXAgPSBmdW5jdGlvbigpew0KCQkJdmFyIHByZXYgPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbi5hY3RpdmUnKS5wcmV2KCcubXMtc2VjdGlvbicpOw0KDQoJCQlpZighcHJldi5sZW5ndGggJiYgb3B0aW9ucy5sb29wVG9wKXsNCgkJCQlwcmV2ID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24nKS5sYXN0KCk7DQoJCQl9DQoNCgkJCWlmIChwcmV2Lmxlbmd0aCkgew0KCQkJCXNjcm9sbFBhZ2UocHJldik7DQoJCQl9DQoJCX07DQoNCgkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvbkRvd24gPSBmdW5jdGlvbiAoKXsNCgkJCXZhciBuZXh0ID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24uYWN0aXZlJykubmV4dCgnLm1zLXNlY3Rpb24nKTsNCg0KCQkJaWYoIW5leHQubGVuZ3RoICYmIG9wdGlvbnMubG9vcEJvdHRvbSApew0KCQkJCW5leHQgPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbicpLmZpcnN0KCk7DQoJCQl9DQoNCgkJCWlmKG5leHQubGVuZ3RoKXsNCgkJCQlzY3JvbGxQYWdlKG5leHQpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVRvID0gZnVuY3Rpb24gKHNlY3Rpb24pew0KCQkJdmFyIGRlc3RpbnkgPSAnJzsNCg0KCQkJaWYoaXNOYU4oc2VjdGlvbikpew0KCQkJCWRlc3RpbnkgPSAkKCcubXMtbGVmdCBbZGF0YS1hbmNob3I9Iicrc2VjdGlvbisnIl0nKTsNCgkJCX1lbHNlew0KCQkJCWRlc3RpbnkgPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbicpLmVxKCAoc2VjdGlvbiAtMSkgKTsNCgkJCX0NCg0KCQkJc2Nyb2xsUGFnZShkZXN0aW55KTsNCgkJfTsNCg0KCQlmdW5jdGlvbiBzY3JvbGxQYWdlKGxlZnREZXN0aW5hdGlvbil7DQoJCQl2YXIgbGVmdERlc3RpbmF0aW9uSW5kZXggPSBsZWZ0RGVzdGluYXRpb24uaW5kZXgoKTsNCgkJCXZhciByaWdodERlc3RpbmF0aW9uID0gJCgnLm1zLXJpZ2h0JykuZmluZCgnLm1zLXNlY3Rpb24nKS5lcSggbnVtYmVyU2VjdGlvbnMgLTEgLSBsZWZ0RGVzdGluYXRpb25JbmRleCk7DQoJCQl2YXIgcmlnaHREZXN0aW5hdGlvbkluZGV4ID0gbnVtYmVyU2VjdGlvbnMgLSAxIC0gbGVmdERlc3RpbmF0aW9uSW5kZXg7DQoJCQl2YXIgYW5jaG9yTGluayAgPSBsZWZ0RGVzdGluYXRpb24uZGF0YSgnYW5jaG9yJyk7DQoJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLmFjdGl2ZScpOw0KCQkJdmFyIGxlYXZpbmdTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5pbmRleCgpICsgMTsNCgkJCXZhciB5TW92ZW1lbnQgPSBnZXRZbW92ZW1lbnQobGVmdERlc3RpbmF0aW9uKTsNCg0KCQkJLy9wcmV2ZW50aW5nIGZyb20gYWN0aXZhdGluZyB0aGUgTW91c2VXaGVlbEhhbmRsZXIgZXZlbnQNCgkJCS8vbW9yZSB0aGFuIG9uY2UgaWYgdGhlIHBhZ2UgaXMgc2Nyb2xsaW5nDQoJCQlpc01vdmluZyA9IHRydWU7DQoNCgkJCXNldFVSTEhhc2goYW5jaG9yTGluayk7DQoNCgkJCXZhciB0b3BQb3MgPSB7DQoJCQkJJ2xlZnQnIDogbGVmdERlc3RpbmF0aW9uLnBvc2l0aW9uKCkudG9wLA0KCQkJCSdyaWdodCc6IHJpZ2h0RGVzdGluYXRpb24ucG9zaXRpb24oKS50b3ANCgkJCX07DQoNCgkJCXJpZ2h0RGVzdGluYXRpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJbGVmdERlc3RpbmF0aW9uLmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCg0KCQkJLy8gVXNlIENTUzMgdHJhbnNsYXRlIGZ1bmN0aW9uYWxpdHkgb3IuLi4NCgkJCWlmIChvcHRpb25zLmNzczMpew0KCQkJCS8vY2FsbGJhY2sgKG9uTGVhdmUpDQoJCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMub25MZWF2ZSkgJiYgb3B0aW9ucy5vbkxlYXZlLmNhbGwodGhpcywgbGVhdmluZ1NlY3Rpb24sIChsZWZ0RGVzdGluYXRpb25JbmRleCArIDEpLCB5TW92ZW1lbnQpOw0KDQoJCQkJdmFyIHRyYW5zbGF0ZTNkTGVmdCA9ICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgdG9wUG9zWydsZWZ0J10gKyAncHgsIDBweCknOw0KCQkJCXZhciB0cmFuc2xhdGUzZFJpZ2h0ID0gJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyB0b3BQb3NbJ3JpZ2h0J10gKyAncHgsIDBweCknOw0KDQoJCQkJdHJhbnNmb3JtQ29udGFpbmVyKCQoJy5tcy1sZWZ0JyksIHRyYW5zbGF0ZTNkTGVmdCwgdHJ1ZSk7DQoJCQkJdHJhbnNmb3JtQ29udGFpbmVyKCQoJy5tcy1yaWdodCcpLCB0cmFuc2xhdGUzZFJpZ2h0LCB0cnVlKTsNCg0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQkvL2NhbGxiYWNrIChhZnRlckxvYWQpDQoJCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLmFmdGVyTG9hZCkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCh0aGlzLCBhbmNob3JMaW5rLCAobGVmdERlc3RpbmF0aW9uSW5kZXggKyAxKSk7DQoNCgkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCQlpc01vdmluZyA9IGZhbHNlOw0KCQkJCQl9LCBzY3JvbGxEZWxheSk7DQoJCQkJfSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCk7DQoJCQl9ZWxzZXsNCgkJCQkvL2NhbGxiYWNrIChvbkxlYXZlKQ0KCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKHRoaXMsIGxlYXZpbmdTZWN0aW9uLCAobGVmdERlc3RpbmF0aW9uSW5kZXggKyAxKSwgeU1vdmVtZW50KTsNCg0KCQkJCSQoJy5tcy1sZWZ0JykuYW5pbWF0ZSh7DQoJCQkJCSd0b3AnOiAtdG9wUG9zWydsZWZ0J10NCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZywgZnVuY3Rpb24oKXsNCgkJCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJMb2FkKSAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKHRoaXMsIGFuY2hvckxpbmssIChsZWZ0RGVzdGluYXRpb25JbmRleCArIDEpKTsNCg0KCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJCWlzTW92aW5nID0gZmFsc2U7DQoJCQkJCX0sIHNjcm9sbERlbGF5KTsNCgkJCQl9KTsNCg0KCQkJCSQoJy5tcy1yaWdodCcpLmFuaW1hdGUoew0KCQkJCQkndG9wJzogLXRvcFBvc1sncmlnaHQnXQ0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nKTsNCgkJCX0NCg0KCQkJLy9mbGFnIHRvIGF2b2lkIGNhbGxpbmduIGBzY3JvbGxQYWdlKClgIHR3aWNlIGluIGNhc2Ugb2YgdXNpbmcgYW5jaG9yIGxpbmtzDQoJCQlsYXN0U2Nyb2xsZWREZXN0aW55ID0gYW5jaG9yTGluazsNCg0KCQkJYWN0aXZhdGVNZW51RWxlbWVudChhbmNob3JMaW5rKTsNCgkJCWFjdGl2YXRlTmF2RG90cyhhbmNob3JMaW5rLCBsZWZ0RGVzdGluYXRpb25JbmRleCk7DQoJCX0NCg0KCQkvKioNCgkJKiBSZW1vdmVzIHRoZSBhdXRvIHNjcm9sbGluZyBhY3Rpb24gZmlyZWQgYnkgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KCQkqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdvbid0IHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zLg0KCQkqLw0KCQlmdW5jdGlvbiByZW1vdmVNb3VzZVdoZWVsSGFuZGxlcigpew0KCQkJaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCgkJCX0gZWxzZSB7DQoJCQkJZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogQWRkcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZvciB0aGUgbW91c2Ugd2hlZWwgYW5kIHRhY2twYWQuDQoJCSogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSBtb3VzZXdoZWVsIGFuZCB0cmFja3BhZCBtb3ZlbWVudHMgd2lsbCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucw0KCQkqLw0KCQlmdW5jdGlvbiBhZGRNb3VzZVdoZWVsSGFuZGxlcigpew0KCQkJaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCgkJCX0gZWxzZSB7DQoJCQkJZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIERldGVjdGluZyBtb3VzZXdoZWVsIHNjcm9sbGluZw0KCQkgKg0KCQkgKiBodHRwOi8vYmxvZ3Muc2l0ZXBvaW50c3RhdGljLmNvbS9leGFtcGxlcy90ZWNoL21vdXNlLXdoZWVsL2luZGV4Lmh0bWwNCgkJICogaHR0cDovL3d3dy5zaXRlcG9pbnQuY29tL2h0bWw1LWphdmFzY3JpcHQtbW91c2Utd2hlZWwvDQoJCSAqLw0KCQlmdW5jdGlvbiBNb3VzZVdoZWVsSGFuZGxlcihlKSB7DQoJCQkvLyBjcm9zcy1icm93c2VyIHdoZWVsIGRlbHRhDQoJCQllID0gd2luZG93LmV2ZW50IHx8IGU7DQoJCQl2YXIgZGVsdGEgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwNCgkJCQkJKGUud2hlZWxEZWx0YSB8fCAtZS5kZWx0YVkgfHwgLWUuZGV0YWlsKSkpOw0KDQoJCQlpZiAoIWlzTW92aW5nKSB7IC8vaWYgdGhlcmVzIGFueSAjDQoNCgkJCQkvL3Njcm9sbGluZyBkb3duPw0KCQkJCWlmIChkZWx0YSA8IDApIHsNCgkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQl9DQoNCgkJCQkvL3Njcm9sbGluZyB1cD8NCgkJCQllbHNlIHsNCgkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJfQ0KCQkJfQ0KDQoNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCS8qKg0KCQkqIEFkZHMgYSBjc3MzIHRyYW5zZm9ybSBwcm9wZXJ0eSB0byB0aGUgY29udGFpbmVyIGNsYXNzIHdpdGggb3Igd2l0aG91dCBhbmltYXRpb24gZGVwZW5kaW5nIG9uIHRoZSBhbmltYXRlZCBwYXJhbS4NCgkJKi8NCgkJZnVuY3Rpb24gdHJhbnNmb3JtQ29udGFpbmVyKGNvbnRhaW5lciwgdHJhbnNsYXRlM2QsIGFuaW1hdGVkKXsNCgkJCWNvbnRhaW5lci50b2dnbGVDbGFzcygnbXMtZWFzaW5nJywgYW5pbWF0ZWQpOw0KDQoJCQljb250YWluZXIuY3NzKGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2QpKTsNCgkJfQ0KDQoNCgkJLyoqDQoJCSogUmV0dXJucyB0aGUgdHJhbnNmb3JtIHN0eWxlcyBmb3IgYWxsIGJyb3dzZXJzDQoJCSovDQoJCWZ1bmN0aW9uIGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2Qpew0KCQkJcmV0dXJuIHsNCgkJCQknLXdlYmtpdC10cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZCwNCgkJCQknLW1vei10cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZCwNCgkJCQknLW1zLXRyYW5zZm9ybSc6dHJhbnNsYXRlM2QsDQoJCQkJJ3RyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkDQoJCQl9Ow0KCQl9DQoNCgkJLyoqDQoJCSAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbmF2aWdhdGlvbiBkb3RzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCgkJICovDQoJCWZ1bmN0aW9uIGFjdGl2YXRlTmF2RG90cyhuYW1lLCBzZWN0aW9uSW5kZXgpew0KCQkJaWYob3B0aW9ucy5uYXZpZ2F0aW9uKXsNCgkJCQkkKCcjbXVsdGlzY3JvbGwtbmF2JykuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQlpZihuYW1lKXsNCgkJCQkJJCgnI211bHRpc2Nyb2xsLW5hdicpLmZpbmQoJ2FbaHJlZj0iIycgKyBuYW1lICsgJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX1lbHNlew0KCQkJCQkkKCcjbXVsdGlzY3JvbGwtbmF2JykuZmluZCgnbGknKS5lcShzZWN0aW9uSW5kZXgpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbWFpbiBtZW51IGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCgkJICovDQoJCWZ1bmN0aW9uIGFjdGl2YXRlTWVudUVsZW1lbnQobmFtZSl7DQoJCQlpZihvcHRpb25zLm1lbnUpew0KCQkJCSQob3B0aW9ucy5tZW51KS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCSQob3B0aW9ucy5tZW51KS5maW5kKCdbZGF0YS1tZW51YW5jaG9yPSInK25hbWUrJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogUmV0dW5zIGB1cGAgb3IgYGRvd25gIGRlcGVuZGluZyBvbiB0aGUgc2Nyb2xsaW5nIG1vdmVtZW50IHRvIHJlYWNoIGl0cyBkZXN0aW5hdGlvbg0KCQkqIGZyb20gdGhlIGN1cnJlbnQgc2VjdGlvbi4NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0WW1vdmVtZW50KGRlc3Rpbnkpew0KCQkJdmFyIGZyb21JbmRleCA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCk7DQoJCQl2YXIgdG9JbmRleCA9IGRlc3RpbnkuaW5kZXgoKTsNCg0KCQkJaWYoZnJvbUluZGV4ID4gdG9JbmRleCl7DQoJCQkJcmV0dXJuICd1cCc7DQoJCQl9DQoJCQlyZXR1cm4gJ2Rvd24nOw0KCQl9DQoNCg0KCQkvKioNCgkJKiBTZXRzIHRoZSBVUkwgaGFzaCBmb3IgYSBzZWN0aW9uIHdpdGggc2xpZGVzDQoJCSovDQoJCWZ1bmN0aW9uIHNldFVSTEhhc2goYW5jaG9yTGluayl7DQoJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoKXsNCgkJCQlsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCgkJCX0NCg0KCQl9DQoNCg0KCQkvKioNCgkJKiBDaGVja3MgZm9yIHRyYW5zbGF0ZTNkIHN1cHBvcnQNCgkJKiBAcmV0dXJuIGJvb2xlYW4NCgkJKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzU2NjE2NzEvZGV0ZWN0aW5nLXRyYW5zZm9ybS10cmFuc2xhdGUzZC1zdXBwb3J0DQoJCSovDQoJCWZ1bmN0aW9uIHN1cHBvcnQzZCgpIHsNCgkJCXZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKSwNCgkJCQloYXMzZCwNCgkJCQl0cmFuc2Zvcm1zID0gew0KCQkJCQknd2Via2l0VHJhbnNmb3JtJzonLXdlYmtpdC10cmFuc2Zvcm0nLA0KCQkJCQknT1RyYW5zZm9ybSc6Jy1vLXRyYW5zZm9ybScsDQoJCQkJCSdtc1RyYW5zZm9ybSc6Jy1tcy10cmFuc2Zvcm0nLA0KCQkJCQknTW96VHJhbnNmb3JtJzonLW1vei10cmFuc2Zvcm0nLA0KCQkJCQkndHJhbnNmb3JtJzondHJhbnNmb3JtJw0KCQkJCX07DQoNCgkJCS8vIEFkZCBpdCB0byB0aGUgYm9keSB0byBnZXQgdGhlIGNvbXB1dGVkIHN0eWxlLg0KCQkJZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoZWwsIG51bGwpOw0KDQoJCQlmb3IgKHZhciB0IGluIHRyYW5zZm9ybXMpIHsNCgkJCQlpZiAoZWwuc3R5bGVbdF0gIT09IHVuZGVmaW5lZCkgew0KCQkJCQllbC5zdHlsZVt0XSA9ICJ0cmFuc2xhdGUzZCgxcHgsMXB4LDFweCkiOw0KCQkJCQloYXMzZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKHRyYW5zZm9ybXNbdF0pOw0KCQkJCX0NCgkJCX0NCg0KCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbCk7DQoNCgkJCXJldHVybiAoaGFzM2QgIT09IHVuZGVmaW5lZCAmJiBoYXMzZC5sZW5ndGggPiAwICYmIGhhczNkICE9PSAibm9uZSIpOw0KCQl9DQoNCgkJLyoqDQoJCSogV3JhcHMgYW4gZWxlbWVudCBpbiBvcmRlciB0byBjZW50ZXIgaXQgdmVydGljYWxseSBieSB1c2luZyBhIGNsYXNzIHN0eWxlLg0KCQkqLw0KCQlmdW5jdGlvbiBhZGRUYWJsZUNsYXNzKGVsZW1lbnQpew0KCQkJZWxlbWVudC5hZGRDbGFzcygnbXMtdGFibGUnKS53cmFwSW5uZXIoJzxkaXYgY2xhc3M9Im1zLXRhYmxlQ2VsbCIgc3R5bGU9ImhlaWdodDogJyArIGdldFRhYmxlSGVpZ2h0KGVsZW1lbnQpICsgJ3B4IiAvPicpOw0KCQl9DQoNCgkJLyoqDQoJCSogR2V0cyB0aGUgaGVpZ2h0IG9mIHRoZSBzZWN0aW9uIGFmdGVyIHJlbW92aW5nIHRoZSBwYWRkaW5ncy4NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0VGFibGVIZWlnaHQoc2VjdGlvbil7DQoJCQl2YXIgc2VjdGlvbkhlaWdodCA9IHdpbmRvd0hlaWdodDsNCg0KCQkJaWYob3B0aW9ucy5wYWRkaW5nVG9wIHx8IG9wdGlvbnMucGFkZGluZ0JvdHRvbSl7DQoJCQkJdmFyIHBhZGRpbmdzID0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctdG9wJykpICsgcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctYm90dG9tJykpOw0KCQkJCXNlY3Rpb25IZWlnaHQgPSAod2luZG93SGVpZ2h0IC0gcGFkZGluZ3MpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gc2VjdGlvbkhlaWdodDsNCgkJfQ0KDQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0aGUgcGFnZSB0byB0aGUgZXhpc3RlbnQgYW5jaG9yIGluIHRoZSBVUkwNCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsVG9BbmNob3IoKXsNCgkJCS8vZ2V0dGluZyB0aGUgYW5jaG9yIGxpbmsgaW4gdGhlIFVSTCBhbmQgZGVsZXRpbmcgdGhlIGAjYA0KCQkJdmFyIHNlY3Rpb25BbmNob3IgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKTsNCgkJCXZhciBzZWN0aW9uID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb25bZGF0YS1hbmNob3I9Iicrc2VjdGlvbkFuY2hvcisnIl0nKTsNCg0KCQkJaWYoc2VjdGlvbkFuY2hvci5sZW5ndGgpeyAgLy9pZiB0aGVyZXMgYW55ICMNCgkJCQlzY3JvbGxQYWdlKHNlY3Rpb24pOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIGtleWJvYXJkIGFycm93IGtleXMNCgkJKi8NCgkJJC5mbi5tdWx0aXNjcm9sbC5zZXRLZXlib2FyZFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlvcHRpb25zLmtleWJvYXJkU2Nyb2xsaW5nID0gdmFsdWU7DQoJCX07DQoNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIG1vdXNlIHdoZWVsIG9yIHRoZSB0cmFja3BhZC4NCgkJKi8NCgkJJC5mbi5tdWx0aXNjcm9sbC5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCgkJCWlmKHZhbHVlKXsNCgkJCQlhZGRNb3VzZVdoZWVsSGFuZGxlcigpOw0KCQkJfWVsc2V7DQoJCQkJcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJKiBEZWZpbmVzIHRoZSBzY3JvbGxpbmcgc3BlZWQNCgkJKi8NCgkJJC5mbi5tdWx0aXNjcm9sbC5zZXRTY3JvbGxpbmdTcGVlZCA9IGZ1bmN0aW9uKHZhbHVlKXsNCgkJICAgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCA9IHZhbHVlOw0KCQl9Ow0KDQoNCg0KCQl2YXIgdG91Y2hTdGFydFkgPSAwOw0KCQl2YXIgdG91Y2hTdGFydFggPSAwOw0KCQl2YXIgdG91Y2hFbmRZID0gMDsNCgkJdmFyIHRvdWNoRW5kWCA9IDA7DQoNCgkJLyogRGV0ZWN0aW5nIHRvdWNoIGV2ZW50cw0KDQoJCSogQXMgd2UgYXJlIGNoYW5naW5nIHRoZSB0b3AgcHJvcGVydHkgb2YgdGhlIHBhZ2Ugb24gc2Nyb2xsaW5nLCB3ZSBjYW4gbm90IHVzZSB0aGUgdHJhZGl0aW9uYWwgd2F5IHRvIGRldGVjdCBpdC4NCgkJKiBUaGlzIHdheSwgdGhlIHRvdWNoc3RhcnQgYW5kIHRoZSB0b3VjaCBtb3ZlcyBzaG93cyBhbiBzbWFsbCBkaWZmZXJlbmNlIGJldHdlZW4gdGhlbSB3aGljaCBpcyB0aGUNCgkJKiB1c2VkIG9uZSB0byBkZXRlcm1pbmUgdGhlIGRpcmVjdGlvbi4NCgkJKi8NCgkJZnVuY3Rpb24gdG91Y2hNb3ZlSGFuZGxlcihldmVudCl7DQoJCQl2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7DQoNCgkJCS8vcHJldmVudGluZyB0aGUgZWFzaW5nIG9uIGlPUyBkZXZpY2VzDQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLmFjdGl2ZScpOw0KDQoJCQlpZiAoIWlzTW92aW5nKSB7IC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCgkJCQl0b3VjaEVuZFkgPSB0b3VjaEV2ZW50c1sneSddOw0KCQkJCXRvdWNoRW5kWCA9IHRvdWNoRXZlbnRzWyd4J107DQoNCg0KCQkJCS8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCgkJCQlpZiAoTWF0aC5hYnModG91Y2hTdGFydFkgLSB0b3VjaEVuZFkpID4gKCQod2luZG93KS5oZWlnaHQoKSAvIDEwMCAqIG9wdGlvbnMudG91Y2hTZW5zaXRpdml0eSkpIHsNCg0KCQkJCQlpZiAodG91Y2hTdGFydFkgPiB0b3VjaEVuZFkpIHsNCgkJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25Eb3duKCk7DQoNCgkJCQkJfSBlbHNlIGlmICh0b3VjaEVuZFkgPiB0b3VjaFN0YXJ0WSkgew0KCQkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCg0KDQoJCS8qKg0KCQkqIEhhbmRsZXIgdG8gZ2V0IGhlIGNvb3JkaW5hdGVzIG9mIHRoZSBzdGFydGluZyB0b3VjaA0KCQkqLw0KCQlmdW5jdGlvbiB0b3VjaFN0YXJ0SGFuZGxlcihldmVudCl7DQoJCQl2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7DQoJCQl2YXIgdG91Y2hFdmVudHMgPSBnZXRFdmVudHNQYWdlKGUpOw0KCQkJdG91Y2hTdGFydFkgPSB0b3VjaEV2ZW50c1sneSddOw0KCQkJdG91Y2hTdGFydFggPSB0b3VjaEV2ZW50c1sneCddOw0KCQl9DQoNCg0KCQkvKioNCgkJKiBBZGRzIHRoZSBwb3NzaWJpbGl0eSB0byBhdXRvIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zIG9uIHRvdWNoIGRldmljZXMuDQoJCSovDQoJCWZ1bmN0aW9uIGFkZFRvdWNoSGFuZGxlcigpew0KCQkJaWYoaXNUb3VjaCl7DQoJCQkJLy9NaWNyb3NvZnQgcG9pbnRlcnMNCgkJCQlNU1BvaW50ZXIgPSBnZXRNU1BvaW50ZXIoKTsNCg0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2hzdGFydCAnICsgIE1TUG9pbnRlci5kb3duKS5vbigndG91Y2hzdGFydCAnICsgTVNQb2ludGVyLmRvd24sIHRvdWNoU3RhcnRIYW5kbGVyKTsNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUpLm9uKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlLCB0b3VjaE1vdmVIYW5kbGVyKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIFJlbW92ZXMgdGhlIGF1dG8gc2Nyb2xsaW5nIGZvciB0b3VjaCBkZXZpY2VzLg0KCQkqLw0KCQlmdW5jdGlvbiByZW1vdmVUb3VjaEhhbmRsZXIoKXsNCgkJCWlmKGlzVG91Y2gpew0KCQkJCS8vTWljcm9zb2Z0IHBvaW50ZXJzDQoJCQkJTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duKTsNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUpOw0KCQkJfQ0KCQl9DQoNCgkJLyoNCgkJKiBSZXR1cm5zIGFuZCBvYmplY3Qgd2l0aCBNaWNyb3NvZnQgcG9pbnRlcnMgKGZvciBJRTwxMSBhbmQgZm9yIElFID49IDExKQ0KCQkqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9kbjMwNDg4Nih2PXZzLjg1KS5hc3B4DQoJCSovDQoJCWZ1bmN0aW9uIGdldE1TUG9pbnRlcigpew0KCQkJdmFyIHBvaW50ZXI7DQoNCgkJCS8vSUUgPj0gMTENCgkJCWlmKHdpbmRvdy5Qb2ludGVyRXZlbnQpew0KCQkJCXBvaW50ZXIgPSB7IGRvd246ICJwb2ludGVyZG93biIsIG1vdmU6ICJwb2ludGVybW92ZSJ9Ow0KCQkJfQ0KDQoJCQkvL0lFIDwgMTENCgkJCWVsc2V7DQoJCQkJcG9pbnRlciA9IHsgZG93bjogIk1TUG9pbnRlckRvd24iLCBtb3ZlOiAiTVNQb2ludGVyTW92ZSJ9Ow0KCQkJfQ0KDQoJCQlyZXR1cm4gcG9pbnRlcjsNCgkJfQ0KDQoJCS8qKg0KCQkqIEdldHMgdGhlIHBhZ2VYIGFuZCBwYWdlWSBwcm9wZXJ0aWVzIGRlcGVuZGluZyBvbiB0aGUgYnJvd3Nlci4NCgkJKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vZnVsbFBhZ2UuanMvaXNzdWVzLzE5NCNpc3N1ZWNvbW1lbnQtMzQwNjk4NTQNCgkJKi8NCgkJZnVuY3Rpb24gZ2V0RXZlbnRzUGFnZShlKXsNCgkJCXZhciBldmVudHMgPSBuZXcgQXJyYXkoKTsNCgkJCWlmICh3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWQpew0KCQkJCWV2ZW50c1sneSddID0gZS5wYWdlWTsNCgkJCQlldmVudHNbJ3gnXSA9IGUucGFnZVg7DQoJCQl9ZWxzZXsNCgkJCQlldmVudHNbJ3knXSA9IGUudG91Y2hlc1swXS5wYWdlWTsNCgkJCQlldmVudHNbJ3gnXSA9ICBlLnRvdWNoZXNbMF0ucGFnZVg7DQoJCQl9DQoNCgkJCXJldHVybiBldmVudHM7DQoJCX0NCg0KCX07DQp9KShqUXVlcnkpOw0K",
                "body": "LyoqDQogKiBtdWx0aXNjcm9sbC5qcyAwLjEuNSBCZXRhDQogKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vbXVsdGlzY3JvbGwuanMNCiAqIE1JVCBsaWNlbnNlZA0KICoNCiAqIENvcHlyaWdodCAoQykgMjAxMyBhbHZhcm90cmlnby5jb20gLSBBIHByb2plY3QgYnkgQWx2YXJvIFRyaWdvDQogKi8NCg0KKGZ1bmN0aW9uKCQpIHsNCgkkLmZuLm11bHRpc2Nyb2xsID0gZnVuY3Rpb24ob3B0aW9ucykgew0KCQkvLyBDcmVhdGUgc29tZSBkZWZhdWx0cywgZXh0ZW5kaW5nIHRoZW0gd2l0aCBhbnkgb3B0aW9ucyB0aGF0IHdlcmUgcHJvdmlkZWQNCgkJb3B0aW9ucyA9ICQuZXh0ZW5kKHsNCgkJCSd2ZXJ0aWNhbENlbnRlcmVkJyA6IHRydWUsDQoJCQknc2Nyb2xsaW5nU3BlZWQnOiA3MDAsDQoJCQknZWFzaW5nJzogJ2Vhc2VJblF1YXJ0JywNCgkJCSdtZW51JzogZmFsc2UsDQoJCQknc2VjdGlvbnNDb2xvcic6IFtdLA0KCQkJJ2FuY2hvcnMnOltdLA0KCQkJJ25hdmlnYXRpb24nOiBmYWxzZSwNCgkJCSduYXZpZ2F0aW9uUG9zaXRpb24nOiAncmlnaHQnLA0KCQkJJ25hdmlnYXRpb25Db2xvcic6ICcjMDAwJywNCgkJCSduYXZpZ2F0aW9uVG9vbHRpcHMnOiBbXSwNCgkJCSdsb29wQm90dG9tJzogZmFsc2UsDQoJCQknbG9vcFRvcCc6IGZhbHNlLA0KCQkJJ2NzczMnOiBmYWxzZSwNCgkJCSdwYWRkaW5nVG9wJzogMCwNCgkJCSdwYWRkaW5nQm90dG9tJzogMCwNCgkJCSdmaXhlZEVsZW1lbnRzJzogbnVsbCwNCgkJCSdub3JtYWxTY3JvbGxFbGVtZW50cyc6IG51bGwsDQoJCQkna2V5Ym9hcmRTY3JvbGxpbmcnOiB0cnVlLA0KCQkJJ3RvdWNoU2Vuc2l0aXZpdHknOiA1LA0KDQoJCQkvL2V2ZW50cw0KCQkJJ2FmdGVyTG9hZCc6IG51bGwsDQoJCQknb25MZWF2ZSc6IG51bGwsDQoJCQknYWZ0ZXJSZW5kZXInOiBudWxsLA0KCQkJJ2FmdGVyUmVzaXplJzogbnVsbA0KCQl9LCBvcHRpb25zKTsNCg0KDQoJCS8vRGVmaW5lcyB0aGUgZGVsYXkgdG8gdGFrZSBwbGFjZSBiZWZvcmUgYmVpbmcgYWJsZSB0byBzY3JvbGwgdG8gdGhlIG5leHQgc2VjdGlvbg0KCQkvL0JFIENBUkVGVUwhIE5vdCByZWNvbW1lbmVkIHRvIGNoYW5nZSBpdCB1bmRlciA0MDAgZm9yIGEgZ29vZCBiZWhhdmlvciBpbiBsYXB0b3BzIGFuZA0KCQkvL0FwcGxlIGRldmljZXMgKGxhcHRvcHMsIG1vdXNlcy4uLikNCgkJdmFyIHNjcm9sbERlbGF5ID0gNjAwOw0KDQoJCXZhciBpc1RvdWNoID0gKCgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpIHx8IChuYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyA+IDApKTsNCgkJdmFyIG51bWJlclNlY3Rpb25zID0gJCgnLm1zLWxlZnQnKS5maW5kKCcubXMtc2VjdGlvbicpLmxlbmd0aDsNCgkJdmFyIGlzTW92aW5nID0gZmFsc2U7DQoJCXZhciBuYXY7DQoJCXZhciB3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoNCg0KCQlhZGRNb3VzZVdoZWVsSGFuZGxlcigpOw0KCQlhZGRUb3VjaEhhbmRsZXIoKTsNCg0KCQkvL2lmIGNzczMgaXMgbm90IHN1cHBvcnRlZCwgaXQgd2lsbCB1c2UgalF1ZXJ5IGFuaW1hdGlvbnMNCgkJaWYob3B0aW9ucy5jc3MzKXsNCgkJCW9wdGlvbnMuY3NzMyA9IHN1cHBvcnQzZCgpOw0KCQl9DQoNCgkJJCgnaHRtbCwgYm9keScpLmNzcyh7DQoJCQknb3ZlcmZsb3cnIDogJ2hpZGRlbicsDQoJCQknaGVpZ2h0JyA6ICcxMDAlJw0KCQl9KTsNCg0KCQkvL2NyZWF0aW5nIHRoZSBuYXZpZ2F0aW9uIGRvdHMNCgkJaWYgKG9wdGlvbnMubmF2aWdhdGlvbikgew0KCQkJJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD0ibXVsdGlzY3JvbGwtbmF2Ij48dWw+PC91bD48L2Rpdj4nKTsNCgkJCW5hdiA9ICQoJyNtdWx0aXNjcm9sbC1uYXYnKTsNCg0KCQkJbmF2LmNzcygnY29sb3InLCBvcHRpb25zLm5hdmlnYXRpb25Db2xvcik7DQoJCQluYXYuYWRkQ2xhc3Mob3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24pOw0KCQl9DQoNCgkJJCgnLm1zLXJpZ2h0LCAubXMtbGVmdCcpLmNzcyh7DQoJCQknd2lkdGgnOiAnNTAlJywNCgkJCSdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQoJCQknaGVpZ2h0JzogJzEwMCUnLA0KCQkJJy1tcy10b3VjaC1hY3Rpb24nOiAnbm9uZScNCgkJfSk7DQoNCgkJJCgnLm1zLXJpZ2h0JykuY3NzKHsNCgkJCSdyaWdodCc6ICcxcHgnLCAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjM2NzU0NTcvY2hyb21lLWFuZC1vcGVyYS1jcmVhdGluZy1zbWFsbC1wYWRkaW5nLXdoZW4tdXNpbmctZGlzcGxheXRhYmxlDQoJCQkndG9wJzogJzAnLA0KCQkJJy1tcy10b3VjaC1hY3Rpb24nOiAnbm9uZScsDQoJCQkndG91Y2gtYWN0aW9uJzogJ25vbmUnDQoJCX0pOw0KDQoJCSQoJy5tcy1sZWZ0JykuY3NzKHsNCgkJCSdsZWZ0JzogJzAnLA0KCQkJJ3RvcCc6ICcwJywNCgkJCSctbXMtdG91Y2gtYWN0aW9uJzogJ25vbmUnLA0KCQkJJ3RvdWNoLWFjdGlvbic6ICdub25lJw0KCQl9KTsNCg0KDQoJCSQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLCAubXMtcmlnaHQgLm1zLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQl2YXIgc2VjdGlvbkluZGV4ID0gJCh0aGlzKS5pbmRleCgpOw0KDQoJCQlpZihvcHRpb25zLnBhZGRpbmdUb3AgfHwgb3B0aW9ucy5wYWRkaW5nQm90dG9tKXsNCgkJCQkkKHRoaXMpLmNzcygncGFkZGluZycsIG9wdGlvbnMucGFkZGluZ1RvcCAgKyAnIDAgJyArIG9wdGlvbnMucGFkZGluZ0JvdHRvbSArICcgMCcpOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIG9wdGlvbnMuc2VjdGlvbnNDb2xvcltzZWN0aW9uSW5kZXhdICE9PSAgJ3VuZGVmaW5lZCcpIHsNCgkJCQkkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIG9wdGlvbnMuc2VjdGlvbnNDb2xvcltzZWN0aW9uSW5kZXhdKTsNCgkJCX0NCg0KCQkJaWYgKHR5cGVvZiBvcHRpb25zLmFuY2hvcnNbc2VjdGlvbkluZGV4XSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkkKHRoaXMpLmF0dHIoJ2RhdGEtYW5jaG9yJywgb3B0aW9ucy5hbmNob3JzW3NlY3Rpb25JbmRleF0pOw0KCQkJfQ0KDQoJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCWFkZFRhYmxlQ2xhc3MoJCh0aGlzKSk7DQoJCQl9DQoNCgkJCS8vb25seSBmb3IgdGhlIGxlZnQgcGFuZWwNCgkJCWlmKCQodGhpcykuY2xvc2VzdCgnLm1zLWxlZnQnKS5sZW5ndGggJiYgb3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQkJdmFyIGxpbmsgPSAnJzsNCgkJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoKXsNCgkJCQkJbGluayA9IG9wdGlvbnMuYW5jaG9yc1tzZWN0aW9uSW5kZXhdOw0KCQkJCX0NCgkJCQl2YXIgdG9vbHRpcCA9IG9wdGlvbnMubmF2aWdhdGlvblRvb2x0aXBzW3NlY3Rpb25JbmRleF07DQoJCQkJaWYodHlwZW9mIHRvb2x0aXAgPT09ICd1bmRlZmluZWQnKXsNCgkJCQkJdG9vbHRpcCA9ICcnOw0KCQkJCX0NCgkJCQlpZiAob3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQkJCW5hdi5maW5kKCd1bCcpLmFwcGVuZCgnPGxpIGRhdGEtdG9vbHRpcD0iJyArIHRvb2x0aXAgKyAnIj48YSBocmVmPSIjJyArIGxpbmsgKyAnIj48c3Bhbj48L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCg0KCQkvL2ludmVydGluZyB0aGUgcmlnaHQgcGFuZWwNCgkJJCgnLm1zLXJpZ2h0JykuaHRtbCggJCgnLm1zLXJpZ2h0JykuZmluZCgnLm1zLXNlY3Rpb24nKS5nZXQoKS5yZXZlcnNlKCkpOw0KDQoJCSQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLCAubXMtcmlnaHQgLm1zLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQl2YXIgc2VjdGlvbkluZGV4ID0gJCh0aGlzKS5pbmRleCgpOw0KDQoJCQkkKHRoaXMpLmNzcyh7DQoJCQkJJ2hlaWdodCc6ICcxMDAlJw0KCQkJfSk7DQoNCg0KCQkJaWYoIXNlY3Rpb25JbmRleCAmJiBvcHRpb25zLm5hdmlnYXRpb24gKXsNCgkJCQkvL2FjdGl2YXRpbmcgdGhlIG5hdmlnYXRpb24gYnVsbGV0DQoJCQkJbmF2LmZpbmQoJ2xpJykuZXEoc2VjdGlvbkluZGV4KS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KCQl9KS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbigpew0KDQoJCQkvL2lmIG5vIGFjdGl2ZSBzZWN0aW9uIGlzIGRlZmluZWQsIHRoZSAxc3Qgb25lIHdpbGwgYmUgdGhlIGRlZmF1bHQgb25lDQoJCQlpZighJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24uYWN0aXZlJykubGVuZ3RoKXsNCgkJCQkkKCcubXMtcmlnaHQnKS5maW5kKCcubXMtc2VjdGlvbicpLmxhc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQkJJCgnLm1zLWxlZnQnKS5maW5kKCcubXMtc2VjdGlvbicpLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KDQoJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KDQoJCQkvL3Njcm9sbGluZyB0byB0aGUgZGVmaW5lZCBhY3RpdmUgc2VjdGlvbiBhbmQgYWRqdXN0aW5nIHJpZ2h0IGFuZCBsZWZ0IHBhbmVscw0KCQkJc2lsZW50U2Nyb2xsKCk7DQoNCgkJCSQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uKCkgew0KCQkJCXNjcm9sbFRvQW5jaG9yKCk7DQoJCQl9KTsNCgkJfSk7DQoNCg0KCQkvL2RldGVjdGluZyBhbnkgY2hhbmdlIG9uIHRoZSBVUkwgdG8gc2Nyb2xsIHRvIHRoZSBnaXZlbiBhbmNob3IgbGluaw0KCQkvLyhhIHdheSB0byBkZXRlY3QgYmFjayBoaXN0b3J5IGJ1dHRvbiBhcyB3ZSBwbGF5IHdpdGggdGhlIGhhc2hlcyBvbiB0aGUgVVJMKQ0KCQkkKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLGZ1bmN0aW9uKCl7DQoJCQl2YXIgdmFsdWUgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKTsNCgkJCXZhciBzZWN0aW9uQW5jaG9yID0gdmFsdWU7DQoNCgkJCWlmKHNlY3Rpb25BbmNob3IubGVuZ3RoKXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJy5tcy1sZWZ0JykuZmluZCgnW2RhdGEtYW5jaG9yPSInK3NlY3Rpb25BbmNob3IrJyJdJyk7DQoNCgkJCQl2YXIgaXNGaXJzdFNjcm9sbE1vdmUgPSAodHlwZW9mIGxhc3RTY3JvbGxlZERlc3RpbnkgPT09ICd1bmRlZmluZWQnICk7DQoNCgkJCQlpZiAoaXNGaXJzdFNjcm9sbE1vdmUgfHwgc2VjdGlvbkFuY2hvciAhPT0gbGFzdFNjcm9sbGVkRGVzdGlueSl7DQoJCQkJCXNjcm9sbFBhZ2Uoc2VjdGlvbik7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCg0KDQoJCS8qKg0KCQkgKiBTbGlkaW5nIHdpdGggYXJyb3cga2V5cywgYm90aCwgdmVydGljYWwgYW5kIGhvcml6b250YWwNCgkJICovDQoJCSQoZG9jdW1lbnQpLmtleWRvd24oZnVuY3Rpb24oZSkgew0KCQkJaWYoZS53aGljaCA9PSA0MCB8fCBlLndoaWNoID09IDM4KXsNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQl9DQoNCgkJCS8vTW92aW5nIHRoZSBtYWluIHBhZ2Ugd2l0aCB0aGUga2V5Ym9hcmQgYXJyb3dzIGlmIGtleWJvYXJkIHNjcm9sbGluZyBpcyBlbmFibGVkDQoJCQlpZiAob3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyAmJiAhaXNNb3ZpbmcpIHsNCgkJCQlzd2l0Y2ggKGUud2hpY2gpIHsNCgkJCQkJLy91cA0KCQkJCQljYXNlIDM4Og0KCQkJCQljYXNlIDMzOg0KCQkJCQkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL2Rvd24NCgkJCQkJY2FzZSA0MDoNCgkJCQkJY2FzZSAzNDoNCgkJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL0hvbWUNCgkJCQkJY2FzZSAzNjoNCgkJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVRvKDEpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9FbmQNCgkJCQkJY2FzZSAzNToNCgkJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVRvKCAkKCcubXMtbGVmdCAubXMtc2VjdGlvbicpLmxlbmd0aCApOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCXJldHVybjsgLy8gZXhpdCB0aGlzIGhhbmRsZXIgZm9yIG90aGVyIGtleXMNCgkJCQl9DQoJCQl9DQoJCX0pOw0KDQoNCgkJLyoqDQoJCSAqIERpc2FibGluZyBhbnkgYWN0aW9uIHdoZW4gcHJlc3Npbmcgb2YgdGhlIG1vdXNlIHdoZWVsIChDaHJvbWUsIElFLCBPcGVyYSwgU2FmYXJpKQ0KCQkgKi8NCgkJJChkb2N1bWVudCkubW91c2Vkb3duKGZ1bmN0aW9uKGUpIHsNCgkJCWlmKGUuYnV0dG9uID09IDEpew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCX0pOw0KDQoJCS8vbmF2aWdhdGlvbiBhY3Rpb24NCgkJJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNtdWx0aXNjcm9sbC1uYXYgYScsIGZ1bmN0aW9uKGUpew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdmFyIGluZGV4ID0gJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpOw0KCQkJc2Nyb2xsUGFnZSgkKCcubXMtbGVmdCAubXMtc2VjdGlvbicpLmVxKGluZGV4KSk7DQoJCX0pOw0KDQoJCS8vbmF2aWdhdGlvbiB0b29sdGlwcw0KCQkkKGRvY3VtZW50KS5vbih7DQoJCQltb3VzZWVudGVyOiBmdW5jdGlvbigpew0KCQkJCXZhciB0b29sdGlwID0gJCh0aGlzKS5kYXRhKCd0b29sdGlwJyk7DQoJCQkJJCgnPGRpdiBjbGFzcz0ibXVsdGlzY3JvbGwtdG9vbHRpcCAnICsgb3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24gKyciPicgKyB0b29sdGlwICsgJzwvZGl2PicpLmhpZGUoKS5hcHBlbmRUbygkKHRoaXMpKS5mYWRlSW4oMjAwKTsNCgkJCX0sDQoJCQltb3VzZWxlYXZlOiBmdW5jdGlvbigpew0KCQkJCSQodGhpcykuZmluZCgnLm11bHRpc2Nyb2xsLXRvb2x0aXAnKS5mYWRlT3V0KDIwMCwgZnVuY3Rpb24oKSB7DQoJCQkJCSQodGhpcykucmVtb3ZlKCk7DQoJCQkJfSk7DQoJCQl9DQoJCX0sICcjbXVsdGlzY3JvbGwtbmF2IGxpJyk7DQoNCg0KCQlpZihvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzKXsNCgkJCSQoZG9jdW1lbnQpLm9uKCdtb3VzZWVudGVyJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24gKCkgew0KCQkJCSQuZm4ubXVsdGlzY3JvbGwuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQoJCQl9KTsNCg0KCQkJJChkb2N1bWVudCkub24oJ21vdXNlbGVhdmUnLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbigpew0KCQkJCSQuZm4ubXVsdGlzY3JvbGwuc2V0TW91c2VXaGVlbFNjcm9sbGluZyh0cnVlKTsNCgkJCX0pOw0KCQl9DQoNCg0KCQkvL3doZW4gcmVzaXppbmcgdGhlIHNpdGUsIHdlIGFkanVzdCB0aGUgaGVpZ2h0cyBvZiB0aGUgc2VjdGlvbnMNCgkJJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHsNCgkJCWRvbmVSZXNpemluZygpOw0KCQl9KTsNCg0KCQkvKioNCgkJICogV2hlbiByZXNpemluZyBpcyBmaW5pc2hlZCwgd2UgYWRqdXN0IHRoZSBzbGlkZXMgc2l6ZXMgYW5kIHBvc2l0aW9ucw0KCQkgKi8NCgkJZnVuY3Rpb24gZG9uZVJlc2l6aW5nKCkgew0KCQkJd2luZG93SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpOw0KCQkJJCgnLm1zLXRhYmxlQ2VsbCcpLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJJCh0aGlzKS5jc3MoeyBoZWlnaHQ6IGdldFRhYmxlSGVpZ2h0KCQodGhpcykucGFyZW50KCkpIH0pOw0KCQkJfSk7DQoJCQlzaWxlbnRTY3JvbGwoKTsNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlc2l6ZSApICYmIG9wdGlvbnMuYWZ0ZXJSZXNpemUuY2FsbCggdGhpcyk7DQoJCX0NCg0KCQlmdW5jdGlvbiBzaWxlbnRTY3JvbGwoKXsNCgkJCS8vbW92aW5nIHRoZSByaWdodCBzZWN0aW9uIHRvIHRoZSBib3R0b20NCgkJCWlmKG9wdGlvbnMuY3NzMyl7DQoJCQkJdHJhbnNmb3JtQ29udGFpbmVyKCQoJy5tcy1sZWZ0JyksICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgJCgnLm1zLWxlZnQnKS5maW5kKCcubXMtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCArICdweCwgMHB4KScsIGZhbHNlKTsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIoJCgnLm1zLXJpZ2h0JyksICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgJCgnLm1zLXJpZ2h0JykuZmluZCgnLm1zLXNlY3Rpb24uYWN0aXZlJykucG9zaXRpb24oKS50b3AgKyAncHgsIDBweCknLCBmYWxzZSk7DQoJCQl9ZWxzZXsNCgkJCQkkKCcubXMtbGVmdCcpLmNzcygndG9wJywgLSQoJy5tcy1sZWZ0JykuZmluZCgnLm1zLXNlY3Rpb24uYWN0aXZlJykucG9zaXRpb24oKS50b3AgKTsNCgkJCQkkKCcubXMtcmlnaHQnKS5jc3MoJ3RvcCcsIC0kKCcubXMtcmlnaHQnKS5maW5kKCcubXMtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCApOw0KCQkJfQ0KCQl9DQoNCgkJJC5mbi5tdWx0aXNjcm9sbC5tb3ZlU2VjdGlvblVwID0gZnVuY3Rpb24oKXsNCgkJCXZhciBwcmV2ID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24uYWN0aXZlJykucHJldignLm1zLXNlY3Rpb24nKTsNCg0KCQkJaWYoIXByZXYubGVuZ3RoICYmIG9wdGlvbnMubG9vcFRvcCl7DQoJCQkJcHJldiA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uJykubGFzdCgpOw0KCQkJfQ0KDQoJCQlpZiAocHJldi5sZW5ndGgpIHsNCgkJCQlzY3JvbGxQYWdlKHByZXYpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25Eb3duID0gZnVuY3Rpb24gKCl7DQoJCQl2YXIgbmV4dCA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uLmFjdGl2ZScpLm5leHQoJy5tcy1zZWN0aW9uJyk7DQoNCgkJCWlmKCFuZXh0Lmxlbmd0aCAmJiBvcHRpb25zLmxvb3BCb3R0b20gKXsNCgkJCQluZXh0ID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24nKS5maXJzdCgpOw0KCQkJfQ0KDQoJCQlpZihuZXh0Lmxlbmd0aCl7DQoJCQkJc2Nyb2xsUGFnZShuZXh0KTsNCgkJCX0NCgkJfTsNCg0KCQkkLmZuLm11bHRpc2Nyb2xsLm1vdmVUbyA9IGZ1bmN0aW9uIChzZWN0aW9uKXsNCgkJCXZhciBkZXN0aW55ID0gJyc7DQoNCgkJCWlmKGlzTmFOKHNlY3Rpb24pKXsNCgkJCQlkZXN0aW55ID0gJCgnLm1zLWxlZnQgW2RhdGEtYW5jaG9yPSInK3NlY3Rpb24rJyJdJyk7DQoJCQl9ZWxzZXsNCgkJCQlkZXN0aW55ID0gJCgnLm1zLWxlZnQgLm1zLXNlY3Rpb24nKS5lcSggKHNlY3Rpb24gLTEpICk7DQoJCQl9DQoNCgkJCXNjcm9sbFBhZ2UoZGVzdGlueSk7DQoJCX07DQoNCgkJZnVuY3Rpb24gc2Nyb2xsUGFnZShsZWZ0RGVzdGluYXRpb24pew0KCQkJdmFyIGxlZnREZXN0aW5hdGlvbkluZGV4ID0gbGVmdERlc3RpbmF0aW9uLmluZGV4KCk7DQoJCQl2YXIgcmlnaHREZXN0aW5hdGlvbiA9ICQoJy5tcy1yaWdodCcpLmZpbmQoJy5tcy1zZWN0aW9uJykuZXEoIG51bWJlclNlY3Rpb25zIC0xIC0gbGVmdERlc3RpbmF0aW9uSW5kZXgpOw0KCQkJdmFyIHJpZ2h0RGVzdGluYXRpb25JbmRleCA9IG51bWJlclNlY3Rpb25zIC0gMSAtIGxlZnREZXN0aW5hdGlvbkluZGV4Ow0KCQkJdmFyIGFuY2hvckxpbmsgID0gbGVmdERlc3RpbmF0aW9uLmRhdGEoJ2FuY2hvcicpOw0KCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbi5hY3RpdmUnKTsNCgkJCXZhciBsZWF2aW5nU2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24uaW5kZXgoKSArIDE7DQoJCQl2YXIgeU1vdmVtZW50ID0gZ2V0WW1vdmVtZW50KGxlZnREZXN0aW5hdGlvbik7DQoNCgkJCS8vcHJldmVudGluZyBmcm9tIGFjdGl2YXRpbmcgdGhlIE1vdXNlV2hlZWxIYW5kbGVyIGV2ZW50DQoJCQkvL21vcmUgdGhhbiBvbmNlIGlmIHRoZSBwYWdlIGlzIHNjcm9sbGluZw0KCQkJaXNNb3ZpbmcgPSB0cnVlOw0KDQoJCQlzZXRVUkxIYXNoKGFuY2hvckxpbmspOw0KDQoJCQl2YXIgdG9wUG9zID0gew0KCQkJCSdsZWZ0JyA6IGxlZnREZXN0aW5hdGlvbi5wb3NpdGlvbigpLnRvcCwNCgkJCQkncmlnaHQnOiByaWdodERlc3RpbmF0aW9uLnBvc2l0aW9uKCkudG9wDQoJCQl9Ow0KDQoJCQlyaWdodERlc3RpbmF0aW9uLmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCWxlZnREZXN0aW5hdGlvbi5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCgkJCS8vIFVzZSBDU1MzIHRyYW5zbGF0ZSBmdW5jdGlvbmFsaXR5IG9yLi4uDQoJCQlpZiAob3B0aW9ucy5jc3MzKXsNCgkJCQkvL2NhbGxiYWNrIChvbkxlYXZlKQ0KCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKHRoaXMsIGxlYXZpbmdTZWN0aW9uLCAobGVmdERlc3RpbmF0aW9uSW5kZXggKyAxKSwgeU1vdmVtZW50KTsNCg0KCQkJCXZhciB0cmFuc2xhdGUzZExlZnQgPSAndHJhbnNsYXRlM2QoMHB4LCAtJyArIHRvcFBvc1snbGVmdCddICsgJ3B4LCAwcHgpJzsNCgkJCQl2YXIgdHJhbnNsYXRlM2RSaWdodCA9ICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgdG9wUG9zWydyaWdodCddICsgJ3B4LCAwcHgpJzsNCg0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcigkKCcubXMtbGVmdCcpLCB0cmFuc2xhdGUzZExlZnQsIHRydWUpOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcigkKCcubXMtcmlnaHQnKSwgdHJhbnNsYXRlM2RSaWdodCwgdHJ1ZSk7DQoNCgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJLy9jYWxsYmFjayAoYWZ0ZXJMb2FkKQ0KCQkJCQkkLmlzRnVuY3Rpb24ob3B0aW9ucy5hZnRlckxvYWQpICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwodGhpcywgYW5jaG9yTGluaywgKGxlZnREZXN0aW5hdGlvbkluZGV4ICsgMSkpOw0KDQoJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQkJaXNNb3ZpbmcgPSBmYWxzZTsNCgkJCQkJfSwgc2Nyb2xsRGVsYXkpOw0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQpOw0KCQkJfWVsc2V7DQoJCQkJLy9jYWxsYmFjayAob25MZWF2ZSkNCgkJCQkkLmlzRnVuY3Rpb24ob3B0aW9ucy5vbkxlYXZlKSAmJiBvcHRpb25zLm9uTGVhdmUuY2FsbCh0aGlzLCBsZWF2aW5nU2VjdGlvbiwgKGxlZnREZXN0aW5hdGlvbkluZGV4ICsgMSksIHlNb3ZlbWVudCk7DQoNCgkJCQkkKCcubXMtbGVmdCcpLmFuaW1hdGUoew0KCQkJCQkndG9wJzogLXRvcFBvc1snbGVmdCddDQoJCQkJfSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCwgb3B0aW9ucy5lYXNpbmcsIGZ1bmN0aW9uKCl7DQoJCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLmFmdGVyTG9hZCkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCh0aGlzLCBhbmNob3JMaW5rLCAobGVmdERlc3RpbmF0aW9uSW5kZXggKyAxKSk7DQoNCgkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCQlpc01vdmluZyA9IGZhbHNlOw0KCQkJCQl9LCBzY3JvbGxEZWxheSk7DQoJCQkJfSk7DQoNCgkJCQkkKCcubXMtcmlnaHQnKS5hbmltYXRlKHsNCgkJCQkJJ3RvcCc6IC10b3BQb3NbJ3JpZ2h0J10NCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZyk7DQoJCQl9DQoNCgkJCS8vZmxhZyB0byBhdm9pZCBjYWxsaW5nbiBgc2Nyb2xsUGFnZSgpYCB0d2ljZSBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvciBsaW5rcw0KCQkJbGFzdFNjcm9sbGVkRGVzdGlueSA9IGFuY2hvckxpbms7DQoNCgkJCWFjdGl2YXRlTWVudUVsZW1lbnQoYW5jaG9yTGluayk7DQoJCQlhY3RpdmF0ZU5hdkRvdHMoYW5jaG9yTGluaywgbGVmdERlc3RpbmF0aW9uSW5kZXgpOw0KCQl9DQoNCgkJLyoqDQoJCSogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZpcmVkIGJ5IHRoZSBtb3VzZSB3aGVlbCBhbmQgdGFja3BhZC4NCgkJKiBBZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIG1vdXNld2hlZWwgYW5kIHRyYWNrcGFkIG1vdmVtZW50cyB3b24ndCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucy4NCgkJKi8NCgkJZnVuY3Rpb24gcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKXsNCgkJCWlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vSUU5LCBDaHJvbWUsIFNhZmFyaSwgT3Blcg0KCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3doZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQoJCQl9IGVsc2Ugew0KCQkJCWRvY3VtZW50LmRldGFjaEV2ZW50KCJvbm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlcik7IC8vSUUgNi83LzgNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIEFkZHMgdGhlIGF1dG8gc2Nyb2xsaW5nIGFjdGlvbiBmb3IgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KCQkqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdpbGwgc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMNCgkJKi8NCgkJZnVuY3Rpb24gYWRkTW91c2VXaGVlbEhhbmRsZXIoKXsNCgkJCWlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vSUU5LCBDaHJvbWUsIFNhZmFyaSwgT3Blcg0KCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQoJCQl9IGVsc2Ugew0KCQkJCWRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlcik7IC8vSUUgNi83LzgNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBEZXRlY3RpbmcgbW91c2V3aGVlbCBzY3JvbGxpbmcNCgkJICoNCgkJICogaHR0cDovL2Jsb2dzLnNpdGVwb2ludHN0YXRpYy5jb20vZXhhbXBsZXMvdGVjaC9tb3VzZS13aGVlbC9pbmRleC5odG1sDQoJCSAqIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9odG1sNS1qYXZhc2NyaXB0LW1vdXNlLXdoZWVsLw0KCQkgKi8NCgkJZnVuY3Rpb24gTW91c2VXaGVlbEhhbmRsZXIoZSkgew0KCQkJLy8gY3Jvc3MtYnJvd3NlciB3aGVlbCBkZWx0YQ0KCQkJZSA9IHdpbmRvdy5ldmVudCB8fCBlOw0KCQkJdmFyIGRlbHRhID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsDQoJCQkJCShlLndoZWVsRGVsdGEgfHwgLWUuZGVsdGFZIHx8IC1lLmRldGFpbCkpKTsNCg0KCQkJaWYgKCFpc01vdmluZykgeyAvL2lmIHRoZXJlcyBhbnkgIw0KDQoJCQkJLy9zY3JvbGxpbmcgZG93bj8NCgkJCQlpZiAoZGVsdGEgPCAwKSB7DQoJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJfQ0KDQoJCQkJLy9zY3JvbGxpbmcgdXA/DQoJCQkJZWxzZSB7DQoJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25VcCgpOw0KCQkJCX0NCgkJCX0NCg0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQkvKioNCgkJKiBBZGRzIGEgY3NzMyB0cmFuc2Zvcm0gcHJvcGVydHkgdG8gdGhlIGNvbnRhaW5lciBjbGFzcyB3aXRoIG9yIHdpdGhvdXQgYW5pbWF0aW9uIGRlcGVuZGluZyBvbiB0aGUgYW5pbWF0ZWQgcGFyYW0uDQoJCSovDQoJCWZ1bmN0aW9uIHRyYW5zZm9ybUNvbnRhaW5lcihjb250YWluZXIsIHRyYW5zbGF0ZTNkLCBhbmltYXRlZCl7DQoJCQljb250YWluZXIudG9nZ2xlQ2xhc3MoJ21zLWVhc2luZycsIGFuaW1hdGVkKTsNCg0KCQkJY29udGFpbmVyLmNzcyhnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKSk7DQoJCX0NCg0KDQoJCS8qKg0KCQkqIFJldHVybnMgdGhlIHRyYW5zZm9ybSBzdHlsZXMgZm9yIGFsbCBicm93c2Vycw0KCQkqLw0KCQlmdW5jdGlvbiBnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKXsNCgkJCXJldHVybiB7DQoJCQkJJy13ZWJraXQtdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tb3otdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tcy10cmFuc2Zvcm0nOnRyYW5zbGF0ZTNkLA0KCQkJCSd0cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZA0KCQkJfTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBBY3RpdmF0aW5nIHRoZSB3ZWJzaXRlIG5hdmlnYXRpb24gZG90cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHNsaWRlIG5hbWUuDQoJCSAqLw0KCQlmdW5jdGlvbiBhY3RpdmF0ZU5hdkRvdHMobmFtZSwgc2VjdGlvbkluZGV4KXsNCgkJCWlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQoJCQkJJCgnI211bHRpc2Nyb2xsLW5hdicpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJaWYobmFtZSl7DQoJCQkJCSQoJyNtdWx0aXNjcm9sbC1uYXYnKS5maW5kKCdhW2hyZWY9IiMnICsgbmFtZSArICciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9ZWxzZXsNCgkJCQkJJCgnI211bHRpc2Nyb2xsLW5hdicpLmZpbmQoJ2xpJykuZXEoc2VjdGlvbkluZGV4KS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBBY3RpdmF0aW5nIHRoZSB3ZWJzaXRlIG1haW4gbWVudSBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHNsaWRlIG5hbWUuDQoJCSAqLw0KCQlmdW5jdGlvbiBhY3RpdmF0ZU1lbnVFbGVtZW50KG5hbWUpew0KCQkJaWYob3B0aW9ucy5tZW51KXsNCgkJCQkkKG9wdGlvbnMubWVudSkuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQkkKG9wdGlvbnMubWVudSkuZmluZCgnW2RhdGEtbWVudWFuY2hvcj0iJytuYW1lKyciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIFJldHVucyBgdXBgIG9yIGBkb3duYCBkZXBlbmRpbmcgb24gdGhlIHNjcm9sbGluZyBtb3ZlbWVudCB0byByZWFjaCBpdHMgZGVzdGluYXRpb24NCgkJKiBmcm9tIHRoZSBjdXJyZW50IHNlY3Rpb24uDQoJCSovDQoJCWZ1bmN0aW9uIGdldFltb3ZlbWVudChkZXN0aW55KXsNCgkJCXZhciBmcm9tSW5kZXggPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgpOw0KCQkJdmFyIHRvSW5kZXggPSBkZXN0aW55LmluZGV4KCk7DQoNCgkJCWlmKGZyb21JbmRleCA+IHRvSW5kZXgpew0KCQkJCXJldHVybiAndXAnOw0KCQkJfQ0KCQkJcmV0dXJuICdkb3duJzsNCgkJfQ0KDQoNCgkJLyoqDQoJCSogU2V0cyB0aGUgVVJMIGhhc2ggZm9yIGEgc2VjdGlvbiB3aXRoIHNsaWRlcw0KCQkqLw0KCQlmdW5jdGlvbiBzZXRVUkxIYXNoKGFuY2hvckxpbmspew0KCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQoJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQl9DQoNCgkJfQ0KDQoNCgkJLyoqDQoJCSogQ2hlY2tzIGZvciB0cmFuc2xhdGUzZCBzdXBwb3J0DQoJCSogQHJldHVybiBib29sZWFuDQoJCSogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81NjYxNjcxL2RldGVjdGluZy10cmFuc2Zvcm0tdHJhbnNsYXRlM2Qtc3VwcG9ydA0KCQkqLw0KCQlmdW5jdGlvbiBzdXBwb3J0M2QoKSB7DQoJCQl2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyksDQoJCQkJaGFzM2QsDQoJCQkJdHJhbnNmb3JtcyA9IHsNCgkJCQkJJ3dlYmtpdFRyYW5zZm9ybSc6Jy13ZWJraXQtdHJhbnNmb3JtJywNCgkJCQkJJ09UcmFuc2Zvcm0nOictby10cmFuc2Zvcm0nLA0KCQkJCQknbXNUcmFuc2Zvcm0nOictbXMtdHJhbnNmb3JtJywNCgkJCQkJJ01velRyYW5zZm9ybSc6Jy1tb3otdHJhbnNmb3JtJywNCgkJCQkJJ3RyYW5zZm9ybSc6J3RyYW5zZm9ybScNCgkJCQl9Ow0KDQoJCQkvLyBBZGQgaXQgdG8gdGhlIGJvZHkgdG8gZ2V0IHRoZSBjb21wdXRlZCBzdHlsZS4NCgkJCWRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGVsLCBudWxsKTsNCg0KCQkJZm9yICh2YXIgdCBpbiB0cmFuc2Zvcm1zKSB7DQoJCQkJaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJZWwuc3R5bGVbdF0gPSAidHJhbnNsYXRlM2QoMXB4LDFweCwxcHgpIjsNCgkJCQkJaGFzM2QgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSh0cmFuc2Zvcm1zW3RdKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOw0KDQoJCQlyZXR1cm4gKGhhczNkICE9PSB1bmRlZmluZWQgJiYgaGFzM2QubGVuZ3RoID4gMCAmJiBoYXMzZCAhPT0gIm5vbmUiKTsNCgkJfQ0KDQoJCS8qKg0KCQkqIFdyYXBzIGFuIGVsZW1lbnQgaW4gb3JkZXIgdG8gY2VudGVyIGl0IHZlcnRpY2FsbHkgYnkgdXNpbmcgYSBjbGFzcyBzdHlsZS4NCgkJKi8NCgkJZnVuY3Rpb24gYWRkVGFibGVDbGFzcyhlbGVtZW50KXsNCgkJCWVsZW1lbnQuYWRkQ2xhc3MoJ21zLXRhYmxlJykud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJtcy10YWJsZUNlbGwiIHN0eWxlPSJoZWlnaHQ6ICcgKyBnZXRUYWJsZUhlaWdodChlbGVtZW50KSArICdweCIgLz4nKTsNCgkJfQ0KDQoJCS8qKg0KCQkqIEdldHMgdGhlIGhlaWdodCBvZiB0aGUgc2VjdGlvbiBhZnRlciByZW1vdmluZyB0aGUgcGFkZGluZ3MuDQoJCSovDQoJCWZ1bmN0aW9uIGdldFRhYmxlSGVpZ2h0KHNlY3Rpb24pew0KCQkJdmFyIHNlY3Rpb25IZWlnaHQgPSB3aW5kb3dIZWlnaHQ7DQoNCgkJCWlmKG9wdGlvbnMucGFkZGluZ1RvcCB8fCBvcHRpb25zLnBhZGRpbmdCb3R0b20pew0KCQkJCXZhciBwYWRkaW5ncyA9IHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLXRvcCcpKSArIHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLWJvdHRvbScpKTsNCgkJCQlzZWN0aW9uSGVpZ2h0ID0gKHdpbmRvd0hlaWdodCAtIHBhZGRpbmdzKTsNCgkJCX0NCg0KCQkJcmV0dXJuIHNlY3Rpb25IZWlnaHQ7DQoJCX0NCg0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdGhlIHBhZ2UgdG8gdGhlIGV4aXN0ZW50IGFuY2hvciBpbiB0aGUgVVJMDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbFRvQW5jaG9yKCl7DQoJCQkvL2dldHRpbmcgdGhlIGFuY2hvciBsaW5rIGluIHRoZSBVUkwgYW5kIGRlbGV0aW5nIHRoZSBgI2ANCgkJCXZhciBzZWN0aW9uQW5jaG9yID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJyk7DQoJCQl2YXIgc2VjdGlvbiA9ICQoJy5tcy1sZWZ0IC5tcy1zZWN0aW9uW2RhdGEtYW5jaG9yPSInK3NlY3Rpb25BbmNob3IrJyJdJyk7DQoNCgkJCWlmKHNlY3Rpb25BbmNob3IubGVuZ3RoKXsgIC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJc2Nyb2xsUGFnZShzZWN0aW9uKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBrZXlib2FyZCBhcnJvdyBrZXlzDQoJCSovDQoJCSQuZm4ubXVsdGlzY3JvbGwuc2V0S2V5Ym9hcmRTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KCQkJb3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyA9IHZhbHVlOw0KCQl9Ow0KDQoJCS8qKg0KCQkqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBtb3VzZSB3aGVlbCBvciB0aGUgdHJhY2twYWQuDQoJCSovDQoJCSQuZm4ubXVsdGlzY3JvbGwuc2V0TW91c2VXaGVlbFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlpZih2YWx1ZSl7DQoJCQkJYWRkTW91c2VXaGVlbEhhbmRsZXIoKTsNCgkJCX1lbHNlew0KCQkJCXJlbW92ZU1vdXNlV2hlZWxIYW5kbGVyKCk7DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSogRGVmaW5lcyB0aGUgc2Nyb2xsaW5nIHNwZWVkDQoJCSovDQoJCSQuZm4ubXVsdGlzY3JvbGwuc2V0U2Nyb2xsaW5nU3BlZWQgPSBmdW5jdGlvbih2YWx1ZSl7DQoJCSAgIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQgPSB2YWx1ZTsNCgkJfTsNCg0KDQoNCgkJdmFyIHRvdWNoU3RhcnRZID0gMDsNCgkJdmFyIHRvdWNoU3RhcnRYID0gMDsNCgkJdmFyIHRvdWNoRW5kWSA9IDA7DQoJCXZhciB0b3VjaEVuZFggPSAwOw0KDQoJCS8qIERldGVjdGluZyB0b3VjaCBldmVudHMNCg0KCQkqIEFzIHdlIGFyZSBjaGFuZ2luZyB0aGUgdG9wIHByb3BlcnR5IG9mIHRoZSBwYWdlIG9uIHNjcm9sbGluZywgd2UgY2FuIG5vdCB1c2UgdGhlIHRyYWRpdGlvbmFsIHdheSB0byBkZXRlY3QgaXQuDQoJCSogVGhpcyB3YXksIHRoZSB0b3VjaHN0YXJ0IGFuZCB0aGUgdG91Y2ggbW92ZXMgc2hvd3MgYW4gc21hbGwgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZW0gd2hpY2ggaXMgdGhlDQoJCSogdXNlZCBvbmUgdG8gZGV0ZXJtaW5lIHRoZSBkaXJlY3Rpb24uDQoJCSovDQoJCWZ1bmN0aW9uIHRvdWNoTW92ZUhhbmRsZXIoZXZlbnQpew0KCQkJdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KDQoJCQkvL3ByZXZlbnRpbmcgdGhlIGVhc2luZyBvbiBpT1MgZGV2aWNlcw0KCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCg0KCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcubXMtbGVmdCAubXMtc2VjdGlvbi5hY3RpdmUnKTsNCg0KCQkJaWYgKCFpc01vdmluZykgeyAvL2lmIHRoZXJlcyBhbnkgIw0KCQkJCXZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQoJCQkJdG91Y2hFbmRZID0gdG91Y2hFdmVudHNbJ3knXTsNCgkJCQl0b3VjaEVuZFggPSB0b3VjaEV2ZW50c1sneCddOw0KDQoNCgkJCQkvL2lzIHRoZSBtb3ZlbWVudCBncmVhdGVyIHRoYW4gdGhlIG1pbmltdW0gcmVzaXN0YW5jZSB0byBzY3JvbGw/DQoJCQkJaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSA+ICgkKHdpbmRvdykuaGVpZ2h0KCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQoNCgkJCQkJaWYgKHRvdWNoU3RhcnRZID4gdG91Y2hFbmRZKSB7DQoJCQkJCQkkLmZuLm11bHRpc2Nyb2xsLm1vdmVTZWN0aW9uRG93bigpOw0KDQoJCQkJCX0gZWxzZSBpZiAodG91Y2hFbmRZID4gdG91Y2hTdGFydFkpIHsNCgkJCQkJCSQuZm4ubXVsdGlzY3JvbGwubW92ZVNlY3Rpb25VcCgpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJKiBIYW5kbGVyIHRvIGdldCBoZSBjb29yZGluYXRlcyBvZiB0aGUgc3RhcnRpbmcgdG91Y2gNCgkJKi8NCgkJZnVuY3Rpb24gdG91Y2hTdGFydEhhbmRsZXIoZXZlbnQpew0KCQkJdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KCQkJdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCgkJCXRvdWNoU3RhcnRZID0gdG91Y2hFdmVudHNbJ3knXTsNCgkJCXRvdWNoU3RhcnRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCgkJfQ0KDQoNCgkJLyoqDQoJCSogQWRkcyB0aGUgcG9zc2liaWxpdHkgdG8gYXV0byBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucyBvbiB0b3VjaCBkZXZpY2VzLg0KCQkqLw0KCQlmdW5jdGlvbiBhZGRUb3VjaEhhbmRsZXIoKXsNCgkJCWlmKGlzVG91Y2gpew0KCQkJCS8vTWljcm9zb2Z0IHBvaW50ZXJzDQoJCQkJTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNoc3RhcnQgJyArICBNU1BvaW50ZXIuZG93bikub24oJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duLCB0b3VjaFN0YXJ0SGFuZGxlcik7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlKS5vbigndG91Y2htb3ZlICcgKyBNU1BvaW50ZXIubW92ZSwgdG91Y2hNb3ZlSGFuZGxlcik7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBSZW1vdmVzIHRoZSBhdXRvIHNjcm9sbGluZyBmb3IgdG91Y2ggZGV2aWNlcy4NCgkJKi8NCgkJZnVuY3Rpb24gcmVtb3ZlVG91Y2hIYW5kbGVyKCl7DQoJCQlpZihpc1RvdWNoKXsNCgkJCQkvL01pY3Jvc29mdCBwb2ludGVycw0KCQkJCU1TUG9pbnRlciA9IGdldE1TUG9pbnRlcigpOw0KDQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaHN0YXJ0ICcgKyBNU1BvaW50ZXIuZG93bik7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlKTsNCgkJCX0NCgkJfQ0KDQoJCS8qDQoJCSogUmV0dXJucyBhbmQgb2JqZWN0IHdpdGggTWljcm9zb2Z0IHBvaW50ZXJzIChmb3IgSUU8MTEgYW5kIGZvciBJRSA+PSAxMSkNCgkJKiBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvZG4zMDQ4ODYodj12cy44NSkuYXNweA0KCQkqLw0KCQlmdW5jdGlvbiBnZXRNU1BvaW50ZXIoKXsNCgkJCXZhciBwb2ludGVyOw0KDQoJCQkvL0lFID49IDExDQoJCQlpZih3aW5kb3cuUG9pbnRlckV2ZW50KXsNCgkJCQlwb2ludGVyID0geyBkb3duOiAicG9pbnRlcmRvd24iLCBtb3ZlOiAicG9pbnRlcm1vdmUifTsNCgkJCX0NCg0KCQkJLy9JRSA8IDExDQoJCQllbHNlew0KCQkJCXBvaW50ZXIgPSB7IGRvd246ICJNU1BvaW50ZXJEb3duIiwgbW92ZTogIk1TUG9pbnRlck1vdmUifTsNCgkJCX0NCg0KCQkJcmV0dXJuIHBvaW50ZXI7DQoJCX0NCg0KCQkvKioNCgkJKiBHZXRzIHRoZSBwYWdlWCBhbmQgcGFnZVkgcHJvcGVydGllcyBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXIuDQoJCSogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzL2lzc3Vlcy8xOTQjaXNzdWVjb21tZW50LTM0MDY5ODU0DQoJCSovDQoJCWZ1bmN0aW9uIGdldEV2ZW50c1BhZ2UoZSl7DQoJCQl2YXIgZXZlbnRzID0gbmV3IEFycmF5KCk7DQoJCQlpZiAod2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKXsNCgkJCQlldmVudHNbJ3knXSA9IGUucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSBlLnBhZ2VYOw0KCQkJfWVsc2V7DQoJCQkJZXZlbnRzWyd5J10gPSBlLnRvdWNoZXNbMF0ucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSAgZS50b3VjaGVzWzBdLnBhZ2VYOw0KCQkJfQ0KDQoJCQlyZXR1cm4gZXZlbnRzOw0KCQl9DQoNCgl9Ow0KfSkoalF1ZXJ5KTsNCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 18:32:20 GMT",
                    "Content-Length": "20809",
                    "Date": "Fri, 07 Nov 2014 18:32:20 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}