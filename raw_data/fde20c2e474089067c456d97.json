{
    "url": "http://localhost:9999/malihu/page-scroll-to-id/jquery.malihu.PageScroll2id.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location</b> and written to <b>$()</b> via the following statement:<ul><li>$(\"._\" + pluginPfx+ \"-h[href='...\" + loc+ \"#\" + id+ \"']\" ) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/malihu/page-scroll-to-id/jquery.malihu.PageScroll2id.js",
                "path": "/malihu/page-scroll-to-id/jquery.malihu.PageScroll2id.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9tYWxpaHUvcGFnZS1zY3JvbGwtdG8taWQvanF1ZXJ5Lm1hbGlodS5QYWdlU2Nyb2xsMmlkLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjU2NzANCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6MzY6MTAgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjM2OjEwIEdNVA0KDQovKgo9PSBQYWdlIHNjcm9sbCB0byBpZCA9PSAKVmVyc2lvbjogMS41LjQgClBsdWdpbiBVUkk6IGh0dHA6Ly9tYW5vcy5tYWxpaHUuZ3IvcGFnZS1zY3JvbGwtdG8taWQvCkF1dGhvcjogbWFsaWh1CkF1dGhvciBVUkk6IGh0dHA6Ly9tYW5vcy5tYWxpaHUuZ3IKTGljZW5zZTogTUlUIExpY2Vuc2UgKE1JVCkKKi8KCi8qCkNvcHlyaWdodCAyMDEzICBtYWxpaHUgIChlbWFpbDogbWFub3NAbWFsaWh1LmdyKQoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCjsoZnVuY3Rpb24oJCx3aW5kb3csZG9jdW1lbnQsdW5kZWZpbmVkKXsKCQoJLyogcGx1Z2luIG5hbWVzcGFjZSwgcHJlZml4LCBkZWZhdWx0IHNlbGVjdG9yKHMpICovCgkKCXZhciBwbHVnaW5OUz0ibVBhZ2VTY3JvbGwyaWQiLAoJCXBsdWdpblBmeD0ibVBTMmlkIiwKCQlkZWZhdWx0U2VsZWN0b3I9Ii5tX1BhZ2VTY3JvbGwyaWQsYVtyZWx+PSdtX1BhZ2VTY3JvbGwyaWQnXSwucGFnZS1zY3JvbGwtdG8taWQsYVtyZWx+PSdwYWdlLXNjcm9sbC10by1pZCddLC5fcHMyaWQiLAoJCgkvKiBkZWZhdWx0IG9wdGlvbnMgKi8KCQoJCWRlZmF1bHRzPXsKCQkJLyogc2Nyb2xsIGFuaW1hdGlvbiBzcGVlZCBpbiBtaWxsaXNlY29uZHM6IEludGVnZXIgKi8KCQkJc2Nyb2xsU3BlZWQ6MTMwMCwKCQkJLyogYXV0by1hZGp1c3QgYW5pbWF0aW9uIHNwZWVkIChhY2NvcmRpbmcgdG8gdGFyZ2V0IGVsZW1lbnQgcG9zaXRpb24gYW5kIHdpbmRvdyBzY3JvbGwpOiBCb29sZWFuICovCgkJCWF1dG9TY3JvbGxTcGVlZDp0cnVlLAoJCQkvKiBzY3JvbGwgYW5pbWF0aW9uIGVhc2luZyB3aGVuIHBhZ2UgaXMgaWRsZTogU3RyaW5nICovCgkJCXNjcm9sbEVhc2luZzoiZWFzZUluT3V0RXhwbyIsCgkJCS8qIHNjcm9sbCBhbmltYXRpb24gZWFzaW5nIHdoaWxlIHBhZ2UgaXMgc2Nyb2xsaW5nOiBTdHJpbmcgKi8KCQkJc2Nyb2xsaW5nRWFzaW5nOiJlYXNlSW5PdXRDaXJjIiwKCQkJLyogZW5kIG9mIHBhZ2UgInNtb290aCBzY3JvbGxpbmciIChhdXRvLWFkanVzdCB0aGUgc2Nyb2xsLXRvIHBvc2l0aW9uIHdoZW4gYm90dG9tIGVsZW1lbnRzIGFyZSB0b28gc2hvcnQpOiBCb29sZWFuICovCgkJCXBhZ2VFbmRTbW9vdGhTY3JvbGw6dHJ1ZSwKCQkJLyogCgkJCXBhZ2UgbGF5b3V0IGRlZmluZXMgc2Nyb2xsaW5nIGRpcmVjdGlvbjogU3RyaW5nIAoJCQl2YWx1ZXM6ICJ2ZXJ0aWNhbCIsICJob3Jpem9udGFsIiwgImF1dG8iIAoJCQkqLwoJCQlsYXlvdXQ6InZlcnRpY2FsIiwKCQkJLyogZXh0cmEgc3BhY2UgaW4gcGl4ZWxzIGZvciB0aGUgdGFyZ2V0IGVsZW1lbnQgcG9zaXRpb246IEludGVnZXIgKi8KCQkJb2Zmc2V0OjAsCgkJCS8qIGhpZ2hsaWdodCB0aGUgbWFpbi9kZWZhdWx0IHNlbGVjdG9ycyBvciBpbnNlcnQgYSBkaWZmZXJlbnQgc2V0OiBCb29sZWFuLCBTdHJpbmcgKi8KCQkJaGlnaGxpZ2h0U2VsZWN0b3I6ZmFsc2UsCgkJCS8qIGNsYXNzIG9mIHRoZSBjbGlja2VkIGVsZW1lbnQ6IFN0cmluZyAqLwoJCQljbGlja2VkQ2xhc3M6cGx1Z2luUGZ4KyItY2xpY2tlZCIsCgkJCS8qIGNsYXNzIG9mIHRoZSBjdXJyZW50IHRhcmdldCBlbGVtZW50OiBTdHJpbmcgKi8KCQkJdGFyZ2V0Q2xhc3M6cGx1Z2luUGZ4KyItdGFyZ2V0IiwKCQkJLyogY2xhc3Mgb2YgdGhlIGhpZ2hsaWdodGVkIGVsZW1lbnQ6IFN0cmluZyAqLwoJCQloaWdobGlnaHRDbGFzczpwbHVnaW5QZngrIi1oaWdobGlnaHQiLAoJCQkvKiBmb3JjZSBhIHNpbmdsZSBoaWdobGlnaHRlZCBlbGVtZW50IGVhY2ggdGltZTogQm9vbGVhbiAqLwoJCQlmb3JjZVNpbmdsZUhpZ2hsaWdodDpmYWxzZSwKCQkJLyoga2VlcCBlbGVtZW50IGhpZ2hsaWdodGVkIHVudGlsIG5leHQgKG9uZSBlbGVtZW50IGFsd2F5cyBzdGF5cyBoaWdobGlnaHRlZCk6IGJvb2xlYW4gKi8KCQkJa2VlcEhpZ2hsaWdodFVudGlsTmV4dDpmYWxzZSwKCQkJLyogaGlnaGxpZ2h0IGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGVpciB0YXJnZXQgYW5kIG5leHQgdGFyZ2V0IHBvc2l0aW9uICh1c2VmdWwgd2hlbiB0YXJnZXRzIGhhdmUgemVybyBkaW1lbnNpb25zKS4gTm9uICJhdXRvIiBsYXlvdXRzIG9ubHk6IGJvb2xlYW4gKi8KCQkJaGlnaGxpZ2h0QnlOZXh0VGFyZ2V0OmZhbHNlLAoJCQkvKiBkaXNhYmxlIHBsdWdpbiBiZWxvdyBbeCx5XSBzY3JlZW4gc2l6ZTogYm9vbGVhbiwgaW50ZWdlciwgYXJyYXkgKFt4LHldKSAqLwoJCQlkaXNhYmxlUGx1Z2luQmVsb3c6ZmFsc2UsCgkJCS8qIGVuYWJsZS9kaXNhYmxlIGNsaWNrIGV2ZW50cyBmb3IgYWxsIHNlbGVjdG9ycyAqLwoJCQljbGlja0V2ZW50czp0cnVlLAoJCQkvKiB1c2VyIGNhbGxiYWNrIGZ1bmN0aW9uczogZm4gKi8KCQkJb25TdGFydDpmdW5jdGlvbigpe30sCgkJCW9uQ29tcGxldGU6ZnVuY3Rpb24oKXt9LAoJCQkvKiBlbmFibGUvZGlzYWJsZSB0aGUgZGVmYXVsdCBzZWxlY3RvcjogQm9vbGVhbiAqLwoJCQlkZWZhdWx0U2VsZWN0b3I6ZmFsc2UsCgkJCS8qIGhpZ2hsaWdodCBlbGVtZW50cyBub3cgYW5kIGluIHRoZSBmdXR1cmUgKi8KCQkJbGl2ZTp0cnVlCgkJfSwKCQoJLyogdmFycywgY29uc3RhbnRzICovCgkKCQlzZWxlY3RvcixvcHQsX2luaXQsX3RyaWdnZXIsX2NsaWNrZWQsX3RhcmdldCxfdG8sX2F4aXMsX29mZnNldCxfZGF0YU9mZnNldCxfdG90YWxJbnN0YW5jZXM9MCxfbGl2ZVRpbWVyLAoJCgkvKiAKCS0tLS0tLS0tLS0tLS0tLQoJbWV0aG9kcyAKCS0tLS0tLS0tLS0tLS0tLQoJKi8KCQoJCW1ldGhvZHM9ewoJCQkKCQkJLyogcGx1Z2luIGluaXRpYWxpemF0aW9uIG1ldGhvZCAqLwoJCQkKCQkJaW5pdDpmdW5jdGlvbihvcHRpb25zKXsKCQkJCQoJCQkJLyogZXh0ZW5kIG9wdGlvbnMsIHN0b3JlIGVhY2ggb3B0aW9uIGluIGpxdWVyeSBkYXRhICovCgkJCQkKCQkJCXZhciBvcHRpb25zPSQuZXh0ZW5kKHRydWUse30sZGVmYXVsdHMsb3B0aW9ucyk7CgkJCQkKCQkJCSQoZG9jdW1lbnQpLmRhdGEocGx1Z2luUGZ4LG9wdGlvbnMpOwoJCQkJb3B0PSQoZG9jdW1lbnQpLmRhdGEocGx1Z2luUGZ4KTsKCQkJCQoJCQkJLyogY2hlY2svc2V0IGpxdWVyeSAoZGVwcmVjYXRlZCkgc2VsZWN0b3IgcHJvcGVydHkgaWYgbm90IGRlZmluZWQgKi8KCQkJCWlmKCF0aGlzLnNlbGVjdG9yKXsKCQkJCQl2YXIgc2VsZWN0b3JDbGFzcz0iX18iK3BsdWdpblBmeDsKCQkJCQl0aGlzLmVhY2goZnVuY3Rpb24oKXsKCQkJCQkJdmFyIGVsPSQodGhpcyk7CgkJCQkJCWlmKCFlbC5oYXNDbGFzcyhzZWxlY3RvckNsYXNzKSl7CgkJCQkJCQllbC5hZGRDbGFzcyhzZWxlY3RvckNsYXNzKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCXRoaXMuc2VsZWN0b3I9Ii4iK3NlbGVjdG9yQ2xhc3M7CgkJCQl9CgkJCQkKCQkJCS8qIHNldCBzZWxlY3RvciAqLwoJCQkJCgkJCQlzZWxlY3Rvcj0oIXNlbGVjdG9yKSA/IHRoaXMuc2VsZWN0b3IgOiBzZWxlY3RvcisiLCIrdGhpcy5zZWxlY3RvcjsKCQkJCQoJCQkJaWYob3B0LmRlZmF1bHRTZWxlY3Rvcil7CgkJCQkJaWYodHlwZW9mICQoc2VsZWN0b3IpIT09Im9iamVjdCIgfHwgJChzZWxlY3RvcikubGVuZ3RoPT09MCl7CgkJCQkJCXNlbGVjdG9yPWRlZmF1bHRTZWxlY3RvcjsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIHBsdWdpbiBldmVudHMgKi8KCQkJCQoJCQkJaWYob3B0LmNsaWNrRXZlbnRzKXsKCQkJCQkkKGRvY3VtZW50KQoJCQkJCQoJCQkJCS51bmRlbGVnYXRlKCIuIitwbHVnaW5QZngpCgkJCQkJCgkJCQkJLmRlbGVnYXRlKHNlbGVjdG9yLCJjbGljay4iK3BsdWdpblBmeCxmdW5jdGlvbihlKXsKCQkJCQkJaWYoZnVuY3Rpb25zLl9pc0Rpc2FibGVkLmNhbGwobnVsbCkpewoJCQkJCQkJZnVuY3Rpb25zLl9yZW1vdmVDbGFzc2VzLmNhbGwobnVsbCk7CgkJCQkJCQlyZXR1cm47CgkJCQkJCX0KCQkJCQkJdmFyICR0aGlzPSQodGhpcyksCgkJCQkJCQlocmVmPSR0aGlzLmF0dHIoImhyZWYiKSwKCQkJCQkJCWhyZWZQcm9wPSR0aGlzLnByb3AoImhyZWYiKTsKCQkJCQkJaWYoaHJlZiAmJiBocmVmLmluZGV4T2YoIiMvIikhPT0tMSl7CgkJCQkJCQlyZXR1cm47CgkJCQkJCX0KCQkJCQkJZnVuY3Rpb25zLl9yZXNldC5jYWxsKG51bGwpOwoJCQkJCQlfZGF0YU9mZnNldD0kdGhpcy5kYXRhKCJwczJpZC1vZmZzZXQiKSB8fCAwOwoJCQkJCQlpZihmdW5jdGlvbnMuX2lzVmFsaWQuY2FsbChudWxsLGhyZWYsaHJlZlByb3ApICYmIGZ1bmN0aW9ucy5fZmluZFRhcmdldC5jYWxsKG51bGwsaHJlZikpewoJCQkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQkJX3RyaWdnZXI9InNlbGVjdG9yIjsKCQkJCQkJCV9jbGlja2VkPSR0aGlzOwoJCQkJCQkJZnVuY3Rpb25zLl9zZXRDbGFzc2VzLmNhbGwobnVsbCx0cnVlKTsKCQkJCQkJCWZ1bmN0aW9ucy5fc2Nyb2xsVG8uY2FsbChudWxsKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQkJCgkJCQkkKHdpbmRvdykKCQkJCQoJCQkJLnVuYmluZCgiLiIrcGx1Z2luUGZ4KQoJCQkJCgkJCQkuYmluZCgic2Nyb2xsLiIrcGx1Z2luUGZ4KyIgcmVzaXplLiIrcGx1Z2luUGZ4LGZ1bmN0aW9uKCl7CgkJCQkJaWYoZnVuY3Rpb25zLl9pc0Rpc2FibGVkLmNhbGwobnVsbCkpewoJCQkJCQlmdW5jdGlvbnMuX3JlbW92ZUNsYXNzZXMuY2FsbChudWxsKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQl2YXIgdGFyZ2V0cz0kKCIuXyIrcGx1Z2luUGZ4KyItdCIpOwoJCQkJCXRhcmdldHMuZWFjaChmdW5jdGlvbihpKXsKCQkJCQkJdmFyIHQ9JCh0aGlzKSxpZD10LmF0dHIoImlkIiksCgkJCQkJCQloPWZ1bmN0aW9ucy5fZmluZEhpZ2hsaWdodC5jYWxsKG51bGwsaWQpOwoJCQkJCQlmdW5jdGlvbnMuX3NldENsYXNzZXMuY2FsbChudWxsLGZhbHNlLHQsaCk7CgkJCQkJCWlmKGk9PXRhcmdldHMubGVuZ3RoLTEpe2Z1bmN0aW9ucy5fZXh0ZW5kQ2xhc3Nlcy5jYWxsKG51bGwpO30KCQkJCQl9KTsKCQkJCX0pOwoJCQkJCgkJCQkvKiBwbHVnaW4gaGFzIGluaXRpYWxpemVkICovCgkJCQkKCQkJCV9pbml0PXRydWU7CgkJCQkKCQkJCS8qIHNldHVwIHNlbGVjdG9ycywgdGFyZ2V0IGVsZW1lbnRzLCBiYXNpYyBwbHVnaW4gY2xhc3NlcyBldGMuICovCgkJCQkKCQkJCWZ1bmN0aW9ucy5fc2V0dXAuY2FsbChudWxsKTsKCQkJCQoJCQkJLyogCgkJCQltb25pdG9yIGZvciBlbGVtZW50cyBtYXRjaGluZyB0aGUgY3VycmVudCBoaWdobGlnaHQgc2VsZWN0b3IgYW5kIGNhbGwgcGx1Z2luIHNldHVwIHdoZW4gZm91bmQgKG5vdyBhbmQgaW4gdGhlIGZ1dHVyZSkgCgkJCQl0byBtYW51YWxseSBlbmFibGUvZGlzYWJsZTogJChkb2N1bWVudCkuZGF0YSgibVBTMmlkIikubGl2ZT1ib29sZWFuIAoJCQkJKi8KCQkJCQoJCQkJZnVuY3Rpb25zLl9saXZlLmNhbGwobnVsbCk7CgkJCX0sCgkJCQoJCQkvKiBzY3JvbGxUbyBtZXRob2QgKi8KCQkJCgkJCXNjcm9sbFRvOmZ1bmN0aW9uKGlkLG9wdGlvbnMpewoJCQkJaWYoZnVuY3Rpb25zLl9pc0Rpc2FibGVkLmNhbGwobnVsbCkpewoJCQkJCWZ1bmN0aW9ucy5fcmVtb3ZlQ2xhc3Nlcy5jYWxsKG51bGwpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWlmKGlkICYmIHR5cGVvZiBpZCE9PSJ1bmRlZmluZWQiKXsKCQkJCQlmdW5jdGlvbnMuX2lzSW5pdC5jYWxsKG51bGwpOwoJCQkJCXZhciBkZWZhdWx0cz17CgkJCQkJCQlsYXlvdXQ6b3B0LmxheW91dCwKCQkJCQkJCW9mZnNldDpvcHQub2Zmc2V0LAoJCQkJCQkJY2xpY2tlZDpmYWxzZQoJCQkJCQl9LAoJCQkJCQlvcHRpb25zPSQuZXh0ZW5kKHRydWUse30sZGVmYXVsdHMsb3B0aW9ucyk7CgkJCQkJZnVuY3Rpb25zLl9yZXNldC5jYWxsKG51bGwpOwoJCQkJCV9heGlzPW9wdGlvbnMubGF5b3V0OwoJCQkJCV9vZmZzZXQ9b3B0aW9ucy5vZmZzZXQ7CgkJCQkJaWQ9KGlkLmluZGV4T2YoIiMiKSE9PS0xKSA/IGlkIDogIiMiK2lkOwoJCQkJCWlmKGZ1bmN0aW9ucy5faXNWYWxpZC5jYWxsKG51bGwsaWQpICYmIGZ1bmN0aW9ucy5fZmluZFRhcmdldC5jYWxsKG51bGwsaWQpKXsKCQkJCQkJX3RyaWdnZXI9InNjcm9sbFRvIjsKCQkJCQkJX2NsaWNrZWQ9b3B0aW9ucy5jbGlja2VkOwoJCQkJCQlpZihfY2xpY2tlZCl7CgkJCQkJCQlmdW5jdGlvbnMuX3NldENsYXNzZXMuY2FsbChudWxsLHRydWUpOwoJCQkJCQl9CgkJCQkJCWZ1bmN0aW9ucy5fc2Nyb2xsVG8uY2FsbChudWxsKTsKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCQoJCQkvKiBkZXN0cm95IG1ldGhvZCAqLwoJCQkKCQkJZGVzdHJveTpmdW5jdGlvbigpewoJCQkJJCh3aW5kb3cpLnVuYmluZCgiLiIrcGx1Z2luUGZ4KTsKCQkJCSQoZG9jdW1lbnQpLnVuZGVsZWdhdGUoIi4iK3BsdWdpblBmeCkucmVtb3ZlRGF0YShwbHVnaW5QZngpOwoJCQkJJCgiLl8iK3BsdWdpblBmeCsiLXQiKS5yZW1vdmVEYXRhKHBsdWdpblBmeCk7CgkJCQlmdW5jdGlvbnMuX3JlbW92ZUNsYXNzZXMuY2FsbChudWxsLHRydWUpOwoJCQl9CgkJfSwKCQoJLyogCgktLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9ucwoJLS0tLS0tLS0tLS0tLS0tCgkqLwoJCgkJZnVuY3Rpb25zPXsKCQkJCgkJCS8qIGNoZWNrcyBpZiBzY3JlZW4gc2l6ZSAoW3gseV0pIGlzIGJlbG93IHRoZSB2YWx1ZShzKSBzZXQgaW4gZGlzYWJsZVBsdWdpbkJlbG93IG9wdGlvbiAqLwoJCQkKCQkJX2lzRGlzYWJsZWQ6ZnVuY3Rpb24oKXsKCQkJCXZhciBlPXdpbmRvdyxhPSJpbm5lciIsCgkJCQkJdmFsPW9wdC5kaXNhYmxlUGx1Z2luQmVsb3cgaW5zdGFuY2VvZiBBcnJheSA/IFtvcHQuZGlzYWJsZVBsdWdpbkJlbG93WzBdIHx8IDAsb3B0LmRpc2FibGVQbHVnaW5CZWxvd1sxXSB8fCAwXSA6IFtvcHQuZGlzYWJsZVBsdWdpbkJlbG93IHx8IDAsMF07CgkJCQlpZighKCJpbm5lcldpZHRoIiBpbiB3aW5kb3cgKSl7CgkJCQkJYT0iY2xpZW50IjsKCQkJCQllPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5OwoJCQkJfQoJCQkJcmV0dXJuIGVbYSsiV2lkdGgiXTw9dmFsWzBdIHx8IGVbYSsiSGVpZ2h0Il08PXZhbFsxXTsKCQkJfSwKCQkJCgkJCS8qIGNoZWNrcyBpZiBocmVmIGF0dHJpYnV0ZSBpcyB2YWxpZCAqLwoJCQkKCQkJX2lzVmFsaWQ6ZnVuY3Rpb24oaHJlZixocmVmUHJvcCl7CgkJCQlpZighaHJlZil7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJaHJlZlByb3A9KCFocmVmUHJvcCkgPyBocmVmIDogaHJlZlByb3A7CgkJCQl2YXIgc3RyPShocmVmUHJvcC5pbmRleE9mKCIjLyIpIT09LTEpID8gaHJlZlByb3Auc3BsaXQoIiMvIilbMF0gOiBocmVmUHJvcC5zcGxpdCgiIyIpWzBdLAoJCQkJCWxvYz13aW5kb3cubG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdCgiIyIpWzBdOwoJCQkJcmV0dXJuIGhyZWYhPT0iIyIgJiYgaHJlZi5pbmRleE9mKCIjIikhPT0tMSAmJiAoc3RyPT09IiIgfHwgc3RyPT09bG9jKTsKCQkJfSwKCQkJCgkJCS8qIHNldHVwIHNlbGVjdG9ycywgdGFyZ2V0IGVsZW1lbnRzLCBiYXNpYyBwbHVnaW4gY2xhc3NlcyBldGMuICovCgkJCQoJCQlfc2V0dXA6ZnVuY3Rpb24oKXsKCQkJCXZhciBlbD1mdW5jdGlvbnMuX2hpZ2hsaWdodFNlbGVjdG9yKCksaT0xLHRwPTA7CgkJCQlyZXR1cm4gJChlbCkuZWFjaChmdW5jdGlvbigpewoJCQkJCXZhciAkdGhpcz0kKHRoaXMpLGhyZWY9JHRoaXMuYXR0cigiaHJlZiIpLGhyZWZQcm9wPSR0aGlzLnByb3AoImhyZWYiKTsKCQkJCQlpZihmdW5jdGlvbnMuX2lzVmFsaWQuY2FsbChudWxsLGhyZWYsaHJlZlByb3ApKXsKCQkJCQkJdmFyIGlkPShocmVmLmluZGV4T2YoIiMvIikhPT0tMSkgPyBocmVmLnNwbGl0KCIjLyIpWzFdIDogaHJlZi5zcGxpdCgiIyIpWzFdLHQ9JCgiIyIraWQpOyAKCQkJCQkJaWYodC5sZW5ndGg+MCl7CgkJCQkJCQlpZihvcHQuaGlnaGxpZ2h0QnlOZXh0VGFyZ2V0KXsKCQkJCQkJCQlpZih0IT09dHApewoJCQkJCQkJCQlpZighdHApe3QuZGF0YShwbHVnaW5QZngse3RuOiIwIn0pO31lbHNle3RwLmRhdGEocGx1Z2luUGZ4LHt0bjp0fSk7fQoJCQkJCQkJCQl0cD10OwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWlmKCF0Lmhhc0NsYXNzKCJfIitwbHVnaW5QZngrIi10IikpewoJCQkJCQkJCXQuYWRkQ2xhc3MoIl8iK3BsdWdpblBmeCsiLXQiKTsKCQkJCQkJCX0KCQkJCQkJCXQuZGF0YShwbHVnaW5QZngse2k6aX0pOwoJCQkJCQkJaWYoISR0aGlzLmhhc0NsYXNzKCJfIitwbHVnaW5QZngrIi1oIikpewoJCQkJCQkJCSR0aGlzLmFkZENsYXNzKCJfIitwbHVnaW5QZngrIi1oIik7CgkJCQkJCQl9CgkJCQkJCQl2YXIgaD1mdW5jdGlvbnMuX2ZpbmRIaWdobGlnaHQuY2FsbChudWxsLGlkKTsKCQkJCQkJCWZ1bmN0aW9ucy5fc2V0Q2xhc3Nlcy5jYWxsKG51bGwsZmFsc2UsdCxoKTsKCQkJCQkJCV90b3RhbEluc3RhbmNlcz1pOwoJCQkJCQkJaSsrCgkJCQkJCQlpZihpPT0kKGVsKS5sZW5ndGgpe2Z1bmN0aW9ucy5fZXh0ZW5kQ2xhc3Nlcy5jYWxsKG51bGwpO30KCQkJCQkJfQoJCQkJCX0KCQkJCX0pOwoJCQl9LAoJCQkKCQkJLyogcmV0dXJucyB0aGUgaGlnaGxpZ2h0IHNlbGVjdG9yICovCgkJCQoJCQlfaGlnaGxpZ2h0U2VsZWN0b3I6ZnVuY3Rpb24oKXsKCQkJCXJldHVybiAob3B0LmhpZ2hsaWdodFNlbGVjdG9yICYmIG9wdC5oaWdobGlnaHRTZWxlY3RvciE9PSIiKSA/IG9wdC5oaWdobGlnaHRTZWxlY3RvciA6IHNlbGVjdG9yOwoJCQl9LAoJCQkKCQkJLyogZmluZHMgdGhlIHRhcmdldCBlbGVtZW50ICovCgkJCQoJCQlfZmluZFRhcmdldDpmdW5jdGlvbihzdHIpewoJCQkJdmFyIHZhbD0oc3RyLmluZGV4T2YoIiMvIikhPT0tMSkgPyBzdHIuc3BsaXQoIiMvIilbMV0gOiBzdHIuc3BsaXQoIiMiKVsxXSwgCgkJCQkJZWw9JCgiIyIrdmFsKTsKCQkJCWlmKGVsLmxlbmd0aDwxIHx8IGVsLmNzcygicG9zaXRpb24iKT09PSJmaXhlZCIpewoJCQkJCWlmKHZhbD09PSJ0b3AiKXsKCQkJCQkJZWw9JCgiYm9keSIpOwoJCQkJCX1lbHNlewoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoJCQkJX3RhcmdldD1lbDsKCQkJCWlmKCFfYXhpcyl7CgkJCQkJX2F4aXM9b3B0LmxheW91dDsKCQkJCX0KCQkJCV9vZmZzZXQ9ZnVuY3Rpb25zLl9zZXRPZmZzZXQuY2FsbChudWxsKTsKCQkJCV90bz1bKGVsLm9mZnNldCgpLnRvcC1fb2Zmc2V0WzBdKS50b1N0cmluZygpLChlbC5vZmZzZXQoKS5sZWZ0LV9vZmZzZXRbMV0pLnRvU3RyaW5nKCldOyAKCQkJCV90b1swXT0oX3RvWzBdPDApID8gMCA6IF90b1swXTsKCQkJCV90b1sxXT0oX3RvWzFdPDApID8gMCA6IF90b1sxXTsKCQkJCXJldHVybiBfdG87CgkJCX0sCgkJCQoJCQkvKiBzZXRzIHRoZSBvZmZzZXQgdmFsdWUgKHBpeGVscywgb2JqZWN0cyBldGMuKSAqLwoJCQkKCQkJX3NldE9mZnNldDpmdW5jdGlvbigpewoJCQkJaWYoIV9vZmZzZXQpewoJCQkJCV9vZmZzZXQ9KG9wdC5vZmZzZXQpID8gb3B0Lm9mZnNldCA6IDA7CgkJCQl9CgkJCQlpZihfZGF0YU9mZnNldCl7CgkJCQkJX29mZnNldD1fZGF0YU9mZnNldDsKCQkJCX0KCQkJCXZhciB2YWwsb2JqLHkseDsKCQkJCXN3aXRjaCh0eXBlb2YgX29mZnNldCl7CgkJCQkJY2FzZSAib2JqZWN0IjoKCQkJCQljYXNlICJzdHJpbmciOgoJCQkJCQl2YWw9Wyhfb2Zmc2V0WyJ5Il0pID8gX29mZnNldFsieSJdIDogX29mZnNldCwoX29mZnNldFsieCJdKSA/IF9vZmZzZXRbIngiXSA6IF9vZmZzZXRdOwoJCQkJCQlvYmo9Wyh2YWxbMF0gaW5zdGFuY2VvZiBqUXVlcnkpID8gdmFsWzBdIDogJCh2YWxbMF0pLCh2YWxbMV0gaW5zdGFuY2VvZiBqUXVlcnkpID8gdmFsWzFdIDogJCh2YWxbMV0pXTsKCQkJCQkJaWYob2JqWzBdLmxlbmd0aD4wKXsgLy8ganMvanF1ZXJ5IG9iamVjdAoJCQkJCQkJeT1vYmpbMF0uaGVpZ2h0KCk7CgkJCQkJCQlpZihvYmpbMF0uY3NzKCJwb3NpdGlvbiIpPT09ImZpeGVkIil7IC8vIGluY2x1ZGUgcG9zaXRpb24gZm9yIGZpeGVkIGVsZW1lbnRzCgkJCQkJCQkJeSs9b2JqWzBdWzBdLm9mZnNldFRvcDsKCQkJCQkJCX0KCQkJCQkJfWVsc2UgaWYoIWlzTmFOKHBhcnNlRmxvYXQodmFsWzBdKSkgJiYgaXNGaW5pdGUodmFsWzBdKSl7IC8vIG51bWVyaWMgc3RyaW5nCgkJCQkJCQl5PXBhcnNlSW50KHZhbFswXSk7CgkJCQkJCX1lbHNlewoJCQkJCQkJeT0wOyAvLyBub24tZXhpc3RpbmcgdmFsdWUKCQkJCQkJfQoJCQkJCQlpZihvYmpbMV0ubGVuZ3RoPjApeyAvLyBqcy9qcXVlcnkgb2JqZWN0CgkJCQkJCQl4PW9ialsxXS53aWR0aCgpOwoJCQkJCQkJaWYob2JqWzFdLmNzcygicG9zaXRpb24iKT09PSJmaXhlZCIpeyAvLyBpbmNsdWRlIHBvc2l0aW9uIGZvciBmaXhlZCBlbGVtZW50cwoJCQkJCQkJCXgrPW9ialsxXVswXS5vZmZzZXRMZWZ0OwoJCQkJCQkJfQoJCQkJCQl9ZWxzZSBpZighaXNOYU4ocGFyc2VGbG9hdCh2YWxbMV0pKSAmJiBpc0Zpbml0ZSh2YWxbMV0pKXsgLy8gbnVtZXJpYyBzdHJpbmcKCQkJCQkJCXg9cGFyc2VJbnQodmFsWzFdKTsKCQkJCQkJfWVsc2V7CgkJCQkJCQl4PTA7IC8vIG5vbi1leGlzdGluZyB2YWx1ZQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZ1bmN0aW9uIjoKCQkJCQkJdmFsPV9vZmZzZXQuY2FsbChudWxsKTsgLy8gZnVuY3Rpb24gKHNpbmdsZSB2YWx1ZSBvciBhcnJheSkKCQkJCQkJaWYodmFsIGluc3RhbmNlb2YgQXJyYXkpewoJCQkJCQkJeT12YWxbMF07CgkJCQkJCQl4PXZhbFsxXTsKCQkJCQkJfWVsc2V7CgkJCQkJCQl5PXg9dmFsOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCXk9eD1wYXJzZUludChfb2Zmc2V0KTsgLy8gbnVtYmVyCgkJCQl9CgkJCQlyZXR1cm4gW3kseF07CgkJCX0sCgkJCQoJCQkvKiBmaW5kcyB0aGUgZWxlbWVudCB0aGF0IHNob3VsZCBiZSBoaWdobGlnaHRlZCAqLwoJCQkKCQkJX2ZpbmRIaWdobGlnaHQ6ZnVuY3Rpb24oaWQpewoJCQkJdmFyIGxvYz13aW5kb3cubG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdCgiIyIpWzBdLAoJCQkJCWhIYXNoPSQoIi5fIitwbHVnaW5QZngrIi1oW2hyZWY9JyMiK2lkKyInXSIpLAoJCQkJCWxoSGFzaD0kKCIuXyIrcGx1Z2luUGZ4KyItaFtocmVmPSciK2xvYysiIyIraWQrIiddIiksCgkJCQkJaEhhc2hTbGFzaD0kKCIuXyIrcGx1Z2luUGZ4KyItaFtocmVmPScjLyIraWQrIiddIiksCgkJCQkJbGhIYXNoU2xhc2g9JCgiLl8iK3BsdWdpblBmeCsiLWhbaHJlZj0nIitsb2MrIiMvIitpZCsiJ10iKTsKCQkJCWhIYXNoPShoSGFzaC5sZW5ndGg+MCkgPyBoSGFzaCA6IGxoSGFzaDsKCQkJCWhIYXNoU2xhc2g9KGhIYXNoU2xhc2gubGVuZ3RoPjApID8gaEhhc2hTbGFzaCA6IGxoSGFzaFNsYXNoOwoJCQkJcmV0dXJuIChoSGFzaFNsYXNoLmxlbmd0aD4wKSA/IGhIYXNoU2xhc2ggOiBoSGFzaDsKCQkJfSwKCQkJCgkJCS8qIHNldHMgcGx1Z2luIGNsYXNzZXMgKi8KCQkJCgkJCV9zZXRDbGFzc2VzOmZ1bmN0aW9uKGMsdCxoKXsKCQkJCXZhciBjYz1vcHQuY2xpY2tlZENsYXNzLHRjPW9wdC50YXJnZXRDbGFzcyxoYz1vcHQuaGlnaGxpZ2h0Q2xhc3M7CgkJCQlpZihjICYmIGNjICYmIGNjIT09IiIpewoJCQkJCSQoIi4iK2NjKS5yZW1vdmVDbGFzcyhjYyk7CgkJCQkJX2NsaWNrZWQuYWRkQ2xhc3MoY2MpOwoJCQkJfWVsc2UgaWYodCAmJiB0YyAmJiB0YyE9PSIiICYmIGggJiYgaGMgJiYgaGMhPT0iIil7CgkJCQkJaWYoZnVuY3Rpb25zLl9jdXJyZW50VGFyZ2V0LmNhbGwobnVsbCx0KSl7CgkJCQkJCXQuYWRkQ2xhc3ModGMpOwoJCQkJCQloLmFkZENsYXNzKGhjKTsKCQkJCQl9ZWxzZXsKCQkJCQkJaWYoIW9wdC5rZWVwSGlnaGxpZ2h0VW50aWxOZXh0IHx8ICQoIi4iK2hjKS5sZW5ndGg+MSl7CgkJCQkJCQl0LnJlbW92ZUNsYXNzKHRjKTsKCQkJCQkJCWgucmVtb3ZlQ2xhc3MoaGMpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQkKCQkJLyogZXh0ZW5kcyBwbHVnaW4gY2xhc3NlcyAqLwoJCQkKCQkJX2V4dGVuZENsYXNzZXM6ZnVuY3Rpb24oKXsKCQkJCXZhciB0Yz1vcHQudGFyZ2V0Q2xhc3MsaGM9b3B0LmhpZ2hsaWdodENsYXNzLAoJCQkJCSR0Yz0kKCIuIit0YyksJGhjPSQoIi4iK2hjKSxmdGM9dGMrIi1maXJzdCIsbHRjPXRjKyItbGFzdCIsZmhjPWhjKyItZmlyc3QiLGxoYz1oYysiLWxhc3QiOwoJCQkJJCgiLl8iK3BsdWdpblBmeCsiLXQiKS5yZW1vdmVDbGFzcyhmdGMrIiAiK2x0Yyk7CgkJCQkkKCIuXyIrcGx1Z2luUGZ4KyItaCIpLnJlbW92ZUNsYXNzKGZoYysiICIrbGhjKTsKCQkJCWlmKCFvcHQuZm9yY2VTaW5nbGVIaWdobGlnaHQpewoJCQkJCSR0Yy5zbGljZSgwLDEpLmFkZENsYXNzKGZ0YykuZW5kKCkuc2xpY2UoLTEpLmFkZENsYXNzKGx0Yyk7CgkJCQkJJGhjLnNsaWNlKDAsMSkuYWRkQ2xhc3MoZmhjKS5lbmQoKS5zbGljZSgtMSkuYWRkQ2xhc3MobGhjKTsKCQkJCX1lbHNlewoJCQkJCWlmKG9wdC5rZWVwSGlnaGxpZ2h0VW50aWxOZXh0ICYmICR0Yy5sZW5ndGg+MSl7CgkJCQkJCSR0Yy5zbGljZSgwLDEpLnJlbW92ZUNsYXNzKHRjKTsgJGhjLnNsaWNlKDAsMSkucmVtb3ZlQ2xhc3MoaGMpOwoJCQkJCX1lbHNlewoJCQkJCQkkdGMuc2xpY2UoMSkucmVtb3ZlQ2xhc3ModGMpOyAkaGMuc2xpY2UoMSkucmVtb3ZlQ2xhc3MoaGMpOwoJCQkJCX0KCQkJCX0KCQkJfSwKCQkJCgkJCS8qIHJlbW92ZXMgcGx1Z2luIGNsYXNzZXMgKi8KCQkJCgkJCV9yZW1vdmVDbGFzc2VzOmZ1bmN0aW9uKGRlc3Ryb3kpewoJCQkJJCgiLiIrb3B0LmNsaWNrZWRDbGFzcykucmVtb3ZlQ2xhc3Mob3B0LmNsaWNrZWRDbGFzcyk7CgkJCQkkKCIuIitvcHQudGFyZ2V0Q2xhc3MpLnJlbW92ZUNsYXNzKG9wdC50YXJnZXRDbGFzcysiICIrb3B0LnRhcmdldENsYXNzKyItZmlyc3QgIitvcHQudGFyZ2V0Q2xhc3MrIi1sYXN0Iik7CgkJCQkkKCIuIitvcHQuaGlnaGxpZ2h0Q2xhc3MpLnJlbW92ZUNsYXNzKG9wdC5oaWdobGlnaHRDbGFzcysiICIrb3B0LmhpZ2hsaWdodENsYXNzKyItZmlyc3QgIitvcHQuaGlnaGxpZ2h0Q2xhc3MrIi1sYXN0Iik7CgkJCQlpZihkZXN0cm95KXsKCQkJCQkkKCIuXyIrcGx1Z2luUGZ4KyItdCIpLnJlbW92ZUNsYXNzKCJfIitwbHVnaW5QZngrIi10Iik7CgkJCQkJJCgiLl8iK3BsdWdpblBmeCsiLWgiKS5yZW1vdmVDbGFzcygiXyIrcGx1Z2luUGZ4KyItaCIpOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyogY2hlY2tzIGlmIHRhcmdldCBlbGVtZW50IGlzIGluIHZpZXdwb3J0ICovCgkJCQoJCQlfY3VycmVudFRhcmdldDpmdW5jdGlvbih0KXsKCQkJCXZhciBvPW9wdFsidGFyZ2V0XyIrdC5kYXRhKHBsdWdpblBmeCkuaV0sCgkJCQkJZGF0YVRhcmdldD10LmRhdGEoInBzMmlkLXRhcmdldCIpLAoJCQkJCXJlY3Q9ZGF0YVRhcmdldCA/ICQoZGF0YVRhcmdldClbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiB0WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCQkJaWYodHlwZW9mIG8hPT0idW5kZWZpbmVkIil7CgkJCQkJdmFyIHk9dC5vZmZzZXQoKS50b3AseD10Lm9mZnNldCgpLmxlZnQsCgkJCQkJCWZyb209KG8uZnJvbSkgPyBvLmZyb20reSA6IHksdG89KG8udG8pID8gby50byt5IDogeSwKCQkJCQkJZnJvbVg9KG8uZnJvbVgpID8gby5mcm9tWCt4IDogeCx0b1g9KG8udG9YKSA/IG8udG9YK3ggOiB4OwoJCQkJCXJldHVybigKCQkJCQkJcmVjdC50b3AgPj0gdG8gJiYgcmVjdC50b3AgPD0gZnJvbSAmJiAKCQkJCQkJcmVjdC5sZWZ0ID49IHRvWCAmJiByZWN0LmxlZnQgPD0gZnJvbVgKCQkJCQkpOwoJCQkJfWVsc2V7CgkJCQkJdmFyIHdoPSQod2luZG93KS5oZWlnaHQoKSx3dz0kKHdpbmRvdykud2lkdGgoKSwKCQkJCQkJdGg9ZGF0YVRhcmdldCA/ICQoZGF0YVRhcmdldCkuaGVpZ2h0KCkgOiB0LmhlaWdodCgpLHR3PWRhdGFUYXJnZXQgPyAkKGRhdGFUYXJnZXQpLndpZHRoKCkgOiB0LndpZHRoKCksCgkJCQkJCWJhc2U9MSsodGgvd2gpLAoJCQkJCQl0b3A9YmFzZSxib3R0b209KHRoPHdoKSA/IGJhc2UqKHdoL3RoKSA6IGJhc2UsCgkJCQkJCWJhc2VYPTErKHR3L3d3KSwKCQkJCQkJbGVmdD1iYXNlWCxyaWdodD0odHc8d3cpID8gYmFzZVgqKHd3L3R3KSA6IGJhc2VYLAoJCQkJCQl2YWw9W3JlY3QudG9wIDw9IHdoL3RvcCxyZWN0LmJvdHRvbSA+PSB3aC9ib3R0b20scmVjdC5sZWZ0IDw9IHd3L2xlZnQscmVjdC5yaWdodCA+PSB3dy9yaWdodF07CgkJCQkJaWYob3B0LmhpZ2hsaWdodEJ5TmV4dFRhcmdldCl7CgkJCQkJCXZhciB0bj10LmRhdGEocGx1Z2luUGZ4KS50bjsKCQkJCQkJaWYodG4pewoJCQkJCQkJdmFyIHJlY3RuPXRuWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCQkJCQkJaWYob3B0LmxheW91dD09PSJ2ZXJ0aWNhbCIpewoJCQkJCQkJCXZhbD1bcmVjdC50b3AgPD0gd2gvMixyZWN0bi50b3AgPiB3aC8yLDEsMV07CgkJCQkJCQl9ZWxzZSBpZihvcHQubGF5b3V0PT09Imhvcml6b250YWwiKXsKCQkJCQkJCQl2YWw9WzEsMSxyZWN0LmxlZnQgPD0gd3cvMixyZWN0bi5sZWZ0ID4gd3cvMl07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuKHZhbFswXSAmJiB2YWxbMV0gJiYgdmFsWzJdICYmIHZhbFszXSk7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKiBzY3JvbGxzIHRoZSBwYWdlICovCgkJCQoJCQlfc2Nyb2xsVG86ZnVuY3Rpb24oKXsKCQkJCW9wdC5zY3JvbGxTcGVlZD1wYXJzZUludChvcHQuc2Nyb2xsU3BlZWQpOwoJCQkJX3RvPShvcHQucGFnZUVuZFNtb290aFNjcm9sbCkgPyBmdW5jdGlvbnMuX3BhZ2VFbmRTbW9vdGhTY3JvbGwuY2FsbChudWxsKSA6IF90bzsKCQkJCXZhciBlbD0kKCJodG1sLGJvZHkiKSwKCQkJCQlzcGVlZD0ob3B0LmF1dG9TY3JvbGxTcGVlZCkgPyBmdW5jdGlvbnMuX2F1dG9TY3JvbGxTcGVlZC5jYWxsKG51bGwpIDogb3B0LnNjcm9sbFNwZWVkLAoJCQkJCWVhc2luZz0oZWwuaXMoIjphbmltYXRlZCIpKSA/IG9wdC5zY3JvbGxpbmdFYXNpbmcgOiBvcHQuc2Nyb2xsRWFzaW5nLAoJCQkJCV90PSQod2luZG93KS5zY3JvbGxUb3AoKSxfbD0kKHdpbmRvdykuc2Nyb2xsTGVmdCgpOwoJCQkJc3dpdGNoKF9heGlzKXsKCQkJCQljYXNlICJob3Jpem9udGFsIjoKCQkJCQkJaWYoX2whPV90b1sxXSl7CgkJCQkJCQlmdW5jdGlvbnMuX2NhbGxiYWNrcy5jYWxsKG51bGwsIm9uU3RhcnQiKTsKCQkJCQkJCWVsLnN0b3AoKS5hbmltYXRlKHtzY3JvbGxMZWZ0Ol90b1sxXX0sc3BlZWQsZWFzaW5nKS5wcm9taXNlKCkudGhlbihmdW5jdGlvbigpewoJCQkJCQkJCWZ1bmN0aW9ucy5fY2FsbGJhY2tzLmNhbGwobnVsbCwib25Db21wbGV0ZSIpOwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYXV0byI6CgkJCQkJCWlmKF90IT1fdG9bMF0gfHwgX2whPV90b1sxXSl7CgkJCQkJCQlmdW5jdGlvbnMuX2NhbGxiYWNrcy5jYWxsKG51bGwsIm9uU3RhcnQiKTsKCQkJCQkJCWlmKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhpUG9kfGlQaG9uZXxpUGFkfEFuZHJvaWQpLykpeyAvLyBtb2JpbGUgZml4CgkJCQkJCQkJdmFyIGxlZnQ7CgkJCQkJCQkJZWwuc3RvcCgpLmFuaW1hdGUoe3BhZ2VZT2Zmc2V0Ol90b1swXSxwYWdlWE9mZnNldDpfdG9bMV19LHsKCQkJCQkJCQkgICAgZHVyYXRpb246c3BlZWQsCgkJCQkJCQkJICAgIGVhc2luZzplYXNpbmcsCgkJCQkJCQkJICAgIHN0ZXA6ZnVuY3Rpb24obm93LGZ4KXsKCQkJCQkJCQkgICAgICAgIGlmKGZ4LnByb3A9PSdwYWdlWE9mZnNldCcpewoJCQkJCQkJCSAgICAgICAgICAgIGxlZnQ9bm93OwoJCQkJCQkJCSAgICAgICAgfWVsc2UgaWYoZngucHJvcD09J3BhZ2VZT2Zmc2V0Jyl7CgkJCQkJCQkJICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKGxlZnQsbm93KTsKCQkJCQkJCQkgICAgICAgIH0KCQkJCQkJCQkgICAgfQoJCQkJCQkJCX0pLnByb21pc2UoKS50aGVuKGZ1bmN0aW9uKCl7CgkJCQkJCQkJCWZ1bmN0aW9ucy5fY2FsbGJhY2tzLmNhbGwobnVsbCwib25Db21wbGV0ZSIpOwoJCQkJCQkJCX0pOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJZWwuc3RvcCgpLmFuaW1hdGUoe3Njcm9sbFRvcDpfdG9bMF0sc2Nyb2xsTGVmdDpfdG9bMV19LHNwZWVkLGVhc2luZykucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24oKXsKCQkJCQkJCQkJZnVuY3Rpb25zLl9jYWxsYmFja3MuY2FsbChudWxsLCJvbkNvbXBsZXRlIik7CgkJCQkJCQkJfSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJaWYoX3QhPV90b1swXSl7CgkJCQkJCQlmdW5jdGlvbnMuX2NhbGxiYWNrcy5jYWxsKG51bGwsIm9uU3RhcnQiKTsKCQkJCQkJCWVsLnN0b3AoKS5hbmltYXRlKHtzY3JvbGxUb3A6X3RvWzBdfSxzcGVlZCxlYXNpbmcpLnByb21pc2UoKS50aGVuKGZ1bmN0aW9uKCl7CgkJCQkJCQkJZnVuY3Rpb25zLl9jYWxsYmFja3MuY2FsbChudWxsLCJvbkNvbXBsZXRlIik7CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJfQoJCQl9LAoJCQkKCQkJLyogc2V0cyBlbmQgb2YgcGFnZSAic21vb3RoIHNjcm9sbGluZyIgcG9zaXRpb24gKi8KCQkJCgkJCV9wYWdlRW5kU21vb3RoU2Nyb2xsOmZ1bmN0aW9uKCl7CgkJCQl2YXIgX2RoPSQoZG9jdW1lbnQpLmhlaWdodCgpLF9kdz0kKGRvY3VtZW50KS53aWR0aCgpLAoJCQkJCV93aD0kKHdpbmRvdykuaGVpZ2h0KCksX3d3PSQod2luZG93KS53aWR0aCgpOwoJCQkJcmV0dXJuIFsoKF9kaC1fdG9bMF0pPF93aCkgPyBfZGgtX3doIDogX3RvWzBdLCgoX2R3LV90b1sxXSk8X3d3KSA/IF9kdy1fd3cgOiBfdG9bMV1dOwoJCQl9LAoJCQkKCQkJLyogc2V0cyB0aGUgYXV0by1hZGp1c3RlZCBhbmltYXRpb24gc3BlZWQgKi8KCQkJCgkJCV9hdXRvU2Nyb2xsU3BlZWQ6ZnVuY3Rpb24oKXsKCQkJCXZhciBfdD0kKHdpbmRvdykuc2Nyb2xsVG9wKCksX2w9JCh3aW5kb3cpLnNjcm9sbExlZnQoKSwKCQkJCQlfaD0kKGRvY3VtZW50KS5oZWlnaHQoKSxfdz0kKGRvY3VtZW50KS53aWR0aCgpLAoJCQkJCXZhbD1bCgkJCQkJCW9wdC5zY3JvbGxTcGVlZCsoKG9wdC5zY3JvbGxTcGVlZCooTWF0aC5mbG9vcigoTWF0aC5hYnMoX3RvWzBdLV90KS9faCkqMTAwKSkpLzEwMCksCgkJCQkJCW9wdC5zY3JvbGxTcGVlZCsoKG9wdC5zY3JvbGxTcGVlZCooTWF0aC5mbG9vcigoTWF0aC5hYnMoX3RvWzFdLV9sKS9fdykqMTAwKSkpLzEwMCkKCQkJCQldOwoJCQkJcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsdmFsKTsKCQkJfSwKCQkJCgkJCS8qIHVzZXIgY2FsbGJhY2sgZnVuY3Rpb25zICovCgkJCQoJCQlfY2FsbGJhY2tzOmZ1bmN0aW9uKGMpewoJCQkJaWYoIW9wdCl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJdGhpc1twbHVnaW5QZnhdPXsKCQkJCQl0cmlnZ2VyOl90cmlnZ2VyLGNsaWNrZWQ6X2NsaWNrZWQsdGFyZ2V0Ol90YXJnZXQsc2Nyb2xsVG86e3k6X3RvWzBdLHg6X3RvWzFdfQoJCQkJfTsKCQkJCXN3aXRjaChjKXsKCQkJCQljYXNlICJvblN0YXJ0IjoKCQkJCQkJb3B0Lm9uU3RhcnQuY2FsbChudWxsLHRoaXNbcGx1Z2luUGZ4XSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIm9uQ29tcGxldGUiOgoJCQkJCQlvcHQub25Db21wbGV0ZS5jYWxsKG51bGwsdGhpc1twbHVnaW5QZnhdKTsKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKiByZXNldHMvY2xlYXJzIHZhcnMgYW5kIGNvbnN0YW50cyAqLwoJCQkKCQkJX3Jlc2V0OmZ1bmN0aW9uKCl7CgkJCQlfYXhpcz1fb2Zmc2V0PV9kYXRhT2Zmc2V0PWZhbHNlOwoJCQl9LAoJCQkKCQkJLyogY2hlY2tzIGlmIHBsdWdpbiBoYXMgaW5pdGlhbGl6ZWQgKi8KCQkJCgkJCV9pc0luaXQ6ZnVuY3Rpb24oKXsKCQkJCWlmKCFfaW5pdCl7CgkJCQkJbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMpOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyogbGl2ZSBmbiAqLwoJCQkKCQkJX2xpdmU6ZnVuY3Rpb24oKXsKCQkJCV9saXZlVGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJCWlmKG9wdC5saXZlKXsKCQkJCQkJaWYoJChmdW5jdGlvbnMuX2hpZ2hsaWdodFNlbGVjdG9yKCkpLmxlbmd0aCE9PV90b3RhbEluc3RhbmNlcyl7CgkJCQkJCQlmdW5jdGlvbnMuX3NldHVwLmNhbGwobnVsbCk7CgkJCQkJCX0KCQkJCQl9ZWxzZXsKCQkJCQkJaWYoX2xpdmVUaW1lcil7Y2xlYXJUaW1lb3V0KF9saXZlVGltZXIpO30KCQkJCQl9CgkJCQkJZnVuY3Rpb25zLl9saXZlLmNhbGwobnVsbCk7CgkJCQl9LDEwMDApOwoJCQl9LAoJCQkKCQkJLyogZXh0ZW5kcyBqcXVlcnkgd2l0aCBjdXN0b20gZWFzaW5ncyAoYXMganF1ZXJ5IHVpKSAqLwoJCQkKCQkJX2Vhc2luZzpmdW5jdGlvbigpewoJCQkJJC5lYXNpbmcuZWFzZUluUXVhZD0kLmVhc2luZy5lYXNlSW5RdWFkIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIGMqKHQvPWQpKnQgKyBiO307CQoJCQkJJC5lYXNpbmcuZWFzZU91dFF1YWQ9JC5lYXNpbmcuZWFzZU91dFF1YWQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gLWMgKih0Lz1kKSoodC0yKSArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VJbk91dFF1YWQ9JC5lYXNpbmcuZWFzZUluT3V0UXVhZCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKnQqdCArIGI7CgkJCQkJCXJldHVybiAtYy8yICogKCgtLXQpKih0LTIpIC0gMSkgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5DdWJpYz0kLmVhc2luZy5lYXNlSW5DdWJpYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKih0Lz1kKSp0KnQgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0Q3ViaWM9JC5lYXNpbmcuZWFzZU91dEN1YmljIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQgKyAxKSArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VJbk91dEN1YmljPSQuZWFzaW5nLmVhc2VJbk91dEN1YmljIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCWlmICgodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0KnQgKyBiOwoJCQkJCQlyZXR1cm4gYy8yKigodC09MikqdCp0ICsgMikgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5RdWFydD0kLmVhc2luZy5lYXNlSW5RdWFydCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKih0Lz1kKSp0KnQqdCArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VPdXRRdWFydD0kLmVhc2luZy5lYXNlT3V0UXVhcnQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gLWMgKiAoKHQ9dC9kLTEpKnQqdCp0IC0gMSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRRdWFydD0kLmVhc2luZy5lYXNlSW5PdXRRdWFydCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKnQqdCp0KnQgKyBiOwoJCQkJCQlyZXR1cm4gLWMvMiAqICgodC09MikqdCp0KnQgLSAyKSArIGI7CgkJCQkJfTsKCQkJCSQuZWFzaW5nLmVhc2VJblF1aW50PSQuZWFzaW5nLmVhc2VJblF1aW50IHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIGMqKHQvPWQpKnQqdCp0KnQgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0UXVpbnQ9JC5lYXNpbmcuZWFzZU91dFF1aW50IHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQqdCp0ICsgMSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRRdWludD0kLmVhc2luZy5lYXNlSW5PdXRRdWludCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKnQqdCp0KnQqdCArIGI7CgkJCQkJCXJldHVybiBjLzIqKCh0LT0yKSp0KnQqdCp0ICsgMikgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5FeHBvPSQuZWFzaW5nLmVhc2VJbkV4cG8gfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gKHQ9PTApID8gYiA6IGMgKiBNYXRoLnBvdygyLCAxMCAqICh0L2QgLSAxKSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0RXhwbz0kLmVhc2luZy5lYXNlT3V0RXhwbyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiAodD09ZCkgPyBiK2MgOiBjICogKC1NYXRoLnBvdygyLCAtMTAgKiB0L2QpICsgMSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRFeHBvPSQuZWFzaW5nLmVhc2VJbk91dEV4cG8gfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKHQ9PTApIHJldHVybiBiOwoJCQkJCQlpZiAodD09ZCkgcmV0dXJuIGIrYzsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMiAqIE1hdGgucG93KDIsIDEwICogKHQgLSAxKSkgKyBiOwoJCQkJCQlyZXR1cm4gYy8yICogKC1NYXRoLnBvdygyLCAtMTAgKiAtLXQpICsgMikgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5TaW5lPSQuZWFzaW5nLmVhc2VJblNpbmUgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gLWMgKiBNYXRoLmNvcyh0L2QgKiAoTWF0aC5QSS8yKSkgKyBjICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZU91dFNpbmU9JC5lYXNpbmcuZWFzZU91dFNpbmUgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gYyAqIE1hdGguc2luKHQvZCAqIChNYXRoLlBJLzIpKSArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VJbk91dFNpbmU9JC5lYXNpbmcuZWFzZUluT3V0U2luZSB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiAtYy8yICogKE1hdGguY29zKE1hdGguUEkqdC9kKSAtIDEpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZUluQ2lyYz0kLmVhc2luZy5lYXNlSW5DaXJjIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIC1jICogKE1hdGguc3FydCgxIC0gKHQvPWQpKnQpIC0gMSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0Q2lyYz0kLmVhc2luZy5lYXNlT3V0Q2lyYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjICogTWF0aC5zcXJ0KDEgLSAodD10L2QtMSkqdCkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRDaXJjPSQuZWFzaW5nLmVhc2VJbk91dENpcmMgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIC1jLzIgKiAoTWF0aC5zcXJ0KDEgLSB0KnQpIC0gMSkgKyBiOwoJCQkJCQlyZXR1cm4gYy8yICogKE1hdGguc3FydCgxIC0gKHQtPTIpKnQpICsgMSkgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5FbGFzdGljPSQuZWFzaW5nLmVhc2VJbkVsYXN0aWMgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJdmFyIHM9MS43MDE1ODt2YXIgcD0wO3ZhciBhPWM7CgkJCQkJCWlmICh0PT0wKSByZXR1cm4gYjsgIGlmICgodC89ZCk9PTEpIHJldHVybiBiK2M7ICBpZiAoIXApIHA9ZCouMzsKCQkJCQkJaWYgKGEgPCBNYXRoLmFicyhjKSkgeyBhPWM7IHZhciBzPXAvNDsgfQoJCQkJCQllbHNlIHZhciBzID0gcC8oMipNYXRoLlBJKSAqIE1hdGguYXNpbiAoYy9hKTsKCQkJCQkJcmV0dXJuIC0oYSpNYXRoLnBvdygyLDEwKih0LT0xKSkgKiBNYXRoLnNpbiggKHQqZC1zKSooMipNYXRoLlBJKS9wICkpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZU91dEVsYXN0aWM9JC5lYXNpbmcuZWFzZU91dEVsYXN0aWMgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJdmFyIHM9MS43MDE1ODt2YXIgcD0wO3ZhciBhPWM7CgkJCQkJCWlmICh0PT0wKSByZXR1cm4gYjsgIGlmICgodC89ZCk9PTEpIHJldHVybiBiK2M7ICBpZiAoIXApIHA9ZCouMzsKCQkJCQkJaWYgKGEgPCBNYXRoLmFicyhjKSkgeyBhPWM7IHZhciBzPXAvNDsgfQoJCQkJCQllbHNlIHZhciBzID0gcC8oMipNYXRoLlBJKSAqIE1hdGguYXNpbiAoYy9hKTsKCQkJCQkJcmV0dXJuIGEqTWF0aC5wb3coMiwtMTAqdCkgKiBNYXRoLnNpbiggKHQqZC1zKSooMipNYXRoLlBJKS9wICkgKyBjICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0RWxhc3RpYz0kLmVhc2luZy5lYXNlSW5PdXRFbGFzdGljIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCXZhciBzPTEuNzAxNTg7dmFyIHA9MDt2YXIgYT1jOwoJCQkJCQlpZiAodD09MCkgcmV0dXJuIGI7ICBpZiAoKHQvPWQvMik9PTIpIHJldHVybiBiK2M7ICBpZiAoIXApIHA9ZCooLjMqMS41KTsKCQkJCQkJaWYgKGEgPCBNYXRoLmFicyhjKSkgeyBhPWM7IHZhciBzPXAvNDsgfQoJCQkJCQllbHNlIHZhciBzID0gcC8oMipNYXRoLlBJKSAqIE1hdGguYXNpbiAoYy9hKTsKCQkJCQkJaWYgKHQgPCAxKSByZXR1cm4gLS41KihhKk1hdGgucG93KDIsMTAqKHQtPTEpKSAqIE1hdGguc2luKCAodCpkLXMpKigyKk1hdGguUEkpL3AgKSkgKyBiOwoJCQkJCQlyZXR1cm4gYSpNYXRoLnBvdygyLC0xMCoodC09MSkpICogTWF0aC5zaW4oICh0KmQtcykqKDIqTWF0aC5QSSkvcCApKi41ICsgYyArIGI7CgkJCQkJfTsKCQkJCSQuZWFzaW5nLmVhc2VJbkJhY2s9JC5lYXNpbmcuZWFzZUluQmFjayB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQscyl7CgkJCQkJCWlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7CgkJCQkJCXJldHVybiBjKih0Lz1kKSp0KigocysxKSp0IC0gcykgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlT3V0QmFjaz0kLmVhc2luZy5lYXNlT3V0QmFjayB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQscyl7CgkJCQkJCWlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7CgkJCQkJCXJldHVybiBjKigodD10L2QtMSkqdCooKHMrMSkqdCArIHMpICsgMSkgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRCYWNrPSQuZWFzaW5nLmVhc2VJbk91dEJhY2sgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkLHMpewoJCQkJCQlpZiAocyA9PSB1bmRlZmluZWQpIHMgPSAxLjcwMTU4OwoJCQkJCQlpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKih0KnQqKCgocyo9KDEuNTI1KSkrMSkqdCAtIHMpKSArIGI7CgkJCQkJCXJldHVybiBjLzIqKCh0LT0yKSp0KigoKHMqPSgxLjUyNSkpKzEpKnQgKyBzKSArIDIpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluQm91bmNlPSQuZWFzaW5nLmVhc2VJbkJvdW5jZSB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjIC0gJC5lYXNpbmcuZWFzZU91dEJvdW5jZSAoeCwgZC10LCAwLCBjLCBkKSArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VPdXRCb3VuY2U9JC5lYXNpbmcuZWFzZU91dEJvdW5jZSB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAoKHQvPWQpIDwgKDEvMi43NSkpIHtyZXR1cm4gYyooNy41NjI1KnQqdCkgKyBiO30gCgkJCQkJCWVsc2UgaWYgKHQgPCAoMi8yLjc1KSkge3JldHVybiBjKig3LjU2MjUqKHQtPSgxLjUvMi43NSkpKnQgKyAuNzUpICsgYjt9IAoJCQkJCQllbHNlIGlmICh0IDwgKDIuNS8yLjc1KSkge3JldHVybiBjKig3LjU2MjUqKHQtPSgyLjI1LzIuNzUpKSp0ICsgLjkzNzUpICsgYjt9IAoJCQkJCQllbHNlIHtyZXR1cm4gYyooNy41NjI1Kih0LT0oMi42MjUvMi43NSkpKnQgKyAuOTg0Mzc1KSArIGI7fQoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRCb3VuY2U9JC5lYXNpbmcuZWFzZUluT3V0Qm91bmNlIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCWlmICh0IDwgZC8yKSByZXR1cm4gJC5lYXNpbmcuZWFzZUluQm91bmNlICh4LCB0KjIsIDAsIGMsIGQpICogLjUgKyBiOwoJCQkJCQlyZXR1cm4gJC5lYXNpbmcuZWFzZU91dEJvdW5jZSAoeCwgdCoyLWQsIDAsIGMsIGQpICogLjUgKyBjKi41ICsgYjsKCQkJCQl9OwoJCQl9CgkJfQoJCQoJLyogCgktLS0tLS0tLS0tLS0tLS0KCXBsdWdpbiBzZXR1cCAKCS0tLS0tLS0tLS0tLS0tLQoJKi8KCQoJLyogZXh0ZW5kIGpxdWVyeSB3aXRoIGN1c3RvbSBlYXNpbmdzICovCgkKCWZ1bmN0aW9ucy5fZWFzaW5nLmNhbGwoKTsKCQoJLyogcGx1Z2luIGNvbnN0cnVjdG9yIGZ1bmN0aW9ucyAqLwoJCgkkLmZuW3BsdWdpbk5TXT1mdW5jdGlvbihtZXRob2QpewoJCWlmKG1ldGhvZHNbbWV0aG9kXSl7CgkJCXJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcyxBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSkpOwoJCX1lbHNlIGlmKHR5cGVvZiBtZXRob2Q9PT0ib2JqZWN0IiB8fCAhbWV0aG9kKXsKCQkJcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CgkJfWVsc2V7CgkJCSQuZXJyb3IoIk1ldGhvZCAiK21ldGhvZCsiIGRvZXMgbm90IGV4aXN0Iik7CgkJfQoJfTsKCSRbcGx1Z2luTlNdPWZ1bmN0aW9uKG1ldGhvZCl7CgkJaWYobWV0aG9kc1ttZXRob2RdKXsKCQkJcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSk7CgkJfWVsc2UgaWYodHlwZW9mIG1ldGhvZD09PSJvYmplY3QiIHx8ICFtZXRob2QpewoJCQlyZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTsKCQl9ZWxzZXsKCQkJJC5lcnJvcigiTWV0aG9kICIrbWV0aG9kKyIgZG9lcyBub3QgZXhpc3QiKTsKCQl9Cgl9OwoJCgkvKiAKCWFsbG93IHNldHRpbmcgcGx1Z2luIGRlZmF1bHQgb3B0aW9ucy4gCglleGFtcGxlOiAkLnBsdWdpbl9uYW1lLmRlZmF1bHRzLm9wdGlvbl9uYW1lPSJvcHRpb25fdmFsdWUiOyAKCSovCgkKCSRbcGx1Z2luTlNdLmRlZmF1bHRzPWRlZmF1bHRzOwoJCn0pKGpRdWVyeSx3aW5kb3csZG9jdW1lbnQpOw==",
                "body": "LyoKPT0gUGFnZSBzY3JvbGwgdG8gaWQgPT0gClZlcnNpb246IDEuNS40IApQbHVnaW4gVVJJOiBodHRwOi8vbWFub3MubWFsaWh1LmdyL3BhZ2Utc2Nyb2xsLXRvLWlkLwpBdXRob3I6IG1hbGlodQpBdXRob3IgVVJJOiBodHRwOi8vbWFub3MubWFsaWh1LmdyCkxpY2Vuc2U6IE1JVCBMaWNlbnNlIChNSVQpCiovCgovKgpDb3B5cmlnaHQgMjAxMyAgbWFsaWh1ICAoZW1haWw6IG1hbm9zQG1hbGlodS5ncikKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCiovCgo7KGZ1bmN0aW9uKCQsd2luZG93LGRvY3VtZW50LHVuZGVmaW5lZCl7CgkKCS8qIHBsdWdpbiBuYW1lc3BhY2UsIHByZWZpeCwgZGVmYXVsdCBzZWxlY3RvcihzKSAqLwoJCgl2YXIgcGx1Z2luTlM9Im1QYWdlU2Nyb2xsMmlkIiwKCQlwbHVnaW5QZng9Im1QUzJpZCIsCgkJZGVmYXVsdFNlbGVjdG9yPSIubV9QYWdlU2Nyb2xsMmlkLGFbcmVsfj0nbV9QYWdlU2Nyb2xsMmlkJ10sLnBhZ2Utc2Nyb2xsLXRvLWlkLGFbcmVsfj0ncGFnZS1zY3JvbGwtdG8taWQnXSwuX3BzMmlkIiwKCQoJLyogZGVmYXVsdCBvcHRpb25zICovCgkKCQlkZWZhdWx0cz17CgkJCS8qIHNjcm9sbCBhbmltYXRpb24gc3BlZWQgaW4gbWlsbGlzZWNvbmRzOiBJbnRlZ2VyICovCgkJCXNjcm9sbFNwZWVkOjEzMDAsCgkJCS8qIGF1dG8tYWRqdXN0IGFuaW1hdGlvbiBzcGVlZCAoYWNjb3JkaW5nIHRvIHRhcmdldCBlbGVtZW50IHBvc2l0aW9uIGFuZCB3aW5kb3cgc2Nyb2xsKTogQm9vbGVhbiAqLwoJCQlhdXRvU2Nyb2xsU3BlZWQ6dHJ1ZSwKCQkJLyogc2Nyb2xsIGFuaW1hdGlvbiBlYXNpbmcgd2hlbiBwYWdlIGlzIGlkbGU6IFN0cmluZyAqLwoJCQlzY3JvbGxFYXNpbmc6ImVhc2VJbk91dEV4cG8iLAoJCQkvKiBzY3JvbGwgYW5pbWF0aW9uIGVhc2luZyB3aGlsZSBwYWdlIGlzIHNjcm9sbGluZzogU3RyaW5nICovCgkJCXNjcm9sbGluZ0Vhc2luZzoiZWFzZUluT3V0Q2lyYyIsCgkJCS8qIGVuZCBvZiBwYWdlICJzbW9vdGggc2Nyb2xsaW5nIiAoYXV0by1hZGp1c3QgdGhlIHNjcm9sbC10byBwb3NpdGlvbiB3aGVuIGJvdHRvbSBlbGVtZW50cyBhcmUgdG9vIHNob3J0KTogQm9vbGVhbiAqLwoJCQlwYWdlRW5kU21vb3RoU2Nyb2xsOnRydWUsCgkJCS8qIAoJCQlwYWdlIGxheW91dCBkZWZpbmVzIHNjcm9sbGluZyBkaXJlY3Rpb246IFN0cmluZyAKCQkJdmFsdWVzOiAidmVydGljYWwiLCAiaG9yaXpvbnRhbCIsICJhdXRvIiAKCQkJKi8KCQkJbGF5b3V0OiJ2ZXJ0aWNhbCIsCgkJCS8qIGV4dHJhIHNwYWNlIGluIHBpeGVscyBmb3IgdGhlIHRhcmdldCBlbGVtZW50IHBvc2l0aW9uOiBJbnRlZ2VyICovCgkJCW9mZnNldDowLAoJCQkvKiBoaWdobGlnaHQgdGhlIG1haW4vZGVmYXVsdCBzZWxlY3RvcnMgb3IgaW5zZXJ0IGEgZGlmZmVyZW50IHNldDogQm9vbGVhbiwgU3RyaW5nICovCgkJCWhpZ2hsaWdodFNlbGVjdG9yOmZhbHNlLAoJCQkvKiBjbGFzcyBvZiB0aGUgY2xpY2tlZCBlbGVtZW50OiBTdHJpbmcgKi8KCQkJY2xpY2tlZENsYXNzOnBsdWdpblBmeCsiLWNsaWNrZWQiLAoJCQkvKiBjbGFzcyBvZiB0aGUgY3VycmVudCB0YXJnZXQgZWxlbWVudDogU3RyaW5nICovCgkJCXRhcmdldENsYXNzOnBsdWdpblBmeCsiLXRhcmdldCIsCgkJCS8qIGNsYXNzIG9mIHRoZSBoaWdobGlnaHRlZCBlbGVtZW50OiBTdHJpbmcgKi8KCQkJaGlnaGxpZ2h0Q2xhc3M6cGx1Z2luUGZ4KyItaGlnaGxpZ2h0IiwKCQkJLyogZm9yY2UgYSBzaW5nbGUgaGlnaGxpZ2h0ZWQgZWxlbWVudCBlYWNoIHRpbWU6IEJvb2xlYW4gKi8KCQkJZm9yY2VTaW5nbGVIaWdobGlnaHQ6ZmFsc2UsCgkJCS8qIGtlZXAgZWxlbWVudCBoaWdobGlnaHRlZCB1bnRpbCBuZXh0IChvbmUgZWxlbWVudCBhbHdheXMgc3RheXMgaGlnaGxpZ2h0ZWQpOiBib29sZWFuICovCgkJCWtlZXBIaWdobGlnaHRVbnRpbE5leHQ6ZmFsc2UsCgkJCS8qIGhpZ2hsaWdodCBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlaXIgdGFyZ2V0IGFuZCBuZXh0IHRhcmdldCBwb3NpdGlvbiAodXNlZnVsIHdoZW4gdGFyZ2V0cyBoYXZlIHplcm8gZGltZW5zaW9ucykuIE5vbiAiYXV0byIgbGF5b3V0cyBvbmx5OiBib29sZWFuICovCgkJCWhpZ2hsaWdodEJ5TmV4dFRhcmdldDpmYWxzZSwKCQkJLyogZGlzYWJsZSBwbHVnaW4gYmVsb3cgW3gseV0gc2NyZWVuIHNpemU6IGJvb2xlYW4sIGludGVnZXIsIGFycmF5IChbeCx5XSkgKi8KCQkJZGlzYWJsZVBsdWdpbkJlbG93OmZhbHNlLAoJCQkvKiBlbmFibGUvZGlzYWJsZSBjbGljayBldmVudHMgZm9yIGFsbCBzZWxlY3RvcnMgKi8KCQkJY2xpY2tFdmVudHM6dHJ1ZSwKCQkJLyogdXNlciBjYWxsYmFjayBmdW5jdGlvbnM6IGZuICovCgkJCW9uU3RhcnQ6ZnVuY3Rpb24oKXt9LAoJCQlvbkNvbXBsZXRlOmZ1bmN0aW9uKCl7fSwKCQkJLyogZW5hYmxlL2Rpc2FibGUgdGhlIGRlZmF1bHQgc2VsZWN0b3I6IEJvb2xlYW4gKi8KCQkJZGVmYXVsdFNlbGVjdG9yOmZhbHNlLAoJCQkvKiBoaWdobGlnaHQgZWxlbWVudHMgbm93IGFuZCBpbiB0aGUgZnV0dXJlICovCgkJCWxpdmU6dHJ1ZQoJCX0sCgkKCS8qIHZhcnMsIGNvbnN0YW50cyAqLwoJCgkJc2VsZWN0b3Isb3B0LF9pbml0LF90cmlnZ2VyLF9jbGlja2VkLF90YXJnZXQsX3RvLF9heGlzLF9vZmZzZXQsX2RhdGFPZmZzZXQsX3RvdGFsSW5zdGFuY2VzPTAsX2xpdmVUaW1lciwKCQoJLyogCgktLS0tLS0tLS0tLS0tLS0KCW1ldGhvZHMgCgktLS0tLS0tLS0tLS0tLS0KCSovCgkKCQltZXRob2RzPXsKCQkJCgkJCS8qIHBsdWdpbiBpbml0aWFsaXphdGlvbiBtZXRob2QgKi8KCQkJCgkJCWluaXQ6ZnVuY3Rpb24ob3B0aW9ucyl7CgkJCQkKCQkJCS8qIGV4dGVuZCBvcHRpb25zLCBzdG9yZSBlYWNoIG9wdGlvbiBpbiBqcXVlcnkgZGF0YSAqLwoJCQkJCgkJCQl2YXIgb3B0aW9ucz0kLmV4dGVuZCh0cnVlLHt9LGRlZmF1bHRzLG9wdGlvbnMpOwoJCQkJCgkJCQkkKGRvY3VtZW50KS5kYXRhKHBsdWdpblBmeCxvcHRpb25zKTsKCQkJCW9wdD0kKGRvY3VtZW50KS5kYXRhKHBsdWdpblBmeCk7CgkJCQkKCQkJCS8qIGNoZWNrL3NldCBqcXVlcnkgKGRlcHJlY2F0ZWQpIHNlbGVjdG9yIHByb3BlcnR5IGlmIG5vdCBkZWZpbmVkICovCgkJCQlpZighdGhpcy5zZWxlY3Rvcil7CgkJCQkJdmFyIHNlbGVjdG9yQ2xhc3M9Il9fIitwbHVnaW5QZng7CgkJCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCl7CgkJCQkJCXZhciBlbD0kKHRoaXMpOwoJCQkJCQlpZighZWwuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzcykpewoJCQkJCQkJZWwuYWRkQ2xhc3Moc2VsZWN0b3JDbGFzcyk7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCQl0aGlzLnNlbGVjdG9yPSIuIitzZWxlY3RvckNsYXNzOwoJCQkJfQoJCQkJCgkJCQkvKiBzZXQgc2VsZWN0b3IgKi8KCQkJCQoJCQkJc2VsZWN0b3I9KCFzZWxlY3RvcikgPyB0aGlzLnNlbGVjdG9yIDogc2VsZWN0b3IrIiwiK3RoaXMuc2VsZWN0b3I7CgkJCQkKCQkJCWlmKG9wdC5kZWZhdWx0U2VsZWN0b3IpewoJCQkJCWlmKHR5cGVvZiAkKHNlbGVjdG9yKSE9PSJvYmplY3QiIHx8ICQoc2VsZWN0b3IpLmxlbmd0aD09PTApewoJCQkJCQlzZWxlY3Rvcj1kZWZhdWx0U2VsZWN0b3I7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBwbHVnaW4gZXZlbnRzICovCgkJCQkKCQkJCWlmKG9wdC5jbGlja0V2ZW50cyl7CgkJCQkJJChkb2N1bWVudCkKCQkJCQkKCQkJCQkudW5kZWxlZ2F0ZSgiLiIrcGx1Z2luUGZ4KQoJCQkJCQoJCQkJCS5kZWxlZ2F0ZShzZWxlY3RvciwiY2xpY2suIitwbHVnaW5QZngsZnVuY3Rpb24oZSl7CgkJCQkJCWlmKGZ1bmN0aW9ucy5faXNEaXNhYmxlZC5jYWxsKG51bGwpKXsKCQkJCQkJCWZ1bmN0aW9ucy5fcmVtb3ZlQ2xhc3Nlcy5jYWxsKG51bGwpOwoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJCXZhciAkdGhpcz0kKHRoaXMpLAoJCQkJCQkJaHJlZj0kdGhpcy5hdHRyKCJocmVmIiksCgkJCQkJCQlocmVmUHJvcD0kdGhpcy5wcm9wKCJocmVmIik7CgkJCQkJCWlmKGhyZWYgJiYgaHJlZi5pbmRleE9mKCIjLyIpIT09LTEpewoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJCWZ1bmN0aW9ucy5fcmVzZXQuY2FsbChudWxsKTsKCQkJCQkJX2RhdGFPZmZzZXQ9JHRoaXMuZGF0YSgicHMyaWQtb2Zmc2V0IikgfHwgMDsKCQkJCQkJaWYoZnVuY3Rpb25zLl9pc1ZhbGlkLmNhbGwobnVsbCxocmVmLGhyZWZQcm9wKSAmJiBmdW5jdGlvbnMuX2ZpbmRUYXJnZXQuY2FsbChudWxsLGhyZWYpKXsKCQkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCV90cmlnZ2VyPSJzZWxlY3RvciI7CgkJCQkJCQlfY2xpY2tlZD0kdGhpczsKCQkJCQkJCWZ1bmN0aW9ucy5fc2V0Q2xhc3Nlcy5jYWxsKG51bGwsdHJ1ZSk7CgkJCQkJCQlmdW5jdGlvbnMuX3Njcm9sbFRvLmNhbGwobnVsbCk7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCQoJCQkJJCh3aW5kb3cpCgkJCQkKCQkJCS51bmJpbmQoIi4iK3BsdWdpblBmeCkKCQkJCQoJCQkJLmJpbmQoInNjcm9sbC4iK3BsdWdpblBmeCsiIHJlc2l6ZS4iK3BsdWdpblBmeCxmdW5jdGlvbigpewoJCQkJCWlmKGZ1bmN0aW9ucy5faXNEaXNhYmxlZC5jYWxsKG51bGwpKXsKCQkJCQkJZnVuY3Rpb25zLl9yZW1vdmVDbGFzc2VzLmNhbGwobnVsbCk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJdmFyIHRhcmdldHM9JCgiLl8iK3BsdWdpblBmeCsiLXQiKTsKCQkJCQl0YXJnZXRzLmVhY2goZnVuY3Rpb24oaSl7CgkJCQkJCXZhciB0PSQodGhpcyksaWQ9dC5hdHRyKCJpZCIpLAoJCQkJCQkJaD1mdW5jdGlvbnMuX2ZpbmRIaWdobGlnaHQuY2FsbChudWxsLGlkKTsKCQkJCQkJZnVuY3Rpb25zLl9zZXRDbGFzc2VzLmNhbGwobnVsbCxmYWxzZSx0LGgpOwoJCQkJCQlpZihpPT10YXJnZXRzLmxlbmd0aC0xKXtmdW5jdGlvbnMuX2V4dGVuZENsYXNzZXMuY2FsbChudWxsKTt9CgkJCQkJfSk7CgkJCQl9KTsKCQkJCQoJCQkJLyogcGx1Z2luIGhhcyBpbml0aWFsaXplZCAqLwoJCQkJCgkJCQlfaW5pdD10cnVlOwoJCQkJCgkJCQkvKiBzZXR1cCBzZWxlY3RvcnMsIHRhcmdldCBlbGVtZW50cywgYmFzaWMgcGx1Z2luIGNsYXNzZXMgZXRjLiAqLwoJCQkJCgkJCQlmdW5jdGlvbnMuX3NldHVwLmNhbGwobnVsbCk7CgkJCQkKCQkJCS8qIAoJCQkJbW9uaXRvciBmb3IgZWxlbWVudHMgbWF0Y2hpbmcgdGhlIGN1cnJlbnQgaGlnaGxpZ2h0IHNlbGVjdG9yIGFuZCBjYWxsIHBsdWdpbiBzZXR1cCB3aGVuIGZvdW5kIChub3cgYW5kIGluIHRoZSBmdXR1cmUpIAoJCQkJdG8gbWFudWFsbHkgZW5hYmxlL2Rpc2FibGU6ICQoZG9jdW1lbnQpLmRhdGEoIm1QUzJpZCIpLmxpdmU9Ym9vbGVhbiAKCQkJCSovCgkJCQkKCQkJCWZ1bmN0aW9ucy5fbGl2ZS5jYWxsKG51bGwpOwoJCQl9LAoJCQkKCQkJLyogc2Nyb2xsVG8gbWV0aG9kICovCgkJCQoJCQlzY3JvbGxUbzpmdW5jdGlvbihpZCxvcHRpb25zKXsKCQkJCWlmKGZ1bmN0aW9ucy5faXNEaXNhYmxlZC5jYWxsKG51bGwpKXsKCQkJCQlmdW5jdGlvbnMuX3JlbW92ZUNsYXNzZXMuY2FsbChudWxsKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZihpZCAmJiB0eXBlb2YgaWQhPT0idW5kZWZpbmVkIil7CgkJCQkJZnVuY3Rpb25zLl9pc0luaXQuY2FsbChudWxsKTsKCQkJCQl2YXIgZGVmYXVsdHM9ewoJCQkJCQkJbGF5b3V0Om9wdC5sYXlvdXQsCgkJCQkJCQlvZmZzZXQ6b3B0Lm9mZnNldCwKCQkJCQkJCWNsaWNrZWQ6ZmFsc2UKCQkJCQkJfSwKCQkJCQkJb3B0aW9ucz0kLmV4dGVuZCh0cnVlLHt9LGRlZmF1bHRzLG9wdGlvbnMpOwoJCQkJCWZ1bmN0aW9ucy5fcmVzZXQuY2FsbChudWxsKTsKCQkJCQlfYXhpcz1vcHRpb25zLmxheW91dDsKCQkJCQlfb2Zmc2V0PW9wdGlvbnMub2Zmc2V0OwoJCQkJCWlkPShpZC5pbmRleE9mKCIjIikhPT0tMSkgPyBpZCA6ICIjIitpZDsKCQkJCQlpZihmdW5jdGlvbnMuX2lzVmFsaWQuY2FsbChudWxsLGlkKSAmJiBmdW5jdGlvbnMuX2ZpbmRUYXJnZXQuY2FsbChudWxsLGlkKSl7CgkJCQkJCV90cmlnZ2VyPSJzY3JvbGxUbyI7CgkJCQkJCV9jbGlja2VkPW9wdGlvbnMuY2xpY2tlZDsKCQkJCQkJaWYoX2NsaWNrZWQpewoJCQkJCQkJZnVuY3Rpb25zLl9zZXRDbGFzc2VzLmNhbGwobnVsbCx0cnVlKTsKCQkJCQkJfQoJCQkJCQlmdW5jdGlvbnMuX3Njcm9sbFRvLmNhbGwobnVsbCk7CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQkKCQkJLyogZGVzdHJveSBtZXRob2QgKi8KCQkJCgkJCWRlc3Ryb3k6ZnVuY3Rpb24oKXsKCQkJCSQod2luZG93KS51bmJpbmQoIi4iK3BsdWdpblBmeCk7CgkJCQkkKGRvY3VtZW50KS51bmRlbGVnYXRlKCIuIitwbHVnaW5QZngpLnJlbW92ZURhdGEocGx1Z2luUGZ4KTsKCQkJCSQoIi5fIitwbHVnaW5QZngrIi10IikucmVtb3ZlRGF0YShwbHVnaW5QZngpOwoJCQkJZnVuY3Rpb25zLl9yZW1vdmVDbGFzc2VzLmNhbGwobnVsbCx0cnVlKTsKCQkJfQoJCX0sCgkKCS8qIAoJLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbnMKCS0tLS0tLS0tLS0tLS0tLQoJKi8KCQoJCWZ1bmN0aW9ucz17CgkJCQoJCQkvKiBjaGVja3MgaWYgc2NyZWVuIHNpemUgKFt4LHldKSBpcyBiZWxvdyB0aGUgdmFsdWUocykgc2V0IGluIGRpc2FibGVQbHVnaW5CZWxvdyBvcHRpb24gKi8KCQkJCgkJCV9pc0Rpc2FibGVkOmZ1bmN0aW9uKCl7CgkJCQl2YXIgZT13aW5kb3csYT0iaW5uZXIiLAoJCQkJCXZhbD1vcHQuZGlzYWJsZVBsdWdpbkJlbG93IGluc3RhbmNlb2YgQXJyYXkgPyBbb3B0LmRpc2FibGVQbHVnaW5CZWxvd1swXSB8fCAwLG9wdC5kaXNhYmxlUGx1Z2luQmVsb3dbMV0gfHwgMF0gOiBbb3B0LmRpc2FibGVQbHVnaW5CZWxvdyB8fCAwLDBdOwoJCQkJaWYoISgiaW5uZXJXaWR0aCIgaW4gd2luZG93ICkpewoJCQkJCWE9ImNsaWVudCI7CgkJCQkJZT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keTsKCQkJCX0KCQkJCXJldHVybiBlW2ErIldpZHRoIl08PXZhbFswXSB8fCBlW2ErIkhlaWdodCJdPD12YWxbMV07CgkJCX0sCgkJCQoJCQkvKiBjaGVja3MgaWYgaHJlZiBhdHRyaWJ1dGUgaXMgdmFsaWQgKi8KCQkJCgkJCV9pc1ZhbGlkOmZ1bmN0aW9uKGhyZWYsaHJlZlByb3ApewoJCQkJaWYoIWhyZWYpewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWhyZWZQcm9wPSghaHJlZlByb3ApID8gaHJlZiA6IGhyZWZQcm9wOwoJCQkJdmFyIHN0cj0oaHJlZlByb3AuaW5kZXhPZigiIy8iKSE9PS0xKSA/IGhyZWZQcm9wLnNwbGl0KCIjLyIpWzBdIDogaHJlZlByb3Auc3BsaXQoIiMiKVswXSwKCQkJCQlsb2M9d2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoIiMiKVswXTsKCQkJCXJldHVybiBocmVmIT09IiMiICYmIGhyZWYuaW5kZXhPZigiIyIpIT09LTEgJiYgKHN0cj09PSIiIHx8IHN0cj09PWxvYyk7CgkJCX0sCgkJCQoJCQkvKiBzZXR1cCBzZWxlY3RvcnMsIHRhcmdldCBlbGVtZW50cywgYmFzaWMgcGx1Z2luIGNsYXNzZXMgZXRjLiAqLwoJCQkKCQkJX3NldHVwOmZ1bmN0aW9uKCl7CgkJCQl2YXIgZWw9ZnVuY3Rpb25zLl9oaWdobGlnaHRTZWxlY3RvcigpLGk9MSx0cD0wOwoJCQkJcmV0dXJuICQoZWwpLmVhY2goZnVuY3Rpb24oKXsKCQkJCQl2YXIgJHRoaXM9JCh0aGlzKSxocmVmPSR0aGlzLmF0dHIoImhyZWYiKSxocmVmUHJvcD0kdGhpcy5wcm9wKCJocmVmIik7CgkJCQkJaWYoZnVuY3Rpb25zLl9pc1ZhbGlkLmNhbGwobnVsbCxocmVmLGhyZWZQcm9wKSl7CgkJCQkJCXZhciBpZD0oaHJlZi5pbmRleE9mKCIjLyIpIT09LTEpID8gaHJlZi5zcGxpdCgiIy8iKVsxXSA6IGhyZWYuc3BsaXQoIiMiKVsxXSx0PSQoIiMiK2lkKTsgCgkJCQkJCWlmKHQubGVuZ3RoPjApewoJCQkJCQkJaWYob3B0LmhpZ2hsaWdodEJ5TmV4dFRhcmdldCl7CgkJCQkJCQkJaWYodCE9PXRwKXsKCQkJCQkJCQkJaWYoIXRwKXt0LmRhdGEocGx1Z2luUGZ4LHt0bjoiMCJ9KTt9ZWxzZXt0cC5kYXRhKHBsdWdpblBmeCx7dG46dH0pO30KCQkJCQkJCQkJdHA9dDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZighdC5oYXNDbGFzcygiXyIrcGx1Z2luUGZ4KyItdCIpKXsKCQkJCQkJCQl0LmFkZENsYXNzKCJfIitwbHVnaW5QZngrIi10Iik7CgkJCQkJCQl9CgkJCQkJCQl0LmRhdGEocGx1Z2luUGZ4LHtpOml9KTsKCQkJCQkJCWlmKCEkdGhpcy5oYXNDbGFzcygiXyIrcGx1Z2luUGZ4KyItaCIpKXsKCQkJCQkJCQkkdGhpcy5hZGRDbGFzcygiXyIrcGx1Z2luUGZ4KyItaCIpOwoJCQkJCQkJfQoJCQkJCQkJdmFyIGg9ZnVuY3Rpb25zLl9maW5kSGlnaGxpZ2h0LmNhbGwobnVsbCxpZCk7CgkJCQkJCQlmdW5jdGlvbnMuX3NldENsYXNzZXMuY2FsbChudWxsLGZhbHNlLHQsaCk7CgkJCQkJCQlfdG90YWxJbnN0YW5jZXM9aTsKCQkJCQkJCWkrKwoJCQkJCQkJaWYoaT09JChlbCkubGVuZ3RoKXtmdW5jdGlvbnMuX2V4dGVuZENsYXNzZXMuY2FsbChudWxsKTt9CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJfSwKCQkJCgkJCS8qIHJldHVybnMgdGhlIGhpZ2hsaWdodCBzZWxlY3RvciAqLwoJCQkKCQkJX2hpZ2hsaWdodFNlbGVjdG9yOmZ1bmN0aW9uKCl7CgkJCQlyZXR1cm4gKG9wdC5oaWdobGlnaHRTZWxlY3RvciAmJiBvcHQuaGlnaGxpZ2h0U2VsZWN0b3IhPT0iIikgPyBvcHQuaGlnaGxpZ2h0U2VsZWN0b3IgOiBzZWxlY3RvcjsKCQkJfSwKCQkJCgkJCS8qIGZpbmRzIHRoZSB0YXJnZXQgZWxlbWVudCAqLwoJCQkKCQkJX2ZpbmRUYXJnZXQ6ZnVuY3Rpb24oc3RyKXsKCQkJCXZhciB2YWw9KHN0ci5pbmRleE9mKCIjLyIpIT09LTEpID8gc3RyLnNwbGl0KCIjLyIpWzFdIDogc3RyLnNwbGl0KCIjIilbMV0sIAoJCQkJCWVsPSQoIiMiK3ZhbCk7CgkJCQlpZihlbC5sZW5ndGg8MSB8fCBlbC5jc3MoInBvc2l0aW9uIik9PT0iZml4ZWQiKXsKCQkJCQlpZih2YWw9PT0idG9wIil7CgkJCQkJCWVsPSQoImJvZHkiKTsKCQkJCQl9ZWxzZXsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCV90YXJnZXQ9ZWw7CgkJCQlpZighX2F4aXMpewoJCQkJCV9heGlzPW9wdC5sYXlvdXQ7CgkJCQl9CgkJCQlfb2Zmc2V0PWZ1bmN0aW9ucy5fc2V0T2Zmc2V0LmNhbGwobnVsbCk7CgkJCQlfdG89WyhlbC5vZmZzZXQoKS50b3AtX29mZnNldFswXSkudG9TdHJpbmcoKSwoZWwub2Zmc2V0KCkubGVmdC1fb2Zmc2V0WzFdKS50b1N0cmluZygpXTsgCgkJCQlfdG9bMF09KF90b1swXTwwKSA/IDAgOiBfdG9bMF07CgkJCQlfdG9bMV09KF90b1sxXTwwKSA/IDAgOiBfdG9bMV07CgkJCQlyZXR1cm4gX3RvOwoJCQl9LAoJCQkKCQkJLyogc2V0cyB0aGUgb2Zmc2V0IHZhbHVlIChwaXhlbHMsIG9iamVjdHMgZXRjLikgKi8KCQkJCgkJCV9zZXRPZmZzZXQ6ZnVuY3Rpb24oKXsKCQkJCWlmKCFfb2Zmc2V0KXsKCQkJCQlfb2Zmc2V0PShvcHQub2Zmc2V0KSA/IG9wdC5vZmZzZXQgOiAwOwoJCQkJfQoJCQkJaWYoX2RhdGFPZmZzZXQpewoJCQkJCV9vZmZzZXQ9X2RhdGFPZmZzZXQ7CgkJCQl9CgkJCQl2YXIgdmFsLG9iaix5LHg7CgkJCQlzd2l0Y2godHlwZW9mIF9vZmZzZXQpewoJCQkJCWNhc2UgIm9iamVjdCI6CgkJCQkJY2FzZSAic3RyaW5nIjoKCQkJCQkJdmFsPVsoX29mZnNldFsieSJdKSA/IF9vZmZzZXRbInkiXSA6IF9vZmZzZXQsKF9vZmZzZXRbIngiXSkgPyBfb2Zmc2V0WyJ4Il0gOiBfb2Zmc2V0XTsKCQkJCQkJb2JqPVsodmFsWzBdIGluc3RhbmNlb2YgalF1ZXJ5KSA/IHZhbFswXSA6ICQodmFsWzBdKSwodmFsWzFdIGluc3RhbmNlb2YgalF1ZXJ5KSA/IHZhbFsxXSA6ICQodmFsWzFdKV07CgkJCQkJCWlmKG9ialswXS5sZW5ndGg+MCl7IC8vIGpzL2pxdWVyeSBvYmplY3QKCQkJCQkJCXk9b2JqWzBdLmhlaWdodCgpOwoJCQkJCQkJaWYob2JqWzBdLmNzcygicG9zaXRpb24iKT09PSJmaXhlZCIpeyAvLyBpbmNsdWRlIHBvc2l0aW9uIGZvciBmaXhlZCBlbGVtZW50cwoJCQkJCQkJCXkrPW9ialswXVswXS5vZmZzZXRUb3A7CgkJCQkJCQl9CgkJCQkJCX1lbHNlIGlmKCFpc05hTihwYXJzZUZsb2F0KHZhbFswXSkpICYmIGlzRmluaXRlKHZhbFswXSkpeyAvLyBudW1lcmljIHN0cmluZwoJCQkJCQkJeT1wYXJzZUludCh2YWxbMF0pOwoJCQkJCQl9ZWxzZXsKCQkJCQkJCXk9MDsgLy8gbm9uLWV4aXN0aW5nIHZhbHVlCgkJCQkJCX0KCQkJCQkJaWYob2JqWzFdLmxlbmd0aD4wKXsgLy8ganMvanF1ZXJ5IG9iamVjdAoJCQkJCQkJeD1vYmpbMV0ud2lkdGgoKTsKCQkJCQkJCWlmKG9ialsxXS5jc3MoInBvc2l0aW9uIik9PT0iZml4ZWQiKXsgLy8gaW5jbHVkZSBwb3NpdGlvbiBmb3IgZml4ZWQgZWxlbWVudHMKCQkJCQkJCQl4Kz1vYmpbMV1bMF0ub2Zmc2V0TGVmdDsKCQkJCQkJCX0KCQkJCQkJfWVsc2UgaWYoIWlzTmFOKHBhcnNlRmxvYXQodmFsWzFdKSkgJiYgaXNGaW5pdGUodmFsWzFdKSl7IC8vIG51bWVyaWMgc3RyaW5nCgkJCQkJCQl4PXBhcnNlSW50KHZhbFsxXSk7CgkJCQkJCX1lbHNlewoJCQkJCQkJeD0wOyAvLyBub24tZXhpc3RpbmcgdmFsdWUKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJmdW5jdGlvbiI6CgkJCQkJCXZhbD1fb2Zmc2V0LmNhbGwobnVsbCk7IC8vIGZ1bmN0aW9uIChzaW5nbGUgdmFsdWUgb3IgYXJyYXkpCgkJCQkJCWlmKHZhbCBpbnN0YW5jZW9mIEFycmF5KXsKCQkJCQkJCXk9dmFsWzBdOwoJCQkJCQkJeD12YWxbMV07CgkJCQkJCX1lbHNlewoJCQkJCQkJeT14PXZhbDsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQl5PXg9cGFyc2VJbnQoX29mZnNldCk7IC8vIG51bWJlcgoJCQkJfQoJCQkJcmV0dXJuIFt5LHhdOwoJCQl9LAoJCQkKCQkJLyogZmluZHMgdGhlIGVsZW1lbnQgdGhhdCBzaG91bGQgYmUgaGlnaGxpZ2h0ZWQgKi8KCQkJCgkJCV9maW5kSGlnaGxpZ2h0OmZ1bmN0aW9uKGlkKXsKCQkJCXZhciBsb2M9d2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoIiMiKVswXSwKCQkJCQloSGFzaD0kKCIuXyIrcGx1Z2luUGZ4KyItaFtocmVmPScjIitpZCsiJ10iKSwKCQkJCQlsaEhhc2g9JCgiLl8iK3BsdWdpblBmeCsiLWhbaHJlZj0nIitsb2MrIiMiK2lkKyInXSIpLAoJCQkJCWhIYXNoU2xhc2g9JCgiLl8iK3BsdWdpblBmeCsiLWhbaHJlZj0nIy8iK2lkKyInXSIpLAoJCQkJCWxoSGFzaFNsYXNoPSQoIi5fIitwbHVnaW5QZngrIi1oW2hyZWY9JyIrbG9jKyIjLyIraWQrIiddIik7CgkJCQloSGFzaD0oaEhhc2gubGVuZ3RoPjApID8gaEhhc2ggOiBsaEhhc2g7CgkJCQloSGFzaFNsYXNoPShoSGFzaFNsYXNoLmxlbmd0aD4wKSA/IGhIYXNoU2xhc2ggOiBsaEhhc2hTbGFzaDsKCQkJCXJldHVybiAoaEhhc2hTbGFzaC5sZW5ndGg+MCkgPyBoSGFzaFNsYXNoIDogaEhhc2g7CgkJCX0sCgkJCQoJCQkvKiBzZXRzIHBsdWdpbiBjbGFzc2VzICovCgkJCQoJCQlfc2V0Q2xhc3NlczpmdW5jdGlvbihjLHQsaCl7CgkJCQl2YXIgY2M9b3B0LmNsaWNrZWRDbGFzcyx0Yz1vcHQudGFyZ2V0Q2xhc3MsaGM9b3B0LmhpZ2hsaWdodENsYXNzOwoJCQkJaWYoYyAmJiBjYyAmJiBjYyE9PSIiKXsKCQkJCQkkKCIuIitjYykucmVtb3ZlQ2xhc3MoY2MpOwoJCQkJCV9jbGlja2VkLmFkZENsYXNzKGNjKTsKCQkJCX1lbHNlIGlmKHQgJiYgdGMgJiYgdGMhPT0iIiAmJiBoICYmIGhjICYmIGhjIT09IiIpewoJCQkJCWlmKGZ1bmN0aW9ucy5fY3VycmVudFRhcmdldC5jYWxsKG51bGwsdCkpewoJCQkJCQl0LmFkZENsYXNzKHRjKTsKCQkJCQkJaC5hZGRDbGFzcyhoYyk7CgkJCQkJfWVsc2V7CgkJCQkJCWlmKCFvcHQua2VlcEhpZ2hsaWdodFVudGlsTmV4dCB8fCAkKCIuIitoYykubGVuZ3RoPjEpewoJCQkJCQkJdC5yZW1vdmVDbGFzcyh0Yyk7CgkJCQkJCQloLnJlbW92ZUNsYXNzKGhjKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfSwKCQkJCgkJCS8qIGV4dGVuZHMgcGx1Z2luIGNsYXNzZXMgKi8KCQkJCgkJCV9leHRlbmRDbGFzc2VzOmZ1bmN0aW9uKCl7CgkJCQl2YXIgdGM9b3B0LnRhcmdldENsYXNzLGhjPW9wdC5oaWdobGlnaHRDbGFzcywKCQkJCQkkdGM9JCgiLiIrdGMpLCRoYz0kKCIuIitoYyksZnRjPXRjKyItZmlyc3QiLGx0Yz10YysiLWxhc3QiLGZoYz1oYysiLWZpcnN0IixsaGM9aGMrIi1sYXN0IjsKCQkJCSQoIi5fIitwbHVnaW5QZngrIi10IikucmVtb3ZlQ2xhc3MoZnRjKyIgIitsdGMpOwoJCQkJJCgiLl8iK3BsdWdpblBmeCsiLWgiKS5yZW1vdmVDbGFzcyhmaGMrIiAiK2xoYyk7CgkJCQlpZighb3B0LmZvcmNlU2luZ2xlSGlnaGxpZ2h0KXsKCQkJCQkkdGMuc2xpY2UoMCwxKS5hZGRDbGFzcyhmdGMpLmVuZCgpLnNsaWNlKC0xKS5hZGRDbGFzcyhsdGMpOwoJCQkJCSRoYy5zbGljZSgwLDEpLmFkZENsYXNzKGZoYykuZW5kKCkuc2xpY2UoLTEpLmFkZENsYXNzKGxoYyk7CgkJCQl9ZWxzZXsKCQkJCQlpZihvcHQua2VlcEhpZ2hsaWdodFVudGlsTmV4dCAmJiAkdGMubGVuZ3RoPjEpewoJCQkJCQkkdGMuc2xpY2UoMCwxKS5yZW1vdmVDbGFzcyh0Yyk7ICRoYy5zbGljZSgwLDEpLnJlbW92ZUNsYXNzKGhjKTsKCQkJCQl9ZWxzZXsKCQkJCQkJJHRjLnNsaWNlKDEpLnJlbW92ZUNsYXNzKHRjKTsgJGhjLnNsaWNlKDEpLnJlbW92ZUNsYXNzKGhjKTsKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCQoJCQkvKiByZW1vdmVzIHBsdWdpbiBjbGFzc2VzICovCgkJCQoJCQlfcmVtb3ZlQ2xhc3NlczpmdW5jdGlvbihkZXN0cm95KXsKCQkJCSQoIi4iK29wdC5jbGlja2VkQ2xhc3MpLnJlbW92ZUNsYXNzKG9wdC5jbGlja2VkQ2xhc3MpOwoJCQkJJCgiLiIrb3B0LnRhcmdldENsYXNzKS5yZW1vdmVDbGFzcyhvcHQudGFyZ2V0Q2xhc3MrIiAiK29wdC50YXJnZXRDbGFzcysiLWZpcnN0ICIrb3B0LnRhcmdldENsYXNzKyItbGFzdCIpOwoJCQkJJCgiLiIrb3B0LmhpZ2hsaWdodENsYXNzKS5yZW1vdmVDbGFzcyhvcHQuaGlnaGxpZ2h0Q2xhc3MrIiAiK29wdC5oaWdobGlnaHRDbGFzcysiLWZpcnN0ICIrb3B0LmhpZ2hsaWdodENsYXNzKyItbGFzdCIpOwoJCQkJaWYoZGVzdHJveSl7CgkJCQkJJCgiLl8iK3BsdWdpblBmeCsiLXQiKS5yZW1vdmVDbGFzcygiXyIrcGx1Z2luUGZ4KyItdCIpOwoJCQkJCSQoIi5fIitwbHVnaW5QZngrIi1oIikucmVtb3ZlQ2xhc3MoIl8iK3BsdWdpblBmeCsiLWgiKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qIGNoZWNrcyBpZiB0YXJnZXQgZWxlbWVudCBpcyBpbiB2aWV3cG9ydCAqLwoJCQkKCQkJX2N1cnJlbnRUYXJnZXQ6ZnVuY3Rpb24odCl7CgkJCQl2YXIgbz1vcHRbInRhcmdldF8iK3QuZGF0YShwbHVnaW5QZngpLmldLAoJCQkJCWRhdGFUYXJnZXQ9dC5kYXRhKCJwczJpZC10YXJnZXQiKSwKCQkJCQlyZWN0PWRhdGFUYXJnZXQgPyAkKGRhdGFUYXJnZXQpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogdFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQkJCWlmKHR5cGVvZiBvIT09InVuZGVmaW5lZCIpewoJCQkJCXZhciB5PXQub2Zmc2V0KCkudG9wLHg9dC5vZmZzZXQoKS5sZWZ0LAoJCQkJCQlmcm9tPShvLmZyb20pID8gby5mcm9tK3kgOiB5LHRvPShvLnRvKSA/IG8udG8reSA6IHksCgkJCQkJCWZyb21YPShvLmZyb21YKSA/IG8uZnJvbVgreCA6IHgsdG9YPShvLnRvWCkgPyBvLnRvWCt4IDogeDsKCQkJCQlyZXR1cm4oCgkJCQkJCXJlY3QudG9wID49IHRvICYmIHJlY3QudG9wIDw9IGZyb20gJiYgCgkJCQkJCXJlY3QubGVmdCA+PSB0b1ggJiYgcmVjdC5sZWZ0IDw9IGZyb21YCgkJCQkJKTsKCQkJCX1lbHNlewoJCQkJCXZhciB3aD0kKHdpbmRvdykuaGVpZ2h0KCksd3c9JCh3aW5kb3cpLndpZHRoKCksCgkJCQkJCXRoPWRhdGFUYXJnZXQgPyAkKGRhdGFUYXJnZXQpLmhlaWdodCgpIDogdC5oZWlnaHQoKSx0dz1kYXRhVGFyZ2V0ID8gJChkYXRhVGFyZ2V0KS53aWR0aCgpIDogdC53aWR0aCgpLAoJCQkJCQliYXNlPTErKHRoL3doKSwKCQkJCQkJdG9wPWJhc2UsYm90dG9tPSh0aDx3aCkgPyBiYXNlKih3aC90aCkgOiBiYXNlLAoJCQkJCQliYXNlWD0xKyh0dy93dyksCgkJCQkJCWxlZnQ9YmFzZVgscmlnaHQ9KHR3PHd3KSA/IGJhc2VYKih3dy90dykgOiBiYXNlWCwKCQkJCQkJdmFsPVtyZWN0LnRvcCA8PSB3aC90b3AscmVjdC5ib3R0b20gPj0gd2gvYm90dG9tLHJlY3QubGVmdCA8PSB3dy9sZWZ0LHJlY3QucmlnaHQgPj0gd3cvcmlnaHRdOwoJCQkJCWlmKG9wdC5oaWdobGlnaHRCeU5leHRUYXJnZXQpewoJCQkJCQl2YXIgdG49dC5kYXRhKHBsdWdpblBmeCkudG47CgkJCQkJCWlmKHRuKXsKCQkJCQkJCXZhciByZWN0bj10blswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQkJCQkJCWlmKG9wdC5sYXlvdXQ9PT0idmVydGljYWwiKXsKCQkJCQkJCQl2YWw9W3JlY3QudG9wIDw9IHdoLzIscmVjdG4udG9wID4gd2gvMiwxLDFdOwoJCQkJCQkJfWVsc2UgaWYob3B0LmxheW91dD09PSJob3Jpem9udGFsIil7CgkJCQkJCQkJdmFsPVsxLDEscmVjdC5sZWZ0IDw9IHd3LzIscmVjdG4ubGVmdCA+IHd3LzJdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCXJldHVybih2YWxbMF0gJiYgdmFsWzFdICYmIHZhbFsyXSAmJiB2YWxbM10pOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyogc2Nyb2xscyB0aGUgcGFnZSAqLwoJCQkKCQkJX3Njcm9sbFRvOmZ1bmN0aW9uKCl7CgkJCQlvcHQuc2Nyb2xsU3BlZWQ9cGFyc2VJbnQob3B0LnNjcm9sbFNwZWVkKTsKCQkJCV90bz0ob3B0LnBhZ2VFbmRTbW9vdGhTY3JvbGwpID8gZnVuY3Rpb25zLl9wYWdlRW5kU21vb3RoU2Nyb2xsLmNhbGwobnVsbCkgOiBfdG87CgkJCQl2YXIgZWw9JCgiaHRtbCxib2R5IiksCgkJCQkJc3BlZWQ9KG9wdC5hdXRvU2Nyb2xsU3BlZWQpID8gZnVuY3Rpb25zLl9hdXRvU2Nyb2xsU3BlZWQuY2FsbChudWxsKSA6IG9wdC5zY3JvbGxTcGVlZCwKCQkJCQllYXNpbmc9KGVsLmlzKCI6YW5pbWF0ZWQiKSkgPyBvcHQuc2Nyb2xsaW5nRWFzaW5nIDogb3B0LnNjcm9sbEVhc2luZywKCQkJCQlfdD0kKHdpbmRvdykuc2Nyb2xsVG9wKCksX2w9JCh3aW5kb3cpLnNjcm9sbExlZnQoKTsKCQkJCXN3aXRjaChfYXhpcyl7CgkJCQkJY2FzZSAiaG9yaXpvbnRhbCI6CgkJCQkJCWlmKF9sIT1fdG9bMV0pewoJCQkJCQkJZnVuY3Rpb25zLl9jYWxsYmFja3MuY2FsbChudWxsLCJvblN0YXJ0Iik7CgkJCQkJCQllbC5zdG9wKCkuYW5pbWF0ZSh7c2Nyb2xsTGVmdDpfdG9bMV19LHNwZWVkLGVhc2luZykucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24oKXsKCQkJCQkJCQlmdW5jdGlvbnMuX2NhbGxiYWNrcy5jYWxsKG51bGwsIm9uQ29tcGxldGUiKTsKCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImF1dG8iOgoJCQkJCQlpZihfdCE9X3RvWzBdIHx8IF9sIT1fdG9bMV0pewoJCQkJCQkJZnVuY3Rpb25zLl9jYWxsYmFja3MuY2FsbChudWxsLCJvblN0YXJ0Iik7CgkJCQkJCQlpZihuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8oaVBvZHxpUGhvbmV8aVBhZHxBbmRyb2lkKS8pKXsgLy8gbW9iaWxlIGZpeAoJCQkJCQkJCXZhciBsZWZ0OwoJCQkJCQkJCWVsLnN0b3AoKS5hbmltYXRlKHtwYWdlWU9mZnNldDpfdG9bMF0scGFnZVhPZmZzZXQ6X3RvWzFdfSx7CgkJCQkJCQkJICAgIGR1cmF0aW9uOnNwZWVkLAoJCQkJCQkJCSAgICBlYXNpbmc6ZWFzaW5nLAoJCQkJCQkJCSAgICBzdGVwOmZ1bmN0aW9uKG5vdyxmeCl7CgkJCQkJCQkJICAgICAgICBpZihmeC5wcm9wPT0ncGFnZVhPZmZzZXQnKXsKCQkJCQkJCQkgICAgICAgICAgICBsZWZ0PW5vdzsKCQkJCQkJCQkgICAgICAgIH1lbHNlIGlmKGZ4LnByb3A9PSdwYWdlWU9mZnNldCcpewoJCQkJCQkJCSAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyhsZWZ0LG5vdyk7CgkJCQkJCQkJICAgICAgICB9CgkJCQkJCQkJICAgIH0KCQkJCQkJCQl9KS5wcm9taXNlKCkudGhlbihmdW5jdGlvbigpewoJCQkJCQkJCQlmdW5jdGlvbnMuX2NhbGxiYWNrcy5jYWxsKG51bGwsIm9uQ29tcGxldGUiKTsKCQkJCQkJCQl9KTsKCQkJCQkJCX1lbHNlewoJCQkJCQkJCWVsLnN0b3AoKS5hbmltYXRlKHtzY3JvbGxUb3A6X3RvWzBdLHNjcm9sbExlZnQ6X3RvWzFdfSxzcGVlZCxlYXNpbmcpLnByb21pc2UoKS50aGVuKGZ1bmN0aW9uKCl7CgkJCQkJCQkJCWZ1bmN0aW9ucy5fY2FsbGJhY2tzLmNhbGwobnVsbCwib25Db21wbGV0ZSIpOwoJCQkJCQkJCX0pOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWlmKF90IT1fdG9bMF0pewoJCQkJCQkJZnVuY3Rpb25zLl9jYWxsYmFja3MuY2FsbChudWxsLCJvblN0YXJ0Iik7CgkJCQkJCQllbC5zdG9wKCkuYW5pbWF0ZSh7c2Nyb2xsVG9wOl90b1swXX0sc3BlZWQsZWFzaW5nKS5wcm9taXNlKCkudGhlbihmdW5jdGlvbigpewoJCQkJCQkJCWZ1bmN0aW9ucy5fY2FsbGJhY2tzLmNhbGwobnVsbCwib25Db21wbGV0ZSIpOwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCX0KCQkJfSwKCQkJCgkJCS8qIHNldHMgZW5kIG9mIHBhZ2UgInNtb290aCBzY3JvbGxpbmciIHBvc2l0aW9uICovCgkJCQoJCQlfcGFnZUVuZFNtb290aFNjcm9sbDpmdW5jdGlvbigpewoJCQkJdmFyIF9kaD0kKGRvY3VtZW50KS5oZWlnaHQoKSxfZHc9JChkb2N1bWVudCkud2lkdGgoKSwKCQkJCQlfd2g9JCh3aW5kb3cpLmhlaWdodCgpLF93dz0kKHdpbmRvdykud2lkdGgoKTsKCQkJCXJldHVybiBbKChfZGgtX3RvWzBdKTxfd2gpID8gX2RoLV93aCA6IF90b1swXSwoKF9kdy1fdG9bMV0pPF93dykgPyBfZHctX3d3IDogX3RvWzFdXTsKCQkJfSwKCQkJCgkJCS8qIHNldHMgdGhlIGF1dG8tYWRqdXN0ZWQgYW5pbWF0aW9uIHNwZWVkICovCgkJCQoJCQlfYXV0b1Njcm9sbFNwZWVkOmZ1bmN0aW9uKCl7CgkJCQl2YXIgX3Q9JCh3aW5kb3cpLnNjcm9sbFRvcCgpLF9sPSQod2luZG93KS5zY3JvbGxMZWZ0KCksCgkJCQkJX2g9JChkb2N1bWVudCkuaGVpZ2h0KCksX3c9JChkb2N1bWVudCkud2lkdGgoKSwKCQkJCQl2YWw9WwoJCQkJCQlvcHQuc2Nyb2xsU3BlZWQrKChvcHQuc2Nyb2xsU3BlZWQqKE1hdGguZmxvb3IoKE1hdGguYWJzKF90b1swXS1fdCkvX2gpKjEwMCkpKS8xMDApLAoJCQkJCQlvcHQuc2Nyb2xsU3BlZWQrKChvcHQuc2Nyb2xsU3BlZWQqKE1hdGguZmxvb3IoKE1hdGguYWJzKF90b1sxXS1fbCkvX3cpKjEwMCkpKS8xMDApCgkJCQkJXTsKCQkJCXJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLHZhbCk7CgkJCX0sCgkJCQoJCQkvKiB1c2VyIGNhbGxiYWNrIGZ1bmN0aW9ucyAqLwoJCQkKCQkJX2NhbGxiYWNrczpmdW5jdGlvbihjKXsKCQkJCWlmKCFvcHQpewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCXRoaXNbcGx1Z2luUGZ4XT17CgkJCQkJdHJpZ2dlcjpfdHJpZ2dlcixjbGlja2VkOl9jbGlja2VkLHRhcmdldDpfdGFyZ2V0LHNjcm9sbFRvOnt5Ol90b1swXSx4Ol90b1sxXX0KCQkJCX07CgkJCQlzd2l0Y2goYyl7CgkJCQkJY2FzZSAib25TdGFydCI6CgkJCQkJCW9wdC5vblN0YXJ0LmNhbGwobnVsbCx0aGlzW3BsdWdpblBmeF0pOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJvbkNvbXBsZXRlIjoKCQkJCQkJb3B0Lm9uQ29tcGxldGUuY2FsbChudWxsLHRoaXNbcGx1Z2luUGZ4XSk7CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyogcmVzZXRzL2NsZWFycyB2YXJzIGFuZCBjb25zdGFudHMgKi8KCQkJCgkJCV9yZXNldDpmdW5jdGlvbigpewoJCQkJX2F4aXM9X29mZnNldD1fZGF0YU9mZnNldD1mYWxzZTsKCQkJfSwKCQkJCgkJCS8qIGNoZWNrcyBpZiBwbHVnaW4gaGFzIGluaXRpYWxpemVkICovCgkJCQoJCQlfaXNJbml0OmZ1bmN0aW9uKCl7CgkJCQlpZighX2luaXQpewoJCQkJCW1ldGhvZHMuaW5pdC5hcHBseSh0aGlzKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qIGxpdmUgZm4gKi8KCQkJCgkJCV9saXZlOmZ1bmN0aW9uKCl7CgkJCQlfbGl2ZVRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCQlpZihvcHQubGl2ZSl7CgkJCQkJCWlmKCQoZnVuY3Rpb25zLl9oaWdobGlnaHRTZWxlY3RvcigpKS5sZW5ndGghPT1fdG90YWxJbnN0YW5jZXMpewoJCQkJCQkJZnVuY3Rpb25zLl9zZXR1cC5jYWxsKG51bGwpOwoJCQkJCQl9CgkJCQkJfWVsc2V7CgkJCQkJCWlmKF9saXZlVGltZXIpe2NsZWFyVGltZW91dChfbGl2ZVRpbWVyKTt9CgkJCQkJfQoJCQkJCWZ1bmN0aW9ucy5fbGl2ZS5jYWxsKG51bGwpOwoJCQkJfSwxMDAwKTsKCQkJfSwKCQkJCgkJCS8qIGV4dGVuZHMganF1ZXJ5IHdpdGggY3VzdG9tIGVhc2luZ3MgKGFzIGpxdWVyeSB1aSkgKi8KCQkJCgkJCV9lYXNpbmc6ZnVuY3Rpb24oKXsKCQkJCSQuZWFzaW5nLmVhc2VJblF1YWQ9JC5lYXNpbmcuZWFzZUluUXVhZCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKih0Lz1kKSp0ICsgYjt9OwkKCQkJCSQuZWFzaW5nLmVhc2VPdXRRdWFkPSQuZWFzaW5nLmVhc2VPdXRRdWFkIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIC1jICoodC89ZCkqKHQtMikgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRRdWFkPSQuZWFzaW5nLmVhc2VJbk91dFF1YWQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQgKyBiOwoJCQkJCQlyZXR1cm4gLWMvMiAqICgoLS10KSoodC0yKSAtIDEpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluQ3ViaWM9JC5lYXNpbmcuZWFzZUluQ3ViaWMgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gYyoodC89ZCkqdCp0ICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZU91dEN1YmljPSQuZWFzaW5nLmVhc2VPdXRDdWJpYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKigodD10L2QtMSkqdCp0ICsgMSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRDdWJpYz0kLmVhc2luZy5lYXNlSW5PdXRDdWJpYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKnQqdCp0ICsgYjsKCQkJCQkJcmV0dXJuIGMvMiooKHQtPTIpKnQqdCArIDIpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluUXVhcnQ9JC5lYXNpbmcuZWFzZUluUXVhcnQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gYyoodC89ZCkqdCp0KnQgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0UXVhcnQ9JC5lYXNpbmcuZWFzZU91dFF1YXJ0IHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIC1jICogKCh0PXQvZC0xKSp0KnQqdCAtIDEpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0UXVhcnQ9JC5lYXNpbmcuZWFzZUluT3V0UXVhcnQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQqdCp0ICsgYjsKCQkJCQkJcmV0dXJuIC1jLzIgKiAoKHQtPTIpKnQqdCp0IC0gMikgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5RdWludD0kLmVhc2luZy5lYXNlSW5RdWludCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKih0Lz1kKSp0KnQqdCp0ICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZU91dFF1aW50PSQuZWFzaW5nLmVhc2VPdXRRdWludCB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiBjKigodD10L2QtMSkqdCp0KnQqdCArIDEpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0UXVpbnQ9JC5lYXNpbmcuZWFzZUluT3V0UXVpbnQgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQqdCp0KnQgKyBiOwoJCQkJCQlyZXR1cm4gYy8yKigodC09MikqdCp0KnQqdCArIDIpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluRXhwbz0kLmVhc2luZy5lYXNlSW5FeHBvIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuICh0PT0wKSA/IGIgOiBjICogTWF0aC5wb3coMiwgMTAgKiAodC9kIC0gMSkpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZU91dEV4cG89JC5lYXNpbmcuZWFzZU91dEV4cG8gfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gKHQ9PWQpID8gYitjIDogYyAqICgtTWF0aC5wb3coMiwgLTEwICogdC9kKSArIDEpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0RXhwbz0kLmVhc2luZy5lYXNlSW5PdXRFeHBvIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCWlmICh0PT0wKSByZXR1cm4gYjsKCQkJCQkJaWYgKHQ9PWQpIHJldHVybiBiK2M7CgkJCQkJCWlmICgodC89ZC8yKSA8IDEpIHJldHVybiBjLzIgKiBNYXRoLnBvdygyLCAxMCAqICh0IC0gMSkpICsgYjsKCQkJCQkJcmV0dXJuIGMvMiAqICgtTWF0aC5wb3coMiwgLTEwICogLS10KSArIDIpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluU2luZT0kLmVhc2luZy5lYXNlSW5TaW5lIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIC1jICogTWF0aC5jb3ModC9kICogKE1hdGguUEkvMikpICsgYyArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VPdXRTaW5lPSQuZWFzaW5nLmVhc2VPdXRTaW5lIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7cmV0dXJuIGMgKiBNYXRoLnNpbih0L2QgKiAoTWF0aC5QSS8yKSkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlSW5PdXRTaW5lPSQuZWFzaW5nLmVhc2VJbk91dFNpbmUgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gLWMvMiAqIChNYXRoLmNvcyhNYXRoLlBJKnQvZCkgLSAxKSArIGI7fTsKCQkJCSQuZWFzaW5nLmVhc2VJbkNpcmM9JC5lYXNpbmcuZWFzZUluQ2lyYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpe3JldHVybiAtYyAqIChNYXRoLnNxcnQoMSAtICh0Lz1kKSp0KSAtIDEpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZU91dENpcmM9JC5lYXNpbmcuZWFzZU91dENpcmMgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gYyAqIE1hdGguc3FydCgxIC0gKHQ9dC9kLTEpKnQpICsgYjt9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0Q2lyYz0kLmVhc2luZy5lYXNlSW5PdXRDaXJjIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCWlmICgodC89ZC8yKSA8IDEpIHJldHVybiAtYy8yICogKE1hdGguc3FydCgxIC0gdCp0KSAtIDEpICsgYjsKCQkJCQkJcmV0dXJuIGMvMiAqIChNYXRoLnNxcnQoMSAtICh0LT0yKSp0KSArIDEpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluRWxhc3RpYz0kLmVhc2luZy5lYXNlSW5FbGFzdGljIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCXZhciBzPTEuNzAxNTg7dmFyIHA9MDt2YXIgYT1jOwoJCQkJCQlpZiAodD09MCkgcmV0dXJuIGI7ICBpZiAoKHQvPWQpPT0xKSByZXR1cm4gYitjOyAgaWYgKCFwKSBwPWQqLjM7CgkJCQkJCWlmIChhIDwgTWF0aC5hYnMoYykpIHsgYT1jOyB2YXIgcz1wLzQ7IH0KCQkJCQkJZWxzZSB2YXIgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4gKGMvYSk7CgkJCQkJCXJldHVybiAtKGEqTWF0aC5wb3coMiwxMCoodC09MSkpICogTWF0aC5zaW4oICh0KmQtcykqKDIqTWF0aC5QSSkvcCApKSArIGI7CgkJCQkJfTsKCQkJCSQuZWFzaW5nLmVhc2VPdXRFbGFzdGljPSQuZWFzaW5nLmVhc2VPdXRFbGFzdGljIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCl7CgkJCQkJCXZhciBzPTEuNzAxNTg7dmFyIHA9MDt2YXIgYT1jOwoJCQkJCQlpZiAodD09MCkgcmV0dXJuIGI7ICBpZiAoKHQvPWQpPT0xKSByZXR1cm4gYitjOyAgaWYgKCFwKSBwPWQqLjM7CgkJCQkJCWlmIChhIDwgTWF0aC5hYnMoYykpIHsgYT1jOyB2YXIgcz1wLzQ7IH0KCQkJCQkJZWxzZSB2YXIgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4gKGMvYSk7CgkJCQkJCXJldHVybiBhKk1hdGgucG93KDIsLTEwKnQpICogTWF0aC5zaW4oICh0KmQtcykqKDIqTWF0aC5QSSkvcCApICsgYyArIGI7CgkJCQkJfTsKCQkJCSQuZWFzaW5nLmVhc2VJbk91dEVsYXN0aWM9JC5lYXNpbmcuZWFzZUluT3V0RWxhc3RpYyB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQl2YXIgcz0xLjcwMTU4O3ZhciBwPTA7dmFyIGE9YzsKCQkJCQkJaWYgKHQ9PTApIHJldHVybiBiOyAgaWYgKCh0Lz1kLzIpPT0yKSByZXR1cm4gYitjOyAgaWYgKCFwKSBwPWQqKC4zKjEuNSk7CgkJCQkJCWlmIChhIDwgTWF0aC5hYnMoYykpIHsgYT1jOyB2YXIgcz1wLzQ7IH0KCQkJCQkJZWxzZSB2YXIgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4gKGMvYSk7CgkJCQkJCWlmICh0IDwgMSkgcmV0dXJuIC0uNSooYSpNYXRoLnBvdygyLDEwKih0LT0xKSkgKiBNYXRoLnNpbiggKHQqZC1zKSooMipNYXRoLlBJKS9wICkpICsgYjsKCQkJCQkJcmV0dXJuIGEqTWF0aC5wb3coMiwtMTAqKHQtPTEpKSAqIE1hdGguc2luKCAodCpkLXMpKigyKk1hdGguUEkpL3AgKSouNSArIGMgKyBiOwoJCQkJCX07CgkJCQkkLmVhc2luZy5lYXNlSW5CYWNrPSQuZWFzaW5nLmVhc2VJbkJhY2sgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkLHMpewoJCQkJCQlpZiAocyA9PSB1bmRlZmluZWQpIHMgPSAxLjcwMTU4OwoJCQkJCQlyZXR1cm4gYyoodC89ZCkqdCooKHMrMSkqdCAtIHMpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZU91dEJhY2s9JC5lYXNpbmcuZWFzZU91dEJhY2sgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkLHMpewoJCQkJCQlpZiAocyA9PSB1bmRlZmluZWQpIHMgPSAxLjcwMTU4OwoJCQkJCQlyZXR1cm4gYyooKHQ9dC9kLTEpKnQqKChzKzEpKnQgKyBzKSArIDEpICsgYjsKCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0QmFjaz0kLmVhc2luZy5lYXNlSW5PdXRCYWNrIHx8IAoJCQkJCWZ1bmN0aW9uKHgsdCxiLGMsZCxzKXsKCQkJCQkJaWYgKHMgPT0gdW5kZWZpbmVkKSBzID0gMS43MDE1ODsKCQkJCQkJaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMioodCp0KigoKHMqPSgxLjUyNSkpKzEpKnQgLSBzKSkgKyBiOwoJCQkJCQlyZXR1cm4gYy8yKigodC09MikqdCooKChzKj0oMS41MjUpKSsxKSp0ICsgcykgKyAyKSArIGI7CgkJCQkJfTsKCQkJCSQuZWFzaW5nLmVhc2VJbkJvdW5jZT0kLmVhc2luZy5lYXNlSW5Cb3VuY2UgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXtyZXR1cm4gYyAtICQuZWFzaW5nLmVhc2VPdXRCb3VuY2UgKHgsIGQtdCwgMCwgYywgZCkgKyBiO307CgkJCQkkLmVhc2luZy5lYXNlT3V0Qm91bmNlPSQuZWFzaW5nLmVhc2VPdXRCb3VuY2UgfHwgCgkJCQkJZnVuY3Rpb24oeCx0LGIsYyxkKXsKCQkJCQkJaWYgKCh0Lz1kKSA8ICgxLzIuNzUpKSB7cmV0dXJuIGMqKDcuNTYyNSp0KnQpICsgYjt9IAoJCQkJCQllbHNlIGlmICh0IDwgKDIvMi43NSkpIHtyZXR1cm4gYyooNy41NjI1Kih0LT0oMS41LzIuNzUpKSp0ICsgLjc1KSArIGI7fSAKCQkJCQkJZWxzZSBpZiAodCA8ICgyLjUvMi43NSkpIHtyZXR1cm4gYyooNy41NjI1Kih0LT0oMi4yNS8yLjc1KSkqdCArIC45Mzc1KSArIGI7fSAKCQkJCQkJZWxzZSB7cmV0dXJuIGMqKDcuNTYyNSoodC09KDIuNjI1LzIuNzUpKSp0ICsgLjk4NDM3NSkgKyBiO30KCQkJCQl9OwoJCQkJJC5lYXNpbmcuZWFzZUluT3V0Qm91bmNlPSQuZWFzaW5nLmVhc2VJbk91dEJvdW5jZSB8fCAKCQkJCQlmdW5jdGlvbih4LHQsYixjLGQpewoJCQkJCQlpZiAodCA8IGQvMikgcmV0dXJuICQuZWFzaW5nLmVhc2VJbkJvdW5jZSAoeCwgdCoyLCAwLCBjLCBkKSAqIC41ICsgYjsKCQkJCQkJcmV0dXJuICQuZWFzaW5nLmVhc2VPdXRCb3VuY2UgKHgsIHQqMi1kLCAwLCBjLCBkKSAqIC41ICsgYyouNSArIGI7CgkJCQkJfTsKCQkJfQoJCX0KCQkKCS8qIAoJLS0tLS0tLS0tLS0tLS0tCglwbHVnaW4gc2V0dXAgCgktLS0tLS0tLS0tLS0tLS0KCSovCgkKCS8qIGV4dGVuZCBqcXVlcnkgd2l0aCBjdXN0b20gZWFzaW5ncyAqLwoJCglmdW5jdGlvbnMuX2Vhc2luZy5jYWxsKCk7CgkKCS8qIHBsdWdpbiBjb25zdHJ1Y3RvciBmdW5jdGlvbnMgKi8KCQoJJC5mbltwbHVnaW5OU109ZnVuY3Rpb24obWV0aG9kKXsKCQlpZihtZXRob2RzW21ldGhvZF0pewoJCQlyZXR1cm4gbWV0aG9kc1ttZXRob2RdLmFwcGx5KHRoaXMsQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpKTsKCQl9ZWxzZSBpZih0eXBlb2YgbWV0aG9kPT09Im9iamVjdCIgfHwgIW1ldGhvZCl7CgkJCXJldHVybiBtZXRob2RzLmluaXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOwoJCX1lbHNlewoJCQkkLmVycm9yKCJNZXRob2QgIittZXRob2QrIiBkb2VzIG5vdCBleGlzdCIpOwoJCX0KCX07CgkkW3BsdWdpbk5TXT1mdW5jdGlvbihtZXRob2QpewoJCWlmKG1ldGhvZHNbbWV0aG9kXSl7CgkJCXJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcyxBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSkpOwoJCX1lbHNlIGlmKHR5cGVvZiBtZXRob2Q9PT0ib2JqZWN0IiB8fCAhbWV0aG9kKXsKCQkJcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CgkJfWVsc2V7CgkJCSQuZXJyb3IoIk1ldGhvZCAiK21ldGhvZCsiIGRvZXMgbm90IGV4aXN0Iik7CgkJfQoJfTsKCQoJLyogCglhbGxvdyBzZXR0aW5nIHBsdWdpbiBkZWZhdWx0IG9wdGlvbnMuIAoJZXhhbXBsZTogJC5wbHVnaW5fbmFtZS5kZWZhdWx0cy5vcHRpb25fbmFtZT0ib3B0aW9uX3ZhbHVlIjsgCgkqLwoJCgkkW3BsdWdpbk5TXS5kZWZhdWx0cz1kZWZhdWx0czsKCQp9KShqUXVlcnksd2luZG93LGRvY3VtZW50KTs=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:36:10 GMT",
                    "Content-Length": "25670",
                    "Date": "Fri, 07 Nov 2014 21:36:10 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}