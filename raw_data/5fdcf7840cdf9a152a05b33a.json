{
    "url": "http://localhost:9999/opitzconsulting/jquery-mobile-angular-adapter/src/integration/widgetAdapters.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location</b> and written to <b>$()</b> via the following statement:<ul><li>$(\"&lt;a href='...\" + location+ \"' data-\" + $.mobile.ns+ \"icon='del...\" + $.mobile.ns+ \"iconpos='...\" + options.closeBtnTe...+ \"&lt;/a&gt;\" ) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/opitzconsulting/jquery-mobile-angular-adapter/src/integration/widgetAdapters.js",
                "path": "/opitzconsulting/jquery-mobile-angular-adapter/src/integration/widgetAdapters.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9vcGl0emNvbnN1bHRpbmcvanF1ZXJ5LW1vYmlsZS1hbmd1bGFyLWFkYXB0ZXIvc3JjL2ludGVncmF0aW9uL3dpZGdldEFkYXB0ZXJzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTY5NjMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDY6NDY6MDIgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA2OjQ2OjAxIEdNVA0KDQooZnVuY3Rpb24gKGFuZ3VsYXIsICQpIHsKICAgIHZhciBuZyA9IGFuZ3VsYXIubW9kdWxlKCJuZyIpOwogICAgbmcuY29uZmlnKFsianFtTmdXaWRnZXRQcm92aWRlciIsIGZ1bmN0aW9uKGpxbU5nV2lkZ2V0UHJvdmlkZXIpIHsKICAgICAgICAvLyByZWdpc3RlciBhIGRlZmF1bHQgaGFuZGxlciBmb3IgYWxsIHdpZGdldHMuCiAgICAgICAgdmFyIHdpZGdldE5hbWUsIHdpZGdldDsKICAgICAgICBmb3IgKHdpZGdldE5hbWUgaW4gJC5tb2JpbGUpIHsKICAgICAgICAgICAgd2lkZ2V0ID0gJC5tb2JpbGVbd2lkZ2V0TmFtZV07CiAgICAgICAgICAgIGlmICh3aWRnZXROYW1lIT09J3BhZ2UnICYmIGFuZ3VsYXIuaXNGdW5jdGlvbih3aWRnZXQpICYmIHdpZGdldC5wcm90b3R5cGUud2lkZ2V0KSB7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCh3aWRnZXROYW1lLCBbImpxbU5nV2lkZ2V0IiwgZGVmYXVsdFdpZGdldF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByZWdpc3RlciBzcGVjaWFsIG92ZXJyaWRlIGhhbmRsZXJzCiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoImNoZWNrYm94cmFkaW8iLCBbImpxbU5nV2lkZ2V0IiwgY2hlY2tib3hSYWRpb1dpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJidXR0b24iLCBbImpxbU5nV2lkZ2V0IiwgYnV0dG9uV2lkZ2V0XSk7CiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoImNvbGxhcHNpYmxlIiwgWyJqcW1OZ1dpZGdldCIsICIkcGFyc2UiLCBjb2xsYXBzaWJsZVdpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJkaWFsb2ciLCBbImpxbU5nV2lkZ2V0IiwgZGlhbG9nV2lkZ2V0XSk7CiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoImNvbnRyb2xncm91cCIsIFsianFtTmdXaWRnZXQiLCBjb250cm9sZ3JvdXBXaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgidGV4dGlucHV0IiwgWyJqcW1OZ1dpZGdldCIsIHRleHRpbnB1dFdpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJzbGlkZXIiLCBbImpxbU5nV2lkZ2V0IiwgIiRwYXJzZSIsIHNsaWRlcldpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJwb3B1cCIsIFsianFtTmdXaWRnZXQiLCAiJHBhcnNlIiwgcG9wdXBXaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgicGFuZWwiLCBbImpxbU5nV2lkZ2V0IiwgIiRwYXJzZSIsIHBhbmVsV2lkZ2V0XSk7CiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoInRhYmxlIiwgWyJqcW1OZ1dpZGdldCIsIHRhYmxlV2lkZ2V0XSk7CiAgICB9XSk7CgogICAgZnVuY3Rpb24gZGVmYXVsdFdpZGdldChqcW1OZ1dpZGV0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsLCBzZWxlY3RDdHJsKSB7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiB0ZXh0aW5wdXRXaWRnZXQoanFtTmdXaWRnZXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcmVMaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIGlmIChpQXR0cnMudHlwZSA9PT0gJ3JhbmdlJykgewogICAgICAgICAgICAgICAgICAgIGlBdHRycy50eXBlID0gJ251bWJlcic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCwgc2VsZWN0Q3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRnZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAganFtTmdXaWRnZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwb3B1cFdpZGdldChqcW1OZ1dpZGV0LCAkcGFyc2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICBhZGRPcGVuZWRCaW5kaW5nKCJwb3B1cCIsICRwYXJzZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsICdfJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhbmVsV2lkZ2V0KGpxbU5nV2lkZXQsICRwYXJzZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCwgc2VsZWN0Q3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgICAgIGFkZE9wZW5lZEJpbmRpbmcoInBhbmVsIiwgJHBhcnNlLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRPcGVuZWRCaW5kaW5nKHdpZGdldE5hbWUsICRwYXJzZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG9wZW5DbG9zZU1ldGhvZFByZWZpeCkgewogICAgICAgIHZhciBzeW5jaW5nID0gZmFsc2U7CiAgICAgICAgaWYgKGlBdHRycy5vcGVuZWQpIHsKICAgICAgICAgICAgdmFyIG9wZW5lZEdldHRlciA9ICRwYXJzZShpQXR0cnMub3BlbmVkKSwKICAgICAgICAgICAgICAgIG9wZW5lZFNldHRlciA9IG9wZW5lZEdldHRlci5hc3NpZ247CgogICAgICAgICAgICBzY29wZS4kd2F0Y2gob3BlbmVkR2V0dGVyLCB1cGRhdGVXaWRnZXQpOwogICAgICAgICAgICBpZiAob3BlbmVkU2V0dGVyKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVTY29wZU9uKG9wZW5DbG9zZU1ldGhvZFByZWZpeCsib3BlbiIsIHRydWUpOwogICAgICAgICAgICAgICAgdXBkYXRlU2NvcGVPbihvcGVuQ2xvc2VNZXRob2RQcmVmaXgrImNsb3NlIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVTY29wZU9uKG1ldGhvZE5hbWUsIHNjb3BlVmFsdWUpIHsKICAgICAgICAgICAgdmFyIHdpZGdldCA9IGlFbGVtZW50LmRhdGEoJC5tb2JpbGVbd2lkZ2V0TmFtZV0ucHJvdG90eXBlLndpZGdldEZ1bGxOYW1lKSwKICAgICAgICAgICAgICAgIF9vbGQgPSB3aWRnZXRbbWV0aG9kTmFtZV07CiAgICAgICAgICAgIHdpZGdldFttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHJlcyA9IF9vbGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIGlmICghc3luY2luZykgewogICAgICAgICAgICAgICAgICAgIHN5bmNpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lZFNldHRlcihzY29wZSwgc2NvcGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc3luY2luZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVdpZGdldChvcGVuZWQpIHsKICAgICAgICAgICAgaWYgKHN5bmNpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzeW5jaW5nID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKG9wZW5lZCkgewogICAgICAgICAgICAgICAgaUVsZW1lbnRbd2lkZ2V0TmFtZV0oIm9wZW4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlFbGVtZW50W3dpZGdldE5hbWVdKCJjbG9zZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN5bmNpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2xpZGVyV2lkZ2V0KGpxbU5nV2lkZXQsICRwYXJzZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCwgc2VsZWN0Q3RybCkgewogICAgICAgICAgICAgICAgaWYgKHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yTmdPcHRpb25zQW5kTmdSZXBlYXRUb0NyZWF0ZU9wdGlvbnMoc2NvcGUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RTZWNvbmRPcHRpb25JZkZpcnN0SXNVbmtub3duT3B0aW9uVG9SZW1vdmVVbmtvd25PcHRpb24oaUVsZW1lbnQsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWxWYWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAobmdNb2RlbEN0cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogbmdNb2RlbEN0cmwuJG1vZGVsVmFsdWUgaXMgbm90IGZpbGxlZCB5ZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gZXZhbHVhdGUgdGhlIG5nLW1vZGVsIGF0dHJpYnV0ZSBvdXJzZWx2ZXMuLi4KICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxWYWx1ZSA9ICRwYXJzZShpQXR0cnMubmdNb2RlbCkoc2NvcGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZXRNaW5WYWx1ZUluU2NvcGVJZk5vVmFsdWVJblNjb3BlQXNKcW1TdGFydHNXaXRoTWluVmFsdWUoaUF0dHJzLCBuZ01vZGVsQ3RybCwgbW9kZWxWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiB3YWl0Rm9yTmdPcHRpb25zQW5kTmdSZXBlYXRUb0NyZWF0ZU9wdGlvbnMoc2NvcGUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIC8vIE5vdGU6IHNjb3BlLiRldmFsQXN5bmMgZG9lcyBub3Qgd29yayBoZXJlLCBhcyBpdCAKICAgICAgICAgICAgLy8gY291bGQgZ2V0IGV4ZWN1dGVkIG5vdCB1bnRpbCB0aGUgbmV4dCAkZGlnZXN0LCB3aGljaCB3b3VsZCBiZSB0b28gbGF0ZSEKICAgICAgICAgICAgc2NvcGUuJHJvb3QuJHBvc3REaWdlc3RPbmUoZnVuY3Rpb24ocmVxdWlyZURpZ2VzdCkgewogICAgICAgICAgICAgICAgcmVxdWlyZURpZ2VzdCgpOwogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRNaW5WYWx1ZUluU2NvcGVJZk5vVmFsdWVJblNjb3BlQXNKcW1TdGFydHNXaXRoTWluVmFsdWUoaUF0dHJzLCBuZ01vZGVsQ3RybCwgbW9kZWxWYWx1ZSkgewogICAgICAgICAgICBpZiAobmdNb2RlbEN0cmwgJiYgdHlwZW9mIGlBdHRycy5taW4gIT09ICJ1bmRlZmluZWQiICYmIG1vZGVsVmFsdWU9PT11bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBfJHByaXN0aW5lID0gbmdNb2RlbEN0cmwuJHByaXN0aW5lOwogICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHByaXN0aW5lID0gZmFsc2U7CiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKGlBdHRycy5taW4pOwogICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHJlbmRlcigpOwogICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHByaXN0aW5lID0gXyRwcmlzdGluZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2VsZWN0U2Vjb25kT3B0aW9uSWZGaXJzdElzVW5rbm93bk9wdGlvblRvUmVtb3ZlVW5rb3duT3B0aW9uKGlFbGVtZW50LCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IGlFbGVtZW50LmNoaWxkcmVuKCJvcHRpb24iKSwKICAgICAgICAgICAgICAgIGluaXRWYWx1ZSA9IG9wdGlvbnMuZXEoMCkudmFsKCksCiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4OwogICAgICAgICAgICBpZiAoaW5pdFZhbHVlID09PSAnPycgfHwgaW5pdFZhbHVlLmluZGV4T2YoJz8gJyk9PT0wKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmVxKDEpLnByb3AoInNlbGVjdGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIgXyRwcmlzdGluZSA9IG5nTW9kZWxDdHJsLiRwcmlzdGluZTsKICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRwcmlzdGluZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaUVsZW1lbnQudHJpZ2dlcigiY2hhbmdlIik7CiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcHJpc3RpbmUgPSBfJHByaXN0aW5lOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCgogICAgZnVuY3Rpb24gY2hlY2tib3hSYWRpb1dpZGdldChqcW1OZ1dpZGV0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY29tcGlsZTogY2hlY2tib3hSYWRpb1ByZWNvbXBpbGUsCiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gaUVsZW1lbnQucGFyZW50KCJsYWJlbCIpOwogICAgICAgICAgICAgICAgaWYgKCFpQXR0cnMubmdtTm9MYWJlbCAmJiBsYWJlbC5sZW5ndGg9PT0wKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHdvIGNoZWNrYm94ZXMgYXJlIGNyZWF0ZWQgYnkgbmctcmVwZWF0LCBhbmQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gbmctcmVwZWF0IGlzIG9uIHRoZSBjaGVja2JveCBhbmQgbm90IG9uIHRoZSBsYWJlbCwKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3QgY2hlY2tib3ggd2lsbCBiZSBmaW5lLCBidXQgdGhlIHNlY29uZCBvbmUKICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIGJlIGF0IGFuIG9kZCBwbGFjZSBpbiB0aGUgZG9tLi4uCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEb24ndCB1c2UgbmctcmVwZWF0IG9yIG90aGVyIGNvbmRpdGlvbmFsIGRpcmVjdGl2ZXMgb24gY2hlY2tib3hlcy9yYWRpb2J1dHRvbnMgZGlyZWN0bHkuIEluc3RlYWQsIHdyYXAgdGhlIGlucHV0IGludG8gYSBsYWJlbCBhbmQgcHV0IHRoZSBkaXJlY3RpdmUgb24gdGhhdCBpbnB1dCEiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwoKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwoKICAgICAgICAgICAgICAgIGlBdHRycy4kb2JzZXJ2ZSgiY2hlY2tlZCIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQudHJpZ2dlckFzeW5jUmVmcmVzaCh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsICJyZWZyZXNoIik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGNoZWNrYm94UmFkaW9QcmVjb21waWxlKG9yaWdFbGVtZW50LCBpbml0QXJncykgewogICAgICAgICAgICAvLyB3cmFwIHRoZSBpbnB1dCB0ZW1wb3JhcmlseSBpbnRvIGl0J3MgbGFiZWwgKHdpbGwgYmUgdW5kb25lIGJ5IHRoZSB3aWRnZXQpLgogICAgICAgICAgICAvLyBCeSB0aGlzLCB0aGUganFtIHdpZGdldCB3aWxsIGFsd2F5cwogICAgICAgICAgICAvLyB1c2UgdGhpcyBsYWJlbCwgZXZlbiBpZiB0aGVyZSBhcmUgb3RoZXIgbGFiZWxzIHdpdGggdGhlIHNhbWUgaWQgb24gdGhlIHNhbWUgcGFnZS4KICAgICAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQgaWYgd2UgdXNlIG5nLXJlcGVhdCBvbiBjaGVja2JveGVzLCBhcyB0aGlzIGNvdWxkCiAgICAgICAgICAgIC8vIGNyZWF0ZSBtdWx0aXBsZSBjaGVja2JveGVzIHdpdGggdGhlIHNhbWUgaWQhCiAgICAgICAgICAgIC8vIFRoaXMgbmVlZHMgdG8gYmUgZG9uZSBpbiB0aGUgcHJlY29tcGlsZSwgYXMgb3RoZXJ3aXNlIGFuZ3VsYXIgY29tcGlsZXIgY291bGQgZ2V0IGludG8gdHJvdWJsZQogICAgICAgICAgICAvLyB3aGVuIGlucHV0IGFuZCBsYWJlbCBhcmUgc2libGluZ3MhCiAgICAgICAgICAgIC8vIFNlZSB0aGUgY2hlY2tib3hyYWRpby1QbHVnaW4gaW4ganFtIGZvciB0aGUgc2VsZWN0b3JzIHVzZWQgdG8gbG9jYXRlIHRoZSBsYWJlbC4KICAgICAgICAgICAgdmFyIHBhcmVudExhYmVsID0gJChvcmlnRWxlbWVudCkuY2xvc2VzdCgibGFiZWwiKTsKICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQob3JpZ0VsZW1lbnQpLmNsb3Nlc3QoImZvcm0sZmllbGRzZXQsOmpxbURhdGEocm9sZT0ncGFnZScpLDpqcW1EYXRhKHJvbGU9J2RpYWxvZycpIik7CiAgICAgICAgICAgIGlmIChjb250YWluZXIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBvcmlnRWxlbWVudC5wYXJlbnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbGFiZWwgPSBwYXJlbnRMYWJlbC5sZW5ndGggPyBwYXJlbnRMYWJlbCA6IGNvbnRhaW5lci5maW5kKCJsYWJlbCIpLmZpbHRlcigiW2Zvcj0nIiArIG9yaWdFbGVtZW50WzBdLmlkICsgIiddIik7CiAgICAgICAgICAgIGlmIChsYWJlbC5sZW5ndGg9PT0wKSB7CiAgICAgICAgICAgICAgICBvcmlnRWxlbWVudC5hdHRyKCJuZ20tbm8tbGFiZWwiLCAidHJ1ZSIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kKG9yaWdFbGVtZW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBidXR0b25XaWRnZXQoanFtTmdXaWRldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByZWNvbXBpbGU6IGZ1bmN0aW9uKG9yaWdFbGVtZW50LCBpbml0QXJncykgewogICAgICAgICAgICAgICAgLy8gQWRkIGEgdGV4dCBub2RlIHdpdGggdGhlIHZhbHVlIGNvbnRlbnQsCiAgICAgICAgICAgICAgICAvLyBhcyB3ZSBuZWVkIGEgdGV4dCBub2RlIGxhdGVyIGluIHRoZSBqcW0gYnV0dG9uIG1hcmt1cCEKICAgICAgICAgICAgICAgIGlmIChvcmlnRWxlbWVudFswXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnSU5QVVQnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb3JpZ0VsZW1lbnQudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgb3JpZ0VsZW1lbnQuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICAgICAgLy8gQnV0dG9uIGRlc3Ryb3lzIHRoZSB0ZXh0IG5vZGUgYW5kIHJlY3JlYXRlcyBhIG5ldyBvbmUuIFRoaXMgZG9lcyBub3Qgd29yawogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHRleHQgbm9kZSBjb250YWlucyBhbmd1bGFyIGV4cHJlc3Npb25zLCBzbyB3ZSBtb3ZlIHRoZQogICAgICAgICAgICAgICAgLy8gdGV4dCBub2RlIHRvIHRoZSByaWdodCBwbGFjZS4KICAgICAgICAgICAgICAgIHZhciB0ZXh0Tm9kZSA9IGlFbGVtZW50LmNvbnRlbnRzKCk7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgICAgIHZhciB0ZXh0U3BhbiA9IGlFbGVtZW50LnBhcmVudCgpLmZpbmQoIi51aS1idG4tdGV4dCIpOwogICAgICAgICAgICAgICAgdGV4dFNwYW4uZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRleHRTcGFuLmFwcGVuZCh0ZXh0Tm9kZSk7CgogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbGxhcHNpYmxlV2lkZ2V0KGpxbU5nV2lkZXQsICRwYXJzZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgICAgIGJpbmRDb2xsYXBzZWRBdHRyaWJ1dGUoc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gYmluZENvbGxhcHNlZEF0dHJpYnV0ZShzY29wZSwgaUVsZW1lbnQsIGlBdHRycykgewogICAgICAgICAgICB2YXIgc3luY2luZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAoaUF0dHJzLmNvbGxhcHNlZCkgewogICAgICAgICAgICAgICAgdmFyIGNvbGxhcHNlZEdldHRlciA9ICRwYXJzZShpQXR0cnMuY29sbGFwc2VkKTsKICAgICAgICAgICAgICAgIHZhciBjb2xsYXBzZWRTZXR0ZXIgPSBjb2xsYXBzZWRHZXR0ZXIuYXNzaWduOwogICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGNvbGxhcHNlZEdldHRlciwgdXBkYXRlV2lkZ2V0KTsKICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzZWRTZXR0ZXIpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVTY29wZU9uKCJjb2xsYXBzZSIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVNjb3BlT24oImV4cGFuZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlV2lkZ2V0KGNvbGxhcHNlZCkgewogICAgICAgICAgICAgICAgaWYgKHN5bmNpbmcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzeW5jaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzZWQpIHsKICAgICAgICAgICAgICAgICAgICBpRWxlbWVudC50cmlnZ2VySGFuZGxlcigiY29sbGFwc2UiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaUVsZW1lbnQudHJpZ2dlckhhbmRsZXIoImV4cGFuZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3luY2luZyA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTY29wZU9uKGV2ZW50TmFtZSwgbmV3Q29sbGFwc2VkVmFsdWUpIHsKICAgICAgICAgICAgICAgIGlFbGVtZW50LmJpbmQoZXZlbnROYW1lLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3luY2luZykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHN5bmNpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmICggaUVsZW1lbnRbMF09PT1ldmVudC50YXJnZXQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZWRTZXR0ZXIoc2NvcGUsIG5ld0NvbGxhcHNlZFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHN5bmNpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpYWxvZ1dpZGdldChqcW1OZ1dpZGV0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY29tcGlsZTogZGlhbG9nUHJlY29tcGlsZSwKICAgICAgICAgICAgbGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKSB7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgICAgIC8vIGFkZCBoYW5kbGVyIHRvIGVuaGFuY2VkIGNsb3NlIGJ1dHRvbiBtYW51YWxseSAodGhlIG9uZSB3ZSBhZGRlZCBpbiBwcmVjb21waWxlKSwKICAgICAgICAgICAgICAgIC8vIGFuZCByZW1vdmUgdGhlIG90aGVyIGNsb3NlIGJ1dHRvbiAodGhlIG9uZSB0aGUgd2lkZ2V0IGNyZWF0ZWQpLgogICAgICAgICAgICAgICAgdmFyIGNsb3NlQnV0dG9ucyA9IGlFbGVtZW50LmZpbmQoJzpqcW1EYXRhKHJvbGU9ImhlYWRlciIpIGE6anFtRGF0YShpY29uPSJkZWxldGUiKScpOwogICAgICAgICAgICAgICAgY2xvc2VCdXR0b25zLmVxKDEpLmJpbmQoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaUVsZW1lbnQuZGlhbG9nKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbnMuZXEoMCkucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLyBEaWFsb2c6IHNlcGFyYXRlIGV2ZW50IGJpbmRpbmcgYW5kIGRvbSBlbmhhbmNlbWVudC4KICAgICAgICAvLyBOb3RlOiBXZSBkbyBuZWVkIHRvIGFkZCB0aGUgY2xvc2UgYnV0dG9uIGR1cmluZyBwcmVjb21waWxlLAogICAgICAgIC8vIGFzIHRoZSBlbmhhbmNlbWVudCBmb3IgdGhlIGRpYWxvZyBoZWFkZXIgZGVwZW5kcyBvbiBpdCAoY2FsY3VsYXRpb24gd2hpY2ggYnV0dG9uIGlzIGxlZnQsIHJpZ2h0LCAuLi4pLAogICAgICAgIC8vIGFuZCB0aGF0IGlzIGV4ZWN1dGVkIHdoZW4gd2UgY3JlYXRlIHRoZSBwYWdlIHdpZGdldCwgd2hpY2ggaXMgYmVmb3JlIHRoZSBkaWFsb2cgd2lkZ2V0IGlzIGNyZWF0ZWQgOi0oCiAgICAgICAgLy8gV2UgY2Fubm90IGFkanVzdCB0aGUgdGltaW5nIG9mIHRoZSBoZWFkZXIgZW5oYW5jZW1lbnQgYXMgaXQgaXMgbm8ganFtIHdpZGdldC4KICAgICAgICBmdW5jdGlvbiBkaWFsb2dQcmVjb21waWxlKG9yaWdFbGVtZW50LCBpbml0QXR0cnMpIHsKICAgICAgICAgICAgRmFrZURpYWxvZy5wcm90b3R5cGUgPSAkLm1vYmlsZS5kaWFsb2cucHJvdG90eXBlOwogICAgICAgICAgICB2YXIgZmFrZURpYWxvZyA9IG5ldyBGYWtlRGlhbG9nKG9yaWdFbGVtZW50LCB7fSksCiAgICAgICAgICAgICAgICBvcHRpb25zID0gZmFrZURpYWxvZy5vcHRpb25zLAogICAgICAgICAgICAgICAgdmFsdWUgPSBvcHRpb25zLmNsb3NlQnRuOwoKICAgICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGlzIGFkYXB0ZWQgZnJvbSAkLm1vYmlsZS5kaWFsb2cucHJvdG90eXBlLl9zZXRDbG9zZUJ0bgogICAgICAgICAgICBpZiAoIHZhbHVlICE9PSAibm9uZSIgKSB7CiAgICAgICAgICAgICAgICAvLyBTYW5pdGl6ZSB2YWx1ZQogICAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gKCB2YWx1ZSA9PT0gImxlZnQiID8gImxlZnQiIDogInJpZ2h0IiApOwogICAgICAgICAgICAgICAgdmFyIGJ0biA9ICQoICI8YSBocmVmPScjJyBjbGFzcz0ndWktYnRuLSIgKyBsb2NhdGlvbiArICInIGRhdGEtIiArICQubW9iaWxlLm5zICsgImljb249J2RlbGV0ZScgZGF0YS0iICsgJC5tb2JpbGUubnMgKyAiaWNvbnBvcz0nbm90ZXh0Jz4iKyBvcHRpb25zLmNsb3NlQnRuVGV4dCArICI8L2E+IiApOwogICAgICAgICAgICAgICAgb3JpZ0VsZW1lbnQuZmluZCggIjpqcW1EYXRhKHJvbGU9J2hlYWRlcicpIiApLmZpcnN0KCkucHJlcGVuZCggYnRuICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIEZha2VEaWFsb2coZWxlbWVudCwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQud2lkZ2V0LmV4dGVuZCgge30sCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNvbnRyb2xncm91cFdpZGdldChqcW1OZ1dpZGV0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKSB7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKCiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgICAgIGlFbGVtZW50LmJpbmQoIiRjaGlsZHJlbkNoYW5nZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAganFtTmdXaWRldC50cmlnZ2VyQXN5bmNSZWZyZXNoKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwge30pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHRhYmxlV2lkZ2V0KGpxbU5nV2lkZXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIHZhciB3aWRnZXQsIHBvcHVwSWQsIHBvcHVwOwogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICB3aWRnZXQgPSBpRWxlbWVudC5kYXRhKCQubW9iaWxlW3dpZGdldE5hbWVdLnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZSk7CiAgICAgICAgICAgICAgICAvLyBUaGUgY29sdW1uLXRvZ2dsZSB3aWRnZXQgY3JlYXRlcyBhIHBvcHVwIHdpdGggYSBubyBlbmhhbmNlZCBjb250cm9sZ3JvdXAKICAgICAgICAgICAgICAgIC8vIGFuZCByZWxpZXMgb24gdGhlIG9yZGVyIGluIHdoaWNoIGpxbSBlbmhhbmNlcyB0aGUgd2lkZ2V0cy4KICAgICAgICAgICAgICAgIC8vIEhvd2V2ZXIsIHRoaXMgb3JkZXIgaXMgZGlmZmVyZW50IGluIHRoZSBhZGFwdGVyLAogICAgICAgICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhhdCB0aGUgcG9wdXAgaXMgcHJvcGVybHkgZW5oYW5jZWQuCiAgICAgICAgICAgICAgICBpZiAod2lkZ2V0ICYmIHdpZGdldC5vcHRpb25zLm1vZGU9PT0nY29sdW1udG9nZ2xlJykgewogICAgICAgICAgICAgICAgICAgIHBvcHVwSWQgPSAoIGlFbGVtZW50LmF0dHIoICJpZCIgKSB8fCB3aWRnZXQub3B0aW9ucy5jbGFzc2VzLnBvcHVwICkgKyAiLXBvcHVwIjsKICAgICAgICAgICAgICAgICAgICBwb3B1cCA9ICQoIiMiK3BvcHVwSWQpOwogICAgICAgICAgICAgICAgICAgIHBvcHVwLnRyaWdnZXIoImNyZWF0ZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKfSkoYW5ndWxhciwgJCk7",
                "body": "KGZ1bmN0aW9uIChhbmd1bGFyLCAkKSB7CiAgICB2YXIgbmcgPSBhbmd1bGFyLm1vZHVsZSgibmciKTsKICAgIG5nLmNvbmZpZyhbImpxbU5nV2lkZ2V0UHJvdmlkZXIiLCBmdW5jdGlvbihqcW1OZ1dpZGdldFByb3ZpZGVyKSB7CiAgICAgICAgLy8gcmVnaXN0ZXIgYSBkZWZhdWx0IGhhbmRsZXIgZm9yIGFsbCB3aWRnZXRzLgogICAgICAgIHZhciB3aWRnZXROYW1lLCB3aWRnZXQ7CiAgICAgICAgZm9yICh3aWRnZXROYW1lIGluICQubW9iaWxlKSB7CiAgICAgICAgICAgIHdpZGdldCA9ICQubW9iaWxlW3dpZGdldE5hbWVdOwogICAgICAgICAgICBpZiAod2lkZ2V0TmFtZSE9PSdwYWdlJyAmJiBhbmd1bGFyLmlzRnVuY3Rpb24od2lkZ2V0KSAmJiB3aWRnZXQucHJvdG90eXBlLndpZGdldCkgewogICAgICAgICAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQod2lkZ2V0TmFtZSwgWyJqcW1OZ1dpZGdldCIsIGRlZmF1bHRXaWRnZXRdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVnaXN0ZXIgc3BlY2lhbCBvdmVycmlkZSBoYW5kbGVycwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJjaGVja2JveHJhZGlvIiwgWyJqcW1OZ1dpZGdldCIsIGNoZWNrYm94UmFkaW9XaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgiYnV0dG9uIiwgWyJqcW1OZ1dpZGdldCIsIGJ1dHRvbldpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJjb2xsYXBzaWJsZSIsIFsianFtTmdXaWRnZXQiLCAiJHBhcnNlIiwgY29sbGFwc2libGVXaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgiZGlhbG9nIiwgWyJqcW1OZ1dpZGdldCIsIGRpYWxvZ1dpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJjb250cm9sZ3JvdXAiLCBbImpxbU5nV2lkZ2V0IiwgY29udHJvbGdyb3VwV2lkZ2V0XSk7CiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoInRleHRpbnB1dCIsIFsianFtTmdXaWRnZXQiLCB0ZXh0aW5wdXRXaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgic2xpZGVyIiwgWyJqcW1OZ1dpZGdldCIsICIkcGFyc2UiLCBzbGlkZXJXaWRnZXRdKTsKICAgICAgICBqcW1OZ1dpZGdldFByb3ZpZGVyLndpZGdldCgicG9wdXAiLCBbImpxbU5nV2lkZ2V0IiwgIiRwYXJzZSIsIHBvcHVwV2lkZ2V0XSk7CiAgICAgICAganFtTmdXaWRnZXRQcm92aWRlci53aWRnZXQoInBhbmVsIiwgWyJqcW1OZ1dpZGdldCIsICIkcGFyc2UiLCBwYW5lbFdpZGdldF0pOwogICAgICAgIGpxbU5nV2lkZ2V0UHJvdmlkZXIud2lkZ2V0KCJ0YWJsZSIsIFsianFtTmdXaWRnZXQiLCB0YWJsZVdpZGdldF0pOwogICAgfV0pOwoKICAgIGZ1bmN0aW9uIGRlZmF1bHRXaWRnZXQoanFtTmdXaWRldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCwgc2VsZWN0Q3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gdGV4dGlucHV0V2lkZ2V0KGpxbU5nV2lkZ2V0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlTGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsLCBzZWxlY3RDdHJsKSB7CiAgICAgICAgICAgICAgICBpZiAoaUF0dHJzLnR5cGUgPT09ICdyYW5nZScpIHsKICAgICAgICAgICAgICAgICAgICBpQXR0cnMudHlwZSA9ICdudW1iZXInOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZ2V0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZ2V0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gcG9wdXBXaWRnZXQoanFtTmdXaWRldCwgJHBhcnNlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsLCBzZWxlY3RDdHJsKSB7CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICAgICAgYWRkT3BlbmVkQmluZGluZygicG9wdXAiLCAkcGFyc2UsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCAnXycpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYW5lbFdpZGdldChqcW1OZ1dpZGV0LCAkcGFyc2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICBhZGRPcGVuZWRCaW5kaW5nKCJwYW5lbCIsICRwYXJzZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsICcnKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkT3BlbmVkQmluZGluZyh3aWRnZXROYW1lLCAkcGFyc2UsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBvcGVuQ2xvc2VNZXRob2RQcmVmaXgpIHsKICAgICAgICB2YXIgc3luY2luZyA9IGZhbHNlOwogICAgICAgIGlmIChpQXR0cnMub3BlbmVkKSB7CiAgICAgICAgICAgIHZhciBvcGVuZWRHZXR0ZXIgPSAkcGFyc2UoaUF0dHJzLm9wZW5lZCksCiAgICAgICAgICAgICAgICBvcGVuZWRTZXR0ZXIgPSBvcGVuZWRHZXR0ZXIuYXNzaWduOwoKICAgICAgICAgICAgc2NvcGUuJHdhdGNoKG9wZW5lZEdldHRlciwgdXBkYXRlV2lkZ2V0KTsKICAgICAgICAgICAgaWYgKG9wZW5lZFNldHRlcikgewogICAgICAgICAgICAgICAgdXBkYXRlU2NvcGVPbihvcGVuQ2xvc2VNZXRob2RQcmVmaXgrIm9wZW4iLCB0cnVlKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVNjb3BlT24ob3BlbkNsb3NlTWV0aG9kUHJlZml4KyJjbG9zZSIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2NvcGVPbihtZXRob2ROYW1lLCBzY29wZVZhbHVlKSB7CiAgICAgICAgICAgIHZhciB3aWRnZXQgPSBpRWxlbWVudC5kYXRhKCQubW9iaWxlW3dpZGdldE5hbWVdLnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZSksCiAgICAgICAgICAgICAgICBfb2xkID0gd2lkZ2V0W21ldGhvZE5hbWVdOwogICAgICAgICAgICB3aWRnZXRbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciByZXMgPSBfb2xkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICBpZiAoIXN5bmNpbmcpIHsKICAgICAgICAgICAgICAgICAgICBzeW5jaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVuZWRTZXR0ZXIoc2NvcGUsIHNjb3BlVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHN5bmNpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVXaWRnZXQob3BlbmVkKSB7CiAgICAgICAgICAgIGlmIChzeW5jaW5nKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3luY2luZyA9IHRydWU7CiAgICAgICAgICAgIGlmIChvcGVuZWQpIHsKICAgICAgICAgICAgICAgIGlFbGVtZW50W3dpZGdldE5hbWVdKCJvcGVuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpRWxlbWVudFt3aWRnZXROYW1lXSgiY2xvc2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzeW5jaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNsaWRlcldpZGdldChqcW1OZ1dpZGV0LCAkcGFyc2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwsIHNlbGVjdEN0cmwpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RDdHJsKSB7CiAgICAgICAgICAgICAgICAgICAgd2FpdEZvck5nT3B0aW9uc0FuZE5nUmVwZWF0VG9DcmVhdGVPcHRpb25zKHNjb3BlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U2Vjb25kT3B0aW9uSWZGaXJzdElzVW5rbm93bk9wdGlvblRvUmVtb3ZlVW5rb3duT3B0aW9uKGlFbGVtZW50LCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5nTW9kZWxDdHJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IG5nTW9kZWxDdHJsLiRtb2RlbFZhbHVlIGlzIG5vdCBmaWxsZWQgeWV0LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGV2YWx1YXRlIHRoZSBuZy1tb2RlbCBhdHRyaWJ1dGUgb3Vyc2VsdmVzLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsVmFsdWUgPSAkcGFyc2UoaUF0dHJzLm5nTW9kZWwpKHNjb3BlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0TWluVmFsdWVJblNjb3BlSWZOb1ZhbHVlSW5TY29wZUFzSnFtU3RhcnRzV2l0aE1pblZhbHVlKGlBdHRycywgbmdNb2RlbEN0cmwsIG1vZGVsVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gd2FpdEZvck5nT3B0aW9uc0FuZE5nUmVwZWF0VG9DcmVhdGVPcHRpb25zKHNjb3BlLCBjYWxsYmFjaykgewogICAgICAgICAgICAvLyBOb3RlOiBzY29wZS4kZXZhbEFzeW5jIGRvZXMgbm90IHdvcmsgaGVyZSwgYXMgaXQgCiAgICAgICAgICAgIC8vIGNvdWxkIGdldCBleGVjdXRlZCBub3QgdW50aWwgdGhlIG5leHQgJGRpZ2VzdCwgd2hpY2ggd291bGQgYmUgdG9vIGxhdGUhCiAgICAgICAgICAgIHNjb3BlLiRyb290LiRwb3N0RGlnZXN0T25lKGZ1bmN0aW9uKHJlcXVpcmVEaWdlc3QpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmVEaWdlc3QoKTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0TWluVmFsdWVJblNjb3BlSWZOb1ZhbHVlSW5TY29wZUFzSnFtU3RhcnRzV2l0aE1pblZhbHVlKGlBdHRycywgbmdNb2RlbEN0cmwsIG1vZGVsVmFsdWUpIHsKICAgICAgICAgICAgaWYgKG5nTW9kZWxDdHJsICYmIHR5cGVvZiBpQXR0cnMubWluICE9PSAidW5kZWZpbmVkIiAmJiBtb2RlbFZhbHVlPT09dW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgXyRwcmlzdGluZSA9IG5nTW9kZWxDdHJsLiRwcmlzdGluZTsKICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRwcmlzdGluZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZpZXdWYWx1ZShpQXR0cnMubWluKTsKICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIoKTsKICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRwcmlzdGluZSA9IF8kcHJpc3RpbmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNlbGVjdFNlY29uZE9wdGlvbklmRmlyc3RJc1Vua25vd25PcHRpb25Ub1JlbW92ZVVua293bk9wdGlvbihpRWxlbWVudCwgbmdNb2RlbEN0cmwpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBpRWxlbWVudC5jaGlsZHJlbigib3B0aW9uIiksCiAgICAgICAgICAgICAgICBpbml0VmFsdWUgPSBvcHRpb25zLmVxKDApLnZhbCgpLAogICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDsKICAgICAgICAgICAgaWYgKGluaXRWYWx1ZSA9PT0gJz8nIHx8IGluaXRWYWx1ZS5pbmRleE9mKCc/ICcpPT09MCkgewogICAgICAgICAgICAgICAgb3B0aW9ucy5lcSgxKS5wcm9wKCJzZWxlY3RlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgdmFyIF8kcHJpc3RpbmUgPSBuZ01vZGVsQ3RybC4kcHJpc3RpbmU7CiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcHJpc3RpbmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlFbGVtZW50LnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHByaXN0aW5lID0gXyRwcmlzdGluZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgoKICAgIGZ1bmN0aW9uIGNoZWNrYm94UmFkaW9XaWRnZXQoanFtTmdXaWRldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByZWNvbXBpbGU6IGNoZWNrYm94UmFkaW9QcmVjb21waWxlLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpIHsKICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGlFbGVtZW50LnBhcmVudCgibGFiZWwiKTsKICAgICAgICAgICAgICAgIGlmICghaUF0dHJzLm5nbU5vTGFiZWwgJiYgbGFiZWwubGVuZ3RoPT09MCkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHR3byBjaGVja2JveGVzIGFyZSBjcmVhdGVkIGJ5IG5nLXJlcGVhdCwgYW5kIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIG5nLXJlcGVhdCBpcyBvbiB0aGUgY2hlY2tib3ggYW5kIG5vdCBvbiB0aGUgbGFiZWwsCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IGNoZWNrYm94IHdpbGwgYmUgZmluZSwgYnV0IHRoZSBzZWNvbmQgb25lCiAgICAgICAgICAgICAgICAgICAgLy8gd2lsbCBiZSBhdCBhbiBvZGQgcGxhY2UgaW4gdGhlIGRvbS4uLgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRG9uJ3QgdXNlIG5nLXJlcGVhdCBvciBvdGhlciBjb25kaXRpb25hbCBkaXJlY3RpdmVzIG9uIGNoZWNrYm94ZXMvcmFkaW9idXR0b25zIGRpcmVjdGx5LiBJbnN0ZWFkLCB3cmFwIHRoZSBpbnB1dCBpbnRvIGEgbGFiZWwgYW5kIHB1dCB0aGUgZGlyZWN0aXZlIG9uIHRoYXQgaW5wdXQhIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmNyZWF0ZVdpZGdldCh3aWRnZXROYW1lLCBpRWxlbWVudCwgaUF0dHJzKTsKCiAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LmJpbmREZWZhdWx0QXR0cnNBbmRFdmVudHMod2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsKTsKCiAgICAgICAgICAgICAgICBpQXR0cnMuJG9ic2VydmUoImNoZWNrZWQiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBqcW1OZ1dpZGV0LnRyaWdnZXJBc3luY1JlZnJlc2god2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCAicmVmcmVzaCIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBjaGVja2JveFJhZGlvUHJlY29tcGlsZShvcmlnRWxlbWVudCwgaW5pdEFyZ3MpIHsKICAgICAgICAgICAgLy8gd3JhcCB0aGUgaW5wdXQgdGVtcG9yYXJpbHkgaW50byBpdCdzIGxhYmVsICh3aWxsIGJlIHVuZG9uZSBieSB0aGUgd2lkZ2V0KS4KICAgICAgICAgICAgLy8gQnkgdGhpcywgdGhlIGpxbSB3aWRnZXQgd2lsbCBhbHdheXMKICAgICAgICAgICAgLy8gdXNlIHRoaXMgbGFiZWwsIGV2ZW4gaWYgdGhlcmUgYXJlIG90aGVyIGxhYmVscyB3aXRoIHRoZSBzYW1lIGlkIG9uIHRoZSBzYW1lIHBhZ2UuCiAgICAgICAgICAgIC8vIFRoaXMgaXMgaW1wb3J0YW50IGlmIHdlIHVzZSBuZy1yZXBlYXQgb24gY2hlY2tib3hlcywgYXMgdGhpcyBjb3VsZAogICAgICAgICAgICAvLyBjcmVhdGUgbXVsdGlwbGUgY2hlY2tib3hlcyB3aXRoIHRoZSBzYW1lIGlkIQogICAgICAgICAgICAvLyBUaGlzIG5lZWRzIHRvIGJlIGRvbmUgaW4gdGhlIHByZWNvbXBpbGUsIGFzIG90aGVyd2lzZSBhbmd1bGFyIGNvbXBpbGVyIGNvdWxkIGdldCBpbnRvIHRyb3VibGUKICAgICAgICAgICAgLy8gd2hlbiBpbnB1dCBhbmQgbGFiZWwgYXJlIHNpYmxpbmdzIQogICAgICAgICAgICAvLyBTZWUgdGhlIGNoZWNrYm94cmFkaW8tUGx1Z2luIGluIGpxbSBmb3IgdGhlIHNlbGVjdG9ycyB1c2VkIHRvIGxvY2F0ZSB0aGUgbGFiZWwuCiAgICAgICAgICAgIHZhciBwYXJlbnRMYWJlbCA9ICQob3JpZ0VsZW1lbnQpLmNsb3Nlc3QoImxhYmVsIik7CiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKG9yaWdFbGVtZW50KS5jbG9zZXN0KCJmb3JtLGZpZWxkc2V0LDpqcW1EYXRhKHJvbGU9J3BhZ2UnKSw6anFtRGF0YShyb2xlPSdkaWFsb2cnKSIpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgY29udGFpbmVyID0gb3JpZ0VsZW1lbnQucGFyZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGxhYmVsID0gcGFyZW50TGFiZWwubGVuZ3RoID8gcGFyZW50TGFiZWwgOiBjb250YWluZXIuZmluZCgibGFiZWwiKS5maWx0ZXIoIltmb3I9JyIgKyBvcmlnRWxlbWVudFswXS5pZCArICInXSIpOwogICAgICAgICAgICBpZiAobGFiZWwubGVuZ3RoPT09MCkgewogICAgICAgICAgICAgICAgb3JpZ0VsZW1lbnQuYXR0cigibmdtLW5vLWxhYmVsIiwgInRydWUiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhYmVsLmFwcGVuZChvcmlnRWxlbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYnV0dG9uV2lkZ2V0KGpxbU5nV2lkZXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcmVjb21waWxlOiBmdW5jdGlvbihvcmlnRWxlbWVudCwgaW5pdEFyZ3MpIHsKICAgICAgICAgICAgICAgIC8vIEFkZCBhIHRleHQgbm9kZSB3aXRoIHRoZSB2YWx1ZSBjb250ZW50LAogICAgICAgICAgICAgICAgLy8gYXMgd2UgbmVlZCBhIHRleHQgbm9kZSBsYXRlciBpbiB0aGUganFtIGJ1dHRvbiBtYXJrdXAhCiAgICAgICAgICAgICAgICBpZiAob3JpZ0VsZW1lbnRbMF0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PT0gJ0lOUFVUJykgewogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9yaWdFbGVtZW50LnZhbCgpOwogICAgICAgICAgICAgICAgICAgIG9yaWdFbGVtZW50LmFwcGVuZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpIHsKICAgICAgICAgICAgICAgIC8vIEJ1dHRvbiBkZXN0cm95cyB0aGUgdGV4dCBub2RlIGFuZCByZWNyZWF0ZXMgYSBuZXcgb25lLiBUaGlzIGRvZXMgbm90IHdvcmsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0ZXh0IG5vZGUgY29udGFpbnMgYW5ndWxhciBleHByZXNzaW9ucywgc28gd2UgbW92ZSB0aGUKICAgICAgICAgICAgICAgIC8vIHRleHQgbm9kZSB0byB0aGUgcmlnaHQgcGxhY2UuCiAgICAgICAgICAgICAgICB2YXIgdGV4dE5vZGUgPSBpRWxlbWVudC5jb250ZW50cygpOwogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICB2YXIgdGV4dFNwYW4gPSBpRWxlbWVudC5wYXJlbnQoKS5maW5kKCIudWktYnRuLXRleHQiKTsKICAgICAgICAgICAgICAgIHRleHRTcGFuLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0ZXh0U3Bhbi5hcHBlbmQodGV4dE5vZGUpOwoKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb2xsYXBzaWJsZVdpZGdldChqcW1OZ1dpZGV0LCAkcGFyc2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbih3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpIHsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICBiaW5kQ29sbGFwc2VkQXR0cmlidXRlKHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGJpbmRDb2xsYXBzZWRBdHRyaWJ1dGUoc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMpIHsKICAgICAgICAgICAgdmFyIHN5bmNpbmcgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGlBdHRycy5jb2xsYXBzZWQpIHsKICAgICAgICAgICAgICAgIHZhciBjb2xsYXBzZWRHZXR0ZXIgPSAkcGFyc2UoaUF0dHJzLmNvbGxhcHNlZCk7CiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkU2V0dGVyID0gY29sbGFwc2VkR2V0dGVyLmFzc2lnbjsKICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChjb2xsYXBzZWRHZXR0ZXIsIHVwZGF0ZVdpZGdldCk7CiAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkU2V0dGVyKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2NvcGVPbigiY29sbGFwc2UiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVTY29wZU9uKCJleHBhbmQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVdpZGdldChjb2xsYXBzZWQpIHsKICAgICAgICAgICAgICAgIGlmIChzeW5jaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3luY2luZyA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgaUVsZW1lbnQudHJpZ2dlckhhbmRsZXIoImNvbGxhcHNlIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlFbGVtZW50LnRyaWdnZXJIYW5kbGVyKCJleHBhbmQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN5bmNpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2NvcGVPbihldmVudE5hbWUsIG5ld0NvbGxhcHNlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICBpRWxlbWVudC5iaW5kKGV2ZW50TmFtZSwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN5bmNpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzeW5jaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoIGlFbGVtZW50WzBdPT09ZXZlbnQudGFyZ2V0ICkgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VkU2V0dGVyKHNjb3BlLCBuZXdDb2xsYXBzZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzeW5jaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkaWFsb2dXaWRnZXQoanFtTmdXaWRldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByZWNvbXBpbGU6IGRpYWxvZ1ByZWNvbXBpbGUsCiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CiAgICAgICAgICAgICAgICAvLyBhZGQgaGFuZGxlciB0byBlbmhhbmNlZCBjbG9zZSBidXR0b24gbWFudWFsbHkgKHRoZSBvbmUgd2UgYWRkZWQgaW4gcHJlY29tcGlsZSksCiAgICAgICAgICAgICAgICAvLyBhbmQgcmVtb3ZlIHRoZSBvdGhlciBjbG9zZSBidXR0b24gKHRoZSBvbmUgdGhlIHdpZGdldCBjcmVhdGVkKS4KICAgICAgICAgICAgICAgIHZhciBjbG9zZUJ1dHRvbnMgPSBpRWxlbWVudC5maW5kKCc6anFtRGF0YShyb2xlPSJoZWFkZXIiKSBhOmpxbURhdGEoaWNvbj0iZGVsZXRlIiknKTsKICAgICAgICAgICAgICAgIGNsb3NlQnV0dG9ucy5lcSgxKS5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlFbGVtZW50LmRpYWxvZygiY2xvc2UiKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY2xvc2VCdXR0b25zLmVxKDApLnJlbW92ZSgpOwoKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gRGlhbG9nOiBzZXBhcmF0ZSBldmVudCBiaW5kaW5nIGFuZCBkb20gZW5oYW5jZW1lbnQuCiAgICAgICAgLy8gTm90ZTogV2UgZG8gbmVlZCB0byBhZGQgdGhlIGNsb3NlIGJ1dHRvbiBkdXJpbmcgcHJlY29tcGlsZSwKICAgICAgICAvLyBhcyB0aGUgZW5oYW5jZW1lbnQgZm9yIHRoZSBkaWFsb2cgaGVhZGVyIGRlcGVuZHMgb24gaXQgKGNhbGN1bGF0aW9uIHdoaWNoIGJ1dHRvbiBpcyBsZWZ0LCByaWdodCwgLi4uKSwKICAgICAgICAvLyBhbmQgdGhhdCBpcyBleGVjdXRlZCB3aGVuIHdlIGNyZWF0ZSB0aGUgcGFnZSB3aWRnZXQsIHdoaWNoIGlzIGJlZm9yZSB0aGUgZGlhbG9nIHdpZGdldCBpcyBjcmVhdGVkIDotKAogICAgICAgIC8vIFdlIGNhbm5vdCBhZGp1c3QgdGhlIHRpbWluZyBvZiB0aGUgaGVhZGVyIGVuaGFuY2VtZW50IGFzIGl0IGlzIG5vIGpxbSB3aWRnZXQuCiAgICAgICAgZnVuY3Rpb24gZGlhbG9nUHJlY29tcGlsZShvcmlnRWxlbWVudCwgaW5pdEF0dHJzKSB7CiAgICAgICAgICAgIEZha2VEaWFsb2cucHJvdG90eXBlID0gJC5tb2JpbGUuZGlhbG9nLnByb3RvdHlwZTsKICAgICAgICAgICAgdmFyIGZha2VEaWFsb2cgPSBuZXcgRmFrZURpYWxvZyhvcmlnRWxlbWVudCwge30pLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IGZha2VEaWFsb2cub3B0aW9ucywKICAgICAgICAgICAgICAgIHZhbHVlID0gb3B0aW9ucy5jbG9zZUJ0bjsKCiAgICAgICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgY29kZSBpcyBhZGFwdGVkIGZyb20gJC5tb2JpbGUuZGlhbG9nLnByb3RvdHlwZS5fc2V0Q2xvc2VCdG4KICAgICAgICAgICAgaWYgKCB2YWx1ZSAhPT0gIm5vbmUiICkgewogICAgICAgICAgICAgICAgLy8gU2FuaXRpemUgdmFsdWUKICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9ICggdmFsdWUgPT09ICJsZWZ0IiA/ICJsZWZ0IiA6ICJyaWdodCIgKTsKICAgICAgICAgICAgICAgIHZhciBidG4gPSAkKCAiPGEgaHJlZj0nIycgY2xhc3M9J3VpLWJ0bi0iICsgbG9jYXRpb24gKyAiJyBkYXRhLSIgKyAkLm1vYmlsZS5ucyArICJpY29uPSdkZWxldGUnIGRhdGEtIiArICQubW9iaWxlLm5zICsgImljb25wb3M9J25vdGV4dCc+Iisgb3B0aW9ucy5jbG9zZUJ0blRleHQgKyAiPC9hPiIgKTsKICAgICAgICAgICAgICAgIG9yaWdFbGVtZW50LmZpbmQoICI6anFtRGF0YShyb2xlPSdoZWFkZXInKSIgKS5maXJzdCgpLnByZXBlbmQoIGJ0biApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBGYWtlRGlhbG9nKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLndpZGdldC5leHRlbmQoIHt9LAogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICB0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjb250cm9sZ3JvdXBXaWRnZXQoanFtTmdXaWRldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCkgewogICAgICAgICAgICAgICAganFtTmdXaWRldC5jcmVhdGVXaWRnZXQod2lkZ2V0TmFtZSwgaUVsZW1lbnQsIGlBdHRycyk7CgogICAgICAgICAgICAgICAganFtTmdXaWRldC5iaW5kRGVmYXVsdEF0dHJzQW5kRXZlbnRzKHdpZGdldE5hbWUsIHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBuZ01vZGVsQ3RybCk7CiAgICAgICAgICAgICAgICBpRWxlbWVudC5iaW5kKCIkY2hpbGRyZW5DaGFuZ2VkIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQudHJpZ2dlckFzeW5jUmVmcmVzaCh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIHt9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiB0YWJsZVdpZGdldChqcW1OZ1dpZGV0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluazogZnVuY3Rpb24od2lkZ2V0TmFtZSwgc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIG5nTW9kZWxDdHJsLCBzZWxlY3RDdHJsKSB7CiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0LCBwb3B1cElkLCBwb3B1cDsKICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuY3JlYXRlV2lkZ2V0KHdpZGdldE5hbWUsIGlFbGVtZW50LCBpQXR0cnMpOwogICAgICAgICAgICAgICAgd2lkZ2V0ID0gaUVsZW1lbnQuZGF0YSgkLm1vYmlsZVt3aWRnZXROYW1lXS5wcm90b3R5cGUud2lkZ2V0RnVsbE5hbWUpOwogICAgICAgICAgICAgICAgLy8gVGhlIGNvbHVtbi10b2dnbGUgd2lkZ2V0IGNyZWF0ZXMgYSBwb3B1cCB3aXRoIGEgbm8gZW5oYW5jZWQgY29udHJvbGdyb3VwCiAgICAgICAgICAgICAgICAvLyBhbmQgcmVsaWVzIG9uIHRoZSBvcmRlciBpbiB3aGljaCBqcW0gZW5oYW5jZXMgdGhlIHdpZGdldHMuCiAgICAgICAgICAgICAgICAvLyBIb3dldmVyLCB0aGlzIG9yZGVyIGlzIGRpZmZlcmVudCBpbiB0aGUgYWRhcHRlciwKICAgICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHBvcHVwIGlzIHByb3Blcmx5IGVuaGFuY2VkLgogICAgICAgICAgICAgICAgaWYgKHdpZGdldCAmJiB3aWRnZXQub3B0aW9ucy5tb2RlPT09J2NvbHVtbnRvZ2dsZScpIHsKICAgICAgICAgICAgICAgICAgICBwb3B1cElkID0gKCBpRWxlbWVudC5hdHRyKCAiaWQiICkgfHwgd2lkZ2V0Lm9wdGlvbnMuY2xhc3Nlcy5wb3B1cCApICsgIi1wb3B1cCI7CiAgICAgICAgICAgICAgICAgICAgcG9wdXAgPSAkKCIjIitwb3B1cElkKTsKICAgICAgICAgICAgICAgICAgICBwb3B1cC50cmlnZ2VyKCJjcmVhdGUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGpxbU5nV2lkZXQuYmluZERlZmF1bHRBdHRyc0FuZEV2ZW50cyh3aWRnZXROYW1lLCBzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgbmdNb2RlbEN0cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCn0pKGFuZ3VsYXIsICQpOw==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 06:46:01 GMT",
                    "Content-Length": "16963",
                    "Date": "Fri, 07 Nov 2014 06:46:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}