{
    "url": "http://localhost:9999/nomocas/min-history/lib/min-history.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.pathname</b> and written to <b>location.pathname</b> via the following statement:<ul><li>location.pathname = location.pathname.substring(window.history.config.basePath.length);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/nomocas/min-history/lib/min-history.js",
                "path": "/nomocas/min-history/lib/min-history.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9ub21vY2FzL21pbi1oaXN0b3J5L2xpYi9taW4taGlzdG9yeS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTI1NjENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDk6NTI6NDMgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA5OjUyOjQyIEdNVA0KDQovKioKICogQGF1dGhvciBHaWxsZXMgQ29vbWFucyA8Z2lsbGVzLmNvb21hbnNAZ21haWwuY29tPgogKiBAbGljZW5jZSBNSVQKICogTWluaW1hbGlzdGljLCB3b3JrYWJsZSwgdW5kZXJzdGFuZGFibGUgaHRtbDUgaGlzdG9yeSBzaGltLgogKiBJRTgrLCBGRjMrLCBTYWZhcmksIENocm9tZSwgLi4uCiAqCiAqCiAqIFJlbWFycXVlIDogZm9yIElFOCwgcGxlYXNlIHVzZSBpdCBpbiBjb25qb25jdGlvbiB3aXRoIGh0dHBzOi8vZ2l0aHViLmNvbS9XZWJSZWZsZWN0aW9uL2llOAogKiAoRXZlbnRzIGxpc3RlbmVyIHBvbHlmaWxsIGZvciBJRTgpCiAqLwooZnVuY3Rpb24oKSB7CgkndXNlIHN0cmljdCc7CglpZiAoIXdpbmRvdy5oaXN0b3J5KSAvLyB0b28gb2xkICEhISA7KQoJCXJldHVybjsKCgkvLyBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyBVVElMUwoJdmFyIF91YU1hdGNoID0gZnVuY3Rpb24odWEpIHsKCQl1YSA9IHVhLnRvTG93ZXJDYXNlKCk7CgkJdmFyIG1hdGNoID0gLyhjaHJvbWUpWyBcL10oW1x3Ll0rKS8uZXhlYyh1YSkgfHwKCQkJLyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8uZXhlYyh1YSkgfHwKCQkJLyhvcGVyYSkoPzouKnZlcnNpb258KVsgXC9dKFtcdy5dKykvLmV4ZWModWEpIHx8CgkJCS8obXNpZSkgKFtcdy5dKykvLmV4ZWModWEpIHx8CgkJCXVhLmluZGV4T2YoJ2NvbXBhdGlibGUnKSA8IDAgJiYgLyhtb3ppbGxhKSg/Oi4qPyBydjooW1x3Ll0rKXwpLy5leGVjKHVhKSB8fCBbXTsKCQlyZXR1cm4gewoJCQlicm93c2VyOiBtYXRjaFsxXSB8fCAnJywKCQkJdmVyc2lvbjogbWF0Y2hbMl0gfHwgJzAnCgkJfTsKCX07CgoJdmFyIHVzZXJBZ2VudCA9IGZ1bmN0aW9uKCkgewoJCXZhciBicm93c2VyID0ge30sCgkJCW1hdGNoZWQgPSBfdWFNYXRjaChuYXZpZ2F0b3IudXNlckFnZW50KTsKCQlpZiAobWF0Y2hlZC5icm93c2VyKSB7CgkJCWJyb3dzZXJbbWF0Y2hlZC5icm93c2VyXSA9IHRydWU7CgkJCWJyb3dzZXIudmVyc2lvbiA9IG1hdGNoZWQudmVyc2lvbjsKCQl9CgkJaWYgKGJyb3dzZXIuY2hyb21lKQoJCQlicm93c2VyLndlYmtpdCA9IHRydWU7CgkJZWxzZSBpZiAoYnJvd3Nlci53ZWJraXQpCgkJCWJyb3dzZXIuc2FmYXJpID0gdHJ1ZTsKCQlyZXR1cm4gYnJvd3NlcjsKCX07CgoJdmFyIHBhcnNlVXJpID0gZnVuY3Rpb24oc3RyKSB7CgkJdmFyIG8gPSBwYXJzZVVyaS5vcHRpb25zLAoJCQltID0gby5wYXJzZXJbby5zdHJpY3RNb2RlID8gInN0cmljdCIgOiAibG9vc2UiXS5leGVjKHN0ciksCgkJCXVyaSA9IHt9LAoJCQlpID0gMTQ7CgkJd2hpbGUgKGktLSkKCQkJdXJpW28ua2V5W2ldXSA9IG1baV0gfHwgIiI7CgkJdXJpW28ucS5uYW1lXSA9IHt9OwoJCXVyaVtvLmtleVsxMl1dLnJlcGxhY2Uoby5xLnBhcnNlciwgZnVuY3Rpb24oJDAsICQxLCAkMikgewoJCQlpZiAoJDEpIHVyaVtvLnEubmFtZV1bJDFdID0gJDI7CgkJfSk7CgkJcmV0dXJuIHVyaTsKCX07CgoJcGFyc2VVcmkub3B0aW9ucyA9IHsKCQlzdHJpY3RNb2RlOiB0cnVlLAoJCWtleTogWyJocmVmIiwgInByb3RvY29sIiwgImhvc3QiLCAidXNlckluZm8iLCAidXNlciIsICJwYXNzd29yZCIsICJob3N0bmFtZSIsICJwb3J0IiwgInJlbGF0aXZlIiwgInBhdGhuYW1lIiwgImRpcmVjdG9yeSIsICJmaWxlIiwgInNlYXJjaCIsICJoYXNoIl0sCgkJcTogewoJCQluYW1lOiAicXVlcnkiLAoJCQlwYXJzZXI6IC8oPzpefCYpKFteJj1dKik9PyhbXiZdKikvZwoJCX0sCgkJcGFyc2VyOiB7CgkJCXN0cmljdDogL14oPzooW146XC8/I10rKTopPyg/OlwvXC8oKD86KChbXjpAXSopKD86OihbXjpAXSopKT8pP0ApPyhbXjpcLz8jXSopKD86OihcZCopKT8pKT8oKCgoPzpbXj8jXC9dKlwvKSopKFtePyNdKikpKD86XD8oW14jXSopKT8oPzojKC4qKSk/KS8sCgkJCWxvb3NlOiAvXig/Oig/IVteOkBdKzpbXjpAXC9dKkApKFteOlwvPyMuXSspOik/KD86XC9cLyk/KCg/OigoW146QF0qKSg/OjooW146QF0qKSk/KT9AKT8oW146XC8/I10qKSg/OjooXGQqKSk/KSgoKFwvKD86W14/I10oPyFbXj8jXC9dKlwuW14/I1wvLl0rKD86Wz8jXXwkKSkpKlwvPyk/KFtePyNcL10qKSkoPzpcPyhbXiNdKikpPyg/OiMoLiopKT8pLwoJCX0KCX07CgoJdmFyIHBhcnNlVVJMID0gZnVuY3Rpb24odXJsKSB7CgkJdmFyIG9iaiA9IHBhcnNlVXJpKHVybCk7CgkJb2JqLnBhdGggPSBvYmoucGF0aG5hbWUgKyAob2JqLnNlYXJjaD8iPyI6IiIpICsgb2JqLnNlYXJjaDsKCQlyZXR1cm4gb2JqOwoJfTsKCgkvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzkwNzcxMDEvaXBob25lLWxvY2Fsc3RvcmFnZS1xdW90YS1leGNlZWRlZC1lcnItaXNzdWUvMTI5NzY5ODgjMTI5NzY5ODgKCXZhciBzZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewoJCXRyeSB7CgkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInRlc3QiLCAidGVzdCIpOwoJCQlzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCJ0ZXN0Iik7CgkJCXJldHVybiB0cnVlOwoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX07CgoJLy8gcHJvZHVjZSBoaWQKCXZhciBwcm9kdWNlSUQgPSBmdW5jdGlvbigpewoJCXJldHVybiAiaCIrKCtuZXcgRGF0ZSArIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSoxMDAwMDAwKSk7Cgl9OwoKCS8vX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyBIaXN0b3J5IFNoaW0KCgl2YXIgc2tpcEhhc2hDaGFuZ2UsCgkJc2tpcEluaXRQb3AgPSBmYWxzZSwKCQlmcm9tR28gPSBmYWxzZSwKCQlhZ2VudCA9IHVzZXJBZ2VudCgpOwoKCXdpbmRvdy5oaXN0b3J5LnBhcnNlVVJMID0gcGFyc2VVUkw7Cgl3aW5kb3cuaGlzdG9yeS5jb25maWcgPSB7CgkJaGFzaENoYW5nZUFsb25lOiB0cnVlLAoJCXNldFN0YXRlRXZlbnQ6dHJ1ZSwKCQlzZXRIYXNoRXZlbnQ6dHJ1ZSwKCQlzdG9yYWdlS2V5OiAibWluLWhpc3RvcnkiLAoJCWJhc2VQYXRoOiAiIiwKCQloaWQ6IHRydWUKCX07CgoJLy8gc29tZSB2ZXJzaW9uIG9mIHNhZmFyaSAoYW5kIGNvKSBoYXZlIG5vICJzdGF0ZSIgcHJvcGVydHkgaW4gaGlzdG9yeS4gZm9yY2UgaXQuCgl3aW5kb3cuaGlzdG9yeS5mb3JjZVN0YXRlID0gISgic3RhdGUiIGluIHdpbmRvdy5oaXN0b3J5KTsKCWlmICh3aW5kb3cuaGlzdG9yeS5mb3JjZVN0YXRlKQoJCXdpbmRvdy5oaXN0b3J5LnN0YXRlID0gbnVsbDsKCgkvLyBzYWZhcmkgZmlyZSBwb3Agc3RhdGUgb24gcGFnZSBsb2FkLiBza2lwIGl0IGZvciBjb25zaXN0ZW5jeS4KCWlmIChhZ2VudC5zYWZhcmkgJiYgbG9jYXRpb24ucmVsYXRpdmUgIT09IHdpbmRvdy5oaXN0b3J5LmNvbmZpZy5iYXNlUGF0aCkKCQlza2lwSW5pdFBvcCA9IHRydWU7CgoJLy8gcHJvZHVjZSBocmVmIHdpdGggaGlkIGluIHNlYXJjaCBwYXJ0Cgl2YXIgZ2V0SHJlZldpdGhIaWQgPSBmdW5jdGlvbihpZCwgbG9jYXRpb24pIHsKCQl2YXIgc2VhcmNoID0gIj8iKyAobG9jYXRpb24uc2VhcmNoIHx8ICIiKSArICImaGlkPSIgKyBpZDsKCQlyZXR1cm4gKGxvY2F0aW9uLnBhdGhuYW1lIHx8ICcvJykgCgkJCSsgc2VhcmNoCgkJCSsgKGxvY2F0aW9uLmhhc2ggPyAoIiMiICsgbG9jYXRpb24uaGFzaCkgOiAiIik7Cgl9OwoKCS8vIHJlbW92ZSBoaWQgZnJvbSBsb2NhdGlvbiBwYXJ0cy4gc3RvcmUgaGlkIGluIGxvY2F0aW9uLgoJdmFyIGNsZWFuSGlkRnJvbUxvY2F0aW9uID0gZnVuY3Rpb24obG9jYXRpb24pIHsKCQlpZiAoIWxvY2F0aW9uLnNlYXJjaCkKCQkJcmV0dXJuOwoJCWxvY2F0aW9uLnNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaC5yZXBsYWNlKC8maGlkPShbXiZdKykvZ2ksIGZ1bmN0aW9uKGMsIHYpIHsKCQkJbG9jYXRpb24uaGlkID0gdjsKCQkJcmV0dXJuICIiOwoJCX0pOwoJCWxvY2F0aW9uLnBhdGggPSBsb2NhdGlvbi5wYXRobmFtZSArIChsb2NhdGlvbi5zZWFyY2ggPyAoIj8iICsgbG9jYXRpb24uc2VhcmNoKSA6ICIiKTsKCQlsb2NhdGlvbi5yZWxhdGl2ZSA9IGxvY2F0aW9uLnBhdGggKyAobG9jYXRpb24uaGFzaCA/ICgiIyIgKyBsb2NhdGlvbi5oYXNoKSA6ICIiKTsKCQlsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24ucHJvdG9jb2wgKyAiOi8vIiArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5yZWxhdGl2ZTsKCX07CgoJdmFyIHJlbW92ZUJhc2VQYXRoID0gZnVuY3Rpb24obG9jYXRpb24pewoJCWlmKCF3aW5kb3cuaGlzdG9yeS5jb25maWcuYmFzZVBhdGgpCgkJCXJldHVybiBsb2NhdGlvbjsKCQlsb2NhdGlvbi5wYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lLnN1YnN0cmluZyh3aW5kb3cuaGlzdG9yeS5jb25maWcuYmFzZVBhdGgubGVuZ3RoKTsKCQlsb2NhdGlvbi5wYXRoID0gbG9jYXRpb24ucGF0aG5hbWUgKyAobG9jYXRpb24uc2VhcmNoID8gKCI/IiArIGxvY2F0aW9uLnNlYXJjaCkgOiAiIik7CgkJbG9jYXRpb24ucmVsYXRpdmUgPSBsb2NhdGlvbi5wYXRoICsgKGxvY2F0aW9uLmhhc2ggPyAoIiMiICsgbG9jYXRpb24uaGFzaCkgOiAiIik7CgkJbG9jYXRpb24uaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgIjovLyIgKyBsb2NhdGlvbi5ob3N0ICsgbG9jYXRpb24ucmVsYXRpdmU7CgkJcmV0dXJuIGxvY2F0aW9uOwoJfTsKCgl2YXIgZmlyZVN0YXRlRXZlbnQgPSBmdW5jdGlvbih0eXBlLCBzdGF0ZSwgYWN0aW9uKSB7CgkJdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudCIpOwoJCWV2dC5pbml0RXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSk7CgkJZXZ0LnN0YXRlID0gc3RhdGUgfHwgbnVsbDsKCQlpZihhY3Rpb24pCgkJCWV2dC5hY3Rpb24gPSBhY3Rpb247CgkJcmV0dXJuIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2dCk7Cgl9OwoKCXdpbmRvdy5oaXN0b3J5LnN0b3JlID0gewoJCXN0YXRlczogW10sCgkJaW5kZXg6IC0xLAoJCWluaXQ6IGZ1bmN0aW9uKCkgewoJCQlpZiAoISh3aW5kb3cuaGlzdG9yeS5zZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCA9IHNlc3Npb25TdG9yYWdlU3VwcG9ydGVkKCkpKQoJCQkJY29uc29sZS53YXJuKCJZb3UgYXJlIHVzaW5nIGN1c3RvbSBoaXN0b3J5IEFQSSBhbmQgU2Vzc2lvbiBTdG9yYWdlIGlzIG5vdCBzdXBwb3J0ZWQuIFlvdSdsbCBsb29zZSBoaXN0b3J5IHdoZW4gbGVhdmluZyBwYWdlLiIpOwoJCQkKCQkJaWYgKHdpbmRvdy5oaXN0b3J5LnNlc3Npb25TdG9yYWdlU3VwcG9ydGVkKQoJCQkJdGhpcy5zdGF0ZXMgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0od2luZG93Lmhpc3RvcnkuY29uZmlnLnN0b3JhZ2VLZXkpKSB8fCBbXTsKCQkJZWxzZQoJCQkJdGhpcy5zdGF0ZXMgPSBbXTsKCQkJaWYgKCF0aGlzLnN0YXRlcy5mb3JFYWNoKQoJCQkJdGhpcy5zdGF0ZXMgPSBbXTsKCQkJLy8gY29uc29sZS5sb2coImluaXQgaGlzdG9yeSBzdGF0ZXMgOiAiLCB0aGlzLnN0YXRlcyk7CgkJfSwKCQljdXJyZW50OmZ1bmN0aW9uKCl7CgkJCXJldHVybiB0aGlzLnN0YXRlc1t0aGlzLmluZGV4XTsKCQl9LAoJCXB1c2g6IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQkJdmFyIHN0YXRlID0geyBkYXRhOiBkYXRhLCB0aXRsZTogdGl0bGUsIHVybDogdXJsIH07CgkJCWlmKHdpbmRvdy5oaXN0b3J5LmNvbmZpZy5oaWQpCgkJCXsKCQkJCXN0YXRlLmRhdGEgPSBzdGF0ZS5kYXRhIHx8IHt9OwoJCQkJc3RhdGUuZGF0YS5oaWQgPSBwcm9kdWNlSUQoKTsKCQkJfQoJCQl0aGlzLmluZGV4Kys7CgkJCWlmICh0aGlzLmluZGV4IDwgdGhpcy5zdGF0ZXMubGVuZ3RoKQoJCQkJdGhpcy5zdGF0ZXMgPSB0aGlzLnN0YXRlcy5zbGljZSgwLCB0aGlzLmluZGV4KTsKCQkJdGhpcy5zdGF0ZXMucHVzaChzdGF0ZSk7CgkJCXJldHVybiBzdGF0ZTsKCQl9LAoJCXJlcGxhY2U6IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQkJdmFyIG9sZCA9IHRoaXMuc3RhdGVzW3RoaXMuaW5kZXhdLAoJCQkJc3RhdGUgPSB7IGRhdGE6IGRhdGEsIHRpdGxlOiB0aXRsZSwgdXJsOiB1cmwgfTsKCQkJaWYod2luZG93Lmhpc3RvcnkuY29uZmlnLmhpZCkKCQkJewoJCQkJc3RhdGUuZGF0YSA9IHN0YXRlLmRhdGEgfHwge307CgkJCQlzdGF0ZS5kYXRhLmhpZCA9IChvbGQgJiYgb2xkLmRhdGEgJiYgb2xkLmRhdGEuaGlkKSA/IG9sZC5kYXRhLmhpZCA6IHByb2R1Y2VJRCgpOwoJCQl9CgkJCXJldHVybiB0aGlzLnN0YXRlc1t0aGlzLmluZGV4XSA9IHN0YXRlOwoJCX0sCgkJZ286IGZ1bmN0aW9uKGluY3JlbWVudCkgewoJCQl2YXIgaSA9IHRoaXMuaW5kZXggKyBpbmNyZW1lbnQsCgkJCQlzdGF0ZSA9IHRoaXMuc3RhdGVzW2ldOwoJCQlpZiAoIXN0YXRlKQoJCQkJcmV0dXJuIG51bGw7CgkJCXRoaXMuaW5kZXggPSBpOwoJCQlyZXR1cm4gc3RhdGU7CgkJfSwKCQlmaW5kOiBmdW5jdGlvbihpZCkgewoJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5zdGF0ZXMubGVuZ3RoLCBzdGF0ZTsgaSA8IGxlbiAmJiAoc3RhdGUgPSB0aGlzLnN0YXRlc1tpXSk7ICsraSkKCQkJCWlmIChzdGF0ZS5kYXRhICYmIHN0YXRlLmRhdGEuaGlkID09IGlkKQoJCQkJCXJldHVybiBzdGF0ZTsKCQkJcmV0dXJuIG51bGw7CgkJfSwKCQlzYXZlOiBmdW5jdGlvbigpIHsKCQkJaWYgKHdpbmRvdy5oaXN0b3J5LnNlc3Npb25TdG9yYWdlU3VwcG9ydGVkKQoJCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh3aW5kb3cuaGlzdG9yeS5jb25maWcuc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkodGhpcy5zdGF0ZXMpKTsKCQl9Cgl9OwkKCXZhciBzZXRTdGF0ZTsgCglpZiAoIXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgLy8gRU1VTEFURUQKCXsKCQl3aW5kb3cuaGlzdG9yeS5lbXVsYXRlZCA9IHRydWU7CgkJc2V0U3RhdGUgPSBmdW5jdGlvbih0eXBlLCBkYXRhLCB0aXRsZSwgdXJsKQoJCXsKCQkJaWYodGl0bGUpCgkJCQlkb2N1bWVudC50aXRsZSA9IHRpdGxlOwoJCQl2YXIgb2xkTG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uOwoJCQl0aGlzLmxvY2F0aW9uID0gcGFyc2VVUkwodXJsKTsKCQkJdmFyIGhyZWYgPSB0aGlzLmxvY2F0aW9uLnJlbGF0aXZlOwoJCQlpZiAodGhpcy5jb25maWcuaGlkKQoJCQl7CgkJCQl0aGlzLnN0YXRlID0gZGF0YSA9IHRoaXMuc3RvcmVbdHlwZV0oZGF0YSwgdGl0bGUsIGhyZWYpLmRhdGE7CS8vICdwdXNoJyBvciAncmVwbGFjZScgaW4gc3RvcmUKCQkJCWhyZWYgPSBnZXRIcmVmV2l0aEhpZChkYXRhLmhpZCwgdGhpcy5sb2NhdGlvbik7IC8vIGxhdW5jaCBoYXNoY2hhbmdlCgkJCX0KCQkJZWxzZQoJCQkJdGhpcy5zdGF0ZSA9IGRhdGEgfHwgbnVsbDsKCQkJaWYodGhpcy5sb2NhdGlvbi5wYXRoID09IG9sZExvY2F0aW9uLnBhdGggJiYgdGhpcy5sb2NhdGlvbi5oYXNoICE9PSBvbGRMb2NhdGlvbi5oYXNoICYmIHRoaXMuY29uZmlnLnNldEhhc2hFdmVudCkKCQkJCWZpcmVTdGF0ZUV2ZW50KCJzZXRoYXNoIiwgdGhpcy5zdGF0ZSwgdHlwZSk7CgkJCWVsc2UgaWYodGhpcy5jb25maWcuc2V0U3RhdGVFdmVudCkKCQkJCWZpcmVTdGF0ZUV2ZW50KCJzZXRzdGF0ZSIsIHRoaXMuc3RhdGUsIHR5cGUpOwoJCQlza2lwSGFzaENoYW5nZSA9IHRydWU7CgkJCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gIiEiICsgaHJlZjsgLy8gbGF1bmNoIGhhc2hjaGFuZ2UKCQl9CgkJdmFyIG9yaWdpbmFsR28gPSB3aW5kb3cuaGlzdG9yeS5nbzsKCQl3aW5kb3cuaGlzdG9yeS5nbyA9IGZ1bmN0aW9uKGFyZykgewoJCQlpZih0aGlzLmNvbmZpZy5oaWQpCgkJCXsKCQkJCXZhciBzdGF0ZSA9IHRoaXMuc3RvcmUuZ28oYXJnKTsKCQkJCWlmICghc3RhdGUpCgkJCQkJcmV0dXJuIG51bGw7CgkJCQl0aGlzLnN0YXRlID0gc3RhdGUuZGF0YTsKCQkJfQoJCQllbHNlCgkJCQl0aGlzLnN0YXRlID0gbnVsbDsKCQkJZnJvbUdvID0gdHJ1ZTsKCQkJb3JpZ2luYWxHby5jYWxsKHRoaXMsIGFyZyk7CgkJfTsKCQl3aW5kb3cuaGlzdG9yeS5iYWNrID0gZnVuY3Rpb24oYXJnKSB7CgkJCXRoaXMuZ28oLTEpOwoJCX07CgkJd2luZG93Lmhpc3RvcnkuZm9yd2FyZCA9IGZ1bmN0aW9uKGFyZykgewoJCQl0aGlzLmdvKDEpOwoJCX07Cgl9IAoJZWxzZSAvLyBOQVRJVkUKCXsKCQl2YXIgb3JpZ2luYWxQdXNoU3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUsCgkJCW9yaWdpbmFsUmVwbGFjZVN0YXRlID0gd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlOwoJCXNldFN0YXRlID0gZnVuY3Rpb24odHlwZSwgZGF0YSwgdGl0bGUsIHVybCl7CgkJCXZhciBvcmlnaW5hbCA9IG9yaWdpbmFsUmVwbGFjZVN0YXRlOwoJCQlpZih0eXBlID09ICdwdXNoJykKCQkJCW9yaWdpbmFsID0gb3JpZ2luYWxQdXNoU3RhdGU7CgkJCWlmKHRpdGxlKQoJCQkJZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKCQkJdmFyIG9sZExvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjsKCQkJdGhpcy5sb2NhdGlvbiA9IHBhcnNlVVJMKHVybCk7CgkJCWlmKHRoaXMuY29uZmlnLmhpZCkKCQkJCWRhdGEgPSB0aGlzLnN0b3JlW3R5cGVdKGRhdGEsIHRpdGxlLCB0aGlzLmxvY2F0aW9uLnJlbGF0aXZlKS5kYXRhOyAvLyBwdXNoIG9yIHJlcGxhY2UgaW4gc3RvcmUKCQkJaWYodGhpcy5mb3JjZVN0YXRlKQoJCQkJdGhpcy5zdGF0ZSA9IGRhdGEgfHwgbnVsbDsKCQkJdmFyIHIgPSBvcmlnaW5hbC5jYWxsKHRoaXMsIGRhdGEsIHRpdGxlLCB3aW5kb3cuaGlzdG9yeS5jb25maWcuYmFzZVBhdGggKyB0aGlzLmxvY2F0aW9uLnJlbGF0aXZlKTsKCQkJaWYodGhpcy5sb2NhdGlvbi5wYXRoID09IG9sZExvY2F0aW9uLnBhdGggJiYgdGhpcy5sb2NhdGlvbi5oYXNoICE9PSBvbGRMb2NhdGlvbi5oYXNoICYmIHRoaXMuY29uZmlnLnNldEhhc2hFdmVudCkKCQkJCWZpcmVTdGF0ZUV2ZW50KCJzZXRoYXNoIiwgdGhpcy5zdGF0ZSwgdHlwZSk7CgkJCWVsc2UgaWYodGhpcy5jb25maWcuc2V0U3RhdGVFdmVudCkKCQkJCWZpcmVTdGF0ZUV2ZW50KCJzZXRzdGF0ZSIsIHRoaXMuc3RhdGUsIHR5cGUpOwoJCQlyZXR1cm4gcjsKCQl9Cgl9CgoJd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXJldHVybiBzZXRTdGF0ZS5jYWxsKHRoaXMsICdwdXNoJywgZGF0YSwgdGl0bGUsIHVybCk7Cgl9OwoJd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXJldHVybiBzZXRTdGF0ZS5jYWxsKHRoaXMsICdyZXBsYWNlJywgZGF0YSwgdGl0bGUsIHVybCk7Cgl9OwoKCS8vIE5hdGl2ZSBPbmx5Cgl2YXIgcG9wU3RhdGUgPSBmdW5jdGlvbihlKSB7CgkJLy8gY29uc29sZS5sb2coImhpc3RvcnkgcG9wU3RhdGUgOiAiLCBlKTsKCQl2YXIgc3RhdGVEYXRhID0gZS5zdGF0ZSwgaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwoJCWlmIChoaXN0b3J5LmZvcmNlU3RhdGUpCgkJCWhpc3Rvcnkuc3RhdGUgPSBzdGF0ZURhdGEgfHwgbnVsbDsKCgkJaWYgKHNraXBJbml0UG9wKSB7CS8vIHNhZmFyaSBwb3BzdGF0ZSBhdCBpbml0IHNraXBwZWQuCgkJCXNraXBJbml0UG9wID0gZmFsc2U7CgkJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJc2tpcEhhc2hDaGFuZ2UgPSBmYWxzZTsKCQl2YXIgdG1wID0gaGlzdG9yeS5sb2NhdGlvbiwJLy8gb2xkCgkJCWN1cnJlbnQgPSBoaXN0b3J5LmxvY2F0aW9uID0gcmVtb3ZlQmFzZVBhdGgocGFyc2VVUkwobG9jYXRpb24uaHJlZikpLCAvLyBuZXcKCQkJc3RhdGU7CgoJCWlmKGhpc3RvcnkuY29uZmlnLmhpZCAmJiBzdGF0ZURhdGEgJiYgc3RhdGVEYXRhLmhpZCkJLy8gdHJ5IHRvIGdldCBzdGF0ZSBmcm9tIGhpZAoJCQlzdGF0ZSA9IGhpc3Rvcnkuc3RvcmUuZmluZChzdGF0ZURhdGEuaGlkKTsKCQkKCQlpZihzdGF0ZSkKCQl7CgkJCS8vIGNoZWNrIHVybCBlcXVhbGl0eS4KCQkJaWYoY3VycmVudC5yZWxhdGl2ZSAhPT0gc3RhdGUudXJsKQoJCQkJdGhyb3cgbmV3IEVycm9yKCJiYWQgc3RhdGUgZnJvbSBuYXRpdmUgcG9wc3RhdGUgKHVybCBkb250IG1hdGNoKSAiK2N1cnJlbnQucmVsYXRpdmUrIiAtICIrc3RhdGUudXJsKTsKCQkJaWYoc3RhdGUudGl0bGUpIC8vIGZvcmNlIHRpdGxlCgkJCQlkb2N1bWVudC50aXRsZSA9IHN0YXRlLnRpdGxlOwoJCX0KCQlpZiAoIXRtcCB8fCB0bXAucGF0aCAhPT0gY3VycmVudC5wYXRoKSAvLyByZWxhdGl2ZSBoYXMgY2hhbmdlIDogYXBwbHkgcG9wIHN0YXRlCgkJewoJCQlpZiAodG1wICYmIHRtcC5oYXNoICE9PSBjdXJyZW50Lmhhc2gpCgkJCQlza2lwSGFzaENoYW5nZSA9IHRydWU7CgkJCXJldHVybiB0cnVlOwoJCX0gCgkJZWxzZSAvLyBwYXRoIGRvZXNuJ3QgY2hhbmdlLiBjaGVjayBoYXNoCgkJaWYgKHRtcC5oYXNoICE9PSBjdXJyZW50Lmhhc2ggJiYgaGlzdG9yeS5jb25maWcuaGFzaENoYW5nZUFsb25lKQoJCXsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJcmV0dXJuIGZhbHNlOyAvLyBza2lwIHBvcHN0YXRlIGlmIGNvbmZpZy5oYXNoQ2hhbmdlQWxvbmUKCQl9CgkJcmV0dXJuIHRydWU7IC8vIG5vdGhpbmcgY2hhbmdlIDogcmVmcmVzaAoJfTsKCgoJdmFyIGhhc2hDaGFuZ2UgPSBmdW5jdGlvbihlKSB7CgkJaWYgKHNraXBIYXNoQ2hhbmdlKSAvLyBza2lwIGFmdGVyIHB1c2hTdGF0ZS9yZXBsYWNlU3RhdGUgKGVtdWxhdGVkKSAgT1IgIGFmdGVyICJwYXRoIGNoYW5nZSIgZnJvbSBwb3BzdGF0ZSAobmF0aXZlKSwgCgkJewoJCQlza2lwSGFzaENoYW5nZSA9IGZhbHNlOwoJCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCS8vX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fIFBPUCBTVEFURSBFTVVMQVRJT04KCQlpZiAod2luZG93Lmhpc3RvcnkuZW11bGF0ZWQpIC8vIGRvIHBvcHN0YXRlIGJlaGF2aW91cgoJCXsKCQkJIC8vIGNvdWxkIGJlIGZyb20gYmFjay9uZXh0IGJ1dHRvbiBvciBtYW51YWwgaGFzaCBjaGFuZ2UgaW4gYWRkcmVzcyBiYXIuCgkJCXZhciBzdGF0ZSwKCQkJCWRhdGEgPSBudWxsLAoJCQkJdG1wID0gd2luZG93Lmhpc3RvcnkubG9jYXRpb24sIC8vIHN3YXAgY3VycmVudExvY2F0aW9uCgkJCQljdXJyZW50ID0gd2luZG93Lmhpc3RvcnkubG9jYXRpb24gPSBwYXJzZVVSTChsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygyKSk7CgkJCWlmICh3aW5kb3cuaGlzdG9yeS5jb25maWcuaGlkKQoJCQl7CgkJCQljbGVhbkhpZEZyb21Mb2NhdGlvbihjdXJyZW50KTsgLy8gdHJ5IHRvIGV4dHJhY3QgaGlkCgkJCQlpZighZnJvbUdvKQoJCQkJewoJCQkJCWlmIChjdXJyZW50LmhpZCkKCQkJCQkJc3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5zdG9yZS5maW5kKGN1cnJlbnQuaGlkKTsKCQkJCQlpZihzdGF0ZSkKCQkJCQkJZGF0YSA9IHN0YXRlLmRhdGEgfHwgbnVsbDsKCQkJCQl3aW5kb3cuaGlzdG9yeS5zdGF0ZSA9IGRhdGE7CgkJCQl9CgkJCX0KCQkJaWYoc3RhdGUgJiYgc3RhdGUudGl0bGUpCS8vIGZvcmNlIHRpdGxlCgkJCQlkb2N1bWVudC50aXRsZSA9IHN0YXRlLnRpdGxlOwoKCQkJaWYgKCF0bXAgfHwgdG1wLnBhdGggIT09IGN1cnJlbnQucGF0aCkgeyAvLyBwYXRoID09IHBhdGhuYW1lICsgPyArIHNlYXJjaAoJCQkJLy8gcGF0aCBoYXMgY2hhbmdlIDogZGlzcGF0Y2ggcG9wc3RhdGUgYW5kIHNraXAgaGFzaGNoYW5nZQoJCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJCWZpcmVTdGF0ZUV2ZW50KCJwb3BzdGF0ZSIsIGRhdGEpOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCS8vIHBhdGggZG9lc24ndCBjaGFuZ2UuIAoJCQkvLyBjaGVjayBoYXNoIGNoYW5nZSA6IGlmICFoYXNoQ2hhbmdlQWxvbmUgOiBkaXNwYXRjaCBwb3BzdGF0ZQoJCQlpZiAodG1wLmhhc2ggIT09IGN1cnJlbnQuaGFzaCAmJiAhd2luZG93Lmhpc3RvcnkuY29uZmlnLmhhc2hDaGFuZ2VBbG9uZSkKCQkJCWZpcmVTdGF0ZUV2ZW50KCJwb3BzdGF0ZSIsIGRhdGEpOwoJCX0KCQlyZXR1cm4gdHJ1ZTsgLy8gcHJvcGFnYXRlIGhhc2hjaGFuZ2UKCX07CgoJd2luZG93Lmhpc3RvcnkuaW5pdCA9IGZ1bmN0aW9uKG9wdCkgewoJCWZvciAodmFyIGkgaW4gb3B0KQoJCQl0aGlzLmNvbmZpZ1tpXSA9IG9wdFtpXTsKCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiaGFzaGNoYW5nZSIsIGhhc2hDaGFuZ2UpOwoJCWlmICghdGhpcy5lbXVsYXRlZCkKCQl7CgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb3BzdGF0ZSIsIHBvcFN0YXRlKTsKCQkJdGhpcy5sb2NhdGlvbiA9IHJlbW92ZUJhc2VQYXRoKHBhcnNlVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSk7CgkJfQoJCWVsc2UKCQkJdGhpcy5sb2NhdGlvbiA9IHBhcnNlVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKCQlpZih0aGlzLmNvbmZpZy5oaWQpCgkJewoJCQl0aGlzLnN0b3JlLmluaXQoKTsKCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsIGZ1bmN0aW9uKCkgewoJCQkJd2luZG93Lmhpc3Rvcnkuc3RvcmUuc2F2ZSgpOwoJCQl9KTsKCQl9Cgl9Owp9KSgpOwo=",
                "body": "LyoqCiAqIEBhdXRob3IgR2lsbGVzIENvb21hbnMgPGdpbGxlcy5jb29tYW5zQGdtYWlsLmNvbT4KICogQGxpY2VuY2UgTUlUCiAqIE1pbmltYWxpc3RpYywgd29ya2FibGUsIHVuZGVyc3RhbmRhYmxlIGh0bWw1IGhpc3Rvcnkgc2hpbS4KICogSUU4KywgRkYzKywgU2FmYXJpLCBDaHJvbWUsIC4uLgogKgogKgogKiBSZW1hcnF1ZSA6IGZvciBJRTgsIHBsZWFzZSB1c2UgaXQgaW4gY29uam9uY3Rpb24gd2l0aCBodHRwczovL2dpdGh1Yi5jb20vV2ViUmVmbGVjdGlvbi9pZTgKICogKEV2ZW50cyBsaXN0ZW5lciBwb2x5ZmlsbCBmb3IgSUU4KQogKi8KKGZ1bmN0aW9uKCkgewoJJ3VzZSBzdHJpY3QnOwoJaWYgKCF3aW5kb3cuaGlzdG9yeSkgLy8gdG9vIG9sZCAhISEgOykKCQlyZXR1cm47CgoJLy8gX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gVVRJTFMKCXZhciBfdWFNYXRjaCA9IGZ1bmN0aW9uKHVhKSB7CgkJdWEgPSB1YS50b0xvd2VyQ2FzZSgpOwoJCXZhciBtYXRjaCA9IC8oY2hyb21lKVsgXC9dKFtcdy5dKykvLmV4ZWModWEpIHx8CgkJCS8od2Via2l0KVsgXC9dKFtcdy5dKykvLmV4ZWModWEpIHx8CgkJCS8ob3BlcmEpKD86Lip2ZXJzaW9ufClbIFwvXShbXHcuXSspLy5leGVjKHVhKSB8fAoJCQkvKG1zaWUpIChbXHcuXSspLy5leGVjKHVhKSB8fAoJCQl1YS5pbmRleE9mKCdjb21wYXRpYmxlJykgPCAwICYmIC8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKyl8KS8uZXhlYyh1YSkgfHwgW107CgkJcmV0dXJuIHsKCQkJYnJvd3NlcjogbWF0Y2hbMV0gfHwgJycsCgkJCXZlcnNpb246IG1hdGNoWzJdIHx8ICcwJwoJCX07Cgl9OwoKCXZhciB1c2VyQWdlbnQgPSBmdW5jdGlvbigpIHsKCQl2YXIgYnJvd3NlciA9IHt9LAoJCQltYXRjaGVkID0gX3VhTWF0Y2gobmF2aWdhdG9yLnVzZXJBZ2VudCk7CgkJaWYgKG1hdGNoZWQuYnJvd3NlcikgewoJCQlicm93c2VyW21hdGNoZWQuYnJvd3Nlcl0gPSB0cnVlOwoJCQlicm93c2VyLnZlcnNpb24gPSBtYXRjaGVkLnZlcnNpb247CgkJfQoJCWlmIChicm93c2VyLmNocm9tZSkKCQkJYnJvd3Nlci53ZWJraXQgPSB0cnVlOwoJCWVsc2UgaWYgKGJyb3dzZXIud2Via2l0KQoJCQlicm93c2VyLnNhZmFyaSA9IHRydWU7CgkJcmV0dXJuIGJyb3dzZXI7Cgl9OwoKCXZhciBwYXJzZVVyaSA9IGZ1bmN0aW9uKHN0cikgewoJCXZhciBvID0gcGFyc2VVcmkub3B0aW9ucywKCQkJbSA9IG8ucGFyc2VyW28uc3RyaWN0TW9kZSA/ICJzdHJpY3QiIDogImxvb3NlIl0uZXhlYyhzdHIpLAoJCQl1cmkgPSB7fSwKCQkJaSA9IDE0OwoJCXdoaWxlIChpLS0pCgkJCXVyaVtvLmtleVtpXV0gPSBtW2ldIHx8ICIiOwoJCXVyaVtvLnEubmFtZV0gPSB7fTsKCQl1cmlbby5rZXlbMTJdXS5yZXBsYWNlKG8ucS5wYXJzZXIsIGZ1bmN0aW9uKCQwLCAkMSwgJDIpIHsKCQkJaWYgKCQxKSB1cmlbby5xLm5hbWVdWyQxXSA9ICQyOwoJCX0pOwoJCXJldHVybiB1cmk7Cgl9OwoKCXBhcnNlVXJpLm9wdGlvbnMgPSB7CgkJc3RyaWN0TW9kZTogdHJ1ZSwKCQlrZXk6IFsiaHJlZiIsICJwcm90b2NvbCIsICJob3N0IiwgInVzZXJJbmZvIiwgInVzZXIiLCAicGFzc3dvcmQiLCAiaG9zdG5hbWUiLCAicG9ydCIsICJyZWxhdGl2ZSIsICJwYXRobmFtZSIsICJkaXJlY3RvcnkiLCAiZmlsZSIsICJzZWFyY2giLCAiaGFzaCJdLAoJCXE6IHsKCQkJbmFtZTogInF1ZXJ5IiwKCQkJcGFyc2VyOiAvKD86XnwmKShbXiY9XSopPT8oW14mXSopL2cKCQl9LAoJCXBhcnNlcjogewoJCQlzdHJpY3Q6IC9eKD86KFteOlwvPyNdKyk6KT8oPzpcL1wvKCg/OigoW146QF0qKSg/OjooW146QF0qKSk/KT9AKT8oW146XC8/I10qKSg/OjooXGQqKSk/KSk/KCgoKD86W14/I1wvXSpcLykqKShbXj8jXSopKSg/Olw/KFteI10qKSk/KD86IyguKikpPykvLAoJCQlsb29zZTogL14oPzooPyFbXjpAXSs6W146QFwvXSpAKShbXjpcLz8jLl0rKTopPyg/OlwvXC8pPygoPzooKFteOkBdKikoPzo6KFteOkBdKikpPyk/QCk/KFteOlwvPyNdKikoPzo6KFxkKikpPykoKChcLyg/OltePyNdKD8hW14/I1wvXSpcLltePyNcLy5dKyg/Ols/I118JCkpKSpcLz8pPyhbXj8jXC9dKikpKD86XD8oW14jXSopKT8oPzojKC4qKSk/KS8KCQl9Cgl9OwoKCXZhciBwYXJzZVVSTCA9IGZ1bmN0aW9uKHVybCkgewoJCXZhciBvYmogPSBwYXJzZVVyaSh1cmwpOwoJCW9iai5wYXRoID0gb2JqLnBhdGhuYW1lICsgKG9iai5zZWFyY2g/Ij8iOiIiKSArIG9iai5zZWFyY2g7CgkJcmV0dXJuIG9iajsKCX07CgoJLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85MDc3MTAxL2lwaG9uZS1sb2NhbHN0b3JhZ2UtcXVvdGEtZXhjZWVkZWQtZXJyLWlzc3VlLzEyOTc2OTg4IzEyOTc2OTg4Cgl2YXIgc2Vzc2lvblN0b3JhZ2VTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKCQl0cnkgewoJCQlzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCJ0ZXN0IiwgInRlc3QiKTsKCQkJc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgidGVzdCIpOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9IGNhdGNoIChlKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9OwoKCS8vIHByb2R1Y2UgaGlkCgl2YXIgcHJvZHVjZUlEID0gZnVuY3Rpb24oKXsKCQlyZXR1cm4gImgiKygrbmV3IERhdGUgKyBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkqMTAwMDAwMCkpOwoJfTsKCgkvL19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gSGlzdG9yeSBTaGltCgoJdmFyIHNraXBIYXNoQ2hhbmdlLAoJCXNraXBJbml0UG9wID0gZmFsc2UsCgkJZnJvbUdvID0gZmFsc2UsCgkJYWdlbnQgPSB1c2VyQWdlbnQoKTsKCgl3aW5kb3cuaGlzdG9yeS5wYXJzZVVSTCA9IHBhcnNlVVJMOwoJd2luZG93Lmhpc3RvcnkuY29uZmlnID0gewoJCWhhc2hDaGFuZ2VBbG9uZTogdHJ1ZSwKCQlzZXRTdGF0ZUV2ZW50OnRydWUsCgkJc2V0SGFzaEV2ZW50OnRydWUsCgkJc3RvcmFnZUtleTogIm1pbi1oaXN0b3J5IiwKCQliYXNlUGF0aDogIiIsCgkJaGlkOiB0cnVlCgl9OwoKCS8vIHNvbWUgdmVyc2lvbiBvZiBzYWZhcmkgKGFuZCBjbykgaGF2ZSBubyAic3RhdGUiIHByb3BlcnR5IGluIGhpc3RvcnkuIGZvcmNlIGl0LgoJd2luZG93Lmhpc3RvcnkuZm9yY2VTdGF0ZSA9ICEoInN0YXRlIiBpbiB3aW5kb3cuaGlzdG9yeSk7CglpZiAod2luZG93Lmhpc3RvcnkuZm9yY2VTdGF0ZSkKCQl3aW5kb3cuaGlzdG9yeS5zdGF0ZSA9IG51bGw7CgoJLy8gc2FmYXJpIGZpcmUgcG9wIHN0YXRlIG9uIHBhZ2UgbG9hZC4gc2tpcCBpdCBmb3IgY29uc2lzdGVuY3kuCglpZiAoYWdlbnQuc2FmYXJpICYmIGxvY2F0aW9uLnJlbGF0aXZlICE9PSB3aW5kb3cuaGlzdG9yeS5jb25maWcuYmFzZVBhdGgpCgkJc2tpcEluaXRQb3AgPSB0cnVlOwoKCS8vIHByb2R1Y2UgaHJlZiB3aXRoIGhpZCBpbiBzZWFyY2ggcGFydAoJdmFyIGdldEhyZWZXaXRoSGlkID0gZnVuY3Rpb24oaWQsIGxvY2F0aW9uKSB7CgkJdmFyIHNlYXJjaCA9ICI/IisgKGxvY2F0aW9uLnNlYXJjaCB8fCAiIikgKyAiJmhpZD0iICsgaWQ7CgkJcmV0dXJuIChsb2NhdGlvbi5wYXRobmFtZSB8fCAnLycpIAoJCQkrIHNlYXJjaAoJCQkrIChsb2NhdGlvbi5oYXNoID8gKCIjIiArIGxvY2F0aW9uLmhhc2gpIDogIiIpOwoJfTsKCgkvLyByZW1vdmUgaGlkIGZyb20gbG9jYXRpb24gcGFydHMuIHN0b3JlIGhpZCBpbiBsb2NhdGlvbi4KCXZhciBjbGVhbkhpZEZyb21Mb2NhdGlvbiA9IGZ1bmN0aW9uKGxvY2F0aW9uKSB7CgkJaWYgKCFsb2NhdGlvbi5zZWFyY2gpCgkJCXJldHVybjsKCQlsb2NhdGlvbi5zZWFyY2ggPSBsb2NhdGlvbi5zZWFyY2gucmVwbGFjZSgvJmhpZD0oW14mXSspL2dpLCBmdW5jdGlvbihjLCB2KSB7CgkJCWxvY2F0aW9uLmhpZCA9IHY7CgkJCXJldHVybiAiIjsKCQl9KTsKCQlsb2NhdGlvbi5wYXRoID0gbG9jYXRpb24ucGF0aG5hbWUgKyAobG9jYXRpb24uc2VhcmNoID8gKCI/IiArIGxvY2F0aW9uLnNlYXJjaCkgOiAiIik7CgkJbG9jYXRpb24ucmVsYXRpdmUgPSBsb2NhdGlvbi5wYXRoICsgKGxvY2F0aW9uLmhhc2ggPyAoIiMiICsgbG9jYXRpb24uaGFzaCkgOiAiIik7CgkJbG9jYXRpb24uaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgIjovLyIgKyBsb2NhdGlvbi5ob3N0ICsgbG9jYXRpb24ucmVsYXRpdmU7Cgl9OwoKCXZhciByZW1vdmVCYXNlUGF0aCA9IGZ1bmN0aW9uKGxvY2F0aW9uKXsKCQlpZighd2luZG93Lmhpc3RvcnkuY29uZmlnLmJhc2VQYXRoKQoJCQlyZXR1cm4gbG9jYXRpb247CgkJbG9jYXRpb24ucGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZS5zdWJzdHJpbmcod2luZG93Lmhpc3RvcnkuY29uZmlnLmJhc2VQYXRoLmxlbmd0aCk7CgkJbG9jYXRpb24ucGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lICsgKGxvY2F0aW9uLnNlYXJjaCA/ICgiPyIgKyBsb2NhdGlvbi5zZWFyY2gpIDogIiIpOwoJCWxvY2F0aW9uLnJlbGF0aXZlID0gbG9jYXRpb24ucGF0aCArIChsb2NhdGlvbi5oYXNoID8gKCIjIiArIGxvY2F0aW9uLmhhc2gpIDogIiIpOwoJCWxvY2F0aW9uLmhyZWYgPSBsb2NhdGlvbi5wcm90b2NvbCArICI6Ly8iICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnJlbGF0aXZlOwoJCXJldHVybiBsb2NhdGlvbjsKCX07CgoJdmFyIGZpcmVTdGF0ZUV2ZW50ID0gZnVuY3Rpb24odHlwZSwgc3RhdGUsIGFjdGlvbikgewoJCXZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTsKCQlldnQuaW5pdEV2ZW50KHR5cGUsIHRydWUsIHRydWUpOwoJCWV2dC5zdGF0ZSA9IHN0YXRlIHx8IG51bGw7CgkJaWYoYWN0aW9uKQoJCQlldnQuYWN0aW9uID0gYWN0aW9uOwoJCXJldHVybiB3aW5kb3cuZGlzcGF0Y2hFdmVudChldnQpOwoJfTsKCgl3aW5kb3cuaGlzdG9yeS5zdG9yZSA9IHsKCQlzdGF0ZXM6IFtdLAoJCWluZGV4OiAtMSwKCQlpbml0OiBmdW5jdGlvbigpIHsKCQkJaWYgKCEod2luZG93Lmhpc3Rvcnkuc2Vzc2lvblN0b3JhZ2VTdXBwb3J0ZWQgPSBzZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCgpKSkKCQkJCWNvbnNvbGUud2FybigiWW91IGFyZSB1c2luZyBjdXN0b20gaGlzdG9yeSBBUEkgYW5kIFNlc3Npb24gU3RvcmFnZSBpcyBub3Qgc3VwcG9ydGVkLiBZb3UnbGwgbG9vc2UgaGlzdG9yeSB3aGVuIGxlYXZpbmcgcGFnZS4iKTsKCQkJCgkJCWlmICh3aW5kb3cuaGlzdG9yeS5zZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCkKCQkJCXRoaXMuc3RhdGVzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHdpbmRvdy5oaXN0b3J5LmNvbmZpZy5zdG9yYWdlS2V5KSkgfHwgW107CgkJCWVsc2UKCQkJCXRoaXMuc3RhdGVzID0gW107CgkJCWlmICghdGhpcy5zdGF0ZXMuZm9yRWFjaCkKCQkJCXRoaXMuc3RhdGVzID0gW107CgkJCS8vIGNvbnNvbGUubG9nKCJpbml0IGhpc3Rvcnkgc3RhdGVzIDogIiwgdGhpcy5zdGF0ZXMpOwoJCX0sCgkJY3VycmVudDpmdW5jdGlvbigpewoJCQlyZXR1cm4gdGhpcy5zdGF0ZXNbdGhpcy5pbmRleF07CgkJfSwKCQlwdXNoOiBmdW5jdGlvbihkYXRhLCB0aXRsZSwgdXJsKSB7CgkJCXZhciBzdGF0ZSA9IHsgZGF0YTogZGF0YSwgdGl0bGU6IHRpdGxlLCB1cmw6IHVybCB9OwoJCQlpZih3aW5kb3cuaGlzdG9yeS5jb25maWcuaGlkKQoJCQl7CgkJCQlzdGF0ZS5kYXRhID0gc3RhdGUuZGF0YSB8fCB7fTsKCQkJCXN0YXRlLmRhdGEuaGlkID0gcHJvZHVjZUlEKCk7CgkJCX0KCQkJdGhpcy5pbmRleCsrOwoJCQlpZiAodGhpcy5pbmRleCA8IHRoaXMuc3RhdGVzLmxlbmd0aCkKCQkJCXRoaXMuc3RhdGVzID0gdGhpcy5zdGF0ZXMuc2xpY2UoMCwgdGhpcy5pbmRleCk7CgkJCXRoaXMuc3RhdGVzLnB1c2goc3RhdGUpOwoJCQlyZXR1cm4gc3RhdGU7CgkJfSwKCQlyZXBsYWNlOiBmdW5jdGlvbihkYXRhLCB0aXRsZSwgdXJsKSB7CgkJCXZhciBvbGQgPSB0aGlzLnN0YXRlc1t0aGlzLmluZGV4XSwKCQkJCXN0YXRlID0geyBkYXRhOiBkYXRhLCB0aXRsZTogdGl0bGUsIHVybDogdXJsIH07CgkJCWlmKHdpbmRvdy5oaXN0b3J5LmNvbmZpZy5oaWQpCgkJCXsKCQkJCXN0YXRlLmRhdGEgPSBzdGF0ZS5kYXRhIHx8IHt9OwoJCQkJc3RhdGUuZGF0YS5oaWQgPSAob2xkICYmIG9sZC5kYXRhICYmIG9sZC5kYXRhLmhpZCkgPyBvbGQuZGF0YS5oaWQgOiBwcm9kdWNlSUQoKTsKCQkJfQoJCQlyZXR1cm4gdGhpcy5zdGF0ZXNbdGhpcy5pbmRleF0gPSBzdGF0ZTsKCQl9LAoJCWdvOiBmdW5jdGlvbihpbmNyZW1lbnQpIHsKCQkJdmFyIGkgPSB0aGlzLmluZGV4ICsgaW5jcmVtZW50LAoJCQkJc3RhdGUgPSB0aGlzLnN0YXRlc1tpXTsKCQkJaWYgKCFzdGF0ZSkKCQkJCXJldHVybiBudWxsOwoJCQl0aGlzLmluZGV4ID0gaTsKCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgkJZmluZDogZnVuY3Rpb24oaWQpIHsKCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuc3RhdGVzLmxlbmd0aCwgc3RhdGU7IGkgPCBsZW4gJiYgKHN0YXRlID0gdGhpcy5zdGF0ZXNbaV0pOyArK2kpCgkJCQlpZiAoc3RhdGUuZGF0YSAmJiBzdGF0ZS5kYXRhLmhpZCA9PSBpZCkKCQkJCQlyZXR1cm4gc3RhdGU7CgkJCXJldHVybiBudWxsOwoJCX0sCgkJc2F2ZTogZnVuY3Rpb24oKSB7CgkJCWlmICh3aW5kb3cuaGlzdG9yeS5zZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCkKCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0od2luZG93Lmhpc3RvcnkuY29uZmlnLnN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KHRoaXMuc3RhdGVzKSk7CgkJfQoJfTsJCgl2YXIgc2V0U3RhdGU7IAoJaWYgKCF3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUpIC8vIEVNVUxBVEVECgl7CgkJd2luZG93Lmhpc3RvcnkuZW11bGF0ZWQgPSB0cnVlOwoJCXNldFN0YXRlID0gZnVuY3Rpb24odHlwZSwgZGF0YSwgdGl0bGUsIHVybCkKCQl7CgkJCWlmKHRpdGxlKQoJCQkJZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKCQkJdmFyIG9sZExvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjsKCQkJdGhpcy5sb2NhdGlvbiA9IHBhcnNlVVJMKHVybCk7CgkJCXZhciBocmVmID0gdGhpcy5sb2NhdGlvbi5yZWxhdGl2ZTsKCQkJaWYgKHRoaXMuY29uZmlnLmhpZCkKCQkJewoJCQkJdGhpcy5zdGF0ZSA9IGRhdGEgPSB0aGlzLnN0b3JlW3R5cGVdKGRhdGEsIHRpdGxlLCBocmVmKS5kYXRhOwkvLyAncHVzaCcgb3IgJ3JlcGxhY2UnIGluIHN0b3JlCgkJCQlocmVmID0gZ2V0SHJlZldpdGhIaWQoZGF0YS5oaWQsIHRoaXMubG9jYXRpb24pOyAvLyBsYXVuY2ggaGFzaGNoYW5nZQoJCQl9CgkJCWVsc2UKCQkJCXRoaXMuc3RhdGUgPSBkYXRhIHx8IG51bGw7CgkJCWlmKHRoaXMubG9jYXRpb24ucGF0aCA9PSBvbGRMb2NhdGlvbi5wYXRoICYmIHRoaXMubG9jYXRpb24uaGFzaCAhPT0gb2xkTG9jYXRpb24uaGFzaCAmJiB0aGlzLmNvbmZpZy5zZXRIYXNoRXZlbnQpCgkJCQlmaXJlU3RhdGVFdmVudCgic2V0aGFzaCIsIHRoaXMuc3RhdGUsIHR5cGUpOwoJCQllbHNlIGlmKHRoaXMuY29uZmlnLnNldFN0YXRlRXZlbnQpCgkJCQlmaXJlU3RhdGVFdmVudCgic2V0c3RhdGUiLCB0aGlzLnN0YXRlLCB0eXBlKTsKCQkJc2tpcEhhc2hDaGFuZ2UgPSB0cnVlOwoJCQl3aW5kb3cubG9jYXRpb24uaGFzaCA9ICIhIiArIGhyZWY7IC8vIGxhdW5jaCBoYXNoY2hhbmdlCgkJfQoJCXZhciBvcmlnaW5hbEdvID0gd2luZG93Lmhpc3RvcnkuZ287CgkJd2luZG93Lmhpc3RvcnkuZ28gPSBmdW5jdGlvbihhcmcpIHsKCQkJaWYodGhpcy5jb25maWcuaGlkKQoJCQl7CgkJCQl2YXIgc3RhdGUgPSB0aGlzLnN0b3JlLmdvKGFyZyk7CgkJCQlpZiAoIXN0YXRlKQoJCQkJCXJldHVybiBudWxsOwoJCQkJdGhpcy5zdGF0ZSA9IHN0YXRlLmRhdGE7CgkJCX0KCQkJZWxzZQoJCQkJdGhpcy5zdGF0ZSA9IG51bGw7CgkJCWZyb21HbyA9IHRydWU7CgkJCW9yaWdpbmFsR28uY2FsbCh0aGlzLCBhcmcpOwoJCX07CgkJd2luZG93Lmhpc3RvcnkuYmFjayA9IGZ1bmN0aW9uKGFyZykgewoJCQl0aGlzLmdvKC0xKTsKCQl9OwoJCXdpbmRvdy5oaXN0b3J5LmZvcndhcmQgPSBmdW5jdGlvbihhcmcpIHsKCQkJdGhpcy5nbygxKTsKCQl9OwoJfSAKCWVsc2UgLy8gTkFUSVZFCgl7CgkJdmFyIG9yaWdpbmFsUHVzaFN0YXRlID0gd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlLAoJCQlvcmlnaW5hbFJlcGxhY2VTdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZTsKCQlzZXRTdGF0ZSA9IGZ1bmN0aW9uKHR5cGUsIGRhdGEsIHRpdGxlLCB1cmwpewoJCQl2YXIgb3JpZ2luYWwgPSBvcmlnaW5hbFJlcGxhY2VTdGF0ZTsKCQkJaWYodHlwZSA9PSAncHVzaCcpCgkJCQlvcmlnaW5hbCA9IG9yaWdpbmFsUHVzaFN0YXRlOwoJCQlpZih0aXRsZSkKCQkJCWRvY3VtZW50LnRpdGxlID0gdGl0bGU7CgkJCXZhciBvbGRMb2NhdGlvbiA9IHRoaXMubG9jYXRpb247CgkJCXRoaXMubG9jYXRpb24gPSBwYXJzZVVSTCh1cmwpOwoJCQlpZih0aGlzLmNvbmZpZy5oaWQpCgkJCQlkYXRhID0gdGhpcy5zdG9yZVt0eXBlXShkYXRhLCB0aXRsZSwgdGhpcy5sb2NhdGlvbi5yZWxhdGl2ZSkuZGF0YTsgLy8gcHVzaCBvciByZXBsYWNlIGluIHN0b3JlCgkJCWlmKHRoaXMuZm9yY2VTdGF0ZSkKCQkJCXRoaXMuc3RhdGUgPSBkYXRhIHx8IG51bGw7CgkJCXZhciByID0gb3JpZ2luYWwuY2FsbCh0aGlzLCBkYXRhLCB0aXRsZSwgd2luZG93Lmhpc3RvcnkuY29uZmlnLmJhc2VQYXRoICsgdGhpcy5sb2NhdGlvbi5yZWxhdGl2ZSk7CgkJCWlmKHRoaXMubG9jYXRpb24ucGF0aCA9PSBvbGRMb2NhdGlvbi5wYXRoICYmIHRoaXMubG9jYXRpb24uaGFzaCAhPT0gb2xkTG9jYXRpb24uaGFzaCAmJiB0aGlzLmNvbmZpZy5zZXRIYXNoRXZlbnQpCgkJCQlmaXJlU3RhdGVFdmVudCgic2V0aGFzaCIsIHRoaXMuc3RhdGUsIHR5cGUpOwoJCQllbHNlIGlmKHRoaXMuY29uZmlnLnNldFN0YXRlRXZlbnQpCgkJCQlmaXJlU3RhdGVFdmVudCgic2V0c3RhdGUiLCB0aGlzLnN0YXRlLCB0eXBlKTsKCQkJcmV0dXJuIHI7CgkJfQoJfQoKCXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQlyZXR1cm4gc2V0U3RhdGUuY2FsbCh0aGlzLCAncHVzaCcsIGRhdGEsIHRpdGxlLCB1cmwpOwoJfTsKCXdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQlyZXR1cm4gc2V0U3RhdGUuY2FsbCh0aGlzLCAncmVwbGFjZScsIGRhdGEsIHRpdGxlLCB1cmwpOwoJfTsKCgkvLyBOYXRpdmUgT25seQoJdmFyIHBvcFN0YXRlID0gZnVuY3Rpb24oZSkgewoJCS8vIGNvbnNvbGUubG9nKCJoaXN0b3J5IHBvcFN0YXRlIDogIiwgZSk7CgkJdmFyIHN0YXRlRGF0YSA9IGUuc3RhdGUsIGhpc3RvcnkgPSB3aW5kb3cuaGlzdG9yeTsKCQlpZiAoaGlzdG9yeS5mb3JjZVN0YXRlKQoJCQloaXN0b3J5LnN0YXRlID0gc3RhdGVEYXRhIHx8IG51bGw7CgoJCWlmIChza2lwSW5pdFBvcCkgewkvLyBzYWZhcmkgcG9wc3RhdGUgYXQgaW5pdCBza2lwcGVkLgoJCQlza2lwSW5pdFBvcCA9IGZhbHNlOwoJCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXNraXBIYXNoQ2hhbmdlID0gZmFsc2U7CgkJdmFyIHRtcCA9IGhpc3RvcnkubG9jYXRpb24sCS8vIG9sZAoJCQljdXJyZW50ID0gaGlzdG9yeS5sb2NhdGlvbiA9IHJlbW92ZUJhc2VQYXRoKHBhcnNlVVJMKGxvY2F0aW9uLmhyZWYpKSwgLy8gbmV3CgkJCXN0YXRlOwoKCQlpZihoaXN0b3J5LmNvbmZpZy5oaWQgJiYgc3RhdGVEYXRhICYmIHN0YXRlRGF0YS5oaWQpCS8vIHRyeSB0byBnZXQgc3RhdGUgZnJvbSBoaWQKCQkJc3RhdGUgPSBoaXN0b3J5LnN0b3JlLmZpbmQoc3RhdGVEYXRhLmhpZCk7CgkJCgkJaWYoc3RhdGUpCgkJewoJCQkvLyBjaGVjayB1cmwgZXF1YWxpdHkuCgkJCWlmKGN1cnJlbnQucmVsYXRpdmUgIT09IHN0YXRlLnVybCkKCQkJCXRocm93IG5ldyBFcnJvcigiYmFkIHN0YXRlIGZyb20gbmF0aXZlIHBvcHN0YXRlICh1cmwgZG9udCBtYXRjaCkgIitjdXJyZW50LnJlbGF0aXZlKyIgLSAiK3N0YXRlLnVybCk7CgkJCWlmKHN0YXRlLnRpdGxlKSAvLyBmb3JjZSB0aXRsZQoJCQkJZG9jdW1lbnQudGl0bGUgPSBzdGF0ZS50aXRsZTsKCQl9CgkJaWYgKCF0bXAgfHwgdG1wLnBhdGggIT09IGN1cnJlbnQucGF0aCkgLy8gcmVsYXRpdmUgaGFzIGNoYW5nZSA6IGFwcGx5IHBvcCBzdGF0ZQoJCXsKCQkJaWYgKHRtcCAmJiB0bXAuaGFzaCAhPT0gY3VycmVudC5oYXNoKQoJCQkJc2tpcEhhc2hDaGFuZ2UgPSB0cnVlOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9IAoJCWVsc2UgLy8gcGF0aCBkb2Vzbid0IGNoYW5nZS4gY2hlY2sgaGFzaAoJCWlmICh0bXAuaGFzaCAhPT0gY3VycmVudC5oYXNoICYmIGhpc3RvcnkuY29uZmlnLmhhc2hDaGFuZ2VBbG9uZSkKCQl7CgkJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgkJCXJldHVybiBmYWxzZTsgLy8gc2tpcCBwb3BzdGF0ZSBpZiBjb25maWcuaGFzaENoYW5nZUFsb25lCgkJfQoJCXJldHVybiB0cnVlOyAvLyBub3RoaW5nIGNoYW5nZSA6IHJlZnJlc2gKCX07CgoKCXZhciBoYXNoQ2hhbmdlID0gZnVuY3Rpb24oZSkgewoJCWlmIChza2lwSGFzaENoYW5nZSkgLy8gc2tpcCBhZnRlciBwdXNoU3RhdGUvcmVwbGFjZVN0YXRlIChlbXVsYXRlZCkgIE9SICBhZnRlciAicGF0aCBjaGFuZ2UiIGZyb20gcG9wc3RhdGUgKG5hdGl2ZSksIAoJCXsKCQkJc2tpcEhhc2hDaGFuZ2UgPSBmYWxzZTsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQkvL19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyBQT1AgU1RBVEUgRU1VTEFUSU9OCgkJaWYgKHdpbmRvdy5oaXN0b3J5LmVtdWxhdGVkKSAvLyBkbyBwb3BzdGF0ZSBiZWhhdmlvdXIKCQl7CgkJCSAvLyBjb3VsZCBiZSBmcm9tIGJhY2svbmV4dCBidXR0b24gb3IgbWFudWFsIGhhc2ggY2hhbmdlIGluIGFkZHJlc3MgYmFyLgoJCQl2YXIgc3RhdGUsCgkJCQlkYXRhID0gbnVsbCwKCQkJCXRtcCA9IHdpbmRvdy5oaXN0b3J5LmxvY2F0aW9uLCAvLyBzd2FwIGN1cnJlbnRMb2NhdGlvbgoJCQkJY3VycmVudCA9IHdpbmRvdy5oaXN0b3J5LmxvY2F0aW9uID0gcGFyc2VVUkwobG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMikpOwoJCQlpZiAod2luZG93Lmhpc3RvcnkuY29uZmlnLmhpZCkKCQkJewoJCQkJY2xlYW5IaWRGcm9tTG9jYXRpb24oY3VycmVudCk7IC8vIHRyeSB0byBleHRyYWN0IGhpZAoJCQkJaWYoIWZyb21HbykKCQkJCXsKCQkJCQlpZiAoY3VycmVudC5oaWQpCgkJCQkJCXN0YXRlID0gd2luZG93Lmhpc3Rvcnkuc3RvcmUuZmluZChjdXJyZW50LmhpZCk7CgkJCQkJaWYoc3RhdGUpCgkJCQkJCWRhdGEgPSBzdGF0ZS5kYXRhIHx8IG51bGw7CgkJCQkJd2luZG93Lmhpc3Rvcnkuc3RhdGUgPSBkYXRhOwoJCQkJfQoJCQl9CgkJCWlmKHN0YXRlICYmIHN0YXRlLnRpdGxlKQkvLyBmb3JjZSB0aXRsZQoJCQkJZG9jdW1lbnQudGl0bGUgPSBzdGF0ZS50aXRsZTsKCgkJCWlmICghdG1wIHx8IHRtcC5wYXRoICE9PSBjdXJyZW50LnBhdGgpIHsgLy8gcGF0aCA9PSBwYXRobmFtZSArID8gKyBzZWFyY2gKCQkJCS8vIHBhdGggaGFzIGNoYW5nZSA6IGRpc3BhdGNoIHBvcHN0YXRlIGFuZCBza2lwIGhhc2hjaGFuZ2UKCQkJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgkJCQlmaXJlU3RhdGVFdmVudCgicG9wc3RhdGUiLCBkYXRhKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkvLyBwYXRoIGRvZXNuJ3QgY2hhbmdlLiAKCQkJLy8gY2hlY2sgaGFzaCBjaGFuZ2UgOiBpZiAhaGFzaENoYW5nZUFsb25lIDogZGlzcGF0Y2ggcG9wc3RhdGUKCQkJaWYgKHRtcC5oYXNoICE9PSBjdXJyZW50Lmhhc2ggJiYgIXdpbmRvdy5oaXN0b3J5LmNvbmZpZy5oYXNoQ2hhbmdlQWxvbmUpCgkJCQlmaXJlU3RhdGVFdmVudCgicG9wc3RhdGUiLCBkYXRhKTsKCQl9CgkJcmV0dXJuIHRydWU7IC8vIHByb3BhZ2F0ZSBoYXNoY2hhbmdlCgl9OwoKCXdpbmRvdy5oaXN0b3J5LmluaXQgPSBmdW5jdGlvbihvcHQpIHsKCQlmb3IgKHZhciBpIGluIG9wdCkKCQkJdGhpcy5jb25maWdbaV0gPSBvcHRbaV07CgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImhhc2hjaGFuZ2UiLCBoYXNoQ2hhbmdlKTsKCQlpZiAoIXRoaXMuZW11bGF0ZWQpCgkJewoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9wc3RhdGUiLCBwb3BTdGF0ZSk7CgkJCXRoaXMubG9jYXRpb24gPSByZW1vdmVCYXNlUGF0aChwYXJzZVVSTCh3aW5kb3cubG9jYXRpb24uaHJlZikpOwoJCX0KCQllbHNlCgkJCXRoaXMubG9jYXRpb24gPSBwYXJzZVVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7CgkJaWYodGhpcy5jb25maWcuaGlkKQoJCXsKCQkJdGhpcy5zdG9yZS5pbml0KCk7CgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLCBmdW5jdGlvbigpIHsKCQkJCXdpbmRvdy5oaXN0b3J5LnN0b3JlLnNhdmUoKTsKCQkJfSk7CgkJfQoJfTsKfSkoKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 09:52:42 GMT",
                    "Content-Length": "12561",
                    "Date": "Fri, 07 Nov 2014 09:52:43 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}