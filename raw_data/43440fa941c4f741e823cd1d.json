{
    "url": "http://localhost:9999/phiggins42/has.js/detect/dom.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statements:<ul><li>var attempt , backup ...rch|| location.hash;</li><li>backup = base.href || href.slice(0, token ? href.indexOf(token) : href.length).replace(/[^\\/]*$/, \"\");</li><li>base.href = backup;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/phiggins42/has.js/detect/dom.js",
                "path": "/phiggins42/has.js/detect/dom.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9waGlnZ2luczQyL2hhcy5qcy9kZXRlY3QvZG9tLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjIwOA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwMzowMzowOCBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDM6MDM6MDggR01UDQoNCihmdW5jdGlvbihoYXMsIGFkZHRlc3QsIGNzc3Byb3ApewoKICAgIGlmKCFoYXMoImRvbSIpKXsgcmV0dXJuOyB9CgogICAgYWRkdGVzdCgiZG9tLXF1aXJrcyIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICB2YXIgc3VwcG9ydGVkOwogICAgICAgIGlmKHR5cGVvZiBkLmNvbXBhdE1vZGUgPT0gInN0cmluZyIpewogICAgICAgICAgICBzdXBwb3J0ZWQgPSAoZC5jb21wYXRNb2RlID09ICJCYWNrQ29tcGF0Iik7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGVsLnN0eWxlLndpZHRoID0gIjEiOwogICAgICAgICAgICBzdXBwb3J0ZWQgPSAoZS5zdHlsZS53aWR0aCA9PSAiMXB4Iik7CiAgICAgICAgICAgIGVsLnN0eWxlLmNzc1RleHQgPSAiIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIGFkZHRlc3QoImRvbS1kYXRhc2V0IiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgiZGF0YS1hLWIiLCAiYyIpOwogICAgICAgIHJldHVybiBoYXMuaXNIb3N0VHlwZShlbCwgImRhdGFzZXQiKSAmJiBlbC5kYXRhc2V0LmFCID09ICJjIjsKICAgIH0pOwoKICAgIC8vIHdvcmtzIGluIGFsbCBidXQgSUUgPCA5CiAgICBhZGR0ZXN0KCJkb20tYWRkZXZlbnRsaXN0ZW5lciIsIGZ1bmN0aW9uKGcsIGQpewogICAgICAgIHJldHVybiBoYXMuaXNIb3N0VHlwZShkLCAiYWRkRXZlbnRMaXN0ZW5lciIpOwogICAgfSk7CgogICAgLy8gd29ya3MgaW4gYWxsIGJ1dCBJRQogICAgYWRkdGVzdCgiZG9tLWNyZWF0ZWVsZW1lbnRucyIsIGZ1bmN0aW9uKGcsIGQpewogICAgICAgIHJldHVybiBoYXMuaXNIb3N0VHlwZShkLCAiY3JlYXRlRWxlbWVudE5TIik7CiAgICB9KTsKCiAgICAvLyBzaG91bGQgZmFpbCBpbiB3ZWJraXQsIGFzIHRoZXkgZG9udCBzdXBwb3J0IGl0LgogICAgYWRkdGVzdCgiZG9tLWF0dHJtb2RpZmllZCIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICB2YXIgc3VwcG9ydGVkID0gZmFsc2UsCiAgICAgICAgICAgIGxpc3RlbmVyID0gZnVuY3Rpb24oKXsgc3VwcG9ydGVkID0gdHJ1ZTsgfTsKCiAgICAgICAgaWYoaGFzKCJkb20tYWRkZXZlbnRsaXN0ZW5lciIpKXsKICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7CiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUF0dHJNb2RpZmllZCIsIGxpc3RlbmVyLCBmYWxzZSk7CiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgiX19fVEVTVF9fXyIsIHRydWUpOwogICAgICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoIl9fX1RFU1RfX18iLCB0cnVlKTsKICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQXR0ck1vZGlmaWVkIiwgbGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIGFkZHRlc3QoImRvbS1zdWJ0cmVlbW9kaWZpZWQiLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgdmFyIHN1cHBvcnRlZCA9IGZhbHNlLAogICAgICAgICAgICBsaXN0ZW5lciA9IGZ1bmN0aW9uKCl7IHN1cHBvcnRlZCA9IHRydWU7IH07CgogICAgICAgIGlmKGhhcygiZG9tLWFkZGV2ZW50bGlzdGVuZXIiKSl7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChkLmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsKICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigiRE9NU3VidHJlZU1vZGlmaWVkIiwgbGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICAgICAgaGFzLmNsZWFyRWxlbWVudChlbCk7CiAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTVN1YnRyZWVNb2RpZmllZCIsIGxpc3RlbmVyLCBmYWxzZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBwb3J0ZWQ7CiAgICB9KTsKCiAgICAvLyBGUk9NIGNmdC5qcwogICAgYWRkdGVzdCgiZG9tLWNoaWxkcmVuIiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIHZhciBzdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICBpZihoYXMuaXNIb3N0VHlwZShlbCwgImNoaWxkcmVuIikpewogICAgICAgICAgICB2YXIgZGl2ID0gZWwuYXBwZW5kQ2hpbGQoZC5jcmVhdGVFbGVtZW50KCJkaXYiKSksCiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGVsLmNoaWxkcmVuOwoKICAgICAgICAgICAgLy8gU2FmYXJpIDIueCByZXR1cm5zIEFMTCBjaGlsZHJlbiBpbmNsdWRpbmcgdGV4dCBub2RlcwogICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChkLmNyZWF0ZVRleHROb2RlKCJ4IikpOwogICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoZGl2LmNsb25lTm9kZShmYWxzZSkpOwogICAgICAgICAgICBzdXBwb3J0ZWQgPSAhIWNoaWxkcmVuICYmIGNoaWxkcmVuLmxlbmd0aCA9PSAxICYmIGNoaWxkcmVuWzBdID09IGRpdjsKICAgICAgICAgICAgaGFzLmNsZWFyRWxlbWVudChlbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBwb3J0ZWQ7CiAgICB9KTsKCiAgICAvLyB0cnVlIGZvciBodG1sLCB4aHRtbCBhbmQgdW5rbm93biBlbGVtZW50cyBhcmUgY2FzZQogICAgLy8gc2Vuc2l0aXZlIHRvIGhvdyB0aGV5IGFyZSB3cml0dGVuIGluIHRoZSBtYXJrdXAKICAgIGFkZHRlc3QoImRvbS10YWduYW1lLXVwcGVyY2FzZSIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICByZXR1cm4gZWwubm9kZU5hbWUgPT0gIkRJViI7CiAgICB9KTsKCiAgICBhZGR0ZXN0KCJkb20taHRtbDUtZWxlbWVudHMiLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgZWwuaW5uZXJIVE1MID0gIjxuYXY+YTwvbmF2PiI7CiAgICAgICAgcmV0dXJuIGVsLmNoaWxkTm9kZXMubGVuZ3RoID09IDE7CiAgICB9KTsKCiAgICAvLyB0cnVlIGZvciBJRSA8IDkKICAgIC8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjM4OShWUy44NSkuYXNweCB2cwogICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTMtQ29yZS9jb3JlLmh0bWwjSUQtMjE0MTc0MTU0NwogICAgYWRkdGVzdCgiZG9tLWNyZWF0ZS1hdHRyIiwgZnVuY3Rpb24oZywgZCl7CiAgICAgICAgdmFyIGlucHV0LAogICAgICAgICAgICBzdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlucHV0ID0gZC5jcmVhdGVFbGVtZW50KCI8aW5wdXQgdHlwZT0naGlkZGVuJyBuYW1lPSdoYXNqcyc+Iik7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IGlucHV0LnR5cGUgPT0gImhpZGRlbiIgJiYgaW5wdXQubmFtZSA9PSAiaGFzanMiOwogICAgICAgIH1jYXRjaChlKXt9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIC8vIFRPRE86IHRoaXMgdGVzdCBpcyByZWFsbHkgdGVzdGluZyBpZiBleHBhbmRvJ3MgYmVjb21lIGF0dHJpYnV0ZXMgKElFKQogICAgLy8gdHJ1ZSBmb3IgSUUKICAgIGFkZHRlc3QoImRvbS1zZWxlY3RhYmxlIiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIHZhciBzdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGVsLnVuc2VsZWN0YWJsZSA9ICJvbiI7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IHR5cGVvZiBlbC5hdHRyaWJ1dGVzLnVuc2VsZWN0YWJsZSAhPSAidW5kZWZpbmVkIiAmJgogICAgICAgICAgICAgICAgZWwuYXR0cmlidXRlcy51bnNlbGVjdGFibGUudmFsdWUgPT0gIm9uIjsKICAgICAgICAgICAgZWwudW5zZWxlY3RhYmxlID0gIm9mZiI7CiAgICAgICAgfWNhdGNoKGUpe30KICAgICAgICByZXR1cm4gc3VwcG9ydGVkOwogICAgfSk7CgogICAgLy8gdHJ1ZSBmb3IgYWxsIG1vZGVybiBicm93c2VycywgaW5jbHVkaW5nIElFIDkrCiAgICBhZGR0ZXN0KCJkb20tY29tcHV0ZWQtc3R5bGUiLCBmdW5jdGlvbihnLCBkKXsKICAgICAgICByZXR1cm4gaGFzLmlzSG9zdFR5cGUoZCwgImRlZmF1bHRWaWV3IikgJiYgaGFzLmlzSG9zdFR5cGUoZC5kZWZhdWx0VmlldywgImdldENvbXB1dGVkU3R5bGUiKTsKICAgIH0pOwoKICAgIC8vIHRydWUgZm9yIElFCiAgICBhZGR0ZXN0KCJkb20tY3VycmVudC1zdHlsZSIsIGZ1bmN0aW9uKGcsIGQpewogICAgICAgIHJldHVybiAhaGFzKCJkb20tY29tcHV0ZWQtc3R5bGUiKSAmJiBoYXMuaXNIb3N0VHlwZShkLmRvY3VtZW50RWxlbWVudCwgImN1cnJlbnRTdHlsZSIpOwogICAgfSk7CgogICAgLy8gdHJ1ZSBmb3IgSUUKICAgIGFkZHRlc3QoImRvbS1lbGVtZW50LWRvLXNjcm9sbCIsIGZ1bmN0aW9uKGcsIGQpewogICAgICAgIHJldHVybiBoYXMuaXNIb3N0VHlwZShkLmRvY3VtZW50RWxlbWVudCwgImRvU2Nyb2xsIik7CiAgICB9KTsKCiAgICAvLyB0ZXN0IGZvciBkeW5hbWljLXVwZGF0aW5nIGJhc2UgdGFnIHN1cHBvcnQgKGFsbG93cyB1cyB0byBhdm9pZCBocmVmICYgc3JjIGF0dHIgcmV3cml0aW5nKQogICAgLy8gZmFsc2UgZm9yIEZpcmVmb3ggPCA0IGFuZCBJRSA8IDgKICAgIGFkZHRlc3QoImRvbS1keW5hbWljLWJhc2UiLCBmdW5jdGlvbiAoZywgZCwgZWwpewogICAgICAgIHZhciBhdHRlbXB0LAogICAgICAgICAgICBiYWNrdXAsCiAgICAgICAgICAgIGJhc2UsCiAgICAgICAgICAgIGF0dGVtcHRzID0gW1tkLmNyZWF0ZUVsZW1lbnQoImEiKSwgImhyZWYiXSwgW2QuY3JlYXRlRWxlbWVudCgicSIpLCAiY2l0ZSJdXSwKICAgICAgICAgICAgaGVhZCA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXSwKICAgICAgICAgICAgaHJlZiA9IGxvY2F0aW9uLmhyZWYsCiAgICAgICAgICAgIGZha2UgPSBmYWxzZSwKICAgICAgICAgICAgc3VwcG9ydGVkID0gbnVsbCwKICAgICAgICAgICAgdG9rZW4gPSBsb2NhdGlvbi5zZWFyY2ggfHwgbG9jYXRpb24uaGFzaDsKCiAgICAgICAgaWYoaGVhZCl7CiAgICAgICAgICAgIGJhc2UgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJiYXNlIilbMF0gfHwgKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBmYWtlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBoZWFkLmluc2VydEJlZm9yZShkLmNyZWF0ZUVsZW1lbnQoImJhc2UiKSwgaGVhZC5maXJzdENoaWxkKTsKICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgIGJhY2t1cCA9IGJhc2UuaHJlZiB8fCBocmVmLnNsaWNlKDAsIHRva2VuID8gaHJlZi5pbmRleE9mKHRva2VuKSA6IGhyZWYubGVuZ3RoKS5yZXBsYWNlKC9bXlwvXSokLywgIiIpOwogICAgICAgICAgICBiYXNlLmhyZWYgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvL3giOwoKICAgICAgICAgICAgLy8gY2hlY2sgc3VwcG9ydCBvbiBtb3JlIHRoYW4gb25lIGVsZW1lbnQgdG8gYmUgdGhvcm91Z2gKICAgICAgICAgICAgd2hpbGUoYXR0ZW1wdCA9IGF0dGVtcHRzLnBvcCgpKXsKICAgICAgICAgICAgICAgIGlmKHN1cHBvcnRlZCAhPSBmYWxzZSl7CiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdFswXVthdHRlbXB0WzFdXSA9ICJ5IjsKICAgICAgICAgICAgICAgICAgICBzdXBwb3J0ZWQgPSBhdHRlbXB0WzBdW2F0dGVtcHRbMV1dLmluZGV4T2YoIngveSIpID4gLTE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmVzZXQgaHJlZiBiZWZvcmUgcmVtb3ZhbCwgb3RoZXJ3aXNlIGhyZWYgcGVyc2lzdHMgaW4gT3BlcmEKICAgICAgICAgICAgYmFzZS5ocmVmID0gYmFja3VwOwogICAgICAgICAgICBpZihmYWtlKXsKICAgICAgICAgICAgICAgIGhlYWQucmVtb3ZlQ2hpbGQoYmFzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIGFkZHRlc3QoImRvbS1ub2RlbGlzdC1zbGljZWFibGUiLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgdmFyIHN1cHBvcnRlZCA9IGZhbHNlLAogICAgICAgICAgICBkZSA9IGQuZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgICBpZCA9IGRlLmlkOwoKICAgICAgICAvLyBPcGVyYSA5LjI1IGJ1ZwogICAgICAgIGRlLmlkID0gImxlbmd0aCI7CiAgICAgICAgLy8gb2xkZXIgU2FmYXJpIHdpbGwgcmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgdHJ5ewogICAgICAgICAgICBzdXBwb3J0ZWQgPSAhIVtdLnNsaWNlLmNhbGwoZC5jaGlsZE5vZGVzLCAwKVswXTsKICAgICAgICB9Y2F0Y2goZSl7fQoKICAgICAgICBkZS5pZCA9IGlkOwogICAgICAgIHJldHVybiBzdXBwb3J0ZWQ7CiAgICB9KTsKCn0pKGhhcywgaGFzLmFkZCwgaGFzLmNzc3Byb3ApOwo=",
                "body": "KGZ1bmN0aW9uKGhhcywgYWRkdGVzdCwgY3NzcHJvcCl7CgogICAgaWYoIWhhcygiZG9tIikpeyByZXR1cm47IH0KCiAgICBhZGR0ZXN0KCJkb20tcXVpcmtzIiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIHZhciBzdXBwb3J0ZWQ7CiAgICAgICAgaWYodHlwZW9mIGQuY29tcGF0TW9kZSA9PSAic3RyaW5nIil7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IChkLmNvbXBhdE1vZGUgPT0gIkJhY2tDb21wYXQiKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMSI7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IChlLnN0eWxlLndpZHRoID09ICIxcHgiKTsKICAgICAgICAgICAgZWwuc3R5bGUuY3NzVGV4dCA9ICIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwcG9ydGVkOwogICAgfSk7CgogICAgYWRkdGVzdCgiZG9tLWRhdGFzZXQiLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCJkYXRhLWEtYiIsICJjIik7CiAgICAgICAgcmV0dXJuIGhhcy5pc0hvc3RUeXBlKGVsLCAiZGF0YXNldCIpICYmIGVsLmRhdGFzZXQuYUIgPT0gImMiOwogICAgfSk7CgogICAgLy8gd29ya3MgaW4gYWxsIGJ1dCBJRSA8IDkKICAgIGFkZHRlc3QoImRvbS1hZGRldmVudGxpc3RlbmVyIiwgZnVuY3Rpb24oZywgZCl7CiAgICAgICAgcmV0dXJuIGhhcy5pc0hvc3RUeXBlKGQsICJhZGRFdmVudExpc3RlbmVyIik7CiAgICB9KTsKCiAgICAvLyB3b3JrcyBpbiBhbGwgYnV0IElFCiAgICBhZGR0ZXN0KCJkb20tY3JlYXRlZWxlbWVudG5zIiwgZnVuY3Rpb24oZywgZCl7CiAgICAgICAgcmV0dXJuIGhhcy5pc0hvc3RUeXBlKGQsICJjcmVhdGVFbGVtZW50TlMiKTsKICAgIH0pOwoKICAgIC8vIHNob3VsZCBmYWlsIGluIHdlYmtpdCwgYXMgdGhleSBkb250IHN1cHBvcnQgaXQuCiAgICBhZGR0ZXN0KCJkb20tYXR0cm1vZGlmaWVkIiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIHZhciBzdXBwb3J0ZWQgPSBmYWxzZSwKICAgICAgICAgICAgbGlzdGVuZXIgPSBmdW5jdGlvbigpeyBzdXBwb3J0ZWQgPSB0cnVlOyB9OwoKICAgICAgICBpZihoYXMoImRvbS1hZGRldmVudGxpc3RlbmVyIikpewogICAgICAgICAgICBzdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQXR0ck1vZGlmaWVkIiwgbGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCJfX19URVNUX19fIiwgdHJ1ZSk7CiAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgiX19fVEVTVF9fXyIsIHRydWUpOwogICAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01BdHRyTW9kaWZpZWQiLCBsaXN0ZW5lciwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwcG9ydGVkOwogICAgfSk7CgogICAgYWRkdGVzdCgiZG9tLXN1YnRyZWVtb2RpZmllZCIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICB2YXIgc3VwcG9ydGVkID0gZmFsc2UsCiAgICAgICAgICAgIGxpc3RlbmVyID0gZnVuY3Rpb24oKXsgc3VwcG9ydGVkID0gdHJ1ZTsgfTsKCiAgICAgICAgaWYoaGFzKCJkb20tYWRkZXZlbnRsaXN0ZW5lciIpKXsKICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7CiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGQuY3JlYXRlRWxlbWVudCgiZGl2IikpOwogICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCJET01TdWJ0cmVlTW9kaWZpZWQiLCBsaXN0ZW5lciwgZmFsc2UpOwogICAgICAgICAgICBoYXMuY2xlYXJFbGVtZW50KGVsKTsKICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NU3VidHJlZU1vZGlmaWVkIiwgbGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIC8vIEZST00gY2Z0LmpzCiAgICBhZGR0ZXN0KCJkb20tY2hpbGRyZW4iLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgdmFyIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgIGlmKGhhcy5pc0hvc3RUeXBlKGVsLCAiY2hpbGRyZW4iKSl7CiAgICAgICAgICAgIHZhciBkaXYgPSBlbC5hcHBlbmRDaGlsZChkLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwKICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gZWwuY2hpbGRyZW47CgogICAgICAgICAgICAvLyBTYWZhcmkgMi54IHJldHVybnMgQUxMIGNoaWxkcmVuIGluY2x1ZGluZyB0ZXh0IG5vZGVzCiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGQuY3JlYXRlVGV4dE5vZGUoIngiKSk7CiAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChkaXYuY2xvbmVOb2RlKGZhbHNlKSk7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9ICEhY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0gPT0gZGl2OwogICAgICAgICAgICBoYXMuY2xlYXJFbGVtZW50KGVsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKICAgIC8vIHRydWUgZm9yIGh0bWwsIHhodG1sIGFuZCB1bmtub3duIGVsZW1lbnRzIGFyZSBjYXNlCiAgICAvLyBzZW5zaXRpdmUgdG8gaG93IHRoZXkgYXJlIHdyaXR0ZW4gaW4gdGhlIG1hcmt1cAogICAgYWRkdGVzdCgiZG9tLXRhZ25hbWUtdXBwZXJjYXNlIiwgZnVuY3Rpb24oZywgZCwgZWwpewogICAgICAgIHJldHVybiBlbC5ub2RlTmFtZSA9PSAiRElWIjsKICAgIH0pOwoKICAgIGFkZHRlc3QoImRvbS1odG1sNS1lbGVtZW50cyIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICBlbC5pbm5lckhUTUwgPSAiPG5hdj5hPC9uYXY+IjsKICAgICAgICByZXR1cm4gZWwuY2hpbGROb2Rlcy5sZW5ndGggPT0gMTsKICAgIH0pOwoKICAgIC8vIHRydWUgZm9yIElFIDwgOQogICAgLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM2Mzg5KFZTLjg1KS5hc3B4IHZzCiAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1Db3JlL2NvcmUuaHRtbCNJRC0yMTQxNzQxNTQ3CiAgICBhZGR0ZXN0KCJkb20tY3JlYXRlLWF0dHIiLCBmdW5jdGlvbihnLCBkKXsKICAgICAgICB2YXIgaW5wdXQsCiAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgIHRyeXsKICAgICAgICAgICAgaW5wdXQgPSBkLmNyZWF0ZUVsZW1lbnQoIjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9J2hhc2pzJz4iKTsKICAgICAgICAgICAgc3VwcG9ydGVkID0gaW5wdXQudHlwZSA9PSAiaGlkZGVuIiAmJiBpbnB1dC5uYW1lID09ICJoYXNqcyI7CiAgICAgICAgfWNhdGNoKGUpe30KICAgICAgICByZXR1cm4gc3VwcG9ydGVkOwogICAgfSk7CgogICAgLy8gVE9ETzogdGhpcyB0ZXN0IGlzIHJlYWxseSB0ZXN0aW5nIGlmIGV4cGFuZG8ncyBiZWNvbWUgYXR0cmlidXRlcyAoSUUpCiAgICAvLyB0cnVlIGZvciBJRQogICAgYWRkdGVzdCgiZG9tLXNlbGVjdGFibGUiLCBmdW5jdGlvbihnLCBkLCBlbCl7CiAgICAgICAgdmFyIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgIHRyeXsKICAgICAgICAgICAgZWwudW5zZWxlY3RhYmxlID0gIm9uIjsKICAgICAgICAgICAgc3VwcG9ydGVkID0gdHlwZW9mIGVsLmF0dHJpYnV0ZXMudW5zZWxlY3RhYmxlICE9ICJ1bmRlZmluZWQiICYmCiAgICAgICAgICAgICAgICBlbC5hdHRyaWJ1dGVzLnVuc2VsZWN0YWJsZS52YWx1ZSA9PSAib24iOwogICAgICAgICAgICBlbC51bnNlbGVjdGFibGUgPSAib2ZmIjsKICAgICAgICB9Y2F0Y2goZSl7fQogICAgICAgIHJldHVybiBzdXBwb3J0ZWQ7CiAgICB9KTsKCiAgICAvLyB0cnVlIGZvciBhbGwgbW9kZXJuIGJyb3dzZXJzLCBpbmNsdWRpbmcgSUUgOSsKICAgIGFkZHRlc3QoImRvbS1jb21wdXRlZC1zdHlsZSIsIGZ1bmN0aW9uKGcsIGQpewogICAgICAgIHJldHVybiBoYXMuaXNIb3N0VHlwZShkLCAiZGVmYXVsdFZpZXciKSAmJiBoYXMuaXNIb3N0VHlwZShkLmRlZmF1bHRWaWV3LCAiZ2V0Q29tcHV0ZWRTdHlsZSIpOwogICAgfSk7CgogICAgLy8gdHJ1ZSBmb3IgSUUKICAgIGFkZHRlc3QoImRvbS1jdXJyZW50LXN0eWxlIiwgZnVuY3Rpb24oZywgZCl7CiAgICAgICAgcmV0dXJuICFoYXMoImRvbS1jb21wdXRlZC1zdHlsZSIpICYmIGhhcy5pc0hvc3RUeXBlKGQuZG9jdW1lbnRFbGVtZW50LCAiY3VycmVudFN0eWxlIik7CiAgICB9KTsKCiAgICAvLyB0cnVlIGZvciBJRQogICAgYWRkdGVzdCgiZG9tLWVsZW1lbnQtZG8tc2Nyb2xsIiwgZnVuY3Rpb24oZywgZCl7CiAgICAgICAgcmV0dXJuIGhhcy5pc0hvc3RUeXBlKGQuZG9jdW1lbnRFbGVtZW50LCAiZG9TY3JvbGwiKTsKICAgIH0pOwoKICAgIC8vIHRlc3QgZm9yIGR5bmFtaWMtdXBkYXRpbmcgYmFzZSB0YWcgc3VwcG9ydCAoYWxsb3dzIHVzIHRvIGF2b2lkIGhyZWYgJiBzcmMgYXR0ciByZXdyaXRpbmcpCiAgICAvLyBmYWxzZSBmb3IgRmlyZWZveCA8IDQgYW5kIElFIDwgOAogICAgYWRkdGVzdCgiZG9tLWR5bmFtaWMtYmFzZSIsIGZ1bmN0aW9uIChnLCBkLCBlbCl7CiAgICAgICAgdmFyIGF0dGVtcHQsCiAgICAgICAgICAgIGJhY2t1cCwKICAgICAgICAgICAgYmFzZSwKICAgICAgICAgICAgYXR0ZW1wdHMgPSBbW2QuY3JlYXRlRWxlbWVudCgiYSIpLCAiaHJlZiJdLCBbZC5jcmVhdGVFbGVtZW50KCJxIiksICJjaXRlIl1dLAogICAgICAgICAgICBoZWFkID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLAogICAgICAgICAgICBocmVmID0gbG9jYXRpb24uaHJlZiwKICAgICAgICAgICAgZmFrZSA9IGZhbHNlLAogICAgICAgICAgICBzdXBwb3J0ZWQgPSBudWxsLAogICAgICAgICAgICB0b2tlbiA9IGxvY2F0aW9uLnNlYXJjaCB8fCBsb2NhdGlvbi5oYXNoOwoKICAgICAgICBpZihoZWFkKXsKICAgICAgICAgICAgYmFzZSA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJhc2UiKVswXSB8fCAoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGZha2UgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGhlYWQuaW5zZXJ0QmVmb3JlKGQuY3JlYXRlRWxlbWVudCgiYmFzZSIpLCBoZWFkLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICB9KSgpOwoKICAgICAgICAgICAgYmFja3VwID0gYmFzZS5ocmVmIHx8IGhyZWYuc2xpY2UoMCwgdG9rZW4gPyBocmVmLmluZGV4T2YodG9rZW4pIDogaHJlZi5sZW5ndGgpLnJlcGxhY2UoL1teXC9dKiQvLCAiIik7CiAgICAgICAgICAgIGJhc2UuaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8veCI7CgogICAgICAgICAgICAvLyBjaGVjayBzdXBwb3J0IG9uIG1vcmUgdGhhbiBvbmUgZWxlbWVudCB0byBiZSB0aG9yb3VnaAogICAgICAgICAgICB3aGlsZShhdHRlbXB0ID0gYXR0ZW1wdHMucG9wKCkpewogICAgICAgICAgICAgICAgaWYoc3VwcG9ydGVkICE9IGZhbHNlKXsKICAgICAgICAgICAgICAgICAgICBhdHRlbXB0WzBdW2F0dGVtcHRbMV1dID0gInkiOwogICAgICAgICAgICAgICAgICAgIHN1cHBvcnRlZCA9IGF0dGVtcHRbMF1bYXR0ZW1wdFsxXV0uaW5kZXhPZigieC95IikgPiAtMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXNldCBocmVmIGJlZm9yZSByZW1vdmFsLCBvdGhlcndpc2UgaHJlZiBwZXJzaXN0cyBpbiBPcGVyYQogICAgICAgICAgICBiYXNlLmhyZWYgPSBiYWNrdXA7CiAgICAgICAgICAgIGlmKGZha2UpewogICAgICAgICAgICAgICAgaGVhZC5yZW1vdmVDaGlsZChiYXNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwcG9ydGVkOwogICAgfSk7CgogICAgYWRkdGVzdCgiZG9tLW5vZGVsaXN0LXNsaWNlYWJsZSIsIGZ1bmN0aW9uKGcsIGQsIGVsKXsKICAgICAgICB2YXIgc3VwcG9ydGVkID0gZmFsc2UsCiAgICAgICAgICAgIGRlID0gZC5kb2N1bWVudEVsZW1lbnQsCiAgICAgICAgICAgIGlkID0gZGUuaWQ7CgogICAgICAgIC8vIE9wZXJhIDkuMjUgYnVnCiAgICAgICAgZGUuaWQgPSAibGVuZ3RoIjsKICAgICAgICAvLyBvbGRlciBTYWZhcmkgd2lsbCByZXR1cm4gYW4gZW1wdHkgYXJyYXkKICAgICAgICB0cnl7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9ICEhW10uc2xpY2UuY2FsbChkLmNoaWxkTm9kZXMsIDApWzBdOwogICAgICAgIH1jYXRjaChlKXt9CgogICAgICAgIGRlLmlkID0gaWQ7CiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDsKICAgIH0pOwoKfSkoaGFzLCBoYXMuYWRkLCBoYXMuY3NzcHJvcCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 03:03:08 GMT",
                    "Content-Length": "6208",
                    "Date": "Fri, 07 Nov 2014 03:03:08 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}